########################################################################################################################
PHASE 1
########################################################################################################################
========================================================================================================================
AGENT:
I will start by viewing the workspace to understand its structure and contents. This will help me identify key files and locations that may be relevant to the task.
========================================================================================================================
USER PROMPT:
Resolve the following problem statement:

<problem_statement>
`EnumMap` deserialization fails with `ClassCastException`
# Gson version
e2e851c9bc692cec68ba7b0cbb002f82b4a229e4

# Java / Android version
openjdk version "11.0.13" 2021-10-19
OpenJDK Runtime Environment Temurin-11.0.13+8 (build 11.0.13+8)
OpenJDK 64-Bit Server VM Temurin-11.0.13+8 (build 11.0.13+8, mixed mode)

# Description
`EnumMap` deserialization fails with `ClassCastException`:
```
java.lang.ClassCastException: class java.util.LinkedHashMap cannot be cast to class java.util.EnumMap
```

The underlying issue is related to #1708, it appears special handling for `EnumMap` is missing.
(I am a bit surprised that this issue has not been mentioned here anywhere before.)

# Reproduction steps
Test case:
```java
private static enum MyEnum {
  VALUE1, VALUE2
}

public void testEnumMap() throws Exception {
  EnumMap<MyEnum, String> map = new EnumMap<MyEnum, String>(MyEnum.class);
  map.put(MyEnum.VALUE1, "test");
  String json = gson.toJson(map);
  assertEquals("{\"VALUE1\":\"test\"}", json);

  Type type = new TypeToken<EnumMap<MyEnum, String>>() {}.getType();
  EnumMap<?, ?> actualMap = gson.fromJson("{\"VALUE1\":\"test\"}", type);
  Map<?, ?> expectedMap = Collections.singletonMap(MyEnum.VALUE1, "test");
  assertEquals(expectedMap, actualMap);
}
```

# Exception stack trace
Not really useful because `ClassCastException` occurs in user code.


</problem_statement>

Do not stop until you have made code changes that resolve the problem statement. Do not ask for clarifications.
========================================================================================================================
AGENT:
I'll start by exploring the workspace to understand the codebase structure and then identify the issue related to `EnumMap` deserialization.
========================================================================================================================
AGENT:
Starting to analyze the problem with EnumMap deserialization failing with ClassCastException. Need to explore the codebase to understand how Map deserialization works and identify where special handling for EnumMap is needed.
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- gson/src/main/java/com/google/gson/internal/bind/MapTypeAdapterFactory.java
- gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened gson/src/main/java/com/google/gson/internal/bind/MapTypeAdapterFactory.java:\n\n````java\n   0 /*\n...\n 104 public final class MapTypeAdapterFactory implements TypeAdapterFactory {\n 105   private final ConstructorConstructor constructorConstructor;\n...\n 108   public MapTypeAdapterFactory(ConstructorConstructor constructorConstructor,\n...\n 114   @Override public <T> TypeAdapter<T> create(Gson gson, TypeToken<T> typeToken) {\n...\n 138   private TypeAdapter<?> getKeyAda...
```
========================================================================================================================
AGENT:
<thinking>
I need to expand the relevant code chunks to understand how the Map deserialization works and where the EnumMap handling should be added. Let me expand the `newDefaultImplementationConstructor` method in `ConstructorConstructor.java` since that's where default implementations for collection types are typically handled.
</thinking>
========================================================================================================================
TOOL CALL (inspect_code)
file_path: gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
line_ranges:
- - 0
  - -1

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java:

````java
   0 /*
   1  * Copyright (C) 2011 Google Inc.
   2  *
   3  * Licensed under the Apache License, Version 2.0 (the "License");
   4  * you may not use this file except in compliance with the License.
   5  * You may obtain a copy of the License at
   6  *
   7  * http://www.apache.org/licenses/LICENSE-2.0
   8  *
   9  * Unless required by applicable law or agreed to in writing...
```
========================================================================================================================
AGENT:
<thinking>
Now I understand the issue. Looking at the `newDefaultImplementationConstructor` method in `ConstructorConstructor.java`:

1. For `EnumSet`, there's special handling (lines 163-178) that extracts the element type from the `ParameterizedType` and creates an `EnumSet` using `EnumSet.noneOf((Class)elementType)`.

2. For `Map`, there's handling for `ConcurrentNavigableMap`, `ConcurrentMap`, `SortedMap`, and a generic fallback to `LinkedHashMap` or `LinkedTreeMap`.

3. However, there's NO special handling for `EnumMap`! The `EnumMap` class requires a special constructor that takes the enum class as an argument (similar to `EnumSet`). Without this special handling, Gson falls back to creating a `LinkedHashMap` which then causes a `ClassCastException` when the user tries to cast it to `EnumMap`.

The fix should add special handling for `EnumMap` similar to how `EnumSet` is handled. I need to:
1. Add an import for `java.util.EnumMap`
2. Add a check for `EnumMap.class.isAssignableFrom(rawType)` in the Map handling section
3. Extract the key type from the `ParameterizedType` and create an `EnumMap` using `new EnumMap<>((Class)keyType)`

Let me also look at the MapTypeAdapterFactory to understand how it works:
</thinking>
========================================================================================================================
TOOL CALL (inspect_code)
file_path: gson/src/main/java/com/google/gson/internal/bind/MapTypeAdapterFactory.java
line_ranges:
- - 0
  - -1

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in gson/src/main/java/com/google/gson/internal/bind/MapTypeAdapterFactory.java:

````java
   0 /*
   1  * Copyright (C) 2011 Google Inc.
   2  *
   3  * Licensed under the Apache License, Version 2.0 (the "License");
   4  * you may not use this file except in compliance with the License.
   5  * You may obtain a copy of the License at
   6  *
   7  *      http://www.apache.org/licenses/LICENSE-2.0
   8  *
   9  * Unless required by applicable law or agreed to i...
```
========================================================================================================================
AGENT:
<thinking>
Now I understand the full picture. The issue is in `ConstructorConstructor.java`. When deserializing an `EnumMap`, the code doesn't have special handling for it, so it falls through to the generic Map handling which creates a `LinkedHashMap` or `LinkedTreeMap`.

The fix needs to be in the `newDefaultImplementationConstructor` method in `ConstructorConstructor.java`. I need to add a check for `EnumMap` similar to how `EnumSet` is handled.

Looking at the existing code:
1. For `EnumSet`, it checks if `type instanceof ParameterizedType`, then gets the first type argument (the enum element type), and creates `EnumSet.noneOf((Class)elementType)`.
2. For `EnumMap`, I need to do something similar: check if `type instanceof ParameterizedType`, get the first type argument (the enum key type), and create `new EnumMap<>((Class)keyType)`.

Let me now implement the fix:

1. Add import for `java.util.EnumMap`
2. Add the EnumMap handling in the Map section, before the other Map checks

Let me first write a test to verify the issue exists and then fix it.
</thinking>

Let me first create a test to reproduce the issue:
========================================================================================================================
TOOL CALL (bash)
command: cd gson && find . -name "*.java" | xargs grep -l "EnumMap" | head -10

========================================================================================================================
TOOL RETURN (bash)
```
...
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && cat pom.xml | head -50

========================================================================================================================
TOOL RETURN (bash)
```
<project xmlns="http://maven.apache.org/POM/4.0.0"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>

  <parent>
    <groupId>com.google.code.gson</groupId>
    <artifactId>gson-parent</artifactId>
    <version>2.9.0-SNAPSHOT</version>
  </parent>

  <artifactId>gson</artifactId>
  <name>Gson</name>

  <licenses>
    <license>
      <name>Apache-2.0</name>...
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn compile -q 2>&1 | tail -20

========================================================================================================================
TOOL RETURN (bash)
```
tmp_code_177cf04125e92b614f4ce1e7bbddcc990d0d15c3c0c223782f7eee1452f08a50.bash: line 1: mvn: command not found...
```
========================================================================================================================
TOOL CALL (bash)
command: which java && java -version

========================================================================================================================
TOOL RETURN (bash)
```
/usr/bin/java
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
openjdk version "21.0.8" 2025-07-15
OpenJDK Runtime Environment (build 21.0.8+9-Ubuntu-0ubuntu124.04.1)
OpenJDK 64-Bit Server VM (build 21.0.8+9-Ubuntu-0ubuntu124.04.1, mixed mode, sharing)...
```
========================================================================================================================
TOOL CALL (bash)
command: apt-get update && apt-get install -y maven 2>&1 | tail -5

========================================================================================================================
TOOL RETURN (bash)
```
Hit:1 https://apt.llvm.org/noble llvm-toolchain-noble-20 InRelease
Hit:2 http://ports.ubuntu.com/ubuntu-ports noble InRelease
Get:3 http://ports.ubuntu.com/ubuntu-ports noble-updates InRelease [126 kB]
Get:4 http://ports.ubuntu.com/ubuntu-ports noble-backports InRelease [126 kB]
Get:5 http://ports.ubuntu.com/ubuntu-ports noble-security InRelease [126 kB]
Get:6 http://ports.ubuntu.com/ubuntu-ports noble-updates/main arm64 Packages [2152 kB]
Get:7 http://ports.ubuntu.com/ubuntu-ports noble-updates...
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn compile -q 2>&1 | tail -20

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
[[1;31mERROR[m] Failed to execute goal [32morg.apache.maven.plugins:maven-compiler-plugin:3.9.0:compile[m [1m(default-compile)[m on project [36mgson[m: [1;31mFatal error compiling[m: error: release version 7 not supported -> [1m[Help 1][m
[[1;31mERROR[m] 
[[1;31mERROR[m] To see the full stack trace of the errors, re-run Maven with the [1m-e...
```
========================================================================================================================
TOOL CALL (bash)
command: cat pom.xml | grep -A5 "maven.compiler"

========================================================================================================================
TOOL RETURN (bash)
```
          <artifactId>maven-compiler-plugin</artifactId>
          <version>3.9.0</version>
          <configuration>
            <release>${javaVersion}</release>
            <jdkToolchain>
              <version>[11,)</version>...
```
========================================================================================================================
TOOL CALL (bash)
command: cat pom.xml | grep "javaVersion"

========================================================================================================================
TOOL RETURN (bash)
```
    <javaVersion>7</javaVersion>
            <release>${javaVersion}</release>...
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn compile -q -DjavaVersion=11 2>&1 | tail -20

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
AGENT:
The code compiles. Now let me create a simple test to reproduce the issue:
========================================================================================================================
TOOL CALL (bash)
command: "cat > /tmp/EnumMapTest.java << 'EOF'\nimport com.google.gson.Gson;\nimport\
  \ com.google.gson.reflect.TypeToken;\nimport java.lang.reflect.Type;\nimport java.util.Collections;\n\
  import java.util.EnumMap;\nimport java.util.Map;\n\npublic class EnumMapTest {\n\
  \    private static enum MyEnum {\n        VALUE1, VALUE2\n    }\n\n    public static\
  \ void main(String[] args) {\n        Gson gson = new Gson();\n        \n      \
  \  // Test serialization\n        EnumMap<MyEnum, String> map = new EnumMap<MyEnum,\
  \ String>(MyEnum.class);\n        map.put(MyEnum.VALUE1, \"test\");\n        String\
  \ json = gson.toJson(map);\n        System.out.println(\"Serialized: \" + json);\n\
  \        \n        // Test deserialization\n        Type type = new TypeToken<EnumMap<MyEnum,\
  \ String>>() {}.getType();\n        try {\n            EnumMap<?, ?> actualMap =\
  \ gson.fromJson(\"{\\\"VALUE1\\\":\\\"test\\\"}\", type);\n            Map<?, ?>\
  \ expectedMap = Collections.singletonMap(MyEnum.VALUE1, \"test\");\n           \
  \ System.out.println(\"Deserialized: \" + actualMap);\n            System.out.println(\"\
  Expected: \" + expectedMap);\n            System.out.println(\"Equals: \" + expectedMap.equals(actualMap));\n\
  \            System.out.println(\"SUCCESS!\");\n        } catch (ClassCastException\
  \ e) {\n            System.out.println(\"FAILED with ClassCastException: \" + e.getMessage());\n\
  \            e.printStackTrace();\n        }\n    }\n}\nEOF\n"

========================================================================================================================
TOOL RETURN (bash)
```
...
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && javac -cp target/classes /tmp/EnumMapTest.java -d /tmp 2>&1

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && java -cp target/classes:/tmp EnumMapTest 2>&1

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Serialized: {"VALUE1":"test"}
FAILED with ClassCastException: class java.util.LinkedHashMap cannot be cast to class java.util.EnumMap (java.util.LinkedHashMap and java.util.EnumMap are in module java.base of loader 'bootstrap')
java.lang.ClassCastException: class java.util.LinkedHashMap cannot be cast to class java.util.EnumMap (java.util.LinkedHashMap and j...
```
========================================================================================================================
AGENT:
I've confirmed the issue. Now let me implement the fix in `ConstructorConstructor.java`:
========================================================================================================================
AGENT:
Confirmed the issue - EnumMap deserialization fails with ClassCastException because there's no special handling for EnumMap in ConstructorConstructor. Now implementing the fix by adding EnumMap handling similar to how EnumSet is handled.
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
find: 'import java.util.ArrayDeque;

  import java.util.ArrayList;

  import java.util.Collection;

  import java.util.EnumSet;

  import java.util.LinkedHashMap;

  import java.util.LinkedHashSet;

  import java.util.Map;

  import java.util.Queue;

  import java.util.Set;

  import java.util.SortedMap;

  import java.util.SortedSet;

  import java.util.TreeMap;

  import java.util.TreeSet;

  import java.util.concurrent.ConcurrentHashMap;

  import java.util.concurrent.ConcurrentMap;

  import java.util.concurrent.ConcurrentNavigableMap;

  import java.util.concurrent.ConcurrentSkipListMap;'
replace: 'import java.util.ArrayDeque;

  import java.util.ArrayList;

  import java.util.Collection;

  import java.util.EnumMap;

  import java.util.EnumSet;

  import java.util.LinkedHashMap;

  import java.util.LinkedHashSet;

  import java.util.Map;

  import java.util.Queue;

  import java.util.Set;

  import java.util.SortedMap;

  import java.util.SortedSet;

  import java.util.TreeMap;

  import java.util.TreeSet;

  import java.util.concurrent.ConcurrentHashMap;

  import java.util.concurrent.ConcurrentMap;

  import java.util.concurrent.ConcurrentNavigableMap;

  import java.util.concurrent.ConcurrentSkipListMap;'

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java:

--- gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
+++ gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
@@ -23,6 +23,7 @@
 import java.util.ArrayDeque;
 import java.util.ArrayList;
 import java.util.Collection;
+import java.util.EnumMap;
 import java.util.EnumSet;
 import java.util.LinkedHashMap;
 import java.util.LinkedHashSet;
...
```
========================================================================================================================
AGENT:
Now let me add the EnumMap handling in the Map section:
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
find: "    if (Map.class.isAssignableFrom(rawType)) {\n      if (ConcurrentNavigableMap.class.isAssignableFrom(rawType))\
  \ {\n        return new ObjectConstructor<T>() {\n          @Override public T construct()\
  \ {\n            return (T) new ConcurrentSkipListMap<Object, Object>();\n     \
  \     }\n        };\n      } else if (ConcurrentMap.class.isAssignableFrom(rawType))\
  \ {\n        return new ObjectConstructor<T>() {\n          @Override public T construct()\
  \ {\n            return (T) new ConcurrentHashMap<Object, Object>();\n         \
  \ }\n        };\n      } else if (SortedMap.class.isAssignableFrom(rawType)) {\n\
  \        return new ObjectConstructor<T>() {\n          @Override public T construct()\
  \ {\n            return (T) new TreeMap<Object, Object>();\n          }\n      \
  \  };\n      } else if (type instanceof ParameterizedType && !(String.class.isAssignableFrom(\n\
  \          TypeToken.get(((ParameterizedType) type).getActualTypeArguments()[0]).getRawType())))\
  \ {\n        return new ObjectConstructor<T>() {\n          @Override public T construct()\
  \ {\n            return (T) new LinkedHashMap<Object, Object>();\n          }\n\
  \        };\n      } else {\n        return new ObjectConstructor<T>() {\n     \
  \     @Override public T construct() {\n            return (T) new LinkedTreeMap<String,\
  \ Object>();\n          }\n        };\n      }\n    }"
replace: "    if (Map.class.isAssignableFrom(rawType)) {\n      if (ConcurrentNavigableMap.class.isAssignableFrom(rawType))\
  \ {\n        return new ObjectConstructor<T>() {\n          @Override public T construct()\
  \ {\n            return (T) new ConcurrentSkipListMap<Object, Object>();\n     \
  \     }\n        };\n      } else if (ConcurrentMap.class.isAssignableFrom(rawType))\
  \ {\n        return new ObjectConstructor<T>() {\n          @Override public T construct()\
  \ {\n            return (T) new ConcurrentHashMap<Object, Object>();\n         \
  \ }\n        };\n      } else if (SortedMap.class.isAssignableFrom(rawType)) {\n\
  \        return new ObjectConstructor<T>() {\n          @Override public T construct()\
  \ {\n            return (T) new TreeMap<Object, Object>();\n          }\n      \
  \  };\n      } else if (EnumMap.class.isAssignableFrom(rawType)) {\n        return\
  \ new ObjectConstructor<T>() {\n          @SuppressWarnings(\"rawtypes\")\n    \
  \      @Override public T construct() {\n            if (type instanceof ParameterizedType)\
  \ {\n              Type keyType = ((ParameterizedType) type).getActualTypeArguments()[0];\n\
  \              if (keyType instanceof Class) {\n                return (T) new EnumMap((Class)\
  \ keyType);\n              } else {\n                throw new JsonIOException(\"\
  Invalid EnumMap type: \" + type.toString());\n              }\n            } else\
  \ {\n              throw new JsonIOException(\"Invalid EnumMap type: \" + type.toString());\n\
  \            }\n          }\n        };\n      } else if (type instanceof ParameterizedType\
  \ && !(String.class.isAssignableFrom(\n          TypeToken.get(((ParameterizedType)\
  \ type).getActualTypeArguments()[0]).getRawType()))) {\n        return new ObjectConstructor<T>()\
  \ {\n          @Override public T construct() {\n            return (T) new LinkedHashMap<Object,\
  \ Object>();\n          }\n        };\n      } else {\n        return new ObjectConstructor<T>()\
  \ {\n          @Override public T construct() {\n            return (T) new LinkedTreeMap<String,\
  \ Object>();\n          }\n        };\n      }\n    }"

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java:

--- gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
+++ gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
@@ -218,6 +218,22 @@
             return (T) new TreeMap<Object, Object>();
           }
         };
+      } else if (EnumMap.class.isAssignableFrom(rawType)) {
+        return new ObjectConstructor<T>() {
+          @SuppressWarnings("rawtype...
```
========================================================================================================================
AGENT:
Now let me recompile and test:
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn compile -q -DjavaVersion=11 2>&1 | tail -20

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && java -cp target/classes:/tmp EnumMapTest 2>&1

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Serialized: {"VALUE1":"test"}
Deserialized: {VALUE1=test}
Expected: {VALUE1=test}
Equals: true
SUCCESS!...
```
========================================================================================================================
AGENT:
The fix works. Now let me verify the changes by looking at the modified file:
========================================================================================================================
TOOL CALL (inspect_code)
file_path: gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
line_ranges:
- - 15
  - 45
- - 200
  - 260

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java:

````java
   0 /*
   1  * Copyright (C) 2011 Google Inc.
   2  *
   3  * Licensed under the Apache License, Version 2.0 (the "License");
   4  * you may not use this file except in compliance with the License.
   5  * You may obtain a copy of the License at
   6  *
   7  * http://www.apache.org/licenses/LICENSE-2.0
   8  *
   9  * Unless required by applicable law or agreed to in writing...
```
========================================================================================================================
AGENT:
The code looks good. Now let me run the existing tests to make sure I haven't broken anything:
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn test -q -DjavaVersion=11 -Dtest=MapTest 2>&1 | tail -30

========================================================================================================================
TOOL RETURN (bash)
```
 [proguard] 	... 6 more
 [proguard] Caused by: java.lang.UnsupportedOperationException: Unsupported version number [65.0] (maximum 61.0, Java 17)
 [proguard] 	at proguard.classfile.util.ClassUtil.checkVersionNumbers(ClassUtil.java:165) ~[proguard-core-8.0.3.jar:?]
 [proguard] 	at proguard.classfile.io.LibraryClassReader.visitLibraryClass(LibraryClassReader.java:86) ~[proguard-core-8.0.3.jar:?]
 [proguard] 	at proguard.classfile.LibraryClass.accept(LibraryClass.java:408) ~[proguard-core-8.0.3.jar...
```
========================================================================================================================
AGENT:
The proguard plugin is failing due to Java version incompatibility. Let me skip that and run the tests directly:
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn test -q -DjavaVersion=11 -Dtest=MapTest -DskipProguard=true
  2>&1 | tail -30

========================================================================================================================
TOOL RETURN (bash)
```
 [proguard] 	... 6 more
 [proguard] Caused by: java.lang.UnsupportedOperationException: Unsupported version number [65.0] (maximum 61.0, Java 17)
 [proguard] 	at proguard.classfile.util.ClassUtil.checkVersionNumbers(ClassUtil.java:165) ~[proguard-core-8.0.3.jar:?]
 [proguard] 	at proguard.classfile.io.LibraryClassReader.visitLibraryClass(LibraryClassReader.java:86) ~[proguard-core-8.0.3.jar:?]
 [proguard] 	at proguard.classfile.LibraryClass.accept(LibraryClass.java:408) ~[proguard-core-8.0.3.jar...
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn test-compile -q -DjavaVersion=11 -Dproguard.skip=true 2>&1
  | tail -10

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn surefire:test -q -DjavaVersion=11 -Dtest=MapTest 2>&1 | tail
  -30

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
[[1;31mERROR[m] OpenJDK 64-Bit Server VM warning: Ignoring option --illegal-access=deny; support was removed in 17.0
[[1;31mERROR[m] OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn surefire:test -DjavaVersion=11 -Dtest=MapTest 2>&1 | tail
  -50

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
[[1;34mINFO[m] Scanning for projects...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m---------------------< [0;36mcom.google.code.gson:gson[0;1m >----------------------[m
[[1;34mINFO[m] [1mBuilding Gson 2.9.0-SNAPSHOT[m
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m-...
```
========================================================================================================================
AGENT:
All 48 tests in MapTest passed. Let me also look at the existing MapTest to see if there are any EnumMap tests already:
========================================================================================================================
TOOL CALL (bash)
command: cd gson && grep -n "EnumMap" src/test/java/com/google/gson/functional/MapTest.java

========================================================================================================================
TOOL RETURN (bash)
```
...
```
========================================================================================================================
AGENT:
There are no existing EnumMap tests. Let me look at the MapTest file to add a proper test for EnumMap:
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- gson/src/test/java/com/google/gson/functional/MapTest.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened gson/src/test/java/com/google/gson/functional/MapTest.java:\n\n````java\n   0 /*\n...\n  53 public class MapTest extends TestCase {\n  54   private Gson gson;\n  55 \n  56   @Override\n  57   protected void setUp() throws Exception {\n...\n  62   public void testMapSerialization() {\n...\n  72   public void testMapDeserialization() {\n...\n  80   @SuppressWarnings({"unchecked", "rawtypes"})\n  81   public void testRawMapSerialization() {\n...\n  90   public void testMapSeri...
```
========================================================================================================================
TOOL CALL (inspect_code)
file_path: gson/src/test/java/com/google/gson/functional/MapTest.java
line_ranges:
- - 0
  - 60
- - 230
  - 260

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in gson/src/test/java/com/google/gson/functional/MapTest.java:

````java
   0 /*
   1  * Copyright (C) 2008 Google Inc.
   2  *
   3  * Licensed under the Apache License, Version 2.0 (the "License");
   4  * you may not use this file except in compliance with the License.
   5  * You may obtain a copy of the License at
   6  *
   7  * http://www.apache.org/licenses/LICENSE-2.0
   8  *
   9  * Unless required by applicable law or agreed to in writing, software
  ...
```
========================================================================================================================
AGENT:
Now let me add a test for EnumMap. I'll add it after the ConcurrentSkipListMap test:
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: gson/src/test/java/com/google/gson/functional/MapTest.java
find: 'import java.lang.reflect.Type;

  import java.util.Collection;

  import java.util.HashMap;

  import java.util.LinkedHashMap;

  import java.util.Map;

  import java.util.SortedMap;

  import java.util.TreeMap;

  import java.util.concurrent.ConcurrentHashMap;

  import java.util.concurrent.ConcurrentMap;

  import java.util.concurrent.ConcurrentNavigableMap;

  import java.util.concurrent.ConcurrentSkipListMap;'
replace: 'import java.lang.reflect.Type;

  import java.util.Collection;

  import java.util.EnumMap;

  import java.util.HashMap;

  import java.util.LinkedHashMap;

  import java.util.Map;

  import java.util.SortedMap;

  import java.util.TreeMap;

  import java.util.concurrent.ConcurrentHashMap;

  import java.util.concurrent.ConcurrentMap;

  import java.util.concurrent.ConcurrentNavigableMap;

  import java.util.concurrent.ConcurrentSkipListMap;'

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in gson/src/test/java/com/google/gson/functional/MapTest.java:

--- gson/src/test/java/com/google/gson/functional/MapTest.java
+++ gson/src/test/java/com/google/gson/functional/MapTest.java
@@ -18,6 +18,7 @@
 
 import java.lang.reflect.Type;
 import java.util.Collection;
+import java.util.EnumMap;
 import java.util.HashMap;
 import java.util.LinkedHashMap;
 import java.util.Map;
...
```
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: gson/src/test/java/com/google/gson/functional/MapTest.java
find: "  public void testConcurrentSkipListMap() throws Exception {\n    Type typeOfMap\
  \ = new TypeToken<ConcurrentSkipListMap<Integer, String>>() {}.getType();\n    ConcurrentSkipListMap<Integer,\
  \ String> map = gson.fromJson(\"{\\\"123\\\":\\\"456\\\"}\", typeOfMap);\n    assertEquals(1,\
  \ map.size());\n    assertTrue(map.containsKey(123));\n    assertEquals(\"456\"\
  , map.get(123));\n    String json = gson.toJson(map);\n    assertEquals(\"{\\\"\
  123\\\":\\\"456\\\"}\", json);\n  }\n\n  public void testParameterizedMapSubclassSerialization()\
  \ {"
replace: "  public void testConcurrentSkipListMap() throws Exception {\n    Type typeOfMap\
  \ = new TypeToken<ConcurrentSkipListMap<Integer, String>>() {}.getType();\n    ConcurrentSkipListMap<Integer,\
  \ String> map = gson.fromJson(\"{\\\"123\\\":\\\"456\\\"}\", typeOfMap);\n    assertEquals(1,\
  \ map.size());\n    assertTrue(map.containsKey(123));\n    assertEquals(\"456\"\
  , map.get(123));\n    String json = gson.toJson(map);\n    assertEquals(\"{\\\"\
  123\\\":\\\"456\\\"}\", json);\n  }\n\n  private enum MyEnum {\n    VALUE1, VALUE2\n\
  \  }\n\n  public void testEnumMap() throws Exception {\n    EnumMap<MyEnum, String>\
  \ map = new EnumMap<MyEnum, String>(MyEnum.class);\n    map.put(MyEnum.VALUE1, \"\
  test\");\n    String json = gson.toJson(map);\n    assertEquals(\"{\\\"VALUE1\\\"\
  :\\\"test\\\"}\", json);\n\n    Type type = new TypeToken<EnumMap<MyEnum, String>>()\
  \ {}.getType();\n    EnumMap<?, ?> actualMap = gson.fromJson(\"{\\\"VALUE1\\\":\\\
  \"test\\\"}\", type);\n    assertEquals(1, actualMap.size());\n    assertEquals(\"\
  test\", actualMap.get(MyEnum.VALUE1));\n  }\n\n  public void testParameterizedMapSubclassSerialization()\
  \ {"

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in gson/src/test/java/com/google/gson/functional/MapTest.java:

--- gson/src/test/java/com/google/gson/functional/MapTest.java
+++ gson/src/test/java/com/google/gson/functional/MapTest.java
@@ -252,6 +252,22 @@
     assertEquals("{\"123\":\"456\"}", json);
   }
 
+  private enum MyEnum {
+    VALUE1, VALUE2
+  }
+
+  public void testEnumMap() throws Exception {
+    EnumMap<MyEnum, String> map = new EnumMap<MyEnum, String>(MyEnum.class);
+    map.put(MyEnum.VALUE1, "te...
```
========================================================================================================================
AGENT:
Now let me run the tests to verify the fix works:
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn test-compile -q -DjavaVersion=11 -Dproguard.skip=true 2>&1
  | tail -10

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn surefire:test -DjavaVersion=11 -Dtest=MapTest 2>&1 | tail
  -30

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
[[1;34mINFO[m] Scanning for projects...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m---------------------< [0;36mcom.google.code.gson:gson[0;1m >----------------------[m
[[1;34mINFO[m] [1mBuilding Gson 2.9.0-SNAPSHOT[m
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m-...
```
========================================================================================================================
AGENT:
All 49 tests pass (48 original + 1 new EnumMap test). Let me also run a broader set of tests to make sure nothing is broken:
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn surefire:test -DjavaVersion=11 2>&1 | tail -50

========================================================================================================================
TOOL RETURN (bash)
```
[[1;34mINFO[m] [1;32mTests run: [0;1;32m2[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 s - in com.google.gson.functional.[1mTreeTypeAdaptersTest[m
[[1;34mINFO[m] Running com.google.gson.functional.[1mExclusionStrategyFunctionalTest[m
[[1;34mINFO[m] [1;32mTests run: [0;1;32m9[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 s - in com.google.gson.functional.[1mExclusionStrategyFunctionalTest[m
[[1;34mINFO[m] Running com.google.gson.functional.[1mLenien...
```
========================================================================================================================
AGENT:
The test failures are unrelated to my changes - they are about date formatting (locale/timezone issues) and security manager issues that are pre-existing in the codebase. The important thing is that the MapTest passes and the EnumMap test passes.

Let me verify the changes one more time and run the original reproduction test:
========================================================================================================================
TOOL CALL (bash)
command: cd gson && java -cp target/classes:/tmp EnumMapTest 2>&1

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Serialized: {"VALUE1":"test"}
Deserialized: {VALUE1=test}
Expected: {VALUE1=test}
Equals: true
SUCCESS!...
```
========================================================================================================================
AGENT:
Let me also verify the final state of the modified files:
========================================================================================================================
TOOL CALL (bash)
command: cd gson && git diff src/main/java/com/google/gson/internal/ConstructorConstructor.java

========================================================================================================================
TOOL RETURN (bash)
```
diff --git a/gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java b/gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
index aa1e3ff6..cb138725 100644
--- a/gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
+++ b/gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java
@@ -23,6 +23,7 @@ import java.lang.reflect.Type;
 import java.util.ArrayDeque;
 import java.util.ArrayList;
 import java.util.Collection;
+import java.ut...
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && git diff src/test/java/com/google/gson/functional/MapTest.java

========================================================================================================================
TOOL RETURN (bash)
```
diff --git a/gson/src/test/java/com/google/gson/functional/MapTest.java b/gson/src/test/java/com/google/gson/functional/MapTest.java
index d14585b3..60385597 100644
--- a/gson/src/test/java/com/google/gson/functional/MapTest.java
+++ b/gson/src/test/java/com/google/gson/functional/MapTest.java
@@ -18,6 +18,7 @@ package com.google.gson.functional;
 
 import java.lang.reflect.Type;
 import java.util.Collection;
+import java.util.EnumMap;
 import java.util.HashMap;
 import java.util.LinkedHashMap;
...
```
========================================================================================================================
AGENT:
The fix has been implemented and tested. Now verifying the changes are complete and correct.
========================================================================================================================
AGENT:
Let me run a few more edge case tests to ensure the fix is robust:
========================================================================================================================
TOOL CALL (bash)
command: "cat > /tmp/EnumMapEdgeCaseTest.java << 'EOF'\nimport com.google.gson.Gson;\n\
  import com.google.gson.reflect.TypeToken;\nimport java.lang.reflect.Type;\nimport\
  \ java.util.EnumMap;\nimport java.util.Map;\n\npublic class EnumMapEdgeCaseTest\
  \ {\n    private static enum MyEnum {\n        VALUE1, VALUE2, VALUE3\n    }\n\n\
  \    public static void main(String[] args) {\n        Gson gson = new Gson();\n\
  \        \n        // Test 1: Empty EnumMap\n        System.out.println(\"Test 1:\
  \ Empty EnumMap\");\n        Type type = new TypeToken<EnumMap<MyEnum, String>>()\
  \ {}.getType();\n        EnumMap<?, ?> emptyMap = gson.fromJson(\"{}\", type);\n\
  \        System.out.println(\"Empty map: \" + emptyMap);\n        System.out.println(\"\
  Is EnumMap: \" + (emptyMap instanceof EnumMap));\n        System.out.println(\"\
  Size: \" + emptyMap.size());\n        \n        // Test 2: Multiple values\n   \
  \     System.out.println(\"\\nTest 2: Multiple values\");\n        EnumMap<MyEnum,\
  \ String> map = new EnumMap<MyEnum, String>(MyEnum.class);\n        map.put(MyEnum.VALUE1,\
  \ \"one\");\n        map.put(MyEnum.VALUE2, \"two\");\n        map.put(MyEnum.VALUE3,\
  \ \"three\");\n        String json = gson.toJson(map);\n        System.out.println(\"\
  Serialized: \" + json);\n        \n        EnumMap<?, ?> deserializedMap = gson.fromJson(json,\
  \ type);\n        System.out.println(\"Deserialized: \" + deserializedMap);\n  \
  \      System.out.println(\"Is EnumMap: \" + (deserializedMap instanceof EnumMap));\n\
  \        System.out.println(\"Equals: \" + map.equals(deserializedMap));\n     \
  \   \n        // Test 3: EnumMap with Integer values\n        System.out.println(\"\
  \\nTest 3: EnumMap with Integer values\");\n        Type intType = new TypeToken<EnumMap<MyEnum,\
  \ Integer>>() {}.getType();\n        EnumMap<MyEnum, Integer> intMap = new EnumMap<MyEnum,\
  \ Integer>(MyEnum.class);\n        intMap.put(MyEnum.VALUE1, 1);\n        intMap.put(MyEnum.VALUE2,\
  \ 2);\n        String intJson = gson.toJson(intMap);\n        System.out.println(\"\
  Serialized: \" + intJson);\n        \n        EnumMap<?, ?> deserializedIntMap =\
  \ gson.fromJson(intJson, intType);\n        System.out.println(\"Deserialized: \"\
  \ + deserializedIntMap);\n        System.out.println(\"Is EnumMap: \" + (deserializedIntMap\
  \ instanceof EnumMap));\n        System.out.println(\"Equals: \" + intMap.equals(deserializedIntMap));\n\
  \        \n        System.out.println(\"\\nAll tests passed!\");\n    }\n}\nEOF\n"

========================================================================================================================
TOOL RETURN (bash)
```
...
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && javac -cp target/classes /tmp/EnumMapEdgeCaseTest.java -d /tmp
  2>&1

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && java -cp target/classes:/tmp EnumMapEdgeCaseTest 2>&1

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Test 1: Empty EnumMap
Empty map: {}
Is EnumMap: true
Size: 0

Test 2: Multiple values
Serialized: {"VALUE1":"one","VALUE2":"two","VALUE3":"three"}
Deserialized: {VALUE1=one, VALUE2=two, VALUE3=three}
Is EnumMap: true
Equals: true

Test 3: EnumMap with Integer values
Serialized: {"VALUE1":1,"VALUE2":2}
Deserialized: {VALUE1=1, VALUE2=2}
Is EnumMap: true
Equal...
```
========================================================================================================================
AGENT:
All edge cases pass. Let me also verify the error handling for invalid EnumMap types:
========================================================================================================================
TOOL CALL (bash)
command: "cat > /tmp/EnumMapErrorTest.java << 'EOF'\nimport com.google.gson.Gson;\n\
  import com.google.gson.JsonIOException;\nimport com.google.gson.reflect.TypeToken;\n\
  import java.lang.reflect.Type;\nimport java.util.EnumMap;\n\npublic class EnumMapErrorTest\
  \ {\n    public static void main(String[] args) {\n        Gson gson = new Gson();\n\
  \        \n        // Test: Raw EnumMap type (no type parameters)\n        System.out.println(\"\
  Test: Raw EnumMap type\");\n        try {\n            @SuppressWarnings(\"rawtypes\"\
  )\n            EnumMap rawMap = gson.fromJson(\"{\\\"VALUE1\\\":\\\"test\\\"}\"\
  , EnumMap.class);\n            System.out.println(\"UNEXPECTED: Got result: \" +\
  \ rawMap);\n        } catch (JsonIOException e) {\n            System.out.println(\"\
  Expected error: \" + e.getMessage());\n        } catch (Exception e) {\n       \
  \     System.out.println(\"Other error: \" + e.getClass().getName() + \": \" + e.getMessage());\n\
  \        }\n        \n        System.out.println(\"\\nTest completed!\");\n    }\n\
  }\nEOF\n"

========================================================================================================================
TOOL RETURN (bash)
```
...
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && javac -cp target/classes /tmp/EnumMapErrorTest.java -d /tmp 2>&1

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
TOOL CALL (bash)
command: cd gson && java -cp target/classes:/tmp EnumMapErrorTest 2>&1

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Test: Raw EnumMap type
Expected error: Invalid EnumMap type: class java.util.EnumMap

Test completed!...
```
========================================================================================================================
AGENT:
The error handling works correctly for raw EnumMap types.

Let me also run the specific test I added to make sure it's working:
========================================================================================================================
TOOL CALL (bash)
command: cd gson && mvn surefire:test -DjavaVersion=11 -Dtest=MapTest#testEnumMap
  2>&1 | tail -20

========================================================================================================================
TOOL RETURN (bash)
```
[[1;34mINFO[m] [1m--- [0;32mmaven-surefire-plugin:3.0.0-M5:test[m [1m(default-cli)[m @ [36mgson[0;1m ---[m
[[1;34mINFO[m] 
[[1;34mINFO[m] -------------------------------------------------------
[[1;34mINFO[m]  T E S T S
[[1;34mINFO[m] -------------------------------------------------------
[[1;31mERROR[m] OpenJDK 64-Bit Server VM warning: Ignoring option --illegal-access=deny; support was removed in 17.0
[[1;31mERROR[m] OpenJDK 64-Bit Server VM warning: Unable to get SVE ve...
```
========================================================================================================================
AGENT:
The test passes. Let me review the final changes one more time:
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened gson/src/main/java/com/google/gson/internal/ConstructorConstructor.java:\n\n````java\n   0 /*\n   1  * Copyright (C) 2011 Google Inc.\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agreed to in writing, s...
```
========================================================================================================================
AGENT:
The changes look correct. Let me summarize what was done:

## Summary of Changes

### Problem
`EnumMap` deserialization was failing with `ClassCastException: class java.util.LinkedHashMap cannot be cast to class java.util.EnumMap` because Gson's `ConstructorConstructor` class didn't have special handling for `EnumMap`.

### Solution
Added special handling for `EnumMap` in `ConstructorConstructor.java`, similar to the existing handling for `EnumSet`. The fix:

1. **Added import for `java.util.EnumMap`** (line 25)

2. **Added EnumMap handling in the `newDefaultImplementationConstructor` method** (lines 220-235):
   - Checks if the raw type is assignable from `EnumMap`
   - Extracts the key type (enum class) from the `ParameterizedType`
   - Creates a new `EnumMap` using the enum class as the constructor argument
   - Throws `JsonIOException` with a descriptive message if the type is not a valid `ParameterizedType` or if the key type is not a `Class`

3. **Added a test case in `MapTest.java`** to verify the fix works correctly for both serialization and deserialization of `EnumMap`.

The fix follows the same pattern as the existing `EnumSet` handling, ensuring consistency in the codebase.
========================================================================================================================
AGENT:
Successfully fixed the EnumMap deserialization issue. The problem was that ConstructorConstructor.java didn't have special handling for EnumMap (similar to how it handles EnumSet). Added the necessary code to:
1. Import java.util.EnumMap
2. Add a check for EnumMap.class.isAssignableFrom(rawType) in the newDefaultImplementationConstructor method
3. Extract the enum key type from the ParameterizedType and create a new EnumMap using that class
4. Added a test case in MapTest.java to verify the fix

The fix allows EnumMap to be properly deserialized from JSON, resolving the ClassCastException that was occurring when Gson was creating a LinkedHashMap instead of an EnumMap.