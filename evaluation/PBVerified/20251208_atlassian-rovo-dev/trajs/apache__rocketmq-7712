########################################################################################################################
PHASE 1
########################################################################################################################
========================================================================================================================
AGENT:
I will start by viewing the workspace to understand its structure and contents. This will help me identify key files and locations that may be relevant to the task.
========================================================================================================================
USER PROMPT:
Resolve the following problem statement:

<problem_statement>
[Bug] Deleting the last item problem of the ACL topic/group perms or the global white list caused by the UtilAll#split func flaw
### Before Creating the Bug Report

- [X] I found a bug, not just asking a question, which should be created in [GitHub Discussions](https://github.com/apache/rocketmq/discussions).

- [X] I have searched the [GitHub Issues](https://github.com/apache/rocketmq/issues) and [GitHub Discussions](https://github.com/apache/rocketmq/discussions)  of this repository and believe that this is not a duplicate.

- [X] I have confirmed that this bug belongs to the current repository, not other repositories of RocketMQ.


### Runtime platform environment

OS(CentOS release 7.6.1810)

### RocketMQ version

branch(develop) version(5.1.5-SNAPSHOT)

### JDK Version

Compliler(Oracke JDK 1.8.0_361) OS(CentOS release 7.6.1810)

### Describe the Bug

I found an bug of ACL during my work on RocketMQ.
When I tried to delete the last item of the ACL topic/group perms, there was an error which indicates the resouce fomat is incrorrect. And there's also an similar problem of the global white list, which is always remain an empty data at last.

### Steps to Reproduce

**To reproduce you can use two ways:**
1. If you use the Dashboard(take the topic/group perms for example)
1.1 Create an ACL with mutiple topic perms and group perms.
1.2 Delete the topic perms or group perms one by one.
1.3 The error woud appear when delete the last one.

![AgAACF5zlnReY1XDkERMf6P-SgV5fqC1](https://github.com/apache/rocketmq/assets/29912051/10e0ddc4-84a9-4306-9f13-b29a26c2cddc)
![AgAACF5zlnR_G2hISrFGkp9IHvbLVnhw](https://github.com/apache/rocketmq/assets/29912051/641c7900-25ae-422f-b892-78725dba4fe3)
![AgAACF5zlnQIxRfBwMZA4odWFJ1KCjd_](https://github.com/apache/rocketmq/assets/29912051/64ca490f-838a-43da-b16a-92fc2995a509)

2. If you want to create an test method for reproduce
2.1 New an DefaultMQAdminExt and config it with namesrv and then start it.
2.2 New an PlainAccessConfig and setGroupPerms(Collections.EMPTY_LIST), setTopicPerms(Collections.EMPTY_LIST).
2.3 Then call DefaultMQAdminExt #createAndUpdatePlainAccessConfig.
2.4 Or to call DefaultMQAdminExt #updateGlobalWhiteAddrConfig with the second parmeter an empty string.

![å›¾ç‰‡](https://github.com/apache/rocketmq/assets/29912051/978d469c-a105-4109-bc9a-76491a5b7cbc)
![å›¾ç‰‡](https://github.com/apache/rocketmq/assets/29912051/f0c277ee-1e91-4c6e-a627-320c2ac59ec4)


### What Did You Expect to See?

For the topic/group perms, it should not be an error to delete the last item.
![å›¾ç‰‡](https://github.com/apache/rocketmq/assets/29912051/26cc5b3d-6b9f-455f-a1ba-5c67668dc20f)


For the global white list, it should not be an empty data

![å›¾ç‰‡](https://github.com/apache/rocketmq/assets/29912051/04377834-cdd7-4a6f-a929-c68bd00482ce)


### What Did You See Instead?

For the topic/group perms, it popup an error: 
org.apache.rocketmq.client.exception.MQClientException: CODE: 209  DESC: Parse Resource format error for .
The expected resource format is 'Res=Perm'. For example: topicA=SUB

![AgAACF5zlnReY1XDkERMf6P-SgV5fqC1](https://github.com/apache/rocketmq/assets/29912051/b06c98b8-852e-4227-9d13-dde47df42f03)

For the global white list, it remains an empty data

![AgAACF5zlnR_G2hISrFGkp9IHvbLVnhw](https://github.com/apache/rocketmq/assets/29912051/794828f0-6471-446c-a885-6e4cd4949803)


### Additional Context

**I've already found and fixed the bug, and I'll submit an PR later.**

</problem_statement>

Do not stop until you have made code changes that resolve the problem statement. Do not ask for clarifications.
========================================================================================================================
AGENT:
Starting to analyze the problem statement. The issue is related to the UtilAll#split function which causes problems when deleting the last item of ACL topic/group perms or the global white list. I need to find and examine the UtilAll#split function and understand how it's being used in the ACL context.
========================================================================================================================
AGENT:
<thinking>
Let me start by examining the problem:

1. The bug is in the `UtilAll#split` function
2. It causes issues when:
   - Deleting the last item of ACL topic/group perms
   - Deleting the last item of the global white list

The error message mentions: "Parse Resource format error for ." which suggests that when an empty string is passed, the split function is returning something unexpected (like an array with an empty string element instead of an empty array).

Let me first find and examine the `UtilAll#split` function.
</thinking>

EXPLORE WORKSPACE: Finding the UtilAll#split function
========================================================================================================================
TOOL CALL (grep)
content_pattern: def split|public.*split
path_glob: '**/UtilAll.java'

========================================================================================================================
TOOL RETURN (grep)
```
common/src/main/java/org/apache/rocketmq/common/UtilAll.java:663:    public static String join(List<String> list, String splitter) {
common/src/main/java/org/apache/rocketmq/common/UtilAll.java:679:    public static List<String> split(String str, String splitter) {...
```
========================================================================================================================
TOOL CALL (inspect_code)
file_path: common/src/main/java/org/apache/rocketmq/common/UtilAll.java
patterns:
- split
- join

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in common/src/main/java/org/apache/rocketmq/common/UtilAll.java:

````java
   0 /*
...
  51 public class UtilAll {
  52     private static final Logger log = LoggerFactory.getLogger(LoggerName.COMMON_LOGGER_NAME);
...
  63         Supplier<Integer> supplier = () -> {
...
  75     public static int getPid() {
...
  79     public static void sleep(long sleepMs) {
...
  83     public static void sleep(long timeOut, TimeUnit timeUnit) {
...
  94     public static St...
```
========================================================================================================================
AGENT:
<thinking>
Now I can see the `split` function. The issue is that when an empty string is passed to `split`, it returns a list with one empty string element instead of an empty list. This is because `String.split("")` or `String.split(";")` on an empty string returns `[""]` (an array with one empty string).

Let me verify this by looking at how this function is used in the ACL context. I need to find where the split function is called for ACL topic/group perms and global white list.
</thinking>
========================================================================================================================
TOOL CALL (grep)
content_pattern: UtilAll\.split

========================================================================================================================
TOOL RETURN (grep)
```
broker/src/main/java/org/apache/rocketmq/broker/processor/AdminBrokerProcessor.java:598:        accessConfig.setTopicPerms(UtilAll.split(requestHeader.getTopicPerms(), ","));
broker/src/main/java/org/apache/rocketmq/broker/processor/AdminBrokerProcessor.java:599:        accessConfig.setGroupPerms(UtilAll.split(requestHeader.getGroupPerms(), ","));
broker/src/main/java/org/apache/rocketmq/broker/processor/AdminBrokerProcessor.java:672:            if (accessValidator.updateGlobalWhiteAddrsConfig(U...
```
========================================================================================================================
TOOL CALL (inspect_code)
file_path: broker/src/main/java/org/apache/rocketmq/broker/processor/AdminBrokerProcessor.java
line_ranges:
- - 590
  - 680

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in broker/src/main/java/org/apache/rocketmq/broker/processor/AdminBrokerProcessor.java:

````java
   0 /*
...
 193 public class AdminBrokerProcessor implements NettyRequestProcessor {
 194     private static final Logger LOGGER = LoggerFactory.getLogger(LoggerName.BROKER_LOGGER_NAME);
...
 198     public AdminBrokerProcessor(final BrokerController brokerController) {
...
 203     private void initConfigBlackList() {
...
 211     @Override
 212     public Remotin...
```
========================================================================================================================
AGENT:
<thinking>
Now I understand the issue. When `UtilAll.split` is called with an empty string, it returns a list with one empty string element `[""]` instead of an empty list `[]`. This causes problems when:

1. For topic/group perms: The empty string is then parsed as a resource permission, which fails because it doesn't match the expected format "Res=Perm".
2. For global white list: The empty string remains in the list, causing an empty data entry.

Let me look at the test file for UtilAll to understand the expected behavior better.
</thinking>
========================================================================================================================
TOOL CALL (grep)
content_pattern: split
path_glob: '**/UtilAllTest.java'

========================================================================================================================
TOOL RETURN (grep)
```
No matches found for pattern 'split'....
```
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java:\n\n````java\n   0 /*\n...\n  38 public class UtilAllTest {\n  39     @Rule\n  40     public TemporaryFolder tempDir = new TemporaryFolder();\n  41 \n  42     @Test\n  43     public void testCurrentStackTrace() {\n...\n  49     @Test\n  50     public void testProperties2Object() {\n...\n  64     @Test\n  65     public void testProperties2String() {\n...\n  88     @Test\n  89     public void testIsPropertiesEqu...
```
========================================================================================================================
AGENT:
<thinking>
I see there's a test for `join` but not for `split`. Let me now fix the `split` function in `UtilAll.java`. The fix should handle the case when the input string is empty or blank, returning an empty list instead of a list with an empty string.

Let me also check if there are any other places where this function is used to make sure the fix won't break anything.
</thinking>
========================================================================================================================
TOOL CALL (inspect_code)
file_path: common/src/main/java/org/apache/rocketmq/common/UtilAll.java
line_ranges:
- - 676
  - 690

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in common/src/main/java/org/apache/rocketmq/common/UtilAll.java:

````java
   0 /*
...
  51 public class UtilAll {
  52     private static final Logger log = LoggerFactory.getLogger(LoggerName.COMMON_LOGGER_NAME);
...
  63         Supplier<Integer> supplier = () -> {
...
  75     public static int getPid() {
...
  79     public static void sleep(long sleepMs) {
...
  83     public static void sleep(long timeOut, TimeUnit timeUnit) {
...
  94     public static St...
```
========================================================================================================================
AGENT:
Now I understand the issue. The `split` function needs to be modified to handle empty strings properly. When an empty string is passed, it should return an empty list instead of a list containing one empty string.

Let me make the fix:
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: common/src/main/java/org/apache/rocketmq/common/UtilAll.java
find: "    public static List<String> split(String str, String splitter) {\n     \
  \   if (str == null) {\n            return null;\n        }\n\n        String[]\
  \ addrArray = str.split(splitter);\n        return Arrays.asList(addrArray);\n \
  \   }"
replace: "    public static List<String> split(String str, String splitter) {\n  \
  \      if (str == null) {\n            return null;\n        }\n\n        if (str.isEmpty())\
  \ {\n            return new ArrayList<>();\n        }\n\n        String[] addrArray\
  \ = str.split(splitter);\n        return Arrays.asList(addrArray);\n    }"

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in common/src/main/java/org/apache/rocketmq/common/UtilAll.java:

--- common/src/main/java/org/apache/rocketmq/common/UtilAll.java
+++ common/src/main/java/org/apache/rocketmq/common/UtilAll.java
@@ -681,6 +681,10 @@
             return null;
         }
 
+        if (str.isEmpty()) {
+            return new ArrayList<>();
+        }
+
         String[] addrArray = str.split(splitter);
         return Arrays.asList(addrArray);
     }
...
```
========================================================================================================================
AGENT:
Now let me verify that the `ArrayList` import is already present in the file:
========================================================================================================================
TOOL CALL (grep)
content_pattern: import.*ArrayList
path_glob: '**/common/UtilAll.java'

========================================================================================================================
TOOL RETURN (grep)
```
No matches found for pattern 'import.*ArrayList'....
```
========================================================================================================================
TOOL CALL (inspect_code)
file_path: common/src/main/java/org/apache/rocketmq/common/UtilAll.java
line_ranges:
- - 0
  - 50

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in common/src/main/java/org/apache/rocketmq/common/UtilAll.java:

````java
   0 /*
   1  * Licensed to the Apache Software Foundation (ASF) under one or more
   2  * contributor license agreements.  See the NOTICE file distributed with
   3  * this work for additional information regarding copyright ownership.
   4  * The ASF licenses this file to You under the Apache License, Version 2.0
   5  * (the "License"); you may not use this file except in compliance wi...
```
========================================================================================================================
AGENT:
I need to add the `ArrayList` import. Let me add it:
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: common/src/main/java/org/apache/rocketmq/common/UtilAll.java
find: 'import java.util.Arrays;

  import java.util.Calendar;'
replace: 'import java.util.ArrayList;

  import java.util.Arrays;

  import java.util.Calendar;'

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in common/src/main/java/org/apache/rocketmq/common/UtilAll.java:

--- common/src/main/java/org/apache/rocketmq/common/UtilAll.java
+++ common/src/main/java/org/apache/rocketmq/common/UtilAll.java
@@ -31,6 +31,7 @@
 import java.text.NumberFormat;
 import java.text.ParseException;
 import java.text.SimpleDateFormat;
+import java.util.ArrayList;
 import java.util.Arrays;
 import java.util.Calendar;
 import java.util.Date;
...
```
========================================================================================================================
AGENT:
Now let me add a test for the `split` function to ensure the fix works correctly:
========================================================================================================================
TOOL CALL (inspect_code)
file_path: common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java
line_ranges:
- - 0
  - -1

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java:

````java
   0 /*
   1  * Licensed to the Apache Software Foundation (ASF) under one or more
   2  * contributor license agreements.  See the NOTICE file distributed with
   3  * this work for additional information regarding copyright ownership.
   4  * The ASF licenses this file to You under the Apache License, Version 2.0
   5  * (the "License"); you may not use this file except in complianc...
```
========================================================================================================================
AGENT:
Now let me add a test for the `split` function:
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java
find: "    @Test\n    public void testJoin() {\n        List<String> list = Arrays.asList(\"\
  groupA=DENY\", \"groupB=PUB|SUB\", \"groupC=SUB\");\n        String comma = \",\"\
  ;\n        assertEquals(\"groupA=DENY,groupB=PUB|SUB,groupC=SUB\", UtilAll.join(list,\
  \ comma));\n        assertEquals(null, UtilAll.join(null, comma));\n        List<String>\
  \ objects = Collections.emptyList();\n        assertEquals(\"\", UtilAll.join(objects,\
  \ comma));\n    }"
replace: "    @Test\n    public void testJoin() {\n        List<String> list = Arrays.asList(\"\
  groupA=DENY\", \"groupB=PUB|SUB\", \"groupC=SUB\");\n        String comma = \",\"\
  ;\n        assertEquals(\"groupA=DENY,groupB=PUB|SUB,groupC=SUB\", UtilAll.join(list,\
  \ comma));\n        assertEquals(null, UtilAll.join(null, comma));\n        List<String>\
  \ objects = Collections.emptyList();\n        assertEquals(\"\", UtilAll.join(objects,\
  \ comma));\n    }\n\n    @Test\n    public void testSplit() {\n        List<String>\
  \ list = Arrays.asList(\"groupA=DENY\", \"groupB=PUB|SUB\", \"groupC=SUB\");\n \
  \       String comma = \",\";\n        assertEquals(list, UtilAll.split(\"groupA=DENY,groupB=PUB|SUB,groupC=SUB\"\
  , comma));\n        assertEquals(null, UtilAll.split(null, comma));\n        //\
  \ Test empty string returns empty list, not a list with one empty string\n     \
  \   List<String> emptyResult = UtilAll.split(\"\", comma);\n        assertThat(emptyResult).isEmpty();\n\
  \    }"

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java:

--- common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java
+++ common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java
@@ -142,6 +142,17 @@
         assertEquals("", UtilAll.join(objects, comma));
     }
 
+    @Test
+    public void testSplit() {
+        List<String> list = Arrays.asList("groupA=DENY", "groupB=PUB|SUB", "groupC=SUB");
+        String comma = ",";
+        assertE...
```
========================================================================================================================
AGENT:
Now let me run the test to verify the fix works:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl common -Dtest=UtilAllTest#testSplit -q 2>&1
  | tail -50
timeout: 120

========================================================================================================================
TOOL RETURN (bash)
```
tmp_code_6b5e06d15665714c3d37e1b1498226dd898aa2f21efda39951452cd5455086e7.bash: line 1: mvn: command not found...
```
========================================================================================================================
TOOL CALL (bash)
command: which mvn || which java || echo "checking for maven/java"

========================================================================================================================
TOOL RETURN (bash)
```
/usr/bin/java...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl common -Dtest=UtilAllTest#testSplit -q 2>&1
  | tail -50
timeout: 180

========================================================================================================================
TOOL RETURN (bash)
```
tmp_code_6fb652a1dea0546132b2ac47e7909a2af7db17036373831483e72b8ac2aeaa30.bash: line 1: ./mvnw: No such file or directory...
```
========================================================================================================================
TOOL CALL (bash)
command: ls -la /workspace/*.sh /workspace/*.xml 2>/dev/null | head -20

========================================================================================================================
TOOL RETURN (bash)
```
-rw-r--r-- 1 root root 47330 Dec  5 13:33 /workspace/pom.xml...
```
========================================================================================================================
TOOL CALL (bash)
command: apt-get update && apt-get install -y maven 2>&1 | tail -10
timeout: 120

========================================================================================================================
TOOL RETURN (bash)
```
Hit:1 https://apt.llvm.org/noble llvm-toolchain-noble-20 InRelease
Hit:2 http://ports.ubuntu.com/ubuntu-ports noble InRelease
Get:3 http://ports.ubuntu.com/ubuntu-ports noble-updates InRelease [126 kB]
Get:4 http://ports.ubuntu.com/ubuntu-ports noble-backports InRelease [126 kB]
Get:5 http://ports.ubuntu.com/ubuntu-ports noble-security InRelease [126 kB]
Get:6 http://ports.ubuntu.com/ubuntu-ports noble-updates/universe arm64 Packages [1877 kB]
Get:7 http://ports.ubuntu.com/ubuntu-ports noble-upd...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl common -Dtest=UtilAllTest#testSplit -q 2>&1
  | tail -50
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
     [java] JVM args ignored when same JVM is used.
[[1;31mERROR[m] Failed to execute goal [32mcom.github.spotbugs:spotbugs-maven-plugin:4.2.2:spotbugs[m [1m(spotbugs)[m on project [36mrocketmq-common[m: [1;31mExecution spotbugs of goal com.github.spotbugs:spotbugs-maven-plugin:4.2.2:spotbugs failed: java.lang.UnsupportedOperationException: The Secu...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl common -Dtest=UtilAllTest#testSplit -Dspotbugs.skip=true
  -Dcheckstyle.skip=true -q 2>&1 | tail -50
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Running org.apache.rocketmq.common.UtilAllTest
13:36:16,604 |-INFO in org.apache.rocketmq.loggin...
```
========================================================================================================================
AGENT:
The test passes. Now let me also run the `testJoin` test to make sure the existing functionality still works:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl common -Dtest=UtilAllTest#testJoin -Dspotbugs.skip=true
  -Dcheckstyle.skip=true -q 2>&1 | tail -30
timeout: 180

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Running org.apache.rocketmq.common.UtilAllTest
13:36:24,921 |-INFO in org.apache.rocketmq.loggin...
```
========================================================================================================================
AGENT:
Now let me run all the tests in the UtilAllTest class to make sure nothing is broken:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl common -Dtest=UtilAllTest -Dspotbugs.skip=true
  -Dcheckstyle.skip=true -q 2>&1 | tail -30
timeout: 180

========================================================================================================================
TOOL RETURN (bash)
```

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Running org.apache.rocketmq.common.UtilAllTest
13:36:33,418 |-INFO in org.apache.rocketmq.logging.ch.qos.logback.classic.LoggerContext[default] - This is logback-classic version 1.3.5-rocketmq
13:36:33,434 |-INFO in org.apache.rocketmq....
```
========================================================================================================================
AGENT:
All 12 tests pass. Now let me also verify the fix by looking at the ACL-related code to understand how the split function is used and ensure the fix addresses the issue:
========================================================================================================================
TOOL CALL (grep)
content_pattern: Parse Resource format error

========================================================================================================================
TOOL RETURN (grep)
```
acl/src/main/java/org/apache/rocketmq/acl/common/Permission.java:100:                throw new AclException(String.format("Parse Resource format error for %s.\n" +...
```
========================================================================================================================
TOOL CALL (inspect_code)
file_path: acl/src/main/java/org/apache/rocketmq/acl/common/Permission.java
line_ranges:
- - 90
  - 120

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in acl/src/main/java/org/apache/rocketmq/acl/common/Permission.java:

````java
   0 /*
   1  * Licensed to the Apache Software Foundation (ASF) under one or more
   2  * contributor license agreements.  See the NOTICE file distributed with
   3  * this work for additional information regarding copyright ownership.
   4  * The ASF licenses this file to You under the Apache License, Version 2.0
   5  * (the "License"); you may not use this file except in complianc...
```
========================================================================================================================
AGENT:
<thinking>
Now I understand the issue completely. Looking at the code:

1. In `AdminBrokerProcessor.java`, when updating ACL config, it calls `UtilAll.split(requestHeader.getTopicPerms(), ",")` and `UtilAll.split(requestHeader.getGroupPerms(), ",")`.

2. When the user deletes the last item, the request header contains an empty string for `topicPerms` or `groupPerms`.

3. Before my fix, `UtilAll.split("", ",")` would return `[""]` (a list with one empty string).

4. This list is then passed to `Permission.checkResourcePerms()`, which iterates over the resources and tries to parse each one.

5. When it tries to parse the empty string `""`, `StringUtils.split("", "=")` returns an empty array (length 0), which is not equal to 2, so it throws the error: "Parse Resource format error for ."

With my fix, `UtilAll.split("", ",")` now returns an empty list `[]`, so `Permission.checkResourcePerms()` will return early at line 92-93 because the list is empty, and no error will be thrown.

Let me also verify the global white list issue. Looking at line 671-672 in AdminBrokerProcessor.java:
```java
if (accessValidator.updateGlobalWhiteAddrsConfig(UtilAll.split(requestHeader.getGlobalWhiteAddrs(), ","),
```

When the user wants to clear all global white addresses, they pass an empty string. Before my fix, this would result in a list with one empty string `[""]`, which would be stored as a single empty entry. With my fix, it will be an empty list `[]`, which is the correct behavior.

Let me run the ACL-related tests to make sure the fix works correctly in the ACL context.
</thinking>

Let me run the ACL-related tests to verify the fix works in the ACL context:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl acl -Dtest=PermissionTest -Dspotbugs.skip=true
  -Dcheckstyle.skip=true -q 2>&1 | tail -30
timeout: 180

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
[[1;31mERROR[m] Failed to execute goal on project [36mrocketmq-acl[m: [1;31mCould not resolve dependencies for project org.apache.rocketmq:rocketmq-acl:jar:5.1.5-SNAPSHOT: The following artifacts could not be resolved: org.apache.rocketmq:rocketmq-remoting:jar:5.1.5-SNAPSHOT, org.apache.rocketmq:rocketmq-common:jar:5.1.5-SNAPSHOT, org.apache.rocketmq:ro...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn install -DskipTests -Dspotbugs.skip=true -Dcheckstyle.skip=true
  -q 2>&1 | tail -30
timeout: 600

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl acl -Dtest=PermissionTest -Dspotbugs.skip=true
  -Dcheckstyle.skip=true -q 2>&1 | tail -30
timeout: 180

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Running org.apache.rocketmq.acl.common.PermissionTest
13:37:58,730 |-INFO in org.apache.rocketmq...
```
========================================================================================================================
AGENT:
All ACL permission tests pass. Let me also verify the fix by looking at the PermissionTest to see if there are any tests related to empty resources:
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- acl/src/test/java/org/apache/rocketmq/acl/common/PermissionTest.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened acl/src/test/java/org/apache/rocketmq/acl/common/PermissionTest.java:\n\n````java\n   0 /*\n   1  * Licensed to the Apache Software Foundation (ASF) under one or more\n   2  * contributor license agreements.  See the NOTICE file distributed with\n   3  * this work for additional information regarding copyright ownership.\n   4  * The ASF licenses this file to You under the Apache License, Version 2.0\n   5  * (the "License"); you may not use this file except in compliance w...
```
========================================================================================================================
AGENT:
<thinking>
Looking at the test file, I can see:

1. Line 172: `Permission.checkResourcePerms(new ArrayList<>());` - This tests that an empty list is handled correctly (no exception).

2. Line 136-137: There's a test that adds an empty string to a list and expects an exception when parsing resource perms.

The fix I made ensures that when `UtilAll.split("", ",")` is called (which happens when the user deletes all items), it returns an empty list instead of a list with one empty string. This means:

1. For topic/group perms: The empty list will be passed to `Permission.checkResourcePerms()`, which will return early at line 92-93 without throwing an exception.

2. For global white list: The empty list will be passed to `updateGlobalWhiteAddrsConfig()`, which will correctly clear all addresses.

Let me also check if there are any other tests related to this functionality.
</thinking>

Let me also run the PlainAccessValidatorTest to ensure the fix works correctly:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl acl -Dtest=PlainAccessValidatorTest -Dspotbugs.skip=true
  -Dcheckstyle.skip=true -q 2>&1 | tail -30
timeout: 180

========================================================================================================================
TOOL RETURN (bash)
```
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org....
```
========================================================================================================================
AGENT:
All 34 tests pass. Now let me verify the fix by reviewing the changes I made:
========================================================================================================================
TOOL CALL (inspect_code)
file_path: common/src/main/java/org/apache/rocketmq/common/UtilAll.java
patterns:
- split

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in common/src/main/java/org/apache/rocketmq/common/UtilAll.java:

````java
   0 /*
   1  * Licensed to the Apache Software Foundation (ASF) under one or more
   2  * contributor license agreements.  See the NOTICE file distributed with
   3  * this work for additional information regarding copyright ownership.
   4  * The ASF licenses this file to You under the Apache License, Version 2.0
   5  * (the "License"); you may not use this file except in compliance wi...
```
========================================================================================================================
AGENT:
The fix looks correct. Let me also verify the test I added:
========================================================================================================================
TOOL CALL (inspect_code)
file_path: common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java
patterns:
- testSplit

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java:

````java
   0 /*
   1  * Licensed to the Apache Software Foundation (ASF) under one or more
   2  * contributor license agreements.  See the NOTICE file distributed with
   3  * this work for additional information regarding copyright ownership.
   4  * The ASF licenses this file to You under the Apache License, Version 2.0
   5  * (the "License"); you may not use this file except in complianc...
```
========================================================================================================================
AGENT:
The changes look correct. Let me now run a quick test to verify the fix works as expected by creating a simple test script:
========================================================================================================================
TOOL CALL (bash)
command: "cd /workspace && cat > /tmp/TestSplit.java << 'EOF'\nimport java.util.ArrayList;\n\
  import java.util.Arrays;\nimport java.util.List;\n\npublic class TestSplit {\n \
  \   public static void main(String[] args) {\n        // Test the old behavior (what\
  \ was happening before the fix)\n        String emptyStr = \"\";\n        String[]\
  \ oldResult = emptyStr.split(\",\");\n        System.out.println(\"Old behavior\
  \ (String.split on empty string):\");\n        System.out.println(\"  Result length:\
  \ \" + oldResult.length);\n        System.out.println(\"  Result[0]: '\" + oldResult[0]\
  \ + \"'\");\n        System.out.println(\"  Result[0].isEmpty(): \" + oldResult[0].isEmpty());\n\
  \        \n        // Test the new behavior (what happens after the fix)\n     \
  \   System.out.println(\"\\nNew behavior (with isEmpty check):\");\n        List<String>\
  \ newResult = split(emptyStr, \",\");\n        System.out.println(\"  Result size:\
  \ \" + newResult.size());\n        System.out.println(\"  Result isEmpty: \" + newResult.isEmpty());\n\
  \        \n        // Test normal case\n        System.out.println(\"\\nNormal case:\"\
  );\n        List<String> normalResult = split(\"a,b,c\", \",\");\n        System.out.println(\"\
  \  Result: \" + normalResult);\n        \n        // Test null case\n        System.out.println(\"\
  \\nNull case:\");\n        List<String> nullResult = split(null, \",\");\n     \
  \   System.out.println(\"  Result: \" + nullResult);\n    }\n    \n    public static\
  \ List<String> split(String str, String splitter) {\n        if (str == null) {\n\
  \            return null;\n        }\n\n        if (str.isEmpty()) {\n         \
  \   return new ArrayList<>();\n        }\n\n        String[] addrArray = str.split(splitter);\n\
  \        return Arrays.asList(addrArray);\n    }\n}\nEOF\njavac /tmp/TestSplit.java\
  \ -d /tmp && java -cp /tmp TestSplit"

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Old behavior (String.split on empty string):
  Result length: 1
  Result[0]: ''
  Result[0].isEmpty(): true

New behavior (with isEmpty check):
  Result size: 0
  Result isEmpty: true

Normal case:
  Result: [a, b, c]

N...
```
========================================================================================================================
AGENT:
The test confirms that:
1. **Old behavior**: `String.split(",")` on an empty string returns an array with one empty string element `[""]`, which has length 1.
2. **New behavior**: With the fix, `split("", ",")` returns an empty list `[]`, which has size 0.

This fix resolves the issue described in the problem statement:
- For topic/group perms: When the user deletes the last item, an empty string is passed. With the fix, `UtilAll.split("", ",")` returns an empty list, which is correctly handled by `Permission.checkResourcePerms()` (it returns early without throwing an error).
- For global white list: When the user wants to clear all addresses, an empty string is passed. With the fix, `UtilAll.split("", ",")` returns an empty list, which correctly clears all addresses without leaving an empty entry.

Let me also run a few more tests to ensure the fix doesn't break anything else:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl common -Dspotbugs.skip=true -Dcheckstyle.skip=true
  -q 2>&1 | tail -30
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
Running org.apache.rocketmq.common.compression.CompressionTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 1, Time elapsed: 0 sec - in org.apache.rocketmq.common.compression.CompressionTest
Running org.apache.rocketmq.common.ServiceThreadTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 1, Time elapsed: 0 sec - in org.apache.rocketmq.common.ServiceThreadTest
Running org.apache.rocketmq.common.BrokerConfigTest
Tests run: 1, Failures: 0, Errors: 0, Skipped: 1, Time elapsed: 0 sec - in org.apa...
```
========================================================================================================================
AGENT:
<thinking>
There's a test failure in `ConcurrentHashMapUtilsTest`, but this is unrelated to my changes. Let me verify by checking if this test was already failing before my changes by looking at the test:
</thinking>
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl common -Dtest=ConcurrentHashMapUtilsTest -Dspotbugs.skip=true
  -Dcheckstyle.skip=true -q 2>&1 | tail -30
timeout: 180

========================================================================================================================
TOOL RETURN (bash)
```

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Running org.apache.rocketmq.common.utils.ConcurrentHashMapUtilsTest
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.047 sec <<< FAILURE! - in org.apache.rocketmq.common.utils.ConcurrentHashMapUtilsTest
computeIfAbsent(...
```
========================================================================================================================
AGENT:
This test failure is unrelated to my changes - it's a pre-existing issue with `ConcurrentHashMapUtilsTest` that throws `IllegalStateException: Recursive update`. This is a known issue with Java's ConcurrentHashMap behavior in certain JDK versions.

Let me run the tests excluding this problematic test to verify my changes don't break anything:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl common -Dtest='!ConcurrentHashMapUtilsTest'
  -Dspotbugs.skip=true -Dcheckstyle.skip=true -q 2>&1 | tail -30
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.apache.rocketmq.common.message.MessageTest
Running org.apache.rocketmq.common.utils.IOTinyUtilsTest
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.apache.rocketmq.common.utils.IOTinyUtilsTest
Running org.apache.rocketmq.common.utils.NameServerAddressUtilsTest
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0 sec - in org.apache.rocketmq.common.utils.NameServerAddressUtil...
```
========================================================================================================================
AGENT:
All 108 tests pass (excluding the pre-existing failing test). Let me also run the ACL tests to make sure the fix works correctly in the ACL context:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && mvn test -pl acl -Dspotbugs.skip=true -Dcheckstyle.skip=true
  -q 2>&1 | tail -30
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:367)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:274)
	at org.apache.maven.surefire.junit4.JUnit4Provider.e...
```
========================================================================================================================
AGENT:
All 106 ACL tests pass. The error messages about JaCoCo are just warnings about code coverage instrumentation, not actual test failures.

Now let me summarize the changes I made:

## Summary of Changes

### Problem
The `UtilAll#split` function had a flaw where splitting an empty string would return a list containing one empty string element `[""]` instead of an empty list `[]`. This caused two issues:

1. **ACL topic/group perms**: When deleting the last item, an empty string was passed to `UtilAll.split()`, which returned `[""]`. This list was then passed to `Permission.checkResourcePerms()`, which tried to parse the empty string and threw an error: "Parse Resource format error for ."

2. **Global white list**: When clearing all addresses, an empty string was passed to `UtilAll.split()`, which returned `[""]`. This resulted in an empty entry remaining in the white list.

### Solution
I modified the `UtilAll#split` function in `common/src/main/java/org/apache/rocketmq/common/UtilAll.java` to check if the input string is empty before splitting. If the string is empty, it returns an empty `ArrayList` instead of splitting the empty string.

### Changes Made

1. **Modified `UtilAll.java`**:
   - Added import for `java.util.ArrayList`
   - Added an empty string check in the `split` method that returns an empty `ArrayList` when the input string is empty

2. **Added test in `UtilAllTest.java`**:
   - Added `testSplit()` method to verify the fix works correctly

### Files Changed
- `common/src/main/java/org/apache/rocketmq/common/UtilAll.java`
- `common/src/test/java/org/apache/rocketmq/common/UtilAllTest.java`
========================================================================================================================
AGENT:
Successfully fixed the bug in UtilAll#split function. The issue was that when an empty string was passed to the split function, it returned a list with one empty string element [""] instead of an empty list []. This caused problems when:

1. Deleting the last item of ACL topic/group perms - the empty string was parsed as a resource permission, causing a "Parse Resource format error" exception.
2. Clearing the global white list - an empty entry remained in the list.

The fix adds a check for empty strings in the split function, returning an empty ArrayList when the input string is empty. I also added a test case to verify this behavior. All relevant tests pass.