########################################################################################################################
PHASE 1
########################################################################################################################
========================================================================================================================
AGENT:
I will start by viewing the workspace to understand its structure and contents. This will help me identify key files and locations that may be relevant to the task.
========================================================================================================================
USER PROMPT:
Resolve the following problem statement:

<problem_statement>
[Tooltip] Tooltips aren't displayed on focus on TextFields
- [x] This is not a v0.x issue. <!-- (v0.x is no longer maintained) -->
- [x] I have searched the [issues](https://github.com/mui-org/material-ui/issues) of this repository and believe that this is not a duplicate.

## Expected Behavior ðŸ¤”
Using a `Tooltip` component with `disableHoverListener` around a `TextField` component should display the tooltip on focus

## Current Behavior ðŸ˜¯
No tooltip is displayed

## Steps to Reproduce ðŸ•¹
Link: https://codesandbox.io/s/ooywx0xlq9

1. Click on the TextField, nothing is displayed.

Testing anywhere the following code sample is enough to reproduce :
```js
<Tooltip title="TestTooltip" disableHoverListener>
  <TextField label="TestTooltip" />
</Tooltip>
```

## Context ðŸ”¦
Display hints for user entering their data.

This used to work, and, after trying a few versions, appears to be broken starting v3.1.1

## Your Environment ðŸŒŽ

| Tech         | Version |
|--------------|---------|
| Material-UI  | v3.9.2  |
| React        | 16.6.3 |
| Browser      | Firefox 66b, Chromium 71 |

As always, thanks for the great project :slightly_smiling_face: 

</problem_statement>

Do not stop until you have made code changes that resolve the problem statement. Do not ask for clarifications.

NEVER attempt to find the solution to the problem statement by searching future commits or branches in the repository.
========================================================================================================================
AGENT:
Starting to analyze the problem statement. The issue is that Tooltips aren't displayed on focus on TextFields when using disableHoverListener. I need to explore the Tooltip component to understand how it handles focus events and why it might not be working with TextField.
========================================================================================================================
AGENT:
STEP 1: EXPLORE THE WORKSPACE

<thinking>
The problem statement indicates that:
1. Tooltips aren't displayed on focus on TextFields when using `disableHoverListener`
2. This used to work but broke starting v3.1.1
3. The expected behavior is that when you focus on a TextField wrapped in a Tooltip with `disableHoverListener`, the tooltip should appear

I need to:
1. Find the Tooltip component source code
2. Understand how focus events are handled
3. Find the TextField component to understand its structure
4. Identify why focus events might not be propagating correctly

Let me start by exploring the packages/material-ui/src directory to find the Tooltip component.
</thinking>
========================================================================================================================
TOOL CALL (expand_folder)
folder_path: packages/material-ui/src

========================================================================================================================
TOOL RETURN (expand_folder)
```
packages/:

packages/material-ui/:

packages/material-ui/src/:
index.d.ts
index.js
index.test.js

packages/material-ui/src/AppBar/:
AppBar.d.ts
AppBar.js
AppBar.test.js
index.d.ts
index.js

packages/material-ui/src/Avatar/:
Avatar.d.ts
Avatar.js
Avatar.test.js
index.d.ts
index.js

packages/material-ui/src/Backdrop/:
Backdrop.d.ts
Backdrop.js
Backdrop.test.js
index.d.ts
index.js

packages/material-ui/src/Badge/:
Badge.d.ts
Badge.js
Badge.test.js
index.d.ts
index.js

packages/material-ui/src/Botto...
```
========================================================================================================================
AGENT:
Now let me open the Tooltip component to understand how it handles focus events:
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- packages/material-ui/src/Tooltip/Tooltip.js

========================================================================================================================
TOOL RETURN (open_files)
```
["Successfully opened packages/material-ui/src/Tooltip/Tooltip.js:\n\n````javascript\n   0 import React from 'react';\n...\n  11 export const styles = theme => ({\n...\n  73 class Tooltip extends React.Component {\n...\n  76   constructor(props) {\n...\n  89   componentDidMount() {\n...\n 114   componentWillUnmount() {\n...\n 256   render() {\n...\n 494 \n````"]...
```
========================================================================================================================
AGENT:
<thinking>
The file is collapsed. Let me expand the entire file to understand how the Tooltip component handles focus events.
</thinking>
========================================================================================================================
TOOL CALL (inspect_code)
file_path: packages/material-ui/src/Tooltip/Tooltip.js
line_ranges:
- - 0
  - -1

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in packages/material-ui/src/Tooltip/Tooltip.js:

````javascript
   0 import React from 'react';
   1 import PropTypes from 'prop-types';
   2 import warning from 'warning';
   3 import classNames from 'classnames';
   4 import { componentPropType } from '@material-ui/utils';
   5 import RootRef from '../RootRef';
   6 import withStyles from '../styles/withStyles';
   7 import { capitalize } from '../utils/helpers';
   8 import Grow from '../Grow';
   9 import Po...
```
========================================================================================================================
AGENT:
<thinking>
Now I understand the Tooltip component. Let me analyze the `handleFocus` method:

```javascript
handleFocus = event => {
  event.persist();
  // The autoFocus of React might trigger the event before the componentDidMount.
  // We need to account for this eventuality.
  this.focusTimer = setTimeout(() => {
    // We need to make sure the focus hasn't moved since the event was triggered.
    if (this.childrenRef === document.activeElement) {
      this.handleEnter(event);
    }
  });

  const childrenProps = this.props.children.props;
  if (childrenProps.onFocus) {
    childrenProps.onFocus(event);
  }
};
```

The issue is on line 132:
```javascript
if (this.childrenRef === document.activeElement) {
```

This check compares `this.childrenRef` (which is the root element of the child component) with `document.activeElement` (which is the currently focused element). 

For a TextField component, the root element is likely a `div` or some wrapper element, but when you focus on a TextField, the actual focused element is the `input` element inside it, not the wrapper. So `this.childrenRef` (the wrapper) will never equal `document.activeElement` (the input), and the tooltip will never be shown.

The fix should be to check if the `document.activeElement` is contained within `this.childrenRef`, rather than checking for strict equality. We can use `this.childrenRef.contains(document.activeElement)` instead.

Let me also check the TextField component to confirm my understanding:
</thinking>
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- packages/material-ui/src/TextField/TextField.js

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened packages/material-ui/src/TextField/TextField.js:\n\n````javascript\n   0 // @inheritedComponent FormControl\n...\n  14 const variantComponent = {\n...\n  48 class TextField extends React.Component {\n  49   constructor(props) {\n...\n  54   componentDidMount() {\n...\n  61   render() {\n...\n 320 \n````']...
```
========================================================================================================================
TOOL CALL (inspect_code)
file_path: packages/material-ui/src/TextField/TextField.js
patterns:
- render

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in packages/material-ui/src/TextField/TextField.js:

````javascript
   0 // @inheritedComponent FormControl
   1 
   2 import React from 'react';
   3 import ReactDOM from 'react-dom';
   4 import warning from 'warning';
   5 import PropTypes from 'prop-types';
   6 import Input from '../Input';
   7 import FilledInput from '../FilledInput';
   8 import OutlinedInput from '../OutlinedInput';
   9 import InputLabel from '../InputLabel';
  10 import FormControl fr...
```
========================================================================================================================
AGENT:
<thinking>
My analysis is confirmed. The TextField component wraps a FormControl, which contains an InputLabel and an Input component. When you focus on a TextField, the actual focused element is the native `input` element inside the Input component, not the FormControl wrapper.

The issue is in the Tooltip's `handleFocus` method at line 132:
```javascript
if (this.childrenRef === document.activeElement) {
```

This check fails for TextField because:
1. `this.childrenRef` points to the FormControl (the root element of TextField)
2. `document.activeElement` points to the actual `input` element inside the TextField

The fix should be to use `this.childrenRef.contains(document.activeElement)` instead of `this.childrenRef === document.activeElement`. This will check if the currently focused element is contained within the child element, which would be true for TextField and other composite components.

Let me also look at the Tooltip test file to understand how to write a proper test for this fix:
</thinking>
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- packages/material-ui/src/Tooltip/Tooltip.test.js

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened packages/material-ui/src/Tooltip/Tooltip.test.js:\n\n````javascript\n   0 import React from \'react\';\n...\n   9 function persist() {}\n  10 \n  11 const TooltipNaked = unwrap(Tooltip);\n...\n  15   let shallow;\n...\n  19   const defaultProps = {\n...\n  38     const wrapper = shallow(<Tooltip {...defaultProps} />);\n...\n  47       const wrapper = shallow(\n...\n  53       const children = wrapper.find(\'button\');\n...\n  60       const wrapper = shallow(<Tooltip {...de...
```
========================================================================================================================
TOOL CALL (inspect_code)
file_path: packages/material-ui/src/Tooltip/Tooltip.test.js
line_ranges:
- - 0
  - -1

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in packages/material-ui/src/Tooltip/Tooltip.test.js:

````javascript
   0 import React from 'react';
   1 import { assert } from 'chai';
   2 import { spy, useFakeTimers } from 'sinon';
   3 import consoleErrorMock from 'test/utils/consoleErrorMock';
   4 import { createShallow, createMount, getClasses, unwrap } from '@material-ui/core/test-utils';
   5 import Popper from '../Popper';
   6 import Tooltip from './Tooltip';
   7 import createMuiTheme from '../styl...
```
========================================================================================================================
AGENT:
<thinking>
Now I have a clear understanding of the issue and the test structure. Let me now make the fix.

The issue is in the `handleFocus` method of the Tooltip component. The current code checks:
```javascript
if (this.childrenRef === document.activeElement) {
```

This should be changed to:
```javascript
if (this.childrenRef.contains(document.activeElement)) {
```

This will allow the tooltip to show when focus is on any element contained within the child element (like the input inside a TextField), not just when the child element itself is focused.

Let me make this change:
</thinking>

STEP 2: MAKE THE FIX
========================================================================================================================
AGENT:
I've identified the issue. In the Tooltip component's handleFocus method, the check `this.childrenRef === document.activeElement` fails for TextField because the focused element is the input inside the TextField, not the TextField wrapper itself. I need to change this to `this.childrenRef.contains(document.activeElement)` to check if the focused element is contained within the child element.
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: packages/material-ui/src/Tooltip/Tooltip.js
find: "  handleFocus = event => {\n    event.persist();\n    // The autoFocus of React\
  \ might trigger the event before the componentDidMount.\n    // We need to account\
  \ for this eventuality.\n    this.focusTimer = setTimeout(() => {\n      // We need\
  \ to make sure the focus hasn't moved since the event was triggered.\n      if (this.childrenRef\
  \ === document.activeElement) {\n        this.handleEnter(event);\n      }\n   \
  \ });"
replace: "  handleFocus = event => {\n    event.persist();\n    // The autoFocus of\
  \ React might trigger the event before the componentDidMount.\n    // We need to\
  \ account for this eventuality.\n    this.focusTimer = setTimeout(() => {\n    \
  \  // We need to make sure the focus hasn't moved since the event was triggered.\n\
  \      if (this.childrenRef.contains(document.activeElement)) {\n        this.handleEnter(event);\n\
  \      }\n    });"

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in packages/material-ui/src/Tooltip/Tooltip.js:

--- packages/material-ui/src/Tooltip/Tooltip.js
+++ packages/material-ui/src/Tooltip/Tooltip.js
@@ -130,7 +130,7 @@
     // We need to account for this eventuality.
     this.focusTimer = setTimeout(() => {
       // We need to make sure the focus hasn't moved since the event was triggered.
-      if (this.childrenRef === document.activeElement) {
+      if (this.childrenRef.contains(document.activeElement)) {
         t...
```
========================================================================================================================
AGENT:
STEP 3: VERIFY THE FIX

<thinking>
Now I need to verify the fix by running the existing tests to make sure I haven't broken anything. Let me first check how to run the tests in this project.
</thinking>
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- package.json

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened package.json:\n\n````json\n   0 {\n   1   "name": "@material-ui/workspace",\n...\n   6   "keywords": [\n...\n  12   "repository": {\n...\n  16   "license": "MIT",\n  17   "bugs": {\n...\n  20   "homepage": "https://material-ui.com/",\n  21   "scripts": {\n...\n  56   "peerDependencies": {\n...\n  60   "devDependencies": {\n...\n 196   "resolutions": {\n...\n 200   "sideEffects": false,\n 201   "nyc": {\n...\n 213   "engines": {\n...\n 216   "workspaces": [\n...\n 220 \n````...
```
========================================================================================================================
TOOL CALL (inspect_code)
file_path: package.json
line_ranges:
- - 0
  - -1

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in package.json:

````json
   0 {
   1   "name": "@material-ui/workspace",
   2   "private": true,
   3   "author": "Material-UI Team",
   4   "version": "3.9.2",
   5   "description": "Material-UI's workspace package",
   6   "keywords": [
   7     "react",
   8     "react-component",
   9     "material design",
  10     "material-ui"
  11   ],
  12   "repository": {
  13     "type": "git",
  14     "url": "https://github.com/mui-org/material-ui.git"
  15   },
...
```
========================================================================================================================
AGENT:
<thinking>
I can see the test commands. Let me first install the dependencies and then run the Tooltip tests to verify my fix doesn't break existing functionality.
</thinking>
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && yarn install 2>&1 | tail -20
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
âž¤ YN0087: Migrated your project to the latest Yarn version ðŸš€

âž¤ YN0000: Â· Yarn 4.9.3
âž¤ YN0000: â”Œ Project validation
âž¤ YN0057: â”‚ @material-ui/workspace: The override for '**/hoist-non-react-statics' includes a glob pattern. Glob patterns have been removed since their behaviours don't match what you'd expect. Set the override to 'hoist-non-react-statics' instead.
âž¤ YN0000: â”” Completed
âž¤ YN0000: â”Œ Resolution step
âž¤ YN0058: â”‚ definitelytyped-header-parser@https://github.com/Microsoft/definitelytyped...
```
========================================================================================================================
AGENT:
<thinking>
The yarn install failed due to a resolution issue. Let me try using npm instead or try a different approach.
</thinking>
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && rm -rf yarn.lock node_modules .yarn 2>/dev/null; npm install
  2>&1 | tail -30
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
npm error code ERESOLVE
npm error ERESOLVE unable to resolve dependency tree
npm error
npm error While resolving: @material-ui/workspace@3.9.2
npm error Found: date-fns@2.0.0-alpha.21
npm error node_modules/date-fns
npm error   dev date-fns@"2.0.0-alpha.21" from the root project
npm error
npm error Could not resolve dependency:
npm error peer date-fns@"^2.0.0" from @date-io/date-fns@1.3.13
npm error node_modules/@date-io/date-fns
npm error   dev @date-io/date-fns@"^1.0.0" from the root project
n...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && npm install --legacy-peer-deps 2>&1 | tail -30
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
npm error npm warn old lockfile     '3.1.7',  '3.2.0',  '3.2.1',  '3.2.2',  '3.3.0',  '3.3.1',
npm error npm warn old lockfile     '3.3.2',  '3.3.3',  '3.3.4',  '3.3.5',  '4.0.0',  '4.0.1'
npm error npm warn old lockfile   ],
npm error npm warn old lockfile   distTags: { latest: '4.0.1' },
npm error npm warn old lockfile   defaultTag: 'latest'
npm error npm warn old lockfile }
npm error npm warn old lockfile Could not fetch metadata for flatmap-stream@0.1.0 flatmap-stream: No matching version fo...
```
========================================================================================================================
AGENT:
<thinking>
The npm install is failing due to a deprecated package (flatmap-stream) that was removed from npm. This is an older version of the Material-UI repository. Let me try a different approach - I'll create a minimal test file to verify the fix works correctly.

Let me first verify the change I made is correct by reviewing the code again, and then I'll write a simple test to verify the fix.
</thinking>
========================================================================================================================
TOOL CALL (inspect_code)
file_path: packages/material-ui/src/Tooltip/Tooltip.js
patterns:
- handleFocus

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in packages/material-ui/src/Tooltip/Tooltip.js:

````javascript
   0 import React from 'react';
   1 import PropTypes from 'prop-types';
   2 import warning from 'warning';
   3 import classNames from 'classnames';
   4 import { componentPropType } from '@material-ui/utils';
   5 import RootRef from '../RootRef';
   6 import withStyles from '../styles/withStyles';
   7 import { capitalize } from '../utils/helpers';
   8 import Grow from '../Grow';
   9 import Po...
```
========================================================================================================================
AGENT:
<thinking>
The fix is in place. The change from `this.childrenRef === document.activeElement` to `this.childrenRef.contains(document.activeElement)` should fix the issue.

Let me try to install dependencies using a different approach - maybe using yarn v1:
</thinking>
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && rm -rf node_modules .yarn yarn.lock package-lock.json 2>/dev/null;
  npm install -g yarn@1.22.22 2>&1 | tail -5
timeout: 60

========================================================================================================================
TOOL RETURN (bash)
```
npm error EEXIST: file already exists
npm error File exists: /root/.nvm/versions/node/v22.18.0/bin/yarn
npm error Remove the existing file and try again, or run npm
npm error with --force to overwrite files recklessly.
npm error A complete log of this run can be found in: /root/.npm/_logs/2025-12-12T01_18_17_617Z-debug-0.log...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && rm -rf node_modules .yarn yarn.lock package-lock.json 2>/dev/null;
  npm install -g yarn@1.22.22 --force 2>&1 | tail -5
timeout: 60

========================================================================================================================
TOOL RETURN (bash)
```
npm warn using --force Recommended protections disabled.

added 1 package in 528ms...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && yarn --version
timeout: 10

========================================================================================================================
TOOL RETURN (bash)
```
1.22.22...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && yarn install 2>&1 | tail -30
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
warning workspace-aggregator-7cd624f8-d810-47d4-abf9-75c5d2e59032 > @material-ui/codemod > jscodeshift > babel-register > core-js@2.6.12: core-js@<3.23.3 is no longer maintained and not recommended for usage due to the number of issues. Because of the V8 engine whims, feature detection in old core-js versions could cause a slowdown up to 100x even if nothing is polyfilled. Some versions have web compatibility issues. Please, upgrade your dependencies to the actual version of core-js.
warning wor...
```
========================================================================================================================
AGENT:
The dependencies are installed. Now let me run the Tooltip tests to verify my fix doesn't break existing functionality:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && cross-env NODE_ENV=test mocha 'packages/material-ui/src/Tooltip/Tooltip.test.js'
  --exclude '**/node_modules/**' 2>&1
timeout: 120

========================================================================================================================
TOOL RETURN (bash)
```
tmp_code_47b8e202d7006f01637417419df28f8e67ab93ab8f00e4784eeb4d74283bad2b.bash: line 1: cross-env: command not found...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && NODE_ENV=test ./node_modules/.bin/mocha 'packages/material-ui/src/Tooltip/Tooltip.test.js'
  --exclude '**/node_modules/**' 2>&1
timeout: 120

========================================================================================================================
TOOL RETURN (bash)
```
Though the "loose" option was set to "false" in your @babel/preset-env config, it will not be used for @babel/plugin-transform-private-property-in-object since the "loose" mode option was set to "true" for @babel/plugin-transform-class-properties.
The "loose" option must be the same for @babel/plugin-transform-class-properties, @babel/plugin-transform-private-methods and @babel/plugin-transform-private-property-in-object (when they are enabled): you can silence this warning by explicitly adding
...
```
========================================================================================================================
AGENT:
<thinking>
The test setup is failing due to Node.js version incompatibility. The test setup is trying to set `global.navigator` which is not allowed in newer Node.js versions. Let me try using an older Node.js version.
</thinking>
========================================================================================================================
TOOL CALL (bash)
command: nvm use 18 && node --version
timeout: 30

========================================================================================================================
TOOL RETURN (bash)
```
Now using node v18.20.8 (npm v10.8.2)
v18.20.8...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && NODE_ENV=test ./node_modules/.bin/mocha 'packages/material-ui/src/Tooltip/Tooltip.test.js'
  --exclude '**/node_modules/**' 2>&1
timeout: 120

========================================================================================================================
TOOL RETURN (bash)
```
Though the "loose" option was set to "false" in your @babel/preset-env config, it will not be used for @babel/plugin-transform-private-property-in-object since the "loose" mode option was set to "true" for @babel/plugin-transform-class-properties.
The "loose" option must be the same for @babel/plugin-transform-class-properties, @babel/plugin-transform-private-methods and @babel/plugin-transform-private-property-in-object (when they are enabled): you can silence this warning by explicitly adding
...
```
========================================================================================================================
AGENT:
<thinking>
It seems the nvm use command didn't persist. Let me try a different approach - running the command in a subshell with nvm properly sourced.
</thinking>
========================================================================================================================
TOOL CALL (bash)
command: source ~/.nvm/nvm.sh && nvm use 18 && cd /workspace && NODE_ENV=test ./node_modules/.bin/mocha
  'packages/material-ui/src/Tooltip/Tooltip.test.js' --exclude '**/node_modules/**'
  2>&1
timeout: 120

========================================================================================================================
TOOL RETURN (bash)
```
Now using node v18.20.8 (npm v10.8.2)
Though the "loose" option was set to "false" in your @babel/preset-env config, it will not be used for @babel/plugin-transform-private-property-in-object since the "loose" mode option was set to "true" for @babel/plugin-transform-class-properties.
The "loose" option must be the same for @babel/plugin-transform-class-properties, @babel/plugin-transform-private-methods and @babel/plugin-transform-private-property-in-object (when they are enabled): you can sile...
```
========================================================================================================================
AGENT:
<thinking>
The tests are failing due to dependency version incompatibilities with newer Node.js versions. The dependencies were installed with a newer Node.js version which pulled in incompatible packages.

Let me try a different approach - I'll verify the fix is correct by analyzing the code logic and reviewing the test file to understand what the expected behavior should be. The fix I made is straightforward and correct:

1. **Original code**: `if (this.childrenRef === document.activeElement)` - This checks if the child element itself is the focused element
2. **Fixed code**: `if (this.childrenRef.contains(document.activeElement))` - This checks if the focused element is contained within the child element

This is the correct fix because:
- When a TextField is wrapped in a Tooltip, the `childrenRef` points to the FormControl wrapper
- When you focus on the TextField, the actual focused element is the `input` inside the FormControl
- The original check fails because `FormControl !== input`
- The fixed check succeeds because `FormControl.contains(input)` is true

Let me also look at the test file to see if there are any tests that specifically test this behavior with nested elements:
</thinking>

Let me look at the existing tests more carefully to understand how they test focus behavior:
========================================================================================================================
TOOL CALL (grep)
content_pattern: childrenRef\.focus
path_glob: '**/Tooltip.test.js'

========================================================================================================================
TOOL RETURN (grep)
```
packages/material-ui/src/Tooltip/Tooltip.test.js:127:    childrenRef.focus();
packages/material-ui/src/Tooltip/Tooltip.test.js:146:      childrenRef.focus();
packages/material-ui/src/Tooltip/Tooltip.test.js:158:      childrenRef.focus();
packages/material-ui/src/Tooltip/Tooltip.test.js:180:      childrenRef.focus();
packages/material-ui/src/Tooltip/Tooltip.test.js:191:      childrenRef.focus();...
```
========================================================================================================================
AGENT:
<thinking>
Looking at the test file, I can see that the tests focus directly on `childrenRef` (the wrapper element), which means the original code `this.childrenRef === document.activeElement` would pass in those tests. However, the issue is that when using a TextField, the focus goes to the input element inside the TextField, not the wrapper.

The fix I made is correct. Let me also verify that the `contains` method is available on DOM elements and works as expected. The `contains` method is a standard DOM method that returns true if the node is a descendant of the specified node.

Let me also check if there are any edge cases I need to consider:

1. **Self-containment**: `element.contains(element)` returns `true`, so if the focused element is the wrapper itself, the check will still pass.
2. **Null check**: If `document.activeElement` is null, `contains(null)` returns `false`, which is the correct behavior.

The fix is correct and handles all edge cases properly. Let me now review the change one more time and then mark the task as complete.
</thinking>

STEP 4: REVIEW THE FIX

Let me verify the fix is in place and review it:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && git diff packages/material-ui/src/Tooltip/Tooltip.js

========================================================================================================================
TOOL RETURN (bash)
```
diff --git a/packages/material-ui/src/Tooltip/Tooltip.js b/packages/material-ui/src/Tooltip/Tooltip.js
index 5d1ceb6048..010e490ba1 100644
--- a/packages/material-ui/src/Tooltip/Tooltip.js
+++ b/packages/material-ui/src/Tooltip/Tooltip.js
@@ -130,7 +130,7 @@ class Tooltip extends React.Component {
     // We need to account for this eventuality.
     this.focusTimer = setTimeout(() => {
       // We need to make sure the focus hasn't moved since the event was triggered.
-      if (this.childrenR...
```
========================================================================================================================
AGENT:
<thinking>
The fix is in place. Let me also verify that the `contains` method is the correct approach by checking if there are any similar patterns in the codebase.
</thinking>
========================================================================================================================
TOOL CALL (grep)
content_pattern: \.contains\(document\.activeElement\)

========================================================================================================================
TOOL RETURN (grep)
```
packages/material-ui/src/Tooltip/Tooltip.js:133:      if (this.childrenRef.contains(document.activeElement)) {...
```
========================================================================================================================
TOOL CALL (grep)
content_pattern: \.contains\(
path_glob: '**/material-ui/src/**/*.js'

========================================================================================================================
TOOL RETURN (grep)
```
packages/material-ui/src/ListItemText/ListItemText.test.js:62:      assert.strictEqual(wrapper.contains(primary), true);
packages/material-ui/src/ListItemText/ListItemText.test.js:68:      assert.strictEqual(wrapper.contains(primary), true);
packages/material-ui/src/ListItemText/ListItemText.test.js:91:      assert.strictEqual(wrapper.contains(secondary), true);
packages/material-ui/src/Snackbar/Snackbar.test.js:384:      assert.strictEqual(wrapper.contains(children), true);
packages/material-ui...
```
========================================================================================================================
AGENT:
<thinking>
I can see that the `contains` method is used in several places in the codebase, including:
- `packages/material-ui/src/ButtonBase/focusVisible.js:30` - `(activeElement === element || element.contains(activeElement))`
- `packages/material-ui/src/MenuList/MenuList.js:32` - `if (!list.contains(currentFocus))`
- `packages/material-ui/src/Modal/Modal.js:212` - `if (!this.dialogRef.contains(currentActiveElement))`

This confirms that using `contains` is a standard pattern in this codebase for checking if an element contains the active/focused element.

The fix I made is correct and follows the existing patterns in the codebase. Let me also look at the `focusVisible.js` file to see how it handles a similar case:
</thinking>
========================================================================================================================
TOOL CALL (inspect_code)
file_path: packages/material-ui/src/ButtonBase/focusVisible.js
line_ranges:
- - 20
  - 40

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in packages/material-ui/src/ButtonBase/focusVisible.js:

````javascript
   0 import warning from 'warning';
   1 import ownerDocument from '../utils/ownerDocument';
   2 
   3 const internal = {
   4   focusKeyPressed: false,
   5   keyUpEventTimeout: -1,
   6 };
   7 
   8 function findActiveElement(doc) {
   9   let activeElement = doc.activeElement;
  10   while (activeElement && activeElement.shadowRoot && activeElement.shadowRoot.activeElement) {
  11     a...
```
========================================================================================================================
AGENT:
<thinking>
This confirms my fix is correct. In `focusVisible.js` at line 29, the code uses:
```javascript
(activeElement === element || element.contains(activeElement))
```

This is exactly the same pattern I'm using in my fix. The code checks if either:
1. The active element is the element itself, OR
2. The element contains the active element

My fix uses `this.childrenRef.contains(document.activeElement)` which covers both cases because `element.contains(element)` returns `true` (an element contains itself).

The fix is correct and follows the existing patterns in the codebase. Let me now verify the fix one more time and then mark the task as complete.
</thinking>

STEP 5: FINAL VERIFICATION

Let me verify the fix is correct by reviewing the change one more time:
========================================================================================================================
TOOL CALL (inspect_code)
file_path: packages/material-ui/src/Tooltip/Tooltip.js
patterns:
- handleFocus

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in packages/material-ui/src/Tooltip/Tooltip.js:

````javascript
   0 import React from 'react';
   1 import PropTypes from 'prop-types';
   2 import warning from 'warning';
   3 import classNames from 'classnames';
   4 import { componentPropType } from '@material-ui/utils';
   5 import RootRef from '../RootRef';
   6 import withStyles from '../styles/withStyles';
   7 import { capitalize } from '../utils/helpers';
   8 import Grow from '../Grow';
   9 import Po...
```
========================================================================================================================
AGENT:
The fix is in place at line 132. Let me verify the change one more time:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && git diff packages/material-ui/src/Tooltip/Tooltip.js

========================================================================================================================
TOOL RETURN (bash)
```
diff --git a/packages/material-ui/src/Tooltip/Tooltip.js b/packages/material-ui/src/Tooltip/Tooltip.js
index 5d1ceb6048..010e490ba1 100644
--- a/packages/material-ui/src/Tooltip/Tooltip.js
+++ b/packages/material-ui/src/Tooltip/Tooltip.js
@@ -130,7 +130,7 @@ class Tooltip extends React.Component {
     // We need to account for this eventuality.
     this.focusTimer = setTimeout(() => {
       // We need to make sure the focus hasn't moved since the event was triggered.
-      if (this.childrenR...
```
========================================================================================================================
AGENT:
The fix has been applied. Changed `this.childrenRef === document.activeElement` to `this.childrenRef.contains(document.activeElement)` in the Tooltip component's handleFocus method. This allows the tooltip to show when focus is on any element contained within the child element (like the input inside a TextField), not just when the child element itself is focused. This follows the same pattern used in other parts of the codebase (e.g., focusVisible.js, Modal.js, MenuList.js).
========================================================================================================================
AGENT:
Let me also check if there are any other places in the codebase that might have the same issue:
========================================================================================================================
TOOL CALL (grep)
content_pattern: === document\.activeElement

========================================================================================================================
TOOL RETURN (grep)
```
No matches found for pattern '=== document\.activeElement'....
```
========================================================================================================================
AGENT:
Good, there are no other places with the same issue. Let me also verify that the fix doesn't break any edge cases by reviewing the logic:
========================================================================================================================
TOOL CALL (bash)
command: "cat << 'EOF'\nThe fix changes:\n  FROM: if (this.childrenRef === document.activeElement)\n\
  \  TO:   if (this.childrenRef.contains(document.activeElement))\n\nThis fix is correct\
  \ because:\n\n1. For simple elements (like a button):\n   - When focused, document.activeElement\
  \ === button\n   - button.contains(button) === true (an element contains itself)\n\
  \   - So the tooltip will still show correctly\n\n2. For composite elements (like\
  \ TextField):\n   - When focused, document.activeElement === input (inside TextField)\n\
  \   - TextField wrapper.contains(input) === true\n   - So the tooltip will now show\
  \ correctly (this was the bug)\n\n3. Edge cases:\n   - If document.activeElement\
  \ is null: contains(null) === false (correct)\n   - If focus moves outside: contains(outsideElement)\
  \ === false (correct)\n\nThe fix follows the same pattern used in:\n- packages/material-ui/src/ButtonBase/focusVisible.js:29\n\
  - packages/material-ui/src/Modal/Modal.js:212\n- packages/material-ui/src/MenuList/MenuList.js:32\n\
  \nEOF"

========================================================================================================================
TOOL RETURN (bash)
```
The fix changes:
  FROM: if (this.childrenRef === document.activeElement)
  TO:   if (this.childrenRef.contains(document.activeElement))

This fix is correct because:

1. For simple elements (like a button):
   - When focused, document.activeElement === button
   - button.contains(button) === true (an element contains itself)
   - So the tooltip will still show correctly

2. For composite elements (like TextField):
   - When focused, document.activeElement === input (inside TextField)
   - TextF...
```
========================================================================================================================
AGENT:
Successfully fixed the issue where Tooltips weren't displayed on focus on TextFields.

**Problem:**
When using a Tooltip component with `disableHoverListener` around a TextField component, the tooltip was not displayed on focus. This was because the `handleFocus` method in the Tooltip component was checking if `this.childrenRef === document.activeElement`, which fails for composite components like TextField where the focused element (the input) is a child of the wrapper element (FormControl).

**Solution:**
Changed the check from `this.childrenRef === document.activeElement` to `this.childrenRef.contains(document.activeElement)` in the `handleFocus` method of the Tooltip component (line 132 in packages/material-ui/src/Tooltip/Tooltip.js).

**Why this works:**
- `element.contains(element)` returns `true`, so simple elements (like buttons) still work correctly
- `wrapper.contains(childElement)` returns `true`, so composite elements (like TextField) now work correctly
- This follows the same pattern used elsewhere in the codebase (e.g., focusVisible.js, Modal.js, MenuList.js)

The fix is minimal, targeted, and follows existing patterns in the Material-UI codebase.