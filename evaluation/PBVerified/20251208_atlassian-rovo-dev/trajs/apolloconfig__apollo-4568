########################################################################################################################
PHASE 1
########################################################################################################################
========================================================================================================================
AGENT:
I will start by viewing the workspace to understand its structure and contents. This will help me identify key files and locations that may be relevant to the task.
========================================================================================================================
USER PROMPT:
Resolve the following problem statement:

<problem_statement>
create namespace with single dot 500 error
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


</problem_statement>

Do not stop until you have made code changes that resolve the problem statement. Do not ask for clarifications.
========================================================================================================================
AGENT:
Starting to analyze the problem statement. The issue is that creating a namespace with a single dot (.) causes a 500 error when querying the namespace. I need to explore the codebase to understand how namespace names are validated and where the crash occurs.
========================================================================================================================
TOOL CALL (grep)
content_pattern: InputValidator
path_glob: '**/*.java'

========================================================================================================================
TOOL RETURN (grep)
```
apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java:20:import com.ctrip.framework.apollo.common.utils.InputValidator;
apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java:65:    if (!InputValidator.isValidAppNamespace(appNamespaceDTO.getName())) {
apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java:67:                                                ...
```
========================================================================================================================
AGENT:
STEP 1: EXPLORE THE INPUTVALIDATOR CLASS

<thinking>
The problem is that creating a namespace with a single dot (.) causes a 500 error. Let me look at the InputValidator class to understand how namespace names are validated. The issue seems to be related to namespace name validation.
</thinking>
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
- apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agreed t...
```
========================================================================================================================
AGENT:
STEP 2: ANALYZE THE VALIDATION LOGIC

<thinking>
Looking at the InputValidator class, I can see:

1. `CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+"` - This regex allows digits, alphabets, underscore, dot, and hyphen. A single dot "." would match this pattern.

2. `APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$"` - This regex also allows a single dot "." because it matches `[a-zA-Z0-9._-]+`.

So the validation allows a single dot as a namespace name. The problem is likely in how the namespace name is processed elsewhere in the code, possibly when trying to determine the file format or when querying the namespace.

Let me search for where the namespace name is used to determine the file format, as the error might occur when trying to parse the format from a single dot.
</thinking>
========================================================================================================================
TOOL CALL (grep)
content_pattern: ConfigFileFormat
path_glob: '**/*.java'

========================================================================================================================
TOOL RETURN (grep)
```
Too many matches found (265). Showing matched files only:
apollo-client/src/main/java/com/ctrip/framework/apollo/ConfigFile.java
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesConfigFileTest.java
apollo-client/src/main/java/com/ctrip/framework/apollo/internals/JsonConfigFile.java
apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
apol...
```
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agreed to ...
```
========================================================================================================================
AGENT:
STEP 3: SEARCH FOR NAMESPACE NAME PARSING LOGIC

<thinking>
Now I need to find where the namespace name is parsed to extract the format. The issue is likely when a namespace name like "." is processed and the code tries to extract the file format from it. Let me search for where the namespace name is split or parsed.
</thinking>
========================================================================================================================
TOOL CALL (grep)
content_pattern: namespaceName.*\\..*split|split.*namespaceName
path_glob: '**/*.java'

========================================================================================================================
TOOL RETURN (grep)
```
apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/ConfigsExportController.java:86:    List<String> fileNameSplit = Splitter.on(".").splitToList(namespaceName);...
```
========================================================================================================================
TOOL CALL (grep)
content_pattern: lastIndexOf.*\\.
path_glob: '**/*.java'

========================================================================================================================
TOOL RETURN (grep)
```
No matches found for pattern 'lastIndexOf.*\\.'....
```
========================================================================================================================
TOOL CALL (grep)
content_pattern: \.substring
path_glob: '**/*.java'

========================================================================================================================
TOOL RETURN (grep)
```
apollo-client/src/main/java/com/ctrip/framework/apollo/spring/property/PlaceholderHelper.java:103:      String placeholderCandidate = strVal.substring(startIndex + PLACEHOLDER_PREFIX.length(), endIndex);
apollo-client/src/main/java/com/ctrip/framework/apollo/spring/property/PlaceholderHelper.java:115:          stack.push(placeholderCandidate.substring(0, separatorIndex));
apollo-client/src/main/java/com/ctrip/framework/apollo/spring/property/PlaceholderHelper.java:117:              normalizeToPl...
```
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law...
```
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/util/ConfigFileUtils.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/util/ConfigFileUtils.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agreed t...
```
========================================================================================================================
AGENT:
STEP 4: SEARCH FOR THE NAMESPACE BO UTILS

<thinking>
Let me look at the NamespaceBOUtils class which might be involved in processing namespace names.
</thinking>
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/util/NamespaceBOUtils.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/util/NamespaceBOUtils.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agreed ...
```
========================================================================================================================
TOOL CALL (grep)
content_pattern: getFormat
path_glob: '**/NamespaceBO.java'

========================================================================================================================
TOOL RETURN (grep)
```
apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/NamespaceBO.java:58:  public String getFormat() {...
```
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/NamespaceBO.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/NamespaceBO.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agreed ...
```
========================================================================================================================
AGENT:
STEP 5: SEARCH FOR WHERE FORMAT IS SET

<thinking>
Now I need to find where the format is set for the NamespaceBO. Let me search for where setFormat is called.
</thinking>
========================================================================================================================
TOOL CALL (grep)
content_pattern: setFormat
path_glob: '**/*.java'

========================================================================================================================
TOOL RETURN (grep)
```
apollo-openapi/src/main/java/com/ctrip/framework/apollo/openapi/dto/OpenAppNamespaceDTO.java:53:    public void setFormat(String format) {
apollo-openapi/src/main/java/com/ctrip/framework/apollo/openapi/client/service/NamespaceOpenApiService.java:100:      appNamespaceDTO.setFormat(ConfigFileFormat.Properties.getValue());
apollo-openapi/src/main/java/com/ctrip/framework/apollo/openapi/dto/OpenNamespaceDTO.java:73:  public void setFormat(String format) {
apollo-adminservice/src/main/java/com/ctri...
```
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agre...
```
========================================================================================================================
AGENT:
STEP 6: EXPAND THE TRANSFORMNAMESPACE2BO METHOD

<thinking>
Let me expand the `transformNamespace2BO` method to see how the namespace is transformed and where the format is set.
</thinking>
========================================================================================================================
TOOL CALL (inspect_code)
file_path: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
patterns:
- transformNamespace2BO
- fillAppNamespaceProperties

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java:

````java
   0 /*
   1  * Copyright 2022 Apollo Authors
   2  *
   3  * Licensed under the Apache License, Version 2.0 (the "License");
   4  * you may not use this file except in compliance with the License.
   5  * You may obtain a copy of the License at
   6  *
   7  * http://www.apache.org/licenses/LICENSE-2.0
   8  *
   9  * Unless required by applicable law or a...
```
========================================================================================================================
AGENT:
STEP 7: LOOK AT THE APPNAMESPACE ENTITY

<thinking>
Now I see that the format comes from `appNamespace.getFormat()`. Let me look at the AppNamespace entity to see how the format is stored and retrieved.
</thinking>
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agreed to...
```
========================================================================================================================
AGENT:
STEP 8: UNDERSTAND THE ISSUE

<thinking>
Now I understand the issue better. Looking at the code:

1. The `InputValidator.CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+"` regex allows a single dot "." as a valid namespace name.

2. When a namespace with name "." is created, it passes validation.

3. However, when the namespace is queried and the format is determined, the code in `NamespaceBOUtils.convert2configFileContent` calls `ConfigFileFormat.fromString(namespaceBO.getFormat())`.

4. The `formatAsEnum()` method in `AppNamespace` also calls `ConfigFileFormat.fromString(this.format)`.

5. Looking at `ConfigFileFormat.fromString()`, it throws an `IllegalArgumentException` if the value is empty or doesn't match any format.

The issue is that a single dot "." is a valid namespace name according to the regex, but it's problematic because:
1. It could be confused with file extensions
2. It might cause issues when parsing the namespace name to extract format information

Let me look at the validation more closely. The issue is that the regex `[0-9a-zA-Z_.-]+` allows a single dot, but this is problematic. We should update the validation to not allow a namespace name that is just a single dot or starts/ends with a dot.

Let me check the test cases to understand the expected behavior better.
</thinking>
========================================================================================================================
TOOL CALL (inspect_code)
file_path: apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java
line_ranges:
- - 0
  - -1

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java:

````java
   0 /*
   1  * Copyright 2022 Apollo Authors
   2  *
   3  * Licensed under the Apache License, Version 2.0 (the "License");
   4  * you may not use this file except in compliance with the License.
   5  * You may obtain a copy of the License at
   6  *
   7  * http://www.apache.org/licenses/LICENSE-2.0
   8  *
   9  * Unless required by applicable law or a...
```
========================================================================================================================
AGENT:
STEP 9: ANALYZE THE ROOT CAUSE

<thinking>
Now I understand the issue. The problem is that:

1. A single dot "." is allowed by the regex `[0-9a-zA-Z_.-]+` because it matches one or more characters from the set `[0-9a-zA-Z_.-]`.

2. When a namespace with name "." is created, it passes validation.

3. However, when the namespace is queried, the code tries to determine the format. Looking at the `NamespaceBOUtils.convert2configFileContent` method, it calls `ConfigFileFormat.fromString(namespaceBO.getFormat())`.

4. The format comes from `appNamespace.getFormat()` which is stored in the database. If the format is empty or invalid, `ConfigFileFormat.fromString()` throws an `IllegalArgumentException`.

Wait, let me re-read the issue. The problem is that creating a namespace with a single dot (.) causes a 500 error when refreshing/querying the namespace. 

Let me trace through the code more carefully:

1. When a namespace is created with name ".", it passes validation.
2. When the namespace is queried, `transformNamespace2BO` is called.
3. `fillAppNamespaceProperties` is called, which looks up the `AppNamespace` by name.
4. If found, `format = appNamespace.getFormat()` is used.
5. The format is then set on the `NamespaceBO`.

The issue might be in how the format is determined or stored. Let me check the `AppNamespaceService` to see how the format is set when creating a namespace.

Actually, looking more carefully at the issue, I think the problem might be in the validation. A single dot "." should not be allowed as a namespace name because:
1. It's confusing and could cause issues with file extensions
2. It might cause issues when parsing the namespace name

Let me update the `InputValidator` to not allow a namespace name that is just a single dot or consists only of dots.

Actually, let me first verify the exact error by looking at where the 500 error might occur. Let me search for where the namespace name might be parsed incorrectly.
</thinking>
========================================================================================================================
TOOL CALL (grep)
content_pattern: ConfigFileFormat\.fromString
path_glob: '**/*.java'

========================================================================================================================
TOOL RETURN (grep)
```
apollo-core/src/test/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormatTest.java:41:        ConfigFileFormat.fromString(ConfigFileFormat.Properties.getValue()));
apollo-core/src/test/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormatTest.java:43:        ConfigFileFormat.fromString(ConfigFileFormat.XML.getValue()));
apollo-core/src/test/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormatTest.java:45:        ConfigFileFormat.fromString(ConfigFileFormat.JSON.getValue()));
...
```
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/ConfigBO.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/ConfigBO.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agreed to ...
```
========================================================================================================================
AGENT:
STEP 10: UNDERSTAND THE FULL PICTURE

<thinking>
Now I understand the issue better. The problem is:

1. When a namespace with name "." is created, it passes validation because the regex `[0-9a-zA-Z_.-]+` allows a single dot.

2. When the namespace is queried, the code tries to determine the format from the `AppNamespace` entity.

3. The format is stored in the database. If the format is empty or invalid, `ConfigFileFormat.fromString()` throws an `IllegalArgumentException`.

But wait, the format should be set when the namespace is created. Let me check how the format is set during namespace creation.

Looking at the code in `AppNamespaceService`:
- Line 107: `appNs.setFormat(ConfigFileFormat.Properties.getValue());` - This sets the format to "properties" by default.

So the format should always be set. Let me check if there's another issue.

Actually, looking at the issue description again: "create namespace with single dot(.) will crash in query namespace". This suggests that the crash happens when querying the namespace, not when creating it.

Let me look at the `NamespaceBOUtils.convert2configFileContent` method more closely:

```java
if (!ConfigFileFormat.Properties.equals(ConfigFileFormat.fromString(namespaceBO.getFormat()))) {
```

If `namespaceBO.getFormat()` returns an empty string or null, `ConfigFileFormat.fromString()` will throw an `IllegalArgumentException`.

But where does the format come from? It comes from `fillAppNamespaceProperties`:

```java
if (appNamespace == null) {
  format = ConfigFileFormat.Properties.getValue();
} else {
  format = appNamespace.getFormat();
}
namespace.setFormat(format);
```

So if `appNamespace.getFormat()` returns null or empty, the format will be null or empty, and `ConfigFileFormat.fromString()` will throw an exception.

But wait, the format should be set when the `AppNamespace` is created. Let me check if there's a case where the format is not set.

Actually, I think I need to look at this from a different angle. The issue says "create namespace with single dot(.)". This might mean creating an `AppNamespace` with name ".".

Let me check the validation in the portal controller for creating namespaces.
</thinking>
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law o...
```
========================================================================================================================
TOOL CALL (inspect_code)
file_path: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
patterns:
- createAppNamespace

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java:

````java
   0 /*
   1  * Copyright 2022 Apollo Authors
   2  *
   3  * Licensed under the Apache License, Version 2.0 (the "License");
   4  * you may not use this file except in compliance with the License.
   5  * You may obtain a copy of the License at
   6  *
   7  * http://www.apache.org/licenses/LICENSE-2.0
   8  *
   9  * Unless required by applicable la...
```
========================================================================================================================
AGENT:
STEP 11: VERIFY THE ISSUE

<thinking>
Now I understand the issue. The validation in `InputValidator.isValidAppNamespace()` uses the regex `[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$` which allows a single dot "." as a valid namespace name.

Let me verify this by testing the regex:
- "." matches `[a-zA-Z0-9._-]+` because it's one or more characters from the set.
- The negative lookbehind `(?<!\\.(json|yml|yaml|xml|properties))$` checks that the string doesn't end with ".json", ".yml", etc. A single "." doesn't end with any of these, so it passes.

So a single dot "." is considered a valid namespace name by the current validation.

The fix should be to update the validation to not allow:
1. A namespace name that is just a single dot "."
2. A namespace name that starts with a dot "."
3. A namespace name that ends with a dot "."

Let me update the `InputValidator` class to add these checks.

Actually, looking at the regex more carefully:
- `CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+"` - This allows any combination of digits, letters, underscore, dot, and hyphen.
- `APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$"` - This is similar but with a negative lookbehind.

The issue is that both regexes allow a single dot "." as a valid name.

The fix should be to update the validation to not allow names that:
1. Consist only of dots (e.g., ".", "..", "...")
2. Start with a dot (e.g., ".name")
3. End with a dot (e.g., "name.")

Let me update the `InputValidator` class.
</thinking>
========================================================================================================================
TOOL CALL (inspect_code)
file_path: apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
line_ranges:
- - 0
  - -1

========================================================================================================================
TOOL RETURN (inspect_code)
```
Successfully expanded code chunks in apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java:

````java
   0 /*
   1  * Copyright 2022 Apollo Authors
   2  *
   3  * Licensed under the Apache License, Version 2.0 (the "License");
   4  * you may not use this file except in compliance with the License.
   5  * You may obtain a copy of the License at
   6  *
   7  * http://www.apache.org/licenses/LICENSE-2.0
   8  *
   9  * Unless required by applicable law or agree...
```
========================================================================================================================
AGENT:
STEP 12: UPDATE THE INPUTVALIDATOR CLASS

<thinking>
Now I need to update the `InputValidator` class to not allow namespace names that:
1. Consist only of dots (e.g., ".", "..", "...")
2. Start with a dot (e.g., ".name")
3. End with a dot (e.g., "name.")

I'll update the regex patterns to add these restrictions. The new regex should:
1. Not start with a dot
2. Not end with a dot
3. Not consist only of dots

For `CLUSTER_NAMESPACE_VALIDATOR`, I'll change it from `[0-9a-zA-Z_.-]+` to `[0-9a-zA-Z_.-]+` with additional checks in the method.

Actually, it's easier to update the regex to:
- `(?![.])` - Negative lookahead to ensure it doesn't start with a dot
- `(?<![.])` - Negative lookbehind to ensure it doesn't end with a dot

But since the regex is also used as a constant for validation annotations, I need to be careful about how I update it.

Let me think about this more carefully:

1. The `CLUSTER_NAMESPACE_VALIDATOR` is used in annotations like `@Pattern(regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR, ...)`.
2. The `APP_NAMESPACE_VALIDATOR` is a private constant used only in the `isValidAppNamespace` method.

For the `CLUSTER_NAMESPACE_VALIDATOR`, I can update the regex to not allow names that start or end with a dot. The new regex would be:
- `[0-9a-zA-Z_-][0-9a-zA-Z_.-]*[0-9a-zA-Z_-]` - This requires at least 2 characters and doesn't allow starting or ending with a dot.
- But this doesn't allow single-character names like "a" or "1".

A better approach is to use:
- `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` - This allows single-character names and multi-character names that don't start or end with a dot.

Wait, this is getting complicated. Let me simplify:

The issue is that a single dot "." is allowed. The simplest fix is to add a check in the `isValidClusterNamespace` and `isValidAppNamespace` methods to reject names that:
1. Start with a dot
2. End with a dot

This way, I don't need to change the regex pattern, which is used in annotations.

Actually, looking at the code more carefully, I see that the `CLUSTER_NAMESPACE_VALIDATOR` is used in annotations, so I need to update the regex to include the restriction. But the annotations use the regex directly, so I need to update the regex.

Let me update the regex to:
- `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` - This allows single-character names (without dots) and multi-character names that don't start or end with a dot.

Wait, this still allows "a.b" but not ".a" or "a.". Let me verify:
- "a" matches `[0-9a-zA-Z_-]` (first part) and the second part `([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` is optional, so it matches.
- "a.b" matches `[0-9a-zA-Z_-]` (first part, "a") and `([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` (second part, ".b" where "." matches `[0-9a-zA-Z_.-]*` and "b" matches `[0-9a-zA-Z_-]`).
- ".a" doesn't match because the first character must be `[0-9a-zA-Z_-]`, not a dot.
- "a." doesn't match because the last character must be `[0-9a-zA-Z_-]`, not a dot.
- "." doesn't match because the first character must be `[0-9a-zA-Z_-]`, not a dot.

This looks correct. Let me update the code.

Actually, I realize I need to also update the `APP_NAMESPACE_VALIDATOR` regex. Let me update both.

For `APP_NAMESPACE_VALIDATOR`, the current regex is:
`[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$`

I need to update it to not allow names that start or end with a dot:
`[a-zA-Z0-9_-]([a-zA-Z0-9._-]*[a-zA-Z0-9_-])?(?<!\\.(json|yml|yaml|xml|properties))$`

Wait, this is getting complicated. Let me simplify by adding a check in the methods instead of updating the regex.

Actually, the simplest fix is to add a check in the `isValidClusterNamespace` and `isValidAppNamespace` methods to reject names that start or end with a dot. This way, I don't need to change the regex pattern.

But wait, the `CLUSTER_NAMESPACE_VALIDATOR` is used in annotations, so the validation will still pass for names that start or end with a dot if the annotation is used directly. However, the methods `isValidClusterNamespace` and `isValidAppNamespace` are also used in the code, so adding the check there will help.

Let me check where the annotations are used and where the methods are used.

Looking at the code:
1. `AppNamespace.java` uses `@Pattern(regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR, ...)` for the `name` field.
2. `NamespaceController.java` uses `InputValidator.isValidAppNamespace(appNamespace.getName())` to validate the namespace name.

So the validation is done in two places:
1. By the `@Pattern` annotation on the entity.
2. By the `isValidAppNamespace` method in the controller.

If I update the regex, both validations will be updated. If I only add a check in the method, the annotation validation will still allow names that start or end with a dot.

I think the best approach is to update the regex to not allow names that start or end with a dot. This will ensure that both the annotation and the method validation are consistent.

Let me update the `CLUSTER_NAMESPACE_VALIDATOR` regex to:
`[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?`

And update the `APP_NAMESPACE_VALIDATOR` regex to:
`[a-zA-Z0-9_-]([a-zA-Z0-9._-]*[a-zA-Z0-9_-])?(?<!\\.(json|yml|yaml|xml|properties))$`

Wait, I need to be more careful. The current regex `[0-9a-zA-Z_.-]+` allows:
- Single character names like "a", "1", "_", "-", "."
- Multi-character names like "a.b", ".a", "a.", "..."

The new regex `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` allows:
- Single character names like "a", "1", "_", "-" (but NOT ".")
- Multi-character names like "a.b", "a-b", "a_b" (but NOT ".a", "a.", "...")

This is the correct behavior. Let me update the code.

Actually, I realize there's a subtle issue. The regex `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` requires:
- The first character to be `[0-9a-zA-Z_-]` (no dot)
- If there are more characters, the last character must be `[0-9a-zA-Z_-]` (no dot)

But what about a two-character name like "a."? Let me check:
- "a." matches `[0-9a-zA-Z_-]` (first part, "a") and `([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` (second part).
- The second part `([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` requires at least one character from `[0-9a-zA-Z_-]` at the end.
- "." matches `[0-9a-zA-Z_.-]*` (zero or more characters), but there's no character from `[0-9a-zA-Z_-]` at the end.
- So "a." doesn't match the second part, and the regex doesn't match.

Wait, that's not right. Let me re-analyze:
- The regex is `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?`
- For "a.", the first character "a" matches `[0-9a-zA-Z_-]`.
- The second part `([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` is optional.
- If we try to match ".", we need `[0-9a-zA-Z_.-]*` followed by `[0-9a-zA-Z_-]`.
- "." matches `[0-9a-zA-Z_.-]*` (one character), but there's no character left to match `[0-9a-zA-Z_-]`.
- So the second part doesn't match, and the regex tries to match without the second part.
- Without the second part, the regex is just `[0-9a-zA-Z_-]`, which matches "a".
- But we have "a.", not just "a", so the regex doesn't match the entire string.

Actually, I need to use anchors to ensure the regex matches the entire string. Let me check if the `Pattern.matcher(name).matches()` method requires the entire string to match.

Yes, `Pattern.matcher(name).matches()` requires the entire string to match the regex. So "a." won't match `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` because:
- "a" matches `[0-9a-zA-Z_-]`.
- "." is left over, and the second part `([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` doesn't match just ".".

Wait, let me re-analyze more carefully:
- The regex is `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?`
- For "a.", we try to match:
  - `[0-9a-zA-Z_-]` matches "a".
  - `([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` is optional, so we can try to match "." or skip it.
  - If we try to match ".", we need `[0-9a-zA-Z_.-]*` followed by `[0-9a-zA-Z_-]`.
  - `[0-9a-zA-Z_.-]*` can match zero characters (empty string).
  - `[0-9a-zA-Z_-]` needs to match ".", but "." is not in `[0-9a-zA-Z_-]`.
  - So the second part doesn't match ".".
  - If we skip the second part, we've only matched "a", but the input is "a.", so the regex doesn't match the entire string.

So "a." doesn't match the regex. 

Let me also verify ".a":
- The regex is `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?`
- For ".a", we try to match:
  - `[0-9a-zA-Z_-]` needs to match ".", but "." is not in `[0-9a-zA-Z_-]`.
  - So the regex doesn't match.

And ".":
- The regex is `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?`
- For ".", we try to match:
  - `[0-9a-zA-Z_-]` needs to match ".", but "." is not in `[0-9a-zA-Z_-]`.
  - So the regex doesn't match.

The new regex is correct. Let me update the code.

But wait, I also need to update the error message to reflect the new restriction. The current message is "Only digits, alphabets and symbol - _ . are allowed". I should update it to mention that the name cannot start or end with a dot.
</thinking>

Now I'll update the `InputValidator` class to fix the issue. The fix is to update the regex patterns to not allow namespace names that start or end with a dot.
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
find: "public class InputValidator {\n  public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE\
  \ = \"Only digits, alphabets and symbol - _ . are allowed\";\n  public static final\
  \ String INVALID_NAMESPACE_NAMESPACE_MESSAGE = \"not allowed to end with .json,\
  \ .yml, .yaml, .xml, .properties\";\n  public static final String CLUSTER_NAMESPACE_VALIDATOR\
  \ = \"[0-9a-zA-Z_.-]+\";\n  private static final String APP_NAMESPACE_VALIDATOR\
  \ = \"[a-zA-Z0-9._-]+(?<!\\\\.(json|yml|yaml|xml|properties))$\";\n  private static\
  \ final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);\n\
  \  private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);"
replace: "public class InputValidator {\n  public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE\
  \ = \"Only digits, alphabets and symbol - _ . are allowed and the name cannot start\
  \ or end with .\";\n  public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE\
  \ = \"not allowed to end with .json, .yml, .yaml, .xml, .properties\";\n  public\
  \ static final String CLUSTER_NAMESPACE_VALIDATOR = \"[0-9a-zA-Z_-][0-9a-zA-Z_.-]*|[0-9a-zA-Z_-]\"\
  ;\n  private static final String APP_NAMESPACE_VALIDATOR = \"[a-zA-Z0-9_-]([a-zA-Z0-9._-]*[a-zA-Z0-9_-])?(?<!\\\
  \\.(json|yml|yaml|xml|properties))$|[a-zA-Z0-9_-]\";\n  private static final Pattern\
  \ CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);\n  private\
  \ static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);"

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java:

--- apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
+++ apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
@@ -24,10 +24,10 @@
  * @author Jason Song(song_s@ctrip.com)
  */
 public class InputValidator {
-  public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbo...
```
========================================================================================================================
AGENT:
STEP 13: UPDATE THE TEST CASES

<thinking>
Now I need to update the test cases to verify the new validation logic. I'll add test cases for:
1. Single dot "." - should be invalid
2. Names starting with a dot ".name" - should be invalid
3. Names ending with a dot "name." - should be invalid
4. Names with dots in the middle "name.test" - should be valid
</thinking>
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java
find: "  @Test\n  public void testValidClusterName() throws Exception {\n    checkClusterName(\"\
  some.cluster-_name.123\", true);\n    checkClusterName(\"some.cluster-_name.123.yml\"\
  , true);\n    checkClusterName(\"some.&.name\", false);\n    checkClusterName(\"\
  \", false);\n    checkClusterName(null, false);\n  }\n\n  @Test\n  public void testValidAppNamespaceName()\
  \ throws Exception {\n    checkAppNamespaceName(\"some.cluster-_name.123\", true);\n\
  \    checkAppNamespaceName(\"some.&.name\", false);\n    checkAppNamespaceName(\"\
  \", false);\n    checkAppNamespaceName(null, false);\n    checkAppNamespaceName(\"\
  some.name.json\", false);\n    checkAppNamespaceName(\"some.name.yml\", false);\n\
  \    checkAppNamespaceName(\"some.name.yaml\", false);\n    checkAppNamespaceName(\"\
  some.name.xml\", false);\n    checkAppNamespaceName(\"some.name.properties\", false);\n\
  \  }"
replace: "  @Test\n  public void testValidClusterName() throws Exception {\n    checkClusterName(\"\
  some.cluster-_name.123\", true);\n    checkClusterName(\"some.cluster-_name.123.yml\"\
  , true);\n    checkClusterName(\"some.&.name\", false);\n    checkClusterName(\"\
  \", false);\n    checkClusterName(null, false);\n    // single character names\n\
  \    checkClusterName(\"a\", true);\n    checkClusterName(\"1\", true);\n    checkClusterName(\"\
  _\", true);\n    checkClusterName(\"-\", true);\n    // names starting or ending\
  \ with dot should be invalid\n    checkClusterName(\".\", false);\n    checkClusterName(\"\
  ..\", false);\n    checkClusterName(\"...\", false);\n    checkClusterName(\".name\"\
  , false);\n    checkClusterName(\"name.\", false);\n    checkClusterName(\".name.\"\
  , false);\n  }\n\n  @Test\n  public void testValidAppNamespaceName() throws Exception\
  \ {\n    checkAppNamespaceName(\"some.cluster-_name.123\", true);\n    checkAppNamespaceName(\"\
  some.&.name\", false);\n    checkAppNamespaceName(\"\", false);\n    checkAppNamespaceName(null,\
  \ false);\n    checkAppNamespaceName(\"some.name.json\", false);\n    checkAppNamespaceName(\"\
  some.name.yml\", false);\n    checkAppNamespaceName(\"some.name.yaml\", false);\n\
  \    checkAppNamespaceName(\"some.name.xml\", false);\n    checkAppNamespaceName(\"\
  some.name.properties\", false);\n    // single character names\n    checkAppNamespaceName(\"\
  a\", true);\n    checkAppNamespaceName(\"1\", true);\n    checkAppNamespaceName(\"\
  _\", true);\n    checkAppNamespaceName(\"-\", true);\n    // names starting or ending\
  \ with dot should be invalid\n    checkAppNamespaceName(\".\", false);\n    checkAppNamespaceName(\"\
  ..\", false);\n    checkAppNamespaceName(\"...\", false);\n    checkAppNamespaceName(\"\
  .name\", false);\n    checkAppNamespaceName(\"name.\", false);\n    checkAppNamespaceName(\"\
  .name.\", false);\n  }"

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java:

--- apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java
+++ apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java
@@ -29,6 +29,18 @@
     checkClusterName("some.&.name", false);
     checkClusterName("", false);
     checkClusterName(null, false);
+    // single character names
+    checkClusterNa...
```
========================================================================================================================
AGENT:
STEP 14: RUN THE TESTS TO VERIFY THE FIX
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-common -Dtest=InputValidatorTest
  -q 2>&1 | tail -50
timeout: 120

========================================================================================================================
TOOL RETURN (bash)
```
--2025-12-05 13:52:51--  https://repo.maven.apache.org/maven2/io/takari/maven-wrapper/0.4.2/maven-wrapper-0.4.2.jar
Resolving repo.maven.apache.org (repo.maven.apache.org)... 104.18.18.12, 104.18.19.12, 2606:4700::6812:130c, ...
Connecting to repo.maven.apache.org (repo.maven.apache.org)|104.18.18.12|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 48337 (47K) [application/java-archive]
Saving to: ‘/workspace/.mvn/wrapper/maven-wrapper.jar’

     0K .......... .............
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw install -DskipTests -q 2>&1 | tail -20
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-common -Dtest=InputValidatorTest
  -q 2>&1 | tail -50
timeout: 120

========================================================================================================================
TOOL RETURN (bash)
```
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunne...
```
========================================================================================================================
AGENT:
<thinking>
The test is failing because the regex `[0-9a-zA-Z_-][0-9a-zA-Z_.-]*|[0-9a-zA-Z_-]` is not working as expected. Let me analyze the issue:

The regex `[0-9a-zA-Z_-][0-9a-zA-Z_.-]*|[0-9a-zA-Z_-]` has two alternatives:
1. `[0-9a-zA-Z_-][0-9a-zA-Z_.-]*` - Matches a character from `[0-9a-zA-Z_-]` followed by zero or more characters from `[0-9a-zA-Z_.-]`.
2. `[0-9a-zA-Z_-]` - Matches a single character from `[0-9a-zA-Z_-]`.

The issue is that the first alternative `[0-9a-zA-Z_-][0-9a-zA-Z_.-]*` allows names that end with a dot. For example, "name." would match:
- `[0-9a-zA-Z_-]` matches "n".
- `[0-9a-zA-Z_.-]*` matches "ame.".

So the regex is not correct. I need to fix it to not allow names that end with a dot.

Let me think about this more carefully. The correct regex should be:
- For single character names: `[0-9a-zA-Z_-]` (no dot)
- For multi-character names: The first character must be `[0-9a-zA-Z_-]` (no dot), the last character must be `[0-9a-zA-Z_-]` (no dot), and the middle characters can be `[0-9a-zA-Z_.-]`.

So the regex should be:
`[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?`

Wait, I think I had this right before. Let me re-analyze:
- `[0-9a-zA-Z_-]` - Matches the first character (no dot).
- `([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` - Optionally matches zero or more characters from `[0-9a-zA-Z_.-]` followed by a character from `[0-9a-zA-Z_-]` (no dot at the end).

For "name.":
- `[0-9a-zA-Z_-]` matches "n".
- `([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` tries to match "ame.".
  - `[0-9a-zA-Z_.-]*` matches "ame".
  - `[0-9a-zA-Z_-]` needs to match ".", but "." is not in `[0-9a-zA-Z_-]`.
  - So the optional group doesn't match.
- Without the optional group, the regex only matches "n", but the input is "name.", so the regex doesn't match the entire string.

Wait, but the test is failing, which means the regex is matching "name." when it shouldn't. Let me check the regex again.

Oh, I see the issue! The regex I used was `[0-9a-zA-Z_-][0-9a-zA-Z_.-]*|[0-9a-zA-Z_-]`, not `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?`.

The regex `[0-9a-zA-Z_-][0-9a-zA-Z_.-]*|[0-9a-zA-Z_-]` has two alternatives:
1. `[0-9a-zA-Z_-][0-9a-zA-Z_.-]*` - Matches a character from `[0-9a-zA-Z_-]` followed by zero or more characters from `[0-9a-zA-Z_.-]`. This allows "name." because:
   - `[0-9a-zA-Z_-]` matches "n".
   - `[0-9a-zA-Z_.-]*` matches "ame.".
2. `[0-9a-zA-Z_-]` - Matches a single character from `[0-9a-zA-Z_-]`.

So the first alternative allows names that end with a dot, which is incorrect.

I need to fix the regex to use `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?` instead of `[0-9a-zA-Z_-][0-9a-zA-Z_.-]*|[0-9a-zA-Z_-]`.

Let me update the code.
</thinking>

I see the issue. The regex I used is incorrect. Let me fix it:
========================================================================================================================
TOOL CALL (find_and_replace_code)
file_path: apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
find: "public class InputValidator {\n  public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE\
  \ = \"Only digits, alphabets and symbol - _ . are allowed and the name cannot start\
  \ or end with .\";\n  public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE\
  \ = \"not allowed to end with .json, .yml, .yaml, .xml, .properties\";\n  public\
  \ static final String CLUSTER_NAMESPACE_VALIDATOR = \"[0-9a-zA-Z_-][0-9a-zA-Z_.-]*|[0-9a-zA-Z_-]\"\
  ;\n  private static final String APP_NAMESPACE_VALIDATOR = \"[a-zA-Z0-9_-]([a-zA-Z0-9._-]*[a-zA-Z0-9_-])?(?<!\\\
  \\.(json|yml|yaml|xml|properties))$|[a-zA-Z0-9_-]\";\n  private static final Pattern\
  \ CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);\n  private\
  \ static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);"
replace: "public class InputValidator {\n  public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE\
  \ = \"Only digits, alphabets and symbol - _ . are allowed and the name cannot start\
  \ or end with .\";\n  public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE\
  \ = \"not allowed to end with .json, .yml, .yaml, .xml, .properties\";\n  public\
  \ static final String CLUSTER_NAMESPACE_VALIDATOR = \"[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?\"\
  ;\n  private static final String APP_NAMESPACE_VALIDATOR = \"(?![.])(?!.*[.]$)[a-zA-Z0-9._-]+(?<!\\\
  \\.(json|yml|yaml|xml|properties))$\";\n  private static final Pattern CLUSTER_NAMESPACE_PATTERN\
  \ = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);\n  private static final Pattern\
  \ APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);"

========================================================================================================================
TOOL RETURN (find_and_replace_code)
```
Successfully replaced code in apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java:

--- apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
+++ apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
@@ -26,8 +26,8 @@
 public class InputValidator {
   public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbol - _ . are allowed and the name cannot start or...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-common -Dtest=InputValidatorTest
  -q 2>&1 | tail -50
timeout: 120

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning....
```
========================================================================================================================
AGENT:
The tests pass now. Let me verify by running the tests again with more verbose output:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-common -Dtest=InputValidatorTest
  2>&1 | tail -30
timeout: 120

========================================================================================================================
TOOL RETURN (bash)
```
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-common:jar:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mmaven-compiler-plugin:3.10.1:compile[m [1m(default-compile)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mmaven-resources-plugin:2.6:testResources[m [1m(default-testResources)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINF...
```
========================================================================================================================
AGENT:
All tests pass. Now let me verify the fix by writing a simple test to confirm the behavior:
========================================================================================================================
TOOL CALL (bash)
command: "cd /workspace && cat > /tmp/TestValidator.java << 'EOF'\nimport java.util.regex.Pattern;\n\
  \npublic class TestValidator {\n    public static final String CLUSTER_NAMESPACE_VALIDATOR\
  \ = \"[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?\";\n    private static final\
  \ String APP_NAMESPACE_VALIDATOR = \"(?![.])(?!.*[.]$)[a-zA-Z0-9._-]+(?<!\\\\.(json|yml|yaml|xml|properties))$\"\
  ;\n    private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);\n\
  \    private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);\n\
  \n    public static boolean isValidClusterNamespace(String name) {\n        if (name\
  \ == null || name.isEmpty()) {\n            return false;\n        }\n        return\
  \ CLUSTER_NAMESPACE_PATTERN.matcher(name).matches();\n    }\n\n    public static\
  \ boolean isValidAppNamespace(String name) {\n        if (name == null || name.isEmpty())\
  \ {\n            return false;\n        }\n        return APP_NAMESPACE_PATTERN.matcher(name).matches();\n\
  \    }\n\n    public static void main(String[] args) {\n        // Test cases for\
  \ cluster namespace\n        System.out.println(\"Testing CLUSTER_NAMESPACE_VALIDATOR:\"\
  );\n        testCluster(\".\", false);\n        testCluster(\"..\", false);\n  \
  \      testCluster(\"...\", false);\n        testCluster(\".name\", false);\n  \
  \      testCluster(\"name.\", false);\n        testCluster(\".name.\", false);\n\
  \        testCluster(\"a\", true);\n        testCluster(\"1\", true);\n        testCluster(\"\
  _\", true);\n        testCluster(\"-\", true);\n        testCluster(\"some.cluster-_name.123\"\
  , true);\n        testCluster(\"some.cluster-_name.123.yml\", true);\n        \n\
  \        // Test cases for app namespace\n        System.out.println(\"\\nTesting\
  \ APP_NAMESPACE_VALIDATOR:\");\n        testApp(\".\", false);\n        testApp(\"\
  ..\", false);\n        testApp(\"...\", false);\n        testApp(\".name\", false);\n\
  \        testApp(\"name.\", false);\n        testApp(\".name.\", false);\n     \
  \   testApp(\"a\", true);\n        testApp(\"1\", true);\n        testApp(\"_\"\
  , true);\n        testApp(\"-\", true);\n        testApp(\"some.cluster-_name.123\"\
  , true);\n        testApp(\"some.name.json\", false);\n        testApp(\"some.name.yml\"\
  , false);\n        testApp(\"some.name.yaml\", false);\n        testApp(\"some.name.xml\"\
  , false);\n        testApp(\"some.name.properties\", false);\n    }\n\n    private\
  \ static void testCluster(String name, boolean expected) {\n        boolean result\
  \ = isValidClusterNamespace(name);\n        String status = result == expected ?\
  \ \"PASS\" : \"FAIL\";\n        System.out.println(status + \": \\\"\" + name +\
  \ \"\\\" -> \" + result + \" (expected: \" + expected + \")\");\n    }\n\n    private\
  \ static void testApp(String name, boolean expected) {\n        boolean result =\
  \ isValidAppNamespace(name);\n        String status = result == expected ? \"PASS\"\
  \ : \"FAIL\";\n        System.out.println(status + \": \\\"\" + name + \"\\\" ->\
  \ \" + result + \" (expected: \" + expected + \")\");\n    }\n}\nEOF\njavac /tmp/TestValidator.java\
  \ && java -cp /tmp TestValidator"
timeout: 30

========================================================================================================================
TOOL RETURN (bash)
```
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
OpenJDK 64-Bit Server VM warning: Unable to get SVE vector length on this system. Disabling SVE. Specify -XX:UseSVE=0 to shun this warning.
Testing CLUSTER_NAMESPACE_VALIDATOR:
PASS: "." -> false (expected: false)
PASS: ".." -> false (expected: false)
PASS: "..." -> false (expected: false)
PASS: ".name" -> false (expected: false)
PASS: "name." -> false (expe...
```
========================================================================================================================
AGENT:
All test cases pass. Now let me run the related tests to make sure the changes don't break anything:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-common -q 2>&1 | tail -30
timeout: 180

========================================================================================================================
TOOL RETURN (bash)
```
13:56:37.605 [main] DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory - Creating shared instance of singleton bean 'com.ctrip.framework.apollo.common.conditional.ConditionalOnProfileTest$TestConfiguration$YetAnotherConfiguration'
13:56:37.608 [main] DEBUG org.springframework.beans.factory.support.DefaultListableBeanFactory - Creating shared instance of singleton bean 'com.ctrip.framework.apollo.common.conditional.ConditionalOnProfileTest$TestConfiguration$SomeConfigurati...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-common -q 2>&1 | grep -E "(Tests
  run|FAILURE|ERROR|BUILD)"
timeout: 180

========================================================================================================================
TOOL RETURN (bash)
```
...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-common 2>&1 | grep -E "(Tests run|FAILURE|ERROR|BUILD
  SUCCESS|BUILD FAILURE)"
timeout: 180

========================================================================================================================
TOOL RETURN (bash)
```
[[1;34mINFO[m] [1;32mTests run: [0;1;32m1[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.315 s - in com.ctrip.framework.apollo.common.conditional.[1mConditionalOnProfileTest[m
[[1;34mINFO[m] [1;32mTests run: [0;1;32m14[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.006 s - in com.ctrip.framework.apollo.common.utils.[1mBeanUtilsTest[m
[[1;34mINFO[m] [1;32mTests run: [0;1;32m1[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.035 s - in com.ctrip.framework.a...
```
========================================================================================================================
AGENT:
All tests in the apollo-common module pass. Now let me run the tests in other modules that use the `InputValidator` class to make sure the changes don't break anything:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-adminservice -Dtest=NamespaceControllerTest,AppControllerTest,ClusterControllerTest
  2>&1 | grep -E "(Tests run|FAILURE|ERROR|BUILD SUCCESS|BUILD FAILURE)"
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
[ERROR] com.ctrip.framework.apollo.common.controller.GlobalDefaultExceptionHandler - Invalid Namespace format: Only digits, alphabets and symbol - _ . are allowed and the name cannot start or end with .
[[1;34mINFO[m] [1;32mTests run: [0;1;32m1[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 7.486 s - in com.ctrip.framework.apollo.adminservice.controller.[1mNamespaceControllerTest[m
[ERROR] com.ctrip.framework.apollo.common.controller.GlobalDefaultExceptionHandler - app not found for...
```
========================================================================================================================
AGENT:
All tests pass. Now let me run the portal tests:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-portal -Dtest=NamespaceControllerTest,NamespaceControllerWithAuthorizationTest
  2>&1 | grep -E "(Tests run|FAILURE|ERROR|BUILD SUCCESS|BUILD FAILURE)" | head -20
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
[ERROR] com.ctrip.framework.apollo.portal.component.AdminServiceAddressLocator - Get admin server address from meta server failed. env: LOCAL, meta server address:http://localhost:8080
[ERROR] com.ctrip.framework.apollo.portal.component.AdminServiceAddressLocator - Get admin server address from meta server failed. env: LOCAL, meta server address:http://localhost:8080
[ERROR] com.ctrip.framework.apollo.portal.component.AdminServiceAddressLocator - Get admin server address from meta server failed....
```
========================================================================================================================
AGENT:
All tests pass. Let me also verify the updated code by looking at the final state of the InputValidator class:
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agreed t...
```
========================================================================================================================
AGENT:
Now let me also check the test file:
========================================================================================================================
TOOL CALL (open_files)
file_paths:
- apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java

========================================================================================================================
TOOL RETURN (open_files)
```
['Successfully opened apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java:\n\n````java\n   0 /*\n   1  * Copyright 2022 Apollo Authors\n   2  *\n   3  * Licensed under the Apache License, Version 2.0 (the "License");\n   4  * you may not use this file except in compliance with the License.\n   5  * You may obtain a copy of the License at\n   6  *\n   7  * http://www.apache.org/licenses/LICENSE-2.0\n   8  *\n   9  * Unless required by applicable law or agre...
```
========================================================================================================================
AGENT:
STEP 15: REVIEW CHANGES

<thinking>
Let me review the changes I made:

1. Updated `CLUSTER_NAMESPACE_VALIDATOR` from `[0-9a-zA-Z_.-]+` to `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?`
   - This regex ensures that:
     - Single character names must be from `[0-9a-zA-Z_-]` (no dot)
     - Multi-character names must start and end with `[0-9a-zA-Z_-]` (no dot at start or end)
     - Middle characters can be from `[0-9a-zA-Z_.-]` (dots allowed in the middle)

2. Updated `APP_NAMESPACE_VALIDATOR` from `[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$` to `(?![.])(?!.*[.]$)[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$`
   - Added `(?![.])` - Negative lookahead to ensure the string doesn't start with a dot
   - Added `(?!.*[.]$)` - Negative lookahead to ensure the string doesn't end with a dot
   - The rest of the regex remains the same

3. Updated `INVALID_CLUSTER_NAMESPACE_MESSAGE` to include the new restriction about not starting or ending with a dot.

4. Added test cases to verify the new validation logic.

The changes ensure that namespace names like ".", "..", "...", ".name", "name.", and ".name." are now rejected, which prevents the 500 error when querying namespaces with such names.

Let me also check if there are any other places where the `CLUSTER_NAMESPACE_VALIDATOR` is used as a regex pattern in annotations, to make sure the new regex is compatible.
</thinking>
========================================================================================================================
TOOL CALL (grep)
content_pattern: CLUSTER_NAMESPACE_VALIDATOR
path_glob: '**/*.java'

========================================================================================================================
TOOL RETURN (grep)
```
apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java:29:  public static final String CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?";
apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java:31:  private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);
apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java:40:      regexp = I...
```
========================================================================================================================
AGENT:
The `CLUSTER_NAMESPACE_VALIDATOR` is used in several places as a regex pattern in `@Pattern` annotations. Let me verify that the new regex works correctly with these annotations by running the related tests:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-adminservice -Dtest=AppControllerTest,ClusterControllerTest,NamespaceControllerTest
  2>&1 | grep -E "(Tests run|FAILURE|ERROR|BUILD SUCCESS|BUILD FAILURE)" | head -10
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
[ERROR] com.ctrip.framework.apollo.common.controller.GlobalDefaultExceptionHandler - Invalid Namespace format: Only digits, alphabets and symbol - _ . are allowed and the name cannot start or end with .
[[1;34mINFO[m] [1;32mTests run: [0;1;32m1[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 5.177 s - in com.ctrip.framework.apollo.adminservice.controller.[1mNamespaceControllerTest[m
[ERROR] com.ctrip.framework.apollo.common.controller.GlobalDefaultExceptionHandler - app not found for...
```
========================================================================================================================
AGENT:
All tests pass. Let me also run a broader set of tests to ensure the changes don't break anything:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-adminservice 2>&1 | grep -E "(Tests
  run|FAILURE|ERROR|BUILD SUCCESS|BUILD FAILURE)" | tail -5
timeout: 600

========================================================================================================================
TOOL RETURN (bash)
```
[ERROR] com.netflix.discovery.DiscoveryClient - DiscoveryClient_APOLLO-ADMINSERVICE/fc8446f8d8cb:apollo-adminservice:0 - de-registration failedCannot execute request on any known server
[[1;34mINFO[m] [1;32mTests run: [0;1;32m6[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.115 s - in com.ctrip.framework.apollo.adminservice.filter.[1mAdminServiceAuthenticationIntegrationTest[m
[[1;34mINFO[m] [1;32mTests run: [0;1;32m8[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.025...
```
========================================================================================================================
AGENT:
All tests in the apollo-adminservice module pass. Let me also run the openapi tests in the portal module:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-portal -Dtest="*NamespaceController*"
  2>&1 | grep -E "(Tests run|FAILURE|ERROR|BUILD SUCCESS|BUILD FAILURE)" | tail -5
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
[ERROR] com.ctrip.framework.apollo.common.controller.GlobalDefaultExceptionHandler - Access is denied
[ERROR] com.ctrip.framework.apollo.common.controller.GlobalDefaultExceptionHandler - Access is denied
[ERROR] com.ctrip.framework.apollo.common.controller.GlobalDefaultExceptionHandler - Invalid Namespace format: Only digits, alphabets and symbol - _ . are allowed and the name cannot start or end with . & not allowed to end with .json, .yml, .yaml, .xml, .properties
[[1;33mWARNING[m] [1;33mTe...
```
========================================================================================================================
AGENT:
All tests pass. Let me now summarize the changes I made:
========================================================================================================================
AGENT:
Verifying the fix by reviewing the changes and running additional tests to ensure the fix is complete and doesn't break any existing functionality.
========================================================================================================================
AGENT:
Let me run a few more tests to ensure the fix is complete:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && ./mvnw test -pl apollo-biz -Dtest="*Namespace*" 2>&1 | grep
  -E "(Tests run|FAILURE|ERROR|BUILD SUCCESS|BUILD FAILURE)" | tail -5
timeout: 300

========================================================================================================================
TOOL RETURN (bash)
```
[[1;34mINFO[m] [1;32mTests run: [0;1;32m3[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.044 s - in com.ctrip.framework.apollo.biz.service.[1mNamespacePublishInfoTest[m
[[1;34mINFO[m] [1;32mTests run: [0;1;32m2[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.062 s - in com.ctrip.framework.apollo.biz.service.[1mNamespaceServiceIntegrationTest[m
[ERROR] com.netflix.discovery.DiscoveryClient - DiscoveryClient_UNKNOWN/fc8446f8d8cb:0 - de-registration failedCannot execute...
```
========================================================================================================================
AGENT:
All tests pass. Let me also verify the fix by looking at the final state of the files:
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && git diff --stat
timeout: 30

========================================================================================================================
TOOL RETURN (bash)
```
 .../apollo/common/utils/InputValidator.java        |  6 +++---
 .../apollo/common/utils/InputValidatorTest.java    | 24 ++++++++++++++++++++++
 2 files changed, 27 insertions(+), 3 deletions(-)...
```
========================================================================================================================
TOOL CALL (bash)
command: cd /workspace && git diff
timeout: 30

========================================================================================================================
TOOL RETURN (bash)
```
diff --git a/apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java b/apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
index b5d2e72cb..a289cd757 100644
--- a/apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
+++ b/apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
@@ -24,10 +24,10 @@ import java.util.regex.Pattern;
  * @author Jason Song(song_s@ctrip...
```
========================================================================================================================
AGENT:
The changes look correct. Let me provide a summary of the fix:

## Summary

The issue was that creating a namespace with a single dot (`.`) caused a 500 error when querying the namespace. This was because the input validation regex allowed names that consist only of dots or start/end with dots.

### Root Cause
The original regex patterns in `InputValidator.java`:
- `CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+"` - allowed any combination of digits, letters, underscore, dot, and hyphen, including a single dot.
- `APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$"` - similarly allowed names starting or ending with dots.

### Fix
Updated the regex patterns to not allow names that start or end with a dot:

1. **`CLUSTER_NAMESPACE_VALIDATOR`**: Changed from `[0-9a-zA-Z_.-]+` to `[0-9a-zA-Z_-]([0-9a-zA-Z_.-]*[0-9a-zA-Z_-])?`
   - This ensures single-character names must be from `[0-9a-zA-Z_-]` (no dot)
   - Multi-character names must start and end with `[0-9a-zA-Z_-]` (no dot at start or end)
   - Dots are still allowed in the middle of the name

2. **`APP_NAMESPACE_VALIDATOR`**: Changed from `[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$` to `(?![.])(?!.*[.]$)[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$`
   - Added `(?![.])` - Negative lookahead to ensure the string doesn't start with a dot
   - Added `(?!.*[.]$)` - Negative lookahead to ensure the string doesn't end with a dot

3. **Updated error message**: Changed `INVALID_CLUSTER_NAMESPACE_MESSAGE` to include the new restriction about not starting or ending with a dot.

4. **Added test cases**: Added comprehensive test cases to verify the new validation logic for both cluster namespace and app namespace names.
========================================================================================================================
AGENT:
Fixed the issue where creating a namespace with a single dot (.) caused a 500 error when querying the namespace. The fix updates the input validation regex patterns in `InputValidator.java` to not allow namespace names that start or end with a dot. This prevents invalid namespace names like ".", "..", "...", ".name", "name.", and ".name." from being created. The fix includes updated regex patterns, an updated error message, and comprehensive test cases to verify the new validation logic. All existing tests pass with the new changes.