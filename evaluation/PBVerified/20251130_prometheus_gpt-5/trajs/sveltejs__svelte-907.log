2025-11-11 00:18:41,090 - thread-133013323122368.prometheus.docker.base_container - INFO - Created temporary project directory: /tmp/tmpz92x_9m9/svelte
2025-11-11 00:18:41,090 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Using workdir: /testbed
2025-11-11 00:18:41,486 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_build: False
2025-11-11 00:18:41,486 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_existing_test: False
2025-11-11 00:18:41,486 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_regression_test: True
2025-11-11 00:18:41,487 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_reproduce_test: True
2025-11-11 00:18:41,487 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State number_of_candidate_patch: 5
2025-11-11 00:18:41,487 - thread-133013323122368.prometheus.lang_graph.nodes.issue_classification_subgraph_node - INFO - Enter IssueClassificationSubgraphNode
2025-11-11 00:18:41,488 - thread-133013323122368.prometheus.lang_graph.nodes.issue_classification_context_message_node - DEBUG - Sending query to context provider:
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

2025-11-11 00:18:41,488 - thread-133013323122368.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-11 00:18:41,489 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:19:06,446 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The file tree alone is insufficient to determine whether removing the async keyword from lifecycle hooks is intentional (design/validation), a generator bug, or a documentation gap. We need to inspect (a) the code that rewrites/wraps the module export and lifecycle hooks, (b) validators for oncreate/ondestroy/onrender/onteardown, (c) tests demonstrating lifecycle hook rewriting behavior, and (d) any documentation mentioning lifecycle hooks and async support.' query='Please provide the full contents (with line numbers) of src/generators/shared/utils/wrapModule.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/propValidators/onrender.ts, src/validate/js/propValidators/ondestroy.ts, src/validate/js/propValidators/onteardown.ts, and test/js/samples/onrender-onteardown-rewritten/{input.html,expected.js,expected-bundle.js}.' extra_requirements='If README.md documents lifecycle hooks or async support, include the relevant section with line numbers; if sending all files is too large, prioritize wrapModule.ts and oncreate.ts plus the test expected.js.' purpose='This context will reveal whether async is intentionally removed during code generation or disallowed by validation, enabling accurate classification of the issue.'
2025-11-11 00:19:06,447 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents (with line numbers) of src/generators/shared/utils/wrapModule.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/propValidators/onrender.ts, src/validate/js/propValidators/ondestroy.ts, src/validate/js/propValidators/onteardown.ts, and test/js/samples/onrender-onteardown-rewritten/{input.html,expected.js,expected-bundle.js}.
2025-11-11 00:19:06,750 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-11 00:19:06,750 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-11 00:19:06,750 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-11 00:19:06,750 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-11 00:19:06,751 - thread-133013323122368.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-11 00:19:06,752 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-11 00:19:06,752 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents (with line numbers) of src/generators/shared/utils/wrapModule.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/propValidators/onrender.ts, src/validate/js/propValidators/ondestroy.ts, src/validate/js/propValidators/onteardown.ts, and test/js/samples/onrender-onteardown-rewritten/{input.html,expected.js,expected-bundle.js}.
Extra requirements: If README.md documents lifecycle hooks or async support, include the relevant section with line numbers; if sending all files is too large, prioritize wrapModule.ts and oncreate.ts plus the test expected.js.
Purpose: This context will reveal whether async is intentionally removed during code generation or disallowed by validation, enabling accurate classification of the issue.
2025-11-11 00:19:13,648 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ULVEx0fartjphJfmbIQQ94g0', 'function': {'arguments': '{"relative_path":"src/generators/shared/utils/wrapModule.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 615, 'prompt_tokens': 2264, 'total_tokens': 2879, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c5522b48-49c2-4cdb-8625-2083dd5f73a9-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/shared/utils/wrapModule.ts'}, 'id': 'call_ULVEx0fartjphJfmbIQQ94g0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2264, 'output_tokens': 615, 'total_tokens': 2879, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-11 00:19:14,979 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_PLq8CWQK3qF2rMPe8P2Dypxl', 'function': {'arguments': '{"relative_path":"src/validate/js/propValidators/oncreate.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 5686, 'total_tokens': 5719, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bb5f0ba0-cf26-466a-8d48-41f4c202dd0b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/validate/js/propValidators/oncreate.ts'}, 'id': 'call_PLq8CWQK3qF2rMPe8P2Dypxl', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5686, 'output_tokens': 33, 'total_tokens': 5719, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:16,221 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_x9qYBmeT1FDMzEPcVpVSIuqd', 'function': {'arguments': '{"relative_path":"src/validate/js/propValidators/onrender.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 5962, 'total_tokens': 5994, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--27897503-461f-4575-9a5e-2ce8eb99fd4d-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/validate/js/propValidators/onrender.ts'}, 'id': 'call_x9qYBmeT1FDMzEPcVpVSIuqd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5962, 'output_tokens': 32, 'total_tokens': 5994, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:17,343 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3ICQhh7hB42j9iAGnqFFkOcK', 'function': {'arguments': '{"relative_path":"src/validate/js/propValidators/onrender.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 6048, 'total_tokens': 6081, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--96acb244-e98d-47e9-9182-911ad890fd67-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/validate/js/propValidators/onrender.ts'}, 'id': 'call_3ICQhh7hB42j9iAGnqFFkOcK', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6048, 'output_tokens': 33, 'total_tokens': 6081, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:18,508 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_wdVJfB9UZ6lF3iuMT7xTfGuq', 'function': {'arguments': '{"relative_path":"src/validate/js/propValidators/ondestroy.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 6284, 'total_tokens': 6318, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6016}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ad2f71af-643e-49fb-9b77-2d0342ca78e2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/validate/js/propValidators/ondestroy.ts'}, 'id': 'call_wdVJfB9UZ6lF3iuMT7xTfGuq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6284, 'output_tokens': 34, 'total_tokens': 6318, 'input_token_details': {'audio': 0, 'cache_read': 6016}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:20,476 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OrMZgNWKrjC1XwcrjISkq7cs', 'function': {'arguments': '{"relative_path":"src/validate/js/propValidators/onteardown.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 6562, 'total_tokens': 6596, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3aa16ca7-673a-476b-87ff-fb929a48ae79-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/validate/js/propValidators/onteardown.ts'}, 'id': 'call_OrMZgNWKrjC1XwcrjISkq7cs', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6562, 'output_tokens': 34, 'total_tokens': 6596, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:22,166 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_yqM00s3nBtTvdR869s31G8WU', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/input.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 35, 'prompt_tokens': 6801, 'total_tokens': 6836, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--11c80a54-89a1-4b1a-8661-ca6512bd455c-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/input.html'}, 'id': 'call_yqM00s3nBtTvdR869s31G8WU', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6801, 'output_tokens': 35, 'total_tokens': 6836, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:23,296 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_YOhxNgODHeaNnUrZVQjnOcgb', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/input.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 6892, 'total_tokens': 6928, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4f3f90ee-337f-4fad-b4ac-cf687f20e5d9-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/input.html'}, 'id': 'call_YOhxNgODHeaNnUrZVQjnOcgb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6892, 'output_tokens': 36, 'total_tokens': 6928, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:24,635 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_QjUrBGHZcLOiejVOc2Q0f9Eu', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/expected.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 7068, 'total_tokens': 7104, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--54c249c8-1588-47f9-9c2a-27730d644d98-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected.js'}, 'id': 'call_QjUrBGHZcLOiejVOc2Q0f9Eu', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7068, 'output_tokens': 36, 'total_tokens': 7104, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:25,677 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_7TDivB1iUBwHa8gI5tWLK863', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/expected.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 7161, 'total_tokens': 7198, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--131bbc22-86c8-4470-b54c-20170e15b80a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected.js'}, 'id': 'call_7TDivB1iUBwHa8gI5tWLK863', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7161, 'output_tokens': 37, 'total_tokens': 7198, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:26,982 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OY3BrT4QZUJNy5MN0XaicqPj', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/expected-bundle.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 7699, 'total_tokens': 7737, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3231e646-e303-49d4-b0fa-d2e1bf0a05de-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected-bundle.js'}, 'id': 'call_OY3BrT4QZUJNy5MN0XaicqPj', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7699, 'output_tokens': 38, 'total_tokens': 7737, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:28,491 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_tGljJUBKmQPZ43DPcfl8VZZK', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/expected-bundle.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 7798, 'total_tokens': 7837, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 7680}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--137af506-7710-43f8-b1ff-8fb316630f1f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected-bundle.js'}, 'id': 'call_tGljJUBKmQPZ43DPcfl8VZZK', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7798, 'output_tokens': 39, 'total_tokens': 7837, 'input_token_details': {'audio': 0, 'cache_read': 7680}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:33,796 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_AsVxud6AufsLYgJHCDhQE2ed', 'function': {'arguments': '{"basename":"README.md"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 605, 'prompt_tokens': 10041, 'total_tokens': 10646, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6272}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f7aa5079-1b78-4f2f-9035-9877672c716c-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'README.md'}, 'id': 'call_AsVxud6AufsLYgJHCDhQE2ed', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10041, 'output_tokens': 605, 'total_tokens': 10646, 'input_token_details': {'audio': 0, 'cache_read': 6272}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-11 00:19:35,162 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hPD5qPtpUJlYTStDRqkznPH7', 'function': {'arguments': '{"relative_path":"README.md"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 10144, 'total_tokens': 10169, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--fa8c1acd-03bf-4c84-a1cf-ca7ead49d178-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'README.md'}, 'id': 'call_hPD5qPtpUJlYTStDRqkznPH7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10144, 'output_tokens': 25, 'total_tokens': 10169, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:19:47,081 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I fetched the full, line-numbered contents of all requested files: src/generators/shared/utils/wrapModule.ts; src/validate/js/propValidators/{oncreate.ts,onrender.ts,ondestroy.ts,onteardown.ts}; and test/js/samples/onrender-onteardown-rewritten/{input.html,expected.js,expected-bundle.js}. I also opened the top-level README.md to check for lifecycle hooks or async support documentation. The README does not contain sections about lifecycle hooks or async support, so there was nothing relevant to include. This should provide the context needed to see whether async is filtered by code generation or disallowed during validation.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 846, 'prompt_tokens': 12307, 'total_tokens': 13153, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--c20023c0-e5c3-42f1-be51-249d586a76ae-0' usage_metadata={'input_tokens': 12307, 'output_tokens': 846, 'total_tokens': 13153, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-11 00:19:47,085 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents (with line numbers) of src/generators/shared/utils/wrapModule.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/propValidators/onrender.ts, src/validate/js/propValidators/ondestroy.ts, src/validate/js/propValidators/onteardown.ts, and test/js/samples/onrender-onteardown-rewritten/{input.html,expected.js,expected-bundle.js}.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If README.md documents lifecycle hooks or async support, include the relevant section with line numbers; if sending all files is too large, prioritize wrapModule.ts and oncreate.ts plus the test expected.js.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
This context will reveal whether async is intentionally removed during code generation or disallowed by validation, enabling accurate classification of the issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: README.md
Line number range: 1 - 101
Content:
1. # Svelte
2. 
3. The magical disappearing UI framework.
4. 
5. * [Read the introductory blog post](https://svelte.technology/blog/frameworks-without-the-framework/)
6. * [Read the guide](https://svelte.technology/guide)
7. * [Try it out](https://svelte.technology/repl)
8. * [Chat on Gitter](https://gitter.im/sveltejs/svelte)
9. 
10. ---
11. 
12. This is the Svelte compiler, which is primarily intended for authors of tooling that integrates Svelte with different build systems. If you just want to write Svelte components and use them in your app, you probably want one of those tools:
13. 
14. * [svelte-cli](https://github.com/sveltejs/svelte-cli) – Command line interface for compiling components
15. * [rollup-plugin-svelte](https://github.com/rollup/rollup-plugin-svelte) – Rollup plugin
16. * [sveltify](https://github.com/tehshrike/sveltify) - Browserify transform
17. * [gulp-svelte](https://github.com/shinnn/gulp-svelte) - gulp plugin
18. * [metalsmith-svelte](https://github.com/shinnn/metalsmith-svelte) - Metalsmith plugin
19. * [system-svelte](https://github.com/CanopyTax/system-svelte) – System.js loader
20. * [svelte-loader](https://github.com/sveltejs/svelte-loader) – Webpack loader
21. * [meteor-svelte](https://github.com/klaussner/meteor-svelte) – Meteor build plugin
22. * More to come!
23. 
24. 
25. ## Example usage
26. 
27. ```js
28. import * as svelte from 'svelte';
29. 
30. const { code, map } = svelte.compile( source, {
31. 	// the target module format – defaults to 'es' (ES2015 modules), can
32. 	// also be 'amd', 'cjs', 'umd', 'iife' or 'eval'
33. 	format: 'umd',
34. 
35. 	// the filename of the source file, used in e.g. generating sourcemaps
36. 	filename: 'MyComponent.html',
37. 
38. 	// the name of the constructor. Required for 'iife' and 'umd' output,
39. 	// but otherwise mostly useful for debugging. Defaults to 'SvelteComponent'
40. 	name: 'MyComponent',
41. 
42. 	// for 'amd' and 'umd' output, you can optionally specify an AMD module ID
43. 	amd: {
44. 		id: 'my-component'
45. 	},
46. 
47. 	// custom error/warning handlers. By default, errors will throw, and
48. 	// warnings will be printed to the console. Where applicable, the
49. 	// error/warning object will have `pos`, `loc` and `frame` properties
50. 	onerror: err => {
51. 		console.error( err.message );
52. 	},
53. 
54. 	onwarn: warning => {
55. 		console.warn( warning.message );
56. 	}
57. });
58. ```
59. 
60. 
61. ## API
62. 
63. The Svelte compiler exposes the following API:
64. 
65. * `compile( source [, options ] ) => { code, map, ast, css }` - Compile the component with the given options (see below). Returns an object containing the compiled JavaScript, a sourcemap, an AST and transformed CSS.
66. * `create( source [, options ] ) => function` - Compile the component and return the component itself.
67. * `VERSION` - The version of this copy of the Svelte compiler as a string, `'x.x.x'`.
68. 
69. ### Options
70. 
71. The Svelte compiler optionally takes a second argument, an object of configuration options:
72. 
73. | | **Values** | **Description** | **Defaults** |
74. |---|---|---|---|
75. | `format` | `'es'`, `'amd'`, `'cjs'`, `'umd'`, `'iife'`, `'eval'` | The format to output in the compiled component.<br>`'es'` - ES6/ES2015 module, suitable for consumption by a bundler<br>`'amd'` - AMD module<br>`'cjs'` - CommonJS module<br>`'iife'` - IIFE-wrapped function defining a global variable, suitable for use directly in browser<br>`'eval'` - standalone function, suitable for passing to `eval()` | `'es'` for `generate: 'dom'`<br>`'cjs'` for `generate: 'ssr'` |
76. | `generate` | `'dom'`, `'ssr'` | Whether to generate JavaScript code intended for use on the client (`'dom'`), or for use in server-side rendering (`'ssr'`). | `'dom'` |
77. | `name` | `string` | The name of the constructor in the compiled component. | `'SvelteComponent'` |
78. | `filename` | `string` | The filename to use in sourcemaps and compiler error and warning messages. | `'SvelteComponent.html'` |
79. | `amd`.`id` | `string` | The AMD module ID to use for the `'amd'` and `'umd'` output formats. | `undefined` |
80. | `cascade` | `true`, `false` | Whether to cascade all of the component's styles to child components. If `false`, only selectors wrapped in `:global(...)` and keyframe IDs beginning with `-global-` are cascaded. | `true` |
81. | `shared` | `true`, `false`, `string` | Whether to import various helpers from a shared external library. When you have a project with multiple components, this reduces the overall size of your JavaScript bundle, at the expense of having immediately-usable component. You can pass a string of the module path to use, or `true` will import from `'svelte/shared.js'`. | `false` |
82. | `dev` | `true`, `false` | Whether to enable run-time checks in the compiled component. These are helpful during development, but slow your component down. | `false` |
83. | `css` | `true`, `false` | Whether to include code to inject your component's styles into the DOM. | `true` |
84. | `globals` | `object`, `function` | When outputting to the `'umd'`, `'iife'` or `'eval'` formats, an object or function mapping the names of imported dependencies to the names of global variables. | `{}` |
85. | `legacy` | `boolean` | Ensures compatibility with very old browsers, at the cost of some extra code |
86. | `onerror` | `function` | Specify a callback for when Svelte encounters an error while compiling the component. Passed two arguments: the error object, and another function that is Svelte's default onerror handling. | (exception is thrown) |
87. | `onwarn` | `function` | Specify a callback for when Svelte encounters a non-fatal warning while compiling the component. Passed two arguments: the warning object, and another function that is Svelte's default onwarn handling. | (warning is logged to console) |
88. 
89. ## Example/starter repos
90. 
91. * [charpeni/svelte-example](https://github.com/charpeni/svelte-example) - Some Svelte examples with configured Rollup, Babel, ESLint, directives, Two-Way binding, and nested components
92. * [EmilTholin/svelte-test](https://github.com/EmilTholin/svelte-test)
93. * [lukechinworth/codenames](https://github.com/lukechinworth/codenames/tree/svelte) – example integration with Redux
94. 
95. ## BrowserStack
96. <img src="https://cdn.worldvectorlogo.com/logos/browserstack.svg" height="80" width="80" align="left">
97. <p>To keep Svelte's performance in check, we use BrowserStack to quickly run benchmarks for each PR that immediately give feedback to the contributor. You can see how we use BrowserStack in the <a href="https://github.com/sveltejs/svelte-bench">svelte-bench</a> project and check out BrowserStack's services on their <a href="https://www.browserstack.com/">website</a>.</p>
98. 
99. ## License
100. 
101. [MIT](LICENSE)


File: src/generators/shared/utils/wrapModule.ts
Line number range: 1 - 298
Content:
1. import deindent from '../../../utils/deindent';
2. import { CompileOptions, ModuleFormat, Node } from '../../../interfaces';
3. 
4. interface Dependency {
5. 	name: string;
6. 	statements: string[];
7. 	source: string;
8. }
9. 
10. const wrappers = { es, amd, cjs, iife, umd, eval: expr };
11. 
12. export default function wrapModule(
13. 	code: string,
14. 	format: ModuleFormat,
15. 	name: string,
16. 	options: CompileOptions,
17. 	banner: string,
18. 	sharedPath: string,
19. 	helpers: { name: string, alias: string }[],
20. 	imports: Node[],
21. 	source: string
22. ): string {
23. 	if (format === 'es') return es(code, name, options, banner, sharedPath, helpers, imports, source);
24. 
25. 	const dependencies = imports.map((declaration, i) => {
26. 		const defaultImport = declaration.specifiers.find(
27. 			(x: Node) =>
28. 				x.type === 'ImportDefaultSpecifier' ||
29. 				(x.type === 'ImportSpecifier' && x.imported.name === 'default')
30. 		);
31. 
32. 		const namespaceImport = declaration.specifiers.find(
33. 			(x: Node) => x.type === 'ImportNamespaceSpecifier'
34. 		);
35. 
36. 		const namedImports = declaration.specifiers.filter(
37. 			(x: Node) =>
38. 				x.type === 'ImportSpecifier' && x.imported.name !== 'default'
39. 		);
40. 
41. 		const name = defaultImport || namespaceImport
42. 			? (defaultImport || namespaceImport).local.name
43. 			: `__import${i}`;
44. 
45. 		const statements: string[] = [];
46. 
47. 		namedImports.forEach((specifier: Node) => {
48. 			statements.push(
49. 				`var ${specifier.local.name} = ${name}.${specifier.imported.name};`
50. 			);
51. 		});
52. 
53. 		if (defaultImport) {
54. 			statements.push(
55. 				`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`
56. 			);
57. 		}
58. 
59. 		return { name, statements, source: declaration.source.value };
60. 	});
61. 
62. 	if (format === 'amd') return amd(code, name, options, banner, dependencies);
63. 	if (format === 'cjs') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);
64. 	if (format === 'iife') return iife(code, name, options, banner, dependencies);
65. 	if (format === 'umd') return umd(code, name, options, banner, dependencies);
66. 	if (format === 'eval') return expr(code, name, options, banner, dependencies);
67. 
68. 	throw new Error(`Not implemented: ${format}`);
69. }
70. 
71. function es(
72. 	code: string,
73. 	name: string,
74. 	options: CompileOptions,
75. 	banner: string,
76. 	sharedPath: string,
77. 	helpers: { name: string, alias: string }[],
78. 	imports: Node[],
79. 	source: string
80. ) {
81. 	const importHelpers = helpers && (
82. 		`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(', ')} } from ${JSON.stringify(sharedPath)};`
83. 	);
84. 
85. 	const importBlock = imports.length > 0 && (
86. 		imports
87. 			.map((declaration: Node) => source.slice(declaration.start, declaration.end))
88. 			.join('\n')
89. 	);
90. 
91. 	return deindent`
92. 		${banner}
93. 		${importHelpers}
94. 		${importBlock}
95. 
96. 		${code}
97. 		export default ${name};`;
98. }
99. 
100. function amd(
101. 	code: string,
102. 	name: string,
103. 	options: CompileOptions,
104. 	banner: string,
105. 	dependencies: Dependency[]
106. ) {
107. 	const sourceString = dependencies.length
108. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
109. 		: '';
110. 
111. 	const id = options.amd && options.amd.id;
112. 
113. 	return deindent`
114. 		define(${id ? `"${id}", ` : ''}${sourceString}function(${paramString(dependencies)}) { "use strict";
115. 			${getCompatibilityStatements(dependencies)}
116. 
117. 			${code}
118. 			return ${name};
119. 		});`;
120. }
121. 
122. function cjs(
123. 	code: string,
124. 	name: string,
125. 	options: CompileOptions,
126. 	banner: string,
127. 	sharedPath: string,
128. 	helpers: { name: string, alias: string }[],
129. 	dependencies: Dependency[]
130. ) {
131. 	const SHARED = '__shared';
132. 	const helperBlock = helpers && (
133. 		`var ${SHARED} = require(${JSON.stringify(sharedPath)});\n` +
134. 		helpers.map(helper => {
135. 			return `var ${helper.alias} = ${SHARED}.${helper.name};`;
136. 		}).join('\n')
137. 	);
138. 
139. 	const requireBlock = dependencies.length > 0 && (
140. 		dependencies
141. 			.map(d => `var ${d.name} = require("${d.source}");`)
142. 			.join('\n\n')
143. 	);
144. 
145. 	return deindent`
146. 		${banner}
147. 		"use strict";
148. 
149. 		${helperBlock}
150. 		${requireBlock}
151. 		${getCompatibilityStatements(dependencies)}
152. 
153. 		${code}
154. 
155. 		module.exports = ${name};`
156. }
157. 
158. function iife(
159. 	code: string,
160. 	name: string,
161. 	options: CompileOptions,
162. 	banner: string,
163. 	dependencies: Dependency[]
164. ) {
165. 	if (!options.name) {
166. 		throw new Error(`Missing required 'name' option for IIFE export`);
167. 	}
168. 
169. 	const globals = getGlobals(dependencies, options);
170. 
171. 	return deindent`
172. 		${banner}
173. 		var ${options.name} = (function(${paramString(dependencies)}) { "use strict";
174. 			${getCompatibilityStatements(dependencies)}
175. 
176. 			${code}
177. 			return ${name};
178. 		}(${globals.join(', ')}));`;
179. }
180. 
181. function umd(
182. 	code: string,
183. 	name: string,
184. 	options: CompileOptions,
185. 	banner: string,
186. 	dependencies: Dependency[]
187. ) {
188. 	if (!options.name) {
189. 		throw new Error(`Missing required 'name' option for UMD export`);
190. 	}
191. 
192. 	const amdId = options.amd && options.amd.id ? `'${options.amd.id}', ` : '';
193. 
194. 	const amdDeps = dependencies.length
195. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
196. 		: '';
197. 
198. 	const cjsDeps = dependencies
199. 		.map(d => `require("${d.source}")`)
200. 		.join(', ');
201. 
202. 	const globals = getGlobals(dependencies, options);
203. 
204. 	return deindent`
205. 		${banner}
206. 		(function(global, factory) {
207. 			typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :
208. 			typeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :
209. 			(global.${options.name} = factory(${globals}));
210. 		}(this, (function (${paramString(dependencies)}) { "use strict";
211. 
212. 			${getCompatibilityStatements(dependencies)}
213. 
214. 			${code}
215. 
216. 			return ${name};
217. 
218. 		})));`;
219. }
220. 
221. function expr(
222. 	code: string,
223. 	name: string,
224. 	options: CompileOptions,
225. 	banner: string,
226. 	dependencies: Dependency[]
227. ) {
228. 	const globals = getGlobals(dependencies, options);
229. 
230. 	return deindent`
231. 		(function (${paramString(dependencies)}) { "use strict";
232. 			${banner}
233. 
234. 			${getCompatibilityStatements(dependencies)}
235. 
236. 			${code}
237. 
238. 			return ${name};
239. 		}(${globals.join(', ')}))`;
240. }
241. 
242. function paramString(dependencies: Dependency[]) {
243. 	return dependencies.map(dep => dep.name).join(', ');
244. }
245. 
246. function removeExtension(file: string) {
247. 	const index = file.lastIndexOf('.');
248. 	return ~index ? file.slice(0, index) : file;
249. }
250. 
251. function getCompatibilityStatements(dependencies: Dependency[]) {
252. 	if (!dependencies.length) return null;
253. 
254. 	const statements: string[] = [];
255. 
256. 	dependencies.forEach(dependency => {
257. 		statements.push(...dependency.statements);
258. 	});
259. 
260. 	return statements.join('\n');
261. }
262. 
263. function getGlobals(dependencies: Dependency[], options: CompileOptions) {
264. 	const { globals, onerror, onwarn } = options;
265. 	const globalFn = getGlobalFn(globals);
266. 
267. 	return dependencies.map(d => {
268. 		let name = globalFn(d.source);
269. 
270. 		if (!name) {
271. 			if (d.name.startsWith('__import')) {
272. 				const error = new Error(
273. 					`Could not determine name for imported module '${d.source}' – use options.globals`
274. 				);
275. 				onerror(error);
276. 			} else {
277. 				const warning = {
278. 					message: `No name was supplied for imported module '${d.source}'. Guessing '${d.name}', but you should use options.globals`,
279. 				};
280. 
281. 				onwarn(warning);
282. 			}
283. 
284. 			name = d.name;
285. 		}
286. 
287. 		return name;
288. 	});
289. }
290. 
291. function getGlobalFn(globals: any): (id: string) => string {
292. 	if (typeof globals === 'function') return globals;
293. 	if (typeof globals === 'object') {
294. 		return id => globals[id];
295. 	}
296. 
297. 	return () => undefined;
298. }


File: src/validate/js/propValidators/oncreate.ts
Line number range: 1 - 14
Content:
1. import usesThisOrArguments from '../utils/usesThisOrArguments';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function oncreate(validator: Validator, prop: Node) {
6. 	if (prop.value.type === 'ArrowFunctionExpression') {
7. 		if (usesThisOrArguments(prop.value.body)) {
8. 			validator.error(
9. 				`'oncreate' should be a function expression, not an arrow function expression`,
10. 				prop.start
11. 			);
12. 		}
13. 	}
14. }


File: src/validate/js/propValidators/ondestroy.ts
Line number range: 1 - 14
Content:
1. import usesThisOrArguments from '../utils/usesThisOrArguments';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function ondestroy(validator: Validator, prop: Node) {
6. 	if (prop.value.type === 'ArrowFunctionExpression') {
7. 		if (usesThisOrArguments(prop.value.body)) {
8. 			validator.error(
9. 				`'ondestroy' should be a function expression, not an arrow function expression`,
10. 				prop.start
11. 			);
12. 		}
13. 	}
14. }


File: src/validate/js/propValidators/onrender.ts
Line number range: 1 - 11
Content:
1. import oncreate from './oncreate';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function onrender(validator: Validator, prop: Node) {
6. 	validator.warn(
7. 		`'onrender' has been deprecated in favour of 'oncreate', and will cause an error in Svelte 2.x`,
8. 		prop.start
9. 	);
10. 	oncreate(validator, prop);
11. }


File: src/validate/js/propValidators/onteardown.ts
Line number range: 1 - 11
Content:
1. import ondestroy from './ondestroy';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function onteardown(validator: Validator, prop: Node) {
6. 	validator.warn(
7. 		`'onteardown' has been deprecated in favour of 'ondestroy', and will cause an error in Svelte 2.x`,
8. 		prop.start
9. 	);
10. 	ondestroy(validator, prop);
11. }


File: test/js/samples/onrender-onteardown-rewritten/expected-bundle.js
Line number range: 1 - 214
Content:
1. function noop() {}
2. 
3. function assign(target) {
4. 	var k,
5. 		source,
6. 		i = 1,
7. 		len = arguments.length;
8. 	for (; i < len; i++) {
9. 		source = arguments[i];
10. 		for (k in source) target[k] = source[k];
11. 	}
12. 
13. 	return target;
14. }
15. 
16. function blankObject() {
17. 	return Object.create(null);
18. }
19. 
20. function destroy(detach) {
21. 	this.destroy = noop;
22. 	this.fire('destroy');
23. 	this.set = this.get = noop;
24. 
25. 	if (detach !== false) this._fragment.u();
26. 	this._fragment.d();
27. 	this._fragment = this._state = null;
28. }
29. 
30. function differs(a, b) {
31. 	return a !== b || ((a && typeof a === 'object') || typeof a === 'function');
32. }
33. 
34. function dispatchObservers(component, group, changed, newState, oldState) {
35. 	for (var key in group) {
36. 		if (!changed[key]) continue;
37. 
38. 		var newValue = newState[key];
39. 		var oldValue = oldState[key];
40. 
41. 		var callbacks = group[key];
42. 		if (!callbacks) continue;
43. 
44. 		for (var i = 0; i < callbacks.length; i += 1) {
45. 			var callback = callbacks[i];
46. 			if (callback.__calling) continue;
47. 
48. 			callback.__calling = true;
49. 			callback.call(component, newValue, oldValue);
50. 			callback.__calling = false;
51. 		}
52. 	}
53. }
54. 
55. function fire(eventName, data) {
56. 	var handlers =
57. 		eventName in this._handlers && this._handlers[eventName].slice();
58. 	if (!handlers) return;
59. 
60. 	for (var i = 0; i < handlers.length; i += 1) {
61. 		handlers[i].call(this, data);
62. 	}
63. }
64. 
65. function get(key) {
66. 	return key ? this._state[key] : this._state;
67. }
68. 
69. function init(component, options) {
70. 	component.options = options;
71. 
72. 	component._observers = { pre: blankObject(), post: blankObject() };
73. 	component._handlers = blankObject();
74. 	component._root = options._root || component;
75. 	component._yield = options._yield;
76. 	component._bind = options._bind;
77. }
78. 
79. function observe(key, callback, options) {
80. 	var group = options && options.defer
81. 		? this._observers.post
82. 		: this._observers.pre;
83. 
84. 	(group[key] || (group[key] = [])).push(callback);
85. 
86. 	if (!options || options.init !== false) {
87. 		callback.__calling = true;
88. 		callback.call(this, this._state[key]);
89. 		callback.__calling = false;
90. 	}
91. 
92. 	return {
93. 		cancel: function() {
94. 			var index = group[key].indexOf(callback);
95. 			if (~index) group[key].splice(index, 1);
96. 		}
97. 	};
98. }
99. 
100. function on(eventName, handler) {
101. 	if (eventName === 'teardown') return this.on('destroy', handler);
102. 
103. 	var handlers = this._handlers[eventName] || (this._handlers[eventName] = []);
104. 	handlers.push(handler);
105. 
106. 	return {
107. 		cancel: function() {
108. 			var index = handlers.indexOf(handler);
109. 			if (~index) handlers.splice(index, 1);
110. 		}
111. 	};
112. }
113. 
114. function set(newState) {
115. 	this._set(assign({}, newState));
116. 	if (this._root._lock) return;
117. 	this._root._lock = true;
118. 	callAll(this._root._beforecreate);
119. 	callAll(this._root._oncreate);
120. 	callAll(this._root._aftercreate);
121. 	this._root._lock = false;
122. }
123. 
124. function _set(newState) {
125. 	var oldState = this._state,
126. 		changed = {},
127. 		dirty = false;
128. 
129. 	for (var key in newState) {
130. 		if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
131. 	}
132. 	if (!dirty) return;
133. 
134. 	this._state = assign({}, oldState, newState);
135. 	this._recompute(changed, this._state);
136. 	if (this._bind) this._bind(changed, this._state);
137. 	dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
138. 	this._fragment.p(changed, this._state);
139. 	dispatchObservers(this, this._observers.post, changed, this._state, oldState);
140. }
141. 
142. function callAll(fns) {
143. 	while (fns && fns.length) fns.pop()();
144. }
145. 
146. function _mount(target, anchor) {
147. 	this._fragment.m(target, anchor);
148. }
149. 
150. function _unmount() {
151. 	this._fragment.u();
152. }
153. 
154. var proto = {
155. 	destroy: destroy,
156. 	get: get,
157. 	fire: fire,
158. 	observe: observe,
159. 	on: on,
160. 	set: set,
161. 	teardown: destroy,
162. 	_recompute: noop,
163. 	_set: _set,
164. 	_mount: _mount,
165. 	_unmount: _unmount
166. };
167. 
168. /* generated by Svelte vX.Y.Z */
169. function oncreate() {}
170. 
171. function ondestroy() {}
172. 
173. function create_main_fragment(state, component) {
174. 
175. 	return {
176. 		c: noop,
177. 
178. 		m: noop,
179. 
180. 		p: noop,
181. 
182. 		u: noop,
183. 
184. 		d: noop
185. 	};
186. }
187. 
188. function SvelteComponent(options) {
189. 	init(this, options);
190. 	this._state = assign({}, options.data);
191. 
192. 	this._handlers.destroy = [ondestroy];
193. 
194. 	var _oncreate = oncreate.bind(this);
195. 
196. 	if (!options._root) {
197. 		this._oncreate = [_oncreate];
198. 	} else {
199. 	 	this._root._oncreate.push(_oncreate);
200. 	 }
201. 
202. 	this._fragment = create_main_fragment(this._state, this);
203. 
204. 	if (options.target) {
205. 		this._fragment.c();
206. 		this._fragment.m(options.target, options.anchor || null);
207. 
208. 		callAll(this._oncreate);
209. 	}
210. }
211. 
212. assign(SvelteComponent.prototype, proto);
213. 
214. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/expected.js
Line number range: 1 - 48
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";
3. 
4. function oncreate() {};
5. 
6. function ondestroy() {};
7. 
8. function create_main_fragment(state, component) {
9. 
10. 	return {
11. 		c: noop,
12. 
13. 		m: noop,
14. 
15. 		p: noop,
16. 
17. 		u: noop,
18. 
19. 		d: noop
20. 	};
21. }
22. 
23. function SvelteComponent(options) {
24. 	init(this, options);
25. 	this._state = assign({}, options.data);
26. 
27. 	this._handlers.destroy = [ondestroy]
28. 
29. 	var _oncreate = oncreate.bind(this);
30. 
31. 	if (!options._root) {
32. 		this._oncreate = [_oncreate];
33. 	} else {
34. 	 	this._root._oncreate.push(_oncreate);
35. 	 }
36. 
37. 	this._fragment = create_main_fragment(this._state, this);
38. 
39. 	if (options.target) {
40. 		this._fragment.c();
41. 		this._fragment.m(options.target, options.anchor || null);
42. 
43. 		callAll(this._oncreate);
44. 	}
45. }
46. 
47. assign(SvelteComponent.prototype, proto);
48. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/input.html
Line number range: 1 - 7
Content:
1. <script>
2. 	export default {
3. 		// this test should be removed in v2
4. 		onrender () {},
5. 		onteardown () {}
6. 	};
7. </script>

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-11 00:20:11,741 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='Query requirement analysis:\n- The user explicitly requests the full contents (with line numbers) of wrapModule.ts.\nDirect match:\n- This context is the entire src/generators/shared/utils/wrapModule.ts file.\nExtended relevance:\n- It implements module wrapping for different formats (es, amd, cjs, iife, umd, eval), which is essential to understand code generation behavior related to module output.\n- Includes helper import handling and dependency compatibility statements that could affect lifecycle or async code generation.', relative_path='src/generators/shared/utils/wrapModule.ts', start_line=1, end_line=298), ContextOutput(reasoning='Query requirement analysis:\n- The user requests the full contents of oncreate.ts.\nDirect match:\n- This context is the entire validator for the oncreate lifecycle hook.\nExtended relevance:\n- Shows validation rule disallowing arrow functions when they use `this` or `arguments`, which is critical to understanding lifecycle hook validation constraints and potential async implications.', relative_path='src/validate/js/propValidators/oncreate.ts', start_line=1, end_line=14), ContextOutput(reasoning="Query requirement analysis:\n- The user requests the full contents of onrender.ts.\nDirect match:\n- This is the entire validator for the deprecated onrender hook.\nExtended relevance:\n- Warns that 'onrender' is deprecated in favor of 'oncreate' and delegates to oncreate validator, indicating lifecycle hook rewriting behavior.", relative_path='src/validate/js/propValidators/onrender.ts', start_line=1, end_line=11), ContextOutput(reasoning='Query requirement analysis:\n- The user requests the full contents of ondestroy.ts.\nDirect match:\n- This is the entire validator for the ondestroy lifecycle hook.\nExtended relevance:\n- Similar validation rule as oncreate regarding arrow functions using `this`/`arguments`, relevant for lifecycle hook semantics.', relative_path='src/validate/js/propValidators/ondestroy.ts', start_line=1, end_line=14), ContextOutput(reasoning="Query requirement analysis:\n- The user requests the full contents of onteardown.ts.\nDirect match:\n- This is the entire validator for the deprecated onteardown hook.\nExtended relevance:\n- Warns that 'onteardown' is deprecated in favor of 'ondestroy' and delegates to ondestroy validator, revealing lifecycle hook deprecation handling.", relative_path='src/validate/js/propValidators/onteardown.ts', start_line=1, end_line=11), ContextOutput(reasoning='Query requirement analysis:\n- The user requests the full contents of test/js/samples/onrender-onteardown-rewritten/input.html.\nDirect match:\n- This context is the entire test input file containing onrender and onteardown hooks.\nExtended relevance:\n- Demonstrates how deprecated hooks appear in source and are expected to be handled by the compiler.', relative_path='test/js/samples/onrender-onteardown-rewritten/input.html', start_line=1, end_line=7), ContextOutput(reasoning='Query requirement analysis:\n- The user requests the full contents of test/js/samples/onrender-onteardown-rewritten/expected.js.\nDirect match:\n- This context is the entire test expected.js output.\nExtended relevance:\n- Shows the generated ES module output using shared helpers, and that onrender/onteardown are rewritten to oncreate/ondestroy handlers, critical for understanding lifecycle transformation.', relative_path='test/js/samples/onrender-onteardown-rewritten/expected.js', start_line=1, end_line=48), ContextOutput(reasoning="Query requirement analysis:\n- The user requests the full contents of test/js/samples/onrender-onteardown-rewritten/expected-bundle.js.\nDirect match:\n- This context is the entire test expected-bundle.js output.\nExtended relevance:\n- Shows the bundled output, including lifecycle handling where 'onteardown' maps to 'destroy' and 'onrender' maps to oncreate, providing insight into runtime behavior after compilation.", relative_path='test/js/samples/onrender-onteardown-rewritten/expected-bundle.js', start_line=1, end_line=214)]
2025-11-11 00:20:11,746 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 8 contexts to memory for query: Please provide the full contents (with line numbers) of src/generators/shared/utils/wrapModule.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/propValidators/onrender.ts, src/validate/js/propValidators/ondestroy.ts, src/validate/js/propValidators/onteardown.ts, and test/js/samples/onrender-onteardown-rewritten/{input.html,expected.js,expected-bundle.js}.
2025-11-11 00:20:12,071 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-11 00:20:12,072 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 8 new contexts to 0 existing contexts
2025-11-11 00:20:12,073 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 8 total contexts (removed 0 duplicates)
2025-11-11 00:20:12,074 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents (with line numbers) of src/generators/shared/utils/wrapModule.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/propValidators/onrender.ts, src/validate/js/propValidators/ondestroy.ts, src/validate/js/propValidators/onteardown.ts, and test/js/samples/onrender-onteardown-rewritten/{input.html,expected.js,expected-bundle.js}.
Extra Requirements: If README.md documents lifecycle hooks or async support, include the relevant section with line numbers; if sending all files is too large, prioritize wrapModule.ts and oncreate.ts plus the test expected.js.
Purpose: This context will reveal whether async is intentionally removed during code generation or disallowed by validation, enabling accurate classification of the issue.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: src/generators/shared/utils/wrapModule.ts
Line number range: 1 - 298
Content:
1. import deindent from '../../../utils/deindent';
2. import { CompileOptions, ModuleFormat, Node } from '../../../interfaces';
3. 
4. interface Dependency {
5. 	name: string;
6. 	statements: string[];
7. 	source: string;
8. }
9. 
10. const wrappers = { es, amd, cjs, iife, umd, eval: expr };
11. 
12. export default function wrapModule(
13. 	code: string,
14. 	format: ModuleFormat,
15. 	name: string,
16. 	options: CompileOptions,
17. 	banner: string,
18. 	sharedPath: string,
19. 	helpers: { name: string, alias: string }[],
20. 	imports: Node[],
21. 	source: string
22. ): string {
23. 	if (format === 'es') return es(code, name, options, banner, sharedPath, helpers, imports, source);
24. 
25. 	const dependencies = imports.map((declaration, i) => {
26. 		const defaultImport = declaration.specifiers.find(
27. 			(x: Node) =>
28. 				x.type === 'ImportDefaultSpecifier' ||
29. 				(x.type === 'ImportSpecifier' && x.imported.name === 'default')
30. 		);
31. 
32. 		const namespaceImport = declaration.specifiers.find(
33. 			(x: Node) => x.type === 'ImportNamespaceSpecifier'
34. 		);
35. 
36. 		const namedImports = declaration.specifiers.filter(
37. 			(x: Node) =>
38. 				x.type === 'ImportSpecifier' && x.imported.name !== 'default'
39. 		);
40. 
41. 		const name = defaultImport || namespaceImport
42. 			? (defaultImport || namespaceImport).local.name
43. 			: `__import${i}`;
44. 
45. 		const statements: string[] = [];
46. 
47. 		namedImports.forEach((specifier: Node) => {
48. 			statements.push(
49. 				`var ${specifier.local.name} = ${name}.${specifier.imported.name};`
50. 			);
51. 		});
52. 
53. 		if (defaultImport) {
54. 			statements.push(
55. 				`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`
56. 			);
57. 		}
58. 
59. 		return { name, statements, source: declaration.source.value };
60. 	});
61. 
62. 	if (format === 'amd') return amd(code, name, options, banner, dependencies);
63. 	if (format === 'cjs') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);
64. 	if (format === 'iife') return iife(code, name, options, banner, dependencies);
65. 	if (format === 'umd') return umd(code, name, options, banner, dependencies);
66. 	if (format === 'eval') return expr(code, name, options, banner, dependencies);
67. 
68. 	throw new Error(`Not implemented: ${format}`);
69. }
70. 
71. function es(
72. 	code: string,
73. 	name: string,
74. 	options: CompileOptions,
75. 	banner: string,
76. 	sharedPath: string,
77. 	helpers: { name: string, alias: string }[],
78. 	imports: Node[],
79. 	source: string
80. ) {
81. 	const importHelpers = helpers && (
82. 		`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(', ')} } from ${JSON.stringify(sharedPath)};`
83. 	);
84. 
85. 	const importBlock = imports.length > 0 && (
86. 		imports
87. 			.map((declaration: Node) => source.slice(declaration.start, declaration.end))
88. 			.join('\n')
89. 	);
90. 
91. 	return deindent`
92. 		${banner}
93. 		${importHelpers}
94. 		${importBlock}
95. 
96. 		${code}
97. 		export default ${name};`;
98. }
99. 
100. function amd(
101. 	code: string,
102. 	name: string,
103. 	options: CompileOptions,
104. 	banner: string,
105. 	dependencies: Dependency[]
106. ) {
107. 	const sourceString = dependencies.length
108. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
109. 		: '';
110. 
111. 	const id = options.amd && options.amd.id;
112. 
113. 	return deindent`
114. 		define(${id ? `"${id}", ` : ''}${sourceString}function(${paramString(dependencies)}) { "use strict";
115. 			${getCompatibilityStatements(dependencies)}
116. 
117. 			${code}
118. 			return ${name};
119. 		});`;
120. }
121. 
122. function cjs(
123. 	code: string,
124. 	name: string,
125. 	options: CompileOptions,
126. 	banner: string,
127. 	sharedPath: string,
128. 	helpers: { name: string, alias: string }[],
129. 	dependencies: Dependency[]
130. ) {
131. 	const SHARED = '__shared';
132. 	const helperBlock = helpers && (
133. 		`var ${SHARED} = require(${JSON.stringify(sharedPath)});\n` +
134. 		helpers.map(helper => {
135. 			return `var ${helper.alias} = ${SHARED}.${helper.name};`;
136. 		}).join('\n')
137. 	);
138. 
139. 	const requireBlock = dependencies.length > 0 && (
140. 		dependencies
141. 			.map(d => `var ${d.name} = require("${d.source}");`)
142. 			.join('\n\n')
143. 	);
144. 
145. 	return deindent`
146. 		${banner}
147. 		"use strict";
148. 
149. 		${helperBlock}
150. 		${requireBlock}
151. 		${getCompatibilityStatements(dependencies)}
152. 
153. 		${code}
154. 
155. 		module.exports = ${name};`
156. }
157. 
158. function iife(
159. 	code: string,
160. 	name: string,
161. 	options: CompileOptions,
162. 	banner: string,
163. 	dependencies: Dependency[]
164. ) {
165. 	if (!options.name) {
166. 		throw new Error(`Missing required 'name' option for IIFE export`);
167. 	}
168. 
169. 	const globals = getGlobals(dependencies, options);
170. 
171. 	return deindent`
172. 		${banner}
173. 		var ${options.name} = (function(${paramString(dependencies)}) { "use strict";
174. 			${getCompatibilityStatements(dependencies)}
175. 
176. 			${code}
177. 			return ${name};
178. 		}(${globals.join(', ')}));`;
179. }
180. 
181. function umd(
182. 	code: string,
183. 	name: string,
184. 	options: CompileOptions,
185. 	banner: string,
186. 	dependencies: Dependency[]
187. ) {
188. 	if (!options.name) {
189. 		throw new Error(`Missing required 'name' option for UMD export`);
190. 	}
191. 
192. 	const amdId = options.amd && options.amd.id ? `'${options.amd.id}', ` : '';
193. 
194. 	const amdDeps = dependencies.length
195. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
196. 		: '';
197. 
198. 	const cjsDeps = dependencies
199. 		.map(d => `require("${d.source}")`)
200. 		.join(', ');
201. 
202. 	const globals = getGlobals(dependencies, options);
203. 
204. 	return deindent`
205. 		${banner}
206. 		(function(global, factory) {
207. 			typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :
208. 			typeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :
209. 			(global.${options.name} = factory(${globals}));
210. 		}(this, (function (${paramString(dependencies)}) { "use strict";
211. 
212. 			${getCompatibilityStatements(dependencies)}
213. 
214. 			${code}
215. 
216. 			return ${name};
217. 
218. 		})));`;
219. }
220. 
221. function expr(
222. 	code: string,
223. 	name: string,
224. 	options: CompileOptions,
225. 	banner: string,
226. 	dependencies: Dependency[]
227. ) {
228. 	const globals = getGlobals(dependencies, options);
229. 
230. 	return deindent`
231. 		(function (${paramString(dependencies)}) { "use strict";
232. 			${banner}
233. 
234. 			${getCompatibilityStatements(dependencies)}
235. 
236. 			${code}
237. 
238. 			return ${name};
239. 		}(${globals.join(', ')}))`;
240. }
241. 
242. function paramString(dependencies: Dependency[]) {
243. 	return dependencies.map(dep => dep.name).join(', ');
244. }
245. 
246. function removeExtension(file: string) {
247. 	const index = file.lastIndexOf('.');
248. 	return ~index ? file.slice(0, index) : file;
249. }
250. 
251. function getCompatibilityStatements(dependencies: Dependency[]) {
252. 	if (!dependencies.length) return null;
253. 
254. 	const statements: string[] = [];
255. 
256. 	dependencies.forEach(dependency => {
257. 		statements.push(...dependency.statements);
258. 	});
259. 
260. 	return statements.join('\n');
261. }
262. 
263. function getGlobals(dependencies: Dependency[], options: CompileOptions) {
264. 	const { globals, onerror, onwarn } = options;
265. 	const globalFn = getGlobalFn(globals);
266. 
267. 	return dependencies.map(d => {
268. 		let name = globalFn(d.source);
269. 
270. 		if (!name) {
271. 			if (d.name.startsWith('__import')) {
272. 				const error = new Error(
273. 					`Could not determine name for imported module '${d.source}' – use options.globals`
274. 				);
275. 				onerror(error);
276. 			} else {
277. 				const warning = {
278. 					message: `No name was supplied for imported module '${d.source}'. Guessing '${d.name}', but you should use options.globals`,
279. 				};
280. 
281. 				onwarn(warning);
282. 			}
283. 
284. 			name = d.name;
285. 		}
286. 
287. 		return name;
288. 	});
289. }
290. 
291. function getGlobalFn(globals: any): (id: string) => string {
292. 	if (typeof globals === 'function') return globals;
293. 	if (typeof globals === 'object') {
294. 		return id => globals[id];
295. 	}
296. 
297. 	return () => undefined;
298. }


File: src/validate/js/propValidators/oncreate.ts
Line number range: 1 - 14
Content:
1. import usesThisOrArguments from '../utils/usesThisOrArguments';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function oncreate(validator: Validator, prop: Node) {
6. 	if (prop.value.type === 'ArrowFunctionExpression') {
7. 		if (usesThisOrArguments(prop.value.body)) {
8. 			validator.error(
9. 				`'oncreate' should be a function expression, not an arrow function expression`,
10. 				prop.start
11. 			);
12. 		}
13. 	}
14. }


File: src/validate/js/propValidators/ondestroy.ts
Line number range: 1 - 14
Content:
1. import usesThisOrArguments from '../utils/usesThisOrArguments';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function ondestroy(validator: Validator, prop: Node) {
6. 	if (prop.value.type === 'ArrowFunctionExpression') {
7. 		if (usesThisOrArguments(prop.value.body)) {
8. 			validator.error(
9. 				`'ondestroy' should be a function expression, not an arrow function expression`,
10. 				prop.start
11. 			);
12. 		}
13. 	}
14. }


File: src/validate/js/propValidators/onrender.ts
Line number range: 1 - 11
Content:
1. import oncreate from './oncreate';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function onrender(validator: Validator, prop: Node) {
6. 	validator.warn(
7. 		`'onrender' has been deprecated in favour of 'oncreate', and will cause an error in Svelte 2.x`,
8. 		prop.start
9. 	);
10. 	oncreate(validator, prop);
11. }


File: src/validate/js/propValidators/onteardown.ts
Line number range: 1 - 11
Content:
1. import ondestroy from './ondestroy';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function onteardown(validator: Validator, prop: Node) {
6. 	validator.warn(
7. 		`'onteardown' has been deprecated in favour of 'ondestroy', and will cause an error in Svelte 2.x`,
8. 		prop.start
9. 	);
10. 	ondestroy(validator, prop);
11. }


File: test/js/samples/onrender-onteardown-rewritten/expected-bundle.js
Line number range: 1 - 214
Content:
1. function noop() {}
2. 
3. function assign(target) {
4. 	var k,
5. 		source,
6. 		i = 1,
7. 		len = arguments.length;
8. 	for (; i < len; i++) {
9. 		source = arguments[i];
10. 		for (k in source) target[k] = source[k];
11. 	}
12. 
13. 	return target;
14. }
15. 
16. function blankObject() {
17. 	return Object.create(null);
18. }
19. 
20. function destroy(detach) {
21. 	this.destroy = noop;
22. 	this.fire('destroy');
23. 	this.set = this.get = noop;
24. 
25. 	if (detach !== false) this._fragment.u();
26. 	this._fragment.d();
27. 	this._fragment = this._state = null;
28. }
29. 
30. function differs(a, b) {
31. 	return a !== b || ((a && typeof a === 'object') || typeof a === 'function');
32. }
33. 
34. function dispatchObservers(component, group, changed, newState, oldState) {
35. 	for (var key in group) {
36. 		if (!changed[key]) continue;
37. 
38. 		var newValue = newState[key];
39. 		var oldValue = oldState[key];
40. 
41. 		var callbacks = group[key];
42. 		if (!callbacks) continue;
43. 
44. 		for (var i = 0; i < callbacks.length; i += 1) {
45. 			var callback = callbacks[i];
46. 			if (callback.__calling) continue;
47. 
48. 			callback.__calling = true;
49. 			callback.call(component, newValue, oldValue);
50. 			callback.__calling = false;
51. 		}
52. 	}
53. }
54. 
55. function fire(eventName, data) {
56. 	var handlers =
57. 		eventName in this._handlers && this._handlers[eventName].slice();
58. 	if (!handlers) return;
59. 
60. 	for (var i = 0; i < handlers.length; i += 1) {
61. 		handlers[i].call(this, data);
62. 	}
63. }
64. 
65. function get(key) {
66. 	return key ? this._state[key] : this._state;
67. }
68. 
69. function init(component, options) {
70. 	component.options = options;
71. 
72. 	component._observers = { pre: blankObject(), post: blankObject() };
73. 	component._handlers = blankObject();
74. 	component._root = options._root || component;
75. 	component._yield = options._yield;
76. 	component._bind = options._bind;
77. }
78. 
79. function observe(key, callback, options) {
80. 	var group = options && options.defer
81. 		? this._observers.post
82. 		: this._observers.pre;
83. 
84. 	(group[key] || (group[key] = [])).push(callback);
85. 
86. 	if (!options || options.init !== false) {
87. 		callback.__calling = true;
88. 		callback.call(this, this._state[key]);
89. 		callback.__calling = false;
90. 	}
91. 
92. 	return {
93. 		cancel: function() {
94. 			var index = group[key].indexOf(callback);
95. 			if (~index) group[key].splice(index, 1);
96. 		}
97. 	};
98. }
99. 
100. function on(eventName, handler) {
101. 	if (eventName === 'teardown') return this.on('destroy', handler);
102. 
103. 	var handlers = this._handlers[eventName] || (this._handlers[eventName] = []);
104. 	handlers.push(handler);
105. 
106. 	return {
107. 		cancel: function() {
108. 			var index = handlers.indexOf(handler);
109. 			if (~index) handlers.splice(index, 1);
110. 		}
111. 	};
112. }
113. 
114. function set(newState) {
115. 	this._set(assign({}, newState));
116. 	if (this._root._lock) return;
117. 	this._root._lock = true;
118. 	callAll(this._root._beforecreate);
119. 	callAll(this._root._oncreate);
120. 	callAll(this._root._aftercreate);
121. 	this._root._lock = false;
122. }
123. 
124. function _set(newState) {
125. 	var oldState = this._state,
126. 		changed = {},
127. 		dirty = false;
128. 
129. 	for (var key in newState) {
130. 		if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
131. 	}
132. 	if (!dirty) return;
133. 
134. 	this._state = assign({}, oldState, newState);
135. 	this._recompute(changed, this._state);
136. 	if (this._bind) this._bind(changed, this._state);
137. 	dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
138. 	this._fragment.p(changed, this._state);
139. 	dispatchObservers(this, this._observers.post, changed, this._state, oldState);
140. }
141. 
142. function callAll(fns) {
143. 	while (fns && fns.length) fns.pop()();
144. }
145. 
146. function _mount(target, anchor) {
147. 	this._fragment.m(target, anchor);
148. }
149. 
150. function _unmount() {
151. 	this._fragment.u();
152. }
153. 
154. var proto = {
155. 	destroy: destroy,
156. 	get: get,
157. 	fire: fire,
158. 	observe: observe,
159. 	on: on,
160. 	set: set,
161. 	teardown: destroy,
162. 	_recompute: noop,
163. 	_set: _set,
164. 	_mount: _mount,
165. 	_unmount: _unmount
166. };
167. 
168. /* generated by Svelte vX.Y.Z */
169. function oncreate() {}
170. 
171. function ondestroy() {}
172. 
173. function create_main_fragment(state, component) {
174. 
175. 	return {
176. 		c: noop,
177. 
178. 		m: noop,
179. 
180. 		p: noop,
181. 
182. 		u: noop,
183. 
184. 		d: noop
185. 	};
186. }
187. 
188. function SvelteComponent(options) {
189. 	init(this, options);
190. 	this._state = assign({}, options.data);
191. 
192. 	this._handlers.destroy = [ondestroy];
193. 
194. 	var _oncreate = oncreate.bind(this);
195. 
196. 	if (!options._root) {
197. 		this._oncreate = [_oncreate];
198. 	} else {
199. 	 	this._root._oncreate.push(_oncreate);
200. 	 }
201. 
202. 	this._fragment = create_main_fragment(this._state, this);
203. 
204. 	if (options.target) {
205. 		this._fragment.c();
206. 		this._fragment.m(options.target, options.anchor || null);
207. 
208. 		callAll(this._oncreate);
209. 	}
210. }
211. 
212. assign(SvelteComponent.prototype, proto);
213. 
214. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/expected.js
Line number range: 1 - 48
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";
3. 
4. function oncreate() {};
5. 
6. function ondestroy() {};
7. 
8. function create_main_fragment(state, component) {
9. 
10. 	return {
11. 		c: noop,
12. 
13. 		m: noop,
14. 
15. 		p: noop,
16. 
17. 		u: noop,
18. 
19. 		d: noop
20. 	};
21. }
22. 
23. function SvelteComponent(options) {
24. 	init(this, options);
25. 	this._state = assign({}, options.data);
26. 
27. 	this._handlers.destroy = [ondestroy]
28. 
29. 	var _oncreate = oncreate.bind(this);
30. 
31. 	if (!options._root) {
32. 		this._oncreate = [_oncreate];
33. 	} else {
34. 	 	this._root._oncreate.push(_oncreate);
35. 	 }
36. 
37. 	this._fragment = create_main_fragment(this._state, this);
38. 
39. 	if (options.target) {
40. 		this._fragment.c();
41. 		this._fragment.m(options.target, options.anchor || null);
42. 
43. 		callAll(this._oncreate);
44. 	}
45. }
46. 
47. assign(SvelteComponent.prototype, proto);
48. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/input.html
Line number range: 1 - 7
Content:
1. <script>
2. 	export default {
3. 		// this test should be removed in v2
4. 		onrender () {},
5. 		onteardown () {}
6. 	};
7. </script>

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:20:35,445 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The current context shows module wrapping and validation for lifecycle hooks but lacks the code that generates lifecycle functions (oncreate/ondestroy) from component scripts. To classify whether removing the async keyword is a bug or intended behavior, we need to inspect the DOM/server-side generator logic that emits these hooks and the code builder used to construct function declarations. Documentation on lifecycle hooks may also clarify async support. Therefore, additional generator and documentation context is essential.' query='Please provide the full contents (with line numbers) of src/generators/dom/index.ts, src/generators/dom/visitors/Component.ts, src/generators/server-side-rendering/visitors/Component.ts, src/generators/Generator.ts, and src/utils/CodeBuilder.ts.' extra_requirements='If README.md documents lifecycle hooks or async usage, include the relevant section with line numbers; if sending all files is too large, prioritize the two Component.ts files and dom/index.ts.' purpose='These files will reveal how lifecycle hooks are generated and whether async is intentionally stripped, enabling accurate issue classification.'
2025-11-11 00:20:35,447 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents (with line numbers) of src/generators/dom/index.ts, src/generators/dom/visitors/Component.ts, src/generators/server-side-rendering/visitors/Component.ts, src/generators/Generator.ts, and src/utils/CodeBuilder.ts.
2025-11-11 00:20:35,886 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-11 00:20:35,886 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-11 00:20:35,886 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-11 00:20:35,886 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-11 00:20:35,887 - thread-133013323122368.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-11 00:20:35,888 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-11 00:20:35,889 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents (with line numbers) of src/generators/dom/index.ts, src/generators/dom/visitors/Component.ts, src/generators/server-side-rendering/visitors/Component.ts, src/generators/Generator.ts, and src/utils/CodeBuilder.ts.
Extra requirements: If README.md documents lifecycle hooks or async usage, include the relevant section with line numbers; if sending all files is too large, prioritize the two Component.ts files and dom/index.ts.
Purpose: These files will reveal how lifecycle hooks are generated and whether async is intentionally stripped, enabling accurate issue classification.
2025-11-11 00:20:42,753 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_EO5anCZuZEupQP8vODZZlmq5', 'function': {'arguments': '{"relative_path":"src/generators/dom/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 420, 'prompt_tokens': 2227, 'total_tokens': 2647, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--909a7118-c1b9-444b-a99b-c4fb543ff1de-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/index.ts'}, 'id': 'call_EO5anCZuZEupQP8vODZZlmq5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2227, 'output_tokens': 420, 'total_tokens': 2647, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-11 00:20:45,050 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zIJNbihPzYN8XJvCzUPoh7Aw', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Component.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 8155, 'total_tokens': 8189, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7610d61b-15df-4530-abb6-388e98493954-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Component.ts'}, 'id': 'call_zIJNbihPzYN8XJvCzUPoh7Aw', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8155, 'output_tokens': 34, 'total_tokens': 8189, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:20:46,495 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WDZ7QE5NDoWuL3oZIqHJFfGv', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/Component.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 13928, 'total_tokens': 13965, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--efed65fd-6448-4e9a-91cb-73cafb7c08a6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/Component.ts'}, 'id': 'call_WDZ7QE5NDoWuL3oZIqHJFfGv', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13928, 'output_tokens': 37, 'total_tokens': 13965, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:20:47,845 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_qb9icugZRx5VvPw29psB4HHS', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 15268, 'total_tokens': 15298, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ebee1d40-32a2-465a-8adf-90bfee18028e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/Generator.ts'}, 'id': 'call_qb9icugZRx5VvPw29psB4HHS', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15268, 'output_tokens': 30, 'total_tokens': 15298, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:20:49,456 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_14RfGGO5fbafzfTM3H5PkcON', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts","start_line":500,"end_line":950}', 'name': 'read_code_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 21388, 'total_tokens': 21426, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--fa8f4ccc-b69e-4b93-b9ee-25ca94334b88-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'src/generators/Generator.ts', 'start_line': 500, 'end_line': 950}, 'id': 'call_14RfGGO5fbafzfTM3H5PkcON', 'type': 'tool_call'}] usage_metadata={'input_tokens': 21388, 'output_tokens': 38, 'total_tokens': 21426, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:20:50,951 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_yfheGzIyC5Di450VRIZvsw5n', 'function': {'arguments': '{"relative_path":"src/utils/CodeBuilder.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 24361, 'total_tokens': 24390, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 15232}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--95584348-3fda-40d5-8d87-6a6904c73559-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/utils/CodeBuilder.ts'}, 'id': 'call_yfheGzIyC5Di450VRIZvsw5n', 'type': 'tool_call'}] usage_metadata={'input_tokens': 24361, 'output_tokens': 29, 'total_tokens': 24390, 'input_token_details': {'audio': 0, 'cache_read': 15232}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:20:52,648 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_pCXOks7KzCvneJDsF3uVWwLr', 'function': {'arguments': '{"relative_path":"README.md"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 26267, 'total_tokens': 26292, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6b8e9110-28bb-41f2-a20e-a925f0fa1bd0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'README.md'}, 'id': 'call_pCXOks7KzCvneJDsF3uVWwLr', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26267, 'output_tokens': 25, 'total_tokens': 26292, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:21:02,921 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I retrieved the full contents with line numbers for src/generators/dom/index.ts, src/generators/dom/visitors/Component.ts, src/generators/server-side-rendering/visitors/Component.ts, src/generators/Generator.ts (using an additional read to include lines beyond 500), and src/utils/CodeBuilder.ts. I also checked README.md for any sections documenting lifecycle hooks or async usage; it does not contain such information, so no README excerpts were added. The two Component.ts files and dom/index.ts were prioritized as requested. This should give you everything needed to analyze how lifecycle hooks are generated and whether async is intentionally stripped.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 912, 'prompt_tokens': 28430, 'total_tokens': 29342, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--039f1efe-bcf4-4d53-85d5-de0a15dd437e-0' usage_metadata={'input_tokens': 28430, 'output_tokens': 912, 'total_tokens': 29342, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-11 00:21:02,925 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents (with line numbers) of src/generators/dom/index.ts, src/generators/dom/visitors/Component.ts, src/generators/server-side-rendering/visitors/Component.ts, src/generators/Generator.ts, and src/utils/CodeBuilder.ts.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If README.md documents lifecycle hooks or async usage, include the relevant section with line numbers; if sending all files is too large, prioritize the two Component.ts files and dom/index.ts.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These files will reveal how lifecycle hooks are generated and whether async is intentionally stripped, enabling accurate issue classification.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: README.md
Line number range: 1 - 101
Content:
1. # Svelte
2. 
3. The magical disappearing UI framework.
4. 
5. * [Read the introductory blog post](https://svelte.technology/blog/frameworks-without-the-framework/)
6. * [Read the guide](https://svelte.technology/guide)
7. * [Try it out](https://svelte.technology/repl)
8. * [Chat on Gitter](https://gitter.im/sveltejs/svelte)
9. 
10. ---
11. 
12. This is the Svelte compiler, which is primarily intended for authors of tooling that integrates Svelte with different build systems. If you just want to write Svelte components and use them in your app, you probably want one of those tools:
13. 
14. * [svelte-cli](https://github.com/sveltejs/svelte-cli) – Command line interface for compiling components
15. * [rollup-plugin-svelte](https://github.com/rollup/rollup-plugin-svelte) – Rollup plugin
16. * [sveltify](https://github.com/tehshrike/sveltify) - Browserify transform
17. * [gulp-svelte](https://github.com/shinnn/gulp-svelte) - gulp plugin
18. * [metalsmith-svelte](https://github.com/shinnn/metalsmith-svelte) - Metalsmith plugin
19. * [system-svelte](https://github.com/CanopyTax/system-svelte) – System.js loader
20. * [svelte-loader](https://github.com/sveltejs/svelte-loader) – Webpack loader
21. * [meteor-svelte](https://github.com/klaussner/meteor-svelte) – Meteor build plugin
22. * More to come!
23. 
24. 
25. ## Example usage
26. 
27. ```js
28. import * as svelte from 'svelte';
29. 
30. const { code, map } = svelte.compile( source, {
31. 	// the target module format – defaults to 'es' (ES2015 modules), can
32. 	// also be 'amd', 'cjs', 'umd', 'iife' or 'eval'
33. 	format: 'umd',
34. 
35. 	// the filename of the source file, used in e.g. generating sourcemaps
36. 	filename: 'MyComponent.html',
37. 
38. 	// the name of the constructor. Required for 'iife' and 'umd' output,
39. 	// but otherwise mostly useful for debugging. Defaults to 'SvelteComponent'
40. 	name: 'MyComponent',
41. 
42. 	// for 'amd' and 'umd' output, you can optionally specify an AMD module ID
43. 	amd: {
44. 		id: 'my-component'
45. 	},
46. 
47. 	// custom error/warning handlers. By default, errors will throw, and
48. 	// warnings will be printed to the console. Where applicable, the
49. 	// error/warning object will have `pos`, `loc` and `frame` properties
50. 	onerror: err => {
51. 		console.error( err.message );
52. 	},
53. 
54. 	onwarn: warning => {
55. 		console.warn( warning.message );
56. 	}
57. });
58. ```
59. 
60. 
61. ## API
62. 
63. The Svelte compiler exposes the following API:
64. 
65. * `compile( source [, options ] ) => { code, map, ast, css }` - Compile the component with the given options (see below). Returns an object containing the compiled JavaScript, a sourcemap, an AST and transformed CSS.
66. * `create( source [, options ] ) => function` - Compile the component and return the component itself.
67. * `VERSION` - The version of this copy of the Svelte compiler as a string, `'x.x.x'`.
68. 
69. ### Options
70. 
71. The Svelte compiler optionally takes a second argument, an object of configuration options:
72. 
73. | | **Values** | **Description** | **Defaults** |
74. |---|---|---|---|
75. | `format` | `'es'`, `'amd'`, `'cjs'`, `'umd'`, `'iife'`, `'eval'` | The format to output in the compiled component.<br>`'es'` - ES6/ES2015 module, suitable for consumption by a bundler<br>`'amd'` - AMD module<br>`'cjs'` - CommonJS module<br>`'iife'` - IIFE-wrapped function defining a global variable, suitable for use directly in browser<br>`'eval'` - standalone function, suitable for passing to `eval()` | `'es'` for `generate: 'dom'`<br>`'cjs'` for `generate: 'ssr'` |
76. | `generate` | `'dom'`, `'ssr'` | Whether to generate JavaScript code intended for use on the client (`'dom'`), or for use in server-side rendering (`'ssr'`). | `'dom'` |
77. | `name` | `string` | The name of the constructor in the compiled component. | `'SvelteComponent'` |
78. | `filename` | `string` | The filename to use in sourcemaps and compiler error and warning messages. | `'SvelteComponent.html'` |
79. | `amd`.`id` | `string` | The AMD module ID to use for the `'amd'` and `'umd'` output formats. | `undefined` |
80. | `cascade` | `true`, `false` | Whether to cascade all of the component's styles to child components. If `false`, only selectors wrapped in `:global(...)` and keyframe IDs beginning with `-global-` are cascaded. | `true` |
81. | `shared` | `true`, `false`, `string` | Whether to import various helpers from a shared external library. When you have a project with multiple components, this reduces the overall size of your JavaScript bundle, at the expense of having immediately-usable component. You can pass a string of the module path to use, or `true` will import from `'svelte/shared.js'`. | `false` |
82. | `dev` | `true`, `false` | Whether to enable run-time checks in the compiled component. These are helpful during development, but slow your component down. | `false` |
83. | `css` | `true`, `false` | Whether to include code to inject your component's styles into the DOM. | `true` |
84. | `globals` | `object`, `function` | When outputting to the `'umd'`, `'iife'` or `'eval'` formats, an object or function mapping the names of imported dependencies to the names of global variables. | `{}` |
85. | `legacy` | `boolean` | Ensures compatibility with very old browsers, at the cost of some extra code |
86. | `onerror` | `function` | Specify a callback for when Svelte encounters an error while compiling the component. Passed two arguments: the error object, and another function that is Svelte's default onerror handling. | (exception is thrown) |
87. | `onwarn` | `function` | Specify a callback for when Svelte encounters a non-fatal warning while compiling the component. Passed two arguments: the warning object, and another function that is Svelte's default onwarn handling. | (warning is logged to console) |
88. 
89. ## Example/starter repos
90. 
91. * [charpeni/svelte-example](https://github.com/charpeni/svelte-example) - Some Svelte examples with configured Rollup, Babel, ESLint, directives, Two-Way binding, and nested components
92. * [EmilTholin/svelte-test](https://github.com/EmilTholin/svelte-test)
93. * [lukechinworth/codenames](https://github.com/lukechinworth/codenames/tree/svelte) – example integration with Redux
94. 
95. ## BrowserStack
96. <img src="https://cdn.worldvectorlogo.com/logos/browserstack.svg" height="80" width="80" align="left">
97. <p>To keep Svelte's performance in check, we use BrowserStack to quickly run benchmarks for each PR that immediately give feedback to the contributor. You can see how we use BrowserStack in the <a href="https://github.com/sveltejs/svelte-bench">svelte-bench</a> project and check out BrowserStack's services on their <a href="https://www.browserstack.com/">website</a>.</p>
98. 
99. ## License
100. 
101. [MIT](LICENSE)


File: src/generators/Generator.ts
Line number range: 1 - 500
Content:
1. import MagicString, { Bundle } from 'magic-string';
2. import { walk } from 'estree-walker';
3. import { getLocator } from 'locate-character';
4. import deindent from '../utils/deindent';
5. import CodeBuilder from '../utils/CodeBuilder';
6. import getCodeFrame from '../utils/getCodeFrame';
7. import isReference from '../utils/isReference';
8. import flattenReference from '../utils/flattenReference';
9. import globalWhitelist from '../utils/globalWhitelist';
10. import reservedNames from '../utils/reservedNames';
11. import namespaces from '../utils/namespaces';
12. import { removeNode, removeObjectKey } from '../utils/removeNode';
13. import wrapModule from './shared/utils/wrapModule';
14. import annotateWithScopes from '../utils/annotateWithScopes';
15. import clone from '../utils/clone';
16. import DomBlock from './dom/Block';
17. import SsrBlock from './server-side-rendering/Block';
18. import Stylesheet from '../css/Stylesheet';
19. import { Node, GenerateOptions, Parsed, CompileOptions, CustomElementOptions } from '../interfaces';
20. 
21. const test = typeof global !== 'undefined' && global.__svelte_test;
22. 
23. interface Computation {
24. 	key: string;
25. 	deps: string[]
26. }
27. 
28. function detectIndentation(str: string) {
29. 	const pattern = /^[\t\s]{1,4}/gm;
30. 	let match;
31. 
32. 	while (match = pattern.exec(str)) {
33. 		if (match[0][0] === '\t') return '\t';
34. 		if (match[0].length === 2) return '  ';
35. 	}
36. 
37. 	return '    ';
38. }
39. 
40. function getIndentationLevel(str: string, b: number) {
41. 	let a = b;
42. 	while (a > 0 && str[a - 1] !== '\n') a -= 1;
43. 	return /^\s*/.exec(str.slice(a, b))[0];
44. }
45. 
46. function getIndentExclusionRanges(node: Node) {
47. 	const ranges: Node[] = [];
48. 	walk(node, {
49. 		enter(node: Node) {
50. 			if (node.type === 'TemplateElement') ranges.push(node);
51. 		}
52. 	});
53. 	return ranges;
54. }
55. 
56. function removeIndentation(
57. 	code: MagicString,
58. 	start: number,
59. 	end: number,
60. 	indentationLevel: string,
61. 	ranges: Node[]
62. ) {
63. 	const str = code.original.slice(start, end);
64. 	const pattern = new RegExp(`^${indentationLevel}`, 'gm');
65. 	let match;
66. 
67. 	while (match = pattern.exec(str)) {
68. 		// TODO bail if we're inside an exclusion range
69. 		code.remove(start + match.index, start + match.index + indentationLevel.length);
70. 	}
71. }
72. 
73. export default class Generator {
74. 	ast: Parsed;
75. 	parsed: Parsed;
76. 	source: string;
77. 	name: string;
78. 	options: CompileOptions;
79. 
80. 	customElement: CustomElementOptions;
81. 	tag: string;
82. 	props: string[];
83. 
84. 	defaultExport: Node[];
85. 	imports: Node[];
86. 	helpers: Set<string>;
87. 	components: Set<string>;
88. 	events: Set<string>;
89. 	transitions: Set<string>;
90. 	importedComponents: Map<string, string>;
91. 	namespace: string;
92. 	hasComponents: boolean;
93. 	computations: Computation[];
94. 	templateProperties: Record<string, Node>;
95. 	slots: Set<string>;
96. 	javascript: string;
97. 
98. 	code: MagicString;
99. 
100. 	bindingGroups: string[];
101. 	indirectDependencies: Map<string, Set<string>>;
102. 	expectedProperties: Set<string>;
103. 	usesRefs: boolean;
104. 
105. 	locate: (c: number) => { line: number, column: number };
106. 
107. 	stylesheet: Stylesheet;
108. 
109. 	userVars: Set<string>;
110. 	templateVars: Map<string, string>;
111. 	aliases: Map<string, string>;
112. 	usedNames: Set<string>;
113. 
114. 	constructor(
115. 		parsed: Parsed,
116. 		source: string,
117. 		name: string,
118. 		stylesheet: Stylesheet,
119. 		options: CompileOptions,
120. 		dom: boolean
121. 	) {
122. 		this.ast = clone(parsed);
123. 
124. 		this.parsed = parsed;
125. 		this.source = source;
126. 		this.options = options;
127. 
128. 		this.imports = [];
129. 		this.helpers = new Set();
130. 		this.components = new Set();
131. 		this.events = new Set();
132. 		this.transitions = new Set();
133. 		this.importedComponents = new Map();
134. 		this.slots = new Set();
135. 
136. 		this.bindingGroups = [];
137. 		this.indirectDependencies = new Map();
138. 
139. 		this.locate = getLocator(this.source);
140. 
141. 		// track which properties are needed, so we can provide useful info
142. 		// in dev mode
143. 		this.expectedProperties = new Set();
144. 
145. 		this.code = new MagicString(source);
146. 		this.usesRefs = false;
147. 
148. 		// styles
149. 		this.stylesheet = stylesheet;
150. 
151. 		// allow compiler to deconflict user's `import { get } from 'whatever'` and
152. 		// Svelte's builtin `import { get, ... } from 'svelte/shared.ts'`;
153. 		this.userVars = new Set();
154. 		this.templateVars = new Map();
155. 		this.aliases = new Map();
156. 		this.usedNames = new Set();
157. 
158. 		this.parseJs(dom);
159. 		this.name = this.alias(name);
160. 
161. 		if (options.customElement === true) {
162. 			this.customElement = {
163. 				tag: this.tag,
164. 				props: this.props // TODO autofill this in
165. 			}
166. 		} else {
167. 			this.customElement = options.customElement;
168. 		}
169. 
170. 		if (this.customElement && !this.customElement.tag) {
171. 			throw new Error(`No tag name specified`); // TODO better error
172. 		}
173. 	}
174. 
175. 	addSourcemapLocations(node: Node) {
176. 		walk(node, {
177. 			enter: (node: Node) => {
178. 				this.code.addSourcemapLocation(node.start);
179. 				this.code.addSourcemapLocation(node.end);
180. 			},
181. 		});
182. 	}
183. 
184. 	alias(name: string) {
185. 		if (!this.aliases.has(name)) {
186. 			this.aliases.set(name, this.getUniqueName(name));
187. 		}
188. 
189. 		return this.aliases.get(name);
190. 	}
191. 
192. 	contextualise(
193. 		block: DomBlock | SsrBlock,
194. 		expression: Node,
195. 		context: string,
196. 		isEventHandler: boolean
197. 	): {
198. 		dependencies: string[],
199. 		contexts: Set<string>,
200. 		indexes: Set<string>,
201. 		snippet: string
202. 	} {
203. 		this.addSourcemapLocations(expression);
204. 
205. 		const usedContexts: Set<string> = new Set();
206. 		const usedIndexes: Set<string> = new Set();
207. 
208. 		const { code, helpers } = this;
209. 		const { contexts, indexes } = block;
210. 
211. 		let scope = annotateWithScopes(expression); // TODO this already happens in findDependencies
212. 		let lexicalDepth = 0;
213. 
214. 		const self = this;
215. 
216. 		walk(expression, {
217. 			enter(node: Node, parent: Node, key: string) {
218. 				if (/^Function/.test(node.type)) lexicalDepth += 1;
219. 
220. 				if (node._scope) {
221. 					scope = node._scope;
222. 					return;
223. 				}
224. 
225. 				if (node.type === 'ThisExpression') {
226. 					if (lexicalDepth === 0 && context)
227. 						code.overwrite(node.start, node.end, context, {
228. 							storeName: true,
229. 							contentOnly: false,
230. 						});
231. 				} else if (isReference(node, parent)) {
232. 					const { name } = flattenReference(node);
233. 					if (scope.has(name)) return;
234. 
235. 					if (name === 'event' && isEventHandler) {
236. 						// noop
237. 					} else if (contexts.has(name)) {
238. 						const contextName = contexts.get(name);
239. 						if (contextName !== name) {
240. 							// this is true for 'reserved' names like `state` and `component`
241. 							code.overwrite(
242. 								node.start,
243. 								node.start + name.length,
244. 								contextName,
245. 								{ storeName: true, contentOnly: false }
246. 							);
247. 						}
248. 
249. 						usedContexts.add(name);
250. 					} else if (helpers.has(name)) {
251. 						let object = node;
252. 						while (object.type === 'MemberExpression') object = object.object;
253. 
254. 						const alias = self.templateVars.get(`helpers-${name}`);
255. 						if (alias !== name) code.overwrite(object.start, object.end, alias);
256. 					} else if (indexes.has(name)) {
257. 						const context = indexes.get(name);
258. 						usedContexts.add(context); // TODO is this right?
259. 						usedIndexes.add(name);
260. 					} else {
261. 						// handle shorthand properties
262. 						if (parent && parent.type === 'Property' && parent.shorthand) {
263. 							if (key === 'key') {
264. 								code.appendLeft(node.start, `${name}: `);
265. 								return;
266. 							}
267. 						}
268. 
269. 						if (globalWhitelist.has(name)) {
270. 							code.prependRight(node.start, `('${name}' in state ? state.`);
271. 							code.appendLeft(
272. 								node.object ? node.object.end : node.end,
273. 								` : ${name})`
274. 							);
275. 						} else {
276. 							code.prependRight(node.start, `state.`);
277. 						}
278. 
279. 						usedContexts.add('state');
280. 					}
281. 
282. 					this.skip();
283. 				}
284. 			},
285. 
286. 			leave(node: Node) {
287. 				if (/^Function/.test(node.type)) lexicalDepth -= 1;
288. 				if (node._scope) scope = scope.parent;
289. 			},
290. 		});
291. 
292. 		const dependencies: Set<string> = new Set(expression._dependencies || []);
293. 
294. 		if (expression._dependencies) {
295. 			expression._dependencies.forEach((prop: string) => {
296. 				if (this.indirectDependencies.has(prop)) {
297. 					this.indirectDependencies.get(prop).forEach(dependency => {
298. 						dependencies.add(dependency);
299. 					});
300. 				}
301. 			});
302. 		}
303. 
304. 		return {
305. 			dependencies: Array.from(dependencies),
306. 			contexts: usedContexts,
307. 			indexes: usedIndexes,
308. 			snippet: `[✂${expression.start}-${expression.end}✂]`,
309. 		};
310. 	}
311. 
312. 	findDependencies(
313. 		contextDependencies: Map<string, string[]>,
314. 		indexes: Map<string, string>,
315. 		expression: Node
316. 	) {
317. 		if (expression._dependencies) return expression._dependencies;
318. 
319. 		let scope = annotateWithScopes(expression);
320. 		const dependencies: string[] = [];
321. 
322. 		const generator = this; // can't use arrow functions, because of this.skip()
323. 
324. 		walk(expression, {
325. 			enter(node: Node, parent: Node) {
326. 				if (node._scope) {
327. 					scope = node._scope;
328. 					return;
329. 				}
330. 
331. 				if (isReference(node, parent)) {
332. 					const { name } = flattenReference(node);
333. 					if (scope.has(name) || generator.helpers.has(name)) return;
334. 
335. 					if (contextDependencies.has(name)) {
336. 						dependencies.push(...contextDependencies.get(name));
337. 					} else if (!indexes.has(name)) {
338. 						dependencies.push(name);
339. 					}
340. 
341. 					this.skip();
342. 				}
343. 			},
344. 
345. 			leave(node: Node) {
346. 				if (node._scope) scope = scope.parent;
347. 			},
348. 		});
349. 
350. 		dependencies.forEach(name => {
351. 			if (!globalWhitelist.has(name)) {
352. 				this.expectedProperties.add(name);
353. 			}
354. 		});
355. 
356. 		return (expression._dependencies = dependencies);
357. 	}
358. 
359. 	generate(result: string, options: CompileOptions, { banner = '', sharedPath, helpers, name, format }: GenerateOptions ) {
360. 		const pattern = /\[✂(\d+)-(\d+)$/;
361. 
362. 		const module = wrapModule(result, format, name, options, banner, sharedPath, helpers, this.imports, this.source);
363. 
364. 		const parts = module.split('✂]');
365. 		const finalChunk = parts.pop();
366. 
367. 		const compiled = new Bundle({ separator: '' });
368. 
369. 		function addString(str: string) {
370. 			compiled.addSource({
371. 				content: new MagicString(str),
372. 			});
373. 		}
374. 
375. 		const { filename } = options;
376. 
377. 		// special case — the source file doesn't actually get used anywhere. we need
378. 		// to add an empty file to populate map.sources and map.sourcesContent
379. 		if (!parts.length) {
380. 			compiled.addSource({
381. 				filename,
382. 				content: new MagicString(this.source).remove(0, this.source.length),
383. 			});
384. 		}
385. 
386. 		parts.forEach((str: string) => {
387. 			const chunk = str.replace(pattern, '');
388. 			if (chunk) addString(chunk);
389. 
390. 			const match = pattern.exec(str);
391. 
392. 			const snippet = this.code.snip(+match[1], +match[2]);
393. 
394. 			compiled.addSource({
395. 				filename,
396. 				content: snippet,
397. 			});
398. 		});
399. 
400. 		addString(finalChunk);
401. 
402. 		const { css, cssMap } = this.customElement ?
403. 			{ css: null, cssMap: null } :
404. 			this.stylesheet.render(options.cssOutputFilename, true);
405. 
406. 		return {
407. 			ast: this.ast,
408. 			code: compiled.toString(),
409. 			map: compiled.generateMap({
410. 				includeContent: true,
411. 				file: options.outputFilename,
412. 			}),
413. 			css,
414. 			cssMap
415. 		};
416. 	}
417. 
418. 	getUniqueName(name: string) {
419. 		if (test) name = `${name}$`;
420. 		let alias = name;
421. 		for (
422. 			let i = 1;
423. 			reservedNames.has(alias) ||
424. 			this.userVars.has(alias) ||
425. 			this.usedNames.has(alias);
426. 			alias = `${name}_${i++}`
427. 		);
428. 		this.usedNames.add(alias);
429. 		return alias;
430. 	}
431. 
432. 	getUniqueNameMaker(params: string[]) {
433. 		const localUsedNames = new Set(params);
434. 
435. 		function add(name: string) {
436. 			localUsedNames.add(name);
437. 		}
438. 
439. 		reservedNames.forEach(add);
440. 		this.userVars.forEach(add);
441. 
442. 		return (name: string) => {
443. 			if (test) name = `${name}$`;
444. 			let alias = name;
445. 			for (
446. 				let i = 1;
447. 				this.usedNames.has(alias) ||
448. 				localUsedNames.has(alias);
449. 				alias = `${name}_${i++}`
450. 			);
451. 			localUsedNames.add(alias);
452. 			return alias;
453. 		};
454. 	}
455. 
456. 	parseJs(dom: boolean) {
457. 		const { code, source } = this;
458. 		const { js } = this.parsed;
459. 
460. 		const imports = this.imports;
461. 		const computations: Computation[] = [];
462. 		const templateProperties: Record<string, Node> = {};
463. 		const componentDefinition = new CodeBuilder();
464. 
465. 		let namespace = null;
466. 
467. 		if (js) {
468. 			this.addSourcemapLocations(js.content);
469. 
470. 			const indentation = detectIndentation(source.slice(js.start, js.end));
471. 			const indentationLevel = getIndentationLevel(source, js.content.body[0].start);
472. 			const indentExclusionRanges = getIndentExclusionRanges(js.content);
473. 
474. 			const scope = annotateWithScopes(js.content);
475. 			scope.declarations.forEach(name => {
476. 				this.userVars.add(name);
477. 			});
478. 
479. 			const body = js.content.body.slice(); // slice, because we're going to be mutating the original
480. 
481. 			// imports need to be hoisted out of the IIFE
482. 			for (let i = 0; i < body.length; i += 1) {
483. 				const node = body[i];
484. 				if (node.type === 'ImportDeclaration') {
485. 					removeNode(code, js.content, node);
486. 					imports.push(node);
487. 
488. 					node.specifiers.forEach((specifier: Node) => {
489. 						this.userVars.add(specifier.local.name);
490. 					});
491. 				}
492. 			}
493. 
494. 			const defaultExport = this.defaultExport = body.find(
495. 				(node: Node) => node.type === 'ExportDefaultDeclaration'
496. 			);
497. 
498. 			if (defaultExport) {
499. 				defaultExport.declaration.properties.forEach((prop: Node) => {
500. 					templateProperties[prop.key.name] = prop;


File: src/generators/Generator.ts
Line number range: 500 - 950
Content:
500. 					templateProperties[prop.key.name] = prop;
501. 				});
502. 
503. 				['helpers', 'events', 'components', 'transitions'].forEach(key => {
504. 					if (templateProperties[key]) {
505. 						templateProperties[key].value.properties.forEach((prop: Node) => {
506. 							this[key].add(prop.key.name);
507. 						});
508. 					}
509. 				});
510. 
511. 				const addArrowFunctionExpression = (name: string, node: Node) => {
512. 					const { body, params } = node;
513. 
514. 					const paramString = params.length ?
515. 						`[✂${params[0].start}-${params[params.length - 1].end}✂]` :
516. 						``;
517. 
518. 					if (body.type === 'BlockStatement') {
519. 						componentDefinition.addBlock(deindent`
520. 							function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
521. 						`);
522. 					} else {
523. 						componentDefinition.addBlock(deindent`
524. 							function ${name}(${paramString}) {
525. 								return [✂${body.start}-${body.end}✂];
526. 							}
527. 						`);
528. 					}
529. 				};
530. 
531. 				const addFunctionExpression = (name: string, node: Node) => {
532. 					let c = node.start;
533. 					while (this.source[c] !== '(') c += 1;
534. 					componentDefinition.addBlock(deindent`
535. 						function ${name}[✂${c}-${node.end}✂];
536. 					`);
537. 				};
538. 
539. 				const addValue = (name: string, node: Node) => {
540. 					componentDefinition.addBlock(deindent`
541. 						var ${name} = [✂${node.start}-${node.end}✂];
542. 					`);
543. 				};
544. 
545. 				const addDeclaration = (key: string, node: Node, disambiguator?: string) => {
546. 					const qualified = disambiguator ? `${disambiguator}-${key}` : key;
547. 
548. 					if (node.type === 'Identifier' && node.name === key) {
549. 						this.templateVars.set(qualified, key);
550. 						return;
551. 					}
552. 
553. 					let name = this.getUniqueName(key);
554. 					this.templateVars.set(qualified, name);
555. 
556. 					// deindent
557. 					const indentationLevel = getIndentationLevel(source, node.start);
558. 					if (indentationLevel) {
559. 						removeIndentation(code, node.start, node.end, indentationLevel, indentExclusionRanges);
560. 					}
561. 
562. 					if (node.type === 'ArrowFunctionExpression') {
563. 						addArrowFunctionExpression(name, node);
564. 					} else if (node.type === 'FunctionExpression') {
565. 						addFunctionExpression(name, node);
566. 					} else {
567. 						addValue(name, node);
568. 					}
569. 				};
570. 
571. 				if (templateProperties.components) {
572. 					templateProperties.components.value.properties.forEach((property: Node) => {
573. 						addDeclaration(property.key.name, property.value, 'components');
574. 					});
575. 				}
576. 
577. 				if (templateProperties.computed) {
578. 					const dependencies = new Map();
579. 
580. 					templateProperties.computed.value.properties.forEach((prop: Node) => {
581. 						const key = prop.key.name;
582. 						const value = prop.value;
583. 
584. 						const deps = value.params.map(
585. 							(param: Node) =>
586. 								param.type === 'AssignmentPattern' ? param.left.name : param.name
587. 						);
588. 						dependencies.set(key, deps);
589. 					});
590. 
591. 					const visited = new Set();
592. 
593. 					const visit = (key: string) => {
594. 						if (!dependencies.has(key)) return; // not a computation
595. 
596. 						if (visited.has(key)) return;
597. 						visited.add(key);
598. 
599. 						const deps = dependencies.get(key);
600. 						deps.forEach(visit);
601. 
602. 						computations.push({ key, deps });
603. 
604. 						const prop = templateProperties.computed.value.properties.find((prop: Node) => prop.key.name === key);
605. 						addDeclaration(key, prop.value, 'computed');
606. 					};
607. 
608. 					templateProperties.computed.value.properties.forEach((prop: Node) =>
609. 						visit(prop.key.name)
610. 					);
611. 				}
612. 
613. 				if (templateProperties.data) {
614. 					addDeclaration('data', templateProperties.data.value);
615. 				}
616. 
617. 				if (templateProperties.events && dom) {
618. 					templateProperties.events.value.properties.forEach((property: Node) => {
619. 						addDeclaration(property.key.name, property.value, 'events');
620. 					});
621. 				}
622. 
623. 				if (templateProperties.helpers) {
624. 					templateProperties.helpers.value.properties.forEach((property: Node) => {
625. 						addDeclaration(property.key.name, property.value, 'helpers');
626. 					});
627. 				}
628. 
629. 				if (templateProperties.methods && dom) {
630. 					addDeclaration('methods', templateProperties.methods.value);
631. 				}
632. 
633. 				if (templateProperties.namespace) {
634. 					const ns = templateProperties.namespace.value.value;
635. 					namespace = namespaces[ns] || ns;
636. 				}
637. 
638. 				if (templateProperties.onrender) templateProperties.oncreate = templateProperties.onrender; // remove after v2
639. 				if (templateProperties.oncreate && dom) {
640. 					addDeclaration('oncreate', templateProperties.oncreate.value);
641. 				}
642. 
643. 				if (templateProperties.onteardown) templateProperties.ondestroy = templateProperties.onteardown; // remove after v2
644. 				if (templateProperties.ondestroy && dom) {
645. 					addDeclaration('ondestroy', templateProperties.ondestroy.value);
646. 				}
647. 
648. 				if (templateProperties.props) {
649. 					this.props = templateProperties.props.value.elements.map((element: Node) => element.value);
650. 				}
651. 
652. 				if (templateProperties.setup) {
653. 					addDeclaration('setup', templateProperties.setup.value);
654. 				}
655. 
656. 				if (templateProperties.tag) {
657. 					this.tag = templateProperties.tag.value.value;
658. 				}
659. 
660. 				if (templateProperties.transitions) {
661. 					templateProperties.transitions.value.properties.forEach((property: Node) => {
662. 						addDeclaration(property.key.name, property.value, 'transitions');
663. 					});
664. 				}
665. 			}
666. 
667. 			if (indentationLevel) {
668. 				if (defaultExport) {
669. 					removeIndentation(code, js.content.start, defaultExport.start, indentationLevel, indentExclusionRanges);
670. 					removeIndentation(code, defaultExport.end, js.content.end, indentationLevel, indentExclusionRanges);
671. 				} else {
672. 					removeIndentation(code, js.content.start, js.content.end, indentationLevel, indentExclusionRanges);
673. 				}
674. 			}
675. 
676. 			let a = js.content.start;
677. 			while (/\s/.test(source[a])) a += 1;
678. 
679. 			let b = js.content.end;
680. 			while (/\s/.test(source[b - 1])) b -= 1;
681. 
682. 			if (defaultExport) {
683. 				this.javascript = '';
684. 				if (a !== defaultExport.start) this.javascript += `[✂${a}-${defaultExport.start}✂]`;
685. 				if (!componentDefinition.isEmpty()) this.javascript += componentDefinition;
686. 				if (defaultExport.end !== b) this.javascript += `[✂${defaultExport.end}-${b}✂]`;
687. 			} else {
688. 				this.javascript = a === b ? null : `[✂${a}-${b}✂]`;
689. 			}
690. 		}
691. 
692. 		this.computations = computations;
693. 		this.namespace = namespace;
694. 		this.templateProperties = templateProperties;
695. 	}
696. }


File: src/generators/dom/index.ts
Line number range: 1 - 437
Content:
1. import MagicString from 'magic-string';
2. import { parseExpressionAt } from 'acorn';
3. import annotateWithScopes from '../../utils/annotateWithScopes';
4. import isReference from '../../utils/isReference';
5. import { walk } from 'estree-walker';
6. import deindent from '../../utils/deindent';
7. import { stringify, escape } from '../../utils/stringify';
8. import CodeBuilder from '../../utils/CodeBuilder';
9. import reservedNames from '../../utils/reservedNames';
10. import visit from './visit';
11. import shared from './shared';
12. import Generator from '../Generator';
13. import Stylesheet from '../../css/Stylesheet';
14. import preprocess from './preprocess';
15. import Block from './Block';
16. import { version } from '../../../package.json';
17. import { Parsed, CompileOptions, Node } from '../../interfaces';
18. 
19. const test = typeof global !== 'undefined' && global.__svelte_test;
20. 
21. export class DomGenerator extends Generator {
22. 	blocks: (Block|string)[];
23. 	readonly: Set<string>;
24. 	metaBindings: string[];
25. 
26. 	hydratable: boolean;
27. 	legacy: boolean;
28. 
29. 	hasIntroTransitions: boolean;
30. 	hasOutroTransitions: boolean;
31. 	hasComplexBindings: boolean;
32. 
33. 	needsEncapsulateHelper: boolean;
34. 
35. 	constructor(
36. 		parsed: Parsed,
37. 		source: string,
38. 		name: string,
39. 		stylesheet: Stylesheet,
40. 		options: CompileOptions
41. 	) {
42. 		super(parsed, source, name, stylesheet, options, true);
43. 		this.blocks = [];
44. 
45. 		this.readonly = new Set();
46. 
47. 		this.hydratable = options.hydratable;
48. 		this.legacy = options.legacy;
49. 		this.needsEncapsulateHelper = false;
50. 
51. 		// initial values for e.g. window.innerWidth, if there's a <:Window> meta tag
52. 		this.metaBindings = [];
53. 	}
54. 
55. 	getUniqueNameMaker(params: string[]) {
56. 		const localUsedNames = new Set(params);
57. 
58. 		function add(name: string) {
59. 			localUsedNames.add(name);
60. 		}
61. 
62. 		reservedNames.forEach(add);
63. 		this.userVars.forEach(add);
64. 		for (const name in shared) {
65. 			localUsedNames.add(test ? `${name}$` : name);
66. 		}
67. 
68. 		return (name: string) => {
69. 			if (test) name = `${name}$`;
70. 			let alias = name;
71. 			for (
72. 				let i = 1;
73. 				this.usedNames.has(alias) ||
74. 				localUsedNames.has(alias);
75. 				alias = `${name}_${i++}`
76. 			);
77. 			localUsedNames.add(alias);
78. 			return alias;
79. 		};
80. 	}
81. }
82. 
83. export default function dom(
84. 	parsed: Parsed,
85. 	source: string,
86. 	stylesheet: Stylesheet,
87. 	options: CompileOptions
88. ) {
89. 	const format = options.format || 'es';
90. 
91. 	const generator = new DomGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
92. 
93. 	const {
94. 		computations,
95. 		name,
96. 		templateProperties,
97. 		namespace,
98. 	} = generator;
99. 
100. 	const { block, state } = preprocess(generator, namespace, parsed.html);
101. 
102. 	generator.stylesheet.warnOnUnusedSelectors(options.onwarn);
103. 
104. 	parsed.html.children.forEach((node: Node) => {
105. 		visit(generator, block, state, node, [], []);
106. 	});
107. 
108. 	const builder = new CodeBuilder();
109. 	const computationBuilder = new CodeBuilder();
110. 	const computationDeps = new Set();
111. 
112. 	if (computations.length) {
113. 		computations.forEach(({ key, deps }) => {
114. 			deps.forEach(dep => {
115. 				computationDeps.add(dep);
116. 			});
117. 
118. 			if (generator.readonly.has(key)) {
119. 				// <:Window> bindings
120. 				throw new Error(
121. 					`Cannot have a computed value '${key}' that clashes with a read-only property`
122. 				);
123. 			}
124. 
125. 			generator.readonly.add(key);
126. 
127. 			const condition = `${deps.map(dep => `changed.${dep}`).join(' || ')}`;
128. 
129. 			const statement = `if (@differs(state.${key}, (state.${key} = %computed-${key}(${deps
130. 				.map(dep => `state.${dep}`)
131. 				.join(', ')})))) changed.${key} = true;`;
132. 
133. 			computationBuilder.addConditional(condition, statement);
134. 		});
135. 	}
136. 
137. 	if (generator.javascript) {
138. 		builder.addBlock(generator.javascript);
139. 	}
140. 
141. 	if (generator.needsEncapsulateHelper) {
142. 		builder.addBlock(deindent`
143. 			function @encapsulateStyles(node) {
144. 				@setAttribute(node, "${generator.stylesheet.id}", "");
145. 			}
146. 		`);
147. 	}
148. 
149. 	const { css, cssMap } = generator.stylesheet.render(options.filename, !generator.customElement);
150. 	const styles = generator.stylesheet.hasStyles && stringify(options.dev ?
151. 		`${css}\n/*# sourceMappingURL=${cssMap.toUrl()} */` :
152. 		css, { onlyEscapeAtSymbol: true });
153. 
154. 	if (styles && generator.options.css !== false && !generator.customElement) {
155. 		builder.addBlock(deindent`
156. 			function @add_css() {
157. 				var style = @createElement("style");
158. 				style.id = '${generator.stylesheet.id}-style';
159. 				style.textContent = ${styles};
160. 				@appendNode(style, document.head);
161. 			}
162. 		`);
163. 	}
164. 
165. 	generator.blocks.forEach(block => {
166. 		builder.addBlock(block.toString());
167. 	});
168. 
169. 	const sharedPath = options.shared === true
170. 		? 'svelte/shared.js'
171. 		: options.shared;
172. 
173. 	const prototypeBase =
174. 		`${name}.prototype` +
175. 		(templateProperties.methods ? `, %methods` : '');
176. 	const proto = sharedPath
177. 		? `@proto`
178. 		: deindent`
179. 		{
180. 			${['destroy', 'get', 'fire', 'observe', 'on', 'set', 'teardown', '_set', '_mount', '_unmount']
181. 				.map(n => `${n}: @${n === 'teardown' ? 'destroy' : n}`)
182. 				.join(',\n')}
183. 		}`;
184. 
185. 	const debugName = `<${generator.customElement ? generator.tag : name}>`;
186. 
187. 	const constructorBody = deindent`
188. 		${options.dev && `this._debugName = '${debugName}';`}
189. 		${options.dev && !generator.customElement &&
190. 			`if (!options || (!options.target && !options._root)) throw new Error("'target' is a required option");`}
191. 		@init(this, options);
192. 		${generator.usesRefs && `this.refs = {};`}
193. 		this._state = @assign(${templateProperties.data ? '%data()' : '{}'}, options.data);
194. 		${generator.metaBindings}
195. 		${computations.length && `this._recompute({ ${Array.from(computationDeps).map(dep => `${dep}: 1`).join(', ')} }, this._state);`}
196. 		${options.dev &&
197. 			Array.from(generator.expectedProperties).map(
198. 				prop =>
199. 					`if (!('${prop}' in this._state)) console.warn("${debugName} was created without expected data property '${prop}'");`
200. 			)}
201. 		${generator.bindingGroups.length &&
202. 			`this._bindingGroups = [${Array(generator.bindingGroups.length).fill('[]').join(', ')}];`}
203. 
204. 		${templateProperties.ondestroy && `this._handlers.destroy = [%ondestroy]`}
205. 
206. 		${generator.slots.size && `this._slotted = options.slots || {};`}
207. 
208. 		${generator.customElement ?
209. 			deindent`
210. 				this.attachShadow({ mode: 'open' });
211. 				${css && `this.shadowRoot.innerHTML = \`<style>${escape(css, { onlyEscapeAtSymbol: true }).replace(/\\/g, '\\\\')}${options.dev ? `\n/*# sourceMappingURL=${cssMap.toUrl()} */` : ''}</style>\`;`}
212. 			` :
213. 			(generator.stylesheet.hasStyles && options.css !== false &&
214. 			`if (!document.getElementById("${generator.stylesheet.id}-style")) @add_css();`)
215. 		}
216. 
217. 		${templateProperties.oncreate && `var _oncreate = %oncreate.bind(this);`}
218. 
219. 		${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`
220. 			if (!options._root) {
221. 				this._oncreate = [${templateProperties.oncreate && `_oncreate`}];
222. 				${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}
223. 				${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}
224. 			} ${templateProperties.oncreate && deindent`
225. 				else {
226. 					this._root._oncreate.push(_oncreate);
227. 				}
228. 			`}
229. 		`}
230. 
231. 		${generator.slots.size && `this.slots = {};`}
232. 
233. 		this._fragment = @create_main_fragment(this._state, this);
234. 
235. 		${generator.customElement ? deindent`
236. 			this._fragment.c();
237. 			this._fragment.${block.hasIntroMethod ? 'i' : 'm'}(this.shadowRoot, null);
238. 
239. 			if (options.target) this._mount(options.target, options.anchor || null);
240. 		` : deindent`
241. 			if (options.target) {
242. 				${generator.hydratable
243. 					? deindent`
244. 						var nodes = @children(options.target);
245. 						options.hydrate ? this._fragment.l(nodes) : this._fragment.c();
246. 						nodes.forEach(@detachNode);
247. 					` :
248. 					deindent`
249. 						${options.dev && `if (options.hydrate) throw new Error("options.hydrate only works if the component was compiled with the \`hydratable: true\` option");`}
250. 						this._fragment.c();
251. 					`}
252. 				this._fragment.${block.hasIntroMethod ? 'i' : 'm'}(options.target, options.anchor || null);
253. 
254. 				${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`
255. 					${generator.hasComponents && `this._lock = true;`}
256. 					${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}
257. 					${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}
258. 					${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}
259. 					${generator.hasComponents && `this._lock = false;`}
260. 				`}
261. 			}
262. 		`}
263. 	`;
264. 
265. 	if (generator.customElement) {
266. 		const props = generator.props || Array.from(generator.expectedProperties);
267. 
268. 		builder.addBlock(deindent`
269. 			class ${name} extends HTMLElement {
270. 				constructor(options = {}) {
271. 					super();
272. 					${constructorBody}
273. 				}
274. 
275. 				static get observedAttributes() {
276. 					return ${JSON.stringify(props)};
277. 				}
278. 
279. 				${props.map(prop => deindent`
280. 					get ${prop}() {
281. 						return this.get('${prop}');
282. 					}
283. 
284. 					set ${prop}(value) {
285. 						this.set({ ${prop}: value });
286. 					}
287. 				`).join('\n\n')}
288. 
289. 				${generator.slots.size && deindent`
290. 					connectedCallback() {
291. 						Object.keys(this._slotted).forEach(key => {
292. 							this.appendChild(this._slotted[key]);
293. 						});
294. 					}`}
295. 
296. 				attributeChangedCallback(attr, oldValue, newValue) {
297. 					this.set({ [attr]: newValue });
298. 				}
299. 			}
300. 
301. 			customElements.define("${generator.tag}", ${name});
302. 			@assign(${prototypeBase}, ${proto}, {
303. 				_mount(target, anchor) {
304. 					target.insertBefore(this, anchor);
305. 				},
306. 
307. 				_unmount() {
308. 					this.parentNode.removeChild(this);
309. 				}
310. 			});
311. 		`);
312. 	} else {
313. 		builder.addBlock(deindent`
314. 			function ${name}(options) {
315. 				${constructorBody}
316. 			}
317. 
318. 			@assign(${prototypeBase}, ${proto});
319. 		`);
320. 	}
321. 
322. 	builder.addBlock(deindent`
323. 		${options.dev && deindent`
324. 			${name}.prototype._checkReadOnly = function _checkReadOnly(newState) {
325. 				${Array.from(generator.readonly).map(
326. 					prop =>
327. 						`if ('${prop}' in newState && !this._updatingReadonlyProperty) throw new Error("${debugName}: Cannot set read-only property '${prop}'");`
328. 				)}
329. 			};
330. 		`}
331. 
332. 		${computations.length ? deindent`
333. 			${name}.prototype._recompute = function _recompute(changed, state) {
334. 				${computationBuilder}
335. 			}
336. 		` : (!sharedPath && `${name}.prototype._recompute = @noop;`)}
337. 
338. 		${templateProperties.setup && `%setup(${name});`}
339. 	`);
340. 
341. 	const usedHelpers = new Set();
342. 
343. 	let result = builder
344. 		.toString()
345. 		.replace(/(%+|@+)(\w*(?:-\w*)?)/g, (match: string, sigil: string, name: string) => {
346. 			if (sigil === '@') {
347. 				if (name in shared) {
348. 					if (options.dev && `${name}Dev` in shared) name = `${name}Dev`;
349. 					usedHelpers.add(name);
350. 				}
351. 
352. 				return generator.alias(name);
353. 			}
354. 
355. 			if (sigil === '%') {
356. 				return generator.templateVars.get(name);
357. 			}
358. 
359. 			return sigil.slice(1) + name;
360. 		});
361. 
362. 	let helpers;
363. 
364. 	if (sharedPath) {
365. 		if (format !== 'es' && format !== 'cjs') {
366. 			throw new Error(`Components with shared helpers must be compiled with \`format: 'es'\` or \`format: 'cjs'\``);
367. 		}
368. 		const used = Array.from(usedHelpers).sort();
369. 		helpers = used.map(name => {
370. 			const alias = generator.alias(name);
371. 			return { name, alias };
372. 		});
373. 	} else {
374. 		let inlineHelpers = '';
375. 
376. 		usedHelpers.forEach(key => {
377. 			const str = shared[key];
378. 			const code = new MagicString(str);
379. 			const expression = parseExpressionAt(str, 0);
380. 
381. 			let scope = annotateWithScopes(expression);
382. 
383. 			walk(expression, {
384. 				enter(node: Node, parent: Node) {
385. 					if (node._scope) scope = node._scope;
386. 
387. 					if (
388. 						node.type === 'Identifier' &&
389. 						isReference(node, parent) &&
390. 						!scope.has(node.name)
391. 					) {
392. 						if (node.name in shared) {
393. 							// this helper function depends on another one
394. 							const dependency = node.name;
395. 							usedHelpers.add(dependency);
396. 
397. 							const alias = generator.alias(dependency);
398. 							if (alias !== node.name)
399. 								code.overwrite(node.start, node.end, alias);
400. 						}
401. 					}
402. 				},
403. 
404. 				leave(node: Node) {
405. 					if (node._scope) scope = scope.parent;
406. 				},
407. 			});
408. 
409. 			if (key === 'transitionManager') {
410. 				// special case
411. 				const global = `_svelteTransitionManager`;
412. 
413. 				inlineHelpers += `\n\nvar ${generator.alias('transitionManager')} = window.${global} || (window.${global} = ${code});\n\n`;
414. 			} else {
415. 				const alias = generator.alias(expression.id.name);
416. 				if (alias !== expression.id.name)
417. 					code.overwrite(expression.id.start, expression.id.end, alias);
418. 
419. 				inlineHelpers += `\n\n${code}`;
420. 			}
421. 		});
422. 
423. 		result += inlineHelpers;
424. 	}
425. 
426. 	const filename = options.filename && (
427. 		typeof process !== 'undefined' ? options.filename.replace(process.cwd(), '').replace(/^[\/\\]/, '') : options.filename
428. 	);
429. 
430. 	return generator.generate(result, options, {
431. 		banner: `/* ${filename ? `${filename} ` : ``}generated by Svelte v${version} */`,
432. 		sharedPath,
433. 		helpers,
434. 		name,
435. 		format,
436. 	});
437. }


File: src/generators/dom/visitors/Component.ts
Line number range: 1 - 449
Content:
1. import deindent from '../../../utils/deindent';
2. import CodeBuilder from '../../../utils/CodeBuilder';
3. import visit from '../visit';
4. import { DomGenerator } from '../index';
5. import Block from '../Block';
6. import getTailSnippet from '../../../utils/getTailSnippet';
7. import getObject from '../../../utils/getObject';
8. import getExpressionPrecedence from '../../../utils/getExpressionPrecedence';
9. import { stringify } from '../../../utils/stringify';
10. import { Node } from '../../../interfaces';
11. import { State } from '../interfaces';
12. 
13. function stringifyProps(props: string[]) {
14. 	if (!props.length) return '{}';
15. 
16. 	const joined = props.join(', ');
17. 	if (joined.length > 40) {
18. 		// make larger data objects readable
19. 		return `{\n\t${props.join(',\n\t')}\n}`;
20. 	}
21. 
22. 	return `{ ${joined} }`;
23. }
24. 
25. interface Attribute {
26. 	name: string;
27. 	value: any;
28. 	dynamic: boolean;
29. 	dependencies?: string[]
30. }
31. 
32. interface Binding {
33. 	name: string;
34. 	value: Node;
35. 	contexts: Set<string>;
36. 	snippet: string;
37. 	obj: string;
38. 	prop: string;
39. 	dependencies: string[];
40. }
41. 
42. export default function visitComponent(
43. 	generator: DomGenerator,
44. 	block: Block,
45. 	state: State,
46. 	node: Node,
47. 	elementStack: Node[],
48. 	componentStack: Node[]
49. ) {
50. 	generator.hasComponents = true;
51. 
52. 	const name = node.var;
53. 
54. 	const componentInitProperties = [`_root: #component._root`];
55. 
56. 	if (node.children.length > 0) {
57. 		const slots = Array.from(node._slots).map(name => `${name}: @createFragment()`);
58. 		componentInitProperties.push(`slots: { ${slots.join(', ')} }`);
59. 
60. 		node.children.forEach((child: Node) => {
61. 			visit(generator, block, node._state, child, elementStack, componentStack.concat(node));
62. 		});
63. 	}
64. 
65. 	const allContexts = new Set();
66. 	const statements: string[] = [];
67. 	const name_context = block.getUniqueName(`${name}_context`);
68. 
69. 	let name_updating: string;
70. 	let name_initial_data: string;
71. 	let beforecreate: string = null;
72. 
73. 	const attributes = node.attributes
74. 		.filter((a: Node) => a.type === 'Attribute')
75. 		.map((a: Node) => mungeAttribute(a, block));
76. 
77. 	const bindings = node.attributes
78. 		.filter((a: Node) => a.type === 'Binding')
79. 		.map((a: Node) => mungeBinding(a, block));
80. 
81. 	if (attributes.length || bindings.length) {
82. 		const initialProps = attributes
83. 			.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);
84. 
85. 		const initialPropString = stringifyProps(initialProps);
86. 
87. 		const updates: string[] = [];
88. 
89. 		attributes
90. 			.filter((attribute: Attribute) => attribute.dynamic)
91. 			.forEach((attribute: Attribute) => {
92. 				if (attribute.dependencies.length) {
93. 					updates.push(deindent`
94. 						if (${attribute.dependencies
95. 							.map(dependency => `changed.${dependency}`)
96. 							.join(' || ')}) ${name}_changes.${attribute.name} = ${attribute.value};
97. 					`);
98. 				}
99. 
100. 				else {
101. 					// TODO this is an odd situation to encounter – I *think* it should only happen with
102. 					// each block indices, in which case it may be possible to optimise this
103. 					updates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);
104. 				}
105. 			});
106. 
107. 		if (bindings.length) {
108. 			generator.hasComplexBindings = true;
109. 
110. 			name_updating = block.alias(`${name}_updating`);
111. 			name_initial_data = block.getUniqueName(`${name}_initial_data`);
112. 
113. 			block.addVariable(name_updating, '{}');
114. 			statements.push(`var ${name_initial_data} = ${initialPropString};`);
115. 
116. 			const setParentFromChildOnChange = new CodeBuilder();
117. 			const setParentFromChildOnInit = new CodeBuilder();
118. 
119. 			bindings.forEach((binding: Binding) => {
120. 				let setParentFromChild;
121. 
122. 				binding.contexts.forEach(context => {
123. 					allContexts.add(context);
124. 				});
125. 
126. 				const { name: key } = getObject(binding.value);
127. 
128. 				if (block.contexts.has(key)) {
129. 					const prop = binding.dependencies[0];
130. 					const computed = isComputed(binding.value);
131. 					const tail = binding.value.type === 'MemberExpression' ? getTailSnippet(binding.value) : '';
132. 
133. 					setParentFromChild = deindent`
134. 						var list = ${name_context}.${block.listNames.get(key)};
135. 						var index = ${name_context}.${block.indexNames.get(key)};
136. 						list[index]${tail} = childState.${binding.name};
137. 
138. 						${binding.dependencies
139. 							.map((prop: string) => `newState.${prop} = state.${prop};`)
140. 							.join('\n')}
141. 					`;
142. 				}
143. 
144. 				else if (binding.value.type === 'MemberExpression') {
145. 					setParentFromChild = deindent`
146. 						${binding.snippet} = childState.${binding.name};
147. 						${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join('\n')}
148. 					`;
149. 				}
150. 
151. 				else {
152. 					setParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;
153. 				}
154. 
155. 				statements.push(deindent`
156. 					if (${binding.prop} in ${binding.obj}) {
157. 						${name_initial_data}.${binding.name} = ${binding.snippet};
158. 						${name_updating}.${binding.name} = true;
159. 					}`
160. 				);
161. 
162. 				setParentFromChildOnChange.addConditional(
163. 					`!${name_updating}.${binding.name} && changed.${binding.name}`,
164. 					setParentFromChild
165. 				);
166. 
167. 				setParentFromChildOnInit.addConditional(
168. 					`!${name_updating}.${binding.name}`,
169. 					setParentFromChild
170. 				);
171. 
172. 				// TODO could binding.dependencies.length ever be 0?
173. 				if (binding.dependencies.length) {
174. 					updates.push(deindent`
175. 						if (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(' || ')}) {
176. 							${name}_changes.${binding.name} = ${binding.snippet};
177. 							${name_updating}.${binding.name} = true;
178. 						}
179. 					`);
180. 				}
181. 			});
182. 
183. 			componentInitProperties.push(`data: ${name_initial_data}`);
184. 
185. 			componentInitProperties.push(deindent`
186. 				_bind: function(changed, childState) {
187. 					var state = #component.get(), newState = {};
188. 					${setParentFromChildOnChange}
189. 					${name_updating} = @assign({}, changed);
190. 					#component._set(newState);
191. 					${name_updating} = {};
192. 				}
193. 			`);
194. 
195. 			beforecreate = deindent`
196. 				#component._root._beforecreate.push(function () {
197. 					var state = #component.get(), childState = ${name}.get(), newState = {};
198. 					if (!childState) return;
199. 					${setParentFromChildOnInit}
200. 					${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(', ')} };
201. 					#component._set(newState);
202. 					${name_updating} = {};
203. 				});
204. 			`;
205. 		} else if (initialProps.length) {
206. 			componentInitProperties.push(`data: ${initialPropString}`);
207. 		}
208. 
209. 		if (updates.length) {
210. 			block.builders.update.addBlock(deindent`
211. 				var ${name}_changes = {};
212. 				${updates.join('\n')}
213. 				${name}._set( ${name}_changes );
214. 				${bindings.length && `${name_updating} = {};`}
215. 			`);
216. 		}
217. 	}
218. 
219. 	const expression = node.name === ':Self' ? generator.name : `%components-${node.name}`;
220. 
221. 	block.builders.init.addBlock(deindent`
222. 		${statements.join('\n')}
223. 		var ${name} = new ${expression}({
224. 			${componentInitProperties.join(',\n')}
225. 		});
226. 
227. 		${beforecreate}
228. 	`);
229. 
230. 	block.builders.create.addLine(`${name}._fragment.c();`);
231. 
232. 	block.builders.claim.addLine(
233. 		`${name}._fragment.l( ${state.parentNodes} );`
234. 	);
235. 
236. 	block.builders.mount.addLine(
237. 		`${name}._mount(${state.parentNode || '#target'}, ${state.parentNode ? 'null' : 'anchor'});`
238. 	);
239. 
240. 	if (!state.parentNode) block.builders.unmount.addLine(`${name}._unmount();`);
241. 
242. 	block.builders.destroy.addLine(`${name}.destroy(false);`);
243. 
244. 	// event handlers
245. 	node.attributes.filter((a: Node) => a.type === 'EventHandler').forEach((handler: Node) => {
246. 		const usedContexts: string[] = [];
247. 
248. 		if (handler.expression) {
249. 			generator.addSourcemapLocations(handler.expression);
250. 			generator.code.prependRight(
251. 				handler.expression.start,
252. 				`${block.alias('component')}.`
253. 			);
254. 
255. 			handler.expression.arguments.forEach((arg: Node) => {
256. 				const { contexts } = block.contextualise(arg, null, true);
257. 
258. 				contexts.forEach(context => {
259. 					if (!~usedContexts.indexOf(context)) usedContexts.push(context);
260. 					allContexts.add(context);
261. 				});
262. 			});
263. 		}
264. 
265. 		// TODO hoist event handlers? can do `this.__component.method(...)`
266. 		const declarations = usedContexts.map(name => {
267. 			if (name === 'state') return `var state = ${name_context}.state;`;
268. 
269. 			const listName = block.listNames.get(name);
270. 			const indexName = block.indexNames.get(name);
271. 
272. 			return `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;
273. 		});
274. 
275. 		const handlerBody =
276. 			(declarations.length ? declarations.join('\n') + '\n\n' : '') +
277. 			(handler.expression ?
278. 				`[✂${handler.expression.start}-${handler.expression.end}✂];` :
279. 				`${block.alias('component')}.fire('${handler.name}', event);`);
280. 
281. 		block.builders.init.addBlock(deindent`
282. 			${name}.on("${handler.name}", function(event) {
283. 				${handlerBody}
284. 			});
285. 		`);
286. 	});
287. 
288. 	// refs
289. 	node.attributes.filter((a: Node) => a.type === 'Ref').forEach((ref: Node) => {
290. 		generator.usesRefs = true;
291. 
292. 		block.builders.init.addLine(`#component.refs.${ref.name} = ${name};`);
293. 
294. 		block.builders.destroy.addLine(deindent`
295. 			if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;
296. 		`);
297. 	});
298. 
299. 	// maintain component context
300. 	if (allContexts.size) {
301. 		const contexts = Array.from(allContexts);
302. 
303. 		const initialProps = contexts
304. 			.map(contextName => {
305. 				if (contextName === 'state') return `state: state`;
306. 
307. 				const listName = block.listNames.get(contextName);
308. 				const indexName = block.indexNames.get(contextName);
309. 
310. 				return `${listName}: ${listName},\n${indexName}: ${indexName}`;
311. 			})
312. 			.join(',\n');
313. 
314. 		const updates = contexts
315. 			.map(contextName => {
316. 				if (contextName === 'state') return `${name_context}.state = state;`;
317. 
318. 				const listName = block.listNames.get(contextName);
319. 				const indexName = block.indexNames.get(contextName);
320. 
321. 				return `${name_context}.${listName} = ${listName};\n${name_context}.${indexName} = ${indexName};`;
322. 			})
323. 			.join('\n');
324. 
325. 		block.builders.init.addBlock(deindent`
326. 			var ${name_context} = {
327. 				${initialProps}
328. 			};
329. 		`);
330. 
331. 		block.builders.update.addBlock(updates);
332. 	}
333. }
334. 
335. function mungeAttribute(attribute: Node, block: Block): Attribute {
336. 	if (attribute.value === true) {
337. 		// attributes without values, e.g. <textarea readonly>
338. 		return {
339. 			name: attribute.name,
340. 			value: true,
341. 			dynamic: false
342. 		};
343. 	}
344. 
345. 	if (attribute.value.length === 0) {
346. 		return {
347. 			name: attribute.name,
348. 			value: `''`,
349. 			dynamic: false
350. 		};
351. 	}
352. 
353. 	if (attribute.value.length === 1) {
354. 		const value = attribute.value[0];
355. 
356. 		if (value.type === 'Text') {
357. 			// static attributes
358. 			return {
359. 				name: attribute.name,
360. 				value: isNaN(value.data) ? stringify(value.data) : value.data,
361. 				dynamic: false
362. 			};
363. 		}
364. 
365. 		// simple dynamic attributes
366. 		const { dependencies, snippet } = block.contextualise(value.expression);
367. 
368. 		// TODO only update attributes that have changed
369. 		return {
370. 			name: attribute.name,
371. 			value: snippet,
372. 			dependencies,
373. 			dynamic: true
374. 		};
375. 	}
376. 
377. 	// otherwise we're dealing with a complex dynamic attribute
378. 	const allDependencies = new Set();
379. 
380. 	const value =
381. 		(attribute.value[0].type === 'Text' ? '' : `"" + `) +
382. 		attribute.value
383. 			.map((chunk: Node) => {
384. 				if (chunk.type === 'Text') {
385. 					return stringify(chunk.data);
386. 				} else {
387. 					const { dependencies, snippet } = block.contextualise(
388. 						chunk.expression
389. 					);
390. 
391. 					dependencies.forEach(dependency => {
392. 						allDependencies.add(dependency);
393. 					});
394. 
395. 					return getExpressionPrecedence(chunk.expression) <= 13 ? `( ${snippet} )` : snippet;
396. 				}
397. 			})
398. 			.join(' + ');
399. 
400. 	return {
401. 		name: attribute.name,
402. 		value,
403. 		dependencies: Array.from(allDependencies),
404. 		dynamic: true
405. 	};
406. }
407. 
408. function mungeBinding(binding: Node, block: Block): Binding {
409. 	const { name } = getObject(binding.value);
410. 	const { snippet, contexts, dependencies } = block.contextualise(
411. 		binding.value
412. 	);
413. 
414. 	const contextual = block.contexts.has(name);
415. 
416. 	let obj;
417. 	let prop;
418. 
419. 	if (contextual) {
420. 		obj = block.listNames.get(name);
421. 		prop = block.indexNames.get(name);
422. 	} else if (binding.value.type === 'MemberExpression') {
423. 		prop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;
424. 		if (!binding.value.computed) prop = `'${prop}'`;
425. 		obj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;
426. 	} else {
427. 		obj = 'state';
428. 		prop = `'${name}'`;
429. 	}
430. 
431. 	return {
432. 		name: binding.name,
433. 		value: binding.value,
434. 		contexts,
435. 		snippet,
436. 		obj,
437. 		prop,
438. 		dependencies
439. 	};
440. }
441. 
442. function isComputed(node: Node) {
443. 	while (node.type === 'MemberExpression') {
444. 		if (node.computed) return true;
445. 		node = node.object;
446. 	}
447. 
448. 	return false;
449. }


File: src/generators/server-side-rendering/visitors/Component.ts
Line number range: 1 - 103
Content:
1. import flattenReference from '../../../utils/flattenReference';
2. import visit from '../visit';
3. import { SsrGenerator } from '../index';
4. import Block from '../Block';
5. import { AppendTarget } from '../interfaces';
6. import { Node } from '../../../interfaces';
7. import getObject from '../../../utils/getObject';
8. import getTailSnippet from '../../../utils/getTailSnippet';
9. import { stringify } from '../../../utils/stringify';
10. 
11. export default function visitComponent(
12. 	generator: SsrGenerator,
13. 	block: Block,
14. 	node: Node
15. ) {
16. 	function stringifyAttribute(chunk: Node) {
17. 		if (chunk.type === 'Text') return chunk.data;
18. 		if (chunk.type === 'MustacheTag') {
19. 			const { snippet } = block.contextualise(chunk.expression);
20. 			return '${__escape( ' + snippet + ')}';
21. 		}
22. 	}
23. 
24. 	const attributes: Node[] = [];
25. 	const bindings: Node[] = [];
26. 
27. 	node.attributes.forEach((attribute: Node) => {
28. 		if (attribute.type === 'Attribute') {
29. 			attributes.push(attribute);
30. 		} else if (attribute.type === 'Binding') {
31. 			bindings.push(attribute);
32. 		}
33. 	});
34. 
35. 	const props = attributes
36. 		.map(attribute => {
37. 			let value;
38. 
39. 			if (attribute.value === true) {
40. 				value = `true`;
41. 			} else if (attribute.value.length === 0) {
42. 				value = `''`;
43. 			} else if (attribute.value.length === 1) {
44. 				const chunk = attribute.value[0];
45. 				if (chunk.type === 'Text') {
46. 					value = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;
47. 				} else {
48. 					const { snippet } = block.contextualise(chunk.expression);
49. 					value = snippet;
50. 				}
51. 			} else {
52. 				value = '`' + attribute.value.map(stringifyAttribute).join('') + '`';
53. 			}
54. 
55. 			return `${attribute.name}: ${value}`;
56. 		})
57. 		.concat(
58. 			bindings.map(binding => {
59. 				const { name } = getObject(binding.value);
60. 				const tail = binding.value.type === 'MemberExpression'
61. 					? getTailSnippet(binding.value)
62. 					: '';
63. 
64. 				const keypath = block.contexts.has(name)
65. 					? `${name}${tail}`
66. 					: `state.${name}${tail}`;
67. 				return `${binding.name}: ${keypath}`;
68. 			})
69. 		)
70. 		.join(', ');
71. 
72. 	const expression = node.name === ':Self' ? generator.name : `%components-${node.name}`;
73. 
74. 	bindings.forEach(binding => {
75. 		block.addBinding(binding, expression);
76. 	});
77. 
78. 	let open = `\${${expression}.render({${props}}`;
79. 
80. 	if (node.children.length) {
81. 		const appendTarget: AppendTarget = {
82. 			slots: { default: '' },
83. 			slotStack: ['default']
84. 		};
85. 
86. 		generator.appendTargets.push(appendTarget);
87. 
88. 		node.children.forEach((child: Node) => {
89. 			visit(generator, block, child);
90. 		});
91. 
92. 		const slotted = Object.keys(appendTarget.slots)
93. 			.map(name => `${name}: () => \`${appendTarget.slots[name]}\``)
94. 			.join(', ');
95. 
96. 		open += `, { slotted: { ${slotted} } }`;
97. 
98. 		generator.appendTargets.pop();
99. 	}
100. 
101. 	generator.append(open);
102. 	generator.append(')}');
103. }


File: src/utils/CodeBuilder.ts
Line number range: 1 - 163
Content:
1. import repeat from './repeat';
2. 
3. enum ChunkType {
4. 	Line,
5. 	Block
6. }
7. 
8. interface Condition {
9. 	condition: string;
10. 	used: boolean;
11. }
12. 
13. export default class CodeBuilder {
14. 	result: string;
15. 	first: ChunkType;
16. 	last: ChunkType;
17. 	lastCondition: string;
18. 	conditionStack: Condition[];
19. 	indent: string;
20. 
21. 	constructor(str = '') {
22. 		this.result = str;
23. 
24. 		const initial = str
25. 			? /\n/.test(str) ? ChunkType.Block : ChunkType.Line
26. 			: null;
27. 		this.first = initial;
28. 		this.last = initial;
29. 
30. 		this.lastCondition = null;
31. 		this.conditionStack = [];
32. 		this.indent = '';
33. 	}
34. 
35. 	addConditional(condition: string, body: string) {
36. 		this.reifyConditions();
37. 
38. 		body = body.replace(/^/gm, `${this.indent}\t`);
39. 
40. 		if (condition === this.lastCondition) {
41. 			this.result += `\n${body}`;
42. 		} else {
43. 			if (this.lastCondition) {
44. 				this.result += `\n${this.indent}}`;
45. 			}
46. 
47. 			this.result += `${this.last === ChunkType.Block ? '\n\n' : '\n'}${this.indent}if (${condition}) {\n${body}`;
48. 			this.lastCondition = condition;
49. 		}
50. 
51. 		this.last = ChunkType.Block;
52. 	}
53. 
54. 	addLine(line: string) {
55. 		this.reifyConditions();
56. 
57. 		if (this.lastCondition) {
58. 			this.result += `\n${this.indent}}`;
59. 			this.lastCondition = null;
60. 		}
61. 
62. 		if (this.last === ChunkType.Block) {
63. 			this.result += `\n\n${this.indent}${line}`;
64. 		} else if (this.last === ChunkType.Line) {
65. 			this.result += `\n${this.indent}${line}`;
66. 		} else {
67. 			this.result += line;
68. 		}
69. 
70. 		this.last = ChunkType.Line;
71. 		if (!this.first) this.first = ChunkType.Line;
72. 	}
73. 
74. 	addLineAtStart(line: string) {
75. 		this.reifyConditions();
76. 
77. 		if (this.first === ChunkType.Block) {
78. 			this.result = `${line}\n\n${this.indent}${this.result}`;
79. 		} else if (this.first === ChunkType.Line) {
80. 			this.result = `${line}\n${this.indent}${this.result}`;
81. 		} else {
82. 			this.result += line;
83. 		}
84. 
85. 		this.first = ChunkType.Line;
86. 		if (!this.last) this.last = ChunkType.Line;
87. 	}
88. 
89. 	addBlock(block: string) {
90. 		this.reifyConditions();
91. 
92. 		if (this.indent) block = block.replace(/^/gm, `${this.indent}`);
93. 
94. 		if (this.lastCondition) {
95. 			this.result += `\n${this.indent}}`;
96. 			this.lastCondition = null;
97. 		}
98. 
99. 		if (this.result) {
100. 			this.result += `\n\n${this.indent}${block}`;
101. 		} else {
102. 			this.result += block;
103. 		}
104. 
105. 		this.last = ChunkType.Block;
106. 		if (!this.first) this.first = ChunkType.Block;
107. 	}
108. 
109. 	addBlockAtStart(block: string) {
110. 		this.reifyConditions();
111. 
112. 		if (this.result) {
113. 			this.result = `${block}\n\n${this.indent}${this.result}`;
114. 		} else {
115. 			this.result += block;
116. 		}
117. 
118. 		this.first = ChunkType.Block;
119. 		if (!this.last) this.last = ChunkType.Block;
120. 	}
121. 
122. 	isEmpty() {
123. 		return this.result === '';
124. 	}
125. 
126. 	pushCondition(condition: string) {
127. 		this.conditionStack.push({ condition, used: false });
128. 	}
129. 
130. 	popCondition() {
131. 		const { used } = this.conditionStack.pop();
132. 
133. 		this.indent = repeat('\t', this.conditionStack.length);
134. 		if (used) this.addLine('}');
135. 	}
136. 
137. 	reifyConditions() {
138. 		for (let i = 0; i < this.conditionStack.length; i += 1) {
139. 			const condition = this.conditionStack[i];
140. 			if (!condition.used) {
141. 				const line = `if (${condition.condition}) {`;
142. 
143. 				if (this.last === ChunkType.Block) {
144. 					this.result += `\n\n${this.indent}${line}`;
145. 				} else if (this.last === ChunkType.Line) {
146. 					this.result += `\n${this.indent}${line}`;
147. 				} else {
148. 					this.result += line;
149. 				}
150. 
151. 				this.last = ChunkType.Line;
152. 				if (!this.first) this.first = ChunkType.Line;
153. 
154. 				this.indent = repeat('\t', this.conditionStack.length);
155. 				condition.used = true;
156. 			}
157. 		}
158. 	}
159. 
160. 	toString() {
161. 		return this.result.trim() + (this.lastCondition ? `\n}` : ``);
162. 	}
163. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-11 00:21:25,953 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n- The user requests full contents of src/generators/dom/index.ts to inspect lifecycle hook generation and async handling.\n2. Extended relevance:\n- This file orchestrates DOM code generation, wiring lifecycle hooks (oncreate/ondestroy), encapsulation, CSS injection, helper resolution, and constructor behavior, directly impacting lifecycle behavior.\n- Essential to understanding how hooks are generated and invoked in the DOM output.\n', relative_path='src/generators/dom/index.ts', start_line=1, end_line=437), ContextOutput(reasoning='1. Query requirement analysis:\n- The user requests full contents of src/generators/dom/visitors/Component.ts.\n2. Extended relevance:\n- This visitor handles component instantiation within DOM generation, including bindings, event handlers, refs, and context propagation.\n- It shows how parent-child lifecycle and binding interactions are set up, crucial to lifecycle hook flow.\n', relative_path='src/generators/dom/visitors/Component.ts', start_line=1, end_line=449), ContextOutput(reasoning='1. Query requirement analysis:\n- The user requests full contents of src/generators/server-side-rendering/visitors/Component.ts.\n2. Extended relevance:\n- This file handles SSR component rendering, mapping attributes and bindings, and slot handling.\n- Important to compare lifecycle and async behavior between DOM and SSR outputs.\n', relative_path='src/generators/server-side-rendering/visitors/Component.ts', start_line=1, end_line=103), ContextOutput(reasoning='1. Query requirement analysis:\n- The user requests full contents of src/generators/Generator.ts.\n2. Extended relevance:\n- Generator parses JS, extracts template properties (including oncreate/ondestroy), components, helpers, computed values, and sets up code snippets.\n- Critical to see how lifecycle hooks are detected and transformed, and whether async constructs are altered.\n', relative_path='src/generators/Generator.ts', start_line=1, end_line=950), ContextOutput(reasoning='1. Query requirement analysis:\n- The user requests full contents of src/utils/CodeBuilder.ts.\n2. Extended relevance:\n- CodeBuilder is used throughout generation to build blocks/conditions; understanding it is necessary to follow how lifecycle and other code blocks are assembled.\n', relative_path='src/utils/CodeBuilder.ts', start_line=1, end_line=163)]
2025-11-11 00:21:25,959 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 5 contexts to memory for query: Please provide the full contents (with line numbers) of src/generators/dom/index.ts, src/generators/dom/visitors/Component.ts, src/generators/server-side-rendering/visitors/Component.ts, src/generators/Generator.ts, and src/utils/CodeBuilder.ts.
2025-11-11 00:21:26,309 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-11 00:21:26,311 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 5 new contexts to 8 existing contexts
2025-11-11 00:21:26,311 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 13 total contexts (removed 0 duplicates)
2025-11-11 00:21:26,313 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents (with line numbers) of src/generators/shared/utils/wrapModule.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/propValidators/onrender.ts, src/validate/js/propValidators/ondestroy.ts, src/validate/js/propValidators/onteardown.ts, and test/js/samples/onrender-onteardown-rewritten/{input.html,expected.js,expected-bundle.js}.
Extra Requirements: If README.md documents lifecycle hooks or async support, include the relevant section with line numbers; if sending all files is too large, prioritize wrapModule.ts and oncreate.ts plus the test expected.js.
Purpose: This context will reveal whether async is intentionally removed during code generation or disallowed by validation, enabling accurate classification of the issue.

Previous refined query 2:
Essential Query: Please provide the full contents (with line numbers) of src/generators/dom/index.ts, src/generators/dom/visitors/Component.ts, src/generators/server-side-rendering/visitors/Component.ts, src/generators/Generator.ts, and src/utils/CodeBuilder.ts.
Extra Requirements: If README.md documents lifecycle hooks or async usage, include the relevant section with line numbers; if sending all files is too large, prioritize the two Component.ts files and dom/index.ts.
Purpose: These files will reveal how lifecycle hooks are generated and whether async is intentionally stripped, enabling accurate issue classification.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: src/generators/Generator.ts
Line number range: 1 - 950
Content:
1. import MagicString, { Bundle } from 'magic-string';
2. import { walk } from 'estree-walker';
3. import { getLocator } from 'locate-character';
4. import deindent from '../utils/deindent';
5. import CodeBuilder from '../utils/CodeBuilder';
6. import getCodeFrame from '../utils/getCodeFrame';
7. import isReference from '../utils/isReference';
8. import flattenReference from '../utils/flattenReference';
9. import globalWhitelist from '../utils/globalWhitelist';
10. import reservedNames from '../utils/reservedNames';
11. import namespaces from '../utils/namespaces';
12. import { removeNode, removeObjectKey } from '../utils/removeNode';
13. import wrapModule from './shared/utils/wrapModule';
14. import annotateWithScopes from '../utils/annotateWithScopes';
15. import clone from '../utils/clone';
16. import DomBlock from './dom/Block';
17. import SsrBlock from './server-side-rendering/Block';
18. import Stylesheet from '../css/Stylesheet';
19. import { Node, GenerateOptions, Parsed, CompileOptions, CustomElementOptions } from '../interfaces';
20. 
21. const test = typeof global !== 'undefined' && global.__svelte_test;
22. 
23. interface Computation {
24. 	key: string;
25. 	deps: string[]
26. }
27. 
28. function detectIndentation(str: string) {
29. 	const pattern = /^[\t\s]{1,4}/gm;
30. 	let match;
31. 
32. 	while (match = pattern.exec(str)) {
33. 		if (match[0][0] === '\t') return '\t';
34. 		if (match[0].length === 2) return '  ';
35. 	}
36. 
37. 	return '    ';
38. }
39. 
40. function getIndentationLevel(str: string, b: number) {
41. 	let a = b;
42. 	while (a > 0 && str[a - 1] !== '\n') a -= 1;
43. 	return /^\s*/.exec(str.slice(a, b))[0];
44. }
45. 
46. function getIndentExclusionRanges(node: Node) {
47. 	const ranges: Node[] = [];
48. 	walk(node, {
49. 		enter(node: Node) {
50. 			if (node.type === 'TemplateElement') ranges.push(node);
51. 		}
52. 	});
53. 	return ranges;
54. }
55. 
56. function removeIndentation(
57. 	code: MagicString,
58. 	start: number,
59. 	end: number,
60. 	indentationLevel: string,
61. 	ranges: Node[]
62. ) {
63. 	const str = code.original.slice(start, end);
64. 	const pattern = new RegExp(`^${indentationLevel}`, 'gm');
65. 	let match;
66. 
67. 	while (match = pattern.exec(str)) {
68. 		// TODO bail if we're inside an exclusion range
69. 		code.remove(start + match.index, start + match.index + indentationLevel.length);
70. 	}
71. }
72. 
73. export default class Generator {
74. 	ast: Parsed;
75. 	parsed: Parsed;
76. 	source: string;
77. 	name: string;
78. 	options: CompileOptions;
79. 
80. 	customElement: CustomElementOptions;
81. 	tag: string;
82. 	props: string[];
83. 
84. 	defaultExport: Node[];
85. 	imports: Node[];
86. 	helpers: Set<string>;
87. 	components: Set<string>;
88. 	events: Set<string>;
89. 	transitions: Set<string>;
90. 	importedComponents: Map<string, string>;
91. 	namespace: string;
92. 	hasComponents: boolean;
93. 	computations: Computation[];
94. 	templateProperties: Record<string, Node>;
95. 	slots: Set<string>;
96. 	javascript: string;
97. 
98. 	code: MagicString;
99. 
100. 	bindingGroups: string[];
101. 	indirectDependencies: Map<string, Set<string>>;
102. 	expectedProperties: Set<string>;
103. 	usesRefs: boolean;
104. 
105. 	locate: (c: number) => { line: number, column: number };
106. 
107. 	stylesheet: Stylesheet;
108. 
109. 	userVars: Set<string>;
110. 	templateVars: Map<string, string>;
111. 	aliases: Map<string, string>;
112. 	usedNames: Set<string>;
113. 
114. 	constructor(
115. 		parsed: Parsed,
116. 		source: string,
117. 		name: string,
118. 		stylesheet: Stylesheet,
119. 		options: CompileOptions,
120. 		dom: boolean
121. 	) {
122. 		this.ast = clone(parsed);
123. 
124. 		this.parsed = parsed;
125. 		this.source = source;
126. 		this.options = options;
127. 
128. 		this.imports = [];
129. 		this.helpers = new Set();
130. 		this.components = new Set();
131. 		this.events = new Set();
132. 		this.transitions = new Set();
133. 		this.importedComponents = new Map();
134. 		this.slots = new Set();
135. 
136. 		this.bindingGroups = [];
137. 		this.indirectDependencies = new Map();
138. 
139. 		this.locate = getLocator(this.source);
140. 
141. 		// track which properties are needed, so we can provide useful info
142. 		// in dev mode
143. 		this.expectedProperties = new Set();
144. 
145. 		this.code = new MagicString(source);
146. 		this.usesRefs = false;
147. 
148. 		// styles
149. 		this.stylesheet = stylesheet;
150. 
151. 		// allow compiler to deconflict user's `import { get } from 'whatever'` and
152. 		// Svelte's builtin `import { get, ... } from 'svelte/shared.ts'`;
153. 		this.userVars = new Set();
154. 		this.templateVars = new Map();
155. 		this.aliases = new Map();
156. 		this.usedNames = new Set();
157. 
158. 		this.parseJs(dom);
159. 		this.name = this.alias(name);
160. 
161. 		if (options.customElement === true) {
162. 			this.customElement = {
163. 				tag: this.tag,
164. 				props: this.props // TODO autofill this in
165. 			}
166. 		} else {
167. 			this.customElement = options.customElement;
168. 		}
169. 
170. 		if (this.customElement && !this.customElement.tag) {
171. 			throw new Error(`No tag name specified`); // TODO better error
172. 		}
173. 	}
174. 
175. 	addSourcemapLocations(node: Node) {
176. 		walk(node, {
177. 			enter: (node: Node) => {
178. 				this.code.addSourcemapLocation(node.start);
179. 				this.code.addSourcemapLocation(node.end);
180. 			},
181. 		});
182. 	}
183. 
184. 	alias(name: string) {
185. 		if (!this.aliases.has(name)) {
186. 			this.aliases.set(name, this.getUniqueName(name));
187. 		}
188. 
189. 		return this.aliases.get(name);
190. 	}
191. 
192. 	contextualise(
193. 		block: DomBlock | SsrBlock,
194. 		expression: Node,
195. 		context: string,
196. 		isEventHandler: boolean
197. 	): {
198. 		dependencies: string[],
199. 		contexts: Set<string>,
200. 		indexes: Set<string>,
201. 		snippet: string
202. 	} {
203. 		this.addSourcemapLocations(expression);
204. 
205. 		const usedContexts: Set<string> = new Set();
206. 		const usedIndexes: Set<string> = new Set();
207. 
208. 		const { code, helpers } = this;
209. 		const { contexts, indexes } = block;
210. 
211. 		let scope = annotateWithScopes(expression); // TODO this already happens in findDependencies
212. 		let lexicalDepth = 0;
213. 
214. 		const self = this;
215. 
216. 		walk(expression, {
217. 			enter(node: Node, parent: Node, key: string) {
218. 				if (/^Function/.test(node.type)) lexicalDepth += 1;
219. 
220. 				if (node._scope) {
221. 					scope = node._scope;
222. 					return;
223. 				}
224. 
225. 				if (node.type === 'ThisExpression') {
226. 					if (lexicalDepth === 0 && context)
227. 						code.overwrite(node.start, node.end, context, {
228. 							storeName: true,
229. 							contentOnly: false,
230. 						});
231. 				} else if (isReference(node, parent)) {
232. 					const { name } = flattenReference(node);
233. 					if (scope.has(name)) return;
234. 
235. 					if (name === 'event' && isEventHandler) {
236. 						// noop
237. 					} else if (contexts.has(name)) {
238. 						const contextName = contexts.get(name);
239. 						if (contextName !== name) {
240. 							// this is true for 'reserved' names like `state` and `component`
241. 							code.overwrite(
242. 								node.start,
243. 								node.start + name.length,
244. 								contextName,
245. 								{ storeName: true, contentOnly: false }
246. 							);
247. 						}
248. 
249. 						usedContexts.add(name);
250. 					} else if (helpers.has(name)) {
251. 						let object = node;
252. 						while (object.type === 'MemberExpression') object = object.object;
253. 
254. 						const alias = self.templateVars.get(`helpers-${name}`);
255. 						if (alias !== name) code.overwrite(object.start, object.end, alias);
256. 					} else if (indexes.has(name)) {
257. 						const context = indexes.get(name);
258. 						usedContexts.add(context); // TODO is this right?
259. 						usedIndexes.add(name);
260. 					} else {
261. 						// handle shorthand properties
262. 						if (parent && parent.type === 'Property' && parent.shorthand) {
263. 							if (key === 'key') {
264. 								code.appendLeft(node.start, `${name}: `);
265. 								return;
266. 							}
267. 						}
268. 
269. 						if (globalWhitelist.has(name)) {
270. 							code.prependRight(node.start, `('${name}' in state ? state.`);
271. 							code.appendLeft(
272. 								node.object ? node.object.end : node.end,
273. 								` : ${name})`
274. 							);
275. 						} else {
276. 							code.prependRight(node.start, `state.`);
277. 						}
278. 
279. 						usedContexts.add('state');
280. 					}
281. 
282. 					this.skip();
283. 				}
284. 			},
285. 
286. 			leave(node: Node) {
287. 				if (/^Function/.test(node.type)) lexicalDepth -= 1;
288. 				if (node._scope) scope = scope.parent;
289. 			},
290. 		});
291. 
292. 		const dependencies: Set<string> = new Set(expression._dependencies || []);
293. 
294. 		if (expression._dependencies) {
295. 			expression._dependencies.forEach((prop: string) => {
296. 				if (this.indirectDependencies.has(prop)) {
297. 					this.indirectDependencies.get(prop).forEach(dependency => {
298. 						dependencies.add(dependency);
299. 					});
300. 				}
301. 			});
302. 		}
303. 
304. 		return {
305. 			dependencies: Array.from(dependencies),
306. 			contexts: usedContexts,
307. 			indexes: usedIndexes,
308. 			snippet: `[✂${expression.start}-${expression.end}✂]`,
309. 		};
310. 	}
311. 
312. 	findDependencies(
313. 		contextDependencies: Map<string, string[]>,
314. 		indexes: Map<string, string>,
315. 		expression: Node
316. 	) {
317. 		if (expression._dependencies) return expression._dependencies;
318. 
319. 		let scope = annotateWithScopes(expression);
320. 		const dependencies: string[] = [];
321. 
322. 		const generator = this; // can't use arrow functions, because of this.skip()
323. 
324. 		walk(expression, {
325. 			enter(node: Node, parent: Node) {
326. 				if (node._scope) {
327. 					scope = node._scope;
328. 					return;
329. 				}
330. 
331. 				if (isReference(node, parent)) {
332. 					const { name } = flattenReference(node);
333. 					if (scope.has(name) || generator.helpers.has(name)) return;
334. 
335. 					if (contextDependencies.has(name)) {
336. 						dependencies.push(...contextDependencies.get(name));
337. 					} else if (!indexes.has(name)) {
338. 						dependencies.push(name);
339. 					}
340. 
341. 					this.skip();
342. 				}
343. 			},
344. 
345. 			leave(node: Node) {
346. 				if (node._scope) scope = scope.parent;
347. 			},
348. 		});
349. 
350. 		dependencies.forEach(name => {
351. 			if (!globalWhitelist.has(name)) {
352. 				this.expectedProperties.add(name);
353. 			}
354. 		});
355. 
356. 		return (expression._dependencies = dependencies);
357. 	}
358. 
359. 	generate(result: string, options: CompileOptions, { banner = '', sharedPath, helpers, name, format }: GenerateOptions ) {
360. 		const pattern = /\[✂(\d+)-(\d+)$/;
361. 
362. 		const module = wrapModule(result, format, name, options, banner, sharedPath, helpers, this.imports, this.source);
363. 
364. 		const parts = module.split('✂]');
365. 		const finalChunk = parts.pop();
366. 
367. 		const compiled = new Bundle({ separator: '' });
368. 
369. 		function addString(str: string) {
370. 			compiled.addSource({
371. 				content: new MagicString(str),
372. 			});
373. 		}
374. 
375. 		const { filename } = options;
376. 
377. 		// special case — the source file doesn't actually get used anywhere. we need
378. 		// to add an empty file to populate map.sources and map.sourcesContent
379. 		if (!parts.length) {
380. 			compiled.addSource({
381. 				filename,
382. 				content: new MagicString(this.source).remove(0, this.source.length),
383. 			});
384. 		}
385. 
386. 		parts.forEach((str: string) => {
387. 			const chunk = str.replace(pattern, '');
388. 			if (chunk) addString(chunk);
389. 
390. 			const match = pattern.exec(str);
391. 
392. 			const snippet = this.code.snip(+match[1], +match[2]);
393. 
394. 			compiled.addSource({
395. 				filename,
396. 				content: snippet,
397. 			});
398. 		});
399. 
400. 		addString(finalChunk);
401. 
402. 		const { css, cssMap } = this.customElement ?
403. 			{ css: null, cssMap: null } :
404. 			this.stylesheet.render(options.cssOutputFilename, true);
405. 
406. 		return {
407. 			ast: this.ast,
408. 			code: compiled.toString(),
409. 			map: compiled.generateMap({
410. 				includeContent: true,
411. 				file: options.outputFilename,
412. 			}),
413. 			css,
414. 			cssMap
415. 		};
416. 	}
417. 
418. 	getUniqueName(name: string) {
419. 		if (test) name = `${name}$`;
420. 		let alias = name;
421. 		for (
422. 			let i = 1;
423. 			reservedNames.has(alias) ||
424. 			this.userVars.has(alias) ||
425. 			this.usedNames.has(alias);
426. 			alias = `${name}_${i++}`
427. 		);
428. 		this.usedNames.add(alias);
429. 		return alias;
430. 	}
431. 
432. 	getUniqueNameMaker(params: string[]) {
433. 		const localUsedNames = new Set(params);
434. 
435. 		function add(name: string) {
436. 			localUsedNames.add(name);
437. 		}
438. 
439. 		reservedNames.forEach(add);
440. 		this.userVars.forEach(add);
441. 
442. 		return (name: string) => {
443. 			if (test) name = `${name}$`;
444. 			let alias = name;
445. 			for (
446. 				let i = 1;
447. 				this.usedNames.has(alias) ||
448. 				localUsedNames.has(alias);
449. 				alias = `${name}_${i++}`
450. 			);
451. 			localUsedNames.add(alias);
452. 			return alias;
453. 		};
454. 	}
455. 
456. 	parseJs(dom: boolean) {
457. 		const { code, source } = this;
458. 		const { js } = this.parsed;
459. 
460. 		const imports = this.imports;
461. 		const computations: Computation[] = [];
462. 		const templateProperties: Record<string, Node> = {};
463. 		const componentDefinition = new CodeBuilder();
464. 
465. 		let namespace = null;
466. 
467. 		if (js) {
468. 			this.addSourcemapLocations(js.content);
469. 
470. 			const indentation = detectIndentation(source.slice(js.start, js.end));
471. 			const indentationLevel = getIndentationLevel(source, js.content.body[0].start);
472. 			const indentExclusionRanges = getIndentExclusionRanges(js.content);
473. 
474. 			const scope = annotateWithScopes(js.content);
475. 			scope.declarations.forEach(name => {
476. 				this.userVars.add(name);
477. 			});
478. 
479. 			const body = js.content.body.slice(); // slice, because we're going to be mutating the original
480. 
481. 			// imports need to be hoisted out of the IIFE
482. 			for (let i = 0; i < body.length; i += 1) {
483. 				const node = body[i];
484. 				if (node.type === 'ImportDeclaration') {
485. 					removeNode(code, js.content, node);
486. 					imports.push(node);
487. 
488. 					node.specifiers.forEach((specifier: Node) => {
489. 						this.userVars.add(specifier.local.name);
490. 					});
491. 				}
492. 			}
493. 
494. 			const defaultExport = this.defaultExport = body.find(
495. 				(node: Node) => node.type === 'ExportDefaultDeclaration'
496. 			);
497. 
498. 			if (defaultExport) {
499. 				defaultExport.declaration.properties.forEach((prop: Node) => {
500. 					templateProperties[prop.key.name] = prop;
501. 				});
502. 
503. 				['helpers', 'events', 'components', 'transitions'].forEach(key => {
504. 					if (templateProperties[key]) {
505. 						templateProperties[key].value.properties.forEach((prop: Node) => {
506. 							this[key].add(prop.key.name);
507. 						});
508. 					}
509. 				});
510. 
511. 				const addArrowFunctionExpression = (name: string, node: Node) => {
512. 					const { body, params } = node;
513. 
514. 					const paramString = params.length ?
515. 						`[✂${params[0].start}-${params[params.length - 1].end}✂]` :
516. 						``;
517. 
518. 					if (body.type === 'BlockStatement') {
519. 						componentDefinition.addBlock(deindent`
520. 							function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
521. 						`);
522. 					} else {
523. 						componentDefinition.addBlock(deindent`
524. 							function ${name}(${paramString}) {
525. 								return [✂${body.start}-${body.end}✂];
526. 							}
527. 						`);
528. 					}
529. 				};
530. 
531. 				const addFunctionExpression = (name: string, node: Node) => {
532. 					let c = node.start;
533. 					while (this.source[c] !== '(') c += 1;
534. 					componentDefinition.addBlock(deindent`
535. 						function ${name}[✂${c}-${node.end}✂];
536. 					`);
537. 				};
538. 
539. 				const addValue = (name: string, node: Node) => {
540. 					componentDefinition.addBlock(deindent`
541. 						var ${name} = [✂${node.start}-${node.end}✂];
542. 					`);
543. 				};
544. 
545. 				const addDeclaration = (key: string, node: Node, disambiguator?: string) => {
546. 					const qualified = disambiguator ? `${disambiguator}-${key}` : key;
547. 
548. 					if (node.type === 'Identifier' && node.name === key) {
549. 						this.templateVars.set(qualified, key);
550. 						return;
551. 					}
552. 
553. 					let name = this.getUniqueName(key);
554. 					this.templateVars.set(qualified, name);
555. 
556. 					// deindent
557. 					const indentationLevel = getIndentationLevel(source, node.start);
558. 					if (indentationLevel) {
559. 						removeIndentation(code, node.start, node.end, indentationLevel, indentExclusionRanges);
560. 					}
561. 
562. 					if (node.type === 'ArrowFunctionExpression') {
563. 						addArrowFunctionExpression(name, node);
564. 					} else if (node.type === 'FunctionExpression') {
565. 						addFunctionExpression(name, node);
566. 					} else {
567. 						addValue(name, node);
568. 					}
569. 				};
570. 
571. 				if (templateProperties.components) {
572. 					templateProperties.components.value.properties.forEach((property: Node) => {
573. 						addDeclaration(property.key.name, property.value, 'components');
574. 					});
575. 				}
576. 
577. 				if (templateProperties.computed) {
578. 					const dependencies = new Map();
579. 
580. 					templateProperties.computed.value.properties.forEach((prop: Node) => {
581. 						const key = prop.key.name;
582. 						const value = prop.value;
583. 
584. 						const deps = value.params.map(
585. 							(param: Node) =>
586. 								param.type === 'AssignmentPattern' ? param.left.name : param.name
587. 						);
588. 						dependencies.set(key, deps);
589. 					});
590. 
591. 					const visited = new Set();
592. 
593. 					const visit = (key: string) => {
594. 						if (!dependencies.has(key)) return; // not a computation
595. 
596. 						if (visited.has(key)) return;
597. 						visited.add(key);
598. 
599. 						const deps = dependencies.get(key);
600. 						deps.forEach(visit);
601. 
602. 						computations.push({ key, deps });
603. 
604. 						const prop = templateProperties.computed.value.properties.find((prop: Node) => prop.key.name === key);
605. 						addDeclaration(key, prop.value, 'computed');
606. 					};
607. 
608. 					templateProperties.computed.value.properties.forEach((prop: Node) =>
609. 						visit(prop.key.name)
610. 					);
611. 				}
612. 
613. 				if (templateProperties.data) {
614. 					addDeclaration('data', templateProperties.data.value);
615. 				}
616. 
617. 				if (templateProperties.events && dom) {
618. 					templateProperties.events.value.properties.forEach((property: Node) => {
619. 						addDeclaration(property.key.name, property.value, 'events');
620. 					});
621. 				}
622. 
623. 				if (templateProperties.helpers) {
624. 					templateProperties.helpers.value.properties.forEach((property: Node) => {
625. 						addDeclaration(property.key.name, property.value, 'helpers');
626. 					});
627. 				}
628. 
629. 				if (templateProperties.methods && dom) {
630. 					addDeclaration('methods', templateProperties.methods.value);
631. 				}
632. 
633. 				if (templateProperties.namespace) {
634. 					const ns = templateProperties.namespace.value.value;
635. 					namespace = namespaces[ns] || ns;
636. 				}
637. 
638. 				if (templateProperties.onrender) templateProperties.oncreate = templateProperties.onrender; // remove after v2
639. 				if (templateProperties.oncreate && dom) {
640. 					addDeclaration('oncreate', templateProperties.oncreate.value);
641. 				}
642. 
643. 				if (templateProperties.onteardown) templateProperties.ondestroy = templateProperties.onteardown; // remove after v2
644. 				if (templateProperties.ondestroy && dom) {
645. 					addDeclaration('ondestroy', templateProperties.ondestroy.value);
646. 				}
647. 
648. 				if (templateProperties.props) {
649. 					this.props = templateProperties.props.value.elements.map((element: Node) => element.value);
650. 				}
651. 
652. 				if (templateProperties.setup) {
653. 					addDeclaration('setup', templateProperties.setup.value);
654. 				}
655. 
656. 				if (templateProperties.tag) {
657. 					this.tag = templateProperties.tag.value.value;
658. 				}
659. 
660. 				if (templateProperties.transitions) {
661. 					templateProperties.transitions.value.properties.forEach((property: Node) => {
662. 						addDeclaration(property.key.name, property.value, 'transitions');
663. 					});
664. 				}
665. 			}
666. 
667. 			if (indentationLevel) {
668. 				if (defaultExport) {
669. 					removeIndentation(code, js.content.start, defaultExport.start, indentationLevel, indentExclusionRanges);
670. 					removeIndentation(code, defaultExport.end, js.content.end, indentationLevel, indentExclusionRanges);
671. 				} else {
672. 					removeIndentation(code, js.content.start, js.content.end, indentationLevel, indentExclusionRanges);
673. 				}
674. 			}
675. 
676. 			let a = js.content.start;
677. 			while (/\s/.test(source[a])) a += 1;
678. 
679. 			let b = js.content.end;
680. 			while (/\s/.test(source[b - 1])) b -= 1;
681. 
682. 			if (defaultExport) {
683. 				this.javascript = '';
684. 				if (a !== defaultExport.start) this.javascript += `[✂${a}-${defaultExport.start}✂]`;
685. 				if (!componentDefinition.isEmpty()) this.javascript += componentDefinition;
686. 				if (defaultExport.end !== b) this.javascript += `[✂${defaultExport.end}-${b}✂]`;
687. 			} else {
688. 				this.javascript = a === b ? null : `[✂${a}-${b}✂]`;
689. 			}
690. 		}
691. 
692. 		this.computations = computations;
693. 		this.namespace = namespace;
694. 		this.templateProperties = templateProperties;
695. 	}
696. }


File: src/generators/dom/index.ts
Line number range: 1 - 437
Content:
1. import MagicString from 'magic-string';
2. import { parseExpressionAt } from 'acorn';
3. import annotateWithScopes from '../../utils/annotateWithScopes';
4. import isReference from '../../utils/isReference';
5. import { walk } from 'estree-walker';
6. import deindent from '../../utils/deindent';
7. import { stringify, escape } from '../../utils/stringify';
8. import CodeBuilder from '../../utils/CodeBuilder';
9. import reservedNames from '../../utils/reservedNames';
10. import visit from './visit';
11. import shared from './shared';
12. import Generator from '../Generator';
13. import Stylesheet from '../../css/Stylesheet';
14. import preprocess from './preprocess';
15. import Block from './Block';
16. import { version } from '../../../package.json';
17. import { Parsed, CompileOptions, Node } from '../../interfaces';
18. 
19. const test = typeof global !== 'undefined' && global.__svelte_test;
20. 
21. export class DomGenerator extends Generator {
22. 	blocks: (Block|string)[];
23. 	readonly: Set<string>;
24. 	metaBindings: string[];
25. 
26. 	hydratable: boolean;
27. 	legacy: boolean;
28. 
29. 	hasIntroTransitions: boolean;
30. 	hasOutroTransitions: boolean;
31. 	hasComplexBindings: boolean;
32. 
33. 	needsEncapsulateHelper: boolean;
34. 
35. 	constructor(
36. 		parsed: Parsed,
37. 		source: string,
38. 		name: string,
39. 		stylesheet: Stylesheet,
40. 		options: CompileOptions
41. 	) {
42. 		super(parsed, source, name, stylesheet, options, true);
43. 		this.blocks = [];
44. 
45. 		this.readonly = new Set();
46. 
47. 		this.hydratable = options.hydratable;
48. 		this.legacy = options.legacy;
49. 		this.needsEncapsulateHelper = false;
50. 
51. 		// initial values for e.g. window.innerWidth, if there's a <:Window> meta tag
52. 		this.metaBindings = [];
53. 	}
54. 
55. 	getUniqueNameMaker(params: string[]) {
56. 		const localUsedNames = new Set(params);
57. 
58. 		function add(name: string) {
59. 			localUsedNames.add(name);
60. 		}
61. 
62. 		reservedNames.forEach(add);
63. 		this.userVars.forEach(add);
64. 		for (const name in shared) {
65. 			localUsedNames.add(test ? `${name}$` : name);
66. 		}
67. 
68. 		return (name: string) => {
69. 			if (test) name = `${name}$`;
70. 			let alias = name;
71. 			for (
72. 				let i = 1;
73. 				this.usedNames.has(alias) ||
74. 				localUsedNames.has(alias);
75. 				alias = `${name}_${i++}`
76. 			);
77. 			localUsedNames.add(alias);
78. 			return alias;
79. 		};
80. 	}
81. }
82. 
83. export default function dom(
84. 	parsed: Parsed,
85. 	source: string,
86. 	stylesheet: Stylesheet,
87. 	options: CompileOptions
88. ) {
89. 	const format = options.format || 'es';
90. 
91. 	const generator = new DomGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
92. 
93. 	const {
94. 		computations,
95. 		name,
96. 		templateProperties,
97. 		namespace,
98. 	} = generator;
99. 
100. 	const { block, state } = preprocess(generator, namespace, parsed.html);
101. 
102. 	generator.stylesheet.warnOnUnusedSelectors(options.onwarn);
103. 
104. 	parsed.html.children.forEach((node: Node) => {
105. 		visit(generator, block, state, node, [], []);
106. 	});
107. 
108. 	const builder = new CodeBuilder();
109. 	const computationBuilder = new CodeBuilder();
110. 	const computationDeps = new Set();
111. 
112. 	if (computations.length) {
113. 		computations.forEach(({ key, deps }) => {
114. 			deps.forEach(dep => {
115. 				computationDeps.add(dep);
116. 			});
117. 
118. 			if (generator.readonly.has(key)) {
119. 				// <:Window> bindings
120. 				throw new Error(
121. 					`Cannot have a computed value '${key}' that clashes with a read-only property`
122. 				);
123. 			}
124. 
125. 			generator.readonly.add(key);
126. 
127. 			const condition = `${deps.map(dep => `changed.${dep}`).join(' || ')}`;
128. 
129. 			const statement = `if (@differs(state.${key}, (state.${key} = %computed-${key}(${deps
130. 				.map(dep => `state.${dep}`)
131. 				.join(', ')})))) changed.${key} = true;`;
132. 
133. 			computationBuilder.addConditional(condition, statement);
134. 		});
135. 	}
136. 
137. 	if (generator.javascript) {
138. 		builder.addBlock(generator.javascript);
139. 	}
140. 
141. 	if (generator.needsEncapsulateHelper) {
142. 		builder.addBlock(deindent`
143. 			function @encapsulateStyles(node) {
144. 				@setAttribute(node, "${generator.stylesheet.id}", "");
145. 			}
146. 		`);
147. 	}
148. 
149. 	const { css, cssMap } = generator.stylesheet.render(options.filename, !generator.customElement);
150. 	const styles = generator.stylesheet.hasStyles && stringify(options.dev ?
151. 		`${css}\n/*# sourceMappingURL=${cssMap.toUrl()} */` :
152. 		css, { onlyEscapeAtSymbol: true });
153. 
154. 	if (styles && generator.options.css !== false && !generator.customElement) {
155. 		builder.addBlock(deindent`
156. 			function @add_css() {
157. 				var style = @createElement("style");
158. 				style.id = '${generator.stylesheet.id}-style';
159. 				style.textContent = ${styles};
160. 				@appendNode(style, document.head);
161. 			}
162. 		`);
163. 	}
164. 
165. 	generator.blocks.forEach(block => {
166. 		builder.addBlock(block.toString());
167. 	});
168. 
169. 	const sharedPath = options.shared === true
170. 		? 'svelte/shared.js'
171. 		: options.shared;
172. 
173. 	const prototypeBase =
174. 		`${name}.prototype` +
175. 		(templateProperties.methods ? `, %methods` : '');
176. 	const proto = sharedPath
177. 		? `@proto`
178. 		: deindent`
179. 		{
180. 			${['destroy', 'get', 'fire', 'observe', 'on', 'set', 'teardown', '_set', '_mount', '_unmount']
181. 				.map(n => `${n}: @${n === 'teardown' ? 'destroy' : n}`)
182. 				.join(',\n')}
183. 		}`;
184. 
185. 	const debugName = `<${generator.customElement ? generator.tag : name}>`;
186. 
187. 	const constructorBody = deindent`
188. 		${options.dev && `this._debugName = '${debugName}';`}
189. 		${options.dev && !generator.customElement &&
190. 			`if (!options || (!options.target && !options._root)) throw new Error("'target' is a required option");`}
191. 		@init(this, options);
192. 		${generator.usesRefs && `this.refs = {};`}
193. 		this._state = @assign(${templateProperties.data ? '%data()' : '{}'}, options.data);
194. 		${generator.metaBindings}
195. 		${computations.length && `this._recompute({ ${Array.from(computationDeps).map(dep => `${dep}: 1`).join(', ')} }, this._state);`}
196. 		${options.dev &&
197. 			Array.from(generator.expectedProperties).map(
198. 				prop =>
199. 					`if (!('${prop}' in this._state)) console.warn("${debugName} was created without expected data property '${prop}'");`
200. 			)}
201. 		${generator.bindingGroups.length &&
202. 			`this._bindingGroups = [${Array(generator.bindingGroups.length).fill('[]').join(', ')}];`}
203. 
204. 		${templateProperties.ondestroy && `this._handlers.destroy = [%ondestroy]`}
205. 
206. 		${generator.slots.size && `this._slotted = options.slots || {};`}
207. 
208. 		${generator.customElement ?
209. 			deindent`
210. 				this.attachShadow({ mode: 'open' });
211. 				${css && `this.shadowRoot.innerHTML = \`<style>${escape(css, { onlyEscapeAtSymbol: true }).replace(/\\/g, '\\\\')}${options.dev ? `\n/*# sourceMappingURL=${cssMap.toUrl()} */` : ''}</style>\`;`}
212. 			` :
213. 			(generator.stylesheet.hasStyles && options.css !== false &&
214. 			`if (!document.getElementById("${generator.stylesheet.id}-style")) @add_css();`)
215. 		}
216. 
217. 		${templateProperties.oncreate && `var _oncreate = %oncreate.bind(this);`}
218. 
219. 		${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`
220. 			if (!options._root) {
221. 				this._oncreate = [${templateProperties.oncreate && `_oncreate`}];
222. 				${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}
223. 				${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}
224. 			} ${templateProperties.oncreate && deindent`
225. 				else {
226. 					this._root._oncreate.push(_oncreate);
227. 				}
228. 			`}
229. 		`}
230. 
231. 		${generator.slots.size && `this.slots = {};`}
232. 
233. 		this._fragment = @create_main_fragment(this._state, this);
234. 
235. 		${generator.customElement ? deindent`
236. 			this._fragment.c();
237. 			this._fragment.${block.hasIntroMethod ? 'i' : 'm'}(this.shadowRoot, null);
238. 
239. 			if (options.target) this._mount(options.target, options.anchor || null);
240. 		` : deindent`
241. 			if (options.target) {
242. 				${generator.hydratable
243. 					? deindent`
244. 						var nodes = @children(options.target);
245. 						options.hydrate ? this._fragment.l(nodes) : this._fragment.c();
246. 						nodes.forEach(@detachNode);
247. 					` :
248. 					deindent`
249. 						${options.dev && `if (options.hydrate) throw new Error("options.hydrate only works if the component was compiled with the \`hydratable: true\` option");`}
250. 						this._fragment.c();
251. 					`}
252. 				this._fragment.${block.hasIntroMethod ? 'i' : 'm'}(options.target, options.anchor || null);
253. 
254. 				${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`
255. 					${generator.hasComponents && `this._lock = true;`}
256. 					${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}
257. 					${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}
258. 					${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}
259. 					${generator.hasComponents && `this._lock = false;`}
260. 				`}
261. 			}
262. 		`}
263. 	`;
264. 
265. 	if (generator.customElement) {
266. 		const props = generator.props || Array.from(generator.expectedProperties);
267. 
268. 		builder.addBlock(deindent`
269. 			class ${name} extends HTMLElement {
270. 				constructor(options = {}) {
271. 					super();
272. 					${constructorBody}
273. 				}
274. 
275. 				static get observedAttributes() {
276. 					return ${JSON.stringify(props)};
277. 				}
278. 
279. 				${props.map(prop => deindent`
280. 					get ${prop}() {
281. 						return this.get('${prop}');
282. 					}
283. 
284. 					set ${prop}(value) {
285. 						this.set({ ${prop}: value });
286. 					}
287. 				`).join('\n\n')}
288. 
289. 				${generator.slots.size && deindent`
290. 					connectedCallback() {
291. 						Object.keys(this._slotted).forEach(key => {
292. 							this.appendChild(this._slotted[key]);
293. 						});
294. 					}`}
295. 
296. 				attributeChangedCallback(attr, oldValue, newValue) {
297. 					this.set({ [attr]: newValue });
298. 				}
299. 			}
300. 
301. 			customElements.define("${generator.tag}", ${name});
302. 			@assign(${prototypeBase}, ${proto}, {
303. 				_mount(target, anchor) {
304. 					target.insertBefore(this, anchor);
305. 				},
306. 
307. 				_unmount() {
308. 					this.parentNode.removeChild(this);
309. 				}
310. 			});
311. 		`);
312. 	} else {
313. 		builder.addBlock(deindent`
314. 			function ${name}(options) {
315. 				${constructorBody}
316. 			}
317. 
318. 			@assign(${prototypeBase}, ${proto});
319. 		`);
320. 	}
321. 
322. 	builder.addBlock(deindent`
323. 		${options.dev && deindent`
324. 			${name}.prototype._checkReadOnly = function _checkReadOnly(newState) {
325. 				${Array.from(generator.readonly).map(
326. 					prop =>
327. 						`if ('${prop}' in newState && !this._updatingReadonlyProperty) throw new Error("${debugName}: Cannot set read-only property '${prop}'");`
328. 				)}
329. 			};
330. 		`}
331. 
332. 		${computations.length ? deindent`
333. 			${name}.prototype._recompute = function _recompute(changed, state) {
334. 				${computationBuilder}
335. 			}
336. 		` : (!sharedPath && `${name}.prototype._recompute = @noop;`)}
337. 
338. 		${templateProperties.setup && `%setup(${name});`}
339. 	`);
340. 
341. 	const usedHelpers = new Set();
342. 
343. 	let result = builder
344. 		.toString()
345. 		.replace(/(%+|@+)(\w*(?:-\w*)?)/g, (match: string, sigil: string, name: string) => {
346. 			if (sigil === '@') {
347. 				if (name in shared) {
348. 					if (options.dev && `${name}Dev` in shared) name = `${name}Dev`;
349. 					usedHelpers.add(name);
350. 				}
351. 
352. 				return generator.alias(name);
353. 			}
354. 
355. 			if (sigil === '%') {
356. 				return generator.templateVars.get(name);
357. 			}
358. 
359. 			return sigil.slice(1) + name;
360. 		});
361. 
362. 	let helpers;
363. 
364. 	if (sharedPath) {
365. 		if (format !== 'es' && format !== 'cjs') {
366. 			throw new Error(`Components with shared helpers must be compiled with \`format: 'es'\` or \`format: 'cjs'\``);
367. 		}
368. 		const used = Array.from(usedHelpers).sort();
369. 		helpers = used.map(name => {
370. 			const alias = generator.alias(name);
371. 			return { name, alias };
372. 		});
373. 	} else {
374. 		let inlineHelpers = '';
375. 
376. 		usedHelpers.forEach(key => {
377. 			const str = shared[key];
378. 			const code = new MagicString(str);
379. 			const expression = parseExpressionAt(str, 0);
380. 
381. 			let scope = annotateWithScopes(expression);
382. 
383. 			walk(expression, {
384. 				enter(node: Node, parent: Node) {
385. 					if (node._scope) scope = node._scope;
386. 
387. 					if (
388. 						node.type === 'Identifier' &&
389. 						isReference(node, parent) &&
390. 						!scope.has(node.name)
391. 					) {
392. 						if (node.name in shared) {
393. 							// this helper function depends on another one
394. 							const dependency = node.name;
395. 							usedHelpers.add(dependency);
396. 
397. 							const alias = generator.alias(dependency);
398. 							if (alias !== node.name)
399. 								code.overwrite(node.start, node.end, alias);
400. 						}
401. 					}
402. 				},
403. 
404. 				leave(node: Node) {
405. 					if (node._scope) scope = scope.parent;
406. 				},
407. 			});
408. 
409. 			if (key === 'transitionManager') {
410. 				// special case
411. 				const global = `_svelteTransitionManager`;
412. 
413. 				inlineHelpers += `\n\nvar ${generator.alias('transitionManager')} = window.${global} || (window.${global} = ${code});\n\n`;
414. 			} else {
415. 				const alias = generator.alias(expression.id.name);
416. 				if (alias !== expression.id.name)
417. 					code.overwrite(expression.id.start, expression.id.end, alias);
418. 
419. 				inlineHelpers += `\n\n${code}`;
420. 			}
421. 		});
422. 
423. 		result += inlineHelpers;
424. 	}
425. 
426. 	const filename = options.filename && (
427. 		typeof process !== 'undefined' ? options.filename.replace(process.cwd(), '').replace(/^[\/\\]/, '') : options.filename
428. 	);
429. 
430. 	return generator.generate(result, options, {
431. 		banner: `/* ${filename ? `${filename} ` : ``}generated by Svelte v${version} */`,
432. 		sharedPath,
433. 		helpers,
434. 		name,
435. 		format,
436. 	});
437. }


File: src/generators/dom/visitors/Component.ts
Line number range: 1 - 449
Content:
1. import deindent from '../../../utils/deindent';
2. import CodeBuilder from '../../../utils/CodeBuilder';
3. import visit from '../visit';
4. import { DomGenerator } from '../index';
5. import Block from '../Block';
6. import getTailSnippet from '../../../utils/getTailSnippet';
7. import getObject from '../../../utils/getObject';
8. import getExpressionPrecedence from '../../../utils/getExpressionPrecedence';
9. import { stringify } from '../../../utils/stringify';
10. import { Node } from '../../../interfaces';
11. import { State } from '../interfaces';
12. 
13. function stringifyProps(props: string[]) {
14. 	if (!props.length) return '{}';
15. 
16. 	const joined = props.join(', ');
17. 	if (joined.length > 40) {
18. 		// make larger data objects readable
19. 		return `{\n\t${props.join(',\n\t')}\n}`;
20. 	}
21. 
22. 	return `{ ${joined} }`;
23. }
24. 
25. interface Attribute {
26. 	name: string;
27. 	value: any;
28. 	dynamic: boolean;
29. 	dependencies?: string[]
30. }
31. 
32. interface Binding {
33. 	name: string;
34. 	value: Node;
35. 	contexts: Set<string>;
36. 	snippet: string;
37. 	obj: string;
38. 	prop: string;
39. 	dependencies: string[];
40. }
41. 
42. export default function visitComponent(
43. 	generator: DomGenerator,
44. 	block: Block,
45. 	state: State,
46. 	node: Node,
47. 	elementStack: Node[],
48. 	componentStack: Node[]
49. ) {
50. 	generator.hasComponents = true;
51. 
52. 	const name = node.var;
53. 
54. 	const componentInitProperties = [`_root: #component._root`];
55. 
56. 	if (node.children.length > 0) {
57. 		const slots = Array.from(node._slots).map(name => `${name}: @createFragment()`);
58. 		componentInitProperties.push(`slots: { ${slots.join(', ')} }`);
59. 
60. 		node.children.forEach((child: Node) => {
61. 			visit(generator, block, node._state, child, elementStack, componentStack.concat(node));
62. 		});
63. 	}
64. 
65. 	const allContexts = new Set();
66. 	const statements: string[] = [];
67. 	const name_context = block.getUniqueName(`${name}_context`);
68. 
69. 	let name_updating: string;
70. 	let name_initial_data: string;
71. 	let beforecreate: string = null;
72. 
73. 	const attributes = node.attributes
74. 		.filter((a: Node) => a.type === 'Attribute')
75. 		.map((a: Node) => mungeAttribute(a, block));
76. 
77. 	const bindings = node.attributes
78. 		.filter((a: Node) => a.type === 'Binding')
79. 		.map((a: Node) => mungeBinding(a, block));
80. 
81. 	if (attributes.length || bindings.length) {
82. 		const initialProps = attributes
83. 			.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);
84. 
85. 		const initialPropString = stringifyProps(initialProps);
86. 
87. 		const updates: string[] = [];
88. 
89. 		attributes
90. 			.filter((attribute: Attribute) => attribute.dynamic)
91. 			.forEach((attribute: Attribute) => {
92. 				if (attribute.dependencies.length) {
93. 					updates.push(deindent`
94. 						if (${attribute.dependencies
95. 							.map(dependency => `changed.${dependency}`)
96. 							.join(' || ')}) ${name}_changes.${attribute.name} = ${attribute.value};
97. 					`);
98. 				}
99. 
100. 				else {
101. 					// TODO this is an odd situation to encounter – I *think* it should only happen with
102. 					// each block indices, in which case it may be possible to optimise this
103. 					updates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);
104. 				}
105. 			});
106. 
107. 		if (bindings.length) {
108. 			generator.hasComplexBindings = true;
109. 
110. 			name_updating = block.alias(`${name}_updating`);
111. 			name_initial_data = block.getUniqueName(`${name}_initial_data`);
112. 
113. 			block.addVariable(name_updating, '{}');
114. 			statements.push(`var ${name_initial_data} = ${initialPropString};`);
115. 
116. 			const setParentFromChildOnChange = new CodeBuilder();
117. 			const setParentFromChildOnInit = new CodeBuilder();
118. 
119. 			bindings.forEach((binding: Binding) => {
120. 				let setParentFromChild;
121. 
122. 				binding.contexts.forEach(context => {
123. 					allContexts.add(context);
124. 				});
125. 
126. 				const { name: key } = getObject(binding.value);
127. 
128. 				if (block.contexts.has(key)) {
129. 					const prop = binding.dependencies[0];
130. 					const computed = isComputed(binding.value);
131. 					const tail = binding.value.type === 'MemberExpression' ? getTailSnippet(binding.value) : '';
132. 
133. 					setParentFromChild = deindent`
134. 						var list = ${name_context}.${block.listNames.get(key)};
135. 						var index = ${name_context}.${block.indexNames.get(key)};
136. 						list[index]${tail} = childState.${binding.name};
137. 
138. 						${binding.dependencies
139. 							.map((prop: string) => `newState.${prop} = state.${prop};`)
140. 							.join('\n')}
141. 					`;
142. 				}
143. 
144. 				else if (binding.value.type === 'MemberExpression') {
145. 					setParentFromChild = deindent`
146. 						${binding.snippet} = childState.${binding.name};
147. 						${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join('\n')}
148. 					`;
149. 				}
150. 
151. 				else {
152. 					setParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;
153. 				}
154. 
155. 				statements.push(deindent`
156. 					if (${binding.prop} in ${binding.obj}) {
157. 						${name_initial_data}.${binding.name} = ${binding.snippet};
158. 						${name_updating}.${binding.name} = true;
159. 					}`
160. 				);
161. 
162. 				setParentFromChildOnChange.addConditional(
163. 					`!${name_updating}.${binding.name} && changed.${binding.name}`,
164. 					setParentFromChild
165. 				);
166. 
167. 				setParentFromChildOnInit.addConditional(
168. 					`!${name_updating}.${binding.name}`,
169. 					setParentFromChild
170. 				);
171. 
172. 				// TODO could binding.dependencies.length ever be 0?
173. 				if (binding.dependencies.length) {
174. 					updates.push(deindent`
175. 						if (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(' || ')}) {
176. 							${name}_changes.${binding.name} = ${binding.snippet};
177. 							${name_updating}.${binding.name} = true;
178. 						}
179. 					`);
180. 				}
181. 			});
182. 
183. 			componentInitProperties.push(`data: ${name_initial_data}`);
184. 
185. 			componentInitProperties.push(deindent`
186. 				_bind: function(changed, childState) {
187. 					var state = #component.get(), newState = {};
188. 					${setParentFromChildOnChange}
189. 					${name_updating} = @assign({}, changed);
190. 					#component._set(newState);
191. 					${name_updating} = {};
192. 				}
193. 			`);
194. 
195. 			beforecreate = deindent`
196. 				#component._root._beforecreate.push(function () {
197. 					var state = #component.get(), childState = ${name}.get(), newState = {};
198. 					if (!childState) return;
199. 					${setParentFromChildOnInit}
200. 					${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(', ')} };
201. 					#component._set(newState);
202. 					${name_updating} = {};
203. 				});
204. 			`;
205. 		} else if (initialProps.length) {
206. 			componentInitProperties.push(`data: ${initialPropString}`);
207. 		}
208. 
209. 		if (updates.length) {
210. 			block.builders.update.addBlock(deindent`
211. 				var ${name}_changes = {};
212. 				${updates.join('\n')}
213. 				${name}._set( ${name}_changes );
214. 				${bindings.length && `${name_updating} = {};`}
215. 			`);
216. 		}
217. 	}
218. 
219. 	const expression = node.name === ':Self' ? generator.name : `%components-${node.name}`;
220. 
221. 	block.builders.init.addBlock(deindent`
222. 		${statements.join('\n')}
223. 		var ${name} = new ${expression}({
224. 			${componentInitProperties.join(',\n')}
225. 		});
226. 
227. 		${beforecreate}
228. 	`);
229. 
230. 	block.builders.create.addLine(`${name}._fragment.c();`);
231. 
232. 	block.builders.claim.addLine(
233. 		`${name}._fragment.l( ${state.parentNodes} );`
234. 	);
235. 
236. 	block.builders.mount.addLine(
237. 		`${name}._mount(${state.parentNode || '#target'}, ${state.parentNode ? 'null' : 'anchor'});`
238. 	);
239. 
240. 	if (!state.parentNode) block.builders.unmount.addLine(`${name}._unmount();`);
241. 
242. 	block.builders.destroy.addLine(`${name}.destroy(false);`);
243. 
244. 	// event handlers
245. 	node.attributes.filter((a: Node) => a.type === 'EventHandler').forEach((handler: Node) => {
246. 		const usedContexts: string[] = [];
247. 
248. 		if (handler.expression) {
249. 			generator.addSourcemapLocations(handler.expression);
250. 			generator.code.prependRight(
251. 				handler.expression.start,
252. 				`${block.alias('component')}.`
253. 			);
254. 
255. 			handler.expression.arguments.forEach((arg: Node) => {
256. 				const { contexts } = block.contextualise(arg, null, true);
257. 
258. 				contexts.forEach(context => {
259. 					if (!~usedContexts.indexOf(context)) usedContexts.push(context);
260. 					allContexts.add(context);
261. 				});
262. 			});
263. 		}
264. 
265. 		// TODO hoist event handlers? can do `this.__component.method(...)`
266. 		const declarations = usedContexts.map(name => {
267. 			if (name === 'state') return `var state = ${name_context}.state;`;
268. 
269. 			const listName = block.listNames.get(name);
270. 			const indexName = block.indexNames.get(name);
271. 
272. 			return `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;
273. 		});
274. 
275. 		const handlerBody =
276. 			(declarations.length ? declarations.join('\n') + '\n\n' : '') +
277. 			(handler.expression ?
278. 				`[✂${handler.expression.start}-${handler.expression.end}✂];` :
279. 				`${block.alias('component')}.fire('${handler.name}', event);`);
280. 
281. 		block.builders.init.addBlock(deindent`
282. 			${name}.on("${handler.name}", function(event) {
283. 				${handlerBody}
284. 			});
285. 		`);
286. 	});
287. 
288. 	// refs
289. 	node.attributes.filter((a: Node) => a.type === 'Ref').forEach((ref: Node) => {
290. 		generator.usesRefs = true;
291. 
292. 		block.builders.init.addLine(`#component.refs.${ref.name} = ${name};`);
293. 
294. 		block.builders.destroy.addLine(deindent`
295. 			if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;
296. 		`);
297. 	});
298. 
299. 	// maintain component context
300. 	if (allContexts.size) {
301. 		const contexts = Array.from(allContexts);
302. 
303. 		const initialProps = contexts
304. 			.map(contextName => {
305. 				if (contextName === 'state') return `state: state`;
306. 
307. 				const listName = block.listNames.get(contextName);
308. 				const indexName = block.indexNames.get(contextName);
309. 
310. 				return `${listName}: ${listName},\n${indexName}: ${indexName}`;
311. 			})
312. 			.join(',\n');
313. 
314. 		const updates = contexts
315. 			.map(contextName => {
316. 				if (contextName === 'state') return `${name_context}.state = state;`;
317. 
318. 				const listName = block.listNames.get(contextName);
319. 				const indexName = block.indexNames.get(contextName);
320. 
321. 				return `${name_context}.${listName} = ${listName};\n${name_context}.${indexName} = ${indexName};`;
322. 			})
323. 			.join('\n');
324. 
325. 		block.builders.init.addBlock(deindent`
326. 			var ${name_context} = {
327. 				${initialProps}
328. 			};
329. 		`);
330. 
331. 		block.builders.update.addBlock(updates);
332. 	}
333. }
334. 
335. function mungeAttribute(attribute: Node, block: Block): Attribute {
336. 	if (attribute.value === true) {
337. 		// attributes without values, e.g. <textarea readonly>
338. 		return {
339. 			name: attribute.name,
340. 			value: true,
341. 			dynamic: false
342. 		};
343. 	}
344. 
345. 	if (attribute.value.length === 0) {
346. 		return {
347. 			name: attribute.name,
348. 			value: `''`,
349. 			dynamic: false
350. 		};
351. 	}
352. 
353. 	if (attribute.value.length === 1) {
354. 		const value = attribute.value[0];
355. 
356. 		if (value.type === 'Text') {
357. 			// static attributes
358. 			return {
359. 				name: attribute.name,
360. 				value: isNaN(value.data) ? stringify(value.data) : value.data,
361. 				dynamic: false
362. 			};
363. 		}
364. 
365. 		// simple dynamic attributes
366. 		const { dependencies, snippet } = block.contextualise(value.expression);
367. 
368. 		// TODO only update attributes that have changed
369. 		return {
370. 			name: attribute.name,
371. 			value: snippet,
372. 			dependencies,
373. 			dynamic: true
374. 		};
375. 	}
376. 
377. 	// otherwise we're dealing with a complex dynamic attribute
378. 	const allDependencies = new Set();
379. 
380. 	const value =
381. 		(attribute.value[0].type === 'Text' ? '' : `"" + `) +
382. 		attribute.value
383. 			.map((chunk: Node) => {
384. 				if (chunk.type === 'Text') {
385. 					return stringify(chunk.data);
386. 				} else {
387. 					const { dependencies, snippet } = block.contextualise(
388. 						chunk.expression
389. 					);
390. 
391. 					dependencies.forEach(dependency => {
392. 						allDependencies.add(dependency);
393. 					});
394. 
395. 					return getExpressionPrecedence(chunk.expression) <= 13 ? `( ${snippet} )` : snippet;
396. 				}
397. 			})
398. 			.join(' + ');
399. 
400. 	return {
401. 		name: attribute.name,
402. 		value,
403. 		dependencies: Array.from(allDependencies),
404. 		dynamic: true
405. 	};
406. }
407. 
408. function mungeBinding(binding: Node, block: Block): Binding {
409. 	const { name } = getObject(binding.value);
410. 	const { snippet, contexts, dependencies } = block.contextualise(
411. 		binding.value
412. 	);
413. 
414. 	const contextual = block.contexts.has(name);
415. 
416. 	let obj;
417. 	let prop;
418. 
419. 	if (contextual) {
420. 		obj = block.listNames.get(name);
421. 		prop = block.indexNames.get(name);
422. 	} else if (binding.value.type === 'MemberExpression') {
423. 		prop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;
424. 		if (!binding.value.computed) prop = `'${prop}'`;
425. 		obj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;
426. 	} else {
427. 		obj = 'state';
428. 		prop = `'${name}'`;
429. 	}
430. 
431. 	return {
432. 		name: binding.name,
433. 		value: binding.value,
434. 		contexts,
435. 		snippet,
436. 		obj,
437. 		prop,
438. 		dependencies
439. 	};
440. }
441. 
442. function isComputed(node: Node) {
443. 	while (node.type === 'MemberExpression') {
444. 		if (node.computed) return true;
445. 		node = node.object;
446. 	}
447. 
448. 	return false;
449. }


File: src/generators/server-side-rendering/visitors/Component.ts
Line number range: 1 - 103
Content:
1. import flattenReference from '../../../utils/flattenReference';
2. import visit from '../visit';
3. import { SsrGenerator } from '../index';
4. import Block from '../Block';
5. import { AppendTarget } from '../interfaces';
6. import { Node } from '../../../interfaces';
7. import getObject from '../../../utils/getObject';
8. import getTailSnippet from '../../../utils/getTailSnippet';
9. import { stringify } from '../../../utils/stringify';
10. 
11. export default function visitComponent(
12. 	generator: SsrGenerator,
13. 	block: Block,
14. 	node: Node
15. ) {
16. 	function stringifyAttribute(chunk: Node) {
17. 		if (chunk.type === 'Text') return chunk.data;
18. 		if (chunk.type === 'MustacheTag') {
19. 			const { snippet } = block.contextualise(chunk.expression);
20. 			return '${__escape( ' + snippet + ')}';
21. 		}
22. 	}
23. 
24. 	const attributes: Node[] = [];
25. 	const bindings: Node[] = [];
26. 
27. 	node.attributes.forEach((attribute: Node) => {
28. 		if (attribute.type === 'Attribute') {
29. 			attributes.push(attribute);
30. 		} else if (attribute.type === 'Binding') {
31. 			bindings.push(attribute);
32. 		}
33. 	});
34. 
35. 	const props = attributes
36. 		.map(attribute => {
37. 			let value;
38. 
39. 			if (attribute.value === true) {
40. 				value = `true`;
41. 			} else if (attribute.value.length === 0) {
42. 				value = `''`;
43. 			} else if (attribute.value.length === 1) {
44. 				const chunk = attribute.value[0];
45. 				if (chunk.type === 'Text') {
46. 					value = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;
47. 				} else {
48. 					const { snippet } = block.contextualise(chunk.expression);
49. 					value = snippet;
50. 				}
51. 			} else {
52. 				value = '`' + attribute.value.map(stringifyAttribute).join('') + '`';
53. 			}
54. 
55. 			return `${attribute.name}: ${value}`;
56. 		})
57. 		.concat(
58. 			bindings.map(binding => {
59. 				const { name } = getObject(binding.value);
60. 				const tail = binding.value.type === 'MemberExpression'
61. 					? getTailSnippet(binding.value)
62. 					: '';
63. 
64. 				const keypath = block.contexts.has(name)
65. 					? `${name}${tail}`
66. 					: `state.${name}${tail}`;
67. 				return `${binding.name}: ${keypath}`;
68. 			})
69. 		)
70. 		.join(', ');
71. 
72. 	const expression = node.name === ':Self' ? generator.name : `%components-${node.name}`;
73. 
74. 	bindings.forEach(binding => {
75. 		block.addBinding(binding, expression);
76. 	});
77. 
78. 	let open = `\${${expression}.render({${props}}`;
79. 
80. 	if (node.children.length) {
81. 		const appendTarget: AppendTarget = {
82. 			slots: { default: '' },
83. 			slotStack: ['default']
84. 		};
85. 
86. 		generator.appendTargets.push(appendTarget);
87. 
88. 		node.children.forEach((child: Node) => {
89. 			visit(generator, block, child);
90. 		});
91. 
92. 		const slotted = Object.keys(appendTarget.slots)
93. 			.map(name => `${name}: () => \`${appendTarget.slots[name]}\``)
94. 			.join(', ');
95. 
96. 		open += `, { slotted: { ${slotted} } }`;
97. 
98. 		generator.appendTargets.pop();
99. 	}
100. 
101. 	generator.append(open);
102. 	generator.append(')}');
103. }


File: src/generators/shared/utils/wrapModule.ts
Line number range: 1 - 298
Content:
1. import deindent from '../../../utils/deindent';
2. import { CompileOptions, ModuleFormat, Node } from '../../../interfaces';
3. 
4. interface Dependency {
5. 	name: string;
6. 	statements: string[];
7. 	source: string;
8. }
9. 
10. const wrappers = { es, amd, cjs, iife, umd, eval: expr };
11. 
12. export default function wrapModule(
13. 	code: string,
14. 	format: ModuleFormat,
15. 	name: string,
16. 	options: CompileOptions,
17. 	banner: string,
18. 	sharedPath: string,
19. 	helpers: { name: string, alias: string }[],
20. 	imports: Node[],
21. 	source: string
22. ): string {
23. 	if (format === 'es') return es(code, name, options, banner, sharedPath, helpers, imports, source);
24. 
25. 	const dependencies = imports.map((declaration, i) => {
26. 		const defaultImport = declaration.specifiers.find(
27. 			(x: Node) =>
28. 				x.type === 'ImportDefaultSpecifier' ||
29. 				(x.type === 'ImportSpecifier' && x.imported.name === 'default')
30. 		);
31. 
32. 		const namespaceImport = declaration.specifiers.find(
33. 			(x: Node) => x.type === 'ImportNamespaceSpecifier'
34. 		);
35. 
36. 		const namedImports = declaration.specifiers.filter(
37. 			(x: Node) =>
38. 				x.type === 'ImportSpecifier' && x.imported.name !== 'default'
39. 		);
40. 
41. 		const name = defaultImport || namespaceImport
42. 			? (defaultImport || namespaceImport).local.name
43. 			: `__import${i}`;
44. 
45. 		const statements: string[] = [];
46. 
47. 		namedImports.forEach((specifier: Node) => {
48. 			statements.push(
49. 				`var ${specifier.local.name} = ${name}.${specifier.imported.name};`
50. 			);
51. 		});
52. 
53. 		if (defaultImport) {
54. 			statements.push(
55. 				`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`
56. 			);
57. 		}
58. 
59. 		return { name, statements, source: declaration.source.value };
60. 	});
61. 
62. 	if (format === 'amd') return amd(code, name, options, banner, dependencies);
63. 	if (format === 'cjs') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);
64. 	if (format === 'iife') return iife(code, name, options, banner, dependencies);
65. 	if (format === 'umd') return umd(code, name, options, banner, dependencies);
66. 	if (format === 'eval') return expr(code, name, options, banner, dependencies);
67. 
68. 	throw new Error(`Not implemented: ${format}`);
69. }
70. 
71. function es(
72. 	code: string,
73. 	name: string,
74. 	options: CompileOptions,
75. 	banner: string,
76. 	sharedPath: string,
77. 	helpers: { name: string, alias: string }[],
78. 	imports: Node[],
79. 	source: string
80. ) {
81. 	const importHelpers = helpers && (
82. 		`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(', ')} } from ${JSON.stringify(sharedPath)};`
83. 	);
84. 
85. 	const importBlock = imports.length > 0 && (
86. 		imports
87. 			.map((declaration: Node) => source.slice(declaration.start, declaration.end))
88. 			.join('\n')
89. 	);
90. 
91. 	return deindent`
92. 		${banner}
93. 		${importHelpers}
94. 		${importBlock}
95. 
96. 		${code}
97. 		export default ${name};`;
98. }
99. 
100. function amd(
101. 	code: string,
102. 	name: string,
103. 	options: CompileOptions,
104. 	banner: string,
105. 	dependencies: Dependency[]
106. ) {
107. 	const sourceString = dependencies.length
108. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
109. 		: '';
110. 
111. 	const id = options.amd && options.amd.id;
112. 
113. 	return deindent`
114. 		define(${id ? `"${id}", ` : ''}${sourceString}function(${paramString(dependencies)}) { "use strict";
115. 			${getCompatibilityStatements(dependencies)}
116. 
117. 			${code}
118. 			return ${name};
119. 		});`;
120. }
121. 
122. function cjs(
123. 	code: string,
124. 	name: string,
125. 	options: CompileOptions,
126. 	banner: string,
127. 	sharedPath: string,
128. 	helpers: { name: string, alias: string }[],
129. 	dependencies: Dependency[]
130. ) {
131. 	const SHARED = '__shared';
132. 	const helperBlock = helpers && (
133. 		`var ${SHARED} = require(${JSON.stringify(sharedPath)});\n` +
134. 		helpers.map(helper => {
135. 			return `var ${helper.alias} = ${SHARED}.${helper.name};`;
136. 		}).join('\n')
137. 	);
138. 
139. 	const requireBlock = dependencies.length > 0 && (
140. 		dependencies
141. 			.map(d => `var ${d.name} = require("${d.source}");`)
142. 			.join('\n\n')
143. 	);
144. 
145. 	return deindent`
146. 		${banner}
147. 		"use strict";
148. 
149. 		${helperBlock}
150. 		${requireBlock}
151. 		${getCompatibilityStatements(dependencies)}
152. 
153. 		${code}
154. 
155. 		module.exports = ${name};`
156. }
157. 
158. function iife(
159. 	code: string,
160. 	name: string,
161. 	options: CompileOptions,
162. 	banner: string,
163. 	dependencies: Dependency[]
164. ) {
165. 	if (!options.name) {
166. 		throw new Error(`Missing required 'name' option for IIFE export`);
167. 	}
168. 
169. 	const globals = getGlobals(dependencies, options);
170. 
171. 	return deindent`
172. 		${banner}
173. 		var ${options.name} = (function(${paramString(dependencies)}) { "use strict";
174. 			${getCompatibilityStatements(dependencies)}
175. 
176. 			${code}
177. 			return ${name};
178. 		}(${globals.join(', ')}));`;
179. }
180. 
181. function umd(
182. 	code: string,
183. 	name: string,
184. 	options: CompileOptions,
185. 	banner: string,
186. 	dependencies: Dependency[]
187. ) {
188. 	if (!options.name) {
189. 		throw new Error(`Missing required 'name' option for UMD export`);
190. 	}
191. 
192. 	const amdId = options.amd && options.amd.id ? `'${options.amd.id}', ` : '';
193. 
194. 	const amdDeps = dependencies.length
195. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
196. 		: '';
197. 
198. 	const cjsDeps = dependencies
199. 		.map(d => `require("${d.source}")`)
200. 		.join(', ');
201. 
202. 	const globals = getGlobals(dependencies, options);
203. 
204. 	return deindent`
205. 		${banner}
206. 		(function(global, factory) {
207. 			typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :
208. 			typeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :
209. 			(global.${options.name} = factory(${globals}));
210. 		}(this, (function (${paramString(dependencies)}) { "use strict";
211. 
212. 			${getCompatibilityStatements(dependencies)}
213. 
214. 			${code}
215. 
216. 			return ${name};
217. 
218. 		})));`;
219. }
220. 
221. function expr(
222. 	code: string,
223. 	name: string,
224. 	options: CompileOptions,
225. 	banner: string,
226. 	dependencies: Dependency[]
227. ) {
228. 	const globals = getGlobals(dependencies, options);
229. 
230. 	return deindent`
231. 		(function (${paramString(dependencies)}) { "use strict";
232. 			${banner}
233. 
234. 			${getCompatibilityStatements(dependencies)}
235. 
236. 			${code}
237. 
238. 			return ${name};
239. 		}(${globals.join(', ')}))`;
240. }
241. 
242. function paramString(dependencies: Dependency[]) {
243. 	return dependencies.map(dep => dep.name).join(', ');
244. }
245. 
246. function removeExtension(file: string) {
247. 	const index = file.lastIndexOf('.');
248. 	return ~index ? file.slice(0, index) : file;
249. }
250. 
251. function getCompatibilityStatements(dependencies: Dependency[]) {
252. 	if (!dependencies.length) return null;
253. 
254. 	const statements: string[] = [];
255. 
256. 	dependencies.forEach(dependency => {
257. 		statements.push(...dependency.statements);
258. 	});
259. 
260. 	return statements.join('\n');
261. }
262. 
263. function getGlobals(dependencies: Dependency[], options: CompileOptions) {
264. 	const { globals, onerror, onwarn } = options;
265. 	const globalFn = getGlobalFn(globals);
266. 
267. 	return dependencies.map(d => {
268. 		let name = globalFn(d.source);
269. 
270. 		if (!name) {
271. 			if (d.name.startsWith('__import')) {
272. 				const error = new Error(
273. 					`Could not determine name for imported module '${d.source}' – use options.globals`
274. 				);
275. 				onerror(error);
276. 			} else {
277. 				const warning = {
278. 					message: `No name was supplied for imported module '${d.source}'. Guessing '${d.name}', but you should use options.globals`,
279. 				};
280. 
281. 				onwarn(warning);
282. 			}
283. 
284. 			name = d.name;
285. 		}
286. 
287. 		return name;
288. 	});
289. }
290. 
291. function getGlobalFn(globals: any): (id: string) => string {
292. 	if (typeof globals === 'function') return globals;
293. 	if (typeof globals === 'object') {
294. 		return id => globals[id];
295. 	}
296. 
297. 	return () => undefined;
298. }


File: src/utils/CodeBuilder.ts
Line number range: 1 - 163
Content:
1. import repeat from './repeat';
2. 
3. enum ChunkType {
4. 	Line,
5. 	Block
6. }
7. 
8. interface Condition {
9. 	condition: string;
10. 	used: boolean;
11. }
12. 
13. export default class CodeBuilder {
14. 	result: string;
15. 	first: ChunkType;
16. 	last: ChunkType;
17. 	lastCondition: string;
18. 	conditionStack: Condition[];
19. 	indent: string;
20. 
21. 	constructor(str = '') {
22. 		this.result = str;
23. 
24. 		const initial = str
25. 			? /\n/.test(str) ? ChunkType.Block : ChunkType.Line
26. 			: null;
27. 		this.first = initial;
28. 		this.last = initial;
29. 
30. 		this.lastCondition = null;
31. 		this.conditionStack = [];
32. 		this.indent = '';
33. 	}
34. 
35. 	addConditional(condition: string, body: string) {
36. 		this.reifyConditions();
37. 
38. 		body = body.replace(/^/gm, `${this.indent}\t`);
39. 
40. 		if (condition === this.lastCondition) {
41. 			this.result += `\n${body}`;
42. 		} else {
43. 			if (this.lastCondition) {
44. 				this.result += `\n${this.indent}}`;
45. 			}
46. 
47. 			this.result += `${this.last === ChunkType.Block ? '\n\n' : '\n'}${this.indent}if (${condition}) {\n${body}`;
48. 			this.lastCondition = condition;
49. 		}
50. 
51. 		this.last = ChunkType.Block;
52. 	}
53. 
54. 	addLine(line: string) {
55. 		this.reifyConditions();
56. 
57. 		if (this.lastCondition) {
58. 			this.result += `\n${this.indent}}`;
59. 			this.lastCondition = null;
60. 		}
61. 
62. 		if (this.last === ChunkType.Block) {
63. 			this.result += `\n\n${this.indent}${line}`;
64. 		} else if (this.last === ChunkType.Line) {
65. 			this.result += `\n${this.indent}${line}`;
66. 		} else {
67. 			this.result += line;
68. 		}
69. 
70. 		this.last = ChunkType.Line;
71. 		if (!this.first) this.first = ChunkType.Line;
72. 	}
73. 
74. 	addLineAtStart(line: string) {
75. 		this.reifyConditions();
76. 
77. 		if (this.first === ChunkType.Block) {
78. 			this.result = `${line}\n\n${this.indent}${this.result}`;
79. 		} else if (this.first === ChunkType.Line) {
80. 			this.result = `${line}\n${this.indent}${this.result}`;
81. 		} else {
82. 			this.result += line;
83. 		}
84. 
85. 		this.first = ChunkType.Line;
86. 		if (!this.last) this.last = ChunkType.Line;
87. 	}
88. 
89. 	addBlock(block: string) {
90. 		this.reifyConditions();
91. 
92. 		if (this.indent) block = block.replace(/^/gm, `${this.indent}`);
93. 
94. 		if (this.lastCondition) {
95. 			this.result += `\n${this.indent}}`;
96. 			this.lastCondition = null;
97. 		}
98. 
99. 		if (this.result) {
100. 			this.result += `\n\n${this.indent}${block}`;
101. 		} else {
102. 			this.result += block;
103. 		}
104. 
105. 		this.last = ChunkType.Block;
106. 		if (!this.first) this.first = ChunkType.Block;
107. 	}
108. 
109. 	addBlockAtStart(block: string) {
110. 		this.reifyConditions();
111. 
112. 		if (this.result) {
113. 			this.result = `${block}\n\n${this.indent}${this.result}`;
114. 		} else {
115. 			this.result += block;
116. 		}
117. 
118. 		this.first = ChunkType.Block;
119. 		if (!this.last) this.last = ChunkType.Block;
120. 	}
121. 
122. 	isEmpty() {
123. 		return this.result === '';
124. 	}
125. 
126. 	pushCondition(condition: string) {
127. 		this.conditionStack.push({ condition, used: false });
128. 	}
129. 
130. 	popCondition() {
131. 		const { used } = this.conditionStack.pop();
132. 
133. 		this.indent = repeat('\t', this.conditionStack.length);
134. 		if (used) this.addLine('}');
135. 	}
136. 
137. 	reifyConditions() {
138. 		for (let i = 0; i < this.conditionStack.length; i += 1) {
139. 			const condition = this.conditionStack[i];
140. 			if (!condition.used) {
141. 				const line = `if (${condition.condition}) {`;
142. 
143. 				if (this.last === ChunkType.Block) {
144. 					this.result += `\n\n${this.indent}${line}`;
145. 				} else if (this.last === ChunkType.Line) {
146. 					this.result += `\n${this.indent}${line}`;
147. 				} else {
148. 					this.result += line;
149. 				}
150. 
151. 				this.last = ChunkType.Line;
152. 				if (!this.first) this.first = ChunkType.Line;
153. 
154. 				this.indent = repeat('\t', this.conditionStack.length);
155. 				condition.used = true;
156. 			}
157. 		}
158. 	}
159. 
160. 	toString() {
161. 		return this.result.trim() + (this.lastCondition ? `\n}` : ``);
162. 	}
163. }


File: src/validate/js/propValidators/oncreate.ts
Line number range: 1 - 14
Content:
1. import usesThisOrArguments from '../utils/usesThisOrArguments';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function oncreate(validator: Validator, prop: Node) {
6. 	if (prop.value.type === 'ArrowFunctionExpression') {
7. 		if (usesThisOrArguments(prop.value.body)) {
8. 			validator.error(
9. 				`'oncreate' should be a function expression, not an arrow function expression`,
10. 				prop.start
11. 			);
12. 		}
13. 	}
14. }


File: src/validate/js/propValidators/ondestroy.ts
Line number range: 1 - 14
Content:
1. import usesThisOrArguments from '../utils/usesThisOrArguments';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function ondestroy(validator: Validator, prop: Node) {
6. 	if (prop.value.type === 'ArrowFunctionExpression') {
7. 		if (usesThisOrArguments(prop.value.body)) {
8. 			validator.error(
9. 				`'ondestroy' should be a function expression, not an arrow function expression`,
10. 				prop.start
11. 			);
12. 		}
13. 	}
14. }


File: src/validate/js/propValidators/onrender.ts
Line number range: 1 - 11
Content:
1. import oncreate from './oncreate';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function onrender(validator: Validator, prop: Node) {
6. 	validator.warn(
7. 		`'onrender' has been deprecated in favour of 'oncreate', and will cause an error in Svelte 2.x`,
8. 		prop.start
9. 	);
10. 	oncreate(validator, prop);
11. }


File: src/validate/js/propValidators/onteardown.ts
Line number range: 1 - 11
Content:
1. import ondestroy from './ondestroy';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function onteardown(validator: Validator, prop: Node) {
6. 	validator.warn(
7. 		`'onteardown' has been deprecated in favour of 'ondestroy', and will cause an error in Svelte 2.x`,
8. 		prop.start
9. 	);
10. 	ondestroy(validator, prop);
11. }


File: test/js/samples/onrender-onteardown-rewritten/expected-bundle.js
Line number range: 1 - 214
Content:
1. function noop() {}
2. 
3. function assign(target) {
4. 	var k,
5. 		source,
6. 		i = 1,
7. 		len = arguments.length;
8. 	for (; i < len; i++) {
9. 		source = arguments[i];
10. 		for (k in source) target[k] = source[k];
11. 	}
12. 
13. 	return target;
14. }
15. 
16. function blankObject() {
17. 	return Object.create(null);
18. }
19. 
20. function destroy(detach) {
21. 	this.destroy = noop;
22. 	this.fire('destroy');
23. 	this.set = this.get = noop;
24. 
25. 	if (detach !== false) this._fragment.u();
26. 	this._fragment.d();
27. 	this._fragment = this._state = null;
28. }
29. 
30. function differs(a, b) {
31. 	return a !== b || ((a && typeof a === 'object') || typeof a === 'function');
32. }
33. 
34. function dispatchObservers(component, group, changed, newState, oldState) {
35. 	for (var key in group) {
36. 		if (!changed[key]) continue;
37. 
38. 		var newValue = newState[key];
39. 		var oldValue = oldState[key];
40. 
41. 		var callbacks = group[key];
42. 		if (!callbacks) continue;
43. 
44. 		for (var i = 0; i < callbacks.length; i += 1) {
45. 			var callback = callbacks[i];
46. 			if (callback.__calling) continue;
47. 
48. 			callback.__calling = true;
49. 			callback.call(component, newValue, oldValue);
50. 			callback.__calling = false;
51. 		}
52. 	}
53. }
54. 
55. function fire(eventName, data) {
56. 	var handlers =
57. 		eventName in this._handlers && this._handlers[eventName].slice();
58. 	if (!handlers) return;
59. 
60. 	for (var i = 0; i < handlers.length; i += 1) {
61. 		handlers[i].call(this, data);
62. 	}
63. }
64. 
65. function get(key) {
66. 	return key ? this._state[key] : this._state;
67. }
68. 
69. function init(component, options) {
70. 	component.options = options;
71. 
72. 	component._observers = { pre: blankObject(), post: blankObject() };
73. 	component._handlers = blankObject();
74. 	component._root = options._root || component;
75. 	component._yield = options._yield;
76. 	component._bind = options._bind;
77. }
78. 
79. function observe(key, callback, options) {
80. 	var group = options && options.defer
81. 		? this._observers.post
82. 		: this._observers.pre;
83. 
84. 	(group[key] || (group[key] = [])).push(callback);
85. 
86. 	if (!options || options.init !== false) {
87. 		callback.__calling = true;
88. 		callback.call(this, this._state[key]);
89. 		callback.__calling = false;
90. 	}
91. 
92. 	return {
93. 		cancel: function() {
94. 			var index = group[key].indexOf(callback);
95. 			if (~index) group[key].splice(index, 1);
96. 		}
97. 	};
98. }
99. 
100. function on(eventName, handler) {
101. 	if (eventName === 'teardown') return this.on('destroy', handler);
102. 
103. 	var handlers = this._handlers[eventName] || (this._handlers[eventName] = []);
104. 	handlers.push(handler);
105. 
106. 	return {
107. 		cancel: function() {
108. 			var index = handlers.indexOf(handler);
109. 			if (~index) handlers.splice(index, 1);
110. 		}
111. 	};
112. }
113. 
114. function set(newState) {
115. 	this._set(assign({}, newState));
116. 	if (this._root._lock) return;
117. 	this._root._lock = true;
118. 	callAll(this._root._beforecreate);
119. 	callAll(this._root._oncreate);
120. 	callAll(this._root._aftercreate);
121. 	this._root._lock = false;
122. }
123. 
124. function _set(newState) {
125. 	var oldState = this._state,
126. 		changed = {},
127. 		dirty = false;
128. 
129. 	for (var key in newState) {
130. 		if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
131. 	}
132. 	if (!dirty) return;
133. 
134. 	this._state = assign({}, oldState, newState);
135. 	this._recompute(changed, this._state);
136. 	if (this._bind) this._bind(changed, this._state);
137. 	dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
138. 	this._fragment.p(changed, this._state);
139. 	dispatchObservers(this, this._observers.post, changed, this._state, oldState);
140. }
141. 
142. function callAll(fns) {
143. 	while (fns && fns.length) fns.pop()();
144. }
145. 
146. function _mount(target, anchor) {
147. 	this._fragment.m(target, anchor);
148. }
149. 
150. function _unmount() {
151. 	this._fragment.u();
152. }
153. 
154. var proto = {
155. 	destroy: destroy,
156. 	get: get,
157. 	fire: fire,
158. 	observe: observe,
159. 	on: on,
160. 	set: set,
161. 	teardown: destroy,
162. 	_recompute: noop,
163. 	_set: _set,
164. 	_mount: _mount,
165. 	_unmount: _unmount
166. };
167. 
168. /* generated by Svelte vX.Y.Z */
169. function oncreate() {}
170. 
171. function ondestroy() {}
172. 
173. function create_main_fragment(state, component) {
174. 
175. 	return {
176. 		c: noop,
177. 
178. 		m: noop,
179. 
180. 		p: noop,
181. 
182. 		u: noop,
183. 
184. 		d: noop
185. 	};
186. }
187. 
188. function SvelteComponent(options) {
189. 	init(this, options);
190. 	this._state = assign({}, options.data);
191. 
192. 	this._handlers.destroy = [ondestroy];
193. 
194. 	var _oncreate = oncreate.bind(this);
195. 
196. 	if (!options._root) {
197. 		this._oncreate = [_oncreate];
198. 	} else {
199. 	 	this._root._oncreate.push(_oncreate);
200. 	 }
201. 
202. 	this._fragment = create_main_fragment(this._state, this);
203. 
204. 	if (options.target) {
205. 		this._fragment.c();
206. 		this._fragment.m(options.target, options.anchor || null);
207. 
208. 		callAll(this._oncreate);
209. 	}
210. }
211. 
212. assign(SvelteComponent.prototype, proto);
213. 
214. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/expected.js
Line number range: 1 - 48
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";
3. 
4. function oncreate() {};
5. 
6. function ondestroy() {};
7. 
8. function create_main_fragment(state, component) {
9. 
10. 	return {
11. 		c: noop,
12. 
13. 		m: noop,
14. 
15. 		p: noop,
16. 
17. 		u: noop,
18. 
19. 		d: noop
20. 	};
21. }
22. 
23. function SvelteComponent(options) {
24. 	init(this, options);
25. 	this._state = assign({}, options.data);
26. 
27. 	this._handlers.destroy = [ondestroy]
28. 
29. 	var _oncreate = oncreate.bind(this);
30. 
31. 	if (!options._root) {
32. 		this._oncreate = [_oncreate];
33. 	} else {
34. 	 	this._root._oncreate.push(_oncreate);
35. 	 }
36. 
37. 	this._fragment = create_main_fragment(this._state, this);
38. 
39. 	if (options.target) {
40. 		this._fragment.c();
41. 		this._fragment.m(options.target, options.anchor || null);
42. 
43. 		callAll(this._oncreate);
44. 	}
45. }
46. 
47. assign(SvelteComponent.prototype, proto);
48. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/input.html
Line number range: 1 - 7
Content:
1. <script>
2. 	export default {
3. 		// this test should be removed in v2
4. 		onrender () {},
5. 		onteardown () {}
6. 	};
7. </script>

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:21:50,068 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The issue is that the async keyword is removed from the oncreate lifecycle hook. The provided context includes the core code paths that transform template properties into generated functions: src/generators/Generator.ts (parseJs, addDeclaration, addArrowFunctionExpression, addFunctionExpression). These show that when oncreate is an ArrowFunctionExpression or FunctionExpression, the generator emits a plain function without preserving the async modifier (lines 512–529 for arrow functions and 531–537 for function expressions). It also shows onrender is rewritten to oncreate (line 638), and that dom/index.ts binds oncreate but does not depend on async behavior (lines 217–229, 254–260). Validation files (src/validate/js/propValidators/*.ts) do not restrict async, indicating removal is unintended. No additional dependencies are required to conclude this is a codegen bug. Therefore, the current context is sufficient to classify the issue as a bug, and no more context is needed.' query='' extra_requirements='If you still want documentation confirmation about async lifecycle hooks, I can additionally extract the relevant README section, but it is not necessary for classification.' purpose='Confirm classification as a compiler bug caused by code generation dropping the async modifier from lifecycle hook functions.'
2025-11-11 00:21:50,073 - thread-133013323122368.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='src/generators/Generator.ts', content="1. import MagicString, { Bundle } from 'magic-string';\n2. import { walk } from 'estree-walker';\n3. import { getLocator } from 'locate-character';\n4. import deindent from '../utils/deindent';\n5. import CodeBuilder from '../utils/CodeBuilder';\n6. import getCodeFrame from '../utils/getCodeFrame';\n7. import isReference from '../utils/isReference';\n8. import flattenReference from '../utils/flattenReference';\n9. import globalWhitelist from '../utils/globalWhitelist';\n10. import reservedNames from '../utils/reservedNames';\n11. import namespaces from '../utils/namespaces';\n12. import { removeNode, removeObjectKey } from '../utils/removeNode';\n13. import wrapModule from './shared/utils/wrapModule';\n14. import annotateWithScopes from '../utils/annotateWithScopes';\n15. import clone from '../utils/clone';\n16. import DomBlock from './dom/Block';\n17. import SsrBlock from './server-side-rendering/Block';\n18. import Stylesheet from '../css/Stylesheet';\n19. import { Node, GenerateOptions, Parsed, CompileOptions, CustomElementOptions } from '../interfaces';\n20. \n21. const test = typeof global !== 'undefined' && global.__svelte_test;\n22. \n23. interface Computation {\n24. \tkey: string;\n25. \tdeps: string[]\n26. }\n27. \n28. function detectIndentation(str: string) {\n29. \tconst pattern = /^[\\t\\s]{1,4}/gm;\n30. \tlet match;\n31. \n32. \twhile (match = pattern.exec(str)) {\n33. \t\tif (match[0][0] === '\\t') return '\\t';\n34. \t\tif (match[0].length === 2) return '  ';\n35. \t}\n36. \n37. \treturn '    ';\n38. }\n39. \n40. function getIndentationLevel(str: string, b: number) {\n41. \tlet a = b;\n42. \twhile (a > 0 && str[a - 1] !== '\\n') a -= 1;\n43. \treturn /^\\s*/.exec(str.slice(a, b))[0];\n44. }\n45. \n46. function getIndentExclusionRanges(node: Node) {\n47. \tconst ranges: Node[] = [];\n48. \twalk(node, {\n49. \t\tenter(node: Node) {\n50. \t\t\tif (node.type === 'TemplateElement') ranges.push(node);\n51. \t\t}\n52. \t});\n53. \treturn ranges;\n54. }\n55. \n56. function removeIndentation(\n57. \tcode: MagicString,\n58. \tstart: number,\n59. \tend: number,\n60. \tindentationLevel: string,\n61. \tranges: Node[]\n62. ) {\n63. \tconst str = code.original.slice(start, end);\n64. \tconst pattern = new RegExp(`^${indentationLevel}`, 'gm');\n65. \tlet match;\n66. \n67. \twhile (match = pattern.exec(str)) {\n68. \t\t// TODO bail if we're inside an exclusion range\n69. \t\tcode.remove(start + match.index, start + match.index + indentationLevel.length);\n70. \t}\n71. }\n72. \n73. export default class Generator {\n74. \tast: Parsed;\n75. \tparsed: Parsed;\n76. \tsource: string;\n77. \tname: string;\n78. \toptions: CompileOptions;\n79. \n80. \tcustomElement: CustomElementOptions;\n81. \ttag: string;\n82. \tprops: string[];\n83. \n84. \tdefaultExport: Node[];\n85. \timports: Node[];\n86. \thelpers: Set<string>;\n87. \tcomponents: Set<string>;\n88. \tevents: Set<string>;\n89. \ttransitions: Set<string>;\n90. \timportedComponents: Map<string, string>;\n91. \tnamespace: string;\n92. \thasComponents: boolean;\n93. \tcomputations: Computation[];\n94. \ttemplateProperties: Record<string, Node>;\n95. \tslots: Set<string>;\n96. \tjavascript: string;\n97. \n98. \tcode: MagicString;\n99. \n100. \tbindingGroups: string[];\n101. \tindirectDependencies: Map<string, Set<string>>;\n102. \texpectedProperties: Set<string>;\n103. \tusesRefs: boolean;\n104. \n105. \tlocate: (c: number) => { line: number, column: number };\n106. \n107. \tstylesheet: Stylesheet;\n108. \n109. \tuserVars: Set<string>;\n110. \ttemplateVars: Map<string, string>;\n111. \taliases: Map<string, string>;\n112. \tusedNames: Set<string>;\n113. \n114. \tconstructor(\n115. \t\tparsed: Parsed,\n116. \t\tsource: string,\n117. \t\tname: string,\n118. \t\tstylesheet: Stylesheet,\n119. \t\toptions: CompileOptions,\n120. \t\tdom: boolean\n121. \t) {\n122. \t\tthis.ast = clone(parsed);\n123. \n124. \t\tthis.parsed = parsed;\n125. \t\tthis.source = source;\n126. \t\tthis.options = options;\n127. \n128. \t\tthis.imports = [];\n129. \t\tthis.helpers = new Set();\n130. \t\tthis.components = new Set();\n131. \t\tthis.events = new Set();\n132. \t\tthis.transitions = new Set();\n133. \t\tthis.importedComponents = new Map();\n134. \t\tthis.slots = new Set();\n135. \n136. \t\tthis.bindingGroups = [];\n137. \t\tthis.indirectDependencies = new Map();\n138. \n139. \t\tthis.locate = getLocator(this.source);\n140. \n141. \t\t// track which properties are needed, so we can provide useful info\n142. \t\t// in dev mode\n143. \t\tthis.expectedProperties = new Set();\n144. \n145. \t\tthis.code = new MagicString(source);\n146. \t\tthis.usesRefs = false;\n147. \n148. \t\t// styles\n149. \t\tthis.stylesheet = stylesheet;\n150. \n151. \t\t// allow compiler to deconflict user's `import { get } from 'whatever'` and\n152. \t\t// Svelte's builtin `import { get, ... } from 'svelte/shared.ts'`;\n153. \t\tthis.userVars = new Set();\n154. \t\tthis.templateVars = new Map();\n155. \t\tthis.aliases = new Map();\n156. \t\tthis.usedNames = new Set();\n157. \n158. \t\tthis.parseJs(dom);\n159. \t\tthis.name = this.alias(name);\n160. \n161. \t\tif (options.customElement === true) {\n162. \t\t\tthis.customElement = {\n163. \t\t\t\ttag: this.tag,\n164. \t\t\t\tprops: this.props // TODO autofill this in\n165. \t\t\t}\n166. \t\t} else {\n167. \t\t\tthis.customElement = options.customElement;\n168. \t\t}\n169. \n170. \t\tif (this.customElement && !this.customElement.tag) {\n171. \t\t\tthrow new Error(`No tag name specified`); // TODO better error\n172. \t\t}\n173. \t}\n174. \n175. \taddSourcemapLocations(node: Node) {\n176. \t\twalk(node, {\n177. \t\t\tenter: (node: Node) => {\n178. \t\t\t\tthis.code.addSourcemapLocation(node.start);\n179. \t\t\t\tthis.code.addSourcemapLocation(node.end);\n180. \t\t\t},\n181. \t\t});\n182. \t}\n183. \n184. \talias(name: string) {\n185. \t\tif (!this.aliases.has(name)) {\n186. \t\t\tthis.aliases.set(name, this.getUniqueName(name));\n187. \t\t}\n188. \n189. \t\treturn this.aliases.get(name);\n190. \t}\n191. \n192. \tcontextualise(\n193. \t\tblock: DomBlock | SsrBlock,\n194. \t\texpression: Node,\n195. \t\tcontext: string,\n196. \t\tisEventHandler: boolean\n197. \t): {\n198. \t\tdependencies: string[],\n199. \t\tcontexts: Set<string>,\n200. \t\tindexes: Set<string>,\n201. \t\tsnippet: string\n202. \t} {\n203. \t\tthis.addSourcemapLocations(expression);\n204. \n205. \t\tconst usedContexts: Set<string> = new Set();\n206. \t\tconst usedIndexes: Set<string> = new Set();\n207. \n208. \t\tconst { code, helpers } = this;\n209. \t\tconst { contexts, indexes } = block;\n210. \n211. \t\tlet scope = annotateWithScopes(expression); // TODO this already happens in findDependencies\n212. \t\tlet lexicalDepth = 0;\n213. \n214. \t\tconst self = this;\n215. \n216. \t\twalk(expression, {\n217. \t\t\tenter(node: Node, parent: Node, key: string) {\n218. \t\t\t\tif (/^Function/.test(node.type)) lexicalDepth += 1;\n219. \n220. \t\t\t\tif (node._scope) {\n221. \t\t\t\t\tscope = node._scope;\n222. \t\t\t\t\treturn;\n223. \t\t\t\t}\n224. \n225. \t\t\t\tif (node.type === 'ThisExpression') {\n226. \t\t\t\t\tif (lexicalDepth === 0 && context)\n227. \t\t\t\t\t\tcode.overwrite(node.start, node.end, context, {\n228. \t\t\t\t\t\t\tstoreName: true,\n229. \t\t\t\t\t\t\tcontentOnly: false,\n230. \t\t\t\t\t\t});\n231. \t\t\t\t} else if (isReference(node, parent)) {\n232. \t\t\t\t\tconst { name } = flattenReference(node);\n233. \t\t\t\t\tif (scope.has(name)) return;\n234. \n235. \t\t\t\t\tif (name === 'event' && isEventHandler) {\n236. \t\t\t\t\t\t// noop\n237. \t\t\t\t\t} else if (contexts.has(name)) {\n238. \t\t\t\t\t\tconst contextName = contexts.get(name);\n239. \t\t\t\t\t\tif (contextName !== name) {\n240. \t\t\t\t\t\t\t// this is true for 'reserved' names like `state` and `component`\n241. \t\t\t\t\t\t\tcode.overwrite(\n242. \t\t\t\t\t\t\t\tnode.start,\n243. \t\t\t\t\t\t\t\tnode.start + name.length,\n244. \t\t\t\t\t\t\t\tcontextName,\n245. \t\t\t\t\t\t\t\t{ storeName: true, contentOnly: false }\n246. \t\t\t\t\t\t\t);\n247. \t\t\t\t\t\t}\n248. \n249. \t\t\t\t\t\tusedContexts.add(name);\n250. \t\t\t\t\t} else if (helpers.has(name)) {\n251. \t\t\t\t\t\tlet object = node;\n252. \t\t\t\t\t\twhile (object.type === 'MemberExpression') object = object.object;\n253. \n254. \t\t\t\t\t\tconst alias = self.templateVars.get(`helpers-${name}`);\n255. \t\t\t\t\t\tif (alias !== name) code.overwrite(object.start, object.end, alias);\n256. \t\t\t\t\t} else if (indexes.has(name)) {\n257. \t\t\t\t\t\tconst context = indexes.get(name);\n258. \t\t\t\t\t\tusedContexts.add(context); // TODO is this right?\n259. \t\t\t\t\t\tusedIndexes.add(name);\n260. \t\t\t\t\t} else {\n261. \t\t\t\t\t\t// handle shorthand properties\n262. \t\t\t\t\t\tif (parent && parent.type === 'Property' && parent.shorthand) {\n263. \t\t\t\t\t\t\tif (key === 'key') {\n264. \t\t\t\t\t\t\t\tcode.appendLeft(node.start, `${name}: `);\n265. \t\t\t\t\t\t\t\treturn;\n266. \t\t\t\t\t\t\t}\n267. \t\t\t\t\t\t}\n268. \n269. \t\t\t\t\t\tif (globalWhitelist.has(name)) {\n270. \t\t\t\t\t\t\tcode.prependRight(node.start, `('${name}' in state ? state.`);\n271. \t\t\t\t\t\t\tcode.appendLeft(\n272. \t\t\t\t\t\t\t\tnode.object ? node.object.end : node.end,\n273. \t\t\t\t\t\t\t\t` : ${name})`\n274. \t\t\t\t\t\t\t);\n275. \t\t\t\t\t\t} else {\n276. \t\t\t\t\t\t\tcode.prependRight(node.start, `state.`);\n277. \t\t\t\t\t\t}\n278. \n279. \t\t\t\t\t\tusedContexts.add('state');\n280. \t\t\t\t\t}\n281. \n282. \t\t\t\t\tthis.skip();\n283. \t\t\t\t}\n284. \t\t\t},\n285. \n286. \t\t\tleave(node: Node) {\n287. \t\t\t\tif (/^Function/.test(node.type)) lexicalDepth -= 1;\n288. \t\t\t\tif (node._scope) scope = scope.parent;\n289. \t\t\t},\n290. \t\t});\n291. \n292. \t\tconst dependencies: Set<string> = new Set(expression._dependencies || []);\n293. \n294. \t\tif (expression._dependencies) {\n295. \t\t\texpression._dependencies.forEach((prop: string) => {\n296. \t\t\t\tif (this.indirectDependencies.has(prop)) {\n297. \t\t\t\t\tthis.indirectDependencies.get(prop).forEach(dependency => {\n298. \t\t\t\t\t\tdependencies.add(dependency);\n299. \t\t\t\t\t});\n300. \t\t\t\t}\n301. \t\t\t});\n302. \t\t}\n303. \n304. \t\treturn {\n305. \t\t\tdependencies: Array.from(dependencies),\n306. \t\t\tcontexts: usedContexts,\n307. \t\t\tindexes: usedIndexes,\n308. \t\t\tsnippet: `[✂${expression.start}-${expression.end}✂]`,\n309. \t\t};\n310. \t}\n311. \n312. \tfindDependencies(\n313. \t\tcontextDependencies: Map<string, string[]>,\n314. \t\tindexes: Map<string, string>,\n315. \t\texpression: Node\n316. \t) {\n317. \t\tif (expression._dependencies) return expression._dependencies;\n318. \n319. \t\tlet scope = annotateWithScopes(expression);\n320. \t\tconst dependencies: string[] = [];\n321. \n322. \t\tconst generator = this; // can't use arrow functions, because of this.skip()\n323. \n324. \t\twalk(expression, {\n325. \t\t\tenter(node: Node, parent: Node) {\n326. \t\t\t\tif (node._scope) {\n327. \t\t\t\t\tscope = node._scope;\n328. \t\t\t\t\treturn;\n329. \t\t\t\t}\n330. \n331. \t\t\t\tif (isReference(node, parent)) {\n332. \t\t\t\t\tconst { name } = flattenReference(node);\n333. \t\t\t\t\tif (scope.has(name) || generator.helpers.has(name)) return;\n334. \n335. \t\t\t\t\tif (contextDependencies.has(name)) {\n336. \t\t\t\t\t\tdependencies.push(...contextDependencies.get(name));\n337. \t\t\t\t\t} else if (!indexes.has(name)) {\n338. \t\t\t\t\t\tdependencies.push(name);\n339. \t\t\t\t\t}\n340. \n341. \t\t\t\t\tthis.skip();\n342. \t\t\t\t}\n343. \t\t\t},\n344. \n345. \t\t\tleave(node: Node) {\n346. \t\t\t\tif (node._scope) scope = scope.parent;\n347. \t\t\t},\n348. \t\t});\n349. \n350. \t\tdependencies.forEach(name => {\n351. \t\t\tif (!globalWhitelist.has(name)) {\n352. \t\t\t\tthis.expectedProperties.add(name);\n353. \t\t\t}\n354. \t\t});\n355. \n356. \t\treturn (expression._dependencies = dependencies);\n357. \t}\n358. \n359. \tgenerate(result: string, options: CompileOptions, { banner = '', sharedPath, helpers, name, format }: GenerateOptions ) {\n360. \t\tconst pattern = /\\[✂(\\d+)-(\\d+)$/;\n361. \n362. \t\tconst module = wrapModule(result, format, name, options, banner, sharedPath, helpers, this.imports, this.source);\n363. \n364. \t\tconst parts = module.split('✂]');\n365. \t\tconst finalChunk = parts.pop();\n366. \n367. \t\tconst compiled = new Bundle({ separator: '' });\n368. \n369. \t\tfunction addString(str: string) {\n370. \t\t\tcompiled.addSource({\n371. \t\t\t\tcontent: new MagicString(str),\n372. \t\t\t});\n373. \t\t}\n374. \n375. \t\tconst { filename } = options;\n376. \n377. \t\t// special case — the source file doesn't actually get used anywhere. we need\n378. \t\t// to add an empty file to populate map.sources and map.sourcesContent\n379. \t\tif (!parts.length) {\n380. \t\t\tcompiled.addSource({\n381. \t\t\t\tfilename,\n382. \t\t\t\tcontent: new MagicString(this.source).remove(0, this.source.length),\n383. \t\t\t});\n384. \t\t}\n385. \n386. \t\tparts.forEach((str: string) => {\n387. \t\t\tconst chunk = str.replace(pattern, '');\n388. \t\t\tif (chunk) addString(chunk);\n389. \n390. \t\t\tconst match = pattern.exec(str);\n391. \n392. \t\t\tconst snippet = this.code.snip(+match[1], +match[2]);\n393. \n394. \t\t\tcompiled.addSource({\n395. \t\t\t\tfilename,\n396. \t\t\t\tcontent: snippet,\n397. \t\t\t});\n398. \t\t});\n399. \n400. \t\taddString(finalChunk);\n401. \n402. \t\tconst { css, cssMap } = this.customElement ?\n403. \t\t\t{ css: null, cssMap: null } :\n404. \t\t\tthis.stylesheet.render(options.cssOutputFilename, true);\n405. \n406. \t\treturn {\n407. \t\t\tast: this.ast,\n408. \t\t\tcode: compiled.toString(),\n409. \t\t\tmap: compiled.generateMap({\n410. \t\t\t\tincludeContent: true,\n411. \t\t\t\tfile: options.outputFilename,\n412. \t\t\t}),\n413. \t\t\tcss,\n414. \t\t\tcssMap\n415. \t\t};\n416. \t}\n417. \n418. \tgetUniqueName(name: string) {\n419. \t\tif (test) name = `${name}$`;\n420. \t\tlet alias = name;\n421. \t\tfor (\n422. \t\t\tlet i = 1;\n423. \t\t\treservedNames.has(alias) ||\n424. \t\t\tthis.userVars.has(alias) ||\n425. \t\t\tthis.usedNames.has(alias);\n426. \t\t\talias = `${name}_${i++}`\n427. \t\t);\n428. \t\tthis.usedNames.add(alias);\n429. \t\treturn alias;\n430. \t}\n431. \n432. \tgetUniqueNameMaker(params: string[]) {\n433. \t\tconst localUsedNames = new Set(params);\n434. \n435. \t\tfunction add(name: string) {\n436. \t\t\tlocalUsedNames.add(name);\n437. \t\t}\n438. \n439. \t\treservedNames.forEach(add);\n440. \t\tthis.userVars.forEach(add);\n441. \n442. \t\treturn (name: string) => {\n443. \t\t\tif (test) name = `${name}$`;\n444. \t\t\tlet alias = name;\n445. \t\t\tfor (\n446. \t\t\t\tlet i = 1;\n447. \t\t\t\tthis.usedNames.has(alias) ||\n448. \t\t\t\tlocalUsedNames.has(alias);\n449. \t\t\t\talias = `${name}_${i++}`\n450. \t\t\t);\n451. \t\t\tlocalUsedNames.add(alias);\n452. \t\t\treturn alias;\n453. \t\t};\n454. \t}\n455. \n456. \tparseJs(dom: boolean) {\n457. \t\tconst { code, source } = this;\n458. \t\tconst { js } = this.parsed;\n459. \n460. \t\tconst imports = this.imports;\n461. \t\tconst computations: Computation[] = [];\n462. \t\tconst templateProperties: Record<string, Node> = {};\n463. \t\tconst componentDefinition = new CodeBuilder();\n464. \n465. \t\tlet namespace = null;\n466. \n467. \t\tif (js) {\n468. \t\t\tthis.addSourcemapLocations(js.content);\n469. \n470. \t\t\tconst indentation = detectIndentation(source.slice(js.start, js.end));\n471. \t\t\tconst indentationLevel = getIndentationLevel(source, js.content.body[0].start);\n472. \t\t\tconst indentExclusionRanges = getIndentExclusionRanges(js.content);\n473. \n474. \t\t\tconst scope = annotateWithScopes(js.content);\n475. \t\t\tscope.declarations.forEach(name => {\n476. \t\t\t\tthis.userVars.add(name);\n477. \t\t\t});\n478. \n479. \t\t\tconst body = js.content.body.slice(); // slice, because we're going to be mutating the original\n480. \n481. \t\t\t// imports need to be hoisted out of the IIFE\n482. \t\t\tfor (let i = 0; i < body.length; i += 1) {\n483. \t\t\t\tconst node = body[i];\n484. \t\t\t\tif (node.type === 'ImportDeclaration') {\n485. \t\t\t\t\tremoveNode(code, js.content, node);\n486. \t\t\t\t\timports.push(node);\n487. \n488. \t\t\t\t\tnode.specifiers.forEach((specifier: Node) => {\n489. \t\t\t\t\t\tthis.userVars.add(specifier.local.name);\n490. \t\t\t\t\t});\n491. \t\t\t\t}\n492. \t\t\t}\n493. \n494. \t\t\tconst defaultExport = this.defaultExport = body.find(\n495. \t\t\t\t(node: Node) => node.type === 'ExportDefaultDeclaration'\n496. \t\t\t);\n497. \n498. \t\t\tif (defaultExport) {\n499. \t\t\t\tdefaultExport.declaration.properties.forEach((prop: Node) => {\n500. \t\t\t\t\ttemplateProperties[prop.key.name] = prop;\n501. \t\t\t\t});\n502. \n503. \t\t\t\t['helpers', 'events', 'components', 'transitions'].forEach(key => {\n504. \t\t\t\t\tif (templateProperties[key]) {\n505. \t\t\t\t\t\ttemplateProperties[key].value.properties.forEach((prop: Node) => {\n506. \t\t\t\t\t\t\tthis[key].add(prop.key.name);\n507. \t\t\t\t\t\t});\n508. \t\t\t\t\t}\n509. \t\t\t\t});\n510. \n511. \t\t\t\tconst addArrowFunctionExpression = (name: string, node: Node) => {\n512. \t\t\t\t\tconst { body, params } = node;\n513. \n514. \t\t\t\t\tconst paramString = params.length ?\n515. \t\t\t\t\t\t`[✂${params[0].start}-${params[params.length - 1].end}✂]` :\n516. \t\t\t\t\t\t``;\n517. \n518. \t\t\t\t\tif (body.type === 'BlockStatement') {\n519. \t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n520. \t\t\t\t\t\t\tfunction ${name}(${paramString}) [✂${body.start}-${body.end}✂]\n521. \t\t\t\t\t\t`);\n522. \t\t\t\t\t} else {\n523. \t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n524. \t\t\t\t\t\t\tfunction ${name}(${paramString}) {\n525. \t\t\t\t\t\t\t\treturn [✂${body.start}-${body.end}✂];\n526. \t\t\t\t\t\t\t}\n527. \t\t\t\t\t\t`);\n528. \t\t\t\t\t}\n529. \t\t\t\t};\n530. \n531. \t\t\t\tconst addFunctionExpression = (name: string, node: Node) => {\n532. \t\t\t\t\tlet c = node.start;\n533. \t\t\t\t\twhile (this.source[c] !== '(') c += 1;\n534. \t\t\t\t\tcomponentDefinition.addBlock(deindent`\n535. \t\t\t\t\t\tfunction ${name}[✂${c}-${node.end}✂];\n536. \t\t\t\t\t`);\n537. \t\t\t\t};\n538. \n539. \t\t\t\tconst addValue = (name: string, node: Node) => {\n540. \t\t\t\t\tcomponentDefinition.addBlock(deindent`\n541. \t\t\t\t\t\tvar ${name} = [✂${node.start}-${node.end}✂];\n542. \t\t\t\t\t`);\n543. \t\t\t\t};\n544. \n545. \t\t\t\tconst addDeclaration = (key: string, node: Node, disambiguator?: string) => {\n546. \t\t\t\t\tconst qualified = disambiguator ? `${disambiguator}-${key}` : key;\n547. \n548. \t\t\t\t\tif (node.type === 'Identifier' && node.name === key) {\n549. \t\t\t\t\t\tthis.templateVars.set(qualified, key);\n550. \t\t\t\t\t\treturn;\n551. \t\t\t\t\t}\n552. \n553. \t\t\t\t\tlet name = this.getUniqueName(key);\n554. \t\t\t\t\tthis.templateVars.set(qualified, name);\n555. \n556. \t\t\t\t\t// deindent\n557. \t\t\t\t\tconst indentationLevel = getIndentationLevel(source, node.start);\n558. \t\t\t\t\tif (indentationLevel) {\n559. \t\t\t\t\t\tremoveIndentation(code, node.start, node.end, indentationLevel, indentExclusionRanges);\n560. \t\t\t\t\t}\n561. \n562. \t\t\t\t\tif (node.type === 'ArrowFunctionExpression') {\n563. \t\t\t\t\t\taddArrowFunctionExpression(name, node);\n564. \t\t\t\t\t} else if (node.type === 'FunctionExpression') {\n565. \t\t\t\t\t\taddFunctionExpression(name, node);\n566. \t\t\t\t\t} else {\n567. \t\t\t\t\t\taddValue(name, node);\n568. \t\t\t\t\t}\n569. \t\t\t\t};\n570. \n571. \t\t\t\tif (templateProperties.components) {\n572. \t\t\t\t\ttemplateProperties.components.value.properties.forEach((property: Node) => {\n573. \t\t\t\t\t\taddDeclaration(property.key.name, property.value, 'components');\n574. \t\t\t\t\t});\n575. \t\t\t\t}\n576. \n577. \t\t\t\tif (templateProperties.computed) {\n578. \t\t\t\t\tconst dependencies = new Map();\n579. \n580. \t\t\t\t\ttemplateProperties.computed.value.properties.forEach((prop: Node) => {\n581. \t\t\t\t\t\tconst key = prop.key.name;\n582. \t\t\t\t\t\tconst value = prop.value;\n583. \n584. \t\t\t\t\t\tconst deps = value.params.map(\n585. \t\t\t\t\t\t\t(param: Node) =>\n586. \t\t\t\t\t\t\t\tparam.type === 'AssignmentPattern' ? param.left.name : param.name\n587. \t\t\t\t\t\t);\n588. \t\t\t\t\t\tdependencies.set(key, deps);\n589. \t\t\t\t\t});\n590. \n591. \t\t\t\t\tconst visited = new Set();\n592. \n593. \t\t\t\t\tconst visit = (key: string) => {\n594. \t\t\t\t\t\tif (!dependencies.has(key)) return; // not a computation\n595. \n596. \t\t\t\t\t\tif (visited.has(key)) return;\n597. \t\t\t\t\t\tvisited.add(key);\n598. \n599. \t\t\t\t\t\tconst deps = dependencies.get(key);\n600. \t\t\t\t\t\tdeps.forEach(visit);\n601. \n602. \t\t\t\t\t\tcomputations.push({ key, deps });\n603. \n604. \t\t\t\t\t\tconst prop = templateProperties.computed.value.properties.find((prop: Node) => prop.key.name === key);\n605. \t\t\t\t\t\taddDeclaration(key, prop.value, 'computed');\n606. \t\t\t\t\t};\n607. \n608. \t\t\t\t\ttemplateProperties.computed.value.properties.forEach((prop: Node) =>\n609. \t\t\t\t\t\tvisit(prop.key.name)\n610. \t\t\t\t\t);\n611. \t\t\t\t}\n612. \n613. \t\t\t\tif (templateProperties.data) {\n614. \t\t\t\t\taddDeclaration('data', templateProperties.data.value);\n615. \t\t\t\t}\n616. \n617. \t\t\t\tif (templateProperties.events && dom) {\n618. \t\t\t\t\ttemplateProperties.events.value.properties.forEach((property: Node) => {\n619. \t\t\t\t\t\taddDeclaration(property.key.name, property.value, 'events');\n620. \t\t\t\t\t});\n621. \t\t\t\t}\n622. \n623. \t\t\t\tif (templateProperties.helpers) {\n624. \t\t\t\t\ttemplateProperties.helpers.value.properties.forEach((property: Node) => {\n625. \t\t\t\t\t\taddDeclaration(property.key.name, property.value, 'helpers');\n626. \t\t\t\t\t});\n627. \t\t\t\t}\n628. \n629. \t\t\t\tif (templateProperties.methods && dom) {\n630. \t\t\t\t\taddDeclaration('methods', templateProperties.methods.value);\n631. \t\t\t\t}\n632. \n633. \t\t\t\tif (templateProperties.namespace) {\n634. \t\t\t\t\tconst ns = templateProperties.namespace.value.value;\n635. \t\t\t\t\tnamespace = namespaces[ns] || ns;\n636. \t\t\t\t}\n637. \n638. \t\t\t\tif (templateProperties.onrender) templateProperties.oncreate = templateProperties.onrender; // remove after v2\n639. \t\t\t\tif (templateProperties.oncreate && dom) {\n640. \t\t\t\t\taddDeclaration('oncreate', templateProperties.oncreate.value);\n641. \t\t\t\t}\n642. \n643. \t\t\t\tif (templateProperties.onteardown) templateProperties.ondestroy = templateProperties.onteardown; // remove after v2\n644. \t\t\t\tif (templateProperties.ondestroy && dom) {\n645. \t\t\t\t\taddDeclaration('ondestroy', templateProperties.ondestroy.value);\n646. \t\t\t\t}\n647. \n648. \t\t\t\tif (templateProperties.props) {\n649. \t\t\t\t\tthis.props = templateProperties.props.value.elements.map((element: Node) => element.value);\n650. \t\t\t\t}\n651. \n652. \t\t\t\tif (templateProperties.setup) {\n653. \t\t\t\t\taddDeclaration('setup', templateProperties.setup.value);\n654. \t\t\t\t}\n655. \n656. \t\t\t\tif (templateProperties.tag) {\n657. \t\t\t\t\tthis.tag = templateProperties.tag.value.value;\n658. \t\t\t\t}\n659. \n660. \t\t\t\tif (templateProperties.transitions) {\n661. \t\t\t\t\ttemplateProperties.transitions.value.properties.forEach((property: Node) => {\n662. \t\t\t\t\t\taddDeclaration(property.key.name, property.value, 'transitions');\n663. \t\t\t\t\t});\n664. \t\t\t\t}\n665. \t\t\t}\n666. \n667. \t\t\tif (indentationLevel) {\n668. \t\t\t\tif (defaultExport) {\n669. \t\t\t\t\tremoveIndentation(code, js.content.start, defaultExport.start, indentationLevel, indentExclusionRanges);\n670. \t\t\t\t\tremoveIndentation(code, defaultExport.end, js.content.end, indentationLevel, indentExclusionRanges);\n671. \t\t\t\t} else {\n672. \t\t\t\t\tremoveIndentation(code, js.content.start, js.content.end, indentationLevel, indentExclusionRanges);\n673. \t\t\t\t}\n674. \t\t\t}\n675. \n676. \t\t\tlet a = js.content.start;\n677. \t\t\twhile (/\\s/.test(source[a])) a += 1;\n678. \n679. \t\t\tlet b = js.content.end;\n680. \t\t\twhile (/\\s/.test(source[b - 1])) b -= 1;\n681. \n682. \t\t\tif (defaultExport) {\n683. \t\t\t\tthis.javascript = '';\n684. \t\t\t\tif (a !== defaultExport.start) this.javascript += `[✂${a}-${defaultExport.start}✂]`;\n685. \t\t\t\tif (!componentDefinition.isEmpty()) this.javascript += componentDefinition;\n686. \t\t\t\tif (defaultExport.end !== b) this.javascript += `[✂${defaultExport.end}-${b}✂]`;\n687. \t\t\t} else {\n688. \t\t\t\tthis.javascript = a === b ? null : `[✂${a}-${b}✂]`;\n689. \t\t\t}\n690. \t\t}\n691. \n692. \t\tthis.computations = computations;\n693. \t\tthis.namespace = namespace;\n694. \t\tthis.templateProperties = templateProperties;\n695. \t}\n696. }", start_line_number=1, end_line_number=950), Context(relative_path='src/generators/dom/index.ts', content='1. import MagicString from \'magic-string\';\n2. import { parseExpressionAt } from \'acorn\';\n3. import annotateWithScopes from \'../../utils/annotateWithScopes\';\n4. import isReference from \'../../utils/isReference\';\n5. import { walk } from \'estree-walker\';\n6. import deindent from \'../../utils/deindent\';\n7. import { stringify, escape } from \'../../utils/stringify\';\n8. import CodeBuilder from \'../../utils/CodeBuilder\';\n9. import reservedNames from \'../../utils/reservedNames\';\n10. import visit from \'./visit\';\n11. import shared from \'./shared\';\n12. import Generator from \'../Generator\';\n13. import Stylesheet from \'../../css/Stylesheet\';\n14. import preprocess from \'./preprocess\';\n15. import Block from \'./Block\';\n16. import { version } from \'../../../package.json\';\n17. import { Parsed, CompileOptions, Node } from \'../../interfaces\';\n18. \n19. const test = typeof global !== \'undefined\' && global.__svelte_test;\n20. \n21. export class DomGenerator extends Generator {\n22. \tblocks: (Block|string)[];\n23. \treadonly: Set<string>;\n24. \tmetaBindings: string[];\n25. \n26. \thydratable: boolean;\n27. \tlegacy: boolean;\n28. \n29. \thasIntroTransitions: boolean;\n30. \thasOutroTransitions: boolean;\n31. \thasComplexBindings: boolean;\n32. \n33. \tneedsEncapsulateHelper: boolean;\n34. \n35. \tconstructor(\n36. \t\tparsed: Parsed,\n37. \t\tsource: string,\n38. \t\tname: string,\n39. \t\tstylesheet: Stylesheet,\n40. \t\toptions: CompileOptions\n41. \t) {\n42. \t\tsuper(parsed, source, name, stylesheet, options, true);\n43. \t\tthis.blocks = [];\n44. \n45. \t\tthis.readonly = new Set();\n46. \n47. \t\tthis.hydratable = options.hydratable;\n48. \t\tthis.legacy = options.legacy;\n49. \t\tthis.needsEncapsulateHelper = false;\n50. \n51. \t\t// initial values for e.g. window.innerWidth, if there\'s a <:Window> meta tag\n52. \t\tthis.metaBindings = [];\n53. \t}\n54. \n55. \tgetUniqueNameMaker(params: string[]) {\n56. \t\tconst localUsedNames = new Set(params);\n57. \n58. \t\tfunction add(name: string) {\n59. \t\t\tlocalUsedNames.add(name);\n60. \t\t}\n61. \n62. \t\treservedNames.forEach(add);\n63. \t\tthis.userVars.forEach(add);\n64. \t\tfor (const name in shared) {\n65. \t\t\tlocalUsedNames.add(test ? `${name}$` : name);\n66. \t\t}\n67. \n68. \t\treturn (name: string) => {\n69. \t\t\tif (test) name = `${name}$`;\n70. \t\t\tlet alias = name;\n71. \t\t\tfor (\n72. \t\t\t\tlet i = 1;\n73. \t\t\t\tthis.usedNames.has(alias) ||\n74. \t\t\t\tlocalUsedNames.has(alias);\n75. \t\t\t\talias = `${name}_${i++}`\n76. \t\t\t);\n77. \t\t\tlocalUsedNames.add(alias);\n78. \t\t\treturn alias;\n79. \t\t};\n80. \t}\n81. }\n82. \n83. export default function dom(\n84. \tparsed: Parsed,\n85. \tsource: string,\n86. \tstylesheet: Stylesheet,\n87. \toptions: CompileOptions\n88. ) {\n89. \tconst format = options.format || \'es\';\n90. \n91. \tconst generator = new DomGenerator(parsed, source, options.name || \'SvelteComponent\', stylesheet, options);\n92. \n93. \tconst {\n94. \t\tcomputations,\n95. \t\tname,\n96. \t\ttemplateProperties,\n97. \t\tnamespace,\n98. \t} = generator;\n99. \n100. \tconst { block, state } = preprocess(generator, namespace, parsed.html);\n101. \n102. \tgenerator.stylesheet.warnOnUnusedSelectors(options.onwarn);\n103. \n104. \tparsed.html.children.forEach((node: Node) => {\n105. \t\tvisit(generator, block, state, node, [], []);\n106. \t});\n107. \n108. \tconst builder = new CodeBuilder();\n109. \tconst computationBuilder = new CodeBuilder();\n110. \tconst computationDeps = new Set();\n111. \n112. \tif (computations.length) {\n113. \t\tcomputations.forEach(({ key, deps }) => {\n114. \t\t\tdeps.forEach(dep => {\n115. \t\t\t\tcomputationDeps.add(dep);\n116. \t\t\t});\n117. \n118. \t\t\tif (generator.readonly.has(key)) {\n119. \t\t\t\t// <:Window> bindings\n120. \t\t\t\tthrow new Error(\n121. \t\t\t\t\t`Cannot have a computed value \'${key}\' that clashes with a read-only property`\n122. \t\t\t\t);\n123. \t\t\t}\n124. \n125. \t\t\tgenerator.readonly.add(key);\n126. \n127. \t\t\tconst condition = `${deps.map(dep => `changed.${dep}`).join(\' || \')}`;\n128. \n129. \t\t\tconst statement = `if (@differs(state.${key}, (state.${key} = %computed-${key}(${deps\n130. \t\t\t\t.map(dep => `state.${dep}`)\n131. \t\t\t\t.join(\', \')})))) changed.${key} = true;`;\n132. \n133. \t\t\tcomputationBuilder.addConditional(condition, statement);\n134. \t\t});\n135. \t}\n136. \n137. \tif (generator.javascript) {\n138. \t\tbuilder.addBlock(generator.javascript);\n139. \t}\n140. \n141. \tif (generator.needsEncapsulateHelper) {\n142. \t\tbuilder.addBlock(deindent`\n143. \t\t\tfunction @encapsulateStyles(node) {\n144. \t\t\t\t@setAttribute(node, "${generator.stylesheet.id}", "");\n145. \t\t\t}\n146. \t\t`);\n147. \t}\n148. \n149. \tconst { css, cssMap } = generator.stylesheet.render(options.filename, !generator.customElement);\n150. \tconst styles = generator.stylesheet.hasStyles && stringify(options.dev ?\n151. \t\t`${css}\\n/*# sourceMappingURL=${cssMap.toUrl()} */` :\n152. \t\tcss, { onlyEscapeAtSymbol: true });\n153. \n154. \tif (styles && generator.options.css !== false && !generator.customElement) {\n155. \t\tbuilder.addBlock(deindent`\n156. \t\t\tfunction @add_css() {\n157. \t\t\t\tvar style = @createElement("style");\n158. \t\t\t\tstyle.id = \'${generator.stylesheet.id}-style\';\n159. \t\t\t\tstyle.textContent = ${styles};\n160. \t\t\t\t@appendNode(style, document.head);\n161. \t\t\t}\n162. \t\t`);\n163. \t}\n164. \n165. \tgenerator.blocks.forEach(block => {\n166. \t\tbuilder.addBlock(block.toString());\n167. \t});\n168. \n169. \tconst sharedPath = options.shared === true\n170. \t\t? \'svelte/shared.js\'\n171. \t\t: options.shared;\n172. \n173. \tconst prototypeBase =\n174. \t\t`${name}.prototype` +\n175. \t\t(templateProperties.methods ? `, %methods` : \'\');\n176. \tconst proto = sharedPath\n177. \t\t? `@proto`\n178. \t\t: deindent`\n179. \t\t{\n180. \t\t\t${[\'destroy\', \'get\', \'fire\', \'observe\', \'on\', \'set\', \'teardown\', \'_set\', \'_mount\', \'_unmount\']\n181. \t\t\t\t.map(n => `${n}: @${n === \'teardown\' ? \'destroy\' : n}`)\n182. \t\t\t\t.join(\',\\n\')}\n183. \t\t}`;\n184. \n185. \tconst debugName = `<${generator.customElement ? generator.tag : name}>`;\n186. \n187. \tconst constructorBody = deindent`\n188. \t\t${options.dev && `this._debugName = \'${debugName}\';`}\n189. \t\t${options.dev && !generator.customElement &&\n190. \t\t\t`if (!options || (!options.target && !options._root)) throw new Error("\'target\' is a required option");`}\n191. \t\t@init(this, options);\n192. \t\t${generator.usesRefs && `this.refs = {};`}\n193. \t\tthis._state = @assign(${templateProperties.data ? \'%data()\' : \'{}\'}, options.data);\n194. \t\t${generator.metaBindings}\n195. \t\t${computations.length && `this._recompute({ ${Array.from(computationDeps).map(dep => `${dep}: 1`).join(\', \')} }, this._state);`}\n196. \t\t${options.dev &&\n197. \t\t\tArray.from(generator.expectedProperties).map(\n198. \t\t\t\tprop =>\n199. \t\t\t\t\t`if (!(\'${prop}\' in this._state)) console.warn("${debugName} was created without expected data property \'${prop}\'");`\n200. \t\t\t)}\n201. \t\t${generator.bindingGroups.length &&\n202. \t\t\t`this._bindingGroups = [${Array(generator.bindingGroups.length).fill(\'[]\').join(\', \')}];`}\n203. \n204. \t\t${templateProperties.ondestroy && `this._handlers.destroy = [%ondestroy]`}\n205. \n206. \t\t${generator.slots.size && `this._slotted = options.slots || {};`}\n207. \n208. \t\t${generator.customElement ?\n209. \t\t\tdeindent`\n210. \t\t\t\tthis.attachShadow({ mode: \'open\' });\n211. \t\t\t\t${css && `this.shadowRoot.innerHTML = \\`<style>${escape(css, { onlyEscapeAtSymbol: true }).replace(/\\\\/g, \'\\\\\\\\\')}${options.dev ? `\\n/*# sourceMappingURL=${cssMap.toUrl()} */` : \'\'}</style>\\`;`}\n212. \t\t\t` :\n213. \t\t\t(generator.stylesheet.hasStyles && options.css !== false &&\n214. \t\t\t`if (!document.getElementById("${generator.stylesheet.id}-style")) @add_css();`)\n215. \t\t}\n216. \n217. \t\t${templateProperties.oncreate && `var _oncreate = %oncreate.bind(this);`}\n218. \n219. \t\t${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`\n220. \t\t\tif (!options._root) {\n221. \t\t\t\tthis._oncreate = [${templateProperties.oncreate && `_oncreate`}];\n222. \t\t\t\t${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}\n223. \t\t\t\t${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}\n224. \t\t\t} ${templateProperties.oncreate && deindent`\n225. \t\t\t\telse {\n226. \t\t\t\t\tthis._root._oncreate.push(_oncreate);\n227. \t\t\t\t}\n228. \t\t\t`}\n229. \t\t`}\n230. \n231. \t\t${generator.slots.size && `this.slots = {};`}\n232. \n233. \t\tthis._fragment = @create_main_fragment(this._state, this);\n234. \n235. \t\t${generator.customElement ? deindent`\n236. \t\t\tthis._fragment.c();\n237. \t\t\tthis._fragment.${block.hasIntroMethod ? \'i\' : \'m\'}(this.shadowRoot, null);\n238. \n239. \t\t\tif (options.target) this._mount(options.target, options.anchor || null);\n240. \t\t` : deindent`\n241. \t\t\tif (options.target) {\n242. \t\t\t\t${generator.hydratable\n243. \t\t\t\t\t? deindent`\n244. \t\t\t\t\t\tvar nodes = @children(options.target);\n245. \t\t\t\t\t\toptions.hydrate ? this._fragment.l(nodes) : this._fragment.c();\n246. \t\t\t\t\t\tnodes.forEach(@detachNode);\n247. \t\t\t\t\t` :\n248. \t\t\t\t\tdeindent`\n249. \t\t\t\t\t\t${options.dev && `if (options.hydrate) throw new Error("options.hydrate only works if the component was compiled with the \\`hydratable: true\\` option");`}\n250. \t\t\t\t\t\tthis._fragment.c();\n251. \t\t\t\t\t`}\n252. \t\t\t\tthis._fragment.${block.hasIntroMethod ? \'i\' : \'m\'}(options.target, options.anchor || null);\n253. \n254. \t\t\t\t${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`\n255. \t\t\t\t\t${generator.hasComponents && `this._lock = true;`}\n256. \t\t\t\t\t${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}\n257. \t\t\t\t\t${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}\n258. \t\t\t\t\t${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}\n259. \t\t\t\t\t${generator.hasComponents && `this._lock = false;`}\n260. \t\t\t\t`}\n261. \t\t\t}\n262. \t\t`}\n263. \t`;\n264. \n265. \tif (generator.customElement) {\n266. \t\tconst props = generator.props || Array.from(generator.expectedProperties);\n267. \n268. \t\tbuilder.addBlock(deindent`\n269. \t\t\tclass ${name} extends HTMLElement {\n270. \t\t\t\tconstructor(options = {}) {\n271. \t\t\t\t\tsuper();\n272. \t\t\t\t\t${constructorBody}\n273. \t\t\t\t}\n274. \n275. \t\t\t\tstatic get observedAttributes() {\n276. \t\t\t\t\treturn ${JSON.stringify(props)};\n277. \t\t\t\t}\n278. \n279. \t\t\t\t${props.map(prop => deindent`\n280. \t\t\t\t\tget ${prop}() {\n281. \t\t\t\t\t\treturn this.get(\'${prop}\');\n282. \t\t\t\t\t}\n283. \n284. \t\t\t\t\tset ${prop}(value) {\n285. \t\t\t\t\t\tthis.set({ ${prop}: value });\n286. \t\t\t\t\t}\n287. \t\t\t\t`).join(\'\\n\\n\')}\n288. \n289. \t\t\t\t${generator.slots.size && deindent`\n290. \t\t\t\t\tconnectedCallback() {\n291. \t\t\t\t\t\tObject.keys(this._slotted).forEach(key => {\n292. \t\t\t\t\t\t\tthis.appendChild(this._slotted[key]);\n293. \t\t\t\t\t\t});\n294. \t\t\t\t\t}`}\n295. \n296. \t\t\t\tattributeChangedCallback(attr, oldValue, newValue) {\n297. \t\t\t\t\tthis.set({ [attr]: newValue });\n298. \t\t\t\t}\n299. \t\t\t}\n300. \n301. \t\t\tcustomElements.define("${generator.tag}", ${name});\n302. \t\t\t@assign(${prototypeBase}, ${proto}, {\n303. \t\t\t\t_mount(target, anchor) {\n304. \t\t\t\t\ttarget.insertBefore(this, anchor);\n305. \t\t\t\t},\n306. \n307. \t\t\t\t_unmount() {\n308. \t\t\t\t\tthis.parentNode.removeChild(this);\n309. \t\t\t\t}\n310. \t\t\t});\n311. \t\t`);\n312. \t} else {\n313. \t\tbuilder.addBlock(deindent`\n314. \t\t\tfunction ${name}(options) {\n315. \t\t\t\t${constructorBody}\n316. \t\t\t}\n317. \n318. \t\t\t@assign(${prototypeBase}, ${proto});\n319. \t\t`);\n320. \t}\n321. \n322. \tbuilder.addBlock(deindent`\n323. \t\t${options.dev && deindent`\n324. \t\t\t${name}.prototype._checkReadOnly = function _checkReadOnly(newState) {\n325. \t\t\t\t${Array.from(generator.readonly).map(\n326. \t\t\t\t\tprop =>\n327. \t\t\t\t\t\t`if (\'${prop}\' in newState && !this._updatingReadonlyProperty) throw new Error("${debugName}: Cannot set read-only property \'${prop}\'");`\n328. \t\t\t\t)}\n329. \t\t\t};\n330. \t\t`}\n331. \n332. \t\t${computations.length ? deindent`\n333. \t\t\t${name}.prototype._recompute = function _recompute(changed, state) {\n334. \t\t\t\t${computationBuilder}\n335. \t\t\t}\n336. \t\t` : (!sharedPath && `${name}.prototype._recompute = @noop;`)}\n337. \n338. \t\t${templateProperties.setup && `%setup(${name});`}\n339. \t`);\n340. \n341. \tconst usedHelpers = new Set();\n342. \n343. \tlet result = builder\n344. \t\t.toString()\n345. \t\t.replace(/(%+|@+)(\\w*(?:-\\w*)?)/g, (match: string, sigil: string, name: string) => {\n346. \t\t\tif (sigil === \'@\') {\n347. \t\t\t\tif (name in shared) {\n348. \t\t\t\t\tif (options.dev && `${name}Dev` in shared) name = `${name}Dev`;\n349. \t\t\t\t\tusedHelpers.add(name);\n350. \t\t\t\t}\n351. \n352. \t\t\t\treturn generator.alias(name);\n353. \t\t\t}\n354. \n355. \t\t\tif (sigil === \'%\') {\n356. \t\t\t\treturn generator.templateVars.get(name);\n357. \t\t\t}\n358. \n359. \t\t\treturn sigil.slice(1) + name;\n360. \t\t});\n361. \n362. \tlet helpers;\n363. \n364. \tif (sharedPath) {\n365. \t\tif (format !== \'es\' && format !== \'cjs\') {\n366. \t\t\tthrow new Error(`Components with shared helpers must be compiled with \\`format: \'es\'\\` or \\`format: \'cjs\'\\``);\n367. \t\t}\n368. \t\tconst used = Array.from(usedHelpers).sort();\n369. \t\thelpers = used.map(name => {\n370. \t\t\tconst alias = generator.alias(name);\n371. \t\t\treturn { name, alias };\n372. \t\t});\n373. \t} else {\n374. \t\tlet inlineHelpers = \'\';\n375. \n376. \t\tusedHelpers.forEach(key => {\n377. \t\t\tconst str = shared[key];\n378. \t\t\tconst code = new MagicString(str);\n379. \t\t\tconst expression = parseExpressionAt(str, 0);\n380. \n381. \t\t\tlet scope = annotateWithScopes(expression);\n382. \n383. \t\t\twalk(expression, {\n384. \t\t\t\tenter(node: Node, parent: Node) {\n385. \t\t\t\t\tif (node._scope) scope = node._scope;\n386. \n387. \t\t\t\t\tif (\n388. \t\t\t\t\t\tnode.type === \'Identifier\' &&\n389. \t\t\t\t\t\tisReference(node, parent) &&\n390. \t\t\t\t\t\t!scope.has(node.name)\n391. \t\t\t\t\t) {\n392. \t\t\t\t\t\tif (node.name in shared) {\n393. \t\t\t\t\t\t\t// this helper function depends on another one\n394. \t\t\t\t\t\t\tconst dependency = node.name;\n395. \t\t\t\t\t\t\tusedHelpers.add(dependency);\n396. \n397. \t\t\t\t\t\t\tconst alias = generator.alias(dependency);\n398. \t\t\t\t\t\t\tif (alias !== node.name)\n399. \t\t\t\t\t\t\t\tcode.overwrite(node.start, node.end, alias);\n400. \t\t\t\t\t\t}\n401. \t\t\t\t\t}\n402. \t\t\t\t},\n403. \n404. \t\t\t\tleave(node: Node) {\n405. \t\t\t\t\tif (node._scope) scope = scope.parent;\n406. \t\t\t\t},\n407. \t\t\t});\n408. \n409. \t\t\tif (key === \'transitionManager\') {\n410. \t\t\t\t// special case\n411. \t\t\t\tconst global = `_svelteTransitionManager`;\n412. \n413. \t\t\t\tinlineHelpers += `\\n\\nvar ${generator.alias(\'transitionManager\')} = window.${global} || (window.${global} = ${code});\\n\\n`;\n414. \t\t\t} else {\n415. \t\t\t\tconst alias = generator.alias(expression.id.name);\n416. \t\t\t\tif (alias !== expression.id.name)\n417. \t\t\t\t\tcode.overwrite(expression.id.start, expression.id.end, alias);\n418. \n419. \t\t\t\tinlineHelpers += `\\n\\n${code}`;\n420. \t\t\t}\n421. \t\t});\n422. \n423. \t\tresult += inlineHelpers;\n424. \t}\n425. \n426. \tconst filename = options.filename && (\n427. \t\ttypeof process !== \'undefined\' ? options.filename.replace(process.cwd(), \'\').replace(/^[\\/\\\\]/, \'\') : options.filename\n428. \t);\n429. \n430. \treturn generator.generate(result, options, {\n431. \t\tbanner: `/* ${filename ? `${filename} ` : ``}generated by Svelte v${version} */`,\n432. \t\tsharedPath,\n433. \t\thelpers,\n434. \t\tname,\n435. \t\tformat,\n436. \t});\n437. }', start_line_number=1, end_line_number=437), Context(relative_path='src/generators/dom/visitors/Component.ts', content='1. import deindent from \'../../../utils/deindent\';\n2. import CodeBuilder from \'../../../utils/CodeBuilder\';\n3. import visit from \'../visit\';\n4. import { DomGenerator } from \'../index\';\n5. import Block from \'../Block\';\n6. import getTailSnippet from \'../../../utils/getTailSnippet\';\n7. import getObject from \'../../../utils/getObject\';\n8. import getExpressionPrecedence from \'../../../utils/getExpressionPrecedence\';\n9. import { stringify } from \'../../../utils/stringify\';\n10. import { Node } from \'../../../interfaces\';\n11. import { State } from \'../interfaces\';\n12. \n13. function stringifyProps(props: string[]) {\n14. \tif (!props.length) return \'{}\';\n15. \n16. \tconst joined = props.join(\', \');\n17. \tif (joined.length > 40) {\n18. \t\t// make larger data objects readable\n19. \t\treturn `{\\n\\t${props.join(\',\\n\\t\')}\\n}`;\n20. \t}\n21. \n22. \treturn `{ ${joined} }`;\n23. }\n24. \n25. interface Attribute {\n26. \tname: string;\n27. \tvalue: any;\n28. \tdynamic: boolean;\n29. \tdependencies?: string[]\n30. }\n31. \n32. interface Binding {\n33. \tname: string;\n34. \tvalue: Node;\n35. \tcontexts: Set<string>;\n36. \tsnippet: string;\n37. \tobj: string;\n38. \tprop: string;\n39. \tdependencies: string[];\n40. }\n41. \n42. export default function visitComponent(\n43. \tgenerator: DomGenerator,\n44. \tblock: Block,\n45. \tstate: State,\n46. \tnode: Node,\n47. \telementStack: Node[],\n48. \tcomponentStack: Node[]\n49. ) {\n50. \tgenerator.hasComponents = true;\n51. \n52. \tconst name = node.var;\n53. \n54. \tconst componentInitProperties = [`_root: #component._root`];\n55. \n56. \tif (node.children.length > 0) {\n57. \t\tconst slots = Array.from(node._slots).map(name => `${name}: @createFragment()`);\n58. \t\tcomponentInitProperties.push(`slots: { ${slots.join(\', \')} }`);\n59. \n60. \t\tnode.children.forEach((child: Node) => {\n61. \t\t\tvisit(generator, block, node._state, child, elementStack, componentStack.concat(node));\n62. \t\t});\n63. \t}\n64. \n65. \tconst allContexts = new Set();\n66. \tconst statements: string[] = [];\n67. \tconst name_context = block.getUniqueName(`${name}_context`);\n68. \n69. \tlet name_updating: string;\n70. \tlet name_initial_data: string;\n71. \tlet beforecreate: string = null;\n72. \n73. \tconst attributes = node.attributes\n74. \t\t.filter((a: Node) => a.type === \'Attribute\')\n75. \t\t.map((a: Node) => mungeAttribute(a, block));\n76. \n77. \tconst bindings = node.attributes\n78. \t\t.filter((a: Node) => a.type === \'Binding\')\n79. \t\t.map((a: Node) => mungeBinding(a, block));\n80. \n81. \tif (attributes.length || bindings.length) {\n82. \t\tconst initialProps = attributes\n83. \t\t\t.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);\n84. \n85. \t\tconst initialPropString = stringifyProps(initialProps);\n86. \n87. \t\tconst updates: string[] = [];\n88. \n89. \t\tattributes\n90. \t\t\t.filter((attribute: Attribute) => attribute.dynamic)\n91. \t\t\t.forEach((attribute: Attribute) => {\n92. \t\t\t\tif (attribute.dependencies.length) {\n93. \t\t\t\t\tupdates.push(deindent`\n94. \t\t\t\t\t\tif (${attribute.dependencies\n95. \t\t\t\t\t\t\t.map(dependency => `changed.${dependency}`)\n96. \t\t\t\t\t\t\t.join(\' || \')}) ${name}_changes.${attribute.name} = ${attribute.value};\n97. \t\t\t\t\t`);\n98. \t\t\t\t}\n99. \n100. \t\t\t\telse {\n101. \t\t\t\t\t// TODO this is an odd situation to encounter – I *think* it should only happen with\n102. \t\t\t\t\t// each block indices, in which case it may be possible to optimise this\n103. \t\t\t\t\tupdates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);\n104. \t\t\t\t}\n105. \t\t\t});\n106. \n107. \t\tif (bindings.length) {\n108. \t\t\tgenerator.hasComplexBindings = true;\n109. \n110. \t\t\tname_updating = block.alias(`${name}_updating`);\n111. \t\t\tname_initial_data = block.getUniqueName(`${name}_initial_data`);\n112. \n113. \t\t\tblock.addVariable(name_updating, \'{}\');\n114. \t\t\tstatements.push(`var ${name_initial_data} = ${initialPropString};`);\n115. \n116. \t\t\tconst setParentFromChildOnChange = new CodeBuilder();\n117. \t\t\tconst setParentFromChildOnInit = new CodeBuilder();\n118. \n119. \t\t\tbindings.forEach((binding: Binding) => {\n120. \t\t\t\tlet setParentFromChild;\n121. \n122. \t\t\t\tbinding.contexts.forEach(context => {\n123. \t\t\t\t\tallContexts.add(context);\n124. \t\t\t\t});\n125. \n126. \t\t\t\tconst { name: key } = getObject(binding.value);\n127. \n128. \t\t\t\tif (block.contexts.has(key)) {\n129. \t\t\t\t\tconst prop = binding.dependencies[0];\n130. \t\t\t\t\tconst computed = isComputed(binding.value);\n131. \t\t\t\t\tconst tail = binding.value.type === \'MemberExpression\' ? getTailSnippet(binding.value) : \'\';\n132. \n133. \t\t\t\t\tsetParentFromChild = deindent`\n134. \t\t\t\t\t\tvar list = ${name_context}.${block.listNames.get(key)};\n135. \t\t\t\t\t\tvar index = ${name_context}.${block.indexNames.get(key)};\n136. \t\t\t\t\t\tlist[index]${tail} = childState.${binding.name};\n137. \n138. \t\t\t\t\t\t${binding.dependencies\n139. \t\t\t\t\t\t\t.map((prop: string) => `newState.${prop} = state.${prop};`)\n140. \t\t\t\t\t\t\t.join(\'\\n\')}\n141. \t\t\t\t\t`;\n142. \t\t\t\t}\n143. \n144. \t\t\t\telse if (binding.value.type === \'MemberExpression\') {\n145. \t\t\t\t\tsetParentFromChild = deindent`\n146. \t\t\t\t\t\t${binding.snippet} = childState.${binding.name};\n147. \t\t\t\t\t\t${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join(\'\\n\')}\n148. \t\t\t\t\t`;\n149. \t\t\t\t}\n150. \n151. \t\t\t\telse {\n152. \t\t\t\t\tsetParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;\n153. \t\t\t\t}\n154. \n155. \t\t\t\tstatements.push(deindent`\n156. \t\t\t\t\tif (${binding.prop} in ${binding.obj}) {\n157. \t\t\t\t\t\t${name_initial_data}.${binding.name} = ${binding.snippet};\n158. \t\t\t\t\t\t${name_updating}.${binding.name} = true;\n159. \t\t\t\t\t}`\n160. \t\t\t\t);\n161. \n162. \t\t\t\tsetParentFromChildOnChange.addConditional(\n163. \t\t\t\t\t`!${name_updating}.${binding.name} && changed.${binding.name}`,\n164. \t\t\t\t\tsetParentFromChild\n165. \t\t\t\t);\n166. \n167. \t\t\t\tsetParentFromChildOnInit.addConditional(\n168. \t\t\t\t\t`!${name_updating}.${binding.name}`,\n169. \t\t\t\t\tsetParentFromChild\n170. \t\t\t\t);\n171. \n172. \t\t\t\t// TODO could binding.dependencies.length ever be 0?\n173. \t\t\t\tif (binding.dependencies.length) {\n174. \t\t\t\t\tupdates.push(deindent`\n175. \t\t\t\t\t\tif (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(\' || \')}) {\n176. \t\t\t\t\t\t\t${name}_changes.${binding.name} = ${binding.snippet};\n177. \t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n178. \t\t\t\t\t\t}\n179. \t\t\t\t\t`);\n180. \t\t\t\t}\n181. \t\t\t});\n182. \n183. \t\t\tcomponentInitProperties.push(`data: ${name_initial_data}`);\n184. \n185. \t\t\tcomponentInitProperties.push(deindent`\n186. \t\t\t\t_bind: function(changed, childState) {\n187. \t\t\t\t\tvar state = #component.get(), newState = {};\n188. \t\t\t\t\t${setParentFromChildOnChange}\n189. \t\t\t\t\t${name_updating} = @assign({}, changed);\n190. \t\t\t\t\t#component._set(newState);\n191. \t\t\t\t\t${name_updating} = {};\n192. \t\t\t\t}\n193. \t\t\t`);\n194. \n195. \t\t\tbeforecreate = deindent`\n196. \t\t\t\t#component._root._beforecreate.push(function () {\n197. \t\t\t\t\tvar state = #component.get(), childState = ${name}.get(), newState = {};\n198. \t\t\t\t\tif (!childState) return;\n199. \t\t\t\t\t${setParentFromChildOnInit}\n200. \t\t\t\t\t${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(\', \')} };\n201. \t\t\t\t\t#component._set(newState);\n202. \t\t\t\t\t${name_updating} = {};\n203. \t\t\t\t});\n204. \t\t\t`;\n205. \t\t} else if (initialProps.length) {\n206. \t\t\tcomponentInitProperties.push(`data: ${initialPropString}`);\n207. \t\t}\n208. \n209. \t\tif (updates.length) {\n210. \t\t\tblock.builders.update.addBlock(deindent`\n211. \t\t\t\tvar ${name}_changes = {};\n212. \t\t\t\t${updates.join(\'\\n\')}\n213. \t\t\t\t${name}._set( ${name}_changes );\n214. \t\t\t\t${bindings.length && `${name_updating} = {};`}\n215. \t\t\t`);\n216. \t\t}\n217. \t}\n218. \n219. \tconst expression = node.name === \':Self\' ? generator.name : `%components-${node.name}`;\n220. \n221. \tblock.builders.init.addBlock(deindent`\n222. \t\t${statements.join(\'\\n\')}\n223. \t\tvar ${name} = new ${expression}({\n224. \t\t\t${componentInitProperties.join(\',\\n\')}\n225. \t\t});\n226. \n227. \t\t${beforecreate}\n228. \t`);\n229. \n230. \tblock.builders.create.addLine(`${name}._fragment.c();`);\n231. \n232. \tblock.builders.claim.addLine(\n233. \t\t`${name}._fragment.l( ${state.parentNodes} );`\n234. \t);\n235. \n236. \tblock.builders.mount.addLine(\n237. \t\t`${name}._mount(${state.parentNode || \'#target\'}, ${state.parentNode ? \'null\' : \'anchor\'});`\n238. \t);\n239. \n240. \tif (!state.parentNode) block.builders.unmount.addLine(`${name}._unmount();`);\n241. \n242. \tblock.builders.destroy.addLine(`${name}.destroy(false);`);\n243. \n244. \t// event handlers\n245. \tnode.attributes.filter((a: Node) => a.type === \'EventHandler\').forEach((handler: Node) => {\n246. \t\tconst usedContexts: string[] = [];\n247. \n248. \t\tif (handler.expression) {\n249. \t\t\tgenerator.addSourcemapLocations(handler.expression);\n250. \t\t\tgenerator.code.prependRight(\n251. \t\t\t\thandler.expression.start,\n252. \t\t\t\t`${block.alias(\'component\')}.`\n253. \t\t\t);\n254. \n255. \t\t\thandler.expression.arguments.forEach((arg: Node) => {\n256. \t\t\t\tconst { contexts } = block.contextualise(arg, null, true);\n257. \n258. \t\t\t\tcontexts.forEach(context => {\n259. \t\t\t\t\tif (!~usedContexts.indexOf(context)) usedContexts.push(context);\n260. \t\t\t\t\tallContexts.add(context);\n261. \t\t\t\t});\n262. \t\t\t});\n263. \t\t}\n264. \n265. \t\t// TODO hoist event handlers? can do `this.__component.method(...)`\n266. \t\tconst declarations = usedContexts.map(name => {\n267. \t\t\tif (name === \'state\') return `var state = ${name_context}.state;`;\n268. \n269. \t\t\tconst listName = block.listNames.get(name);\n270. \t\t\tconst indexName = block.indexNames.get(name);\n271. \n272. \t\t\treturn `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;\n273. \t\t});\n274. \n275. \t\tconst handlerBody =\n276. \t\t\t(declarations.length ? declarations.join(\'\\n\') + \'\\n\\n\' : \'\') +\n277. \t\t\t(handler.expression ?\n278. \t\t\t\t`[✂${handler.expression.start}-${handler.expression.end}✂];` :\n279. \t\t\t\t`${block.alias(\'component\')}.fire(\'${handler.name}\', event);`);\n280. \n281. \t\tblock.builders.init.addBlock(deindent`\n282. \t\t\t${name}.on("${handler.name}", function(event) {\n283. \t\t\t\t${handlerBody}\n284. \t\t\t});\n285. \t\t`);\n286. \t});\n287. \n288. \t// refs\n289. \tnode.attributes.filter((a: Node) => a.type === \'Ref\').forEach((ref: Node) => {\n290. \t\tgenerator.usesRefs = true;\n291. \n292. \t\tblock.builders.init.addLine(`#component.refs.${ref.name} = ${name};`);\n293. \n294. \t\tblock.builders.destroy.addLine(deindent`\n295. \t\t\tif (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;\n296. \t\t`);\n297. \t});\n298. \n299. \t// maintain component context\n300. \tif (allContexts.size) {\n301. \t\tconst contexts = Array.from(allContexts);\n302. \n303. \t\tconst initialProps = contexts\n304. \t\t\t.map(contextName => {\n305. \t\t\t\tif (contextName === \'state\') return `state: state`;\n306. \n307. \t\t\t\tconst listName = block.listNames.get(contextName);\n308. \t\t\t\tconst indexName = block.indexNames.get(contextName);\n309. \n310. \t\t\t\treturn `${listName}: ${listName},\\n${indexName}: ${indexName}`;\n311. \t\t\t})\n312. \t\t\t.join(\',\\n\');\n313. \n314. \t\tconst updates = contexts\n315. \t\t\t.map(contextName => {\n316. \t\t\t\tif (contextName === \'state\') return `${name_context}.state = state;`;\n317. \n318. \t\t\t\tconst listName = block.listNames.get(contextName);\n319. \t\t\t\tconst indexName = block.indexNames.get(contextName);\n320. \n321. \t\t\t\treturn `${name_context}.${listName} = ${listName};\\n${name_context}.${indexName} = ${indexName};`;\n322. \t\t\t})\n323. \t\t\t.join(\'\\n\');\n324. \n325. \t\tblock.builders.init.addBlock(deindent`\n326. \t\t\tvar ${name_context} = {\n327. \t\t\t\t${initialProps}\n328. \t\t\t};\n329. \t\t`);\n330. \n331. \t\tblock.builders.update.addBlock(updates);\n332. \t}\n333. }\n334. \n335. function mungeAttribute(attribute: Node, block: Block): Attribute {\n336. \tif (attribute.value === true) {\n337. \t\t// attributes without values, e.g. <textarea readonly>\n338. \t\treturn {\n339. \t\t\tname: attribute.name,\n340. \t\t\tvalue: true,\n341. \t\t\tdynamic: false\n342. \t\t};\n343. \t}\n344. \n345. \tif (attribute.value.length === 0) {\n346. \t\treturn {\n347. \t\t\tname: attribute.name,\n348. \t\t\tvalue: `\'\'`,\n349. \t\t\tdynamic: false\n350. \t\t};\n351. \t}\n352. \n353. \tif (attribute.value.length === 1) {\n354. \t\tconst value = attribute.value[0];\n355. \n356. \t\tif (value.type === \'Text\') {\n357. \t\t\t// static attributes\n358. \t\t\treturn {\n359. \t\t\t\tname: attribute.name,\n360. \t\t\t\tvalue: isNaN(value.data) ? stringify(value.data) : value.data,\n361. \t\t\t\tdynamic: false\n362. \t\t\t};\n363. \t\t}\n364. \n365. \t\t// simple dynamic attributes\n366. \t\tconst { dependencies, snippet } = block.contextualise(value.expression);\n367. \n368. \t\t// TODO only update attributes that have changed\n369. \t\treturn {\n370. \t\t\tname: attribute.name,\n371. \t\t\tvalue: snippet,\n372. \t\t\tdependencies,\n373. \t\t\tdynamic: true\n374. \t\t};\n375. \t}\n376. \n377. \t// otherwise we\'re dealing with a complex dynamic attribute\n378. \tconst allDependencies = new Set();\n379. \n380. \tconst value =\n381. \t\t(attribute.value[0].type === \'Text\' ? \'\' : `"" + `) +\n382. \t\tattribute.value\n383. \t\t\t.map((chunk: Node) => {\n384. \t\t\t\tif (chunk.type === \'Text\') {\n385. \t\t\t\t\treturn stringify(chunk.data);\n386. \t\t\t\t} else {\n387. \t\t\t\t\tconst { dependencies, snippet } = block.contextualise(\n388. \t\t\t\t\t\tchunk.expression\n389. \t\t\t\t\t);\n390. \n391. \t\t\t\t\tdependencies.forEach(dependency => {\n392. \t\t\t\t\t\tallDependencies.add(dependency);\n393. \t\t\t\t\t});\n394. \n395. \t\t\t\t\treturn getExpressionPrecedence(chunk.expression) <= 13 ? `( ${snippet} )` : snippet;\n396. \t\t\t\t}\n397. \t\t\t})\n398. \t\t\t.join(\' + \');\n399. \n400. \treturn {\n401. \t\tname: attribute.name,\n402. \t\tvalue,\n403. \t\tdependencies: Array.from(allDependencies),\n404. \t\tdynamic: true\n405. \t};\n406. }\n407. \n408. function mungeBinding(binding: Node, block: Block): Binding {\n409. \tconst { name } = getObject(binding.value);\n410. \tconst { snippet, contexts, dependencies } = block.contextualise(\n411. \t\tbinding.value\n412. \t);\n413. \n414. \tconst contextual = block.contexts.has(name);\n415. \n416. \tlet obj;\n417. \tlet prop;\n418. \n419. \tif (contextual) {\n420. \t\tobj = block.listNames.get(name);\n421. \t\tprop = block.indexNames.get(name);\n422. \t} else if (binding.value.type === \'MemberExpression\') {\n423. \t\tprop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;\n424. \t\tif (!binding.value.computed) prop = `\'${prop}\'`;\n425. \t\tobj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;\n426. \t} else {\n427. \t\tobj = \'state\';\n428. \t\tprop = `\'${name}\'`;\n429. \t}\n430. \n431. \treturn {\n432. \t\tname: binding.name,\n433. \t\tvalue: binding.value,\n434. \t\tcontexts,\n435. \t\tsnippet,\n436. \t\tobj,\n437. \t\tprop,\n438. \t\tdependencies\n439. \t};\n440. }\n441. \n442. function isComputed(node: Node) {\n443. \twhile (node.type === \'MemberExpression\') {\n444. \t\tif (node.computed) return true;\n445. \t\tnode = node.object;\n446. \t}\n447. \n448. \treturn false;\n449. }', start_line_number=1, end_line_number=449), Context(relative_path='src/generators/server-side-rendering/visitors/Component.ts', content="1. import flattenReference from '../../../utils/flattenReference';\n2. import visit from '../visit';\n3. import { SsrGenerator } from '../index';\n4. import Block from '../Block';\n5. import { AppendTarget } from '../interfaces';\n6. import { Node } from '../../../interfaces';\n7. import getObject from '../../../utils/getObject';\n8. import getTailSnippet from '../../../utils/getTailSnippet';\n9. import { stringify } from '../../../utils/stringify';\n10. \n11. export default function visitComponent(\n12. \tgenerator: SsrGenerator,\n13. \tblock: Block,\n14. \tnode: Node\n15. ) {\n16. \tfunction stringifyAttribute(chunk: Node) {\n17. \t\tif (chunk.type === 'Text') return chunk.data;\n18. \t\tif (chunk.type === 'MustacheTag') {\n19. \t\t\tconst { snippet } = block.contextualise(chunk.expression);\n20. \t\t\treturn '${__escape( ' + snippet + ')}';\n21. \t\t}\n22. \t}\n23. \n24. \tconst attributes: Node[] = [];\n25. \tconst bindings: Node[] = [];\n26. \n27. \tnode.attributes.forEach((attribute: Node) => {\n28. \t\tif (attribute.type === 'Attribute') {\n29. \t\t\tattributes.push(attribute);\n30. \t\t} else if (attribute.type === 'Binding') {\n31. \t\t\tbindings.push(attribute);\n32. \t\t}\n33. \t});\n34. \n35. \tconst props = attributes\n36. \t\t.map(attribute => {\n37. \t\t\tlet value;\n38. \n39. \t\t\tif (attribute.value === true) {\n40. \t\t\t\tvalue = `true`;\n41. \t\t\t} else if (attribute.value.length === 0) {\n42. \t\t\t\tvalue = `''`;\n43. \t\t\t} else if (attribute.value.length === 1) {\n44. \t\t\t\tconst chunk = attribute.value[0];\n45. \t\t\t\tif (chunk.type === 'Text') {\n46. \t\t\t\t\tvalue = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;\n47. \t\t\t\t} else {\n48. \t\t\t\t\tconst { snippet } = block.contextualise(chunk.expression);\n49. \t\t\t\t\tvalue = snippet;\n50. \t\t\t\t}\n51. \t\t\t} else {\n52. \t\t\t\tvalue = '`' + attribute.value.map(stringifyAttribute).join('') + '`';\n53. \t\t\t}\n54. \n55. \t\t\treturn `${attribute.name}: ${value}`;\n56. \t\t})\n57. \t\t.concat(\n58. \t\t\tbindings.map(binding => {\n59. \t\t\t\tconst { name } = getObject(binding.value);\n60. \t\t\t\tconst tail = binding.value.type === 'MemberExpression'\n61. \t\t\t\t\t? getTailSnippet(binding.value)\n62. \t\t\t\t\t: '';\n63. \n64. \t\t\t\tconst keypath = block.contexts.has(name)\n65. \t\t\t\t\t? `${name}${tail}`\n66. \t\t\t\t\t: `state.${name}${tail}`;\n67. \t\t\t\treturn `${binding.name}: ${keypath}`;\n68. \t\t\t})\n69. \t\t)\n70. \t\t.join(', ');\n71. \n72. \tconst expression = node.name === ':Self' ? generator.name : `%components-${node.name}`;\n73. \n74. \tbindings.forEach(binding => {\n75. \t\tblock.addBinding(binding, expression);\n76. \t});\n77. \n78. \tlet open = `\\${${expression}.render({${props}}`;\n79. \n80. \tif (node.children.length) {\n81. \t\tconst appendTarget: AppendTarget = {\n82. \t\t\tslots: { default: '' },\n83. \t\t\tslotStack: ['default']\n84. \t\t};\n85. \n86. \t\tgenerator.appendTargets.push(appendTarget);\n87. \n88. \t\tnode.children.forEach((child: Node) => {\n89. \t\t\tvisit(generator, block, child);\n90. \t\t});\n91. \n92. \t\tconst slotted = Object.keys(appendTarget.slots)\n93. \t\t\t.map(name => `${name}: () => \\`${appendTarget.slots[name]}\\``)\n94. \t\t\t.join(', ');\n95. \n96. \t\topen += `, { slotted: { ${slotted} } }`;\n97. \n98. \t\tgenerator.appendTargets.pop();\n99. \t}\n100. \n101. \tgenerator.append(open);\n102. \tgenerator.append(')}');\n103. }", start_line_number=1, end_line_number=103), Context(relative_path='src/generators/shared/utils/wrapModule.ts', content='1. import deindent from \'../../../utils/deindent\';\n2. import { CompileOptions, ModuleFormat, Node } from \'../../../interfaces\';\n3. \n4. interface Dependency {\n5. \tname: string;\n6. \tstatements: string[];\n7. \tsource: string;\n8. }\n9. \n10. const wrappers = { es, amd, cjs, iife, umd, eval: expr };\n11. \n12. export default function wrapModule(\n13. \tcode: string,\n14. \tformat: ModuleFormat,\n15. \tname: string,\n16. \toptions: CompileOptions,\n17. \tbanner: string,\n18. \tsharedPath: string,\n19. \thelpers: { name: string, alias: string }[],\n20. \timports: Node[],\n21. \tsource: string\n22. ): string {\n23. \tif (format === \'es\') return es(code, name, options, banner, sharedPath, helpers, imports, source);\n24. \n25. \tconst dependencies = imports.map((declaration, i) => {\n26. \t\tconst defaultImport = declaration.specifiers.find(\n27. \t\t\t(x: Node) =>\n28. \t\t\t\tx.type === \'ImportDefaultSpecifier\' ||\n29. \t\t\t\t(x.type === \'ImportSpecifier\' && x.imported.name === \'default\')\n30. \t\t);\n31. \n32. \t\tconst namespaceImport = declaration.specifiers.find(\n33. \t\t\t(x: Node) => x.type === \'ImportNamespaceSpecifier\'\n34. \t\t);\n35. \n36. \t\tconst namedImports = declaration.specifiers.filter(\n37. \t\t\t(x: Node) =>\n38. \t\t\t\tx.type === \'ImportSpecifier\' && x.imported.name !== \'default\'\n39. \t\t);\n40. \n41. \t\tconst name = defaultImport || namespaceImport\n42. \t\t\t? (defaultImport || namespaceImport).local.name\n43. \t\t\t: `__import${i}`;\n44. \n45. \t\tconst statements: string[] = [];\n46. \n47. \t\tnamedImports.forEach((specifier: Node) => {\n48. \t\t\tstatements.push(\n49. \t\t\t\t`var ${specifier.local.name} = ${name}.${specifier.imported.name};`\n50. \t\t\t);\n51. \t\t});\n52. \n53. \t\tif (defaultImport) {\n54. \t\t\tstatements.push(\n55. \t\t\t\t`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`\n56. \t\t\t);\n57. \t\t}\n58. \n59. \t\treturn { name, statements, source: declaration.source.value };\n60. \t});\n61. \n62. \tif (format === \'amd\') return amd(code, name, options, banner, dependencies);\n63. \tif (format === \'cjs\') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);\n64. \tif (format === \'iife\') return iife(code, name, options, banner, dependencies);\n65. \tif (format === \'umd\') return umd(code, name, options, banner, dependencies);\n66. \tif (format === \'eval\') return expr(code, name, options, banner, dependencies);\n67. \n68. \tthrow new Error(`Not implemented: ${format}`);\n69. }\n70. \n71. function es(\n72. \tcode: string,\n73. \tname: string,\n74. \toptions: CompileOptions,\n75. \tbanner: string,\n76. \tsharedPath: string,\n77. \thelpers: { name: string, alias: string }[],\n78. \timports: Node[],\n79. \tsource: string\n80. ) {\n81. \tconst importHelpers = helpers && (\n82. \t\t`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(\', \')} } from ${JSON.stringify(sharedPath)};`\n83. \t);\n84. \n85. \tconst importBlock = imports.length > 0 && (\n86. \t\timports\n87. \t\t\t.map((declaration: Node) => source.slice(declaration.start, declaration.end))\n88. \t\t\t.join(\'\\n\')\n89. \t);\n90. \n91. \treturn deindent`\n92. \t\t${banner}\n93. \t\t${importHelpers}\n94. \t\t${importBlock}\n95. \n96. \t\t${code}\n97. \t\texport default ${name};`;\n98. }\n99. \n100. function amd(\n101. \tcode: string,\n102. \tname: string,\n103. \toptions: CompileOptions,\n104. \tbanner: string,\n105. \tdependencies: Dependency[]\n106. ) {\n107. \tconst sourceString = dependencies.length\n108. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n109. \t\t: \'\';\n110. \n111. \tconst id = options.amd && options.amd.id;\n112. \n113. \treturn deindent`\n114. \t\tdefine(${id ? `"${id}", ` : \'\'}${sourceString}function(${paramString(dependencies)}) { "use strict";\n115. \t\t\t${getCompatibilityStatements(dependencies)}\n116. \n117. \t\t\t${code}\n118. \t\t\treturn ${name};\n119. \t\t});`;\n120. }\n121. \n122. function cjs(\n123. \tcode: string,\n124. \tname: string,\n125. \toptions: CompileOptions,\n126. \tbanner: string,\n127. \tsharedPath: string,\n128. \thelpers: { name: string, alias: string }[],\n129. \tdependencies: Dependency[]\n130. ) {\n131. \tconst SHARED = \'__shared\';\n132. \tconst helperBlock = helpers && (\n133. \t\t`var ${SHARED} = require(${JSON.stringify(sharedPath)});\\n` +\n134. \t\thelpers.map(helper => {\n135. \t\t\treturn `var ${helper.alias} = ${SHARED}.${helper.name};`;\n136. \t\t}).join(\'\\n\')\n137. \t);\n138. \n139. \tconst requireBlock = dependencies.length > 0 && (\n140. \t\tdependencies\n141. \t\t\t.map(d => `var ${d.name} = require("${d.source}");`)\n142. \t\t\t.join(\'\\n\\n\')\n143. \t);\n144. \n145. \treturn deindent`\n146. \t\t${banner}\n147. \t\t"use strict";\n148. \n149. \t\t${helperBlock}\n150. \t\t${requireBlock}\n151. \t\t${getCompatibilityStatements(dependencies)}\n152. \n153. \t\t${code}\n154. \n155. \t\tmodule.exports = ${name};`\n156. }\n157. \n158. function iife(\n159. \tcode: string,\n160. \tname: string,\n161. \toptions: CompileOptions,\n162. \tbanner: string,\n163. \tdependencies: Dependency[]\n164. ) {\n165. \tif (!options.name) {\n166. \t\tthrow new Error(`Missing required \'name\' option for IIFE export`);\n167. \t}\n168. \n169. \tconst globals = getGlobals(dependencies, options);\n170. \n171. \treturn deindent`\n172. \t\t${banner}\n173. \t\tvar ${options.name} = (function(${paramString(dependencies)}) { "use strict";\n174. \t\t\t${getCompatibilityStatements(dependencies)}\n175. \n176. \t\t\t${code}\n177. \t\t\treturn ${name};\n178. \t\t}(${globals.join(\', \')}));`;\n179. }\n180. \n181. function umd(\n182. \tcode: string,\n183. \tname: string,\n184. \toptions: CompileOptions,\n185. \tbanner: string,\n186. \tdependencies: Dependency[]\n187. ) {\n188. \tif (!options.name) {\n189. \t\tthrow new Error(`Missing required \'name\' option for UMD export`);\n190. \t}\n191. \n192. \tconst amdId = options.amd && options.amd.id ? `\'${options.amd.id}\', ` : \'\';\n193. \n194. \tconst amdDeps = dependencies.length\n195. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n196. \t\t: \'\';\n197. \n198. \tconst cjsDeps = dependencies\n199. \t\t.map(d => `require("${d.source}")`)\n200. \t\t.join(\', \');\n201. \n202. \tconst globals = getGlobals(dependencies, options);\n203. \n204. \treturn deindent`\n205. \t\t${banner}\n206. \t\t(function(global, factory) {\n207. \t\t\ttypeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :\n208. \t\t\ttypeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :\n209. \t\t\t(global.${options.name} = factory(${globals}));\n210. \t\t}(this, (function (${paramString(dependencies)}) { "use strict";\n211. \n212. \t\t\t${getCompatibilityStatements(dependencies)}\n213. \n214. \t\t\t${code}\n215. \n216. \t\t\treturn ${name};\n217. \n218. \t\t})));`;\n219. }\n220. \n221. function expr(\n222. \tcode: string,\n223. \tname: string,\n224. \toptions: CompileOptions,\n225. \tbanner: string,\n226. \tdependencies: Dependency[]\n227. ) {\n228. \tconst globals = getGlobals(dependencies, options);\n229. \n230. \treturn deindent`\n231. \t\t(function (${paramString(dependencies)}) { "use strict";\n232. \t\t\t${banner}\n233. \n234. \t\t\t${getCompatibilityStatements(dependencies)}\n235. \n236. \t\t\t${code}\n237. \n238. \t\t\treturn ${name};\n239. \t\t}(${globals.join(\', \')}))`;\n240. }\n241. \n242. function paramString(dependencies: Dependency[]) {\n243. \treturn dependencies.map(dep => dep.name).join(\', \');\n244. }\n245. \n246. function removeExtension(file: string) {\n247. \tconst index = file.lastIndexOf(\'.\');\n248. \treturn ~index ? file.slice(0, index) : file;\n249. }\n250. \n251. function getCompatibilityStatements(dependencies: Dependency[]) {\n252. \tif (!dependencies.length) return null;\n253. \n254. \tconst statements: string[] = [];\n255. \n256. \tdependencies.forEach(dependency => {\n257. \t\tstatements.push(...dependency.statements);\n258. \t});\n259. \n260. \treturn statements.join(\'\\n\');\n261. }\n262. \n263. function getGlobals(dependencies: Dependency[], options: CompileOptions) {\n264. \tconst { globals, onerror, onwarn } = options;\n265. \tconst globalFn = getGlobalFn(globals);\n266. \n267. \treturn dependencies.map(d => {\n268. \t\tlet name = globalFn(d.source);\n269. \n270. \t\tif (!name) {\n271. \t\t\tif (d.name.startsWith(\'__import\')) {\n272. \t\t\t\tconst error = new Error(\n273. \t\t\t\t\t`Could not determine name for imported module \'${d.source}\' – use options.globals`\n274. \t\t\t\t);\n275. \t\t\t\tonerror(error);\n276. \t\t\t} else {\n277. \t\t\t\tconst warning = {\n278. \t\t\t\t\tmessage: `No name was supplied for imported module \'${d.source}\'. Guessing \'${d.name}\', but you should use options.globals`,\n279. \t\t\t\t};\n280. \n281. \t\t\t\tonwarn(warning);\n282. \t\t\t}\n283. \n284. \t\t\tname = d.name;\n285. \t\t}\n286. \n287. \t\treturn name;\n288. \t});\n289. }\n290. \n291. function getGlobalFn(globals: any): (id: string) => string {\n292. \tif (typeof globals === \'function\') return globals;\n293. \tif (typeof globals === \'object\') {\n294. \t\treturn id => globals[id];\n295. \t}\n296. \n297. \treturn () => undefined;\n298. }', start_line_number=1, end_line_number=298), Context(relative_path='src/utils/CodeBuilder.ts', content="1. import repeat from './repeat';\n2. \n3. enum ChunkType {\n4. \tLine,\n5. \tBlock\n6. }\n7. \n8. interface Condition {\n9. \tcondition: string;\n10. \tused: boolean;\n11. }\n12. \n13. export default class CodeBuilder {\n14. \tresult: string;\n15. \tfirst: ChunkType;\n16. \tlast: ChunkType;\n17. \tlastCondition: string;\n18. \tconditionStack: Condition[];\n19. \tindent: string;\n20. \n21. \tconstructor(str = '') {\n22. \t\tthis.result = str;\n23. \n24. \t\tconst initial = str\n25. \t\t\t? /\\n/.test(str) ? ChunkType.Block : ChunkType.Line\n26. \t\t\t: null;\n27. \t\tthis.first = initial;\n28. \t\tthis.last = initial;\n29. \n30. \t\tthis.lastCondition = null;\n31. \t\tthis.conditionStack = [];\n32. \t\tthis.indent = '';\n33. \t}\n34. \n35. \taddConditional(condition: string, body: string) {\n36. \t\tthis.reifyConditions();\n37. \n38. \t\tbody = body.replace(/^/gm, `${this.indent}\\t`);\n39. \n40. \t\tif (condition === this.lastCondition) {\n41. \t\t\tthis.result += `\\n${body}`;\n42. \t\t} else {\n43. \t\t\tif (this.lastCondition) {\n44. \t\t\t\tthis.result += `\\n${this.indent}}`;\n45. \t\t\t}\n46. \n47. \t\t\tthis.result += `${this.last === ChunkType.Block ? '\\n\\n' : '\\n'}${this.indent}if (${condition}) {\\n${body}`;\n48. \t\t\tthis.lastCondition = condition;\n49. \t\t}\n50. \n51. \t\tthis.last = ChunkType.Block;\n52. \t}\n53. \n54. \taddLine(line: string) {\n55. \t\tthis.reifyConditions();\n56. \n57. \t\tif (this.lastCondition) {\n58. \t\t\tthis.result += `\\n${this.indent}}`;\n59. \t\t\tthis.lastCondition = null;\n60. \t\t}\n61. \n62. \t\tif (this.last === ChunkType.Block) {\n63. \t\t\tthis.result += `\\n\\n${this.indent}${line}`;\n64. \t\t} else if (this.last === ChunkType.Line) {\n65. \t\t\tthis.result += `\\n${this.indent}${line}`;\n66. \t\t} else {\n67. \t\t\tthis.result += line;\n68. \t\t}\n69. \n70. \t\tthis.last = ChunkType.Line;\n71. \t\tif (!this.first) this.first = ChunkType.Line;\n72. \t}\n73. \n74. \taddLineAtStart(line: string) {\n75. \t\tthis.reifyConditions();\n76. \n77. \t\tif (this.first === ChunkType.Block) {\n78. \t\t\tthis.result = `${line}\\n\\n${this.indent}${this.result}`;\n79. \t\t} else if (this.first === ChunkType.Line) {\n80. \t\t\tthis.result = `${line}\\n${this.indent}${this.result}`;\n81. \t\t} else {\n82. \t\t\tthis.result += line;\n83. \t\t}\n84. \n85. \t\tthis.first = ChunkType.Line;\n86. \t\tif (!this.last) this.last = ChunkType.Line;\n87. \t}\n88. \n89. \taddBlock(block: string) {\n90. \t\tthis.reifyConditions();\n91. \n92. \t\tif (this.indent) block = block.replace(/^/gm, `${this.indent}`);\n93. \n94. \t\tif (this.lastCondition) {\n95. \t\t\tthis.result += `\\n${this.indent}}`;\n96. \t\t\tthis.lastCondition = null;\n97. \t\t}\n98. \n99. \t\tif (this.result) {\n100. \t\t\tthis.result += `\\n\\n${this.indent}${block}`;\n101. \t\t} else {\n102. \t\t\tthis.result += block;\n103. \t\t}\n104. \n105. \t\tthis.last = ChunkType.Block;\n106. \t\tif (!this.first) this.first = ChunkType.Block;\n107. \t}\n108. \n109. \taddBlockAtStart(block: string) {\n110. \t\tthis.reifyConditions();\n111. \n112. \t\tif (this.result) {\n113. \t\t\tthis.result = `${block}\\n\\n${this.indent}${this.result}`;\n114. \t\t} else {\n115. \t\t\tthis.result += block;\n116. \t\t}\n117. \n118. \t\tthis.first = ChunkType.Block;\n119. \t\tif (!this.last) this.last = ChunkType.Block;\n120. \t}\n121. \n122. \tisEmpty() {\n123. \t\treturn this.result === '';\n124. \t}\n125. \n126. \tpushCondition(condition: string) {\n127. \t\tthis.conditionStack.push({ condition, used: false });\n128. \t}\n129. \n130. \tpopCondition() {\n131. \t\tconst { used } = this.conditionStack.pop();\n132. \n133. \t\tthis.indent = repeat('\\t', this.conditionStack.length);\n134. \t\tif (used) this.addLine('}');\n135. \t}\n136. \n137. \treifyConditions() {\n138. \t\tfor (let i = 0; i < this.conditionStack.length; i += 1) {\n139. \t\t\tconst condition = this.conditionStack[i];\n140. \t\t\tif (!condition.used) {\n141. \t\t\t\tconst line = `if (${condition.condition}) {`;\n142. \n143. \t\t\t\tif (this.last === ChunkType.Block) {\n144. \t\t\t\t\tthis.result += `\\n\\n${this.indent}${line}`;\n145. \t\t\t\t} else if (this.last === ChunkType.Line) {\n146. \t\t\t\t\tthis.result += `\\n${this.indent}${line}`;\n147. \t\t\t\t} else {\n148. \t\t\t\t\tthis.result += line;\n149. \t\t\t\t}\n150. \n151. \t\t\t\tthis.last = ChunkType.Line;\n152. \t\t\t\tif (!this.first) this.first = ChunkType.Line;\n153. \n154. \t\t\t\tthis.indent = repeat('\\t', this.conditionStack.length);\n155. \t\t\t\tcondition.used = true;\n156. \t\t\t}\n157. \t\t}\n158. \t}\n159. \n160. \ttoString() {\n161. \t\treturn this.result.trim() + (this.lastCondition ? `\\n}` : ``);\n162. \t}\n163. }", start_line_number=1, end_line_number=163), Context(relative_path='src/validate/js/propValidators/oncreate.ts', content="1. import usesThisOrArguments from '../utils/usesThisOrArguments';\n2. import { Validator } from '../../';\n3. import { Node } from '../../../interfaces';\n4. \n5. export default function oncreate(validator: Validator, prop: Node) {\n6. \tif (prop.value.type === 'ArrowFunctionExpression') {\n7. \t\tif (usesThisOrArguments(prop.value.body)) {\n8. \t\t\tvalidator.error(\n9. \t\t\t\t`'oncreate' should be a function expression, not an arrow function expression`,\n10. \t\t\t\tprop.start\n11. \t\t\t);\n12. \t\t}\n13. \t}\n14. }", start_line_number=1, end_line_number=14), Context(relative_path='src/validate/js/propValidators/ondestroy.ts', content="1. import usesThisOrArguments from '../utils/usesThisOrArguments';\n2. import { Validator } from '../../';\n3. import { Node } from '../../../interfaces';\n4. \n5. export default function ondestroy(validator: Validator, prop: Node) {\n6. \tif (prop.value.type === 'ArrowFunctionExpression') {\n7. \t\tif (usesThisOrArguments(prop.value.body)) {\n8. \t\t\tvalidator.error(\n9. \t\t\t\t`'ondestroy' should be a function expression, not an arrow function expression`,\n10. \t\t\t\tprop.start\n11. \t\t\t);\n12. \t\t}\n13. \t}\n14. }", start_line_number=1, end_line_number=14), Context(relative_path='src/validate/js/propValidators/onrender.ts', content="1. import oncreate from './oncreate';\n2. import { Validator } from '../../';\n3. import { Node } from '../../../interfaces';\n4. \n5. export default function onrender(validator: Validator, prop: Node) {\n6. \tvalidator.warn(\n7. \t\t`'onrender' has been deprecated in favour of 'oncreate', and will cause an error in Svelte 2.x`,\n8. \t\tprop.start\n9. \t);\n10. \toncreate(validator, prop);\n11. }", start_line_number=1, end_line_number=11), Context(relative_path='src/validate/js/propValidators/onteardown.ts', content="1. import ondestroy from './ondestroy';\n2. import { Validator } from '../../';\n3. import { Node } from '../../../interfaces';\n4. \n5. export default function onteardown(validator: Validator, prop: Node) {\n6. \tvalidator.warn(\n7. \t\t`'onteardown' has been deprecated in favour of 'ondestroy', and will cause an error in Svelte 2.x`,\n8. \t\tprop.start\n9. \t);\n10. \tondestroy(validator, prop);\n11. }", start_line_number=1, end_line_number=11), Context(relative_path='test/js/samples/onrender-onteardown-rewritten/expected-bundle.js', content="1. function noop() {}\n2. \n3. function assign(target) {\n4. \tvar k,\n5. \t\tsource,\n6. \t\ti = 1,\n7. \t\tlen = arguments.length;\n8. \tfor (; i < len; i++) {\n9. \t\tsource = arguments[i];\n10. \t\tfor (k in source) target[k] = source[k];\n11. \t}\n12. \n13. \treturn target;\n14. }\n15. \n16. function blankObject() {\n17. \treturn Object.create(null);\n18. }\n19. \n20. function destroy(detach) {\n21. \tthis.destroy = noop;\n22. \tthis.fire('destroy');\n23. \tthis.set = this.get = noop;\n24. \n25. \tif (detach !== false) this._fragment.u();\n26. \tthis._fragment.d();\n27. \tthis._fragment = this._state = null;\n28. }\n29. \n30. function differs(a, b) {\n31. \treturn a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n32. }\n33. \n34. function dispatchObservers(component, group, changed, newState, oldState) {\n35. \tfor (var key in group) {\n36. \t\tif (!changed[key]) continue;\n37. \n38. \t\tvar newValue = newState[key];\n39. \t\tvar oldValue = oldState[key];\n40. \n41. \t\tvar callbacks = group[key];\n42. \t\tif (!callbacks) continue;\n43. \n44. \t\tfor (var i = 0; i < callbacks.length; i += 1) {\n45. \t\t\tvar callback = callbacks[i];\n46. \t\t\tif (callback.__calling) continue;\n47. \n48. \t\t\tcallback.__calling = true;\n49. \t\t\tcallback.call(component, newValue, oldValue);\n50. \t\t\tcallback.__calling = false;\n51. \t\t}\n52. \t}\n53. }\n54. \n55. function fire(eventName, data) {\n56. \tvar handlers =\n57. \t\teventName in this._handlers && this._handlers[eventName].slice();\n58. \tif (!handlers) return;\n59. \n60. \tfor (var i = 0; i < handlers.length; i += 1) {\n61. \t\thandlers[i].call(this, data);\n62. \t}\n63. }\n64. \n65. function get(key) {\n66. \treturn key ? this._state[key] : this._state;\n67. }\n68. \n69. function init(component, options) {\n70. \tcomponent.options = options;\n71. \n72. \tcomponent._observers = { pre: blankObject(), post: blankObject() };\n73. \tcomponent._handlers = blankObject();\n74. \tcomponent._root = options._root || component;\n75. \tcomponent._yield = options._yield;\n76. \tcomponent._bind = options._bind;\n77. }\n78. \n79. function observe(key, callback, options) {\n80. \tvar group = options && options.defer\n81. \t\t? this._observers.post\n82. \t\t: this._observers.pre;\n83. \n84. \t(group[key] || (group[key] = [])).push(callback);\n85. \n86. \tif (!options || options.init !== false) {\n87. \t\tcallback.__calling = true;\n88. \t\tcallback.call(this, this._state[key]);\n89. \t\tcallback.__calling = false;\n90. \t}\n91. \n92. \treturn {\n93. \t\tcancel: function() {\n94. \t\t\tvar index = group[key].indexOf(callback);\n95. \t\t\tif (~index) group[key].splice(index, 1);\n96. \t\t}\n97. \t};\n98. }\n99. \n100. function on(eventName, handler) {\n101. \tif (eventName === 'teardown') return this.on('destroy', handler);\n102. \n103. \tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n104. \thandlers.push(handler);\n105. \n106. \treturn {\n107. \t\tcancel: function() {\n108. \t\t\tvar index = handlers.indexOf(handler);\n109. \t\t\tif (~index) handlers.splice(index, 1);\n110. \t\t}\n111. \t};\n112. }\n113. \n114. function set(newState) {\n115. \tthis._set(assign({}, newState));\n116. \tif (this._root._lock) return;\n117. \tthis._root._lock = true;\n118. \tcallAll(this._root._beforecreate);\n119. \tcallAll(this._root._oncreate);\n120. \tcallAll(this._root._aftercreate);\n121. \tthis._root._lock = false;\n122. }\n123. \n124. function _set(newState) {\n125. \tvar oldState = this._state,\n126. \t\tchanged = {},\n127. \t\tdirty = false;\n128. \n129. \tfor (var key in newState) {\n130. \t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n131. \t}\n132. \tif (!dirty) return;\n133. \n134. \tthis._state = assign({}, oldState, newState);\n135. \tthis._recompute(changed, this._state);\n136. \tif (this._bind) this._bind(changed, this._state);\n137. \tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n138. \tthis._fragment.p(changed, this._state);\n139. \tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n140. }\n141. \n142. function callAll(fns) {\n143. \twhile (fns && fns.length) fns.pop()();\n144. }\n145. \n146. function _mount(target, anchor) {\n147. \tthis._fragment.m(target, anchor);\n148. }\n149. \n150. function _unmount() {\n151. \tthis._fragment.u();\n152. }\n153. \n154. var proto = {\n155. \tdestroy: destroy,\n156. \tget: get,\n157. \tfire: fire,\n158. \tobserve: observe,\n159. \ton: on,\n160. \tset: set,\n161. \tteardown: destroy,\n162. \t_recompute: noop,\n163. \t_set: _set,\n164. \t_mount: _mount,\n165. \t_unmount: _unmount\n166. };\n167. \n168. /* generated by Svelte vX.Y.Z */\n169. function oncreate() {}\n170. \n171. function ondestroy() {}\n172. \n173. function create_main_fragment(state, component) {\n174. \n175. \treturn {\n176. \t\tc: noop,\n177. \n178. \t\tm: noop,\n179. \n180. \t\tp: noop,\n181. \n182. \t\tu: noop,\n183. \n184. \t\td: noop\n185. \t};\n186. }\n187. \n188. function SvelteComponent(options) {\n189. \tinit(this, options);\n190. \tthis._state = assign({}, options.data);\n191. \n192. \tthis._handlers.destroy = [ondestroy];\n193. \n194. \tvar _oncreate = oncreate.bind(this);\n195. \n196. \tif (!options._root) {\n197. \t\tthis._oncreate = [_oncreate];\n198. \t} else {\n199. \t \tthis._root._oncreate.push(_oncreate);\n200. \t }\n201. \n202. \tthis._fragment = create_main_fragment(this._state, this);\n203. \n204. \tif (options.target) {\n205. \t\tthis._fragment.c();\n206. \t\tthis._fragment.m(options.target, options.anchor || null);\n207. \n208. \t\tcallAll(this._oncreate);\n209. \t}\n210. }\n211. \n212. assign(SvelteComponent.prototype, proto);\n213. \n214. export default SvelteComponent;", start_line_number=1, end_line_number=214), Context(relative_path='test/js/samples/onrender-onteardown-rewritten/expected.js', content='1. /* generated by Svelte vX.Y.Z */\n2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";\n3. \n4. function oncreate() {};\n5. \n6. function ondestroy() {};\n7. \n8. function create_main_fragment(state, component) {\n9. \n10. \treturn {\n11. \t\tc: noop,\n12. \n13. \t\tm: noop,\n14. \n15. \t\tp: noop,\n16. \n17. \t\tu: noop,\n18. \n19. \t\td: noop\n20. \t};\n21. }\n22. \n23. function SvelteComponent(options) {\n24. \tinit(this, options);\n25. \tthis._state = assign({}, options.data);\n26. \n27. \tthis._handlers.destroy = [ondestroy]\n28. \n29. \tvar _oncreate = oncreate.bind(this);\n30. \n31. \tif (!options._root) {\n32. \t\tthis._oncreate = [_oncreate];\n33. \t} else {\n34. \t \tthis._root._oncreate.push(_oncreate);\n35. \t }\n36. \n37. \tthis._fragment = create_main_fragment(this._state, this);\n38. \n39. \tif (options.target) {\n40. \t\tthis._fragment.c();\n41. \t\tthis._fragment.m(options.target, options.anchor || null);\n42. \n43. \t\tcallAll(this._oncreate);\n44. \t}\n45. }\n46. \n47. assign(SvelteComponent.prototype, proto);\n48. export default SvelteComponent;', start_line_number=1, end_line_number=48), Context(relative_path='test/js/samples/onrender-onteardown-rewritten/input.html', content='1. <script>\n2. \texport default {\n3. \t\t// this test should be removed in v2\n4. \t\tonrender () {},\n5. \t\tonteardown () {}\n6. \t};\n7. </script>', start_line_number=1, end_line_number=7)]
2025-11-11 00:22:00,505 - thread-133013323122368.prometheus.lang_graph.nodes.issue_classifier_node - INFO - IssueClassifierNode classified the issue as: bug
2025-11-11 00:22:00,506 - thread-133013323122368.prometheus.lang_graph.nodes.issue_classification_subgraph_node - INFO - issue_type: bug
2025-11-11 00:22:00,507 - thread-133013323122368.prometheus.docker.base_container - INFO - Pulling docker image: ghcr.io/timesler/swe-polybench.eval.x86_64.sveltejs__svelte-907:latest
2025-11-11 00:22:34,123 - thread-133013323122368.prometheus.docker.base_container - INFO - Tagging pulled image as: prometheus_user_defined_container_8dbbd5ffd7
2025-11-11 00:22:34,131 - thread-133013323122368.prometheus.docker.base_container - INFO - Starting container from image prometheus_user_defined_container_8dbbd5ffd7
2025-11-11 00:22:34,975 - thread-133013323122368.prometheus.docker.base_container - INFO - Starting persistent shell for interactive mode...
2025-11-11 00:22:35,449 - thread-133013323122368.prometheus.docker.base_container - INFO - Persistent shell is ready
2025-11-11 00:22:35,450 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - Enter IssueBugSubgraphNode
2025-11-11 00:22:35,453 - thread-133013323122368.prometheus.lang_graph.nodes.bug_get_regression_tests_subgraph_node - INFO - Enter bug_get_regression_tests_subgraph_node
2025-11-11 00:22:35,455 - thread-133013323122368.prometheus.lang_graph.nodes.bug_get_regression_context_message_node - DEBUG - Sending query to context provider subgraph:
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

2025-11-11 00:22:35,456 - thread-133013323122368.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-11 00:22:35,458 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:22:52,979 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The request requires citing 8 existing tests with exact file paths and line numbers, including imports and assertions. The current context provides only the file tree, not the file contents of the test suites. Without the actual contents of test/js/index.js, test/runtime/index.js, and shared test setup files, it’s impossible to extract specific test cases and their line numbers or include the precise imports and assertions.' query='Please provide the full contents of test/js/index.js, test/runtime/index.js, test/helpers.js, test/setup.js, and test/test.js.' extra_requirements='If sending full files is too large, include at minimum the test case definitions for lifecycle hooks (oncreate/onrender/ondestroy) and how samples are loaded, with exact line numbers.' purpose='I need these files to extract 8 relevant test cases with precise imports, setup, assertions, and line numbers.'
2025-11-11 00:22:52,980 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents of test/js/index.js, test/runtime/index.js, test/helpers.js, test/setup.js, and test/test.js.
2025-11-11 00:22:53,526 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-11 00:22:53,526 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-11 00:22:53,526 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-11 00:22:53,526 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-11 00:22:53,527 - thread-133013323122368.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-11 00:22:53,528 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-11 00:22:53,528 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents of test/js/index.js, test/runtime/index.js, test/helpers.js, test/setup.js, and test/test.js.
Extra requirements: If sending full files is too large, include at minimum the test case definitions for lifecycle hooks (oncreate/onrender/ondestroy) and how samples are loaded, with exact line numbers.
Purpose: I need these files to extract 8 relevant test cases with precise imports, setup, assertions, and line numbers.
2025-11-11 00:22:59,639 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_YSnKFv0ugMJjH9QNGUwvHLgm', 'function': {'arguments': '{"relative_path":"test/js/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 417, 'prompt_tokens': 2197, 'total_tokens': 2614, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f3e84c67-ff8b-4e8c-9d4a-8c9d8003daaf-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/index.js'}, 'id': 'call_YSnKFv0ugMJjH9QNGUwvHLgm', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2197, 'output_tokens': 417, 'total_tokens': 2614, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-11 00:23:02,222 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_I1vTmeqdtdVErdhetVERIIpQ', 'function': {'arguments': '{"relative_path":"test/runtime/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 225, 'prompt_tokens': 3355, 'total_tokens': 3580, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b8f320f3-d8d1-49f5-a84e-fcf99fb6170e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/index.js'}, 'id': 'call_I1vTmeqdtdVErdhetVERIIpQ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3355, 'output_tokens': 225, 'total_tokens': 3580, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-11 00:23:03,232 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_50P6mJwMTICQNMBmwyE6sAjv', 'function': {'arguments': '{"relative_path":"test/helpers.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 6480, 'total_tokens': 6506, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3eb32462-239a-4b06-bd12-39e1ef203989-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/helpers.js'}, 'id': 'call_50P6mJwMTICQNMBmwyE6sAjv', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6480, 'output_tokens': 26, 'total_tokens': 6506, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:23:04,448 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_McxcD6XIbqEGZ9gU6jVriMqS', 'function': {'arguments': '{"relative_path":"test/setup.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 9234, 'total_tokens': 9260, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3328}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7fe15c6d-b60e-415e-a86b-fcf79f1a6a08-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/setup.js'}, 'id': 'call_McxcD6XIbqEGZ9gU6jVriMqS', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9234, 'output_tokens': 26, 'total_tokens': 9260, 'input_token_details': {'audio': 0, 'cache_read': 3328}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:23:06,173 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JahUzCHpDMJEqIovJXFA5XG4', 'function': {'arguments': '{"relative_path":"test/test.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 9845, 'total_tokens': 9871, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2c12fa56-eafd-4fcc-91ea-17f172439ca1-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/test.js'}, 'id': 'call_JahUzCHpDMJEqIovJXFA5XG4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9845, 'output_tokens': 26, 'total_tokens': 9871, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:23:18,787 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I fetched and displayed the full contents of the five requested files with line numbers: test/js/index.js, test/runtime/index.js, test/helpers.js, test/setup.js, and test/test.js. The JS tests load samples from test/js/samples (lines 8–21) and compare generated code/bundles, while the runtime tests compile .html components via require.extensions (lines 29–38), iterate over test/runtime/samples with shared/hydrate variants (lines 201–205), and run per-sample config.test/assertions (lines 169–185). The helpers and setup establish the JSDOM environment, HTML normalization/equality, sample compilation output, and ES module-to-CommonJS translation used by the tests. This gives you the precise imports, setup, assertions, and line numbers needed to extract lifecycle hook-related tests from the samples.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1337, 'prompt_tokens': 10049, 'total_tokens': 11386, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1152, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--b50279d3-f50c-45d8-b359-2cbbdf0a216c-0' usage_metadata={'input_tokens': 10049, 'output_tokens': 1337, 'total_tokens': 11386, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1152}}
2025-11-11 00:23:18,791 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents of test/js/index.js, test/runtime/index.js, test/helpers.js, test/setup.js, and test/test.js.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending full files is too large, include at minimum the test case definitions for lifecycle hooks (oncreate/onrender/ondestroy) and how samples are loaded, with exact line numbers.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
I need these files to extract 8 relevant test cases with precise imports, setup, assertions, and line numbers.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: test/helpers.js
Line number range: 1 - 239
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	if (test) global.__svelte_test = true;
12. 
13. 	const resolved = process.env.COVERAGE
14. 		? require.resolve('../src/index.js')
15. 		: require.resolve('../compiler/svelte.js');
16. 
17. 	delete require.cache[resolved];
18. 	return require(resolved);
19. }
20. 
21. export const svelte = loadSvelte();
22. 
23. export function exists(path) {
24. 	try {
25. 		fs.statSync(path);
26. 		return true;
27. 	} catch (err) {
28. 		return false;
29. 	}
30. }
31. 
32. export function tryToLoadJson(file) {
33. 	try {
34. 		return JSON.parse(fs.readFileSync(file));
35. 	} catch (err) {
36. 		if (err.code !== 'ENOENT') throw err;
37. 		return null;
38. 	}
39. }
40. 
41. export function tryToReadFile(file) {
42. 	try {
43. 		return fs.readFileSync(file, 'utf-8');
44. 	} catch (err) {
45. 		if (err.code !== 'ENOENT') throw err;
46. 		return null;
47. 	}
48. }
49. 
50. const { window } = new JSDOM('<main></main>');
51. global.document = window.document;
52. 
53. export function env() {
54. 	window._svelteTransitionManager = null;
55. 	window.document.body.innerHTML = '<main></main>';
56. 
57. 	return window;
58. }
59. 
60. function cleanChildren(node) {
61. 	let previous = null;
62. 
63. 	// sort attributes
64. 	const attributes = Array.from(node.attributes).sort((a, b) => {
65. 		return a.name < b.name ? -1 : 1;
66. 	});
67. 
68. 	attributes.forEach(attr => {
69. 		node.removeAttribute(attr.name);
70. 	});
71. 
72. 	attributes.forEach(attr => {
73. 		node.setAttribute(attr.name, attr.value);
74. 	});
75. 
76. 	// recurse
77. 	[...node.childNodes].forEach(child => {
78. 		if (child.nodeType === 3) {
79. 			// text
80. 			if (
81. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
82. 				node.tagName !== 'text' &&
83. 				node.tagName !== 'tspan'
84. 			) {
85. 				node.removeChild(child);
86. 			}
87. 
88. 			child.data = child.data.replace(/\s{2,}/g, '\n');
89. 
90. 			if (previous && previous.nodeType === 3) {
91. 				previous.data += child.data;
92. 				previous.data = previous.data.replace(/\s{2,}/g, '\n');
93. 
94. 				node.removeChild(child);
95. 				child = previous;
96. 			}
97. 		} else {
98. 			cleanChildren(child);
99. 		}
100. 
101. 		previous = child;
102. 	});
103. 
104. 	// collapse whitespace
105. 	if (node.firstChild && node.firstChild.nodeType === 3) {
106. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
107. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
108. 	}
109. 
110. 	if (node.lastChild && node.lastChild.nodeType === 3) {
111. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
112. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
113. 	}
114. }
115. 
116. export function normalizeHtml(window, html) {
117. 	try {
118. 		const node = window.document.createElement('div');
119. 		node.innerHTML = html
120. 			.replace(/<!--.*?-->/g, '')
121. 			.replace(/>[\s\r\n]+</g, '><')
122. 			.trim();
123. 		cleanChildren(node, '');
124. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
125. 	} catch (err) {
126. 		throw new Error(`Failed to normalize HTML:\n${html}`);
127. 	}
128. }
129. 
130. export function setupHtmlEqual() {
131. 	const window = env();
132. 
133. 	assert.htmlEqual = (actual, expected, message) => {
134. 		assert.deepEqual(
135. 			normalizeHtml(window, actual),
136. 			normalizeHtml(window, expected),
137. 			message
138. 		);
139. 	};
140. }
141. 
142. export function loadConfig(file) {
143. 	try {
144. 		const resolved = require.resolve(file);
145. 		delete require.cache[resolved];
146. 
147. 		const config = require(resolved);
148. 		return config.default || config;
149. 	} catch (err) {
150. 		if (err.code === 'MODULE_NOT_FOUND') {
151. 			return {};
152. 		}
153. 
154. 		throw err;
155. 	}
156. }
157. 
158. export function addLineNumbers(code) {
159. 	return code
160. 		.split('\n')
161. 		.map((line, i) => {
162. 			i = String(i + 1);
163. 			while (i.length < 3) i = ` ${i}`;
164. 
165. 			return (
166. 				chalk.grey(`  ${i}: `) +
167. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
168. 			);
169. 		})
170. 		.join('\n');
171. }
172. 
173. function capitalise(str) {
174. 	return str[0].toUpperCase() + str.slice(1);
175. }
176. 
177. export function showOutput(cwd, options = {}, s = svelte) {
178. 	glob.sync('**/*.html', { cwd }).forEach(file => {
179. 		if (file[0] === '_') return;
180. 		const { code } = s.compile(
181. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
182. 			Object.assign(options, {
183. 				filename: file,
184. 				name: capitalise(path.basename(file).replace(/\.html$/, ''))
185. 			})
186. 		);
187. 
188. 		console.log( // eslint-disable-line no-console
189. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
190. 		);
191. 	});
192. }
193. 
194. const start = /\n(\t+)/;
195. export function deindent(strings, ...values) {
196. 	const indentation = start.exec(strings[0])[1];
197. 	const pattern = new RegExp(`^${indentation}`, 'gm');
198. 
199. 	let result = strings[0].replace(start, '').replace(pattern, '');
200. 
201. 	let trailingIndentation = getTrailingIndentation(result);
202. 
203. 	for (let i = 1; i < strings.length; i += 1) {
204. 		let expression = values[i - 1];
205. 		const string = strings[i].replace(pattern, '');
206. 
207. 		if (Array.isArray(expression)) {
208. 			expression = expression.length ? expression.join('\n') : null;
209. 		}
210. 
211. 		if (expression || expression === '') {
212. 			const value = String(expression).replace(
213. 				/\n/g,
214. 				`\n${trailingIndentation}`
215. 			);
216. 			result += value + string;
217. 		} else {
218. 			let c = result.length;
219. 			while (/\s/.test(result[c - 1])) c -= 1;
220. 			result = result.slice(0, c) + string;
221. 		}
222. 
223. 		trailingIndentation = getTrailingIndentation(result);
224. 	}
225. 
226. 	return result.trim().replace(/\t+$/gm, '');
227. }
228. 
229. function getTrailingIndentation(str) {
230. 	let i = str.length;
231. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
232. 	return str.slice(i, str.length);
233. }
234. 
235. export function spaces(i) {
236. 	let result = '';
237. 	while (i--) result += ' ';
238. 	return result;
239. }


File: test/js/index.js
Line number range: 1 - 79
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import { rollup } from "rollup";
5. import { loadConfig, svelte } from "../helpers.js";
6. 
7. describe("js", () => {
8. 	fs.readdirSync("test/js/samples").forEach(dir => {
9. 		if (dir[0] === ".") return;
10. 
11. 		// add .solo to a sample directory name to only run that test
12. 		const solo = /\.solo/.test(dir);
13. 
14. 		if (solo && process.env.CI) {
15. 			throw new Error("Forgot to remove `solo: true` from test");
16. 		}
17. 
18. 		(solo ? it.only : it)(dir, () => {
19. 			dir = path.resolve("test/js/samples", dir);
20. 			const config = loadConfig(`${dir}/_config.js`);
21. 
22. 			const input = fs
23. 				.readFileSync(`${dir}/input.html`, "utf-8")
24. 				.replace(/\s+$/, "");
25. 
26. 			let actual;
27. 
28. 			try {
29. 				const options = Object.assign(config.options || {}, {
30. 					shared: true
31. 				});
32. 
33. 				actual = svelte.compile(input, options).code.replace(/generated by Svelte v\d+\.\d+\.\d+/, 'generated by Svelte vX.Y.Z');
34. 			} catch (err) {
35. 				console.log(err.frame);
36. 				throw err;
37. 			}
38. 
39. 			fs.writeFileSync(`${dir}/_actual.js`, actual);
40. 
41. 			return rollup({
42. 				input: `${dir}/_actual.js`,
43. 				plugins: [
44. 					{
45. 						resolveId(importee, importer) {
46. 							if (!importer) return importee;
47. 							if (importee === "svelte/shared.js")
48. 								return path.resolve("shared.js");
49. 							return null;
50. 						}
51. 					}
52. 				]
53. 			}).then(bundle => {
54. 				return bundle.generate({ format: "es" });
55. 			}).then(({ code }) => {
56. 				fs.writeFileSync(`${dir}/_actual-bundle.js`, code);
57. 
58. 				const expected = fs.readFileSync(`${dir}/expected.js`, "utf-8");
59. 				const expectedBundle = fs.readFileSync(
60. 					`${dir}/expected-bundle.js`,
61. 					"utf-8"
62. 				);
63. 
64. 				assert.equal(
65. 					actual.trim().replace(/^[ \t]+$/gm, ""),
66. 					expected.trim().replace(/^[ \t]+$/gm, "")
67. 				);
68. 
69. 				assert.equal(
70. 					code.trim().replace(/^[ \t]+$/gm, ""),
71. 					expectedBundle.trim().replace(/^[ \t]+$/gm, "")
72. 				);
73. 			}).catch(err => {
74. 				if (err.loc) console.error(err.loc);
75. 				throw err;
76. 			});
77. 		});
78. 	});
79. });


File: test/runtime/index.js
Line number range: 1 - 241
Content:
1. import assert from "assert";
2. import * as path from "path";
3. import * as fs from "fs";
4. import * as acorn from "acorn";
5. import { transitionManager } from "../../shared.js";
6. 
7. import {
8. 	showOutput,
9. 	loadConfig,
10. 	loadSvelte,
11. 	env,
12. 	setupHtmlEqual,
13. 	spaces
14. } from "../helpers.js";
15. 
16. let svelte;
17. 
18. let compileOptions = null;
19. 
20. function getName(filename) {
21. 	const base = path.basename(filename).replace(".html", "");
22. 	return base[0].toUpperCase() + base.slice(1);
23. }
24. 
25. describe("runtime", () => {
26. 	before(() => {
27. 		svelte = loadSvelte(true);
28. 
29. 		require.extensions[".html"] = function(module, filename) {
30. 			const options = Object.assign(
31. 				{ filename, name: getName(filename), format: 'cjs' },
32. 				compileOptions
33. 			);
34. 
35. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
36. 
37. 			return module._compile(code, filename);
38. 		};
39. 
40. 		return setupHtmlEqual();
41. 	});
42. 
43. 	const failed = new Set();
44. 
45. 	function runTest(dir, shared, hydrate) {
46. 		if (dir[0] === ".") return;
47. 
48. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
49. 
50. 		if (config.solo && process.env.CI) {
51. 			throw new Error("Forgot to remove `solo: true` from test");
52. 		}
53. 
54. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
55. 			if (failed.has(dir)) {
56. 				// this makes debugging easier, by only printing compiled output once
57. 				throw new Error('skipping test, already failed');
58. 			}
59. 
60. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
61. 
62. 			compileOptions = config.compileOptions || {};
63. 			compileOptions.shared = shared;
64. 			compileOptions.hydratable = hydrate;
65. 			compileOptions.dev = config.dev;
66. 
67. 			// check that no ES2015+ syntax slipped in
68. 			if (!config.allowES2015) {
69. 				try {
70. 					const source = fs.readFileSync(
71. 						`test/runtime/samples/${dir}/main.html`,
72. 						"utf-8"
73. 					);
74. 					const { code } = svelte.compile(source, compileOptions);
75. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
76. 					if (startIndex === -1) throw new Error("missing create_main_fragment");
77. 					const endIndex = code.lastIndexOf("export default");
78. 					const es5 =
79. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
80. 						code.slice(startIndex, endIndex);
81. 
82. 					acorn.parse(es5, { ecmaVersion: 5 });
83. 
84. 					if (/Object\.assign/.test(es5)) {
85. 						throw new Error(
86. 							"cannot use Object.assign in generated code, as it is not supported everywhere"
87. 						);
88. 					}
89. 				} catch (err) {
90. 					failed.add(dir);
91. 					showOutput(cwd, { shared }, svelte); // eslint-disable-line no-console
92. 					throw err;
93. 				}
94. 			}
95. 
96. 			Object.keys(require.cache)
97. 				.filter(x => x.endsWith(".html"))
98. 				.forEach(file => {
99. 					delete require.cache[file];
100. 				});
101. 
102. 			let SvelteComponent;
103. 
104. 			let unintendedError = null;
105. 
106. 			const window = env();
107. 
108. 			try {
109. 				// set of hacks to support transition tests
110. 				transitionManager.running = false;
111. 				transitionManager.transitions = [];
112. 
113. 				const raf = {
114. 					time: 0,
115. 					callback: null,
116. 					tick: now => {
117. 						raf.time = now;
118. 						if (raf.callback) raf.callback();
119. 					}
120. 				};
121. 				window.performance = { now: () => raf.time };
122. 				global.requestAnimationFrame = cb => {
123. 					let called = false;
124. 					raf.callback = () => {
125. 						if (!called) {
126. 							called = true;
127. 							cb();
128. 						}
129. 					};
130. 				};
131. 
132. 				global.window = window;
133. 
134. 				try {
135. 					SvelteComponent = require(`./samples/${dir}/main.html`);
136. 				} catch (err) {
137. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
138. 					throw err;
139. 				}
140. 
141. 				global.window = window;
142. 
143. 				// Put the constructor on window for testing
144. 				window.SvelteComponent = SvelteComponent;
145. 
146. 				const target = window.document.querySelector("main");
147. 
148. 				const warnings = [];
149. 				const warn = console.warn;
150. 				console.warn = warning => {
151. 					warnings.push(warning);
152. 				};
153. 
154. 				const options = Object.assign({}, {
155. 					target,
156. 					hydrate,
157. 					data: config.data
158. 				}, config.options || {});
159. 
160. 				const component = new SvelteComponent(options);
161. 
162. 				console.warn = warn;
163. 
164. 				if (config.error) {
165. 					unintendedError = true;
166. 					throw new Error("Expected a runtime error");
167. 				}
168. 
169. 				if (config.warnings) {
170. 					assert.deepEqual(warnings, config.warnings);
171. 				} else if (warnings.length) {
172. 					unintendedError = true;
173. 					throw new Error("Received unexpected warnings");
174. 				}
175. 
176. 				if (config.html) {
177. 					assert.htmlEqual(target.innerHTML, config.html);
178. 				}
179. 
180. 				if (config.test) {
181. 					config.test(assert, component, target, window, raf);
182. 				} else {
183. 					component.destroy();
184. 					assert.equal(target.innerHTML, "");
185. 				}
186. 			} catch (err) {
187. 				if (config.error && !unintendedError) {
188. 					config.error(assert, err);
189. 				} else {
190. 					failed.add(dir);
191. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
192. 					throw err;
193. 				}
194. 			}
195. 
196. 			if (config.show) showOutput(cwd, { shared, hydratable: hydrate }, svelte);
197. 		});
198. 	}
199. 
200. 	const shared = path.resolve("shared.js");
201. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
202. 		runTest(dir, shared, false);
203. 		runTest(dir, shared, true);
204. 		runTest(dir, null, false);
205. 	});
206. 
207. 	it("fails if options.target is missing in dev mode", () => {
208. 		const { code } = svelte.compile(`<div></div>`, {
209. 			format: "iife",
210. 			name: "SvelteComponent",
211. 			dev: true
212. 		});
213. 
214. 		const SvelteComponent = eval(
215. 			`(function () { ${code}; return SvelteComponent; }())`
216. 		);
217. 
218. 		assert.throws(() => {
219. 			new SvelteComponent();
220. 		}, /'target' is a required option/);
221. 	});
222. 
223. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
224. 		const { code } = svelte.compile(`<div></div>`, {
225. 			format: "iife",
226. 			name: "SvelteComponent",
227. 			dev: true
228. 		});
229. 
230. 		const SvelteComponent = eval(
231. 			`(function () { ${code}; return SvelteComponent; }())`
232. 		);
233. 
234. 		assert.throws(() => {
235. 			new SvelteComponent({
236. 				target: {},
237. 				hydrate: true
238. 			});
239. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
240. 	});
241. });


File: test/setup.js
Line number range: 1 - 37
Content:
1. const fs = require('fs');
2. const path = require('path');
3. 
4. require('console-group').install();
5. require('source-map-support').install();
6. 
7. require.extensions['.js'] = function(module, filename) {
8. 	const exports = [];
9. 
10. 	var code = fs.readFileSync(filename, 'utf-8')
11. 		.replace(/^import (?:\* as )?(\w+) from ['"]([^'"]+)['"];?/gm, 'var $1 = require("$2");')
12. 		.replace(/^import {([^}]+)} from ['"](.+)['"];?/gm, 'var {$1} = require("$2");')
13. 		.replace(/^export default /gm, 'module.exports = ')
14. 		.replace(/^export (const|let|var|class|function) (\w+)/gm, (match, type, name) => {
15. 			exports.push(name);
16. 			return `${type} ${name}`;
17. 		})
18. 		.replace(/^export \{([^}]+)\}/gm, (match, names) => {
19. 			names.split(',').filter(Boolean).forEach(name => {
20. 				exports.push(name);
21. 			});
22. 
23. 			return '';
24. 		})
25. 		.replace(/^export function (\w+)/gm, 'exports.$1 = function $1');
26. 
27. 	exports.forEach(name => {
28. 		code += `\nexports.${name} = ${name};`;
29. 	});
30. 
31. 	try {
32. 		return module._compile(code, filename);
33. 	} catch (err) {
34. 		console.log(code); // eslint-disable-line no-console
35. 		throw err;
36. 	}
37. };


File: test/test.js
Line number range: 1 - 11
Content:
1. const glob = require("glob");
2. 
3. require("./setup");
4. 
5. glob.sync("**/__test__.js", { cwd: "src" }).forEach(function(file) {
6. 	require("../src/" + file);
7. });
8. 
9. glob.sync("*/index.js", { cwd: "test" }).forEach(function(file) {
10. 	require("./" + file);
11. });

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-11 00:23:45,306 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n   - The user requests the full contents of test/js/index.js.\n   - This file defines how JS code-generation samples are discovered, compiled, bundled, and asserted.\n2. Extended relevance:\n   - It includes sample loading (fs.readdirSync of test/js/samples), precise imports, compilation via svelte.compile, bundling via rollup, and assertions comparing outputs — all essential to understand the JS tests and extract test cases with accurate line numbers.', relative_path='test/js/index.js', start_line=1, end_line=79), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user requests the full contents of test/runtime/index.js.\n   - This file is the runtime test harness that dynamically compiles .html samples and executes them, capturing warnings, verifying HTML, and running optional config.test hooks.\n2. Extended relevance:\n   - It shows how samples are loaded (fs.readdirSync of test/runtime/samples, require.extensions for .html), environment setup (env, JSDOM, raf), compile options (shared, hydratable, dev), and assertions.\n   - These are critical to understand runtime tests, including where lifecycle behavior (oncreate/onrender/ondestroy) would be exercised via sample components.', relative_path='test/runtime/index.js', start_line=1, end_line=241), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user requests the full contents of test/helpers.js.\n   - This file provides utilities used across tests (loading Svelte, JSDOM env, HTML normalization and equality, config loading, etc.).\n2. Extended relevance:\n   - Defines loadSvelte, env, setupHtmlEqual, normalizeHtml, loadConfig, and showOutput which are called from the test runners to set up the environment, load samples, and perform assertions — essential for correctly interpreting test behavior and reproducing results with exact line numbers.', relative_path='test/helpers.js', start_line=1, end_line=239), ContextOutput(reasoning="1. Query requirement analysis:\n   - The user requests the full contents of test/setup.js.\n   - This file configures the test runtime to handle ES module syntax in test files by transforming to CommonJS.\n2. Extended relevance:\n   - It installs source-map support and defines require.extensions['.js'] transform logic, which is necessary to run the test files as written — part of precise setup the user needs.", relative_path='test/setup.js', start_line=1, end_line=37), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user requests the full contents of test/test.js.\n   - This file is the top-level test entry that discovers and requires test suites.\n2. Extended relevance:\n   - It shows how the test runners are loaded (requires ./setup then loads */index.js in test), which is necessary to understand how samples and specific test runners are invoked.', relative_path='test/test.js', start_line=1, end_line=11)]
2025-11-11 00:23:45,310 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 5 contexts to memory for query: Please provide the full contents of test/js/index.js, test/runtime/index.js, test/helpers.js, test/setup.js, and test/test.js.
2025-11-11 00:23:45,632 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-11 00:23:45,634 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 5 new contexts to 0 existing contexts
2025-11-11 00:23:45,634 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 5 total contexts (removed 0 duplicates)
2025-11-11 00:23:45,635 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of test/js/index.js, test/runtime/index.js, test/helpers.js, test/setup.js, and test/test.js.
Extra Requirements: If sending full files is too large, include at minimum the test case definitions for lifecycle hooks (oncreate/onrender/ondestroy) and how samples are loaded, with exact line numbers.
Purpose: I need these files to extract 8 relevant test cases with precise imports, setup, assertions, and line numbers.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: test/helpers.js
Line number range: 1 - 239
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	if (test) global.__svelte_test = true;
12. 
13. 	const resolved = process.env.COVERAGE
14. 		? require.resolve('../src/index.js')
15. 		: require.resolve('../compiler/svelte.js');
16. 
17. 	delete require.cache[resolved];
18. 	return require(resolved);
19. }
20. 
21. export const svelte = loadSvelte();
22. 
23. export function exists(path) {
24. 	try {
25. 		fs.statSync(path);
26. 		return true;
27. 	} catch (err) {
28. 		return false;
29. 	}
30. }
31. 
32. export function tryToLoadJson(file) {
33. 	try {
34. 		return JSON.parse(fs.readFileSync(file));
35. 	} catch (err) {
36. 		if (err.code !== 'ENOENT') throw err;
37. 		return null;
38. 	}
39. }
40. 
41. export function tryToReadFile(file) {
42. 	try {
43. 		return fs.readFileSync(file, 'utf-8');
44. 	} catch (err) {
45. 		if (err.code !== 'ENOENT') throw err;
46. 		return null;
47. 	}
48. }
49. 
50. const { window } = new JSDOM('<main></main>');
51. global.document = window.document;
52. 
53. export function env() {
54. 	window._svelteTransitionManager = null;
55. 	window.document.body.innerHTML = '<main></main>';
56. 
57. 	return window;
58. }
59. 
60. function cleanChildren(node) {
61. 	let previous = null;
62. 
63. 	// sort attributes
64. 	const attributes = Array.from(node.attributes).sort((a, b) => {
65. 		return a.name < b.name ? -1 : 1;
66. 	});
67. 
68. 	attributes.forEach(attr => {
69. 		node.removeAttribute(attr.name);
70. 	});
71. 
72. 	attributes.forEach(attr => {
73. 		node.setAttribute(attr.name, attr.value);
74. 	});
75. 
76. 	// recurse
77. 	[...node.childNodes].forEach(child => {
78. 		if (child.nodeType === 3) {
79. 			// text
80. 			if (
81. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
82. 				node.tagName !== 'text' &&
83. 				node.tagName !== 'tspan'
84. 			) {
85. 				node.removeChild(child);
86. 			}
87. 
88. 			child.data = child.data.replace(/\s{2,}/g, '\n');
89. 
90. 			if (previous && previous.nodeType === 3) {
91. 				previous.data += child.data;
92. 				previous.data = previous.data.replace(/\s{2,}/g, '\n');
93. 
94. 				node.removeChild(child);
95. 				child = previous;
96. 			}
97. 		} else {
98. 			cleanChildren(child);
99. 		}
100. 
101. 		previous = child;
102. 	});
103. 
104. 	// collapse whitespace
105. 	if (node.firstChild && node.firstChild.nodeType === 3) {
106. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
107. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
108. 	}
109. 
110. 	if (node.lastChild && node.lastChild.nodeType === 3) {
111. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
112. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
113. 	}
114. }
115. 
116. export function normalizeHtml(window, html) {
117. 	try {
118. 		const node = window.document.createElement('div');
119. 		node.innerHTML = html
120. 			.replace(/<!--.*?-->/g, '')
121. 			.replace(/>[\s\r\n]+</g, '><')
122. 			.trim();
123. 		cleanChildren(node, '');
124. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
125. 	} catch (err) {
126. 		throw new Error(`Failed to normalize HTML:\n${html}`);
127. 	}
128. }
129. 
130. export function setupHtmlEqual() {
131. 	const window = env();
132. 
133. 	assert.htmlEqual = (actual, expected, message) => {
134. 		assert.deepEqual(
135. 			normalizeHtml(window, actual),
136. 			normalizeHtml(window, expected),
137. 			message
138. 		);
139. 	};
140. }
141. 
142. export function loadConfig(file) {
143. 	try {
144. 		const resolved = require.resolve(file);
145. 		delete require.cache[resolved];
146. 
147. 		const config = require(resolved);
148. 		return config.default || config;
149. 	} catch (err) {
150. 		if (err.code === 'MODULE_NOT_FOUND') {
151. 			return {};
152. 		}
153. 
154. 		throw err;
155. 	}
156. }
157. 
158. export function addLineNumbers(code) {
159. 	return code
160. 		.split('\n')
161. 		.map((line, i) => {
162. 			i = String(i + 1);
163. 			while (i.length < 3) i = ` ${i}`;
164. 
165. 			return (
166. 				chalk.grey(`  ${i}: `) +
167. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
168. 			);
169. 		})
170. 		.join('\n');
171. }
172. 
173. function capitalise(str) {
174. 	return str[0].toUpperCase() + str.slice(1);
175. }
176. 
177. export function showOutput(cwd, options = {}, s = svelte) {
178. 	glob.sync('**/*.html', { cwd }).forEach(file => {
179. 		if (file[0] === '_') return;
180. 		const { code } = s.compile(
181. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
182. 			Object.assign(options, {
183. 				filename: file,
184. 				name: capitalise(path.basename(file).replace(/\.html$/, ''))
185. 			})
186. 		);
187. 
188. 		console.log( // eslint-disable-line no-console
189. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
190. 		);
191. 	});
192. }
193. 
194. const start = /\n(\t+)/;
195. export function deindent(strings, ...values) {
196. 	const indentation = start.exec(strings[0])[1];
197. 	const pattern = new RegExp(`^${indentation}`, 'gm');
198. 
199. 	let result = strings[0].replace(start, '').replace(pattern, '');
200. 
201. 	let trailingIndentation = getTrailingIndentation(result);
202. 
203. 	for (let i = 1; i < strings.length; i += 1) {
204. 		let expression = values[i - 1];
205. 		const string = strings[i].replace(pattern, '');
206. 
207. 		if (Array.isArray(expression)) {
208. 			expression = expression.length ? expression.join('\n') : null;
209. 		}
210. 
211. 		if (expression || expression === '') {
212. 			const value = String(expression).replace(
213. 				/\n/g,
214. 				`\n${trailingIndentation}`
215. 			);
216. 			result += value + string;
217. 		} else {
218. 			let c = result.length;
219. 			while (/\s/.test(result[c - 1])) c -= 1;
220. 			result = result.slice(0, c) + string;
221. 		}
222. 
223. 		trailingIndentation = getTrailingIndentation(result);
224. 	}
225. 
226. 	return result.trim().replace(/\t+$/gm, '');
227. }
228. 
229. function getTrailingIndentation(str) {
230. 	let i = str.length;
231. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
232. 	return str.slice(i, str.length);
233. }
234. 
235. export function spaces(i) {
236. 	let result = '';
237. 	while (i--) result += ' ';
238. 	return result;
239. }


File: test/js/index.js
Line number range: 1 - 79
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import { rollup } from "rollup";
5. import { loadConfig, svelte } from "../helpers.js";
6. 
7. describe("js", () => {
8. 	fs.readdirSync("test/js/samples").forEach(dir => {
9. 		if (dir[0] === ".") return;
10. 
11. 		// add .solo to a sample directory name to only run that test
12. 		const solo = /\.solo/.test(dir);
13. 
14. 		if (solo && process.env.CI) {
15. 			throw new Error("Forgot to remove `solo: true` from test");
16. 		}
17. 
18. 		(solo ? it.only : it)(dir, () => {
19. 			dir = path.resolve("test/js/samples", dir);
20. 			const config = loadConfig(`${dir}/_config.js`);
21. 
22. 			const input = fs
23. 				.readFileSync(`${dir}/input.html`, "utf-8")
24. 				.replace(/\s+$/, "");
25. 
26. 			let actual;
27. 
28. 			try {
29. 				const options = Object.assign(config.options || {}, {
30. 					shared: true
31. 				});
32. 
33. 				actual = svelte.compile(input, options).code.replace(/generated by Svelte v\d+\.\d+\.\d+/, 'generated by Svelte vX.Y.Z');
34. 			} catch (err) {
35. 				console.log(err.frame);
36. 				throw err;
37. 			}
38. 
39. 			fs.writeFileSync(`${dir}/_actual.js`, actual);
40. 
41. 			return rollup({
42. 				input: `${dir}/_actual.js`,
43. 				plugins: [
44. 					{
45. 						resolveId(importee, importer) {
46. 							if (!importer) return importee;
47. 							if (importee === "svelte/shared.js")
48. 								return path.resolve("shared.js");
49. 							return null;
50. 						}
51. 					}
52. 				]
53. 			}).then(bundle => {
54. 				return bundle.generate({ format: "es" });
55. 			}).then(({ code }) => {
56. 				fs.writeFileSync(`${dir}/_actual-bundle.js`, code);
57. 
58. 				const expected = fs.readFileSync(`${dir}/expected.js`, "utf-8");
59. 				const expectedBundle = fs.readFileSync(
60. 					`${dir}/expected-bundle.js`,
61. 					"utf-8"
62. 				);
63. 
64. 				assert.equal(
65. 					actual.trim().replace(/^[ \t]+$/gm, ""),
66. 					expected.trim().replace(/^[ \t]+$/gm, "")
67. 				);
68. 
69. 				assert.equal(
70. 					code.trim().replace(/^[ \t]+$/gm, ""),
71. 					expectedBundle.trim().replace(/^[ \t]+$/gm, "")
72. 				);
73. 			}).catch(err => {
74. 				if (err.loc) console.error(err.loc);
75. 				throw err;
76. 			});
77. 		});
78. 	});
79. });


File: test/runtime/index.js
Line number range: 1 - 241
Content:
1. import assert from "assert";
2. import * as path from "path";
3. import * as fs from "fs";
4. import * as acorn from "acorn";
5. import { transitionManager } from "../../shared.js";
6. 
7. import {
8. 	showOutput,
9. 	loadConfig,
10. 	loadSvelte,
11. 	env,
12. 	setupHtmlEqual,
13. 	spaces
14. } from "../helpers.js";
15. 
16. let svelte;
17. 
18. let compileOptions = null;
19. 
20. function getName(filename) {
21. 	const base = path.basename(filename).replace(".html", "");
22. 	return base[0].toUpperCase() + base.slice(1);
23. }
24. 
25. describe("runtime", () => {
26. 	before(() => {
27. 		svelte = loadSvelte(true);
28. 
29. 		require.extensions[".html"] = function(module, filename) {
30. 			const options = Object.assign(
31. 				{ filename, name: getName(filename), format: 'cjs' },
32. 				compileOptions
33. 			);
34. 
35. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
36. 
37. 			return module._compile(code, filename);
38. 		};
39. 
40. 		return setupHtmlEqual();
41. 	});
42. 
43. 	const failed = new Set();
44. 
45. 	function runTest(dir, shared, hydrate) {
46. 		if (dir[0] === ".") return;
47. 
48. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
49. 
50. 		if (config.solo && process.env.CI) {
51. 			throw new Error("Forgot to remove `solo: true` from test");
52. 		}
53. 
54. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
55. 			if (failed.has(dir)) {
56. 				// this makes debugging easier, by only printing compiled output once
57. 				throw new Error('skipping test, already failed');
58. 			}
59. 
60. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
61. 
62. 			compileOptions = config.compileOptions || {};
63. 			compileOptions.shared = shared;
64. 			compileOptions.hydratable = hydrate;
65. 			compileOptions.dev = config.dev;
66. 
67. 			// check that no ES2015+ syntax slipped in
68. 			if (!config.allowES2015) {
69. 				try {
70. 					const source = fs.readFileSync(
71. 						`test/runtime/samples/${dir}/main.html`,
72. 						"utf-8"
73. 					);
74. 					const { code } = svelte.compile(source, compileOptions);
75. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
76. 					if (startIndex === -1) throw new Error("missing create_main_fragment");
77. 					const endIndex = code.lastIndexOf("export default");
78. 					const es5 =
79. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
80. 						code.slice(startIndex, endIndex);
81. 
82. 					acorn.parse(es5, { ecmaVersion: 5 });
83. 
84. 					if (/Object\.assign/.test(es5)) {
85. 						throw new Error(
86. 							"cannot use Object.assign in generated code, as it is not supported everywhere"
87. 						);
88. 					}
89. 				} catch (err) {
90. 					failed.add(dir);
91. 					showOutput(cwd, { shared }, svelte); // eslint-disable-line no-console
92. 					throw err;
93. 				}
94. 			}
95. 
96. 			Object.keys(require.cache)
97. 				.filter(x => x.endsWith(".html"))
98. 				.forEach(file => {
99. 					delete require.cache[file];
100. 				});
101. 
102. 			let SvelteComponent;
103. 
104. 			let unintendedError = null;
105. 
106. 			const window = env();
107. 
108. 			try {
109. 				// set of hacks to support transition tests
110. 				transitionManager.running = false;
111. 				transitionManager.transitions = [];
112. 
113. 				const raf = {
114. 					time: 0,
115. 					callback: null,
116. 					tick: now => {
117. 						raf.time = now;
118. 						if (raf.callback) raf.callback();
119. 					}
120. 				};
121. 				window.performance = { now: () => raf.time };
122. 				global.requestAnimationFrame = cb => {
123. 					let called = false;
124. 					raf.callback = () => {
125. 						if (!called) {
126. 							called = true;
127. 							cb();
128. 						}
129. 					};
130. 				};
131. 
132. 				global.window = window;
133. 
134. 				try {
135. 					SvelteComponent = require(`./samples/${dir}/main.html`);
136. 				} catch (err) {
137. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
138. 					throw err;
139. 				}
140. 
141. 				global.window = window;
142. 
143. 				// Put the constructor on window for testing
144. 				window.SvelteComponent = SvelteComponent;
145. 
146. 				const target = window.document.querySelector("main");
147. 
148. 				const warnings = [];
149. 				const warn = console.warn;
150. 				console.warn = warning => {
151. 					warnings.push(warning);
152. 				};
153. 
154. 				const options = Object.assign({}, {
155. 					target,
156. 					hydrate,
157. 					data: config.data
158. 				}, config.options || {});
159. 
160. 				const component = new SvelteComponent(options);
161. 
162. 				console.warn = warn;
163. 
164. 				if (config.error) {
165. 					unintendedError = true;
166. 					throw new Error("Expected a runtime error");
167. 				}
168. 
169. 				if (config.warnings) {
170. 					assert.deepEqual(warnings, config.warnings);
171. 				} else if (warnings.length) {
172. 					unintendedError = true;
173. 					throw new Error("Received unexpected warnings");
174. 				}
175. 
176. 				if (config.html) {
177. 					assert.htmlEqual(target.innerHTML, config.html);
178. 				}
179. 
180. 				if (config.test) {
181. 					config.test(assert, component, target, window, raf);
182. 				} else {
183. 					component.destroy();
184. 					assert.equal(target.innerHTML, "");
185. 				}
186. 			} catch (err) {
187. 				if (config.error && !unintendedError) {
188. 					config.error(assert, err);
189. 				} else {
190. 					failed.add(dir);
191. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
192. 					throw err;
193. 				}
194. 			}
195. 
196. 			if (config.show) showOutput(cwd, { shared, hydratable: hydrate }, svelte);
197. 		});
198. 	}
199. 
200. 	const shared = path.resolve("shared.js");
201. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
202. 		runTest(dir, shared, false);
203. 		runTest(dir, shared, true);
204. 		runTest(dir, null, false);
205. 	});
206. 
207. 	it("fails if options.target is missing in dev mode", () => {
208. 		const { code } = svelte.compile(`<div></div>`, {
209. 			format: "iife",
210. 			name: "SvelteComponent",
211. 			dev: true
212. 		});
213. 
214. 		const SvelteComponent = eval(
215. 			`(function () { ${code}; return SvelteComponent; }())`
216. 		);
217. 
218. 		assert.throws(() => {
219. 			new SvelteComponent();
220. 		}, /'target' is a required option/);
221. 	});
222. 
223. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
224. 		const { code } = svelte.compile(`<div></div>`, {
225. 			format: "iife",
226. 			name: "SvelteComponent",
227. 			dev: true
228. 		});
229. 
230. 		const SvelteComponent = eval(
231. 			`(function () { ${code}; return SvelteComponent; }())`
232. 		);
233. 
234. 		assert.throws(() => {
235. 			new SvelteComponent({
236. 				target: {},
237. 				hydrate: true
238. 			});
239. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
240. 	});
241. });


File: test/setup.js
Line number range: 1 - 37
Content:
1. const fs = require('fs');
2. const path = require('path');
3. 
4. require('console-group').install();
5. require('source-map-support').install();
6. 
7. require.extensions['.js'] = function(module, filename) {
8. 	const exports = [];
9. 
10. 	var code = fs.readFileSync(filename, 'utf-8')
11. 		.replace(/^import (?:\* as )?(\w+) from ['"]([^'"]+)['"];?/gm, 'var $1 = require("$2");')
12. 		.replace(/^import {([^}]+)} from ['"](.+)['"];?/gm, 'var {$1} = require("$2");')
13. 		.replace(/^export default /gm, 'module.exports = ')
14. 		.replace(/^export (const|let|var|class|function) (\w+)/gm, (match, type, name) => {
15. 			exports.push(name);
16. 			return `${type} ${name}`;
17. 		})
18. 		.replace(/^export \{([^}]+)\}/gm, (match, names) => {
19. 			names.split(',').filter(Boolean).forEach(name => {
20. 				exports.push(name);
21. 			});
22. 
23. 			return '';
24. 		})
25. 		.replace(/^export function (\w+)/gm, 'exports.$1 = function $1');
26. 
27. 	exports.forEach(name => {
28. 		code += `\nexports.${name} = ${name};`;
29. 	});
30. 
31. 	try {
32. 		return module._compile(code, filename);
33. 	} catch (err) {
34. 		console.log(code); // eslint-disable-line no-console
35. 		throw err;
36. 	}
37. };


File: test/test.js
Line number range: 1 - 11
Content:
1. const glob = require("glob");
2. 
3. require("./setup");
4. 
5. glob.sync("**/__test__.js", { cwd: "src" }).forEach(function(file) {
6. 	require("../src/" + file);
7. });
8. 
9. glob.sync("*/index.js", { cwd: "test" }).forEach(function(file) {
10. 	require("./" + file);
11. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:24:04,305 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The issue concerns lifecycle hook code generation (async oncreate being removed). To select 8 precise regression tests with imports and assertions, I need the contents of specific sample-based tests that exercise oncreate/onrender lifecycle behavior. The current context only shows the test harness, not the sample files where the actual test logic and expected outputs live.' query='Please provide the full contents (with line numbers) of these test sample files: 1) test/runtime/samples/bindings-before-oncreate/_config.js and main.html, 2) test/runtime/samples/lifecycle-events/_config.js and main.html, 3) test/runtime/samples/onrender-fires-when-ready/_config.js and main.html, 4) test/runtime/samples/onrender-fires-when-ready-nested/_config.js and main.html, 5) test/runtime/samples/ondestroy-before-cleanup/_config.js and main.html, 6) test/runtime/samples/set-in-oncreate/_config.js and main.html, 7) test/js/samples/onrender-onteardown-rewritten/expected.js, expected-bundle.js, and input.html, 8) test/js/samples/ssr-no-oncreate-etc/_config.js, expected.js, expected-bundle.js, and input.html.' extra_requirements='If sending all files is too large, include at minimum each _config.js and main.html (runtime) and expected.js, expected-bundle.js, input.html (js), with all import statements and test callbacks, plus exact line numbers.' purpose='I need these to extract 8 complete, self-contained test cases covering lifecycle hooks where async oncreate could affect behavior.'
2025-11-11 00:24:04,307 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents (with line numbers) of these test sample files: 1) test/runtime/samples/bindings-before-oncreate/_config.js and main.html, 2) test/runtime/samples/lifecycle-events/_config.js and main.html, 3) test/runtime/samples/onrender-fires-when-ready/_config.js and main.html, 4) test/runtime/samples/onrender-fires-when-ready-nested/_config.js and main.html, 5) test/runtime/samples/ondestroy-before-cleanup/_config.js and main.html, 6) test/runtime/samples/set-in-oncreate/_config.js and main.html, 7) test/js/samples/onrender-onteardown-rewritten/expected.js, expected-bundle.js, and input.html, 8) test/js/samples/ssr-no-oncreate-etc/_config.js, expected.js, expected-bundle.js, and input.html.
2025-11-11 00:24:04,608 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-11 00:24:04,608 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-11 00:24:04,608 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-11 00:24:04,608 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-11 00:24:04,610 - thread-133013323122368.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-11 00:24:04,611 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-11 00:24:04,611 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents (with line numbers) of these test sample files: 1) test/runtime/samples/bindings-before-oncreate/_config.js and main.html, 2) test/runtime/samples/lifecycle-events/_config.js and main.html, 3) test/runtime/samples/onrender-fires-when-ready/_config.js and main.html, 4) test/runtime/samples/onrender-fires-when-ready-nested/_config.js and main.html, 5) test/runtime/samples/ondestroy-before-cleanup/_config.js and main.html, 6) test/runtime/samples/set-in-oncreate/_config.js and main.html, 7) test/js/samples/onrender-onteardown-rewritten/expected.js, expected-bundle.js, and input.html, 8) test/js/samples/ssr-no-oncreate-etc/_config.js, expected.js, expected-bundle.js, and input.html.
Extra requirements: If sending all files is too large, include at minimum each _config.js and main.html (runtime) and expected.js, expected-bundle.js, input.html (js), with all import statements and test callbacks, plus exact line numbers.
Purpose: I need these to extract 8 complete, self-contained test cases covering lifecycle hooks where async oncreate could affect behavior.
2025-11-11 00:24:10,936 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_V29aeTLJCfZghEC4DmuLOQl5', 'function': {'arguments': '{"relative_path":"test/runtime/samples/bindings-before-oncreate/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 554, 'prompt_tokens': 2372, 'total_tokens': 2926, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cbcaf863-2dfc-4d09-a338-2309702f3cd3-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/bindings-before-oncreate/_config.js'}, 'id': 'call_V29aeTLJCfZghEC4DmuLOQl5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2372, 'output_tokens': 554, 'total_tokens': 2926, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-11 00:24:11,930 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_K1SZ0qA71FC3C3CMKyjhFNRL', 'function': {'arguments': '{"relative_path":"test/runtime/samples/bindings-before-oncreate/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 35, 'prompt_tokens': 2528, 'total_tokens': 2563, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d67bb5bc-10e9-4823-937e-e673e16a2bf6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/bindings-before-oncreate/main.html'}, 'id': 'call_K1SZ0qA71FC3C3CMKyjhFNRL', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2528, 'output_tokens': 35, 'total_tokens': 2563, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:19,515 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ybdjtGFtVEkVOC6oT3zwTQOb', 'function': {'arguments': '{"relative_path":"test/runtime/samples/lifecycle-events/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 807, 'prompt_tokens': 2707, 'total_tokens': 3514, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--21ccafdb-0c1a-45a0-8dd6-d80ed919ea8b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/lifecycle-events/_config.js'}, 'id': 'call_ybdjtGFtVEkVOC6oT3zwTQOb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2707, 'output_tokens': 807, 'total_tokens': 3514, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-11 00:24:20,707 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_oVRJ9TJA7sRCShd7XEqQDRIo', 'function': {'arguments': '{"relative_path":"test/runtime/samples/lifecycle-events/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 2886, 'total_tokens': 2918, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ac3bb68f-6a78-434f-bf70-33e891b80168-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/lifecycle-events/main.html'}, 'id': 'call_oVRJ9TJA7sRCShd7XEqQDRIo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2886, 'output_tokens': 32, 'total_tokens': 2918, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:22,096 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_jdxMTOnP7aQHlci2T2mUomPz', 'function': {'arguments': '{"relative_path":"test/runtime/samples/onrender-fires-when-ready/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 3096, 'total_tokens': 3133, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cf6b9f4e-1e59-4711-9b3d-fe18c737f298-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/_config.js'}, 'id': 'call_jdxMTOnP7aQHlci2T2mUomPz', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3096, 'output_tokens': 37, 'total_tokens': 3133, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:23,264 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xJzdn1RGlkECWVt0ewzFsnNx', 'function': {'arguments': '{"relative_path":"test/runtime/samples/onrender-fires-when-ready/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 3346, 'total_tokens': 3382, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6d2ed1a8-16e6-4fa0-9304-17be12bed9dd-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/main.html'}, 'id': 'call_xJzdn1RGlkECWVt0ewzFsnNx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3346, 'output_tokens': 36, 'total_tokens': 3382, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:24,399 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WztRSDnSeg2j0WnmxWLPPQ8V', 'function': {'arguments': '{"relative_path":"test/runtime/samples/onrender-fires-when-ready-nested/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 3584, 'total_tokens': 3623, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3328}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bf3a54e4-bc70-4f0a-b5da-04942e858207-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/onrender-fires-when-ready-nested/_config.js'}, 'id': 'call_WztRSDnSeg2j0WnmxWLPPQ8V', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3584, 'output_tokens': 39, 'total_tokens': 3623, 'input_token_details': {'audio': 0, 'cache_read': 3328}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:25,440 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_rXHObI363sD64za43H1xtNgP', 'function': {'arguments': '{"relative_path":"test/runtime/samples/onrender-fires-when-ready-nested/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 3759, 'total_tokens': 3797, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2432}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c42650cc-4440-499f-b4b6-896b28824423-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/onrender-fires-when-ready-nested/main.html'}, 'id': 'call_rXHObI363sD64za43H1xtNgP', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3759, 'output_tokens': 38, 'total_tokens': 3797, 'input_token_details': {'audio': 0, 'cache_read': 2432}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:26,983 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_059byXJsbDVJh4tShRIh0aeU', 'function': {'arguments': '{"relative_path":"test/runtime/samples/ondestroy-before-cleanup/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 4003, 'total_tokens': 4039, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--68b5445e-190d-447a-a3f2-78db118d43df-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/ondestroy-before-cleanup/_config.js'}, 'id': 'call_059byXJsbDVJh4tShRIh0aeU', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4003, 'output_tokens': 36, 'total_tokens': 4039, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:28,073 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_sYSFrttM9d2PSViZo5LwAYO7', 'function': {'arguments': '{"relative_path":"test/runtime/samples/ondestroy-before-cleanup/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 35, 'prompt_tokens': 4207, 'total_tokens': 4242, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3968}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8338204b-f6cf-409c-ac87-866cb4f87288-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/ondestroy-before-cleanup/main.html'}, 'id': 'call_sYSFrttM9d2PSViZo5LwAYO7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4207, 'output_tokens': 35, 'total_tokens': 4242, 'input_token_details': {'audio': 0, 'cache_read': 3968}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:29,332 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Yhi6nuDUdSft4IT6nc7bACmm', 'function': {'arguments': '{"relative_path":"test/runtime/samples/set-in-oncreate/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 4464, 'total_tokens': 4498, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a1510ea3-2173-4a70-b271-67eda60d1f8b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/set-in-oncreate/_config.js'}, 'id': 'call_Yhi6nuDUdSft4IT6nc7bACmm', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4464, 'output_tokens': 34, 'total_tokens': 4498, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:30,531 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_09KMBpvqWUnO97NyogLWMk9A', 'function': {'arguments': '{"relative_path":"test/runtime/samples/set-in-oncreate/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 4619, 'total_tokens': 4652, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3584}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--72dd1292-d74f-44ba-951a-556496f36ab3-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/set-in-oncreate/main.html'}, 'id': 'call_09KMBpvqWUnO97NyogLWMk9A', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4619, 'output_tokens': 33, 'total_tokens': 4652, 'input_token_details': {'audio': 0, 'cache_read': 3584}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:31,606 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_IlsMykbBIKlRa7IFZr8zG3CI', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/expected.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 4834, 'total_tokens': 4871, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4224}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b1b1e42a-2390-49ce-a69d-7bd524b6375e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected.js'}, 'id': 'call_IlsMykbBIKlRa7IFZr8zG3CI', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4834, 'output_tokens': 37, 'total_tokens': 4871, 'input_token_details': {'audio': 0, 'cache_read': 4224}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:32,602 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Qqhhq7yhorCB29VG52CcLLAy', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/expected-bundle.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 5372, 'total_tokens': 5411, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2816}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b578f81e-338f-4a25-bf61-49919aa05a5e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected-bundle.js'}, 'id': 'call_Qqhhq7yhorCB29VG52CcLLAy', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5372, 'output_tokens': 39, 'total_tokens': 5411, 'input_token_details': {'audio': 0, 'cache_read': 2816}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:33,710 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_YdxppRG7eI5Z30amPL9b7yAQ', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/input.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 7615, 'total_tokens': 7651, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5376}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e498e24d-7007-4411-9973-cc2db7d660b2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/input.html'}, 'id': 'call_YdxppRG7eI5Z30amPL9b7yAQ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7615, 'output_tokens': 36, 'total_tokens': 7651, 'input_token_details': {'audio': 0, 'cache_read': 5376}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:35,609 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_SNuat5DOhdVpTZLvQ679XMn9', 'function': {'arguments': '{"relative_path":"test/js/samples/ssr-no-oncreate-etc/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 7791, 'total_tokens': 7829, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--30b5045c-58d3-4f63-9e18-5b6145372e52-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/_config.js'}, 'id': 'call_SNuat5DOhdVpTZLvQ679XMn9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7791, 'output_tokens': 38, 'total_tokens': 7829, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:36,905 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JJyqnxxA6fXnivi5hAkKve7l', 'function': {'arguments': '{"relative_path":"test/js/samples/ssr-no-oncreate-etc/expected.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 7944, 'total_tokens': 7982, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4608}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--fb40d842-d158-40a2-9b9b-2391572bbaac-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/expected.js'}, 'id': 'call_JJyqnxxA6fXnivi5hAkKve7l', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7944, 'output_tokens': 38, 'total_tokens': 7982, 'input_token_details': {'audio': 0, 'cache_read': 4608}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:38,045 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_YC69fsJHSV4g3bRS0lx98gA3', 'function': {'arguments': '{"relative_path":"test/js/samples/ssr-no-oncreate-etc/expected-bundle.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 40, 'prompt_tokens': 8393, 'total_tokens': 8433, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f7007125-dec9-4860-8953-53d64f8335a6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/expected-bundle.js'}, 'id': 'call_YC69fsJHSV4g3bRS0lx98gA3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8393, 'output_tokens': 40, 'total_tokens': 8433, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:39,110 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fiWyMbQurPjKOTApOIbwYGni', 'function': {'arguments': '{"relative_path":"test/js/samples/ssr-no-oncreate-etc/input.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 8702, 'total_tokens': 8739, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 7552}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1d91c76d-7f6e-4bce-a5ee-586e7c785e6b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/input.html'}, 'id': 'call_fiWyMbQurPjKOTApOIbwYGni', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8702, 'output_tokens': 37, 'total_tokens': 8739, 'input_token_details': {'audio': 0, 'cache_read': 7552}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:24:50,648 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I retrieved the full contents with line numbers for all eight test sample groups you listed, covering each runtime _config.js and main.html, and each js expected.js, expected-bundle.js, and input.html. The files include all imports and test callbacks (including lifecycle hooks and set/destroy assertions) as requested. This should give you complete, self-contained cases to analyze how async oncreate affects behavior. If you need the referenced component files (e.g., Widget.html, Top.html) to run the runtime samples, I can fetch those too.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1016, 'prompt_tokens': 9018, 'total_tokens': 10034, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 896, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--5fa7adec-ac75-44dc-9456-83991c9177c6-0' usage_metadata={'input_tokens': 9018, 'output_tokens': 1016, 'total_tokens': 10034, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 896}}
2025-11-11 00:24:50,650 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents (with line numbers) of these test sample files: 1) test/runtime/samples/bindings-before-oncreate/_config.js and main.html, 2) test/runtime/samples/lifecycle-events/_config.js and main.html, 3) test/runtime/samples/onrender-fires-when-ready/_config.js and main.html, 4) test/runtime/samples/onrender-fires-when-ready-nested/_config.js and main.html, 5) test/runtime/samples/ondestroy-before-cleanup/_config.js and main.html, 6) test/runtime/samples/set-in-oncreate/_config.js and main.html, 7) test/js/samples/onrender-onteardown-rewritten/expected.js, expected-bundle.js, and input.html, 8) test/js/samples/ssr-no-oncreate-etc/_config.js, expected.js, expected-bundle.js, and input.html.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending all files is too large, include at minimum each _config.js and main.html (runtime) and expected.js, expected-bundle.js, input.html (js), with all import statements and test callbacks, plus exact line numbers.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
I need these to extract 8 complete, self-contained test cases covering lifecycle hooks where async oncreate could affect behavior.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: test/js/samples/onrender-onteardown-rewritten/expected-bundle.js
Line number range: 1 - 214
Content:
1. function noop() {}
2. 
3. function assign(target) {
4. 	var k,
5. 		source,
6. 		i = 1,
7. 		len = arguments.length;
8. 	for (; i < len; i++) {
9. 		source = arguments[i];
10. 		for (k in source) target[k] = source[k];
11. 	}
12. 
13. 	return target;
14. }
15. 
16. function blankObject() {
17. 	return Object.create(null);
18. }
19. 
20. function destroy(detach) {
21. 	this.destroy = noop;
22. 	this.fire('destroy');
23. 	this.set = this.get = noop;
24. 
25. 	if (detach !== false) this._fragment.u();
26. 	this._fragment.d();
27. 	this._fragment = this._state = null;
28. }
29. 
30. function differs(a, b) {
31. 	return a !== b || ((a && typeof a === 'object') || typeof a === 'function');
32. }
33. 
34. function dispatchObservers(component, group, changed, newState, oldState) {
35. 	for (var key in group) {
36. 		if (!changed[key]) continue;
37. 
38. 		var newValue = newState[key];
39. 		var oldValue = oldState[key];
40. 
41. 		var callbacks = group[key];
42. 		if (!callbacks) continue;
43. 
44. 		for (var i = 0; i < callbacks.length; i += 1) {
45. 			var callback = callbacks[i];
46. 			if (callback.__calling) continue;
47. 
48. 			callback.__calling = true;
49. 			callback.call(component, newValue, oldValue);
50. 			callback.__calling = false;
51. 		}
52. 	}
53. }
54. 
55. function fire(eventName, data) {
56. 	var handlers =
57. 		eventName in this._handlers && this._handlers[eventName].slice();
58. 	if (!handlers) return;
59. 
60. 	for (var i = 0; i < handlers.length; i += 1) {
61. 		handlers[i].call(this, data);
62. 	}
63. }
64. 
65. function get(key) {
66. 	return key ? this._state[key] : this._state;
67. }
68. 
69. function init(component, options) {
70. 	component.options = options;
71. 
72. 	component._observers = { pre: blankObject(), post: blankObject() };
73. 	component._handlers = blankObject();
74. 	component._root = options._root || component;
75. 	component._yield = options._yield;
76. 	component._bind = options._bind;
77. }
78. 
79. function observe(key, callback, options) {
80. 	var group = options && options.defer
81. 		? this._observers.post
82. 		: this._observers.pre;
83. 
84. 	(group[key] || (group[key] = [])).push(callback);
85. 
86. 	if (!options || options.init !== false) {
87. 		callback.__calling = true;
88. 		callback.call(this, this._state[key]);
89. 		callback.__calling = false;
90. 	}
91. 
92. 	return {
93. 		cancel: function() {
94. 			var index = group[key].indexOf(callback);
95. 			if (~index) group[key].splice(index, 1);
96. 		}
97. 	};
98. }
99. 
100. function on(eventName, handler) {
101. 	if (eventName === 'teardown') return this.on('destroy', handler);
102. 
103. 	var handlers = this._handlers[eventName] || (this._handlers[eventName] = []);
104. 	handlers.push(handler);
105. 
106. 	return {
107. 		cancel: function() {
108. 			var index = handlers.indexOf(handler);
109. 			if (~index) handlers.splice(index, 1);
110. 		}
111. 	};
112. }
113. 
114. function set(newState) {
115. 	this._set(assign({}, newState));
116. 	if (this._root._lock) return;
117. 	this._root._lock = true;
118. 	callAll(this._root._beforecreate);
119. 	callAll(this._root._oncreate);
120. 	callAll(this._root._aftercreate);
121. 	this._root._lock = false;
122. }
123. 
124. function _set(newState) {
125. 	var oldState = this._state,
126. 		changed = {},
127. 		dirty = false;
128. 
129. 	for (var key in newState) {
130. 		if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
131. 	}
132. 	if (!dirty) return;
133. 
134. 	this._state = assign({}, oldState, newState);
135. 	this._recompute(changed, this._state);
136. 	if (this._bind) this._bind(changed, this._state);
137. 	dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
138. 	this._fragment.p(changed, this._state);
139. 	dispatchObservers(this, this._observers.post, changed, this._state, oldState);
140. }
141. 
142. function callAll(fns) {
143. 	while (fns && fns.length) fns.pop()();
144. }
145. 
146. function _mount(target, anchor) {
147. 	this._fragment.m(target, anchor);
148. }
149. 
150. function _unmount() {
151. 	this._fragment.u();
152. }
153. 
154. var proto = {
155. 	destroy: destroy,
156. 	get: get,
157. 	fire: fire,
158. 	observe: observe,
159. 	on: on,
160. 	set: set,
161. 	teardown: destroy,
162. 	_recompute: noop,
163. 	_set: _set,
164. 	_mount: _mount,
165. 	_unmount: _unmount
166. };
167. 
168. /* generated by Svelte vX.Y.Z */
169. function oncreate() {}
170. 
171. function ondestroy() {}
172. 
173. function create_main_fragment(state, component) {
174. 
175. 	return {
176. 		c: noop,
177. 
178. 		m: noop,
179. 
180. 		p: noop,
181. 
182. 		u: noop,
183. 
184. 		d: noop
185. 	};
186. }
187. 
188. function SvelteComponent(options) {
189. 	init(this, options);
190. 	this._state = assign({}, options.data);
191. 
192. 	this._handlers.destroy = [ondestroy];
193. 
194. 	var _oncreate = oncreate.bind(this);
195. 
196. 	if (!options._root) {
197. 		this._oncreate = [_oncreate];
198. 	} else {
199. 	 	this._root._oncreate.push(_oncreate);
200. 	 }
201. 
202. 	this._fragment = create_main_fragment(this._state, this);
203. 
204. 	if (options.target) {
205. 		this._fragment.c();
206. 		this._fragment.m(options.target, options.anchor || null);
207. 
208. 		callAll(this._oncreate);
209. 	}
210. }
211. 
212. assign(SvelteComponent.prototype, proto);
213. 
214. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/expected.js
Line number range: 1 - 48
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";
3. 
4. function oncreate() {};
5. 
6. function ondestroy() {};
7. 
8. function create_main_fragment(state, component) {
9. 
10. 	return {
11. 		c: noop,
12. 
13. 		m: noop,
14. 
15. 		p: noop,
16. 
17. 		u: noop,
18. 
19. 		d: noop
20. 	};
21. }
22. 
23. function SvelteComponent(options) {
24. 	init(this, options);
25. 	this._state = assign({}, options.data);
26. 
27. 	this._handlers.destroy = [ondestroy]
28. 
29. 	var _oncreate = oncreate.bind(this);
30. 
31. 	if (!options._root) {
32. 		this._oncreate = [_oncreate];
33. 	} else {
34. 	 	this._root._oncreate.push(_oncreate);
35. 	 }
36. 
37. 	this._fragment = create_main_fragment(this._state, this);
38. 
39. 	if (options.target) {
40. 		this._fragment.c();
41. 		this._fragment.m(options.target, options.anchor || null);
42. 
43. 		callAll(this._oncreate);
44. 	}
45. }
46. 
47. assign(SvelteComponent.prototype, proto);
48. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/input.html
Line number range: 1 - 7
Content:
1. <script>
2. 	export default {
3. 		// this test should be removed in v2
4. 		onrender () {},
5. 		onteardown () {}
6. 	};
7. </script>


File: test/js/samples/ssr-no-oncreate-etc/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	options: {
3. 		generate: 'ssr'
4. 	}
5. };


File: test/js/samples/ssr-no-oncreate-etc/expected-bundle.js
Line number range: 1 - 23
Content:
1. var SvelteComponent = {};
2. 
3. SvelteComponent.data = function() {
4. 	return {};
5. };
6. 
7. SvelteComponent.render = function(state, options) {
8. 	state = state || {};
9. 
10. 	return ``.trim();
11. };
12. 
13. SvelteComponent.renderCss = function() {
14. 	var components = [];
15. 
16. 	return {
17. 		css: components.map(x => x.css).join('\n'),
18. 		map: null,
19. 		components
20. 	};
21. };
22. 
23. module.exports = SvelteComponent;


File: test/js/samples/ssr-no-oncreate-etc/expected.js
Line number range: 1 - 37
Content:
1. "use strict";
2. 
3. var SvelteComponent = {};;
4. 
5. SvelteComponent.data = function() {
6. 	return {};
7. };
8. 
9. SvelteComponent.render = function(state, options) {
10. 	state = state || {};
11. 
12. 	return ``.trim();
13. };
14. 
15. SvelteComponent.renderCss = function() {
16. 	var components = [];
17. 
18. 	return {
19. 		css: components.map(x => x.css).join('\n'),
20. 		map: null,
21. 		components
22. 	};
23. };
24. 
25. var escaped = {
26. 	'"': '&quot;',
27. 	"'": '&#39;',
28. 	'&': '&amp;',
29. 	'<': '&lt;',
30. 	'>': '&gt;'
31. };
32. 
33. function __escape(html) {
34. 	return String(html).replace(/["'&<>]/g, match => escaped[match]);
35. }
36. 
37. module.exports = SvelteComponent;


File: test/js/samples/ssr-no-oncreate-etc/input.html
Line number range: 1 - 23
Content:
1. <script>
2. 	export default {
3. 		oncreate() {
4. 			console.log('oncreate');
5. 		},
6. 
7. 		ondestroy() {
8. 			console.log('ondestroy');
9. 		},
10. 
11. 		methods: {
12. 			foo() {
13. 				console.log('foo');
14. 			}
15. 		},
16. 
17. 		events: {
18. 			swipe(node, callback) {
19. 				// TODO implement
20. 			}
21. 		}
22. 	};
23. </script>


File: test/runtime/samples/bindings-before-oncreate/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	test(assert, component) {
3. 		assert.equal(component.refs.one.snapshot, 2);
4. 	}
5. };


File: test/runtime/samples/bindings-before-oncreate/main.html
Line number range: 1 - 9
Content:
1. <One ref:one/>
2. 
3. <script>
4. 	import One from './One.html';
5. 
6. 	export default {
7. 		components: { One }
8. 	};
9. </script>


File: test/runtime/samples/lifecycle-events/_config.js
Line number range: 1 - 7
Content:
1. export default {
2. 	test(assert, component) {
3. 		assert.deepEqual(component.events, ['create']);
4. 		component.destroy();
5. 		assert.deepEqual(component.events, ['create', 'destroy']);
6. 	}
7. };


File: test/runtime/samples/lifecycle-events/main.html
Line number range: 1 - 13
Content:
1. <div></div>
2. 
3. <script>
4. 	export default {
5. 		oncreate() {
6. 			this.events = ['create'];
7. 		},
8. 
9. 		ondestroy() {
10. 			this.events.push('destroy');
11. 		}
12. 	};
13. </script>


File: test/runtime/samples/ondestroy-before-cleanup/_config.js
Line number range: 1 - 9
Content:
1. export default {
2. 	test(assert, component, target) {
3. 		const top = component.refs.top;
4. 		const div = target.querySelector('div');
5. 
6. 		component.set({ visible: false });
7. 		assert.equal(top.refOnDestroy, div);
8. 	}
9. };


File: test/runtime/samples/ondestroy-before-cleanup/main.html
Line number range: 1 - 18
Content:
1. {{#if visible}}
2. 	<Top ref:top></Top>
3. {{/if}}
4. 
5. <script>
6. 	import Top from './Top.html';
7. 	
8. 	export default {
9. 		data() {
10. 			return {
11. 				visible: true
12. 			};
13. 		},
14. 		components: {
15. 			Top
16. 		}
17. 	};
18. </script>


File: test/runtime/samples/onrender-fires-when-ready-nested/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: `<div><p>true</p>\n<p>true</p></div>`
5. };


File: test/runtime/samples/onrender-fires-when-ready-nested/main.html
Line number range: 1 - 16
Content:
1. <div>
2. 	<Widget/>
3. 	<ParentWidget />
4. </div>
5. 
6. <script>
7. 	import Widget from './Widget.html';
8. 	import ParentWidget from './ParentWidget.html';
9. 
10. 	export default {
11. 		components: {
12. 			Widget,
13. 			ParentWidget
14. 		}
15. 	};
16. </script>


File: test/runtime/samples/onrender-fires-when-ready/_config.js
Line number range: 1 - 12
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: `<div><p>true</p></div>`,
5. 
6. 	test ( assert, component, target ) {
7. 		component.set({ foo: true });
8. 		assert.htmlEqual( target.innerHTML, `<div><p>true</p>\n<p>true</p></div>` );
9. 
10. 		component.destroy();
11. 	}
12. };


File: test/runtime/samples/onrender-fires-when-ready/main.html
Line number range: 1 - 17
Content:
1. <div>
2. 	<Widget/>
3. 
4. 	{{#if foo}}
5. 		<Widget/>
6. 	{{/if}}
7. </div>
8. 
9. <script>
10. 	import Widget from './Widget.html';
11. 
12. 	export default {
13. 		components: {
14. 			Widget
15. 		}
16. 	};
17. </script>


File: test/runtime/samples/set-in-oncreate/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: '<p>2</p>'
5. };


File: test/runtime/samples/set-in-oncreate/main.html
Line number range: 1 - 13
Content:
1. <p>{{foo}}</p>
2. 
3. <script>
4. 	export default {
5. 		data: () => ({
6. 			foo: 1
7. 		}),
8. 
9. 		oncreate () {
10. 			this.set({ foo: 2 });
11. 		}
12. 	};
13. </script>

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-11 00:25:11,018 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='Query asks for the full contents of bindings-before-oncreate/_config.js. Providing the entire file (lines 1-5) satisfies the requirement and includes the test callback referenced in the query.', relative_path='test/runtime/samples/bindings-before-oncreate/_config.js', start_line=1, end_line=5), ContextOutput(reasoning='Query asks for the full contents of bindings-before-oncreate/main.html. The entire file (lines 1-9) includes imports and component setup, required by the query.', relative_path='test/runtime/samples/bindings-before-oncreate/main.html', start_line=1, end_line=9), ContextOutput(reasoning='Query requests lifecycle-events/_config.js full contents. Including the whole file (lines 1-7) covers the test callbacks needed.', relative_path='test/runtime/samples/lifecycle-events/_config.js', start_line=1, end_line=7), ContextOutput(reasoning='Query requests lifecycle-events/main.html full contents. Including lines 1-13 provides the oncreate/ondestroy hooks necessary to understand the lifecycle test.', relative_path='test/runtime/samples/lifecycle-events/main.html', start_line=1, end_line=13), ContextOutput(reasoning='Query asks for onrender-fires-when-ready/_config.js full contents. Including the entire file (lines 1-12) covers SSR skip, expected HTML, and test steps.', relative_path='test/runtime/samples/onrender-fires-when-ready/_config.js', start_line=1, end_line=12), ContextOutput(reasoning='Query asks for onrender-fires-when-ready/main.html full contents. Including lines 1-17 provides the component structure and import statements.', relative_path='test/runtime/samples/onrender-fires-when-ready/main.html', start_line=1, end_line=17), ContextOutput(reasoning='Query asks for onrender-fires-when-ready-nested/_config.js full contents. Including lines 1-5 covers SSR skip and expected HTML.', relative_path='test/runtime/samples/onrender-fires-when-ready-nested/_config.js', start_line=1, end_line=5), ContextOutput(reasoning='Query asks for onrender-fires-when-ready-nested/main.html full contents. Including lines 1-16 provides component usage and imports.', relative_path='test/runtime/samples/onrender-fires-when-ready-nested/main.html', start_line=1, end_line=16), ContextOutput(reasoning='Query asks for ondestroy-before-cleanup/_config.js full contents. Including lines 1-9 covers the test asserting ondestroy runs before DOM cleanup.', relative_path='test/runtime/samples/ondestroy-before-cleanup/_config.js', start_line=1, end_line=9), ContextOutput(reasoning='Query asks for ondestroy-before-cleanup/main.html full contents. Including lines 1-18 provides the conditional rendering and component import.', relative_path='test/runtime/samples/ondestroy-before-cleanup/main.html', start_line=1, end_line=18), ContextOutput(reasoning='Query asks for set-in-oncreate/_config.js full contents. Including lines 1-5 covers SSR skip and expected HTML.', relative_path='test/runtime/samples/set-in-oncreate/_config.js', start_line=1, end_line=5), ContextOutput(reasoning='Query asks for set-in-oncreate/main.html full contents. Including lines 1-13 provides initial data and oncreate hook setting state.', relative_path='test/runtime/samples/set-in-oncreate/main.html', start_line=1, end_line=13), ContextOutput(reasoning='Query asks for onrender-onteardown-rewritten expected.js full contents. Including lines 1-48 satisfies the requirement and shows imports and lifecycle rewrites.', relative_path='test/js/samples/onrender-onteardown-rewritten/expected.js', start_line=1, end_line=48), ContextOutput(reasoning='Query asks for onrender-onteardown-rewritten expected-bundle.js full contents. Including lines 1-214 provides the full bundled output relevant to lifecycle behavior.', relative_path='test/js/samples/onrender-onteardown-rewritten/expected-bundle.js', start_line=1, end_line=214), ContextOutput(reasoning='Query asks for onrender-onteardown-rewritten input.html full contents. Including lines 1-7 shows the original lifecycle hooks prior to rewrite.', relative_path='test/js/samples/onrender-onteardown-rewritten/input.html', start_line=1, end_line=7), ContextOutput(reasoning='Query asks for ssr-no-oncreate-etc/_config.js full contents. Including lines 1-5 shows SSR generation configuration.', relative_path='test/js/samples/ssr-no-oncreate-etc/_config.js', start_line=1, end_line=5), ContextOutput(reasoning='Query asks for ssr-no-oncreate-etc expected.js full contents. Including lines 1-37 shows the SSR output without lifecycle hooks.', relative_path='test/js/samples/ssr-no-oncreate-etc/expected.js', start_line=1, end_line=37), ContextOutput(reasoning='Query asks for ssr-no-oncreate-etc expected-bundle.js full contents. Including lines 1-23 provides the bundled SSR output.', relative_path='test/js/samples/ssr-no-oncreate-etc/expected-bundle.js', start_line=1, end_line=23), ContextOutput(reasoning='Query asks for ssr-no-oncreate-etc input.html full contents. Including lines 1-23 shows component definition with oncreate/ondestroy/methods/events, relevant to SSR removal behavior.', relative_path='test/js/samples/ssr-no-oncreate-etc/input.html', start_line=1, end_line=23)]
2025-11-11 00:25:11,024 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 19 contexts to memory for query: Please provide the full contents (with line numbers) of these test sample files: 1) test/runtime/samples/bindings-before-oncreate/_config.js and main.html, 2) test/runtime/samples/lifecycle-events/_config.js and main.html, 3) test/runtime/samples/onrender-fires-when-ready/_config.js and main.html, 4) test/runtime/samples/onrender-fires-when-ready-nested/_config.js and main.html, 5) test/runtime/samples/ondestroy-before-cleanup/_config.js and main.html, 6) test/runtime/samples/set-in-oncreate/_config.js and main.html, 7) test/js/samples/onrender-onteardown-rewritten/expected.js, expected-bundle.js, and input.html, 8) test/js/samples/ssr-no-oncreate-etc/_config.js, expected.js, expected-bundle.js, and input.html.
2025-11-11 00:25:11,429 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-11 00:25:11,430 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 19 new contexts to 5 existing contexts
2025-11-11 00:25:11,431 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 24 total contexts (removed 0 duplicates)
2025-11-11 00:25:11,433 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of test/js/index.js, test/runtime/index.js, test/helpers.js, test/setup.js, and test/test.js.
Extra Requirements: If sending full files is too large, include at minimum the test case definitions for lifecycle hooks (oncreate/onrender/ondestroy) and how samples are loaded, with exact line numbers.
Purpose: I need these files to extract 8 relevant test cases with precise imports, setup, assertions, and line numbers.

Previous refined query 2:
Essential Query: Please provide the full contents (with line numbers) of these test sample files: 1) test/runtime/samples/bindings-before-oncreate/_config.js and main.html, 2) test/runtime/samples/lifecycle-events/_config.js and main.html, 3) test/runtime/samples/onrender-fires-when-ready/_config.js and main.html, 4) test/runtime/samples/onrender-fires-when-ready-nested/_config.js and main.html, 5) test/runtime/samples/ondestroy-before-cleanup/_config.js and main.html, 6) test/runtime/samples/set-in-oncreate/_config.js and main.html, 7) test/js/samples/onrender-onteardown-rewritten/expected.js, expected-bundle.js, and input.html, 8) test/js/samples/ssr-no-oncreate-etc/_config.js, expected.js, expected-bundle.js, and input.html.
Extra Requirements: If sending all files is too large, include at minimum each _config.js and main.html (runtime) and expected.js, expected-bundle.js, input.html (js), with all import statements and test callbacks, plus exact line numbers.
Purpose: I need these to extract 8 complete, self-contained test cases covering lifecycle hooks where async oncreate could affect behavior.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: test/helpers.js
Line number range: 1 - 239
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	if (test) global.__svelte_test = true;
12. 
13. 	const resolved = process.env.COVERAGE
14. 		? require.resolve('../src/index.js')
15. 		: require.resolve('../compiler/svelte.js');
16. 
17. 	delete require.cache[resolved];
18. 	return require(resolved);
19. }
20. 
21. export const svelte = loadSvelte();
22. 
23. export function exists(path) {
24. 	try {
25. 		fs.statSync(path);
26. 		return true;
27. 	} catch (err) {
28. 		return false;
29. 	}
30. }
31. 
32. export function tryToLoadJson(file) {
33. 	try {
34. 		return JSON.parse(fs.readFileSync(file));
35. 	} catch (err) {
36. 		if (err.code !== 'ENOENT') throw err;
37. 		return null;
38. 	}
39. }
40. 
41. export function tryToReadFile(file) {
42. 	try {
43. 		return fs.readFileSync(file, 'utf-8');
44. 	} catch (err) {
45. 		if (err.code !== 'ENOENT') throw err;
46. 		return null;
47. 	}
48. }
49. 
50. const { window } = new JSDOM('<main></main>');
51. global.document = window.document;
52. 
53. export function env() {
54. 	window._svelteTransitionManager = null;
55. 	window.document.body.innerHTML = '<main></main>';
56. 
57. 	return window;
58. }
59. 
60. function cleanChildren(node) {
61. 	let previous = null;
62. 
63. 	// sort attributes
64. 	const attributes = Array.from(node.attributes).sort((a, b) => {
65. 		return a.name < b.name ? -1 : 1;
66. 	});
67. 
68. 	attributes.forEach(attr => {
69. 		node.removeAttribute(attr.name);
70. 	});
71. 
72. 	attributes.forEach(attr => {
73. 		node.setAttribute(attr.name, attr.value);
74. 	});
75. 
76. 	// recurse
77. 	[...node.childNodes].forEach(child => {
78. 		if (child.nodeType === 3) {
79. 			// text
80. 			if (
81. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
82. 				node.tagName !== 'text' &&
83. 				node.tagName !== 'tspan'
84. 			) {
85. 				node.removeChild(child);
86. 			}
87. 
88. 			child.data = child.data.replace(/\s{2,}/g, '\n');
89. 
90. 			if (previous && previous.nodeType === 3) {
91. 				previous.data += child.data;
92. 				previous.data = previous.data.replace(/\s{2,}/g, '\n');
93. 
94. 				node.removeChild(child);
95. 				child = previous;
96. 			}
97. 		} else {
98. 			cleanChildren(child);
99. 		}
100. 
101. 		previous = child;
102. 	});
103. 
104. 	// collapse whitespace
105. 	if (node.firstChild && node.firstChild.nodeType === 3) {
106. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
107. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
108. 	}
109. 
110. 	if (node.lastChild && node.lastChild.nodeType === 3) {
111. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
112. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
113. 	}
114. }
115. 
116. export function normalizeHtml(window, html) {
117. 	try {
118. 		const node = window.document.createElement('div');
119. 		node.innerHTML = html
120. 			.replace(/<!--.*?-->/g, '')
121. 			.replace(/>[\s\r\n]+</g, '><')
122. 			.trim();
123. 		cleanChildren(node, '');
124. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
125. 	} catch (err) {
126. 		throw new Error(`Failed to normalize HTML:\n${html}`);
127. 	}
128. }
129. 
130. export function setupHtmlEqual() {
131. 	const window = env();
132. 
133. 	assert.htmlEqual = (actual, expected, message) => {
134. 		assert.deepEqual(
135. 			normalizeHtml(window, actual),
136. 			normalizeHtml(window, expected),
137. 			message
138. 		);
139. 	};
140. }
141. 
142. export function loadConfig(file) {
143. 	try {
144. 		const resolved = require.resolve(file);
145. 		delete require.cache[resolved];
146. 
147. 		const config = require(resolved);
148. 		return config.default || config;
149. 	} catch (err) {
150. 		if (err.code === 'MODULE_NOT_FOUND') {
151. 			return {};
152. 		}
153. 
154. 		throw err;
155. 	}
156. }
157. 
158. export function addLineNumbers(code) {
159. 	return code
160. 		.split('\n')
161. 		.map((line, i) => {
162. 			i = String(i + 1);
163. 			while (i.length < 3) i = ` ${i}`;
164. 
165. 			return (
166. 				chalk.grey(`  ${i}: `) +
167. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
168. 			);
169. 		})
170. 		.join('\n');
171. }
172. 
173. function capitalise(str) {
174. 	return str[0].toUpperCase() + str.slice(1);
175. }
176. 
177. export function showOutput(cwd, options = {}, s = svelte) {
178. 	glob.sync('**/*.html', { cwd }).forEach(file => {
179. 		if (file[0] === '_') return;
180. 		const { code } = s.compile(
181. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
182. 			Object.assign(options, {
183. 				filename: file,
184. 				name: capitalise(path.basename(file).replace(/\.html$/, ''))
185. 			})
186. 		);
187. 
188. 		console.log( // eslint-disable-line no-console
189. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
190. 		);
191. 	});
192. }
193. 
194. const start = /\n(\t+)/;
195. export function deindent(strings, ...values) {
196. 	const indentation = start.exec(strings[0])[1];
197. 	const pattern = new RegExp(`^${indentation}`, 'gm');
198. 
199. 	let result = strings[0].replace(start, '').replace(pattern, '');
200. 
201. 	let trailingIndentation = getTrailingIndentation(result);
202. 
203. 	for (let i = 1; i < strings.length; i += 1) {
204. 		let expression = values[i - 1];
205. 		const string = strings[i].replace(pattern, '');
206. 
207. 		if (Array.isArray(expression)) {
208. 			expression = expression.length ? expression.join('\n') : null;
209. 		}
210. 
211. 		if (expression || expression === '') {
212. 			const value = String(expression).replace(
213. 				/\n/g,
214. 				`\n${trailingIndentation}`
215. 			);
216. 			result += value + string;
217. 		} else {
218. 			let c = result.length;
219. 			while (/\s/.test(result[c - 1])) c -= 1;
220. 			result = result.slice(0, c) + string;
221. 		}
222. 
223. 		trailingIndentation = getTrailingIndentation(result);
224. 	}
225. 
226. 	return result.trim().replace(/\t+$/gm, '');
227. }
228. 
229. function getTrailingIndentation(str) {
230. 	let i = str.length;
231. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
232. 	return str.slice(i, str.length);
233. }
234. 
235. export function spaces(i) {
236. 	let result = '';
237. 	while (i--) result += ' ';
238. 	return result;
239. }


File: test/js/index.js
Line number range: 1 - 79
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import { rollup } from "rollup";
5. import { loadConfig, svelte } from "../helpers.js";
6. 
7. describe("js", () => {
8. 	fs.readdirSync("test/js/samples").forEach(dir => {
9. 		if (dir[0] === ".") return;
10. 
11. 		// add .solo to a sample directory name to only run that test
12. 		const solo = /\.solo/.test(dir);
13. 
14. 		if (solo && process.env.CI) {
15. 			throw new Error("Forgot to remove `solo: true` from test");
16. 		}
17. 
18. 		(solo ? it.only : it)(dir, () => {
19. 			dir = path.resolve("test/js/samples", dir);
20. 			const config = loadConfig(`${dir}/_config.js`);
21. 
22. 			const input = fs
23. 				.readFileSync(`${dir}/input.html`, "utf-8")
24. 				.replace(/\s+$/, "");
25. 
26. 			let actual;
27. 
28. 			try {
29. 				const options = Object.assign(config.options || {}, {
30. 					shared: true
31. 				});
32. 
33. 				actual = svelte.compile(input, options).code.replace(/generated by Svelte v\d+\.\d+\.\d+/, 'generated by Svelte vX.Y.Z');
34. 			} catch (err) {
35. 				console.log(err.frame);
36. 				throw err;
37. 			}
38. 
39. 			fs.writeFileSync(`${dir}/_actual.js`, actual);
40. 
41. 			return rollup({
42. 				input: `${dir}/_actual.js`,
43. 				plugins: [
44. 					{
45. 						resolveId(importee, importer) {
46. 							if (!importer) return importee;
47. 							if (importee === "svelte/shared.js")
48. 								return path.resolve("shared.js");
49. 							return null;
50. 						}
51. 					}
52. 				]
53. 			}).then(bundle => {
54. 				return bundle.generate({ format: "es" });
55. 			}).then(({ code }) => {
56. 				fs.writeFileSync(`${dir}/_actual-bundle.js`, code);
57. 
58. 				const expected = fs.readFileSync(`${dir}/expected.js`, "utf-8");
59. 				const expectedBundle = fs.readFileSync(
60. 					`${dir}/expected-bundle.js`,
61. 					"utf-8"
62. 				);
63. 
64. 				assert.equal(
65. 					actual.trim().replace(/^[ \t]+$/gm, ""),
66. 					expected.trim().replace(/^[ \t]+$/gm, "")
67. 				);
68. 
69. 				assert.equal(
70. 					code.trim().replace(/^[ \t]+$/gm, ""),
71. 					expectedBundle.trim().replace(/^[ \t]+$/gm, "")
72. 				);
73. 			}).catch(err => {
74. 				if (err.loc) console.error(err.loc);
75. 				throw err;
76. 			});
77. 		});
78. 	});
79. });


File: test/js/samples/onrender-onteardown-rewritten/expected-bundle.js
Line number range: 1 - 214
Content:
1. function noop() {}
2. 
3. function assign(target) {
4. 	var k,
5. 		source,
6. 		i = 1,
7. 		len = arguments.length;
8. 	for (; i < len; i++) {
9. 		source = arguments[i];
10. 		for (k in source) target[k] = source[k];
11. 	}
12. 
13. 	return target;
14. }
15. 
16. function blankObject() {
17. 	return Object.create(null);
18. }
19. 
20. function destroy(detach) {
21. 	this.destroy = noop;
22. 	this.fire('destroy');
23. 	this.set = this.get = noop;
24. 
25. 	if (detach !== false) this._fragment.u();
26. 	this._fragment.d();
27. 	this._fragment = this._state = null;
28. }
29. 
30. function differs(a, b) {
31. 	return a !== b || ((a && typeof a === 'object') || typeof a === 'function');
32. }
33. 
34. function dispatchObservers(component, group, changed, newState, oldState) {
35. 	for (var key in group) {
36. 		if (!changed[key]) continue;
37. 
38. 		var newValue = newState[key];
39. 		var oldValue = oldState[key];
40. 
41. 		var callbacks = group[key];
42. 		if (!callbacks) continue;
43. 
44. 		for (var i = 0; i < callbacks.length; i += 1) {
45. 			var callback = callbacks[i];
46. 			if (callback.__calling) continue;
47. 
48. 			callback.__calling = true;
49. 			callback.call(component, newValue, oldValue);
50. 			callback.__calling = false;
51. 		}
52. 	}
53. }
54. 
55. function fire(eventName, data) {
56. 	var handlers =
57. 		eventName in this._handlers && this._handlers[eventName].slice();
58. 	if (!handlers) return;
59. 
60. 	for (var i = 0; i < handlers.length; i += 1) {
61. 		handlers[i].call(this, data);
62. 	}
63. }
64. 
65. function get(key) {
66. 	return key ? this._state[key] : this._state;
67. }
68. 
69. function init(component, options) {
70. 	component.options = options;
71. 
72. 	component._observers = { pre: blankObject(), post: blankObject() };
73. 	component._handlers = blankObject();
74. 	component._root = options._root || component;
75. 	component._yield = options._yield;
76. 	component._bind = options._bind;
77. }
78. 
79. function observe(key, callback, options) {
80. 	var group = options && options.defer
81. 		? this._observers.post
82. 		: this._observers.pre;
83. 
84. 	(group[key] || (group[key] = [])).push(callback);
85. 
86. 	if (!options || options.init !== false) {
87. 		callback.__calling = true;
88. 		callback.call(this, this._state[key]);
89. 		callback.__calling = false;
90. 	}
91. 
92. 	return {
93. 		cancel: function() {
94. 			var index = group[key].indexOf(callback);
95. 			if (~index) group[key].splice(index, 1);
96. 		}
97. 	};
98. }
99. 
100. function on(eventName, handler) {
101. 	if (eventName === 'teardown') return this.on('destroy', handler);
102. 
103. 	var handlers = this._handlers[eventName] || (this._handlers[eventName] = []);
104. 	handlers.push(handler);
105. 
106. 	return {
107. 		cancel: function() {
108. 			var index = handlers.indexOf(handler);
109. 			if (~index) handlers.splice(index, 1);
110. 		}
111. 	};
112. }
113. 
114. function set(newState) {
115. 	this._set(assign({}, newState));
116. 	if (this._root._lock) return;
117. 	this._root._lock = true;
118. 	callAll(this._root._beforecreate);
119. 	callAll(this._root._oncreate);
120. 	callAll(this._root._aftercreate);
121. 	this._root._lock = false;
122. }
123. 
124. function _set(newState) {
125. 	var oldState = this._state,
126. 		changed = {},
127. 		dirty = false;
128. 
129. 	for (var key in newState) {
130. 		if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
131. 	}
132. 	if (!dirty) return;
133. 
134. 	this._state = assign({}, oldState, newState);
135. 	this._recompute(changed, this._state);
136. 	if (this._bind) this._bind(changed, this._state);
137. 	dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
138. 	this._fragment.p(changed, this._state);
139. 	dispatchObservers(this, this._observers.post, changed, this._state, oldState);
140. }
141. 
142. function callAll(fns) {
143. 	while (fns && fns.length) fns.pop()();
144. }
145. 
146. function _mount(target, anchor) {
147. 	this._fragment.m(target, anchor);
148. }
149. 
150. function _unmount() {
151. 	this._fragment.u();
152. }
153. 
154. var proto = {
155. 	destroy: destroy,
156. 	get: get,
157. 	fire: fire,
158. 	observe: observe,
159. 	on: on,
160. 	set: set,
161. 	teardown: destroy,
162. 	_recompute: noop,
163. 	_set: _set,
164. 	_mount: _mount,
165. 	_unmount: _unmount
166. };
167. 
168. /* generated by Svelte vX.Y.Z */
169. function oncreate() {}
170. 
171. function ondestroy() {}
172. 
173. function create_main_fragment(state, component) {
174. 
175. 	return {
176. 		c: noop,
177. 
178. 		m: noop,
179. 
180. 		p: noop,
181. 
182. 		u: noop,
183. 
184. 		d: noop
185. 	};
186. }
187. 
188. function SvelteComponent(options) {
189. 	init(this, options);
190. 	this._state = assign({}, options.data);
191. 
192. 	this._handlers.destroy = [ondestroy];
193. 
194. 	var _oncreate = oncreate.bind(this);
195. 
196. 	if (!options._root) {
197. 		this._oncreate = [_oncreate];
198. 	} else {
199. 	 	this._root._oncreate.push(_oncreate);
200. 	 }
201. 
202. 	this._fragment = create_main_fragment(this._state, this);
203. 
204. 	if (options.target) {
205. 		this._fragment.c();
206. 		this._fragment.m(options.target, options.anchor || null);
207. 
208. 		callAll(this._oncreate);
209. 	}
210. }
211. 
212. assign(SvelteComponent.prototype, proto);
213. 
214. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/expected.js
Line number range: 1 - 48
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";
3. 
4. function oncreate() {};
5. 
6. function ondestroy() {};
7. 
8. function create_main_fragment(state, component) {
9. 
10. 	return {
11. 		c: noop,
12. 
13. 		m: noop,
14. 
15. 		p: noop,
16. 
17. 		u: noop,
18. 
19. 		d: noop
20. 	};
21. }
22. 
23. function SvelteComponent(options) {
24. 	init(this, options);
25. 	this._state = assign({}, options.data);
26. 
27. 	this._handlers.destroy = [ondestroy]
28. 
29. 	var _oncreate = oncreate.bind(this);
30. 
31. 	if (!options._root) {
32. 		this._oncreate = [_oncreate];
33. 	} else {
34. 	 	this._root._oncreate.push(_oncreate);
35. 	 }
36. 
37. 	this._fragment = create_main_fragment(this._state, this);
38. 
39. 	if (options.target) {
40. 		this._fragment.c();
41. 		this._fragment.m(options.target, options.anchor || null);
42. 
43. 		callAll(this._oncreate);
44. 	}
45. }
46. 
47. assign(SvelteComponent.prototype, proto);
48. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/input.html
Line number range: 1 - 7
Content:
1. <script>
2. 	export default {
3. 		// this test should be removed in v2
4. 		onrender () {},
5. 		onteardown () {}
6. 	};
7. </script>


File: test/js/samples/ssr-no-oncreate-etc/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	options: {
3. 		generate: 'ssr'
4. 	}
5. };


File: test/js/samples/ssr-no-oncreate-etc/expected-bundle.js
Line number range: 1 - 23
Content:
1. var SvelteComponent = {};
2. 
3. SvelteComponent.data = function() {
4. 	return {};
5. };
6. 
7. SvelteComponent.render = function(state, options) {
8. 	state = state || {};
9. 
10. 	return ``.trim();
11. };
12. 
13. SvelteComponent.renderCss = function() {
14. 	var components = [];
15. 
16. 	return {
17. 		css: components.map(x => x.css).join('\n'),
18. 		map: null,
19. 		components
20. 	};
21. };
22. 
23. module.exports = SvelteComponent;


File: test/js/samples/ssr-no-oncreate-etc/expected.js
Line number range: 1 - 37
Content:
1. "use strict";
2. 
3. var SvelteComponent = {};;
4. 
5. SvelteComponent.data = function() {
6. 	return {};
7. };
8. 
9. SvelteComponent.render = function(state, options) {
10. 	state = state || {};
11. 
12. 	return ``.trim();
13. };
14. 
15. SvelteComponent.renderCss = function() {
16. 	var components = [];
17. 
18. 	return {
19. 		css: components.map(x => x.css).join('\n'),
20. 		map: null,
21. 		components
22. 	};
23. };
24. 
25. var escaped = {
26. 	'"': '&quot;',
27. 	"'": '&#39;',
28. 	'&': '&amp;',
29. 	'<': '&lt;',
30. 	'>': '&gt;'
31. };
32. 
33. function __escape(html) {
34. 	return String(html).replace(/["'&<>]/g, match => escaped[match]);
35. }
36. 
37. module.exports = SvelteComponent;


File: test/js/samples/ssr-no-oncreate-etc/input.html
Line number range: 1 - 23
Content:
1. <script>
2. 	export default {
3. 		oncreate() {
4. 			console.log('oncreate');
5. 		},
6. 
7. 		ondestroy() {
8. 			console.log('ondestroy');
9. 		},
10. 
11. 		methods: {
12. 			foo() {
13. 				console.log('foo');
14. 			}
15. 		},
16. 
17. 		events: {
18. 			swipe(node, callback) {
19. 				// TODO implement
20. 			}
21. 		}
22. 	};
23. </script>


File: test/runtime/index.js
Line number range: 1 - 241
Content:
1. import assert from "assert";
2. import * as path from "path";
3. import * as fs from "fs";
4. import * as acorn from "acorn";
5. import { transitionManager } from "../../shared.js";
6. 
7. import {
8. 	showOutput,
9. 	loadConfig,
10. 	loadSvelte,
11. 	env,
12. 	setupHtmlEqual,
13. 	spaces
14. } from "../helpers.js";
15. 
16. let svelte;
17. 
18. let compileOptions = null;
19. 
20. function getName(filename) {
21. 	const base = path.basename(filename).replace(".html", "");
22. 	return base[0].toUpperCase() + base.slice(1);
23. }
24. 
25. describe("runtime", () => {
26. 	before(() => {
27. 		svelte = loadSvelte(true);
28. 
29. 		require.extensions[".html"] = function(module, filename) {
30. 			const options = Object.assign(
31. 				{ filename, name: getName(filename), format: 'cjs' },
32. 				compileOptions
33. 			);
34. 
35. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
36. 
37. 			return module._compile(code, filename);
38. 		};
39. 
40. 		return setupHtmlEqual();
41. 	});
42. 
43. 	const failed = new Set();
44. 
45. 	function runTest(dir, shared, hydrate) {
46. 		if (dir[0] === ".") return;
47. 
48. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
49. 
50. 		if (config.solo && process.env.CI) {
51. 			throw new Error("Forgot to remove `solo: true` from test");
52. 		}
53. 
54. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
55. 			if (failed.has(dir)) {
56. 				// this makes debugging easier, by only printing compiled output once
57. 				throw new Error('skipping test, already failed');
58. 			}
59. 
60. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
61. 
62. 			compileOptions = config.compileOptions || {};
63. 			compileOptions.shared = shared;
64. 			compileOptions.hydratable = hydrate;
65. 			compileOptions.dev = config.dev;
66. 
67. 			// check that no ES2015+ syntax slipped in
68. 			if (!config.allowES2015) {
69. 				try {
70. 					const source = fs.readFileSync(
71. 						`test/runtime/samples/${dir}/main.html`,
72. 						"utf-8"
73. 					);
74. 					const { code } = svelte.compile(source, compileOptions);
75. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
76. 					if (startIndex === -1) throw new Error("missing create_main_fragment");
77. 					const endIndex = code.lastIndexOf("export default");
78. 					const es5 =
79. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
80. 						code.slice(startIndex, endIndex);
81. 
82. 					acorn.parse(es5, { ecmaVersion: 5 });
83. 
84. 					if (/Object\.assign/.test(es5)) {
85. 						throw new Error(
86. 							"cannot use Object.assign in generated code, as it is not supported everywhere"
87. 						);
88. 					}
89. 				} catch (err) {
90. 					failed.add(dir);
91. 					showOutput(cwd, { shared }, svelte); // eslint-disable-line no-console
92. 					throw err;
93. 				}
94. 			}
95. 
96. 			Object.keys(require.cache)
97. 				.filter(x => x.endsWith(".html"))
98. 				.forEach(file => {
99. 					delete require.cache[file];
100. 				});
101. 
102. 			let SvelteComponent;
103. 
104. 			let unintendedError = null;
105. 
106. 			const window = env();
107. 
108. 			try {
109. 				// set of hacks to support transition tests
110. 				transitionManager.running = false;
111. 				transitionManager.transitions = [];
112. 
113. 				const raf = {
114. 					time: 0,
115. 					callback: null,
116. 					tick: now => {
117. 						raf.time = now;
118. 						if (raf.callback) raf.callback();
119. 					}
120. 				};
121. 				window.performance = { now: () => raf.time };
122. 				global.requestAnimationFrame = cb => {
123. 					let called = false;
124. 					raf.callback = () => {
125. 						if (!called) {
126. 							called = true;
127. 							cb();
128. 						}
129. 					};
130. 				};
131. 
132. 				global.window = window;
133. 
134. 				try {
135. 					SvelteComponent = require(`./samples/${dir}/main.html`);
136. 				} catch (err) {
137. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
138. 					throw err;
139. 				}
140. 
141. 				global.window = window;
142. 
143. 				// Put the constructor on window for testing
144. 				window.SvelteComponent = SvelteComponent;
145. 
146. 				const target = window.document.querySelector("main");
147. 
148. 				const warnings = [];
149. 				const warn = console.warn;
150. 				console.warn = warning => {
151. 					warnings.push(warning);
152. 				};
153. 
154. 				const options = Object.assign({}, {
155. 					target,
156. 					hydrate,
157. 					data: config.data
158. 				}, config.options || {});
159. 
160. 				const component = new SvelteComponent(options);
161. 
162. 				console.warn = warn;
163. 
164. 				if (config.error) {
165. 					unintendedError = true;
166. 					throw new Error("Expected a runtime error");
167. 				}
168. 
169. 				if (config.warnings) {
170. 					assert.deepEqual(warnings, config.warnings);
171. 				} else if (warnings.length) {
172. 					unintendedError = true;
173. 					throw new Error("Received unexpected warnings");
174. 				}
175. 
176. 				if (config.html) {
177. 					assert.htmlEqual(target.innerHTML, config.html);
178. 				}
179. 
180. 				if (config.test) {
181. 					config.test(assert, component, target, window, raf);
182. 				} else {
183. 					component.destroy();
184. 					assert.equal(target.innerHTML, "");
185. 				}
186. 			} catch (err) {
187. 				if (config.error && !unintendedError) {
188. 					config.error(assert, err);
189. 				} else {
190. 					failed.add(dir);
191. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
192. 					throw err;
193. 				}
194. 			}
195. 
196. 			if (config.show) showOutput(cwd, { shared, hydratable: hydrate }, svelte);
197. 		});
198. 	}
199. 
200. 	const shared = path.resolve("shared.js");
201. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
202. 		runTest(dir, shared, false);
203. 		runTest(dir, shared, true);
204. 		runTest(dir, null, false);
205. 	});
206. 
207. 	it("fails if options.target is missing in dev mode", () => {
208. 		const { code } = svelte.compile(`<div></div>`, {
209. 			format: "iife",
210. 			name: "SvelteComponent",
211. 			dev: true
212. 		});
213. 
214. 		const SvelteComponent = eval(
215. 			`(function () { ${code}; return SvelteComponent; }())`
216. 		);
217. 
218. 		assert.throws(() => {
219. 			new SvelteComponent();
220. 		}, /'target' is a required option/);
221. 	});
222. 
223. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
224. 		const { code } = svelte.compile(`<div></div>`, {
225. 			format: "iife",
226. 			name: "SvelteComponent",
227. 			dev: true
228. 		});
229. 
230. 		const SvelteComponent = eval(
231. 			`(function () { ${code}; return SvelteComponent; }())`
232. 		);
233. 
234. 		assert.throws(() => {
235. 			new SvelteComponent({
236. 				target: {},
237. 				hydrate: true
238. 			});
239. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
240. 	});
241. });


File: test/runtime/samples/bindings-before-oncreate/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	test(assert, component) {
3. 		assert.equal(component.refs.one.snapshot, 2);
4. 	}
5. };


File: test/runtime/samples/bindings-before-oncreate/main.html
Line number range: 1 - 9
Content:
1. <One ref:one/>
2. 
3. <script>
4. 	import One from './One.html';
5. 
6. 	export default {
7. 		components: { One }
8. 	};
9. </script>


File: test/runtime/samples/lifecycle-events/_config.js
Line number range: 1 - 7
Content:
1. export default {
2. 	test(assert, component) {
3. 		assert.deepEqual(component.events, ['create']);
4. 		component.destroy();
5. 		assert.deepEqual(component.events, ['create', 'destroy']);
6. 	}
7. };


File: test/runtime/samples/lifecycle-events/main.html
Line number range: 1 - 13
Content:
1. <div></div>
2. 
3. <script>
4. 	export default {
5. 		oncreate() {
6. 			this.events = ['create'];
7. 		},
8. 
9. 		ondestroy() {
10. 			this.events.push('destroy');
11. 		}
12. 	};
13. </script>


File: test/runtime/samples/ondestroy-before-cleanup/_config.js
Line number range: 1 - 9
Content:
1. export default {
2. 	test(assert, component, target) {
3. 		const top = component.refs.top;
4. 		const div = target.querySelector('div');
5. 
6. 		component.set({ visible: false });
7. 		assert.equal(top.refOnDestroy, div);
8. 	}
9. };


File: test/runtime/samples/ondestroy-before-cleanup/main.html
Line number range: 1 - 18
Content:
1. {{#if visible}}
2. 	<Top ref:top></Top>
3. {{/if}}
4. 
5. <script>
6. 	import Top from './Top.html';
7. 	
8. 	export default {
9. 		data() {
10. 			return {
11. 				visible: true
12. 			};
13. 		},
14. 		components: {
15. 			Top
16. 		}
17. 	};
18. </script>


File: test/runtime/samples/onrender-fires-when-ready-nested/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: `<div><p>true</p>\n<p>true</p></div>`
5. };


File: test/runtime/samples/onrender-fires-when-ready-nested/main.html
Line number range: 1 - 16
Content:
1. <div>
2. 	<Widget/>
3. 	<ParentWidget />
4. </div>
5. 
6. <script>
7. 	import Widget from './Widget.html';
8. 	import ParentWidget from './ParentWidget.html';
9. 
10. 	export default {
11. 		components: {
12. 			Widget,
13. 			ParentWidget
14. 		}
15. 	};
16. </script>


File: test/runtime/samples/onrender-fires-when-ready/_config.js
Line number range: 1 - 12
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: `<div><p>true</p></div>`,
5. 
6. 	test ( assert, component, target ) {
7. 		component.set({ foo: true });
8. 		assert.htmlEqual( target.innerHTML, `<div><p>true</p>\n<p>true</p></div>` );
9. 
10. 		component.destroy();
11. 	}
12. };


File: test/runtime/samples/onrender-fires-when-ready/main.html
Line number range: 1 - 17
Content:
1. <div>
2. 	<Widget/>
3. 
4. 	{{#if foo}}
5. 		<Widget/>
6. 	{{/if}}
7. </div>
8. 
9. <script>
10. 	import Widget from './Widget.html';
11. 
12. 	export default {
13. 		components: {
14. 			Widget
15. 		}
16. 	};
17. </script>


File: test/runtime/samples/set-in-oncreate/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: '<p>2</p>'
5. };


File: test/runtime/samples/set-in-oncreate/main.html
Line number range: 1 - 13
Content:
1. <p>{{foo}}</p>
2. 
3. <script>
4. 	export default {
5. 		data: () => ({
6. 			foo: 1
7. 		}),
8. 
9. 		oncreate () {
10. 			this.set({ foo: 2 });
11. 		}
12. 	};
13. </script>


File: test/setup.js
Line number range: 1 - 37
Content:
1. const fs = require('fs');
2. const path = require('path');
3. 
4. require('console-group').install();
5. require('source-map-support').install();
6. 
7. require.extensions['.js'] = function(module, filename) {
8. 	const exports = [];
9. 
10. 	var code = fs.readFileSync(filename, 'utf-8')
11. 		.replace(/^import (?:\* as )?(\w+) from ['"]([^'"]+)['"];?/gm, 'var $1 = require("$2");')
12. 		.replace(/^import {([^}]+)} from ['"](.+)['"];?/gm, 'var {$1} = require("$2");')
13. 		.replace(/^export default /gm, 'module.exports = ')
14. 		.replace(/^export (const|let|var|class|function) (\w+)/gm, (match, type, name) => {
15. 			exports.push(name);
16. 			return `${type} ${name}`;
17. 		})
18. 		.replace(/^export \{([^}]+)\}/gm, (match, names) => {
19. 			names.split(',').filter(Boolean).forEach(name => {
20. 				exports.push(name);
21. 			});
22. 
23. 			return '';
24. 		})
25. 		.replace(/^export function (\w+)/gm, 'exports.$1 = function $1');
26. 
27. 	exports.forEach(name => {
28. 		code += `\nexports.${name} = ${name};`;
29. 	});
30. 
31. 	try {
32. 		return module._compile(code, filename);
33. 	} catch (err) {
34. 		console.log(code); // eslint-disable-line no-console
35. 		throw err;
36. 	}
37. };


File: test/test.js
Line number range: 1 - 11
Content:
1. const glob = require("glob");
2. 
3. require("./setup");
4. 
5. glob.sync("**/__test__.js", { cwd: "src" }).forEach(function(file) {
6. 	require("../src/" + file);
7. });
8. 
9. glob.sync("*/index.js", { cwd: "test" }).forEach(function(file) {
10. 	require("./" + file);
11. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:25:51,945 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We have the test harness and several relevant sample tests (configs and main.html), but the inner component files referenced by these runtime samples (Widget.html, ParentWidget.html, Top.html, One.html) are missing. To provide 8 complete, self-contained test cases with exact file paths and line numbers, we need the contents of these component files that implement lifecycle hooks (oncreate/ondestroy), as they are critical to the tests’ behavior.' query='Please provide the full contents with line numbers of these files: 1) test/runtime/samples/onrender-fires-when-ready/Widget.html, 2) test/runtime/samples/onrender-fires-when-ready-nested/Widget.html, 3) test/runtime/samples/onrender-fires-when-ready-nested/ParentWidget.html, 4) test/runtime/samples/ondestroy-before-cleanup/Top.html, and 5) test/runtime/samples/bindings-before-oncreate/One.html.' extra_requirements='If full files are too large, include at minimum the lines where oncreate/ondestroy are defined (especially any async usage), plus their import statements and exported default objects.' purpose='These component files are necessary to assemble 8 complete, self-contained test cases with accurate imports and line numbers related to lifecycle hooks, ensuring relevance to the async oncreate issue.'
2025-11-11 00:25:51,947 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents with line numbers of these files: 1) test/runtime/samples/onrender-fires-when-ready/Widget.html, 2) test/runtime/samples/onrender-fires-when-ready-nested/Widget.html, 3) test/runtime/samples/onrender-fires-when-ready-nested/ParentWidget.html, 4) test/runtime/samples/ondestroy-before-cleanup/Top.html, and 5) test/runtime/samples/bindings-before-oncreate/One.html.
2025-11-11 00:25:52,309 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-11 00:25:52,309 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-11 00:25:52,309 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-11 00:25:52,309 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-11 00:25:52,310 - thread-133013323122368.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-11 00:25:52,312 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-11 00:25:52,312 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents with line numbers of these files: 1) test/runtime/samples/onrender-fires-when-ready/Widget.html, 2) test/runtime/samples/onrender-fires-when-ready-nested/Widget.html, 3) test/runtime/samples/onrender-fires-when-ready-nested/ParentWidget.html, 4) test/runtime/samples/ondestroy-before-cleanup/Top.html, and 5) test/runtime/samples/bindings-before-oncreate/One.html.
Extra requirements: If full files are too large, include at minimum the lines where oncreate/ondestroy are defined (especially any async usage), plus their import statements and exported default objects.
Purpose: These component files are necessary to assemble 8 complete, self-contained test cases with accurate imports and line numbers related to lifecycle hooks, ensuring relevance to the async oncreate issue.
2025-11-11 00:26:00,898 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Z6rkgxk7rSC4Eb7eD0J0F6Y8', 'function': {'arguments': '{"relative_path":"test/runtime/samples/onrender-fires-when-ready/Widget.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 363, 'prompt_tokens': 2283, 'total_tokens': 2646, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ff7322c9-472b-482a-8e94-556e9763d088-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/Widget.html'}, 'id': 'call_Z6rkgxk7rSC4Eb7eD0J0F6Y8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2283, 'output_tokens': 363, 'total_tokens': 2646, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-11 00:26:01,947 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_oPUyc3iEi7DjZglEppQXBIls', 'function': {'arguments': '{"relative_path":"test/runtime/samples/onrender-fires-when-ready-nested/Widget.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 2480, 'total_tokens': 2519, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--315d676d-0344-47d1-a946-6a3908395278-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/onrender-fires-when-ready-nested/Widget.html'}, 'id': 'call_oPUyc3iEi7DjZglEppQXBIls', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2480, 'output_tokens': 39, 'total_tokens': 2519, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:26:03,228 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_tXlUQWRsQnUTFAPgVd1znwAF', 'function': {'arguments': '{"relative_path":"test/runtime/samples/onrender-fires-when-ready-nested/ParentWidget.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 40, 'prompt_tokens': 2681, 'total_tokens': 2721, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--edc059d8-a80a-48be-a9fb-55885fde40f3-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/onrender-fires-when-ready-nested/ParentWidget.html'}, 'id': 'call_tXlUQWRsQnUTFAPgVd1znwAF', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2681, 'output_tokens': 40, 'total_tokens': 2721, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:26:04,228 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_BjGmF5dR9NftqkDWBpCCf6oZ', 'function': {'arguments': '{"relative_path":"test/runtime/samples/ondestroy-before-cleanup/Top.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 2892, 'total_tokens': 2928, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2432}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--14bb6ad5-8166-490c-af22-d6ede8448528-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/ondestroy-before-cleanup/Top.html'}, 'id': 'call_BjGmF5dR9NftqkDWBpCCf6oZ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2892, 'output_tokens': 36, 'total_tokens': 2928, 'input_token_details': {'audio': 0, 'cache_read': 2432}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:26:05,442 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_mhkLHUaO9VwBXnbRGhP5Odki', 'function': {'arguments': '{"relative_path":"test/runtime/samples/bindings-before-oncreate/One.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 3079, 'total_tokens': 3115, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--559f2d03-d07b-43c9-b4c6-f5a32dd13e63-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/bindings-before-oncreate/One.html'}, 'id': 'call_mhkLHUaO9VwBXnbRGhP5Odki', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3079, 'output_tokens': 36, 'total_tokens': 3115, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:26:16,963 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located and retrieved the full contents with line numbers for all five requested files. Each file is small, so the complete contents are provided, including import statements, exported default objects, and lifecycle hooks (oncreate/ondestroy). The two Widget.html files include oncreate; Top.html includes ondestroy; and One.html includes an import, components registration, and oncreate usage. These outputs should give you the exact lines needed for assembling the test cases related to async lifecycle behavior.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 938, 'prompt_tokens': 3311, 'total_tokens': 4249, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--935cfb17-448a-46db-ac9c-633d6e0e1f38-0' usage_metadata={'input_tokens': 3311, 'output_tokens': 938, 'total_tokens': 4249, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-11 00:26:16,966 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents with line numbers of these files: 1) test/runtime/samples/onrender-fires-when-ready/Widget.html, 2) test/runtime/samples/onrender-fires-when-ready-nested/Widget.html, 3) test/runtime/samples/onrender-fires-when-ready-nested/ParentWidget.html, 4) test/runtime/samples/ondestroy-before-cleanup/Top.html, and 5) test/runtime/samples/bindings-before-oncreate/One.html.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If full files are too large, include at minimum the lines where oncreate/ondestroy are defined (especially any async usage), plus their import statements and exported default objects.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These component files are necessary to assemble 8 complete, self-contained test cases with accurate imports and line numbers related to lifecycle hooks, ensuring relevance to the async oncreate issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: test/runtime/samples/bindings-before-oncreate/One.html
Line number range: 1 - 15
Content:
1. <Two bind:foo/>
2. 
3. <script>
4. 	import Two from './Two.html';
5. 
6. 	export default {
7. 		components: {
8. 			Two
9. 		},
10. 
11. 		oncreate() {
12. 			this.snapshot = this.get('foo');
13. 		}
14. 	};
15. </script>


File: test/runtime/samples/ondestroy-before-cleanup/Top.html
Line number range: 1 - 9
Content:
1. <div ref:element></div>
2. 
3. <script>
4. 	export default {
5. 		ondestroy() {
6. 			this.refOnDestroy = this.refs.element;
7. 		}
8. 	};
9. </script>


File: test/runtime/samples/onrender-fires-when-ready-nested/ParentWidget.html
Line number range: 1 - 11
Content:
1. <Widget/>{{#if foo}}<Widget/>{{/if}}
2. 
3. <script>
4. 	import Widget from './Widget.html';
5. 
6. 	export default {
7. 		components: {
8. 			Widget
9. 		}
10. 	};
11. </script>


File: test/runtime/samples/onrender-fires-when-ready-nested/Widget.html
Line number range: 1 - 9
Content:
1. <p ref:x>{{inDocument}}</p>
2. 
3. <script>
4. 	export default {
5. 		oncreate () {
6. 			this.set({ inDocument: document.contains( this.refs.x ) })
7. 		}
8. 	};
9. </script>


File: test/runtime/samples/onrender-fires-when-ready/Widget.html
Line number range: 1 - 9
Content:
1. <p ref:x>{{inDocument}}</p>
2. 
3. <script>
4. 	export default {
5. 		oncreate () {
6. 			this.set({ inDocument: document.contains( this.refs.x ) })
7. 		}
8. 	};
9. </script>

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-11 00:26:37,562 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The query requests the full contents with line numbers of this specific file and highlights lifecycle hooks and imports/exports. This file includes an import, exported default with components, and an oncreate hook relevant to the bindings-before-oncreate test.', relative_path='test/runtime/samples/bindings-before-oncreate/One.html', start_line=1, end_line=15), ContextOutput(reasoning='The query asks for the full contents with line numbers, focusing on lifecycle hooks. This file contains an ondestroy hook inside the exported default object, which is central to the ondestroy-before-cleanup test.', relative_path='test/runtime/samples/ondestroy-before-cleanup/Top.html', start_line=1, end_line=9), ContextOutput(reasoning='The query asks for ParentWidget.html contents with line numbers. This file imports Widget and exports a default with components, necessary to understand the nested onrender test setup.', relative_path='test/runtime/samples/onrender-fires-when-ready-nested/ParentWidget.html', start_line=1, end_line=11), ContextOutput(reasoning='The query asks for the nested Widget.html contents, including lifecycle details. This file defines an oncreate hook that checks document containment and updates state, which is directly relevant to the onrender readiness behavior.', relative_path='test/runtime/samples/onrender-fires-when-ready-nested/Widget.html', start_line=1, end_line=9), ContextOutput(reasoning='The query asks for the Widget.html in onrender-fires-when-ready. This file includes an oncreate hook that sets inDocument based on DOM presence, directly implementing the behavior under test.', relative_path='test/runtime/samples/onrender-fires-when-ready/Widget.html', start_line=1, end_line=9)]
2025-11-11 00:26:37,564 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 5 contexts to memory for query: Please provide the full contents with line numbers of these files: 1) test/runtime/samples/onrender-fires-when-ready/Widget.html, 2) test/runtime/samples/onrender-fires-when-ready-nested/Widget.html, 3) test/runtime/samples/onrender-fires-when-ready-nested/ParentWidget.html, 4) test/runtime/samples/ondestroy-before-cleanup/Top.html, and 5) test/runtime/samples/bindings-before-oncreate/One.html.
2025-11-11 00:26:39,122 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-11 00:26:39,124 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 5 new contexts to 24 existing contexts
2025-11-11 00:26:39,124 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 29 total contexts (removed 0 duplicates)
2025-11-11 00:26:39,125 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-11-11 00:26:39,128 - thread-133013323122368.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='test/helpers.js', content="1. import { JSDOM } from 'jsdom';\n2. import assert from 'assert';\n3. import glob from 'glob';\n4. import fs from 'fs';\n5. import path from 'path';\n6. import chalk from 'chalk';\n7. \n8. // for coverage purposes, we need to test source files,\n9. // but for sanity purposes, we need to test dist files\n10. export function loadSvelte(test) {\n11. \tif (test) global.__svelte_test = true;\n12. \n13. \tconst resolved = process.env.COVERAGE\n14. \t\t? require.resolve('../src/index.js')\n15. \t\t: require.resolve('../compiler/svelte.js');\n16. \n17. \tdelete require.cache[resolved];\n18. \treturn require(resolved);\n19. }\n20. \n21. export const svelte = loadSvelte();\n22. \n23. export function exists(path) {\n24. \ttry {\n25. \t\tfs.statSync(path);\n26. \t\treturn true;\n27. \t} catch (err) {\n28. \t\treturn false;\n29. \t}\n30. }\n31. \n32. export function tryToLoadJson(file) {\n33. \ttry {\n34. \t\treturn JSON.parse(fs.readFileSync(file));\n35. \t} catch (err) {\n36. \t\tif (err.code !== 'ENOENT') throw err;\n37. \t\treturn null;\n38. \t}\n39. }\n40. \n41. export function tryToReadFile(file) {\n42. \ttry {\n43. \t\treturn fs.readFileSync(file, 'utf-8');\n44. \t} catch (err) {\n45. \t\tif (err.code !== 'ENOENT') throw err;\n46. \t\treturn null;\n47. \t}\n48. }\n49. \n50. const { window } = new JSDOM('<main></main>');\n51. global.document = window.document;\n52. \n53. export function env() {\n54. \twindow._svelteTransitionManager = null;\n55. \twindow.document.body.innerHTML = '<main></main>';\n56. \n57. \treturn window;\n58. }\n59. \n60. function cleanChildren(node) {\n61. \tlet previous = null;\n62. \n63. \t// sort attributes\n64. \tconst attributes = Array.from(node.attributes).sort((a, b) => {\n65. \t\treturn a.name < b.name ? -1 : 1;\n66. \t});\n67. \n68. \tattributes.forEach(attr => {\n69. \t\tnode.removeAttribute(attr.name);\n70. \t});\n71. \n72. \tattributes.forEach(attr => {\n73. \t\tnode.setAttribute(attr.name, attr.value);\n74. \t});\n75. \n76. \t// recurse\n77. \t[...node.childNodes].forEach(child => {\n78. \t\tif (child.nodeType === 3) {\n79. \t\t\t// text\n80. \t\t\tif (\n81. \t\t\t\tnode.namespaceURI === 'http://www.w3.org/2000/svg' &&\n82. \t\t\t\tnode.tagName !== 'text' &&\n83. \t\t\t\tnode.tagName !== 'tspan'\n84. \t\t\t) {\n85. \t\t\t\tnode.removeChild(child);\n86. \t\t\t}\n87. \n88. \t\t\tchild.data = child.data.replace(/\\s{2,}/g, '\\n');\n89. \n90. \t\t\tif (previous && previous.nodeType === 3) {\n91. \t\t\t\tprevious.data += child.data;\n92. \t\t\t\tprevious.data = previous.data.replace(/\\s{2,}/g, '\\n');\n93. \n94. \t\t\t\tnode.removeChild(child);\n95. \t\t\t\tchild = previous;\n96. \t\t\t}\n97. \t\t} else {\n98. \t\t\tcleanChildren(child);\n99. \t\t}\n100. \n101. \t\tprevious = child;\n102. \t});\n103. \n104. \t// collapse whitespace\n105. \tif (node.firstChild && node.firstChild.nodeType === 3) {\n106. \t\tnode.firstChild.data = node.firstChild.data.replace(/^\\s+/, '');\n107. \t\tif (!node.firstChild.data) node.removeChild(node.firstChild);\n108. \t}\n109. \n110. \tif (node.lastChild && node.lastChild.nodeType === 3) {\n111. \t\tnode.lastChild.data = node.lastChild.data.replace(/\\s+$/, '');\n112. \t\tif (!node.lastChild.data) node.removeChild(node.lastChild);\n113. \t}\n114. }\n115. \n116. export function normalizeHtml(window, html) {\n117. \ttry {\n118. \t\tconst node = window.document.createElement('div');\n119. \t\tnode.innerHTML = html\n120. \t\t\t.replace(/<!--.*?-->/g, '')\n121. \t\t\t.replace(/>[\\s\\r\\n]+</g, '><')\n122. \t\t\t.trim();\n123. \t\tcleanChildren(node, '');\n124. \t\treturn node.innerHTML.replace(/<\\/?noscript\\/?>/g, '');\n125. \t} catch (err) {\n126. \t\tthrow new Error(`Failed to normalize HTML:\\n${html}`);\n127. \t}\n128. }\n129. \n130. export function setupHtmlEqual() {\n131. \tconst window = env();\n132. \n133. \tassert.htmlEqual = (actual, expected, message) => {\n134. \t\tassert.deepEqual(\n135. \t\t\tnormalizeHtml(window, actual),\n136. \t\t\tnormalizeHtml(window, expected),\n137. \t\t\tmessage\n138. \t\t);\n139. \t};\n140. }\n141. \n142. export function loadConfig(file) {\n143. \ttry {\n144. \t\tconst resolved = require.resolve(file);\n145. \t\tdelete require.cache[resolved];\n146. \n147. \t\tconst config = require(resolved);\n148. \t\treturn config.default || config;\n149. \t} catch (err) {\n150. \t\tif (err.code === 'MODULE_NOT_FOUND') {\n151. \t\t\treturn {};\n152. \t\t}\n153. \n154. \t\tthrow err;\n155. \t}\n156. }\n157. \n158. export function addLineNumbers(code) {\n159. \treturn code\n160. \t\t.split('\\n')\n161. \t\t.map((line, i) => {\n162. \t\t\ti = String(i + 1);\n163. \t\t\twhile (i.length < 3) i = ` ${i}`;\n164. \n165. \t\t\treturn (\n166. \t\t\t\tchalk.grey(`  ${i}: `) +\n167. \t\t\t\tline.replace(/^\\t+/, match => match.split('\\t').join('    '))\n168. \t\t\t);\n169. \t\t})\n170. \t\t.join('\\n');\n171. }\n172. \n173. function capitalise(str) {\n174. \treturn str[0].toUpperCase() + str.slice(1);\n175. }\n176. \n177. export function showOutput(cwd, options = {}, s = svelte) {\n178. \tglob.sync('**/*.html', { cwd }).forEach(file => {\n179. \t\tif (file[0] === '_') return;\n180. \t\tconst { code } = s.compile(\n181. \t\t\tfs.readFileSync(`${cwd}/${file}`, 'utf-8'),\n182. \t\t\tObject.assign(options, {\n183. \t\t\t\tfilename: file,\n184. \t\t\t\tname: capitalise(path.basename(file).replace(/\\.html$/, ''))\n185. \t\t\t})\n186. \t\t);\n187. \n188. \t\tconsole.log( // eslint-disable-line no-console\n189. \t\t\t`\\n>> ${chalk.cyan.bold(file)}\\n${addLineNumbers(code)}\\n<< ${chalk.cyan.bold(file)}`\n190. \t\t);\n191. \t});\n192. }\n193. \n194. const start = /\\n(\\t+)/;\n195. export function deindent(strings, ...values) {\n196. \tconst indentation = start.exec(strings[0])[1];\n197. \tconst pattern = new RegExp(`^${indentation}`, 'gm');\n198. \n199. \tlet result = strings[0].replace(start, '').replace(pattern, '');\n200. \n201. \tlet trailingIndentation = getTrailingIndentation(result);\n202. \n203. \tfor (let i = 1; i < strings.length; i += 1) {\n204. \t\tlet expression = values[i - 1];\n205. \t\tconst string = strings[i].replace(pattern, '');\n206. \n207. \t\tif (Array.isArray(expression)) {\n208. \t\t\texpression = expression.length ? expression.join('\\n') : null;\n209. \t\t}\n210. \n211. \t\tif (expression || expression === '') {\n212. \t\t\tconst value = String(expression).replace(\n213. \t\t\t\t/\\n/g,\n214. \t\t\t\t`\\n${trailingIndentation}`\n215. \t\t\t);\n216. \t\t\tresult += value + string;\n217. \t\t} else {\n218. \t\t\tlet c = result.length;\n219. \t\t\twhile (/\\s/.test(result[c - 1])) c -= 1;\n220. \t\t\tresult = result.slice(0, c) + string;\n221. \t\t}\n222. \n223. \t\ttrailingIndentation = getTrailingIndentation(result);\n224. \t}\n225. \n226. \treturn result.trim().replace(/\\t+$/gm, '');\n227. }\n228. \n229. function getTrailingIndentation(str) {\n230. \tlet i = str.length;\n231. \twhile (str[i - 1] === ' ' || str[i - 1] === '\\t') i -= 1;\n232. \treturn str.slice(i, str.length);\n233. }\n234. \n235. export function spaces(i) {\n236. \tlet result = '';\n237. \twhile (i--) result += ' ';\n238. \treturn result;\n239. }", start_line_number=1, end_line_number=239), Context(relative_path='test/js/index.js', content='1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import { rollup } from "rollup";\n5. import { loadConfig, svelte } from "../helpers.js";\n6. \n7. describe("js", () => {\n8. \tfs.readdirSync("test/js/samples").forEach(dir => {\n9. \t\tif (dir[0] === ".") return;\n10. \n11. \t\t// add .solo to a sample directory name to only run that test\n12. \t\tconst solo = /\\.solo/.test(dir);\n13. \n14. \t\tif (solo && process.env.CI) {\n15. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n16. \t\t}\n17. \n18. \t\t(solo ? it.only : it)(dir, () => {\n19. \t\t\tdir = path.resolve("test/js/samples", dir);\n20. \t\t\tconst config = loadConfig(`${dir}/_config.js`);\n21. \n22. \t\t\tconst input = fs\n23. \t\t\t\t.readFileSync(`${dir}/input.html`, "utf-8")\n24. \t\t\t\t.replace(/\\s+$/, "");\n25. \n26. \t\t\tlet actual;\n27. \n28. \t\t\ttry {\n29. \t\t\t\tconst options = Object.assign(config.options || {}, {\n30. \t\t\t\t\tshared: true\n31. \t\t\t\t});\n32. \n33. \t\t\t\tactual = svelte.compile(input, options).code.replace(/generated by Svelte v\\d+\\.\\d+\\.\\d+/, \'generated by Svelte vX.Y.Z\');\n34. \t\t\t} catch (err) {\n35. \t\t\t\tconsole.log(err.frame);\n36. \t\t\t\tthrow err;\n37. \t\t\t}\n38. \n39. \t\t\tfs.writeFileSync(`${dir}/_actual.js`, actual);\n40. \n41. \t\t\treturn rollup({\n42. \t\t\t\tinput: `${dir}/_actual.js`,\n43. \t\t\t\tplugins: [\n44. \t\t\t\t\t{\n45. \t\t\t\t\t\tresolveId(importee, importer) {\n46. \t\t\t\t\t\t\tif (!importer) return importee;\n47. \t\t\t\t\t\t\tif (importee === "svelte/shared.js")\n48. \t\t\t\t\t\t\t\treturn path.resolve("shared.js");\n49. \t\t\t\t\t\t\treturn null;\n50. \t\t\t\t\t\t}\n51. \t\t\t\t\t}\n52. \t\t\t\t]\n53. \t\t\t}).then(bundle => {\n54. \t\t\t\treturn bundle.generate({ format: "es" });\n55. \t\t\t}).then(({ code }) => {\n56. \t\t\t\tfs.writeFileSync(`${dir}/_actual-bundle.js`, code);\n57. \n58. \t\t\t\tconst expected = fs.readFileSync(`${dir}/expected.js`, "utf-8");\n59. \t\t\t\tconst expectedBundle = fs.readFileSync(\n60. \t\t\t\t\t`${dir}/expected-bundle.js`,\n61. \t\t\t\t\t"utf-8"\n62. \t\t\t\t);\n63. \n64. \t\t\t\tassert.equal(\n65. \t\t\t\t\tactual.trim().replace(/^[ \\t]+$/gm, ""),\n66. \t\t\t\t\texpected.trim().replace(/^[ \\t]+$/gm, "")\n67. \t\t\t\t);\n68. \n69. \t\t\t\tassert.equal(\n70. \t\t\t\t\tcode.trim().replace(/^[ \\t]+$/gm, ""),\n71. \t\t\t\t\texpectedBundle.trim().replace(/^[ \\t]+$/gm, "")\n72. \t\t\t\t);\n73. \t\t\t}).catch(err => {\n74. \t\t\t\tif (err.loc) console.error(err.loc);\n75. \t\t\t\tthrow err;\n76. \t\t\t});\n77. \t\t});\n78. \t});\n79. });', start_line_number=1, end_line_number=79), Context(relative_path='test/js/samples/onrender-onteardown-rewritten/expected-bundle.js', content="1. function noop() {}\n2. \n3. function assign(target) {\n4. \tvar k,\n5. \t\tsource,\n6. \t\ti = 1,\n7. \t\tlen = arguments.length;\n8. \tfor (; i < len; i++) {\n9. \t\tsource = arguments[i];\n10. \t\tfor (k in source) target[k] = source[k];\n11. \t}\n12. \n13. \treturn target;\n14. }\n15. \n16. function blankObject() {\n17. \treturn Object.create(null);\n18. }\n19. \n20. function destroy(detach) {\n21. \tthis.destroy = noop;\n22. \tthis.fire('destroy');\n23. \tthis.set = this.get = noop;\n24. \n25. \tif (detach !== false) this._fragment.u();\n26. \tthis._fragment.d();\n27. \tthis._fragment = this._state = null;\n28. }\n29. \n30. function differs(a, b) {\n31. \treturn a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n32. }\n33. \n34. function dispatchObservers(component, group, changed, newState, oldState) {\n35. \tfor (var key in group) {\n36. \t\tif (!changed[key]) continue;\n37. \n38. \t\tvar newValue = newState[key];\n39. \t\tvar oldValue = oldState[key];\n40. \n41. \t\tvar callbacks = group[key];\n42. \t\tif (!callbacks) continue;\n43. \n44. \t\tfor (var i = 0; i < callbacks.length; i += 1) {\n45. \t\t\tvar callback = callbacks[i];\n46. \t\t\tif (callback.__calling) continue;\n47. \n48. \t\t\tcallback.__calling = true;\n49. \t\t\tcallback.call(component, newValue, oldValue);\n50. \t\t\tcallback.__calling = false;\n51. \t\t}\n52. \t}\n53. }\n54. \n55. function fire(eventName, data) {\n56. \tvar handlers =\n57. \t\teventName in this._handlers && this._handlers[eventName].slice();\n58. \tif (!handlers) return;\n59. \n60. \tfor (var i = 0; i < handlers.length; i += 1) {\n61. \t\thandlers[i].call(this, data);\n62. \t}\n63. }\n64. \n65. function get(key) {\n66. \treturn key ? this._state[key] : this._state;\n67. }\n68. \n69. function init(component, options) {\n70. \tcomponent.options = options;\n71. \n72. \tcomponent._observers = { pre: blankObject(), post: blankObject() };\n73. \tcomponent._handlers = blankObject();\n74. \tcomponent._root = options._root || component;\n75. \tcomponent._yield = options._yield;\n76. \tcomponent._bind = options._bind;\n77. }\n78. \n79. function observe(key, callback, options) {\n80. \tvar group = options && options.defer\n81. \t\t? this._observers.post\n82. \t\t: this._observers.pre;\n83. \n84. \t(group[key] || (group[key] = [])).push(callback);\n85. \n86. \tif (!options || options.init !== false) {\n87. \t\tcallback.__calling = true;\n88. \t\tcallback.call(this, this._state[key]);\n89. \t\tcallback.__calling = false;\n90. \t}\n91. \n92. \treturn {\n93. \t\tcancel: function() {\n94. \t\t\tvar index = group[key].indexOf(callback);\n95. \t\t\tif (~index) group[key].splice(index, 1);\n96. \t\t}\n97. \t};\n98. }\n99. \n100. function on(eventName, handler) {\n101. \tif (eventName === 'teardown') return this.on('destroy', handler);\n102. \n103. \tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n104. \thandlers.push(handler);\n105. \n106. \treturn {\n107. \t\tcancel: function() {\n108. \t\t\tvar index = handlers.indexOf(handler);\n109. \t\t\tif (~index) handlers.splice(index, 1);\n110. \t\t}\n111. \t};\n112. }\n113. \n114. function set(newState) {\n115. \tthis._set(assign({}, newState));\n116. \tif (this._root._lock) return;\n117. \tthis._root._lock = true;\n118. \tcallAll(this._root._beforecreate);\n119. \tcallAll(this._root._oncreate);\n120. \tcallAll(this._root._aftercreate);\n121. \tthis._root._lock = false;\n122. }\n123. \n124. function _set(newState) {\n125. \tvar oldState = this._state,\n126. \t\tchanged = {},\n127. \t\tdirty = false;\n128. \n129. \tfor (var key in newState) {\n130. \t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n131. \t}\n132. \tif (!dirty) return;\n133. \n134. \tthis._state = assign({}, oldState, newState);\n135. \tthis._recompute(changed, this._state);\n136. \tif (this._bind) this._bind(changed, this._state);\n137. \tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n138. \tthis._fragment.p(changed, this._state);\n139. \tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n140. }\n141. \n142. function callAll(fns) {\n143. \twhile (fns && fns.length) fns.pop()();\n144. }\n145. \n146. function _mount(target, anchor) {\n147. \tthis._fragment.m(target, anchor);\n148. }\n149. \n150. function _unmount() {\n151. \tthis._fragment.u();\n152. }\n153. \n154. var proto = {\n155. \tdestroy: destroy,\n156. \tget: get,\n157. \tfire: fire,\n158. \tobserve: observe,\n159. \ton: on,\n160. \tset: set,\n161. \tteardown: destroy,\n162. \t_recompute: noop,\n163. \t_set: _set,\n164. \t_mount: _mount,\n165. \t_unmount: _unmount\n166. };\n167. \n168. /* generated by Svelte vX.Y.Z */\n169. function oncreate() {}\n170. \n171. function ondestroy() {}\n172. \n173. function create_main_fragment(state, component) {\n174. \n175. \treturn {\n176. \t\tc: noop,\n177. \n178. \t\tm: noop,\n179. \n180. \t\tp: noop,\n181. \n182. \t\tu: noop,\n183. \n184. \t\td: noop\n185. \t};\n186. }\n187. \n188. function SvelteComponent(options) {\n189. \tinit(this, options);\n190. \tthis._state = assign({}, options.data);\n191. \n192. \tthis._handlers.destroy = [ondestroy];\n193. \n194. \tvar _oncreate = oncreate.bind(this);\n195. \n196. \tif (!options._root) {\n197. \t\tthis._oncreate = [_oncreate];\n198. \t} else {\n199. \t \tthis._root._oncreate.push(_oncreate);\n200. \t }\n201. \n202. \tthis._fragment = create_main_fragment(this._state, this);\n203. \n204. \tif (options.target) {\n205. \t\tthis._fragment.c();\n206. \t\tthis._fragment.m(options.target, options.anchor || null);\n207. \n208. \t\tcallAll(this._oncreate);\n209. \t}\n210. }\n211. \n212. assign(SvelteComponent.prototype, proto);\n213. \n214. export default SvelteComponent;", start_line_number=1, end_line_number=214), Context(relative_path='test/js/samples/onrender-onteardown-rewritten/expected.js', content='1. /* generated by Svelte vX.Y.Z */\n2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";\n3. \n4. function oncreate() {};\n5. \n6. function ondestroy() {};\n7. \n8. function create_main_fragment(state, component) {\n9. \n10. \treturn {\n11. \t\tc: noop,\n12. \n13. \t\tm: noop,\n14. \n15. \t\tp: noop,\n16. \n17. \t\tu: noop,\n18. \n19. \t\td: noop\n20. \t};\n21. }\n22. \n23. function SvelteComponent(options) {\n24. \tinit(this, options);\n25. \tthis._state = assign({}, options.data);\n26. \n27. \tthis._handlers.destroy = [ondestroy]\n28. \n29. \tvar _oncreate = oncreate.bind(this);\n30. \n31. \tif (!options._root) {\n32. \t\tthis._oncreate = [_oncreate];\n33. \t} else {\n34. \t \tthis._root._oncreate.push(_oncreate);\n35. \t }\n36. \n37. \tthis._fragment = create_main_fragment(this._state, this);\n38. \n39. \tif (options.target) {\n40. \t\tthis._fragment.c();\n41. \t\tthis._fragment.m(options.target, options.anchor || null);\n42. \n43. \t\tcallAll(this._oncreate);\n44. \t}\n45. }\n46. \n47. assign(SvelteComponent.prototype, proto);\n48. export default SvelteComponent;', start_line_number=1, end_line_number=48), Context(relative_path='test/js/samples/onrender-onteardown-rewritten/input.html', content='1. <script>\n2. \texport default {\n3. \t\t// this test should be removed in v2\n4. \t\tonrender () {},\n5. \t\tonteardown () {}\n6. \t};\n7. </script>', start_line_number=1, end_line_number=7), Context(relative_path='test/js/samples/ssr-no-oncreate-etc/_config.js', content="1. export default {\n2. \toptions: {\n3. \t\tgenerate: 'ssr'\n4. \t}\n5. };", start_line_number=1, end_line_number=5), Context(relative_path='test/js/samples/ssr-no-oncreate-etc/expected-bundle.js', content="1. var SvelteComponent = {};\n2. \n3. SvelteComponent.data = function() {\n4. \treturn {};\n5. };\n6. \n7. SvelteComponent.render = function(state, options) {\n8. \tstate = state || {};\n9. \n10. \treturn ``.trim();\n11. };\n12. \n13. SvelteComponent.renderCss = function() {\n14. \tvar components = [];\n15. \n16. \treturn {\n17. \t\tcss: components.map(x => x.css).join('\\n'),\n18. \t\tmap: null,\n19. \t\tcomponents\n20. \t};\n21. };\n22. \n23. module.exports = SvelteComponent;", start_line_number=1, end_line_number=23), Context(relative_path='test/js/samples/ssr-no-oncreate-etc/expected.js', content='1. "use strict";\n2. \n3. var SvelteComponent = {};;\n4. \n5. SvelteComponent.data = function() {\n6. \treturn {};\n7. };\n8. \n9. SvelteComponent.render = function(state, options) {\n10. \tstate = state || {};\n11. \n12. \treturn ``.trim();\n13. };\n14. \n15. SvelteComponent.renderCss = function() {\n16. \tvar components = [];\n17. \n18. \treturn {\n19. \t\tcss: components.map(x => x.css).join(\'\\n\'),\n20. \t\tmap: null,\n21. \t\tcomponents\n22. \t};\n23. };\n24. \n25. var escaped = {\n26. \t\'"\': \'&quot;\',\n27. \t"\'": \'&#39;\',\n28. \t\'&\': \'&amp;\',\n29. \t\'<\': \'&lt;\',\n30. \t\'>\': \'&gt;\'\n31. };\n32. \n33. function __escape(html) {\n34. \treturn String(html).replace(/["\'&<>]/g, match => escaped[match]);\n35. }\n36. \n37. module.exports = SvelteComponent;', start_line_number=1, end_line_number=37), Context(relative_path='test/js/samples/ssr-no-oncreate-etc/input.html', content="1. <script>\n2. \texport default {\n3. \t\toncreate() {\n4. \t\t\tconsole.log('oncreate');\n5. \t\t},\n6. \n7. \t\tondestroy() {\n8. \t\t\tconsole.log('ondestroy');\n9. \t\t},\n10. \n11. \t\tmethods: {\n12. \t\t\tfoo() {\n13. \t\t\t\tconsole.log('foo');\n14. \t\t\t}\n15. \t\t},\n16. \n17. \t\tevents: {\n18. \t\t\tswipe(node, callback) {\n19. \t\t\t\t// TODO implement\n20. \t\t\t}\n21. \t\t}\n22. \t};\n23. </script>", start_line_number=1, end_line_number=23), Context(relative_path='test/runtime/index.js', content='1. import assert from "assert";\n2. import * as path from "path";\n3. import * as fs from "fs";\n4. import * as acorn from "acorn";\n5. import { transitionManager } from "../../shared.js";\n6. \n7. import {\n8. \tshowOutput,\n9. \tloadConfig,\n10. \tloadSvelte,\n11. \tenv,\n12. \tsetupHtmlEqual,\n13. \tspaces\n14. } from "../helpers.js";\n15. \n16. let svelte;\n17. \n18. let compileOptions = null;\n19. \n20. function getName(filename) {\n21. \tconst base = path.basename(filename).replace(".html", "");\n22. \treturn base[0].toUpperCase() + base.slice(1);\n23. }\n24. \n25. describe("runtime", () => {\n26. \tbefore(() => {\n27. \t\tsvelte = loadSvelte(true);\n28. \n29. \t\trequire.extensions[".html"] = function(module, filename) {\n30. \t\t\tconst options = Object.assign(\n31. \t\t\t\t{ filename, name: getName(filename), format: \'cjs\' },\n32. \t\t\t\tcompileOptions\n33. \t\t\t);\n34. \n35. \t\t\tconst { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);\n36. \n37. \t\t\treturn module._compile(code, filename);\n38. \t\t};\n39. \n40. \t\treturn setupHtmlEqual();\n41. \t});\n42. \n43. \tconst failed = new Set();\n44. \n45. \tfunction runTest(dir, shared, hydrate) {\n46. \t\tif (dir[0] === ".") return;\n47. \n48. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n49. \n50. \t\tif (config.solo && process.env.CI) {\n51. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n52. \t\t}\n53. \n54. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? \'shared\' : \'inline\'} helpers)`, () => {\n55. \t\t\tif (failed.has(dir)) {\n56. \t\t\t\t// this makes debugging easier, by only printing compiled output once\n57. \t\t\t\tthrow new Error(\'skipping test, already failed\');\n58. \t\t\t}\n59. \n60. \t\t\tconst cwd = path.resolve(`test/runtime/samples/${dir}`);\n61. \n62. \t\t\tcompileOptions = config.compileOptions || {};\n63. \t\t\tcompileOptions.shared = shared;\n64. \t\t\tcompileOptions.hydratable = hydrate;\n65. \t\t\tcompileOptions.dev = config.dev;\n66. \n67. \t\t\t// check that no ES2015+ syntax slipped in\n68. \t\t\tif (!config.allowES2015) {\n69. \t\t\t\ttry {\n70. \t\t\t\t\tconst source = fs.readFileSync(\n71. \t\t\t\t\t\t`test/runtime/samples/${dir}/main.html`,\n72. \t\t\t\t\t\t"utf-8"\n73. \t\t\t\t\t);\n74. \t\t\t\t\tconst { code } = svelte.compile(source, compileOptions);\n75. \t\t\t\t\tconst startIndex = code.indexOf("function create_main_fragment"); // may change!\n76. \t\t\t\t\tif (startIndex === -1) throw new Error("missing create_main_fragment");\n77. \t\t\t\t\tconst endIndex = code.lastIndexOf("export default");\n78. \t\t\t\t\tconst es5 =\n79. \t\t\t\t\t\tcode.slice(0, startIndex).split(\'\\n\').map(x => spaces(x.length)).join(\'\\n\') +\n80. \t\t\t\t\t\tcode.slice(startIndex, endIndex);\n81. \n82. \t\t\t\t\tacorn.parse(es5, { ecmaVersion: 5 });\n83. \n84. \t\t\t\t\tif (/Object\\.assign/.test(es5)) {\n85. \t\t\t\t\t\tthrow new Error(\n86. \t\t\t\t\t\t\t"cannot use Object.assign in generated code, as it is not supported everywhere"\n87. \t\t\t\t\t\t);\n88. \t\t\t\t\t}\n89. \t\t\t\t} catch (err) {\n90. \t\t\t\t\tfailed.add(dir);\n91. \t\t\t\t\tshowOutput(cwd, { shared }, svelte); // eslint-disable-line no-console\n92. \t\t\t\t\tthrow err;\n93. \t\t\t\t}\n94. \t\t\t}\n95. \n96. \t\t\tObject.keys(require.cache)\n97. \t\t\t\t.filter(x => x.endsWith(".html"))\n98. \t\t\t\t.forEach(file => {\n99. \t\t\t\t\tdelete require.cache[file];\n100. \t\t\t\t});\n101. \n102. \t\t\tlet SvelteComponent;\n103. \n104. \t\t\tlet unintendedError = null;\n105. \n106. \t\t\tconst window = env();\n107. \n108. \t\t\ttry {\n109. \t\t\t\t// set of hacks to support transition tests\n110. \t\t\t\ttransitionManager.running = false;\n111. \t\t\t\ttransitionManager.transitions = [];\n112. \n113. \t\t\t\tconst raf = {\n114. \t\t\t\t\ttime: 0,\n115. \t\t\t\t\tcallback: null,\n116. \t\t\t\t\ttick: now => {\n117. \t\t\t\t\t\traf.time = now;\n118. \t\t\t\t\t\tif (raf.callback) raf.callback();\n119. \t\t\t\t\t}\n120. \t\t\t\t};\n121. \t\t\t\twindow.performance = { now: () => raf.time };\n122. \t\t\t\tglobal.requestAnimationFrame = cb => {\n123. \t\t\t\t\tlet called = false;\n124. \t\t\t\t\traf.callback = () => {\n125. \t\t\t\t\t\tif (!called) {\n126. \t\t\t\t\t\t\tcalled = true;\n127. \t\t\t\t\t\t\tcb();\n128. \t\t\t\t\t\t}\n129. \t\t\t\t\t};\n130. \t\t\t\t};\n131. \n132. \t\t\t\tglobal.window = window;\n133. \n134. \t\t\t\ttry {\n135. \t\t\t\t\tSvelteComponent = require(`./samples/${dir}/main.html`);\n136. \t\t\t\t} catch (err) {\n137. \t\t\t\t\tshowOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console\n138. \t\t\t\t\tthrow err;\n139. \t\t\t\t}\n140. \n141. \t\t\t\tglobal.window = window;\n142. \n143. \t\t\t\t// Put the constructor on window for testing\n144. \t\t\t\twindow.SvelteComponent = SvelteComponent;\n145. \n146. \t\t\t\tconst target = window.document.querySelector("main");\n147. \n148. \t\t\t\tconst warnings = [];\n149. \t\t\t\tconst warn = console.warn;\n150. \t\t\t\tconsole.warn = warning => {\n151. \t\t\t\t\twarnings.push(warning);\n152. \t\t\t\t};\n153. \n154. \t\t\t\tconst options = Object.assign({}, {\n155. \t\t\t\t\ttarget,\n156. \t\t\t\t\thydrate,\n157. \t\t\t\t\tdata: config.data\n158. \t\t\t\t}, config.options || {});\n159. \n160. \t\t\t\tconst component = new SvelteComponent(options);\n161. \n162. \t\t\t\tconsole.warn = warn;\n163. \n164. \t\t\t\tif (config.error) {\n165. \t\t\t\t\tunintendedError = true;\n166. \t\t\t\t\tthrow new Error("Expected a runtime error");\n167. \t\t\t\t}\n168. \n169. \t\t\t\tif (config.warnings) {\n170. \t\t\t\t\tassert.deepEqual(warnings, config.warnings);\n171. \t\t\t\t} else if (warnings.length) {\n172. \t\t\t\t\tunintendedError = true;\n173. \t\t\t\t\tthrow new Error("Received unexpected warnings");\n174. \t\t\t\t}\n175. \n176. \t\t\t\tif (config.html) {\n177. \t\t\t\t\tassert.htmlEqual(target.innerHTML, config.html);\n178. \t\t\t\t}\n179. \n180. \t\t\t\tif (config.test) {\n181. \t\t\t\t\tconfig.test(assert, component, target, window, raf);\n182. \t\t\t\t} else {\n183. \t\t\t\t\tcomponent.destroy();\n184. \t\t\t\t\tassert.equal(target.innerHTML, "");\n185. \t\t\t\t}\n186. \t\t\t} catch (err) {\n187. \t\t\t\tif (config.error && !unintendedError) {\n188. \t\t\t\t\tconfig.error(assert, err);\n189. \t\t\t\t} else {\n190. \t\t\t\t\tfailed.add(dir);\n191. \t\t\t\t\tshowOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console\n192. \t\t\t\t\tthrow err;\n193. \t\t\t\t}\n194. \t\t\t}\n195. \n196. \t\t\tif (config.show) showOutput(cwd, { shared, hydratable: hydrate }, svelte);\n197. \t\t});\n198. \t}\n199. \n200. \tconst shared = path.resolve("shared.js");\n201. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n202. \t\trunTest(dir, shared, false);\n203. \t\trunTest(dir, shared, true);\n204. \t\trunTest(dir, null, false);\n205. \t});\n206. \n207. \tit("fails if options.target is missing in dev mode", () => {\n208. \t\tconst { code } = svelte.compile(`<div></div>`, {\n209. \t\t\tformat: "iife",\n210. \t\t\tname: "SvelteComponent",\n211. \t\t\tdev: true\n212. \t\t});\n213. \n214. \t\tconst SvelteComponent = eval(\n215. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n216. \t\t);\n217. \n218. \t\tassert.throws(() => {\n219. \t\t\tnew SvelteComponent();\n220. \t\t}, /\'target\' is a required option/);\n221. \t});\n222. \n223. \tit("fails if options.hydrate is true but the component is non-hydratable", () => {\n224. \t\tconst { code } = svelte.compile(`<div></div>`, {\n225. \t\t\tformat: "iife",\n226. \t\t\tname: "SvelteComponent",\n227. \t\t\tdev: true\n228. \t\t});\n229. \n230. \t\tconst SvelteComponent = eval(\n231. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n232. \t\t);\n233. \n234. \t\tassert.throws(() => {\n235. \t\t\tnew SvelteComponent({\n236. \t\t\t\ttarget: {},\n237. \t\t\t\thydrate: true\n238. \t\t\t});\n239. \t\t}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);\n240. \t});\n241. });', start_line_number=1, end_line_number=241), Context(relative_path='test/runtime/samples/bindings-before-oncreate/One.html', content="1. <Two bind:foo/>\n2. \n3. <script>\n4. \timport Two from './Two.html';\n5. \n6. \texport default {\n7. \t\tcomponents: {\n8. \t\t\tTwo\n9. \t\t},\n10. \n11. \t\toncreate() {\n12. \t\t\tthis.snapshot = this.get('foo');\n13. \t\t}\n14. \t};\n15. </script>", start_line_number=1, end_line_number=15), Context(relative_path='test/runtime/samples/bindings-before-oncreate/_config.js', content='1. export default {\n2. \ttest(assert, component) {\n3. \t\tassert.equal(component.refs.one.snapshot, 2);\n4. \t}\n5. };', start_line_number=1, end_line_number=5), Context(relative_path='test/runtime/samples/bindings-before-oncreate/main.html', content="1. <One ref:one/>\n2. \n3. <script>\n4. \timport One from './One.html';\n5. \n6. \texport default {\n7. \t\tcomponents: { One }\n8. \t};\n9. </script>", start_line_number=1, end_line_number=9), Context(relative_path='test/runtime/samples/lifecycle-events/_config.js', content="1. export default {\n2. \ttest(assert, component) {\n3. \t\tassert.deepEqual(component.events, ['create']);\n4. \t\tcomponent.destroy();\n5. \t\tassert.deepEqual(component.events, ['create', 'destroy']);\n6. \t}\n7. };", start_line_number=1, end_line_number=7), Context(relative_path='test/runtime/samples/lifecycle-events/main.html', content="1. <div></div>\n2. \n3. <script>\n4. \texport default {\n5. \t\toncreate() {\n6. \t\t\tthis.events = ['create'];\n7. \t\t},\n8. \n9. \t\tondestroy() {\n10. \t\t\tthis.events.push('destroy');\n11. \t\t}\n12. \t};\n13. </script>", start_line_number=1, end_line_number=13), Context(relative_path='test/runtime/samples/ondestroy-before-cleanup/Top.html', content='1. <div ref:element></div>\n2. \n3. <script>\n4. \texport default {\n5. \t\tondestroy() {\n6. \t\t\tthis.refOnDestroy = this.refs.element;\n7. \t\t}\n8. \t};\n9. </script>', start_line_number=1, end_line_number=9), Context(relative_path='test/runtime/samples/ondestroy-before-cleanup/_config.js', content="1. export default {\n2. \ttest(assert, component, target) {\n3. \t\tconst top = component.refs.top;\n4. \t\tconst div = target.querySelector('div');\n5. \n6. \t\tcomponent.set({ visible: false });\n7. \t\tassert.equal(top.refOnDestroy, div);\n8. \t}\n9. };", start_line_number=1, end_line_number=9), Context(relative_path='test/runtime/samples/ondestroy-before-cleanup/main.html', content="1. {{#if visible}}\n2. \t<Top ref:top></Top>\n3. {{/if}}\n4. \n5. <script>\n6. \timport Top from './Top.html';\n7. \t\n8. \texport default {\n9. \t\tdata() {\n10. \t\t\treturn {\n11. \t\t\t\tvisible: true\n12. \t\t\t};\n13. \t\t},\n14. \t\tcomponents: {\n15. \t\t\tTop\n16. \t\t}\n17. \t};\n18. </script>", start_line_number=1, end_line_number=18), Context(relative_path='test/runtime/samples/onrender-fires-when-ready-nested/ParentWidget.html', content="1. <Widget/>{{#if foo}}<Widget/>{{/if}}\n2. \n3. <script>\n4. \timport Widget from './Widget.html';\n5. \n6. \texport default {\n7. \t\tcomponents: {\n8. \t\t\tWidget\n9. \t\t}\n10. \t};\n11. </script>", start_line_number=1, end_line_number=11), Context(relative_path='test/runtime/samples/onrender-fires-when-ready-nested/Widget.html', content='1. <p ref:x>{{inDocument}}</p>\n2. \n3. <script>\n4. \texport default {\n5. \t\toncreate () {\n6. \t\t\tthis.set({ inDocument: document.contains( this.refs.x ) })\n7. \t\t}\n8. \t};\n9. </script>', start_line_number=1, end_line_number=9), Context(relative_path='test/runtime/samples/onrender-fires-when-ready-nested/_config.js', content="1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: `<div><p>true</p>\\n<p>true</p></div>`\n5. };", start_line_number=1, end_line_number=5), Context(relative_path='test/runtime/samples/onrender-fires-when-ready-nested/main.html', content="1. <div>\n2. \t<Widget/>\n3. \t<ParentWidget />\n4. </div>\n5. \n6. <script>\n7. \timport Widget from './Widget.html';\n8. \timport ParentWidget from './ParentWidget.html';\n9. \n10. \texport default {\n11. \t\tcomponents: {\n12. \t\t\tWidget,\n13. \t\t\tParentWidget\n14. \t\t}\n15. \t};\n16. </script>", start_line_number=1, end_line_number=16), Context(relative_path='test/runtime/samples/onrender-fires-when-ready/Widget.html', content='1. <p ref:x>{{inDocument}}</p>\n2. \n3. <script>\n4. \texport default {\n5. \t\toncreate () {\n6. \t\t\tthis.set({ inDocument: document.contains( this.refs.x ) })\n7. \t\t}\n8. \t};\n9. </script>', start_line_number=1, end_line_number=9), Context(relative_path='test/runtime/samples/onrender-fires-when-ready/_config.js', content="1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: `<div><p>true</p></div>`,\n5. \n6. \ttest ( assert, component, target ) {\n7. \t\tcomponent.set({ foo: true });\n8. \t\tassert.htmlEqual( target.innerHTML, `<div><p>true</p>\\n<p>true</p></div>` );\n9. \n10. \t\tcomponent.destroy();\n11. \t}\n12. };", start_line_number=1, end_line_number=12), Context(relative_path='test/runtime/samples/onrender-fires-when-ready/main.html', content="1. <div>\n2. \t<Widget/>\n3. \n4. \t{{#if foo}}\n5. \t\t<Widget/>\n6. \t{{/if}}\n7. </div>\n8. \n9. <script>\n10. \timport Widget from './Widget.html';\n11. \n12. \texport default {\n13. \t\tcomponents: {\n14. \t\t\tWidget\n15. \t\t}\n16. \t};\n17. </script>", start_line_number=1, end_line_number=17), Context(relative_path='test/runtime/samples/set-in-oncreate/_config.js', content="1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: '<p>2</p>'\n5. };", start_line_number=1, end_line_number=5), Context(relative_path='test/runtime/samples/set-in-oncreate/main.html', content='1. <p>{{foo}}</p>\n2. \n3. <script>\n4. \texport default {\n5. \t\tdata: () => ({\n6. \t\t\tfoo: 1\n7. \t\t}),\n8. \n9. \t\toncreate () {\n10. \t\t\tthis.set({ foo: 2 });\n11. \t\t}\n12. \t};\n13. </script>', start_line_number=1, end_line_number=13), Context(relative_path='test/setup.js', content='1. const fs = require(\'fs\');\n2. const path = require(\'path\');\n3. \n4. require(\'console-group\').install();\n5. require(\'source-map-support\').install();\n6. \n7. require.extensions[\'.js\'] = function(module, filename) {\n8. \tconst exports = [];\n9. \n10. \tvar code = fs.readFileSync(filename, \'utf-8\')\n11. \t\t.replace(/^import (?:\\* as )?(\\w+) from [\'"]([^\'"]+)[\'"];?/gm, \'var $1 = require("$2");\')\n12. \t\t.replace(/^import {([^}]+)} from [\'"](.+)[\'"];?/gm, \'var {$1} = require("$2");\')\n13. \t\t.replace(/^export default /gm, \'module.exports = \')\n14. \t\t.replace(/^export (const|let|var|class|function) (\\w+)/gm, (match, type, name) => {\n15. \t\t\texports.push(name);\n16. \t\t\treturn `${type} ${name}`;\n17. \t\t})\n18. \t\t.replace(/^export \\{([^}]+)\\}/gm, (match, names) => {\n19. \t\t\tnames.split(\',\').filter(Boolean).forEach(name => {\n20. \t\t\t\texports.push(name);\n21. \t\t\t});\n22. \n23. \t\t\treturn \'\';\n24. \t\t})\n25. \t\t.replace(/^export function (\\w+)/gm, \'exports.$1 = function $1\');\n26. \n27. \texports.forEach(name => {\n28. \t\tcode += `\\nexports.${name} = ${name};`;\n29. \t});\n30. \n31. \ttry {\n32. \t\treturn module._compile(code, filename);\n33. \t} catch (err) {\n34. \t\tconsole.log(code); // eslint-disable-line no-console\n35. \t\tthrow err;\n36. \t}\n37. };', start_line_number=1, end_line_number=37), Context(relative_path='test/test.js', content='1. const glob = require("glob");\n2. \n3. require("./setup");\n4. \n5. glob.sync("**/__test__.js", { cwd: "src" }).forEach(function(file) {\n6. \trequire("../src/" + file);\n7. });\n8. \n9. glob.sync("*/index.js", { cwd: "test" }).forEach(function(file) {\n10. \trequire("./" + file);\n11. });', start_line_number=1, end_line_number=11)]
2025-11-11 00:27:20,158 - thread-133013323122368.prometheus.lang_graph.nodes.bug_get_regression_tests_selection_node - DEBUG - Model response: selected_tests=[RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: This test directly exercises the oncreate lifecycle hook by mutating component state during oncreate, the very hook impacted by the async keyword handling.\n2. Impact likelihood: Changing how oncreate is compiled/executed (e.g., preserving async or altering its invocation) could affect whether state changes happen at the expected time and thus break the DOM assertion.\n3. Not skipped: The sample has no skip flags used by the runtime harness; it runs in normal test runs.', test_identifier='test/runtime/samples/set-in-oncreate'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: This test uses oncreate in a component to set data based on DOM readiness, which depends on correct oncreate behavior.\n2. Impact likelihood: If oncreate becomes async or its execution timing changes due to preserving async, the readiness check and subsequent DOM output could differ, breaking the expected HTML.\n3. Not skipped: No skip configuration for the runtime harness; executes in standard runs.', test_identifier='test/runtime/samples/onrender-fires-when-ready'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: Similar to the previous test but with nested components, it stresses oncreate timing and ordering across multiple components.\n2. Impact likelihood: Any change to oncreate semantics (such as retaining async) could have compounded effects in nested scenarios, making this test likely to catch regressions.\n3. Not skipped: No skip settings affecting runtime execution; it runs normally.', test_identifier='test/runtime/samples/onrender-fires-when-ready-nested'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: Ensures that two-way bindings are established before oncreate runs, directly probing lifecycle ordering around oncreate.\n2. Impact likelihood: Adjusting oncreate (e.g., making it async) could alter when snapshotting occurs relative to bindings, risking a regression in expected behavior.\n3. Not skipped: This sample is included in the regular runtime suite without skip flags.', test_identifier='test/runtime/samples/bindings-before-oncreate'), RegressionTestStructuredOutPut(reasoning="1. Relevance to issue: Validates lifecycle events triggered by oncreate and ondestroy, focusing on correct sequencing and presence of the 'create' event.\n2. Impact likelihood: Modifying how oncreate is compiled/invoked (to preserve async) could change event timing or dispatch behavior, potentially breaking this test.\n3. Not skipped: The sample runs under the standard runtime harness with no skip directives.", test_identifier='test/runtime/samples/lifecycle-events')]
2025-11-11 00:27:20,158 - thread-133013323122368.prometheus.lang_graph.nodes.bug_get_regression_tests_selection_node - DEBUG - 5 tests selected as regression tests
2025-11-11 00:27:20,159 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - INFO - Enter run_regression_tests_subgraph_node
2025-11-11 00:27:20,159 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - DEBUG - selected_regression_tests: ['test/runtime/samples/set-in-oncreate', 'test/runtime/samples/onrender-fires-when-ready', 'test/runtime/samples/onrender-fires-when-ready-nested', 'test/runtime/samples/bindings-before-oncreate', 'test/runtime/samples/lifecycle-events']
2025-11-11 00:27:23,789 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JDA5OeREptUvv9lyRzgl1Erm', 'function': {'arguments': '{"command":"ls -la"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 218, 'prompt_tokens': 598, 'total_tokens': 816, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ca3064f9-abd0-4752-a272-adac8783ef94-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la'}, 'id': 'call_JDA5OeREptUvv9lyRzgl1Erm', 'type': 'tool_call'}] usage_metadata={'input_tokens': 598, 'output_tokens': 218, 'total_tokens': 816, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-11 00:27:23,793 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ls -la
2025-11-11 00:27:23,894 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:27:23,894 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 744
drwxr-xr-x   1 root root   4096 Aug 28 02:26 [0m[01;34m.[0m
drwxr-xr-x   1 root root   4096 Nov 11 00:22 [01;34m..[0m
-rw-rw-r--   1 root root    227 Aug 28 02:25 .editorconfig
-rw-rw-r--   1 root root     76 Aug 28 02:25 .eslintignore
-rw-rw-r--   1 root root   1239 Aug 28 02:25 .eslintrc.json
-rw-rw-r--   1 root root     78 Aug 28 02:25 .flowconfig
drwxrwxr-x   7 root root   4096 Aug 28 02:25 [01;34m.git[0m
drwxrwxr-x   2 root root   4096 Aug 28 02:25 [01;34m.github[0m
-rw-rw-r--   1 root root    263 Aug 28 02:25 .gitignore
-rw-rw-r--   1 root root     51 Aug 28 02:25 .prettierrc
-rw-rw-r--   1 root root    270 Aug 28 02:25 .travis.yml
-rw-rw-r--   1 root root  37604 Aug 28 02:25 CHANGELOG.md
-rw-rw-r--   1 root root    251 Aug 28 02:25 Dockerfile
-rw-rw-r--   1 root root   1114 Aug 28 02:25 LICENSE
-rw-rw-r--   1 root root   6462 Aug 28 02:25 README.md
-rw-rw-r--   1 root root    556 Aug 28 02:25 appveyor.yml
-rw-rw-r--   1 root root     70 Aug 28 02:25 mocha.coverage.opts
-rw-rw-r--   1 root root     12 Aug 28 02:25 mocha.opts
drwxr-xr-x 385 root root  16384 Aug 28 02:26 [01;34mnode_modules[0m
-rw-r--r--   1 root root 470834 Aug 28 02:26 package-lock.json
-rw-rw-r--   1 root root   2284 Aug 28 02:25 package.json
-rw-rw-r--   1 root root   1668 Aug 28 02:25 rollup.config.js
drwxrwxr-x   9 root root   4096 Aug 28 02:25 [01;34msrc[0m
drwxrwxr-x  13 root root   4096 Aug 28 02:25 [01;34mtest[0m
-rw-rw-r--   1 root root    326 Aug 28 02:25 tsconfig.json
-rw-rw-r--   1 root root 138152 Aug 28 02:26 yarn.lock
[?2004l
2025-11-11 00:27:25,399 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_BlqUJa3Tr7r7L3GGnPmnp7PL', 'function': {'arguments': '{"command":"ls -la test/runtime/samples"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 94, 'prompt_tokens': 1376, 'total_tokens': 1470, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--522de841-aa60-4f1f-a555-6e148504c975-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test/runtime/samples'}, 'id': 'call_BlqUJa3Tr7r7L3GGnPmnp7PL', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1376, 'output_tokens': 94, 'total_tokens': 1470, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-11 00:27:25,402 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/runtime/samples
2025-11-11 00:27:25,505 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:27:25,505 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 1128
drwxrwxr-x 279 root root 16384 Aug 28 02:25 [0m[01;34m.[0m
drwxrwxr-x   3 root root  4096 Aug 28 02:25 [01;34m..[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-dynamic-multiple[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-dynamic-reserved[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-dynamic-shorthand[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-dynamic-type[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-empty[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-empty-svg[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-namespaced[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-partial-number[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-prefer-expression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-static-at-symbol[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-static-boolean[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mattribute-static-quotemarks[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mautofocus[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-audio-currenttime-duration[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-indirect[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-checkbox[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-checkbox-deep-contextual[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-checkbox-group[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-checkbox-group-outside-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-number[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-radio-group[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-range[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-range-change[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-text[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-text-contextual[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-text-deconflicted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-text-deep[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-text-deep-computed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-text-deep-computed-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-text-deep-contextual[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-text-deep-contextual-computed-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-input-with-event[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-select[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-select-in-each-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-select-in-yield[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-select-initial-value[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-select-initial-value-undefined[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-select-late[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-select-multiple[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbinding-textarea[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbindings-before-oncreate[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mbindings-coalesced[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-blowback[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-blowback-b[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-blowback-c[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-computed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-conditional[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-conditional-b[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-deep[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-deep-b[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-each-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-each-object[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-infinite-loop[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-binding-parent-supercedes-child[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-data-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-data-dynamic-late[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-data-dynamic-shorthand[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-data-empty[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-data-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-data-static-boolean[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-events[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-events-data[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-events-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-if-placement[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-nested-deep[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-nested-deeper[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-not-void[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-ref[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-slot-default[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-slot-fallback[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-slot-if-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-slot-if-block-before-node[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-slot-if-else-block-before-node[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-slot-named[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-slot-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-slot-nested-component[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-static-at-symbol[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-yield[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-yield-follows-element[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-yield-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-yield-multiple-in-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-yield-multiple-in-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-yield-nested-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-yield-parent[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-yield-placement[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomponent-yield-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomputed-empty[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomputed-function[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomputed-values[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomputed-values-default[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcomputed-values-function-dependency[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcss[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcss-comments[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcss-false[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcss-space-in-attribute[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mcustom-method[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdeconflict-builtins[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdeconflict-contexts[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdeconflict-non-helpers[0m
drwxrwxr-x   3 root root  4096 Aug 28 02:25 [01;34mdeconflict-self[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdeconflict-template-1[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdeconflict-template-2[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdeconflict-vars[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdefault-data[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdefault-data-function[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdefault-data-override[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdestroy-twice[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdestructuring[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdev-warning-bad-observe-arguments[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdev-warning-destroy-not-teardown[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdev-warning-destroy-twice[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdev-warning-helper[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdev-warning-missing-data[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdev-warning-missing-data-binding[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdev-warning-readonly-computed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mdev-warning-readonly-window-binding[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-containing-component-in-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-containing-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-destructured-array[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-dynamic-else-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-else[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-else-starts-empty[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-indexed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-keyed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-keyed-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-keyed-random-permute[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-keyed-unshift[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-random-permute[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-block-text-node[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-blocks-expression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-blocks-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34meach-blocks-nested-b[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34melement-invalid-name[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mempty-style-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mescape-template-literals[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mescaped-text[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-console-log[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-custom[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-custom-context[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-custom-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-custom-node-context[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-destroy[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-each-deconflicted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-event-methods[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-hoisted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-removal[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-sanitize[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-shorthand[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-shorthand-component[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevent-handler-this-methods[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevents-custom[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mevents-lifecycle[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mflush-before-bindings[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mfunction-in-expression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mget-state[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mglobals-accessible-directly[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mglobals-not-dereferenced[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mglobals-shadowed-by-data[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mglobals-shadowed-by-helpers[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mhello-world[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mhelpers[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mhelpers-not-call-expression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mhtml-entities[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mif-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mif-block-else[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mif-block-elseif[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mif-block-elseif-text[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mif-block-expression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mif-block-or[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mif-block-widget[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mignore-unchanged-attribute[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mignore-unchanged-attribute-compound[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mignore-unchanged-raw[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mignore-unchanged-tag[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mimported-renamed-components[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34minline-expressions[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34minput-list[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mlifecycle-events[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mnames-deconflicted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mnames-deconflicted-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mnbsp[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mobserve-binding-ignores-unchanged[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mobserve-component-ignores-irrelevant-changes[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mobserve-deferred[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mobserve-prevents-loop[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mondestroy-before-cleanup[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34monrender-chain[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34monrender-fires-when-ready[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34monrender-fires-when-ready-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34moptions[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mparen-wrapped-expressions[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mraw-anchor-first-child[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mraw-anchor-first-last-child[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mraw-anchor-last-child[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mraw-anchor-next-previous-sibling[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mraw-anchor-next-sibling[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mraw-anchor-previous-sibling[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mraw-mustaches[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mraw-mustaches-preserved[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mrefs[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mrefs-unset[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mselect[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mselect-bind-array[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mselect-bind-in-array[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mselect-change-handler[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mselect-no-whitespace[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mselect-one-way-bind[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mselect-one-way-bind-object[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mselect-props[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mself-reference[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mself-reference-tree[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mset-after-destroy[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mset-clones-input[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mset-in-observe[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mset-in-observe-dedupes-renders[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mset-in-oncreate[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mset-in-ondestroy[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mset-mutated-data[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mset-prevents-loop[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msetup[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msigil-static-#[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msigil-static-@[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msingle-static-element[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msingle-text-node[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mslot-in-custom-element[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mstate-deconflicted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg-attributes[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg-child-component-declared-namespace[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg-child-component-declared-namespace-shorthand[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg-class[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg-each-block-anchor[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg-each-block-namespace[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg-multiple[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg-no-whitespace[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg-xlink[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34msvg-xmlns[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtextarea-children[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtextarea-value[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-css-delay[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-delay[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-delay-in-out[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-dynamic-if-block-bidi[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-each-block-intro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-each-block-intro-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-each-block-keyed-intro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-each-block-keyed-intro-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-each-block-keyed-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-each-block-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-events[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-if-block-bidi[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-if-block-in-each-block-bidi[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-if-block-in-each-block-bidi-2[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-if-block-in-each-block-bidi-3[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-if-block-intro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-if-block-intro-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-if-else-block-dynamic-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-if-else-block-intro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-if-else-block-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-if-elseif-block-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mtransition-js-initial[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mwhitespace-each-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mwhitespace-normal[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mwindow-bind-scroll-update[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mwindow-binding-resize[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mwindow-event[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:25 [01;34mwindow-event-context[0m
[?2004l
2025-11-11 00:27:28,148 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zVoIHIunvAL66G2xNrtawveU', 'function': {'arguments': '{"command":"cat package.json"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 90, 'prompt_tokens': 12185, 'total_tokens': 12275, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3cede323-b78c-4b45-bb3d-a5a8681e75fb-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat package.json'}, 'id': 'call_zVoIHIunvAL66G2xNrtawveU', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12185, 'output_tokens': 90, 'total_tokens': 12275, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-11 00:27:28,152 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: cat package.json
2025-11-11 00:27:28,253 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:27:28,253 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
{
  "name": "svelte",
  "version": "1.41.1",
  "description": "The magical disappearing UI framework",
  "main": "compiler/svelte.js",
  "files": [
    "compiler",
    "ssr",
    "shared.js",
    "README.md"
  ],
  "scripts": {
    "test": "mocha --opts mocha.opts",
    "quicktest": "mocha --opts mocha.opts",
    "precoverage": "export COVERAGE=true && nyc mocha --opts mocha.coverage.opts",
    "coverage": "nyc report --reporter=text-lcov > coverage.lcov",
    "codecov": "codecov",
    "precodecov": "npm run coverage",
    "lint": "echo noop",
    "build": "node src/shared/_build.js && rollup -c",
    "dev": "node src/shared/_build.js && rollup -c -w",
    "pretest": "npm run build",
    "prepublishOnly": "npm run lint && npm test",
    "prettier": "prettier --write \"src/**/*.ts\""
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/sveltejs/svelte.git"
  },
  "keywords": [
    "UI",
    "framework",
    "templates",
    "templating"
  ],
  "author": "Rich Harris",
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/sveltejs/svelte/issues"
  },
  "homepage": "https://github.com/sveltejs/svelte#README",
  "devDependencies": {
    "@types/mocha": "^2.2.41",
    "@types/node": "^8.0.17",
    "acorn": "^5.1.1",
    "chalk": "^2.0.1",
    "codecov": "^2.2.0",
    "console-group": "^0.3.2",
    "css-tree": "1.0.0-alpha22",
    "eslint": "^4.3.0",
    "eslint-plugin-html": "^3.0.0",
    "eslint-plugin-import": "^2.2.0",
    "estree-walker": "^0.5.0",
    "glob": "^7.1.1",
    "jsdom": "^11.1.0",
    "locate-character": "^2.0.0",
    "magic-string": "^0.22.3",
    "mocha": "^3.2.0",
    "nightmare": "^2.10.0",
    "node-resolve": "^1.3.3",
    "nyc": "^11.1.0",
    "prettier": "^1.7.0",
    "rollup": "^0.48.2",
    "rollup-plugin-buble": "^0.15.0",
    "rollup-plugin-commonjs": "^8.0.2",
    "rollup-plugin-json": "^2.1.0",
    "rollup-plugin-node-resolve": "^3.0.0",
    "rollup-plugin-typescript": "^0.8.1",
    "rollup-plugin-virtual": "^1.0.1",
    "rollup-watch": "^4.3.1",
    "source-map": "^0.5.6",
    "source-map-support": "^0.4.8",
    "typescript": "^2.3.2"
  },
  "nyc": {
    "include": [
      "src/**/*.js",
      "shared.js"
    ],
    "exclude": [
      "src/**/__test__.js",
      "src/shared/**"
    ]
  }
}
[?2004l
2025-11-11 00:27:30,383 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_J7lpUZ0mxUwzByY8YJ7fBJox', 'function': {'arguments': '{"command":"ls -la test/runtime"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 92, 'prompt_tokens': 13037, 'total_tokens': 13129, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5f97cee3-bb15-4055-8230-ec5ac51f33bf-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test/runtime'}, 'id': 'call_J7lpUZ0mxUwzByY8YJ7fBJox', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13037, 'output_tokens': 92, 'total_tokens': 13129, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-11 00:27:30,386 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/runtime
2025-11-11 00:27:30,488 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:27:30,488 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 32
drwxrwxr-x   3 root root  4096 Aug 28 02:25 [0m[01;34m.[0m
drwxrwxr-x  13 root root  4096 Aug 28 02:25 [01;34m..[0m
-rw-rw-r--   1 root root  6066 Aug 28 02:25 index.js
drwxrwxr-x 279 root root 16384 Aug 28 02:25 [01;34msamples[0m
[?2004l
2025-11-11 00:27:31,754 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_yXXRrYqjfMMRP6lnZbt7tdh4', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/runtime/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 13218, 'total_tokens': 13248, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--fe7af3c1-2e40-4124-a0d1-6d211d8d59da-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/runtime/index.js"}, 'id': 'call_yXXRrYqjfMMRP6lnZbt7tdh4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13218, 'output_tokens': 30, 'total_tokens': 13248, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:27:31,756 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/runtime/index.js
2025-11-11 00:27:31,857 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:27:31,858 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import assert from "assert";
import * as path from "path";
import * as fs from "fs";
import * as acorn from "acorn";
import { transitionManager } from "../../shared.js";

import {
	showOutput,
	loadConfig,
	loadSvelte,
	env,
	setupHtmlEqual,
	spaces
} from "../helpers.js";

let svelte;

let compileOptions = null;

function getName(filename) {
	const base = path.basename(filename).replace(".html", "");
	return base[0].toUpperCase() + base.slice(1);
}

describe("runtime", () => {
	before(() => {
		svelte = loadSvelte(true);

		require.extensions[".html"] = function(module, filename) {
			const options = Object.assign(
				{ filename, name: getName(filename), format: 'cjs' },
				compileOptions
			);

			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);

			return module._compile(code, filename);
		};

		return setupHtmlEqual();
	});

	const failed = new Set();

	function runTest(dir, shared, hydrate) {
		if (dir[0] === ".") return;

		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);

		if (config.solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
			if (failed.has(dir)) {
				// this makes debugging easier, by only printing compiled output once
				throw new Error('skipping test, already failed');
			}

			const cwd = path.resolve(`test/runtime/samples/${dir}`);

			compileOptions = config.compileOptions || {};
			compileOptions.shared = shared;
			compileOptions.hydratable = hydrate;
			compileOptions.dev = config.dev;

			// check that no ES2015+ syntax slipped in
			if (!config.allowES2015) {
				try {
					const source = fs.readFileSync(
						`test/runtime/samples/${dir}/main.html`,
						"utf-8"
					);
					const { code } = svelte.compile(source, compileOptions);
					const startIndex = code.indexOf("function create_main_fragment"); // may change!
					if (startIndex === -1) throw new Error("missing create_main_fragment");
					const endIndex = code.lastIndexOf("export default");
					const es5 =
						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
						code.slice(startIndex, endIndex);

					acorn.parse(es5, { ecmaVersion: 5 });

					if (/Object\.assign/.test(es5)) {
						throw new Error(
							"cannot use Object.assign in generated code, as it is not supported everywhere"
						);
					}
				} catch (err) {
					failed.add(dir);
					showOutput(cwd, { shared }, svelte); // eslint-disable-line no-console
					throw err;
				}
			}

			Object.keys(require.cache)
				.filter(x => x.endsWith(".html"))
				.forEach(file => {
					delete require.cache[file];
				});

			let SvelteComponent;

			let unintendedError = null;

			const window = env();

			try {
				// set of hacks to support transition tests
				transitionManager.running = false;
				transitionManager.transitions = [];

				const raf = {
					time: 0,
					callback: null,
					tick: now => {
						raf.time = now;
						if (raf.callback) raf.callback();
					}
				};
				window.performance = { now: () => raf.time };
				global.requestAnimationFrame = cb => {
					let called = false;
					raf.callback = () => {
						if (!called) {
							called = true;
							cb();
						}
					};
				};

				global.window = window;

				try {
					SvelteComponent = require(`./samples/${dir}/main.html`);
				} catch (err) {
					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
					throw err;
				}

				global.window = window;

				// Put the constructor on window for testing
				window.SvelteComponent = SvelteComponent;

				const target = window.document.querySelector("main");

				const warnings = [];
				const warn = console.warn;
				console.warn = warning => {
					warnings.push(warning);
				};

				const options = Object.assign({}, {
					target,
					hydrate,
					data: config.data
				}, config.options || {});

				const component = new SvelteComponent(options);

				console.warn = warn;

				if (config.error) {
					unintendedError = true;
					throw new Error("Expected a runtime error");
				}

				if (config.warnings) {
					assert.deepEqual(warnings, config.warnings);
				} else if (warnings.length) {
					unintendedError = true;
					throw new Error("Received unexpected warnings");
				}

				if (config.html) {
					assert.htmlEqual(target.innerHTML, config.html);
				}

				if (config.test) {
					config.test(assert, component, target, window, raf);
				} else {
					component.destroy();
					assert.equal(target.innerHTML, "");
				}
			} catch (err) {
				if (config.error && !unintendedError) {
					config.error(assert, err);
				} else {
					failed.add(dir);
					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
					throw err;
				}
			}

			if (config.show) showOutput(cwd, { shared, hydratable: hydrate }, svelte);
		});
	}

	const shared = path.resolve("shared.js");
[?2004l
2025-11-11 00:27:33,129 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_QQpo4bV6TGjvZsSDfMLVLIRh', 'function': {'arguments': '{"command":"sed -n \'200,400p\' test/runtime/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 14568, 'total_tokens': 14598, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4bdee91b-b321-4921-b7f5-56b9fe7b0896-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '200,400p' test/runtime/index.js"}, 'id': 'call_QQpo4bV6TGjvZsSDfMLVLIRh', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14568, 'output_tokens': 30, 'total_tokens': 14598, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:27:33,132 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '200,400p' test/runtime/index.js
2025-11-11 00:27:33,234 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:27:33,234 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
	const shared = path.resolve("shared.js");
	fs.readdirSync("test/runtime/samples").forEach(dir => {
		runTest(dir, shared, false);
		runTest(dir, shared, true);
		runTest(dir, null, false);
	});

	it("fails if options.target is missing in dev mode", () => {
		const { code } = svelte.compile(`<div></div>`, {
			format: "iife",
			name: "SvelteComponent",
			dev: true
		});

		const SvelteComponent = eval(
			`(function () { ${code}; return SvelteComponent; }())`
		);

		assert.throws(() => {
			new SvelteComponent();
		}, /'target' is a required option/);
	});

	it("fails if options.hydrate is true but the component is non-hydratable", () => {
		const { code } = svelte.compile(`<div></div>`, {
			format: "iife",
			name: "SvelteComponent",
			dev: true
		});

		const SvelteComponent = eval(
			`(function () { ${code}; return SvelteComponent; }())`
		);

		assert.throws(() => {
			new SvelteComponent({
				target: {},
				hydrate: true
			});
		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
	});
});
[?2004l
2025-11-11 00:27:36,473 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_q6sbFbsxL1ecmBYhm0t1UHZS', 'function': {'arguments': '{"command":"cat mocha.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 154, 'prompt_tokens': 14933, 'total_tokens': 15087, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 14592}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--655681f2-2d81-4fee-9b75-1b49c670d54a-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat mocha.opts'}, 'id': 'call_q6sbFbsxL1ecmBYhm0t1UHZS', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14933, 'output_tokens': 154, 'total_tokens': 15087, 'input_token_details': {'audio': 0, 'cache_read': 14592}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-11 00:27:36,477 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: cat mocha.opts
2025-11-11 00:27:36,579 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:27:36,579 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-11 00:27:40,752 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_LtBN9l1kYgUYyceDzwFRzt4e', 'function': {'arguments': '{"command":"ls -la test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 155, 'prompt_tokens': 14976, 'total_tokens': 15131, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2074ee0e-170b-48c8-aab3-9ea00fbe389f-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test'}, 'id': 'call_LtBN9l1kYgUYyceDzwFRzt4e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14976, 'output_tokens': 155, 'total_tokens': 15131, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-11 00:27:40,756 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ls -la test
2025-11-11 00:27:40,857 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:27:40,857 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 68
drwxrwxr-x 13 root root 4096 Aug 28 02:25 [0m[01;34m.[0m
drwxr-xr-x  1 root root 4096 Aug 28 02:26 [01;34m..[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:25 [01;34mcreate[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:25 [01;34mcss[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:25 [01;34mcustom-elements[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:25 [01;34mformats[0m
-rw-rw-r--  1 root root 5474 Aug 28 02:25 helpers.js
drwxrwxr-x  3 root root 4096 Aug 28 02:25 [01;34mhydration[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:25 [01;34mjs[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:25 [01;34mparser[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:25 [01;34mruntime[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:25 [01;34mserver-side-rendering[0m
-rw-rw-r--  1 root root 1077 Aug 28 02:25 setup.js
drwxrwxr-x  3 root root 4096 Aug 28 02:25 [01;34msourcemaps[0m
-rw-rw-r--  1 root root  247 Aug 28 02:25 test.js
drwxrwxr-x  3 root root 4096 Aug 28 02:25 [01;34mvalidator[0m
[?2004l
2025-11-11 00:27:54,196 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_jWa53oV1CL1MIYeoPo7Z11s2', 'function': {'arguments': '{"command":"npm test -- -g \\"set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events\\""}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1149, 'prompt_tokens': 15547, 'total_tokens': 16696, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1088, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c66fa958-a109-4a70-aa11-ab3e48ac9a4e-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm test -- -g "set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events"'}, 'id': 'call_jWa53oV1CL1MIYeoPo7Z11s2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15547, 'output_tokens': 1149, 'total_tokens': 16696, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1088}}
2025-11-11 00:27:54,200 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: npm test -- -g "set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events"
2025-11-11 00:28:00,952 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:28:00,952 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
 npm test -- -g "set-in-oncreate|onrender-fires-when-r
ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events"
"
[?2004l

> svelte@1.41.1 pretest
> npm run build


> svelte@1.41.1 build
> node src/shared/_build.js && rollup -c

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m4.2s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m26ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m38ms[22m[39m

> svelte@1.41.1 test
> mocha --opts mocha.opts -g set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events


[0m[0m
[0m  runtime[0m
  [32m  ✓[0m[90m bindings-before-oncreate (shared helpers)[0m[33m (40ms)[0m
  [32m  ✓[0m[90m bindings-before-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m bindings-before-oncreate (inline helpers)[0m[33m (41ms)[0m
  [32m  ✓[0m[90m lifecycle-events (shared helpers)[0m
  [32m  ✓[0m[90m lifecycle-events (shared helpers)[0m
  [32m  ✓[0m[90m lifecycle-events (inline helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (inline helpers)[0m[33m (41ms)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (inline helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (inline helpers)[0m

[0m  ssr[0m
  [32m  ✓[0m[90m bindings-before-oncreate[0m
  [32m  ✓[0m[90m lifecycle-events[0m


[92m [0m[32m 17 passing[0m[90m (307ms)[0m

[37;40mnpm[0m [0m[36;40mnotice[0m[35m[0m 
[0m[37;40mnpm[0m [0m[36;40mnotice[0m[35m[0m New [31mmajor[39m version of npm available! [31m8.19.4[39m -> [32m11.6.2[39m
[0m[37;40mnpm[0m [0m[36;40mnotice[0m[35m[0m Changelog: [36mhttps://github.com/npm/cli/releases/tag/v11.6.2[39m
[0m[37;40mnpm[0m [0m[36;40mnotice[0m[35m[0m Run [32mnpm install -g npm@11.6.2[39m to update!
[0m[37;40mnpm[0m [0m[36;40mnotice[0m[35m[0m 
[?2004l
2025-11-11 00:28:11,688 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JQ2OuBgyJurwVMqYT0Dp5Pz7', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/test.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 803, 'prompt_tokens': 16891, 'total_tokens': 17694, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--61c8ffb3-3570-44e7-8fa5-159f84e9b4f3-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/test.js"}, 'id': 'call_JQ2OuBgyJurwVMqYT0Dp5Pz7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16891, 'output_tokens': 803, 'total_tokens': 17694, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-11 00:28:11,692 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/test.js
2025-11-11 00:28:11,793 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:28:11,793 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
const glob = require("glob");

require("./setup");

glob.sync("**/__test__.js", { cwd: "src" }).forEach(function(file) {
	require("../src/" + file);
});

glob.sync("*/index.js", { cwd: "test" }).forEach(function(file) {
	require("./" + file);
});
[?2004l
2025-11-11 00:28:20,891 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='Result:\n npm test -- -g "set-in-oncreate|onrender-fires-when-r\nready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events"\n"\n\n> svelte@1.41.1 pretest\n> npm run build\n\n\n> svelte@1.41.1 build\n> node src/shared/_build.js && rollup -c\n\n\nsrc/index.ts → compiler/svelte.js...\ncreated compiler/svelte.js in 4.2s\n\n\nsrc/server-side-rendering/register.js → ssr/register.js...\ncreated ssr/register.js in 26ms\n\n\nsrc/shared/index.js → shared.js...\ncreated shared.js in 38ms\n\n> svelte@1.41.1 test\n> mocha --opts mocha.opts -g set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events\n\n\n\n  runtime\n    ✓ bindings-before-oncreate (shared helpers) (40ms)\n    ✓ bindings-before-oncreate (shared helpers)\n    ✓ bindings-before-oncreate (inline helpers) (41ms)\n    ✓ lifecycle-events (shared helpers)\n    ✓ lifecycle-events (shared helpers)\n    ✓ lifecycle-events (inline helpers)\n    ✓ onrender-fires-when-ready (shared helpers)\n    ✓ onrender-fires-when-ready (shared helpers)\n    ✓ onrender-fires-when-ready (inline helpers) (41ms)\n    ✓ onrender-fires-when-ready-nested (shared helpers)\n    ✓ onrender-fires-when-ready-nested (shared helpers)\n    ✓ onrender-fires-when-ready-nested (inline helpers)\n    ✓ set-in-oncreate (shared helpers)\n    ✓ set-in-oncreate (shared helpers)\n    ✓ set-in-oncreate (inline helpers)\n\n  ssr\n    ✓ bindings-before-oncreate\n    ✓ lifecycle-events\n\n\n  17 passing (307ms)\n\nnpm notice \nnpm notice New major version of npm available! 8.19.4 -> 11.6.2\nnpm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2\nnpm notice Run npm install -g npm@11.6.2 to update!\nnpm notice' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1118, 'prompt_tokens': 17011, 'total_tokens': 18129, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12928}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--b4242dd2-4629-40c8-be2d-947a7e603868-0' usage_metadata={'input_tokens': 17011, 'output_tokens': 1118, 'total_tokens': 18129, 'input_token_details': {'audio': 0, 'cache_read': 12928}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-11 00:28:20,894 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_structure_node - DEBUG - Human Message: 
We have run the selected regression tests on the codebase.
The following regression tests were selected to run:
--- BEGIN SELECTED REGRESSION TESTS ---
test/runtime/samples/set-in-oncreate
test/runtime/samples/onrender-fires-when-ready
test/runtime/samples/onrender-fires-when-ready-nested
test/runtime/samples/bindings-before-oncreate
test/runtime/samples/lifecycle-events
--- END SELECTED REGRESSION TESTS ---

Run Regression Tests Logs:
--- BEGIN LOG ---
Result:
 npm test -- -g "set-in-oncreate|onrender-fires-when-r
ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events"
"

> svelte@1.41.1 pretest
> npm run build


> svelte@1.41.1 build
> node src/shared/_build.js && rollup -c


src/index.ts → compiler/svelte.js...
created compiler/svelte.js in 4.2s


src/server-side-rendering/register.js → ssr/register.js...
created ssr/register.js in 26ms


src/shared/index.js → shared.js...
created shared.js in 38ms

> svelte@1.41.1 test
> mocha --opts mocha.opts -g set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events



  runtime
    ✓ bindings-before-oncreate (shared helpers) (40ms)
    ✓ bindings-before-oncreate (shared helpers)
    ✓ bindings-before-oncreate (inline helpers) (41ms)
    ✓ lifecycle-events (shared helpers)
    ✓ lifecycle-events (shared helpers)
    ✓ lifecycle-events (inline helpers)
    ✓ onrender-fires-when-ready (shared helpers)
    ✓ onrender-fires-when-ready (shared helpers)
    ✓ onrender-fires-when-ready (inline helpers) (41ms)
    ✓ onrender-fires-when-ready-nested (shared helpers)
    ✓ onrender-fires-when-ready-nested (shared helpers)
    ✓ onrender-fires-when-ready-nested (inline helpers)
    ✓ set-in-oncreate (shared helpers)
    ✓ set-in-oncreate (shared helpers)
    ✓ set-in-oncreate (inline helpers)

  ssr
    ✓ bindings-before-oncreate
    ✓ lifecycle-events


  17 passing (307ms)

npm notice 
npm notice New major version of npm available! 8.19.4 -> 11.6.2
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
npm notice Run npm install -g npm@11.6.2 to update!
npm notice
--- END LOG ---

Please analyze the logs and determine which regression tests passed!. You should return the exact test identifier 
that we give to you.
Don't forget to return the total number of tests run!

2025-11-11 00:28:33,714 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_structure_node - DEBUG - passed_regression_tests=['test/runtime/samples/set-in-oncreate', 'test/runtime/samples/onrender-fires-when-ready', 'test/runtime/samples/onrender-fires-when-ready-nested', 'test/runtime/samples/bindings-before-oncreate', 'test/runtime/samples/lifecycle-events'] regression_test_fail_log='' total_tests_run=17
2025-11-11 00:28:33,716 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - INFO - passed_regression_tests: ['test/runtime/samples/set-in-oncreate', 'test/runtime/samples/onrender-fires-when-ready', 'test/runtime/samples/onrender-fires-when-ready-nested', 'test/runtime/samples/bindings-before-oncreate', 'test/runtime/samples/lifecycle-events']
2025-11-11 00:28:33,716 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - DEBUG - regression_test_fail_log: 
2025-11-11 00:28:33,717 - thread-133013323122368.prometheus.lang_graph.nodes.bug_get_regression_tests_subgraph_node - DEBUG - Selected 5 regression tests: ['test/runtime/samples/set-in-oncreate', 'test/runtime/samples/onrender-fires-when-ready', 'test/runtime/samples/onrender-fires-when-ready-nested', 'test/runtime/samples/bindings-before-oncreate', 'test/runtime/samples/lifecycle-events']
2025-11-11 00:28:33,718 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - Enter bug_reproduction_subgraph
2025-11-11 00:28:33,721 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_reproduction_context_message_node - DEBUG - Sending query to context provider subgraph:
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-11-11 00:28:33,723 - thread-133013323122368.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-11 00:28:33,726 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:28:53,635 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The file tree does not provide the contents of test files, sample inputs, configs, or the test harness. To return 5 complete, self-contained test cases with exact imports, setup, assertions, helper functions, and line numbers, I need the actual source of the relevant test suites and their sample directories. Without these contents, I cannot accurately extract or cite the tests or their line numbers.' query='Please provide the full content of test/js/index.js, test/runtime/index.js, test/server-side-rendering/index.js, test/helpers.js, test/setup.js, and the complete contents of these sample directories: test/js/samples/onrender-onteardown-rewritten, test/js/samples/setup-method, test/js/samples/ssr-no-oncreate-etc, test/runtime/samples/set-in-oncreate, and test/runtime/samples/onrender-fires-when-ready.' extra_requirements='If sending all files is too large, at minimum include each file’s import statements and the specific test cases/functions that exercise lifecycle method rewriting or oncreate behavior, with exact line numbers.' purpose='These files contain the test harness and the target samples needed to extract 5 relevant tests demonstrating lifecycle method handling similar to the async oncreate bug.'
2025-11-11 00:28:53,637 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of test/js/index.js, test/runtime/index.js, test/server-side-rendering/index.js, test/helpers.js, test/setup.js, and the complete contents of these sample directories: test/js/samples/onrender-onteardown-rewritten, test/js/samples/setup-method, test/js/samples/ssr-no-oncreate-etc, test/runtime/samples/set-in-oncreate, and test/runtime/samples/onrender-fires-when-ready.
2025-11-11 00:28:54,281 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-11 00:28:54,281 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-11 00:28:54,281 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-11 00:28:54,282 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-11 00:28:54,283 - thread-133013323122368.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-11 00:28:54,284 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-11 00:28:54,284 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of test/js/index.js, test/runtime/index.js, test/server-side-rendering/index.js, test/helpers.js, test/setup.js, and the complete contents of these sample directories: test/js/samples/onrender-onteardown-rewritten, test/js/samples/setup-method, test/js/samples/ssr-no-oncreate-etc, test/runtime/samples/set-in-oncreate, and test/runtime/samples/onrender-fires-when-ready.
Extra requirements: If sending all files is too large, at minimum include each file’s import statements and the specific test cases/functions that exercise lifecycle method rewriting or oncreate behavior, with exact line numbers.
Purpose: These files contain the test harness and the target samples needed to extract 5 relevant tests demonstrating lifecycle method handling similar to the async oncreate bug.
2025-11-11 00:29:03,664 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_MmSwBlYVbPJBTbTYPM6jtybp', 'function': {'arguments': '{"relative_path":"test/js/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1057, 'prompt_tokens': 2268, 'total_tokens': 3325, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1024, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0c3fc7ae-c3eb-483d-ba6f-5e57cfb26e04-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/index.js'}, 'id': 'call_MmSwBlYVbPJBTbTYPM6jtybp', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2268, 'output_tokens': 1057, 'total_tokens': 3325, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1024}}
2025-11-11 00:29:12,119 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_W0CIq2FzqcidCqtmRvCmuJaw', 'function': {'arguments': '{"relative_path":"test/runtime/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 929, 'prompt_tokens': 3426, 'total_tokens': 4355, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 896, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--185c0d03-def2-4778-bbe4-1d7ef07edff9-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/index.js'}, 'id': 'call_W0CIq2FzqcidCqtmRvCmuJaw', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3426, 'output_tokens': 929, 'total_tokens': 4355, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 896}}
2025-11-11 00:29:13,559 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zdRgeKiDwTiNyzuJKy9huq9V', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 6551, 'total_tokens': 6581, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3136b3e0-5e66-4c79-b336-aecdb991677e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/index.js'}, 'id': 'call_zdRgeKiDwTiNyzuJKy9huq9V', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6551, 'output_tokens': 30, 'total_tokens': 6581, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:14,918 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_STCyXkzZ6LreyIsX62B4vDE5', 'function': {'arguments': '{"relative_path":"test/helpers.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 7976, 'total_tokens': 8002, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3328}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--12168e50-7264-438b-9821-40dd3db3a3b1-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/helpers.js'}, 'id': 'call_STCyXkzZ6LreyIsX62B4vDE5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7976, 'output_tokens': 26, 'total_tokens': 8002, 'input_token_details': {'audio': 0, 'cache_read': 3328}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:16,143 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_c27kLDFenmtfF8mggogPO7NB', 'function': {'arguments': '{"relative_path":"test/setup.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 10730, 'total_tokens': 10756, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--01379cd3-2df2-4928-a4f8-0d6dbfa400aa-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/setup.js'}, 'id': 'call_c27kLDFenmtfF8mggogPO7NB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10730, 'output_tokens': 26, 'total_tokens': 10756, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:24,463 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_O39BEQfviXTFyTdLyg64Z46U', 'function': {'arguments': '{"relative_path":"test/runtime/samples/set-in-oncreate/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 743, 'prompt_tokens': 11341, 'total_tokens': 12084, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bb7f7b0b-9e4d-4b86-9ee6-04580f215412-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/set-in-oncreate/main.html'}, 'id': 'call_O39BEQfviXTFyTdLyg64Z46U', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11341, 'output_tokens': 743, 'total_tokens': 12084, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-11 00:29:25,926 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_bdxSmMC2BQBWaJ6wLkMTVkBG', 'function': {'arguments': '{"relative_path":"test/runtime/samples/set-in-oncreate/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 11556, 'total_tokens': 11590, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2c945ab4-08fa-4aa4-bb2a-40ea61634da9-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/set-in-oncreate/_config.js'}, 'id': 'call_bdxSmMC2BQBWaJ6wLkMTVkBG', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11556, 'output_tokens': 34, 'total_tokens': 11590, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:33,102 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_YnlWF1T12juXPn8li31ErYov', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/input.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 554, 'prompt_tokens': 11711, 'total_tokens': 12265, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3f7d4406-d876-4e90-86e4-0323e39bb685-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/input.html'}, 'id': 'call_YnlWF1T12juXPn8li31ErYov', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11711, 'output_tokens': 554, 'total_tokens': 12265, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-11 00:29:34,857 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_MBtkmZ3Y3WBUad5cuvuWeqH5', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 11887, 'total_tokens': 11924, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9022a01b-5891-4a6f-a0c1-1d54df6cd573-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/_config.js'}, 'id': 'call_MBtkmZ3Y3WBUad5cuvuWeqH5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11887, 'output_tokens': 37, 'total_tokens': 11924, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:40,276 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_LZ6XLUrb4K9KQthruSC94SF8', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/expected.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 555, 'prompt_tokens': 11959, 'total_tokens': 12514, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 7936}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--150599e0-790d-441b-b691-ef539cb9eb26-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected.js'}, 'id': 'call_LZ6XLUrb4K9KQthruSC94SF8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11959, 'output_tokens': 555, 'total_tokens': 12514, 'input_token_details': {'audio': 0, 'cache_read': 7936}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-11 00:29:41,545 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6DS5yPnCLoSnSAAu7ioAygjv', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/expected-bundle.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 12497, 'total_tokens': 12536, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 11520}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--54a5471c-4f19-4dbb-9781-afbb879c5fce-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected-bundle.js'}, 'id': 'call_6DS5yPnCLoSnSAAu7ioAygjv', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12497, 'output_tokens': 39, 'total_tokens': 12536, 'input_token_details': {'audio': 0, 'cache_read': 11520}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:43,000 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_XriIxDJJ0o23Hv4EQbgcIFkc', 'function': {'arguments': '{"relative_path":"test/js/samples/setup-method/input.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 14740, 'total_tokens': 14771, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 10752}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9ad806a1-b250-4594-865f-eda5df6d5a14-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/setup-method/input.html'}, 'id': 'call_XriIxDJJ0o23Hv4EQbgcIFkc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14740, 'output_tokens': 31, 'total_tokens': 14771, 'input_token_details': {'audio': 0, 'cache_read': 10752}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:44,397 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_43d1HO3H49e7r7tuoHRt6XIk', 'function': {'arguments': '{"relative_path":"test/js/samples/setup-method/expected.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 15030, 'total_tokens': 15062, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--66eaab0f-c37b-42ca-9d9b-0d2e2bfb62de-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/setup-method/expected.js'}, 'id': 'call_43d1HO3H49e7r7tuoHRt6XIk', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15030, 'output_tokens': 32, 'total_tokens': 15062, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:45,866 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_RLPoi1c9BOhYaqEfoo2yslgD', 'function': {'arguments': '{"relative_path":"test/js/samples/setup-method/expected-bundle.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 15561, 'total_tokens': 15595, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 11904}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--32917815-cf86-46f8-bb48-af923b8b52c5-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/setup-method/expected-bundle.js'}, 'id': 'call_RLPoi1c9BOhYaqEfoo2yslgD', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15561, 'output_tokens': 34, 'total_tokens': 15595, 'input_token_details': {'audio': 0, 'cache_read': 11904}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:47,702 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_DNIuevaOWfkpL7JwbAXCLv9K', 'function': {'arguments': '{"relative_path":"test/js/samples/ssr-no-oncreate-etc/input.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 17802, 'total_tokens': 17839, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3b6d0c2b-0456-493b-be47-824c3146a6e7-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/input.html'}, 'id': 'call_DNIuevaOWfkpL7JwbAXCLv9K', 'type': 'tool_call'}] usage_metadata={'input_tokens': 17802, 'output_tokens': 37, 'total_tokens': 17839, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:49,263 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_vcxWsPPEVd9EpivtlaYUcPcB', 'function': {'arguments': '{"relative_path":"test/js/samples/ssr-no-oncreate-etc/expected.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 18118, 'total_tokens': 18156, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--db1eb127-843d-44c5-8a1e-6fddfd98911f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/expected.js'}, 'id': 'call_vcxWsPPEVd9EpivtlaYUcPcB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18118, 'output_tokens': 38, 'total_tokens': 18156, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:50,940 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_DLsUXJ3qqQu45ZpLbWQmVTUy', 'function': {'arguments': '{"relative_path":"test/runtime/samples/onrender-fires-when-ready/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 18567, 'total_tokens': 18603, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e0cef192-3c93-4b7b-9633-b3a5c03846a2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/main.html'}, 'id': 'call_DLsUXJ3qqQu45ZpLbWQmVTUy', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18567, 'output_tokens': 36, 'total_tokens': 18603, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:52,923 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_d8xZQvnMR0taeBk1KTOWMokH', 'function': {'arguments': '{"relative_path":"test/runtime/samples/onrender-fires-when-ready/Widget.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 18805, 'total_tokens': 18842, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 14720}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--27fcad93-ef39-48b8-8e00-d34fa18e4cb9-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/Widget.html'}, 'id': 'call_d8xZQvnMR0taeBk1KTOWMokH', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18805, 'output_tokens': 37, 'total_tokens': 18842, 'input_token_details': {'audio': 0, 'cache_read': 14720}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:56,335 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_K9GII8vro8hUvrHyO50ThawN', 'function': {'arguments': '{"relative_path":"test/runtime/samples/onrender-fires-when-ready/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 19002, 'total_tokens': 19039, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--06c9071d-c93f-47d8-a593-d6f6c5083336-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/_config.js'}, 'id': 'call_K9GII8vro8hUvrHyO50ThawN', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19002, 'output_tokens': 37, 'total_tokens': 19039, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:29:58,460 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VAQicG9LtbHayCu2yfq1Zjgq', 'function': {'arguments': '{"relative_path":"test/js/samples/onrender-onteardown-rewritten/_actual.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 19252, 'total_tokens': 19289, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c547206f-e449-4bae-beac-89072bca0610-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/_actual.js'}, 'id': 'call_VAQicG9LtbHayCu2yfq1Zjgq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19252, 'output_tokens': 37, 'total_tokens': 19289, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:30:07,063 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_nJspAJRVUocdsgvslYQ4ocjz', 'function': {'arguments': '{"relative_path":"test/js/samples/ssr-no-oncreate-etc/expected-bundle.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 878, 'prompt_tokens': 19324, 'total_tokens': 20202, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 15488}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--89023fe8-81f7-429d-ada1-8ac13c25b907-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/expected-bundle.js'}, 'id': 'call_nJspAJRVUocdsgvslYQ4ocjz', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19324, 'output_tokens': 878, 'total_tokens': 20202, 'input_token_details': {'audio': 0, 'cache_read': 15488}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-11 00:30:11,896 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_5HRaLMFlZIggWHdzHGYRbe0k', 'function': {'arguments': '{"relative_path":"test/js/samples/setup-method/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 358, 'prompt_tokens': 19633, 'total_tokens': 19991, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f872e155-4f58-464f-b4f6-8a9011e7cb06-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/samples/setup-method/_config.js'}, 'id': 'call_5HRaLMFlZIggWHdzHGYRbe0k', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19633, 'output_tokens': 358, 'total_tokens': 19991, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-11 00:30:27,338 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located and read the full contents of the core test harness files: test/js/index.js, test/runtime/index.js, test/server-side-rendering/index.js, test/helpers.js, and test/setup.js. I then retrieved the complete contents for the requested sample directories, including oncreate/onrender lifecycle-related tests: test/js/samples/onrender-onteardown-rewritten, test/js/samples/setup-method, test/js/samples/ssr-no-oncreate-etc, test/runtime/samples/set-in-oncreate, and test/runtime/samples/onrender-fires-when-ready (including component subfiles like Widget.html and each directory’s expected outputs/configs where present). These reads include the import statements and the exact lines of the lifecycle methods and test configurations that exercise lifecycle method rewriting and oncreate behavior. Where a _config.js didn’t exist for a sample, I verified its absence.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1596, 'prompt_tokens': 19695, 'total_tokens': 21291, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1408, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 18560}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--d1d3e8e6-04fe-4c13-b47d-6f17c516b024-0' usage_metadata={'input_tokens': 19695, 'output_tokens': 1596, 'total_tokens': 21291, 'input_token_details': {'audio': 0, 'cache_read': 18560}, 'output_token_details': {'audio': 0, 'reasoning': 1408}}
2025-11-11 00:30:27,343 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of test/js/index.js, test/runtime/index.js, test/server-side-rendering/index.js, test/helpers.js, test/setup.js, and the complete contents of these sample directories: test/js/samples/onrender-onteardown-rewritten, test/js/samples/setup-method, test/js/samples/ssr-no-oncreate-etc, test/runtime/samples/set-in-oncreate, and test/runtime/samples/onrender-fires-when-ready.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending all files is too large, at minimum include each file’s import statements and the specific test cases/functions that exercise lifecycle method rewriting or oncreate behavior, with exact line numbers.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These files contain the test harness and the target samples needed to extract 5 relevant tests demonstrating lifecycle method handling similar to the async oncreate bug.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: test/helpers.js
Line number range: 1 - 239
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	if (test) global.__svelte_test = true;
12. 
13. 	const resolved = process.env.COVERAGE
14. 		? require.resolve('../src/index.js')
15. 		: require.resolve('../compiler/svelte.js');
16. 
17. 	delete require.cache[resolved];
18. 	return require(resolved);
19. }
20. 
21. export const svelte = loadSvelte();
22. 
23. export function exists(path) {
24. 	try {
25. 		fs.statSync(path);
26. 		return true;
27. 	} catch (err) {
28. 		return false;
29. 	}
30. }
31. 
32. export function tryToLoadJson(file) {
33. 	try {
34. 		return JSON.parse(fs.readFileSync(file));
35. 	} catch (err) {
36. 		if (err.code !== 'ENOENT') throw err;
37. 		return null;
38. 	}
39. }
40. 
41. export function tryToReadFile(file) {
42. 	try {
43. 		return fs.readFileSync(file, 'utf-8');
44. 	} catch (err) {
45. 		if (err.code !== 'ENOENT') throw err;
46. 		return null;
47. 	}
48. }
49. 
50. const { window } = new JSDOM('<main></main>');
51. global.document = window.document;
52. 
53. export function env() {
54. 	window._svelteTransitionManager = null;
55. 	window.document.body.innerHTML = '<main></main>';
56. 
57. 	return window;
58. }
59. 
60. function cleanChildren(node) {
61. 	let previous = null;
62. 
63. 	// sort attributes
64. 	const attributes = Array.from(node.attributes).sort((a, b) => {
65. 		return a.name < b.name ? -1 : 1;
66. 	});
67. 
68. 	attributes.forEach(attr => {
69. 		node.removeAttribute(attr.name);
70. 	});
71. 
72. 	attributes.forEach(attr => {
73. 		node.setAttribute(attr.name, attr.value);
74. 	});
75. 
76. 	// recurse
77. 	[...node.childNodes].forEach(child => {
78. 		if (child.nodeType === 3) {
79. 			// text
80. 			if (
81. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
82. 				node.tagName !== 'text' &&
83. 				node.tagName !== 'tspan'
84. 			) {
85. 				node.removeChild(child);
86. 			}
87. 
88. 			child.data = child.data.replace(/\s{2,}/g, '\n');
89. 
90. 			if (previous && previous.nodeType === 3) {
91. 				previous.data += child.data;
92. 				previous.data = previous.data.replace(/\s{2,}/g, '\n');
93. 
94. 				node.removeChild(child);
95. 				child = previous;
96. 			}
97. 		} else {
98. 			cleanChildren(child);
99. 		}
100. 
101. 		previous = child;
102. 	});
103. 
104. 	// collapse whitespace
105. 	if (node.firstChild && node.firstChild.nodeType === 3) {
106. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
107. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
108. 	}
109. 
110. 	if (node.lastChild && node.lastChild.nodeType === 3) {
111. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
112. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
113. 	}
114. }
115. 
116. export function normalizeHtml(window, html) {
117. 	try {
118. 		const node = window.document.createElement('div');
119. 		node.innerHTML = html
120. 			.replace(/<!--.*?-->/g, '')
121. 			.replace(/>[\s\r\n]+</g, '><')
122. 			.trim();
123. 		cleanChildren(node, '');
124. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
125. 	} catch (err) {
126. 		throw new Error(`Failed to normalize HTML:\n${html}`);
127. 	}
128. }
129. 
130. export function setupHtmlEqual() {
131. 	const window = env();
132. 
133. 	assert.htmlEqual = (actual, expected, message) => {
134. 		assert.deepEqual(
135. 			normalizeHtml(window, actual),
136. 			normalizeHtml(window, expected),
137. 			message
138. 		);
139. 	};
140. }
141. 
142. export function loadConfig(file) {
143. 	try {
144. 		const resolved = require.resolve(file);
145. 		delete require.cache[resolved];
146. 
147. 		const config = require(resolved);
148. 		return config.default || config;
149. 	} catch (err) {
150. 		if (err.code === 'MODULE_NOT_FOUND') {
151. 			return {};
152. 		}
153. 
154. 		throw err;
155. 	}
156. }
157. 
158. export function addLineNumbers(code) {
159. 	return code
160. 		.split('\n')
161. 		.map((line, i) => {
162. 			i = String(i + 1);
163. 			while (i.length < 3) i = ` ${i}`;
164. 
165. 			return (
166. 				chalk.grey(`  ${i}: `) +
167. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
168. 			);
169. 		})
170. 		.join('\n');
171. }
172. 
173. function capitalise(str) {
174. 	return str[0].toUpperCase() + str.slice(1);
175. }
176. 
177. export function showOutput(cwd, options = {}, s = svelte) {
178. 	glob.sync('**/*.html', { cwd }).forEach(file => {
179. 		if (file[0] === '_') return;
180. 		const { code } = s.compile(
181. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
182. 			Object.assign(options, {
183. 				filename: file,
184. 				name: capitalise(path.basename(file).replace(/\.html$/, ''))
185. 			})
186. 		);
187. 
188. 		console.log( // eslint-disable-line no-console
189. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
190. 		);
191. 	});
192. }
193. 
194. const start = /\n(\t+)/;
195. export function deindent(strings, ...values) {
196. 	const indentation = start.exec(strings[0])[1];
197. 	const pattern = new RegExp(`^${indentation}`, 'gm');
198. 
199. 	let result = strings[0].replace(start, '').replace(pattern, '');
200. 
201. 	let trailingIndentation = getTrailingIndentation(result);
202. 
203. 	for (let i = 1; i < strings.length; i += 1) {
204. 		let expression = values[i - 1];
205. 		const string = strings[i].replace(pattern, '');
206. 
207. 		if (Array.isArray(expression)) {
208. 			expression = expression.length ? expression.join('\n') : null;
209. 		}
210. 
211. 		if (expression || expression === '') {
212. 			const value = String(expression).replace(
213. 				/\n/g,
214. 				`\n${trailingIndentation}`
215. 			);
216. 			result += value + string;
217. 		} else {
218. 			let c = result.length;
219. 			while (/\s/.test(result[c - 1])) c -= 1;
220. 			result = result.slice(0, c) + string;
221. 		}
222. 
223. 		trailingIndentation = getTrailingIndentation(result);
224. 	}
225. 
226. 	return result.trim().replace(/\t+$/gm, '');
227. }
228. 
229. function getTrailingIndentation(str) {
230. 	let i = str.length;
231. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
232. 	return str.slice(i, str.length);
233. }
234. 
235. export function spaces(i) {
236. 	let result = '';
237. 	while (i--) result += ' ';
238. 	return result;
239. }


File: test/js/index.js
Line number range: 1 - 79
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import { rollup } from "rollup";
5. import { loadConfig, svelte } from "../helpers.js";
6. 
7. describe("js", () => {
8. 	fs.readdirSync("test/js/samples").forEach(dir => {
9. 		if (dir[0] === ".") return;
10. 
11. 		// add .solo to a sample directory name to only run that test
12. 		const solo = /\.solo/.test(dir);
13. 
14. 		if (solo && process.env.CI) {
15. 			throw new Error("Forgot to remove `solo: true` from test");
16. 		}
17. 
18. 		(solo ? it.only : it)(dir, () => {
19. 			dir = path.resolve("test/js/samples", dir);
20. 			const config = loadConfig(`${dir}/_config.js`);
21. 
22. 			const input = fs
23. 				.readFileSync(`${dir}/input.html`, "utf-8")
24. 				.replace(/\s+$/, "");
25. 
26. 			let actual;
27. 
28. 			try {
29. 				const options = Object.assign(config.options || {}, {
30. 					shared: true
31. 				});
32. 
33. 				actual = svelte.compile(input, options).code.replace(/generated by Svelte v\d+\.\d+\.\d+/, 'generated by Svelte vX.Y.Z');
34. 			} catch (err) {
35. 				console.log(err.frame);
36. 				throw err;
37. 			}
38. 
39. 			fs.writeFileSync(`${dir}/_actual.js`, actual);
40. 
41. 			return rollup({
42. 				input: `${dir}/_actual.js`,
43. 				plugins: [
44. 					{
45. 						resolveId(importee, importer) {
46. 							if (!importer) return importee;
47. 							if (importee === "svelte/shared.js")
48. 								return path.resolve("shared.js");
49. 							return null;
50. 						}
51. 					}
52. 				]
53. 			}).then(bundle => {
54. 				return bundle.generate({ format: "es" });
55. 			}).then(({ code }) => {
56. 				fs.writeFileSync(`${dir}/_actual-bundle.js`, code);
57. 
58. 				const expected = fs.readFileSync(`${dir}/expected.js`, "utf-8");
59. 				const expectedBundle = fs.readFileSync(
60. 					`${dir}/expected-bundle.js`,
61. 					"utf-8"
62. 				);
63. 
64. 				assert.equal(
65. 					actual.trim().replace(/^[ \t]+$/gm, ""),
66. 					expected.trim().replace(/^[ \t]+$/gm, "")
67. 				);
68. 
69. 				assert.equal(
70. 					code.trim().replace(/^[ \t]+$/gm, ""),
71. 					expectedBundle.trim().replace(/^[ \t]+$/gm, "")
72. 				);
73. 			}).catch(err => {
74. 				if (err.loc) console.error(err.loc);
75. 				throw err;
76. 			});
77. 		});
78. 	});
79. });


File: test/js/samples/onrender-onteardown-rewritten/expected-bundle.js
Line number range: 1 - 214
Content:
1. function noop() {}
2. 
3. function assign(target) {
4. 	var k,
5. 		source,
6. 		i = 1,
7. 		len = arguments.length;
8. 	for (; i < len; i++) {
9. 		source = arguments[i];
10. 		for (k in source) target[k] = source[k];
11. 	}
12. 
13. 	return target;
14. }
15. 
16. function blankObject() {
17. 	return Object.create(null);
18. }
19. 
20. function destroy(detach) {
21. 	this.destroy = noop;
22. 	this.fire('destroy');
23. 	this.set = this.get = noop;
24. 
25. 	if (detach !== false) this._fragment.u();
26. 	this._fragment.d();
27. 	this._fragment = this._state = null;
28. }
29. 
30. function differs(a, b) {
31. 	return a !== b || ((a && typeof a === 'object') || typeof a === 'function');
32. }
33. 
34. function dispatchObservers(component, group, changed, newState, oldState) {
35. 	for (var key in group) {
36. 		if (!changed[key]) continue;
37. 
38. 		var newValue = newState[key];
39. 		var oldValue = oldState[key];
40. 
41. 		var callbacks = group[key];
42. 		if (!callbacks) continue;
43. 
44. 		for (var i = 0; i < callbacks.length; i += 1) {
45. 			var callback = callbacks[i];
46. 			if (callback.__calling) continue;
47. 
48. 			callback.__calling = true;
49. 			callback.call(component, newValue, oldValue);
50. 			callback.__calling = false;
51. 		}
52. 	}
53. }
54. 
55. function fire(eventName, data) {
56. 	var handlers =
57. 		eventName in this._handlers && this._handlers[eventName].slice();
58. 	if (!handlers) return;
59. 
60. 	for (var i = 0; i < handlers.length; i += 1) {
61. 		handlers[i].call(this, data);
62. 	}
63. }
64. 
65. function get(key) {
66. 	return key ? this._state[key] : this._state;
67. }
68. 
69. function init(component, options) {
70. 	component.options = options;
71. 
72. 	component._observers = { pre: blankObject(), post: blankObject() };
73. 	component._handlers = blankObject();
74. 	component._root = options._root || component;
75. 	component._yield = options._yield;
76. 	component._bind = options._bind;
77. }
78. 
79. function observe(key, callback, options) {
80. 	var group = options && options.defer
81. 		? this._observers.post
82. 		: this._observers.pre;
83. 
84. 	(group[key] || (group[key] = [])).push(callback);
85. 
86. 	if (!options || options.init !== false) {
87. 		callback.__calling = true;
88. 		callback.call(this, this._state[key]);
89. 		callback.__calling = false;
90. 	}
91. 
92. 	return {
93. 		cancel: function() {
94. 			var index = group[key].indexOf(callback);
95. 			if (~index) group[key].splice(index, 1);
96. 		}
97. 	};
98. }
99. 
100. function on(eventName, handler) {
101. 	if (eventName === 'teardown') return this.on('destroy', handler);
102. 
103. 	var handlers = this._handlers[eventName] || (this._handlers[eventName] = []);
104. 	handlers.push(handler);
105. 
106. 	return {
107. 		cancel: function() {
108. 			var index = handlers.indexOf(handler);
109. 			if (~index) handlers.splice(index, 1);
110. 		}
111. 	};
112. }
113. 
114. function set(newState) {
115. 	this._set(assign({}, newState));
116. 	if (this._root._lock) return;
117. 	this._root._lock = true;
118. 	callAll(this._root._beforecreate);
119. 	callAll(this._root._oncreate);
120. 	callAll(this._root._aftercreate);
121. 	this._root._lock = false;
122. }
123. 
124. function _set(newState) {
125. 	var oldState = this._state,
126. 		changed = {},
127. 		dirty = false;
128. 
129. 	for (var key in newState) {
130. 		if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
131. 	}
132. 	if (!dirty) return;
133. 
134. 	this._state = assign({}, oldState, newState);
135. 	this._recompute(changed, this._state);
136. 	if (this._bind) this._bind(changed, this._state);
137. 	dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
138. 	this._fragment.p(changed, this._state);
139. 	dispatchObservers(this, this._observers.post, changed, this._state, oldState);
140. }
141. 
142. function callAll(fns) {
143. 	while (fns && fns.length) fns.pop()();
144. }
145. 
146. function _mount(target, anchor) {
147. 	this._fragment.m(target, anchor);
148. }
149. 
150. function _unmount() {
151. 	this._fragment.u();
152. }
153. 
154. var proto = {
155. 	destroy: destroy,
156. 	get: get,
157. 	fire: fire,
158. 	observe: observe,
159. 	on: on,
160. 	set: set,
161. 	teardown: destroy,
162. 	_recompute: noop,
163. 	_set: _set,
164. 	_mount: _mount,
165. 	_unmount: _unmount
166. };
167. 
168. /* generated by Svelte vX.Y.Z */
169. function oncreate() {}
170. 
171. function ondestroy() {}
172. 
173. function create_main_fragment(state, component) {
174. 
175. 	return {
176. 		c: noop,
177. 
178. 		m: noop,
179. 
180. 		p: noop,
181. 
182. 		u: noop,
183. 
184. 		d: noop
185. 	};
186. }
187. 
188. function SvelteComponent(options) {
189. 	init(this, options);
190. 	this._state = assign({}, options.data);
191. 
192. 	this._handlers.destroy = [ondestroy];
193. 
194. 	var _oncreate = oncreate.bind(this);
195. 
196. 	if (!options._root) {
197. 		this._oncreate = [_oncreate];
198. 	} else {
199. 	 	this._root._oncreate.push(_oncreate);
200. 	 }
201. 
202. 	this._fragment = create_main_fragment(this._state, this);
203. 
204. 	if (options.target) {
205. 		this._fragment.c();
206. 		this._fragment.m(options.target, options.anchor || null);
207. 
208. 		callAll(this._oncreate);
209. 	}
210. }
211. 
212. assign(SvelteComponent.prototype, proto);
213. 
214. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/expected.js
Line number range: 1 - 48
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";
3. 
4. function oncreate() {};
5. 
6. function ondestroy() {};
7. 
8. function create_main_fragment(state, component) {
9. 
10. 	return {
11. 		c: noop,
12. 
13. 		m: noop,
14. 
15. 		p: noop,
16. 
17. 		u: noop,
18. 
19. 		d: noop
20. 	};
21. }
22. 
23. function SvelteComponent(options) {
24. 	init(this, options);
25. 	this._state = assign({}, options.data);
26. 
27. 	this._handlers.destroy = [ondestroy]
28. 
29. 	var _oncreate = oncreate.bind(this);
30. 
31. 	if (!options._root) {
32. 		this._oncreate = [_oncreate];
33. 	} else {
34. 	 	this._root._oncreate.push(_oncreate);
35. 	 }
36. 
37. 	this._fragment = create_main_fragment(this._state, this);
38. 
39. 	if (options.target) {
40. 		this._fragment.c();
41. 		this._fragment.m(options.target, options.anchor || null);
42. 
43. 		callAll(this._oncreate);
44. 	}
45. }
46. 
47. assign(SvelteComponent.prototype, proto);
48. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/input.html
Line number range: 1 - 7
Content:
1. <script>
2. 	export default {
3. 		// this test should be removed in v2
4. 		onrender () {},
5. 		onteardown () {}
6. 	};
7. </script>


File: test/js/samples/setup-method/expected-bundle.js
Line number range: 1 - 216
Content:
1. function noop() {}
2. 
3. function assign(target) {
4. 	var k,
5. 		source,
6. 		i = 1,
7. 		len = arguments.length;
8. 	for (; i < len; i++) {
9. 		source = arguments[i];
10. 		for (k in source) target[k] = source[k];
11. 	}
12. 
13. 	return target;
14. }
15. 
16. function blankObject() {
17. 	return Object.create(null);
18. }
19. 
20. function destroy(detach) {
21. 	this.destroy = noop;
22. 	this.fire('destroy');
23. 	this.set = this.get = noop;
24. 
25. 	if (detach !== false) this._fragment.u();
26. 	this._fragment.d();
27. 	this._fragment = this._state = null;
28. }
29. 
30. function differs(a, b) {
31. 	return a !== b || ((a && typeof a === 'object') || typeof a === 'function');
32. }
33. 
34. function dispatchObservers(component, group, changed, newState, oldState) {
35. 	for (var key in group) {
36. 		if (!changed[key]) continue;
37. 
38. 		var newValue = newState[key];
39. 		var oldValue = oldState[key];
40. 
41. 		var callbacks = group[key];
42. 		if (!callbacks) continue;
43. 
44. 		for (var i = 0; i < callbacks.length; i += 1) {
45. 			var callback = callbacks[i];
46. 			if (callback.__calling) continue;
47. 
48. 			callback.__calling = true;
49. 			callback.call(component, newValue, oldValue);
50. 			callback.__calling = false;
51. 		}
52. 	}
53. }
54. 
55. function fire(eventName, data) {
56. 	var handlers =
57. 		eventName in this._handlers && this._handlers[eventName].slice();
58. 	if (!handlers) return;
59. 
60. 	for (var i = 0; i < handlers.length; i += 1) {
61. 		handlers[i].call(this, data);
62. 	}
63. }
64. 
65. function get(key) {
66. 	return key ? this._state[key] : this._state;
67. }
68. 
69. function init(component, options) {
70. 	component.options = options;
71. 
72. 	component._observers = { pre: blankObject(), post: blankObject() };
73. 	component._handlers = blankObject();
74. 	component._root = options._root || component;
75. 	component._yield = options._yield;
76. 	component._bind = options._bind;
77. }
78. 
79. function observe(key, callback, options) {
80. 	var group = options && options.defer
81. 		? this._observers.post
82. 		: this._observers.pre;
83. 
84. 	(group[key] || (group[key] = [])).push(callback);
85. 
86. 	if (!options || options.init !== false) {
87. 		callback.__calling = true;
88. 		callback.call(this, this._state[key]);
89. 		callback.__calling = false;
90. 	}
91. 
92. 	return {
93. 		cancel: function() {
94. 			var index = group[key].indexOf(callback);
95. 			if (~index) group[key].splice(index, 1);
96. 		}
97. 	};
98. }
99. 
100. function on(eventName, handler) {
101. 	if (eventName === 'teardown') return this.on('destroy', handler);
102. 
103. 	var handlers = this._handlers[eventName] || (this._handlers[eventName] = []);
104. 	handlers.push(handler);
105. 
106. 	return {
107. 		cancel: function() {
108. 			var index = handlers.indexOf(handler);
109. 			if (~index) handlers.splice(index, 1);
110. 		}
111. 	};
112. }
113. 
114. function set(newState) {
115. 	this._set(assign({}, newState));
116. 	if (this._root._lock) return;
117. 	this._root._lock = true;
118. 	callAll(this._root._beforecreate);
119. 	callAll(this._root._oncreate);
120. 	callAll(this._root._aftercreate);
121. 	this._root._lock = false;
122. }
123. 
124. function _set(newState) {
125. 	var oldState = this._state,
126. 		changed = {},
127. 		dirty = false;
128. 
129. 	for (var key in newState) {
130. 		if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
131. 	}
132. 	if (!dirty) return;
133. 
134. 	this._state = assign({}, oldState, newState);
135. 	this._recompute(changed, this._state);
136. 	if (this._bind) this._bind(changed, this._state);
137. 	dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
138. 	this._fragment.p(changed, this._state);
139. 	dispatchObservers(this, this._observers.post, changed, this._state, oldState);
140. }
141. 
142. function callAll(fns) {
143. 	while (fns && fns.length) fns.pop()();
144. }
145. 
146. function _mount(target, anchor) {
147. 	this._fragment.m(target, anchor);
148. }
149. 
150. function _unmount() {
151. 	this._fragment.u();
152. }
153. 
154. var proto = {
155. 	destroy: destroy,
156. 	get: get,
157. 	fire: fire,
158. 	observe: observe,
159. 	on: on,
160. 	set: set,
161. 	teardown: destroy,
162. 	_recompute: noop,
163. 	_set: _set,
164. 	_mount: _mount,
165. 	_unmount: _unmount
166. };
167. 
168. /* generated by Svelte vX.Y.Z */
169. var methods = {
170. 	foo ( bar ) {
171. 		console.log( bar );
172. 	}
173. };
174. 
175. function setup(Component) {
176. 	Component.SOME_CONSTANT = 42;
177. 	Component.factory = function (target) {
178. 		return new Component({
179. 			target: target
180. 		});
181. 	};
182. 	Component.prototype.foo( 'baz' );
183. }
184. 
185. function create_main_fragment(state, component) {
186. 
187. 	return {
188. 		c: noop,
189. 
190. 		m: noop,
191. 
192. 		p: noop,
193. 
194. 		u: noop,
195. 
196. 		d: noop
197. 	};
198. }
199. 
200. function SvelteComponent(options) {
201. 	init(this, options);
202. 	this._state = assign({}, options.data);
203. 
204. 	this._fragment = create_main_fragment(this._state, this);
205. 
206. 	if (options.target) {
207. 		this._fragment.c();
208. 		this._fragment.m(options.target, options.anchor || null);
209. 	}
210. }
211. 
212. assign(SvelteComponent.prototype, methods, proto);
213. 
214. setup(SvelteComponent);
215. 
216. export default SvelteComponent;


File: test/js/samples/setup-method/expected.js
Line number range: 1 - 50
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, init, noop, proto } from "svelte/shared.js";
3. 
4. var methods = {
5. 	foo ( bar ) {
6. 		console.log( bar );
7. 	}
8. };
9. 
10. function setup(Component) {
11. 	Component.SOME_CONSTANT = 42;
12. 	Component.factory = function (target) {
13. 		return new Component({
14. 			target: target
15. 		});
16. 	}
17. 	Component.prototype.foo( 'baz' );
18. }
19. 
20. function create_main_fragment(state, component) {
21. 
22. 	return {
23. 		c: noop,
24. 
25. 		m: noop,
26. 
27. 		p: noop,
28. 
29. 		u: noop,
30. 
31. 		d: noop
32. 	};
33. }
34. 
35. function SvelteComponent(options) {
36. 	init(this, options);
37. 	this._state = assign({}, options.data);
38. 
39. 	this._fragment = create_main_fragment(this._state, this);
40. 
41. 	if (options.target) {
42. 		this._fragment.c();
43. 		this._fragment.m(options.target, options.anchor || null);
44. 	}
45. }
46. 
47. assign(SvelteComponent.prototype, methods, proto);
48. 
49. setup(SvelteComponent);
50. export default SvelteComponent;


File: test/js/samples/setup-method/input.html
Line number range: 1 - 18
Content:
1. <script>
2. 	export default {
3. 		methods: {
4. 			foo ( bar ) {
5. 				console.log( bar );
6. 			}
7. 		},
8. 		setup: (Component) => {
9. 			Component.SOME_CONSTANT = 42;
10. 			Component.factory = function (target) {
11. 				return new Component({
12. 					target: target
13. 				});
14. 			}
15. 			Component.prototype.foo( 'baz' );
16. 		}
17. 	};
18. </script>


File: test/js/samples/ssr-no-oncreate-etc/expected-bundle.js
Line number range: 1 - 23
Content:
1. var SvelteComponent = {};
2. 
3. SvelteComponent.data = function() {
4. 	return {};
5. };
6. 
7. SvelteComponent.render = function(state, options) {
8. 	state = state || {};
9. 
10. 	return ``.trim();
11. };
12. 
13. SvelteComponent.renderCss = function() {
14. 	var components = [];
15. 
16. 	return {
17. 		css: components.map(x => x.css).join('\n'),
18. 		map: null,
19. 		components
20. 	};
21. };
22. 
23. module.exports = SvelteComponent;


File: test/js/samples/ssr-no-oncreate-etc/expected.js
Line number range: 1 - 37
Content:
1. "use strict";
2. 
3. var SvelteComponent = {};;
4. 
5. SvelteComponent.data = function() {
6. 	return {};
7. };
8. 
9. SvelteComponent.render = function(state, options) {
10. 	state = state || {};
11. 
12. 	return ``.trim();
13. };
14. 
15. SvelteComponent.renderCss = function() {
16. 	var components = [];
17. 
18. 	return {
19. 		css: components.map(x => x.css).join('\n'),
20. 		map: null,
21. 		components
22. 	};
23. };
24. 
25. var escaped = {
26. 	'"': '&quot;',
27. 	"'": '&#39;',
28. 	'&': '&amp;',
29. 	'<': '&lt;',
30. 	'>': '&gt;'
31. };
32. 
33. function __escape(html) {
34. 	return String(html).replace(/["'&<>]/g, match => escaped[match]);
35. }
36. 
37. module.exports = SvelteComponent;


File: test/js/samples/ssr-no-oncreate-etc/input.html
Line number range: 1 - 23
Content:
1. <script>
2. 	export default {
3. 		oncreate() {
4. 			console.log('oncreate');
5. 		},
6. 
7. 		ondestroy() {
8. 			console.log('ondestroy');
9. 		},
10. 
11. 		methods: {
12. 			foo() {
13. 				console.log('foo');
14. 			}
15. 		},
16. 
17. 		events: {
18. 			swipe(node, callback) {
19. 				// TODO implement
20. 			}
21. 		}
22. 	};
23. </script>


File: test/runtime/index.js
Line number range: 1 - 241
Content:
1. import assert from "assert";
2. import * as path from "path";
3. import * as fs from "fs";
4. import * as acorn from "acorn";
5. import { transitionManager } from "../../shared.js";
6. 
7. import {
8. 	showOutput,
9. 	loadConfig,
10. 	loadSvelte,
11. 	env,
12. 	setupHtmlEqual,
13. 	spaces
14. } from "../helpers.js";
15. 
16. let svelte;
17. 
18. let compileOptions = null;
19. 
20. function getName(filename) {
21. 	const base = path.basename(filename).replace(".html", "");
22. 	return base[0].toUpperCase() + base.slice(1);
23. }
24. 
25. describe("runtime", () => {
26. 	before(() => {
27. 		svelte = loadSvelte(true);
28. 
29. 		require.extensions[".html"] = function(module, filename) {
30. 			const options = Object.assign(
31. 				{ filename, name: getName(filename), format: 'cjs' },
32. 				compileOptions
33. 			);
34. 
35. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
36. 
37. 			return module._compile(code, filename);
38. 		};
39. 
40. 		return setupHtmlEqual();
41. 	});
42. 
43. 	const failed = new Set();
44. 
45. 	function runTest(dir, shared, hydrate) {
46. 		if (dir[0] === ".") return;
47. 
48. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
49. 
50. 		if (config.solo && process.env.CI) {
51. 			throw new Error("Forgot to remove `solo: true` from test");
52. 		}
53. 
54. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
55. 			if (failed.has(dir)) {
56. 				// this makes debugging easier, by only printing compiled output once
57. 				throw new Error('skipping test, already failed');
58. 			}
59. 
60. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
61. 
62. 			compileOptions = config.compileOptions || {};
63. 			compileOptions.shared = shared;
64. 			compileOptions.hydratable = hydrate;
65. 			compileOptions.dev = config.dev;
66. 
67. 			// check that no ES2015+ syntax slipped in
68. 			if (!config.allowES2015) {
69. 				try {
70. 					const source = fs.readFileSync(
71. 						`test/runtime/samples/${dir}/main.html`,
72. 						"utf-8"
73. 					);
74. 					const { code } = svelte.compile(source, compileOptions);
75. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
76. 					if (startIndex === -1) throw new Error("missing create_main_fragment");
77. 					const endIndex = code.lastIndexOf("export default");
78. 					const es5 =
79. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
80. 						code.slice(startIndex, endIndex);
81. 
82. 					acorn.parse(es5, { ecmaVersion: 5 });
83. 
84. 					if (/Object\.assign/.test(es5)) {
85. 						throw new Error(
86. 							"cannot use Object.assign in generated code, as it is not supported everywhere"
87. 						);
88. 					}
89. 				} catch (err) {
90. 					failed.add(dir);
91. 					showOutput(cwd, { shared }, svelte); // eslint-disable-line no-console
92. 					throw err;
93. 				}
94. 			}
95. 
96. 			Object.keys(require.cache)
97. 				.filter(x => x.endsWith(".html"))
98. 				.forEach(file => {
99. 					delete require.cache[file];
100. 				});
101. 
102. 			let SvelteComponent;
103. 
104. 			let unintendedError = null;
105. 
106. 			const window = env();
107. 
108. 			try {
109. 				// set of hacks to support transition tests
110. 				transitionManager.running = false;
111. 				transitionManager.transitions = [];
112. 
113. 				const raf = {
114. 					time: 0,
115. 					callback: null,
116. 					tick: now => {
117. 						raf.time = now;
118. 						if (raf.callback) raf.callback();
119. 					}
120. 				};
121. 				window.performance = { now: () => raf.time };
122. 				global.requestAnimationFrame = cb => {
123. 					let called = false;
124. 					raf.callback = () => {
125. 						if (!called) {
126. 							called = true;
127. 							cb();
128. 						}
129. 					};
130. 				};
131. 
132. 				global.window = window;
133. 
134. 				try {
135. 					SvelteComponent = require(`./samples/${dir}/main.html`);
136. 				} catch (err) {
137. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
138. 					throw err;
139. 				}
140. 
141. 				global.window = window;
142. 
143. 				// Put the constructor on window for testing
144. 				window.SvelteComponent = SvelteComponent;
145. 
146. 				const target = window.document.querySelector("main");
147. 
148. 				const warnings = [];
149. 				const warn = console.warn;
150. 				console.warn = warning => {
151. 					warnings.push(warning);
152. 				};
153. 
154. 				const options = Object.assign({}, {
155. 					target,
156. 					hydrate,
157. 					data: config.data
158. 				}, config.options || {});
159. 
160. 				const component = new SvelteComponent(options);
161. 
162. 				console.warn = warn;
163. 
164. 				if (config.error) {
165. 					unintendedError = true;
166. 					throw new Error("Expected a runtime error");
167. 				}
168. 
169. 				if (config.warnings) {
170. 					assert.deepEqual(warnings, config.warnings);
171. 				} else if (warnings.length) {
172. 					unintendedError = true;
173. 					throw new Error("Received unexpected warnings");
174. 				}
175. 
176. 				if (config.html) {
177. 					assert.htmlEqual(target.innerHTML, config.html);
178. 				}
179. 
180. 				if (config.test) {
181. 					config.test(assert, component, target, window, raf);
182. 				} else {
183. 					component.destroy();
184. 					assert.equal(target.innerHTML, "");
185. 				}
186. 			} catch (err) {
187. 				if (config.error && !unintendedError) {
188. 					config.error(assert, err);
189. 				} else {
190. 					failed.add(dir);
191. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
192. 					throw err;
193. 				}
194. 			}
195. 
196. 			if (config.show) showOutput(cwd, { shared, hydratable: hydrate }, svelte);
197. 		});
198. 	}
199. 
200. 	const shared = path.resolve("shared.js");
201. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
202. 		runTest(dir, shared, false);
203. 		runTest(dir, shared, true);
204. 		runTest(dir, null, false);
205. 	});
206. 
207. 	it("fails if options.target is missing in dev mode", () => {
208. 		const { code } = svelte.compile(`<div></div>`, {
209. 			format: "iife",
210. 			name: "SvelteComponent",
211. 			dev: true
212. 		});
213. 
214. 		const SvelteComponent = eval(
215. 			`(function () { ${code}; return SvelteComponent; }())`
216. 		);
217. 
218. 		assert.throws(() => {
219. 			new SvelteComponent();
220. 		}, /'target' is a required option/);
221. 	});
222. 
223. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
224. 		const { code } = svelte.compile(`<div></div>`, {
225. 			format: "iife",
226. 			name: "SvelteComponent",
227. 			dev: true
228. 		});
229. 
230. 		const SvelteComponent = eval(
231. 			`(function () { ${code}; return SvelteComponent; }())`
232. 		);
233. 
234. 		assert.throws(() => {
235. 			new SvelteComponent({
236. 				target: {},
237. 				hydrate: true
238. 			});
239. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
240. 	});
241. });


File: test/runtime/samples/onrender-fires-when-ready/Widget.html
Line number range: 1 - 9
Content:
1. <p ref:x>{{inDocument}}</p>
2. 
3. <script>
4. 	export default {
5. 		oncreate () {
6. 			this.set({ inDocument: document.contains( this.refs.x ) })
7. 		}
8. 	};
9. </script>


File: test/runtime/samples/onrender-fires-when-ready/_config.js
Line number range: 1 - 12
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: `<div><p>true</p></div>`,
5. 
6. 	test ( assert, component, target ) {
7. 		component.set({ foo: true });
8. 		assert.htmlEqual( target.innerHTML, `<div><p>true</p>\n<p>true</p></div>` );
9. 
10. 		component.destroy();
11. 	}
12. };


File: test/runtime/samples/onrender-fires-when-ready/main.html
Line number range: 1 - 17
Content:
1. <div>
2. 	<Widget/>
3. 
4. 	{{#if foo}}
5. 		<Widget/>
6. 	{{/if}}
7. </div>
8. 
9. <script>
10. 	import Widget from './Widget.html';
11. 
12. 	export default {
13. 		components: {
14. 			Widget
15. 		}
16. 	};
17. </script>


File: test/runtime/samples/set-in-oncreate/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: '<p>2</p>'
5. };


File: test/runtime/samples/set-in-oncreate/main.html
Line number range: 1 - 13
Content:
1. <p>{{foo}}</p>
2. 
3. <script>
4. 	export default {
5. 		data: () => ({
6. 			foo: 1
7. 		}),
8. 
9. 		oncreate () {
10. 			this.set({ foo: 2 });
11. 		}
12. 	};
13. </script>


File: test/server-side-rendering/index.js
Line number range: 1 - 106
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require(process.env.COVERAGE
25. 			? "../../src/server-side-rendering/register.js"
26. 			: "../../ssr/register");
27. 
28. 		return setupHtmlEqual();
29. 	});
30. 
31. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
32. 		if (dir[0] === ".") return;
33. 
34. 		// add .solo to a sample directory name to only run that test, or
35. 		// .show to always show the output. or both
36. 		const solo = /\.solo/.test(dir);
37. 		const show = /\.show/.test(dir);
38. 
39. 		if (solo && process.env.CI) {
40. 			throw new Error("Forgot to remove `solo: true` from test");
41. 		}
42. 
43. 		(solo ? it.only : it)(dir, () => {
44. 			dir = path.resolve("test/server-side-rendering/samples", dir);
45. 			try {
46. 				const component = require(`${dir}/main.html`);
47. 
48. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
49. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
50. 
51. 				const data = tryToLoadJson(`${dir}/data.json`);
52. 
53. 				const html = component.render(data);
54. 				const css = component.renderCss().css;
55. 
56. 				fs.writeFileSync(`${dir}/_actual.html`, html);
57. 				if (css) fs.writeFileSync(`${dir}/_actual.css`, css);
58. 
59. 				assert.htmlEqual(html, expectedHtml);
60. 				assert.equal(
61. 					css.replace(/^\s+/gm, ""),
62. 					expectedCss.replace(/^\s+/gm, "")
63. 				);
64. 
65. 				if (show) showOutput(dir, { generate: 'ssr' });
66. 			} catch (err) {
67. 				showOutput(dir, { generate: 'ssr' });
68. 				throw err;
69. 			}
70. 		});
71. 	});
72. 
73. 	// duplicate client-side tests, as far as possible
74. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
75. 		if (dir[0] === ".") return;
76. 
77. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
78. 
79. 		if (config.solo && process.env.CI) {
80. 			throw new Error("Forgot to remove `solo: true` from test");
81. 		}
82. 
83. 		if (config["skip-ssr"]) return;
84. 
85. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
86. 			const cwd = path.resolve("test/runtime/samples", dir);
87. 
88. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
89. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
90. 				delete require.cache[resolved];
91. 			});
92. 
93. 			try {
94. 				const component = require(`../runtime/samples/${dir}/main.html`);
95. 				const html = component.render(config.data);
96. 
97. 				if (config.html) {
98. 					assert.htmlEqual(html, config.html);
99. 				}
100. 			} catch (err) {
101. 				showOutput(cwd, { generate: "ssr" });
102. 				throw err;
103. 			}
104. 		});
105. 	});
106. });


File: test/setup.js
Line number range: 1 - 37
Content:
1. const fs = require('fs');
2. const path = require('path');
3. 
4. require('console-group').install();
5. require('source-map-support').install();
6. 
7. require.extensions['.js'] = function(module, filename) {
8. 	const exports = [];
9. 
10. 	var code = fs.readFileSync(filename, 'utf-8')
11. 		.replace(/^import (?:\* as )?(\w+) from ['"]([^'"]+)['"];?/gm, 'var $1 = require("$2");')
12. 		.replace(/^import {([^}]+)} from ['"](.+)['"];?/gm, 'var {$1} = require("$2");')
13. 		.replace(/^export default /gm, 'module.exports = ')
14. 		.replace(/^export (const|let|var|class|function) (\w+)/gm, (match, type, name) => {
15. 			exports.push(name);
16. 			return `${type} ${name}`;
17. 		})
18. 		.replace(/^export \{([^}]+)\}/gm, (match, names) => {
19. 			names.split(',').filter(Boolean).forEach(name => {
20. 				exports.push(name);
21. 			});
22. 
23. 			return '';
24. 		})
25. 		.replace(/^export function (\w+)/gm, 'exports.$1 = function $1');
26. 
27. 	exports.forEach(name => {
28. 		code += `\nexports.${name} = ${name};`;
29. 	});
30. 
31. 	try {
32. 		return module._compile(code, filename);
33. 	} catch (err) {
34. 		console.log(code); // eslint-disable-line no-console
35. 		throw err;
36. 	}
37. };

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-11 00:31:53,313 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='This is the JS compile test harness that discovers sample directories (including onrender-onteardown-rewritten), compiles them, bundles with Rollup, and asserts expected outputs. It provides the imports and the full flow needed to verify lifecycle method rewriting at the JS level.', relative_path='test/js/index.js', start_line=1, end_line=79), ContextOutput(reasoning='Sample input that defines legacy lifecycle methods onrender and onteardown; this is the source whose methods are expected to be rewritten by the compiler.', relative_path='test/js/samples/onrender-onteardown-rewritten/input.html', start_line=1, end_line=6), ContextOutput(reasoning='Expected compiled JS shows lifecycle rewrite: onrender -> oncreate (function oncreate) and onteardown -> ondestroy; establishes the presence of these generated lifecycle hooks.', relative_path='test/js/samples/onrender-onteardown-rewritten/expected.js', start_line=1, end_line=8), ContextOutput(reasoning='Constructor portion shows rewritten lifecycle wiring: destroy handlers set to ondestroy, and oncreate bound and queued for execution.', relative_path='test/js/samples/onrender-onteardown-rewritten/expected.js', start_line=23, end_line=35), ContextOutput(reasoning='Constructor finalization shows callAll(this._oncreate) being invoked after mounting, proving oncreate is executed on mount.', relative_path='test/js/samples/onrender-onteardown-rewritten/expected.js', start_line=39, end_line=45), ContextOutput(reasoning="Runtime helper maps 'teardown' to 'destroy' to support legacy event naming; relevant to onteardown behavior and its aliasing at runtime.", relative_path='test/js/samples/onrender-onteardown-rewritten/expected-bundle.js', start_line=100, end_line=112), ContextOutput(reasoning='Bundled expected output shows lifecycle rewrite at runtime: generated oncreate/ondestroy, destroy handler registration, and scheduling of oncreate; demonstrates onrender/onteardown rewriting end-to-end.', relative_path='test/js/samples/onrender-onteardown-rewritten/expected-bundle.js', start_line=168, end_line=210), ContextOutput(reasoning='Sample showing setup method transformation (requested by query). While not lifecycle-focused, it is part of the specified directories and shows importless custom setup behavior expected by the compiler tests.', relative_path='test/js/samples/setup-method/input.html', start_line=1, end_line=18), ContextOutput(reasoning='Expected JS for setup-method: demonstrates methods object merge and setup(Component) invocation; included as the query asks for this sample directory’s contents.', relative_path='test/js/samples/setup-method/expected.js', start_line=1, end_line=19), ContextOutput(reasoning='Expected JS for setup-method constructor and exports, showing how setup is applied; included to complete the requested sample directory context.', relative_path='test/js/samples/setup-method/expected.js', start_line=35, end_line=50), ContextOutput(reasoning='SSR sample input explicitly uses oncreate/ondestroy/methods/events; used to demonstrate that SSR output omits client-only lifecycle hooks like oncreate/ondestroy.', relative_path='test/js/samples/ssr-no-oncreate-etc/input.html', start_line=1, end_line=23), ContextOutput(reasoning='Expected SSR JS (CJS) output: shows no oncreate/ondestroy; contains only render and renderCss; verifies SSR excludes client lifecycle code.', relative_path='test/js/samples/ssr-no-oncreate-etc/expected.js', start_line=1, end_line=37), ContextOutput(reasoning='Expected SSR bundle output: compact version confirming absence of client lifecycle code; included for completeness of the requested sample directory.', relative_path='test/js/samples/ssr-no-oncreate-etc/expected-bundle.js', start_line=1, end_line=23), ContextOutput(reasoning='Runtime test harness imports and helpers; establishes environment for executing runtime samples where oncreate behavior is exercised.', relative_path='test/runtime/index.js', start_line=1, end_line=14), ContextOutput(reasoning='before() hook loads the compiler into require, sets up .html compilation, and configures HTML equality utilities; necessary for running runtime lifecycle tests.', relative_path='test/runtime/index.js', start_line=25, end_line=41), ContextOutput(reasoning='runTest configuration: sets compile options including hydratable flag and dev mode; part of the test harness needed to run lifecycle tests like set-in-oncreate and onrender-fires-when-ready.', relative_path='test/runtime/index.js', start_line=45, end_line=66), ContextOutput(reasoning='Clears cached .html modules and initializes the JSDOM environment along with RAF stubs; ensures oncreate runs in a DOM-ready simulated environment.', relative_path='test/runtime/index.js', start_line=96, end_line=123), ContextOutput(reasoning='Loads the compiled component for the sample under test; if it fails, shows output. This is where lifecycle code is brought into the runtime.', relative_path='test/runtime/index.js', start_line=134, end_line=139), ContextOutput(reasoning='Attaches constructor to window, selects target, captures warnings, builds options (including hydrate), and instantiates the component — the point where oncreate will fire.', relative_path='test/runtime/index.js', start_line=144, end_line=161), ContextOutput(reasoning='Post-instantiation checks: compares HTML and runs per-sample tests or destroys component; confirms effects of oncreate are visible in the DOM.', relative_path='test/runtime/index.js', start_line=176, end_line=186), ContextOutput(reasoning='Enumerates runtime samples in three modes (shared helpers, hydratable, inline) ensuring the lifecycle-related samples are executed; relevant to how the tests are run.', relative_path='test/runtime/index.js', start_line=200, end_line=206), ContextOutput(reasoning='Config for set-in-oncreate sample: explicitly marks as skip-ssr and asserts expected HTML; relevant to oncreate behavior test.', relative_path='test/runtime/samples/set-in-oncreate/_config.js', start_line=1, end_line=5), ContextOutput(reasoning='set-in-oncreate sample component: oncreate sets foo to 2; exercises async-like state change during oncreate.', relative_path='test/runtime/samples/set-in-oncreate/main.html', start_line=1, end_line=12), ContextOutput(reasoning='Widget component used by onrender-fires-when-ready sample: oncreate tests document.contains for a ref, verifying oncreate timing relative to DOM insertion.', relative_path='test/runtime/samples/onrender-fires-when-ready/Widget.html', start_line=1, end_line=8), ContextOutput(reasoning='Main component for onrender-fires-when-ready: renders Widget and conditionally another; used to test that oncreate fires when the component is in the document for both instances.', relative_path='test/runtime/samples/onrender-fires-when-ready/main.html', start_line=1, end_line=17), ContextOutput(reasoning='onrender-fires-when-ready test config: asserts initial HTML and then performs a set() to add another Widget, verifying oncreate behavior and DOM readiness.', relative_path='test/runtime/samples/onrender-fires-when-ready/_config.js', start_line=1, end_line=12), ContextOutput(reasoning='Test helpers imports, JSDOM setup, and exported svelte reference; required infrastructure for runtime tests and oncreate DOM availability.', relative_path='test/helpers.js', start_line=1, end_line=22), ContextOutput(reasoning='JSDOM window and document setup; env() resets DOM; required for lifecycle tests that query document during oncreate.', relative_path='test/helpers.js', start_line=50, end_line=58), ContextOutput(reasoning='normalizeHtml and setupHtmlEqual provide HTML normalization and assertion used to validate results of lifecycle effects in DOM.', relative_path='test/helpers.js', start_line=116, end_line=140), ContextOutput(reasoning='Server-side rendering test harness imports and helpers; sets up the environment for SSR tests involving lifecycle presence/absence.', relative_path='test/server-side-rendering/index.js', start_line=1, end_line=11), ContextOutput(reasoning='before() hook for SSR tests registers the SSR compiler and sets up HTML equality; required for running SSR samples like ssr-no-oncreate-etc.', relative_path='test/server-side-rendering/index.js', start_line=23, end_line=29), ContextOutput(reasoning='SSR samples runner: loads main.html, renders HTML and CSS, and asserts expected outputs; used by SSR tests to ensure lifecycle hooks are excluded.', relative_path='test/server-side-rendering/index.js', start_line=31, end_line=71), ContextOutput(reasoning='Duplicates runtime samples for SSR (skipping those marked skip-ssr); ensures that samples like set-in-oncreate are not run in SSR while others are verified server-side.', relative_path='test/server-side-rendering/index.js', start_line=73, end_line=106), ContextOutput(reasoning="Test setup file that transforms ES module syntax to CommonJS for Node's require; included as the query explicitly asks for test/setup.js content.", relative_path='test/setup.js', start_line=1, end_line=37)]
2025-11-11 00:31:53,323 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 34 contexts to memory for query: Please provide the full content of test/js/index.js, test/runtime/index.js, test/server-side-rendering/index.js, test/helpers.js, test/setup.js, and the complete contents of these sample directories: test/js/samples/onrender-onteardown-rewritten, test/js/samples/setup-method, test/js/samples/ssr-no-oncreate-etc, test/runtime/samples/set-in-oncreate, and test/runtime/samples/onrender-fires-when-ready.
2025-11-11 00:31:53,669 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-11 00:31:53,670 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 34 new contexts to 0 existing contexts
2025-11-11 00:31:53,671 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 34 total contexts (removed 0 duplicates)
2025-11-11 00:31:53,673 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of test/js/index.js, test/runtime/index.js, test/server-side-rendering/index.js, test/helpers.js, test/setup.js, and the complete contents of these sample directories: test/js/samples/onrender-onteardown-rewritten, test/js/samples/setup-method, test/js/samples/ssr-no-oncreate-etc, test/runtime/samples/set-in-oncreate, and test/runtime/samples/onrender-fires-when-ready.
Extra Requirements: If sending all files is too large, at minimum include each file’s import statements and the specific test cases/functions that exercise lifecycle method rewriting or oncreate behavior, with exact line numbers.
Purpose: These files contain the test harness and the target samples needed to extract 5 relevant tests demonstrating lifecycle method handling similar to the async oncreate bug.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: test/helpers.js
Line number range: 1 - 22
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	if (test) global.__svelte_test = true;
12. 
13. 	const resolved = process.env.COVERAGE
14. 		? require.resolve('../src/index.js')
15. 		: require.resolve('../compiler/svelte.js');
16. 
17. 	delete require.cache[resolved];
18. 	return require(resolved);
19. }
20. 
21. export const svelte = loadSvelte();
22. 


File: test/helpers.js
Line number range: 50 - 58
Content:
50. const { window } = new JSDOM('<main></main>');
51. global.document = window.document;
52. 
53. export function env() {
54. 	window._svelteTransitionManager = null;
55. 	window.document.body.innerHTML = '<main></main>';
56. 
57. 	return window;
58. }


File: test/helpers.js
Line number range: 116 - 140
Content:
116. export function normalizeHtml(window, html) {
117. 	try {
118. 		const node = window.document.createElement('div');
119. 		node.innerHTML = html
120. 			.replace(/<!--.*?-->/g, '')
121. 			.replace(/>[\s\r\n]+</g, '><')
122. 			.trim();
123. 		cleanChildren(node, '');
124. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
125. 	} catch (err) {
126. 		throw new Error(`Failed to normalize HTML:\n${html}`);
127. 	}
128. }
129. 
130. export function setupHtmlEqual() {
131. 	const window = env();
132. 
133. 	assert.htmlEqual = (actual, expected, message) => {
134. 		assert.deepEqual(
135. 			normalizeHtml(window, actual),
136. 			normalizeHtml(window, expected),
137. 			message
138. 		);
139. 	};
140. }


File: test/js/index.js
Line number range: 1 - 79
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import { rollup } from "rollup";
5. import { loadConfig, svelte } from "../helpers.js";
6. 
7. describe("js", () => {
8. 	fs.readdirSync("test/js/samples").forEach(dir => {
9. 		if (dir[0] === ".") return;
10. 
11. 		// add .solo to a sample directory name to only run that test
12. 		const solo = /\.solo/.test(dir);
13. 
14. 		if (solo && process.env.CI) {
15. 			throw new Error("Forgot to remove `solo: true` from test");
16. 		}
17. 
18. 		(solo ? it.only : it)(dir, () => {
19. 			dir = path.resolve("test/js/samples", dir);
20. 			const config = loadConfig(`${dir}/_config.js`);
21. 
22. 			const input = fs
23. 				.readFileSync(`${dir}/input.html`, "utf-8")
24. 				.replace(/\s+$/, "");
25. 
26. 			let actual;
27. 
28. 			try {
29. 				const options = Object.assign(config.options || {}, {
30. 					shared: true
31. 				});
32. 
33. 				actual = svelte.compile(input, options).code.replace(/generated by Svelte v\d+\.\d+\.\d+/, 'generated by Svelte vX.Y.Z');
34. 			} catch (err) {
35. 				console.log(err.frame);
36. 				throw err;
37. 			}
38. 
39. 			fs.writeFileSync(`${dir}/_actual.js`, actual);
40. 
41. 			return rollup({
42. 				input: `${dir}/_actual.js`,
43. 				plugins: [
44. 					{
45. 						resolveId(importee, importer) {
46. 							if (!importer) return importee;
47. 							if (importee === "svelte/shared.js")
48. 								return path.resolve("shared.js");
49. 							return null;
50. 						}
51. 					}
52. 				]
53. 			}).then(bundle => {
54. 				return bundle.generate({ format: "es" });
55. 			}).then(({ code }) => {
56. 				fs.writeFileSync(`${dir}/_actual-bundle.js`, code);
57. 
58. 				const expected = fs.readFileSync(`${dir}/expected.js`, "utf-8");
59. 				const expectedBundle = fs.readFileSync(
60. 					`${dir}/expected-bundle.js`,
61. 					"utf-8"
62. 				);
63. 
64. 				assert.equal(
65. 					actual.trim().replace(/^[ \t]+$/gm, ""),
66. 					expected.trim().replace(/^[ \t]+$/gm, "")
67. 				);
68. 
69. 				assert.equal(
70. 					code.trim().replace(/^[ \t]+$/gm, ""),
71. 					expectedBundle.trim().replace(/^[ \t]+$/gm, "")
72. 				);
73. 			}).catch(err => {
74. 				if (err.loc) console.error(err.loc);
75. 				throw err;
76. 			});
77. 		});
78. 	});
79. });


File: test/js/samples/onrender-onteardown-rewritten/expected-bundle.js
Line number range: 100 - 112
Content:
100. function on(eventName, handler) {
101. 	if (eventName === 'teardown') return this.on('destroy', handler);
102. 
103. 	var handlers = this._handlers[eventName] || (this._handlers[eventName] = []);
104. 	handlers.push(handler);
105. 
106. 	return {
107. 		cancel: function() {
108. 			var index = handlers.indexOf(handler);
109. 			if (~index) handlers.splice(index, 1);
110. 		}
111. 	};
112. }


File: test/js/samples/onrender-onteardown-rewritten/expected-bundle.js
Line number range: 168 - 210
Content:
168. /* generated by Svelte vX.Y.Z */
169. function oncreate() {}
170. 
171. function ondestroy() {}
172. 
173. function create_main_fragment(state, component) {
174. 
175. 	return {
176. 		c: noop,
177. 
178. 		m: noop,
179. 
180. 		p: noop,
181. 
182. 		u: noop,
183. 
184. 		d: noop
185. 	};
186. }
187. 
188. function SvelteComponent(options) {
189. 	init(this, options);
190. 	this._state = assign({}, options.data);
191. 
192. 	this._handlers.destroy = [ondestroy];
193. 
194. 	var _oncreate = oncreate.bind(this);
195. 
196. 	if (!options._root) {
197. 		this._oncreate = [_oncreate];
198. 	} else {
199. 	 	this._root._oncreate.push(_oncreate);
200. 	 }
201. 
202. 	this._fragment = create_main_fragment(this._state, this);
203. 
204. 	if (options.target) {
205. 		this._fragment.c();
206. 		this._fragment.m(options.target, options.anchor || null);
207. 
208. 		callAll(this._oncreate);
209. 	}
210. }


File: test/js/samples/onrender-onteardown-rewritten/expected.js
Line number range: 1 - 8
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";
3. 
4. function oncreate() {};
5. 
6. function ondestroy() {};
7. 
8. function create_main_fragment(state, component) {


File: test/js/samples/onrender-onteardown-rewritten/expected.js
Line number range: 23 - 35
Content:
23. function SvelteComponent(options) {
24. 	init(this, options);
25. 	this._state = assign({}, options.data);
26. 
27. 	this._handlers.destroy = [ondestroy]
28. 
29. 	var _oncreate = oncreate.bind(this);
30. 
31. 	if (!options._root) {
32. 		this._oncreate = [_oncreate];
33. 	} else {
34. 	 	this._root._oncreate.push(_oncreate);
35. 	 }


File: test/js/samples/onrender-onteardown-rewritten/expected.js
Line number range: 39 - 45
Content:
39. 	if (options.target) {
40. 		this._fragment.c();
41. 		this._fragment.m(options.target, options.anchor || null);
42. 
43. 		callAll(this._oncreate);
44. 	}
45. }


File: test/js/samples/onrender-onteardown-rewritten/input.html
Line number range: 1 - 6
Content:
1. <script>
2. 	export default {
3. 		// this test should be removed in v2
4. 		onrender () {},
5. 		onteardown () {}
6. 	};


File: test/js/samples/setup-method/expected.js
Line number range: 1 - 19
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, init, noop, proto } from "svelte/shared.js";
3. 
4. var methods = {
5. 	foo ( bar ) {
6. 		console.log( bar );
7. 	}
8. };
9. 
10. function setup(Component) {
11. 	Component.SOME_CONSTANT = 42;
12. 	Component.factory = function (target) {
13. 		return new Component({
14. 			target: target
15. 		});
16. 	}
17. 	Component.prototype.foo( 'baz' );
18. }
19. 


File: test/js/samples/setup-method/expected.js
Line number range: 35 - 50
Content:
35. function SvelteComponent(options) {
36. 	init(this, options);
37. 	this._state = assign({}, options.data);
38. 
39. 	this._fragment = create_main_fragment(this._state, this);
40. 
41. 	if (options.target) {
42. 		this._fragment.c();
43. 		this._fragment.m(options.target, options.anchor || null);
44. 	}
45. }
46. 
47. assign(SvelteComponent.prototype, methods, proto);
48. 
49. setup(SvelteComponent);
50. export default SvelteComponent;


File: test/js/samples/setup-method/input.html
Line number range: 1 - 18
Content:
1. <script>
2. 	export default {
3. 		methods: {
4. 			foo ( bar ) {
5. 				console.log( bar );
6. 			}
7. 		},
8. 		setup: (Component) => {
9. 			Component.SOME_CONSTANT = 42;
10. 			Component.factory = function (target) {
11. 				return new Component({
12. 					target: target
13. 				});
14. 			}
15. 			Component.prototype.foo( 'baz' );
16. 		}
17. 	};
18. </script>


File: test/js/samples/ssr-no-oncreate-etc/expected-bundle.js
Line number range: 1 - 23
Content:
1. var SvelteComponent = {};
2. 
3. SvelteComponent.data = function() {
4. 	return {};
5. };
6. 
7. SvelteComponent.render = function(state, options) {
8. 	state = state || {};
9. 
10. 	return ``.trim();
11. };
12. 
13. SvelteComponent.renderCss = function() {
14. 	var components = [];
15. 
16. 	return {
17. 		css: components.map(x => x.css).join('\n'),
18. 		map: null,
19. 		components
20. 	};
21. };
22. 
23. module.exports = SvelteComponent;


File: test/js/samples/ssr-no-oncreate-etc/expected.js
Line number range: 1 - 37
Content:
1. "use strict";
2. 
3. var SvelteComponent = {};;
4. 
5. SvelteComponent.data = function() {
6. 	return {};
7. };
8. 
9. SvelteComponent.render = function(state, options) {
10. 	state = state || {};
11. 
12. 	return ``.trim();
13. };
14. 
15. SvelteComponent.renderCss = function() {
16. 	var components = [];
17. 
18. 	return {
19. 		css: components.map(x => x.css).join('\n'),
20. 		map: null,
21. 		components
22. 	};
23. };
24. 
25. var escaped = {
26. 	'"': '&quot;',
27. 	"'": '&#39;',
28. 	'&': '&amp;',
29. 	'<': '&lt;',
30. 	'>': '&gt;'
31. };
32. 
33. function __escape(html) {
34. 	return String(html).replace(/["'&<>]/g, match => escaped[match]);
35. }
36. 
37. module.exports = SvelteComponent;


File: test/js/samples/ssr-no-oncreate-etc/input.html
Line number range: 1 - 23
Content:
1. <script>
2. 	export default {
3. 		oncreate() {
4. 			console.log('oncreate');
5. 		},
6. 
7. 		ondestroy() {
8. 			console.log('ondestroy');
9. 		},
10. 
11. 		methods: {
12. 			foo() {
13. 				console.log('foo');
14. 			}
15. 		},
16. 
17. 		events: {
18. 			swipe(node, callback) {
19. 				// TODO implement
20. 			}
21. 		}
22. 	};
23. </script>


File: test/runtime/index.js
Line number range: 1 - 14
Content:
1. import assert from "assert";
2. import * as path from "path";
3. import * as fs from "fs";
4. import * as acorn from "acorn";
5. import { transitionManager } from "../../shared.js";
6. 
7. import {
8. 	showOutput,
9. 	loadConfig,
10. 	loadSvelte,
11. 	env,
12. 	setupHtmlEqual,
13. 	spaces
14. } from "../helpers.js";


File: test/runtime/index.js
Line number range: 25 - 41
Content:
25. describe("runtime", () => {
26. 	before(() => {
27. 		svelte = loadSvelte(true);
28. 
29. 		require.extensions[".html"] = function(module, filename) {
30. 			const options = Object.assign(
31. 				{ filename, name: getName(filename), format: 'cjs' },
32. 				compileOptions
33. 			);
34. 
35. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
36. 
37. 			return module._compile(code, filename);
38. 		};
39. 
40. 		return setupHtmlEqual();
41. 	});


File: test/runtime/index.js
Line number range: 45 - 66
Content:
45. 	function runTest(dir, shared, hydrate) {
46. 		if (dir[0] === ".") return;
47. 
48. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
49. 
50. 		if (config.solo && process.env.CI) {
51. 			throw new Error("Forgot to remove `solo: true` from test");
52. 		}
53. 
54. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
55. 			if (failed.has(dir)) {
56. 				// this makes debugging easier, by only printing compiled output once
57. 				throw new Error('skipping test, already failed');
58. 			}
59. 
60. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
61. 
62. 			compileOptions = config.compileOptions || {};
63. 			compileOptions.shared = shared;
64. 			compileOptions.hydratable = hydrate;
65. 			compileOptions.dev = config.dev;
66. 


File: test/runtime/index.js
Line number range: 96 - 123
Content:
96. 			Object.keys(require.cache)
97. 				.filter(x => x.endsWith(".html"))
98. 				.forEach(file => {
99. 					delete require.cache[file];
100. 				});
101. 
102. 			let SvelteComponent;
103. 
104. 			let unintendedError = null;
105. 
106. 			const window = env();
107. 
108. 			try {
109. 				// set of hacks to support transition tests
110. 				transitionManager.running = false;
111. 				transitionManager.transitions = [];
112. 
113. 				const raf = {
114. 					time: 0,
115. 					callback: null,
116. 					tick: now => {
117. 						raf.time = now;
118. 						if (raf.callback) raf.callback();
119. 					}
120. 				};
121. 				window.performance = { now: () => raf.time };
122. 				global.requestAnimationFrame = cb => {
123. 					let called = false;


File: test/runtime/index.js
Line number range: 134 - 139
Content:
134. 				try {
135. 					SvelteComponent = require(`./samples/${dir}/main.html`);
136. 				} catch (err) {
137. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
138. 					throw err;
139. 				}


File: test/runtime/index.js
Line number range: 144 - 161
Content:
144. 				window.SvelteComponent = SvelteComponent;
145. 
146. 				const target = window.document.querySelector("main");
147. 
148. 				const warnings = [];
149. 				const warn = console.warn;
150. 				console.warn = warning => {
151. 					warnings.push(warning);
152. 				};
153. 
154. 				const options = Object.assign({}, {
155. 					target,
156. 					hydrate,
157. 					data: config.data
158. 				}, config.options || {});
159. 
160. 				const component = new SvelteComponent(options);
161. 


File: test/runtime/index.js
Line number range: 176 - 186
Content:
176. 				if (config.html) {
177. 					assert.htmlEqual(target.innerHTML, config.html);
178. 				}
179. 
180. 				if (config.test) {
181. 					config.test(assert, component, target, window, raf);
182. 				} else {
183. 					component.destroy();
184. 					assert.equal(target.innerHTML, "");
185. 				}
186. 			} catch (err) {


File: test/runtime/index.js
Line number range: 200 - 206
Content:
200. 	const shared = path.resolve("shared.js");
201. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
202. 		runTest(dir, shared, false);
203. 		runTest(dir, shared, true);
204. 		runTest(dir, null, false);
205. 	});
206. 


File: test/runtime/samples/onrender-fires-when-ready/Widget.html
Line number range: 1 - 8
Content:
1. <p ref:x>{{inDocument}}</p>
2. 
3. <script>
4. 	export default {
5. 		oncreate () {
6. 			this.set({ inDocument: document.contains( this.refs.x ) })
7. 		}
8. 	};


File: test/runtime/samples/onrender-fires-when-ready/_config.js
Line number range: 1 - 12
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: `<div><p>true</p></div>`,
5. 
6. 	test ( assert, component, target ) {
7. 		component.set({ foo: true });
8. 		assert.htmlEqual( target.innerHTML, `<div><p>true</p>\n<p>true</p></div>` );
9. 
10. 		component.destroy();
11. 	}
12. };


File: test/runtime/samples/onrender-fires-when-ready/main.html
Line number range: 1 - 17
Content:
1. <div>
2. 	<Widget/>
3. 
4. 	{{#if foo}}
5. 		<Widget/>
6. 	{{/if}}
7. </div>
8. 
9. <script>
10. 	import Widget from './Widget.html';
11. 
12. 	export default {
13. 		components: {
14. 			Widget
15. 		}
16. 	};
17. </script>


File: test/runtime/samples/set-in-oncreate/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: '<p>2</p>'
5. };


File: test/runtime/samples/set-in-oncreate/main.html
Line number range: 1 - 12
Content:
1. <p>{{foo}}</p>
2. 
3. <script>
4. 	export default {
5. 		data: () => ({
6. 			foo: 1
7. 		}),
8. 
9. 		oncreate () {
10. 			this.set({ foo: 2 });
11. 		}
12. 	};


File: test/server-side-rendering/index.js
Line number range: 1 - 11
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";


File: test/server-side-rendering/index.js
Line number range: 23 - 29
Content:
23. 	before(() => {
24. 		require(process.env.COVERAGE
25. 			? "../../src/server-side-rendering/register.js"
26. 			: "../../ssr/register");
27. 
28. 		return setupHtmlEqual();
29. 	});


File: test/server-side-rendering/index.js
Line number range: 31 - 71
Content:
31. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
32. 		if (dir[0] === ".") return;
33. 
34. 		// add .solo to a sample directory name to only run that test, or
35. 		// .show to always show the output. or both
36. 		const solo = /\.solo/.test(dir);
37. 		const show = /\.show/.test(dir);
38. 
39. 		if (solo && process.env.CI) {
40. 			throw new Error("Forgot to remove `solo: true` from test");
41. 		}
42. 
43. 		(solo ? it.only : it)(dir, () => {
44. 			dir = path.resolve("test/server-side-rendering/samples", dir);
45. 			try {
46. 				const component = require(`${dir}/main.html`);
47. 
48. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
49. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
50. 
51. 				const data = tryToLoadJson(`${dir}/data.json`);
52. 
53. 				const html = component.render(data);
54. 				const css = component.renderCss().css;
55. 
56. 				fs.writeFileSync(`${dir}/_actual.html`, html);
57. 				if (css) fs.writeFileSync(`${dir}/_actual.css`, css);
58. 
59. 				assert.htmlEqual(html, expectedHtml);
60. 				assert.equal(
61. 					css.replace(/^\s+/gm, ""),
62. 					expectedCss.replace(/^\s+/gm, "")
63. 				);
64. 
65. 				if (show) showOutput(dir, { generate: 'ssr' });
66. 			} catch (err) {
67. 				showOutput(dir, { generate: 'ssr' });
68. 				throw err;
69. 			}
70. 		});
71. 	});


File: test/server-side-rendering/index.js
Line number range: 73 - 106
Content:
73. 	// duplicate client-side tests, as far as possible
74. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
75. 		if (dir[0] === ".") return;
76. 
77. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
78. 
79. 		if (config.solo && process.env.CI) {
80. 			throw new Error("Forgot to remove `solo: true` from test");
81. 		}
82. 
83. 		if (config["skip-ssr"]) return;
84. 
85. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
86. 			const cwd = path.resolve("test/runtime/samples", dir);
87. 
88. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
89. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
90. 				delete require.cache[resolved];
91. 			});
92. 
93. 			try {
94. 				const component = require(`../runtime/samples/${dir}/main.html`);
95. 				const html = component.render(config.data);
96. 
97. 				if (config.html) {
98. 					assert.htmlEqual(html, config.html);
99. 				}
100. 			} catch (err) {
101. 				showOutput(cwd, { generate: "ssr" });
102. 				throw err;
103. 			}
104. 		});
105. 	});
106. });


File: test/setup.js
Line number range: 1 - 37
Content:
1. const fs = require('fs');
2. const path = require('path');
3. 
4. require('console-group').install();
5. require('source-map-support').install();
6. 
7. require.extensions['.js'] = function(module, filename) {
8. 	const exports = [];
9. 
10. 	var code = fs.readFileSync(filename, 'utf-8')
11. 		.replace(/^import (?:\* as )?(\w+) from ['"]([^'"]+)['"];?/gm, 'var $1 = require("$2");')
12. 		.replace(/^import {([^}]+)} from ['"](.+)['"];?/gm, 'var {$1} = require("$2");')
13. 		.replace(/^export default /gm, 'module.exports = ')
14. 		.replace(/^export (const|let|var|class|function) (\w+)/gm, (match, type, name) => {
15. 			exports.push(name);
16. 			return `${type} ${name}`;
17. 		})
18. 		.replace(/^export \{([^}]+)\}/gm, (match, names) => {
19. 			names.split(',').filter(Boolean).forEach(name => {
20. 				exports.push(name);
21. 			});
22. 
23. 			return '';
24. 		})
25. 		.replace(/^export function (\w+)/gm, 'exports.$1 = function $1');
26. 
27. 	exports.forEach(name => {
28. 		code += `\nexports.${name} = ${name};`;
29. 	});
30. 
31. 	try {
32. 		return module._compile(code, filename);
33. 	} catch (err) {
34. 		console.log(code); // eslint-disable-line no-console
35. 		throw err;
36. 	}
37. };

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:32:25,185 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We need to deliver 5 complete test cases around lifecycle methods (especially oncreate) similar to the async removal bug, including imports, setup, helper functions, and exact line numbers. The aggregated context already includes harness files and four relevant samples (onrender-onteardown-rewritten, setup-method, ssr-no-oncreate-etc, set-in-oncreate, onrender-fires-when-ready). To produce self-contained tests, we must include helper functions used by harnesses (e.g., loadConfig, showOutput, spaces, tryToLoadJson) from test/helpers.js, which are not fully provided. Also, we need at least one more highly relevant sample demonstrating oncreate behavior (e.g., bindings-before-oncreate or onrender-fires-when-ready-nested or lifecycle-events). Therefore, additional context is essential.' query='Please provide the full content of test/helpers.js and the complete files (with line numbers) for test/runtime/samples/bindings-before-oncreate, test/runtime/samples/onrender-fires-when-ready-nested, and test/runtime/samples/lifecycle-events.' extra_requirements='If sending all files is too large, at minimum include each file’s import statements and any test functions in _config.js, plus the main.html files containing oncreate logic, with exact line numbers.' purpose='These files supply missing helper definitions and additional lifecycle samples needed to assemble 5 complete, self-contained tests demonstrating oncreate behavior similar to the async keyword removal bug.'
2025-11-11 00:32:25,186 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of test/helpers.js and the complete files (with line numbers) for test/runtime/samples/bindings-before-oncreate, test/runtime/samples/onrender-fires-when-ready-nested, and test/runtime/samples/lifecycle-events.
2025-11-11 00:32:25,562 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: [{'query_essential_query': 'Please provide the full contents (with line numbers) of these test sample files: 1) test/runtime/samples/bindings-before-oncreate/_config.js and main.html, 2) test/runtime/samples/lifecycle-events/_config.js and main.html, 3) test/runtime/samples/onrender-fires-when-ready/_config.js and main.html, 4) test/runtime/samples/onrender-fires-when-ready-nested/_config.js and main.html, 5) test/runtime/samples/ondestroy-before-cleanup/_config.js and main.html, 6) test/runtime/samples/set-in-oncreate/_config.js and main.html, 7) test/js/samples/onrender-onteardown-rewritten/expected.js, expected-bundle.js, and input.html, 8) test/js/samples/ssr-no-oncreate-etc/_config.js, expected.js, expected-bundle.js, and input.html.', 'query_extra_requirements': 'If sending all files is too large, include at minimum each _config.js and main.html (runtime) and expected.js, expected-bundle.js, input.html (js), with all import statements and test callbacks, plus exact line numbers.', 'query_purpose': 'I need these to extract 8 complete, self-contained test cases covering lifecycle hooks where async oncreate could affect behavior.', 'memory_context_contexts': [{'relative_path': 'test/runtime/samples/bindings-before-oncreate/_config.js', 'content': '1. export default {\n2. \ttest(assert, component) {\n3. \t\tassert.equal(component.refs.one.snapshot, 2);\n4. \t}\n5. };', 'start_line_number': 1, 'end_line_number': 5}, {'relative_path': 'test/runtime/samples/bindings-before-oncreate/main.html', 'content': "1. <One ref:one/>\n2. \n3. <script>\n4. \timport One from './One.html';\n5. \n6. \texport default {\n7. \t\tcomponents: { One }\n8. \t};\n9. </script>", 'start_line_number': 1, 'end_line_number': 9}, {'relative_path': 'test/runtime/samples/lifecycle-events/_config.js', 'content': "1. export default {\n2. \ttest(assert, component) {\n3. \t\tassert.deepEqual(component.events, ['create']);\n4. \t\tcomponent.destroy();\n5. \t\tassert.deepEqual(component.events, ['create', 'destroy']);\n6. \t}\n7. };", 'start_line_number': 1, 'end_line_number': 7}, {'relative_path': 'test/runtime/samples/lifecycle-events/main.html', 'content': "1. <div></div>\n2. \n3. <script>\n4. \texport default {\n5. \t\toncreate() {\n6. \t\t\tthis.events = ['create'];\n7. \t\t},\n8. \n9. \t\tondestroy() {\n10. \t\t\tthis.events.push('destroy');\n11. \t\t}\n12. \t};\n13. </script>", 'start_line_number': 1, 'end_line_number': 13}, {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/_config.js', 'content': "1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: `<div><p>true</p></div>`,\n5. \n6. \ttest ( assert, component, target ) {\n7. \t\tcomponent.set({ foo: true });\n8. \t\tassert.htmlEqual( target.innerHTML, `<div><p>true</p>\\n<p>true</p></div>` );\n9. \n10. \t\tcomponent.destroy();\n11. \t}\n12. };", 'start_line_number': 1, 'end_line_number': 12}, {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/main.html', 'content': "1. <div>\n2. \t<Widget/>\n3. \n4. \t{{#if foo}}\n5. \t\t<Widget/>\n6. \t{{/if}}\n7. </div>\n8. \n9. <script>\n10. \timport Widget from './Widget.html';\n11. \n12. \texport default {\n13. \t\tcomponents: {\n14. \t\t\tWidget\n15. \t\t}\n16. \t};\n17. </script>", 'start_line_number': 1, 'end_line_number': 17}, {'relative_path': 'test/runtime/samples/onrender-fires-when-ready-nested/_config.js', 'content': "1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: `<div><p>true</p>\\n<p>true</p></div>`\n5. };", 'start_line_number': 1, 'end_line_number': 5}, {'relative_path': 'test/runtime/samples/onrender-fires-when-ready-nested/main.html', 'content': "1. <div>\n2. \t<Widget/>\n3. \t<ParentWidget />\n4. </div>\n5. \n6. <script>\n7. \timport Widget from './Widget.html';\n8. \timport ParentWidget from './ParentWidget.html';\n9. \n10. \texport default {\n11. \t\tcomponents: {\n12. \t\t\tWidget,\n13. \t\t\tParentWidget\n14. \t\t}\n15. \t};\n16. </script>", 'start_line_number': 1, 'end_line_number': 16}, {'relative_path': 'test/runtime/samples/ondestroy-before-cleanup/_config.js', 'content': "1. export default {\n2. \ttest(assert, component, target) {\n3. \t\tconst top = component.refs.top;\n4. \t\tconst div = target.querySelector('div');\n5. \n6. \t\tcomponent.set({ visible: false });\n7. \t\tassert.equal(top.refOnDestroy, div);\n8. \t}\n9. };", 'start_line_number': 1, 'end_line_number': 9}, {'relative_path': 'test/runtime/samples/ondestroy-before-cleanup/main.html', 'content': "1. {{#if visible}}\n2. \t<Top ref:top></Top>\n3. {{/if}}\n4. \n5. <script>\n6. \timport Top from './Top.html';\n7. \t\n8. \texport default {\n9. \t\tdata() {\n10. \t\t\treturn {\n11. \t\t\t\tvisible: true\n12. \t\t\t};\n13. \t\t},\n14. \t\tcomponents: {\n15. \t\t\tTop\n16. \t\t}\n17. \t};\n18. </script>", 'start_line_number': 1, 'end_line_number': 18}, {'relative_path': 'test/runtime/samples/set-in-oncreate/_config.js', 'content': "1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: '<p>2</p>'\n5. };", 'start_line_number': 1, 'end_line_number': 5}, {'relative_path': 'test/runtime/samples/set-in-oncreate/main.html', 'content': '1. <p>{{foo}}</p>\n2. \n3. <script>\n4. \texport default {\n5. \t\tdata: () => ({\n6. \t\t\tfoo: 1\n7. \t\t}),\n8. \n9. \t\toncreate () {\n10. \t\t\tthis.set({ foo: 2 });\n11. \t\t}\n12. \t};\n13. </script>', 'start_line_number': 1, 'end_line_number': 13}, {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected.js', 'content': '1. /* generated by Svelte vX.Y.Z */\n2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";\n3. \n4. function oncreate() {};\n5. \n6. function ondestroy() {};\n7. \n8. function create_main_fragment(state, component) {\n9. \n10. \treturn {\n11. \t\tc: noop,\n12. \n13. \t\tm: noop,\n14. \n15. \t\tp: noop,\n16. \n17. \t\tu: noop,\n18. \n19. \t\td: noop\n20. \t};\n21. }\n22. \n23. function SvelteComponent(options) {\n24. \tinit(this, options);\n25. \tthis._state = assign({}, options.data);\n26. \n27. \tthis._handlers.destroy = [ondestroy]\n28. \n29. \tvar _oncreate = oncreate.bind(this);\n30. \n31. \tif (!options._root) {\n32. \t\tthis._oncreate = [_oncreate];\n33. \t} else {\n34. \t \tthis._root._oncreate.push(_oncreate);\n35. \t }\n36. \n37. \tthis._fragment = create_main_fragment(this._state, this);\n38. \n39. \tif (options.target) {\n40. \t\tthis._fragment.c();\n41. \t\tthis._fragment.m(options.target, options.anchor || null);\n42. \n43. \t\tcallAll(this._oncreate);\n44. \t}\n45. }\n46. \n47. assign(SvelteComponent.prototype, proto);\n48. export default SvelteComponent;', 'start_line_number': 1, 'end_line_number': 48}, {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected-bundle.js', 'content': "1. function noop() {}\n2. \n3. function assign(target) {\n4. \tvar k,\n5. \t\tsource,\n6. \t\ti = 1,\n7. \t\tlen = arguments.length;\n8. \tfor (; i < len; i++) {\n9. \t\tsource = arguments[i];\n10. \t\tfor (k in source) target[k] = source[k];\n11. \t}\n12. \n13. \treturn target;\n14. }\n15. \n16. function blankObject() {\n17. \treturn Object.create(null);\n18. }\n19. \n20. function destroy(detach) {\n21. \tthis.destroy = noop;\n22. \tthis.fire('destroy');\n23. \tthis.set = this.get = noop;\n24. \n25. \tif (detach !== false) this._fragment.u();\n26. \tthis._fragment.d();\n27. \tthis._fragment = this._state = null;\n28. }\n29. \n30. function differs(a, b) {\n31. \treturn a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n32. }\n33. \n34. function dispatchObservers(component, group, changed, newState, oldState) {\n35. \tfor (var key in group) {\n36. \t\tif (!changed[key]) continue;\n37. \n38. \t\tvar newValue = newState[key];\n39. \t\tvar oldValue = oldState[key];\n40. \n41. \t\tvar callbacks = group[key];\n42. \t\tif (!callbacks) continue;\n43. \n44. \t\tfor (var i = 0; i < callbacks.length; i += 1) {\n45. \t\t\tvar callback = callbacks[i];\n46. \t\t\tif (callback.__calling) continue;\n47. \n48. \t\t\tcallback.__calling = true;\n49. \t\t\tcallback.call(component, newValue, oldValue);\n50. \t\t\tcallback.__calling = false;\n51. \t\t}\n52. \t}\n53. }\n54. \n55. function fire(eventName, data) {\n56. \tvar handlers =\n57. \t\teventName in this._handlers && this._handlers[eventName].slice();\n58. \tif (!handlers) return;\n59. \n60. \tfor (var i = 0; i < handlers.length; i += 1) {\n61. \t\thandlers[i].call(this, data);\n62. \t}\n63. }\n64. \n65. function get(key) {\n66. \treturn key ? this._state[key] : this._state;\n67. }\n68. \n69. function init(component, options) {\n70. \tcomponent.options = options;\n71. \n72. \tcomponent._observers = { pre: blankObject(), post: blankObject() };\n73. \tcomponent._handlers = blankObject();\n74. \tcomponent._root = options._root || component;\n75. \tcomponent._yield = options._yield;\n76. \tcomponent._bind = options._bind;\n77. }\n78. \n79. function observe(key, callback, options) {\n80. \tvar group = options && options.defer\n81. \t\t? this._observers.post\n82. \t\t: this._observers.pre;\n83. \n84. \t(group[key] || (group[key] = [])).push(callback);\n85. \n86. \tif (!options || options.init !== false) {\n87. \t\tcallback.__calling = true;\n88. \t\tcallback.call(this, this._state[key]);\n89. \t\tcallback.__calling = false;\n90. \t}\n91. \n92. \treturn {\n93. \t\tcancel: function() {\n94. \t\t\tvar index = group[key].indexOf(callback);\n95. \t\t\tif (~index) group[key].splice(index, 1);\n96. \t\t}\n97. \t};\n98. }\n99. \n100. function on(eventName, handler) {\n101. \tif (eventName === 'teardown') return this.on('destroy', handler);\n102. \n103. \tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n104. \thandlers.push(handler);\n105. \n106. \treturn {\n107. \t\tcancel: function() {\n108. \t\t\tvar index = handlers.indexOf(handler);\n109. \t\t\tif (~index) handlers.splice(index, 1);\n110. \t\t}\n111. \t};\n112. }\n113. \n114. function set(newState) {\n115. \tthis._set(assign({}, newState));\n116. \tif (this._root._lock) return;\n117. \tthis._root._lock = true;\n118. \tcallAll(this._root._beforecreate);\n119. \tcallAll(this._root._oncreate);\n120. \tcallAll(this._root._aftercreate);\n121. \tthis._root._lock = false;\n122. }\n123. \n124. function _set(newState) {\n125. \tvar oldState = this._state,\n126. \t\tchanged = {},\n127. \t\tdirty = false;\n128. \n129. \tfor (var key in newState) {\n130. \t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n131. \t}\n132. \tif (!dirty) return;\n133. \n134. \tthis._state = assign({}, oldState, newState);\n135. \tthis._recompute(changed, this._state);\n136. \tif (this._bind) this._bind(changed, this._state);\n137. \tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n138. \tthis._fragment.p(changed, this._state);\n139. \tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n140. }\n141. \n142. function callAll(fns) {\n143. \twhile (fns && fns.length) fns.pop()();\n144. }\n145. \n146. function _mount(target, anchor) {\n147. \tthis._fragment.m(target, anchor);\n148. }\n149. \n150. function _unmount() {\n151. \tthis._fragment.u();\n152. }\n153. \n154. var proto = {\n155. \tdestroy: destroy,\n156. \tget: get,\n157. \tfire: fire,\n158. \tobserve: observe,\n159. \ton: on,\n160. \tset: set,\n161. \tteardown: destroy,\n162. \t_recompute: noop,\n163. \t_set: _set,\n164. \t_mount: _mount,\n165. \t_unmount: _unmount\n166. };\n167. \n168. /* generated by Svelte vX.Y.Z */\n169. function oncreate() {}\n170. \n171. function ondestroy() {}\n172. \n173. function create_main_fragment(state, component) {\n174. \n175. \treturn {\n176. \t\tc: noop,\n177. \n178. \t\tm: noop,\n179. \n180. \t\tp: noop,\n181. \n182. \t\tu: noop,\n183. \n184. \t\td: noop\n185. \t};\n186. }\n187. \n188. function SvelteComponent(options) {\n189. \tinit(this, options);\n190. \tthis._state = assign({}, options.data);\n191. \n192. \tthis._handlers.destroy = [ondestroy];\n193. \n194. \tvar _oncreate = oncreate.bind(this);\n195. \n196. \tif (!options._root) {\n197. \t\tthis._oncreate = [_oncreate];\n198. \t} else {\n199. \t \tthis._root._oncreate.push(_oncreate);\n200. \t }\n201. \n202. \tthis._fragment = create_main_fragment(this._state, this);\n203. \n204. \tif (options.target) {\n205. \t\tthis._fragment.c();\n206. \t\tthis._fragment.m(options.target, options.anchor || null);\n207. \n208. \t\tcallAll(this._oncreate);\n209. \t}\n210. }\n211. \n212. assign(SvelteComponent.prototype, proto);\n213. \n214. export default SvelteComponent;", 'start_line_number': 1, 'end_line_number': 214}, {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/input.html', 'content': '1. <script>\n2. \texport default {\n3. \t\t// this test should be removed in v2\n4. \t\tonrender () {},\n5. \t\tonteardown () {}\n6. \t};\n7. </script>', 'start_line_number': 1, 'end_line_number': 7}, {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/_config.js', 'content': "1. export default {\n2. \toptions: {\n3. \t\tgenerate: 'ssr'\n4. \t}\n5. };", 'start_line_number': 1, 'end_line_number': 5}, {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/expected.js', 'content': '1. "use strict";\n2. \n3. var SvelteComponent = {};;\n4. \n5. SvelteComponent.data = function() {\n6. \treturn {};\n7. };\n8. \n9. SvelteComponent.render = function(state, options) {\n10. \tstate = state || {};\n11. \n12. \treturn ``.trim();\n13. };\n14. \n15. SvelteComponent.renderCss = function() {\n16. \tvar components = [];\n17. \n18. \treturn {\n19. \t\tcss: components.map(x => x.css).join(\'\\n\'),\n20. \t\tmap: null,\n21. \t\tcomponents\n22. \t};\n23. };\n24. \n25. var escaped = {\n26. \t\'"\': \'&quot;\',\n27. \t"\'": \'&#39;\',\n28. \t\'&\': \'&amp;\',\n29. \t\'<\': \'&lt;\',\n30. \t\'>\': \'&gt;\'\n31. };\n32. \n33. function __escape(html) {\n34. \treturn String(html).replace(/["\'&<>]/g, match => escaped[match]);\n35. }\n36. \n37. module.exports = SvelteComponent;', 'start_line_number': 1, 'end_line_number': 37}, {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/expected-bundle.js', 'content': "1. var SvelteComponent = {};\n2. \n3. SvelteComponent.data = function() {\n4. \treturn {};\n5. };\n6. \n7. SvelteComponent.render = function(state, options) {\n8. \tstate = state || {};\n9. \n10. \treturn ``.trim();\n11. };\n12. \n13. SvelteComponent.renderCss = function() {\n14. \tvar components = [];\n15. \n16. \treturn {\n17. \t\tcss: components.map(x => x.css).join('\\n'),\n18. \t\tmap: null,\n19. \t\tcomponents\n20. \t};\n21. };\n22. \n23. module.exports = SvelteComponent;", 'start_line_number': 1, 'end_line_number': 23}, {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/input.html', 'content': "1. <script>\n2. \texport default {\n3. \t\toncreate() {\n4. \t\t\tconsole.log('oncreate');\n5. \t\t},\n6. \n7. \t\tondestroy() {\n8. \t\t\tconsole.log('ondestroy');\n9. \t\t},\n10. \n11. \t\tmethods: {\n12. \t\t\tfoo() {\n13. \t\t\t\tconsole.log('foo');\n14. \t\t\t}\n15. \t\t},\n16. \n17. \t\tevents: {\n18. \t\t\tswipe(node, callback) {\n19. \t\t\t\t// TODO implement\n20. \t\t\t}\n21. \t\t}\n22. \t};\n23. </script>", 'start_line_number': 1, 'end_line_number': 23}]}, {'query_essential_query': 'Please provide the full content of test/js/index.js, test/runtime/index.js, test/server-side-rendering/index.js, test/helpers.js, test/setup.js, and the complete contents of these sample directories: test/js/samples/onrender-onteardown-rewritten, test/js/samples/setup-method, test/js/samples/ssr-no-oncreate-etc, test/runtime/samples/set-in-oncreate, and test/runtime/samples/onrender-fires-when-ready.', 'query_extra_requirements': 'If sending all files is too large, at minimum include each file’s import statements and the specific test cases/functions that exercise lifecycle method rewriting or oncreate behavior, with exact line numbers.', 'query_purpose': 'These files contain the test harness and the target samples needed to extract 5 relevant tests demonstrating lifecycle method handling similar to the async oncreate bug.', 'memory_context_contexts': [{'relative_path': 'test/js/index.js', 'content': '1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import { rollup } from "rollup";\n5. import { loadConfig, svelte } from "../helpers.js";\n6. \n7. describe("js", () => {\n8. \tfs.readdirSync("test/js/samples").forEach(dir => {\n9. \t\tif (dir[0] === ".") return;\n10. \n11. \t\t// add .solo to a sample directory name to only run that test\n12. \t\tconst solo = /\\.solo/.test(dir);\n13. \n14. \t\tif (solo && process.env.CI) {\n15. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n16. \t\t}\n17. \n18. \t\t(solo ? it.only : it)(dir, () => {\n19. \t\t\tdir = path.resolve("test/js/samples", dir);\n20. \t\t\tconst config = loadConfig(`${dir}/_config.js`);\n21. \n22. \t\t\tconst input = fs\n23. \t\t\t\t.readFileSync(`${dir}/input.html`, "utf-8")\n24. \t\t\t\t.replace(/\\s+$/, "");\n25. \n26. \t\t\tlet actual;\n27. \n28. \t\t\ttry {\n29. \t\t\t\tconst options = Object.assign(config.options || {}, {\n30. \t\t\t\t\tshared: true\n31. \t\t\t\t});\n32. \n33. \t\t\t\tactual = svelte.compile(input, options).code.replace(/generated by Svelte v\\d+\\.\\d+\\.\\d+/, \'generated by Svelte vX.Y.Z\');\n34. \t\t\t} catch (err) {\n35. \t\t\t\tconsole.log(err.frame);\n36. \t\t\t\tthrow err;\n37. \t\t\t}\n38. \n39. \t\t\tfs.writeFileSync(`${dir}/_actual.js`, actual);\n40. \n41. \t\t\treturn rollup({\n42. \t\t\t\tinput: `${dir}/_actual.js`,\n43. \t\t\t\tplugins: [\n44. \t\t\t\t\t{\n45. \t\t\t\t\t\tresolveId(importee, importer) {\n46. \t\t\t\t\t\t\tif (!importer) return importee;\n47. \t\t\t\t\t\t\tif (importee === "svelte/shared.js")\n48. \t\t\t\t\t\t\t\treturn path.resolve("shared.js");\n49. \t\t\t\t\t\t\treturn null;\n50. \t\t\t\t\t\t}\n51. \t\t\t\t\t}\n52. \t\t\t\t]\n53. \t\t\t}).then(bundle => {\n54. \t\t\t\treturn bundle.generate({ format: "es" });\n55. \t\t\t}).then(({ code }) => {\n56. \t\t\t\tfs.writeFileSync(`${dir}/_actual-bundle.js`, code);\n57. \n58. \t\t\t\tconst expected = fs.readFileSync(`${dir}/expected.js`, "utf-8");\n59. \t\t\t\tconst expectedBundle = fs.readFileSync(\n60. \t\t\t\t\t`${dir}/expected-bundle.js`,\n61. \t\t\t\t\t"utf-8"\n62. \t\t\t\t);\n63. \n64. \t\t\t\tassert.equal(\n65. \t\t\t\t\tactual.trim().replace(/^[ \\t]+$/gm, ""),\n66. \t\t\t\t\texpected.trim().replace(/^[ \\t]+$/gm, "")\n67. \t\t\t\t);\n68. \n69. \t\t\t\tassert.equal(\n70. \t\t\t\t\tcode.trim().replace(/^[ \\t]+$/gm, ""),\n71. \t\t\t\t\texpectedBundle.trim().replace(/^[ \\t]+$/gm, "")\n72. \t\t\t\t);\n73. \t\t\t}).catch(err => {\n74. \t\t\t\tif (err.loc) console.error(err.loc);\n75. \t\t\t\tthrow err;\n76. \t\t\t});\n77. \t\t});\n78. \t});\n79. });', 'start_line_number': 1, 'end_line_number': 79}, {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/input.html', 'content': '1. <script>\n2. \texport default {\n3. \t\t// this test should be removed in v2\n4. \t\tonrender () {},\n5. \t\tonteardown () {}\n6. \t};', 'start_line_number': 1, 'end_line_number': 6}, {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected.js', 'content': '1. /* generated by Svelte vX.Y.Z */\n2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";\n3. \n4. function oncreate() {};\n5. \n6. function ondestroy() {};\n7. \n8. function create_main_fragment(state, component) {', 'start_line_number': 1, 'end_line_number': 8}, {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected.js', 'content': '23. function SvelteComponent(options) {\n24. \tinit(this, options);\n25. \tthis._state = assign({}, options.data);\n26. \n27. \tthis._handlers.destroy = [ondestroy]\n28. \n29. \tvar _oncreate = oncreate.bind(this);\n30. \n31. \tif (!options._root) {\n32. \t\tthis._oncreate = [_oncreate];\n33. \t} else {\n34. \t \tthis._root._oncreate.push(_oncreate);\n35. \t }', 'start_line_number': 23, 'end_line_number': 35}, {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected.js', 'content': '39. \tif (options.target) {\n40. \t\tthis._fragment.c();\n41. \t\tthis._fragment.m(options.target, options.anchor || null);\n42. \n43. \t\tcallAll(this._oncreate);\n44. \t}\n45. }', 'start_line_number': 39, 'end_line_number': 45}, {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected-bundle.js', 'content': "100. function on(eventName, handler) {\n101. \tif (eventName === 'teardown') return this.on('destroy', handler);\n102. \n103. \tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n104. \thandlers.push(handler);\n105. \n106. \treturn {\n107. \t\tcancel: function() {\n108. \t\t\tvar index = handlers.indexOf(handler);\n109. \t\t\tif (~index) handlers.splice(index, 1);\n110. \t\t}\n111. \t};\n112. }", 'start_line_number': 100, 'end_line_number': 112}, {'relative_path': 'test/js/samples/onrender-onteardown-rewritten/expected-bundle.js', 'content': '168. /* generated by Svelte vX.Y.Z */\n169. function oncreate() {}\n170. \n171. function ondestroy() {}\n172. \n173. function create_main_fragment(state, component) {\n174. \n175. \treturn {\n176. \t\tc: noop,\n177. \n178. \t\tm: noop,\n179. \n180. \t\tp: noop,\n181. \n182. \t\tu: noop,\n183. \n184. \t\td: noop\n185. \t};\n186. }\n187. \n188. function SvelteComponent(options) {\n189. \tinit(this, options);\n190. \tthis._state = assign({}, options.data);\n191. \n192. \tthis._handlers.destroy = [ondestroy];\n193. \n194. \tvar _oncreate = oncreate.bind(this);\n195. \n196. \tif (!options._root) {\n197. \t\tthis._oncreate = [_oncreate];\n198. \t} else {\n199. \t \tthis._root._oncreate.push(_oncreate);\n200. \t }\n201. \n202. \tthis._fragment = create_main_fragment(this._state, this);\n203. \n204. \tif (options.target) {\n205. \t\tthis._fragment.c();\n206. \t\tthis._fragment.m(options.target, options.anchor || null);\n207. \n208. \t\tcallAll(this._oncreate);\n209. \t}\n210. }', 'start_line_number': 168, 'end_line_number': 210}, {'relative_path': 'test/js/samples/setup-method/input.html', 'content': "1. <script>\n2. \texport default {\n3. \t\tmethods: {\n4. \t\t\tfoo ( bar ) {\n5. \t\t\t\tconsole.log( bar );\n6. \t\t\t}\n7. \t\t},\n8. \t\tsetup: (Component) => {\n9. \t\t\tComponent.SOME_CONSTANT = 42;\n10. \t\t\tComponent.factory = function (target) {\n11. \t\t\t\treturn new Component({\n12. \t\t\t\t\ttarget: target\n13. \t\t\t\t});\n14. \t\t\t}\n15. \t\t\tComponent.prototype.foo( 'baz' );\n16. \t\t}\n17. \t};\n18. </script>", 'start_line_number': 1, 'end_line_number': 18}, {'relative_path': 'test/js/samples/setup-method/expected.js', 'content': '1. /* generated by Svelte vX.Y.Z */\n2. import { assign, init, noop, proto } from "svelte/shared.js";\n3. \n4. var methods = {\n5. \tfoo ( bar ) {\n6. \t\tconsole.log( bar );\n7. \t}\n8. };\n9. \n10. function setup(Component) {\n11. \tComponent.SOME_CONSTANT = 42;\n12. \tComponent.factory = function (target) {\n13. \t\treturn new Component({\n14. \t\t\ttarget: target\n15. \t\t});\n16. \t}\n17. \tComponent.prototype.foo( \'baz\' );\n18. }\n19. ', 'start_line_number': 1, 'end_line_number': 19}, {'relative_path': 'test/js/samples/setup-method/expected.js', 'content': '35. function SvelteComponent(options) {\n36. \tinit(this, options);\n37. \tthis._state = assign({}, options.data);\n38. \n39. \tthis._fragment = create_main_fragment(this._state, this);\n40. \n41. \tif (options.target) {\n42. \t\tthis._fragment.c();\n43. \t\tthis._fragment.m(options.target, options.anchor || null);\n44. \t}\n45. }\n46. \n47. assign(SvelteComponent.prototype, methods, proto);\n48. \n49. setup(SvelteComponent);\n50. export default SvelteComponent;', 'start_line_number': 35, 'end_line_number': 50}, {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/input.html', 'content': "1. <script>\n2. \texport default {\n3. \t\toncreate() {\n4. \t\t\tconsole.log('oncreate');\n5. \t\t},\n6. \n7. \t\tondestroy() {\n8. \t\t\tconsole.log('ondestroy');\n9. \t\t},\n10. \n11. \t\tmethods: {\n12. \t\t\tfoo() {\n13. \t\t\t\tconsole.log('foo');\n14. \t\t\t}\n15. \t\t},\n16. \n17. \t\tevents: {\n18. \t\t\tswipe(node, callback) {\n19. \t\t\t\t// TODO implement\n20. \t\t\t}\n21. \t\t}\n22. \t};\n23. </script>", 'start_line_number': 1, 'end_line_number': 23}, {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/expected.js', 'content': '1. "use strict";\n2. \n3. var SvelteComponent = {};;\n4. \n5. SvelteComponent.data = function() {\n6. \treturn {};\n7. };\n8. \n9. SvelteComponent.render = function(state, options) {\n10. \tstate = state || {};\n11. \n12. \treturn ``.trim();\n13. };\n14. \n15. SvelteComponent.renderCss = function() {\n16. \tvar components = [];\n17. \n18. \treturn {\n19. \t\tcss: components.map(x => x.css).join(\'\\n\'),\n20. \t\tmap: null,\n21. \t\tcomponents\n22. \t};\n23. };\n24. \n25. var escaped = {\n26. \t\'"\': \'&quot;\',\n27. \t"\'": \'&#39;\',\n28. \t\'&\': \'&amp;\',\n29. \t\'<\': \'&lt;\',\n30. \t\'>\': \'&gt;\'\n31. };\n32. \n33. function __escape(html) {\n34. \treturn String(html).replace(/["\'&<>]/g, match => escaped[match]);\n35. }\n36. \n37. module.exports = SvelteComponent;', 'start_line_number': 1, 'end_line_number': 37}, {'relative_path': 'test/js/samples/ssr-no-oncreate-etc/expected-bundle.js', 'content': "1. var SvelteComponent = {};\n2. \n3. SvelteComponent.data = function() {\n4. \treturn {};\n5. };\n6. \n7. SvelteComponent.render = function(state, options) {\n8. \tstate = state || {};\n9. \n10. \treturn ``.trim();\n11. };\n12. \n13. SvelteComponent.renderCss = function() {\n14. \tvar components = [];\n15. \n16. \treturn {\n17. \t\tcss: components.map(x => x.css).join('\\n'),\n18. \t\tmap: null,\n19. \t\tcomponents\n20. \t};\n21. };\n22. \n23. module.exports = SvelteComponent;", 'start_line_number': 1, 'end_line_number': 23}, {'relative_path': 'test/runtime/index.js', 'content': '1. import assert from "assert";\n2. import * as path from "path";\n3. import * as fs from "fs";\n4. import * as acorn from "acorn";\n5. import { transitionManager } from "../../shared.js";\n6. \n7. import {\n8. \tshowOutput,\n9. \tloadConfig,\n10. \tloadSvelte,\n11. \tenv,\n12. \tsetupHtmlEqual,\n13. \tspaces\n14. } from "../helpers.js";', 'start_line_number': 1, 'end_line_number': 14}, {'relative_path': 'test/runtime/index.js', 'content': '25. describe("runtime", () => {\n26. \tbefore(() => {\n27. \t\tsvelte = loadSvelte(true);\n28. \n29. \t\trequire.extensions[".html"] = function(module, filename) {\n30. \t\t\tconst options = Object.assign(\n31. \t\t\t\t{ filename, name: getName(filename), format: \'cjs\' },\n32. \t\t\t\tcompileOptions\n33. \t\t\t);\n34. \n35. \t\t\tconst { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);\n36. \n37. \t\t\treturn module._compile(code, filename);\n38. \t\t};\n39. \n40. \t\treturn setupHtmlEqual();\n41. \t});', 'start_line_number': 25, 'end_line_number': 41}, {'relative_path': 'test/runtime/index.js', 'content': '45. \tfunction runTest(dir, shared, hydrate) {\n46. \t\tif (dir[0] === ".") return;\n47. \n48. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n49. \n50. \t\tif (config.solo && process.env.CI) {\n51. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n52. \t\t}\n53. \n54. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? \'shared\' : \'inline\'} helpers)`, () => {\n55. \t\t\tif (failed.has(dir)) {\n56. \t\t\t\t// this makes debugging easier, by only printing compiled output once\n57. \t\t\t\tthrow new Error(\'skipping test, already failed\');\n58. \t\t\t}\n59. \n60. \t\t\tconst cwd = path.resolve(`test/runtime/samples/${dir}`);\n61. \n62. \t\t\tcompileOptions = config.compileOptions || {};\n63. \t\t\tcompileOptions.shared = shared;\n64. \t\t\tcompileOptions.hydratable = hydrate;\n65. \t\t\tcompileOptions.dev = config.dev;\n66. ', 'start_line_number': 45, 'end_line_number': 66}, {'relative_path': 'test/runtime/index.js', 'content': '96. \t\t\tObject.keys(require.cache)\n97. \t\t\t\t.filter(x => x.endsWith(".html"))\n98. \t\t\t\t.forEach(file => {\n99. \t\t\t\t\tdelete require.cache[file];\n100. \t\t\t\t});\n101. \n102. \t\t\tlet SvelteComponent;\n103. \n104. \t\t\tlet unintendedError = null;\n105. \n106. \t\t\tconst window = env();\n107. \n108. \t\t\ttry {\n109. \t\t\t\t// set of hacks to support transition tests\n110. \t\t\t\ttransitionManager.running = false;\n111. \t\t\t\ttransitionManager.transitions = [];\n112. \n113. \t\t\t\tconst raf = {\n114. \t\t\t\t\ttime: 0,\n115. \t\t\t\t\tcallback: null,\n116. \t\t\t\t\ttick: now => {\n117. \t\t\t\t\t\traf.time = now;\n118. \t\t\t\t\t\tif (raf.callback) raf.callback();\n119. \t\t\t\t\t}\n120. \t\t\t\t};\n121. \t\t\t\twindow.performance = { now: () => raf.time };\n122. \t\t\t\tglobal.requestAnimationFrame = cb => {\n123. \t\t\t\t\tlet called = false;', 'start_line_number': 96, 'end_line_number': 123}, {'relative_path': 'test/runtime/index.js', 'content': '134. \t\t\t\ttry {\n135. \t\t\t\t\tSvelteComponent = require(`./samples/${dir}/main.html`);\n136. \t\t\t\t} catch (err) {\n137. \t\t\t\t\tshowOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console\n138. \t\t\t\t\tthrow err;\n139. \t\t\t\t}', 'start_line_number': 134, 'end_line_number': 139}, {'relative_path': 'test/runtime/index.js', 'content': '144. \t\t\t\twindow.SvelteComponent = SvelteComponent;\n145. \n146. \t\t\t\tconst target = window.document.querySelector("main");\n147. \n148. \t\t\t\tconst warnings = [];\n149. \t\t\t\tconst warn = console.warn;\n150. \t\t\t\tconsole.warn = warning => {\n151. \t\t\t\t\twarnings.push(warning);\n152. \t\t\t\t};\n153. \n154. \t\t\t\tconst options = Object.assign({}, {\n155. \t\t\t\t\ttarget,\n156. \t\t\t\t\thydrate,\n157. \t\t\t\t\tdata: config.data\n158. \t\t\t\t}, config.options || {});\n159. \n160. \t\t\t\tconst component = new SvelteComponent(options);\n161. ', 'start_line_number': 144, 'end_line_number': 161}, {'relative_path': 'test/runtime/index.js', 'content': '176. \t\t\t\tif (config.html) {\n177. \t\t\t\t\tassert.htmlEqual(target.innerHTML, config.html);\n178. \t\t\t\t}\n179. \n180. \t\t\t\tif (config.test) {\n181. \t\t\t\t\tconfig.test(assert, component, target, window, raf);\n182. \t\t\t\t} else {\n183. \t\t\t\t\tcomponent.destroy();\n184. \t\t\t\t\tassert.equal(target.innerHTML, "");\n185. \t\t\t\t}\n186. \t\t\t} catch (err) {', 'start_line_number': 176, 'end_line_number': 186}, {'relative_path': 'test/runtime/index.js', 'content': '200. \tconst shared = path.resolve("shared.js");\n201. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n202. \t\trunTest(dir, shared, false);\n203. \t\trunTest(dir, shared, true);\n204. \t\trunTest(dir, null, false);\n205. \t});\n206. ', 'start_line_number': 200, 'end_line_number': 206}, {'relative_path': 'test/runtime/samples/set-in-oncreate/_config.js', 'content': "1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: '<p>2</p>'\n5. };", 'start_line_number': 1, 'end_line_number': 5}, {'relative_path': 'test/runtime/samples/set-in-oncreate/main.html', 'content': '1. <p>{{foo}}</p>\n2. \n3. <script>\n4. \texport default {\n5. \t\tdata: () => ({\n6. \t\t\tfoo: 1\n7. \t\t}),\n8. \n9. \t\toncreate () {\n10. \t\t\tthis.set({ foo: 2 });\n11. \t\t}\n12. \t};', 'start_line_number': 1, 'end_line_number': 12}, {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/Widget.html', 'content': '1. <p ref:x>{{inDocument}}</p>\n2. \n3. <script>\n4. \texport default {\n5. \t\toncreate () {\n6. \t\t\tthis.set({ inDocument: document.contains( this.refs.x ) })\n7. \t\t}\n8. \t};', 'start_line_number': 1, 'end_line_number': 8}, {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/main.html', 'content': "1. <div>\n2. \t<Widget/>\n3. \n4. \t{{#if foo}}\n5. \t\t<Widget/>\n6. \t{{/if}}\n7. </div>\n8. \n9. <script>\n10. \timport Widget from './Widget.html';\n11. \n12. \texport default {\n13. \t\tcomponents: {\n14. \t\t\tWidget\n15. \t\t}\n16. \t};\n17. </script>", 'start_line_number': 1, 'end_line_number': 17}, {'relative_path': 'test/runtime/samples/onrender-fires-when-ready/_config.js', 'content': "1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: `<div><p>true</p></div>`,\n5. \n6. \ttest ( assert, component, target ) {\n7. \t\tcomponent.set({ foo: true });\n8. \t\tassert.htmlEqual( target.innerHTML, `<div><p>true</p>\\n<p>true</p></div>` );\n9. \n10. \t\tcomponent.destroy();\n11. \t}\n12. };", 'start_line_number': 1, 'end_line_number': 12}, {'relative_path': 'test/helpers.js', 'content': "1. import { JSDOM } from 'jsdom';\n2. import assert from 'assert';\n3. import glob from 'glob';\n4. import fs from 'fs';\n5. import path from 'path';\n6. import chalk from 'chalk';\n7. \n8. // for coverage purposes, we need to test source files,\n9. // but for sanity purposes, we need to test dist files\n10. export function loadSvelte(test) {\n11. \tif (test) global.__svelte_test = true;\n12. \n13. \tconst resolved = process.env.COVERAGE\n14. \t\t? require.resolve('../src/index.js')\n15. \t\t: require.resolve('../compiler/svelte.js');\n16. \n17. \tdelete require.cache[resolved];\n18. \treturn require(resolved);\n19. }\n20. \n21. export const svelte = loadSvelte();\n22. ", 'start_line_number': 1, 'end_line_number': 22}, {'relative_path': 'test/helpers.js', 'content': "50. const { window } = new JSDOM('<main></main>');\n51. global.document = window.document;\n52. \n53. export function env() {\n54. \twindow._svelteTransitionManager = null;\n55. \twindow.document.body.innerHTML = '<main></main>';\n56. \n57. \treturn window;\n58. }", 'start_line_number': 50, 'end_line_number': 58}, {'relative_path': 'test/helpers.js', 'content': "116. export function normalizeHtml(window, html) {\n117. \ttry {\n118. \t\tconst node = window.document.createElement('div');\n119. \t\tnode.innerHTML = html\n120. \t\t\t.replace(/<!--.*?-->/g, '')\n121. \t\t\t.replace(/>[\\s\\r\\n]+</g, '><')\n122. \t\t\t.trim();\n123. \t\tcleanChildren(node, '');\n124. \t\treturn node.innerHTML.replace(/<\\/?noscript\\/?>/g, '');\n125. \t} catch (err) {\n126. \t\tthrow new Error(`Failed to normalize HTML:\\n${html}`);\n127. \t}\n128. }\n129. \n130. export function setupHtmlEqual() {\n131. \tconst window = env();\n132. \n133. \tassert.htmlEqual = (actual, expected, message) => {\n134. \t\tassert.deepEqual(\n135. \t\t\tnormalizeHtml(window, actual),\n136. \t\t\tnormalizeHtml(window, expected),\n137. \t\t\tmessage\n138. \t\t);\n139. \t};\n140. }", 'start_line_number': 116, 'end_line_number': 140}, {'relative_path': 'test/server-side-rendering/index.js', 'content': '1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";', 'start_line_number': 1, 'end_line_number': 11}, {'relative_path': 'test/server-side-rendering/index.js', 'content': '23. \tbefore(() => {\n24. \t\trequire(process.env.COVERAGE\n25. \t\t\t? "../../src/server-side-rendering/register.js"\n26. \t\t\t: "../../ssr/register");\n27. \n28. \t\treturn setupHtmlEqual();\n29. \t});', 'start_line_number': 23, 'end_line_number': 29}, {'relative_path': 'test/server-side-rendering/index.js', 'content': '31. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n32. \t\tif (dir[0] === ".") return;\n33. \n34. \t\t// add .solo to a sample directory name to only run that test, or\n35. \t\t// .show to always show the output. or both\n36. \t\tconst solo = /\\.solo/.test(dir);\n37. \t\tconst show = /\\.show/.test(dir);\n38. \n39. \t\tif (solo && process.env.CI) {\n40. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n41. \t\t}\n42. \n43. \t\t(solo ? it.only : it)(dir, () => {\n44. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n45. \t\t\ttry {\n46. \t\t\t\tconst component = require(`${dir}/main.html`);\n47. \n48. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n49. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n50. \n51. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n52. \n53. \t\t\t\tconst html = component.render(data);\n54. \t\t\t\tconst css = component.renderCss().css;\n55. \n56. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n57. \t\t\t\tif (css) fs.writeFileSync(`${dir}/_actual.css`, css);\n58. \n59. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n60. \t\t\t\tassert.equal(\n61. \t\t\t\t\tcss.replace(/^\\s+/gm, ""),\n62. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n63. \t\t\t\t);\n64. \n65. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n66. \t\t\t} catch (err) {\n67. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n68. \t\t\t\tthrow err;\n69. \t\t\t}\n70. \t\t});\n71. \t});', 'start_line_number': 31, 'end_line_number': 71}, {'relative_path': 'test/server-side-rendering/index.js', 'content': '73. \t// duplicate client-side tests, as far as possible\n74. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n75. \t\tif (dir[0] === ".") return;\n76. \n77. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n78. \n79. \t\tif (config.solo && process.env.CI) {\n80. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n81. \t\t}\n82. \n83. \t\tif (config["skip-ssr"]) return;\n84. \n85. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n86. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n87. \n88. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n89. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n90. \t\t\t\tdelete require.cache[resolved];\n91. \t\t\t});\n92. \n93. \t\t\ttry {\n94. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n95. \t\t\t\tconst html = component.render(config.data);\n96. \n97. \t\t\t\tif (config.html) {\n98. \t\t\t\t\tassert.htmlEqual(html, config.html);\n99. \t\t\t\t}\n100. \t\t\t} catch (err) {\n101. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n102. \t\t\t\tthrow err;\n103. \t\t\t}\n104. \t\t});\n105. \t});\n106. });', 'start_line_number': 73, 'end_line_number': 106}, {'relative_path': 'test/setup.js', 'content': '1. const fs = require(\'fs\');\n2. const path = require(\'path\');\n3. \n4. require(\'console-group\').install();\n5. require(\'source-map-support\').install();\n6. \n7. require.extensions[\'.js\'] = function(module, filename) {\n8. \tconst exports = [];\n9. \n10. \tvar code = fs.readFileSync(filename, \'utf-8\')\n11. \t\t.replace(/^import (?:\\* as )?(\\w+) from [\'"]([^\'"]+)[\'"];?/gm, \'var $1 = require("$2");\')\n12. \t\t.replace(/^import {([^}]+)} from [\'"](.+)[\'"];?/gm, \'var {$1} = require("$2");\')\n13. \t\t.replace(/^export default /gm, \'module.exports = \')\n14. \t\t.replace(/^export (const|let|var|class|function) (\\w+)/gm, (match, type, name) => {\n15. \t\t\texports.push(name);\n16. \t\t\treturn `${type} ${name}`;\n17. \t\t})\n18. \t\t.replace(/^export \\{([^}]+)\\}/gm, (match, names) => {\n19. \t\t\tnames.split(\',\').filter(Boolean).forEach(name => {\n20. \t\t\t\texports.push(name);\n21. \t\t\t});\n22. \n23. \t\t\treturn \'\';\n24. \t\t})\n25. \t\t.replace(/^export function (\\w+)/gm, \'exports.$1 = function $1\');\n26. \n27. \texports.forEach(name => {\n28. \t\tcode += `\\nexports.${name} = ${name};`;\n29. \t});\n30. \n31. \ttry {\n32. \t\treturn module._compile(code, filename);\n33. \t} catch (err) {\n34. \t\tconsole.log(code); // eslint-disable-line no-console\n35. \t\tthrow err;\n36. \t}\n37. };', 'start_line_number': 1, 'end_line_number': 37}]}]
2025-11-11 00:32:25,563 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 2 memories from memory
2025-11-11 00:32:25,563 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 53 contexts from memory
2025-11-11 00:32:25,564 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 40 contexts from memory
2025-11-11 00:32:25,565 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 40 new contexts to 34 existing contexts
2025-11-11 00:32:25,568 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 40 total contexts (removed 34 duplicates)
2025-11-11 00:32:25,569 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of test/js/index.js, test/runtime/index.js, test/server-side-rendering/index.js, test/helpers.js, test/setup.js, and the complete contents of these sample directories: test/js/samples/onrender-onteardown-rewritten, test/js/samples/setup-method, test/js/samples/ssr-no-oncreate-etc, test/runtime/samples/set-in-oncreate, and test/runtime/samples/onrender-fires-when-ready.
Extra Requirements: If sending all files is too large, at minimum include each file’s import statements and the specific test cases/functions that exercise lifecycle method rewriting or oncreate behavior, with exact line numbers.
Purpose: These files contain the test harness and the target samples needed to extract 5 relevant tests demonstrating lifecycle method handling similar to the async oncreate bug.

Previous refined query 2:
Essential Query: Please provide the full content of test/helpers.js and the complete files (with line numbers) for test/runtime/samples/bindings-before-oncreate, test/runtime/samples/onrender-fires-when-ready-nested, and test/runtime/samples/lifecycle-events.
Extra Requirements: If sending all files is too large, at minimum include each file’s import statements and any test functions in _config.js, plus the main.html files containing oncreate logic, with exact line numbers.
Purpose: These files supply missing helper definitions and additional lifecycle samples needed to assemble 5 complete, self-contained tests demonstrating oncreate behavior similar to the async keyword removal bug.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: test/helpers.js
Line number range: 1 - 22
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	if (test) global.__svelte_test = true;
12. 
13. 	const resolved = process.env.COVERAGE
14. 		? require.resolve('../src/index.js')
15. 		: require.resolve('../compiler/svelte.js');
16. 
17. 	delete require.cache[resolved];
18. 	return require(resolved);
19. }
20. 
21. export const svelte = loadSvelte();
22. 


File: test/helpers.js
Line number range: 50 - 58
Content:
50. const { window } = new JSDOM('<main></main>');
51. global.document = window.document;
52. 
53. export function env() {
54. 	window._svelteTransitionManager = null;
55. 	window.document.body.innerHTML = '<main></main>';
56. 
57. 	return window;
58. }


File: test/helpers.js
Line number range: 116 - 140
Content:
116. export function normalizeHtml(window, html) {
117. 	try {
118. 		const node = window.document.createElement('div');
119. 		node.innerHTML = html
120. 			.replace(/<!--.*?-->/g, '')
121. 			.replace(/>[\s\r\n]+</g, '><')
122. 			.trim();
123. 		cleanChildren(node, '');
124. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
125. 	} catch (err) {
126. 		throw new Error(`Failed to normalize HTML:\n${html}`);
127. 	}
128. }
129. 
130. export function setupHtmlEqual() {
131. 	const window = env();
132. 
133. 	assert.htmlEqual = (actual, expected, message) => {
134. 		assert.deepEqual(
135. 			normalizeHtml(window, actual),
136. 			normalizeHtml(window, expected),
137. 			message
138. 		);
139. 	};
140. }


File: test/js/index.js
Line number range: 1 - 79
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import { rollup } from "rollup";
5. import { loadConfig, svelte } from "../helpers.js";
6. 
7. describe("js", () => {
8. 	fs.readdirSync("test/js/samples").forEach(dir => {
9. 		if (dir[0] === ".") return;
10. 
11. 		// add .solo to a sample directory name to only run that test
12. 		const solo = /\.solo/.test(dir);
13. 
14. 		if (solo && process.env.CI) {
15. 			throw new Error("Forgot to remove `solo: true` from test");
16. 		}
17. 
18. 		(solo ? it.only : it)(dir, () => {
19. 			dir = path.resolve("test/js/samples", dir);
20. 			const config = loadConfig(`${dir}/_config.js`);
21. 
22. 			const input = fs
23. 				.readFileSync(`${dir}/input.html`, "utf-8")
24. 				.replace(/\s+$/, "");
25. 
26. 			let actual;
27. 
28. 			try {
29. 				const options = Object.assign(config.options || {}, {
30. 					shared: true
31. 				});
32. 
33. 				actual = svelte.compile(input, options).code.replace(/generated by Svelte v\d+\.\d+\.\d+/, 'generated by Svelte vX.Y.Z');
34. 			} catch (err) {
35. 				console.log(err.frame);
36. 				throw err;
37. 			}
38. 
39. 			fs.writeFileSync(`${dir}/_actual.js`, actual);
40. 
41. 			return rollup({
42. 				input: `${dir}/_actual.js`,
43. 				plugins: [
44. 					{
45. 						resolveId(importee, importer) {
46. 							if (!importer) return importee;
47. 							if (importee === "svelte/shared.js")
48. 								return path.resolve("shared.js");
49. 							return null;
50. 						}
51. 					}
52. 				]
53. 			}).then(bundle => {
54. 				return bundle.generate({ format: "es" });
55. 			}).then(({ code }) => {
56. 				fs.writeFileSync(`${dir}/_actual-bundle.js`, code);
57. 
58. 				const expected = fs.readFileSync(`${dir}/expected.js`, "utf-8");
59. 				const expectedBundle = fs.readFileSync(
60. 					`${dir}/expected-bundle.js`,
61. 					"utf-8"
62. 				);
63. 
64. 				assert.equal(
65. 					actual.trim().replace(/^[ \t]+$/gm, ""),
66. 					expected.trim().replace(/^[ \t]+$/gm, "")
67. 				);
68. 
69. 				assert.equal(
70. 					code.trim().replace(/^[ \t]+$/gm, ""),
71. 					expectedBundle.trim().replace(/^[ \t]+$/gm, "")
72. 				);
73. 			}).catch(err => {
74. 				if (err.loc) console.error(err.loc);
75. 				throw err;
76. 			});
77. 		});
78. 	});
79. });


File: test/js/samples/onrender-onteardown-rewritten/expected-bundle.js
Line number range: 1 - 214
Content:
1. function noop() {}
2. 
3. function assign(target) {
4. 	var k,
5. 		source,
6. 		i = 1,
7. 		len = arguments.length;
8. 	for (; i < len; i++) {
9. 		source = arguments[i];
10. 		for (k in source) target[k] = source[k];
11. 	}
12. 
13. 	return target;
14. }
15. 
16. function blankObject() {
17. 	return Object.create(null);
18. }
19. 
20. function destroy(detach) {
21. 	this.destroy = noop;
22. 	this.fire('destroy');
23. 	this.set = this.get = noop;
24. 
25. 	if (detach !== false) this._fragment.u();
26. 	this._fragment.d();
27. 	this._fragment = this._state = null;
28. }
29. 
30. function differs(a, b) {
31. 	return a !== b || ((a && typeof a === 'object') || typeof a === 'function');
32. }
33. 
34. function dispatchObservers(component, group, changed, newState, oldState) {
35. 	for (var key in group) {
36. 		if (!changed[key]) continue;
37. 
38. 		var newValue = newState[key];
39. 		var oldValue = oldState[key];
40. 
41. 		var callbacks = group[key];
42. 		if (!callbacks) continue;
43. 
44. 		for (var i = 0; i < callbacks.length; i += 1) {
45. 			var callback = callbacks[i];
46. 			if (callback.__calling) continue;
47. 
48. 			callback.__calling = true;
49. 			callback.call(component, newValue, oldValue);
50. 			callback.__calling = false;
51. 		}
52. 	}
53. }
54. 
55. function fire(eventName, data) {
56. 	var handlers =
57. 		eventName in this._handlers && this._handlers[eventName].slice();
58. 	if (!handlers) return;
59. 
60. 	for (var i = 0; i < handlers.length; i += 1) {
61. 		handlers[i].call(this, data);
62. 	}
63. }
64. 
65. function get(key) {
66. 	return key ? this._state[key] : this._state;
67. }
68. 
69. function init(component, options) {
70. 	component.options = options;
71. 
72. 	component._observers = { pre: blankObject(), post: blankObject() };
73. 	component._handlers = blankObject();
74. 	component._root = options._root || component;
75. 	component._yield = options._yield;
76. 	component._bind = options._bind;
77. }
78. 
79. function observe(key, callback, options) {
80. 	var group = options && options.defer
81. 		? this._observers.post
82. 		: this._observers.pre;
83. 
84. 	(group[key] || (group[key] = [])).push(callback);
85. 
86. 	if (!options || options.init !== false) {
87. 		callback.__calling = true;
88. 		callback.call(this, this._state[key]);
89. 		callback.__calling = false;
90. 	}
91. 
92. 	return {
93. 		cancel: function() {
94. 			var index = group[key].indexOf(callback);
95. 			if (~index) group[key].splice(index, 1);
96. 		}
97. 	};
98. }
99. 
100. function on(eventName, handler) {
101. 	if (eventName === 'teardown') return this.on('destroy', handler);
102. 
103. 	var handlers = this._handlers[eventName] || (this._handlers[eventName] = []);
104. 	handlers.push(handler);
105. 
106. 	return {
107. 		cancel: function() {
108. 			var index = handlers.indexOf(handler);
109. 			if (~index) handlers.splice(index, 1);
110. 		}
111. 	};
112. }
113. 
114. function set(newState) {
115. 	this._set(assign({}, newState));
116. 	if (this._root._lock) return;
117. 	this._root._lock = true;
118. 	callAll(this._root._beforecreate);
119. 	callAll(this._root._oncreate);
120. 	callAll(this._root._aftercreate);
121. 	this._root._lock = false;
122. }
123. 
124. function _set(newState) {
125. 	var oldState = this._state,
126. 		changed = {},
127. 		dirty = false;
128. 
129. 	for (var key in newState) {
130. 		if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
131. 	}
132. 	if (!dirty) return;
133. 
134. 	this._state = assign({}, oldState, newState);
135. 	this._recompute(changed, this._state);
136. 	if (this._bind) this._bind(changed, this._state);
137. 	dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
138. 	this._fragment.p(changed, this._state);
139. 	dispatchObservers(this, this._observers.post, changed, this._state, oldState);
140. }
141. 
142. function callAll(fns) {
143. 	while (fns && fns.length) fns.pop()();
144. }
145. 
146. function _mount(target, anchor) {
147. 	this._fragment.m(target, anchor);
148. }
149. 
150. function _unmount() {
151. 	this._fragment.u();
152. }
153. 
154. var proto = {
155. 	destroy: destroy,
156. 	get: get,
157. 	fire: fire,
158. 	observe: observe,
159. 	on: on,
160. 	set: set,
161. 	teardown: destroy,
162. 	_recompute: noop,
163. 	_set: _set,
164. 	_mount: _mount,
165. 	_unmount: _unmount
166. };
167. 
168. /* generated by Svelte vX.Y.Z */
169. function oncreate() {}
170. 
171. function ondestroy() {}
172. 
173. function create_main_fragment(state, component) {
174. 
175. 	return {
176. 		c: noop,
177. 
178. 		m: noop,
179. 
180. 		p: noop,
181. 
182. 		u: noop,
183. 
184. 		d: noop
185. 	};
186. }
187. 
188. function SvelteComponent(options) {
189. 	init(this, options);
190. 	this._state = assign({}, options.data);
191. 
192. 	this._handlers.destroy = [ondestroy];
193. 
194. 	var _oncreate = oncreate.bind(this);
195. 
196. 	if (!options._root) {
197. 		this._oncreate = [_oncreate];
198. 	} else {
199. 	 	this._root._oncreate.push(_oncreate);
200. 	 }
201. 
202. 	this._fragment = create_main_fragment(this._state, this);
203. 
204. 	if (options.target) {
205. 		this._fragment.c();
206. 		this._fragment.m(options.target, options.anchor || null);
207. 
208. 		callAll(this._oncreate);
209. 	}
210. }
211. 
212. assign(SvelteComponent.prototype, proto);
213. 
214. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/expected.js
Line number range: 1 - 48
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";
3. 
4. function oncreate() {};
5. 
6. function ondestroy() {};
7. 
8. function create_main_fragment(state, component) {
9. 
10. 	return {
11. 		c: noop,
12. 
13. 		m: noop,
14. 
15. 		p: noop,
16. 
17. 		u: noop,
18. 
19. 		d: noop
20. 	};
21. }
22. 
23. function SvelteComponent(options) {
24. 	init(this, options);
25. 	this._state = assign({}, options.data);
26. 
27. 	this._handlers.destroy = [ondestroy]
28. 
29. 	var _oncreate = oncreate.bind(this);
30. 
31. 	if (!options._root) {
32. 		this._oncreate = [_oncreate];
33. 	} else {
34. 	 	this._root._oncreate.push(_oncreate);
35. 	 }
36. 
37. 	this._fragment = create_main_fragment(this._state, this);
38. 
39. 	if (options.target) {
40. 		this._fragment.c();
41. 		this._fragment.m(options.target, options.anchor || null);
42. 
43. 		callAll(this._oncreate);
44. 	}
45. }
46. 
47. assign(SvelteComponent.prototype, proto);
48. export default SvelteComponent;


File: test/js/samples/onrender-onteardown-rewritten/input.html
Line number range: 1 - 7
Content:
1. <script>
2. 	export default {
3. 		// this test should be removed in v2
4. 		onrender () {},
5. 		onteardown () {}
6. 	};
7. </script>


File: test/js/samples/setup-method/expected.js
Line number range: 1 - 19
Content:
1. /* generated by Svelte vX.Y.Z */
2. import { assign, init, noop, proto } from "svelte/shared.js";
3. 
4. var methods = {
5. 	foo ( bar ) {
6. 		console.log( bar );
7. 	}
8. };
9. 
10. function setup(Component) {
11. 	Component.SOME_CONSTANT = 42;
12. 	Component.factory = function (target) {
13. 		return new Component({
14. 			target: target
15. 		});
16. 	}
17. 	Component.prototype.foo( 'baz' );
18. }
19. 


File: test/js/samples/setup-method/expected.js
Line number range: 35 - 50
Content:
35. function SvelteComponent(options) {
36. 	init(this, options);
37. 	this._state = assign({}, options.data);
38. 
39. 	this._fragment = create_main_fragment(this._state, this);
40. 
41. 	if (options.target) {
42. 		this._fragment.c();
43. 		this._fragment.m(options.target, options.anchor || null);
44. 	}
45. }
46. 
47. assign(SvelteComponent.prototype, methods, proto);
48. 
49. setup(SvelteComponent);
50. export default SvelteComponent;


File: test/js/samples/setup-method/input.html
Line number range: 1 - 18
Content:
1. <script>
2. 	export default {
3. 		methods: {
4. 			foo ( bar ) {
5. 				console.log( bar );
6. 			}
7. 		},
8. 		setup: (Component) => {
9. 			Component.SOME_CONSTANT = 42;
10. 			Component.factory = function (target) {
11. 				return new Component({
12. 					target: target
13. 				});
14. 			}
15. 			Component.prototype.foo( 'baz' );
16. 		}
17. 	};
18. </script>


File: test/js/samples/ssr-no-oncreate-etc/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	options: {
3. 		generate: 'ssr'
4. 	}
5. };


File: test/js/samples/ssr-no-oncreate-etc/expected-bundle.js
Line number range: 1 - 23
Content:
1. var SvelteComponent = {};
2. 
3. SvelteComponent.data = function() {
4. 	return {};
5. };
6. 
7. SvelteComponent.render = function(state, options) {
8. 	state = state || {};
9. 
10. 	return ``.trim();
11. };
12. 
13. SvelteComponent.renderCss = function() {
14. 	var components = [];
15. 
16. 	return {
17. 		css: components.map(x => x.css).join('\n'),
18. 		map: null,
19. 		components
20. 	};
21. };
22. 
23. module.exports = SvelteComponent;


File: test/js/samples/ssr-no-oncreate-etc/expected.js
Line number range: 1 - 37
Content:
1. "use strict";
2. 
3. var SvelteComponent = {};;
4. 
5. SvelteComponent.data = function() {
6. 	return {};
7. };
8. 
9. SvelteComponent.render = function(state, options) {
10. 	state = state || {};
11. 
12. 	return ``.trim();
13. };
14. 
15. SvelteComponent.renderCss = function() {
16. 	var components = [];
17. 
18. 	return {
19. 		css: components.map(x => x.css).join('\n'),
20. 		map: null,
21. 		components
22. 	};
23. };
24. 
25. var escaped = {
26. 	'"': '&quot;',
27. 	"'": '&#39;',
28. 	'&': '&amp;',
29. 	'<': '&lt;',
30. 	'>': '&gt;'
31. };
32. 
33. function __escape(html) {
34. 	return String(html).replace(/["'&<>]/g, match => escaped[match]);
35. }
36. 
37. module.exports = SvelteComponent;


File: test/js/samples/ssr-no-oncreate-etc/input.html
Line number range: 1 - 23
Content:
1. <script>
2. 	export default {
3. 		oncreate() {
4. 			console.log('oncreate');
5. 		},
6. 
7. 		ondestroy() {
8. 			console.log('ondestroy');
9. 		},
10. 
11. 		methods: {
12. 			foo() {
13. 				console.log('foo');
14. 			}
15. 		},
16. 
17. 		events: {
18. 			swipe(node, callback) {
19. 				// TODO implement
20. 			}
21. 		}
22. 	};
23. </script>


File: test/runtime/index.js
Line number range: 1 - 14
Content:
1. import assert from "assert";
2. import * as path from "path";
3. import * as fs from "fs";
4. import * as acorn from "acorn";
5. import { transitionManager } from "../../shared.js";
6. 
7. import {
8. 	showOutput,
9. 	loadConfig,
10. 	loadSvelte,
11. 	env,
12. 	setupHtmlEqual,
13. 	spaces
14. } from "../helpers.js";


File: test/runtime/index.js
Line number range: 25 - 41
Content:
25. describe("runtime", () => {
26. 	before(() => {
27. 		svelte = loadSvelte(true);
28. 
29. 		require.extensions[".html"] = function(module, filename) {
30. 			const options = Object.assign(
31. 				{ filename, name: getName(filename), format: 'cjs' },
32. 				compileOptions
33. 			);
34. 
35. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
36. 
37. 			return module._compile(code, filename);
38. 		};
39. 
40. 		return setupHtmlEqual();
41. 	});


File: test/runtime/index.js
Line number range: 45 - 66
Content:
45. 	function runTest(dir, shared, hydrate) {
46. 		if (dir[0] === ".") return;
47. 
48. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
49. 
50. 		if (config.solo && process.env.CI) {
51. 			throw new Error("Forgot to remove `solo: true` from test");
52. 		}
53. 
54. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
55. 			if (failed.has(dir)) {
56. 				// this makes debugging easier, by only printing compiled output once
57. 				throw new Error('skipping test, already failed');
58. 			}
59. 
60. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
61. 
62. 			compileOptions = config.compileOptions || {};
63. 			compileOptions.shared = shared;
64. 			compileOptions.hydratable = hydrate;
65. 			compileOptions.dev = config.dev;
66. 


File: test/runtime/index.js
Line number range: 96 - 123
Content:
96. 			Object.keys(require.cache)
97. 				.filter(x => x.endsWith(".html"))
98. 				.forEach(file => {
99. 					delete require.cache[file];
100. 				});
101. 
102. 			let SvelteComponent;
103. 
104. 			let unintendedError = null;
105. 
106. 			const window = env();
107. 
108. 			try {
109. 				// set of hacks to support transition tests
110. 				transitionManager.running = false;
111. 				transitionManager.transitions = [];
112. 
113. 				const raf = {
114. 					time: 0,
115. 					callback: null,
116. 					tick: now => {
117. 						raf.time = now;
118. 						if (raf.callback) raf.callback();
119. 					}
120. 				};
121. 				window.performance = { now: () => raf.time };
122. 				global.requestAnimationFrame = cb => {
123. 					let called = false;


File: test/runtime/index.js
Line number range: 134 - 139
Content:
134. 				try {
135. 					SvelteComponent = require(`./samples/${dir}/main.html`);
136. 				} catch (err) {
137. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
138. 					throw err;
139. 				}


File: test/runtime/index.js
Line number range: 144 - 161
Content:
144. 				window.SvelteComponent = SvelteComponent;
145. 
146. 				const target = window.document.querySelector("main");
147. 
148. 				const warnings = [];
149. 				const warn = console.warn;
150. 				console.warn = warning => {
151. 					warnings.push(warning);
152. 				};
153. 
154. 				const options = Object.assign({}, {
155. 					target,
156. 					hydrate,
157. 					data: config.data
158. 				}, config.options || {});
159. 
160. 				const component = new SvelteComponent(options);
161. 


File: test/runtime/index.js
Line number range: 176 - 186
Content:
176. 				if (config.html) {
177. 					assert.htmlEqual(target.innerHTML, config.html);
178. 				}
179. 
180. 				if (config.test) {
181. 					config.test(assert, component, target, window, raf);
182. 				} else {
183. 					component.destroy();
184. 					assert.equal(target.innerHTML, "");
185. 				}
186. 			} catch (err) {


File: test/runtime/index.js
Line number range: 200 - 206
Content:
200. 	const shared = path.resolve("shared.js");
201. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
202. 		runTest(dir, shared, false);
203. 		runTest(dir, shared, true);
204. 		runTest(dir, null, false);
205. 	});
206. 


File: test/runtime/samples/bindings-before-oncreate/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	test(assert, component) {
3. 		assert.equal(component.refs.one.snapshot, 2);
4. 	}
5. };


File: test/runtime/samples/bindings-before-oncreate/main.html
Line number range: 1 - 9
Content:
1. <One ref:one/>
2. 
3. <script>
4. 	import One from './One.html';
5. 
6. 	export default {
7. 		components: { One }
8. 	};
9. </script>


File: test/runtime/samples/lifecycle-events/_config.js
Line number range: 1 - 7
Content:
1. export default {
2. 	test(assert, component) {
3. 		assert.deepEqual(component.events, ['create']);
4. 		component.destroy();
5. 		assert.deepEqual(component.events, ['create', 'destroy']);
6. 	}
7. };


File: test/runtime/samples/lifecycle-events/main.html
Line number range: 1 - 13
Content:
1. <div></div>
2. 
3. <script>
4. 	export default {
5. 		oncreate() {
6. 			this.events = ['create'];
7. 		},
8. 
9. 		ondestroy() {
10. 			this.events.push('destroy');
11. 		}
12. 	};
13. </script>


File: test/runtime/samples/ondestroy-before-cleanup/_config.js
Line number range: 1 - 9
Content:
1. export default {
2. 	test(assert, component, target) {
3. 		const top = component.refs.top;
4. 		const div = target.querySelector('div');
5. 
6. 		component.set({ visible: false });
7. 		assert.equal(top.refOnDestroy, div);
8. 	}
9. };


File: test/runtime/samples/ondestroy-before-cleanup/main.html
Line number range: 1 - 18
Content:
1. {{#if visible}}
2. 	<Top ref:top></Top>
3. {{/if}}
4. 
5. <script>
6. 	import Top from './Top.html';
7. 	
8. 	export default {
9. 		data() {
10. 			return {
11. 				visible: true
12. 			};
13. 		},
14. 		components: {
15. 			Top
16. 		}
17. 	};
18. </script>


File: test/runtime/samples/onrender-fires-when-ready-nested/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: `<div><p>true</p>\n<p>true</p></div>`
5. };


File: test/runtime/samples/onrender-fires-when-ready-nested/main.html
Line number range: 1 - 16
Content:
1. <div>
2. 	<Widget/>
3. 	<ParentWidget />
4. </div>
5. 
6. <script>
7. 	import Widget from './Widget.html';
8. 	import ParentWidget from './ParentWidget.html';
9. 
10. 	export default {
11. 		components: {
12. 			Widget,
13. 			ParentWidget
14. 		}
15. 	};
16. </script>


File: test/runtime/samples/onrender-fires-when-ready/Widget.html
Line number range: 1 - 8
Content:
1. <p ref:x>{{inDocument}}</p>
2. 
3. <script>
4. 	export default {
5. 		oncreate () {
6. 			this.set({ inDocument: document.contains( this.refs.x ) })
7. 		}
8. 	};


File: test/runtime/samples/onrender-fires-when-ready/_config.js
Line number range: 1 - 12
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: `<div><p>true</p></div>`,
5. 
6. 	test ( assert, component, target ) {
7. 		component.set({ foo: true });
8. 		assert.htmlEqual( target.innerHTML, `<div><p>true</p>\n<p>true</p></div>` );
9. 
10. 		component.destroy();
11. 	}
12. };


File: test/runtime/samples/onrender-fires-when-ready/main.html
Line number range: 1 - 17
Content:
1. <div>
2. 	<Widget/>
3. 
4. 	{{#if foo}}
5. 		<Widget/>
6. 	{{/if}}
7. </div>
8. 
9. <script>
10. 	import Widget from './Widget.html';
11. 
12. 	export default {
13. 		components: {
14. 			Widget
15. 		}
16. 	};
17. </script>


File: test/runtime/samples/set-in-oncreate/_config.js
Line number range: 1 - 5
Content:
1. export default {
2. 	'skip-ssr': true, // uses oncreate
3. 
4. 	html: '<p>2</p>'
5. };


File: test/runtime/samples/set-in-oncreate/main.html
Line number range: 1 - 13
Content:
1. <p>{{foo}}</p>
2. 
3. <script>
4. 	export default {
5. 		data: () => ({
6. 			foo: 1
7. 		}),
8. 
9. 		oncreate () {
10. 			this.set({ foo: 2 });
11. 		}
12. 	};
13. </script>


File: test/server-side-rendering/index.js
Line number range: 1 - 11
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";


File: test/server-side-rendering/index.js
Line number range: 23 - 29
Content:
23. 	before(() => {
24. 		require(process.env.COVERAGE
25. 			? "../../src/server-side-rendering/register.js"
26. 			: "../../ssr/register");
27. 
28. 		return setupHtmlEqual();
29. 	});


File: test/server-side-rendering/index.js
Line number range: 31 - 71
Content:
31. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
32. 		if (dir[0] === ".") return;
33. 
34. 		// add .solo to a sample directory name to only run that test, or
35. 		// .show to always show the output. or both
36. 		const solo = /\.solo/.test(dir);
37. 		const show = /\.show/.test(dir);
38. 
39. 		if (solo && process.env.CI) {
40. 			throw new Error("Forgot to remove `solo: true` from test");
41. 		}
42. 
43. 		(solo ? it.only : it)(dir, () => {
44. 			dir = path.resolve("test/server-side-rendering/samples", dir);
45. 			try {
46. 				const component = require(`${dir}/main.html`);
47. 
48. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
49. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
50. 
51. 				const data = tryToLoadJson(`${dir}/data.json`);
52. 
53. 				const html = component.render(data);
54. 				const css = component.renderCss().css;
55. 
56. 				fs.writeFileSync(`${dir}/_actual.html`, html);
57. 				if (css) fs.writeFileSync(`${dir}/_actual.css`, css);
58. 
59. 				assert.htmlEqual(html, expectedHtml);
60. 				assert.equal(
61. 					css.replace(/^\s+/gm, ""),
62. 					expectedCss.replace(/^\s+/gm, "")
63. 				);
64. 
65. 				if (show) showOutput(dir, { generate: 'ssr' });
66. 			} catch (err) {
67. 				showOutput(dir, { generate: 'ssr' });
68. 				throw err;
69. 			}
70. 		});
71. 	});


File: test/server-side-rendering/index.js
Line number range: 73 - 106
Content:
73. 	// duplicate client-side tests, as far as possible
74. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
75. 		if (dir[0] === ".") return;
76. 
77. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
78. 
79. 		if (config.solo && process.env.CI) {
80. 			throw new Error("Forgot to remove `solo: true` from test");
81. 		}
82. 
83. 		if (config["skip-ssr"]) return;
84. 
85. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
86. 			const cwd = path.resolve("test/runtime/samples", dir);
87. 
88. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
89. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
90. 				delete require.cache[resolved];
91. 			});
92. 
93. 			try {
94. 				const component = require(`../runtime/samples/${dir}/main.html`);
95. 				const html = component.render(config.data);
96. 
97. 				if (config.html) {
98. 					assert.htmlEqual(html, config.html);
99. 				}
100. 			} catch (err) {
101. 				showOutput(cwd, { generate: "ssr" });
102. 				throw err;
103. 			}
104. 		});
105. 	});
106. });


File: test/setup.js
Line number range: 1 - 37
Content:
1. const fs = require('fs');
2. const path = require('path');
3. 
4. require('console-group').install();
5. require('source-map-support').install();
6. 
7. require.extensions['.js'] = function(module, filename) {
8. 	const exports = [];
9. 
10. 	var code = fs.readFileSync(filename, 'utf-8')
11. 		.replace(/^import (?:\* as )?(\w+) from ['"]([^'"]+)['"];?/gm, 'var $1 = require("$2");')
12. 		.replace(/^import {([^}]+)} from ['"](.+)['"];?/gm, 'var {$1} = require("$2");')
13. 		.replace(/^export default /gm, 'module.exports = ')
14. 		.replace(/^export (const|let|var|class|function) (\w+)/gm, (match, type, name) => {
15. 			exports.push(name);
16. 			return `${type} ${name}`;
17. 		})
18. 		.replace(/^export \{([^}]+)\}/gm, (match, names) => {
19. 			names.split(',').filter(Boolean).forEach(name => {
20. 				exports.push(name);
21. 			});
22. 
23. 			return '';
24. 		})
25. 		.replace(/^export function (\w+)/gm, 'exports.$1 = function $1');
26. 
27. 	exports.forEach(name => {
28. 		code += `\nexports.${name} = ${name};`;
29. 	});
30. 
31. 	try {
32. 		return module._compile(code, filename);
33. 	} catch (err) {
34. 		console.log(code); // eslint-disable-line no-console
35. 		throw err;
36. 	}
37. };

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:33:01,739 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='To return 5 complete, self-contained tests with all imports, helper functions, and exact line numbers, I need the missing helper definitions and the complete runtime harness. The current context only shows parts of test/helpers.js and partial snippets of test/runtime/index.js. The js test harness is complete, but runtime tests depend on helpers like loadConfig, showOutput, tryToReadFile, tryToLoadJson, getName, and spaces that are not provided, and the full runtime file to show how the samples are executed.' query='Please provide the missing definitions in test/helpers.js for loadConfig, showOutput, tryToReadFile, tryToLoadJson, getName, and spaces, and the full content (with line numbers) of test/runtime/index.js.' extra_requirements='If full files are too large, include at minimum the import section and the test execution logic that loads sample _config.js and runs lifecycle oncreate samples, with line numbers.' purpose='This will allow me to assemble 5 complete tests demonstrating oncreate lifecycle handling, including all imports, helper functions, setup/mocking, assertions, and exact line references.'
2025-11-11 00:33:01,741 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the missing definitions in test/helpers.js for loadConfig, showOutput, tryToReadFile, tryToLoadJson, getName, and spaces, and the full content (with line numbers) of test/runtime/index.js.
2025-11-11 00:33:02,086 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-11 00:33:02,087 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-11 00:33:02,087 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-11 00:33:02,087 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-11 00:33:02,088 - thread-133013323122368.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-11 00:33:02,090 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-11 00:33:02,090 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the missing definitions in test/helpers.js for loadConfig, showOutput, tryToReadFile, tryToLoadJson, getName, and spaces, and the full content (with line numbers) of test/runtime/index.js.
Extra requirements: If full files are too large, include at minimum the import section and the test execution logic that loads sample _config.js and runs lifecycle oncreate samples, with line numbers.
Purpose: This will allow me to assemble 5 complete tests demonstrating oncreate lifecycle handling, including all imports, helper functions, setup/mocking, assertions, and exact line references.
2025-11-11 00:33:06,783 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_NiYzsmDBM3WgLsFycRLgxIbH', 'function': {'arguments': '{"relative_path":"test/helpers.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 479, 'prompt_tokens': 2223, 'total_tokens': 2702, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--aec09539-ba35-4978-9ec0-3a54981444cf-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/helpers.js'}, 'id': 'call_NiYzsmDBM3WgLsFycRLgxIbH', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2223, 'output_tokens': 479, 'total_tokens': 2702, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-11 00:33:07,793 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_DGgJpigtIBEHGf5dbRnQwlkb', 'function': {'arguments': '{"relative_path":"test/helpers.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 2294, 'total_tokens': 2320, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--158e6d86-f033-4a95-a5af-465de867703a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/helpers.js'}, 'id': 'call_DGgJpigtIBEHGf5dbRnQwlkb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2294, 'output_tokens': 26, 'total_tokens': 2320, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:33:11,936 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_mwJifntMuqZZF4WeJW6zV89T', 'function': {'arguments': '{"relative_path":"test/runtime/index.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 416, 'prompt_tokens': 5048, 'total_tokens': 5464, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a5a8a970-51bf-4fbd-9cfa-91652d2e2a9d-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/index.js'}, 'id': 'call_mwJifntMuqZZF4WeJW6zV89T', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5048, 'output_tokens': 416, 'total_tokens': 5464, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-11 00:33:13,171 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_HoWjGzoT3XVzsmZGZ1aaBWMR', 'function': {'arguments': '{"relative_path":"test/runtime/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 27, 'prompt_tokens': 5121, 'total_tokens': 5148, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--309a578d-e397-4e5e-8d7a-cd68bceaf642-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/index.js'}, 'id': 'call_HoWjGzoT3XVzsmZGZ1aaBWMR', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5121, 'output_tokens': 27, 'total_tokens': 5148, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:33:30,696 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located and read test/helpers.js and confirmed the implementations for tryToLoadJson (lines 32–39), tryToReadFile (41–48), loadConfig (142–156), showOutput (177–192), and spaces (235–239). I verified that getName is not defined in test/helpers.js; the equivalent logic exists in test/runtime/index.js (lines 20–23), which you can add to helpers if needed. I also retrieved the full content of test/runtime/index.js (lines 1–241), including the import section and the test execution logic that loads each sample’s _config.js and runs the runtime tests (covering lifecycle/oncreate samples). This should give you exact code and line references to assemble your five complete tests.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1573, 'prompt_tokens': 8246, 'total_tokens': 9819, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1408, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--b5bbf812-e750-4d94-a5cb-051fc757bee4-0' usage_metadata={'input_tokens': 8246, 'output_tokens': 1573, 'total_tokens': 9819, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1408}}
2025-11-11 00:33:30,700 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the missing definitions in test/helpers.js for loadConfig, showOutput, tryToReadFile, tryToLoadJson, getName, and spaces, and the full content (with line numbers) of test/runtime/index.js.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If full files are too large, include at minimum the import section and the test execution logic that loads sample _config.js and runs lifecycle oncreate samples, with line numbers.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
This will allow me to assemble 5 complete tests demonstrating oncreate lifecycle handling, including all imports, helper functions, setup/mocking, assertions, and exact line references.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: test/helpers.js
Line number range: 1 - 239
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	if (test) global.__svelte_test = true;
12. 
13. 	const resolved = process.env.COVERAGE
14. 		? require.resolve('../src/index.js')
15. 		: require.resolve('../compiler/svelte.js');
16. 
17. 	delete require.cache[resolved];
18. 	return require(resolved);
19. }
20. 
21. export const svelte = loadSvelte();
22. 
23. export function exists(path) {
24. 	try {
25. 		fs.statSync(path);
26. 		return true;
27. 	} catch (err) {
28. 		return false;
29. 	}
30. }
31. 
32. export function tryToLoadJson(file) {
33. 	try {
34. 		return JSON.parse(fs.readFileSync(file));
35. 	} catch (err) {
36. 		if (err.code !== 'ENOENT') throw err;
37. 		return null;
38. 	}
39. }
40. 
41. export function tryToReadFile(file) {
42. 	try {
43. 		return fs.readFileSync(file, 'utf-8');
44. 	} catch (err) {
45. 		if (err.code !== 'ENOENT') throw err;
46. 		return null;
47. 	}
48. }
49. 
50. const { window } = new JSDOM('<main></main>');
51. global.document = window.document;
52. 
53. export function env() {
54. 	window._svelteTransitionManager = null;
55. 	window.document.body.innerHTML = '<main></main>';
56. 
57. 	return window;
58. }
59. 
60. function cleanChildren(node) {
61. 	let previous = null;
62. 
63. 	// sort attributes
64. 	const attributes = Array.from(node.attributes).sort((a, b) => {
65. 		return a.name < b.name ? -1 : 1;
66. 	});
67. 
68. 	attributes.forEach(attr => {
69. 		node.removeAttribute(attr.name);
70. 	});
71. 
72. 	attributes.forEach(attr => {
73. 		node.setAttribute(attr.name, attr.value);
74. 	});
75. 
76. 	// recurse
77. 	[...node.childNodes].forEach(child => {
78. 		if (child.nodeType === 3) {
79. 			// text
80. 			if (
81. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
82. 				node.tagName !== 'text' &&
83. 				node.tagName !== 'tspan'
84. 			) {
85. 				node.removeChild(child);
86. 			}
87. 
88. 			child.data = child.data.replace(/\s{2,}/g, '\n');
89. 
90. 			if (previous && previous.nodeType === 3) {
91. 				previous.data += child.data;
92. 				previous.data = previous.data.replace(/\s{2,}/g, '\n');
93. 
94. 				node.removeChild(child);
95. 				child = previous;
96. 			}
97. 		} else {
98. 			cleanChildren(child);
99. 		}
100. 
101. 		previous = child;
102. 	});
103. 
104. 	// collapse whitespace
105. 	if (node.firstChild && node.firstChild.nodeType === 3) {
106. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
107. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
108. 	}
109. 
110. 	if (node.lastChild && node.lastChild.nodeType === 3) {
111. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
112. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
113. 	}
114. }
115. 
116. export function normalizeHtml(window, html) {
117. 	try {
118. 		const node = window.document.createElement('div');
119. 		node.innerHTML = html
120. 			.replace(/<!--.*?-->/g, '')
121. 			.replace(/>[\s\r\n]+</g, '><')
122. 			.trim();
123. 		cleanChildren(node, '');
124. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
125. 	} catch (err) {
126. 		throw new Error(`Failed to normalize HTML:\n${html}`);
127. 	}
128. }
129. 
130. export function setupHtmlEqual() {
131. 	const window = env();
132. 
133. 	assert.htmlEqual = (actual, expected, message) => {
134. 		assert.deepEqual(
135. 			normalizeHtml(window, actual),
136. 			normalizeHtml(window, expected),
137. 			message
138. 		);
139. 	};
140. }
141. 
142. export function loadConfig(file) {
143. 	try {
144. 		const resolved = require.resolve(file);
145. 		delete require.cache[resolved];
146. 
147. 		const config = require(resolved);
148. 		return config.default || config;
149. 	} catch (err) {
150. 		if (err.code === 'MODULE_NOT_FOUND') {
151. 			return {};
152. 		}
153. 
154. 		throw err;
155. 	}
156. }
157. 
158. export function addLineNumbers(code) {
159. 	return code
160. 		.split('\n')
161. 		.map((line, i) => {
162. 			i = String(i + 1);
163. 			while (i.length < 3) i = ` ${i}`;
164. 
165. 			return (
166. 				chalk.grey(`  ${i}: `) +
167. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
168. 			);
169. 		})
170. 		.join('\n');
171. }
172. 
173. function capitalise(str) {
174. 	return str[0].toUpperCase() + str.slice(1);
175. }
176. 
177. export function showOutput(cwd, options = {}, s = svelte) {
178. 	glob.sync('**/*.html', { cwd }).forEach(file => {
179. 		if (file[0] === '_') return;
180. 		const { code } = s.compile(
181. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
182. 			Object.assign(options, {
183. 				filename: file,
184. 				name: capitalise(path.basename(file).replace(/\.html$/, ''))
185. 			})
186. 		);
187. 
188. 		console.log( // eslint-disable-line no-console
189. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
190. 		);
191. 	});
192. }
193. 
194. const start = /\n(\t+)/;
195. export function deindent(strings, ...values) {
196. 	const indentation = start.exec(strings[0])[1];
197. 	const pattern = new RegExp(`^${indentation}`, 'gm');
198. 
199. 	let result = strings[0].replace(start, '').replace(pattern, '');
200. 
201. 	let trailingIndentation = getTrailingIndentation(result);
202. 
203. 	for (let i = 1; i < strings.length; i += 1) {
204. 		let expression = values[i - 1];
205. 		const string = strings[i].replace(pattern, '');
206. 
207. 		if (Array.isArray(expression)) {
208. 			expression = expression.length ? expression.join('\n') : null;
209. 		}
210. 
211. 		if (expression || expression === '') {
212. 			const value = String(expression).replace(
213. 				/\n/g,
214. 				`\n${trailingIndentation}`
215. 			);
216. 			result += value + string;
217. 		} else {
218. 			let c = result.length;
219. 			while (/\s/.test(result[c - 1])) c -= 1;
220. 			result = result.slice(0, c) + string;
221. 		}
222. 
223. 		trailingIndentation = getTrailingIndentation(result);
224. 	}
225. 
226. 	return result.trim().replace(/\t+$/gm, '');
227. }
228. 
229. function getTrailingIndentation(str) {
230. 	let i = str.length;
231. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
232. 	return str.slice(i, str.length);
233. }
234. 
235. export function spaces(i) {
236. 	let result = '';
237. 	while (i--) result += ' ';
238. 	return result;
239. }


File: test/runtime/index.js
Line number range: 1 - 241
Content:
1. import assert from "assert";
2. import * as path from "path";
3. import * as fs from "fs";
4. import * as acorn from "acorn";
5. import { transitionManager } from "../../shared.js";
6. 
7. import {
8. 	showOutput,
9. 	loadConfig,
10. 	loadSvelte,
11. 	env,
12. 	setupHtmlEqual,
13. 	spaces
14. } from "../helpers.js";
15. 
16. let svelte;
17. 
18. let compileOptions = null;
19. 
20. function getName(filename) {
21. 	const base = path.basename(filename).replace(".html", "");
22. 	return base[0].toUpperCase() + base.slice(1);
23. }
24. 
25. describe("runtime", () => {
26. 	before(() => {
27. 		svelte = loadSvelte(true);
28. 
29. 		require.extensions[".html"] = function(module, filename) {
30. 			const options = Object.assign(
31. 				{ filename, name: getName(filename), format: 'cjs' },
32. 				compileOptions
33. 			);
34. 
35. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
36. 
37. 			return module._compile(code, filename);
38. 		};
39. 
40. 		return setupHtmlEqual();
41. 	});
42. 
43. 	const failed = new Set();
44. 
45. 	function runTest(dir, shared, hydrate) {
46. 		if (dir[0] === ".") return;
47. 
48. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
49. 
50. 		if (config.solo && process.env.CI) {
51. 			throw new Error("Forgot to remove `solo: true` from test");
52. 		}
53. 
54. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
55. 			if (failed.has(dir)) {
56. 				// this makes debugging easier, by only printing compiled output once
57. 				throw new Error('skipping test, already failed');
58. 			}
59. 
60. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
61. 
62. 			compileOptions = config.compileOptions || {};
63. 			compileOptions.shared = shared;
64. 			compileOptions.hydratable = hydrate;
65. 			compileOptions.dev = config.dev;
66. 
67. 			// check that no ES2015+ syntax slipped in
68. 			if (!config.allowES2015) {
69. 				try {
70. 					const source = fs.readFileSync(
71. 						`test/runtime/samples/${dir}/main.html`,
72. 						"utf-8"
73. 					);
74. 					const { code } = svelte.compile(source, compileOptions);
75. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
76. 					if (startIndex === -1) throw new Error("missing create_main_fragment");
77. 					const endIndex = code.lastIndexOf("export default");
78. 					const es5 =
79. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
80. 						code.slice(startIndex, endIndex);
81. 
82. 					acorn.parse(es5, { ecmaVersion: 5 });
83. 
84. 					if (/Object\.assign/.test(es5)) {
85. 						throw new Error(
86. 							"cannot use Object.assign in generated code, as it is not supported everywhere"
87. 						);
88. 					}
89. 				} catch (err) {
90. 					failed.add(dir);
91. 					showOutput(cwd, { shared }, svelte); // eslint-disable-line no-console
92. 					throw err;
93. 				}
94. 			}
95. 
96. 			Object.keys(require.cache)
97. 				.filter(x => x.endsWith(".html"))
98. 				.forEach(file => {
99. 					delete require.cache[file];
100. 				});
101. 
102. 			let SvelteComponent;
103. 
104. 			let unintendedError = null;
105. 
106. 			const window = env();
107. 
108. 			try {
109. 				// set of hacks to support transition tests
110. 				transitionManager.running = false;
111. 				transitionManager.transitions = [];
112. 
113. 				const raf = {
114. 					time: 0,
115. 					callback: null,
116. 					tick: now => {
117. 						raf.time = now;
118. 						if (raf.callback) raf.callback();
119. 					}
120. 				};
121. 				window.performance = { now: () => raf.time };
122. 				global.requestAnimationFrame = cb => {
123. 					let called = false;
124. 					raf.callback = () => {
125. 						if (!called) {
126. 							called = true;
127. 							cb();
128. 						}
129. 					};
130. 				};
131. 
132. 				global.window = window;
133. 
134. 				try {
135. 					SvelteComponent = require(`./samples/${dir}/main.html`);
136. 				} catch (err) {
137. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
138. 					throw err;
139. 				}
140. 
141. 				global.window = window;
142. 
143. 				// Put the constructor on window for testing
144. 				window.SvelteComponent = SvelteComponent;
145. 
146. 				const target = window.document.querySelector("main");
147. 
148. 				const warnings = [];
149. 				const warn = console.warn;
150. 				console.warn = warning => {
151. 					warnings.push(warning);
152. 				};
153. 
154. 				const options = Object.assign({}, {
155. 					target,
156. 					hydrate,
157. 					data: config.data
158. 				}, config.options || {});
159. 
160. 				const component = new SvelteComponent(options);
161. 
162. 				console.warn = warn;
163. 
164. 				if (config.error) {
165. 					unintendedError = true;
166. 					throw new Error("Expected a runtime error");
167. 				}
168. 
169. 				if (config.warnings) {
170. 					assert.deepEqual(warnings, config.warnings);
171. 				} else if (warnings.length) {
172. 					unintendedError = true;
173. 					throw new Error("Received unexpected warnings");
174. 				}
175. 
176. 				if (config.html) {
177. 					assert.htmlEqual(target.innerHTML, config.html);
178. 				}
179. 
180. 				if (config.test) {
181. 					config.test(assert, component, target, window, raf);
182. 				} else {
183. 					component.destroy();
184. 					assert.equal(target.innerHTML, "");
185. 				}
186. 			} catch (err) {
187. 				if (config.error && !unintendedError) {
188. 					config.error(assert, err);
189. 				} else {
190. 					failed.add(dir);
191. 					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
192. 					throw err;
193. 				}
194. 			}
195. 
196. 			if (config.show) showOutput(cwd, { shared, hydratable: hydrate }, svelte);
197. 		});
198. 	}
199. 
200. 	const shared = path.resolve("shared.js");
201. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
202. 		runTest(dir, shared, false);
203. 		runTest(dir, shared, true);
204. 		runTest(dir, null, false);
205. 	});
206. 
207. 	it("fails if options.target is missing in dev mode", () => {
208. 		const { code } = svelte.compile(`<div></div>`, {
209. 			format: "iife",
210. 			name: "SvelteComponent",
211. 			dev: true
212. 		});
213. 
214. 		const SvelteComponent = eval(
215. 			`(function () { ${code}; return SvelteComponent; }())`
216. 		);
217. 
218. 		assert.throws(() => {
219. 			new SvelteComponent();
220. 		}, /'target' is a required option/);
221. 	});
222. 
223. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
224. 		const { code } = svelte.compile(`<div></div>`, {
225. 			format: "iife",
226. 			name: "SvelteComponent",
227. 			dev: true
228. 		});
229. 
230. 		const SvelteComponent = eval(
231. 			`(function () { ${code}; return SvelteComponent; }())`
232. 		);
233. 
234. 		assert.throws(() => {
235. 			new SvelteComponent({
236. 				target: {},
237. 				hydrate: true
238. 			});
239. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
240. 	});
241. });

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-11 00:34:04,813 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The query asks for the missing definition of tryToLoadJson in test/helpers.js. These lines contain the complete implementation, handling ENOENT and returning null, which is critical to replicate behavior in tests.', relative_path='test/helpers.js', start_line=32, end_line=39), ContextOutput(reasoning='The query asks for the missing definition of tryToReadFile in test/helpers.js. These lines provide the exact implementation used in the test suite, including ENOENT handling.', relative_path='test/helpers.js', start_line=41, end_line=48), ContextOutput(reasoning='The query asks for the missing definition of loadConfig in test/helpers.js. These lines show how the config module is resolved, cache-cleared, required, and default export handled, including MODULE_NOT_FOUND fallback to {}.', relative_path='test/helpers.js', start_line=142, end_line=156), ContextOutput(reasoning='showOutput in test/helpers.js depends on addLineNumbers to print compiled code with line numbers. Including this provides necessary dependency details to fully implement showOutput as requested.', relative_path='test/helpers.js', start_line=158, end_line=171), ContextOutput(reasoning='showOutput in test/helpers.js calls capitalise to derive component names from filenames. This small helper is an essential dependency of showOutput.', relative_path='test/helpers.js', start_line=173, end_line=175), ContextOutput(reasoning='The query asks for the missing definition of showOutput in test/helpers.js. These lines contain the complete implementation, including globbing, svelte compile, and console output formatting.', relative_path='test/helpers.js', start_line=177, end_line=192), ContextOutput(reasoning='The query asks for the missing definition of spaces in test/helpers.js. These lines define the simple utility used by runtime tests to build ES5-only sliced code.', relative_path='test/helpers.js', start_line=235, end_line=239), ContextOutput(reasoning="The query requests the full content (with line numbers) of test/runtime/index.js, including imports, getName, configuration loading, and test execution logic. Providing the entire file satisfies the 'full content' requirement and includes getName.", relative_path='test/runtime/index.js', start_line=1, end_line=241)]
2025-11-11 00:34:04,817 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 8 contexts to memory for query: Please provide the missing definitions in test/helpers.js for loadConfig, showOutput, tryToReadFile, tryToLoadJson, getName, and spaces, and the full content (with line numbers) of test/runtime/index.js.
2025-11-11 00:34:05,484 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-11 00:34:05,485 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 8 new contexts to 40 existing contexts
2025-11-11 00:34:05,487 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 40 total contexts (removed 8 duplicates)
2025-11-11 00:34:05,488 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-11-11 00:34:05,491 - thread-133013323122368.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='test/helpers.js', content="1. import { JSDOM } from 'jsdom';\n2. import assert from 'assert';\n3. import glob from 'glob';\n4. import fs from 'fs';\n5. import path from 'path';\n6. import chalk from 'chalk';\n7. \n8. // for coverage purposes, we need to test source files,\n9. // but for sanity purposes, we need to test dist files\n10. export function loadSvelte(test) {\n11. \tif (test) global.__svelte_test = true;\n12. \n13. \tconst resolved = process.env.COVERAGE\n14. \t\t? require.resolve('../src/index.js')\n15. \t\t: require.resolve('../compiler/svelte.js');\n16. \n17. \tdelete require.cache[resolved];\n18. \treturn require(resolved);\n19. }\n20. \n21. export const svelte = loadSvelte();\n22. ", start_line_number=1, end_line_number=22), Context(relative_path='test/helpers.js', content="32. export function tryToLoadJson(file) {\n33. \ttry {\n34. \t\treturn JSON.parse(fs.readFileSync(file));\n35. \t} catch (err) {\n36. \t\tif (err.code !== 'ENOENT') throw err;\n37. \t\treturn null;\n38. \t}\n39. }", start_line_number=32, end_line_number=39), Context(relative_path='test/helpers.js', content="41. export function tryToReadFile(file) {\n42. \ttry {\n43. \t\treturn fs.readFileSync(file, 'utf-8');\n44. \t} catch (err) {\n45. \t\tif (err.code !== 'ENOENT') throw err;\n46. \t\treturn null;\n47. \t}\n48. }", start_line_number=41, end_line_number=48), Context(relative_path='test/helpers.js', content="50. const { window } = new JSDOM('<main></main>');\n51. global.document = window.document;\n52. \n53. export function env() {\n54. \twindow._svelteTransitionManager = null;\n55. \twindow.document.body.innerHTML = '<main></main>';\n56. \n57. \treturn window;\n58. }", start_line_number=50, end_line_number=58), Context(relative_path='test/helpers.js', content="116. export function normalizeHtml(window, html) {\n117. \ttry {\n118. \t\tconst node = window.document.createElement('div');\n119. \t\tnode.innerHTML = html\n120. \t\t\t.replace(/<!--.*?-->/g, '')\n121. \t\t\t.replace(/>[\\s\\r\\n]+</g, '><')\n122. \t\t\t.trim();\n123. \t\tcleanChildren(node, '');\n124. \t\treturn node.innerHTML.replace(/<\\/?noscript\\/?>/g, '');\n125. \t} catch (err) {\n126. \t\tthrow new Error(`Failed to normalize HTML:\\n${html}`);\n127. \t}\n128. }\n129. \n130. export function setupHtmlEqual() {\n131. \tconst window = env();\n132. \n133. \tassert.htmlEqual = (actual, expected, message) => {\n134. \t\tassert.deepEqual(\n135. \t\t\tnormalizeHtml(window, actual),\n136. \t\t\tnormalizeHtml(window, expected),\n137. \t\t\tmessage\n138. \t\t);\n139. \t};\n140. }", start_line_number=116, end_line_number=140), Context(relative_path='test/helpers.js', content="142. export function loadConfig(file) {\n143. \ttry {\n144. \t\tconst resolved = require.resolve(file);\n145. \t\tdelete require.cache[resolved];\n146. \n147. \t\tconst config = require(resolved);\n148. \t\treturn config.default || config;\n149. \t} catch (err) {\n150. \t\tif (err.code === 'MODULE_NOT_FOUND') {\n151. \t\t\treturn {};\n152. \t\t}\n153. \n154. \t\tthrow err;\n155. \t}\n156. }", start_line_number=142, end_line_number=156), Context(relative_path='test/helpers.js', content="158. export function addLineNumbers(code) {\n159. \treturn code\n160. \t\t.split('\\n')\n161. \t\t.map((line, i) => {\n162. \t\t\ti = String(i + 1);\n163. \t\t\twhile (i.length < 3) i = ` ${i}`;\n164. \n165. \t\t\treturn (\n166. \t\t\t\tchalk.grey(`  ${i}: `) +\n167. \t\t\t\tline.replace(/^\\t+/, match => match.split('\\t').join('    '))\n168. \t\t\t);\n169. \t\t})\n170. \t\t.join('\\n');\n171. }", start_line_number=158, end_line_number=171), Context(relative_path='test/helpers.js', content='173. function capitalise(str) {\n174. \treturn str[0].toUpperCase() + str.slice(1);\n175. }', start_line_number=173, end_line_number=175), Context(relative_path='test/helpers.js', content="177. export function showOutput(cwd, options = {}, s = svelte) {\n178. \tglob.sync('**/*.html', { cwd }).forEach(file => {\n179. \t\tif (file[0] === '_') return;\n180. \t\tconst { code } = s.compile(\n181. \t\t\tfs.readFileSync(`${cwd}/${file}`, 'utf-8'),\n182. \t\t\tObject.assign(options, {\n183. \t\t\t\tfilename: file,\n184. \t\t\t\tname: capitalise(path.basename(file).replace(/\\.html$/, ''))\n185. \t\t\t})\n186. \t\t);\n187. \n188. \t\tconsole.log( // eslint-disable-line no-console\n189. \t\t\t`\\n>> ${chalk.cyan.bold(file)}\\n${addLineNumbers(code)}\\n<< ${chalk.cyan.bold(file)}`\n190. \t\t);\n191. \t});\n192. }", start_line_number=177, end_line_number=192), Context(relative_path='test/helpers.js', content="235. export function spaces(i) {\n236. \tlet result = '';\n237. \twhile (i--) result += ' ';\n238. \treturn result;\n239. }", start_line_number=235, end_line_number=239), Context(relative_path='test/js/index.js', content='1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import { rollup } from "rollup";\n5. import { loadConfig, svelte } from "../helpers.js";\n6. \n7. describe("js", () => {\n8. \tfs.readdirSync("test/js/samples").forEach(dir => {\n9. \t\tif (dir[0] === ".") return;\n10. \n11. \t\t// add .solo to a sample directory name to only run that test\n12. \t\tconst solo = /\\.solo/.test(dir);\n13. \n14. \t\tif (solo && process.env.CI) {\n15. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n16. \t\t}\n17. \n18. \t\t(solo ? it.only : it)(dir, () => {\n19. \t\t\tdir = path.resolve("test/js/samples", dir);\n20. \t\t\tconst config = loadConfig(`${dir}/_config.js`);\n21. \n22. \t\t\tconst input = fs\n23. \t\t\t\t.readFileSync(`${dir}/input.html`, "utf-8")\n24. \t\t\t\t.replace(/\\s+$/, "");\n25. \n26. \t\t\tlet actual;\n27. \n28. \t\t\ttry {\n29. \t\t\t\tconst options = Object.assign(config.options || {}, {\n30. \t\t\t\t\tshared: true\n31. \t\t\t\t});\n32. \n33. \t\t\t\tactual = svelte.compile(input, options).code.replace(/generated by Svelte v\\d+\\.\\d+\\.\\d+/, \'generated by Svelte vX.Y.Z\');\n34. \t\t\t} catch (err) {\n35. \t\t\t\tconsole.log(err.frame);\n36. \t\t\t\tthrow err;\n37. \t\t\t}\n38. \n39. \t\t\tfs.writeFileSync(`${dir}/_actual.js`, actual);\n40. \n41. \t\t\treturn rollup({\n42. \t\t\t\tinput: `${dir}/_actual.js`,\n43. \t\t\t\tplugins: [\n44. \t\t\t\t\t{\n45. \t\t\t\t\t\tresolveId(importee, importer) {\n46. \t\t\t\t\t\t\tif (!importer) return importee;\n47. \t\t\t\t\t\t\tif (importee === "svelte/shared.js")\n48. \t\t\t\t\t\t\t\treturn path.resolve("shared.js");\n49. \t\t\t\t\t\t\treturn null;\n50. \t\t\t\t\t\t}\n51. \t\t\t\t\t}\n52. \t\t\t\t]\n53. \t\t\t}).then(bundle => {\n54. \t\t\t\treturn bundle.generate({ format: "es" });\n55. \t\t\t}).then(({ code }) => {\n56. \t\t\t\tfs.writeFileSync(`${dir}/_actual-bundle.js`, code);\n57. \n58. \t\t\t\tconst expected = fs.readFileSync(`${dir}/expected.js`, "utf-8");\n59. \t\t\t\tconst expectedBundle = fs.readFileSync(\n60. \t\t\t\t\t`${dir}/expected-bundle.js`,\n61. \t\t\t\t\t"utf-8"\n62. \t\t\t\t);\n63. \n64. \t\t\t\tassert.equal(\n65. \t\t\t\t\tactual.trim().replace(/^[ \\t]+$/gm, ""),\n66. \t\t\t\t\texpected.trim().replace(/^[ \\t]+$/gm, "")\n67. \t\t\t\t);\n68. \n69. \t\t\t\tassert.equal(\n70. \t\t\t\t\tcode.trim().replace(/^[ \\t]+$/gm, ""),\n71. \t\t\t\t\texpectedBundle.trim().replace(/^[ \\t]+$/gm, "")\n72. \t\t\t\t);\n73. \t\t\t}).catch(err => {\n74. \t\t\t\tif (err.loc) console.error(err.loc);\n75. \t\t\t\tthrow err;\n76. \t\t\t});\n77. \t\t});\n78. \t});\n79. });', start_line_number=1, end_line_number=79), Context(relative_path='test/js/samples/onrender-onteardown-rewritten/expected-bundle.js', content="1. function noop() {}\n2. \n3. function assign(target) {\n4. \tvar k,\n5. \t\tsource,\n6. \t\ti = 1,\n7. \t\tlen = arguments.length;\n8. \tfor (; i < len; i++) {\n9. \t\tsource = arguments[i];\n10. \t\tfor (k in source) target[k] = source[k];\n11. \t}\n12. \n13. \treturn target;\n14. }\n15. \n16. function blankObject() {\n17. \treturn Object.create(null);\n18. }\n19. \n20. function destroy(detach) {\n21. \tthis.destroy = noop;\n22. \tthis.fire('destroy');\n23. \tthis.set = this.get = noop;\n24. \n25. \tif (detach !== false) this._fragment.u();\n26. \tthis._fragment.d();\n27. \tthis._fragment = this._state = null;\n28. }\n29. \n30. function differs(a, b) {\n31. \treturn a !== b || ((a && typeof a === 'object') || typeof a === 'function');\n32. }\n33. \n34. function dispatchObservers(component, group, changed, newState, oldState) {\n35. \tfor (var key in group) {\n36. \t\tif (!changed[key]) continue;\n37. \n38. \t\tvar newValue = newState[key];\n39. \t\tvar oldValue = oldState[key];\n40. \n41. \t\tvar callbacks = group[key];\n42. \t\tif (!callbacks) continue;\n43. \n44. \t\tfor (var i = 0; i < callbacks.length; i += 1) {\n45. \t\t\tvar callback = callbacks[i];\n46. \t\t\tif (callback.__calling) continue;\n47. \n48. \t\t\tcallback.__calling = true;\n49. \t\t\tcallback.call(component, newValue, oldValue);\n50. \t\t\tcallback.__calling = false;\n51. \t\t}\n52. \t}\n53. }\n54. \n55. function fire(eventName, data) {\n56. \tvar handlers =\n57. \t\teventName in this._handlers && this._handlers[eventName].slice();\n58. \tif (!handlers) return;\n59. \n60. \tfor (var i = 0; i < handlers.length; i += 1) {\n61. \t\thandlers[i].call(this, data);\n62. \t}\n63. }\n64. \n65. function get(key) {\n66. \treturn key ? this._state[key] : this._state;\n67. }\n68. \n69. function init(component, options) {\n70. \tcomponent.options = options;\n71. \n72. \tcomponent._observers = { pre: blankObject(), post: blankObject() };\n73. \tcomponent._handlers = blankObject();\n74. \tcomponent._root = options._root || component;\n75. \tcomponent._yield = options._yield;\n76. \tcomponent._bind = options._bind;\n77. }\n78. \n79. function observe(key, callback, options) {\n80. \tvar group = options && options.defer\n81. \t\t? this._observers.post\n82. \t\t: this._observers.pre;\n83. \n84. \t(group[key] || (group[key] = [])).push(callback);\n85. \n86. \tif (!options || options.init !== false) {\n87. \t\tcallback.__calling = true;\n88. \t\tcallback.call(this, this._state[key]);\n89. \t\tcallback.__calling = false;\n90. \t}\n91. \n92. \treturn {\n93. \t\tcancel: function() {\n94. \t\t\tvar index = group[key].indexOf(callback);\n95. \t\t\tif (~index) group[key].splice(index, 1);\n96. \t\t}\n97. \t};\n98. }\n99. \n100. function on(eventName, handler) {\n101. \tif (eventName === 'teardown') return this.on('destroy', handler);\n102. \n103. \tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n104. \thandlers.push(handler);\n105. \n106. \treturn {\n107. \t\tcancel: function() {\n108. \t\t\tvar index = handlers.indexOf(handler);\n109. \t\t\tif (~index) handlers.splice(index, 1);\n110. \t\t}\n111. \t};\n112. }\n113. \n114. function set(newState) {\n115. \tthis._set(assign({}, newState));\n116. \tif (this._root._lock) return;\n117. \tthis._root._lock = true;\n118. \tcallAll(this._root._beforecreate);\n119. \tcallAll(this._root._oncreate);\n120. \tcallAll(this._root._aftercreate);\n121. \tthis._root._lock = false;\n122. }\n123. \n124. function _set(newState) {\n125. \tvar oldState = this._state,\n126. \t\tchanged = {},\n127. \t\tdirty = false;\n128. \n129. \tfor (var key in newState) {\n130. \t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n131. \t}\n132. \tif (!dirty) return;\n133. \n134. \tthis._state = assign({}, oldState, newState);\n135. \tthis._recompute(changed, this._state);\n136. \tif (this._bind) this._bind(changed, this._state);\n137. \tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n138. \tthis._fragment.p(changed, this._state);\n139. \tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n140. }\n141. \n142. function callAll(fns) {\n143. \twhile (fns && fns.length) fns.pop()();\n144. }\n145. \n146. function _mount(target, anchor) {\n147. \tthis._fragment.m(target, anchor);\n148. }\n149. \n150. function _unmount() {\n151. \tthis._fragment.u();\n152. }\n153. \n154. var proto = {\n155. \tdestroy: destroy,\n156. \tget: get,\n157. \tfire: fire,\n158. \tobserve: observe,\n159. \ton: on,\n160. \tset: set,\n161. \tteardown: destroy,\n162. \t_recompute: noop,\n163. \t_set: _set,\n164. \t_mount: _mount,\n165. \t_unmount: _unmount\n166. };\n167. \n168. /* generated by Svelte vX.Y.Z */\n169. function oncreate() {}\n170. \n171. function ondestroy() {}\n172. \n173. function create_main_fragment(state, component) {\n174. \n175. \treturn {\n176. \t\tc: noop,\n177. \n178. \t\tm: noop,\n179. \n180. \t\tp: noop,\n181. \n182. \t\tu: noop,\n183. \n184. \t\td: noop\n185. \t};\n186. }\n187. \n188. function SvelteComponent(options) {\n189. \tinit(this, options);\n190. \tthis._state = assign({}, options.data);\n191. \n192. \tthis._handlers.destroy = [ondestroy];\n193. \n194. \tvar _oncreate = oncreate.bind(this);\n195. \n196. \tif (!options._root) {\n197. \t\tthis._oncreate = [_oncreate];\n198. \t} else {\n199. \t \tthis._root._oncreate.push(_oncreate);\n200. \t }\n201. \n202. \tthis._fragment = create_main_fragment(this._state, this);\n203. \n204. \tif (options.target) {\n205. \t\tthis._fragment.c();\n206. \t\tthis._fragment.m(options.target, options.anchor || null);\n207. \n208. \t\tcallAll(this._oncreate);\n209. \t}\n210. }\n211. \n212. assign(SvelteComponent.prototype, proto);\n213. \n214. export default SvelteComponent;", start_line_number=1, end_line_number=214), Context(relative_path='test/js/samples/onrender-onteardown-rewritten/expected.js', content='1. /* generated by Svelte vX.Y.Z */\n2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";\n3. \n4. function oncreate() {};\n5. \n6. function ondestroy() {};\n7. \n8. function create_main_fragment(state, component) {\n9. \n10. \treturn {\n11. \t\tc: noop,\n12. \n13. \t\tm: noop,\n14. \n15. \t\tp: noop,\n16. \n17. \t\tu: noop,\n18. \n19. \t\td: noop\n20. \t};\n21. }\n22. \n23. function SvelteComponent(options) {\n24. \tinit(this, options);\n25. \tthis._state = assign({}, options.data);\n26. \n27. \tthis._handlers.destroy = [ondestroy]\n28. \n29. \tvar _oncreate = oncreate.bind(this);\n30. \n31. \tif (!options._root) {\n32. \t\tthis._oncreate = [_oncreate];\n33. \t} else {\n34. \t \tthis._root._oncreate.push(_oncreate);\n35. \t }\n36. \n37. \tthis._fragment = create_main_fragment(this._state, this);\n38. \n39. \tif (options.target) {\n40. \t\tthis._fragment.c();\n41. \t\tthis._fragment.m(options.target, options.anchor || null);\n42. \n43. \t\tcallAll(this._oncreate);\n44. \t}\n45. }\n46. \n47. assign(SvelteComponent.prototype, proto);\n48. export default SvelteComponent;', start_line_number=1, end_line_number=48), Context(relative_path='test/js/samples/onrender-onteardown-rewritten/input.html', content='1. <script>\n2. \texport default {\n3. \t\t// this test should be removed in v2\n4. \t\tonrender () {},\n5. \t\tonteardown () {}\n6. \t};\n7. </script>', start_line_number=1, end_line_number=7), Context(relative_path='test/js/samples/setup-method/expected.js', content='1. /* generated by Svelte vX.Y.Z */\n2. import { assign, init, noop, proto } from "svelte/shared.js";\n3. \n4. var methods = {\n5. \tfoo ( bar ) {\n6. \t\tconsole.log( bar );\n7. \t}\n8. };\n9. \n10. function setup(Component) {\n11. \tComponent.SOME_CONSTANT = 42;\n12. \tComponent.factory = function (target) {\n13. \t\treturn new Component({\n14. \t\t\ttarget: target\n15. \t\t});\n16. \t}\n17. \tComponent.prototype.foo( \'baz\' );\n18. }\n19. ', start_line_number=1, end_line_number=19), Context(relative_path='test/js/samples/setup-method/expected.js', content='35. function SvelteComponent(options) {\n36. \tinit(this, options);\n37. \tthis._state = assign({}, options.data);\n38. \n39. \tthis._fragment = create_main_fragment(this._state, this);\n40. \n41. \tif (options.target) {\n42. \t\tthis._fragment.c();\n43. \t\tthis._fragment.m(options.target, options.anchor || null);\n44. \t}\n45. }\n46. \n47. assign(SvelteComponent.prototype, methods, proto);\n48. \n49. setup(SvelteComponent);\n50. export default SvelteComponent;', start_line_number=35, end_line_number=50), Context(relative_path='test/js/samples/setup-method/input.html', content="1. <script>\n2. \texport default {\n3. \t\tmethods: {\n4. \t\t\tfoo ( bar ) {\n5. \t\t\t\tconsole.log( bar );\n6. \t\t\t}\n7. \t\t},\n8. \t\tsetup: (Component) => {\n9. \t\t\tComponent.SOME_CONSTANT = 42;\n10. \t\t\tComponent.factory = function (target) {\n11. \t\t\t\treturn new Component({\n12. \t\t\t\t\ttarget: target\n13. \t\t\t\t});\n14. \t\t\t}\n15. \t\t\tComponent.prototype.foo( 'baz' );\n16. \t\t}\n17. \t};\n18. </script>", start_line_number=1, end_line_number=18), Context(relative_path='test/js/samples/ssr-no-oncreate-etc/_config.js', content="1. export default {\n2. \toptions: {\n3. \t\tgenerate: 'ssr'\n4. \t}\n5. };", start_line_number=1, end_line_number=5), Context(relative_path='test/js/samples/ssr-no-oncreate-etc/expected-bundle.js', content="1. var SvelteComponent = {};\n2. \n3. SvelteComponent.data = function() {\n4. \treturn {};\n5. };\n6. \n7. SvelteComponent.render = function(state, options) {\n8. \tstate = state || {};\n9. \n10. \treturn ``.trim();\n11. };\n12. \n13. SvelteComponent.renderCss = function() {\n14. \tvar components = [];\n15. \n16. \treturn {\n17. \t\tcss: components.map(x => x.css).join('\\n'),\n18. \t\tmap: null,\n19. \t\tcomponents\n20. \t};\n21. };\n22. \n23. module.exports = SvelteComponent;", start_line_number=1, end_line_number=23), Context(relative_path='test/js/samples/ssr-no-oncreate-etc/expected.js', content='1. "use strict";\n2. \n3. var SvelteComponent = {};;\n4. \n5. SvelteComponent.data = function() {\n6. \treturn {};\n7. };\n8. \n9. SvelteComponent.render = function(state, options) {\n10. \tstate = state || {};\n11. \n12. \treturn ``.trim();\n13. };\n14. \n15. SvelteComponent.renderCss = function() {\n16. \tvar components = [];\n17. \n18. \treturn {\n19. \t\tcss: components.map(x => x.css).join(\'\\n\'),\n20. \t\tmap: null,\n21. \t\tcomponents\n22. \t};\n23. };\n24. \n25. var escaped = {\n26. \t\'"\': \'&quot;\',\n27. \t"\'": \'&#39;\',\n28. \t\'&\': \'&amp;\',\n29. \t\'<\': \'&lt;\',\n30. \t\'>\': \'&gt;\'\n31. };\n32. \n33. function __escape(html) {\n34. \treturn String(html).replace(/["\'&<>]/g, match => escaped[match]);\n35. }\n36. \n37. module.exports = SvelteComponent;', start_line_number=1, end_line_number=37), Context(relative_path='test/js/samples/ssr-no-oncreate-etc/input.html', content="1. <script>\n2. \texport default {\n3. \t\toncreate() {\n4. \t\t\tconsole.log('oncreate');\n5. \t\t},\n6. \n7. \t\tondestroy() {\n8. \t\t\tconsole.log('ondestroy');\n9. \t\t},\n10. \n11. \t\tmethods: {\n12. \t\t\tfoo() {\n13. \t\t\t\tconsole.log('foo');\n14. \t\t\t}\n15. \t\t},\n16. \n17. \t\tevents: {\n18. \t\t\tswipe(node, callback) {\n19. \t\t\t\t// TODO implement\n20. \t\t\t}\n21. \t\t}\n22. \t};\n23. </script>", start_line_number=1, end_line_number=23), Context(relative_path='test/runtime/index.js', content='1. import assert from "assert";\n2. import * as path from "path";\n3. import * as fs from "fs";\n4. import * as acorn from "acorn";\n5. import { transitionManager } from "../../shared.js";\n6. \n7. import {\n8. \tshowOutput,\n9. \tloadConfig,\n10. \tloadSvelte,\n11. \tenv,\n12. \tsetupHtmlEqual,\n13. \tspaces\n14. } from "../helpers.js";\n15. \n16. let svelte;\n17. \n18. let compileOptions = null;\n19. \n20. function getName(filename) {\n21. \tconst base = path.basename(filename).replace(".html", "");\n22. \treturn base[0].toUpperCase() + base.slice(1);\n23. }\n24. \n25. describe("runtime", () => {\n26. \tbefore(() => {\n27. \t\tsvelte = loadSvelte(true);\n28. \n29. \t\trequire.extensions[".html"] = function(module, filename) {\n30. \t\t\tconst options = Object.assign(\n31. \t\t\t\t{ filename, name: getName(filename), format: \'cjs\' },\n32. \t\t\t\tcompileOptions\n33. \t\t\t);\n34. \n35. \t\t\tconst { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);\n36. \n37. \t\t\treturn module._compile(code, filename);\n38. \t\t};\n39. \n40. \t\treturn setupHtmlEqual();\n41. \t});\n42. \n43. \tconst failed = new Set();\n44. \n45. \tfunction runTest(dir, shared, hydrate) {\n46. \t\tif (dir[0] === ".") return;\n47. \n48. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n49. \n50. \t\tif (config.solo && process.env.CI) {\n51. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n52. \t\t}\n53. \n54. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? \'shared\' : \'inline\'} helpers)`, () => {\n55. \t\t\tif (failed.has(dir)) {\n56. \t\t\t\t// this makes debugging easier, by only printing compiled output once\n57. \t\t\t\tthrow new Error(\'skipping test, already failed\');\n58. \t\t\t}\n59. \n60. \t\t\tconst cwd = path.resolve(`test/runtime/samples/${dir}`);\n61. \n62. \t\t\tcompileOptions = config.compileOptions || {};\n63. \t\t\tcompileOptions.shared = shared;\n64. \t\t\tcompileOptions.hydratable = hydrate;\n65. \t\t\tcompileOptions.dev = config.dev;\n66. \n67. \t\t\t// check that no ES2015+ syntax slipped in\n68. \t\t\tif (!config.allowES2015) {\n69. \t\t\t\ttry {\n70. \t\t\t\t\tconst source = fs.readFileSync(\n71. \t\t\t\t\t\t`test/runtime/samples/${dir}/main.html`,\n72. \t\t\t\t\t\t"utf-8"\n73. \t\t\t\t\t);\n74. \t\t\t\t\tconst { code } = svelte.compile(source, compileOptions);\n75. \t\t\t\t\tconst startIndex = code.indexOf("function create_main_fragment"); // may change!\n76. \t\t\t\t\tif (startIndex === -1) throw new Error("missing create_main_fragment");\n77. \t\t\t\t\tconst endIndex = code.lastIndexOf("export default");\n78. \t\t\t\t\tconst es5 =\n79. \t\t\t\t\t\tcode.slice(0, startIndex).split(\'\\n\').map(x => spaces(x.length)).join(\'\\n\') +\n80. \t\t\t\t\t\tcode.slice(startIndex, endIndex);\n81. \n82. \t\t\t\t\tacorn.parse(es5, { ecmaVersion: 5 });\n83. \n84. \t\t\t\t\tif (/Object\\.assign/.test(es5)) {\n85. \t\t\t\t\t\tthrow new Error(\n86. \t\t\t\t\t\t\t"cannot use Object.assign in generated code, as it is not supported everywhere"\n87. \t\t\t\t\t\t);\n88. \t\t\t\t\t}\n89. \t\t\t\t} catch (err) {\n90. \t\t\t\t\tfailed.add(dir);\n91. \t\t\t\t\tshowOutput(cwd, { shared }, svelte); // eslint-disable-line no-console\n92. \t\t\t\t\tthrow err;\n93. \t\t\t\t}\n94. \t\t\t}\n95. \n96. \t\t\tObject.keys(require.cache)\n97. \t\t\t\t.filter(x => x.endsWith(".html"))\n98. \t\t\t\t.forEach(file => {\n99. \t\t\t\t\tdelete require.cache[file];\n100. \t\t\t\t});\n101. \n102. \t\t\tlet SvelteComponent;\n103. \n104. \t\t\tlet unintendedError = null;\n105. \n106. \t\t\tconst window = env();\n107. \n108. \t\t\ttry {\n109. \t\t\t\t// set of hacks to support transition tests\n110. \t\t\t\ttransitionManager.running = false;\n111. \t\t\t\ttransitionManager.transitions = [];\n112. \n113. \t\t\t\tconst raf = {\n114. \t\t\t\t\ttime: 0,\n115. \t\t\t\t\tcallback: null,\n116. \t\t\t\t\ttick: now => {\n117. \t\t\t\t\t\traf.time = now;\n118. \t\t\t\t\t\tif (raf.callback) raf.callback();\n119. \t\t\t\t\t}\n120. \t\t\t\t};\n121. \t\t\t\twindow.performance = { now: () => raf.time };\n122. \t\t\t\tglobal.requestAnimationFrame = cb => {\n123. \t\t\t\t\tlet called = false;\n124. \t\t\t\t\traf.callback = () => {\n125. \t\t\t\t\t\tif (!called) {\n126. \t\t\t\t\t\t\tcalled = true;\n127. \t\t\t\t\t\t\tcb();\n128. \t\t\t\t\t\t}\n129. \t\t\t\t\t};\n130. \t\t\t\t};\n131. \n132. \t\t\t\tglobal.window = window;\n133. \n134. \t\t\t\ttry {\n135. \t\t\t\t\tSvelteComponent = require(`./samples/${dir}/main.html`);\n136. \t\t\t\t} catch (err) {\n137. \t\t\t\t\tshowOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console\n138. \t\t\t\t\tthrow err;\n139. \t\t\t\t}\n140. \n141. \t\t\t\tglobal.window = window;\n142. \n143. \t\t\t\t// Put the constructor on window for testing\n144. \t\t\t\twindow.SvelteComponent = SvelteComponent;\n145. \n146. \t\t\t\tconst target = window.document.querySelector("main");\n147. \n148. \t\t\t\tconst warnings = [];\n149. \t\t\t\tconst warn = console.warn;\n150. \t\t\t\tconsole.warn = warning => {\n151. \t\t\t\t\twarnings.push(warning);\n152. \t\t\t\t};\n153. \n154. \t\t\t\tconst options = Object.assign({}, {\n155. \t\t\t\t\ttarget,\n156. \t\t\t\t\thydrate,\n157. \t\t\t\t\tdata: config.data\n158. \t\t\t\t}, config.options || {});\n159. \n160. \t\t\t\tconst component = new SvelteComponent(options);\n161. \n162. \t\t\t\tconsole.warn = warn;\n163. \n164. \t\t\t\tif (config.error) {\n165. \t\t\t\t\tunintendedError = true;\n166. \t\t\t\t\tthrow new Error("Expected a runtime error");\n167. \t\t\t\t}\n168. \n169. \t\t\t\tif (config.warnings) {\n170. \t\t\t\t\tassert.deepEqual(warnings, config.warnings);\n171. \t\t\t\t} else if (warnings.length) {\n172. \t\t\t\t\tunintendedError = true;\n173. \t\t\t\t\tthrow new Error("Received unexpected warnings");\n174. \t\t\t\t}\n175. \n176. \t\t\t\tif (config.html) {\n177. \t\t\t\t\tassert.htmlEqual(target.innerHTML, config.html);\n178. \t\t\t\t}\n179. \n180. \t\t\t\tif (config.test) {\n181. \t\t\t\t\tconfig.test(assert, component, target, window, raf);\n182. \t\t\t\t} else {\n183. \t\t\t\t\tcomponent.destroy();\n184. \t\t\t\t\tassert.equal(target.innerHTML, "");\n185. \t\t\t\t}\n186. \t\t\t} catch (err) {\n187. \t\t\t\tif (config.error && !unintendedError) {\n188. \t\t\t\t\tconfig.error(assert, err);\n189. \t\t\t\t} else {\n190. \t\t\t\t\tfailed.add(dir);\n191. \t\t\t\t\tshowOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console\n192. \t\t\t\t\tthrow err;\n193. \t\t\t\t}\n194. \t\t\t}\n195. \n196. \t\t\tif (config.show) showOutput(cwd, { shared, hydratable: hydrate }, svelte);\n197. \t\t});\n198. \t}\n199. \n200. \tconst shared = path.resolve("shared.js");\n201. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n202. \t\trunTest(dir, shared, false);\n203. \t\trunTest(dir, shared, true);\n204. \t\trunTest(dir, null, false);\n205. \t});\n206. \n207. \tit("fails if options.target is missing in dev mode", () => {\n208. \t\tconst { code } = svelte.compile(`<div></div>`, {\n209. \t\t\tformat: "iife",\n210. \t\t\tname: "SvelteComponent",\n211. \t\t\tdev: true\n212. \t\t});\n213. \n214. \t\tconst SvelteComponent = eval(\n215. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n216. \t\t);\n217. \n218. \t\tassert.throws(() => {\n219. \t\t\tnew SvelteComponent();\n220. \t\t}, /\'target\' is a required option/);\n221. \t});\n222. \n223. \tit("fails if options.hydrate is true but the component is non-hydratable", () => {\n224. \t\tconst { code } = svelte.compile(`<div></div>`, {\n225. \t\t\tformat: "iife",\n226. \t\t\tname: "SvelteComponent",\n227. \t\t\tdev: true\n228. \t\t});\n229. \n230. \t\tconst SvelteComponent = eval(\n231. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n232. \t\t);\n233. \n234. \t\tassert.throws(() => {\n235. \t\t\tnew SvelteComponent({\n236. \t\t\t\ttarget: {},\n237. \t\t\t\thydrate: true\n238. \t\t\t});\n239. \t\t}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);\n240. \t});\n241. });', start_line_number=1, end_line_number=241), Context(relative_path='test/runtime/samples/bindings-before-oncreate/_config.js', content='1. export default {\n2. \ttest(assert, component) {\n3. \t\tassert.equal(component.refs.one.snapshot, 2);\n4. \t}\n5. };', start_line_number=1, end_line_number=5), Context(relative_path='test/runtime/samples/bindings-before-oncreate/main.html', content="1. <One ref:one/>\n2. \n3. <script>\n4. \timport One from './One.html';\n5. \n6. \texport default {\n7. \t\tcomponents: { One }\n8. \t};\n9. </script>", start_line_number=1, end_line_number=9), Context(relative_path='test/runtime/samples/lifecycle-events/_config.js', content="1. export default {\n2. \ttest(assert, component) {\n3. \t\tassert.deepEqual(component.events, ['create']);\n4. \t\tcomponent.destroy();\n5. \t\tassert.deepEqual(component.events, ['create', 'destroy']);\n6. \t}\n7. };", start_line_number=1, end_line_number=7), Context(relative_path='test/runtime/samples/lifecycle-events/main.html', content="1. <div></div>\n2. \n3. <script>\n4. \texport default {\n5. \t\toncreate() {\n6. \t\t\tthis.events = ['create'];\n7. \t\t},\n8. \n9. \t\tondestroy() {\n10. \t\t\tthis.events.push('destroy');\n11. \t\t}\n12. \t};\n13. </script>", start_line_number=1, end_line_number=13), Context(relative_path='test/runtime/samples/ondestroy-before-cleanup/_config.js', content="1. export default {\n2. \ttest(assert, component, target) {\n3. \t\tconst top = component.refs.top;\n4. \t\tconst div = target.querySelector('div');\n5. \n6. \t\tcomponent.set({ visible: false });\n7. \t\tassert.equal(top.refOnDestroy, div);\n8. \t}\n9. };", start_line_number=1, end_line_number=9), Context(relative_path='test/runtime/samples/ondestroy-before-cleanup/main.html', content="1. {{#if visible}}\n2. \t<Top ref:top></Top>\n3. {{/if}}\n4. \n5. <script>\n6. \timport Top from './Top.html';\n7. \t\n8. \texport default {\n9. \t\tdata() {\n10. \t\t\treturn {\n11. \t\t\t\tvisible: true\n12. \t\t\t};\n13. \t\t},\n14. \t\tcomponents: {\n15. \t\t\tTop\n16. \t\t}\n17. \t};\n18. </script>", start_line_number=1, end_line_number=18), Context(relative_path='test/runtime/samples/onrender-fires-when-ready-nested/_config.js', content="1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: `<div><p>true</p>\\n<p>true</p></div>`\n5. };", start_line_number=1, end_line_number=5), Context(relative_path='test/runtime/samples/onrender-fires-when-ready-nested/main.html', content="1. <div>\n2. \t<Widget/>\n3. \t<ParentWidget />\n4. </div>\n5. \n6. <script>\n7. \timport Widget from './Widget.html';\n8. \timport ParentWidget from './ParentWidget.html';\n9. \n10. \texport default {\n11. \t\tcomponents: {\n12. \t\t\tWidget,\n13. \t\t\tParentWidget\n14. \t\t}\n15. \t};\n16. </script>", start_line_number=1, end_line_number=16), Context(relative_path='test/runtime/samples/onrender-fires-when-ready/Widget.html', content='1. <p ref:x>{{inDocument}}</p>\n2. \n3. <script>\n4. \texport default {\n5. \t\toncreate () {\n6. \t\t\tthis.set({ inDocument: document.contains( this.refs.x ) })\n7. \t\t}\n8. \t};', start_line_number=1, end_line_number=8), Context(relative_path='test/runtime/samples/onrender-fires-when-ready/_config.js', content="1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: `<div><p>true</p></div>`,\n5. \n6. \ttest ( assert, component, target ) {\n7. \t\tcomponent.set({ foo: true });\n8. \t\tassert.htmlEqual( target.innerHTML, `<div><p>true</p>\\n<p>true</p></div>` );\n9. \n10. \t\tcomponent.destroy();\n11. \t}\n12. };", start_line_number=1, end_line_number=12), Context(relative_path='test/runtime/samples/onrender-fires-when-ready/main.html', content="1. <div>\n2. \t<Widget/>\n3. \n4. \t{{#if foo}}\n5. \t\t<Widget/>\n6. \t{{/if}}\n7. </div>\n8. \n9. <script>\n10. \timport Widget from './Widget.html';\n11. \n12. \texport default {\n13. \t\tcomponents: {\n14. \t\t\tWidget\n15. \t\t}\n16. \t};\n17. </script>", start_line_number=1, end_line_number=17), Context(relative_path='test/runtime/samples/set-in-oncreate/_config.js', content="1. export default {\n2. \t'skip-ssr': true, // uses oncreate\n3. \n4. \thtml: '<p>2</p>'\n5. };", start_line_number=1, end_line_number=5), Context(relative_path='test/runtime/samples/set-in-oncreate/main.html', content='1. <p>{{foo}}</p>\n2. \n3. <script>\n4. \texport default {\n5. \t\tdata: () => ({\n6. \t\t\tfoo: 1\n7. \t\t}),\n8. \n9. \t\toncreate () {\n10. \t\t\tthis.set({ foo: 2 });\n11. \t\t}\n12. \t};\n13. </script>', start_line_number=1, end_line_number=13), Context(relative_path='test/server-side-rendering/index.js', content='1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";', start_line_number=1, end_line_number=11), Context(relative_path='test/server-side-rendering/index.js', content='23. \tbefore(() => {\n24. \t\trequire(process.env.COVERAGE\n25. \t\t\t? "../../src/server-side-rendering/register.js"\n26. \t\t\t: "../../ssr/register");\n27. \n28. \t\treturn setupHtmlEqual();\n29. \t});', start_line_number=23, end_line_number=29), Context(relative_path='test/server-side-rendering/index.js', content='31. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n32. \t\tif (dir[0] === ".") return;\n33. \n34. \t\t// add .solo to a sample directory name to only run that test, or\n35. \t\t// .show to always show the output. or both\n36. \t\tconst solo = /\\.solo/.test(dir);\n37. \t\tconst show = /\\.show/.test(dir);\n38. \n39. \t\tif (solo && process.env.CI) {\n40. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n41. \t\t}\n42. \n43. \t\t(solo ? it.only : it)(dir, () => {\n44. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n45. \t\t\ttry {\n46. \t\t\t\tconst component = require(`${dir}/main.html`);\n47. \n48. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n49. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n50. \n51. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n52. \n53. \t\t\t\tconst html = component.render(data);\n54. \t\t\t\tconst css = component.renderCss().css;\n55. \n56. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n57. \t\t\t\tif (css) fs.writeFileSync(`${dir}/_actual.css`, css);\n58. \n59. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n60. \t\t\t\tassert.equal(\n61. \t\t\t\t\tcss.replace(/^\\s+/gm, ""),\n62. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n63. \t\t\t\t);\n64. \n65. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n66. \t\t\t} catch (err) {\n67. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n68. \t\t\t\tthrow err;\n69. \t\t\t}\n70. \t\t});\n71. \t});', start_line_number=31, end_line_number=71), Context(relative_path='test/server-side-rendering/index.js', content='73. \t// duplicate client-side tests, as far as possible\n74. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n75. \t\tif (dir[0] === ".") return;\n76. \n77. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n78. \n79. \t\tif (config.solo && process.env.CI) {\n80. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n81. \t\t}\n82. \n83. \t\tif (config["skip-ssr"]) return;\n84. \n85. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n86. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n87. \n88. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n89. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n90. \t\t\t\tdelete require.cache[resolved];\n91. \t\t\t});\n92. \n93. \t\t\ttry {\n94. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n95. \t\t\t\tconst html = component.render(config.data);\n96. \n97. \t\t\t\tif (config.html) {\n98. \t\t\t\t\tassert.htmlEqual(html, config.html);\n99. \t\t\t\t}\n100. \t\t\t} catch (err) {\n101. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n102. \t\t\t\tthrow err;\n103. \t\t\t}\n104. \t\t});\n105. \t});\n106. });', start_line_number=73, end_line_number=106), Context(relative_path='test/setup.js', content='1. const fs = require(\'fs\');\n2. const path = require(\'path\');\n3. \n4. require(\'console-group\').install();\n5. require(\'source-map-support\').install();\n6. \n7. require.extensions[\'.js\'] = function(module, filename) {\n8. \tconst exports = [];\n9. \n10. \tvar code = fs.readFileSync(filename, \'utf-8\')\n11. \t\t.replace(/^import (?:\\* as )?(\\w+) from [\'"]([^\'"]+)[\'"];?/gm, \'var $1 = require("$2");\')\n12. \t\t.replace(/^import {([^}]+)} from [\'"](.+)[\'"];?/gm, \'var {$1} = require("$2");\')\n13. \t\t.replace(/^export default /gm, \'module.exports = \')\n14. \t\t.replace(/^export (const|let|var|class|function) (\\w+)/gm, (match, type, name) => {\n15. \t\t\texports.push(name);\n16. \t\t\treturn `${type} ${name}`;\n17. \t\t})\n18. \t\t.replace(/^export \\{([^}]+)\\}/gm, (match, names) => {\n19. \t\t\tnames.split(\',\').filter(Boolean).forEach(name => {\n20. \t\t\t\texports.push(name);\n21. \t\t\t});\n22. \n23. \t\t\treturn \'\';\n24. \t\t})\n25. \t\t.replace(/^export function (\\w+)/gm, \'exports.$1 = function $1\');\n26. \n27. \texports.forEach(name => {\n28. \t\tcode += `\\nexports.${name} = ${name};`;\n29. \t});\n30. \n31. \ttry {\n32. \t\treturn module._compile(code, filename);\n33. \t} catch (err) {\n34. \t\tconsole.log(code); // eslint-disable-line no-console\n35. \t\tthrow err;\n36. \t}\n37. };', start_line_number=1, end_line_number=37)]
2025-11-11 00:34:05,495 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_write_message_node - DEBUG - Sending message to BugReproducingWriteNode:
content='Issue title:\nasync keyword is removed\n\nIssue description: \n[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:\n\n```js\nexport default {\n  async oncreate() {\n    const data = await fetch(\'foo.json\').then(r => r.json());\n    console.log(data);\n  }\n};\n```\n\nIssue comments:\n\n\nBug reproducing context:\nFile: test/helpers.js\nLine number range: 1 - 22\nContent:\n1. import { JSDOM } from \'jsdom\';\n2. import assert from \'assert\';\n3. import glob from \'glob\';\n4. import fs from \'fs\';\n5. import path from \'path\';\n6. import chalk from \'chalk\';\n7. \n8. // for coverage purposes, we need to test source files,\n9. // but for sanity purposes, we need to test dist files\n10. export function loadSvelte(test) {\n11. \tif (test) global.__svelte_test = true;\n12. \n13. \tconst resolved = process.env.COVERAGE\n14. \t\t? require.resolve(\'../src/index.js\')\n15. \t\t: require.resolve(\'../compiler/svelte.js\');\n16. \n17. \tdelete require.cache[resolved];\n18. \treturn require(resolved);\n19. }\n20. \n21. export const svelte = loadSvelte();\n22. \n\n\nFile: test/helpers.js\nLine number range: 32 - 39\nContent:\n32. export function tryToLoadJson(file) {\n33. \ttry {\n34. \t\treturn JSON.parse(fs.readFileSync(file));\n35. \t} catch (err) {\n36. \t\tif (err.code !== \'ENOENT\') throw err;\n37. \t\treturn null;\n38. \t}\n39. }\n\n\nFile: test/helpers.js\nLine number range: 41 - 48\nContent:\n41. export function tryToReadFile(file) {\n42. \ttry {\n43. \t\treturn fs.readFileSync(file, \'utf-8\');\n44. \t} catch (err) {\n45. \t\tif (err.code !== \'ENOENT\') throw err;\n46. \t\treturn null;\n47. \t}\n48. }\n\n\nFile: test/helpers.js\nLine number range: 50 - 58\nContent:\n50. const { window } = new JSDOM(\'<main></main>\');\n51. global.document = window.document;\n52. \n53. export function env() {\n54. \twindow._svelteTransitionManager = null;\n55. \twindow.document.body.innerHTML = \'<main></main>\';\n56. \n57. \treturn window;\n58. }\n\n\nFile: test/helpers.js\nLine number range: 116 - 140\nContent:\n116. export function normalizeHtml(window, html) {\n117. \ttry {\n118. \t\tconst node = window.document.createElement(\'div\');\n119. \t\tnode.innerHTML = html\n120. \t\t\t.replace(/<!--.*?-->/g, \'\')\n121. \t\t\t.replace(/>[\\s\\r\\n]+</g, \'><\')\n122. \t\t\t.trim();\n123. \t\tcleanChildren(node, \'\');\n124. \t\treturn node.innerHTML.replace(/<\\/?noscript\\/?>/g, \'\');\n125. \t} catch (err) {\n126. \t\tthrow new Error(`Failed to normalize HTML:\\n${html}`);\n127. \t}\n128. }\n129. \n130. export function setupHtmlEqual() {\n131. \tconst window = env();\n132. \n133. \tassert.htmlEqual = (actual, expected, message) => {\n134. \t\tassert.deepEqual(\n135. \t\t\tnormalizeHtml(window, actual),\n136. \t\t\tnormalizeHtml(window, expected),\n137. \t\t\tmessage\n138. \t\t);\n139. \t};\n140. }\n\n\nFile: test/helpers.js\nLine number range: 142 - 156\nContent:\n142. export function loadConfig(file) {\n143. \ttry {\n144. \t\tconst resolved = require.resolve(file);\n145. \t\tdelete require.cache[resolved];\n146. \n147. \t\tconst config = require(resolved);\n148. \t\treturn config.default || config;\n149. \t} catch (err) {\n150. \t\tif (err.code === \'MODULE_NOT_FOUND\') {\n151. \t\t\treturn {};\n152. \t\t}\n153. \n154. \t\tthrow err;\n155. \t}\n156. }\n\n\nFile: test/helpers.js\nLine number range: 158 - 171\nContent:\n158. export function addLineNumbers(code) {\n159. \treturn code\n160. \t\t.split(\'\\n\')\n161. \t\t.map((line, i) => {\n162. \t\t\ti = String(i + 1);\n163. \t\t\twhile (i.length < 3) i = ` ${i}`;\n164. \n165. \t\t\treturn (\n166. \t\t\t\tchalk.grey(`  ${i}: `) +\n167. \t\t\t\tline.replace(/^\\t+/, match => match.split(\'\\t\').join(\'    \'))\n168. \t\t\t);\n169. \t\t})\n170. \t\t.join(\'\\n\');\n171. }\n\n\nFile: test/helpers.js\nLine number range: 173 - 175\nContent:\n173. function capitalise(str) {\n174. \treturn str[0].toUpperCase() + str.slice(1);\n175. }\n\n\nFile: test/helpers.js\nLine number range: 177 - 192\nContent:\n177. export function showOutput(cwd, options = {}, s = svelte) {\n178. \tglob.sync(\'**/*.html\', { cwd }).forEach(file => {\n179. \t\tif (file[0] === \'_\') return;\n180. \t\tconst { code } = s.compile(\n181. \t\t\tfs.readFileSync(`${cwd}/${file}`, \'utf-8\'),\n182. \t\t\tObject.assign(options, {\n183. \t\t\t\tfilename: file,\n184. \t\t\t\tname: capitalise(path.basename(file).replace(/\\.html$/, \'\'))\n185. \t\t\t})\n186. \t\t);\n187. \n188. \t\tconsole.log( // eslint-disable-line no-console\n189. \t\t\t`\\n>> ${chalk.cyan.bold(file)}\\n${addLineNumbers(code)}\\n<< ${chalk.cyan.bold(file)}`\n190. \t\t);\n191. \t});\n192. }\n\n\nFile: test/helpers.js\nLine number range: 235 - 239\nContent:\n235. export function spaces(i) {\n236. \tlet result = \'\';\n237. \twhile (i--) result += \' \';\n238. \treturn result;\n239. }\n\n\nFile: test/js/index.js\nLine number range: 1 - 79\nContent:\n1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import { rollup } from "rollup";\n5. import { loadConfig, svelte } from "../helpers.js";\n6. \n7. describe("js", () => {\n8. \tfs.readdirSync("test/js/samples").forEach(dir => {\n9. \t\tif (dir[0] === ".") return;\n10. \n11. \t\t// add .solo to a sample directory name to only run that test\n12. \t\tconst solo = /\\.solo/.test(dir);\n13. \n14. \t\tif (solo && process.env.CI) {\n15. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n16. \t\t}\n17. \n18. \t\t(solo ? it.only : it)(dir, () => {\n19. \t\t\tdir = path.resolve("test/js/samples", dir);\n20. \t\t\tconst config = loadConfig(`${dir}/_config.js`);\n21. \n22. \t\t\tconst input = fs\n23. \t\t\t\t.readFileSync(`${dir}/input.html`, "utf-8")\n24. \t\t\t\t.replace(/\\s+$/, "");\n25. \n26. \t\t\tlet actual;\n27. \n28. \t\t\ttry {\n29. \t\t\t\tconst options = Object.assign(config.options || {}, {\n30. \t\t\t\t\tshared: true\n31. \t\t\t\t});\n32. \n33. \t\t\t\tactual = svelte.compile(input, options).code.replace(/generated by Svelte v\\d+\\.\\d+\\.\\d+/, \'generated by Svelte vX.Y.Z\');\n34. \t\t\t} catch (err) {\n35. \t\t\t\tconsole.log(err.frame);\n36. \t\t\t\tthrow err;\n37. \t\t\t}\n38. \n39. \t\t\tfs.writeFileSync(`${dir}/_actual.js`, actual);\n40. \n41. \t\t\treturn rollup({\n42. \t\t\t\tinput: `${dir}/_actual.js`,\n43. \t\t\t\tplugins: [\n44. \t\t\t\t\t{\n45. \t\t\t\t\t\tresolveId(importee, importer) {\n46. \t\t\t\t\t\t\tif (!importer) return importee;\n47. \t\t\t\t\t\t\tif (importee === "svelte/shared.js")\n48. \t\t\t\t\t\t\t\treturn path.resolve("shared.js");\n49. \t\t\t\t\t\t\treturn null;\n50. \t\t\t\t\t\t}\n51. \t\t\t\t\t}\n52. \t\t\t\t]\n53. \t\t\t}).then(bundle => {\n54. \t\t\t\treturn bundle.generate({ format: "es" });\n55. \t\t\t}).then(({ code }) => {\n56. \t\t\t\tfs.writeFileSync(`${dir}/_actual-bundle.js`, code);\n57. \n58. \t\t\t\tconst expected = fs.readFileSync(`${dir}/expected.js`, "utf-8");\n59. \t\t\t\tconst expectedBundle = fs.readFileSync(\n60. \t\t\t\t\t`${dir}/expected-bundle.js`,\n61. \t\t\t\t\t"utf-8"\n62. \t\t\t\t);\n63. \n64. \t\t\t\tassert.equal(\n65. \t\t\t\t\tactual.trim().replace(/^[ \\t]+$/gm, ""),\n66. \t\t\t\t\texpected.trim().replace(/^[ \\t]+$/gm, "")\n67. \t\t\t\t);\n68. \n69. \t\t\t\tassert.equal(\n70. \t\t\t\t\tcode.trim().replace(/^[ \\t]+$/gm, ""),\n71. \t\t\t\t\texpectedBundle.trim().replace(/^[ \\t]+$/gm, "")\n72. \t\t\t\t);\n73. \t\t\t}).catch(err => {\n74. \t\t\t\tif (err.loc) console.error(err.loc);\n75. \t\t\t\tthrow err;\n76. \t\t\t});\n77. \t\t});\n78. \t});\n79. });\n\n\nFile: test/js/samples/onrender-onteardown-rewritten/expected-bundle.js\nLine number range: 1 - 214\nContent:\n1. function noop() {}\n2. \n3. function assign(target) {\n4. \tvar k,\n5. \t\tsource,\n6. \t\ti = 1,\n7. \t\tlen = arguments.length;\n8. \tfor (; i < len; i++) {\n9. \t\tsource = arguments[i];\n10. \t\tfor (k in source) target[k] = source[k];\n11. \t}\n12. \n13. \treturn target;\n14. }\n15. \n16. function blankObject() {\n17. \treturn Object.create(null);\n18. }\n19. \n20. function destroy(detach) {\n21. \tthis.destroy = noop;\n22. \tthis.fire(\'destroy\');\n23. \tthis.set = this.get = noop;\n24. \n25. \tif (detach !== false) this._fragment.u();\n26. \tthis._fragment.d();\n27. \tthis._fragment = this._state = null;\n28. }\n29. \n30. function differs(a, b) {\n31. \treturn a !== b || ((a && typeof a === \'object\') || typeof a === \'function\');\n32. }\n33. \n34. function dispatchObservers(component, group, changed, newState, oldState) {\n35. \tfor (var key in group) {\n36. \t\tif (!changed[key]) continue;\n37. \n38. \t\tvar newValue = newState[key];\n39. \t\tvar oldValue = oldState[key];\n40. \n41. \t\tvar callbacks = group[key];\n42. \t\tif (!callbacks) continue;\n43. \n44. \t\tfor (var i = 0; i < callbacks.length; i += 1) {\n45. \t\t\tvar callback = callbacks[i];\n46. \t\t\tif (callback.__calling) continue;\n47. \n48. \t\t\tcallback.__calling = true;\n49. \t\t\tcallback.call(component, newValue, oldValue);\n50. \t\t\tcallback.__calling = false;\n51. \t\t}\n52. \t}\n53. }\n54. \n55. function fire(eventName, data) {\n56. \tvar handlers =\n57. \t\teventName in this._handlers && this._handlers[eventName].slice();\n58. \tif (!handlers) return;\n59. \n60. \tfor (var i = 0; i < handlers.length; i += 1) {\n61. \t\thandlers[i].call(this, data);\n62. \t}\n63. }\n64. \n65. function get(key) {\n66. \treturn key ? this._state[key] : this._state;\n67. }\n68. \n69. function init(component, options) {\n70. \tcomponent.options = options;\n71. \n72. \tcomponent._observers = { pre: blankObject(), post: blankObject() };\n73. \tcomponent._handlers = blankObject();\n74. \tcomponent._root = options._root || component;\n75. \tcomponent._yield = options._yield;\n76. \tcomponent._bind = options._bind;\n77. }\n78. \n79. function observe(key, callback, options) {\n80. \tvar group = options && options.defer\n81. \t\t? this._observers.post\n82. \t\t: this._observers.pre;\n83. \n84. \t(group[key] || (group[key] = [])).push(callback);\n85. \n86. \tif (!options || options.init !== false) {\n87. \t\tcallback.__calling = true;\n88. \t\tcallback.call(this, this._state[key]);\n89. \t\tcallback.__calling = false;\n90. \t}\n91. \n92. \treturn {\n93. \t\tcancel: function() {\n94. \t\t\tvar index = group[key].indexOf(callback);\n95. \t\t\tif (~index) group[key].splice(index, 1);\n96. \t\t}\n97. \t};\n98. }\n99. \n100. function on(eventName, handler) {\n101. \tif (eventName === \'teardown\') return this.on(\'destroy\', handler);\n102. \n103. \tvar handlers = this._handlers[eventName] || (this._handlers[eventName] = []);\n104. \thandlers.push(handler);\n105. \n106. \treturn {\n107. \t\tcancel: function() {\n108. \t\t\tvar index = handlers.indexOf(handler);\n109. \t\t\tif (~index) handlers.splice(index, 1);\n110. \t\t}\n111. \t};\n112. }\n113. \n114. function set(newState) {\n115. \tthis._set(assign({}, newState));\n116. \tif (this._root._lock) return;\n117. \tthis._root._lock = true;\n118. \tcallAll(this._root._beforecreate);\n119. \tcallAll(this._root._oncreate);\n120. \tcallAll(this._root._aftercreate);\n121. \tthis._root._lock = false;\n122. }\n123. \n124. function _set(newState) {\n125. \tvar oldState = this._state,\n126. \t\tchanged = {},\n127. \t\tdirty = false;\n128. \n129. \tfor (var key in newState) {\n130. \t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n131. \t}\n132. \tif (!dirty) return;\n133. \n134. \tthis._state = assign({}, oldState, newState);\n135. \tthis._recompute(changed, this._state);\n136. \tif (this._bind) this._bind(changed, this._state);\n137. \tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n138. \tthis._fragment.p(changed, this._state);\n139. \tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n140. }\n141. \n142. function callAll(fns) {\n143. \twhile (fns && fns.length) fns.pop()();\n144. }\n145. \n146. function _mount(target, anchor) {\n147. \tthis._fragment.m(target, anchor);\n148. }\n149. \n150. function _unmount() {\n151. \tthis._fragment.u();\n152. }\n153. \n154. var proto = {\n155. \tdestroy: destroy,\n156. \tget: get,\n157. \tfire: fire,\n158. \tobserve: observe,\n159. \ton: on,\n160. \tset: set,\n161. \tteardown: destroy,\n162. \t_recompute: noop,\n163. \t_set: _set,\n164. \t_mount: _mount,\n165. \t_unmount: _unmount\n166. };\n167. \n168. /* generated by Svelte vX.Y.Z */\n169. function oncreate() {}\n170. \n171. function ondestroy() {}\n172. \n173. function create_main_fragment(state, component) {\n174. \n175. \treturn {\n176. \t\tc: noop,\n177. \n178. \t\tm: noop,\n179. \n180. \t\tp: noop,\n181. \n182. \t\tu: noop,\n183. \n184. \t\td: noop\n185. \t};\n186. }\n187. \n188. function SvelteComponent(options) {\n189. \tinit(this, options);\n190. \tthis._state = assign({}, options.data);\n191. \n192. \tthis._handlers.destroy = [ondestroy];\n193. \n194. \tvar _oncreate = oncreate.bind(this);\n195. \n196. \tif (!options._root) {\n197. \t\tthis._oncreate = [_oncreate];\n198. \t} else {\n199. \t \tthis._root._oncreate.push(_oncreate);\n200. \t }\n201. \n202. \tthis._fragment = create_main_fragment(this._state, this);\n203. \n204. \tif (options.target) {\n205. \t\tthis._fragment.c();\n206. \t\tthis._fragment.m(options.target, options.anchor || null);\n207. \n208. \t\tcallAll(this._oncreate);\n209. \t}\n210. }\n211. \n212. assign(SvelteComponent.prototype, proto);\n213. \n214. export default SvelteComponent;\n\n\nFile: test/js/samples/onrender-onteardown-rewritten/expected.js\nLine number range: 1 - 48\nContent:\n1. /* generated by Svelte vX.Y.Z */\n2. import { assign, callAll, init, noop, proto } from "svelte/shared.js";\n3. \n4. function oncreate() {};\n5. \n6. function ondestroy() {};\n7. \n8. function create_main_fragment(state, component) {\n9. \n10. \treturn {\n11. \t\tc: noop,\n12. \n13. \t\tm: noop,\n14. \n15. \t\tp: noop,\n16. \n17. \t\tu: noop,\n18. \n19. \t\td: noop\n20. \t};\n21. }\n22. \n23. function SvelteComponent(options) {\n24. \tinit(this, options);\n25. \tthis._state = assign({}, options.data);\n26. \n27. \tthis._handlers.destroy = [ondestroy]\n28. \n29. \tvar _oncreate = oncreate.bind(this);\n30. \n31. \tif (!options._root) {\n32. \t\tthis._oncreate = [_oncreate];\n33. \t} else {\n34. \t \tthis._root._oncreate.push(_oncreate);\n35. \t }\n36. \n37. \tthis._fragment = create_main_fragment(this._state, this);\n38. \n39. \tif (options.target) {\n40. \t\tthis._fragment.c();\n41. \t\tthis._fragment.m(options.target, options.anchor || null);\n42. \n43. \t\tcallAll(this._oncreate);\n44. \t}\n45. }\n46. \n47. assign(SvelteComponent.prototype, proto);\n48. export default SvelteComponent;\n\n\nFile: test/js/samples/onrender-onteardown-rewritten/input.html\nLine number range: 1 - 7\nContent:\n1. <script>\n2. \texport default {\n3. \t\t// this test should be removed in v2\n4. \t\tonrender () {},\n5. \t\tonteardown () {}\n6. \t};\n7. </script>\n\n\nFile: test/js/samples/setup-method/expected.js\nLine number range: 1 - 19\nContent:\n1. /* generated by Svelte vX.Y.Z */\n2. import { assign, init, noop, proto } from "svelte/shared.js";\n3. \n4. var methods = {\n5. \tfoo ( bar ) {\n6. \t\tconsole.log( bar );\n7. \t}\n8. };\n9. \n10. function setup(Component) {\n11. \tComponent.SOME_CONSTANT = 42;\n12. \tComponent.factory = function (target) {\n13. \t\treturn new Component({\n14. \t\t\ttarget: target\n15. \t\t});\n16. \t}\n17. \tComponent.prototype.foo( \'baz\' );\n18. }\n19. \n\n\nFile: test/js/samples/setup-method/expected.js\nLine number range: 35 - 50\nContent:\n35. function SvelteComponent(options) {\n36. \tinit(this, options);\n37. \tthis._state = assign({}, options.data);\n38. \n39. \tthis._fragment = create_main_fragment(this._state, this);\n40. \n41. \tif (options.target) {\n42. \t\tthis._fragment.c();\n43. \t\tthis._fragment.m(options.target, options.anchor || null);\n44. \t}\n45. }\n46. \n47. assign(SvelteComponent.prototype, methods, proto);\n48. \n49. setup(SvelteComponent);\n50. export default SvelteComponent;\n\n\nFile: test/js/samples/setup-method/input.html\nLine number range: 1 - 18\nContent:\n1. <script>\n2. \texport default {\n3. \t\tmethods: {\n4. \t\t\tfoo ( bar ) {\n5. \t\t\t\tconsole.log( bar );\n6. \t\t\t}\n7. \t\t},\n8. \t\tsetup: (Component) => {\n9. \t\t\tComponent.SOME_CONSTANT = 42;\n10. \t\t\tComponent.factory = function (target) {\n11. \t\t\t\treturn new Component({\n12. \t\t\t\t\ttarget: target\n13. \t\t\t\t});\n14. \t\t\t}\n15. \t\t\tComponent.prototype.foo( \'baz\' );\n16. \t\t}\n17. \t};\n18. </script>\n\n\nFile: test/js/samples/ssr-no-oncreate-etc/_config.js\nLine number range: 1 - 5\nContent:\n1. export default {\n2. \toptions: {\n3. \t\tgenerate: \'ssr\'\n4. \t}\n5. };\n\n\nFile: test/js/samples/ssr-no-oncreate-etc/expected-bundle.js\nLine number range: 1 - 23\nContent:\n1. var SvelteComponent = {};\n2. \n3. SvelteComponent.data = function() {\n4. \treturn {};\n5. };\n6. \n7. SvelteComponent.render = function(state, options) {\n8. \tstate = state || {};\n9. \n10. \treturn ``.trim();\n11. };\n12. \n13. SvelteComponent.renderCss = function() {\n14. \tvar components = [];\n15. \n16. \treturn {\n17. \t\tcss: components.map(x => x.css).join(\'\\n\'),\n18. \t\tmap: null,\n19. \t\tcomponents\n20. \t};\n21. };\n22. \n23. module.exports = SvelteComponent;\n\n\nFile: test/js/samples/ssr-no-oncreate-etc/expected.js\nLine number range: 1 - 37\nContent:\n1. "use strict";\n2. \n3. var SvelteComponent = {};;\n4. \n5. SvelteComponent.data = function() {\n6. \treturn {};\n7. };\n8. \n9. SvelteComponent.render = function(state, options) {\n10. \tstate = state || {};\n11. \n12. \treturn ``.trim();\n13. };\n14. \n15. SvelteComponent.renderCss = function() {\n16. \tvar components = [];\n17. \n18. \treturn {\n19. \t\tcss: components.map(x => x.css).join(\'\\n\'),\n20. \t\tmap: null,\n21. \t\tcomponents\n22. \t};\n23. };\n24. \n25. var escaped = {\n26. \t\'"\': \'&quot;\',\n27. \t"\'": \'&#39;\',\n28. \t\'&\': \'&amp;\',\n29. \t\'<\': \'&lt;\',\n30. \t\'>\': \'&gt;\'\n31. };\n32. \n33. function __escape(html) {\n34. \treturn String(html).replace(/["\'&<>]/g, match => escaped[match]);\n35. }\n36. \n37. module.exports = SvelteComponent;\n\n\nFile: test/js/samples/ssr-no-oncreate-etc/input.html\nLine number range: 1 - 23\nContent:\n1. <script>\n2. \texport default {\n3. \t\toncreate() {\n4. \t\t\tconsole.log(\'oncreate\');\n5. \t\t},\n6. \n7. \t\tondestroy() {\n8. \t\t\tconsole.log(\'ondestroy\');\n9. \t\t},\n10. \n11. \t\tmethods: {\n12. \t\t\tfoo() {\n13. \t\t\t\tconsole.log(\'foo\');\n14. \t\t\t}\n15. \t\t},\n16. \n17. \t\tevents: {\n18. \t\t\tswipe(node, callback) {\n19. \t\t\t\t// TODO implement\n20. \t\t\t}\n21. \t\t}\n22. \t};\n23. </script>\n\n\nFile: test/runtime/index.js\nLine number range: 1 - 241\nContent:\n1. import assert from "assert";\n2. import * as path from "path";\n3. import * as fs from "fs";\n4. import * as acorn from "acorn";\n5. import { transitionManager } from "../../shared.js";\n6. \n7. import {\n8. \tshowOutput,\n9. \tloadConfig,\n10. \tloadSvelte,\n11. \tenv,\n12. \tsetupHtmlEqual,\n13. \tspaces\n14. } from "../helpers.js";\n15. \n16. let svelte;\n17. \n18. let compileOptions = null;\n19. \n20. function getName(filename) {\n21. \tconst base = path.basename(filename).replace(".html", "");\n22. \treturn base[0].toUpperCase() + base.slice(1);\n23. }\n24. \n25. describe("runtime", () => {\n26. \tbefore(() => {\n27. \t\tsvelte = loadSvelte(true);\n28. \n29. \t\trequire.extensions[".html"] = function(module, filename) {\n30. \t\t\tconst options = Object.assign(\n31. \t\t\t\t{ filename, name: getName(filename), format: \'cjs\' },\n32. \t\t\t\tcompileOptions\n33. \t\t\t);\n34. \n35. \t\t\tconst { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);\n36. \n37. \t\t\treturn module._compile(code, filename);\n38. \t\t};\n39. \n40. \t\treturn setupHtmlEqual();\n41. \t});\n42. \n43. \tconst failed = new Set();\n44. \n45. \tfunction runTest(dir, shared, hydrate) {\n46. \t\tif (dir[0] === ".") return;\n47. \n48. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n49. \n50. \t\tif (config.solo && process.env.CI) {\n51. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n52. \t\t}\n53. \n54. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? \'shared\' : \'inline\'} helpers)`, () => {\n55. \t\t\tif (failed.has(dir)) {\n56. \t\t\t\t// this makes debugging easier, by only printing compiled output once\n57. \t\t\t\tthrow new Error(\'skipping test, already failed\');\n58. \t\t\t}\n59. \n60. \t\t\tconst cwd = path.resolve(`test/runtime/samples/${dir}`);\n61. \n62. \t\t\tcompileOptions = config.compileOptions || {};\n63. \t\t\tcompileOptions.shared = shared;\n64. \t\t\tcompileOptions.hydratable = hydrate;\n65. \t\t\tcompileOptions.dev = config.dev;\n66. \n67. \t\t\t// check that no ES2015+ syntax slipped in\n68. \t\t\tif (!config.allowES2015) {\n69. \t\t\t\ttry {\n70. \t\t\t\t\tconst source = fs.readFileSync(\n71. \t\t\t\t\t\t`test/runtime/samples/${dir}/main.html`,\n72. \t\t\t\t\t\t"utf-8"\n73. \t\t\t\t\t);\n74. \t\t\t\t\tconst { code } = svelte.compile(source, compileOptions);\n75. \t\t\t\t\tconst startIndex = code.indexOf("function create_main_fragment"); // may change!\n76. \t\t\t\t\tif (startIndex === -1) throw new Error("missing create_main_fragment");\n77. \t\t\t\t\tconst endIndex = code.lastIndexOf("export default");\n78. \t\t\t\t\tconst es5 =\n79. \t\t\t\t\t\tcode.slice(0, startIndex).split(\'\\n\').map(x => spaces(x.length)).join(\'\\n\') +\n80. \t\t\t\t\t\tcode.slice(startIndex, endIndex);\n81. \n82. \t\t\t\t\tacorn.parse(es5, { ecmaVersion: 5 });\n83. \n84. \t\t\t\t\tif (/Object\\.assign/.test(es5)) {\n85. \t\t\t\t\t\tthrow new Error(\n86. \t\t\t\t\t\t\t"cannot use Object.assign in generated code, as it is not supported everywhere"\n87. \t\t\t\t\t\t);\n88. \t\t\t\t\t}\n89. \t\t\t\t} catch (err) {\n90. \t\t\t\t\tfailed.add(dir);\n91. \t\t\t\t\tshowOutput(cwd, { shared }, svelte); // eslint-disable-line no-console\n92. \t\t\t\t\tthrow err;\n93. \t\t\t\t}\n94. \t\t\t}\n95. \n96. \t\t\tObject.keys(require.cache)\n97. \t\t\t\t.filter(x => x.endsWith(".html"))\n98. \t\t\t\t.forEach(file => {\n99. \t\t\t\t\tdelete require.cache[file];\n100. \t\t\t\t});\n101. \n102. \t\t\tlet SvelteComponent;\n103. \n104. \t\t\tlet unintendedError = null;\n105. \n106. \t\t\tconst window = env();\n107. \n108. \t\t\ttry {\n109. \t\t\t\t// set of hacks to support transition tests\n110. \t\t\t\ttransitionManager.running = false;\n111. \t\t\t\ttransitionManager.transitions = [];\n112. \n113. \t\t\t\tconst raf = {\n114. \t\t\t\t\ttime: 0,\n115. \t\t\t\t\tcallback: null,\n116. \t\t\t\t\ttick: now => {\n117. \t\t\t\t\t\traf.time = now;\n118. \t\t\t\t\t\tif (raf.callback) raf.callback();\n119. \t\t\t\t\t}\n120. \t\t\t\t};\n121. \t\t\t\twindow.performance = { now: () => raf.time };\n122. \t\t\t\tglobal.requestAnimationFrame = cb => {\n123. \t\t\t\t\tlet called = false;\n124. \t\t\t\t\traf.callback = () => {\n125. \t\t\t\t\t\tif (!called) {\n126. \t\t\t\t\t\t\tcalled = true;\n127. \t\t\t\t\t\t\tcb();\n128. \t\t\t\t\t\t}\n129. \t\t\t\t\t};\n130. \t\t\t\t};\n131. \n132. \t\t\t\tglobal.window = window;\n133. \n134. \t\t\t\ttry {\n135. \t\t\t\t\tSvelteComponent = require(`./samples/${dir}/main.html`);\n136. \t\t\t\t} catch (err) {\n137. \t\t\t\t\tshowOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console\n138. \t\t\t\t\tthrow err;\n139. \t\t\t\t}\n140. \n141. \t\t\t\tglobal.window = window;\n142. \n143. \t\t\t\t// Put the constructor on window for testing\n144. \t\t\t\twindow.SvelteComponent = SvelteComponent;\n145. \n146. \t\t\t\tconst target = window.document.querySelector("main");\n147. \n148. \t\t\t\tconst warnings = [];\n149. \t\t\t\tconst warn = console.warn;\n150. \t\t\t\tconsole.warn = warning => {\n151. \t\t\t\t\twarnings.push(warning);\n152. \t\t\t\t};\n153. \n154. \t\t\t\tconst options = Object.assign({}, {\n155. \t\t\t\t\ttarget,\n156. \t\t\t\t\thydrate,\n157. \t\t\t\t\tdata: config.data\n158. \t\t\t\t}, config.options || {});\n159. \n160. \t\t\t\tconst component = new SvelteComponent(options);\n161. \n162. \t\t\t\tconsole.warn = warn;\n163. \n164. \t\t\t\tif (config.error) {\n165. \t\t\t\t\tunintendedError = true;\n166. \t\t\t\t\tthrow new Error("Expected a runtime error");\n167. \t\t\t\t}\n168. \n169. \t\t\t\tif (config.warnings) {\n170. \t\t\t\t\tassert.deepEqual(warnings, config.warnings);\n171. \t\t\t\t} else if (warnings.length) {\n172. \t\t\t\t\tunintendedError = true;\n173. \t\t\t\t\tthrow new Error("Received unexpected warnings");\n174. \t\t\t\t}\n175. \n176. \t\t\t\tif (config.html) {\n177. \t\t\t\t\tassert.htmlEqual(target.innerHTML, config.html);\n178. \t\t\t\t}\n179. \n180. \t\t\t\tif (config.test) {\n181. \t\t\t\t\tconfig.test(assert, component, target, window, raf);\n182. \t\t\t\t} else {\n183. \t\t\t\t\tcomponent.destroy();\n184. \t\t\t\t\tassert.equal(target.innerHTML, "");\n185. \t\t\t\t}\n186. \t\t\t} catch (err) {\n187. \t\t\t\tif (config.error && !unintendedError) {\n188. \t\t\t\t\tconfig.error(assert, err);\n189. \t\t\t\t} else {\n190. \t\t\t\t\tfailed.add(dir);\n191. \t\t\t\t\tshowOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console\n192. \t\t\t\t\tthrow err;\n193. \t\t\t\t}\n194. \t\t\t}\n195. \n196. \t\t\tif (config.show) showOutput(cwd, { shared, hydratable: hydrate }, svelte);\n197. \t\t});\n198. \t}\n199. \n200. \tconst shared = path.resolve("shared.js");\n201. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n202. \t\trunTest(dir, shared, false);\n203. \t\trunTest(dir, shared, true);\n204. \t\trunTest(dir, null, false);\n205. \t});\n206. \n207. \tit("fails if options.target is missing in dev mode", () => {\n208. \t\tconst { code } = svelte.compile(`<div></div>`, {\n209. \t\t\tformat: "iife",\n210. \t\t\tname: "SvelteComponent",\n211. \t\t\tdev: true\n212. \t\t});\n213. \n214. \t\tconst SvelteComponent = eval(\n215. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n216. \t\t);\n217. \n218. \t\tassert.throws(() => {\n219. \t\t\tnew SvelteComponent();\n220. \t\t}, /\'target\' is a required option/);\n221. \t});\n222. \n223. \tit("fails if options.hydrate is true but the component is non-hydratable", () => {\n224. \t\tconst { code } = svelte.compile(`<div></div>`, {\n225. \t\t\tformat: "iife",\n226. \t\t\tname: "SvelteComponent",\n227. \t\t\tdev: true\n228. \t\t});\n229. \n230. \t\tconst SvelteComponent = eval(\n231. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n232. \t\t);\n233. \n234. \t\tassert.throws(() => {\n235. \t\t\tnew SvelteComponent({\n236. \t\t\t\ttarget: {},\n237. \t\t\t\thydrate: true\n238. \t\t\t});\n239. \t\t}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);\n240. \t});\n241. });\n\n\nFile: test/runtime/samples/bindings-before-oncreate/_config.js\nLine number range: 1 - 5\nContent:\n1. export default {\n2. \ttest(assert, component) {\n3. \t\tassert.equal(component.refs.one.snapshot, 2);\n4. \t}\n5. };\n\n\nFile: test/runtime/samples/bindings-before-oncreate/main.html\nLine number range: 1 - 9\nContent:\n1. <One ref:one/>\n2. \n3. <script>\n4. \timport One from \'./One.html\';\n5. \n6. \texport default {\n7. \t\tcomponents: { One }\n8. \t};\n9. </script>\n\n\nFile: test/runtime/samples/lifecycle-events/_config.js\nLine number range: 1 - 7\nContent:\n1. export default {\n2. \ttest(assert, component) {\n3. \t\tassert.deepEqual(component.events, [\'create\']);\n4. \t\tcomponent.destroy();\n5. \t\tassert.deepEqual(component.events, [\'create\', \'destroy\']);\n6. \t}\n7. };\n\n\nFile: test/runtime/samples/lifecycle-events/main.html\nLine number range: 1 - 13\nContent:\n1. <div></div>\n2. \n3. <script>\n4. \texport default {\n5. \t\toncreate() {\n6. \t\t\tthis.events = [\'create\'];\n7. \t\t},\n8. \n9. \t\tondestroy() {\n10. \t\t\tthis.events.push(\'destroy\');\n11. \t\t}\n12. \t};\n13. </script>\n\n\nFile: test/runtime/samples/ondestroy-before-cleanup/_config.js\nLine number range: 1 - 9\nContent:\n1. export default {\n2. \ttest(assert, component, target) {\n3. \t\tconst top = component.refs.top;\n4. \t\tconst div = target.querySelector(\'div\');\n5. \n6. \t\tcomponent.set({ visible: false });\n7. \t\tassert.equal(top.refOnDestroy, div);\n8. \t}\n9. };\n\n\nFile: test/runtime/samples/ondestroy-before-cleanup/main.html\nLine number range: 1 - 18\nContent:\n1. {{#if visible}}\n2. \t<Top ref:top></Top>\n3. {{/if}}\n4. \n5. <script>\n6. \timport Top from \'./Top.html\';\n7. \t\n8. \texport default {\n9. \t\tdata() {\n10. \t\t\treturn {\n11. \t\t\t\tvisible: true\n12. \t\t\t};\n13. \t\t},\n14. \t\tcomponents: {\n15. \t\t\tTop\n16. \t\t}\n17. \t};\n18. </script>\n\n\nFile: test/runtime/samples/onrender-fires-when-ready-nested/_config.js\nLine number range: 1 - 5\nContent:\n1. export default {\n2. \t\'skip-ssr\': true, // uses oncreate\n3. \n4. \thtml: `<div><p>true</p>\\n<p>true</p></div>`\n5. };\n\n\nFile: test/runtime/samples/onrender-fires-when-ready-nested/main.html\nLine number range: 1 - 16\nContent:\n1. <div>\n2. \t<Widget/>\n3. \t<ParentWidget />\n4. </div>\n5. \n6. <script>\n7. \timport Widget from \'./Widget.html\';\n8. \timport ParentWidget from \'./ParentWidget.html\';\n9. \n10. \texport default {\n11. \t\tcomponents: {\n12. \t\t\tWidget,\n13. \t\t\tParentWidget\n14. \t\t}\n15. \t};\n16. </script>\n\n\nFile: test/runtime/samples/onrender-fires-when-ready/Widget.html\nLine number range: 1 - 8\nContent:\n1. <p ref:x>{{inDocument}}</p>\n2. \n3. <script>\n4. \texport default {\n5. \t\toncreate () {\n6. \t\t\tthis.set({ inDocument: document.contains( this.refs.x ) })\n7. \t\t}\n8. \t};\n\n\nFile: test/runtime/samples/onrender-fires-when-ready/_config.js\nLine number range: 1 - 12\nContent:\n1. export default {\n2. \t\'skip-ssr\': true, // uses oncreate\n3. \n4. \thtml: `<div><p>true</p></div>`,\n5. \n6. \ttest ( assert, component, target ) {\n7. \t\tcomponent.set({ foo: true });\n8. \t\tassert.htmlEqual( target.innerHTML, `<div><p>true</p>\\n<p>true</p></div>` );\n9. \n10. \t\tcomponent.destroy();\n11. \t}\n12. };\n\n\nFile: test/runtime/samples/onrender-fires-when-ready/main.html\nLine number range: 1 - 17\nContent:\n1. <div>\n2. \t<Widget/>\n3. \n4. \t{{#if foo}}\n5. \t\t<Widget/>\n6. \t{{/if}}\n7. </div>\n8. \n9. <script>\n10. \timport Widget from \'./Widget.html\';\n11. \n12. \texport default {\n13. \t\tcomponents: {\n14. \t\t\tWidget\n15. \t\t}\n16. \t};\n17. </script>\n\n\nFile: test/runtime/samples/set-in-oncreate/_config.js\nLine number range: 1 - 5\nContent:\n1. export default {\n2. \t\'skip-ssr\': true, // uses oncreate\n3. \n4. \thtml: \'<p>2</p>\'\n5. };\n\n\nFile: test/runtime/samples/set-in-oncreate/main.html\nLine number range: 1 - 13\nContent:\n1. <p>{{foo}}</p>\n2. \n3. <script>\n4. \texport default {\n5. \t\tdata: () => ({\n6. \t\t\tfoo: 1\n7. \t\t}),\n8. \n9. \t\toncreate () {\n10. \t\t\tthis.set({ foo: 2 });\n11. \t\t}\n12. \t};\n13. </script>\n\n\nFile: test/server-side-rendering/index.js\nLine number range: 1 - 11\nContent:\n1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";\n\n\nFile: test/server-side-rendering/index.js\nLine number range: 23 - 29\nContent:\n23. \tbefore(() => {\n24. \t\trequire(process.env.COVERAGE\n25. \t\t\t? "../../src/server-side-rendering/register.js"\n26. \t\t\t: "../../ssr/register");\n27. \n28. \t\treturn setupHtmlEqual();\n29. \t});\n\n\nFile: test/server-side-rendering/index.js\nLine number range: 31 - 71\nContent:\n31. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n32. \t\tif (dir[0] === ".") return;\n33. \n34. \t\t// add .solo to a sample directory name to only run that test, or\n35. \t\t// .show to always show the output. or both\n36. \t\tconst solo = /\\.solo/.test(dir);\n37. \t\tconst show = /\\.show/.test(dir);\n38. \n39. \t\tif (solo && process.env.CI) {\n40. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n41. \t\t}\n42. \n43. \t\t(solo ? it.only : it)(dir, () => {\n44. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n45. \t\t\ttry {\n46. \t\t\t\tconst component = require(`${dir}/main.html`);\n47. \n48. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n49. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n50. \n51. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n52. \n53. \t\t\t\tconst html = component.render(data);\n54. \t\t\t\tconst css = component.renderCss().css;\n55. \n56. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n57. \t\t\t\tif (css) fs.writeFileSync(`${dir}/_actual.css`, css);\n58. \n59. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n60. \t\t\t\tassert.equal(\n61. \t\t\t\t\tcss.replace(/^\\s+/gm, ""),\n62. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n63. \t\t\t\t);\n64. \n65. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n66. \t\t\t} catch (err) {\n67. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n68. \t\t\t\tthrow err;\n69. \t\t\t}\n70. \t\t});\n71. \t});\n\n\nFile: test/server-side-rendering/index.js\nLine number range: 73 - 106\nContent:\n73. \t// duplicate client-side tests, as far as possible\n74. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n75. \t\tif (dir[0] === ".") return;\n76. \n77. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n78. \n79. \t\tif (config.solo && process.env.CI) {\n80. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n81. \t\t}\n82. \n83. \t\tif (config["skip-ssr"]) return;\n84. \n85. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n86. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n87. \n88. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n89. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n90. \t\t\t\tdelete require.cache[resolved];\n91. \t\t\t});\n92. \n93. \t\t\ttry {\n94. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n95. \t\t\t\tconst html = component.render(config.data);\n96. \n97. \t\t\t\tif (config.html) {\n98. \t\t\t\t\tassert.htmlEqual(html, config.html);\n99. \t\t\t\t}\n100. \t\t\t} catch (err) {\n101. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n102. \t\t\t\tthrow err;\n103. \t\t\t}\n104. \t\t});\n105. \t});\n106. });\n\n\nFile: test/setup.js\nLine number range: 1 - 37\nContent:\n1. const fs = require(\'fs\');\n2. const path = require(\'path\');\n3. \n4. require(\'console-group\').install();\n5. require(\'source-map-support\').install();\n6. \n7. require.extensions[\'.js\'] = function(module, filename) {\n8. \tconst exports = [];\n9. \n10. \tvar code = fs.readFileSync(filename, \'utf-8\')\n11. \t\t.replace(/^import (?:\\* as )?(\\w+) from [\'"]([^\'"]+)[\'"];?/gm, \'var $1 = require("$2");\')\n12. \t\t.replace(/^import {([^}]+)} from [\'"](.+)[\'"];?/gm, \'var {$1} = require("$2");\')\n13. \t\t.replace(/^export default /gm, \'module.exports = \')\n14. \t\t.replace(/^export (const|let|var|class|function) (\\w+)/gm, (match, type, name) => {\n15. \t\t\texports.push(name);\n16. \t\t\treturn `${type} ${name}`;\n17. \t\t})\n18. \t\t.replace(/^export \\{([^}]+)\\}/gm, (match, names) => {\n19. \t\t\tnames.split(\',\').filter(Boolean).forEach(name => {\n20. \t\t\t\texports.push(name);\n21. \t\t\t});\n22. \n23. \t\t\treturn \'\';\n24. \t\t})\n25. \t\t.replace(/^export function (\\w+)/gm, \'exports.$1 = function $1\');\n26. \n27. \texports.forEach(name => {\n28. \t\tcode += `\\nexports.${name} = ${name};`;\n29. \t});\n30. \n31. \ttry {\n32. \t\treturn module._compile(code, filename);\n33. \t} catch (err) {\n34. \t\tconsole.log(code); // eslint-disable-line no-console\n35. \t\tthrow err;\n36. \t}\n37. };\n\n\nNow generate the complete self-contained test case that reproduces the bug with the same error/exception.\n' additional_kwargs={} response_metadata={}
2025-11-11 00:34:35,417 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='import assert from "assert";\nimport { svelte } from "../helpers.js";\n\ndescribe("js", () => {\n  it("preserves async keyword on oncreate lifecycle method", () => {\n    const input = `<script>\n      export default {\n        async oncreate() {\n          const data = await fetch(\'foo.json\').then(r => r.json());\n          console.log(data);\n        }\n      };\n    </script>`;\n\n    const { code } = svelte.compile(input, { shared: true });\n    assert.ok(/async function oncreate\\s*\\(/.test(code));\n  });\n});' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2690, 'prompt_tokens': 11281, 'total_tokens': 13971, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2560, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--aa11c675-bd22-428d-ad8c-b422079353d6-0' usage_metadata={'input_tokens': 11281, 'output_tokens': 2690, 'total_tokens': 13971, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 2560}}
2025-11-11 00:34:38,775 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WW2JXktplbMlXffc6jj0UIld', 'function': {'arguments': '{"relative_path":"test/js/index.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 156, 'prompt_tokens': 22595, 'total_tokens': 22751, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5e526016-012f-4e7c-be99-d663f4f3ac9f-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/js/index.js'}, 'id': 'call_WW2JXktplbMlXffc6jj0UIld', 'type': 'tool_call'}] usage_metadata={'input_tokens': 22595, 'output_tokens': 156, 'total_tokens': 22751, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-11 00:34:43,048 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_05Nx4UV5prtpzjqNrCxDjKTl', 'function': {'arguments': '{"relative_path":"test/test.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 219, 'prompt_tokens': 23376, 'total_tokens': 23595, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--54859f1e-c520-4f69-9839-1b62ca3be831-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/test.js'}, 'id': 'call_05Nx4UV5prtpzjqNrCxDjKTl', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23376, 'output_tokens': 219, 'total_tokens': 23595, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-11 00:34:46,789 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xW25n8RBUQlnvljSr0a62mcc', 'function': {'arguments': '{"relative_path":"test/js/update.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 284, 'prompt_tokens': 23502, 'total_tokens': 23786, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bccf8288-a8d5-4e26-8162-4db112c453e1-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/js/update.js'}, 'id': 'call_xW25n8RBUQlnvljSr0a62mcc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23502, 'output_tokens': 284, 'total_tokens': 23786, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-11 00:34:52,237 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lF7g400HOCBtpxCAdhXQ7zyJ', 'function': {'arguments': '{"relative_path":"test/create/index.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 348, 'prompt_tokens': 23678, 'total_tokens': 24026, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 23296}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f6acbd6c-7975-4dab-a325-7624fed9428d-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/create/index.js'}, 'id': 'call_lF7g400HOCBtpxCAdhXQ7zyJ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23678, 'output_tokens': 348, 'total_tokens': 24026, 'input_token_details': {'audio': 0, 'cache_read': 23296}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-11 00:35:10,782 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_r4O5YPR5koGJoAkL36VvjPbb', 'function': {'arguments': '{"relative_path":"test/js-async/index.js","content":"import assert from \\"assert\\";\\nimport { svelte } from \\"../helpers.js\\";\\n\\ndescribe(\\"js\\", () => {\\n  it(\\"preserves async keyword on oncreate lifecycle method\\", () => {\\n    const input = `<script>\\n      export default {\\n        async oncreate() {\\n          const data = await fetch(\'foo.json\').then(r => r.json());\\n          console.log(data);\\n        }\\n      };\\n    </script>`;\\n\\n    const { code } = svelte.compile(input, { shared: true });\\n    assert.ok(/async function oncreate\\\\s*\\\\(/.test(code));\\n  });\\n});\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1464, 'prompt_tokens': 24001, 'total_tokens': 25465, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1280, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b9ab3681-b213-4050-a388-f086952b4dec-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'test/js-async/index.js', 'content': 'import assert from "assert";\nimport { svelte } from "../helpers.js";\n\ndescribe("js", () => {\n  it("preserves async keyword on oncreate lifecycle method", () => {\n    const input = `<script>\n      export default {\n        async oncreate() {\n          const data = await fetch(\'foo.json\').then(r => r.json());\n          console.log(data);\n        }\n      };\n    </script>`;\n\n    const { code } = svelte.compile(input, { shared: true });\n    assert.ok(/async function oncreate\\s*\\(/.test(code));\n  });\n});\n'}, 'id': 'call_r4O5YPR5koGJoAkL36VvjPbb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 24001, 'output_tokens': 1464, 'total_tokens': 25465, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1280}}
2025-11-11 00:35:19,235 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_jmtMCVNuPdFFgbZC7cAmUNz9', 'function': {'arguments': '{"relative_path":"test/setup.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 539, 'prompt_tokens': 24201, 'total_tokens': 24740, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d58b784d-1d74-4a55-a1ab-69bc297c584c-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/setup.js'}, 'id': 'call_jmtMCVNuPdFFgbZC7cAmUNz9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 24201, 'output_tokens': 539, 'total_tokens': 24740, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-11 00:35:32,691 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='test/js-async/index.js' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1296, 'prompt_tokens': 24638, 'total_tokens': 25934, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1280, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--a76174f1-49aa-47dd-ab11-bc10f88e32d0-0' usage_metadata={'input_tokens': 24638, 'output_tokens': 1296, 'total_tokens': 25934, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1280}}
2025-11-11 00:35:32,764 - thread-133013323122368.prometheus.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/test/js-async/index.js b/test/js-async/index.js
new file mode 100644
index 000000000..d8a0e8922
--- /dev/null
+++ b/test/js-async/index.js
@@ -0,0 +1,18 @@
+import assert from "assert";
+import { svelte } from "../helpers.js";
+
+describe("js", () => {
+  it("preserves async keyword on oncreate lifecycle method", () => {
+    const input = `<script>
+      export default {
+        async oncreate() {
+          const data = await fetch('foo.json').then(r => r.json());
+          console.log(data);
+        }
+      };
+    </script>`;
+
+    const { code } = svelte.compile(input, { shared: true });
+    assert.ok(/async function oncreate\s*\(/.test(code));
+  });
+});

2025-11-11 00:35:32,766 - thread-133013323122368.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-11 00:35:32,800 - thread-133013323122368.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-11 00:35:32,800 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-11 00:35:33,042 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:35:33,042 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 1dad8f193 add test for #891
[?2004l
2025-11-11 00:35:33,042 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-11 00:35:33,144 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:35:33,144 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing Dockerfile
[?2004l
2025-11-11 00:35:33,144 - thread-133013323122368.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-11 00:35:33,145 - thread-133013323122368.prometheus.docker.base_container - INFO - Creating directory test/js-async in the container
2025-11-11 00:35:33,145 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p test/js-async
2025-11-11 00:35:33,246 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:35:33,246 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-11 00:35:33,247 - thread-133013323122368.prometheus.docker.base_container - INFO - Updating test/js-async/index.js in the container
2025-11-11 00:35:33,255 - thread-133013323122368.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-11 00:35:36,397 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ILZ4qmXdr0TgjpciKxsdMO2b', 'function': {'arguments': '{"command":"ls -la"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 218, 'prompt_tokens': 429, 'total_tokens': 647, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8b75a56d-415b-4574-809e-4c82b82b197f-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la'}, 'id': 'call_ILZ4qmXdr0TgjpciKxsdMO2b', 'type': 'tool_call'}] usage_metadata={'input_tokens': 429, 'output_tokens': 218, 'total_tokens': 647, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-11 00:35:36,401 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ls -la
2025-11-11 00:35:36,503 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:35:36,503 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 748
drwxr-xr-x   1 root root   4096 Nov 11 00:35 [0m[01;34m.[0m
drwxr-xr-x   1 root root   4096 Nov 11 00:35 [01;34m..[0m
-rw-r--r--   1 root root    227 Nov 11 00:35 .editorconfig
-rw-r--r--   1 root root     76 Nov 11 00:35 .eslintignore
-rw-r--r--   1 root root   1239 Nov 11 00:35 .eslintrc.json
-rw-r--r--   1 root root     78 Nov 11 00:35 .flowconfig
drwxrwxr-x   1 root root   4096 Nov 11 00:35 [01;34m.git[0m
drwxrwxr-x   1 root root   4096 Nov 11 00:35 [01;34m.github[0m
-rw-r--r--   1 root root    263 Nov 11 00:35 .gitignore
-rw-r--r--   1 root root     51 Nov 11 00:35 .prettierrc
-rw-r--r--   1 root root    270 Nov 11 00:35 .travis.yml
-rw-r--r--   1 root root  37604 Nov 11 00:35 CHANGELOG.md
-rw-r--r--   1 root root   1114 Nov 11 00:35 LICENSE
-rw-r--r--   1 root root   6462 Nov 11 00:35 README.md
-rw-r--r--   1 root root    556 Nov 11 00:35 appveyor.yml
drwxr-xr-x   2 root root   4096 Nov 11 00:27 [01;34mcompiler[0m
-rw-r--r--   1 root root     70 Nov 11 00:35 mocha.coverage.opts
-rw-r--r--   1 root root     12 Nov 11 00:35 mocha.opts
drwxr-xr-x 385 root root  16384 Aug 28 02:26 [01;34mnode_modules[0m
-rw-r--r--   1 root root 470834 Aug 28 02:26 package-lock.json
-rw-r--r--   1 root root   2295 Nov 11 00:35 package.json
-rw-r--r--   1 root root   1668 Nov 11 00:35 rollup.config.js
-rw-r--r--   1 root root  13810 Nov 11 00:27 shared.js
drwxrwxr-x   1 root root   4096 Nov 11 00:35 [01;34msrc[0m
drwxr-xr-x   2 root root   4096 Nov 11 00:27 [01;34mssr[0m
drwxrwxr-x   1 root root   4096 Nov 11 00:35 [01;34mtest[0m
-rw-r--r--   1 root root    326 Nov 11 00:35 tsconfig.json
-rw-r--r--   1 root root 109393 Nov 11 00:35 yarn.lock
[?2004l
2025-11-11 00:35:38,156 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_R9IYOKV72GiGnWCQdf4Rsnit', 'function': {'arguments': '{"command":"cat package.json"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 90, 'prompt_tokens': 1279, 'total_tokens': 1369, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f845f041-9f1d-4e2d-b1c2-7b0078fd9861-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat package.json'}, 'id': 'call_R9IYOKV72GiGnWCQdf4Rsnit', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1279, 'output_tokens': 90, 'total_tokens': 1369, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-11 00:35:38,160 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: cat package.json
2025-11-11 00:35:38,262 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:35:38,262 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
{
  "name": "svelte",
  "version": "1.41.1",
  "description": "The magical disappearing UI framework",
  "main": "compiler/svelte.js",
  "files": [
    "compiler",
    "ssr",
    "shared.js",
    "README.md"
  ],
  "scripts": {
    "test": "mocha --opts mocha.opts",
    "quicktest": "mocha --opts mocha.opts",
    "precoverage": "export COVERAGE=true && nyc mocha --opts mocha.coverage.opts",
    "coverage": "nyc report --reporter=text-lcov > coverage.lcov",
    "codecov": "codecov",
    "precodecov": "npm run coverage",
    "lint": "eslint src test/*.js",
    "build": "node src/shared/_build.js && rollup -c",
    "dev": "node src/shared/_build.js && rollup -c -w",
    "pretest": "npm run build",
    "prepublishOnly": "npm run lint && npm test",
    "prettier": "prettier --write \"src/**/*.ts\""
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/sveltejs/svelte.git"
  },
  "keywords": [
    "UI",
    "framework",
    "templates",
    "templating"
  ],
  "author": "Rich Harris",
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/sveltejs/svelte/issues"
  },
  "homepage": "https://github.com/sveltejs/svelte#README",
  "devDependencies": {
    "@types/mocha": "^2.2.41",
    "@types/node": "^8.0.17",
    "acorn": "^5.1.1",
    "chalk": "^2.0.1",
    "codecov": "^2.2.0",
    "console-group": "^0.3.2",
    "css-tree": "1.0.0-alpha22",
    "eslint": "^4.3.0",
    "eslint-plugin-html": "^3.0.0",
    "eslint-plugin-import": "^2.2.0",
    "estree-walker": "^0.5.0",
    "glob": "^7.1.1",
    "jsdom": "^11.1.0",
    "locate-character": "^2.0.0",
    "magic-string": "^0.22.3",
    "mocha": "^3.2.0",
    "nightmare": "^2.10.0",
    "node-resolve": "^1.3.3",
    "nyc": "^11.1.0",
    "prettier": "^1.7.0",
    "rollup": "^0.48.2",
    "rollup-plugin-buble": "^0.15.0",
    "rollup-plugin-commonjs": "^8.0.2",
    "rollup-plugin-json": "^2.1.0",
    "rollup-plugin-node-resolve": "^3.0.0",
    "rollup-plugin-typescript": "^0.8.1",
    "rollup-plugin-virtual": "^1.0.1",
    "rollup-watch": "^4.3.1",
    "source-map": "^0.5.6",
    "source-map-support": "^0.4.8",
    "typescript": "^2.3.2"
  },
  "nyc": {
    "include": [
      "src/**/*.js",
      "shared.js"
    ],
    "exclude": [
      "src/**/__test__.js",
      "src/shared/**"
    ]
  }
}
[?2004l
2025-11-11 00:35:47,541 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_RZEUgVOKgOqhCAI58strpDTI', 'function': {'arguments': '{"command":"npm run build"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 730, 'prompt_tokens': 2134, 'total_tokens': 2864, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--07b93247-bba0-43f5-b5de-4e90d823eb10-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm run build'}, 'id': 'call_RZEUgVOKgOqhCAI58strpDTI', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2134, 'output_tokens': 730, 'total_tokens': 2864, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-11 00:35:47,545 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: npm run build
2025-11-11 00:35:52,856 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:35:52,856 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l

> svelte@1.41.1 build
> node src/shared/_build.js && rollup -c

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m4.3s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m29ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m63ms[22m[39m
[?2004l
2025-11-11 00:35:54,954 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JK6WBcn8UBUPBVfKeHf6gOFt', 'function': {'arguments': '{"command":"cat mocha.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 90, 'prompt_tokens': 2441, 'total_tokens': 2531, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7bdc4dd0-b66e-4420-a020-d19daf2fb856-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat mocha.opts'}, 'id': 'call_JK6WBcn8UBUPBVfKeHf6gOFt', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2441, 'output_tokens': 90, 'total_tokens': 2531, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-11 00:35:54,958 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: cat mocha.opts
2025-11-11 00:35:55,059 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:35:55,060 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-11 00:36:00,014 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_affTVIFuZDgCKYaiFuUuFYjH', 'function': {'arguments': '{"command":"./node_modules/.bin/mocha test/js-async/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 356, 'prompt_tokens': 2484, 'total_tokens': 2840, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1152}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--64f0df96-54c9-4027-8677-ae83f8811ff9-0' tool_calls=[{'name': 'run_command', 'args': {'command': './node_modules/.bin/mocha test/js-async/index.js'}, 'id': 'call_affTVIFuZDgCKYaiFuUuFYjH', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2484, 'output_tokens': 356, 'total_tokens': 2840, 'input_token_details': {'audio': 0, 'cache_read': 1152}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-11 00:36:00,018 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ./node_modules/.bin/mocha test/js-async/index.js
2025-11-11 00:36:00,209 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-11 00:36:00,210 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
/testbed/test/js-async/index.js:1
import assert from "assert";
^^^^^^

SyntaxError: Cannot use import statement outside a module
[90m    at Object.compileFunction (node:vm:360:18)[39m
[90m    at wrapSafe (node:internal/modules/cjs/loader:1126:15)[39m
[90m    at Module._compile (node:internal/modules/cjs/loader:1162:27)[39m
[90m    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1252:10)[39m
[90m    at Module.load (node:internal/modules/cjs/loader:1076:32)[39m
[90m    at Function.Module._load (node:internal/modules/cjs/loader:911:12)[39m
[90m    at Module.require (node:internal/modules/cjs/loader:1100:19)[39m
[90m    at require (node:internal/modules/cjs/helpers:119:18)[39m
    at [90m/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:230:27
    at Array.forEach (<anonymous>)
    at Mocha.loadFiles [90m(/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:227:14[90m)[39m
    at Mocha.run [90m(/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:513:10[90m)[39m
    at Object.<anonymous> [90m(/testbed/[39mnode_modules/[4mmocha[24m/bin/_mocha:480:18[90m)[39m
[90m    at Module._compile (node:internal/modules/cjs/loader:1198:14)[39m
[90m    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1252:10)[39m
[90m    at Module.load (node:internal/modules/cjs/loader:1076:32)[39m
[90m    at Function.Module._load (node:internal/modules/cjs/loader:911:12)[39m
[90m    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)[39m
[90m    at node:internal/main/run_main_module:22:47[39m
[?2004l
2025-11-11 00:36:03,718 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_B8vKAj9qhf7gtRfZJzsj08CE', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/js-async/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 294, 'prompt_tokens': 3155, 'total_tokens': 3449, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bbc487b2-1b6e-4743-a82d-67758e3122f5-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/js-async/index.js"}, 'id': 'call_B8vKAj9qhf7gtRfZJzsj08CE', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3155, 'output_tokens': 294, 'total_tokens': 3449, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-11 00:36:03,722 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/js-async/index.js
2025-11-11 00:36:03,823 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:36:03,824 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import assert from "assert";
import { svelte } from "../helpers.js";

describe("js", () => {
  it("preserves async keyword on oncreate lifecycle method", () => {
    const input = `<script>
      export default {
        async oncreate() {
          const data = await fetch('foo.json').then(r => r.json());
          console.log(data);
        }
      };
    </script>`;

    const { code } = svelte.compile(input, { shared: true });
    assert.ok(/async function oncreate\s*\(/.test(code));
  });
});
[?2004l
2025-11-11 00:36:07,391 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0e9GZHB0hN9RedvQvTMjVyAV', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/helpers.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 291, 'prompt_tokens': 3330, 'total_tokens': 3621, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ad01321f-edaf-4d98-af6a-b4456dfc9f42-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/helpers.js"}, 'id': 'call_0e9GZHB0hN9RedvQvTMjVyAV', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3330, 'output_tokens': 291, 'total_tokens': 3621, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-11 00:36:07,395 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/helpers.js
2025-11-11 00:36:07,497 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:36:07,497 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import { JSDOM } from 'jsdom';
import assert from 'assert';
import glob from 'glob';
import fs from 'fs';
import path from 'path';
import chalk from 'chalk';

// for coverage purposes, we need to test source files,
// but for sanity purposes, we need to test dist files
export function loadSvelte(test) {
	if (test) global.__svelte_test = true;

	const resolved = process.env.COVERAGE
		? require.resolve('../src/index.js')
		: require.resolve('../compiler/svelte.js');

	delete require.cache[resolved];
	return require(resolved);
}

export const svelte = loadSvelte();

export function exists(path) {
	try {
		fs.statSync(path);
		return true;
	} catch (err) {
		return false;
	}
}

export function tryToLoadJson(file) {
	try {
		return JSON.parse(fs.readFileSync(file));
	} catch (err) {
		if (err.code !== 'ENOENT') throw err;
		return null;
	}
}

export function tryToReadFile(file) {
	try {
		return fs.readFileSync(file, 'utf-8');
	} catch (err) {
		if (err.code !== 'ENOENT') throw err;
		return null;
	}
}

const { window } = new JSDOM('<main></main>');
global.document = window.document;

export function env() {
	window._svelteTransitionManager = null;
	window.document.body.innerHTML = '<main></main>';

	return window;
}

function cleanChildren(node) {
	let previous = null;

	// sort attributes
	const attributes = Array.from(node.attributes).sort((a, b) => {
		return a.name < b.name ? -1 : 1;
	});

	attributes.forEach(attr => {
		node.removeAttribute(attr.name);
	});

	attributes.forEach(attr => {
		node.setAttribute(attr.name, attr.value);
	});

	// recurse
	[...node.childNodes].forEach(child => {
		if (child.nodeType === 3) {
			// text
			if (
				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
				node.tagName !== 'text' &&
				node.tagName !== 'tspan'
			) {
				node.removeChild(child);
			}

			child.data = child.data.replace(/\s{2,}/g, '\n');

			if (previous && previous.nodeType === 3) {
				previous.data += child.data;
				previous.data = previous.data.replace(/\s{2,}/g, '\n');

				node.removeChild(child);
				child = previous;
			}
		} else {
			cleanChildren(child);
		}

		previous = child;
	});

	// collapse whitespace
	if (node.firstChild && node.firstChild.nodeType === 3) {
		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
		if (!node.firstChild.data) node.removeChild(node.firstChild);
	}

	if (node.lastChild && node.lastChild.nodeType === 3) {
		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
		if (!node.lastChild.data) node.removeChild(node.lastChild);
	}
}

export function normalizeHtml(window, html) {
	try {
		const node = window.document.createElement('div');
		node.innerHTML = html
			.replace(/<!--.*?-->/g, '')
			.replace(/>[\s\r\n]+</g, '><')
			.trim();
		cleanChildren(node, '');
		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
	} catch (err) {
		throw new Error(`Failed to normalize HTML:\n${html}`);
	}
}

export function setupHtmlEqual() {
	const window = env();

	assert.htmlEqual = (actual, expected, message) => {
		assert.deepEqual(
			normalizeHtml(window, actual),
			normalizeHtml(window, expected),
			message
		);
	};
}

export function loadConfig(file) {
	try {
		const resolved = require.resolve(file);
		delete require.cache[resolved];

		const config = require(resolved);
		return config.default || config;
	} catch (err) {
		if (err.code === 'MODULE_NOT_FOUND') {
			return {};
		}

		throw err;
	}
}

export function addLineNumbers(code) {
	return code
		.split('\n')
		.map((line, i) => {
			i = String(i + 1);
			while (i.length < 3) i = ` ${i}`;

			return (
				chalk.grey(`  ${i}: `) +
				line.replace(/^\t+/, match => match.split('\t').join('    '))
			);
		})
		.join('\n');
}

function capitalise(str) {
	return str[0].toUpperCase() + str.slice(1);
}

export function showOutput(cwd, options = {}, s = svelte) {
	glob.sync('**/*.html', { cwd }).forEach(file => {
		if (file[0] === '_') return;
		const { code } = s.compile(
			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
			Object.assign(options, {
				filename: file,
				name: capitalise(path.basename(file).replace(/\.html$/, ''))
			})
		);

		console.log( // eslint-disable-line no-console
			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
		);
	});
}

const start = /\n(\t+)/;
export function deindent(strings, ...values) {
	const indentation = start.exec(strings[0])[1];
	const pattern = new RegExp(`^${indentation}`, 'gm');

	let result = strings[0].replace(start, '').replace(pattern, '');

[?2004l
2025-11-11 00:36:08,932 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_kfNZROhI5SX4IQhULEv3USLA', 'function': {'arguments': '{"command":"sed -n \'200,400p\' test/helpers.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 4627, 'total_tokens': 4656, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3072}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0d780d0a-5877-4691-b3a2-18ecbc42ade3-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '200,400p' test/helpers.js"}, 'id': 'call_kfNZROhI5SX4IQhULEv3USLA', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4627, 'output_tokens': 29, 'total_tokens': 4656, 'input_token_details': {'audio': 0, 'cache_read': 3072}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:36:08,936 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '200,400p' test/helpers.js
2025-11-11 00:36:09,037 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:36:09,037 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l

	let trailingIndentation = getTrailingIndentation(result);

	for (let i = 1; i < strings.length; i += 1) {
		let expression = values[i - 1];
		const string = strings[i].replace(pattern, '');

		if (Array.isArray(expression)) {
			expression = expression.length ? expression.join('\n') : null;
		}

		if (expression || expression === '') {
			const value = String(expression).replace(
				/\n/g,
				`\n${trailingIndentation}`
			);
			result += value + string;
		} else {
			let c = result.length;
			while (/\s/.test(result[c - 1])) c -= 1;
			result = result.slice(0, c) + string;
		}

		trailingIndentation = getTrailingIndentation(result);
	}

	return result.trim().replace(/\t+$/gm, '');
}

function getTrailingIndentation(str) {
	let i = str.length;
	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
	return str.slice(i, str.length);
}

export function spaces(i) {
	let result = '';
	while (i--) result += ' ';
	return result;
}
[?2004l
2025-11-11 00:36:16,279 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JMGpn1ERCwhuOVZ3ANbz4s1t', 'function': {'arguments': '{"command":"npm i --no-audit --no-fund esm@^3"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 613, 'prompt_tokens': 4946, 'total_tokens': 5559, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--dd4ab604-845a-46cd-a379-7c15e5bcbf7d-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm i --no-audit --no-fund esm@^3'}, 'id': 'call_JMGpn1ERCwhuOVZ3ANbz4s1t', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4946, 'output_tokens': 613, 'total_tokens': 5559, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-11 00:36:16,283 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: npm i --no-audit --no-fund esm@^3
2025-11-11 00:36:17,755 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:36:17,755 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?25l[[100;90m..................[0m] | reify: [32;40mtiming[0m [35marborist:ctor[0m Completed in 0ms[0m[K
[[100;90m..................[0m] - idealTree:testbed: [7msill[0m [35midealTree[0m buildDeps[0m[K
[[100;90m..................[0m] \ idealTree:testbed: [7msill[0m [35midealTree[0m buildDeps[0m[K
[[100;90m..................[0m] \ idealTree:testbed: [7msill[0m [35midealTree[0m buildDeps[0m[K
[[107;97m#########[0m[100;90m.........[0m] \ idealTree: [32;40mtiming[0m [35midealTree[0m Completed in 645ms[0m[K
[[107;97m##################[0m] / reify:esm: [32;40mtiming[0m [35mreify:loadBundles[0m Completed in 12ms[0m[K
[[107;97m##################[0m] - reify:esm: [32;40mhttp[0m [35mfetch[0m GET 200 https://registry.npmjs.org[0m[K

[K[?25h
added 1 package in 1s
[?2004l
2025-11-11 00:36:19,044 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_f50mCZ14ISG81X3Bxz462eat', 'function': {'arguments': '{"command":"./node_modules/.bin/mocha -r esm test/js-async/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 5416, 'total_tokens': 5449, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--de910250-4b40-4156-bdda-c2392a65586d-0' tool_calls=[{'name': 'run_command', 'args': {'command': './node_modules/.bin/mocha -r esm test/js-async/index.js'}, 'id': 'call_f50mCZ14ISG81X3Bxz462eat', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5416, 'output_tokens': 33, 'total_tokens': 5449, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:36:19,047 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ./node_modules/.bin/mocha -r esm test/js-async/index.js
2025-11-11 00:36:20,687 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-11 00:36:20,687 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
 ./node_modules/.bin/mocha -r esm test/js-async/index.
.js
[?2004l

[0m[0m
[0m  js[0m
  [31m  1) preserves async keyword on oncreate lifecycle method[0m


[92m [0m[32m 0 passing[0m[90m (34ms)[0m
[31m  1 failing[0m

[0m  1) js preserves async keyword on oncreate lifecycle method:

      [31mAssertionError [ERR_ASSERTION]: The expression evaluated to a falsy value:

  assert.ok(/async function oncreate\s*\(/.test(code))
[0m
      [32m+ expected[0m [31m- actual[0m

      [31m-false[0m
      [32m+true[0m
      [0m[90m
      at Context.<anonymous> (test/js-async/index.js:16:12)
      at processImmediate (node:internal/timers:466:21)
[0m


[?2004l
2025-11-11 00:36:30,098 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content=' ./node_modules/.bin/mocha -r esm test/js-async/index.\n.js\n\n\n  js\n    1) preserves async keyword on oncreate lifecycle method\n\n\n  0 passing (34ms)\n  1 failing\n\n  1) js preserves async keyword on oncreate lifecycle method:\n\n      AssertionError [ERR_ASSERTION]: The expression evaluated to a falsy value:\n\n  assert.ok(/async function oncreate\\s*\\(/.test(code))\n\n      + expected - actual\n\n      -false\n      +true\n\n      at Context.<anonymous> (test/js-async/index.js:16:12)\n      at processImmediate (node:internal/timers:466:21)' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 918, 'prompt_tokens': 5738, 'total_tokens': 6656, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4864}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--518b2cc3-c72e-4c6a-bc3b-65430687cfc6-0' usage_metadata={'input_tokens': 5738, 'output_tokens': 918, 'total_tokens': 6656, 'input_token_details': {'audio': 0, 'cache_read': 4864}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-11 00:41:47,942 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproducing_structured_node - DEBUG - reproduced_bug=True reproduced_bug_failure_log='./node_modules/.bin/mocha test/js-async/index.js\n/testbed/test/js-async/index.js:1\nimport assert from "assert";\n^^^^^^\n\nSyntaxError: Cannot use import statement outside a module\n    at Object.compileFunction (node:vm:360:18)\n    at wrapSafe (node:internal/modules/cjs/loader:1126:15)\n    at Module._compile (node:internal/modules/cjs/loader:1162:27)\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1252:10)\n    at Module.load (node:internal/modules/cjs/loader:1076:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:911:12)\n    at Module.require (node:internal/modules/cjs/helpers:119:18)\n    at /testbed/node_modules/mocha/lib/mocha.js:230:27\n    at Array.forEach (<anonymous>)\n    at Mocha.loadFiles (/testbed/node_modules/mocha/lib/mocha.js:227:14)\n    at Mocha.run (/testbed/node_modules/mocha/lib/mocha.js:513:10)\n    at Object.<anonymous> (/testbed/node_modules/mocha/bin/_mocha:480:18)\n    at Module._compile (node:internal/modules/cjs/loader:1198:14)\n    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1252:10)\n    at Module.load (node:internal/modules/cjs/loader:1076:32)\n    at Function.Module._load (node:internal/modules/cjs/loader:911:12)\n    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)\n    at node:internal/main/run_main_module:22:47\n\n./node_modules/.bin/mocha -r esm test/js-async/index.\n.js\n\n\n  js\n    1) preserves async keyword on oncreate lifecycle method\n\n\n  0 passing (34ms)\n  1 failing\n\n  1) js preserves async keyword on oncreate lifecycle method:\n\n      AssertionError [ERR_ASSERTION]: The expression evaluated to a falsy value:\n\n  assert.ok(/async function oncreate\\s*\\(/.test(code))\n\n      + expected - actual\n\n      -false\n      +true\n\n      at Context.<anonymous> (test/js-async/index.js:16:12)\n      at processImmediate (node:internal/timers:466:21)\n' reproduced_bug_commands=['npm run build', './node_modules/.bin/mocha -r esm test/js-async/index.js']
2025-11-11 00:41:47,978 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - reproduced_bug: True
2025-11-11 00:41:47,978 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - reproduced_bug_file: test/js-async/index.js
2025-11-11 00:41:47,978 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - reproduced_bug_commands: ['npm run build', './node_modules/.bin/mocha -r esm test/js-async/index.js']
2025-11-11 00:41:47,978 - thread-133013323122368.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - reproduced_bug_patch: diff --git a/test/js-async/index.js b/test/js-async/index.js
new file mode 100644
index 000000000..d8a0e8922
--- /dev/null
+++ b/test/js-async/index.js
@@ -0,0 +1,18 @@
+import assert from "assert";
+import { svelte } from "../helpers.js";
+
+describe("js", () => {
+  it("preserves async keyword on oncreate lifecycle method", () => {
+    const input = `<script>
+      export default {
+        async oncreate() {
+          const data = await fetch('foo.json').then(r => r.json());
+          console.log(data);
+        }
+      };
+    </script>`;
+
+    const { code } = svelte.compile(input, { shared: true });
+    assert.ok(/async function oncreate\s*\(/.test(code));
+  });
+});

2025-11-11 00:41:47,980 - thread-133013323122368.prometheus.lang_graph.nodes.issue_verified_bug_subgraph_node - INFO - Enter IssueVerifiedBugSubgraphNode
2025-11-11 00:41:47,983 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_context_message_node - DEBUG - Sending query to context provider:
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

2025-11-11 00:41:47,985 - thread-133013323122368.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-11 00:41:47,987 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:42:13,403 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We only have the repository file tree, not the actual source contents. The issue concerns the compiler transforming lifecycle methods (oncreate) and dropping the async keyword, which likely happens in code that validates/rewrites lifecycle props and stringifies or generates function code. To understand and fix this, we need the implementations for lifecycle prop handling, object extraction, code stringification, and the DOM/SSR generators’ preprocessing/wrapping paths that output lifecycle methods. These are all in production code under src and not visible yet.' query='Please provide the full contents of the following files: src/utils/stringify.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/index.ts, src/utils/getObject.ts, src/generators/dom/preprocess.ts, src/generators/dom/index.ts, src/generators/shared/utils/wrapModule.ts, src/index.ts, and src/interfaces.ts.' extra_requirements='If some files are large, include at least the parts that handle lifecycle methods (oncreate/onrender/ondestroy/onteardown) and any code that prints or stringifies function/method AST nodes, with their imports.' purpose='These files will reveal where lifecycle methods are parsed, validated, transformed, and emitted so we can locate why the async modifier is being removed and how to preserve it.'
2025-11-11 00:42:13,405 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents of the following files: src/utils/stringify.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/index.ts, src/utils/getObject.ts, src/generators/dom/preprocess.ts, src/generators/dom/index.ts, src/generators/shared/utils/wrapModule.ts, src/index.ts, and src/interfaces.ts.
2025-11-11 00:42:16,345 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-11 00:42:16,345 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-11 00:42:16,345 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-11 00:42:16,345 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-11 00:42:16,347 - thread-133013323122368.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-11 00:42:16,348 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-11 00:42:16,348 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents of the following files: src/utils/stringify.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/index.ts, src/utils/getObject.ts, src/generators/dom/preprocess.ts, src/generators/dom/index.ts, src/generators/shared/utils/wrapModule.ts, src/index.ts, and src/interfaces.ts.
Extra requirements: If some files are large, include at least the parts that handle lifecycle methods (oncreate/onrender/ondestroy/onteardown) and any code that prints or stringifies function/method AST nodes, with their imports.
Purpose: These files will reveal where lifecycle methods are parsed, validated, transformed, and emitted so we can locate why the async modifier is being removed and how to preserve it.
2025-11-11 00:42:21,520 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_riFn3Uev5VHPquLBdUpsdlIu', 'function': {'arguments': '{"relative_path":"src/utils/stringify.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 546, 'prompt_tokens': 2262, 'total_tokens': 2808, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9dd67f18-8669-42ba-8b84-07db7d80ddf1-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/utils/stringify.ts'}, 'id': 'call_riFn3Uev5VHPquLBdUpsdlIu', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2262, 'output_tokens': 546, 'total_tokens': 2808, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-11 00:42:22,760 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_mG5uCd2MOno3J3CqlpL7ZN0O', 'function': {'arguments': '{"relative_path":"src/validate/js/propValidators/oncreate.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 2483, 'total_tokens': 2516, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--104c82f9-8127-433b-892d-8b7f8354652b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/validate/js/propValidators/oncreate.ts'}, 'id': 'call_mG5uCd2MOno3J3CqlpL7ZN0O', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2483, 'output_tokens': 33, 'total_tokens': 2516, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:42:23,767 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_8AjuKJQv2S5lvoXQTD9K52Ao', 'function': {'arguments': '{"relative_path":"src/validate/js/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 2759, 'total_tokens': 2788, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--16e4b0f2-8f51-4b67-bdc5-31bd19b53aeb-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/validate/js/index.ts'}, 'id': 'call_8AjuKJQv2S5lvoXQTD9K52Ao', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2759, 'output_tokens': 29, 'total_tokens': 2788, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:42:25,180 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_rWDUlt992Gz8IBzrpaE77XKE', 'function': {'arguments': '{"relative_path":"src/utils/getObject.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 4082, 'total_tokens': 4110, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a6d30624-593d-46f4-a28c-c9c8458ded9f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/utils/getObject.ts'}, 'id': 'call_rWDUlt992Gz8IBzrpaE77XKE', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4082, 'output_tokens': 28, 'total_tokens': 4110, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:42:26,925 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_tmx2c5Cel9kCyx4f9eGuiCGB', 'function': {'arguments': '{"relative_path":"src/generators/dom/preprocess.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 4240, 'total_tokens': 4271, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4dae2ee3-a08d-4b13-a362-e38cd070dfce-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/preprocess.ts'}, 'id': 'call_tmx2c5Cel9kCyx4f9eGuiCGB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4240, 'output_tokens': 31, 'total_tokens': 4271, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:42:29,082 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_oguMcKdvEMnmynuW53qlsbEO', 'function': {'arguments': '{"relative_path":"src/generators/dom/preprocess.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 10578, 'total_tokens': 10609, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--76a65909-d2b1-49c5-8b00-fd4d901329d6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/preprocess.ts'}, 'id': 'call_oguMcKdvEMnmynuW53qlsbEO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10578, 'output_tokens': 31, 'total_tokens': 10609, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:42:30,826 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fBjO3hkxwDlNtuTxP9LZ49Po', 'function': {'arguments': '{"relative_path":"src/generators/dom/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 16916, 'total_tokens': 16946, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f42a2d05-0069-4022-8b96-98e2352958d8-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/index.ts'}, 'id': 'call_fBjO3hkxwDlNtuTxP9LZ49Po', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16916, 'output_tokens': 30, 'total_tokens': 16946, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:42:32,759 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fg39jQsEtgXNtbB9sW6fdnS1', 'function': {'arguments': '{"relative_path":"src/generators/shared/utils/wrapModule.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 22844, 'total_tokens': 22877, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--18b2e961-6bff-4cff-aaa8-98c68c0aa781-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/shared/utils/wrapModule.ts'}, 'id': 'call_fg39jQsEtgXNtbB9sW6fdnS1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 22844, 'output_tokens': 33, 'total_tokens': 22877, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:42:34,406 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_cAjfTezbUcOgVaq2Xn7TuOa9', 'function': {'arguments': '{"relative_path":"src/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 26266, 'total_tokens': 26292, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--806a86b0-0b55-4868-9200-8f7695b55527-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/index.ts'}, 'id': 'call_cAjfTezbUcOgVaq2Xn7TuOa9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26266, 'output_tokens': 26, 'total_tokens': 26292, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:42:38,095 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JYmz0VG0QytSJfxMmXHQraGf', 'function': {'arguments': '{"relative_path":"src/interfaces.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 27170, 'total_tokens': 27196, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 10496}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0119cdff-28c7-4d21-9d48-b0fdd2032c14-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/interfaces.ts'}, 'id': 'call_JYmz0VG0QytSJfxMmXHQraGf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 27170, 'output_tokens': 26, 'total_tokens': 27196, 'input_token_details': {'audio': 0, 'cache_read': 10496}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:42:48,217 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xLVzhcOW3B9BhvTuFAsTOIg4', 'function': {'arguments': '{"relative_path":"src/generators/dom/preprocess.ts","start_line":500,"end_line":1200}', 'name': 'read_code_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 878, 'prompt_tokens': 27973, 'total_tokens': 28851, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8328df99-ff9f-40b1-8657-92dd377c7cb9-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'src/generators/dom/preprocess.ts', 'start_line': 500, 'end_line': 1200}, 'id': 'call_xLVzhcOW3B9BhvTuFAsTOIg4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 27973, 'output_tokens': 878, 'total_tokens': 28851, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-11 00:43:03,352 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I retrieved and provided the full contents of all requested files: src/utils/stringify.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/index.ts, src/utils/getObject.ts, src/generators/dom/preprocess.ts, src/generators/dom/index.ts, src/generators/shared/utils/wrapModule.ts, src/index.ts, and src/interfaces.ts. For the large dom/preprocess.ts, I fetched the entire file by reading it in two parts to ensure completeness. These files include the lifecycle handling points (oncreate/ondestroy/onteardown in validation and DOM generation) and the stringify/escape utility that may be involved in emitting code. This should give you the end-to-end context of parsing, validation, transformation, and emission to track down where the async modifier is being lost and how to preserve it.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1270, 'prompt_tokens': 28536, 'total_tokens': 29806, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1088, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--8c80ab45-4f3a-4b39-bbaf-7d5dc8a78869-0' usage_metadata={'input_tokens': 28536, 'output_tokens': 1270, 'total_tokens': 29806, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1088}}
2025-11-11 00:43:03,357 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents of the following files: src/utils/stringify.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/index.ts, src/utils/getObject.ts, src/generators/dom/preprocess.ts, src/generators/dom/index.ts, src/generators/shared/utils/wrapModule.ts, src/index.ts, and src/interfaces.ts.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If some files are large, include at least the parts that handle lifecycle methods (oncreate/onrender/ondestroy/onteardown) and any code that prints or stringifies function/method AST nodes, with their imports.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These files will reveal where lifecycle methods are parsed, validated, transformed, and emitted so we can locate why the async modifier is being removed and how to preserve it.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: src/generators/dom/index.ts
Line number range: 1 - 437
Content:
1. import MagicString from 'magic-string';
2. import { parseExpressionAt } from 'acorn';
3. import annotateWithScopes from '../../utils/annotateWithScopes';
4. import isReference from '../../utils/isReference';
5. import { walk } from 'estree-walker';
6. import deindent from '../../utils/deindent';
7. import { stringify, escape } from '../../utils/stringify';
8. import CodeBuilder from '../../utils/CodeBuilder';
9. import reservedNames from '../../utils/reservedNames';
10. import visit from './visit';
11. import shared from './shared';
12. import Generator from '../Generator';
13. import Stylesheet from '../../css/Stylesheet';
14. import preprocess from './preprocess';
15. import Block from './Block';
16. import { version } from '../../../package.json';
17. import { Parsed, CompileOptions, Node } from '../../interfaces';
18. 
19. const test = typeof global !== 'undefined' && global.__svelte_test;
20. 
21. export class DomGenerator extends Generator {
22. 	blocks: (Block|string)[];
23. 	readonly: Set<string>;
24. 	metaBindings: string[];
25. 
26. 	hydratable: boolean;
27. 	legacy: boolean;
28. 
29. 	hasIntroTransitions: boolean;
30. 	hasOutroTransitions: boolean;
31. 	hasComplexBindings: boolean;
32. 
33. 	needsEncapsulateHelper: boolean;
34. 
35. 	constructor(
36. 		parsed: Parsed,
37. 		source: string,
38. 		name: string,
39. 		stylesheet: Stylesheet,
40. 		options: CompileOptions
41. 	) {
42. 		super(parsed, source, name, stylesheet, options, true);
43. 		this.blocks = [];
44. 
45. 		this.readonly = new Set();
46. 
47. 		this.hydratable = options.hydratable;
48. 		this.legacy = options.legacy;
49. 		this.needsEncapsulateHelper = false;
50. 
51. 		// initial values for e.g. window.innerWidth, if there's a <:Window> meta tag
52. 		this.metaBindings = [];
53. 	}
54. 
55. 	getUniqueNameMaker(params: string[]) {
56. 		const localUsedNames = new Set(params);
57. 
58. 		function add(name: string) {
59. 			localUsedNames.add(name);
60. 		}
61. 
62. 		reservedNames.forEach(add);
63. 		this.userVars.forEach(add);
64. 		for (const name in shared) {
65. 			localUsedNames.add(test ? `${name}$` : name);
66. 		}
67. 
68. 		return (name: string) => {
69. 			if (test) name = `${name}$`;
70. 			let alias = name;
71. 			for (
72. 				let i = 1;
73. 				this.usedNames.has(alias) ||
74. 				localUsedNames.has(alias);
75. 				alias = `${name}_${i++}`
76. 			);
77. 			localUsedNames.add(alias);
78. 			return alias;
79. 		};
80. 	}
81. }
82. 
83. export default function dom(
84. 	parsed: Parsed,
85. 	source: string,
86. 	stylesheet: Stylesheet,
87. 	options: CompileOptions
88. ) {
89. 	const format = options.format || 'es';
90. 
91. 	const generator = new DomGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
92. 
93. 	const {
94. 		computations,
95. 		name,
96. 		templateProperties,
97. 		namespace,
98. 	} = generator;
99. 
100. 	const { block, state } = preprocess(generator, namespace, parsed.html);
101. 
102. 	generator.stylesheet.warnOnUnusedSelectors(options.onwarn);
103. 
104. 	parsed.html.children.forEach((node: Node) => {
105. 		visit(generator, block, state, node, [], []);
106. 	});
107. 
108. 	const builder = new CodeBuilder();
109. 	const computationBuilder = new CodeBuilder();
110. 	const computationDeps = new Set();
111. 
112. 	if (computations.length) {
113. 		computations.forEach(({ key, deps }) => {
114. 			deps.forEach(dep => {
115. 				computationDeps.add(dep);
116. 			});
117. 
118. 			if (generator.readonly.has(key)) {
119. 				// <:Window> bindings
120. 				throw new Error(
121. 					`Cannot have a computed value '${key}' that clashes with a read-only property`
122. 				);
123. 			}
124. 
125. 			generator.readonly.add(key);
126. 
127. 			const condition = `${deps.map(dep => `changed.${dep}`).join(' || ')}`;
128. 
129. 			const statement = `if (@differs(state.${key}, (state.${key} = %computed-${key}(${deps
130. 				.map(dep => `state.${dep}`)
131. 				.join(', ')})))) changed.${key} = true;`;
132. 
133. 			computationBuilder.addConditional(condition, statement);
134. 		});
135. 	}
136. 
137. 	if (generator.javascript) {
138. 		builder.addBlock(generator.javascript);
139. 	}
140. 
141. 	if (generator.needsEncapsulateHelper) {
142. 		builder.addBlock(deindent`
143. 			function @encapsulateStyles(node) {
144. 				@setAttribute(node, "${generator.stylesheet.id}", "");
145. 			}
146. 		`);
147. 	}
148. 
149. 	const { css, cssMap } = generator.stylesheet.render(options.filename, !generator.customElement);
150. 	const styles = generator.stylesheet.hasStyles && stringify(options.dev ?
151. 		`${css}\n/*# sourceMappingURL=${cssMap.toUrl()} */` :
152. 		css, { onlyEscapeAtSymbol: true });
153. 
154. 	if (styles && generator.options.css !== false && !generator.customElement) {
155. 		builder.addBlock(deindent`
156. 			function @add_css() {
157. 				var style = @createElement("style");
158. 				style.id = '${generator.stylesheet.id}-style';
159. 				style.textContent = ${styles};
160. 				@appendNode(style, document.head);
161. 			}
162. 		`);
163. 	}
164. 
165. 	generator.blocks.forEach(block => {
166. 		builder.addBlock(block.toString());
167. 	});
168. 
169. 	const sharedPath = options.shared === true
170. 		? 'svelte/shared.js'
171. 		: options.shared;
172. 
173. 	const prototypeBase =
174. 		`${name}.prototype` +
175. 		(templateProperties.methods ? `, %methods` : '');
176. 	const proto = sharedPath
177. 		? `@proto`
178. 		: deindent`
179. 		{
180. 			${['destroy', 'get', 'fire', 'observe', 'on', 'set', 'teardown', '_set', '_mount', '_unmount']
181. 				.map(n => `${n}: @${n === 'teardown' ? 'destroy' : n}`)
182. 				.join(',\n')}
183. 		}`;
184. 
185. 	const debugName = `<${generator.customElement ? generator.tag : name}>`;
186. 
187. 	const constructorBody = deindent`
188. 		${options.dev && `this._debugName = '${debugName}';`}
189. 		${options.dev && !generator.customElement &&
190. 			`if (!options || (!options.target && !options._root)) throw new Error("'target' is a required option");`}
191. 		@init(this, options);
192. 		${generator.usesRefs && `this.refs = {};`}
193. 		this._state = @assign(${templateProperties.data ? '%data()' : '{}'}, options.data);
194. 		${generator.metaBindings}
195. 		${computations.length && `this._recompute({ ${Array.from(computationDeps).map(dep => `${dep}: 1`).join(', ')} }, this._state);`}
196. 		${options.dev &&
197. 			Array.from(generator.expectedProperties).map(
198. 				prop =>
199. 					`if (!('${prop}' in this._state)) console.warn("${debugName} was created without expected data property '${prop}'");`
200. 			)}
201. 		${generator.bindingGroups.length &&
202. 			`this._bindingGroups = [${Array(generator.bindingGroups.length).fill('[]').join(', ')}];`}
203. 
204. 		${templateProperties.ondestroy && `this._handlers.destroy = [%ondestroy]`}
205. 
206. 		${generator.slots.size && `this._slotted = options.slots || {};`}
207. 
208. 		${generator.customElement ?
209. 			deindent`
210. 				this.attachShadow({ mode: 'open' });
211. 				${css && `this.shadowRoot.innerHTML = \`<style>${escape(css, { onlyEscapeAtSymbol: true }).replace(/\\/g, '\\\\')}${options.dev ? `\n/*# sourceMappingURL=${cssMap.toUrl()} */` : ''}</style>\`;`}
212. 			` :
213. 			(generator.stylesheet.hasStyles && options.css !== false &&
214. 			`if (!document.getElementById("${generator.stylesheet.id}-style")) @add_css();`)
215. 		}
216. 
217. 		${templateProperties.oncreate && `var _oncreate = %oncreate.bind(this);`}
218. 
219. 		${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`
220. 			if (!options._root) {
221. 				this._oncreate = [${templateProperties.oncreate && `_oncreate`}];
222. 				${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}
223. 				${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}
224. 			} ${templateProperties.oncreate && deindent`
225. 				else {
226. 					this._root._oncreate.push(_oncreate);
227. 				}
228. 			`}
229. 		`}
230. 
231. 		${generator.slots.size && `this.slots = {};`}
232. 
233. 		this._fragment = @create_main_fragment(this._state, this);
234. 
235. 		${generator.customElement ? deindent`
236. 			this._fragment.c();
237. 			this._fragment.${block.hasIntroMethod ? 'i' : 'm'}(this.shadowRoot, null);
238. 
239. 			if (options.target) this._mount(options.target, options.anchor || null);
240. 		` : deindent`
241. 			if (options.target) {
242. 				${generator.hydratable
243. 					? deindent`
244. 						var nodes = @children(options.target);
245. 						options.hydrate ? this._fragment.l(nodes) : this._fragment.c();
246. 						nodes.forEach(@detachNode);
247. 					` :
248. 					deindent`
249. 						${options.dev && `if (options.hydrate) throw new Error("options.hydrate only works if the component was compiled with the \`hydratable: true\` option");`}
250. 						this._fragment.c();
251. 					`}
252. 				this._fragment.${block.hasIntroMethod ? 'i' : 'm'}(options.target, options.anchor || null);
253. 
254. 				${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`
255. 					${generator.hasComponents && `this._lock = true;`}
256. 					${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}
257. 					${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}
258. 					${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}
259. 					${generator.hasComponents && `this._lock = false;`}
260. 				`}
261. 			}
262. 		`}
263. 	`;
264. 
265. 	if (generator.customElement) {
266. 		const props = generator.props || Array.from(generator.expectedProperties);
267. 
268. 		builder.addBlock(deindent`
269. 			class ${name} extends HTMLElement {
270. 				constructor(options = {}) {
271. 					super();
272. 					${constructorBody}
273. 				}
274. 
275. 				static get observedAttributes() {
276. 					return ${JSON.stringify(props)};
277. 				}
278. 
279. 				${props.map(prop => deindent`
280. 					get ${prop}() {
281. 						return this.get('${prop}');
282. 					}
283. 
284. 					set ${prop}(value) {
285. 						this.set({ ${prop}: value });
286. 					}
287. 				`).join('\n\n')}
288. 
289. 				${generator.slots.size && deindent`
290. 					connectedCallback() {
291. 						Object.keys(this._slotted).forEach(key => {
292. 							this.appendChild(this._slotted[key]);
293. 						});
294. 					}`}
295. 
296. 				attributeChangedCallback(attr, oldValue, newValue) {
297. 					this.set({ [attr]: newValue });
298. 				}
299. 			}
300. 
301. 			customElements.define("${generator.tag}", ${name});
302. 			@assign(${prototypeBase}, ${proto}, {
303. 				_mount(target, anchor) {
304. 					target.insertBefore(this, anchor);
305. 				},
306. 
307. 				_unmount() {
308. 					this.parentNode.removeChild(this);
309. 				}
310. 			});
311. 		`);
312. 	} else {
313. 		builder.addBlock(deindent`
314. 			function ${name}(options) {
315. 				${constructorBody}
316. 			}
317. 
318. 			@assign(${prototypeBase}, ${proto});
319. 		`);
320. 	}
321. 
322. 	builder.addBlock(deindent`
323. 		${options.dev && deindent`
324. 			${name}.prototype._checkReadOnly = function _checkReadOnly(newState) {
325. 				${Array.from(generator.readonly).map(
326. 					prop =>
327. 						`if ('${prop}' in newState && !this._updatingReadonlyProperty) throw new Error("${debugName}: Cannot set read-only property '${prop}'");`
328. 				)}
329. 			};
330. 		`}
331. 
332. 		${computations.length ? deindent`
333. 			${name}.prototype._recompute = function _recompute(changed, state) {
334. 				${computationBuilder}
335. 			}
336. 		` : (!sharedPath && `${name}.prototype._recompute = @noop;`)}
337. 
338. 		${templateProperties.setup && `%setup(${name});`}
339. 	`);
340. 
341. 	const usedHelpers = new Set();
342. 
343. 	let result = builder
344. 		.toString()
345. 		.replace(/(%+|@+)(\w*(?:-\w*)?)/g, (match: string, sigil: string, name: string) => {
346. 			if (sigil === '@') {
347. 				if (name in shared) {
348. 					if (options.dev && `${name}Dev` in shared) name = `${name}Dev`;
349. 					usedHelpers.add(name);
350. 				}
351. 
352. 				return generator.alias(name);
353. 			}
354. 
355. 			if (sigil === '%') {
356. 				return generator.templateVars.get(name);
357. 			}
358. 
359. 			return sigil.slice(1) + name;
360. 		});
361. 
362. 	let helpers;
363. 
364. 	if (sharedPath) {
365. 		if (format !== 'es' && format !== 'cjs') {
366. 			throw new Error(`Components with shared helpers must be compiled with \`format: 'es'\` or \`format: 'cjs'\``);
367. 		}
368. 		const used = Array.from(usedHelpers).sort();
369. 		helpers = used.map(name => {
370. 			const alias = generator.alias(name);
371. 			return { name, alias };
372. 		});
373. 	} else {
374. 		let inlineHelpers = '';
375. 
376. 		usedHelpers.forEach(key => {
377. 			const str = shared[key];
378. 			const code = new MagicString(str);
379. 			const expression = parseExpressionAt(str, 0);
380. 
381. 			let scope = annotateWithScopes(expression);
382. 
383. 			walk(expression, {
384. 				enter(node: Node, parent: Node) {
385. 					if (node._scope) scope = node._scope;
386. 
387. 					if (
388. 						node.type === 'Identifier' &&
389. 						isReference(node, parent) &&
390. 						!scope.has(node.name)
391. 					) {
392. 						if (node.name in shared) {
393. 							// this helper function depends on another one
394. 							const dependency = node.name;
395. 							usedHelpers.add(dependency);
396. 
397. 							const alias = generator.alias(dependency);
398. 							if (alias !== node.name)
399. 								code.overwrite(node.start, node.end, alias);
400. 						}
401. 					}
402. 				},
403. 
404. 				leave(node: Node) {
405. 					if (node._scope) scope = scope.parent;
406. 				},
407. 			});
408. 
409. 			if (key === 'transitionManager') {
410. 				// special case
411. 				const global = `_svelteTransitionManager`;
412. 
413. 				inlineHelpers += `\n\nvar ${generator.alias('transitionManager')} = window.${global} || (window.${global} = ${code});\n\n`;
414. 			} else {
415. 				const alias = generator.alias(expression.id.name);
416. 				if (alias !== expression.id.name)
417. 					code.overwrite(expression.id.start, expression.id.end, alias);
418. 
419. 				inlineHelpers += `\n\n${code}`;
420. 			}
421. 		});
422. 
423. 		result += inlineHelpers;
424. 	}
425. 
426. 	const filename = options.filename && (
427. 		typeof process !== 'undefined' ? options.filename.replace(process.cwd(), '').replace(/^[\/\\]/, '') : options.filename
428. 	);
429. 
430. 	return generator.generate(result, options, {
431. 		banner: `/* ${filename ? `${filename} ` : ``}generated by Svelte v${version} */`,
432. 		sharedPath,
433. 		helpers,
434. 		name,
435. 		format,
436. 	});
437. }


File: src/generators/dom/preprocess.ts
Line number range: 1 - 500
Content:
1. import Block from './Block';
2. import { trimStart, trimEnd } from '../../utils/trim';
3. import { assign } from '../../shared/index.js';
4. import getStaticAttributeValue from '../../utils/getStaticAttributeValue';
5. import isChildOfComponent from '../shared/utils/isChildOfComponent';
6. import { DomGenerator } from './index';
7. import { Node } from '../../interfaces';
8. import { State } from './interfaces';
9. 
10. function isElseIf(node: Node) {
11. 	return (
12. 		node && node.children.length === 1 && node.children[0].type === 'IfBlock'
13. 	);
14. }
15. 
16. function getChildState(parent: State, child = {}) {
17. 	return assign(
18. 		{},
19. 		parent,
20. 		{ parentNode: null, parentNodes: 'nodes' },
21. 		child || {}
22. 	);
23. }
24. 
25. function createDebuggingComment(node: Node, generator: DomGenerator) {
26. 	const { locate, source } = generator;
27. 
28. 	let c = node.start;
29. 	if (node.type === 'ElseBlock') {
30. 		while (source[c] !== '{') c -= 1;
31. 		c -= 1;
32. 	}
33. 
34. 	let d = node.expression ? node.expression.end : c;
35. 	while (source[d] !== '}') d += 1;
36. 	d += 2;
37. 
38. 	const start = locate(c);
39. 	const loc = `(${start.line + 1}:${start.column})`;
40. 
41. 	return `${loc} ${source.slice(c, d)}`.replace(/\n/g, ' ');
42. }
43. 
44. function cannotUseInnerHTML(node: Node) {
45. 	while (node && node.canUseInnerHTML) {
46. 		node.canUseInnerHTML = false;
47. 		node = node.parent;
48. 	}
49. }
50. 
51. // Whitespace inside one of these elements will not result in
52. // a whitespace node being created in any circumstances. (This
53. // list is almost certainly very incomplete)
54. const elementsWithoutText = new Set([
55. 	'audio',
56. 	'datalist',
57. 	'dl',
58. 	'ol',
59. 	'optgroup',
60. 	'select',
61. 	'ul',
62. 	'video',
63. ]);
64. 
65. const preprocessors = {
66. 	MustacheTag: (
67. 		generator: DomGenerator,
68. 		block: Block,
69. 		state: State,
70. 		node: Node,
71. 		elementStack: Node[],
72. 		componentStack: Node[],
73. 		stripWhitespace: boolean
74. 	) => {
75. 		cannotUseInnerHTML(node);
76. 		node.var = block.getUniqueName('text');
77. 
78. 		const dependencies = block.findDependencies(node.expression);
79. 		block.addDependencies(dependencies);
80. 	},
81. 
82. 	RawMustacheTag: (
83. 		generator: DomGenerator,
84. 		block: Block,
85. 		state: State,
86. 		node: Node,
87. 		elementStack: Node[],
88. 		componentStack: Node[],
89. 		stripWhitespace: boolean
90. 	) => {
91. 		cannotUseInnerHTML(node);
92. 		node.var = block.getUniqueName('raw');
93. 
94. 		const dependencies = block.findDependencies(node.expression);
95. 		block.addDependencies(dependencies);
96. 	},
97. 
98. 	Text: (
99. 		generator: DomGenerator,
100. 		block: Block,
101. 		state: State,
102. 		node: Node,
103. 		elementStack: Node[],
104. 		componentStack: Node[],
105. 		stripWhitespace: boolean
106. 	) => {
107. 		if (!/\S/.test(node.data) && (state.namespace || elementsWithoutText.has(state.parentNodeName))) {
108. 			node.shouldSkip = true;
109. 			return;
110. 		}
111. 
112. 		node.var = block.getUniqueName(`text`);
113. 	},
114. 
115. 	IfBlock: (
116. 		generator: DomGenerator,
117. 		block: Block,
118. 		state: State,
119. 		node: Node,
120. 		inEachBlock: boolean,
121. 		elementStack: Node[],
122. 		componentStack: Node[],
123. 		stripWhitespace: boolean,
124. 		nextSibling: Node
125. 	) => {
126. 		cannotUseInnerHTML(node);
127. 
128. 		const blocks: Block[] = [];
129. 		let dynamic = false;
130. 		let hasIntros = false;
131. 		let hasOutros = false;
132. 
133. 		function attachBlocks(node: Node) {
134. 			node.var = block.getUniqueName(`if_block`);
135. 
136. 			const dependencies = block.findDependencies(node.expression);
137. 			block.addDependencies(dependencies);
138. 
139. 			node._block = block.child({
140. 				comment: createDebuggingComment(node, generator),
141. 				name: generator.getUniqueName(`create_if_block`),
142. 			});
143. 
144. 			node._state = getChildState(state);
145. 
146. 			blocks.push(node._block);
147. 			preprocessChildren(generator, node._block, node._state, node, inEachBlock, elementStack, componentStack, stripWhitespace, nextSibling);
148. 
149. 			if (node._block.dependencies.size > 0) {
150. 				dynamic = true;
151. 				block.addDependencies(node._block.dependencies);
152. 			}
153. 
154. 			if (node._block.hasIntroMethod) hasIntros = true;
155. 			if (node._block.hasOutroMethod) hasOutros = true;
156. 
157. 			if (isElseIf(node.else)) {
158. 				attachBlocks(node.else.children[0]);
159. 			} else if (node.else) {
160. 				node.else._block = block.child({
161. 					comment: createDebuggingComment(node.else, generator),
162. 					name: generator.getUniqueName(`create_if_block`),
163. 				});
164. 
165. 				node.else._state = getChildState(state);
166. 
167. 				blocks.push(node.else._block);
168. 				preprocessChildren(
169. 					generator,
170. 					node.else._block,
171. 					node.else._state,
172. 					node.else,
173. 					inEachBlock,
174. 					elementStack,
175. 					componentStack,
176. 					stripWhitespace,
177. 					nextSibling
178. 				);
179. 
180. 				if (node.else._block.dependencies.size > 0) {
181. 					dynamic = true;
182. 					block.addDependencies(node.else._block.dependencies);
183. 				}
184. 			}
185. 		}
186. 
187. 		attachBlocks(node);
188. 
189. 		blocks.forEach(block => {
190. 			block.hasUpdateMethod = dynamic;
191. 			block.hasIntroMethod = hasIntros;
192. 			block.hasOutroMethod = hasOutros;
193. 		});
194. 
195. 		generator.blocks.push(...blocks);
196. 	},
197. 
198. 	EachBlock: (
199. 		generator: DomGenerator,
200. 		block: Block,
201. 		state: State,
202. 		node: Node,
203. 		inEachBlock: boolean,
204. 		elementStack: Node[],
205. 		componentStack: Node[],
206. 		stripWhitespace: boolean,
207. 		nextSibling: Node
208. 	) => {
209. 		cannotUseInnerHTML(node);
210. 		node.var = block.getUniqueName(`each`);
211. 
212. 		const dependencies = block.findDependencies(node.expression);
213. 		block.addDependencies(dependencies);
214. 
215. 		const indexNames = new Map(block.indexNames);
216. 		const indexName =
217. 			node.index || block.getUniqueName(`${node.context}_index`);
218. 		indexNames.set(node.context, indexName);
219. 
220. 		const listNames = new Map(block.listNames);
221. 		const listName = block.getUniqueName(
222. 			(node.expression.type === 'MemberExpression' && !node.expression.computed) ? node.expression.property.name :
223. 			node.expression.type === 'Identifier' ? node.expression.name :
224. 			`each_value`
225. 		);
226. 		listNames.set(node.context, listName);
227. 
228. 		const context = generator.getUniqueName(node.context);
229. 		const contexts = new Map(block.contexts);
230. 		contexts.set(node.context, context);
231. 
232. 		const indexes = new Map(block.indexes);
233. 		if (node.index) indexes.set(node.index, node.context);
234. 
235. 		const changeableIndexes = new Map(block.changeableIndexes);
236. 		if (node.index) changeableIndexes.set(node.index, node.key);
237. 
238. 		const contextDependencies = new Map(block.contextDependencies);
239. 		contextDependencies.set(node.context, dependencies);
240. 
241. 		if (node.destructuredContexts) {
242. 			for (const i = 0; i < node.destructuredContexts.length; i++) {
243. 				contexts.set(node.destructuredContexts[i], `${context}[${i}]`);
244. 				contextDependencies.set(node.destructuredContexts[i], dependencies);
245. 			}
246. 		}
247. 
248. 		node._block = block.child({
249. 			comment: createDebuggingComment(node, generator),
250. 			name: generator.getUniqueName('create_each_block'),
251. 			expression: node.expression,
252. 			context: node.context,
253. 			key: node.key,
254. 
255. 			contextDependencies,
256. 			contexts,
257. 			indexes,
258. 			changeableIndexes,
259. 
260. 			listName,
261. 			indexName,
262. 
263. 			indexNames,
264. 			listNames,
265. 			params: block.params.concat(listName, context, indexName),
266. 		});
267. 
268. 		node._state = getChildState(state, {
269. 			inEachBlock: true,
270. 		});
271. 
272. 		generator.blocks.push(node._block);
273. 		preprocessChildren(generator, node._block, node._state, node, true, elementStack, componentStack, stripWhitespace, nextSibling);
274. 		block.addDependencies(node._block.dependencies);
275. 		node._block.hasUpdateMethod = node._block.dependencies.size > 0;
276. 
277. 		if (node.else) {
278. 			node.else._block = block.child({
279. 				comment: createDebuggingComment(node.else, generator),
280. 				name: generator.getUniqueName(`${node._block.name}_else`),
281. 			});
282. 
283. 			node.else._state = getChildState(state);
284. 
285. 			generator.blocks.push(node.else._block);
286. 			preprocessChildren(
287. 				generator,
288. 				node.else._block,
289. 				node.else._state,
290. 				node.else,
291. 				inEachBlock,
292. 				elementStack,
293. 				componentStack,
294. 				stripWhitespace,
295. 				nextSibling
296. 			);
297. 			node.else._block.hasUpdateMethod = node.else._block.dependencies.size > 0;
298. 		}
299. 	},
300. 
301. 	Element: (
302. 		generator: DomGenerator,
303. 		block: Block,
304. 		state: State,
305. 		node: Node,
306. 		inEachBlock: boolean,
307. 		elementStack: Node[],
308. 		componentStack: Node[],
309. 		stripWhitespace: boolean,
310. 		nextSibling: Node
311. 	) => {
312. 		if (node.name === 'slot') {
313. 			cannotUseInnerHTML(node);
314. 		}
315. 
316. 		node.attributes.forEach((attribute: Node) => {
317. 			if (attribute.type === 'Attribute' && attribute.value !== true) {
318. 				attribute.value.forEach((chunk: Node) => {
319. 					if (chunk.type !== 'Text') {
320. 						if (node.parent) cannotUseInnerHTML(node.parent);
321. 
322. 						const dependencies = block.findDependencies(chunk.expression);
323. 						block.addDependencies(dependencies);
324. 
325. 						// special case — <option value='{{foo}}'> — see below
326. 						if (
327. 							node.name === 'option' &&
328. 							attribute.name === 'value' &&
329. 							state.selectBindingDependencies
330. 						) {
331. 							state.selectBindingDependencies.forEach(prop => {
332. 								dependencies.forEach((dependency: string) => {
333. 									generator.indirectDependencies.get(prop).add(dependency);
334. 								});
335. 							});
336. 						}
337. 					}
338. 				});
339. 			} else {
340. 				if (node.parent) cannotUseInnerHTML(node.parent);
341. 
342. 				if (attribute.type === 'EventHandler' && attribute.expression) {
343. 					attribute.expression.arguments.forEach((arg: Node) => {
344. 						const dependencies = block.findDependencies(arg);
345. 						block.addDependencies(dependencies);
346. 					});
347. 				} else if (attribute.type === 'Binding') {
348. 					const dependencies = block.findDependencies(attribute.value);
349. 					block.addDependencies(dependencies);
350. 				} else if (attribute.type === 'Transition') {
351. 					if (attribute.intro)
352. 						generator.hasIntroTransitions = block.hasIntroMethod = true;
353. 					if (attribute.outro) {
354. 						generator.hasOutroTransitions = block.hasOutroMethod = true;
355. 						block.outros += 1;
356. 					}
357. 				}
358. 			}
359. 		});
360. 
361. 		// special case — in a case like this...
362. 		//
363. 		//   <select bind:value='foo'>
364. 		//     <option value='{{bar}}'>bar</option>
365. 		//     <option value='{{baz}}'>baz</option>
366. 		//   </option>
367. 		//
368. 		// ...we need to know that `foo` depends on `bar` and `baz`,
369. 		// so that if `foo.qux` changes, we know that we need to
370. 		// mark `bar` and `baz` as dirty too
371. 		if (node.name === 'select') {
372. 			cannotUseInnerHTML(node);
373. 
374. 			const value = node.attributes.find(
375. 				(attribute: Node) => attribute.name === 'value'
376. 			);
377. 			if (value) {
378. 				// TODO does this also apply to e.g. `<input type='checkbox' bind:group='foo'>`?
379. 				const dependencies = block.findDependencies(value.value);
380. 				state.selectBindingDependencies = dependencies;
381. 				dependencies.forEach((prop: string) => {
382. 					generator.indirectDependencies.set(prop, new Set());
383. 				});
384. 			} else {
385. 				state.selectBindingDependencies = null;
386. 			}
387. 		}
388. 
389. 		const isComponent =
390. 			generator.components.has(node.name) || node.name === ':Self';
391. 
392. 		if (isComponent) {
393. 			cannotUseInnerHTML(node);
394. 
395. 			node.var = block.getUniqueName(
396. 				(node.name === ':Self' ? generator.name : node.name).toLowerCase()
397. 			);
398. 
399. 			node._state = getChildState(state, {
400. 				parentNode: `${node.var}._slotted.default`
401. 			});
402. 		} else {
403. 			const slot = getStaticAttributeValue(node, 'slot');
404. 			if (slot && isChildOfComponent(node, generator)) {
405. 				cannotUseInnerHTML(node);
406. 				node.slotted = true;
407. 				// TODO validate slots — no nesting, no dynamic names...
408. 				const component = componentStack[componentStack.length - 1];
409. 				component._slots.add(slot);
410. 			}
411. 
412. 			node.var = block.getUniqueName(
413. 				node.name.replace(/[^a-zA-Z0-9_$]/g, '_')
414. 			);
415. 
416. 			node._state = getChildState(state, {
417. 				isTopLevel: false,
418. 				parentNode: node.var,
419. 				parentNodes: block.getUniqueName(`${node.var}_nodes`),
420. 				parentNodeName: node.name,
421. 				namespace: node.name === 'svg'
422. 					? 'http://www.w3.org/2000/svg'
423. 					: state.namespace,
424. 				allUsedContexts: [],
425. 			});
426. 
427. 			generator.stylesheet.apply(node, elementStack);
428. 		}
429. 
430. 		if (node.children.length) {
431. 			if (isComponent) {
432. 				if (node.children) node._slots = new Set(['default']);
433. 				preprocessChildren(generator, block, node._state, node, inEachBlock, elementStack, componentStack.concat(node), stripWhitespace, nextSibling);
434. 			} else {
435. 				if (node.name === 'pre' || node.name === 'textarea') stripWhitespace = false;
436. 				preprocessChildren(generator, block, node._state, node, inEachBlock, elementStack.concat(node), componentStack, stripWhitespace, nextSibling);
437. 			}
438. 		}
439. 	},
440. };
441. 
442. function preprocessChildren(
443. 	generator: DomGenerator,
444. 	block: Block,
445. 	state: State,
446. 	node: Node,
447. 	inEachBlock: boolean,
448. 	elementStack: Node[],
449. 	componentStack: Node[],
450. 	stripWhitespace: boolean,
451. 	nextSibling: Node
452. ) {
453. 	// glue text nodes together
454. 	const cleaned: Node[] = [];
455. 	let lastChild: Node;
456. 
457. 	node.children.forEach((child: Node) => {
458. 		if (child.type === 'Comment') return;
459. 
460. 		if (child.type === 'Text' && lastChild && lastChild.type === 'Text') {
461. 			lastChild.data += child.data;
462. 			lastChild.end = child.end;
463. 		} else {
464. 			if (child.type === 'Text' && stripWhitespace && cleaned.length === 0) {
465. 				child.data = trimStart(child.data);
466. 				if (child.data) cleaned.push(child);
467. 			} else {
468. 				cleaned.push(child);
469. 			}
470. 		}
471. 
472. 		lastChild = child;
473. 	});
474. 
475. 	lastChild = null;
476. 
477. 	cleaned.forEach((child: Node, i: number) => {
478. 		child.parent = node;
479. 		child.canUseInnerHTML = !generator.hydratable;
480. 
481. 		const preprocessor = preprocessors[child.type];
482. 		if (preprocessor) preprocessor(generator, block, state, child, inEachBlock, elementStack, componentStack, stripWhitespace, cleaned[i + 1] || nextSibling);
483. 
484. 		if (child.shouldSkip) return;
485. 
486. 		if (lastChild) lastChild.next = child;
487. 		child.prev = lastChild;
488. 
489. 		lastChild = child;
490. 	});
491. 
492. 	// We want to remove trailing whitespace inside an element/component/block,
493. 	// *unless* there is no whitespace between this node and its next sibling
494. 	if (stripWhitespace && lastChild && lastChild.type === 'Text') {
495. 		const shouldTrim = (
496. 			nextSibling ?  (nextSibling.type === 'Text' && /^\s/.test(nextSibling.data)) : !inEachBlock
497. 		);
498. 
499. 		if (shouldTrim) {
500. 			lastChild.data = trimEnd(lastChild.data);


File: src/generators/dom/preprocess.ts
Line number range: 500 - 1200
Content:
500. 			lastChild.data = trimEnd(lastChild.data);
501. 			if (!lastChild.data) {
502. 				cleaned.pop();
503. 				lastChild = cleaned[cleaned.length - 1];
504. 				lastChild.next = null;
505. 			}
506. 		}
507. 	}
508. 
509. 	node.children = cleaned;
510. }
511. 
512. export default function preprocess(
513. 	generator: DomGenerator,
514. 	namespace: string,
515. 	node: Node
516. ) {
517. 	const block = new Block({
518. 		generator,
519. 		name: '@create_main_fragment',
520. 		key: null,
521. 
522. 		contexts: new Map(),
523. 		indexes: new Map(),
524. 		changeableIndexes: new Map(),
525. 		contextDependencies: new Map(),
526. 
527. 		params: ['state'],
528. 		indexNames: new Map(),
529. 		listNames: new Map(),
530. 
531. 		dependencies: new Set(),
532. 	});
533. 
534. 	const state: State = {
535. 		namespace,
536. 		parentNode: null,
537. 		parentNodes: 'nodes'
538. 	};
539. 
540. 	generator.blocks.push(block);
541. 	preprocessChildren(generator, block, state, node, false, [], [], true, null);
542. 	block.hasUpdateMethod = true;
543. 
544. 	return { block, state };
545. }


File: src/generators/shared/utils/wrapModule.ts
Line number range: 1 - 298
Content:
1. import deindent from '../../../utils/deindent';
2. import { CompileOptions, ModuleFormat, Node } from '../../../interfaces';
3. 
4. interface Dependency {
5. 	name: string;
6. 	statements: string[];
7. 	source: string;
8. }
9. 
10. const wrappers = { es, amd, cjs, iife, umd, eval: expr };
11. 
12. export default function wrapModule(
13. 	code: string,
14. 	format: ModuleFormat,
15. 	name: string,
16. 	options: CompileOptions,
17. 	banner: string,
18. 	sharedPath: string,
19. 	helpers: { name: string, alias: string }[],
20. 	imports: Node[],
21. 	source: string
22. ): string {
23. 	if (format === 'es') return es(code, name, options, banner, sharedPath, helpers, imports, source);
24. 
25. 	const dependencies = imports.map((declaration, i) => {
26. 		const defaultImport = declaration.specifiers.find(
27. 			(x: Node) =>
28. 				x.type === 'ImportDefaultSpecifier' ||
29. 				(x.type === 'ImportSpecifier' && x.imported.name === 'default')
30. 		);
31. 
32. 		const namespaceImport = declaration.specifiers.find(
33. 			(x: Node) => x.type === 'ImportNamespaceSpecifier'
34. 		);
35. 
36. 		const namedImports = declaration.specifiers.filter(
37. 			(x: Node) =>
38. 				x.type === 'ImportSpecifier' && x.imported.name !== 'default'
39. 		);
40. 
41. 		const name = defaultImport || namespaceImport
42. 			? (defaultImport || namespaceImport).local.name
43. 			: `__import${i}`;
44. 
45. 		const statements: string[] = [];
46. 
47. 		namedImports.forEach((specifier: Node) => {
48. 			statements.push(
49. 				`var ${specifier.local.name} = ${name}.${specifier.imported.name};`
50. 			);
51. 		});
52. 
53. 		if (defaultImport) {
54. 			statements.push(
55. 				`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`
56. 			);
57. 		}
58. 
59. 		return { name, statements, source: declaration.source.value };
60. 	});
61. 
62. 	if (format === 'amd') return amd(code, name, options, banner, dependencies);
63. 	if (format === 'cjs') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);
64. 	if (format === 'iife') return iife(code, name, options, banner, dependencies);
65. 	if (format === 'umd') return umd(code, name, options, banner, dependencies);
66. 	if (format === 'eval') return expr(code, name, options, banner, dependencies);
67. 
68. 	throw new Error(`Not implemented: ${format}`);
69. }
70. 
71. function es(
72. 	code: string,
73. 	name: string,
74. 	options: CompileOptions,
75. 	banner: string,
76. 	sharedPath: string,
77. 	helpers: { name: string, alias: string }[],
78. 	imports: Node[],
79. 	source: string
80. ) {
81. 	const importHelpers = helpers && (
82. 		`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(', ')} } from ${JSON.stringify(sharedPath)};`
83. 	);
84. 
85. 	const importBlock = imports.length > 0 && (
86. 		imports
87. 			.map((declaration: Node) => source.slice(declaration.start, declaration.end))
88. 			.join('\n')
89. 	);
90. 
91. 	return deindent`
92. 		${banner}
93. 		${importHelpers}
94. 		${importBlock}
95. 
96. 		${code}
97. 		export default ${name};`;
98. }
99. 
100. function amd(
101. 	code: string,
102. 	name: string,
103. 	options: CompileOptions,
104. 	banner: string,
105. 	dependencies: Dependency[]
106. ) {
107. 	const sourceString = dependencies.length
108. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
109. 		: '';
110. 
111. 	const id = options.amd && options.amd.id;
112. 
113. 	return deindent`
114. 		define(${id ? `"${id}", ` : ''}${sourceString}function(${paramString(dependencies)}) { "use strict";
115. 			${getCompatibilityStatements(dependencies)}
116. 
117. 			${code}
118. 			return ${name};
119. 		});`;
120. }
121. 
122. function cjs(
123. 	code: string,
124. 	name: string,
125. 	options: CompileOptions,
126. 	banner: string,
127. 	sharedPath: string,
128. 	helpers: { name: string, alias: string }[],
129. 	dependencies: Dependency[]
130. ) {
131. 	const SHARED = '__shared';
132. 	const helperBlock = helpers && (
133. 		`var ${SHARED} = require(${JSON.stringify(sharedPath)});\n` +
134. 		helpers.map(helper => {
135. 			return `var ${helper.alias} = ${SHARED}.${helper.name};`;
136. 		}).join('\n')
137. 	);
138. 
139. 	const requireBlock = dependencies.length > 0 && (
140. 		dependencies
141. 			.map(d => `var ${d.name} = require("${d.source}");`)
142. 			.join('\n\n')
143. 	);
144. 
145. 	return deindent`
146. 		${banner}
147. 		"use strict";
148. 
149. 		${helperBlock}
150. 		${requireBlock}
151. 		${getCompatibilityStatements(dependencies)}
152. 
153. 		${code}
154. 
155. 		module.exports = ${name};`
156. }
157. 
158. function iife(
159. 	code: string,
160. 	name: string,
161. 	options: CompileOptions,
162. 	banner: string,
163. 	dependencies: Dependency[]
164. ) {
165. 	if (!options.name) {
166. 		throw new Error(`Missing required 'name' option for IIFE export`);
167. 	}
168. 
169. 	const globals = getGlobals(dependencies, options);
170. 
171. 	return deindent`
172. 		${banner}
173. 		var ${options.name} = (function(${paramString(dependencies)}) { "use strict";
174. 			${getCompatibilityStatements(dependencies)}
175. 
176. 			${code}
177. 			return ${name};
178. 		}(${globals.join(', ')}));`;
179. }
180. 
181. function umd(
182. 	code: string,
183. 	name: string,
184. 	options: CompileOptions,
185. 	banner: string,
186. 	dependencies: Dependency[]
187. ) {
188. 	if (!options.name) {
189. 		throw new Error(`Missing required 'name' option for UMD export`);
190. 	}
191. 
192. 	const amdId = options.amd && options.amd.id ? `'${options.amd.id}', ` : '';
193. 
194. 	const amdDeps = dependencies.length
195. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
196. 		: '';
197. 
198. 	const cjsDeps = dependencies
199. 		.map(d => `require("${d.source}")`)
200. 		.join(', ');
201. 
202. 	const globals = getGlobals(dependencies, options);
203. 
204. 	return deindent`
205. 		${banner}
206. 		(function(global, factory) {
207. 			typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :
208. 			typeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :
209. 			(global.${options.name} = factory(${globals}));
210. 		}(this, (function (${paramString(dependencies)}) { "use strict";
211. 
212. 			${getCompatibilityStatements(dependencies)}
213. 
214. 			${code}
215. 
216. 			return ${name};
217. 
218. 		})));`;
219. }
220. 
221. function expr(
222. 	code: string,
223. 	name: string,
224. 	options: CompileOptions,
225. 	banner: string,
226. 	dependencies: Dependency[]
227. ) {
228. 	const globals = getGlobals(dependencies, options);
229. 
230. 	return deindent`
231. 		(function (${paramString(dependencies)}) { "use strict";
232. 			${banner}
233. 
234. 			${getCompatibilityStatements(dependencies)}
235. 
236. 			${code}
237. 
238. 			return ${name};
239. 		}(${globals.join(', ')}))`;
240. }
241. 
242. function paramString(dependencies: Dependency[]) {
243. 	return dependencies.map(dep => dep.name).join(', ');
244. }
245. 
246. function removeExtension(file: string) {
247. 	const index = file.lastIndexOf('.');
248. 	return ~index ? file.slice(0, index) : file;
249. }
250. 
251. function getCompatibilityStatements(dependencies: Dependency[]) {
252. 	if (!dependencies.length) return null;
253. 
254. 	const statements: string[] = [];
255. 
256. 	dependencies.forEach(dependency => {
257. 		statements.push(...dependency.statements);
258. 	});
259. 
260. 	return statements.join('\n');
261. }
262. 
263. function getGlobals(dependencies: Dependency[], options: CompileOptions) {
264. 	const { globals, onerror, onwarn } = options;
265. 	const globalFn = getGlobalFn(globals);
266. 
267. 	return dependencies.map(d => {
268. 		let name = globalFn(d.source);
269. 
270. 		if (!name) {
271. 			if (d.name.startsWith('__import')) {
272. 				const error = new Error(
273. 					`Could not determine name for imported module '${d.source}' – use options.globals`
274. 				);
275. 				onerror(error);
276. 			} else {
277. 				const warning = {
278. 					message: `No name was supplied for imported module '${d.source}'. Guessing '${d.name}', but you should use options.globals`,
279. 				};
280. 
281. 				onwarn(warning);
282. 			}
283. 
284. 			name = d.name;
285. 		}
286. 
287. 		return name;
288. 	});
289. }
290. 
291. function getGlobalFn(globals: any): (id: string) => string {
292. 	if (typeof globals === 'function') return globals;
293. 	if (typeof globals === 'object') {
294. 		return id => globals[id];
295. 	}
296. 
297. 	return () => undefined;
298. }


File: src/index.ts
Line number range: 1 - 78
Content:
1. import parse from './parse/index';
2. import validate from './validate/index';
3. import generate from './generators/dom/index';
4. import generateSSR from './generators/server-side-rendering/index';
5. import { assign } from './shared/index.js';
6. import { version } from '../package.json';
7. import Stylesheet from './css/Stylesheet';
8. import { Parsed, CompileOptions, Warning } from './interfaces';
9. 
10. function normalizeOptions(options: CompileOptions): CompileOptions {
11. 	let normalizedOptions = assign({ generate: 'dom' }, options);
12. 	const { onwarn, onerror } = normalizedOptions;
13. 	normalizedOptions.onwarn = onwarn
14. 		? (warning: Warning) => onwarn(warning, defaultOnwarn)
15. 		: defaultOnwarn;
16. 	normalizedOptions.onerror = onerror
17. 		? (error: Error) => onerror(error, defaultOnerror)
18. 		: defaultOnerror;
19. 	return normalizedOptions;
20. }
21. 
22. function defaultOnwarn(warning: Warning) {
23. 	if (warning.loc) {
24. 		console.warn(
25. 			`(${warning.loc.line}:${warning.loc.column}) – ${warning.message}`
26. 		); // eslint-disable-line no-console
27. 	} else {
28. 		console.warn(warning.message); // eslint-disable-line no-console
29. 	}
30. }
31. 
32. function defaultOnerror(error: Error) {
33. 	throw error;
34. }
35. 
36. export function compile(source: string, _options: CompileOptions) {
37. 	const options = normalizeOptions(_options);
38. 
39. 	let parsed: Parsed;
40. 
41. 	try {
42. 		parsed = parse(source, options);
43. 	} catch (err) {
44. 		options.onerror(err);
45. 		return;
46. 	}
47. 
48. 	const stylesheet = new Stylesheet(source, parsed, options.filename, options.cascade !== false);
49. 
50. 	validate(parsed, source, stylesheet, options);
51. 
52. 	const compiler = options.generate === 'ssr' ? generateSSR : generate;
53. 
54. 	return compiler(parsed, source, stylesheet, options);
55. }
56. 
57. export function create(source: string, _options: CompileOptions = {}) {
58. 	_options.format = 'eval';
59. 
60. 	const compiled = compile(source, _options);
61. 
62. 	if (!compiled || !compiled.code) {
63. 		return;
64. 	}
65. 
66. 	try {
67. 		return (0,eval)(compiled.code);
68. 	} catch (err) {
69. 		if (_options.onerror) {
70. 			_options.onerror(err);
71. 			return;
72. 		} else {
73. 			throw err;
74. 		}
75. 	}
76. }
77. 
78. export { parse, validate, version as VERSION };


File: src/interfaces.ts
Line number range: 1 - 80
Content:
1. export interface Node {
2. 	start: number;
3. 	end: number;
4. 	type: string;
5. 	[propName: string]: any;
6. }
7. 
8. export interface Parser {
9. 	readonly template: string;
10. 	readonly filename?: string;
11. 
12. 	index: number;
13. 	stack: Array<Node>;
14. 
15. 	html: Node;
16. 	css: Node;
17. 	js: Node;
18. 	metaTags: {};
19. }
20. 
21. export interface Parsed {
22. 	hash: number;
23. 	html: Node;
24. 	css: Node;
25. 	js: Node;
26. }
27. 
28. export interface Warning {
29. 	loc?: { line: number; column: number; pos?: number };
30. 	pos?: number;
31. 	message: string;
32. 	filename?: string;
33. 	frame?: string;
34. 	toString: () => string;
35. }
36. 
37. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';
38. 
39. export interface CompileOptions {
40. 	format?: ModuleFormat;
41. 	name?: string;
42. 	filename?: string;
43. 	generate?: string;
44. 	globals?: ((id: string) => string) | object;
45. 	amd?: {
46. 		id?: string;
47. 	};
48. 
49. 	outputFilename?: string;
50. 	cssOutputFilename?: string;
51. 
52. 	dev?: boolean;
53. 	shared?: boolean | string;
54. 	cascade?: boolean;
55. 	hydratable?: boolean;
56. 	legacy?: boolean;
57. 	customElement?: CustomElementOptions | true;
58. 	css?: boolean;
59. 
60. 	onerror?: (error: Error) => void;
61. 	onwarn?: (warning: Warning) => void;
62. }
63. 
64. export interface GenerateOptions {
65. 	name: string;
66. 	format: ModuleFormat;
67. 	banner?: string;
68. 	sharedPath?: string | boolean;
69. 	helpers?: { name: string, alias: string }[];
70. }
71. 
72. export interface Visitor {
73. 	enter: (node: Node) => void;
74. 	leave?: (node: Node) => void;
75. }
76. 
77. export interface CustomElementOptions {
78. 	tag?: string;
79. 	props?: string[];
80. }


File: src/utils/getObject.ts
Line number range: 1 - 6
Content:
1. import { Node } from '../interfaces';
2. 
3. export default function getObject(node: Node) {
4. 	while (node.type === 'MemberExpression') node = node.object;
5. 	return node;
6. }


File: src/utils/stringify.ts
Line number range: 1 - 9
Content:
1. export function stringify(data: string, options = {}) {
2. 	return JSON.stringify(escape(data, options));
3. }
4. 
5. export function escape(data: string, { onlyEscapeAtSymbol = false } = {}) {
6. 	return data.replace(onlyEscapeAtSymbol ? /(%+|@+)/g : /(%+|@+|#+)/g, (match: string) => {
7. 		return match + match[0];
8. 	});
9. }


File: src/validate/js/index.ts
Line number range: 1 - 93
Content:
1. import propValidators from './propValidators/index';
2. import fuzzymatch from '../utils/fuzzymatch';
3. import checkForDupes from './utils/checkForDupes';
4. import checkForComputedKeys from './utils/checkForComputedKeys';
5. import namespaces from '../../utils/namespaces';
6. import { Validator } from '../';
7. import { Node } from '../../interfaces';
8. 
9. const validPropList = Object.keys(propValidators);
10. 
11. export default function validateJs(validator: Validator, js: Node) {
12. 	js.content.body.forEach((node: Node) => {
13. 		// check there are no named exports
14. 		if (node.type === 'ExportNamedDeclaration') {
15. 			validator.error(`A component can only have a default export`, node.start);
16. 		}
17. 
18. 		if (node.type === 'ExportDefaultDeclaration') {
19. 			if (node.declaration.type !== 'ObjectExpression') {
20. 				return validator.error(
21. 					`Default export must be an object literal`,
22. 					node.declaration.start
23. 				);
24. 			}
25. 
26. 			checkForComputedKeys(validator, node.declaration.properties);
27. 			checkForDupes(validator, node.declaration.properties);
28. 
29. 			const props = validator.properties;
30. 
31. 			node.declaration.properties.forEach((prop: Node) => {
32. 				props.set(prop.key.name, prop);
33. 			});
34. 
35. 			// Remove these checks in version 2
36. 			if (props.has('oncreate') && props.has('onrender')) {
37. 				validator.error(
38. 					'Cannot have both oncreate and onrender',
39. 					props.get('onrender').start
40. 				);
41. 			}
42. 
43. 			if (props.has('ondestroy') && props.has('onteardown')) {
44. 				validator.error(
45. 					'Cannot have both ondestroy and onteardown',
46. 					props.get('onteardown').start
47. 				);
48. 			}
49. 
50. 			// ensure all exported props are valid
51. 			node.declaration.properties.forEach((prop: Node) => {
52. 				const propValidator = propValidators[prop.key.name];
53. 
54. 				if (propValidator) {
55. 					propValidator(validator, prop);
56. 				} else {
57. 					const match = fuzzymatch(prop.key.name, validPropList);
58. 					if (match) {
59. 						validator.error(
60. 							`Unexpected property '${prop.key.name}' (did you mean '${match}'?)`,
61. 							prop.start
62. 						);
63. 					} else if (/FunctionExpression/.test(prop.value.type)) {
64. 						validator.error(
65. 							`Unexpected property '${prop.key.name}' (did you mean to include it in 'methods'?)`,
66. 							prop.start
67. 						);
68. 					} else {
69. 						validator.error(
70. 							`Unexpected property '${prop.key.name}'`,
71. 							prop.start
72. 						);
73. 					}
74. 				}
75. 			});
76. 
77. 			if (props.has('namespace')) {
78. 				const ns = props.get('namespace').value.value;
79. 				validator.namespace = namespaces[ns] || ns;
80. 			}
81. 
82. 			validator.defaultExport = node;
83. 		}
84. 	});
85. 
86. 	['components', 'methods', 'helpers', 'transitions'].forEach(key => {
87. 		if (validator.properties.has(key)) {
88. 			validator.properties.get(key).value.properties.forEach((prop: Node) => {
89. 				validator[key].set(prop.key.name, prop.value);
90. 			});
91. 		}
92. 	});
93. }


File: src/validate/js/propValidators/oncreate.ts
Line number range: 1 - 14
Content:
1. import usesThisOrArguments from '../utils/usesThisOrArguments';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function oncreate(validator: Validator, prop: Node) {
6. 	if (prop.value.type === 'ArrowFunctionExpression') {
7. 		if (usesThisOrArguments(prop.value.body)) {
8. 			validator.error(
9. 				`'oncreate' should be a function expression, not an arrow function expression`,
10. 				prop.start
11. 			);
12. 		}
13. 	}
14. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-11 00:43:28,809 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis: The user asks for full contents of src/utils/stringify.ts; this file provides stringify and escape utilities used during code generation (e.g., escaping @/% markers) which is relevant to how code is emitted.\n2. Extended relevance: It includes functions that handle string escaping which could affect emitted lifecycle-related code blocks or styles; includes imports implicitly via usage.', relative_path='src/utils/stringify.ts', start_line=1, end_line=9), ContextOutput(reasoning='1. Query requirement analysis: The user requests the full contents of src/validate/js/propValidators/oncreate.ts; this file validates the oncreate lifecycle property.\n2. Extended relevance: It ensures oncreate is not an arrow function when using this/arguments, directly affecting lifecycle method validation and potential async modifier handling.', relative_path='src/validate/js/propValidators/oncreate.ts', start_line=1, end_line=14), ContextOutput(reasoning='1. Query requirement analysis: The user requests full contents of src/validate/js/index.ts; this file orchestrates JavaScript validation, including lifecycle properties.\n2. Extended relevance: It checks for conflicts between oncreate/onrender and ondestroy/onteardown, runs prop validators, and records default export, which is essential for understanding lifecycle parsing and validation.', relative_path='src/validate/js/index.ts', start_line=1, end_line=93), ContextOutput(reasoning='1. Query requirement analysis: The user requests full contents of src/utils/getObject.ts; this utility walks MemberExpression chains to return the root object.\n2. Extended relevance: This is useful when analyzing AST nodes during validation/transformation of lifecycle methods.', relative_path='src/utils/getObject.ts', start_line=1, end_line=6), ContextOutput(reasoning='1. Query requirement analysis: The user requests full contents of src/generators/dom/preprocess.ts; this file preprocesses DOM nodes prior to generation.\n2. Extended relevance: It marks intro/outro transitions and computes block dependencies, affecting lifecycle behavior (e.g., transitions interacting with creation/mounting); includes helper functions used by generator.', relative_path='src/generators/dom/preprocess.ts', start_line=1, end_line=545), ContextOutput(reasoning='1. Query requirement analysis: The user requests full contents of src/generators/dom/index.ts; this is the primary DOM code generator where lifecycle methods are emitted.\n2. Extended relevance: It binds and schedules oncreate handlers, assigns ondestroy handlers, calls beforecreate/oncreate/aftercreate sequences, and sets prototype methods including teardown/destroy. It also handles shared helpers import and escaping stringification via stringify().', relative_path='src/generators/dom/index.ts', start_line=1, end_line=437), ContextOutput(reasoning='1. Query requirement analysis: The user requests full contents of src/generators/shared/utils/wrapModule.ts; this wraps generated code into various module formats.\n2. Extended relevance: It includes import/require handling for shared helpers and emits the final code structure, relevant to how lifecycle method code is output and preserved in different formats.', relative_path='src/generators/shared/utils/wrapModule.ts', start_line=1, end_line=298), ContextOutput(reasoning='1. Query requirement analysis: The user requests full contents of src/index.ts; this file ties together parse, validate, and generate phases.\n2. Extended relevance: It shows the pipeline in which lifecycle methods are parsed and validated before being generated, necessary for understanding where async modifiers might be altered.', relative_path='src/index.ts', start_line=1, end_line=78), ContextOutput(reasoning='1. Query requirement analysis: The user requests full contents of src/interfaces.ts; this defines core interfaces used across parsing/validation/generation.\n2. Extended relevance: It defines Node, CompileOptions, and related types that underpin lifecycle handling and code emission.', relative_path='src/interfaces.ts', start_line=1, end_line=80)]
2025-11-11 00:43:28,816 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 9 contexts to memory for query: Please provide the full contents of the following files: src/utils/stringify.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/index.ts, src/utils/getObject.ts, src/generators/dom/preprocess.ts, src/generators/dom/index.ts, src/generators/shared/utils/wrapModule.ts, src/index.ts, and src/interfaces.ts.
2025-11-11 00:43:32,886 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-11 00:43:32,887 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 9 new contexts to 0 existing contexts
2025-11-11 00:43:32,887 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 9 total contexts (removed 0 duplicates)
2025-11-11 00:43:32,889 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of the following files: src/utils/stringify.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/index.ts, src/utils/getObject.ts, src/generators/dom/preprocess.ts, src/generators/dom/index.ts, src/generators/shared/utils/wrapModule.ts, src/index.ts, and src/interfaces.ts.
Extra Requirements: If some files are large, include at least the parts that handle lifecycle methods (oncreate/onrender/ondestroy/onteardown) and any code that prints or stringifies function/method AST nodes, with their imports.
Purpose: These files will reveal where lifecycle methods are parsed, validated, transformed, and emitted so we can locate why the async modifier is being removed and how to preserve it.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: src/generators/dom/index.ts
Line number range: 1 - 437
Content:
1. import MagicString from 'magic-string';
2. import { parseExpressionAt } from 'acorn';
3. import annotateWithScopes from '../../utils/annotateWithScopes';
4. import isReference from '../../utils/isReference';
5. import { walk } from 'estree-walker';
6. import deindent from '../../utils/deindent';
7. import { stringify, escape } from '../../utils/stringify';
8. import CodeBuilder from '../../utils/CodeBuilder';
9. import reservedNames from '../../utils/reservedNames';
10. import visit from './visit';
11. import shared from './shared';
12. import Generator from '../Generator';
13. import Stylesheet from '../../css/Stylesheet';
14. import preprocess from './preprocess';
15. import Block from './Block';
16. import { version } from '../../../package.json';
17. import { Parsed, CompileOptions, Node } from '../../interfaces';
18. 
19. const test = typeof global !== 'undefined' && global.__svelte_test;
20. 
21. export class DomGenerator extends Generator {
22. 	blocks: (Block|string)[];
23. 	readonly: Set<string>;
24. 	metaBindings: string[];
25. 
26. 	hydratable: boolean;
27. 	legacy: boolean;
28. 
29. 	hasIntroTransitions: boolean;
30. 	hasOutroTransitions: boolean;
31. 	hasComplexBindings: boolean;
32. 
33. 	needsEncapsulateHelper: boolean;
34. 
35. 	constructor(
36. 		parsed: Parsed,
37. 		source: string,
38. 		name: string,
39. 		stylesheet: Stylesheet,
40. 		options: CompileOptions
41. 	) {
42. 		super(parsed, source, name, stylesheet, options, true);
43. 		this.blocks = [];
44. 
45. 		this.readonly = new Set();
46. 
47. 		this.hydratable = options.hydratable;
48. 		this.legacy = options.legacy;
49. 		this.needsEncapsulateHelper = false;
50. 
51. 		// initial values for e.g. window.innerWidth, if there's a <:Window> meta tag
52. 		this.metaBindings = [];
53. 	}
54. 
55. 	getUniqueNameMaker(params: string[]) {
56. 		const localUsedNames = new Set(params);
57. 
58. 		function add(name: string) {
59. 			localUsedNames.add(name);
60. 		}
61. 
62. 		reservedNames.forEach(add);
63. 		this.userVars.forEach(add);
64. 		for (const name in shared) {
65. 			localUsedNames.add(test ? `${name}$` : name);
66. 		}
67. 
68. 		return (name: string) => {
69. 			if (test) name = `${name}$`;
70. 			let alias = name;
71. 			for (
72. 				let i = 1;
73. 				this.usedNames.has(alias) ||
74. 				localUsedNames.has(alias);
75. 				alias = `${name}_${i++}`
76. 			);
77. 			localUsedNames.add(alias);
78. 			return alias;
79. 		};
80. 	}
81. }
82. 
83. export default function dom(
84. 	parsed: Parsed,
85. 	source: string,
86. 	stylesheet: Stylesheet,
87. 	options: CompileOptions
88. ) {
89. 	const format = options.format || 'es';
90. 
91. 	const generator = new DomGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
92. 
93. 	const {
94. 		computations,
95. 		name,
96. 		templateProperties,
97. 		namespace,
98. 	} = generator;
99. 
100. 	const { block, state } = preprocess(generator, namespace, parsed.html);
101. 
102. 	generator.stylesheet.warnOnUnusedSelectors(options.onwarn);
103. 
104. 	parsed.html.children.forEach((node: Node) => {
105. 		visit(generator, block, state, node, [], []);
106. 	});
107. 
108. 	const builder = new CodeBuilder();
109. 	const computationBuilder = new CodeBuilder();
110. 	const computationDeps = new Set();
111. 
112. 	if (computations.length) {
113. 		computations.forEach(({ key, deps }) => {
114. 			deps.forEach(dep => {
115. 				computationDeps.add(dep);
116. 			});
117. 
118. 			if (generator.readonly.has(key)) {
119. 				// <:Window> bindings
120. 				throw new Error(
121. 					`Cannot have a computed value '${key}' that clashes with a read-only property`
122. 				);
123. 			}
124. 
125. 			generator.readonly.add(key);
126. 
127. 			const condition = `${deps.map(dep => `changed.${dep}`).join(' || ')}`;
128. 
129. 			const statement = `if (@differs(state.${key}, (state.${key} = %computed-${key}(${deps
130. 				.map(dep => `state.${dep}`)
131. 				.join(', ')})))) changed.${key} = true;`;
132. 
133. 			computationBuilder.addConditional(condition, statement);
134. 		});
135. 	}
136. 
137. 	if (generator.javascript) {
138. 		builder.addBlock(generator.javascript);
139. 	}
140. 
141. 	if (generator.needsEncapsulateHelper) {
142. 		builder.addBlock(deindent`
143. 			function @encapsulateStyles(node) {
144. 				@setAttribute(node, "${generator.stylesheet.id}", "");
145. 			}
146. 		`);
147. 	}
148. 
149. 	const { css, cssMap } = generator.stylesheet.render(options.filename, !generator.customElement);
150. 	const styles = generator.stylesheet.hasStyles && stringify(options.dev ?
151. 		`${css}\n/*# sourceMappingURL=${cssMap.toUrl()} */` :
152. 		css, { onlyEscapeAtSymbol: true });
153. 
154. 	if (styles && generator.options.css !== false && !generator.customElement) {
155. 		builder.addBlock(deindent`
156. 			function @add_css() {
157. 				var style = @createElement("style");
158. 				style.id = '${generator.stylesheet.id}-style';
159. 				style.textContent = ${styles};
160. 				@appendNode(style, document.head);
161. 			}
162. 		`);
163. 	}
164. 
165. 	generator.blocks.forEach(block => {
166. 		builder.addBlock(block.toString());
167. 	});
168. 
169. 	const sharedPath = options.shared === true
170. 		? 'svelte/shared.js'
171. 		: options.shared;
172. 
173. 	const prototypeBase =
174. 		`${name}.prototype` +
175. 		(templateProperties.methods ? `, %methods` : '');
176. 	const proto = sharedPath
177. 		? `@proto`
178. 		: deindent`
179. 		{
180. 			${['destroy', 'get', 'fire', 'observe', 'on', 'set', 'teardown', '_set', '_mount', '_unmount']
181. 				.map(n => `${n}: @${n === 'teardown' ? 'destroy' : n}`)
182. 				.join(',\n')}
183. 		}`;
184. 
185. 	const debugName = `<${generator.customElement ? generator.tag : name}>`;
186. 
187. 	const constructorBody = deindent`
188. 		${options.dev && `this._debugName = '${debugName}';`}
189. 		${options.dev && !generator.customElement &&
190. 			`if (!options || (!options.target && !options._root)) throw new Error("'target' is a required option");`}
191. 		@init(this, options);
192. 		${generator.usesRefs && `this.refs = {};`}
193. 		this._state = @assign(${templateProperties.data ? '%data()' : '{}'}, options.data);
194. 		${generator.metaBindings}
195. 		${computations.length && `this._recompute({ ${Array.from(computationDeps).map(dep => `${dep}: 1`).join(', ')} }, this._state);`}
196. 		${options.dev &&
197. 			Array.from(generator.expectedProperties).map(
198. 				prop =>
199. 					`if (!('${prop}' in this._state)) console.warn("${debugName} was created without expected data property '${prop}'");`
200. 			)}
201. 		${generator.bindingGroups.length &&
202. 			`this._bindingGroups = [${Array(generator.bindingGroups.length).fill('[]').join(', ')}];`}
203. 
204. 		${templateProperties.ondestroy && `this._handlers.destroy = [%ondestroy]`}
205. 
206. 		${generator.slots.size && `this._slotted = options.slots || {};`}
207. 
208. 		${generator.customElement ?
209. 			deindent`
210. 				this.attachShadow({ mode: 'open' });
211. 				${css && `this.shadowRoot.innerHTML = \`<style>${escape(css, { onlyEscapeAtSymbol: true }).replace(/\\/g, '\\\\')}${options.dev ? `\n/*# sourceMappingURL=${cssMap.toUrl()} */` : ''}</style>\`;`}
212. 			` :
213. 			(generator.stylesheet.hasStyles && options.css !== false &&
214. 			`if (!document.getElementById("${generator.stylesheet.id}-style")) @add_css();`)
215. 		}
216. 
217. 		${templateProperties.oncreate && `var _oncreate = %oncreate.bind(this);`}
218. 
219. 		${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`
220. 			if (!options._root) {
221. 				this._oncreate = [${templateProperties.oncreate && `_oncreate`}];
222. 				${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}
223. 				${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}
224. 			} ${templateProperties.oncreate && deindent`
225. 				else {
226. 					this._root._oncreate.push(_oncreate);
227. 				}
228. 			`}
229. 		`}
230. 
231. 		${generator.slots.size && `this.slots = {};`}
232. 
233. 		this._fragment = @create_main_fragment(this._state, this);
234. 
235. 		${generator.customElement ? deindent`
236. 			this._fragment.c();
237. 			this._fragment.${block.hasIntroMethod ? 'i' : 'm'}(this.shadowRoot, null);
238. 
239. 			if (options.target) this._mount(options.target, options.anchor || null);
240. 		` : deindent`
241. 			if (options.target) {
242. 				${generator.hydratable
243. 					? deindent`
244. 						var nodes = @children(options.target);
245. 						options.hydrate ? this._fragment.l(nodes) : this._fragment.c();
246. 						nodes.forEach(@detachNode);
247. 					` :
248. 					deindent`
249. 						${options.dev && `if (options.hydrate) throw new Error("options.hydrate only works if the component was compiled with the \`hydratable: true\` option");`}
250. 						this._fragment.c();
251. 					`}
252. 				this._fragment.${block.hasIntroMethod ? 'i' : 'm'}(options.target, options.anchor || null);
253. 
254. 				${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`
255. 					${generator.hasComponents && `this._lock = true;`}
256. 					${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}
257. 					${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}
258. 					${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}
259. 					${generator.hasComponents && `this._lock = false;`}
260. 				`}
261. 			}
262. 		`}
263. 	`;
264. 
265. 	if (generator.customElement) {
266. 		const props = generator.props || Array.from(generator.expectedProperties);
267. 
268. 		builder.addBlock(deindent`
269. 			class ${name} extends HTMLElement {
270. 				constructor(options = {}) {
271. 					super();
272. 					${constructorBody}
273. 				}
274. 
275. 				static get observedAttributes() {
276. 					return ${JSON.stringify(props)};
277. 				}
278. 
279. 				${props.map(prop => deindent`
280. 					get ${prop}() {
281. 						return this.get('${prop}');
282. 					}
283. 
284. 					set ${prop}(value) {
285. 						this.set({ ${prop}: value });
286. 					}
287. 				`).join('\n\n')}
288. 
289. 				${generator.slots.size && deindent`
290. 					connectedCallback() {
291. 						Object.keys(this._slotted).forEach(key => {
292. 							this.appendChild(this._slotted[key]);
293. 						});
294. 					}`}
295. 
296. 				attributeChangedCallback(attr, oldValue, newValue) {
297. 					this.set({ [attr]: newValue });
298. 				}
299. 			}
300. 
301. 			customElements.define("${generator.tag}", ${name});
302. 			@assign(${prototypeBase}, ${proto}, {
303. 				_mount(target, anchor) {
304. 					target.insertBefore(this, anchor);
305. 				},
306. 
307. 				_unmount() {
308. 					this.parentNode.removeChild(this);
309. 				}
310. 			});
311. 		`);
312. 	} else {
313. 		builder.addBlock(deindent`
314. 			function ${name}(options) {
315. 				${constructorBody}
316. 			}
317. 
318. 			@assign(${prototypeBase}, ${proto});
319. 		`);
320. 	}
321. 
322. 	builder.addBlock(deindent`
323. 		${options.dev && deindent`
324. 			${name}.prototype._checkReadOnly = function _checkReadOnly(newState) {
325. 				${Array.from(generator.readonly).map(
326. 					prop =>
327. 						`if ('${prop}' in newState && !this._updatingReadonlyProperty) throw new Error("${debugName}: Cannot set read-only property '${prop}'");`
328. 				)}
329. 			};
330. 		`}
331. 
332. 		${computations.length ? deindent`
333. 			${name}.prototype._recompute = function _recompute(changed, state) {
334. 				${computationBuilder}
335. 			}
336. 		` : (!sharedPath && `${name}.prototype._recompute = @noop;`)}
337. 
338. 		${templateProperties.setup && `%setup(${name});`}
339. 	`);
340. 
341. 	const usedHelpers = new Set();
342. 
343. 	let result = builder
344. 		.toString()
345. 		.replace(/(%+|@+)(\w*(?:-\w*)?)/g, (match: string, sigil: string, name: string) => {
346. 			if (sigil === '@') {
347. 				if (name in shared) {
348. 					if (options.dev && `${name}Dev` in shared) name = `${name}Dev`;
349. 					usedHelpers.add(name);
350. 				}
351. 
352. 				return generator.alias(name);
353. 			}
354. 
355. 			if (sigil === '%') {
356. 				return generator.templateVars.get(name);
357. 			}
358. 
359. 			return sigil.slice(1) + name;
360. 		});
361. 
362. 	let helpers;
363. 
364. 	if (sharedPath) {
365. 		if (format !== 'es' && format !== 'cjs') {
366. 			throw new Error(`Components with shared helpers must be compiled with \`format: 'es'\` or \`format: 'cjs'\``);
367. 		}
368. 		const used = Array.from(usedHelpers).sort();
369. 		helpers = used.map(name => {
370. 			const alias = generator.alias(name);
371. 			return { name, alias };
372. 		});
373. 	} else {
374. 		let inlineHelpers = '';
375. 
376. 		usedHelpers.forEach(key => {
377. 			const str = shared[key];
378. 			const code = new MagicString(str);
379. 			const expression = parseExpressionAt(str, 0);
380. 
381. 			let scope = annotateWithScopes(expression);
382. 
383. 			walk(expression, {
384. 				enter(node: Node, parent: Node) {
385. 					if (node._scope) scope = node._scope;
386. 
387. 					if (
388. 						node.type === 'Identifier' &&
389. 						isReference(node, parent) &&
390. 						!scope.has(node.name)
391. 					) {
392. 						if (node.name in shared) {
393. 							// this helper function depends on another one
394. 							const dependency = node.name;
395. 							usedHelpers.add(dependency);
396. 
397. 							const alias = generator.alias(dependency);
398. 							if (alias !== node.name)
399. 								code.overwrite(node.start, node.end, alias);
400. 						}
401. 					}
402. 				},
403. 
404. 				leave(node: Node) {
405. 					if (node._scope) scope = scope.parent;
406. 				},
407. 			});
408. 
409. 			if (key === 'transitionManager') {
410. 				// special case
411. 				const global = `_svelteTransitionManager`;
412. 
413. 				inlineHelpers += `\n\nvar ${generator.alias('transitionManager')} = window.${global} || (window.${global} = ${code});\n\n`;
414. 			} else {
415. 				const alias = generator.alias(expression.id.name);
416. 				if (alias !== expression.id.name)
417. 					code.overwrite(expression.id.start, expression.id.end, alias);
418. 
419. 				inlineHelpers += `\n\n${code}`;
420. 			}
421. 		});
422. 
423. 		result += inlineHelpers;
424. 	}
425. 
426. 	const filename = options.filename && (
427. 		typeof process !== 'undefined' ? options.filename.replace(process.cwd(), '').replace(/^[\/\\]/, '') : options.filename
428. 	);
429. 
430. 	return generator.generate(result, options, {
431. 		banner: `/* ${filename ? `${filename} ` : ``}generated by Svelte v${version} */`,
432. 		sharedPath,
433. 		helpers,
434. 		name,
435. 		format,
436. 	});
437. }


File: src/generators/dom/preprocess.ts
Line number range: 1 - 545
Content:
1. import Block from './Block';
2. import { trimStart, trimEnd } from '../../utils/trim';
3. import { assign } from '../../shared/index.js';
4. import getStaticAttributeValue from '../../utils/getStaticAttributeValue';
5. import isChildOfComponent from '../shared/utils/isChildOfComponent';
6. import { DomGenerator } from './index';
7. import { Node } from '../../interfaces';
8. import { State } from './interfaces';
9. 
10. function isElseIf(node: Node) {
11. 	return (
12. 		node && node.children.length === 1 && node.children[0].type === 'IfBlock'
13. 	);
14. }
15. 
16. function getChildState(parent: State, child = {}) {
17. 	return assign(
18. 		{},
19. 		parent,
20. 		{ parentNode: null, parentNodes: 'nodes' },
21. 		child || {}
22. 	);
23. }
24. 
25. function createDebuggingComment(node: Node, generator: DomGenerator) {
26. 	const { locate, source } = generator;
27. 
28. 	let c = node.start;
29. 	if (node.type === 'ElseBlock') {
30. 		while (source[c] !== '{') c -= 1;
31. 		c -= 1;
32. 	}
33. 
34. 	let d = node.expression ? node.expression.end : c;
35. 	while (source[d] !== '}') d += 1;
36. 	d += 2;
37. 
38. 	const start = locate(c);
39. 	const loc = `(${start.line + 1}:${start.column})`;
40. 
41. 	return `${loc} ${source.slice(c, d)}`.replace(/\n/g, ' ');
42. }
43. 
44. function cannotUseInnerHTML(node: Node) {
45. 	while (node && node.canUseInnerHTML) {
46. 		node.canUseInnerHTML = false;
47. 		node = node.parent;
48. 	}
49. }
50. 
51. // Whitespace inside one of these elements will not result in
52. // a whitespace node being created in any circumstances. (This
53. // list is almost certainly very incomplete)
54. const elementsWithoutText = new Set([
55. 	'audio',
56. 	'datalist',
57. 	'dl',
58. 	'ol',
59. 	'optgroup',
60. 	'select',
61. 	'ul',
62. 	'video',
63. ]);
64. 
65. const preprocessors = {
66. 	MustacheTag: (
67. 		generator: DomGenerator,
68. 		block: Block,
69. 		state: State,
70. 		node: Node,
71. 		elementStack: Node[],
72. 		componentStack: Node[],
73. 		stripWhitespace: boolean
74. 	) => {
75. 		cannotUseInnerHTML(node);
76. 		node.var = block.getUniqueName('text');
77. 
78. 		const dependencies = block.findDependencies(node.expression);
79. 		block.addDependencies(dependencies);
80. 	},
81. 
82. 	RawMustacheTag: (
83. 		generator: DomGenerator,
84. 		block: Block,
85. 		state: State,
86. 		node: Node,
87. 		elementStack: Node[],
88. 		componentStack: Node[],
89. 		stripWhitespace: boolean
90. 	) => {
91. 		cannotUseInnerHTML(node);
92. 		node.var = block.getUniqueName('raw');
93. 
94. 		const dependencies = block.findDependencies(node.expression);
95. 		block.addDependencies(dependencies);
96. 	},
97. 
98. 	Text: (
99. 		generator: DomGenerator,
100. 		block: Block,
101. 		state: State,
102. 		node: Node,
103. 		elementStack: Node[],
104. 		componentStack: Node[],
105. 		stripWhitespace: boolean
106. 	) => {
107. 		if (!/\S/.test(node.data) && (state.namespace || elementsWithoutText.has(state.parentNodeName))) {
108. 			node.shouldSkip = true;
109. 			return;
110. 		}
111. 
112. 		node.var = block.getUniqueName(`text`);
113. 	},
114. 
115. 	IfBlock: (
116. 		generator: DomGenerator,
117. 		block: Block,
118. 		state: State,
119. 		node: Node,
120. 		inEachBlock: boolean,
121. 		elementStack: Node[],
122. 		componentStack: Node[],
123. 		stripWhitespace: boolean,
124. 		nextSibling: Node
125. 	) => {
126. 		cannotUseInnerHTML(node);
127. 
128. 		const blocks: Block[] = [];
129. 		let dynamic = false;
130. 		let hasIntros = false;
131. 		let hasOutros = false;
132. 
133. 		function attachBlocks(node: Node) {
134. 			node.var = block.getUniqueName(`if_block`);
135. 
136. 			const dependencies = block.findDependencies(node.expression);
137. 			block.addDependencies(dependencies);
138. 
139. 			node._block = block.child({
140. 				comment: createDebuggingComment(node, generator),
141. 				name: generator.getUniqueName(`create_if_block`),
142. 			});
143. 
144. 			node._state = getChildState(state);
145. 
146. 			blocks.push(node._block);
147. 			preprocessChildren(generator, node._block, node._state, node, inEachBlock, elementStack, componentStack, stripWhitespace, nextSibling);
148. 
149. 			if (node._block.dependencies.size > 0) {
150. 				dynamic = true;
151. 				block.addDependencies(node._block.dependencies);
152. 			}
153. 
154. 			if (node._block.hasIntroMethod) hasIntros = true;
155. 			if (node._block.hasOutroMethod) hasOutros = true;
156. 
157. 			if (isElseIf(node.else)) {
158. 				attachBlocks(node.else.children[0]);
159. 			} else if (node.else) {
160. 				node.else._block = block.child({
161. 					comment: createDebuggingComment(node.else, generator),
162. 					name: generator.getUniqueName(`create_if_block`),
163. 				});
164. 
165. 				node.else._state = getChildState(state);
166. 
167. 				blocks.push(node.else._block);
168. 				preprocessChildren(
169. 					generator,
170. 					node.else._block,
171. 					node.else._state,
172. 					node.else,
173. 					inEachBlock,
174. 					elementStack,
175. 					componentStack,
176. 					stripWhitespace,
177. 					nextSibling
178. 				);
179. 
180. 				if (node.else._block.dependencies.size > 0) {
181. 					dynamic = true;
182. 					block.addDependencies(node.else._block.dependencies);
183. 				}
184. 			}
185. 		}
186. 
187. 		attachBlocks(node);
188. 
189. 		blocks.forEach(block => {
190. 			block.hasUpdateMethod = dynamic;
191. 			block.hasIntroMethod = hasIntros;
192. 			block.hasOutroMethod = hasOutros;
193. 		});
194. 
195. 		generator.blocks.push(...blocks);
196. 	},
197. 
198. 	EachBlock: (
199. 		generator: DomGenerator,
200. 		block: Block,
201. 		state: State,
202. 		node: Node,
203. 		inEachBlock: boolean,
204. 		elementStack: Node[],
205. 		componentStack: Node[],
206. 		stripWhitespace: boolean,
207. 		nextSibling: Node
208. 	) => {
209. 		cannotUseInnerHTML(node);
210. 		node.var = block.getUniqueName(`each`);
211. 
212. 		const dependencies = block.findDependencies(node.expression);
213. 		block.addDependencies(dependencies);
214. 
215. 		const indexNames = new Map(block.indexNames);
216. 		const indexName =
217. 			node.index || block.getUniqueName(`${node.context}_index`);
218. 		indexNames.set(node.context, indexName);
219. 
220. 		const listNames = new Map(block.listNames);
221. 		const listName = block.getUniqueName(
222. 			(node.expression.type === 'MemberExpression' && !node.expression.computed) ? node.expression.property.name :
223. 			node.expression.type === 'Identifier' ? node.expression.name :
224. 			`each_value`
225. 		);
226. 		listNames.set(node.context, listName);
227. 
228. 		const context = generator.getUniqueName(node.context);
229. 		const contexts = new Map(block.contexts);
230. 		contexts.set(node.context, context);
231. 
232. 		const indexes = new Map(block.indexes);
233. 		if (node.index) indexes.set(node.index, node.context);
234. 
235. 		const changeableIndexes = new Map(block.changeableIndexes);
236. 		if (node.index) changeableIndexes.set(node.index, node.key);
237. 
238. 		const contextDependencies = new Map(block.contextDependencies);
239. 		contextDependencies.set(node.context, dependencies);
240. 
241. 		if (node.destructuredContexts) {
242. 			for (const i = 0; i < node.destructuredContexts.length; i++) {
243. 				contexts.set(node.destructuredContexts[i], `${context}[${i}]`);
244. 				contextDependencies.set(node.destructuredContexts[i], dependencies);
245. 			}
246. 		}
247. 
248. 		node._block = block.child({
249. 			comment: createDebuggingComment(node, generator),
250. 			name: generator.getUniqueName('create_each_block'),
251. 			expression: node.expression,
252. 			context: node.context,
253. 			key: node.key,
254. 
255. 			contextDependencies,
256. 			contexts,
257. 			indexes,
258. 			changeableIndexes,
259. 
260. 			listName,
261. 			indexName,
262. 
263. 			indexNames,
264. 			listNames,
265. 			params: block.params.concat(listName, context, indexName),
266. 		});
267. 
268. 		node._state = getChildState(state, {
269. 			inEachBlock: true,
270. 		});
271. 
272. 		generator.blocks.push(node._block);
273. 		preprocessChildren(generator, node._block, node._state, node, true, elementStack, componentStack, stripWhitespace, nextSibling);
274. 		block.addDependencies(node._block.dependencies);
275. 		node._block.hasUpdateMethod = node._block.dependencies.size > 0;
276. 
277. 		if (node.else) {
278. 			node.else._block = block.child({
279. 				comment: createDebuggingComment(node.else, generator),
280. 				name: generator.getUniqueName(`${node._block.name}_else`),
281. 			});
282. 
283. 			node.else._state = getChildState(state);
284. 
285. 			generator.blocks.push(node.else._block);
286. 			preprocessChildren(
287. 				generator,
288. 				node.else._block,
289. 				node.else._state,
290. 				node.else,
291. 				inEachBlock,
292. 				elementStack,
293. 				componentStack,
294. 				stripWhitespace,
295. 				nextSibling
296. 			);
297. 			node.else._block.hasUpdateMethod = node.else._block.dependencies.size > 0;
298. 		}
299. 	},
300. 
301. 	Element: (
302. 		generator: DomGenerator,
303. 		block: Block,
304. 		state: State,
305. 		node: Node,
306. 		inEachBlock: boolean,
307. 		elementStack: Node[],
308. 		componentStack: Node[],
309. 		stripWhitespace: boolean,
310. 		nextSibling: Node
311. 	) => {
312. 		if (node.name === 'slot') {
313. 			cannotUseInnerHTML(node);
314. 		}
315. 
316. 		node.attributes.forEach((attribute: Node) => {
317. 			if (attribute.type === 'Attribute' && attribute.value !== true) {
318. 				attribute.value.forEach((chunk: Node) => {
319. 					if (chunk.type !== 'Text') {
320. 						if (node.parent) cannotUseInnerHTML(node.parent);
321. 
322. 						const dependencies = block.findDependencies(chunk.expression);
323. 						block.addDependencies(dependencies);
324. 
325. 						// special case — <option value='{{foo}}'> — see below
326. 						if (
327. 							node.name === 'option' &&
328. 							attribute.name === 'value' &&
329. 							state.selectBindingDependencies
330. 						) {
331. 							state.selectBindingDependencies.forEach(prop => {
332. 								dependencies.forEach((dependency: string) => {
333. 									generator.indirectDependencies.get(prop).add(dependency);
334. 								});
335. 							});
336. 						}
337. 					}
338. 				});
339. 			} else {
340. 				if (node.parent) cannotUseInnerHTML(node.parent);
341. 
342. 				if (attribute.type === 'EventHandler' && attribute.expression) {
343. 					attribute.expression.arguments.forEach((arg: Node) => {
344. 						const dependencies = block.findDependencies(arg);
345. 						block.addDependencies(dependencies);
346. 					});
347. 				} else if (attribute.type === 'Binding') {
348. 					const dependencies = block.findDependencies(attribute.value);
349. 					block.addDependencies(dependencies);
350. 				} else if (attribute.type === 'Transition') {
351. 					if (attribute.intro)
352. 						generator.hasIntroTransitions = block.hasIntroMethod = true;
353. 					if (attribute.outro) {
354. 						generator.hasOutroTransitions = block.hasOutroMethod = true;
355. 						block.outros += 1;
356. 					}
357. 				}
358. 			}
359. 		});
360. 
361. 		// special case — in a case like this...
362. 		//
363. 		//   <select bind:value='foo'>
364. 		//     <option value='{{bar}}'>bar</option>
365. 		//     <option value='{{baz}}'>baz</option>
366. 		//   </option>
367. 		//
368. 		// ...we need to know that `foo` depends on `bar` and `baz`,
369. 		// so that if `foo.qux` changes, we know that we need to
370. 		// mark `bar` and `baz` as dirty too
371. 		if (node.name === 'select') {
372. 			cannotUseInnerHTML(node);
373. 
374. 			const value = node.attributes.find(
375. 				(attribute: Node) => attribute.name === 'value'
376. 			);
377. 			if (value) {
378. 				// TODO does this also apply to e.g. `<input type='checkbox' bind:group='foo'>`?
379. 				const dependencies = block.findDependencies(value.value);
380. 				state.selectBindingDependencies = dependencies;
381. 				dependencies.forEach((prop: string) => {
382. 					generator.indirectDependencies.set(prop, new Set());
383. 				});
384. 			} else {
385. 				state.selectBindingDependencies = null;
386. 			}
387. 		}
388. 
389. 		const isComponent =
390. 			generator.components.has(node.name) || node.name === ':Self';
391. 
392. 		if (isComponent) {
393. 			cannotUseInnerHTML(node);
394. 
395. 			node.var = block.getUniqueName(
396. 				(node.name === ':Self' ? generator.name : node.name).toLowerCase()
397. 			);
398. 
399. 			node._state = getChildState(state, {
400. 				parentNode: `${node.var}._slotted.default`
401. 			});
402. 		} else {
403. 			const slot = getStaticAttributeValue(node, 'slot');
404. 			if (slot && isChildOfComponent(node, generator)) {
405. 				cannotUseInnerHTML(node);
406. 				node.slotted = true;
407. 				// TODO validate slots — no nesting, no dynamic names...
408. 				const component = componentStack[componentStack.length - 1];
409. 				component._slots.add(slot);
410. 			}
411. 
412. 			node.var = block.getUniqueName(
413. 				node.name.replace(/[^a-zA-Z0-9_$]/g, '_')
414. 			);
415. 
416. 			node._state = getChildState(state, {
417. 				isTopLevel: false,
418. 				parentNode: node.var,
419. 				parentNodes: block.getUniqueName(`${node.var}_nodes`),
420. 				parentNodeName: node.name,
421. 				namespace: node.name === 'svg'
422. 					? 'http://www.w3.org/2000/svg'
423. 					: state.namespace,
424. 				allUsedContexts: [],
425. 			});
426. 
427. 			generator.stylesheet.apply(node, elementStack);
428. 		}
429. 
430. 		if (node.children.length) {
431. 			if (isComponent) {
432. 				if (node.children) node._slots = new Set(['default']);
433. 				preprocessChildren(generator, block, node._state, node, inEachBlock, elementStack, componentStack.concat(node), stripWhitespace, nextSibling);
434. 			} else {
435. 				if (node.name === 'pre' || node.name === 'textarea') stripWhitespace = false;
436. 				preprocessChildren(generator, block, node._state, node, inEachBlock, elementStack.concat(node), componentStack, stripWhitespace, nextSibling);
437. 			}
438. 		}
439. 	},
440. };
441. 
442. function preprocessChildren(
443. 	generator: DomGenerator,
444. 	block: Block,
445. 	state: State,
446. 	node: Node,
447. 	inEachBlock: boolean,
448. 	elementStack: Node[],
449. 	componentStack: Node[],
450. 	stripWhitespace: boolean,
451. 	nextSibling: Node
452. ) {
453. 	// glue text nodes together
454. 	const cleaned: Node[] = [];
455. 	let lastChild: Node;
456. 
457. 	node.children.forEach((child: Node) => {
458. 		if (child.type === 'Comment') return;
459. 
460. 		if (child.type === 'Text' && lastChild && lastChild.type === 'Text') {
461. 			lastChild.data += child.data;
462. 			lastChild.end = child.end;
463. 		} else {
464. 			if (child.type === 'Text' && stripWhitespace && cleaned.length === 0) {
465. 				child.data = trimStart(child.data);
466. 				if (child.data) cleaned.push(child);
467. 			} else {
468. 				cleaned.push(child);
469. 			}
470. 		}
471. 
472. 		lastChild = child;
473. 	});
474. 
475. 	lastChild = null;
476. 
477. 	cleaned.forEach((child: Node, i: number) => {
478. 		child.parent = node;
479. 		child.canUseInnerHTML = !generator.hydratable;
480. 
481. 		const preprocessor = preprocessors[child.type];
482. 		if (preprocessor) preprocessor(generator, block, state, child, inEachBlock, elementStack, componentStack, stripWhitespace, cleaned[i + 1] || nextSibling);
483. 
484. 		if (child.shouldSkip) return;
485. 
486. 		if (lastChild) lastChild.next = child;
487. 		child.prev = lastChild;
488. 
489. 		lastChild = child;
490. 	});
491. 
492. 	// We want to remove trailing whitespace inside an element/component/block,
493. 	// *unless* there is no whitespace between this node and its next sibling
494. 	if (stripWhitespace && lastChild && lastChild.type === 'Text') {
495. 		const shouldTrim = (
496. 			nextSibling ?  (nextSibling.type === 'Text' && /^\s/.test(nextSibling.data)) : !inEachBlock
497. 		);
498. 
499. 		if (shouldTrim) {
500. 			lastChild.data = trimEnd(lastChild.data);
501. 			if (!lastChild.data) {
502. 				cleaned.pop();
503. 				lastChild = cleaned[cleaned.length - 1];
504. 				lastChild.next = null;
505. 			}
506. 		}
507. 	}
508. 
509. 	node.children = cleaned;
510. }
511. 
512. export default function preprocess(
513. 	generator: DomGenerator,
514. 	namespace: string,
515. 	node: Node
516. ) {
517. 	const block = new Block({
518. 		generator,
519. 		name: '@create_main_fragment',
520. 		key: null,
521. 
522. 		contexts: new Map(),
523. 		indexes: new Map(),
524. 		changeableIndexes: new Map(),
525. 		contextDependencies: new Map(),
526. 
527. 		params: ['state'],
528. 		indexNames: new Map(),
529. 		listNames: new Map(),
530. 
531. 		dependencies: new Set(),
532. 	});
533. 
534. 	const state: State = {
535. 		namespace,
536. 		parentNode: null,
537. 		parentNodes: 'nodes'
538. 	};
539. 
540. 	generator.blocks.push(block);
541. 	preprocessChildren(generator, block, state, node, false, [], [], true, null);
542. 	block.hasUpdateMethod = true;
543. 
544. 	return { block, state };
545. }


File: src/generators/shared/utils/wrapModule.ts
Line number range: 1 - 298
Content:
1. import deindent from '../../../utils/deindent';
2. import { CompileOptions, ModuleFormat, Node } from '../../../interfaces';
3. 
4. interface Dependency {
5. 	name: string;
6. 	statements: string[];
7. 	source: string;
8. }
9. 
10. const wrappers = { es, amd, cjs, iife, umd, eval: expr };
11. 
12. export default function wrapModule(
13. 	code: string,
14. 	format: ModuleFormat,
15. 	name: string,
16. 	options: CompileOptions,
17. 	banner: string,
18. 	sharedPath: string,
19. 	helpers: { name: string, alias: string }[],
20. 	imports: Node[],
21. 	source: string
22. ): string {
23. 	if (format === 'es') return es(code, name, options, banner, sharedPath, helpers, imports, source);
24. 
25. 	const dependencies = imports.map((declaration, i) => {
26. 		const defaultImport = declaration.specifiers.find(
27. 			(x: Node) =>
28. 				x.type === 'ImportDefaultSpecifier' ||
29. 				(x.type === 'ImportSpecifier' && x.imported.name === 'default')
30. 		);
31. 
32. 		const namespaceImport = declaration.specifiers.find(
33. 			(x: Node) => x.type === 'ImportNamespaceSpecifier'
34. 		);
35. 
36. 		const namedImports = declaration.specifiers.filter(
37. 			(x: Node) =>
38. 				x.type === 'ImportSpecifier' && x.imported.name !== 'default'
39. 		);
40. 
41. 		const name = defaultImport || namespaceImport
42. 			? (defaultImport || namespaceImport).local.name
43. 			: `__import${i}`;
44. 
45. 		const statements: string[] = [];
46. 
47. 		namedImports.forEach((specifier: Node) => {
48. 			statements.push(
49. 				`var ${specifier.local.name} = ${name}.${specifier.imported.name};`
50. 			);
51. 		});
52. 
53. 		if (defaultImport) {
54. 			statements.push(
55. 				`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`
56. 			);
57. 		}
58. 
59. 		return { name, statements, source: declaration.source.value };
60. 	});
61. 
62. 	if (format === 'amd') return amd(code, name, options, banner, dependencies);
63. 	if (format === 'cjs') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);
64. 	if (format === 'iife') return iife(code, name, options, banner, dependencies);
65. 	if (format === 'umd') return umd(code, name, options, banner, dependencies);
66. 	if (format === 'eval') return expr(code, name, options, banner, dependencies);
67. 
68. 	throw new Error(`Not implemented: ${format}`);
69. }
70. 
71. function es(
72. 	code: string,
73. 	name: string,
74. 	options: CompileOptions,
75. 	banner: string,
76. 	sharedPath: string,
77. 	helpers: { name: string, alias: string }[],
78. 	imports: Node[],
79. 	source: string
80. ) {
81. 	const importHelpers = helpers && (
82. 		`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(', ')} } from ${JSON.stringify(sharedPath)};`
83. 	);
84. 
85. 	const importBlock = imports.length > 0 && (
86. 		imports
87. 			.map((declaration: Node) => source.slice(declaration.start, declaration.end))
88. 			.join('\n')
89. 	);
90. 
91. 	return deindent`
92. 		${banner}
93. 		${importHelpers}
94. 		${importBlock}
95. 
96. 		${code}
97. 		export default ${name};`;
98. }
99. 
100. function amd(
101. 	code: string,
102. 	name: string,
103. 	options: CompileOptions,
104. 	banner: string,
105. 	dependencies: Dependency[]
106. ) {
107. 	const sourceString = dependencies.length
108. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
109. 		: '';
110. 
111. 	const id = options.amd && options.amd.id;
112. 
113. 	return deindent`
114. 		define(${id ? `"${id}", ` : ''}${sourceString}function(${paramString(dependencies)}) { "use strict";
115. 			${getCompatibilityStatements(dependencies)}
116. 
117. 			${code}
118. 			return ${name};
119. 		});`;
120. }
121. 
122. function cjs(
123. 	code: string,
124. 	name: string,
125. 	options: CompileOptions,
126. 	banner: string,
127. 	sharedPath: string,
128. 	helpers: { name: string, alias: string }[],
129. 	dependencies: Dependency[]
130. ) {
131. 	const SHARED = '__shared';
132. 	const helperBlock = helpers && (
133. 		`var ${SHARED} = require(${JSON.stringify(sharedPath)});\n` +
134. 		helpers.map(helper => {
135. 			return `var ${helper.alias} = ${SHARED}.${helper.name};`;
136. 		}).join('\n')
137. 	);
138. 
139. 	const requireBlock = dependencies.length > 0 && (
140. 		dependencies
141. 			.map(d => `var ${d.name} = require("${d.source}");`)
142. 			.join('\n\n')
143. 	);
144. 
145. 	return deindent`
146. 		${banner}
147. 		"use strict";
148. 
149. 		${helperBlock}
150. 		${requireBlock}
151. 		${getCompatibilityStatements(dependencies)}
152. 
153. 		${code}
154. 
155. 		module.exports = ${name};`
156. }
157. 
158. function iife(
159. 	code: string,
160. 	name: string,
161. 	options: CompileOptions,
162. 	banner: string,
163. 	dependencies: Dependency[]
164. ) {
165. 	if (!options.name) {
166. 		throw new Error(`Missing required 'name' option for IIFE export`);
167. 	}
168. 
169. 	const globals = getGlobals(dependencies, options);
170. 
171. 	return deindent`
172. 		${banner}
173. 		var ${options.name} = (function(${paramString(dependencies)}) { "use strict";
174. 			${getCompatibilityStatements(dependencies)}
175. 
176. 			${code}
177. 			return ${name};
178. 		}(${globals.join(', ')}));`;
179. }
180. 
181. function umd(
182. 	code: string,
183. 	name: string,
184. 	options: CompileOptions,
185. 	banner: string,
186. 	dependencies: Dependency[]
187. ) {
188. 	if (!options.name) {
189. 		throw new Error(`Missing required 'name' option for UMD export`);
190. 	}
191. 
192. 	const amdId = options.amd && options.amd.id ? `'${options.amd.id}', ` : '';
193. 
194. 	const amdDeps = dependencies.length
195. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
196. 		: '';
197. 
198. 	const cjsDeps = dependencies
199. 		.map(d => `require("${d.source}")`)
200. 		.join(', ');
201. 
202. 	const globals = getGlobals(dependencies, options);
203. 
204. 	return deindent`
205. 		${banner}
206. 		(function(global, factory) {
207. 			typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :
208. 			typeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :
209. 			(global.${options.name} = factory(${globals}));
210. 		}(this, (function (${paramString(dependencies)}) { "use strict";
211. 
212. 			${getCompatibilityStatements(dependencies)}
213. 
214. 			${code}
215. 
216. 			return ${name};
217. 
218. 		})));`;
219. }
220. 
221. function expr(
222. 	code: string,
223. 	name: string,
224. 	options: CompileOptions,
225. 	banner: string,
226. 	dependencies: Dependency[]
227. ) {
228. 	const globals = getGlobals(dependencies, options);
229. 
230. 	return deindent`
231. 		(function (${paramString(dependencies)}) { "use strict";
232. 			${banner}
233. 
234. 			${getCompatibilityStatements(dependencies)}
235. 
236. 			${code}
237. 
238. 			return ${name};
239. 		}(${globals.join(', ')}))`;
240. }
241. 
242. function paramString(dependencies: Dependency[]) {
243. 	return dependencies.map(dep => dep.name).join(', ');
244. }
245. 
246. function removeExtension(file: string) {
247. 	const index = file.lastIndexOf('.');
248. 	return ~index ? file.slice(0, index) : file;
249. }
250. 
251. function getCompatibilityStatements(dependencies: Dependency[]) {
252. 	if (!dependencies.length) return null;
253. 
254. 	const statements: string[] = [];
255. 
256. 	dependencies.forEach(dependency => {
257. 		statements.push(...dependency.statements);
258. 	});
259. 
260. 	return statements.join('\n');
261. }
262. 
263. function getGlobals(dependencies: Dependency[], options: CompileOptions) {
264. 	const { globals, onerror, onwarn } = options;
265. 	const globalFn = getGlobalFn(globals);
266. 
267. 	return dependencies.map(d => {
268. 		let name = globalFn(d.source);
269. 
270. 		if (!name) {
271. 			if (d.name.startsWith('__import')) {
272. 				const error = new Error(
273. 					`Could not determine name for imported module '${d.source}' – use options.globals`
274. 				);
275. 				onerror(error);
276. 			} else {
277. 				const warning = {
278. 					message: `No name was supplied for imported module '${d.source}'. Guessing '${d.name}', but you should use options.globals`,
279. 				};
280. 
281. 				onwarn(warning);
282. 			}
283. 
284. 			name = d.name;
285. 		}
286. 
287. 		return name;
288. 	});
289. }
290. 
291. function getGlobalFn(globals: any): (id: string) => string {
292. 	if (typeof globals === 'function') return globals;
293. 	if (typeof globals === 'object') {
294. 		return id => globals[id];
295. 	}
296. 
297. 	return () => undefined;
298. }


File: src/index.ts
Line number range: 1 - 78
Content:
1. import parse from './parse/index';
2. import validate from './validate/index';
3. import generate from './generators/dom/index';
4. import generateSSR from './generators/server-side-rendering/index';
5. import { assign } from './shared/index.js';
6. import { version } from '../package.json';
7. import Stylesheet from './css/Stylesheet';
8. import { Parsed, CompileOptions, Warning } from './interfaces';
9. 
10. function normalizeOptions(options: CompileOptions): CompileOptions {
11. 	let normalizedOptions = assign({ generate: 'dom' }, options);
12. 	const { onwarn, onerror } = normalizedOptions;
13. 	normalizedOptions.onwarn = onwarn
14. 		? (warning: Warning) => onwarn(warning, defaultOnwarn)
15. 		: defaultOnwarn;
16. 	normalizedOptions.onerror = onerror
17. 		? (error: Error) => onerror(error, defaultOnerror)
18. 		: defaultOnerror;
19. 	return normalizedOptions;
20. }
21. 
22. function defaultOnwarn(warning: Warning) {
23. 	if (warning.loc) {
24. 		console.warn(
25. 			`(${warning.loc.line}:${warning.loc.column}) – ${warning.message}`
26. 		); // eslint-disable-line no-console
27. 	} else {
28. 		console.warn(warning.message); // eslint-disable-line no-console
29. 	}
30. }
31. 
32. function defaultOnerror(error: Error) {
33. 	throw error;
34. }
35. 
36. export function compile(source: string, _options: CompileOptions) {
37. 	const options = normalizeOptions(_options);
38. 
39. 	let parsed: Parsed;
40. 
41. 	try {
42. 		parsed = parse(source, options);
43. 	} catch (err) {
44. 		options.onerror(err);
45. 		return;
46. 	}
47. 
48. 	const stylesheet = new Stylesheet(source, parsed, options.filename, options.cascade !== false);
49. 
50. 	validate(parsed, source, stylesheet, options);
51. 
52. 	const compiler = options.generate === 'ssr' ? generateSSR : generate;
53. 
54. 	return compiler(parsed, source, stylesheet, options);
55. }
56. 
57. export function create(source: string, _options: CompileOptions = {}) {
58. 	_options.format = 'eval';
59. 
60. 	const compiled = compile(source, _options);
61. 
62. 	if (!compiled || !compiled.code) {
63. 		return;
64. 	}
65. 
66. 	try {
67. 		return (0,eval)(compiled.code);
68. 	} catch (err) {
69. 		if (_options.onerror) {
70. 			_options.onerror(err);
71. 			return;
72. 		} else {
73. 			throw err;
74. 		}
75. 	}
76. }
77. 
78. export { parse, validate, version as VERSION };


File: src/interfaces.ts
Line number range: 1 - 80
Content:
1. export interface Node {
2. 	start: number;
3. 	end: number;
4. 	type: string;
5. 	[propName: string]: any;
6. }
7. 
8. export interface Parser {
9. 	readonly template: string;
10. 	readonly filename?: string;
11. 
12. 	index: number;
13. 	stack: Array<Node>;
14. 
15. 	html: Node;
16. 	css: Node;
17. 	js: Node;
18. 	metaTags: {};
19. }
20. 
21. export interface Parsed {
22. 	hash: number;
23. 	html: Node;
24. 	css: Node;
25. 	js: Node;
26. }
27. 
28. export interface Warning {
29. 	loc?: { line: number; column: number; pos?: number };
30. 	pos?: number;
31. 	message: string;
32. 	filename?: string;
33. 	frame?: string;
34. 	toString: () => string;
35. }
36. 
37. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';
38. 
39. export interface CompileOptions {
40. 	format?: ModuleFormat;
41. 	name?: string;
42. 	filename?: string;
43. 	generate?: string;
44. 	globals?: ((id: string) => string) | object;
45. 	amd?: {
46. 		id?: string;
47. 	};
48. 
49. 	outputFilename?: string;
50. 	cssOutputFilename?: string;
51. 
52. 	dev?: boolean;
53. 	shared?: boolean | string;
54. 	cascade?: boolean;
55. 	hydratable?: boolean;
56. 	legacy?: boolean;
57. 	customElement?: CustomElementOptions | true;
58. 	css?: boolean;
59. 
60. 	onerror?: (error: Error) => void;
61. 	onwarn?: (warning: Warning) => void;
62. }
63. 
64. export interface GenerateOptions {
65. 	name: string;
66. 	format: ModuleFormat;
67. 	banner?: string;
68. 	sharedPath?: string | boolean;
69. 	helpers?: { name: string, alias: string }[];
70. }
71. 
72. export interface Visitor {
73. 	enter: (node: Node) => void;
74. 	leave?: (node: Node) => void;
75. }
76. 
77. export interface CustomElementOptions {
78. 	tag?: string;
79. 	props?: string[];
80. }


File: src/utils/getObject.ts
Line number range: 1 - 6
Content:
1. import { Node } from '../interfaces';
2. 
3. export default function getObject(node: Node) {
4. 	while (node.type === 'MemberExpression') node = node.object;
5. 	return node;
6. }


File: src/utils/stringify.ts
Line number range: 1 - 9
Content:
1. export function stringify(data: string, options = {}) {
2. 	return JSON.stringify(escape(data, options));
3. }
4. 
5. export function escape(data: string, { onlyEscapeAtSymbol = false } = {}) {
6. 	return data.replace(onlyEscapeAtSymbol ? /(%+|@+)/g : /(%+|@+|#+)/g, (match: string) => {
7. 		return match + match[0];
8. 	});
9. }


File: src/validate/js/index.ts
Line number range: 1 - 93
Content:
1. import propValidators from './propValidators/index';
2. import fuzzymatch from '../utils/fuzzymatch';
3. import checkForDupes from './utils/checkForDupes';
4. import checkForComputedKeys from './utils/checkForComputedKeys';
5. import namespaces from '../../utils/namespaces';
6. import { Validator } from '../';
7. import { Node } from '../../interfaces';
8. 
9. const validPropList = Object.keys(propValidators);
10. 
11. export default function validateJs(validator: Validator, js: Node) {
12. 	js.content.body.forEach((node: Node) => {
13. 		// check there are no named exports
14. 		if (node.type === 'ExportNamedDeclaration') {
15. 			validator.error(`A component can only have a default export`, node.start);
16. 		}
17. 
18. 		if (node.type === 'ExportDefaultDeclaration') {
19. 			if (node.declaration.type !== 'ObjectExpression') {
20. 				return validator.error(
21. 					`Default export must be an object literal`,
22. 					node.declaration.start
23. 				);
24. 			}
25. 
26. 			checkForComputedKeys(validator, node.declaration.properties);
27. 			checkForDupes(validator, node.declaration.properties);
28. 
29. 			const props = validator.properties;
30. 
31. 			node.declaration.properties.forEach((prop: Node) => {
32. 				props.set(prop.key.name, prop);
33. 			});
34. 
35. 			// Remove these checks in version 2
36. 			if (props.has('oncreate') && props.has('onrender')) {
37. 				validator.error(
38. 					'Cannot have both oncreate and onrender',
39. 					props.get('onrender').start
40. 				);
41. 			}
42. 
43. 			if (props.has('ondestroy') && props.has('onteardown')) {
44. 				validator.error(
45. 					'Cannot have both ondestroy and onteardown',
46. 					props.get('onteardown').start
47. 				);
48. 			}
49. 
50. 			// ensure all exported props are valid
51. 			node.declaration.properties.forEach((prop: Node) => {
52. 				const propValidator = propValidators[prop.key.name];
53. 
54. 				if (propValidator) {
55. 					propValidator(validator, prop);
56. 				} else {
57. 					const match = fuzzymatch(prop.key.name, validPropList);
58. 					if (match) {
59. 						validator.error(
60. 							`Unexpected property '${prop.key.name}' (did you mean '${match}'?)`,
61. 							prop.start
62. 						);
63. 					} else if (/FunctionExpression/.test(prop.value.type)) {
64. 						validator.error(
65. 							`Unexpected property '${prop.key.name}' (did you mean to include it in 'methods'?)`,
66. 							prop.start
67. 						);
68. 					} else {
69. 						validator.error(
70. 							`Unexpected property '${prop.key.name}'`,
71. 							prop.start
72. 						);
73. 					}
74. 				}
75. 			});
76. 
77. 			if (props.has('namespace')) {
78. 				const ns = props.get('namespace').value.value;
79. 				validator.namespace = namespaces[ns] || ns;
80. 			}
81. 
82. 			validator.defaultExport = node;
83. 		}
84. 	});
85. 
86. 	['components', 'methods', 'helpers', 'transitions'].forEach(key => {
87. 		if (validator.properties.has(key)) {
88. 			validator.properties.get(key).value.properties.forEach((prop: Node) => {
89. 				validator[key].set(prop.key.name, prop.value);
90. 			});
91. 		}
92. 	});
93. }


File: src/validate/js/propValidators/oncreate.ts
Line number range: 1 - 14
Content:
1. import usesThisOrArguments from '../utils/usesThisOrArguments';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function oncreate(validator: Validator, prop: Node) {
6. 	if (prop.value.type === 'ArrowFunctionExpression') {
7. 		if (usesThisOrArguments(prop.value.body)) {
8. 			validator.error(
9. 				`'oncreate' should be a function expression, not an arrow function expression`,
10. 				prop.start
11. 			);
12. 		}
13. 	}
14. }

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:44:01,331 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The issue concerns the lifecycle method oncreate losing its async modifier during code generation. The provided context shows where %oncreate is injected (dom/index.ts) and validation rules (validate/js/oncreate.ts), but it lacks the critical implementation that builds templateProperties and templateVars from the JS default export and serializes function nodes. Those responsibilities are likely in the base Generator and DOM visitor pipeline. Therefore we need the source that constructs oncreate and emits its code to identify where async is being stripped.' query='Please provide the full contents of src/generators/Generator.ts, src/generators/dom/visit.ts, src/generators/dom/visitors/index.ts, and src/parse/read/script.ts.' extra_requirements='If sending full files is too large, include at minimum the parts that build templateProperties/templateVars (especially handling oncreate/ondestroy/onrender/onteardown) and any function serialization/rewrite logic that could drop the async modifier, with their imports.' purpose='These files define how lifecycle functions are parsed and emitted; inspecting them will show where async is removed and how to preserve it.'
2025-11-11 00:44:01,333 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents of src/generators/Generator.ts, src/generators/dom/visit.ts, src/generators/dom/visitors/index.ts, and src/parse/read/script.ts.
2025-11-11 00:44:05,255 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-11 00:44:05,255 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-11 00:44:05,256 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-11 00:44:05,256 - thread-133013323122368.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-11 00:44:05,257 - thread-133013323122368.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-11 00:44:05,258 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-11 00:44:05,259 - thread-133013323122368.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents of src/generators/Generator.ts, src/generators/dom/visit.ts, src/generators/dom/visitors/index.ts, and src/parse/read/script.ts.
Extra requirements: If sending full files is too large, include at minimum the parts that build templateProperties/templateVars (especially handling oncreate/ondestroy/onrender/onteardown) and any function serialization/rewrite logic that could drop the async modifier, with their imports.
Purpose: These files define how lifecycle functions are parsed and emitted; inspecting them will show where async is removed and how to preserve it.
2025-11-11 00:44:12,446 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_TkDdI3fF0uRIcGi08SOgHT0H', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts","start_line":1,"end_line":10000}', 'name': 'read_code_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 493, 'prompt_tokens': 2225, 'total_tokens': 2718, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--eb4b233e-4473-4681-90ac-a4e31a454f1b-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'src/generators/Generator.ts', 'start_line': 1, 'end_line': 10000}, 'id': 'call_TkDdI3fF0uRIcGi08SOgHT0H', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2225, 'output_tokens': 493, 'total_tokens': 2718, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-11 00:44:13,893 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_SxVq6l7OjRKYsw06BUSGid1X', 'function': {'arguments': '{"relative_path":"src/generators/dom/visit.ts","start_line":1,"end_line":10000}', 'name': 'read_code_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 40, 'prompt_tokens': 11201, 'total_tokens': 11241, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--982b9261-d0c6-4640-81af-917436d5f027-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'src/generators/dom/visit.ts', 'start_line': 1, 'end_line': 10000}, 'id': 'call_SxVq6l7OjRKYsw06BUSGid1X', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11201, 'output_tokens': 40, 'total_tokens': 11241, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:44:15,409 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6dsw7Rm36ggCA5DrSrkGPjxz', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/index.ts","start_line":1,"end_line":10000}', 'name': 'read_code_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 42, 'prompt_tokens': 11485, 'total_tokens': 11527, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3259e7d4-d9b7-4dbb-86f7-9d19ab7067ce-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'src/generators/dom/visitors/index.ts', 'start_line': 1, 'end_line': 10000}, 'id': 'call_6dsw7Rm36ggCA5DrSrkGPjxz', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11485, 'output_tokens': 42, 'total_tokens': 11527, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:44:17,154 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_edubKA4orF7kT5RvjjDvAe8C', 'function': {'arguments': '{"relative_path":"src/parse/read/script.ts","start_line":1,"end_line":10000}', 'name': 'read_code_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 11769, 'total_tokens': 11807, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4088cd7e-0ab8-4180-a2aa-13d108d8f134-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'src/parse/read/script.ts', 'start_line': 1, 'end_line': 10000}, 'id': 'call_edubKA4orF7kT5RvjjDvAe8C', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11769, 'output_tokens': 38, 'total_tokens': 11807, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:44:28,626 - thread-133013323122368.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I fetched and displayed the full contents of src/generators/Generator.ts, src/generators/dom/visit.ts, src/generators/dom/visitors/index.ts, and src/parse/read/script.ts. In Generator.ts, I verified how templateProperties/templateVars are built, including the legacy onrender→oncreate and onteardown→ondestroy handling, and examined the function serialization logic for ArrowFunctionExpression and FunctionExpression. That logic rewrites them to named function declarations and, by slicing from the first “(” onward, effectively drops any async modifier. The dom visitor files are simple dispatchers, and script.ts uses acorn (ECMA 8, module) to parse the script.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1115, 'prompt_tokens': 12269, 'total_tokens': 13384, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--4c9f98ce-6b89-4adf-a807-db136013be9b-0' usage_metadata={'input_tokens': 12269, 'output_tokens': 1115, 'total_tokens': 13384, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-11 00:44:28,630 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents of src/generators/Generator.ts, src/generators/dom/visit.ts, src/generators/dom/visitors/index.ts, and src/parse/read/script.ts.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending full files is too large, include at minimum the parts that build templateProperties/templateVars (especially handling oncreate/ondestroy/onrender/onteardown) and any function serialization/rewrite logic that could drop the async modifier, with their imports.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These files define how lifecycle functions are parsed and emitted; inspecting them will show where async is removed and how to preserve it.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: src/generators/Generator.ts
Line number range: 1 - 10000
Content:
1. import MagicString, { Bundle } from 'magic-string';
2. import { walk } from 'estree-walker';
3. import { getLocator } from 'locate-character';
4. import deindent from '../utils/deindent';
5. import CodeBuilder from '../utils/CodeBuilder';
6. import getCodeFrame from '../utils/getCodeFrame';
7. import isReference from '../utils/isReference';
8. import flattenReference from '../utils/flattenReference';
9. import globalWhitelist from '../utils/globalWhitelist';
10. import reservedNames from '../utils/reservedNames';
11. import namespaces from '../utils/namespaces';
12. import { removeNode, removeObjectKey } from '../utils/removeNode';
13. import wrapModule from './shared/utils/wrapModule';
14. import annotateWithScopes from '../utils/annotateWithScopes';
15. import clone from '../utils/clone';
16. import DomBlock from './dom/Block';
17. import SsrBlock from './server-side-rendering/Block';
18. import Stylesheet from '../css/Stylesheet';
19. import { Node, GenerateOptions, Parsed, CompileOptions, CustomElementOptions } from '../interfaces';
20. 
21. const test = typeof global !== 'undefined' && global.__svelte_test;
22. 
23. interface Computation {
24. 	key: string;
25. 	deps: string[]
26. }
27. 
28. function detectIndentation(str: string) {
29. 	const pattern = /^[\t\s]{1,4}/gm;
30. 	let match;
31. 
32. 	while (match = pattern.exec(str)) {
33. 		if (match[0][0] === '\t') return '\t';
34. 		if (match[0].length === 2) return '  ';
35. 	}
36. 
37. 	return '    ';
38. }
39. 
40. function getIndentationLevel(str: string, b: number) {
41. 	let a = b;
42. 	while (a > 0 && str[a - 1] !== '\n') a -= 1;
43. 	return /^\s*/.exec(str.slice(a, b))[0];
44. }
45. 
46. function getIndentExclusionRanges(node: Node) {
47. 	const ranges: Node[] = [];
48. 	walk(node, {
49. 		enter(node: Node) {
50. 			if (node.type === 'TemplateElement') ranges.push(node);
51. 		}
52. 	});
53. 	return ranges;
54. }
55. 
56. function removeIndentation(
57. 	code: MagicString,
58. 	start: number,
59. 	end: number,
60. 	indentationLevel: string,
61. 	ranges: Node[]
62. ) {
63. 	const str = code.original.slice(start, end);
64. 	const pattern = new RegExp(`^${indentationLevel}`, 'gm');
65. 	let match;
66. 
67. 	while (match = pattern.exec(str)) {
68. 		// TODO bail if we're inside an exclusion range
69. 		code.remove(start + match.index, start + match.index + indentationLevel.length);
70. 	}
71. }
72. 
73. export default class Generator {
74. 	ast: Parsed;
75. 	parsed: Parsed;
76. 	source: string;
77. 	name: string;
78. 	options: CompileOptions;
79. 
80. 	customElement: CustomElementOptions;
81. 	tag: string;
82. 	props: string[];
83. 
84. 	defaultExport: Node[];
85. 	imports: Node[];
86. 	helpers: Set<string>;
87. 	components: Set<string>;
88. 	events: Set<string>;
89. 	transitions: Set<string>;
90. 	importedComponents: Map<string, string>;
91. 	namespace: string;
92. 	hasComponents: boolean;
93. 	computations: Computation[];
94. 	templateProperties: Record<string, Node>;
95. 	slots: Set<string>;
96. 	javascript: string;
97. 
98. 	code: MagicString;
99. 
100. 	bindingGroups: string[];
101. 	indirectDependencies: Map<string, Set<string>>;
102. 	expectedProperties: Set<string>;
103. 	usesRefs: boolean;
104. 
105. 	locate: (c: number) => { line: number, column: number };
106. 
107. 	stylesheet: Stylesheet;
108. 
109. 	userVars: Set<string>;
110. 	templateVars: Map<string, string>;
111. 	aliases: Map<string, string>;
112. 	usedNames: Set<string>;
113. 
114. 	constructor(
115. 		parsed: Parsed,
116. 		source: string,
117. 		name: string,
118. 		stylesheet: Stylesheet,
119. 		options: CompileOptions,
120. 		dom: boolean
121. 	) {
122. 		this.ast = clone(parsed);
123. 
124. 		this.parsed = parsed;
125. 		this.source = source;
126. 		this.options = options;
127. 
128. 		this.imports = [];
129. 		this.helpers = new Set();
130. 		this.components = new Set();
131. 		this.events = new Set();
132. 		this.transitions = new Set();
133. 		this.importedComponents = new Map();
134. 		this.slots = new Set();
135. 
136. 		this.bindingGroups = [];
137. 		this.indirectDependencies = new Map();
138. 
139. 		this.locate = getLocator(this.source);
140. 
141. 		// track which properties are needed, so we can provide useful info
142. 		// in dev mode
143. 		this.expectedProperties = new Set();
144. 
145. 		this.code = new MagicString(source);
146. 		this.usesRefs = false;
147. 
148. 		// styles
149. 		this.stylesheet = stylesheet;
150. 
151. 		// allow compiler to deconflict user's `import { get } from 'whatever'` and
152. 		// Svelte's builtin `import { get, ... } from 'svelte/shared.ts'`;
153. 		this.userVars = new Set();
154. 		this.templateVars = new Map();
155. 		this.aliases = new Map();
156. 		this.usedNames = new Set();
157. 
158. 		this.parseJs(dom);
159. 		this.name = this.alias(name);
160. 
161. 		if (options.customElement === true) {
162. 			this.customElement = {
163. 				tag: this.tag,
164. 				props: this.props // TODO autofill this in
165. 			}
166. 		} else {
167. 			this.customElement = options.customElement;
168. 		}
169. 
170. 		if (this.customElement && !this.customElement.tag) {
171. 			throw new Error(`No tag name specified`); // TODO better error
172. 		}
173. 	}
174. 
175. 	addSourcemapLocations(node: Node) {
176. 		walk(node, {
177. 			enter: (node: Node) => {
178. 				this.code.addSourcemapLocation(node.start);
179. 				this.code.addSourcemapLocation(node.end);
180. 			},
181. 		});
182. 	}
183. 
184. 	alias(name: string) {
185. 		if (!this.aliases.has(name)) {
186. 			this.aliases.set(name, this.getUniqueName(name));
187. 		}
188. 
189. 		return this.aliases.get(name);
190. 	}
191. 
192. 	contextualise(
193. 		block: DomBlock | SsrBlock,
194. 		expression: Node,
195. 		context: string,
196. 		isEventHandler: boolean
197. 	): {
198. 		dependencies: string[],
199. 		contexts: Set<string>,
200. 		indexes: Set<string>,
201. 		snippet: string
202. 	} {
203. 		this.addSourcemapLocations(expression);
204. 
205. 		const usedContexts: Set<string> = new Set();
206. 		const usedIndexes: Set<string> = new Set();
207. 
208. 		const { code, helpers } = this;
209. 		const { contexts, indexes } = block;
210. 
211. 		let scope = annotateWithScopes(expression); // TODO this already happens in findDependencies
212. 		let lexicalDepth = 0;
213. 
214. 		const self = this;
215. 
216. 		walk(expression, {
217. 			enter(node: Node, parent: Node, key: string) {
218. 				if (/^Function/.test(node.type)) lexicalDepth += 1;
219. 
220. 				if (node._scope) {
221. 					scope = node._scope;
222. 					return;
223. 				}
224. 
225. 				if (node.type === 'ThisExpression') {
226. 					if (lexicalDepth === 0 && context)
227. 						code.overwrite(node.start, node.end, context, {
228. 							storeName: true,
229. 							contentOnly: false,
230. 						});
231. 				} else if (isReference(node, parent)) {
232. 					const { name } = flattenReference(node);
233. 					if (scope.has(name)) return;
234. 
235. 					if (name === 'event' && isEventHandler) {
236. 						// noop
237. 					} else if (contexts.has(name)) {
238. 						const contextName = contexts.get(name);
239. 						if (contextName !== name) {
240. 							// this is true for 'reserved' names like `state` and `component`
241. 							code.overwrite(
242. 								node.start,
243. 								node.start + name.length,
244. 								contextName,
245. 								{ storeName: true, contentOnly: false }
246. 							);
247. 						}
248. 
249. 						usedContexts.add(name);
250. 					} else if (helpers.has(name)) {
251. 						let object = node;
252. 						while (object.type === 'MemberExpression') object = object.object;
253. 
254. 						const alias = self.templateVars.get(`helpers-${name}`);
255. 						if (alias !== name) code.overwrite(object.start, object.end, alias);
256. 					} else if (indexes.has(name)) {
257. 						const context = indexes.get(name);
258. 						usedContexts.add(context); // TODO is this right?
259. 						usedIndexes.add(name);
260. 					} else {
261. 						// handle shorthand properties
262. 						if (parent && parent.type === 'Property' && parent.shorthand) {
263. 							if (key === 'key') {
264. 								code.appendLeft(node.start, `${name}: `);
265. 								return;
266. 							}
267. 						}
268. 
269. 						if (globalWhitelist.has(name)) {
270. 							code.prependRight(node.start, `('${name}' in state ? state.`);
271. 							code.appendLeft(
272. 								node.object ? node.object.end : node.end,
273. 								` : ${name})`
274. 							);
275. 						} else {
276. 							code.prependRight(node.start, `state.`);
277. 						}
278. 
279. 						usedContexts.add('state');
280. 					}
281. 
282. 					this.skip();
283. 				}
284. 			},
285. 
286. 			leave(node: Node) {
287. 				if (/^Function/.test(node.type)) lexicalDepth -= 1;
288. 				if (node._scope) scope = scope.parent;
289. 			},
290. 		});
291. 
292. 		const dependencies: Set<string> = new Set(expression._dependencies || []);
293. 
294. 		if (expression._dependencies) {
295. 			expression._dependencies.forEach((prop: string) => {
296. 				if (this.indirectDependencies.has(prop)) {
297. 					this.indirectDependencies.get(prop).forEach(dependency => {
298. 						dependencies.add(dependency);
299. 					});
300. 				}
301. 			});
302. 		}
303. 
304. 		return {
305. 			dependencies: Array.from(dependencies),
306. 			contexts: usedContexts,
307. 			indexes: usedIndexes,
308. 			snippet: `[✂${expression.start}-${expression.end}✂]`,
309. 		};
310. 	}
311. 
312. 	findDependencies(
313. 		contextDependencies: Map<string, string[]>,
314. 		indexes: Map<string, string>,
315. 		expression: Node
316. 	) {
317. 		if (expression._dependencies) return expression._dependencies;
318. 
319. 		let scope = annotateWithScopes(expression);
320. 		const dependencies: string[] = [];
321. 
322. 		const generator = this; // can't use arrow functions, because of this.skip()
323. 
324. 		walk(expression, {
325. 			enter(node: Node, parent: Node) {
326. 				if (node._scope) {
327. 					scope = node._scope;
328. 					return;
329. 				}
330. 
331. 				if (isReference(node, parent)) {
332. 					const { name } = flattenReference(node);
333. 					if (scope.has(name) || generator.helpers.has(name)) return;
334. 
335. 					if (contextDependencies.has(name)) {
336. 						dependencies.push(...contextDependencies.get(name));
337. 					} else if (!indexes.has(name)) {
338. 						dependencies.push(name);
339. 					}
340. 
341. 					this.skip();
342. 				}
343. 			},
344. 
345. 			leave(node: Node) {
346. 				if (node._scope) scope = scope.parent;
347. 			},
348. 		});
349. 
350. 		dependencies.forEach(name => {
351. 			if (!globalWhitelist.has(name)) {
352. 				this.expectedProperties.add(name);
353. 			}
354. 		});
355. 
356. 		return (expression._dependencies = dependencies);
357. 	}
358. 
359. 	generate(result: string, options: CompileOptions, { banner = '', sharedPath, helpers, name, format }: GenerateOptions ) {
360. 		const pattern = /\[✂(\d+)-(\d+)$/;
361. 
362. 		const module = wrapModule(result, format, name, options, banner, sharedPath, helpers, this.imports, this.source);
363. 
364. 		const parts = module.split('✂]');
365. 		const finalChunk = parts.pop();
366. 
367. 		const compiled = new Bundle({ separator: '' });
368. 
369. 		function addString(str: string) {
370. 			compiled.addSource({
371. 				content: new MagicString(str),
372. 			});
373. 		}
374. 
375. 		const { filename } = options;
376. 
377. 		// special case — the source file doesn't actually get used anywhere. we need
378. 		// to add an empty file to populate map.sources and map.sourcesContent
379. 		if (!parts.length) {
380. 			compiled.addSource({
381. 				filename,
382. 				content: new MagicString(this.source).remove(0, this.source.length),
383. 			});
384. 		}
385. 
386. 		parts.forEach((str: string) => {
387. 			const chunk = str.replace(pattern, '');
388. 			if (chunk) addString(chunk);
389. 
390. 			const match = pattern.exec(str);
391. 
392. 			const snippet = this.code.snip(+match[1], +match[2]);
393. 
394. 			compiled.addSource({
395. 				filename,
396. 				content: snippet,
397. 			});
398. 		});
399. 
400. 		addString(finalChunk);
401. 
402. 		const { css, cssMap } = this.customElement ?
403. 			{ css: null, cssMap: null } :
404. 			this.stylesheet.render(options.cssOutputFilename, true);
405. 
406. 		return {
407. 			ast: this.ast,
408. 			code: compiled.toString(),
409. 			map: compiled.generateMap({
410. 				includeContent: true,
411. 				file: options.outputFilename,
412. 			}),
413. 			css,
414. 			cssMap
415. 		};
416. 	}
417. 
418. 	getUniqueName(name: string) {
419. 		if (test) name = `${name}$`;
420. 		let alias = name;
421. 		for (
422. 			let i = 1;
423. 			reservedNames.has(alias) ||
424. 			this.userVars.has(alias) ||
425. 			this.usedNames.has(alias);
426. 			alias = `${name}_${i++}`
427. 		);
428. 		this.usedNames.add(alias);
429. 		return alias;
430. 	}
431. 
432. 	getUniqueNameMaker(params: string[]) {
433. 		const localUsedNames = new Set(params);
434. 
435. 		function add(name: string) {
436. 			localUsedNames.add(name);
437. 		}
438. 
439. 		reservedNames.forEach(add);
440. 		this.userVars.forEach(add);
441. 
442. 		return (name: string) => {
443. 			if (test) name = `${name}$`;
444. 			let alias = name;
445. 			for (
446. 				let i = 1;
447. 				this.usedNames.has(alias) ||
448. 				localUsedNames.has(alias);
449. 				alias = `${name}_${i++}`
450. 			);
451. 			localUsedNames.add(alias);
452. 			return alias;
453. 		};
454. 	}
455. 
456. 	parseJs(dom: boolean) {
457. 		const { code, source } = this;
458. 		const { js } = this.parsed;
459. 
460. 		const imports = this.imports;
461. 		const computations: Computation[] = [];
462. 		const templateProperties: Record<string, Node> = {};
463. 		const componentDefinition = new CodeBuilder();
464. 
465. 		let namespace = null;
466. 
467. 		if (js) {
468. 			this.addSourcemapLocations(js.content);
469. 
470. 			const indentation = detectIndentation(source.slice(js.start, js.end));
471. 			const indentationLevel = getIndentationLevel(source, js.content.body[0].start);
472. 			const indentExclusionRanges = getIndentExclusionRanges(js.content);
473. 
474. 			const scope = annotateWithScopes(js.content);
475. 			scope.declarations.forEach(name => {
476. 				this.userVars.add(name);
477. 			});
478. 
479. 			const body = js.content.body.slice(); // slice, because we're going to be mutating the original
480. 
481. 			// imports need to be hoisted out of the IIFE
482. 			for (let i = 0; i < body.length; i += 1) {
483. 				const node = body[i];
484. 				if (node.type === 'ImportDeclaration') {
485. 					removeNode(code, js.content, node);
486. 					imports.push(node);
487. 
488. 					node.specifiers.forEach((specifier: Node) => {
489. 						this.userVars.add(specifier.local.name);
490. 					});
491. 				}
492. 			}
493. 
494. 			const defaultExport = this.defaultExport = body.find(
495. 				(node: Node) => node.type === 'ExportDefaultDeclaration'
496. 			);
497. 
498. 			if (defaultExport) {
499. 				defaultExport.declaration.properties.forEach((prop: Node) => {
500. 					templateProperties[prop.key.name] = prop;
501. 				});
502. 
503. 				['helpers', 'events', 'components', 'transitions'].forEach(key => {
504. 					if (templateProperties[key]) {
505. 						templateProperties[key].value.properties.forEach((prop: Node) => {
506. 							this[key].add(prop.key.name);
507. 						});
508. 					}
509. 				});
510. 
511. 				const addArrowFunctionExpression = (name: string, node: Node) => {
512. 					const { body, params } = node;
513. 
514. 					const paramString = params.length ?
515. 						`[✂${params[0].start}-${params[params.length - 1].end}✂]` :
516. 						``;
517. 
518. 					if (body.type === 'BlockStatement') {
519. 						componentDefinition.addBlock(deindent`
520. 							function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
521. 						`);
522. 					} else {
523. 						componentDefinition.addBlock(deindent`
524. 							function ${name}(${paramString}) {
525. 								return [✂${body.start}-${body.end}✂];
526. 							}
527. 						`);
528. 					}
529. 				};
530. 
531. 				const addFunctionExpression = (name: string, node: Node) => {
532. 					let c = node.start;
533. 					while (this.source[c] !== '(') c += 1;
534. 					componentDefinition.addBlock(deindent`
535. 						function ${name}[✂${c}-${node.end}✂];
536. 					`);
537. 				};
538. 
539. 				const addValue = (name: string, node: Node) => {
540. 					componentDefinition.addBlock(deindent`
541. 						var ${name} = [✂${node.start}-${node.end}✂];
542. 					`);
543. 				};
544. 
545. 				const addDeclaration = (key: string, node: Node, disambiguator?: string) => {
546. 					const qualified = disambiguator ? `${disambiguator}-${key}` : key;
547. 
548. 					if (node.type === 'Identifier' && node.name === key) {
549. 						this.templateVars.set(qualified, key);
550. 						return;
551. 					}
552. 
553. 					let name = this.getUniqueName(key);
554. 					this.templateVars.set(qualified, name);
555. 
556. 					// deindent
557. 					const indentationLevel = getIndentationLevel(source, node.start);
558. 					if (indentationLevel) {
559. 						removeIndentation(code, node.start, node.end, indentationLevel, indentExclusionRanges);
560. 					}
561. 
562. 					if (node.type === 'ArrowFunctionExpression') {
563. 						addArrowFunctionExpression(name, node);
564. 					} else if (node.type === 'FunctionExpression') {
565. 						addFunctionExpression(name, node);
566. 					} else {
567. 						addValue(name, node);
568. 					}
569. 				};
570. 
571. 				if (templateProperties.components) {
572. 					templateProperties.components.value.properties.forEach((property: Node) => {
573. 						addDeclaration(property.key.name, property.value, 'components');
574. 					});
575. 				}
576. 
577. 				if (templateProperties.computed) {
578. 					const dependencies = new Map();
579. 
580. 					templateProperties.computed.value.properties.forEach((prop: Node) => {
581. 						const key = prop.key.name;
582. 						const value = prop.value;
583. 
584. 						const deps = value.params.map(
585. 							(param: Node) =>
586. 								param.type === 'AssignmentPattern' ? param.left.name : param.name
587. 						);
588. 						dependencies.set(key, deps);
589. 					});
590. 
591. 					const visited = new Set();
592. 
593. 					const visit = (key: string) => {
594. 						if (!dependencies.has(key)) return; // not a computation
595. 
596. 						if (visited.has(key)) return;
597. 						visited.add(key);
598. 
599. 						const deps = dependencies.get(key);
600. 						deps.forEach(visit);
601. 
602. 						computations.push({ key, deps });
603. 
604. 						const prop = templateProperties.computed.value.properties.find((prop: Node) => prop.key.name === key);
605. 						addDeclaration(key, prop.value, 'computed');
606. 					};
607. 
608. 					templateProperties.computed.value.properties.forEach((prop: Node) =>
609. 						visit(prop.key.name)
610. 					);
611. 				}
612. 
613. 				if (templateProperties.data) {
614. 					addDeclaration('data', templateProperties.data.value);
615. 				}
616. 
617. 				if (templateProperties.events && dom) {
618. 					templateProperties.events.value.properties.forEach((property: Node) => {
619. 						addDeclaration(property.key.name, property.value, 'events');
620. 					});
621. 				}
622. 
623. 				if (templateProperties.helpers) {
624. 					templateProperties.helpers.value.properties.forEach((property: Node) => {
625. 						addDeclaration(property.key.name, property.value, 'helpers');
626. 					});
627. 				}
628. 
629. 				if (templateProperties.methods && dom) {
630. 					addDeclaration('methods', templateProperties.methods.value);
631. 				}
632. 
633. 				if (templateProperties.namespace) {
634. 					const ns = templateProperties.namespace.value.value;
635. 					namespace = namespaces[ns] || ns;
636. 				}
637. 
638. 				if (templateProperties.onrender) templateProperties.oncreate = templateProperties.onrender; // remove after v2
639. 				if (templateProperties.oncreate && dom) {
640. 					addDeclaration('oncreate', templateProperties.oncreate.value);
641. 				}
642. 
643. 				if (templateProperties.onteardown) templateProperties.ondestroy = templateProperties.onteardown; // remove after v2
644. 				if (templateProperties.ondestroy && dom) {
645. 					addDeclaration('ondestroy', templateProperties.ondestroy.value);
646. 				}
647. 
648. 				if (templateProperties.props) {
649. 					this.props = templateProperties.props.value.elements.map((element: Node) => element.value);
650. 				}
651. 
652. 				if (templateProperties.setup) {
653. 					addDeclaration('setup', templateProperties.setup.value);
654. 				}
655. 
656. 				if (templateProperties.tag) {
657. 					this.tag = templateProperties.tag.value.value;
658. 				}
659. 
660. 				if (templateProperties.transitions) {
661. 					templateProperties.transitions.value.properties.forEach((property: Node) => {
662. 						addDeclaration(property.key.name, property.value, 'transitions');
663. 					});
664. 				}
665. 			}
666. 
667. 			if (indentationLevel) {
668. 				if (defaultExport) {
669. 					removeIndentation(code, js.content.start, defaultExport.start, indentationLevel, indentExclusionRanges);
670. 					removeIndentation(code, defaultExport.end, js.content.end, indentationLevel, indentExclusionRanges);
671. 				} else {
672. 					removeIndentation(code, js.content.start, js.content.end, indentationLevel, indentExclusionRanges);
673. 				}
674. 			}
675. 
676. 			let a = js.content.start;
677. 			while (/\s/.test(source[a])) a += 1;
678. 
679. 			let b = js.content.end;
680. 			while (/\s/.test(source[b - 1])) b -= 1;
681. 
682. 			if (defaultExport) {
683. 				this.javascript = '';
684. 				if (a !== defaultExport.start) this.javascript += `[✂${a}-${defaultExport.start}✂]`;
685. 				if (!componentDefinition.isEmpty()) this.javascript += componentDefinition;
686. 				if (defaultExport.end !== b) this.javascript += `[✂${defaultExport.end}-${b}✂]`;
687. 			} else {
688. 				this.javascript = a === b ? null : `[✂${a}-${b}✂]`;
689. 			}
690. 		}
691. 
692. 		this.computations = computations;
693. 		this.namespace = namespace;
694. 		this.templateProperties = templateProperties;
695. 	}
696. }


File: src/generators/dom/visit.ts
Line number range: 1 - 10000
Content:
1. import visitors from './visitors/index';
2. import { DomGenerator } from './index';
3. import Block from './Block';
4. import { Node } from '../../interfaces';
5. import { State } from './interfaces';
6. 
7. export default function visit(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	elementStack: Node[],
13. 	componentStack: Node[]
14. ) {
15. 	const visitor = visitors[node.type];
16. 	visitor(generator, block, state, node, elementStack, componentStack);
17. }


File: src/generators/dom/visitors/index.ts
Line number range: 1 - 10000
Content:
1. import EachBlock from './EachBlock';
2. import Element from './Element/Element';
3. import IfBlock from './IfBlock';
4. import MustacheTag from './MustacheTag';
5. import RawMustacheTag from './RawMustacheTag';
6. import Text from './Text';
7. import { Visitor } from '../interfaces';
8. 
9. const visitors: Record<string, Visitor> = {
10. 	EachBlock,
11. 	Element,
12. 	IfBlock,
13. 	MustacheTag,
14. 	RawMustacheTag,
15. 	Text
16. };
17. 
18. export default visitors;


File: src/parse/read/script.ts
Line number range: 1 - 10000
Content:
1. import { parse } from 'acorn';
2. import repeat from '../../utils/repeat';
3. import { Parser } from '../index';
4. import { Node } from '../../interfaces';
5. 
6. const scriptClosingTag = '</script>';
7. 
8. export default function readScript(parser: Parser, start: number, attributes: Node[]) {
9. 	const scriptStart = parser.index;
10. 	const scriptEnd = parser.template.indexOf(scriptClosingTag, scriptStart);
11. 
12. 	if (scriptEnd === -1) parser.error(`<script> must have a closing tag`);
13. 
14. 	const source =
15. 		repeat(' ', scriptStart) + parser.template.slice(scriptStart, scriptEnd);
16. 	parser.index = scriptEnd + scriptClosingTag.length;
17. 
18. 	let ast;
19. 
20. 	try {
21. 		ast = parse(source, {
22. 			ecmaVersion: 8,
23. 			sourceType: 'module',
24. 		});
25. 	} catch (err) {
26. 		parser.acornError(err);
27. 	}
28. 
29. 	if (!ast.body.length) return null;
30. 
31. 	ast.start = scriptStart;
32. 	return {
33. 		start,
34. 		end: parser.index,
35. 		attributes,
36. 		content: ast,
37. 	};
38. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-11 00:44:53,612 - thread-133013323122368.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='Query requires full files, but at minimum needs parts that build templateProperties/templateVars and lifecycle handling plus function serialization that may drop async. Imports provide essential dependencies/types used by these parts.', relative_path='src/generators/Generator.ts', start_line=1, end_line=20), ContextOutput(reasoning='Defines class fields including templateProperties and templateVars, which are central to lifecycle parsing/emission.', relative_path='src/generators/Generator.ts', start_line=94, end_line=111), ContextOutput(reasoning='Initializes templateVars and triggers parseJs, which builds templateProperties/templateVars.', relative_path='src/generators/Generator.ts', start_line=154, end_line=160), ContextOutput(reasoning='parseJs local declarations of computations, templateProperties, and componentDefinition; essential context for building templateProperties/templateVars.', relative_path='src/generators/Generator.ts', start_line=461, end_line=466), ContextOutput(reasoning='Builds templateProperties from default export and collects helpers/events/components/transitions; directly addresses templateProperties construction.', relative_path='src/generators/Generator.ts', start_line=494, end_line=509), ContextOutput(reasoning='Function serialization helpers: ArrowFunction, FunctionExpression, and value handling. Critical for understanding potential loss of async modifier.', relative_path='src/generators/Generator.ts', start_line=511, end_line=543), ContextOutput(reasoning='addDeclaration wires names to templateVars, deindents, and delegates to function serializers. Central to templateVars construction and possible async-stripping behavior.', relative_path='src/generators/Generator.ts', start_line=545, end_line=569), ContextOutput(reasoning='Lifecycle mapping and emission: onrender→oncreate and onteardown→ondestroy; addDeclaration used to emit lifecycle functions.', relative_path='src/generators/Generator.ts', start_line=638, end_line=646), ContextOutput(reasoning='Final assignment of computations, namespace, and templateProperties back to the instance; ensures completeness of where templateProperties ends up.', relative_path='src/generators/Generator.ts', start_line=692, end_line=695), ContextOutput(reasoning='Dom visitor dispatcher; full file is short and requested, ties into DOM generation but not lifecycle/async specifics.', relative_path='src/generators/dom/visit.ts', start_line=1, end_line=17), ContextOutput(reasoning='Visitors registry; full file is short and requested. Provides essential mapping used by visit.ts.', relative_path='src/generators/dom/visitors/index.ts', start_line=1, end_line=18), ContextOutput(reasoning='Script reader/parsing; full file is short and requested. Shows acorn config (ecmaVersion, sourceType) relevant to parsing async functions.', relative_path='src/parse/read/script.ts', start_line=1, end_line=38)]
2025-11-11 00:44:53,619 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 12 contexts to memory for query: Please provide the full contents of src/generators/Generator.ts, src/generators/dom/visit.ts, src/generators/dom/visitors/index.ts, and src/parse/read/script.ts.
2025-11-11 00:44:56,591 - thread-133013323122368.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-11 00:44:56,592 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 12 new contexts to 9 existing contexts
2025-11-11 00:44:56,593 - thread-133013323122368.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 21 total contexts (removed 0 duplicates)
2025-11-11 00:44:56,595 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── isChildOfComponent.ts
|   |           ├── walkHtml.ts
|   |           └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── trim.ts
|   |   └── validCalleeObjects.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
async keyword is removed

Issue description: 
[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:

```js
export default {
  async oncreate() {
    const data = await fetch('foo.json').then(r => r.json());
    console.log(data);
  }
};
```

Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of the following files: src/utils/stringify.ts, src/validate/js/propValidators/oncreate.ts, src/validate/js/index.ts, src/utils/getObject.ts, src/generators/dom/preprocess.ts, src/generators/dom/index.ts, src/generators/shared/utils/wrapModule.ts, src/index.ts, and src/interfaces.ts.
Extra Requirements: If some files are large, include at least the parts that handle lifecycle methods (oncreate/onrender/ondestroy/onteardown) and any code that prints or stringifies function/method AST nodes, with their imports.
Purpose: These files will reveal where lifecycle methods are parsed, validated, transformed, and emitted so we can locate why the async modifier is being removed and how to preserve it.

Previous refined query 2:
Essential Query: Please provide the full contents of src/generators/Generator.ts, src/generators/dom/visit.ts, src/generators/dom/visitors/index.ts, and src/parse/read/script.ts.
Extra Requirements: If sending full files is too large, include at minimum the parts that build templateProperties/templateVars (especially handling oncreate/ondestroy/onrender/onteardown) and any function serialization/rewrite logic that could drop the async modifier, with their imports.
Purpose: These files define how lifecycle functions are parsed and emitted; inspecting them will show where async is removed and how to preserve it.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: src/generators/Generator.ts
Line number range: 1 - 20
Content:
1. import MagicString, { Bundle } from 'magic-string';
2. import { walk } from 'estree-walker';
3. import { getLocator } from 'locate-character';
4. import deindent from '../utils/deindent';
5. import CodeBuilder from '../utils/CodeBuilder';
6. import getCodeFrame from '../utils/getCodeFrame';
7. import isReference from '../utils/isReference';
8. import flattenReference from '../utils/flattenReference';
9. import globalWhitelist from '../utils/globalWhitelist';
10. import reservedNames from '../utils/reservedNames';
11. import namespaces from '../utils/namespaces';
12. import { removeNode, removeObjectKey } from '../utils/removeNode';
13. import wrapModule from './shared/utils/wrapModule';
14. import annotateWithScopes from '../utils/annotateWithScopes';
15. import clone from '../utils/clone';
16. import DomBlock from './dom/Block';
17. import SsrBlock from './server-side-rendering/Block';
18. import Stylesheet from '../css/Stylesheet';
19. import { Node, GenerateOptions, Parsed, CompileOptions, CustomElementOptions } from '../interfaces';
20. 


File: src/generators/Generator.ts
Line number range: 94 - 111
Content:
94. 	templateProperties: Record<string, Node>;
95. 	slots: Set<string>;
96. 	javascript: string;
97. 
98. 	code: MagicString;
99. 
100. 	bindingGroups: string[];
101. 	indirectDependencies: Map<string, Set<string>>;
102. 	expectedProperties: Set<string>;
103. 	usesRefs: boolean;
104. 
105. 	locate: (c: number) => { line: number, column: number };
106. 
107. 	stylesheet: Stylesheet;
108. 
109. 	userVars: Set<string>;
110. 	templateVars: Map<string, string>;
111. 	aliases: Map<string, string>;


File: src/generators/Generator.ts
Line number range: 154 - 160
Content:
154. 		this.templateVars = new Map();
155. 		this.aliases = new Map();
156. 		this.usedNames = new Set();
157. 
158. 		this.parseJs(dom);
159. 		this.name = this.alias(name);
160. 


File: src/generators/Generator.ts
Line number range: 461 - 466
Content:
461. 		const computations: Computation[] = [];
462. 		const templateProperties: Record<string, Node> = {};
463. 		const componentDefinition = new CodeBuilder();
464. 
465. 		let namespace = null;
466. 


File: src/generators/Generator.ts
Line number range: 494 - 509
Content:
494. 			const defaultExport = this.defaultExport = body.find(
495. 				(node: Node) => node.type === 'ExportDefaultDeclaration'
496. 			);
497. 
498. 			if (defaultExport) {
499. 				defaultExport.declaration.properties.forEach((prop: Node) => {
500. 					templateProperties[prop.key.name] = prop;
501. 				});
502. 
503. 				['helpers', 'events', 'components', 'transitions'].forEach(key => {
504. 					if (templateProperties[key]) {
505. 						templateProperties[key].value.properties.forEach((prop: Node) => {
506. 							this[key].add(prop.key.name);
507. 						});
508. 					}
509. 				});


File: src/generators/Generator.ts
Line number range: 511 - 543
Content:
511. 				const addArrowFunctionExpression = (name: string, node: Node) => {
512. 					const { body, params } = node;
513. 
514. 					const paramString = params.length ?
515. 						`[✂${params[0].start}-${params[params.length - 1].end}✂]` :
516. 						``;
517. 
518. 					if (body.type === 'BlockStatement') {
519. 						componentDefinition.addBlock(deindent`
520. 							function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
521. 						`);
522. 					} else {
523. 						componentDefinition.addBlock(deindent`
524. 							function ${name}(${paramString}) {
525. 								return [✂${body.start}-${body.end}✂];
526. 							}
527. 						`);
528. 					}
529. 				};
530. 
531. 				const addFunctionExpression = (name: string, node: Node) => {
532. 					let c = node.start;
533. 					while (this.source[c] !== '(') c += 1;
534. 					componentDefinition.addBlock(deindent`
535. 						function ${name}[✂${c}-${node.end}✂];
536. 					`);
537. 				};
538. 
539. 				const addValue = (name: string, node: Node) => {
540. 					componentDefinition.addBlock(deindent`
541. 						var ${name} = [✂${node.start}-${node.end}✂];
542. 					`);
543. 				};


File: src/generators/Generator.ts
Line number range: 545 - 569
Content:
545. 				const addDeclaration = (key: string, node: Node, disambiguator?: string) => {
546. 					const qualified = disambiguator ? `${disambiguator}-${key}` : key;
547. 
548. 					if (node.type === 'Identifier' && node.name === key) {
549. 						this.templateVars.set(qualified, key);
550. 						return;
551. 					}
552. 
553. 					let name = this.getUniqueName(key);
554. 					this.templateVars.set(qualified, name);
555. 
556. 					// deindent
557. 					const indentationLevel = getIndentationLevel(source, node.start);
558. 					if (indentationLevel) {
559. 						removeIndentation(code, node.start, node.end, indentationLevel, indentExclusionRanges);
560. 					}
561. 
562. 					if (node.type === 'ArrowFunctionExpression') {
563. 						addArrowFunctionExpression(name, node);
564. 					} else if (node.type === 'FunctionExpression') {
565. 						addFunctionExpression(name, node);
566. 					} else {
567. 						addValue(name, node);
568. 					}
569. 				};


File: src/generators/Generator.ts
Line number range: 638 - 646
Content:
638. 				if (templateProperties.onrender) templateProperties.oncreate = templateProperties.onrender; // remove after v2
639. 				if (templateProperties.oncreate && dom) {
640. 					addDeclaration('oncreate', templateProperties.oncreate.value);
641. 				}
642. 
643. 				if (templateProperties.onteardown) templateProperties.ondestroy = templateProperties.onteardown; // remove after v2
644. 				if (templateProperties.ondestroy && dom) {
645. 					addDeclaration('ondestroy', templateProperties.ondestroy.value);
646. 				}


File: src/generators/Generator.ts
Line number range: 692 - 695
Content:
692. 		this.computations = computations;
693. 		this.namespace = namespace;
694. 		this.templateProperties = templateProperties;
695. 	}


File: src/generators/dom/index.ts
Line number range: 1 - 437
Content:
1. import MagicString from 'magic-string';
2. import { parseExpressionAt } from 'acorn';
3. import annotateWithScopes from '../../utils/annotateWithScopes';
4. import isReference from '../../utils/isReference';
5. import { walk } from 'estree-walker';
6. import deindent from '../../utils/deindent';
7. import { stringify, escape } from '../../utils/stringify';
8. import CodeBuilder from '../../utils/CodeBuilder';
9. import reservedNames from '../../utils/reservedNames';
10. import visit from './visit';
11. import shared from './shared';
12. import Generator from '../Generator';
13. import Stylesheet from '../../css/Stylesheet';
14. import preprocess from './preprocess';
15. import Block from './Block';
16. import { version } from '../../../package.json';
17. import { Parsed, CompileOptions, Node } from '../../interfaces';
18. 
19. const test = typeof global !== 'undefined' && global.__svelte_test;
20. 
21. export class DomGenerator extends Generator {
22. 	blocks: (Block|string)[];
23. 	readonly: Set<string>;
24. 	metaBindings: string[];
25. 
26. 	hydratable: boolean;
27. 	legacy: boolean;
28. 
29. 	hasIntroTransitions: boolean;
30. 	hasOutroTransitions: boolean;
31. 	hasComplexBindings: boolean;
32. 
33. 	needsEncapsulateHelper: boolean;
34. 
35. 	constructor(
36. 		parsed: Parsed,
37. 		source: string,
38. 		name: string,
39. 		stylesheet: Stylesheet,
40. 		options: CompileOptions
41. 	) {
42. 		super(parsed, source, name, stylesheet, options, true);
43. 		this.blocks = [];
44. 
45. 		this.readonly = new Set();
46. 
47. 		this.hydratable = options.hydratable;
48. 		this.legacy = options.legacy;
49. 		this.needsEncapsulateHelper = false;
50. 
51. 		// initial values for e.g. window.innerWidth, if there's a <:Window> meta tag
52. 		this.metaBindings = [];
53. 	}
54. 
55. 	getUniqueNameMaker(params: string[]) {
56. 		const localUsedNames = new Set(params);
57. 
58. 		function add(name: string) {
59. 			localUsedNames.add(name);
60. 		}
61. 
62. 		reservedNames.forEach(add);
63. 		this.userVars.forEach(add);
64. 		for (const name in shared) {
65. 			localUsedNames.add(test ? `${name}$` : name);
66. 		}
67. 
68. 		return (name: string) => {
69. 			if (test) name = `${name}$`;
70. 			let alias = name;
71. 			for (
72. 				let i = 1;
73. 				this.usedNames.has(alias) ||
74. 				localUsedNames.has(alias);
75. 				alias = `${name}_${i++}`
76. 			);
77. 			localUsedNames.add(alias);
78. 			return alias;
79. 		};
80. 	}
81. }
82. 
83. export default function dom(
84. 	parsed: Parsed,
85. 	source: string,
86. 	stylesheet: Stylesheet,
87. 	options: CompileOptions
88. ) {
89. 	const format = options.format || 'es';
90. 
91. 	const generator = new DomGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
92. 
93. 	const {
94. 		computations,
95. 		name,
96. 		templateProperties,
97. 		namespace,
98. 	} = generator;
99. 
100. 	const { block, state } = preprocess(generator, namespace, parsed.html);
101. 
102. 	generator.stylesheet.warnOnUnusedSelectors(options.onwarn);
103. 
104. 	parsed.html.children.forEach((node: Node) => {
105. 		visit(generator, block, state, node, [], []);
106. 	});
107. 
108. 	const builder = new CodeBuilder();
109. 	const computationBuilder = new CodeBuilder();
110. 	const computationDeps = new Set();
111. 
112. 	if (computations.length) {
113. 		computations.forEach(({ key, deps }) => {
114. 			deps.forEach(dep => {
115. 				computationDeps.add(dep);
116. 			});
117. 
118. 			if (generator.readonly.has(key)) {
119. 				// <:Window> bindings
120. 				throw new Error(
121. 					`Cannot have a computed value '${key}' that clashes with a read-only property`
122. 				);
123. 			}
124. 
125. 			generator.readonly.add(key);
126. 
127. 			const condition = `${deps.map(dep => `changed.${dep}`).join(' || ')}`;
128. 
129. 			const statement = `if (@differs(state.${key}, (state.${key} = %computed-${key}(${deps
130. 				.map(dep => `state.${dep}`)
131. 				.join(', ')})))) changed.${key} = true;`;
132. 
133. 			computationBuilder.addConditional(condition, statement);
134. 		});
135. 	}
136. 
137. 	if (generator.javascript) {
138. 		builder.addBlock(generator.javascript);
139. 	}
140. 
141. 	if (generator.needsEncapsulateHelper) {
142. 		builder.addBlock(deindent`
143. 			function @encapsulateStyles(node) {
144. 				@setAttribute(node, "${generator.stylesheet.id}", "");
145. 			}
146. 		`);
147. 	}
148. 
149. 	const { css, cssMap } = generator.stylesheet.render(options.filename, !generator.customElement);
150. 	const styles = generator.stylesheet.hasStyles && stringify(options.dev ?
151. 		`${css}\n/*# sourceMappingURL=${cssMap.toUrl()} */` :
152. 		css, { onlyEscapeAtSymbol: true });
153. 
154. 	if (styles && generator.options.css !== false && !generator.customElement) {
155. 		builder.addBlock(deindent`
156. 			function @add_css() {
157. 				var style = @createElement("style");
158. 				style.id = '${generator.stylesheet.id}-style';
159. 				style.textContent = ${styles};
160. 				@appendNode(style, document.head);
161. 			}
162. 		`);
163. 	}
164. 
165. 	generator.blocks.forEach(block => {
166. 		builder.addBlock(block.toString());
167. 	});
168. 
169. 	const sharedPath = options.shared === true
170. 		? 'svelte/shared.js'
171. 		: options.shared;
172. 
173. 	const prototypeBase =
174. 		`${name}.prototype` +
175. 		(templateProperties.methods ? `, %methods` : '');
176. 	const proto = sharedPath
177. 		? `@proto`
178. 		: deindent`
179. 		{
180. 			${['destroy', 'get', 'fire', 'observe', 'on', 'set', 'teardown', '_set', '_mount', '_unmount']
181. 				.map(n => `${n}: @${n === 'teardown' ? 'destroy' : n}`)
182. 				.join(',\n')}
183. 		}`;
184. 
185. 	const debugName = `<${generator.customElement ? generator.tag : name}>`;
186. 
187. 	const constructorBody = deindent`
188. 		${options.dev && `this._debugName = '${debugName}';`}
189. 		${options.dev && !generator.customElement &&
190. 			`if (!options || (!options.target && !options._root)) throw new Error("'target' is a required option");`}
191. 		@init(this, options);
192. 		${generator.usesRefs && `this.refs = {};`}
193. 		this._state = @assign(${templateProperties.data ? '%data()' : '{}'}, options.data);
194. 		${generator.metaBindings}
195. 		${computations.length && `this._recompute({ ${Array.from(computationDeps).map(dep => `${dep}: 1`).join(', ')} }, this._state);`}
196. 		${options.dev &&
197. 			Array.from(generator.expectedProperties).map(
198. 				prop =>
199. 					`if (!('${prop}' in this._state)) console.warn("${debugName} was created without expected data property '${prop}'");`
200. 			)}
201. 		${generator.bindingGroups.length &&
202. 			`this._bindingGroups = [${Array(generator.bindingGroups.length).fill('[]').join(', ')}];`}
203. 
204. 		${templateProperties.ondestroy && `this._handlers.destroy = [%ondestroy]`}
205. 
206. 		${generator.slots.size && `this._slotted = options.slots || {};`}
207. 
208. 		${generator.customElement ?
209. 			deindent`
210. 				this.attachShadow({ mode: 'open' });
211. 				${css && `this.shadowRoot.innerHTML = \`<style>${escape(css, { onlyEscapeAtSymbol: true }).replace(/\\/g, '\\\\')}${options.dev ? `\n/*# sourceMappingURL=${cssMap.toUrl()} */` : ''}</style>\`;`}
212. 			` :
213. 			(generator.stylesheet.hasStyles && options.css !== false &&
214. 			`if (!document.getElementById("${generator.stylesheet.id}-style")) @add_css();`)
215. 		}
216. 
217. 		${templateProperties.oncreate && `var _oncreate = %oncreate.bind(this);`}
218. 
219. 		${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`
220. 			if (!options._root) {
221. 				this._oncreate = [${templateProperties.oncreate && `_oncreate`}];
222. 				${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}
223. 				${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}
224. 			} ${templateProperties.oncreate && deindent`
225. 				else {
226. 					this._root._oncreate.push(_oncreate);
227. 				}
228. 			`}
229. 		`}
230. 
231. 		${generator.slots.size && `this.slots = {};`}
232. 
233. 		this._fragment = @create_main_fragment(this._state, this);
234. 
235. 		${generator.customElement ? deindent`
236. 			this._fragment.c();
237. 			this._fragment.${block.hasIntroMethod ? 'i' : 'm'}(this.shadowRoot, null);
238. 
239. 			if (options.target) this._mount(options.target, options.anchor || null);
240. 		` : deindent`
241. 			if (options.target) {
242. 				${generator.hydratable
243. 					? deindent`
244. 						var nodes = @children(options.target);
245. 						options.hydrate ? this._fragment.l(nodes) : this._fragment.c();
246. 						nodes.forEach(@detachNode);
247. 					` :
248. 					deindent`
249. 						${options.dev && `if (options.hydrate) throw new Error("options.hydrate only works if the component was compiled with the \`hydratable: true\` option");`}
250. 						this._fragment.c();
251. 					`}
252. 				this._fragment.${block.hasIntroMethod ? 'i' : 'm'}(options.target, options.anchor || null);
253. 
254. 				${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`
255. 					${generator.hasComponents && `this._lock = true;`}
256. 					${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}
257. 					${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}
258. 					${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}
259. 					${generator.hasComponents && `this._lock = false;`}
260. 				`}
261. 			}
262. 		`}
263. 	`;
264. 
265. 	if (generator.customElement) {
266. 		const props = generator.props || Array.from(generator.expectedProperties);
267. 
268. 		builder.addBlock(deindent`
269. 			class ${name} extends HTMLElement {
270. 				constructor(options = {}) {
271. 					super();
272. 					${constructorBody}
273. 				}
274. 
275. 				static get observedAttributes() {
276. 					return ${JSON.stringify(props)};
277. 				}
278. 
279. 				${props.map(prop => deindent`
280. 					get ${prop}() {
281. 						return this.get('${prop}');
282. 					}
283. 
284. 					set ${prop}(value) {
285. 						this.set({ ${prop}: value });
286. 					}
287. 				`).join('\n\n')}
288. 
289. 				${generator.slots.size && deindent`
290. 					connectedCallback() {
291. 						Object.keys(this._slotted).forEach(key => {
292. 							this.appendChild(this._slotted[key]);
293. 						});
294. 					}`}
295. 
296. 				attributeChangedCallback(attr, oldValue, newValue) {
297. 					this.set({ [attr]: newValue });
298. 				}
299. 			}
300. 
301. 			customElements.define("${generator.tag}", ${name});
302. 			@assign(${prototypeBase}, ${proto}, {
303. 				_mount(target, anchor) {
304. 					target.insertBefore(this, anchor);
305. 				},
306. 
307. 				_unmount() {
308. 					this.parentNode.removeChild(this);
309. 				}
310. 			});
311. 		`);
312. 	} else {
313. 		builder.addBlock(deindent`
314. 			function ${name}(options) {
315. 				${constructorBody}
316. 			}
317. 
318. 			@assign(${prototypeBase}, ${proto});
319. 		`);
320. 	}
321. 
322. 	builder.addBlock(deindent`
323. 		${options.dev && deindent`
324. 			${name}.prototype._checkReadOnly = function _checkReadOnly(newState) {
325. 				${Array.from(generator.readonly).map(
326. 					prop =>
327. 						`if ('${prop}' in newState && !this._updatingReadonlyProperty) throw new Error("${debugName}: Cannot set read-only property '${prop}'");`
328. 				)}
329. 			};
330. 		`}
331. 
332. 		${computations.length ? deindent`
333. 			${name}.prototype._recompute = function _recompute(changed, state) {
334. 				${computationBuilder}
335. 			}
336. 		` : (!sharedPath && `${name}.prototype._recompute = @noop;`)}
337. 
338. 		${templateProperties.setup && `%setup(${name});`}
339. 	`);
340. 
341. 	const usedHelpers = new Set();
342. 
343. 	let result = builder
344. 		.toString()
345. 		.replace(/(%+|@+)(\w*(?:-\w*)?)/g, (match: string, sigil: string, name: string) => {
346. 			if (sigil === '@') {
347. 				if (name in shared) {
348. 					if (options.dev && `${name}Dev` in shared) name = `${name}Dev`;
349. 					usedHelpers.add(name);
350. 				}
351. 
352. 				return generator.alias(name);
353. 			}
354. 
355. 			if (sigil === '%') {
356. 				return generator.templateVars.get(name);
357. 			}
358. 
359. 			return sigil.slice(1) + name;
360. 		});
361. 
362. 	let helpers;
363. 
364. 	if (sharedPath) {
365. 		if (format !== 'es' && format !== 'cjs') {
366. 			throw new Error(`Components with shared helpers must be compiled with \`format: 'es'\` or \`format: 'cjs'\``);
367. 		}
368. 		const used = Array.from(usedHelpers).sort();
369. 		helpers = used.map(name => {
370. 			const alias = generator.alias(name);
371. 			return { name, alias };
372. 		});
373. 	} else {
374. 		let inlineHelpers = '';
375. 
376. 		usedHelpers.forEach(key => {
377. 			const str = shared[key];
378. 			const code = new MagicString(str);
379. 			const expression = parseExpressionAt(str, 0);
380. 
381. 			let scope = annotateWithScopes(expression);
382. 
383. 			walk(expression, {
384. 				enter(node: Node, parent: Node) {
385. 					if (node._scope) scope = node._scope;
386. 
387. 					if (
388. 						node.type === 'Identifier' &&
389. 						isReference(node, parent) &&
390. 						!scope.has(node.name)
391. 					) {
392. 						if (node.name in shared) {
393. 							// this helper function depends on another one
394. 							const dependency = node.name;
395. 							usedHelpers.add(dependency);
396. 
397. 							const alias = generator.alias(dependency);
398. 							if (alias !== node.name)
399. 								code.overwrite(node.start, node.end, alias);
400. 						}
401. 					}
402. 				},
403. 
404. 				leave(node: Node) {
405. 					if (node._scope) scope = scope.parent;
406. 				},
407. 			});
408. 
409. 			if (key === 'transitionManager') {
410. 				// special case
411. 				const global = `_svelteTransitionManager`;
412. 
413. 				inlineHelpers += `\n\nvar ${generator.alias('transitionManager')} = window.${global} || (window.${global} = ${code});\n\n`;
414. 			} else {
415. 				const alias = generator.alias(expression.id.name);
416. 				if (alias !== expression.id.name)
417. 					code.overwrite(expression.id.start, expression.id.end, alias);
418. 
419. 				inlineHelpers += `\n\n${code}`;
420. 			}
421. 		});
422. 
423. 		result += inlineHelpers;
424. 	}
425. 
426. 	const filename = options.filename && (
427. 		typeof process !== 'undefined' ? options.filename.replace(process.cwd(), '').replace(/^[\/\\]/, '') : options.filename
428. 	);
429. 
430. 	return generator.generate(result, options, {
431. 		banner: `/* ${filename ? `${filename} ` : ``}generated by Svelte v${version} */`,
432. 		sharedPath,
433. 		helpers,
434. 		name,
435. 		format,
436. 	});
437. }


File: src/generators/dom/preprocess.ts
Line number range: 1 - 545
Content:
1. import Block from './Block';
2. import { trimStart, trimEnd } from '../../utils/trim';
3. import { assign } from '../../shared/index.js';
4. import getStaticAttributeValue from '../../utils/getStaticAttributeValue';
5. import isChildOfComponent from '../shared/utils/isChildOfComponent';
6. import { DomGenerator } from './index';
7. import { Node } from '../../interfaces';
8. import { State } from './interfaces';
9. 
10. function isElseIf(node: Node) {
11. 	return (
12. 		node && node.children.length === 1 && node.children[0].type === 'IfBlock'
13. 	);
14. }
15. 
16. function getChildState(parent: State, child = {}) {
17. 	return assign(
18. 		{},
19. 		parent,
20. 		{ parentNode: null, parentNodes: 'nodes' },
21. 		child || {}
22. 	);
23. }
24. 
25. function createDebuggingComment(node: Node, generator: DomGenerator) {
26. 	const { locate, source } = generator;
27. 
28. 	let c = node.start;
29. 	if (node.type === 'ElseBlock') {
30. 		while (source[c] !== '{') c -= 1;
31. 		c -= 1;
32. 	}
33. 
34. 	let d = node.expression ? node.expression.end : c;
35. 	while (source[d] !== '}') d += 1;
36. 	d += 2;
37. 
38. 	const start = locate(c);
39. 	const loc = `(${start.line + 1}:${start.column})`;
40. 
41. 	return `${loc} ${source.slice(c, d)}`.replace(/\n/g, ' ');
42. }
43. 
44. function cannotUseInnerHTML(node: Node) {
45. 	while (node && node.canUseInnerHTML) {
46. 		node.canUseInnerHTML = false;
47. 		node = node.parent;
48. 	}
49. }
50. 
51. // Whitespace inside one of these elements will not result in
52. // a whitespace node being created in any circumstances. (This
53. // list is almost certainly very incomplete)
54. const elementsWithoutText = new Set([
55. 	'audio',
56. 	'datalist',
57. 	'dl',
58. 	'ol',
59. 	'optgroup',
60. 	'select',
61. 	'ul',
62. 	'video',
63. ]);
64. 
65. const preprocessors = {
66. 	MustacheTag: (
67. 		generator: DomGenerator,
68. 		block: Block,
69. 		state: State,
70. 		node: Node,
71. 		elementStack: Node[],
72. 		componentStack: Node[],
73. 		stripWhitespace: boolean
74. 	) => {
75. 		cannotUseInnerHTML(node);
76. 		node.var = block.getUniqueName('text');
77. 
78. 		const dependencies = block.findDependencies(node.expression);
79. 		block.addDependencies(dependencies);
80. 	},
81. 
82. 	RawMustacheTag: (
83. 		generator: DomGenerator,
84. 		block: Block,
85. 		state: State,
86. 		node: Node,
87. 		elementStack: Node[],
88. 		componentStack: Node[],
89. 		stripWhitespace: boolean
90. 	) => {
91. 		cannotUseInnerHTML(node);
92. 		node.var = block.getUniqueName('raw');
93. 
94. 		const dependencies = block.findDependencies(node.expression);
95. 		block.addDependencies(dependencies);
96. 	},
97. 
98. 	Text: (
99. 		generator: DomGenerator,
100. 		block: Block,
101. 		state: State,
102. 		node: Node,
103. 		elementStack: Node[],
104. 		componentStack: Node[],
105. 		stripWhitespace: boolean
106. 	) => {
107. 		if (!/\S/.test(node.data) && (state.namespace || elementsWithoutText.has(state.parentNodeName))) {
108. 			node.shouldSkip = true;
109. 			return;
110. 		}
111. 
112. 		node.var = block.getUniqueName(`text`);
113. 	},
114. 
115. 	IfBlock: (
116. 		generator: DomGenerator,
117. 		block: Block,
118. 		state: State,
119. 		node: Node,
120. 		inEachBlock: boolean,
121. 		elementStack: Node[],
122. 		componentStack: Node[],
123. 		stripWhitespace: boolean,
124. 		nextSibling: Node
125. 	) => {
126. 		cannotUseInnerHTML(node);
127. 
128. 		const blocks: Block[] = [];
129. 		let dynamic = false;
130. 		let hasIntros = false;
131. 		let hasOutros = false;
132. 
133. 		function attachBlocks(node: Node) {
134. 			node.var = block.getUniqueName(`if_block`);
135. 
136. 			const dependencies = block.findDependencies(node.expression);
137. 			block.addDependencies(dependencies);
138. 
139. 			node._block = block.child({
140. 				comment: createDebuggingComment(node, generator),
141. 				name: generator.getUniqueName(`create_if_block`),
142. 			});
143. 
144. 			node._state = getChildState(state);
145. 
146. 			blocks.push(node._block);
147. 			preprocessChildren(generator, node._block, node._state, node, inEachBlock, elementStack, componentStack, stripWhitespace, nextSibling);
148. 
149. 			if (node._block.dependencies.size > 0) {
150. 				dynamic = true;
151. 				block.addDependencies(node._block.dependencies);
152. 			}
153. 
154. 			if (node._block.hasIntroMethod) hasIntros = true;
155. 			if (node._block.hasOutroMethod) hasOutros = true;
156. 
157. 			if (isElseIf(node.else)) {
158. 				attachBlocks(node.else.children[0]);
159. 			} else if (node.else) {
160. 				node.else._block = block.child({
161. 					comment: createDebuggingComment(node.else, generator),
162. 					name: generator.getUniqueName(`create_if_block`),
163. 				});
164. 
165. 				node.else._state = getChildState(state);
166. 
167. 				blocks.push(node.else._block);
168. 				preprocessChildren(
169. 					generator,
170. 					node.else._block,
171. 					node.else._state,
172. 					node.else,
173. 					inEachBlock,
174. 					elementStack,
175. 					componentStack,
176. 					stripWhitespace,
177. 					nextSibling
178. 				);
179. 
180. 				if (node.else._block.dependencies.size > 0) {
181. 					dynamic = true;
182. 					block.addDependencies(node.else._block.dependencies);
183. 				}
184. 			}
185. 		}
186. 
187. 		attachBlocks(node);
188. 
189. 		blocks.forEach(block => {
190. 			block.hasUpdateMethod = dynamic;
191. 			block.hasIntroMethod = hasIntros;
192. 			block.hasOutroMethod = hasOutros;
193. 		});
194. 
195. 		generator.blocks.push(...blocks);
196. 	},
197. 
198. 	EachBlock: (
199. 		generator: DomGenerator,
200. 		block: Block,
201. 		state: State,
202. 		node: Node,
203. 		inEachBlock: boolean,
204. 		elementStack: Node[],
205. 		componentStack: Node[],
206. 		stripWhitespace: boolean,
207. 		nextSibling: Node
208. 	) => {
209. 		cannotUseInnerHTML(node);
210. 		node.var = block.getUniqueName(`each`);
211. 
212. 		const dependencies = block.findDependencies(node.expression);
213. 		block.addDependencies(dependencies);
214. 
215. 		const indexNames = new Map(block.indexNames);
216. 		const indexName =
217. 			node.index || block.getUniqueName(`${node.context}_index`);
218. 		indexNames.set(node.context, indexName);
219. 
220. 		const listNames = new Map(block.listNames);
221. 		const listName = block.getUniqueName(
222. 			(node.expression.type === 'MemberExpression' && !node.expression.computed) ? node.expression.property.name :
223. 			node.expression.type === 'Identifier' ? node.expression.name :
224. 			`each_value`
225. 		);
226. 		listNames.set(node.context, listName);
227. 
228. 		const context = generator.getUniqueName(node.context);
229. 		const contexts = new Map(block.contexts);
230. 		contexts.set(node.context, context);
231. 
232. 		const indexes = new Map(block.indexes);
233. 		if (node.index) indexes.set(node.index, node.context);
234. 
235. 		const changeableIndexes = new Map(block.changeableIndexes);
236. 		if (node.index) changeableIndexes.set(node.index, node.key);
237. 
238. 		const contextDependencies = new Map(block.contextDependencies);
239. 		contextDependencies.set(node.context, dependencies);
240. 
241. 		if (node.destructuredContexts) {
242. 			for (const i = 0; i < node.destructuredContexts.length; i++) {
243. 				contexts.set(node.destructuredContexts[i], `${context}[${i}]`);
244. 				contextDependencies.set(node.destructuredContexts[i], dependencies);
245. 			}
246. 		}
247. 
248. 		node._block = block.child({
249. 			comment: createDebuggingComment(node, generator),
250. 			name: generator.getUniqueName('create_each_block'),
251. 			expression: node.expression,
252. 			context: node.context,
253. 			key: node.key,
254. 
255. 			contextDependencies,
256. 			contexts,
257. 			indexes,
258. 			changeableIndexes,
259. 
260. 			listName,
261. 			indexName,
262. 
263. 			indexNames,
264. 			listNames,
265. 			params: block.params.concat(listName, context, indexName),
266. 		});
267. 
268. 		node._state = getChildState(state, {
269. 			inEachBlock: true,
270. 		});
271. 
272. 		generator.blocks.push(node._block);
273. 		preprocessChildren(generator, node._block, node._state, node, true, elementStack, componentStack, stripWhitespace, nextSibling);
274. 		block.addDependencies(node._block.dependencies);
275. 		node._block.hasUpdateMethod = node._block.dependencies.size > 0;
276. 
277. 		if (node.else) {
278. 			node.else._block = block.child({
279. 				comment: createDebuggingComment(node.else, generator),
280. 				name: generator.getUniqueName(`${node._block.name}_else`),
281. 			});
282. 
283. 			node.else._state = getChildState(state);
284. 
285. 			generator.blocks.push(node.else._block);
286. 			preprocessChildren(
287. 				generator,
288. 				node.else._block,
289. 				node.else._state,
290. 				node.else,
291. 				inEachBlock,
292. 				elementStack,
293. 				componentStack,
294. 				stripWhitespace,
295. 				nextSibling
296. 			);
297. 			node.else._block.hasUpdateMethod = node.else._block.dependencies.size > 0;
298. 		}
299. 	},
300. 
301. 	Element: (
302. 		generator: DomGenerator,
303. 		block: Block,
304. 		state: State,
305. 		node: Node,
306. 		inEachBlock: boolean,
307. 		elementStack: Node[],
308. 		componentStack: Node[],
309. 		stripWhitespace: boolean,
310. 		nextSibling: Node
311. 	) => {
312. 		if (node.name === 'slot') {
313. 			cannotUseInnerHTML(node);
314. 		}
315. 
316. 		node.attributes.forEach((attribute: Node) => {
317. 			if (attribute.type === 'Attribute' && attribute.value !== true) {
318. 				attribute.value.forEach((chunk: Node) => {
319. 					if (chunk.type !== 'Text') {
320. 						if (node.parent) cannotUseInnerHTML(node.parent);
321. 
322. 						const dependencies = block.findDependencies(chunk.expression);
323. 						block.addDependencies(dependencies);
324. 
325. 						// special case — <option value='{{foo}}'> — see below
326. 						if (
327. 							node.name === 'option' &&
328. 							attribute.name === 'value' &&
329. 							state.selectBindingDependencies
330. 						) {
331. 							state.selectBindingDependencies.forEach(prop => {
332. 								dependencies.forEach((dependency: string) => {
333. 									generator.indirectDependencies.get(prop).add(dependency);
334. 								});
335. 							});
336. 						}
337. 					}
338. 				});
339. 			} else {
340. 				if (node.parent) cannotUseInnerHTML(node.parent);
341. 
342. 				if (attribute.type === 'EventHandler' && attribute.expression) {
343. 					attribute.expression.arguments.forEach((arg: Node) => {
344. 						const dependencies = block.findDependencies(arg);
345. 						block.addDependencies(dependencies);
346. 					});
347. 				} else if (attribute.type === 'Binding') {
348. 					const dependencies = block.findDependencies(attribute.value);
349. 					block.addDependencies(dependencies);
350. 				} else if (attribute.type === 'Transition') {
351. 					if (attribute.intro)
352. 						generator.hasIntroTransitions = block.hasIntroMethod = true;
353. 					if (attribute.outro) {
354. 						generator.hasOutroTransitions = block.hasOutroMethod = true;
355. 						block.outros += 1;
356. 					}
357. 				}
358. 			}
359. 		});
360. 
361. 		// special case — in a case like this...
362. 		//
363. 		//   <select bind:value='foo'>
364. 		//     <option value='{{bar}}'>bar</option>
365. 		//     <option value='{{baz}}'>baz</option>
366. 		//   </option>
367. 		//
368. 		// ...we need to know that `foo` depends on `bar` and `baz`,
369. 		// so that if `foo.qux` changes, we know that we need to
370. 		// mark `bar` and `baz` as dirty too
371. 		if (node.name === 'select') {
372. 			cannotUseInnerHTML(node);
373. 
374. 			const value = node.attributes.find(
375. 				(attribute: Node) => attribute.name === 'value'
376. 			);
377. 			if (value) {
378. 				// TODO does this also apply to e.g. `<input type='checkbox' bind:group='foo'>`?
379. 				const dependencies = block.findDependencies(value.value);
380. 				state.selectBindingDependencies = dependencies;
381. 				dependencies.forEach((prop: string) => {
382. 					generator.indirectDependencies.set(prop, new Set());
383. 				});
384. 			} else {
385. 				state.selectBindingDependencies = null;
386. 			}
387. 		}
388. 
389. 		const isComponent =
390. 			generator.components.has(node.name) || node.name === ':Self';
391. 
392. 		if (isComponent) {
393. 			cannotUseInnerHTML(node);
394. 
395. 			node.var = block.getUniqueName(
396. 				(node.name === ':Self' ? generator.name : node.name).toLowerCase()
397. 			);
398. 
399. 			node._state = getChildState(state, {
400. 				parentNode: `${node.var}._slotted.default`
401. 			});
402. 		} else {
403. 			const slot = getStaticAttributeValue(node, 'slot');
404. 			if (slot && isChildOfComponent(node, generator)) {
405. 				cannotUseInnerHTML(node);
406. 				node.slotted = true;
407. 				// TODO validate slots — no nesting, no dynamic names...
408. 				const component = componentStack[componentStack.length - 1];
409. 				component._slots.add(slot);
410. 			}
411. 
412. 			node.var = block.getUniqueName(
413. 				node.name.replace(/[^a-zA-Z0-9_$]/g, '_')
414. 			);
415. 
416. 			node._state = getChildState(state, {
417. 				isTopLevel: false,
418. 				parentNode: node.var,
419. 				parentNodes: block.getUniqueName(`${node.var}_nodes`),
420. 				parentNodeName: node.name,
421. 				namespace: node.name === 'svg'
422. 					? 'http://www.w3.org/2000/svg'
423. 					: state.namespace,
424. 				allUsedContexts: [],
425. 			});
426. 
427. 			generator.stylesheet.apply(node, elementStack);
428. 		}
429. 
430. 		if (node.children.length) {
431. 			if (isComponent) {
432. 				if (node.children) node._slots = new Set(['default']);
433. 				preprocessChildren(generator, block, node._state, node, inEachBlock, elementStack, componentStack.concat(node), stripWhitespace, nextSibling);
434. 			} else {
435. 				if (node.name === 'pre' || node.name === 'textarea') stripWhitespace = false;
436. 				preprocessChildren(generator, block, node._state, node, inEachBlock, elementStack.concat(node), componentStack, stripWhitespace, nextSibling);
437. 			}
438. 		}
439. 	},
440. };
441. 
442. function preprocessChildren(
443. 	generator: DomGenerator,
444. 	block: Block,
445. 	state: State,
446. 	node: Node,
447. 	inEachBlock: boolean,
448. 	elementStack: Node[],
449. 	componentStack: Node[],
450. 	stripWhitespace: boolean,
451. 	nextSibling: Node
452. ) {
453. 	// glue text nodes together
454. 	const cleaned: Node[] = [];
455. 	let lastChild: Node;
456. 
457. 	node.children.forEach((child: Node) => {
458. 		if (child.type === 'Comment') return;
459. 
460. 		if (child.type === 'Text' && lastChild && lastChild.type === 'Text') {
461. 			lastChild.data += child.data;
462. 			lastChild.end = child.end;
463. 		} else {
464. 			if (child.type === 'Text' && stripWhitespace && cleaned.length === 0) {
465. 				child.data = trimStart(child.data);
466. 				if (child.data) cleaned.push(child);
467. 			} else {
468. 				cleaned.push(child);
469. 			}
470. 		}
471. 
472. 		lastChild = child;
473. 	});
474. 
475. 	lastChild = null;
476. 
477. 	cleaned.forEach((child: Node, i: number) => {
478. 		child.parent = node;
479. 		child.canUseInnerHTML = !generator.hydratable;
480. 
481. 		const preprocessor = preprocessors[child.type];
482. 		if (preprocessor) preprocessor(generator, block, state, child, inEachBlock, elementStack, componentStack, stripWhitespace, cleaned[i + 1] || nextSibling);
483. 
484. 		if (child.shouldSkip) return;
485. 
486. 		if (lastChild) lastChild.next = child;
487. 		child.prev = lastChild;
488. 
489. 		lastChild = child;
490. 	});
491. 
492. 	// We want to remove trailing whitespace inside an element/component/block,
493. 	// *unless* there is no whitespace between this node and its next sibling
494. 	if (stripWhitespace && lastChild && lastChild.type === 'Text') {
495. 		const shouldTrim = (
496. 			nextSibling ?  (nextSibling.type === 'Text' && /^\s/.test(nextSibling.data)) : !inEachBlock
497. 		);
498. 
499. 		if (shouldTrim) {
500. 			lastChild.data = trimEnd(lastChild.data);
501. 			if (!lastChild.data) {
502. 				cleaned.pop();
503. 				lastChild = cleaned[cleaned.length - 1];
504. 				lastChild.next = null;
505. 			}
506. 		}
507. 	}
508. 
509. 	node.children = cleaned;
510. }
511. 
512. export default function preprocess(
513. 	generator: DomGenerator,
514. 	namespace: string,
515. 	node: Node
516. ) {
517. 	const block = new Block({
518. 		generator,
519. 		name: '@create_main_fragment',
520. 		key: null,
521. 
522. 		contexts: new Map(),
523. 		indexes: new Map(),
524. 		changeableIndexes: new Map(),
525. 		contextDependencies: new Map(),
526. 
527. 		params: ['state'],
528. 		indexNames: new Map(),
529. 		listNames: new Map(),
530. 
531. 		dependencies: new Set(),
532. 	});
533. 
534. 	const state: State = {
535. 		namespace,
536. 		parentNode: null,
537. 		parentNodes: 'nodes'
538. 	};
539. 
540. 	generator.blocks.push(block);
541. 	preprocessChildren(generator, block, state, node, false, [], [], true, null);
542. 	block.hasUpdateMethod = true;
543. 
544. 	return { block, state };
545. }


File: src/generators/dom/visit.ts
Line number range: 1 - 17
Content:
1. import visitors from './visitors/index';
2. import { DomGenerator } from './index';
3. import Block from './Block';
4. import { Node } from '../../interfaces';
5. import { State } from './interfaces';
6. 
7. export default function visit(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	elementStack: Node[],
13. 	componentStack: Node[]
14. ) {
15. 	const visitor = visitors[node.type];
16. 	visitor(generator, block, state, node, elementStack, componentStack);
17. }


File: src/generators/dom/visitors/index.ts
Line number range: 1 - 18
Content:
1. import EachBlock from './EachBlock';
2. import Element from './Element/Element';
3. import IfBlock from './IfBlock';
4. import MustacheTag from './MustacheTag';
5. import RawMustacheTag from './RawMustacheTag';
6. import Text from './Text';
7. import { Visitor } from '../interfaces';
8. 
9. const visitors: Record<string, Visitor> = {
10. 	EachBlock,
11. 	Element,
12. 	IfBlock,
13. 	MustacheTag,
14. 	RawMustacheTag,
15. 	Text
16. };
17. 
18. export default visitors;


File: src/generators/shared/utils/wrapModule.ts
Line number range: 1 - 298
Content:
1. import deindent from '../../../utils/deindent';
2. import { CompileOptions, ModuleFormat, Node } from '../../../interfaces';
3. 
4. interface Dependency {
5. 	name: string;
6. 	statements: string[];
7. 	source: string;
8. }
9. 
10. const wrappers = { es, amd, cjs, iife, umd, eval: expr };
11. 
12. export default function wrapModule(
13. 	code: string,
14. 	format: ModuleFormat,
15. 	name: string,
16. 	options: CompileOptions,
17. 	banner: string,
18. 	sharedPath: string,
19. 	helpers: { name: string, alias: string }[],
20. 	imports: Node[],
21. 	source: string
22. ): string {
23. 	if (format === 'es') return es(code, name, options, banner, sharedPath, helpers, imports, source);
24. 
25. 	const dependencies = imports.map((declaration, i) => {
26. 		const defaultImport = declaration.specifiers.find(
27. 			(x: Node) =>
28. 				x.type === 'ImportDefaultSpecifier' ||
29. 				(x.type === 'ImportSpecifier' && x.imported.name === 'default')
30. 		);
31. 
32. 		const namespaceImport = declaration.specifiers.find(
33. 			(x: Node) => x.type === 'ImportNamespaceSpecifier'
34. 		);
35. 
36. 		const namedImports = declaration.specifiers.filter(
37. 			(x: Node) =>
38. 				x.type === 'ImportSpecifier' && x.imported.name !== 'default'
39. 		);
40. 
41. 		const name = defaultImport || namespaceImport
42. 			? (defaultImport || namespaceImport).local.name
43. 			: `__import${i}`;
44. 
45. 		const statements: string[] = [];
46. 
47. 		namedImports.forEach((specifier: Node) => {
48. 			statements.push(
49. 				`var ${specifier.local.name} = ${name}.${specifier.imported.name};`
50. 			);
51. 		});
52. 
53. 		if (defaultImport) {
54. 			statements.push(
55. 				`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`
56. 			);
57. 		}
58. 
59. 		return { name, statements, source: declaration.source.value };
60. 	});
61. 
62. 	if (format === 'amd') return amd(code, name, options, banner, dependencies);
63. 	if (format === 'cjs') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);
64. 	if (format === 'iife') return iife(code, name, options, banner, dependencies);
65. 	if (format === 'umd') return umd(code, name, options, banner, dependencies);
66. 	if (format === 'eval') return expr(code, name, options, banner, dependencies);
67. 
68. 	throw new Error(`Not implemented: ${format}`);
69. }
70. 
71. function es(
72. 	code: string,
73. 	name: string,
74. 	options: CompileOptions,
75. 	banner: string,
76. 	sharedPath: string,
77. 	helpers: { name: string, alias: string }[],
78. 	imports: Node[],
79. 	source: string
80. ) {
81. 	const importHelpers = helpers && (
82. 		`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(', ')} } from ${JSON.stringify(sharedPath)};`
83. 	);
84. 
85. 	const importBlock = imports.length > 0 && (
86. 		imports
87. 			.map((declaration: Node) => source.slice(declaration.start, declaration.end))
88. 			.join('\n')
89. 	);
90. 
91. 	return deindent`
92. 		${banner}
93. 		${importHelpers}
94. 		${importBlock}
95. 
96. 		${code}
97. 		export default ${name};`;
98. }
99. 
100. function amd(
101. 	code: string,
102. 	name: string,
103. 	options: CompileOptions,
104. 	banner: string,
105. 	dependencies: Dependency[]
106. ) {
107. 	const sourceString = dependencies.length
108. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
109. 		: '';
110. 
111. 	const id = options.amd && options.amd.id;
112. 
113. 	return deindent`
114. 		define(${id ? `"${id}", ` : ''}${sourceString}function(${paramString(dependencies)}) { "use strict";
115. 			${getCompatibilityStatements(dependencies)}
116. 
117. 			${code}
118. 			return ${name};
119. 		});`;
120. }
121. 
122. function cjs(
123. 	code: string,
124. 	name: string,
125. 	options: CompileOptions,
126. 	banner: string,
127. 	sharedPath: string,
128. 	helpers: { name: string, alias: string }[],
129. 	dependencies: Dependency[]
130. ) {
131. 	const SHARED = '__shared';
132. 	const helperBlock = helpers && (
133. 		`var ${SHARED} = require(${JSON.stringify(sharedPath)});\n` +
134. 		helpers.map(helper => {
135. 			return `var ${helper.alias} = ${SHARED}.${helper.name};`;
136. 		}).join('\n')
137. 	);
138. 
139. 	const requireBlock = dependencies.length > 0 && (
140. 		dependencies
141. 			.map(d => `var ${d.name} = require("${d.source}");`)
142. 			.join('\n\n')
143. 	);
144. 
145. 	return deindent`
146. 		${banner}
147. 		"use strict";
148. 
149. 		${helperBlock}
150. 		${requireBlock}
151. 		${getCompatibilityStatements(dependencies)}
152. 
153. 		${code}
154. 
155. 		module.exports = ${name};`
156. }
157. 
158. function iife(
159. 	code: string,
160. 	name: string,
161. 	options: CompileOptions,
162. 	banner: string,
163. 	dependencies: Dependency[]
164. ) {
165. 	if (!options.name) {
166. 		throw new Error(`Missing required 'name' option for IIFE export`);
167. 	}
168. 
169. 	const globals = getGlobals(dependencies, options);
170. 
171. 	return deindent`
172. 		${banner}
173. 		var ${options.name} = (function(${paramString(dependencies)}) { "use strict";
174. 			${getCompatibilityStatements(dependencies)}
175. 
176. 			${code}
177. 			return ${name};
178. 		}(${globals.join(', ')}));`;
179. }
180. 
181. function umd(
182. 	code: string,
183. 	name: string,
184. 	options: CompileOptions,
185. 	banner: string,
186. 	dependencies: Dependency[]
187. ) {
188. 	if (!options.name) {
189. 		throw new Error(`Missing required 'name' option for UMD export`);
190. 	}
191. 
192. 	const amdId = options.amd && options.amd.id ? `'${options.amd.id}', ` : '';
193. 
194. 	const amdDeps = dependencies.length
195. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
196. 		: '';
197. 
198. 	const cjsDeps = dependencies
199. 		.map(d => `require("${d.source}")`)
200. 		.join(', ');
201. 
202. 	const globals = getGlobals(dependencies, options);
203. 
204. 	return deindent`
205. 		${banner}
206. 		(function(global, factory) {
207. 			typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :
208. 			typeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :
209. 			(global.${options.name} = factory(${globals}));
210. 		}(this, (function (${paramString(dependencies)}) { "use strict";
211. 
212. 			${getCompatibilityStatements(dependencies)}
213. 
214. 			${code}
215. 
216. 			return ${name};
217. 
218. 		})));`;
219. }
220. 
221. function expr(
222. 	code: string,
223. 	name: string,
224. 	options: CompileOptions,
225. 	banner: string,
226. 	dependencies: Dependency[]
227. ) {
228. 	const globals = getGlobals(dependencies, options);
229. 
230. 	return deindent`
231. 		(function (${paramString(dependencies)}) { "use strict";
232. 			${banner}
233. 
234. 			${getCompatibilityStatements(dependencies)}
235. 
236. 			${code}
237. 
238. 			return ${name};
239. 		}(${globals.join(', ')}))`;
240. }
241. 
242. function paramString(dependencies: Dependency[]) {
243. 	return dependencies.map(dep => dep.name).join(', ');
244. }
245. 
246. function removeExtension(file: string) {
247. 	const index = file.lastIndexOf('.');
248. 	return ~index ? file.slice(0, index) : file;
249. }
250. 
251. function getCompatibilityStatements(dependencies: Dependency[]) {
252. 	if (!dependencies.length) return null;
253. 
254. 	const statements: string[] = [];
255. 
256. 	dependencies.forEach(dependency => {
257. 		statements.push(...dependency.statements);
258. 	});
259. 
260. 	return statements.join('\n');
261. }
262. 
263. function getGlobals(dependencies: Dependency[], options: CompileOptions) {
264. 	const { globals, onerror, onwarn } = options;
265. 	const globalFn = getGlobalFn(globals);
266. 
267. 	return dependencies.map(d => {
268. 		let name = globalFn(d.source);
269. 
270. 		if (!name) {
271. 			if (d.name.startsWith('__import')) {
272. 				const error = new Error(
273. 					`Could not determine name for imported module '${d.source}' – use options.globals`
274. 				);
275. 				onerror(error);
276. 			} else {
277. 				const warning = {
278. 					message: `No name was supplied for imported module '${d.source}'. Guessing '${d.name}', but you should use options.globals`,
279. 				};
280. 
281. 				onwarn(warning);
282. 			}
283. 
284. 			name = d.name;
285. 		}
286. 
287. 		return name;
288. 	});
289. }
290. 
291. function getGlobalFn(globals: any): (id: string) => string {
292. 	if (typeof globals === 'function') return globals;
293. 	if (typeof globals === 'object') {
294. 		return id => globals[id];
295. 	}
296. 
297. 	return () => undefined;
298. }


File: src/index.ts
Line number range: 1 - 78
Content:
1. import parse from './parse/index';
2. import validate from './validate/index';
3. import generate from './generators/dom/index';
4. import generateSSR from './generators/server-side-rendering/index';
5. import { assign } from './shared/index.js';
6. import { version } from '../package.json';
7. import Stylesheet from './css/Stylesheet';
8. import { Parsed, CompileOptions, Warning } from './interfaces';
9. 
10. function normalizeOptions(options: CompileOptions): CompileOptions {
11. 	let normalizedOptions = assign({ generate: 'dom' }, options);
12. 	const { onwarn, onerror } = normalizedOptions;
13. 	normalizedOptions.onwarn = onwarn
14. 		? (warning: Warning) => onwarn(warning, defaultOnwarn)
15. 		: defaultOnwarn;
16. 	normalizedOptions.onerror = onerror
17. 		? (error: Error) => onerror(error, defaultOnerror)
18. 		: defaultOnerror;
19. 	return normalizedOptions;
20. }
21. 
22. function defaultOnwarn(warning: Warning) {
23. 	if (warning.loc) {
24. 		console.warn(
25. 			`(${warning.loc.line}:${warning.loc.column}) – ${warning.message}`
26. 		); // eslint-disable-line no-console
27. 	} else {
28. 		console.warn(warning.message); // eslint-disable-line no-console
29. 	}
30. }
31. 
32. function defaultOnerror(error: Error) {
33. 	throw error;
34. }
35. 
36. export function compile(source: string, _options: CompileOptions) {
37. 	const options = normalizeOptions(_options);
38. 
39. 	let parsed: Parsed;
40. 
41. 	try {
42. 		parsed = parse(source, options);
43. 	} catch (err) {
44. 		options.onerror(err);
45. 		return;
46. 	}
47. 
48. 	const stylesheet = new Stylesheet(source, parsed, options.filename, options.cascade !== false);
49. 
50. 	validate(parsed, source, stylesheet, options);
51. 
52. 	const compiler = options.generate === 'ssr' ? generateSSR : generate;
53. 
54. 	return compiler(parsed, source, stylesheet, options);
55. }
56. 
57. export function create(source: string, _options: CompileOptions = {}) {
58. 	_options.format = 'eval';
59. 
60. 	const compiled = compile(source, _options);
61. 
62. 	if (!compiled || !compiled.code) {
63. 		return;
64. 	}
65. 
66. 	try {
67. 		return (0,eval)(compiled.code);
68. 	} catch (err) {
69. 		if (_options.onerror) {
70. 			_options.onerror(err);
71. 			return;
72. 		} else {
73. 			throw err;
74. 		}
75. 	}
76. }
77. 
78. export { parse, validate, version as VERSION };


File: src/interfaces.ts
Line number range: 1 - 80
Content:
1. export interface Node {
2. 	start: number;
3. 	end: number;
4. 	type: string;
5. 	[propName: string]: any;
6. }
7. 
8. export interface Parser {
9. 	readonly template: string;
10. 	readonly filename?: string;
11. 
12. 	index: number;
13. 	stack: Array<Node>;
14. 
15. 	html: Node;
16. 	css: Node;
17. 	js: Node;
18. 	metaTags: {};
19. }
20. 
21. export interface Parsed {
22. 	hash: number;
23. 	html: Node;
24. 	css: Node;
25. 	js: Node;
26. }
27. 
28. export interface Warning {
29. 	loc?: { line: number; column: number; pos?: number };
30. 	pos?: number;
31. 	message: string;
32. 	filename?: string;
33. 	frame?: string;
34. 	toString: () => string;
35. }
36. 
37. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';
38. 
39. export interface CompileOptions {
40. 	format?: ModuleFormat;
41. 	name?: string;
42. 	filename?: string;
43. 	generate?: string;
44. 	globals?: ((id: string) => string) | object;
45. 	amd?: {
46. 		id?: string;
47. 	};
48. 
49. 	outputFilename?: string;
50. 	cssOutputFilename?: string;
51. 
52. 	dev?: boolean;
53. 	shared?: boolean | string;
54. 	cascade?: boolean;
55. 	hydratable?: boolean;
56. 	legacy?: boolean;
57. 	customElement?: CustomElementOptions | true;
58. 	css?: boolean;
59. 
60. 	onerror?: (error: Error) => void;
61. 	onwarn?: (warning: Warning) => void;
62. }
63. 
64. export interface GenerateOptions {
65. 	name: string;
66. 	format: ModuleFormat;
67. 	banner?: string;
68. 	sharedPath?: string | boolean;
69. 	helpers?: { name: string, alias: string }[];
70. }
71. 
72. export interface Visitor {
73. 	enter: (node: Node) => void;
74. 	leave?: (node: Node) => void;
75. }
76. 
77. export interface CustomElementOptions {
78. 	tag?: string;
79. 	props?: string[];
80. }


File: src/parse/read/script.ts
Line number range: 1 - 38
Content:
1. import { parse } from 'acorn';
2. import repeat from '../../utils/repeat';
3. import { Parser } from '../index';
4. import { Node } from '../../interfaces';
5. 
6. const scriptClosingTag = '</script>';
7. 
8. export default function readScript(parser: Parser, start: number, attributes: Node[]) {
9. 	const scriptStart = parser.index;
10. 	const scriptEnd = parser.template.indexOf(scriptClosingTag, scriptStart);
11. 
12. 	if (scriptEnd === -1) parser.error(`<script> must have a closing tag`);
13. 
14. 	const source =
15. 		repeat(' ', scriptStart) + parser.template.slice(scriptStart, scriptEnd);
16. 	parser.index = scriptEnd + scriptClosingTag.length;
17. 
18. 	let ast;
19. 
20. 	try {
21. 		ast = parse(source, {
22. 			ecmaVersion: 8,
23. 			sourceType: 'module',
24. 		});
25. 	} catch (err) {
26. 		parser.acornError(err);
27. 	}
28. 
29. 	if (!ast.body.length) return null;
30. 
31. 	ast.start = scriptStart;
32. 	return {
33. 		start,
34. 		end: parser.index,
35. 		attributes,
36. 		content: ast,
37. 	};
38. }


File: src/utils/getObject.ts
Line number range: 1 - 6
Content:
1. import { Node } from '../interfaces';
2. 
3. export default function getObject(node: Node) {
4. 	while (node.type === 'MemberExpression') node = node.object;
5. 	return node;
6. }


File: src/utils/stringify.ts
Line number range: 1 - 9
Content:
1. export function stringify(data: string, options = {}) {
2. 	return JSON.stringify(escape(data, options));
3. }
4. 
5. export function escape(data: string, { onlyEscapeAtSymbol = false } = {}) {
6. 	return data.replace(onlyEscapeAtSymbol ? /(%+|@+)/g : /(%+|@+|#+)/g, (match: string) => {
7. 		return match + match[0];
8. 	});
9. }


File: src/validate/js/index.ts
Line number range: 1 - 93
Content:
1. import propValidators from './propValidators/index';
2. import fuzzymatch from '../utils/fuzzymatch';
3. import checkForDupes from './utils/checkForDupes';
4. import checkForComputedKeys from './utils/checkForComputedKeys';
5. import namespaces from '../../utils/namespaces';
6. import { Validator } from '../';
7. import { Node } from '../../interfaces';
8. 
9. const validPropList = Object.keys(propValidators);
10. 
11. export default function validateJs(validator: Validator, js: Node) {
12. 	js.content.body.forEach((node: Node) => {
13. 		// check there are no named exports
14. 		if (node.type === 'ExportNamedDeclaration') {
15. 			validator.error(`A component can only have a default export`, node.start);
16. 		}
17. 
18. 		if (node.type === 'ExportDefaultDeclaration') {
19. 			if (node.declaration.type !== 'ObjectExpression') {
20. 				return validator.error(
21. 					`Default export must be an object literal`,
22. 					node.declaration.start
23. 				);
24. 			}
25. 
26. 			checkForComputedKeys(validator, node.declaration.properties);
27. 			checkForDupes(validator, node.declaration.properties);
28. 
29. 			const props = validator.properties;
30. 
31. 			node.declaration.properties.forEach((prop: Node) => {
32. 				props.set(prop.key.name, prop);
33. 			});
34. 
35. 			// Remove these checks in version 2
36. 			if (props.has('oncreate') && props.has('onrender')) {
37. 				validator.error(
38. 					'Cannot have both oncreate and onrender',
39. 					props.get('onrender').start
40. 				);
41. 			}
42. 
43. 			if (props.has('ondestroy') && props.has('onteardown')) {
44. 				validator.error(
45. 					'Cannot have both ondestroy and onteardown',
46. 					props.get('onteardown').start
47. 				);
48. 			}
49. 
50. 			// ensure all exported props are valid
51. 			node.declaration.properties.forEach((prop: Node) => {
52. 				const propValidator = propValidators[prop.key.name];
53. 
54. 				if (propValidator) {
55. 					propValidator(validator, prop);
56. 				} else {
57. 					const match = fuzzymatch(prop.key.name, validPropList);
58. 					if (match) {
59. 						validator.error(
60. 							`Unexpected property '${prop.key.name}' (did you mean '${match}'?)`,
61. 							prop.start
62. 						);
63. 					} else if (/FunctionExpression/.test(prop.value.type)) {
64. 						validator.error(
65. 							`Unexpected property '${prop.key.name}' (did you mean to include it in 'methods'?)`,
66. 							prop.start
67. 						);
68. 					} else {
69. 						validator.error(
70. 							`Unexpected property '${prop.key.name}'`,
71. 							prop.start
72. 						);
73. 					}
74. 				}
75. 			});
76. 
77. 			if (props.has('namespace')) {
78. 				const ns = props.get('namespace').value.value;
79. 				validator.namespace = namespaces[ns] || ns;
80. 			}
81. 
82. 			validator.defaultExport = node;
83. 		}
84. 	});
85. 
86. 	['components', 'methods', 'helpers', 'transitions'].forEach(key => {
87. 		if (validator.properties.has(key)) {
88. 			validator.properties.get(key).value.properties.forEach((prop: Node) => {
89. 				validator[key].set(prop.key.name, prop.value);
90. 			});
91. 		}
92. 	});
93. }


File: src/validate/js/propValidators/oncreate.ts
Line number range: 1 - 14
Content:
1. import usesThisOrArguments from '../utils/usesThisOrArguments';
2. import { Validator } from '../../';
3. import { Node } from '../../../interfaces';
4. 
5. export default function oncreate(validator: Validator, prop: Node) {
6. 	if (prop.value.type === 'ArrowFunctionExpression') {
7. 		if (usesThisOrArguments(prop.value.body)) {
8. 			validator.error(
9. 				`'oncreate' should be a function expression, not an arrow function expression`,
10. 				prop.start
11. 			);
12. 		}
13. 	}
14. }

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-11 00:45:16,902 - thread-133013323122368.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The issue concerns the async keyword being removed from the oncreate lifecycle method. The provided context includes the key areas where lifecycle methods are parsed, validated, transformed, and emitted: (1) parse/read/script.ts shows Acorn parsing (which supports async functions), (2) validate/js/index.ts and propValidators/oncreate.ts handle lifecycle validation, (3) generators/Generator.ts contains addFunctionExpression/addArrowFunctionExpression and addDeclaration where oncreate/ondestroy are transformed—these helpers currently don’t preserve node.async, explaining the removal, and (4) generators/dom/index.ts shows how %oncreate is bound and used. This is sufficient to understand and fix the issue without further files. No additional context is necessary.' query='' extra_requirements='' purpose='We can now point to the exact transformation that drops async and suggest preserving node.async in Generator.ts when constructing functions.'
2025-11-11 00:45:16,908 - thread-133013323122368.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='src/generators/Generator.ts', content="1. import MagicString, { Bundle } from 'magic-string';\n2. import { walk } from 'estree-walker';\n3. import { getLocator } from 'locate-character';\n4. import deindent from '../utils/deindent';\n5. import CodeBuilder from '../utils/CodeBuilder';\n6. import getCodeFrame from '../utils/getCodeFrame';\n7. import isReference from '../utils/isReference';\n8. import flattenReference from '../utils/flattenReference';\n9. import globalWhitelist from '../utils/globalWhitelist';\n10. import reservedNames from '../utils/reservedNames';\n11. import namespaces from '../utils/namespaces';\n12. import { removeNode, removeObjectKey } from '../utils/removeNode';\n13. import wrapModule from './shared/utils/wrapModule';\n14. import annotateWithScopes from '../utils/annotateWithScopes';\n15. import clone from '../utils/clone';\n16. import DomBlock from './dom/Block';\n17. import SsrBlock from './server-side-rendering/Block';\n18. import Stylesheet from '../css/Stylesheet';\n19. import { Node, GenerateOptions, Parsed, CompileOptions, CustomElementOptions } from '../interfaces';\n20. ", start_line_number=1, end_line_number=20), Context(relative_path='src/generators/Generator.ts', content='94. \ttemplateProperties: Record<string, Node>;\n95. \tslots: Set<string>;\n96. \tjavascript: string;\n97. \n98. \tcode: MagicString;\n99. \n100. \tbindingGroups: string[];\n101. \tindirectDependencies: Map<string, Set<string>>;\n102. \texpectedProperties: Set<string>;\n103. \tusesRefs: boolean;\n104. \n105. \tlocate: (c: number) => { line: number, column: number };\n106. \n107. \tstylesheet: Stylesheet;\n108. \n109. \tuserVars: Set<string>;\n110. \ttemplateVars: Map<string, string>;\n111. \taliases: Map<string, string>;', start_line_number=94, end_line_number=111), Context(relative_path='src/generators/Generator.ts', content='154. \t\tthis.templateVars = new Map();\n155. \t\tthis.aliases = new Map();\n156. \t\tthis.usedNames = new Set();\n157. \n158. \t\tthis.parseJs(dom);\n159. \t\tthis.name = this.alias(name);\n160. ', start_line_number=154, end_line_number=160), Context(relative_path='src/generators/Generator.ts', content='461. \t\tconst computations: Computation[] = [];\n462. \t\tconst templateProperties: Record<string, Node> = {};\n463. \t\tconst componentDefinition = new CodeBuilder();\n464. \n465. \t\tlet namespace = null;\n466. ', start_line_number=461, end_line_number=466), Context(relative_path='src/generators/Generator.ts', content="494. \t\t\tconst defaultExport = this.defaultExport = body.find(\n495. \t\t\t\t(node: Node) => node.type === 'ExportDefaultDeclaration'\n496. \t\t\t);\n497. \n498. \t\t\tif (defaultExport) {\n499. \t\t\t\tdefaultExport.declaration.properties.forEach((prop: Node) => {\n500. \t\t\t\t\ttemplateProperties[prop.key.name] = prop;\n501. \t\t\t\t});\n502. \n503. \t\t\t\t['helpers', 'events', 'components', 'transitions'].forEach(key => {\n504. \t\t\t\t\tif (templateProperties[key]) {\n505. \t\t\t\t\t\ttemplateProperties[key].value.properties.forEach((prop: Node) => {\n506. \t\t\t\t\t\t\tthis[key].add(prop.key.name);\n507. \t\t\t\t\t\t});\n508. \t\t\t\t\t}\n509. \t\t\t\t});", start_line_number=494, end_line_number=509), Context(relative_path='src/generators/Generator.ts', content="511. \t\t\t\tconst addArrowFunctionExpression = (name: string, node: Node) => {\n512. \t\t\t\t\tconst { body, params } = node;\n513. \n514. \t\t\t\t\tconst paramString = params.length ?\n515. \t\t\t\t\t\t`[✂${params[0].start}-${params[params.length - 1].end}✂]` :\n516. \t\t\t\t\t\t``;\n517. \n518. \t\t\t\t\tif (body.type === 'BlockStatement') {\n519. \t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n520. \t\t\t\t\t\t\tfunction ${name}(${paramString}) [✂${body.start}-${body.end}✂]\n521. \t\t\t\t\t\t`);\n522. \t\t\t\t\t} else {\n523. \t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n524. \t\t\t\t\t\t\tfunction ${name}(${paramString}) {\n525. \t\t\t\t\t\t\t\treturn [✂${body.start}-${body.end}✂];\n526. \t\t\t\t\t\t\t}\n527. \t\t\t\t\t\t`);\n528. \t\t\t\t\t}\n529. \t\t\t\t};\n530. \n531. \t\t\t\tconst addFunctionExpression = (name: string, node: Node) => {\n532. \t\t\t\t\tlet c = node.start;\n533. \t\t\t\t\twhile (this.source[c] !== '(') c += 1;\n534. \t\t\t\t\tcomponentDefinition.addBlock(deindent`\n535. \t\t\t\t\t\tfunction ${name}[✂${c}-${node.end}✂];\n536. \t\t\t\t\t`);\n537. \t\t\t\t};\n538. \n539. \t\t\t\tconst addValue = (name: string, node: Node) => {\n540. \t\t\t\t\tcomponentDefinition.addBlock(deindent`\n541. \t\t\t\t\t\tvar ${name} = [✂${node.start}-${node.end}✂];\n542. \t\t\t\t\t`);\n543. \t\t\t\t};", start_line_number=511, end_line_number=543), Context(relative_path='src/generators/Generator.ts', content="545. \t\t\t\tconst addDeclaration = (key: string, node: Node, disambiguator?: string) => {\n546. \t\t\t\t\tconst qualified = disambiguator ? `${disambiguator}-${key}` : key;\n547. \n548. \t\t\t\t\tif (node.type === 'Identifier' && node.name === key) {\n549. \t\t\t\t\t\tthis.templateVars.set(qualified, key);\n550. \t\t\t\t\t\treturn;\n551. \t\t\t\t\t}\n552. \n553. \t\t\t\t\tlet name = this.getUniqueName(key);\n554. \t\t\t\t\tthis.templateVars.set(qualified, name);\n555. \n556. \t\t\t\t\t// deindent\n557. \t\t\t\t\tconst indentationLevel = getIndentationLevel(source, node.start);\n558. \t\t\t\t\tif (indentationLevel) {\n559. \t\t\t\t\t\tremoveIndentation(code, node.start, node.end, indentationLevel, indentExclusionRanges);\n560. \t\t\t\t\t}\n561. \n562. \t\t\t\t\tif (node.type === 'ArrowFunctionExpression') {\n563. \t\t\t\t\t\taddArrowFunctionExpression(name, node);\n564. \t\t\t\t\t} else if (node.type === 'FunctionExpression') {\n565. \t\t\t\t\t\taddFunctionExpression(name, node);\n566. \t\t\t\t\t} else {\n567. \t\t\t\t\t\taddValue(name, node);\n568. \t\t\t\t\t}\n569. \t\t\t\t};", start_line_number=545, end_line_number=569), Context(relative_path='src/generators/Generator.ts', content="638. \t\t\t\tif (templateProperties.onrender) templateProperties.oncreate = templateProperties.onrender; // remove after v2\n639. \t\t\t\tif (templateProperties.oncreate && dom) {\n640. \t\t\t\t\taddDeclaration('oncreate', templateProperties.oncreate.value);\n641. \t\t\t\t}\n642. \n643. \t\t\t\tif (templateProperties.onteardown) templateProperties.ondestroy = templateProperties.onteardown; // remove after v2\n644. \t\t\t\tif (templateProperties.ondestroy && dom) {\n645. \t\t\t\t\taddDeclaration('ondestroy', templateProperties.ondestroy.value);\n646. \t\t\t\t}", start_line_number=638, end_line_number=646), Context(relative_path='src/generators/Generator.ts', content='692. \t\tthis.computations = computations;\n693. \t\tthis.namespace = namespace;\n694. \t\tthis.templateProperties = templateProperties;\n695. \t}', start_line_number=692, end_line_number=695), Context(relative_path='src/generators/dom/index.ts', content='1. import MagicString from \'magic-string\';\n2. import { parseExpressionAt } from \'acorn\';\n3. import annotateWithScopes from \'../../utils/annotateWithScopes\';\n4. import isReference from \'../../utils/isReference\';\n5. import { walk } from \'estree-walker\';\n6. import deindent from \'../../utils/deindent\';\n7. import { stringify, escape } from \'../../utils/stringify\';\n8. import CodeBuilder from \'../../utils/CodeBuilder\';\n9. import reservedNames from \'../../utils/reservedNames\';\n10. import visit from \'./visit\';\n11. import shared from \'./shared\';\n12. import Generator from \'../Generator\';\n13. import Stylesheet from \'../../css/Stylesheet\';\n14. import preprocess from \'./preprocess\';\n15. import Block from \'./Block\';\n16. import { version } from \'../../../package.json\';\n17. import { Parsed, CompileOptions, Node } from \'../../interfaces\';\n18. \n19. const test = typeof global !== \'undefined\' && global.__svelte_test;\n20. \n21. export class DomGenerator extends Generator {\n22. \tblocks: (Block|string)[];\n23. \treadonly: Set<string>;\n24. \tmetaBindings: string[];\n25. \n26. \thydratable: boolean;\n27. \tlegacy: boolean;\n28. \n29. \thasIntroTransitions: boolean;\n30. \thasOutroTransitions: boolean;\n31. \thasComplexBindings: boolean;\n32. \n33. \tneedsEncapsulateHelper: boolean;\n34. \n35. \tconstructor(\n36. \t\tparsed: Parsed,\n37. \t\tsource: string,\n38. \t\tname: string,\n39. \t\tstylesheet: Stylesheet,\n40. \t\toptions: CompileOptions\n41. \t) {\n42. \t\tsuper(parsed, source, name, stylesheet, options, true);\n43. \t\tthis.blocks = [];\n44. \n45. \t\tthis.readonly = new Set();\n46. \n47. \t\tthis.hydratable = options.hydratable;\n48. \t\tthis.legacy = options.legacy;\n49. \t\tthis.needsEncapsulateHelper = false;\n50. \n51. \t\t// initial values for e.g. window.innerWidth, if there\'s a <:Window> meta tag\n52. \t\tthis.metaBindings = [];\n53. \t}\n54. \n55. \tgetUniqueNameMaker(params: string[]) {\n56. \t\tconst localUsedNames = new Set(params);\n57. \n58. \t\tfunction add(name: string) {\n59. \t\t\tlocalUsedNames.add(name);\n60. \t\t}\n61. \n62. \t\treservedNames.forEach(add);\n63. \t\tthis.userVars.forEach(add);\n64. \t\tfor (const name in shared) {\n65. \t\t\tlocalUsedNames.add(test ? `${name}$` : name);\n66. \t\t}\n67. \n68. \t\treturn (name: string) => {\n69. \t\t\tif (test) name = `${name}$`;\n70. \t\t\tlet alias = name;\n71. \t\t\tfor (\n72. \t\t\t\tlet i = 1;\n73. \t\t\t\tthis.usedNames.has(alias) ||\n74. \t\t\t\tlocalUsedNames.has(alias);\n75. \t\t\t\talias = `${name}_${i++}`\n76. \t\t\t);\n77. \t\t\tlocalUsedNames.add(alias);\n78. \t\t\treturn alias;\n79. \t\t};\n80. \t}\n81. }\n82. \n83. export default function dom(\n84. \tparsed: Parsed,\n85. \tsource: string,\n86. \tstylesheet: Stylesheet,\n87. \toptions: CompileOptions\n88. ) {\n89. \tconst format = options.format || \'es\';\n90. \n91. \tconst generator = new DomGenerator(parsed, source, options.name || \'SvelteComponent\', stylesheet, options);\n92. \n93. \tconst {\n94. \t\tcomputations,\n95. \t\tname,\n96. \t\ttemplateProperties,\n97. \t\tnamespace,\n98. \t} = generator;\n99. \n100. \tconst { block, state } = preprocess(generator, namespace, parsed.html);\n101. \n102. \tgenerator.stylesheet.warnOnUnusedSelectors(options.onwarn);\n103. \n104. \tparsed.html.children.forEach((node: Node) => {\n105. \t\tvisit(generator, block, state, node, [], []);\n106. \t});\n107. \n108. \tconst builder = new CodeBuilder();\n109. \tconst computationBuilder = new CodeBuilder();\n110. \tconst computationDeps = new Set();\n111. \n112. \tif (computations.length) {\n113. \t\tcomputations.forEach(({ key, deps }) => {\n114. \t\t\tdeps.forEach(dep => {\n115. \t\t\t\tcomputationDeps.add(dep);\n116. \t\t\t});\n117. \n118. \t\t\tif (generator.readonly.has(key)) {\n119. \t\t\t\t// <:Window> bindings\n120. \t\t\t\tthrow new Error(\n121. \t\t\t\t\t`Cannot have a computed value \'${key}\' that clashes with a read-only property`\n122. \t\t\t\t);\n123. \t\t\t}\n124. \n125. \t\t\tgenerator.readonly.add(key);\n126. \n127. \t\t\tconst condition = `${deps.map(dep => `changed.${dep}`).join(\' || \')}`;\n128. \n129. \t\t\tconst statement = `if (@differs(state.${key}, (state.${key} = %computed-${key}(${deps\n130. \t\t\t\t.map(dep => `state.${dep}`)\n131. \t\t\t\t.join(\', \')})))) changed.${key} = true;`;\n132. \n133. \t\t\tcomputationBuilder.addConditional(condition, statement);\n134. \t\t});\n135. \t}\n136. \n137. \tif (generator.javascript) {\n138. \t\tbuilder.addBlock(generator.javascript);\n139. \t}\n140. \n141. \tif (generator.needsEncapsulateHelper) {\n142. \t\tbuilder.addBlock(deindent`\n143. \t\t\tfunction @encapsulateStyles(node) {\n144. \t\t\t\t@setAttribute(node, "${generator.stylesheet.id}", "");\n145. \t\t\t}\n146. \t\t`);\n147. \t}\n148. \n149. \tconst { css, cssMap } = generator.stylesheet.render(options.filename, !generator.customElement);\n150. \tconst styles = generator.stylesheet.hasStyles && stringify(options.dev ?\n151. \t\t`${css}\\n/*# sourceMappingURL=${cssMap.toUrl()} */` :\n152. \t\tcss, { onlyEscapeAtSymbol: true });\n153. \n154. \tif (styles && generator.options.css !== false && !generator.customElement) {\n155. \t\tbuilder.addBlock(deindent`\n156. \t\t\tfunction @add_css() {\n157. \t\t\t\tvar style = @createElement("style");\n158. \t\t\t\tstyle.id = \'${generator.stylesheet.id}-style\';\n159. \t\t\t\tstyle.textContent = ${styles};\n160. \t\t\t\t@appendNode(style, document.head);\n161. \t\t\t}\n162. \t\t`);\n163. \t}\n164. \n165. \tgenerator.blocks.forEach(block => {\n166. \t\tbuilder.addBlock(block.toString());\n167. \t});\n168. \n169. \tconst sharedPath = options.shared === true\n170. \t\t? \'svelte/shared.js\'\n171. \t\t: options.shared;\n172. \n173. \tconst prototypeBase =\n174. \t\t`${name}.prototype` +\n175. \t\t(templateProperties.methods ? `, %methods` : \'\');\n176. \tconst proto = sharedPath\n177. \t\t? `@proto`\n178. \t\t: deindent`\n179. \t\t{\n180. \t\t\t${[\'destroy\', \'get\', \'fire\', \'observe\', \'on\', \'set\', \'teardown\', \'_set\', \'_mount\', \'_unmount\']\n181. \t\t\t\t.map(n => `${n}: @${n === \'teardown\' ? \'destroy\' : n}`)\n182. \t\t\t\t.join(\',\\n\')}\n183. \t\t}`;\n184. \n185. \tconst debugName = `<${generator.customElement ? generator.tag : name}>`;\n186. \n187. \tconst constructorBody = deindent`\n188. \t\t${options.dev && `this._debugName = \'${debugName}\';`}\n189. \t\t${options.dev && !generator.customElement &&\n190. \t\t\t`if (!options || (!options.target && !options._root)) throw new Error("\'target\' is a required option");`}\n191. \t\t@init(this, options);\n192. \t\t${generator.usesRefs && `this.refs = {};`}\n193. \t\tthis._state = @assign(${templateProperties.data ? \'%data()\' : \'{}\'}, options.data);\n194. \t\t${generator.metaBindings}\n195. \t\t${computations.length && `this._recompute({ ${Array.from(computationDeps).map(dep => `${dep}: 1`).join(\', \')} }, this._state);`}\n196. \t\t${options.dev &&\n197. \t\t\tArray.from(generator.expectedProperties).map(\n198. \t\t\t\tprop =>\n199. \t\t\t\t\t`if (!(\'${prop}\' in this._state)) console.warn("${debugName} was created without expected data property \'${prop}\'");`\n200. \t\t\t)}\n201. \t\t${generator.bindingGroups.length &&\n202. \t\t\t`this._bindingGroups = [${Array(generator.bindingGroups.length).fill(\'[]\').join(\', \')}];`}\n203. \n204. \t\t${templateProperties.ondestroy && `this._handlers.destroy = [%ondestroy]`}\n205. \n206. \t\t${generator.slots.size && `this._slotted = options.slots || {};`}\n207. \n208. \t\t${generator.customElement ?\n209. \t\t\tdeindent`\n210. \t\t\t\tthis.attachShadow({ mode: \'open\' });\n211. \t\t\t\t${css && `this.shadowRoot.innerHTML = \\`<style>${escape(css, { onlyEscapeAtSymbol: true }).replace(/\\\\/g, \'\\\\\\\\\')}${options.dev ? `\\n/*# sourceMappingURL=${cssMap.toUrl()} */` : \'\'}</style>\\`;`}\n212. \t\t\t` :\n213. \t\t\t(generator.stylesheet.hasStyles && options.css !== false &&\n214. \t\t\t`if (!document.getElementById("${generator.stylesheet.id}-style")) @add_css();`)\n215. \t\t}\n216. \n217. \t\t${templateProperties.oncreate && `var _oncreate = %oncreate.bind(this);`}\n218. \n219. \t\t${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`\n220. \t\t\tif (!options._root) {\n221. \t\t\t\tthis._oncreate = [${templateProperties.oncreate && `_oncreate`}];\n222. \t\t\t\t${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}\n223. \t\t\t\t${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}\n224. \t\t\t} ${templateProperties.oncreate && deindent`\n225. \t\t\t\telse {\n226. \t\t\t\t\tthis._root._oncreate.push(_oncreate);\n227. \t\t\t\t}\n228. \t\t\t`}\n229. \t\t`}\n230. \n231. \t\t${generator.slots.size && `this.slots = {};`}\n232. \n233. \t\tthis._fragment = @create_main_fragment(this._state, this);\n234. \n235. \t\t${generator.customElement ? deindent`\n236. \t\t\tthis._fragment.c();\n237. \t\t\tthis._fragment.${block.hasIntroMethod ? \'i\' : \'m\'}(this.shadowRoot, null);\n238. \n239. \t\t\tif (options.target) this._mount(options.target, options.anchor || null);\n240. \t\t` : deindent`\n241. \t\t\tif (options.target) {\n242. \t\t\t\t${generator.hydratable\n243. \t\t\t\t\t? deindent`\n244. \t\t\t\t\t\tvar nodes = @children(options.target);\n245. \t\t\t\t\t\toptions.hydrate ? this._fragment.l(nodes) : this._fragment.c();\n246. \t\t\t\t\t\tnodes.forEach(@detachNode);\n247. \t\t\t\t\t` :\n248. \t\t\t\t\tdeindent`\n249. \t\t\t\t\t\t${options.dev && `if (options.hydrate) throw new Error("options.hydrate only works if the component was compiled with the \\`hydratable: true\\` option");`}\n250. \t\t\t\t\t\tthis._fragment.c();\n251. \t\t\t\t\t`}\n252. \t\t\t\tthis._fragment.${block.hasIntroMethod ? \'i\' : \'m\'}(options.target, options.anchor || null);\n253. \n254. \t\t\t\t${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`\n255. \t\t\t\t\t${generator.hasComponents && `this._lock = true;`}\n256. \t\t\t\t\t${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}\n257. \t\t\t\t\t${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}\n258. \t\t\t\t\t${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}\n259. \t\t\t\t\t${generator.hasComponents && `this._lock = false;`}\n260. \t\t\t\t`}\n261. \t\t\t}\n262. \t\t`}\n263. \t`;\n264. \n265. \tif (generator.customElement) {\n266. \t\tconst props = generator.props || Array.from(generator.expectedProperties);\n267. \n268. \t\tbuilder.addBlock(deindent`\n269. \t\t\tclass ${name} extends HTMLElement {\n270. \t\t\t\tconstructor(options = {}) {\n271. \t\t\t\t\tsuper();\n272. \t\t\t\t\t${constructorBody}\n273. \t\t\t\t}\n274. \n275. \t\t\t\tstatic get observedAttributes() {\n276. \t\t\t\t\treturn ${JSON.stringify(props)};\n277. \t\t\t\t}\n278. \n279. \t\t\t\t${props.map(prop => deindent`\n280. \t\t\t\t\tget ${prop}() {\n281. \t\t\t\t\t\treturn this.get(\'${prop}\');\n282. \t\t\t\t\t}\n283. \n284. \t\t\t\t\tset ${prop}(value) {\n285. \t\t\t\t\t\tthis.set({ ${prop}: value });\n286. \t\t\t\t\t}\n287. \t\t\t\t`).join(\'\\n\\n\')}\n288. \n289. \t\t\t\t${generator.slots.size && deindent`\n290. \t\t\t\t\tconnectedCallback() {\n291. \t\t\t\t\t\tObject.keys(this._slotted).forEach(key => {\n292. \t\t\t\t\t\t\tthis.appendChild(this._slotted[key]);\n293. \t\t\t\t\t\t});\n294. \t\t\t\t\t}`}\n295. \n296. \t\t\t\tattributeChangedCallback(attr, oldValue, newValue) {\n297. \t\t\t\t\tthis.set({ [attr]: newValue });\n298. \t\t\t\t}\n299. \t\t\t}\n300. \n301. \t\t\tcustomElements.define("${generator.tag}", ${name});\n302. \t\t\t@assign(${prototypeBase}, ${proto}, {\n303. \t\t\t\t_mount(target, anchor) {\n304. \t\t\t\t\ttarget.insertBefore(this, anchor);\n305. \t\t\t\t},\n306. \n307. \t\t\t\t_unmount() {\n308. \t\t\t\t\tthis.parentNode.removeChild(this);\n309. \t\t\t\t}\n310. \t\t\t});\n311. \t\t`);\n312. \t} else {\n313. \t\tbuilder.addBlock(deindent`\n314. \t\t\tfunction ${name}(options) {\n315. \t\t\t\t${constructorBody}\n316. \t\t\t}\n317. \n318. \t\t\t@assign(${prototypeBase}, ${proto});\n319. \t\t`);\n320. \t}\n321. \n322. \tbuilder.addBlock(deindent`\n323. \t\t${options.dev && deindent`\n324. \t\t\t${name}.prototype._checkReadOnly = function _checkReadOnly(newState) {\n325. \t\t\t\t${Array.from(generator.readonly).map(\n326. \t\t\t\t\tprop =>\n327. \t\t\t\t\t\t`if (\'${prop}\' in newState && !this._updatingReadonlyProperty) throw new Error("${debugName}: Cannot set read-only property \'${prop}\'");`\n328. \t\t\t\t)}\n329. \t\t\t};\n330. \t\t`}\n331. \n332. \t\t${computations.length ? deindent`\n333. \t\t\t${name}.prototype._recompute = function _recompute(changed, state) {\n334. \t\t\t\t${computationBuilder}\n335. \t\t\t}\n336. \t\t` : (!sharedPath && `${name}.prototype._recompute = @noop;`)}\n337. \n338. \t\t${templateProperties.setup && `%setup(${name});`}\n339. \t`);\n340. \n341. \tconst usedHelpers = new Set();\n342. \n343. \tlet result = builder\n344. \t\t.toString()\n345. \t\t.replace(/(%+|@+)(\\w*(?:-\\w*)?)/g, (match: string, sigil: string, name: string) => {\n346. \t\t\tif (sigil === \'@\') {\n347. \t\t\t\tif (name in shared) {\n348. \t\t\t\t\tif (options.dev && `${name}Dev` in shared) name = `${name}Dev`;\n349. \t\t\t\t\tusedHelpers.add(name);\n350. \t\t\t\t}\n351. \n352. \t\t\t\treturn generator.alias(name);\n353. \t\t\t}\n354. \n355. \t\t\tif (sigil === \'%\') {\n356. \t\t\t\treturn generator.templateVars.get(name);\n357. \t\t\t}\n358. \n359. \t\t\treturn sigil.slice(1) + name;\n360. \t\t});\n361. \n362. \tlet helpers;\n363. \n364. \tif (sharedPath) {\n365. \t\tif (format !== \'es\' && format !== \'cjs\') {\n366. \t\t\tthrow new Error(`Components with shared helpers must be compiled with \\`format: \'es\'\\` or \\`format: \'cjs\'\\``);\n367. \t\t}\n368. \t\tconst used = Array.from(usedHelpers).sort();\n369. \t\thelpers = used.map(name => {\n370. \t\t\tconst alias = generator.alias(name);\n371. \t\t\treturn { name, alias };\n372. \t\t});\n373. \t} else {\n374. \t\tlet inlineHelpers = \'\';\n375. \n376. \t\tusedHelpers.forEach(key => {\n377. \t\t\tconst str = shared[key];\n378. \t\t\tconst code = new MagicString(str);\n379. \t\t\tconst expression = parseExpressionAt(str, 0);\n380. \n381. \t\t\tlet scope = annotateWithScopes(expression);\n382. \n383. \t\t\twalk(expression, {\n384. \t\t\t\tenter(node: Node, parent: Node) {\n385. \t\t\t\t\tif (node._scope) scope = node._scope;\n386. \n387. \t\t\t\t\tif (\n388. \t\t\t\t\t\tnode.type === \'Identifier\' &&\n389. \t\t\t\t\t\tisReference(node, parent) &&\n390. \t\t\t\t\t\t!scope.has(node.name)\n391. \t\t\t\t\t) {\n392. \t\t\t\t\t\tif (node.name in shared) {\n393. \t\t\t\t\t\t\t// this helper function depends on another one\n394. \t\t\t\t\t\t\tconst dependency = node.name;\n395. \t\t\t\t\t\t\tusedHelpers.add(dependency);\n396. \n397. \t\t\t\t\t\t\tconst alias = generator.alias(dependency);\n398. \t\t\t\t\t\t\tif (alias !== node.name)\n399. \t\t\t\t\t\t\t\tcode.overwrite(node.start, node.end, alias);\n400. \t\t\t\t\t\t}\n401. \t\t\t\t\t}\n402. \t\t\t\t},\n403. \n404. \t\t\t\tleave(node: Node) {\n405. \t\t\t\t\tif (node._scope) scope = scope.parent;\n406. \t\t\t\t},\n407. \t\t\t});\n408. \n409. \t\t\tif (key === \'transitionManager\') {\n410. \t\t\t\t// special case\n411. \t\t\t\tconst global = `_svelteTransitionManager`;\n412. \n413. \t\t\t\tinlineHelpers += `\\n\\nvar ${generator.alias(\'transitionManager\')} = window.${global} || (window.${global} = ${code});\\n\\n`;\n414. \t\t\t} else {\n415. \t\t\t\tconst alias = generator.alias(expression.id.name);\n416. \t\t\t\tif (alias !== expression.id.name)\n417. \t\t\t\t\tcode.overwrite(expression.id.start, expression.id.end, alias);\n418. \n419. \t\t\t\tinlineHelpers += `\\n\\n${code}`;\n420. \t\t\t}\n421. \t\t});\n422. \n423. \t\tresult += inlineHelpers;\n424. \t}\n425. \n426. \tconst filename = options.filename && (\n427. \t\ttypeof process !== \'undefined\' ? options.filename.replace(process.cwd(), \'\').replace(/^[\\/\\\\]/, \'\') : options.filename\n428. \t);\n429. \n430. \treturn generator.generate(result, options, {\n431. \t\tbanner: `/* ${filename ? `${filename} ` : ``}generated by Svelte v${version} */`,\n432. \t\tsharedPath,\n433. \t\thelpers,\n434. \t\tname,\n435. \t\tformat,\n436. \t});\n437. }', start_line_number=1, end_line_number=437), Context(relative_path='src/generators/dom/preprocess.ts', content="1. import Block from './Block';\n2. import { trimStart, trimEnd } from '../../utils/trim';\n3. import { assign } from '../../shared/index.js';\n4. import getStaticAttributeValue from '../../utils/getStaticAttributeValue';\n5. import isChildOfComponent from '../shared/utils/isChildOfComponent';\n6. import { DomGenerator } from './index';\n7. import { Node } from '../../interfaces';\n8. import { State } from './interfaces';\n9. \n10. function isElseIf(node: Node) {\n11. \treturn (\n12. \t\tnode && node.children.length === 1 && node.children[0].type === 'IfBlock'\n13. \t);\n14. }\n15. \n16. function getChildState(parent: State, child = {}) {\n17. \treturn assign(\n18. \t\t{},\n19. \t\tparent,\n20. \t\t{ parentNode: null, parentNodes: 'nodes' },\n21. \t\tchild || {}\n22. \t);\n23. }\n24. \n25. function createDebuggingComment(node: Node, generator: DomGenerator) {\n26. \tconst { locate, source } = generator;\n27. \n28. \tlet c = node.start;\n29. \tif (node.type === 'ElseBlock') {\n30. \t\twhile (source[c] !== '{') c -= 1;\n31. \t\tc -= 1;\n32. \t}\n33. \n34. \tlet d = node.expression ? node.expression.end : c;\n35. \twhile (source[d] !== '}') d += 1;\n36. \td += 2;\n37. \n38. \tconst start = locate(c);\n39. \tconst loc = `(${start.line + 1}:${start.column})`;\n40. \n41. \treturn `${loc} ${source.slice(c, d)}`.replace(/\\n/g, ' ');\n42. }\n43. \n44. function cannotUseInnerHTML(node: Node) {\n45. \twhile (node && node.canUseInnerHTML) {\n46. \t\tnode.canUseInnerHTML = false;\n47. \t\tnode = node.parent;\n48. \t}\n49. }\n50. \n51. // Whitespace inside one of these elements will not result in\n52. // a whitespace node being created in any circumstances. (This\n53. // list is almost certainly very incomplete)\n54. const elementsWithoutText = new Set([\n55. \t'audio',\n56. \t'datalist',\n57. \t'dl',\n58. \t'ol',\n59. \t'optgroup',\n60. \t'select',\n61. \t'ul',\n62. \t'video',\n63. ]);\n64. \n65. const preprocessors = {\n66. \tMustacheTag: (\n67. \t\tgenerator: DomGenerator,\n68. \t\tblock: Block,\n69. \t\tstate: State,\n70. \t\tnode: Node,\n71. \t\telementStack: Node[],\n72. \t\tcomponentStack: Node[],\n73. \t\tstripWhitespace: boolean\n74. \t) => {\n75. \t\tcannotUseInnerHTML(node);\n76. \t\tnode.var = block.getUniqueName('text');\n77. \n78. \t\tconst dependencies = block.findDependencies(node.expression);\n79. \t\tblock.addDependencies(dependencies);\n80. \t},\n81. \n82. \tRawMustacheTag: (\n83. \t\tgenerator: DomGenerator,\n84. \t\tblock: Block,\n85. \t\tstate: State,\n86. \t\tnode: Node,\n87. \t\telementStack: Node[],\n88. \t\tcomponentStack: Node[],\n89. \t\tstripWhitespace: boolean\n90. \t) => {\n91. \t\tcannotUseInnerHTML(node);\n92. \t\tnode.var = block.getUniqueName('raw');\n93. \n94. \t\tconst dependencies = block.findDependencies(node.expression);\n95. \t\tblock.addDependencies(dependencies);\n96. \t},\n97. \n98. \tText: (\n99. \t\tgenerator: DomGenerator,\n100. \t\tblock: Block,\n101. \t\tstate: State,\n102. \t\tnode: Node,\n103. \t\telementStack: Node[],\n104. \t\tcomponentStack: Node[],\n105. \t\tstripWhitespace: boolean\n106. \t) => {\n107. \t\tif (!/\\S/.test(node.data) && (state.namespace || elementsWithoutText.has(state.parentNodeName))) {\n108. \t\t\tnode.shouldSkip = true;\n109. \t\t\treturn;\n110. \t\t}\n111. \n112. \t\tnode.var = block.getUniqueName(`text`);\n113. \t},\n114. \n115. \tIfBlock: (\n116. \t\tgenerator: DomGenerator,\n117. \t\tblock: Block,\n118. \t\tstate: State,\n119. \t\tnode: Node,\n120. \t\tinEachBlock: boolean,\n121. \t\telementStack: Node[],\n122. \t\tcomponentStack: Node[],\n123. \t\tstripWhitespace: boolean,\n124. \t\tnextSibling: Node\n125. \t) => {\n126. \t\tcannotUseInnerHTML(node);\n127. \n128. \t\tconst blocks: Block[] = [];\n129. \t\tlet dynamic = false;\n130. \t\tlet hasIntros = false;\n131. \t\tlet hasOutros = false;\n132. \n133. \t\tfunction attachBlocks(node: Node) {\n134. \t\t\tnode.var = block.getUniqueName(`if_block`);\n135. \n136. \t\t\tconst dependencies = block.findDependencies(node.expression);\n137. \t\t\tblock.addDependencies(dependencies);\n138. \n139. \t\t\tnode._block = block.child({\n140. \t\t\t\tcomment: createDebuggingComment(node, generator),\n141. \t\t\t\tname: generator.getUniqueName(`create_if_block`),\n142. \t\t\t});\n143. \n144. \t\t\tnode._state = getChildState(state);\n145. \n146. \t\t\tblocks.push(node._block);\n147. \t\t\tpreprocessChildren(generator, node._block, node._state, node, inEachBlock, elementStack, componentStack, stripWhitespace, nextSibling);\n148. \n149. \t\t\tif (node._block.dependencies.size > 0) {\n150. \t\t\t\tdynamic = true;\n151. \t\t\t\tblock.addDependencies(node._block.dependencies);\n152. \t\t\t}\n153. \n154. \t\t\tif (node._block.hasIntroMethod) hasIntros = true;\n155. \t\t\tif (node._block.hasOutroMethod) hasOutros = true;\n156. \n157. \t\t\tif (isElseIf(node.else)) {\n158. \t\t\t\tattachBlocks(node.else.children[0]);\n159. \t\t\t} else if (node.else) {\n160. \t\t\t\tnode.else._block = block.child({\n161. \t\t\t\t\tcomment: createDebuggingComment(node.else, generator),\n162. \t\t\t\t\tname: generator.getUniqueName(`create_if_block`),\n163. \t\t\t\t});\n164. \n165. \t\t\t\tnode.else._state = getChildState(state);\n166. \n167. \t\t\t\tblocks.push(node.else._block);\n168. \t\t\t\tpreprocessChildren(\n169. \t\t\t\t\tgenerator,\n170. \t\t\t\t\tnode.else._block,\n171. \t\t\t\t\tnode.else._state,\n172. \t\t\t\t\tnode.else,\n173. \t\t\t\t\tinEachBlock,\n174. \t\t\t\t\telementStack,\n175. \t\t\t\t\tcomponentStack,\n176. \t\t\t\t\tstripWhitespace,\n177. \t\t\t\t\tnextSibling\n178. \t\t\t\t);\n179. \n180. \t\t\t\tif (node.else._block.dependencies.size > 0) {\n181. \t\t\t\t\tdynamic = true;\n182. \t\t\t\t\tblock.addDependencies(node.else._block.dependencies);\n183. \t\t\t\t}\n184. \t\t\t}\n185. \t\t}\n186. \n187. \t\tattachBlocks(node);\n188. \n189. \t\tblocks.forEach(block => {\n190. \t\t\tblock.hasUpdateMethod = dynamic;\n191. \t\t\tblock.hasIntroMethod = hasIntros;\n192. \t\t\tblock.hasOutroMethod = hasOutros;\n193. \t\t});\n194. \n195. \t\tgenerator.blocks.push(...blocks);\n196. \t},\n197. \n198. \tEachBlock: (\n199. \t\tgenerator: DomGenerator,\n200. \t\tblock: Block,\n201. \t\tstate: State,\n202. \t\tnode: Node,\n203. \t\tinEachBlock: boolean,\n204. \t\telementStack: Node[],\n205. \t\tcomponentStack: Node[],\n206. \t\tstripWhitespace: boolean,\n207. \t\tnextSibling: Node\n208. \t) => {\n209. \t\tcannotUseInnerHTML(node);\n210. \t\tnode.var = block.getUniqueName(`each`);\n211. \n212. \t\tconst dependencies = block.findDependencies(node.expression);\n213. \t\tblock.addDependencies(dependencies);\n214. \n215. \t\tconst indexNames = new Map(block.indexNames);\n216. \t\tconst indexName =\n217. \t\t\tnode.index || block.getUniqueName(`${node.context}_index`);\n218. \t\tindexNames.set(node.context, indexName);\n219. \n220. \t\tconst listNames = new Map(block.listNames);\n221. \t\tconst listName = block.getUniqueName(\n222. \t\t\t(node.expression.type === 'MemberExpression' && !node.expression.computed) ? node.expression.property.name :\n223. \t\t\tnode.expression.type === 'Identifier' ? node.expression.name :\n224. \t\t\t`each_value`\n225. \t\t);\n226. \t\tlistNames.set(node.context, listName);\n227. \n228. \t\tconst context = generator.getUniqueName(node.context);\n229. \t\tconst contexts = new Map(block.contexts);\n230. \t\tcontexts.set(node.context, context);\n231. \n232. \t\tconst indexes = new Map(block.indexes);\n233. \t\tif (node.index) indexes.set(node.index, node.context);\n234. \n235. \t\tconst changeableIndexes = new Map(block.changeableIndexes);\n236. \t\tif (node.index) changeableIndexes.set(node.index, node.key);\n237. \n238. \t\tconst contextDependencies = new Map(block.contextDependencies);\n239. \t\tcontextDependencies.set(node.context, dependencies);\n240. \n241. \t\tif (node.destructuredContexts) {\n242. \t\t\tfor (const i = 0; i < node.destructuredContexts.length; i++) {\n243. \t\t\t\tcontexts.set(node.destructuredContexts[i], `${context}[${i}]`);\n244. \t\t\t\tcontextDependencies.set(node.destructuredContexts[i], dependencies);\n245. \t\t\t}\n246. \t\t}\n247. \n248. \t\tnode._block = block.child({\n249. \t\t\tcomment: createDebuggingComment(node, generator),\n250. \t\t\tname: generator.getUniqueName('create_each_block'),\n251. \t\t\texpression: node.expression,\n252. \t\t\tcontext: node.context,\n253. \t\t\tkey: node.key,\n254. \n255. \t\t\tcontextDependencies,\n256. \t\t\tcontexts,\n257. \t\t\tindexes,\n258. \t\t\tchangeableIndexes,\n259. \n260. \t\t\tlistName,\n261. \t\t\tindexName,\n262. \n263. \t\t\tindexNames,\n264. \t\t\tlistNames,\n265. \t\t\tparams: block.params.concat(listName, context, indexName),\n266. \t\t});\n267. \n268. \t\tnode._state = getChildState(state, {\n269. \t\t\tinEachBlock: true,\n270. \t\t});\n271. \n272. \t\tgenerator.blocks.push(node._block);\n273. \t\tpreprocessChildren(generator, node._block, node._state, node, true, elementStack, componentStack, stripWhitespace, nextSibling);\n274. \t\tblock.addDependencies(node._block.dependencies);\n275. \t\tnode._block.hasUpdateMethod = node._block.dependencies.size > 0;\n276. \n277. \t\tif (node.else) {\n278. \t\t\tnode.else._block = block.child({\n279. \t\t\t\tcomment: createDebuggingComment(node.else, generator),\n280. \t\t\t\tname: generator.getUniqueName(`${node._block.name}_else`),\n281. \t\t\t});\n282. \n283. \t\t\tnode.else._state = getChildState(state);\n284. \n285. \t\t\tgenerator.blocks.push(node.else._block);\n286. \t\t\tpreprocessChildren(\n287. \t\t\t\tgenerator,\n288. \t\t\t\tnode.else._block,\n289. \t\t\t\tnode.else._state,\n290. \t\t\t\tnode.else,\n291. \t\t\t\tinEachBlock,\n292. \t\t\t\telementStack,\n293. \t\t\t\tcomponentStack,\n294. \t\t\t\tstripWhitespace,\n295. \t\t\t\tnextSibling\n296. \t\t\t);\n297. \t\t\tnode.else._block.hasUpdateMethod = node.else._block.dependencies.size > 0;\n298. \t\t}\n299. \t},\n300. \n301. \tElement: (\n302. \t\tgenerator: DomGenerator,\n303. \t\tblock: Block,\n304. \t\tstate: State,\n305. \t\tnode: Node,\n306. \t\tinEachBlock: boolean,\n307. \t\telementStack: Node[],\n308. \t\tcomponentStack: Node[],\n309. \t\tstripWhitespace: boolean,\n310. \t\tnextSibling: Node\n311. \t) => {\n312. \t\tif (node.name === 'slot') {\n313. \t\t\tcannotUseInnerHTML(node);\n314. \t\t}\n315. \n316. \t\tnode.attributes.forEach((attribute: Node) => {\n317. \t\t\tif (attribute.type === 'Attribute' && attribute.value !== true) {\n318. \t\t\t\tattribute.value.forEach((chunk: Node) => {\n319. \t\t\t\t\tif (chunk.type !== 'Text') {\n320. \t\t\t\t\t\tif (node.parent) cannotUseInnerHTML(node.parent);\n321. \n322. \t\t\t\t\t\tconst dependencies = block.findDependencies(chunk.expression);\n323. \t\t\t\t\t\tblock.addDependencies(dependencies);\n324. \n325. \t\t\t\t\t\t// special case — <option value='{{foo}}'> — see below\n326. \t\t\t\t\t\tif (\n327. \t\t\t\t\t\t\tnode.name === 'option' &&\n328. \t\t\t\t\t\t\tattribute.name === 'value' &&\n329. \t\t\t\t\t\t\tstate.selectBindingDependencies\n330. \t\t\t\t\t\t) {\n331. \t\t\t\t\t\t\tstate.selectBindingDependencies.forEach(prop => {\n332. \t\t\t\t\t\t\t\tdependencies.forEach((dependency: string) => {\n333. \t\t\t\t\t\t\t\t\tgenerator.indirectDependencies.get(prop).add(dependency);\n334. \t\t\t\t\t\t\t\t});\n335. \t\t\t\t\t\t\t});\n336. \t\t\t\t\t\t}\n337. \t\t\t\t\t}\n338. \t\t\t\t});\n339. \t\t\t} else {\n340. \t\t\t\tif (node.parent) cannotUseInnerHTML(node.parent);\n341. \n342. \t\t\t\tif (attribute.type === 'EventHandler' && attribute.expression) {\n343. \t\t\t\t\tattribute.expression.arguments.forEach((arg: Node) => {\n344. \t\t\t\t\t\tconst dependencies = block.findDependencies(arg);\n345. \t\t\t\t\t\tblock.addDependencies(dependencies);\n346. \t\t\t\t\t});\n347. \t\t\t\t} else if (attribute.type === 'Binding') {\n348. \t\t\t\t\tconst dependencies = block.findDependencies(attribute.value);\n349. \t\t\t\t\tblock.addDependencies(dependencies);\n350. \t\t\t\t} else if (attribute.type === 'Transition') {\n351. \t\t\t\t\tif (attribute.intro)\n352. \t\t\t\t\t\tgenerator.hasIntroTransitions = block.hasIntroMethod = true;\n353. \t\t\t\t\tif (attribute.outro) {\n354. \t\t\t\t\t\tgenerator.hasOutroTransitions = block.hasOutroMethod = true;\n355. \t\t\t\t\t\tblock.outros += 1;\n356. \t\t\t\t\t}\n357. \t\t\t\t}\n358. \t\t\t}\n359. \t\t});\n360. \n361. \t\t// special case — in a case like this...\n362. \t\t//\n363. \t\t//   <select bind:value='foo'>\n364. \t\t//     <option value='{{bar}}'>bar</option>\n365. \t\t//     <option value='{{baz}}'>baz</option>\n366. \t\t//   </option>\n367. \t\t//\n368. \t\t// ...we need to know that `foo` depends on `bar` and `baz`,\n369. \t\t// so that if `foo.qux` changes, we know that we need to\n370. \t\t// mark `bar` and `baz` as dirty too\n371. \t\tif (node.name === 'select') {\n372. \t\t\tcannotUseInnerHTML(node);\n373. \n374. \t\t\tconst value = node.attributes.find(\n375. \t\t\t\t(attribute: Node) => attribute.name === 'value'\n376. \t\t\t);\n377. \t\t\tif (value) {\n378. \t\t\t\t// TODO does this also apply to e.g. `<input type='checkbox' bind:group='foo'>`?\n379. \t\t\t\tconst dependencies = block.findDependencies(value.value);\n380. \t\t\t\tstate.selectBindingDependencies = dependencies;\n381. \t\t\t\tdependencies.forEach((prop: string) => {\n382. \t\t\t\t\tgenerator.indirectDependencies.set(prop, new Set());\n383. \t\t\t\t});\n384. \t\t\t} else {\n385. \t\t\t\tstate.selectBindingDependencies = null;\n386. \t\t\t}\n387. \t\t}\n388. \n389. \t\tconst isComponent =\n390. \t\t\tgenerator.components.has(node.name) || node.name === ':Self';\n391. \n392. \t\tif (isComponent) {\n393. \t\t\tcannotUseInnerHTML(node);\n394. \n395. \t\t\tnode.var = block.getUniqueName(\n396. \t\t\t\t(node.name === ':Self' ? generator.name : node.name).toLowerCase()\n397. \t\t\t);\n398. \n399. \t\t\tnode._state = getChildState(state, {\n400. \t\t\t\tparentNode: `${node.var}._slotted.default`\n401. \t\t\t});\n402. \t\t} else {\n403. \t\t\tconst slot = getStaticAttributeValue(node, 'slot');\n404. \t\t\tif (slot && isChildOfComponent(node, generator)) {\n405. \t\t\t\tcannotUseInnerHTML(node);\n406. \t\t\t\tnode.slotted = true;\n407. \t\t\t\t// TODO validate slots — no nesting, no dynamic names...\n408. \t\t\t\tconst component = componentStack[componentStack.length - 1];\n409. \t\t\t\tcomponent._slots.add(slot);\n410. \t\t\t}\n411. \n412. \t\t\tnode.var = block.getUniqueName(\n413. \t\t\t\tnode.name.replace(/[^a-zA-Z0-9_$]/g, '_')\n414. \t\t\t);\n415. \n416. \t\t\tnode._state = getChildState(state, {\n417. \t\t\t\tisTopLevel: false,\n418. \t\t\t\tparentNode: node.var,\n419. \t\t\t\tparentNodes: block.getUniqueName(`${node.var}_nodes`),\n420. \t\t\t\tparentNodeName: node.name,\n421. \t\t\t\tnamespace: node.name === 'svg'\n422. \t\t\t\t\t? 'http://www.w3.org/2000/svg'\n423. \t\t\t\t\t: state.namespace,\n424. \t\t\t\tallUsedContexts: [],\n425. \t\t\t});\n426. \n427. \t\t\tgenerator.stylesheet.apply(node, elementStack);\n428. \t\t}\n429. \n430. \t\tif (node.children.length) {\n431. \t\t\tif (isComponent) {\n432. \t\t\t\tif (node.children) node._slots = new Set(['default']);\n433. \t\t\t\tpreprocessChildren(generator, block, node._state, node, inEachBlock, elementStack, componentStack.concat(node), stripWhitespace, nextSibling);\n434. \t\t\t} else {\n435. \t\t\t\tif (node.name === 'pre' || node.name === 'textarea') stripWhitespace = false;\n436. \t\t\t\tpreprocessChildren(generator, block, node._state, node, inEachBlock, elementStack.concat(node), componentStack, stripWhitespace, nextSibling);\n437. \t\t\t}\n438. \t\t}\n439. \t},\n440. };\n441. \n442. function preprocessChildren(\n443. \tgenerator: DomGenerator,\n444. \tblock: Block,\n445. \tstate: State,\n446. \tnode: Node,\n447. \tinEachBlock: boolean,\n448. \telementStack: Node[],\n449. \tcomponentStack: Node[],\n450. \tstripWhitespace: boolean,\n451. \tnextSibling: Node\n452. ) {\n453. \t// glue text nodes together\n454. \tconst cleaned: Node[] = [];\n455. \tlet lastChild: Node;\n456. \n457. \tnode.children.forEach((child: Node) => {\n458. \t\tif (child.type === 'Comment') return;\n459. \n460. \t\tif (child.type === 'Text' && lastChild && lastChild.type === 'Text') {\n461. \t\t\tlastChild.data += child.data;\n462. \t\t\tlastChild.end = child.end;\n463. \t\t} else {\n464. \t\t\tif (child.type === 'Text' && stripWhitespace && cleaned.length === 0) {\n465. \t\t\t\tchild.data = trimStart(child.data);\n466. \t\t\t\tif (child.data) cleaned.push(child);\n467. \t\t\t} else {\n468. \t\t\t\tcleaned.push(child);\n469. \t\t\t}\n470. \t\t}\n471. \n472. \t\tlastChild = child;\n473. \t});\n474. \n475. \tlastChild = null;\n476. \n477. \tcleaned.forEach((child: Node, i: number) => {\n478. \t\tchild.parent = node;\n479. \t\tchild.canUseInnerHTML = !generator.hydratable;\n480. \n481. \t\tconst preprocessor = preprocessors[child.type];\n482. \t\tif (preprocessor) preprocessor(generator, block, state, child, inEachBlock, elementStack, componentStack, stripWhitespace, cleaned[i + 1] || nextSibling);\n483. \n484. \t\tif (child.shouldSkip) return;\n485. \n486. \t\tif (lastChild) lastChild.next = child;\n487. \t\tchild.prev = lastChild;\n488. \n489. \t\tlastChild = child;\n490. \t});\n491. \n492. \t// We want to remove trailing whitespace inside an element/component/block,\n493. \t// *unless* there is no whitespace between this node and its next sibling\n494. \tif (stripWhitespace && lastChild && lastChild.type === 'Text') {\n495. \t\tconst shouldTrim = (\n496. \t\t\tnextSibling ?  (nextSibling.type === 'Text' && /^\\s/.test(nextSibling.data)) : !inEachBlock\n497. \t\t);\n498. \n499. \t\tif (shouldTrim) {\n500. \t\t\tlastChild.data = trimEnd(lastChild.data);\n501. \t\t\tif (!lastChild.data) {\n502. \t\t\t\tcleaned.pop();\n503. \t\t\t\tlastChild = cleaned[cleaned.length - 1];\n504. \t\t\t\tlastChild.next = null;\n505. \t\t\t}\n506. \t\t}\n507. \t}\n508. \n509. \tnode.children = cleaned;\n510. }\n511. \n512. export default function preprocess(\n513. \tgenerator: DomGenerator,\n514. \tnamespace: string,\n515. \tnode: Node\n516. ) {\n517. \tconst block = new Block({\n518. \t\tgenerator,\n519. \t\tname: '@create_main_fragment',\n520. \t\tkey: null,\n521. \n522. \t\tcontexts: new Map(),\n523. \t\tindexes: new Map(),\n524. \t\tchangeableIndexes: new Map(),\n525. \t\tcontextDependencies: new Map(),\n526. \n527. \t\tparams: ['state'],\n528. \t\tindexNames: new Map(),\n529. \t\tlistNames: new Map(),\n530. \n531. \t\tdependencies: new Set(),\n532. \t});\n533. \n534. \tconst state: State = {\n535. \t\tnamespace,\n536. \t\tparentNode: null,\n537. \t\tparentNodes: 'nodes'\n538. \t};\n539. \n540. \tgenerator.blocks.push(block);\n541. \tpreprocessChildren(generator, block, state, node, false, [], [], true, null);\n542. \tblock.hasUpdateMethod = true;\n543. \n544. \treturn { block, state };\n545. }", start_line_number=1, end_line_number=545), Context(relative_path='src/generators/dom/visit.ts', content="1. import visitors from './visitors/index';\n2. import { DomGenerator } from './index';\n3. import Block from './Block';\n4. import { Node } from '../../interfaces';\n5. import { State } from './interfaces';\n6. \n7. export default function visit(\n8. \tgenerator: DomGenerator,\n9. \tblock: Block,\n10. \tstate: State,\n11. \tnode: Node,\n12. \telementStack: Node[],\n13. \tcomponentStack: Node[]\n14. ) {\n15. \tconst visitor = visitors[node.type];\n16. \tvisitor(generator, block, state, node, elementStack, componentStack);\n17. }", start_line_number=1, end_line_number=17), Context(relative_path='src/generators/dom/visitors/index.ts', content="1. import EachBlock from './EachBlock';\n2. import Element from './Element/Element';\n3. import IfBlock from './IfBlock';\n4. import MustacheTag from './MustacheTag';\n5. import RawMustacheTag from './RawMustacheTag';\n6. import Text from './Text';\n7. import { Visitor } from '../interfaces';\n8. \n9. const visitors: Record<string, Visitor> = {\n10. \tEachBlock,\n11. \tElement,\n12. \tIfBlock,\n13. \tMustacheTag,\n14. \tRawMustacheTag,\n15. \tText\n16. };\n17. \n18. export default visitors;", start_line_number=1, end_line_number=18), Context(relative_path='src/generators/shared/utils/wrapModule.ts', content='1. import deindent from \'../../../utils/deindent\';\n2. import { CompileOptions, ModuleFormat, Node } from \'../../../interfaces\';\n3. \n4. interface Dependency {\n5. \tname: string;\n6. \tstatements: string[];\n7. \tsource: string;\n8. }\n9. \n10. const wrappers = { es, amd, cjs, iife, umd, eval: expr };\n11. \n12. export default function wrapModule(\n13. \tcode: string,\n14. \tformat: ModuleFormat,\n15. \tname: string,\n16. \toptions: CompileOptions,\n17. \tbanner: string,\n18. \tsharedPath: string,\n19. \thelpers: { name: string, alias: string }[],\n20. \timports: Node[],\n21. \tsource: string\n22. ): string {\n23. \tif (format === \'es\') return es(code, name, options, banner, sharedPath, helpers, imports, source);\n24. \n25. \tconst dependencies = imports.map((declaration, i) => {\n26. \t\tconst defaultImport = declaration.specifiers.find(\n27. \t\t\t(x: Node) =>\n28. \t\t\t\tx.type === \'ImportDefaultSpecifier\' ||\n29. \t\t\t\t(x.type === \'ImportSpecifier\' && x.imported.name === \'default\')\n30. \t\t);\n31. \n32. \t\tconst namespaceImport = declaration.specifiers.find(\n33. \t\t\t(x: Node) => x.type === \'ImportNamespaceSpecifier\'\n34. \t\t);\n35. \n36. \t\tconst namedImports = declaration.specifiers.filter(\n37. \t\t\t(x: Node) =>\n38. \t\t\t\tx.type === \'ImportSpecifier\' && x.imported.name !== \'default\'\n39. \t\t);\n40. \n41. \t\tconst name = defaultImport || namespaceImport\n42. \t\t\t? (defaultImport || namespaceImport).local.name\n43. \t\t\t: `__import${i}`;\n44. \n45. \t\tconst statements: string[] = [];\n46. \n47. \t\tnamedImports.forEach((specifier: Node) => {\n48. \t\t\tstatements.push(\n49. \t\t\t\t`var ${specifier.local.name} = ${name}.${specifier.imported.name};`\n50. \t\t\t);\n51. \t\t});\n52. \n53. \t\tif (defaultImport) {\n54. \t\t\tstatements.push(\n55. \t\t\t\t`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`\n56. \t\t\t);\n57. \t\t}\n58. \n59. \t\treturn { name, statements, source: declaration.source.value };\n60. \t});\n61. \n62. \tif (format === \'amd\') return amd(code, name, options, banner, dependencies);\n63. \tif (format === \'cjs\') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);\n64. \tif (format === \'iife\') return iife(code, name, options, banner, dependencies);\n65. \tif (format === \'umd\') return umd(code, name, options, banner, dependencies);\n66. \tif (format === \'eval\') return expr(code, name, options, banner, dependencies);\n67. \n68. \tthrow new Error(`Not implemented: ${format}`);\n69. }\n70. \n71. function es(\n72. \tcode: string,\n73. \tname: string,\n74. \toptions: CompileOptions,\n75. \tbanner: string,\n76. \tsharedPath: string,\n77. \thelpers: { name: string, alias: string }[],\n78. \timports: Node[],\n79. \tsource: string\n80. ) {\n81. \tconst importHelpers = helpers && (\n82. \t\t`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(\', \')} } from ${JSON.stringify(sharedPath)};`\n83. \t);\n84. \n85. \tconst importBlock = imports.length > 0 && (\n86. \t\timports\n87. \t\t\t.map((declaration: Node) => source.slice(declaration.start, declaration.end))\n88. \t\t\t.join(\'\\n\')\n89. \t);\n90. \n91. \treturn deindent`\n92. \t\t${banner}\n93. \t\t${importHelpers}\n94. \t\t${importBlock}\n95. \n96. \t\t${code}\n97. \t\texport default ${name};`;\n98. }\n99. \n100. function amd(\n101. \tcode: string,\n102. \tname: string,\n103. \toptions: CompileOptions,\n104. \tbanner: string,\n105. \tdependencies: Dependency[]\n106. ) {\n107. \tconst sourceString = dependencies.length\n108. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n109. \t\t: \'\';\n110. \n111. \tconst id = options.amd && options.amd.id;\n112. \n113. \treturn deindent`\n114. \t\tdefine(${id ? `"${id}", ` : \'\'}${sourceString}function(${paramString(dependencies)}) { "use strict";\n115. \t\t\t${getCompatibilityStatements(dependencies)}\n116. \n117. \t\t\t${code}\n118. \t\t\treturn ${name};\n119. \t\t});`;\n120. }\n121. \n122. function cjs(\n123. \tcode: string,\n124. \tname: string,\n125. \toptions: CompileOptions,\n126. \tbanner: string,\n127. \tsharedPath: string,\n128. \thelpers: { name: string, alias: string }[],\n129. \tdependencies: Dependency[]\n130. ) {\n131. \tconst SHARED = \'__shared\';\n132. \tconst helperBlock = helpers && (\n133. \t\t`var ${SHARED} = require(${JSON.stringify(sharedPath)});\\n` +\n134. \t\thelpers.map(helper => {\n135. \t\t\treturn `var ${helper.alias} = ${SHARED}.${helper.name};`;\n136. \t\t}).join(\'\\n\')\n137. \t);\n138. \n139. \tconst requireBlock = dependencies.length > 0 && (\n140. \t\tdependencies\n141. \t\t\t.map(d => `var ${d.name} = require("${d.source}");`)\n142. \t\t\t.join(\'\\n\\n\')\n143. \t);\n144. \n145. \treturn deindent`\n146. \t\t${banner}\n147. \t\t"use strict";\n148. \n149. \t\t${helperBlock}\n150. \t\t${requireBlock}\n151. \t\t${getCompatibilityStatements(dependencies)}\n152. \n153. \t\t${code}\n154. \n155. \t\tmodule.exports = ${name};`\n156. }\n157. \n158. function iife(\n159. \tcode: string,\n160. \tname: string,\n161. \toptions: CompileOptions,\n162. \tbanner: string,\n163. \tdependencies: Dependency[]\n164. ) {\n165. \tif (!options.name) {\n166. \t\tthrow new Error(`Missing required \'name\' option for IIFE export`);\n167. \t}\n168. \n169. \tconst globals = getGlobals(dependencies, options);\n170. \n171. \treturn deindent`\n172. \t\t${banner}\n173. \t\tvar ${options.name} = (function(${paramString(dependencies)}) { "use strict";\n174. \t\t\t${getCompatibilityStatements(dependencies)}\n175. \n176. \t\t\t${code}\n177. \t\t\treturn ${name};\n178. \t\t}(${globals.join(\', \')}));`;\n179. }\n180. \n181. function umd(\n182. \tcode: string,\n183. \tname: string,\n184. \toptions: CompileOptions,\n185. \tbanner: string,\n186. \tdependencies: Dependency[]\n187. ) {\n188. \tif (!options.name) {\n189. \t\tthrow new Error(`Missing required \'name\' option for UMD export`);\n190. \t}\n191. \n192. \tconst amdId = options.amd && options.amd.id ? `\'${options.amd.id}\', ` : \'\';\n193. \n194. \tconst amdDeps = dependencies.length\n195. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n196. \t\t: \'\';\n197. \n198. \tconst cjsDeps = dependencies\n199. \t\t.map(d => `require("${d.source}")`)\n200. \t\t.join(\', \');\n201. \n202. \tconst globals = getGlobals(dependencies, options);\n203. \n204. \treturn deindent`\n205. \t\t${banner}\n206. \t\t(function(global, factory) {\n207. \t\t\ttypeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :\n208. \t\t\ttypeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :\n209. \t\t\t(global.${options.name} = factory(${globals}));\n210. \t\t}(this, (function (${paramString(dependencies)}) { "use strict";\n211. \n212. \t\t\t${getCompatibilityStatements(dependencies)}\n213. \n214. \t\t\t${code}\n215. \n216. \t\t\treturn ${name};\n217. \n218. \t\t})));`;\n219. }\n220. \n221. function expr(\n222. \tcode: string,\n223. \tname: string,\n224. \toptions: CompileOptions,\n225. \tbanner: string,\n226. \tdependencies: Dependency[]\n227. ) {\n228. \tconst globals = getGlobals(dependencies, options);\n229. \n230. \treturn deindent`\n231. \t\t(function (${paramString(dependencies)}) { "use strict";\n232. \t\t\t${banner}\n233. \n234. \t\t\t${getCompatibilityStatements(dependencies)}\n235. \n236. \t\t\t${code}\n237. \n238. \t\t\treturn ${name};\n239. \t\t}(${globals.join(\', \')}))`;\n240. }\n241. \n242. function paramString(dependencies: Dependency[]) {\n243. \treturn dependencies.map(dep => dep.name).join(\', \');\n244. }\n245. \n246. function removeExtension(file: string) {\n247. \tconst index = file.lastIndexOf(\'.\');\n248. \treturn ~index ? file.slice(0, index) : file;\n249. }\n250. \n251. function getCompatibilityStatements(dependencies: Dependency[]) {\n252. \tif (!dependencies.length) return null;\n253. \n254. \tconst statements: string[] = [];\n255. \n256. \tdependencies.forEach(dependency => {\n257. \t\tstatements.push(...dependency.statements);\n258. \t});\n259. \n260. \treturn statements.join(\'\\n\');\n261. }\n262. \n263. function getGlobals(dependencies: Dependency[], options: CompileOptions) {\n264. \tconst { globals, onerror, onwarn } = options;\n265. \tconst globalFn = getGlobalFn(globals);\n266. \n267. \treturn dependencies.map(d => {\n268. \t\tlet name = globalFn(d.source);\n269. \n270. \t\tif (!name) {\n271. \t\t\tif (d.name.startsWith(\'__import\')) {\n272. \t\t\t\tconst error = new Error(\n273. \t\t\t\t\t`Could not determine name for imported module \'${d.source}\' – use options.globals`\n274. \t\t\t\t);\n275. \t\t\t\tonerror(error);\n276. \t\t\t} else {\n277. \t\t\t\tconst warning = {\n278. \t\t\t\t\tmessage: `No name was supplied for imported module \'${d.source}\'. Guessing \'${d.name}\', but you should use options.globals`,\n279. \t\t\t\t};\n280. \n281. \t\t\t\tonwarn(warning);\n282. \t\t\t}\n283. \n284. \t\t\tname = d.name;\n285. \t\t}\n286. \n287. \t\treturn name;\n288. \t});\n289. }\n290. \n291. function getGlobalFn(globals: any): (id: string) => string {\n292. \tif (typeof globals === \'function\') return globals;\n293. \tif (typeof globals === \'object\') {\n294. \t\treturn id => globals[id];\n295. \t}\n296. \n297. \treturn () => undefined;\n298. }', start_line_number=1, end_line_number=298), Context(relative_path='src/index.ts', content="1. import parse from './parse/index';\n2. import validate from './validate/index';\n3. import generate from './generators/dom/index';\n4. import generateSSR from './generators/server-side-rendering/index';\n5. import { assign } from './shared/index.js';\n6. import { version } from '../package.json';\n7. import Stylesheet from './css/Stylesheet';\n8. import { Parsed, CompileOptions, Warning } from './interfaces';\n9. \n10. function normalizeOptions(options: CompileOptions): CompileOptions {\n11. \tlet normalizedOptions = assign({ generate: 'dom' }, options);\n12. \tconst { onwarn, onerror } = normalizedOptions;\n13. \tnormalizedOptions.onwarn = onwarn\n14. \t\t? (warning: Warning) => onwarn(warning, defaultOnwarn)\n15. \t\t: defaultOnwarn;\n16. \tnormalizedOptions.onerror = onerror\n17. \t\t? (error: Error) => onerror(error, defaultOnerror)\n18. \t\t: defaultOnerror;\n19. \treturn normalizedOptions;\n20. }\n21. \n22. function defaultOnwarn(warning: Warning) {\n23. \tif (warning.loc) {\n24. \t\tconsole.warn(\n25. \t\t\t`(${warning.loc.line}:${warning.loc.column}) – ${warning.message}`\n26. \t\t); // eslint-disable-line no-console\n27. \t} else {\n28. \t\tconsole.warn(warning.message); // eslint-disable-line no-console\n29. \t}\n30. }\n31. \n32. function defaultOnerror(error: Error) {\n33. \tthrow error;\n34. }\n35. \n36. export function compile(source: string, _options: CompileOptions) {\n37. \tconst options = normalizeOptions(_options);\n38. \n39. \tlet parsed: Parsed;\n40. \n41. \ttry {\n42. \t\tparsed = parse(source, options);\n43. \t} catch (err) {\n44. \t\toptions.onerror(err);\n45. \t\treturn;\n46. \t}\n47. \n48. \tconst stylesheet = new Stylesheet(source, parsed, options.filename, options.cascade !== false);\n49. \n50. \tvalidate(parsed, source, stylesheet, options);\n51. \n52. \tconst compiler = options.generate === 'ssr' ? generateSSR : generate;\n53. \n54. \treturn compiler(parsed, source, stylesheet, options);\n55. }\n56. \n57. export function create(source: string, _options: CompileOptions = {}) {\n58. \t_options.format = 'eval';\n59. \n60. \tconst compiled = compile(source, _options);\n61. \n62. \tif (!compiled || !compiled.code) {\n63. \t\treturn;\n64. \t}\n65. \n66. \ttry {\n67. \t\treturn (0,eval)(compiled.code);\n68. \t} catch (err) {\n69. \t\tif (_options.onerror) {\n70. \t\t\t_options.onerror(err);\n71. \t\t\treturn;\n72. \t\t} else {\n73. \t\t\tthrow err;\n74. \t\t}\n75. \t}\n76. }\n77. \n78. export { parse, validate, version as VERSION };", start_line_number=1, end_line_number=78), Context(relative_path='src/interfaces.ts', content="1. export interface Node {\n2. \tstart: number;\n3. \tend: number;\n4. \ttype: string;\n5. \t[propName: string]: any;\n6. }\n7. \n8. export interface Parser {\n9. \treadonly template: string;\n10. \treadonly filename?: string;\n11. \n12. \tindex: number;\n13. \tstack: Array<Node>;\n14. \n15. \thtml: Node;\n16. \tcss: Node;\n17. \tjs: Node;\n18. \tmetaTags: {};\n19. }\n20. \n21. export interface Parsed {\n22. \thash: number;\n23. \thtml: Node;\n24. \tcss: Node;\n25. \tjs: Node;\n26. }\n27. \n28. export interface Warning {\n29. \tloc?: { line: number; column: number; pos?: number };\n30. \tpos?: number;\n31. \tmessage: string;\n32. \tfilename?: string;\n33. \tframe?: string;\n34. \ttoString: () => string;\n35. }\n36. \n37. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';\n38. \n39. export interface CompileOptions {\n40. \tformat?: ModuleFormat;\n41. \tname?: string;\n42. \tfilename?: string;\n43. \tgenerate?: string;\n44. \tglobals?: ((id: string) => string) | object;\n45. \tamd?: {\n46. \t\tid?: string;\n47. \t};\n48. \n49. \toutputFilename?: string;\n50. \tcssOutputFilename?: string;\n51. \n52. \tdev?: boolean;\n53. \tshared?: boolean | string;\n54. \tcascade?: boolean;\n55. \thydratable?: boolean;\n56. \tlegacy?: boolean;\n57. \tcustomElement?: CustomElementOptions | true;\n58. \tcss?: boolean;\n59. \n60. \tonerror?: (error: Error) => void;\n61. \tonwarn?: (warning: Warning) => void;\n62. }\n63. \n64. export interface GenerateOptions {\n65. \tname: string;\n66. \tformat: ModuleFormat;\n67. \tbanner?: string;\n68. \tsharedPath?: string | boolean;\n69. \thelpers?: { name: string, alias: string }[];\n70. }\n71. \n72. export interface Visitor {\n73. \tenter: (node: Node) => void;\n74. \tleave?: (node: Node) => void;\n75. }\n76. \n77. export interface CustomElementOptions {\n78. \ttag?: string;\n79. \tprops?: string[];\n80. }", start_line_number=1, end_line_number=80), Context(relative_path='src/parse/read/script.ts', content="1. import { parse } from 'acorn';\n2. import repeat from '../../utils/repeat';\n3. import { Parser } from '../index';\n4. import { Node } from '../../interfaces';\n5. \n6. const scriptClosingTag = '</script>';\n7. \n8. export default function readScript(parser: Parser, start: number, attributes: Node[]) {\n9. \tconst scriptStart = parser.index;\n10. \tconst scriptEnd = parser.template.indexOf(scriptClosingTag, scriptStart);\n11. \n12. \tif (scriptEnd === -1) parser.error(`<script> must have a closing tag`);\n13. \n14. \tconst source =\n15. \t\trepeat(' ', scriptStart) + parser.template.slice(scriptStart, scriptEnd);\n16. \tparser.index = scriptEnd + scriptClosingTag.length;\n17. \n18. \tlet ast;\n19. \n20. \ttry {\n21. \t\tast = parse(source, {\n22. \t\t\tecmaVersion: 8,\n23. \t\t\tsourceType: 'module',\n24. \t\t});\n25. \t} catch (err) {\n26. \t\tparser.acornError(err);\n27. \t}\n28. \n29. \tif (!ast.body.length) return null;\n30. \n31. \tast.start = scriptStart;\n32. \treturn {\n33. \t\tstart,\n34. \t\tend: parser.index,\n35. \t\tattributes,\n36. \t\tcontent: ast,\n37. \t};\n38. }", start_line_number=1, end_line_number=38), Context(relative_path='src/utils/getObject.ts', content="1. import { Node } from '../interfaces';\n2. \n3. export default function getObject(node: Node) {\n4. \twhile (node.type === 'MemberExpression') node = node.object;\n5. \treturn node;\n6. }", start_line_number=1, end_line_number=6), Context(relative_path='src/utils/stringify.ts', content='1. export function stringify(data: string, options = {}) {\n2. \treturn JSON.stringify(escape(data, options));\n3. }\n4. \n5. export function escape(data: string, { onlyEscapeAtSymbol = false } = {}) {\n6. \treturn data.replace(onlyEscapeAtSymbol ? /(%+|@+)/g : /(%+|@+|#+)/g, (match: string) => {\n7. \t\treturn match + match[0];\n8. \t});\n9. }', start_line_number=1, end_line_number=9), Context(relative_path='src/validate/js/index.ts', content="1. import propValidators from './propValidators/index';\n2. import fuzzymatch from '../utils/fuzzymatch';\n3. import checkForDupes from './utils/checkForDupes';\n4. import checkForComputedKeys from './utils/checkForComputedKeys';\n5. import namespaces from '../../utils/namespaces';\n6. import { Validator } from '../';\n7. import { Node } from '../../interfaces';\n8. \n9. const validPropList = Object.keys(propValidators);\n10. \n11. export default function validateJs(validator: Validator, js: Node) {\n12. \tjs.content.body.forEach((node: Node) => {\n13. \t\t// check there are no named exports\n14. \t\tif (node.type === 'ExportNamedDeclaration') {\n15. \t\t\tvalidator.error(`A component can only have a default export`, node.start);\n16. \t\t}\n17. \n18. \t\tif (node.type === 'ExportDefaultDeclaration') {\n19. \t\t\tif (node.declaration.type !== 'ObjectExpression') {\n20. \t\t\t\treturn validator.error(\n21. \t\t\t\t\t`Default export must be an object literal`,\n22. \t\t\t\t\tnode.declaration.start\n23. \t\t\t\t);\n24. \t\t\t}\n25. \n26. \t\t\tcheckForComputedKeys(validator, node.declaration.properties);\n27. \t\t\tcheckForDupes(validator, node.declaration.properties);\n28. \n29. \t\t\tconst props = validator.properties;\n30. \n31. \t\t\tnode.declaration.properties.forEach((prop: Node) => {\n32. \t\t\t\tprops.set(prop.key.name, prop);\n33. \t\t\t});\n34. \n35. \t\t\t// Remove these checks in version 2\n36. \t\t\tif (props.has('oncreate') && props.has('onrender')) {\n37. \t\t\t\tvalidator.error(\n38. \t\t\t\t\t'Cannot have both oncreate and onrender',\n39. \t\t\t\t\tprops.get('onrender').start\n40. \t\t\t\t);\n41. \t\t\t}\n42. \n43. \t\t\tif (props.has('ondestroy') && props.has('onteardown')) {\n44. \t\t\t\tvalidator.error(\n45. \t\t\t\t\t'Cannot have both ondestroy and onteardown',\n46. \t\t\t\t\tprops.get('onteardown').start\n47. \t\t\t\t);\n48. \t\t\t}\n49. \n50. \t\t\t// ensure all exported props are valid\n51. \t\t\tnode.declaration.properties.forEach((prop: Node) => {\n52. \t\t\t\tconst propValidator = propValidators[prop.key.name];\n53. \n54. \t\t\t\tif (propValidator) {\n55. \t\t\t\t\tpropValidator(validator, prop);\n56. \t\t\t\t} else {\n57. \t\t\t\t\tconst match = fuzzymatch(prop.key.name, validPropList);\n58. \t\t\t\t\tif (match) {\n59. \t\t\t\t\t\tvalidator.error(\n60. \t\t\t\t\t\t\t`Unexpected property '${prop.key.name}' (did you mean '${match}'?)`,\n61. \t\t\t\t\t\t\tprop.start\n62. \t\t\t\t\t\t);\n63. \t\t\t\t\t} else if (/FunctionExpression/.test(prop.value.type)) {\n64. \t\t\t\t\t\tvalidator.error(\n65. \t\t\t\t\t\t\t`Unexpected property '${prop.key.name}' (did you mean to include it in 'methods'?)`,\n66. \t\t\t\t\t\t\tprop.start\n67. \t\t\t\t\t\t);\n68. \t\t\t\t\t} else {\n69. \t\t\t\t\t\tvalidator.error(\n70. \t\t\t\t\t\t\t`Unexpected property '${prop.key.name}'`,\n71. \t\t\t\t\t\t\tprop.start\n72. \t\t\t\t\t\t);\n73. \t\t\t\t\t}\n74. \t\t\t\t}\n75. \t\t\t});\n76. \n77. \t\t\tif (props.has('namespace')) {\n78. \t\t\t\tconst ns = props.get('namespace').value.value;\n79. \t\t\t\tvalidator.namespace = namespaces[ns] || ns;\n80. \t\t\t}\n81. \n82. \t\t\tvalidator.defaultExport = node;\n83. \t\t}\n84. \t});\n85. \n86. \t['components', 'methods', 'helpers', 'transitions'].forEach(key => {\n87. \t\tif (validator.properties.has(key)) {\n88. \t\t\tvalidator.properties.get(key).value.properties.forEach((prop: Node) => {\n89. \t\t\t\tvalidator[key].set(prop.key.name, prop.value);\n90. \t\t\t});\n91. \t\t}\n92. \t});\n93. }", start_line_number=1, end_line_number=93), Context(relative_path='src/validate/js/propValidators/oncreate.ts', content="1. import usesThisOrArguments from '../utils/usesThisOrArguments';\n2. import { Validator } from '../../';\n3. import { Node } from '../../../interfaces';\n4. \n5. export default function oncreate(validator: Validator, prop: Node) {\n6. \tif (prop.value.type === 'ArrowFunctionExpression') {\n7. \t\tif (usesThisOrArguments(prop.value.body)) {\n8. \t\t\tvalidator.error(\n9. \t\t\t\t`'oncreate' should be a function expression, not an arrow function expression`,\n10. \t\t\t\tprop.start\n11. \t\t\t);\n12. \t\t}\n13. \t}\n14. }", start_line_number=1, end_line_number=14)]
2025-11-11 00:45:16,912 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_analyzer_message_node - DEBUG - Sending message to IssueBugAnalyzerNode:
content='I am going to share details about an issue reported to a codebase and its related bug context.\nPlease analyze this bug and provide a high-level description of what needs to be changed:\n\n1. Issue Understanding:\n- Analyze the issue title, description, and comments provided\n- Identify the reported symptoms and unexpected behaviors\n\n2. Code Analysis:\n- Identify which files, functions, or code blocks are involved\n- Explain what the problematic code is currently doing\n\n3. Root Cause:\n- Explain why the current behavior is incorrect\n- Identify which specific parts of the code are causing the issue\n\n4. Fix Suggestion:\nFor each needed change, describe in plain English:\n- Which file needs to be modified\n- Which function or code block needs changes\n- What needs to be changed (e.g., "rename variable x to y", "add null check for parameter z")\n- Why this change would fix the issue\n\nDo NOT provide actual code snippets or diffs. Focus on describing what needs to be changed.\n\nHere are the details for analysis:\n\nIssue title:\nasync keyword is removed\n\nIssue description: \n[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:\n\n```js\nexport default {\n  async oncreate() {\n    const data = await fetch(\'foo.json\').then(r => r.json());\n    console.log(data);\n  }\n};\n```\n\nIssue comments:\n\n\nBug Context:\nFile: src/generators/Generator.ts\nLine number range: 1 - 20\nContent:\n1. import MagicString, { Bundle } from \'magic-string\';\n2. import { walk } from \'estree-walker\';\n3. import { getLocator } from \'locate-character\';\n4. import deindent from \'../utils/deindent\';\n5. import CodeBuilder from \'../utils/CodeBuilder\';\n6. import getCodeFrame from \'../utils/getCodeFrame\';\n7. import isReference from \'../utils/isReference\';\n8. import flattenReference from \'../utils/flattenReference\';\n9. import globalWhitelist from \'../utils/globalWhitelist\';\n10. import reservedNames from \'../utils/reservedNames\';\n11. import namespaces from \'../utils/namespaces\';\n12. import { removeNode, removeObjectKey } from \'../utils/removeNode\';\n13. import wrapModule from \'./shared/utils/wrapModule\';\n14. import annotateWithScopes from \'../utils/annotateWithScopes\';\n15. import clone from \'../utils/clone\';\n16. import DomBlock from \'./dom/Block\';\n17. import SsrBlock from \'./server-side-rendering/Block\';\n18. import Stylesheet from \'../css/Stylesheet\';\n19. import { Node, GenerateOptions, Parsed, CompileOptions, CustomElementOptions } from \'../interfaces\';\n20. \n\n\nFile: src/generators/Generator.ts\nLine number range: 94 - 111\nContent:\n94. \ttemplateProperties: Record<string, Node>;\n95. \tslots: Set<string>;\n96. \tjavascript: string;\n97. \n98. \tcode: MagicString;\n99. \n100. \tbindingGroups: string[];\n101. \tindirectDependencies: Map<string, Set<string>>;\n102. \texpectedProperties: Set<string>;\n103. \tusesRefs: boolean;\n104. \n105. \tlocate: (c: number) => { line: number, column: number };\n106. \n107. \tstylesheet: Stylesheet;\n108. \n109. \tuserVars: Set<string>;\n110. \ttemplateVars: Map<string, string>;\n111. \taliases: Map<string, string>;\n\n\nFile: src/generators/Generator.ts\nLine number range: 154 - 160\nContent:\n154. \t\tthis.templateVars = new Map();\n155. \t\tthis.aliases = new Map();\n156. \t\tthis.usedNames = new Set();\n157. \n158. \t\tthis.parseJs(dom);\n159. \t\tthis.name = this.alias(name);\n160. \n\n\nFile: src/generators/Generator.ts\nLine number range: 461 - 466\nContent:\n461. \t\tconst computations: Computation[] = [];\n462. \t\tconst templateProperties: Record<string, Node> = {};\n463. \t\tconst componentDefinition = new CodeBuilder();\n464. \n465. \t\tlet namespace = null;\n466. \n\n\nFile: src/generators/Generator.ts\nLine number range: 494 - 509\nContent:\n494. \t\t\tconst defaultExport = this.defaultExport = body.find(\n495. \t\t\t\t(node: Node) => node.type === \'ExportDefaultDeclaration\'\n496. \t\t\t);\n497. \n498. \t\t\tif (defaultExport) {\n499. \t\t\t\tdefaultExport.declaration.properties.forEach((prop: Node) => {\n500. \t\t\t\t\ttemplateProperties[prop.key.name] = prop;\n501. \t\t\t\t});\n502. \n503. \t\t\t\t[\'helpers\', \'events\', \'components\', \'transitions\'].forEach(key => {\n504. \t\t\t\t\tif (templateProperties[key]) {\n505. \t\t\t\t\t\ttemplateProperties[key].value.properties.forEach((prop: Node) => {\n506. \t\t\t\t\t\t\tthis[key].add(prop.key.name);\n507. \t\t\t\t\t\t});\n508. \t\t\t\t\t}\n509. \t\t\t\t});\n\n\nFile: src/generators/Generator.ts\nLine number range: 511 - 543\nContent:\n511. \t\t\t\tconst addArrowFunctionExpression = (name: string, node: Node) => {\n512. \t\t\t\t\tconst { body, params } = node;\n513. \n514. \t\t\t\t\tconst paramString = params.length ?\n515. \t\t\t\t\t\t`[✂${params[0].start}-${params[params.length - 1].end}✂]` :\n516. \t\t\t\t\t\t``;\n517. \n518. \t\t\t\t\tif (body.type === \'BlockStatement\') {\n519. \t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n520. \t\t\t\t\t\t\tfunction ${name}(${paramString}) [✂${body.start}-${body.end}✂]\n521. \t\t\t\t\t\t`);\n522. \t\t\t\t\t} else {\n523. \t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n524. \t\t\t\t\t\t\tfunction ${name}(${paramString}) {\n525. \t\t\t\t\t\t\t\treturn [✂${body.start}-${body.end}✂];\n526. \t\t\t\t\t\t\t}\n527. \t\t\t\t\t\t`);\n528. \t\t\t\t\t}\n529. \t\t\t\t};\n530. \n531. \t\t\t\tconst addFunctionExpression = (name: string, node: Node) => {\n532. \t\t\t\t\tlet c = node.start;\n533. \t\t\t\t\twhile (this.source[c] !== \'(\') c += 1;\n534. \t\t\t\t\tcomponentDefinition.addBlock(deindent`\n535. \t\t\t\t\t\tfunction ${name}[✂${c}-${node.end}✂];\n536. \t\t\t\t\t`);\n537. \t\t\t\t};\n538. \n539. \t\t\t\tconst addValue = (name: string, node: Node) => {\n540. \t\t\t\t\tcomponentDefinition.addBlock(deindent`\n541. \t\t\t\t\t\tvar ${name} = [✂${node.start}-${node.end}✂];\n542. \t\t\t\t\t`);\n543. \t\t\t\t};\n\n\nFile: src/generators/Generator.ts\nLine number range: 545 - 569\nContent:\n545. \t\t\t\tconst addDeclaration = (key: string, node: Node, disambiguator?: string) => {\n546. \t\t\t\t\tconst qualified = disambiguator ? `${disambiguator}-${key}` : key;\n547. \n548. \t\t\t\t\tif (node.type === \'Identifier\' && node.name === key) {\n549. \t\t\t\t\t\tthis.templateVars.set(qualified, key);\n550. \t\t\t\t\t\treturn;\n551. \t\t\t\t\t}\n552. \n553. \t\t\t\t\tlet name = this.getUniqueName(key);\n554. \t\t\t\t\tthis.templateVars.set(qualified, name);\n555. \n556. \t\t\t\t\t// deindent\n557. \t\t\t\t\tconst indentationLevel = getIndentationLevel(source, node.start);\n558. \t\t\t\t\tif (indentationLevel) {\n559. \t\t\t\t\t\tremoveIndentation(code, node.start, node.end, indentationLevel, indentExclusionRanges);\n560. \t\t\t\t\t}\n561. \n562. \t\t\t\t\tif (node.type === \'ArrowFunctionExpression\') {\n563. \t\t\t\t\t\taddArrowFunctionExpression(name, node);\n564. \t\t\t\t\t} else if (node.type === \'FunctionExpression\') {\n565. \t\t\t\t\t\taddFunctionExpression(name, node);\n566. \t\t\t\t\t} else {\n567. \t\t\t\t\t\taddValue(name, node);\n568. \t\t\t\t\t}\n569. \t\t\t\t};\n\n\nFile: src/generators/Generator.ts\nLine number range: 638 - 646\nContent:\n638. \t\t\t\tif (templateProperties.onrender) templateProperties.oncreate = templateProperties.onrender; // remove after v2\n639. \t\t\t\tif (templateProperties.oncreate && dom) {\n640. \t\t\t\t\taddDeclaration(\'oncreate\', templateProperties.oncreate.value);\n641. \t\t\t\t}\n642. \n643. \t\t\t\tif (templateProperties.onteardown) templateProperties.ondestroy = templateProperties.onteardown; // remove after v2\n644. \t\t\t\tif (templateProperties.ondestroy && dom) {\n645. \t\t\t\t\taddDeclaration(\'ondestroy\', templateProperties.ondestroy.value);\n646. \t\t\t\t}\n\n\nFile: src/generators/Generator.ts\nLine number range: 692 - 695\nContent:\n692. \t\tthis.computations = computations;\n693. \t\tthis.namespace = namespace;\n694. \t\tthis.templateProperties = templateProperties;\n695. \t}\n\n\nFile: src/generators/dom/index.ts\nLine number range: 1 - 437\nContent:\n1. import MagicString from \'magic-string\';\n2. import { parseExpressionAt } from \'acorn\';\n3. import annotateWithScopes from \'../../utils/annotateWithScopes\';\n4. import isReference from \'../../utils/isReference\';\n5. import { walk } from \'estree-walker\';\n6. import deindent from \'../../utils/deindent\';\n7. import { stringify, escape } from \'../../utils/stringify\';\n8. import CodeBuilder from \'../../utils/CodeBuilder\';\n9. import reservedNames from \'../../utils/reservedNames\';\n10. import visit from \'./visit\';\n11. import shared from \'./shared\';\n12. import Generator from \'../Generator\';\n13. import Stylesheet from \'../../css/Stylesheet\';\n14. import preprocess from \'./preprocess\';\n15. import Block from \'./Block\';\n16. import { version } from \'../../../package.json\';\n17. import { Parsed, CompileOptions, Node } from \'../../interfaces\';\n18. \n19. const test = typeof global !== \'undefined\' && global.__svelte_test;\n20. \n21. export class DomGenerator extends Generator {\n22. \tblocks: (Block|string)[];\n23. \treadonly: Set<string>;\n24. \tmetaBindings: string[];\n25. \n26. \thydratable: boolean;\n27. \tlegacy: boolean;\n28. \n29. \thasIntroTransitions: boolean;\n30. \thasOutroTransitions: boolean;\n31. \thasComplexBindings: boolean;\n32. \n33. \tneedsEncapsulateHelper: boolean;\n34. \n35. \tconstructor(\n36. \t\tparsed: Parsed,\n37. \t\tsource: string,\n38. \t\tname: string,\n39. \t\tstylesheet: Stylesheet,\n40. \t\toptions: CompileOptions\n41. \t) {\n42. \t\tsuper(parsed, source, name, stylesheet, options, true);\n43. \t\tthis.blocks = [];\n44. \n45. \t\tthis.readonly = new Set();\n46. \n47. \t\tthis.hydratable = options.hydratable;\n48. \t\tthis.legacy = options.legacy;\n49. \t\tthis.needsEncapsulateHelper = false;\n50. \n51. \t\t// initial values for e.g. window.innerWidth, if there\'s a <:Window> meta tag\n52. \t\tthis.metaBindings = [];\n53. \t}\n54. \n55. \tgetUniqueNameMaker(params: string[]) {\n56. \t\tconst localUsedNames = new Set(params);\n57. \n58. \t\tfunction add(name: string) {\n59. \t\t\tlocalUsedNames.add(name);\n60. \t\t}\n61. \n62. \t\treservedNames.forEach(add);\n63. \t\tthis.userVars.forEach(add);\n64. \t\tfor (const name in shared) {\n65. \t\t\tlocalUsedNames.add(test ? `${name}$` : name);\n66. \t\t}\n67. \n68. \t\treturn (name: string) => {\n69. \t\t\tif (test) name = `${name}$`;\n70. \t\t\tlet alias = name;\n71. \t\t\tfor (\n72. \t\t\t\tlet i = 1;\n73. \t\t\t\tthis.usedNames.has(alias) ||\n74. \t\t\t\tlocalUsedNames.has(alias);\n75. \t\t\t\talias = `${name}_${i++}`\n76. \t\t\t);\n77. \t\t\tlocalUsedNames.add(alias);\n78. \t\t\treturn alias;\n79. \t\t};\n80. \t}\n81. }\n82. \n83. export default function dom(\n84. \tparsed: Parsed,\n85. \tsource: string,\n86. \tstylesheet: Stylesheet,\n87. \toptions: CompileOptions\n88. ) {\n89. \tconst format = options.format || \'es\';\n90. \n91. \tconst generator = new DomGenerator(parsed, source, options.name || \'SvelteComponent\', stylesheet, options);\n92. \n93. \tconst {\n94. \t\tcomputations,\n95. \t\tname,\n96. \t\ttemplateProperties,\n97. \t\tnamespace,\n98. \t} = generator;\n99. \n100. \tconst { block, state } = preprocess(generator, namespace, parsed.html);\n101. \n102. \tgenerator.stylesheet.warnOnUnusedSelectors(options.onwarn);\n103. \n104. \tparsed.html.children.forEach((node: Node) => {\n105. \t\tvisit(generator, block, state, node, [], []);\n106. \t});\n107. \n108. \tconst builder = new CodeBuilder();\n109. \tconst computationBuilder = new CodeBuilder();\n110. \tconst computationDeps = new Set();\n111. \n112. \tif (computations.length) {\n113. \t\tcomputations.forEach(({ key, deps }) => {\n114. \t\t\tdeps.forEach(dep => {\n115. \t\t\t\tcomputationDeps.add(dep);\n116. \t\t\t});\n117. \n118. \t\t\tif (generator.readonly.has(key)) {\n119. \t\t\t\t// <:Window> bindings\n120. \t\t\t\tthrow new Error(\n121. \t\t\t\t\t`Cannot have a computed value \'${key}\' that clashes with a read-only property`\n122. \t\t\t\t);\n123. \t\t\t}\n124. \n125. \t\t\tgenerator.readonly.add(key);\n126. \n127. \t\t\tconst condition = `${deps.map(dep => `changed.${dep}`).join(\' || \')}`;\n128. \n129. \t\t\tconst statement = `if (@differs(state.${key}, (state.${key} = %computed-${key}(${deps\n130. \t\t\t\t.map(dep => `state.${dep}`)\n131. \t\t\t\t.join(\', \')})))) changed.${key} = true;`;\n132. \n133. \t\t\tcomputationBuilder.addConditional(condition, statement);\n134. \t\t});\n135. \t}\n136. \n137. \tif (generator.javascript) {\n138. \t\tbuilder.addBlock(generator.javascript);\n139. \t}\n140. \n141. \tif (generator.needsEncapsulateHelper) {\n142. \t\tbuilder.addBlock(deindent`\n143. \t\t\tfunction @encapsulateStyles(node) {\n144. \t\t\t\t@setAttribute(node, "${generator.stylesheet.id}", "");\n145. \t\t\t}\n146. \t\t`);\n147. \t}\n148. \n149. \tconst { css, cssMap } = generator.stylesheet.render(options.filename, !generator.customElement);\n150. \tconst styles = generator.stylesheet.hasStyles && stringify(options.dev ?\n151. \t\t`${css}\\n/*# sourceMappingURL=${cssMap.toUrl()} */` :\n152. \t\tcss, { onlyEscapeAtSymbol: true });\n153. \n154. \tif (styles && generator.options.css !== false && !generator.customElement) {\n155. \t\tbuilder.addBlock(deindent`\n156. \t\t\tfunction @add_css() {\n157. \t\t\t\tvar style = @createElement("style");\n158. \t\t\t\tstyle.id = \'${generator.stylesheet.id}-style\';\n159. \t\t\t\tstyle.textContent = ${styles};\n160. \t\t\t\t@appendNode(style, document.head);\n161. \t\t\t}\n162. \t\t`);\n163. \t}\n164. \n165. \tgenerator.blocks.forEach(block => {\n166. \t\tbuilder.addBlock(block.toString());\n167. \t});\n168. \n169. \tconst sharedPath = options.shared === true\n170. \t\t? \'svelte/shared.js\'\n171. \t\t: options.shared;\n172. \n173. \tconst prototypeBase =\n174. \t\t`${name}.prototype` +\n175. \t\t(templateProperties.methods ? `, %methods` : \'\');\n176. \tconst proto = sharedPath\n177. \t\t? `@proto`\n178. \t\t: deindent`\n179. \t\t{\n180. \t\t\t${[\'destroy\', \'get\', \'fire\', \'observe\', \'on\', \'set\', \'teardown\', \'_set\', \'_mount\', \'_unmount\']\n181. \t\t\t\t.map(n => `${n}: @${n === \'teardown\' ? \'destroy\' : n}`)\n182. \t\t\t\t.join(\',\\n\')}\n183. \t\t}`;\n184. \n185. \tconst debugName = `<${generator.customElement ? generator.tag : name}>`;\n186. \n187. \tconst constructorBody = deindent`\n188. \t\t${options.dev && `this._debugName = \'${debugName}\';`}\n189. \t\t${options.dev && !generator.customElement &&\n190. \t\t\t`if (!options || (!options.target && !options._root)) throw new Error("\'target\' is a required option");`}\n191. \t\t@init(this, options);\n192. \t\t${generator.usesRefs && `this.refs = {};`}\n193. \t\tthis._state = @assign(${templateProperties.data ? \'%data()\' : \'{}\'}, options.data);\n194. \t\t${generator.metaBindings}\n195. \t\t${computations.length && `this._recompute({ ${Array.from(computationDeps).map(dep => `${dep}: 1`).join(\', \')} }, this._state);`}\n196. \t\t${options.dev &&\n197. \t\t\tArray.from(generator.expectedProperties).map(\n198. \t\t\t\tprop =>\n199. \t\t\t\t\t`if (!(\'${prop}\' in this._state)) console.warn("${debugName} was created without expected data property \'${prop}\'");`\n200. \t\t\t)}\n201. \t\t${generator.bindingGroups.length &&\n202. \t\t\t`this._bindingGroups = [${Array(generator.bindingGroups.length).fill(\'[]\').join(\', \')}];`}\n203. \n204. \t\t${templateProperties.ondestroy && `this._handlers.destroy = [%ondestroy]`}\n205. \n206. \t\t${generator.slots.size && `this._slotted = options.slots || {};`}\n207. \n208. \t\t${generator.customElement ?\n209. \t\t\tdeindent`\n210. \t\t\t\tthis.attachShadow({ mode: \'open\' });\n211. \t\t\t\t${css && `this.shadowRoot.innerHTML = \\`<style>${escape(css, { onlyEscapeAtSymbol: true }).replace(/\\\\/g, \'\\\\\\\\\')}${options.dev ? `\\n/*# sourceMappingURL=${cssMap.toUrl()} */` : \'\'}</style>\\`;`}\n212. \t\t\t` :\n213. \t\t\t(generator.stylesheet.hasStyles && options.css !== false &&\n214. \t\t\t`if (!document.getElementById("${generator.stylesheet.id}-style")) @add_css();`)\n215. \t\t}\n216. \n217. \t\t${templateProperties.oncreate && `var _oncreate = %oncreate.bind(this);`}\n218. \n219. \t\t${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`\n220. \t\t\tif (!options._root) {\n221. \t\t\t\tthis._oncreate = [${templateProperties.oncreate && `_oncreate`}];\n222. \t\t\t\t${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}\n223. \t\t\t\t${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}\n224. \t\t\t} ${templateProperties.oncreate && deindent`\n225. \t\t\t\telse {\n226. \t\t\t\t\tthis._root._oncreate.push(_oncreate);\n227. \t\t\t\t}\n228. \t\t\t`}\n229. \t\t`}\n230. \n231. \t\t${generator.slots.size && `this.slots = {};`}\n232. \n233. \t\tthis._fragment = @create_main_fragment(this._state, this);\n234. \n235. \t\t${generator.customElement ? deindent`\n236. \t\t\tthis._fragment.c();\n237. \t\t\tthis._fragment.${block.hasIntroMethod ? \'i\' : \'m\'}(this.shadowRoot, null);\n238. \n239. \t\t\tif (options.target) this._mount(options.target, options.anchor || null);\n240. \t\t` : deindent`\n241. \t\t\tif (options.target) {\n242. \t\t\t\t${generator.hydratable\n243. \t\t\t\t\t? deindent`\n244. \t\t\t\t\t\tvar nodes = @children(options.target);\n245. \t\t\t\t\t\toptions.hydrate ? this._fragment.l(nodes) : this._fragment.c();\n246. \t\t\t\t\t\tnodes.forEach(@detachNode);\n247. \t\t\t\t\t` :\n248. \t\t\t\t\tdeindent`\n249. \t\t\t\t\t\t${options.dev && `if (options.hydrate) throw new Error("options.hydrate only works if the component was compiled with the \\`hydratable: true\\` option");`}\n250. \t\t\t\t\t\tthis._fragment.c();\n251. \t\t\t\t\t`}\n252. \t\t\t\tthis._fragment.${block.hasIntroMethod ? \'i\' : \'m\'}(options.target, options.anchor || null);\n253. \n254. \t\t\t\t${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`\n255. \t\t\t\t\t${generator.hasComponents && `this._lock = true;`}\n256. \t\t\t\t\t${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}\n257. \t\t\t\t\t${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}\n258. \t\t\t\t\t${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}\n259. \t\t\t\t\t${generator.hasComponents && `this._lock = false;`}\n260. \t\t\t\t`}\n261. \t\t\t}\n262. \t\t`}\n263. \t`;\n264. \n265. \tif (generator.customElement) {\n266. \t\tconst props = generator.props || Array.from(generator.expectedProperties);\n267. \n268. \t\tbuilder.addBlock(deindent`\n269. \t\t\tclass ${name} extends HTMLElement {\n270. \t\t\t\tconstructor(options = {}) {\n271. \t\t\t\t\tsuper();\n272. \t\t\t\t\t${constructorBody}\n273. \t\t\t\t}\n274. \n275. \t\t\t\tstatic get observedAttributes() {\n276. \t\t\t\t\treturn ${JSON.stringify(props)};\n277. \t\t\t\t}\n278. \n279. \t\t\t\t${props.map(prop => deindent`\n280. \t\t\t\t\tget ${prop}() {\n281. \t\t\t\t\t\treturn this.get(\'${prop}\');\n282. \t\t\t\t\t}\n283. \n284. \t\t\t\t\tset ${prop}(value) {\n285. \t\t\t\t\t\tthis.set({ ${prop}: value });\n286. \t\t\t\t\t}\n287. \t\t\t\t`).join(\'\\n\\n\')}\n288. \n289. \t\t\t\t${generator.slots.size && deindent`\n290. \t\t\t\t\tconnectedCallback() {\n291. \t\t\t\t\t\tObject.keys(this._slotted).forEach(key => {\n292. \t\t\t\t\t\t\tthis.appendChild(this._slotted[key]);\n293. \t\t\t\t\t\t});\n294. \t\t\t\t\t}`}\n295. \n296. \t\t\t\tattributeChangedCallback(attr, oldValue, newValue) {\n297. \t\t\t\t\tthis.set({ [attr]: newValue });\n298. \t\t\t\t}\n299. \t\t\t}\n300. \n301. \t\t\tcustomElements.define("${generator.tag}", ${name});\n302. \t\t\t@assign(${prototypeBase}, ${proto}, {\n303. \t\t\t\t_mount(target, anchor) {\n304. \t\t\t\t\ttarget.insertBefore(this, anchor);\n305. \t\t\t\t},\n306. \n307. \t\t\t\t_unmount() {\n308. \t\t\t\t\tthis.parentNode.removeChild(this);\n309. \t\t\t\t}\n310. \t\t\t});\n311. \t\t`);\n312. \t} else {\n313. \t\tbuilder.addBlock(deindent`\n314. \t\t\tfunction ${name}(options) {\n315. \t\t\t\t${constructorBody}\n316. \t\t\t}\n317. \n318. \t\t\t@assign(${prototypeBase}, ${proto});\n319. \t\t`);\n320. \t}\n321. \n322. \tbuilder.addBlock(deindent`\n323. \t\t${options.dev && deindent`\n324. \t\t\t${name}.prototype._checkReadOnly = function _checkReadOnly(newState) {\n325. \t\t\t\t${Array.from(generator.readonly).map(\n326. \t\t\t\t\tprop =>\n327. \t\t\t\t\t\t`if (\'${prop}\' in newState && !this._updatingReadonlyProperty) throw new Error("${debugName}: Cannot set read-only property \'${prop}\'");`\n328. \t\t\t\t)}\n329. \t\t\t};\n330. \t\t`}\n331. \n332. \t\t${computations.length ? deindent`\n333. \t\t\t${name}.prototype._recompute = function _recompute(changed, state) {\n334. \t\t\t\t${computationBuilder}\n335. \t\t\t}\n336. \t\t` : (!sharedPath && `${name}.prototype._recompute = @noop;`)}\n337. \n338. \t\t${templateProperties.setup && `%setup(${name});`}\n339. \t`);\n340. \n341. \tconst usedHelpers = new Set();\n342. \n343. \tlet result = builder\n344. \t\t.toString()\n345. \t\t.replace(/(%+|@+)(\\w*(?:-\\w*)?)/g, (match: string, sigil: string, name: string) => {\n346. \t\t\tif (sigil === \'@\') {\n347. \t\t\t\tif (name in shared) {\n348. \t\t\t\t\tif (options.dev && `${name}Dev` in shared) name = `${name}Dev`;\n349. \t\t\t\t\tusedHelpers.add(name);\n350. \t\t\t\t}\n351. \n352. \t\t\t\treturn generator.alias(name);\n353. \t\t\t}\n354. \n355. \t\t\tif (sigil === \'%\') {\n356. \t\t\t\treturn generator.templateVars.get(name);\n357. \t\t\t}\n358. \n359. \t\t\treturn sigil.slice(1) + name;\n360. \t\t});\n361. \n362. \tlet helpers;\n363. \n364. \tif (sharedPath) {\n365. \t\tif (format !== \'es\' && format !== \'cjs\') {\n366. \t\t\tthrow new Error(`Components with shared helpers must be compiled with \\`format: \'es\'\\` or \\`format: \'cjs\'\\``);\n367. \t\t}\n368. \t\tconst used = Array.from(usedHelpers).sort();\n369. \t\thelpers = used.map(name => {\n370. \t\t\tconst alias = generator.alias(name);\n371. \t\t\treturn { name, alias };\n372. \t\t});\n373. \t} else {\n374. \t\tlet inlineHelpers = \'\';\n375. \n376. \t\tusedHelpers.forEach(key => {\n377. \t\t\tconst str = shared[key];\n378. \t\t\tconst code = new MagicString(str);\n379. \t\t\tconst expression = parseExpressionAt(str, 0);\n380. \n381. \t\t\tlet scope = annotateWithScopes(expression);\n382. \n383. \t\t\twalk(expression, {\n384. \t\t\t\tenter(node: Node, parent: Node) {\n385. \t\t\t\t\tif (node._scope) scope = node._scope;\n386. \n387. \t\t\t\t\tif (\n388. \t\t\t\t\t\tnode.type === \'Identifier\' &&\n389. \t\t\t\t\t\tisReference(node, parent) &&\n390. \t\t\t\t\t\t!scope.has(node.name)\n391. \t\t\t\t\t) {\n392. \t\t\t\t\t\tif (node.name in shared) {\n393. \t\t\t\t\t\t\t// this helper function depends on another one\n394. \t\t\t\t\t\t\tconst dependency = node.name;\n395. \t\t\t\t\t\t\tusedHelpers.add(dependency);\n396. \n397. \t\t\t\t\t\t\tconst alias = generator.alias(dependency);\n398. \t\t\t\t\t\t\tif (alias !== node.name)\n399. \t\t\t\t\t\t\t\tcode.overwrite(node.start, node.end, alias);\n400. \t\t\t\t\t\t}\n401. \t\t\t\t\t}\n402. \t\t\t\t},\n403. \n404. \t\t\t\tleave(node: Node) {\n405. \t\t\t\t\tif (node._scope) scope = scope.parent;\n406. \t\t\t\t},\n407. \t\t\t});\n408. \n409. \t\t\tif (key === \'transitionManager\') {\n410. \t\t\t\t// special case\n411. \t\t\t\tconst global = `_svelteTransitionManager`;\n412. \n413. \t\t\t\tinlineHelpers += `\\n\\nvar ${generator.alias(\'transitionManager\')} = window.${global} || (window.${global} = ${code});\\n\\n`;\n414. \t\t\t} else {\n415. \t\t\t\tconst alias = generator.alias(expression.id.name);\n416. \t\t\t\tif (alias !== expression.id.name)\n417. \t\t\t\t\tcode.overwrite(expression.id.start, expression.id.end, alias);\n418. \n419. \t\t\t\tinlineHelpers += `\\n\\n${code}`;\n420. \t\t\t}\n421. \t\t});\n422. \n423. \t\tresult += inlineHelpers;\n424. \t}\n425. \n426. \tconst filename = options.filename && (\n427. \t\ttypeof process !== \'undefined\' ? options.filename.replace(process.cwd(), \'\').replace(/^[\\/\\\\]/, \'\') : options.filename\n428. \t);\n429. \n430. \treturn generator.generate(result, options, {\n431. \t\tbanner: `/* ${filename ? `${filename} ` : ``}generated by Svelte v${version} */`,\n432. \t\tsharedPath,\n433. \t\thelpers,\n434. \t\tname,\n435. \t\tformat,\n436. \t});\n437. }\n\n\nFile: src/generators/dom/preprocess.ts\nLine number range: 1 - 545\nContent:\n1. import Block from \'./Block\';\n2. import { trimStart, trimEnd } from \'../../utils/trim\';\n3. import { assign } from \'../../shared/index.js\';\n4. import getStaticAttributeValue from \'../../utils/getStaticAttributeValue\';\n5. import isChildOfComponent from \'../shared/utils/isChildOfComponent\';\n6. import { DomGenerator } from \'./index\';\n7. import { Node } from \'../../interfaces\';\n8. import { State } from \'./interfaces\';\n9. \n10. function isElseIf(node: Node) {\n11. \treturn (\n12. \t\tnode && node.children.length === 1 && node.children[0].type === \'IfBlock\'\n13. \t);\n14. }\n15. \n16. function getChildState(parent: State, child = {}) {\n17. \treturn assign(\n18. \t\t{},\n19. \t\tparent,\n20. \t\t{ parentNode: null, parentNodes: \'nodes\' },\n21. \t\tchild || {}\n22. \t);\n23. }\n24. \n25. function createDebuggingComment(node: Node, generator: DomGenerator) {\n26. \tconst { locate, source } = generator;\n27. \n28. \tlet c = node.start;\n29. \tif (node.type === \'ElseBlock\') {\n30. \t\twhile (source[c] !== \'{\') c -= 1;\n31. \t\tc -= 1;\n32. \t}\n33. \n34. \tlet d = node.expression ? node.expression.end : c;\n35. \twhile (source[d] !== \'}\') d += 1;\n36. \td += 2;\n37. \n38. \tconst start = locate(c);\n39. \tconst loc = `(${start.line + 1}:${start.column})`;\n40. \n41. \treturn `${loc} ${source.slice(c, d)}`.replace(/\\n/g, \' \');\n42. }\n43. \n44. function cannotUseInnerHTML(node: Node) {\n45. \twhile (node && node.canUseInnerHTML) {\n46. \t\tnode.canUseInnerHTML = false;\n47. \t\tnode = node.parent;\n48. \t}\n49. }\n50. \n51. // Whitespace inside one of these elements will not result in\n52. // a whitespace node being created in any circumstances. (This\n53. // list is almost certainly very incomplete)\n54. const elementsWithoutText = new Set([\n55. \t\'audio\',\n56. \t\'datalist\',\n57. \t\'dl\',\n58. \t\'ol\',\n59. \t\'optgroup\',\n60. \t\'select\',\n61. \t\'ul\',\n62. \t\'video\',\n63. ]);\n64. \n65. const preprocessors = {\n66. \tMustacheTag: (\n67. \t\tgenerator: DomGenerator,\n68. \t\tblock: Block,\n69. \t\tstate: State,\n70. \t\tnode: Node,\n71. \t\telementStack: Node[],\n72. \t\tcomponentStack: Node[],\n73. \t\tstripWhitespace: boolean\n74. \t) => {\n75. \t\tcannotUseInnerHTML(node);\n76. \t\tnode.var = block.getUniqueName(\'text\');\n77. \n78. \t\tconst dependencies = block.findDependencies(node.expression);\n79. \t\tblock.addDependencies(dependencies);\n80. \t},\n81. \n82. \tRawMustacheTag: (\n83. \t\tgenerator: DomGenerator,\n84. \t\tblock: Block,\n85. \t\tstate: State,\n86. \t\tnode: Node,\n87. \t\telementStack: Node[],\n88. \t\tcomponentStack: Node[],\n89. \t\tstripWhitespace: boolean\n90. \t) => {\n91. \t\tcannotUseInnerHTML(node);\n92. \t\tnode.var = block.getUniqueName(\'raw\');\n93. \n94. \t\tconst dependencies = block.findDependencies(node.expression);\n95. \t\tblock.addDependencies(dependencies);\n96. \t},\n97. \n98. \tText: (\n99. \t\tgenerator: DomGenerator,\n100. \t\tblock: Block,\n101. \t\tstate: State,\n102. \t\tnode: Node,\n103. \t\telementStack: Node[],\n104. \t\tcomponentStack: Node[],\n105. \t\tstripWhitespace: boolean\n106. \t) => {\n107. \t\tif (!/\\S/.test(node.data) && (state.namespace || elementsWithoutText.has(state.parentNodeName))) {\n108. \t\t\tnode.shouldSkip = true;\n109. \t\t\treturn;\n110. \t\t}\n111. \n112. \t\tnode.var = block.getUniqueName(`text`);\n113. \t},\n114. \n115. \tIfBlock: (\n116. \t\tgenerator: DomGenerator,\n117. \t\tblock: Block,\n118. \t\tstate: State,\n119. \t\tnode: Node,\n120. \t\tinEachBlock: boolean,\n121. \t\telementStack: Node[],\n122. \t\tcomponentStack: Node[],\n123. \t\tstripWhitespace: boolean,\n124. \t\tnextSibling: Node\n125. \t) => {\n126. \t\tcannotUseInnerHTML(node);\n127. \n128. \t\tconst blocks: Block[] = [];\n129. \t\tlet dynamic = false;\n130. \t\tlet hasIntros = false;\n131. \t\tlet hasOutros = false;\n132. \n133. \t\tfunction attachBlocks(node: Node) {\n134. \t\t\tnode.var = block.getUniqueName(`if_block`);\n135. \n136. \t\t\tconst dependencies = block.findDependencies(node.expression);\n137. \t\t\tblock.addDependencies(dependencies);\n138. \n139. \t\t\tnode._block = block.child({\n140. \t\t\t\tcomment: createDebuggingComment(node, generator),\n141. \t\t\t\tname: generator.getUniqueName(`create_if_block`),\n142. \t\t\t});\n143. \n144. \t\t\tnode._state = getChildState(state);\n145. \n146. \t\t\tblocks.push(node._block);\n147. \t\t\tpreprocessChildren(generator, node._block, node._state, node, inEachBlock, elementStack, componentStack, stripWhitespace, nextSibling);\n148. \n149. \t\t\tif (node._block.dependencies.size > 0) {\n150. \t\t\t\tdynamic = true;\n151. \t\t\t\tblock.addDependencies(node._block.dependencies);\n152. \t\t\t}\n153. \n154. \t\t\tif (node._block.hasIntroMethod) hasIntros = true;\n155. \t\t\tif (node._block.hasOutroMethod) hasOutros = true;\n156. \n157. \t\t\tif (isElseIf(node.else)) {\n158. \t\t\t\tattachBlocks(node.else.children[0]);\n159. \t\t\t} else if (node.else) {\n160. \t\t\t\tnode.else._block = block.child({\n161. \t\t\t\t\tcomment: createDebuggingComment(node.else, generator),\n162. \t\t\t\t\tname: generator.getUniqueName(`create_if_block`),\n163. \t\t\t\t});\n164. \n165. \t\t\t\tnode.else._state = getChildState(state);\n166. \n167. \t\t\t\tblocks.push(node.else._block);\n168. \t\t\t\tpreprocessChildren(\n169. \t\t\t\t\tgenerator,\n170. \t\t\t\t\tnode.else._block,\n171. \t\t\t\t\tnode.else._state,\n172. \t\t\t\t\tnode.else,\n173. \t\t\t\t\tinEachBlock,\n174. \t\t\t\t\telementStack,\n175. \t\t\t\t\tcomponentStack,\n176. \t\t\t\t\tstripWhitespace,\n177. \t\t\t\t\tnextSibling\n178. \t\t\t\t);\n179. \n180. \t\t\t\tif (node.else._block.dependencies.size > 0) {\n181. \t\t\t\t\tdynamic = true;\n182. \t\t\t\t\tblock.addDependencies(node.else._block.dependencies);\n183. \t\t\t\t}\n184. \t\t\t}\n185. \t\t}\n186. \n187. \t\tattachBlocks(node);\n188. \n189. \t\tblocks.forEach(block => {\n190. \t\t\tblock.hasUpdateMethod = dynamic;\n191. \t\t\tblock.hasIntroMethod = hasIntros;\n192. \t\t\tblock.hasOutroMethod = hasOutros;\n193. \t\t});\n194. \n195. \t\tgenerator.blocks.push(...blocks);\n196. \t},\n197. \n198. \tEachBlock: (\n199. \t\tgenerator: DomGenerator,\n200. \t\tblock: Block,\n201. \t\tstate: State,\n202. \t\tnode: Node,\n203. \t\tinEachBlock: boolean,\n204. \t\telementStack: Node[],\n205. \t\tcomponentStack: Node[],\n206. \t\tstripWhitespace: boolean,\n207. \t\tnextSibling: Node\n208. \t) => {\n209. \t\tcannotUseInnerHTML(node);\n210. \t\tnode.var = block.getUniqueName(`each`);\n211. \n212. \t\tconst dependencies = block.findDependencies(node.expression);\n213. \t\tblock.addDependencies(dependencies);\n214. \n215. \t\tconst indexNames = new Map(block.indexNames);\n216. \t\tconst indexName =\n217. \t\t\tnode.index || block.getUniqueName(`${node.context}_index`);\n218. \t\tindexNames.set(node.context, indexName);\n219. \n220. \t\tconst listNames = new Map(block.listNames);\n221. \t\tconst listName = block.getUniqueName(\n222. \t\t\t(node.expression.type === \'MemberExpression\' && !node.expression.computed) ? node.expression.property.name :\n223. \t\t\tnode.expression.type === \'Identifier\' ? node.expression.name :\n224. \t\t\t`each_value`\n225. \t\t);\n226. \t\tlistNames.set(node.context, listName);\n227. \n228. \t\tconst context = generator.getUniqueName(node.context);\n229. \t\tconst contexts = new Map(block.contexts);\n230. \t\tcontexts.set(node.context, context);\n231. \n232. \t\tconst indexes = new Map(block.indexes);\n233. \t\tif (node.index) indexes.set(node.index, node.context);\n234. \n235. \t\tconst changeableIndexes = new Map(block.changeableIndexes);\n236. \t\tif (node.index) changeableIndexes.set(node.index, node.key);\n237. \n238. \t\tconst contextDependencies = new Map(block.contextDependencies);\n239. \t\tcontextDependencies.set(node.context, dependencies);\n240. \n241. \t\tif (node.destructuredContexts) {\n242. \t\t\tfor (const i = 0; i < node.destructuredContexts.length; i++) {\n243. \t\t\t\tcontexts.set(node.destructuredContexts[i], `${context}[${i}]`);\n244. \t\t\t\tcontextDependencies.set(node.destructuredContexts[i], dependencies);\n245. \t\t\t}\n246. \t\t}\n247. \n248. \t\tnode._block = block.child({\n249. \t\t\tcomment: createDebuggingComment(node, generator),\n250. \t\t\tname: generator.getUniqueName(\'create_each_block\'),\n251. \t\t\texpression: node.expression,\n252. \t\t\tcontext: node.context,\n253. \t\t\tkey: node.key,\n254. \n255. \t\t\tcontextDependencies,\n256. \t\t\tcontexts,\n257. \t\t\tindexes,\n258. \t\t\tchangeableIndexes,\n259. \n260. \t\t\tlistName,\n261. \t\t\tindexName,\n262. \n263. \t\t\tindexNames,\n264. \t\t\tlistNames,\n265. \t\t\tparams: block.params.concat(listName, context, indexName),\n266. \t\t});\n267. \n268. \t\tnode._state = getChildState(state, {\n269. \t\t\tinEachBlock: true,\n270. \t\t});\n271. \n272. \t\tgenerator.blocks.push(node._block);\n273. \t\tpreprocessChildren(generator, node._block, node._state, node, true, elementStack, componentStack, stripWhitespace, nextSibling);\n274. \t\tblock.addDependencies(node._block.dependencies);\n275. \t\tnode._block.hasUpdateMethod = node._block.dependencies.size > 0;\n276. \n277. \t\tif (node.else) {\n278. \t\t\tnode.else._block = block.child({\n279. \t\t\t\tcomment: createDebuggingComment(node.else, generator),\n280. \t\t\t\tname: generator.getUniqueName(`${node._block.name}_else`),\n281. \t\t\t});\n282. \n283. \t\t\tnode.else._state = getChildState(state);\n284. \n285. \t\t\tgenerator.blocks.push(node.else._block);\n286. \t\t\tpreprocessChildren(\n287. \t\t\t\tgenerator,\n288. \t\t\t\tnode.else._block,\n289. \t\t\t\tnode.else._state,\n290. \t\t\t\tnode.else,\n291. \t\t\t\tinEachBlock,\n292. \t\t\t\telementStack,\n293. \t\t\t\tcomponentStack,\n294. \t\t\t\tstripWhitespace,\n295. \t\t\t\tnextSibling\n296. \t\t\t);\n297. \t\t\tnode.else._block.hasUpdateMethod = node.else._block.dependencies.size > 0;\n298. \t\t}\n299. \t},\n300. \n301. \tElement: (\n302. \t\tgenerator: DomGenerator,\n303. \t\tblock: Block,\n304. \t\tstate: State,\n305. \t\tnode: Node,\n306. \t\tinEachBlock: boolean,\n307. \t\telementStack: Node[],\n308. \t\tcomponentStack: Node[],\n309. \t\tstripWhitespace: boolean,\n310. \t\tnextSibling: Node\n311. \t) => {\n312. \t\tif (node.name === \'slot\') {\n313. \t\t\tcannotUseInnerHTML(node);\n314. \t\t}\n315. \n316. \t\tnode.attributes.forEach((attribute: Node) => {\n317. \t\t\tif (attribute.type === \'Attribute\' && attribute.value !== true) {\n318. \t\t\t\tattribute.value.forEach((chunk: Node) => {\n319. \t\t\t\t\tif (chunk.type !== \'Text\') {\n320. \t\t\t\t\t\tif (node.parent) cannotUseInnerHTML(node.parent);\n321. \n322. \t\t\t\t\t\tconst dependencies = block.findDependencies(chunk.expression);\n323. \t\t\t\t\t\tblock.addDependencies(dependencies);\n324. \n325. \t\t\t\t\t\t// special case — <option value=\'{{foo}}\'> — see below\n326. \t\t\t\t\t\tif (\n327. \t\t\t\t\t\t\tnode.name === \'option\' &&\n328. \t\t\t\t\t\t\tattribute.name === \'value\' &&\n329. \t\t\t\t\t\t\tstate.selectBindingDependencies\n330. \t\t\t\t\t\t) {\n331. \t\t\t\t\t\t\tstate.selectBindingDependencies.forEach(prop => {\n332. \t\t\t\t\t\t\t\tdependencies.forEach((dependency: string) => {\n333. \t\t\t\t\t\t\t\t\tgenerator.indirectDependencies.get(prop).add(dependency);\n334. \t\t\t\t\t\t\t\t});\n335. \t\t\t\t\t\t\t});\n336. \t\t\t\t\t\t}\n337. \t\t\t\t\t}\n338. \t\t\t\t});\n339. \t\t\t} else {\n340. \t\t\t\tif (node.parent) cannotUseInnerHTML(node.parent);\n341. \n342. \t\t\t\tif (attribute.type === \'EventHandler\' && attribute.expression) {\n343. \t\t\t\t\tattribute.expression.arguments.forEach((arg: Node) => {\n344. \t\t\t\t\t\tconst dependencies = block.findDependencies(arg);\n345. \t\t\t\t\t\tblock.addDependencies(dependencies);\n346. \t\t\t\t\t});\n347. \t\t\t\t} else if (attribute.type === \'Binding\') {\n348. \t\t\t\t\tconst dependencies = block.findDependencies(attribute.value);\n349. \t\t\t\t\tblock.addDependencies(dependencies);\n350. \t\t\t\t} else if (attribute.type === \'Transition\') {\n351. \t\t\t\t\tif (attribute.intro)\n352. \t\t\t\t\t\tgenerator.hasIntroTransitions = block.hasIntroMethod = true;\n353. \t\t\t\t\tif (attribute.outro) {\n354. \t\t\t\t\t\tgenerator.hasOutroTransitions = block.hasOutroMethod = true;\n355. \t\t\t\t\t\tblock.outros += 1;\n356. \t\t\t\t\t}\n357. \t\t\t\t}\n358. \t\t\t}\n359. \t\t});\n360. \n361. \t\t// special case — in a case like this...\n362. \t\t//\n363. \t\t//   <select bind:value=\'foo\'>\n364. \t\t//     <option value=\'{{bar}}\'>bar</option>\n365. \t\t//     <option value=\'{{baz}}\'>baz</option>\n366. \t\t//   </option>\n367. \t\t//\n368. \t\t// ...we need to know that `foo` depends on `bar` and `baz`,\n369. \t\t// so that if `foo.qux` changes, we know that we need to\n370. \t\t// mark `bar` and `baz` as dirty too\n371. \t\tif (node.name === \'select\') {\n372. \t\t\tcannotUseInnerHTML(node);\n373. \n374. \t\t\tconst value = node.attributes.find(\n375. \t\t\t\t(attribute: Node) => attribute.name === \'value\'\n376. \t\t\t);\n377. \t\t\tif (value) {\n378. \t\t\t\t// TODO does this also apply to e.g. `<input type=\'checkbox\' bind:group=\'foo\'>`?\n379. \t\t\t\tconst dependencies = block.findDependencies(value.value);\n380. \t\t\t\tstate.selectBindingDependencies = dependencies;\n381. \t\t\t\tdependencies.forEach((prop: string) => {\n382. \t\t\t\t\tgenerator.indirectDependencies.set(prop, new Set());\n383. \t\t\t\t});\n384. \t\t\t} else {\n385. \t\t\t\tstate.selectBindingDependencies = null;\n386. \t\t\t}\n387. \t\t}\n388. \n389. \t\tconst isComponent =\n390. \t\t\tgenerator.components.has(node.name) || node.name === \':Self\';\n391. \n392. \t\tif (isComponent) {\n393. \t\t\tcannotUseInnerHTML(node);\n394. \n395. \t\t\tnode.var = block.getUniqueName(\n396. \t\t\t\t(node.name === \':Self\' ? generator.name : node.name).toLowerCase()\n397. \t\t\t);\n398. \n399. \t\t\tnode._state = getChildState(state, {\n400. \t\t\t\tparentNode: `${node.var}._slotted.default`\n401. \t\t\t});\n402. \t\t} else {\n403. \t\t\tconst slot = getStaticAttributeValue(node, \'slot\');\n404. \t\t\tif (slot && isChildOfComponent(node, generator)) {\n405. \t\t\t\tcannotUseInnerHTML(node);\n406. \t\t\t\tnode.slotted = true;\n407. \t\t\t\t// TODO validate slots — no nesting, no dynamic names...\n408. \t\t\t\tconst component = componentStack[componentStack.length - 1];\n409. \t\t\t\tcomponent._slots.add(slot);\n410. \t\t\t}\n411. \n412. \t\t\tnode.var = block.getUniqueName(\n413. \t\t\t\tnode.name.replace(/[^a-zA-Z0-9_$]/g, \'_\')\n414. \t\t\t);\n415. \n416. \t\t\tnode._state = getChildState(state, {\n417. \t\t\t\tisTopLevel: false,\n418. \t\t\t\tparentNode: node.var,\n419. \t\t\t\tparentNodes: block.getUniqueName(`${node.var}_nodes`),\n420. \t\t\t\tparentNodeName: node.name,\n421. \t\t\t\tnamespace: node.name === \'svg\'\n422. \t\t\t\t\t? \'http://www.w3.org/2000/svg\'\n423. \t\t\t\t\t: state.namespace,\n424. \t\t\t\tallUsedContexts: [],\n425. \t\t\t});\n426. \n427. \t\t\tgenerator.stylesheet.apply(node, elementStack);\n428. \t\t}\n429. \n430. \t\tif (node.children.length) {\n431. \t\t\tif (isComponent) {\n432. \t\t\t\tif (node.children) node._slots = new Set([\'default\']);\n433. \t\t\t\tpreprocessChildren(generator, block, node._state, node, inEachBlock, elementStack, componentStack.concat(node), stripWhitespace, nextSibling);\n434. \t\t\t} else {\n435. \t\t\t\tif (node.name === \'pre\' || node.name === \'textarea\') stripWhitespace = false;\n436. \t\t\t\tpreprocessChildren(generator, block, node._state, node, inEachBlock, elementStack.concat(node), componentStack, stripWhitespace, nextSibling);\n437. \t\t\t}\n438. \t\t}\n439. \t},\n440. };\n441. \n442. function preprocessChildren(\n443. \tgenerator: DomGenerator,\n444. \tblock: Block,\n445. \tstate: State,\n446. \tnode: Node,\n447. \tinEachBlock: boolean,\n448. \telementStack: Node[],\n449. \tcomponentStack: Node[],\n450. \tstripWhitespace: boolean,\n451. \tnextSibling: Node\n452. ) {\n453. \t// glue text nodes together\n454. \tconst cleaned: Node[] = [];\n455. \tlet lastChild: Node;\n456. \n457. \tnode.children.forEach((child: Node) => {\n458. \t\tif (child.type === \'Comment\') return;\n459. \n460. \t\tif (child.type === \'Text\' && lastChild && lastChild.type === \'Text\') {\n461. \t\t\tlastChild.data += child.data;\n462. \t\t\tlastChild.end = child.end;\n463. \t\t} else {\n464. \t\t\tif (child.type === \'Text\' && stripWhitespace && cleaned.length === 0) {\n465. \t\t\t\tchild.data = trimStart(child.data);\n466. \t\t\t\tif (child.data) cleaned.push(child);\n467. \t\t\t} else {\n468. \t\t\t\tcleaned.push(child);\n469. \t\t\t}\n470. \t\t}\n471. \n472. \t\tlastChild = child;\n473. \t});\n474. \n475. \tlastChild = null;\n476. \n477. \tcleaned.forEach((child: Node, i: number) => {\n478. \t\tchild.parent = node;\n479. \t\tchild.canUseInnerHTML = !generator.hydratable;\n480. \n481. \t\tconst preprocessor = preprocessors[child.type];\n482. \t\tif (preprocessor) preprocessor(generator, block, state, child, inEachBlock, elementStack, componentStack, stripWhitespace, cleaned[i + 1] || nextSibling);\n483. \n484. \t\tif (child.shouldSkip) return;\n485. \n486. \t\tif (lastChild) lastChild.next = child;\n487. \t\tchild.prev = lastChild;\n488. \n489. \t\tlastChild = child;\n490. \t});\n491. \n492. \t// We want to remove trailing whitespace inside an element/component/block,\n493. \t// *unless* there is no whitespace between this node and its next sibling\n494. \tif (stripWhitespace && lastChild && lastChild.type === \'Text\') {\n495. \t\tconst shouldTrim = (\n496. \t\t\tnextSibling ?  (nextSibling.type === \'Text\' && /^\\s/.test(nextSibling.data)) : !inEachBlock\n497. \t\t);\n498. \n499. \t\tif (shouldTrim) {\n500. \t\t\tlastChild.data = trimEnd(lastChild.data);\n501. \t\t\tif (!lastChild.data) {\n502. \t\t\t\tcleaned.pop();\n503. \t\t\t\tlastChild = cleaned[cleaned.length - 1];\n504. \t\t\t\tlastChild.next = null;\n505. \t\t\t}\n506. \t\t}\n507. \t}\n508. \n509. \tnode.children = cleaned;\n510. }\n511. \n512. export default function preprocess(\n513. \tgenerator: DomGenerator,\n514. \tnamespace: string,\n515. \tnode: Node\n516. ) {\n517. \tconst block = new Block({\n518. \t\tgenerator,\n519. \t\tname: \'@create_main_fragment\',\n520. \t\tkey: null,\n521. \n522. \t\tcontexts: new Map(),\n523. \t\tindexes: new Map(),\n524. \t\tchangeableIndexes: new Map(),\n525. \t\tcontextDependencies: new Map(),\n526. \n527. \t\tparams: [\'state\'],\n528. \t\tindexNames: new Map(),\n529. \t\tlistNames: new Map(),\n530. \n531. \t\tdependencies: new Set(),\n532. \t});\n533. \n534. \tconst state: State = {\n535. \t\tnamespace,\n536. \t\tparentNode: null,\n537. \t\tparentNodes: \'nodes\'\n538. \t};\n539. \n540. \tgenerator.blocks.push(block);\n541. \tpreprocessChildren(generator, block, state, node, false, [], [], true, null);\n542. \tblock.hasUpdateMethod = true;\n543. \n544. \treturn { block, state };\n545. }\n\n\nFile: src/generators/dom/visit.ts\nLine number range: 1 - 17\nContent:\n1. import visitors from \'./visitors/index\';\n2. import { DomGenerator } from \'./index\';\n3. import Block from \'./Block\';\n4. import { Node } from \'../../interfaces\';\n5. import { State } from \'./interfaces\';\n6. \n7. export default function visit(\n8. \tgenerator: DomGenerator,\n9. \tblock: Block,\n10. \tstate: State,\n11. \tnode: Node,\n12. \telementStack: Node[],\n13. \tcomponentStack: Node[]\n14. ) {\n15. \tconst visitor = visitors[node.type];\n16. \tvisitor(generator, block, state, node, elementStack, componentStack);\n17. }\n\n\nFile: src/generators/dom/visitors/index.ts\nLine number range: 1 - 18\nContent:\n1. import EachBlock from \'./EachBlock\';\n2. import Element from \'./Element/Element\';\n3. import IfBlock from \'./IfBlock\';\n4. import MustacheTag from \'./MustacheTag\';\n5. import RawMustacheTag from \'./RawMustacheTag\';\n6. import Text from \'./Text\';\n7. import { Visitor } from \'../interfaces\';\n8. \n9. const visitors: Record<string, Visitor> = {\n10. \tEachBlock,\n11. \tElement,\n12. \tIfBlock,\n13. \tMustacheTag,\n14. \tRawMustacheTag,\n15. \tText\n16. };\n17. \n18. export default visitors;\n\n\nFile: src/generators/shared/utils/wrapModule.ts\nLine number range: 1 - 298\nContent:\n1. import deindent from \'../../../utils/deindent\';\n2. import { CompileOptions, ModuleFormat, Node } from \'../../../interfaces\';\n3. \n4. interface Dependency {\n5. \tname: string;\n6. \tstatements: string[];\n7. \tsource: string;\n8. }\n9. \n10. const wrappers = { es, amd, cjs, iife, umd, eval: expr };\n11. \n12. export default function wrapModule(\n13. \tcode: string,\n14. \tformat: ModuleFormat,\n15. \tname: string,\n16. \toptions: CompileOptions,\n17. \tbanner: string,\n18. \tsharedPath: string,\n19. \thelpers: { name: string, alias: string }[],\n20. \timports: Node[],\n21. \tsource: string\n22. ): string {\n23. \tif (format === \'es\') return es(code, name, options, banner, sharedPath, helpers, imports, source);\n24. \n25. \tconst dependencies = imports.map((declaration, i) => {\n26. \t\tconst defaultImport = declaration.specifiers.find(\n27. \t\t\t(x: Node) =>\n28. \t\t\t\tx.type === \'ImportDefaultSpecifier\' ||\n29. \t\t\t\t(x.type === \'ImportSpecifier\' && x.imported.name === \'default\')\n30. \t\t);\n31. \n32. \t\tconst namespaceImport = declaration.specifiers.find(\n33. \t\t\t(x: Node) => x.type === \'ImportNamespaceSpecifier\'\n34. \t\t);\n35. \n36. \t\tconst namedImports = declaration.specifiers.filter(\n37. \t\t\t(x: Node) =>\n38. \t\t\t\tx.type === \'ImportSpecifier\' && x.imported.name !== \'default\'\n39. \t\t);\n40. \n41. \t\tconst name = defaultImport || namespaceImport\n42. \t\t\t? (defaultImport || namespaceImport).local.name\n43. \t\t\t: `__import${i}`;\n44. \n45. \t\tconst statements: string[] = [];\n46. \n47. \t\tnamedImports.forEach((specifier: Node) => {\n48. \t\t\tstatements.push(\n49. \t\t\t\t`var ${specifier.local.name} = ${name}.${specifier.imported.name};`\n50. \t\t\t);\n51. \t\t});\n52. \n53. \t\tif (defaultImport) {\n54. \t\t\tstatements.push(\n55. \t\t\t\t`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`\n56. \t\t\t);\n57. \t\t}\n58. \n59. \t\treturn { name, statements, source: declaration.source.value };\n60. \t});\n61. \n62. \tif (format === \'amd\') return amd(code, name, options, banner, dependencies);\n63. \tif (format === \'cjs\') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);\n64. \tif (format === \'iife\') return iife(code, name, options, banner, dependencies);\n65. \tif (format === \'umd\') return umd(code, name, options, banner, dependencies);\n66. \tif (format === \'eval\') return expr(code, name, options, banner, dependencies);\n67. \n68. \tthrow new Error(`Not implemented: ${format}`);\n69. }\n70. \n71. function es(\n72. \tcode: string,\n73. \tname: string,\n74. \toptions: CompileOptions,\n75. \tbanner: string,\n76. \tsharedPath: string,\n77. \thelpers: { name: string, alias: string }[],\n78. \timports: Node[],\n79. \tsource: string\n80. ) {\n81. \tconst importHelpers = helpers && (\n82. \t\t`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(\', \')} } from ${JSON.stringify(sharedPath)};`\n83. \t);\n84. \n85. \tconst importBlock = imports.length > 0 && (\n86. \t\timports\n87. \t\t\t.map((declaration: Node) => source.slice(declaration.start, declaration.end))\n88. \t\t\t.join(\'\\n\')\n89. \t);\n90. \n91. \treturn deindent`\n92. \t\t${banner}\n93. \t\t${importHelpers}\n94. \t\t${importBlock}\n95. \n96. \t\t${code}\n97. \t\texport default ${name};`;\n98. }\n99. \n100. function amd(\n101. \tcode: string,\n102. \tname: string,\n103. \toptions: CompileOptions,\n104. \tbanner: string,\n105. \tdependencies: Dependency[]\n106. ) {\n107. \tconst sourceString = dependencies.length\n108. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n109. \t\t: \'\';\n110. \n111. \tconst id = options.amd && options.amd.id;\n112. \n113. \treturn deindent`\n114. \t\tdefine(${id ? `"${id}", ` : \'\'}${sourceString}function(${paramString(dependencies)}) { "use strict";\n115. \t\t\t${getCompatibilityStatements(dependencies)}\n116. \n117. \t\t\t${code}\n118. \t\t\treturn ${name};\n119. \t\t});`;\n120. }\n121. \n122. function cjs(\n123. \tcode: string,\n124. \tname: string,\n125. \toptions: CompileOptions,\n126. \tbanner: string,\n127. \tsharedPath: string,\n128. \thelpers: { name: string, alias: string }[],\n129. \tdependencies: Dependency[]\n130. ) {\n131. \tconst SHARED = \'__shared\';\n132. \tconst helperBlock = helpers && (\n133. \t\t`var ${SHARED} = require(${JSON.stringify(sharedPath)});\\n` +\n134. \t\thelpers.map(helper => {\n135. \t\t\treturn `var ${helper.alias} = ${SHARED}.${helper.name};`;\n136. \t\t}).join(\'\\n\')\n137. \t);\n138. \n139. \tconst requireBlock = dependencies.length > 0 && (\n140. \t\tdependencies\n141. \t\t\t.map(d => `var ${d.name} = require("${d.source}");`)\n142. \t\t\t.join(\'\\n\\n\')\n143. \t);\n144. \n145. \treturn deindent`\n146. \t\t${banner}\n147. \t\t"use strict";\n148. \n149. \t\t${helperBlock}\n150. \t\t${requireBlock}\n151. \t\t${getCompatibilityStatements(dependencies)}\n152. \n153. \t\t${code}\n154. \n155. \t\tmodule.exports = ${name};`\n156. }\n157. \n158. function iife(\n159. \tcode: string,\n160. \tname: string,\n161. \toptions: CompileOptions,\n162. \tbanner: string,\n163. \tdependencies: Dependency[]\n164. ) {\n165. \tif (!options.name) {\n166. \t\tthrow new Error(`Missing required \'name\' option for IIFE export`);\n167. \t}\n168. \n169. \tconst globals = getGlobals(dependencies, options);\n170. \n171. \treturn deindent`\n172. \t\t${banner}\n173. \t\tvar ${options.name} = (function(${paramString(dependencies)}) { "use strict";\n174. \t\t\t${getCompatibilityStatements(dependencies)}\n175. \n176. \t\t\t${code}\n177. \t\t\treturn ${name};\n178. \t\t}(${globals.join(\', \')}));`;\n179. }\n180. \n181. function umd(\n182. \tcode: string,\n183. \tname: string,\n184. \toptions: CompileOptions,\n185. \tbanner: string,\n186. \tdependencies: Dependency[]\n187. ) {\n188. \tif (!options.name) {\n189. \t\tthrow new Error(`Missing required \'name\' option for UMD export`);\n190. \t}\n191. \n192. \tconst amdId = options.amd && options.amd.id ? `\'${options.amd.id}\', ` : \'\';\n193. \n194. \tconst amdDeps = dependencies.length\n195. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n196. \t\t: \'\';\n197. \n198. \tconst cjsDeps = dependencies\n199. \t\t.map(d => `require("${d.source}")`)\n200. \t\t.join(\', \');\n201. \n202. \tconst globals = getGlobals(dependencies, options);\n203. \n204. \treturn deindent`\n205. \t\t${banner}\n206. \t\t(function(global, factory) {\n207. \t\t\ttypeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :\n208. \t\t\ttypeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :\n209. \t\t\t(global.${options.name} = factory(${globals}));\n210. \t\t}(this, (function (${paramString(dependencies)}) { "use strict";\n211. \n212. \t\t\t${getCompatibilityStatements(dependencies)}\n213. \n214. \t\t\t${code}\n215. \n216. \t\t\treturn ${name};\n217. \n218. \t\t})));`;\n219. }\n220. \n221. function expr(\n222. \tcode: string,\n223. \tname: string,\n224. \toptions: CompileOptions,\n225. \tbanner: string,\n226. \tdependencies: Dependency[]\n227. ) {\n228. \tconst globals = getGlobals(dependencies, options);\n229. \n230. \treturn deindent`\n231. \t\t(function (${paramString(dependencies)}) { "use strict";\n232. \t\t\t${banner}\n233. \n234. \t\t\t${getCompatibilityStatements(dependencies)}\n235. \n236. \t\t\t${code}\n237. \n238. \t\t\treturn ${name};\n239. \t\t}(${globals.join(\', \')}))`;\n240. }\n241. \n242. function paramString(dependencies: Dependency[]) {\n243. \treturn dependencies.map(dep => dep.name).join(\', \');\n244. }\n245. \n246. function removeExtension(file: string) {\n247. \tconst index = file.lastIndexOf(\'.\');\n248. \treturn ~index ? file.slice(0, index) : file;\n249. }\n250. \n251. function getCompatibilityStatements(dependencies: Dependency[]) {\n252. \tif (!dependencies.length) return null;\n253. \n254. \tconst statements: string[] = [];\n255. \n256. \tdependencies.forEach(dependency => {\n257. \t\tstatements.push(...dependency.statements);\n258. \t});\n259. \n260. \treturn statements.join(\'\\n\');\n261. }\n262. \n263. function getGlobals(dependencies: Dependency[], options: CompileOptions) {\n264. \tconst { globals, onerror, onwarn } = options;\n265. \tconst globalFn = getGlobalFn(globals);\n266. \n267. \treturn dependencies.map(d => {\n268. \t\tlet name = globalFn(d.source);\n269. \n270. \t\tif (!name) {\n271. \t\t\tif (d.name.startsWith(\'__import\')) {\n272. \t\t\t\tconst error = new Error(\n273. \t\t\t\t\t`Could not determine name for imported module \'${d.source}\' – use options.globals`\n274. \t\t\t\t);\n275. \t\t\t\tonerror(error);\n276. \t\t\t} else {\n277. \t\t\t\tconst warning = {\n278. \t\t\t\t\tmessage: `No name was supplied for imported module \'${d.source}\'. Guessing \'${d.name}\', but you should use options.globals`,\n279. \t\t\t\t};\n280. \n281. \t\t\t\tonwarn(warning);\n282. \t\t\t}\n283. \n284. \t\t\tname = d.name;\n285. \t\t}\n286. \n287. \t\treturn name;\n288. \t});\n289. }\n290. \n291. function getGlobalFn(globals: any): (id: string) => string {\n292. \tif (typeof globals === \'function\') return globals;\n293. \tif (typeof globals === \'object\') {\n294. \t\treturn id => globals[id];\n295. \t}\n296. \n297. \treturn () => undefined;\n298. }\n\n\nFile: src/index.ts\nLine number range: 1 - 78\nContent:\n1. import parse from \'./parse/index\';\n2. import validate from \'./validate/index\';\n3. import generate from \'./generators/dom/index\';\n4. import generateSSR from \'./generators/server-side-rendering/index\';\n5. import { assign } from \'./shared/index.js\';\n6. import { version } from \'../package.json\';\n7. import Stylesheet from \'./css/Stylesheet\';\n8. import { Parsed, CompileOptions, Warning } from \'./interfaces\';\n9. \n10. function normalizeOptions(options: CompileOptions): CompileOptions {\n11. \tlet normalizedOptions = assign({ generate: \'dom\' }, options);\n12. \tconst { onwarn, onerror } = normalizedOptions;\n13. \tnormalizedOptions.onwarn = onwarn\n14. \t\t? (warning: Warning) => onwarn(warning, defaultOnwarn)\n15. \t\t: defaultOnwarn;\n16. \tnormalizedOptions.onerror = onerror\n17. \t\t? (error: Error) => onerror(error, defaultOnerror)\n18. \t\t: defaultOnerror;\n19. \treturn normalizedOptions;\n20. }\n21. \n22. function defaultOnwarn(warning: Warning) {\n23. \tif (warning.loc) {\n24. \t\tconsole.warn(\n25. \t\t\t`(${warning.loc.line}:${warning.loc.column}) – ${warning.message}`\n26. \t\t); // eslint-disable-line no-console\n27. \t} else {\n28. \t\tconsole.warn(warning.message); // eslint-disable-line no-console\n29. \t}\n30. }\n31. \n32. function defaultOnerror(error: Error) {\n33. \tthrow error;\n34. }\n35. \n36. export function compile(source: string, _options: CompileOptions) {\n37. \tconst options = normalizeOptions(_options);\n38. \n39. \tlet parsed: Parsed;\n40. \n41. \ttry {\n42. \t\tparsed = parse(source, options);\n43. \t} catch (err) {\n44. \t\toptions.onerror(err);\n45. \t\treturn;\n46. \t}\n47. \n48. \tconst stylesheet = new Stylesheet(source, parsed, options.filename, options.cascade !== false);\n49. \n50. \tvalidate(parsed, source, stylesheet, options);\n51. \n52. \tconst compiler = options.generate === \'ssr\' ? generateSSR : generate;\n53. \n54. \treturn compiler(parsed, source, stylesheet, options);\n55. }\n56. \n57. export function create(source: string, _options: CompileOptions = {}) {\n58. \t_options.format = \'eval\';\n59. \n60. \tconst compiled = compile(source, _options);\n61. \n62. \tif (!compiled || !compiled.code) {\n63. \t\treturn;\n64. \t}\n65. \n66. \ttry {\n67. \t\treturn (0,eval)(compiled.code);\n68. \t} catch (err) {\n69. \t\tif (_options.onerror) {\n70. \t\t\t_options.onerror(err);\n71. \t\t\treturn;\n72. \t\t} else {\n73. \t\t\tthrow err;\n74. \t\t}\n75. \t}\n76. }\n77. \n78. export { parse, validate, version as VERSION };\n\n\nFile: src/interfaces.ts\nLine number range: 1 - 80\nContent:\n1. export interface Node {\n2. \tstart: number;\n3. \tend: number;\n4. \ttype: string;\n5. \t[propName: string]: any;\n6. }\n7. \n8. export interface Parser {\n9. \treadonly template: string;\n10. \treadonly filename?: string;\n11. \n12. \tindex: number;\n13. \tstack: Array<Node>;\n14. \n15. \thtml: Node;\n16. \tcss: Node;\n17. \tjs: Node;\n18. \tmetaTags: {};\n19. }\n20. \n21. export interface Parsed {\n22. \thash: number;\n23. \thtml: Node;\n24. \tcss: Node;\n25. \tjs: Node;\n26. }\n27. \n28. export interface Warning {\n29. \tloc?: { line: number; column: number; pos?: number };\n30. \tpos?: number;\n31. \tmessage: string;\n32. \tfilename?: string;\n33. \tframe?: string;\n34. \ttoString: () => string;\n35. }\n36. \n37. export type ModuleFormat = \'es\' | \'amd\' | \'cjs\' | \'iife\' | \'umd\' | \'eval\';\n38. \n39. export interface CompileOptions {\n40. \tformat?: ModuleFormat;\n41. \tname?: string;\n42. \tfilename?: string;\n43. \tgenerate?: string;\n44. \tglobals?: ((id: string) => string) | object;\n45. \tamd?: {\n46. \t\tid?: string;\n47. \t};\n48. \n49. \toutputFilename?: string;\n50. \tcssOutputFilename?: string;\n51. \n52. \tdev?: boolean;\n53. \tshared?: boolean | string;\n54. \tcascade?: boolean;\n55. \thydratable?: boolean;\n56. \tlegacy?: boolean;\n57. \tcustomElement?: CustomElementOptions | true;\n58. \tcss?: boolean;\n59. \n60. \tonerror?: (error: Error) => void;\n61. \tonwarn?: (warning: Warning) => void;\n62. }\n63. \n64. export interface GenerateOptions {\n65. \tname: string;\n66. \tformat: ModuleFormat;\n67. \tbanner?: string;\n68. \tsharedPath?: string | boolean;\n69. \thelpers?: { name: string, alias: string }[];\n70. }\n71. \n72. export interface Visitor {\n73. \tenter: (node: Node) => void;\n74. \tleave?: (node: Node) => void;\n75. }\n76. \n77. export interface CustomElementOptions {\n78. \ttag?: string;\n79. \tprops?: string[];\n80. }\n\n\nFile: src/parse/read/script.ts\nLine number range: 1 - 38\nContent:\n1. import { parse } from \'acorn\';\n2. import repeat from \'../../utils/repeat\';\n3. import { Parser } from \'../index\';\n4. import { Node } from \'../../interfaces\';\n5. \n6. const scriptClosingTag = \'</script>\';\n7. \n8. export default function readScript(parser: Parser, start: number, attributes: Node[]) {\n9. \tconst scriptStart = parser.index;\n10. \tconst scriptEnd = parser.template.indexOf(scriptClosingTag, scriptStart);\n11. \n12. \tif (scriptEnd === -1) parser.error(`<script> must have a closing tag`);\n13. \n14. \tconst source =\n15. \t\trepeat(\' \', scriptStart) + parser.template.slice(scriptStart, scriptEnd);\n16. \tparser.index = scriptEnd + scriptClosingTag.length;\n17. \n18. \tlet ast;\n19. \n20. \ttry {\n21. \t\tast = parse(source, {\n22. \t\t\tecmaVersion: 8,\n23. \t\t\tsourceType: \'module\',\n24. \t\t});\n25. \t} catch (err) {\n26. \t\tparser.acornError(err);\n27. \t}\n28. \n29. \tif (!ast.body.length) return null;\n30. \n31. \tast.start = scriptStart;\n32. \treturn {\n33. \t\tstart,\n34. \t\tend: parser.index,\n35. \t\tattributes,\n36. \t\tcontent: ast,\n37. \t};\n38. }\n\n\nFile: src/utils/getObject.ts\nLine number range: 1 - 6\nContent:\n1. import { Node } from \'../interfaces\';\n2. \n3. export default function getObject(node: Node) {\n4. \twhile (node.type === \'MemberExpression\') node = node.object;\n5. \treturn node;\n6. }\n\n\nFile: src/utils/stringify.ts\nLine number range: 1 - 9\nContent:\n1. export function stringify(data: string, options = {}) {\n2. \treturn JSON.stringify(escape(data, options));\n3. }\n4. \n5. export function escape(data: string, { onlyEscapeAtSymbol = false } = {}) {\n6. \treturn data.replace(onlyEscapeAtSymbol ? /(%+|@+)/g : /(%+|@+|#+)/g, (match: string) => {\n7. \t\treturn match + match[0];\n8. \t});\n9. }\n\n\nFile: src/validate/js/index.ts\nLine number range: 1 - 93\nContent:\n1. import propValidators from \'./propValidators/index\';\n2. import fuzzymatch from \'../utils/fuzzymatch\';\n3. import checkForDupes from \'./utils/checkForDupes\';\n4. import checkForComputedKeys from \'./utils/checkForComputedKeys\';\n5. import namespaces from \'../../utils/namespaces\';\n6. import { Validator } from \'../\';\n7. import { Node } from \'../../interfaces\';\n8. \n9. const validPropList = Object.keys(propValidators);\n10. \n11. export default function validateJs(validator: Validator, js: Node) {\n12. \tjs.content.body.forEach((node: Node) => {\n13. \t\t// check there are no named exports\n14. \t\tif (node.type === \'ExportNamedDeclaration\') {\n15. \t\t\tvalidator.error(`A component can only have a default export`, node.start);\n16. \t\t}\n17. \n18. \t\tif (node.type === \'ExportDefaultDeclaration\') {\n19. \t\t\tif (node.declaration.type !== \'ObjectExpression\') {\n20. \t\t\t\treturn validator.error(\n21. \t\t\t\t\t`Default export must be an object literal`,\n22. \t\t\t\t\tnode.declaration.start\n23. \t\t\t\t);\n24. \t\t\t}\n25. \n26. \t\t\tcheckForComputedKeys(validator, node.declaration.properties);\n27. \t\t\tcheckForDupes(validator, node.declaration.properties);\n28. \n29. \t\t\tconst props = validator.properties;\n30. \n31. \t\t\tnode.declaration.properties.forEach((prop: Node) => {\n32. \t\t\t\tprops.set(prop.key.name, prop);\n33. \t\t\t});\n34. \n35. \t\t\t// Remove these checks in version 2\n36. \t\t\tif (props.has(\'oncreate\') && props.has(\'onrender\')) {\n37. \t\t\t\tvalidator.error(\n38. \t\t\t\t\t\'Cannot have both oncreate and onrender\',\n39. \t\t\t\t\tprops.get(\'onrender\').start\n40. \t\t\t\t);\n41. \t\t\t}\n42. \n43. \t\t\tif (props.has(\'ondestroy\') && props.has(\'onteardown\')) {\n44. \t\t\t\tvalidator.error(\n45. \t\t\t\t\t\'Cannot have both ondestroy and onteardown\',\n46. \t\t\t\t\tprops.get(\'onteardown\').start\n47. \t\t\t\t);\n48. \t\t\t}\n49. \n50. \t\t\t// ensure all exported props are valid\n51. \t\t\tnode.declaration.properties.forEach((prop: Node) => {\n52. \t\t\t\tconst propValidator = propValidators[prop.key.name];\n53. \n54. \t\t\t\tif (propValidator) {\n55. \t\t\t\t\tpropValidator(validator, prop);\n56. \t\t\t\t} else {\n57. \t\t\t\t\tconst match = fuzzymatch(prop.key.name, validPropList);\n58. \t\t\t\t\tif (match) {\n59. \t\t\t\t\t\tvalidator.error(\n60. \t\t\t\t\t\t\t`Unexpected property \'${prop.key.name}\' (did you mean \'${match}\'?)`,\n61. \t\t\t\t\t\t\tprop.start\n62. \t\t\t\t\t\t);\n63. \t\t\t\t\t} else if (/FunctionExpression/.test(prop.value.type)) {\n64. \t\t\t\t\t\tvalidator.error(\n65. \t\t\t\t\t\t\t`Unexpected property \'${prop.key.name}\' (did you mean to include it in \'methods\'?)`,\n66. \t\t\t\t\t\t\tprop.start\n67. \t\t\t\t\t\t);\n68. \t\t\t\t\t} else {\n69. \t\t\t\t\t\tvalidator.error(\n70. \t\t\t\t\t\t\t`Unexpected property \'${prop.key.name}\'`,\n71. \t\t\t\t\t\t\tprop.start\n72. \t\t\t\t\t\t);\n73. \t\t\t\t\t}\n74. \t\t\t\t}\n75. \t\t\t});\n76. \n77. \t\t\tif (props.has(\'namespace\')) {\n78. \t\t\t\tconst ns = props.get(\'namespace\').value.value;\n79. \t\t\t\tvalidator.namespace = namespaces[ns] || ns;\n80. \t\t\t}\n81. \n82. \t\t\tvalidator.defaultExport = node;\n83. \t\t}\n84. \t});\n85. \n86. \t[\'components\', \'methods\', \'helpers\', \'transitions\'].forEach(key => {\n87. \t\tif (validator.properties.has(key)) {\n88. \t\t\tvalidator.properties.get(key).value.properties.forEach((prop: Node) => {\n89. \t\t\t\tvalidator[key].set(prop.key.name, prop.value);\n90. \t\t\t});\n91. \t\t}\n92. \t});\n93. }\n\n\nFile: src/validate/js/propValidators/oncreate.ts\nLine number range: 1 - 14\nContent:\n1. import usesThisOrArguments from \'../utils/usesThisOrArguments\';\n2. import { Validator } from \'../../\';\n3. import { Node } from \'../../../interfaces\';\n4. \n5. export default function oncreate(validator: Validator, prop: Node) {\n6. \tif (prop.value.type === \'ArrowFunctionExpression\') {\n7. \t\tif (usesThisOrArguments(prop.value.body)) {\n8. \t\t\tvalidator.error(\n9. \t\t\t\t`\'oncreate\' should be a function expression, not an arrow function expression`,\n10. \t\t\t\tprop.start\n11. \t\t\t);\n12. \t\t}\n13. \t}\n14. }\n\n' additional_kwargs={} response_metadata={}
2025-11-11 00:46:02,805 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_analyzer_node - DEBUG - content='1) Issue Understanding\n\n- Symptom: When a component defines an async lifecycle method in the default export object (e.g., async oncreate() { ... }), the compiled output removes the async keyword from the generated function. As a result, any await expressions inside the function are invalid at runtime because await is only allowed within async functions.\n- Unexpected behavior: The compiler transforms async functions (both object literal methods and arrow functions) into plain non-async functions. This breaks code that uses await inside oncreate (and potentially other template properties that accept functions).\n\n2) Code Analysis\n\n- Involved files and functions:\n  - File: src/generators/Generator.ts\n    - Function block: addArrowFunctionExpression (around lines 511–529)\n    - Function block: addFunctionExpression (around lines 531–537)\n    - Function block: addDeclaration (around lines 545–569) — calls the above for specific properties, including oncreate and ondestroy\n  - File: src/generators/dom/index.ts\n    - Constructor generation uses %oncreate and binds it: var _oncreate = %oncreate.bind(this); (around line 217), and calls @callAll(this._oncreate) later.\n\n- What the problematic code is doing:\n  - addArrowFunctionExpression takes an ArrowFunctionExpression node and generates a normal function declaration string: “function name(params) { … }” or “function name(params) { return expr; }” if the arrow function has a concise body. It does not consider node.async.\n  - addFunctionExpression takes a FunctionExpression node and builds a “function name(…params…) { … }” block by slicing the original source starting at the first “(”. It also does not consider node.async (or node.generator).\n  - addDeclaration wires these helpers to generate named functions for template properties such as oncreate and ondestroy. Because the helpers omit async, any async function becomes non-async in the output.\n\n3) Root Cause\n\n- The generator’s transformation logic does not preserve the async modifier when converting arrow functions or object/method FunctionExpressions into standalone named functions. Specifically:\n  - addArrowFunctionExpression ignores node.async and always emits a non-async function.\n  - addFunctionExpression rebuilds “function name(…)” from the source slice starting at the first “(”, thereby dropping any “async ” that precedes the “function” keyword and any “*” for generators. The reconstructed header never includes async, so await becomes illegal.\n- The bug manifests when templateProperties.oncreate.value is async (either as an object method “async oncreate() { … }” or an arrow “oncreate: async () => { … }”).\n\n4) Fix Suggestion\n\nA) Preserve async for ArrowFunctionExpression-based declarations\n- File: src/generators/Generator.ts\n- Function/block: addArrowFunctionExpression\n- Change: When node.async is true, prepend “async ” to the generated function header. That is, emit “async function name(…) { … }” (for a block body) or “async function name(…) { return [expr]; }” (for a concise body).\n- Why: This preserves the async semantics of the original arrow function so that await remains valid inside the function body. Without this, await causes a syntax/runtime error.\n\nB) Preserve async (and generator) for FunctionExpression-based declarations\n- File: src/generators/Generator.ts\n- Function/block: addFunctionExpression\n- Change: Inspect node.async and node.generator. Prepend “async ” when node.async is true, and include “*” after “function” when node.generator is true, in the constructed function header. For example, emit “async function name[✂c-end✂]” or “function* name[✂c-end✂]”, or “async function* name[✂c-end✂]” for async generators. Keep the slicing starting from “(” for parameters and body as-is.\n- Why: The current implementation discards modifiers that appear before the parameter list, specifically “async ” and the generator “*”. Restoring them ensures the generated function has the same semantics as the original (particularly vital for async oncreate with await).\n\nC) No changes needed in invocation sites\n- File: src/generators/dom/index.ts\n- Function/block: constructor body where %oncreate is bound and invoked (@callAll)\n- Change: None. Binding an async function with .bind(this) is correct and will still return a promise when called; the compiler does not need to await it. The important part is that the function remains async so await inside is legal.\n\nAfter these changes, async oncreate and other async template properties will retain their async nature in the compiled output, ensuring await expressions execute as intended without syntax errors.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 5357, 'prompt_tokens': 18003, 'total_tokens': 23360, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 4352, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--23583335-8293-4d0a-8340-a0964dad0138-0' usage_metadata={'input_tokens': 18003, 'output_tokens': 5357, 'total_tokens': 23360, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 4352}}
2025-11-11 00:46:02,810 - thread-133013323122368.prometheus.lang_graph.nodes.edit_message_node - DEBUG - Sending message to EditNode:
content='--- BEGIN ISSUE INFO ---\nIssue title:\nasync keyword is removed\n\nIssue description: \n[REPL](https://svelte.technology/repl?version=1.41.1&gist=7710173c36cc27e97038ee10a4fe62ab). The `async` keyword is removed from the `oncreate` function:\n\n```js\nexport default {\n  async oncreate() {\n    const data = await fetch(\'foo.json\').then(r => r.json());\n    console.log(data);\n  }\n};\n```\n\nIssue comments:\n\n--- END ISSUE INFO ---\n\nContext Found:\n--- BEGIN CONTEXT ---\nFile: src/generators/Generator.ts\nLine number range: 1 - 20\nContent:\n1. import MagicString, { Bundle } from \'magic-string\';\n2. import { walk } from \'estree-walker\';\n3. import { getLocator } from \'locate-character\';\n4. import deindent from \'../utils/deindent\';\n5. import CodeBuilder from \'../utils/CodeBuilder\';\n6. import getCodeFrame from \'../utils/getCodeFrame\';\n7. import isReference from \'../utils/isReference\';\n8. import flattenReference from \'../utils/flattenReference\';\n9. import globalWhitelist from \'../utils/globalWhitelist\';\n10. import reservedNames from \'../utils/reservedNames\';\n11. import namespaces from \'../utils/namespaces\';\n12. import { removeNode, removeObjectKey } from \'../utils/removeNode\';\n13. import wrapModule from \'./shared/utils/wrapModule\';\n14. import annotateWithScopes from \'../utils/annotateWithScopes\';\n15. import clone from \'../utils/clone\';\n16. import DomBlock from \'./dom/Block\';\n17. import SsrBlock from \'./server-side-rendering/Block\';\n18. import Stylesheet from \'../css/Stylesheet\';\n19. import { Node, GenerateOptions, Parsed, CompileOptions, CustomElementOptions } from \'../interfaces\';\n20. \n\n\nFile: src/generators/Generator.ts\nLine number range: 94 - 111\nContent:\n94. \ttemplateProperties: Record<string, Node>;\n95. \tslots: Set<string>;\n96. \tjavascript: string;\n97. \n98. \tcode: MagicString;\n99. \n100. \tbindingGroups: string[];\n101. \tindirectDependencies: Map<string, Set<string>>;\n102. \texpectedProperties: Set<string>;\n103. \tusesRefs: boolean;\n104. \n105. \tlocate: (c: number) => { line: number, column: number };\n106. \n107. \tstylesheet: Stylesheet;\n108. \n109. \tuserVars: Set<string>;\n110. \ttemplateVars: Map<string, string>;\n111. \taliases: Map<string, string>;\n\n\nFile: src/generators/Generator.ts\nLine number range: 154 - 160\nContent:\n154. \t\tthis.templateVars = new Map();\n155. \t\tthis.aliases = new Map();\n156. \t\tthis.usedNames = new Set();\n157. \n158. \t\tthis.parseJs(dom);\n159. \t\tthis.name = this.alias(name);\n160. \n\n\nFile: src/generators/Generator.ts\nLine number range: 461 - 466\nContent:\n461. \t\tconst computations: Computation[] = [];\n462. \t\tconst templateProperties: Record<string, Node> = {};\n463. \t\tconst componentDefinition = new CodeBuilder();\n464. \n465. \t\tlet namespace = null;\n466. \n\n\nFile: src/generators/Generator.ts\nLine number range: 494 - 509\nContent:\n494. \t\t\tconst defaultExport = this.defaultExport = body.find(\n495. \t\t\t\t(node: Node) => node.type === \'ExportDefaultDeclaration\'\n496. \t\t\t);\n497. \n498. \t\t\tif (defaultExport) {\n499. \t\t\t\tdefaultExport.declaration.properties.forEach((prop: Node) => {\n500. \t\t\t\t\ttemplateProperties[prop.key.name] = prop;\n501. \t\t\t\t});\n502. \n503. \t\t\t\t[\'helpers\', \'events\', \'components\', \'transitions\'].forEach(key => {\n504. \t\t\t\t\tif (templateProperties[key]) {\n505. \t\t\t\t\t\ttemplateProperties[key].value.properties.forEach((prop: Node) => {\n506. \t\t\t\t\t\t\tthis[key].add(prop.key.name);\n507. \t\t\t\t\t\t});\n508. \t\t\t\t\t}\n509. \t\t\t\t});\n\n\nFile: src/generators/Generator.ts\nLine number range: 511 - 543\nContent:\n511. \t\t\t\tconst addArrowFunctionExpression = (name: string, node: Node) => {\n512. \t\t\t\t\tconst { body, params } = node;\n513. \n514. \t\t\t\t\tconst paramString = params.length ?\n515. \t\t\t\t\t\t`[✂${params[0].start}-${params[params.length - 1].end}✂]` :\n516. \t\t\t\t\t\t``;\n517. \n518. \t\t\t\t\tif (body.type === \'BlockStatement\') {\n519. \t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n520. \t\t\t\t\t\t\tfunction ${name}(${paramString}) [✂${body.start}-${body.end}✂]\n521. \t\t\t\t\t\t`);\n522. \t\t\t\t\t} else {\n523. \t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n524. \t\t\t\t\t\t\tfunction ${name}(${paramString}) {\n525. \t\t\t\t\t\t\t\treturn [✂${body.start}-${body.end}✂];\n526. \t\t\t\t\t\t\t}\n527. \t\t\t\t\t\t`);\n528. \t\t\t\t\t}\n529. \t\t\t\t};\n530. \n531. \t\t\t\tconst addFunctionExpression = (name: string, node: Node) => {\n532. \t\t\t\t\tlet c = node.start;\n533. \t\t\t\t\twhile (this.source[c] !== \'(\') c += 1;\n534. \t\t\t\t\tcomponentDefinition.addBlock(deindent`\n535. \t\t\t\t\t\tfunction ${name}[✂${c}-${node.end}✂];\n536. \t\t\t\t\t`);\n537. \t\t\t\t};\n538. \n539. \t\t\t\tconst addValue = (name: string, node: Node) => {\n540. \t\t\t\t\tcomponentDefinition.addBlock(deindent`\n541. \t\t\t\t\t\tvar ${name} = [✂${node.start}-${node.end}✂];\n542. \t\t\t\t\t`);\n543. \t\t\t\t};\n\n\nFile: src/generators/Generator.ts\nLine number range: 545 - 569\nContent:\n545. \t\t\t\tconst addDeclaration = (key: string, node: Node, disambiguator?: string) => {\n546. \t\t\t\t\tconst qualified = disambiguator ? `${disambiguator}-${key}` : key;\n547. \n548. \t\t\t\t\tif (node.type === \'Identifier\' && node.name === key) {\n549. \t\t\t\t\t\tthis.templateVars.set(qualified, key);\n550. \t\t\t\t\t\treturn;\n551. \t\t\t\t\t}\n552. \n553. \t\t\t\t\tlet name = this.getUniqueName(key);\n554. \t\t\t\t\tthis.templateVars.set(qualified, name);\n555. \n556. \t\t\t\t\t// deindent\n557. \t\t\t\t\tconst indentationLevel = getIndentationLevel(source, node.start);\n558. \t\t\t\t\tif (indentationLevel) {\n559. \t\t\t\t\t\tremoveIndentation(code, node.start, node.end, indentationLevel, indentExclusionRanges);\n560. \t\t\t\t\t}\n561. \n562. \t\t\t\t\tif (node.type === \'ArrowFunctionExpression\') {\n563. \t\t\t\t\t\taddArrowFunctionExpression(name, node);\n564. \t\t\t\t\t} else if (node.type === \'FunctionExpression\') {\n565. \t\t\t\t\t\taddFunctionExpression(name, node);\n566. \t\t\t\t\t} else {\n567. \t\t\t\t\t\taddValue(name, node);\n568. \t\t\t\t\t}\n569. \t\t\t\t};\n\n\nFile: src/generators/Generator.ts\nLine number range: 638 - 646\nContent:\n638. \t\t\t\tif (templateProperties.onrender) templateProperties.oncreate = templateProperties.onrender; // remove after v2\n639. \t\t\t\tif (templateProperties.oncreate && dom) {\n640. \t\t\t\t\taddDeclaration(\'oncreate\', templateProperties.oncreate.value);\n641. \t\t\t\t}\n642. \n643. \t\t\t\tif (templateProperties.onteardown) templateProperties.ondestroy = templateProperties.onteardown; // remove after v2\n644. \t\t\t\tif (templateProperties.ondestroy && dom) {\n645. \t\t\t\t\taddDeclaration(\'ondestroy\', templateProperties.ondestroy.value);\n646. \t\t\t\t}\n\n\nFile: src/generators/Generator.ts\nLine number range: 692 - 695\nContent:\n692. \t\tthis.computations = computations;\n693. \t\tthis.namespace = namespace;\n694. \t\tthis.templateProperties = templateProperties;\n695. \t}\n\n\nFile: src/generators/dom/index.ts\nLine number range: 1 - 437\nContent:\n1. import MagicString from \'magic-string\';\n2. import { parseExpressionAt } from \'acorn\';\n3. import annotateWithScopes from \'../../utils/annotateWithScopes\';\n4. import isReference from \'../../utils/isReference\';\n5. import { walk } from \'estree-walker\';\n6. import deindent from \'../../utils/deindent\';\n7. import { stringify, escape } from \'../../utils/stringify\';\n8. import CodeBuilder from \'../../utils/CodeBuilder\';\n9. import reservedNames from \'../../utils/reservedNames\';\n10. import visit from \'./visit\';\n11. import shared from \'./shared\';\n12. import Generator from \'../Generator\';\n13. import Stylesheet from \'../../css/Stylesheet\';\n14. import preprocess from \'./preprocess\';\n15. import Block from \'./Block\';\n16. import { version } from \'../../../package.json\';\n17. import { Parsed, CompileOptions, Node } from \'../../interfaces\';\n18. \n19. const test = typeof global !== \'undefined\' && global.__svelte_test;\n20. \n21. export class DomGenerator extends Generator {\n22. \tblocks: (Block|string)[];\n23. \treadonly: Set<string>;\n24. \tmetaBindings: string[];\n25. \n26. \thydratable: boolean;\n27. \tlegacy: boolean;\n28. \n29. \thasIntroTransitions: boolean;\n30. \thasOutroTransitions: boolean;\n31. \thasComplexBindings: boolean;\n32. \n33. \tneedsEncapsulateHelper: boolean;\n34. \n35. \tconstructor(\n36. \t\tparsed: Parsed,\n37. \t\tsource: string,\n38. \t\tname: string,\n39. \t\tstylesheet: Stylesheet,\n40. \t\toptions: CompileOptions\n41. \t) {\n42. \t\tsuper(parsed, source, name, stylesheet, options, true);\n43. \t\tthis.blocks = [];\n44. \n45. \t\tthis.readonly = new Set();\n46. \n47. \t\tthis.hydratable = options.hydratable;\n48. \t\tthis.legacy = options.legacy;\n49. \t\tthis.needsEncapsulateHelper = false;\n50. \n51. \t\t// initial values for e.g. window.innerWidth, if there\'s a <:Window> meta tag\n52. \t\tthis.metaBindings = [];\n53. \t}\n54. \n55. \tgetUniqueNameMaker(params: string[]) {\n56. \t\tconst localUsedNames = new Set(params);\n57. \n58. \t\tfunction add(name: string) {\n59. \t\t\tlocalUsedNames.add(name);\n60. \t\t}\n61. \n62. \t\treservedNames.forEach(add);\n63. \t\tthis.userVars.forEach(add);\n64. \t\tfor (const name in shared) {\n65. \t\t\tlocalUsedNames.add(test ? `${name}$` : name);\n66. \t\t}\n67. \n68. \t\treturn (name: string) => {\n69. \t\t\tif (test) name = `${name}$`;\n70. \t\t\tlet alias = name;\n71. \t\t\tfor (\n72. \t\t\t\tlet i = 1;\n73. \t\t\t\tthis.usedNames.has(alias) ||\n74. \t\t\t\tlocalUsedNames.has(alias);\n75. \t\t\t\talias = `${name}_${i++}`\n76. \t\t\t);\n77. \t\t\tlocalUsedNames.add(alias);\n78. \t\t\treturn alias;\n79. \t\t};\n80. \t}\n81. }\n82. \n83. export default function dom(\n84. \tparsed: Parsed,\n85. \tsource: string,\n86. \tstylesheet: Stylesheet,\n87. \toptions: CompileOptions\n88. ) {\n89. \tconst format = options.format || \'es\';\n90. \n91. \tconst generator = new DomGenerator(parsed, source, options.name || \'SvelteComponent\', stylesheet, options);\n92. \n93. \tconst {\n94. \t\tcomputations,\n95. \t\tname,\n96. \t\ttemplateProperties,\n97. \t\tnamespace,\n98. \t} = generator;\n99. \n100. \tconst { block, state } = preprocess(generator, namespace, parsed.html);\n101. \n102. \tgenerator.stylesheet.warnOnUnusedSelectors(options.onwarn);\n103. \n104. \tparsed.html.children.forEach((node: Node) => {\n105. \t\tvisit(generator, block, state, node, [], []);\n106. \t});\n107. \n108. \tconst builder = new CodeBuilder();\n109. \tconst computationBuilder = new CodeBuilder();\n110. \tconst computationDeps = new Set();\n111. \n112. \tif (computations.length) {\n113. \t\tcomputations.forEach(({ key, deps }) => {\n114. \t\t\tdeps.forEach(dep => {\n115. \t\t\t\tcomputationDeps.add(dep);\n116. \t\t\t});\n117. \n118. \t\t\tif (generator.readonly.has(key)) {\n119. \t\t\t\t// <:Window> bindings\n120. \t\t\t\tthrow new Error(\n121. \t\t\t\t\t`Cannot have a computed value \'${key}\' that clashes with a read-only property`\n122. \t\t\t\t);\n123. \t\t\t}\n124. \n125. \t\t\tgenerator.readonly.add(key);\n126. \n127. \t\t\tconst condition = `${deps.map(dep => `changed.${dep}`).join(\' || \')}`;\n128. \n129. \t\t\tconst statement = `if (@differs(state.${key}, (state.${key} = %computed-${key}(${deps\n130. \t\t\t\t.map(dep => `state.${dep}`)\n131. \t\t\t\t.join(\', \')})))) changed.${key} = true;`;\n132. \n133. \t\t\tcomputationBuilder.addConditional(condition, statement);\n134. \t\t});\n135. \t}\n136. \n137. \tif (generator.javascript) {\n138. \t\tbuilder.addBlock(generator.javascript);\n139. \t}\n140. \n141. \tif (generator.needsEncapsulateHelper) {\n142. \t\tbuilder.addBlock(deindent`\n143. \t\t\tfunction @encapsulateStyles(node) {\n144. \t\t\t\t@setAttribute(node, "${generator.stylesheet.id}", "");\n145. \t\t\t}\n146. \t\t`);\n147. \t}\n148. \n149. \tconst { css, cssMap } = generator.stylesheet.render(options.filename, !generator.customElement);\n150. \tconst styles = generator.stylesheet.hasStyles && stringify(options.dev ?\n151. \t\t`${css}\\n/*# sourceMappingURL=${cssMap.toUrl()} */` :\n152. \t\tcss, { onlyEscapeAtSymbol: true });\n153. \n154. \tif (styles && generator.options.css !== false && !generator.customElement) {\n155. \t\tbuilder.addBlock(deindent`\n156. \t\t\tfunction @add_css() {\n157. \t\t\t\tvar style = @createElement("style");\n158. \t\t\t\tstyle.id = \'${generator.stylesheet.id}-style\';\n159. \t\t\t\tstyle.textContent = ${styles};\n160. \t\t\t\t@appendNode(style, document.head);\n161. \t\t\t}\n162. \t\t`);\n163. \t}\n164. \n165. \tgenerator.blocks.forEach(block => {\n166. \t\tbuilder.addBlock(block.toString());\n167. \t});\n168. \n169. \tconst sharedPath = options.shared === true\n170. \t\t? \'svelte/shared.js\'\n171. \t\t: options.shared;\n172. \n173. \tconst prototypeBase =\n174. \t\t`${name}.prototype` +\n175. \t\t(templateProperties.methods ? `, %methods` : \'\');\n176. \tconst proto = sharedPath\n177. \t\t? `@proto`\n178. \t\t: deindent`\n179. \t\t{\n180. \t\t\t${[\'destroy\', \'get\', \'fire\', \'observe\', \'on\', \'set\', \'teardown\', \'_set\', \'_mount\', \'_unmount\']\n181. \t\t\t\t.map(n => `${n}: @${n === \'teardown\' ? \'destroy\' : n}`)\n182. \t\t\t\t.join(\',\\n\')}\n183. \t\t}`;\n184. \n185. \tconst debugName = `<${generator.customElement ? generator.tag : name}>`;\n186. \n187. \tconst constructorBody = deindent`\n188. \t\t${options.dev && `this._debugName = \'${debugName}\';`}\n189. \t\t${options.dev && !generator.customElement &&\n190. \t\t\t`if (!options || (!options.target && !options._root)) throw new Error("\'target\' is a required option");`}\n191. \t\t@init(this, options);\n192. \t\t${generator.usesRefs && `this.refs = {};`}\n193. \t\tthis._state = @assign(${templateProperties.data ? \'%data()\' : \'{}\'}, options.data);\n194. \t\t${generator.metaBindings}\n195. \t\t${computations.length && `this._recompute({ ${Array.from(computationDeps).map(dep => `${dep}: 1`).join(\', \')} }, this._state);`}\n196. \t\t${options.dev &&\n197. \t\t\tArray.from(generator.expectedProperties).map(\n198. \t\t\t\tprop =>\n199. \t\t\t\t\t`if (!(\'${prop}\' in this._state)) console.warn("${debugName} was created without expected data property \'${prop}\'");`\n200. \t\t\t)}\n201. \t\t${generator.bindingGroups.length &&\n202. \t\t\t`this._bindingGroups = [${Array(generator.bindingGroups.length).fill(\'[]\').join(\', \')}];`}\n203. \n204. \t\t${templateProperties.ondestroy && `this._handlers.destroy = [%ondestroy]`}\n205. \n206. \t\t${generator.slots.size && `this._slotted = options.slots || {};`}\n207. \n208. \t\t${generator.customElement ?\n209. \t\t\tdeindent`\n210. \t\t\t\tthis.attachShadow({ mode: \'open\' });\n211. \t\t\t\t${css && `this.shadowRoot.innerHTML = \\`<style>${escape(css, { onlyEscapeAtSymbol: true }).replace(/\\\\/g, \'\\\\\\\\\')}${options.dev ? `\\n/*# sourceMappingURL=${cssMap.toUrl()} */` : \'\'}</style>\\`;`}\n212. \t\t\t` :\n213. \t\t\t(generator.stylesheet.hasStyles && options.css !== false &&\n214. \t\t\t`if (!document.getElementById("${generator.stylesheet.id}-style")) @add_css();`)\n215. \t\t}\n216. \n217. \t\t${templateProperties.oncreate && `var _oncreate = %oncreate.bind(this);`}\n218. \n219. \t\t${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`\n220. \t\t\tif (!options._root) {\n221. \t\t\t\tthis._oncreate = [${templateProperties.oncreate && `_oncreate`}];\n222. \t\t\t\t${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}\n223. \t\t\t\t${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}\n224. \t\t\t} ${templateProperties.oncreate && deindent`\n225. \t\t\t\telse {\n226. \t\t\t\t\tthis._root._oncreate.push(_oncreate);\n227. \t\t\t\t}\n228. \t\t\t`}\n229. \t\t`}\n230. \n231. \t\t${generator.slots.size && `this.slots = {};`}\n232. \n233. \t\tthis._fragment = @create_main_fragment(this._state, this);\n234. \n235. \t\t${generator.customElement ? deindent`\n236. \t\t\tthis._fragment.c();\n237. \t\t\tthis._fragment.${block.hasIntroMethod ? \'i\' : \'m\'}(this.shadowRoot, null);\n238. \n239. \t\t\tif (options.target) this._mount(options.target, options.anchor || null);\n240. \t\t` : deindent`\n241. \t\t\tif (options.target) {\n242. \t\t\t\t${generator.hydratable\n243. \t\t\t\t\t? deindent`\n244. \t\t\t\t\t\tvar nodes = @children(options.target);\n245. \t\t\t\t\t\toptions.hydrate ? this._fragment.l(nodes) : this._fragment.c();\n246. \t\t\t\t\t\tnodes.forEach(@detachNode);\n247. \t\t\t\t\t` :\n248. \t\t\t\t\tdeindent`\n249. \t\t\t\t\t\t${options.dev && `if (options.hydrate) throw new Error("options.hydrate only works if the component was compiled with the \\`hydratable: true\\` option");`}\n250. \t\t\t\t\t\tthis._fragment.c();\n251. \t\t\t\t\t`}\n252. \t\t\t\tthis._fragment.${block.hasIntroMethod ? \'i\' : \'m\'}(options.target, options.anchor || null);\n253. \n254. \t\t\t\t${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`\n255. \t\t\t\t\t${generator.hasComponents && `this._lock = true;`}\n256. \t\t\t\t\t${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}\n257. \t\t\t\t\t${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}\n258. \t\t\t\t\t${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}\n259. \t\t\t\t\t${generator.hasComponents && `this._lock = false;`}\n260. \t\t\t\t`}\n261. \t\t\t}\n262. \t\t`}\n263. \t`;\n264. \n265. \tif (generator.customElement) {\n266. \t\tconst props = generator.props || Array.from(generator.expectedProperties);\n267. \n268. \t\tbuilder.addBlock(deindent`\n269. \t\t\tclass ${name} extends HTMLElement {\n270. \t\t\t\tconstructor(options = {}) {\n271. \t\t\t\t\tsuper();\n272. \t\t\t\t\t${constructorBody}\n273. \t\t\t\t}\n274. \n275. \t\t\t\tstatic get observedAttributes() {\n276. \t\t\t\t\treturn ${JSON.stringify(props)};\n277. \t\t\t\t}\n278. \n279. \t\t\t\t${props.map(prop => deindent`\n280. \t\t\t\t\tget ${prop}() {\n281. \t\t\t\t\t\treturn this.get(\'${prop}\');\n282. \t\t\t\t\t}\n283. \n284. \t\t\t\t\tset ${prop}(value) {\n285. \t\t\t\t\t\tthis.set({ ${prop}: value });\n286. \t\t\t\t\t}\n287. \t\t\t\t`).join(\'\\n\\n\')}\n288. \n289. \t\t\t\t${generator.slots.size && deindent`\n290. \t\t\t\t\tconnectedCallback() {\n291. \t\t\t\t\t\tObject.keys(this._slotted).forEach(key => {\n292. \t\t\t\t\t\t\tthis.appendChild(this._slotted[key]);\n293. \t\t\t\t\t\t});\n294. \t\t\t\t\t}`}\n295. \n296. \t\t\t\tattributeChangedCallback(attr, oldValue, newValue) {\n297. \t\t\t\t\tthis.set({ [attr]: newValue });\n298. \t\t\t\t}\n299. \t\t\t}\n300. \n301. \t\t\tcustomElements.define("${generator.tag}", ${name});\n302. \t\t\t@assign(${prototypeBase}, ${proto}, {\n303. \t\t\t\t_mount(target, anchor) {\n304. \t\t\t\t\ttarget.insertBefore(this, anchor);\n305. \t\t\t\t},\n306. \n307. \t\t\t\t_unmount() {\n308. \t\t\t\t\tthis.parentNode.removeChild(this);\n309. \t\t\t\t}\n310. \t\t\t});\n311. \t\t`);\n312. \t} else {\n313. \t\tbuilder.addBlock(deindent`\n314. \t\t\tfunction ${name}(options) {\n315. \t\t\t\t${constructorBody}\n316. \t\t\t}\n317. \n318. \t\t\t@assign(${prototypeBase}, ${proto});\n319. \t\t`);\n320. \t}\n321. \n322. \tbuilder.addBlock(deindent`\n323. \t\t${options.dev && deindent`\n324. \t\t\t${name}.prototype._checkReadOnly = function _checkReadOnly(newState) {\n325. \t\t\t\t${Array.from(generator.readonly).map(\n326. \t\t\t\t\tprop =>\n327. \t\t\t\t\t\t`if (\'${prop}\' in newState && !this._updatingReadonlyProperty) throw new Error("${debugName}: Cannot set read-only property \'${prop}\'");`\n328. \t\t\t\t)}\n329. \t\t\t};\n330. \t\t`}\n331. \n332. \t\t${computations.length ? deindent`\n333. \t\t\t${name}.prototype._recompute = function _recompute(changed, state) {\n334. \t\t\t\t${computationBuilder}\n335. \t\t\t}\n336. \t\t` : (!sharedPath && `${name}.prototype._recompute = @noop;`)}\n337. \n338. \t\t${templateProperties.setup && `%setup(${name});`}\n339. \t`);\n340. \n341. \tconst usedHelpers = new Set();\n342. \n343. \tlet result = builder\n344. \t\t.toString()\n345. \t\t.replace(/(%+|@+)(\\w*(?:-\\w*)?)/g, (match: string, sigil: string, name: string) => {\n346. \t\t\tif (sigil === \'@\') {\n347. \t\t\t\tif (name in shared) {\n348. \t\t\t\t\tif (options.dev && `${name}Dev` in shared) name = `${name}Dev`;\n349. \t\t\t\t\tusedHelpers.add(name);\n350. \t\t\t\t}\n351. \n352. \t\t\t\treturn generator.alias(name);\n353. \t\t\t}\n354. \n355. \t\t\tif (sigil === \'%\') {\n356. \t\t\t\treturn generator.templateVars.get(name);\n357. \t\t\t}\n358. \n359. \t\t\treturn sigil.slice(1) + name;\n360. \t\t});\n361. \n362. \tlet helpers;\n363. \n364. \tif (sharedPath) {\n365. \t\tif (format !== \'es\' && format !== \'cjs\') {\n366. \t\t\tthrow new Error(`Components with shared helpers must be compiled with \\`format: \'es\'\\` or \\`format: \'cjs\'\\``);\n367. \t\t}\n368. \t\tconst used = Array.from(usedHelpers).sort();\n369. \t\thelpers = used.map(name => {\n370. \t\t\tconst alias = generator.alias(name);\n371. \t\t\treturn { name, alias };\n372. \t\t});\n373. \t} else {\n374. \t\tlet inlineHelpers = \'\';\n375. \n376. \t\tusedHelpers.forEach(key => {\n377. \t\t\tconst str = shared[key];\n378. \t\t\tconst code = new MagicString(str);\n379. \t\t\tconst expression = parseExpressionAt(str, 0);\n380. \n381. \t\t\tlet scope = annotateWithScopes(expression);\n382. \n383. \t\t\twalk(expression, {\n384. \t\t\t\tenter(node: Node, parent: Node) {\n385. \t\t\t\t\tif (node._scope) scope = node._scope;\n386. \n387. \t\t\t\t\tif (\n388. \t\t\t\t\t\tnode.type === \'Identifier\' &&\n389. \t\t\t\t\t\tisReference(node, parent) &&\n390. \t\t\t\t\t\t!scope.has(node.name)\n391. \t\t\t\t\t) {\n392. \t\t\t\t\t\tif (node.name in shared) {\n393. \t\t\t\t\t\t\t// this helper function depends on another one\n394. \t\t\t\t\t\t\tconst dependency = node.name;\n395. \t\t\t\t\t\t\tusedHelpers.add(dependency);\n396. \n397. \t\t\t\t\t\t\tconst alias = generator.alias(dependency);\n398. \t\t\t\t\t\t\tif (alias !== node.name)\n399. \t\t\t\t\t\t\t\tcode.overwrite(node.start, node.end, alias);\n400. \t\t\t\t\t\t}\n401. \t\t\t\t\t}\n402. \t\t\t\t},\n403. \n404. \t\t\t\tleave(node: Node) {\n405. \t\t\t\t\tif (node._scope) scope = scope.parent;\n406. \t\t\t\t},\n407. \t\t\t});\n408. \n409. \t\t\tif (key === \'transitionManager\') {\n410. \t\t\t\t// special case\n411. \t\t\t\tconst global = `_svelteTransitionManager`;\n412. \n413. \t\t\t\tinlineHelpers += `\\n\\nvar ${generator.alias(\'transitionManager\')} = window.${global} || (window.${global} = ${code});\\n\\n`;\n414. \t\t\t} else {\n415. \t\t\t\tconst alias = generator.alias(expression.id.name);\n416. \t\t\t\tif (alias !== expression.id.name)\n417. \t\t\t\t\tcode.overwrite(expression.id.start, expression.id.end, alias);\n418. \n419. \t\t\t\tinlineHelpers += `\\n\\n${code}`;\n420. \t\t\t}\n421. \t\t});\n422. \n423. \t\tresult += inlineHelpers;\n424. \t}\n425. \n426. \tconst filename = options.filename && (\n427. \t\ttypeof process !== \'undefined\' ? options.filename.replace(process.cwd(), \'\').replace(/^[\\/\\\\]/, \'\') : options.filename\n428. \t);\n429. \n430. \treturn generator.generate(result, options, {\n431. \t\tbanner: `/* ${filename ? `${filename} ` : ``}generated by Svelte v${version} */`,\n432. \t\tsharedPath,\n433. \t\thelpers,\n434. \t\tname,\n435. \t\tformat,\n436. \t});\n437. }\n\n\nFile: src/generators/dom/preprocess.ts\nLine number range: 1 - 545\nContent:\n1. import Block from \'./Block\';\n2. import { trimStart, trimEnd } from \'../../utils/trim\';\n3. import { assign } from \'../../shared/index.js\';\n4. import getStaticAttributeValue from \'../../utils/getStaticAttributeValue\';\n5. import isChildOfComponent from \'../shared/utils/isChildOfComponent\';\n6. import { DomGenerator } from \'./index\';\n7. import { Node } from \'../../interfaces\';\n8. import { State } from \'./interfaces\';\n9. \n10. function isElseIf(node: Node) {\n11. \treturn (\n12. \t\tnode && node.children.length === 1 && node.children[0].type === \'IfBlock\'\n13. \t);\n14. }\n15. \n16. function getChildState(parent: State, child = {}) {\n17. \treturn assign(\n18. \t\t{},\n19. \t\tparent,\n20. \t\t{ parentNode: null, parentNodes: \'nodes\' },\n21. \t\tchild || {}\n22. \t);\n23. }\n24. \n25. function createDebuggingComment(node: Node, generator: DomGenerator) {\n26. \tconst { locate, source } = generator;\n27. \n28. \tlet c = node.start;\n29. \tif (node.type === \'ElseBlock\') {\n30. \t\twhile (source[c] !== \'{\') c -= 1;\n31. \t\tc -= 1;\n32. \t}\n33. \n34. \tlet d = node.expression ? node.expression.end : c;\n35. \twhile (source[d] !== \'}\') d += 1;\n36. \td += 2;\n37. \n38. \tconst start = locate(c);\n39. \tconst loc = `(${start.line + 1}:${start.column})`;\n40. \n41. \treturn `${loc} ${source.slice(c, d)}`.replace(/\\n/g, \' \');\n42. }\n43. \n44. function cannotUseInnerHTML(node: Node) {\n45. \twhile (node && node.canUseInnerHTML) {\n46. \t\tnode.canUseInnerHTML = false;\n47. \t\tnode = node.parent;\n48. \t}\n49. }\n50. \n51. // Whitespace inside one of these elements will not result in\n52. // a whitespace node being created in any circumstances. (This\n53. // list is almost certainly very incomplete)\n54. const elementsWithoutText = new Set([\n55. \t\'audio\',\n56. \t\'datalist\',\n57. \t\'dl\',\n58. \t\'ol\',\n59. \t\'optgroup\',\n60. \t\'select\',\n61. \t\'ul\',\n62. \t\'video\',\n63. ]);\n64. \n65. const preprocessors = {\n66. \tMustacheTag: (\n67. \t\tgenerator: DomGenerator,\n68. \t\tblock: Block,\n69. \t\tstate: State,\n70. \t\tnode: Node,\n71. \t\telementStack: Node[],\n72. \t\tcomponentStack: Node[],\n73. \t\tstripWhitespace: boolean\n74. \t) => {\n75. \t\tcannotUseInnerHTML(node);\n76. \t\tnode.var = block.getUniqueName(\'text\');\n77. \n78. \t\tconst dependencies = block.findDependencies(node.expression);\n79. \t\tblock.addDependencies(dependencies);\n80. \t},\n81. \n82. \tRawMustacheTag: (\n83. \t\tgenerator: DomGenerator,\n84. \t\tblock: Block,\n85. \t\tstate: State,\n86. \t\tnode: Node,\n87. \t\telementStack: Node[],\n88. \t\tcomponentStack: Node[],\n89. \t\tstripWhitespace: boolean\n90. \t) => {\n91. \t\tcannotUseInnerHTML(node);\n92. \t\tnode.var = block.getUniqueName(\'raw\');\n93. \n94. \t\tconst dependencies = block.findDependencies(node.expression);\n95. \t\tblock.addDependencies(dependencies);\n96. \t},\n97. \n98. \tText: (\n99. \t\tgenerator: DomGenerator,\n100. \t\tblock: Block,\n101. \t\tstate: State,\n102. \t\tnode: Node,\n103. \t\telementStack: Node[],\n104. \t\tcomponentStack: Node[],\n105. \t\tstripWhitespace: boolean\n106. \t) => {\n107. \t\tif (!/\\S/.test(node.data) && (state.namespace || elementsWithoutText.has(state.parentNodeName))) {\n108. \t\t\tnode.shouldSkip = true;\n109. \t\t\treturn;\n110. \t\t}\n111. \n112. \t\tnode.var = block.getUniqueName(`text`);\n113. \t},\n114. \n115. \tIfBlock: (\n116. \t\tgenerator: DomGenerator,\n117. \t\tblock: Block,\n118. \t\tstate: State,\n119. \t\tnode: Node,\n120. \t\tinEachBlock: boolean,\n121. \t\telementStack: Node[],\n122. \t\tcomponentStack: Node[],\n123. \t\tstripWhitespace: boolean,\n124. \t\tnextSibling: Node\n125. \t) => {\n126. \t\tcannotUseInnerHTML(node);\n127. \n128. \t\tconst blocks: Block[] = [];\n129. \t\tlet dynamic = false;\n130. \t\tlet hasIntros = false;\n131. \t\tlet hasOutros = false;\n132. \n133. \t\tfunction attachBlocks(node: Node) {\n134. \t\t\tnode.var = block.getUniqueName(`if_block`);\n135. \n136. \t\t\tconst dependencies = block.findDependencies(node.expression);\n137. \t\t\tblock.addDependencies(dependencies);\n138. \n139. \t\t\tnode._block = block.child({\n140. \t\t\t\tcomment: createDebuggingComment(node, generator),\n141. \t\t\t\tname: generator.getUniqueName(`create_if_block`),\n142. \t\t\t});\n143. \n144. \t\t\tnode._state = getChildState(state);\n145. \n146. \t\t\tblocks.push(node._block);\n147. \t\t\tpreprocessChildren(generator, node._block, node._state, node, inEachBlock, elementStack, componentStack, stripWhitespace, nextSibling);\n148. \n149. \t\t\tif (node._block.dependencies.size > 0) {\n150. \t\t\t\tdynamic = true;\n151. \t\t\t\tblock.addDependencies(node._block.dependencies);\n152. \t\t\t}\n153. \n154. \t\t\tif (node._block.hasIntroMethod) hasIntros = true;\n155. \t\t\tif (node._block.hasOutroMethod) hasOutros = true;\n156. \n157. \t\t\tif (isElseIf(node.else)) {\n158. \t\t\t\tattachBlocks(node.else.children[0]);\n159. \t\t\t} else if (node.else) {\n160. \t\t\t\tnode.else._block = block.child({\n161. \t\t\t\t\tcomment: createDebuggingComment(node.else, generator),\n162. \t\t\t\t\tname: generator.getUniqueName(`create_if_block`),\n163. \t\t\t\t});\n164. \n165. \t\t\t\tnode.else._state = getChildState(state);\n166. \n167. \t\t\t\tblocks.push(node.else._block);\n168. \t\t\t\tpreprocessChildren(\n169. \t\t\t\t\tgenerator,\n170. \t\t\t\t\tnode.else._block,\n171. \t\t\t\t\tnode.else._state,\n172. \t\t\t\t\tnode.else,\n173. \t\t\t\t\tinEachBlock,\n174. \t\t\t\t\telementStack,\n175. \t\t\t\t\tcomponentStack,\n176. \t\t\t\t\tstripWhitespace,\n177. \t\t\t\t\tnextSibling\n178. \t\t\t\t);\n179. \n180. \t\t\t\tif (node.else._block.dependencies.size > 0) {\n181. \t\t\t\t\tdynamic = true;\n182. \t\t\t\t\tblock.addDependencies(node.else._block.dependencies);\n183. \t\t\t\t}\n184. \t\t\t}\n185. \t\t}\n186. \n187. \t\tattachBlocks(node);\n188. \n189. \t\tblocks.forEach(block => {\n190. \t\t\tblock.hasUpdateMethod = dynamic;\n191. \t\t\tblock.hasIntroMethod = hasIntros;\n192. \t\t\tblock.hasOutroMethod = hasOutros;\n193. \t\t});\n194. \n195. \t\tgenerator.blocks.push(...blocks);\n196. \t},\n197. \n198. \tEachBlock: (\n199. \t\tgenerator: DomGenerator,\n200. \t\tblock: Block,\n201. \t\tstate: State,\n202. \t\tnode: Node,\n203. \t\tinEachBlock: boolean,\n204. \t\telementStack: Node[],\n205. \t\tcomponentStack: Node[],\n206. \t\tstripWhitespace: boolean,\n207. \t\tnextSibling: Node\n208. \t) => {\n209. \t\tcannotUseInnerHTML(node);\n210. \t\tnode.var = block.getUniqueName(`each`);\n211. \n212. \t\tconst dependencies = block.findDependencies(node.expression);\n213. \t\tblock.addDependencies(dependencies);\n214. \n215. \t\tconst indexNames = new Map(block.indexNames);\n216. \t\tconst indexName =\n217. \t\t\tnode.index || block.getUniqueName(`${node.context}_index`);\n218. \t\tindexNames.set(node.context, indexName);\n219. \n220. \t\tconst listNames = new Map(block.listNames);\n221. \t\tconst listName = block.getUniqueName(\n222. \t\t\t(node.expression.type === \'MemberExpression\' && !node.expression.computed) ? node.expression.property.name :\n223. \t\t\tnode.expression.type === \'Identifier\' ? node.expression.name :\n224. \t\t\t`each_value`\n225. \t\t);\n226. \t\tlistNames.set(node.context, listName);\n227. \n228. \t\tconst context = generator.getUniqueName(node.context);\n229. \t\tconst contexts = new Map(block.contexts);\n230. \t\tcontexts.set(node.context, context);\n231. \n232. \t\tconst indexes = new Map(block.indexes);\n233. \t\tif (node.index) indexes.set(node.index, node.context);\n234. \n235. \t\tconst changeableIndexes = new Map(block.changeableIndexes);\n236. \t\tif (node.index) changeableIndexes.set(node.index, node.key);\n237. \n238. \t\tconst contextDependencies = new Map(block.contextDependencies);\n239. \t\tcontextDependencies.set(node.context, dependencies);\n240. \n241. \t\tif (node.destructuredContexts) {\n242. \t\t\tfor (const i = 0; i < node.destructuredContexts.length; i++) {\n243. \t\t\t\tcontexts.set(node.destructuredContexts[i], `${context}[${i}]`);\n244. \t\t\t\tcontextDependencies.set(node.destructuredContexts[i], dependencies);\n245. \t\t\t}\n246. \t\t}\n247. \n248. \t\tnode._block = block.child({\n249. \t\t\tcomment: createDebuggingComment(node, generator),\n250. \t\t\tname: generator.getUniqueName(\'create_each_block\'),\n251. \t\t\texpression: node.expression,\n252. \t\t\tcontext: node.context,\n253. \t\t\tkey: node.key,\n254. \n255. \t\t\tcontextDependencies,\n256. \t\t\tcontexts,\n257. \t\t\tindexes,\n258. \t\t\tchangeableIndexes,\n259. \n260. \t\t\tlistName,\n261. \t\t\tindexName,\n262. \n263. \t\t\tindexNames,\n264. \t\t\tlistNames,\n265. \t\t\tparams: block.params.concat(listName, context, indexName),\n266. \t\t});\n267. \n268. \t\tnode._state = getChildState(state, {\n269. \t\t\tinEachBlock: true,\n270. \t\t});\n271. \n272. \t\tgenerator.blocks.push(node._block);\n273. \t\tpreprocessChildren(generator, node._block, node._state, node, true, elementStack, componentStack, stripWhitespace, nextSibling);\n274. \t\tblock.addDependencies(node._block.dependencies);\n275. \t\tnode._block.hasUpdateMethod = node._block.dependencies.size > 0;\n276. \n277. \t\tif (node.else) {\n278. \t\t\tnode.else._block = block.child({\n279. \t\t\t\tcomment: createDebuggingComment(node.else, generator),\n280. \t\t\t\tname: generator.getUniqueName(`${node._block.name}_else`),\n281. \t\t\t});\n282. \n283. \t\t\tnode.else._state = getChildState(state);\n284. \n285. \t\t\tgenerator.blocks.push(node.else._block);\n286. \t\t\tpreprocessChildren(\n287. \t\t\t\tgenerator,\n288. \t\t\t\tnode.else._block,\n289. \t\t\t\tnode.else._state,\n290. \t\t\t\tnode.else,\n291. \t\t\t\tinEachBlock,\n292. \t\t\t\telementStack,\n293. \t\t\t\tcomponentStack,\n294. \t\t\t\tstripWhitespace,\n295. \t\t\t\tnextSibling\n296. \t\t\t);\n297. \t\t\tnode.else._block.hasUpdateMethod = node.else._block.dependencies.size > 0;\n298. \t\t}\n299. \t},\n300. \n301. \tElement: (\n302. \t\tgenerator: DomGenerator,\n303. \t\tblock: Block,\n304. \t\tstate: State,\n305. \t\tnode: Node,\n306. \t\tinEachBlock: boolean,\n307. \t\telementStack: Node[],\n308. \t\tcomponentStack: Node[],\n309. \t\tstripWhitespace: boolean,\n310. \t\tnextSibling: Node\n311. \t) => {\n312. \t\tif (node.name === \'slot\') {\n313. \t\t\tcannotUseInnerHTML(node);\n314. \t\t}\n315. \n316. \t\tnode.attributes.forEach((attribute: Node) => {\n317. \t\t\tif (attribute.type === \'Attribute\' && attribute.value !== true) {\n318. \t\t\t\tattribute.value.forEach((chunk: Node) => {\n319. \t\t\t\t\tif (chunk.type !== \'Text\') {\n320. \t\t\t\t\t\tif (node.parent) cannotUseInnerHTML(node.parent);\n321. \n322. \t\t\t\t\t\tconst dependencies = block.findDependencies(chunk.expression);\n323. \t\t\t\t\t\tblock.addDependencies(dependencies);\n324. \n325. \t\t\t\t\t\t// special case — <option value=\'{{foo}}\'> — see below\n326. \t\t\t\t\t\tif (\n327. \t\t\t\t\t\t\tnode.name === \'option\' &&\n328. \t\t\t\t\t\t\tattribute.name === \'value\' &&\n329. \t\t\t\t\t\t\tstate.selectBindingDependencies\n330. \t\t\t\t\t\t) {\n331. \t\t\t\t\t\t\tstate.selectBindingDependencies.forEach(prop => {\n332. \t\t\t\t\t\t\t\tdependencies.forEach((dependency: string) => {\n333. \t\t\t\t\t\t\t\t\tgenerator.indirectDependencies.get(prop).add(dependency);\n334. \t\t\t\t\t\t\t\t});\n335. \t\t\t\t\t\t\t});\n336. \t\t\t\t\t\t}\n337. \t\t\t\t\t}\n338. \t\t\t\t});\n339. \t\t\t} else {\n340. \t\t\t\tif (node.parent) cannotUseInnerHTML(node.parent);\n341. \n342. \t\t\t\tif (attribute.type === \'EventHandler\' && attribute.expression) {\n343. \t\t\t\t\tattribute.expression.arguments.forEach((arg: Node) => {\n344. \t\t\t\t\t\tconst dependencies = block.findDependencies(arg);\n345. \t\t\t\t\t\tblock.addDependencies(dependencies);\n346. \t\t\t\t\t});\n347. \t\t\t\t} else if (attribute.type === \'Binding\') {\n348. \t\t\t\t\tconst dependencies = block.findDependencies(attribute.value);\n349. \t\t\t\t\tblock.addDependencies(dependencies);\n350. \t\t\t\t} else if (attribute.type === \'Transition\') {\n351. \t\t\t\t\tif (attribute.intro)\n352. \t\t\t\t\t\tgenerator.hasIntroTransitions = block.hasIntroMethod = true;\n353. \t\t\t\t\tif (attribute.outro) {\n354. \t\t\t\t\t\tgenerator.hasOutroTransitions = block.hasOutroMethod = true;\n355. \t\t\t\t\t\tblock.outros += 1;\n356. \t\t\t\t\t}\n357. \t\t\t\t}\n358. \t\t\t}\n359. \t\t});\n360. \n361. \t\t// special case — in a case like this...\n362. \t\t//\n363. \t\t//   <select bind:value=\'foo\'>\n364. \t\t//     <option value=\'{{bar}}\'>bar</option>\n365. \t\t//     <option value=\'{{baz}}\'>baz</option>\n366. \t\t//   </option>\n367. \t\t//\n368. \t\t// ...we need to know that `foo` depends on `bar` and `baz`,\n369. \t\t// so that if `foo.qux` changes, we know that we need to\n370. \t\t// mark `bar` and `baz` as dirty too\n371. \t\tif (node.name === \'select\') {\n372. \t\t\tcannotUseInnerHTML(node);\n373. \n374. \t\t\tconst value = node.attributes.find(\n375. \t\t\t\t(attribute: Node) => attribute.name === \'value\'\n376. \t\t\t);\n377. \t\t\tif (value) {\n378. \t\t\t\t// TODO does this also apply to e.g. `<input type=\'checkbox\' bind:group=\'foo\'>`?\n379. \t\t\t\tconst dependencies = block.findDependencies(value.value);\n380. \t\t\t\tstate.selectBindingDependencies = dependencies;\n381. \t\t\t\tdependencies.forEach((prop: string) => {\n382. \t\t\t\t\tgenerator.indirectDependencies.set(prop, new Set());\n383. \t\t\t\t});\n384. \t\t\t} else {\n385. \t\t\t\tstate.selectBindingDependencies = null;\n386. \t\t\t}\n387. \t\t}\n388. \n389. \t\tconst isComponent =\n390. \t\t\tgenerator.components.has(node.name) || node.name === \':Self\';\n391. \n392. \t\tif (isComponent) {\n393. \t\t\tcannotUseInnerHTML(node);\n394. \n395. \t\t\tnode.var = block.getUniqueName(\n396. \t\t\t\t(node.name === \':Self\' ? generator.name : node.name).toLowerCase()\n397. \t\t\t);\n398. \n399. \t\t\tnode._state = getChildState(state, {\n400. \t\t\t\tparentNode: `${node.var}._slotted.default`\n401. \t\t\t});\n402. \t\t} else {\n403. \t\t\tconst slot = getStaticAttributeValue(node, \'slot\');\n404. \t\t\tif (slot && isChildOfComponent(node, generator)) {\n405. \t\t\t\tcannotUseInnerHTML(node);\n406. \t\t\t\tnode.slotted = true;\n407. \t\t\t\t// TODO validate slots — no nesting, no dynamic names...\n408. \t\t\t\tconst component = componentStack[componentStack.length - 1];\n409. \t\t\t\tcomponent._slots.add(slot);\n410. \t\t\t}\n411. \n412. \t\t\tnode.var = block.getUniqueName(\n413. \t\t\t\tnode.name.replace(/[^a-zA-Z0-9_$]/g, \'_\')\n414. \t\t\t);\n415. \n416. \t\t\tnode._state = getChildState(state, {\n417. \t\t\t\tisTopLevel: false,\n418. \t\t\t\tparentNode: node.var,\n419. \t\t\t\tparentNodes: block.getUniqueName(`${node.var}_nodes`),\n420. \t\t\t\tparentNodeName: node.name,\n421. \t\t\t\tnamespace: node.name === \'svg\'\n422. \t\t\t\t\t? \'http://www.w3.org/2000/svg\'\n423. \t\t\t\t\t: state.namespace,\n424. \t\t\t\tallUsedContexts: [],\n425. \t\t\t});\n426. \n427. \t\t\tgenerator.stylesheet.apply(node, elementStack);\n428. \t\t}\n429. \n430. \t\tif (node.children.length) {\n431. \t\t\tif (isComponent) {\n432. \t\t\t\tif (node.children) node._slots = new Set([\'default\']);\n433. \t\t\t\tpreprocessChildren(generator, block, node._state, node, inEachBlock, elementStack, componentStack.concat(node), stripWhitespace, nextSibling);\n434. \t\t\t} else {\n435. \t\t\t\tif (node.name === \'pre\' || node.name === \'textarea\') stripWhitespace = false;\n436. \t\t\t\tpreprocessChildren(generator, block, node._state, node, inEachBlock, elementStack.concat(node), componentStack, stripWhitespace, nextSibling);\n437. \t\t\t}\n438. \t\t}\n439. \t},\n440. };\n441. \n442. function preprocessChildren(\n443. \tgenerator: DomGenerator,\n444. \tblock: Block,\n445. \tstate: State,\n446. \tnode: Node,\n447. \tinEachBlock: boolean,\n448. \telementStack: Node[],\n449. \tcomponentStack: Node[],\n450. \tstripWhitespace: boolean,\n451. \tnextSibling: Node\n452. ) {\n453. \t// glue text nodes together\n454. \tconst cleaned: Node[] = [];\n455. \tlet lastChild: Node;\n456. \n457. \tnode.children.forEach((child: Node) => {\n458. \t\tif (child.type === \'Comment\') return;\n459. \n460. \t\tif (child.type === \'Text\' && lastChild && lastChild.type === \'Text\') {\n461. \t\t\tlastChild.data += child.data;\n462. \t\t\tlastChild.end = child.end;\n463. \t\t} else {\n464. \t\t\tif (child.type === \'Text\' && stripWhitespace && cleaned.length === 0) {\n465. \t\t\t\tchild.data = trimStart(child.data);\n466. \t\t\t\tif (child.data) cleaned.push(child);\n467. \t\t\t} else {\n468. \t\t\t\tcleaned.push(child);\n469. \t\t\t}\n470. \t\t}\n471. \n472. \t\tlastChild = child;\n473. \t});\n474. \n475. \tlastChild = null;\n476. \n477. \tcleaned.forEach((child: Node, i: number) => {\n478. \t\tchild.parent = node;\n479. \t\tchild.canUseInnerHTML = !generator.hydratable;\n480. \n481. \t\tconst preprocessor = preprocessors[child.type];\n482. \t\tif (preprocessor) preprocessor(generator, block, state, child, inEachBlock, elementStack, componentStack, stripWhitespace, cleaned[i + 1] || nextSibling);\n483. \n484. \t\tif (child.shouldSkip) return;\n485. \n486. \t\tif (lastChild) lastChild.next = child;\n487. \t\tchild.prev = lastChild;\n488. \n489. \t\tlastChild = child;\n490. \t});\n491. \n492. \t// We want to remove trailing whitespace inside an element/component/block,\n493. \t// *unless* there is no whitespace between this node and its next sibling\n494. \tif (stripWhitespace && lastChild && lastChild.type === \'Text\') {\n495. \t\tconst shouldTrim = (\n496. \t\t\tnextSibling ?  (nextSibling.type === \'Text\' && /^\\s/.test(nextSibling.data)) : !inEachBlock\n497. \t\t);\n498. \n499. \t\tif (shouldTrim) {\n500. \t\t\tlastChild.data = trimEnd(lastChild.data);\n501. \t\t\tif (!lastChild.data) {\n502. \t\t\t\tcleaned.pop();\n503. \t\t\t\tlastChild = cleaned[cleaned.length - 1];\n504. \t\t\t\tlastChild.next = null;\n505. \t\t\t}\n506. \t\t}\n507. \t}\n508. \n509. \tnode.children = cleaned;\n510. }\n511. \n512. export default function preprocess(\n513. \tgenerator: DomGenerator,\n514. \tnamespace: string,\n515. \tnode: Node\n516. ) {\n517. \tconst block = new Block({\n518. \t\tgenerator,\n519. \t\tname: \'@create_main_fragment\',\n520. \t\tkey: null,\n521. \n522. \t\tcontexts: new Map(),\n523. \t\tindexes: new Map(),\n524. \t\tchangeableIndexes: new Map(),\n525. \t\tcontextDependencies: new Map(),\n526. \n527. \t\tparams: [\'state\'],\n528. \t\tindexNames: new Map(),\n529. \t\tlistNames: new Map(),\n530. \n531. \t\tdependencies: new Set(),\n532. \t});\n533. \n534. \tconst state: State = {\n535. \t\tnamespace,\n536. \t\tparentNode: null,\n537. \t\tparentNodes: \'nodes\'\n538. \t};\n539. \n540. \tgenerator.blocks.push(block);\n541. \tpreprocessChildren(generator, block, state, node, false, [], [], true, null);\n542. \tblock.hasUpdateMethod = true;\n543. \n544. \treturn { block, state };\n545. }\n\n\nFile: src/generators/dom/visit.ts\nLine number range: 1 - 17\nContent:\n1. import visitors from \'./visitors/index\';\n2. import { DomGenerator } from \'./index\';\n3. import Block from \'./Block\';\n4. import { Node } from \'../../interfaces\';\n5. import { State } from \'./interfaces\';\n6. \n7. export default function visit(\n8. \tgenerator: DomGenerator,\n9. \tblock: Block,\n10. \tstate: State,\n11. \tnode: Node,\n12. \telementStack: Node[],\n13. \tcomponentStack: Node[]\n14. ) {\n15. \tconst visitor = visitors[node.type];\n16. \tvisitor(generator, block, state, node, elementStack, componentStack);\n17. }\n\n\nFile: src/generators/dom/visitors/index.ts\nLine number range: 1 - 18\nContent:\n1. import EachBlock from \'./EachBlock\';\n2. import Element from \'./Element/Element\';\n3. import IfBlock from \'./IfBlock\';\n4. import MustacheTag from \'./MustacheTag\';\n5. import RawMustacheTag from \'./RawMustacheTag\';\n6. import Text from \'./Text\';\n7. import { Visitor } from \'../interfaces\';\n8. \n9. const visitors: Record<string, Visitor> = {\n10. \tEachBlock,\n11. \tElement,\n12. \tIfBlock,\n13. \tMustacheTag,\n14. \tRawMustacheTag,\n15. \tText\n16. };\n17. \n18. export default visitors;\n\n\nFile: src/generators/shared/utils/wrapModule.ts\nLine number range: 1 - 298\nContent:\n1. import deindent from \'../../../utils/deindent\';\n2. import { CompileOptions, ModuleFormat, Node } from \'../../../interfaces\';\n3. \n4. interface Dependency {\n5. \tname: string;\n6. \tstatements: string[];\n7. \tsource: string;\n8. }\n9. \n10. const wrappers = { es, amd, cjs, iife, umd, eval: expr };\n11. \n12. export default function wrapModule(\n13. \tcode: string,\n14. \tformat: ModuleFormat,\n15. \tname: string,\n16. \toptions: CompileOptions,\n17. \tbanner: string,\n18. \tsharedPath: string,\n19. \thelpers: { name: string, alias: string }[],\n20. \timports: Node[],\n21. \tsource: string\n22. ): string {\n23. \tif (format === \'es\') return es(code, name, options, banner, sharedPath, helpers, imports, source);\n24. \n25. \tconst dependencies = imports.map((declaration, i) => {\n26. \t\tconst defaultImport = declaration.specifiers.find(\n27. \t\t\t(x: Node) =>\n28. \t\t\t\tx.type === \'ImportDefaultSpecifier\' ||\n29. \t\t\t\t(x.type === \'ImportSpecifier\' && x.imported.name === \'default\')\n30. \t\t);\n31. \n32. \t\tconst namespaceImport = declaration.specifiers.find(\n33. \t\t\t(x: Node) => x.type === \'ImportNamespaceSpecifier\'\n34. \t\t);\n35. \n36. \t\tconst namedImports = declaration.specifiers.filter(\n37. \t\t\t(x: Node) =>\n38. \t\t\t\tx.type === \'ImportSpecifier\' && x.imported.name !== \'default\'\n39. \t\t);\n40. \n41. \t\tconst name = defaultImport || namespaceImport\n42. \t\t\t? (defaultImport || namespaceImport).local.name\n43. \t\t\t: `__import${i}`;\n44. \n45. \t\tconst statements: string[] = [];\n46. \n47. \t\tnamedImports.forEach((specifier: Node) => {\n48. \t\t\tstatements.push(\n49. \t\t\t\t`var ${specifier.local.name} = ${name}.${specifier.imported.name};`\n50. \t\t\t);\n51. \t\t});\n52. \n53. \t\tif (defaultImport) {\n54. \t\t\tstatements.push(\n55. \t\t\t\t`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`\n56. \t\t\t);\n57. \t\t}\n58. \n59. \t\treturn { name, statements, source: declaration.source.value };\n60. \t});\n61. \n62. \tif (format === \'amd\') return amd(code, name, options, banner, dependencies);\n63. \tif (format === \'cjs\') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);\n64. \tif (format === \'iife\') return iife(code, name, options, banner, dependencies);\n65. \tif (format === \'umd\') return umd(code, name, options, banner, dependencies);\n66. \tif (format === \'eval\') return expr(code, name, options, banner, dependencies);\n67. \n68. \tthrow new Error(`Not implemented: ${format}`);\n69. }\n70. \n71. function es(\n72. \tcode: string,\n73. \tname: string,\n74. \toptions: CompileOptions,\n75. \tbanner: string,\n76. \tsharedPath: string,\n77. \thelpers: { name: string, alias: string }[],\n78. \timports: Node[],\n79. \tsource: string\n80. ) {\n81. \tconst importHelpers = helpers && (\n82. \t\t`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(\', \')} } from ${JSON.stringify(sharedPath)};`\n83. \t);\n84. \n85. \tconst importBlock = imports.length > 0 && (\n86. \t\timports\n87. \t\t\t.map((declaration: Node) => source.slice(declaration.start, declaration.end))\n88. \t\t\t.join(\'\\n\')\n89. \t);\n90. \n91. \treturn deindent`\n92. \t\t${banner}\n93. \t\t${importHelpers}\n94. \t\t${importBlock}\n95. \n96. \t\t${code}\n97. \t\texport default ${name};`;\n98. }\n99. \n100. function amd(\n101. \tcode: string,\n102. \tname: string,\n103. \toptions: CompileOptions,\n104. \tbanner: string,\n105. \tdependencies: Dependency[]\n106. ) {\n107. \tconst sourceString = dependencies.length\n108. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n109. \t\t: \'\';\n110. \n111. \tconst id = options.amd && options.amd.id;\n112. \n113. \treturn deindent`\n114. \t\tdefine(${id ? `"${id}", ` : \'\'}${sourceString}function(${paramString(dependencies)}) { "use strict";\n115. \t\t\t${getCompatibilityStatements(dependencies)}\n116. \n117. \t\t\t${code}\n118. \t\t\treturn ${name};\n119. \t\t});`;\n120. }\n121. \n122. function cjs(\n123. \tcode: string,\n124. \tname: string,\n125. \toptions: CompileOptions,\n126. \tbanner: string,\n127. \tsharedPath: string,\n128. \thelpers: { name: string, alias: string }[],\n129. \tdependencies: Dependency[]\n130. ) {\n131. \tconst SHARED = \'__shared\';\n132. \tconst helperBlock = helpers && (\n133. \t\t`var ${SHARED} = require(${JSON.stringify(sharedPath)});\\n` +\n134. \t\thelpers.map(helper => {\n135. \t\t\treturn `var ${helper.alias} = ${SHARED}.${helper.name};`;\n136. \t\t}).join(\'\\n\')\n137. \t);\n138. \n139. \tconst requireBlock = dependencies.length > 0 && (\n140. \t\tdependencies\n141. \t\t\t.map(d => `var ${d.name} = require("${d.source}");`)\n142. \t\t\t.join(\'\\n\\n\')\n143. \t);\n144. \n145. \treturn deindent`\n146. \t\t${banner}\n147. \t\t"use strict";\n148. \n149. \t\t${helperBlock}\n150. \t\t${requireBlock}\n151. \t\t${getCompatibilityStatements(dependencies)}\n152. \n153. \t\t${code}\n154. \n155. \t\tmodule.exports = ${name};`\n156. }\n157. \n158. function iife(\n159. \tcode: string,\n160. \tname: string,\n161. \toptions: CompileOptions,\n162. \tbanner: string,\n163. \tdependencies: Dependency[]\n164. ) {\n165. \tif (!options.name) {\n166. \t\tthrow new Error(`Missing required \'name\' option for IIFE export`);\n167. \t}\n168. \n169. \tconst globals = getGlobals(dependencies, options);\n170. \n171. \treturn deindent`\n172. \t\t${banner}\n173. \t\tvar ${options.name} = (function(${paramString(dependencies)}) { "use strict";\n174. \t\t\t${getCompatibilityStatements(dependencies)}\n175. \n176. \t\t\t${code}\n177. \t\t\treturn ${name};\n178. \t\t}(${globals.join(\', \')}));`;\n179. }\n180. \n181. function umd(\n182. \tcode: string,\n183. \tname: string,\n184. \toptions: CompileOptions,\n185. \tbanner: string,\n186. \tdependencies: Dependency[]\n187. ) {\n188. \tif (!options.name) {\n189. \t\tthrow new Error(`Missing required \'name\' option for UMD export`);\n190. \t}\n191. \n192. \tconst amdId = options.amd && options.amd.id ? `\'${options.amd.id}\', ` : \'\';\n193. \n194. \tconst amdDeps = dependencies.length\n195. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n196. \t\t: \'\';\n197. \n198. \tconst cjsDeps = dependencies\n199. \t\t.map(d => `require("${d.source}")`)\n200. \t\t.join(\', \');\n201. \n202. \tconst globals = getGlobals(dependencies, options);\n203. \n204. \treturn deindent`\n205. \t\t${banner}\n206. \t\t(function(global, factory) {\n207. \t\t\ttypeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :\n208. \t\t\ttypeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :\n209. \t\t\t(global.${options.name} = factory(${globals}));\n210. \t\t}(this, (function (${paramString(dependencies)}) { "use strict";\n211. \n212. \t\t\t${getCompatibilityStatements(dependencies)}\n213. \n214. \t\t\t${code}\n215. \n216. \t\t\treturn ${name};\n217. \n218. \t\t})));`;\n219. }\n220. \n221. function expr(\n222. \tcode: string,\n223. \tname: string,\n224. \toptions: CompileOptions,\n225. \tbanner: string,\n226. \tdependencies: Dependency[]\n227. ) {\n228. \tconst globals = getGlobals(dependencies, options);\n229. \n230. \treturn deindent`\n231. \t\t(function (${paramString(dependencies)}) { "use strict";\n232. \t\t\t${banner}\n233. \n234. \t\t\t${getCompatibilityStatements(dependencies)}\n235. \n236. \t\t\t${code}\n237. \n238. \t\t\treturn ${name};\n239. \t\t}(${globals.join(\', \')}))`;\n240. }\n241. \n242. function paramString(dependencies: Dependency[]) {\n243. \treturn dependencies.map(dep => dep.name).join(\', \');\n244. }\n245. \n246. function removeExtension(file: string) {\n247. \tconst index = file.lastIndexOf(\'.\');\n248. \treturn ~index ? file.slice(0, index) : file;\n249. }\n250. \n251. function getCompatibilityStatements(dependencies: Dependency[]) {\n252. \tif (!dependencies.length) return null;\n253. \n254. \tconst statements: string[] = [];\n255. \n256. \tdependencies.forEach(dependency => {\n257. \t\tstatements.push(...dependency.statements);\n258. \t});\n259. \n260. \treturn statements.join(\'\\n\');\n261. }\n262. \n263. function getGlobals(dependencies: Dependency[], options: CompileOptions) {\n264. \tconst { globals, onerror, onwarn } = options;\n265. \tconst globalFn = getGlobalFn(globals);\n266. \n267. \treturn dependencies.map(d => {\n268. \t\tlet name = globalFn(d.source);\n269. \n270. \t\tif (!name) {\n271. \t\t\tif (d.name.startsWith(\'__import\')) {\n272. \t\t\t\tconst error = new Error(\n273. \t\t\t\t\t`Could not determine name for imported module \'${d.source}\' – use options.globals`\n274. \t\t\t\t);\n275. \t\t\t\tonerror(error);\n276. \t\t\t} else {\n277. \t\t\t\tconst warning = {\n278. \t\t\t\t\tmessage: `No name was supplied for imported module \'${d.source}\'. Guessing \'${d.name}\', but you should use options.globals`,\n279. \t\t\t\t};\n280. \n281. \t\t\t\tonwarn(warning);\n282. \t\t\t}\n283. \n284. \t\t\tname = d.name;\n285. \t\t}\n286. \n287. \t\treturn name;\n288. \t});\n289. }\n290. \n291. function getGlobalFn(globals: any): (id: string) => string {\n292. \tif (typeof globals === \'function\') return globals;\n293. \tif (typeof globals === \'object\') {\n294. \t\treturn id => globals[id];\n295. \t}\n296. \n297. \treturn () => undefined;\n298. }\n\n\nFile: src/index.ts\nLine number range: 1 - 78\nContent:\n1. import parse from \'./parse/index\';\n2. import validate from \'./validate/index\';\n3. import generate from \'./generators/dom/index\';\n4. import generateSSR from \'./generators/server-side-rendering/index\';\n5. import { assign } from \'./shared/index.js\';\n6. import { version } from \'../package.json\';\n7. import Stylesheet from \'./css/Stylesheet\';\n8. import { Parsed, CompileOptions, Warning } from \'./interfaces\';\n9. \n10. function normalizeOptions(options: CompileOptions): CompileOptions {\n11. \tlet normalizedOptions = assign({ generate: \'dom\' }, options);\n12. \tconst { onwarn, onerror } = normalizedOptions;\n13. \tnormalizedOptions.onwarn = onwarn\n14. \t\t? (warning: Warning) => onwarn(warning, defaultOnwarn)\n15. \t\t: defaultOnwarn;\n16. \tnormalizedOptions.onerror = onerror\n17. \t\t? (error: Error) => onerror(error, defaultOnerror)\n18. \t\t: defaultOnerror;\n19. \treturn normalizedOptions;\n20. }\n21. \n22. function defaultOnwarn(warning: Warning) {\n23. \tif (warning.loc) {\n24. \t\tconsole.warn(\n25. \t\t\t`(${warning.loc.line}:${warning.loc.column}) – ${warning.message}`\n26. \t\t); // eslint-disable-line no-console\n27. \t} else {\n28. \t\tconsole.warn(warning.message); // eslint-disable-line no-console\n29. \t}\n30. }\n31. \n32. function defaultOnerror(error: Error) {\n33. \tthrow error;\n34. }\n35. \n36. export function compile(source: string, _options: CompileOptions) {\n37. \tconst options = normalizeOptions(_options);\n38. \n39. \tlet parsed: Parsed;\n40. \n41. \ttry {\n42. \t\tparsed = parse(source, options);\n43. \t} catch (err) {\n44. \t\toptions.onerror(err);\n45. \t\treturn;\n46. \t}\n47. \n48. \tconst stylesheet = new Stylesheet(source, parsed, options.filename, options.cascade !== false);\n49. \n50. \tvalidate(parsed, source, stylesheet, options);\n51. \n52. \tconst compiler = options.generate === \'ssr\' ? generateSSR : generate;\n53. \n54. \treturn compiler(parsed, source, stylesheet, options);\n55. }\n56. \n57. export function create(source: string, _options: CompileOptions = {}) {\n58. \t_options.format = \'eval\';\n59. \n60. \tconst compiled = compile(source, _options);\n61. \n62. \tif (!compiled || !compiled.code) {\n63. \t\treturn;\n64. \t}\n65. \n66. \ttry {\n67. \t\treturn (0,eval)(compiled.code);\n68. \t} catch (err) {\n69. \t\tif (_options.onerror) {\n70. \t\t\t_options.onerror(err);\n71. \t\t\treturn;\n72. \t\t} else {\n73. \t\t\tthrow err;\n74. \t\t}\n75. \t}\n76. }\n77. \n78. export { parse, validate, version as VERSION };\n\n\nFile: src/interfaces.ts\nLine number range: 1 - 80\nContent:\n1. export interface Node {\n2. \tstart: number;\n3. \tend: number;\n4. \ttype: string;\n5. \t[propName: string]: any;\n6. }\n7. \n8. export interface Parser {\n9. \treadonly template: string;\n10. \treadonly filename?: string;\n11. \n12. \tindex: number;\n13. \tstack: Array<Node>;\n14. \n15. \thtml: Node;\n16. \tcss: Node;\n17. \tjs: Node;\n18. \tmetaTags: {};\n19. }\n20. \n21. export interface Parsed {\n22. \thash: number;\n23. \thtml: Node;\n24. \tcss: Node;\n25. \tjs: Node;\n26. }\n27. \n28. export interface Warning {\n29. \tloc?: { line: number; column: number; pos?: number };\n30. \tpos?: number;\n31. \tmessage: string;\n32. \tfilename?: string;\n33. \tframe?: string;\n34. \ttoString: () => string;\n35. }\n36. \n37. export type ModuleFormat = \'es\' | \'amd\' | \'cjs\' | \'iife\' | \'umd\' | \'eval\';\n38. \n39. export interface CompileOptions {\n40. \tformat?: ModuleFormat;\n41. \tname?: string;\n42. \tfilename?: string;\n43. \tgenerate?: string;\n44. \tglobals?: ((id: string) => string) | object;\n45. \tamd?: {\n46. \t\tid?: string;\n47. \t};\n48. \n49. \toutputFilename?: string;\n50. \tcssOutputFilename?: string;\n51. \n52. \tdev?: boolean;\n53. \tshared?: boolean | string;\n54. \tcascade?: boolean;\n55. \thydratable?: boolean;\n56. \tlegacy?: boolean;\n57. \tcustomElement?: CustomElementOptions | true;\n58. \tcss?: boolean;\n59. \n60. \tonerror?: (error: Error) => void;\n61. \tonwarn?: (warning: Warning) => void;\n62. }\n63. \n64. export interface GenerateOptions {\n65. \tname: string;\n66. \tformat: ModuleFormat;\n67. \tbanner?: string;\n68. \tsharedPath?: string | boolean;\n69. \thelpers?: { name: string, alias: string }[];\n70. }\n71. \n72. export interface Visitor {\n73. \tenter: (node: Node) => void;\n74. \tleave?: (node: Node) => void;\n75. }\n76. \n77. export interface CustomElementOptions {\n78. \ttag?: string;\n79. \tprops?: string[];\n80. }\n\n\nFile: src/parse/read/script.ts\nLine number range: 1 - 38\nContent:\n1. import { parse } from \'acorn\';\n2. import repeat from \'../../utils/repeat\';\n3. import { Parser } from \'../index\';\n4. import { Node } from \'../../interfaces\';\n5. \n6. const scriptClosingTag = \'</script>\';\n7. \n8. export default function readScript(parser: Parser, start: number, attributes: Node[]) {\n9. \tconst scriptStart = parser.index;\n10. \tconst scriptEnd = parser.template.indexOf(scriptClosingTag, scriptStart);\n11. \n12. \tif (scriptEnd === -1) parser.error(`<script> must have a closing tag`);\n13. \n14. \tconst source =\n15. \t\trepeat(\' \', scriptStart) + parser.template.slice(scriptStart, scriptEnd);\n16. \tparser.index = scriptEnd + scriptClosingTag.length;\n17. \n18. \tlet ast;\n19. \n20. \ttry {\n21. \t\tast = parse(source, {\n22. \t\t\tecmaVersion: 8,\n23. \t\t\tsourceType: \'module\',\n24. \t\t});\n25. \t} catch (err) {\n26. \t\tparser.acornError(err);\n27. \t}\n28. \n29. \tif (!ast.body.length) return null;\n30. \n31. \tast.start = scriptStart;\n32. \treturn {\n33. \t\tstart,\n34. \t\tend: parser.index,\n35. \t\tattributes,\n36. \t\tcontent: ast,\n37. \t};\n38. }\n\n\nFile: src/utils/getObject.ts\nLine number range: 1 - 6\nContent:\n1. import { Node } from \'../interfaces\';\n2. \n3. export default function getObject(node: Node) {\n4. \twhile (node.type === \'MemberExpression\') node = node.object;\n5. \treturn node;\n6. }\n\n\nFile: src/utils/stringify.ts\nLine number range: 1 - 9\nContent:\n1. export function stringify(data: string, options = {}) {\n2. \treturn JSON.stringify(escape(data, options));\n3. }\n4. \n5. export function escape(data: string, { onlyEscapeAtSymbol = false } = {}) {\n6. \treturn data.replace(onlyEscapeAtSymbol ? /(%+|@+)/g : /(%+|@+|#+)/g, (match: string) => {\n7. \t\treturn match + match[0];\n8. \t});\n9. }\n\n\nFile: src/validate/js/index.ts\nLine number range: 1 - 93\nContent:\n1. import propValidators from \'./propValidators/index\';\n2. import fuzzymatch from \'../utils/fuzzymatch\';\n3. import checkForDupes from \'./utils/checkForDupes\';\n4. import checkForComputedKeys from \'./utils/checkForComputedKeys\';\n5. import namespaces from \'../../utils/namespaces\';\n6. import { Validator } from \'../\';\n7. import { Node } from \'../../interfaces\';\n8. \n9. const validPropList = Object.keys(propValidators);\n10. \n11. export default function validateJs(validator: Validator, js: Node) {\n12. \tjs.content.body.forEach((node: Node) => {\n13. \t\t// check there are no named exports\n14. \t\tif (node.type === \'ExportNamedDeclaration\') {\n15. \t\t\tvalidator.error(`A component can only have a default export`, node.start);\n16. \t\t}\n17. \n18. \t\tif (node.type === \'ExportDefaultDeclaration\') {\n19. \t\t\tif (node.declaration.type !== \'ObjectExpression\') {\n20. \t\t\t\treturn validator.error(\n21. \t\t\t\t\t`Default export must be an object literal`,\n22. \t\t\t\t\tnode.declaration.start\n23. \t\t\t\t);\n24. \t\t\t}\n25. \n26. \t\t\tcheckForComputedKeys(validator, node.declaration.properties);\n27. \t\t\tcheckForDupes(validator, node.declaration.properties);\n28. \n29. \t\t\tconst props = validator.properties;\n30. \n31. \t\t\tnode.declaration.properties.forEach((prop: Node) => {\n32. \t\t\t\tprops.set(prop.key.name, prop);\n33. \t\t\t});\n34. \n35. \t\t\t// Remove these checks in version 2\n36. \t\t\tif (props.has(\'oncreate\') && props.has(\'onrender\')) {\n37. \t\t\t\tvalidator.error(\n38. \t\t\t\t\t\'Cannot have both oncreate and onrender\',\n39. \t\t\t\t\tprops.get(\'onrender\').start\n40. \t\t\t\t);\n41. \t\t\t}\n42. \n43. \t\t\tif (props.has(\'ondestroy\') && props.has(\'onteardown\')) {\n44. \t\t\t\tvalidator.error(\n45. \t\t\t\t\t\'Cannot have both ondestroy and onteardown\',\n46. \t\t\t\t\tprops.get(\'onteardown\').start\n47. \t\t\t\t);\n48. \t\t\t}\n49. \n50. \t\t\t// ensure all exported props are valid\n51. \t\t\tnode.declaration.properties.forEach((prop: Node) => {\n52. \t\t\t\tconst propValidator = propValidators[prop.key.name];\n53. \n54. \t\t\t\tif (propValidator) {\n55. \t\t\t\t\tpropValidator(validator, prop);\n56. \t\t\t\t} else {\n57. \t\t\t\t\tconst match = fuzzymatch(prop.key.name, validPropList);\n58. \t\t\t\t\tif (match) {\n59. \t\t\t\t\t\tvalidator.error(\n60. \t\t\t\t\t\t\t`Unexpected property \'${prop.key.name}\' (did you mean \'${match}\'?)`,\n61. \t\t\t\t\t\t\tprop.start\n62. \t\t\t\t\t\t);\n63. \t\t\t\t\t} else if (/FunctionExpression/.test(prop.value.type)) {\n64. \t\t\t\t\t\tvalidator.error(\n65. \t\t\t\t\t\t\t`Unexpected property \'${prop.key.name}\' (did you mean to include it in \'methods\'?)`,\n66. \t\t\t\t\t\t\tprop.start\n67. \t\t\t\t\t\t);\n68. \t\t\t\t\t} else {\n69. \t\t\t\t\t\tvalidator.error(\n70. \t\t\t\t\t\t\t`Unexpected property \'${prop.key.name}\'`,\n71. \t\t\t\t\t\t\tprop.start\n72. \t\t\t\t\t\t);\n73. \t\t\t\t\t}\n74. \t\t\t\t}\n75. \t\t\t});\n76. \n77. \t\t\tif (props.has(\'namespace\')) {\n78. \t\t\t\tconst ns = props.get(\'namespace\').value.value;\n79. \t\t\t\tvalidator.namespace = namespaces[ns] || ns;\n80. \t\t\t}\n81. \n82. \t\t\tvalidator.defaultExport = node;\n83. \t\t}\n84. \t});\n85. \n86. \t[\'components\', \'methods\', \'helpers\', \'transitions\'].forEach(key => {\n87. \t\tif (validator.properties.has(key)) {\n88. \t\t\tvalidator.properties.get(key).value.properties.forEach((prop: Node) => {\n89. \t\t\t\tvalidator[key].set(prop.key.name, prop.value);\n90. \t\t\t});\n91. \t\t}\n92. \t});\n93. }\n\n\nFile: src/validate/js/propValidators/oncreate.ts\nLine number range: 1 - 14\nContent:\n1. import usesThisOrArguments from \'../utils/usesThisOrArguments\';\n2. import { Validator } from \'../../\';\n3. import { Node } from \'../../../interfaces\';\n4. \n5. export default function oncreate(validator: Validator, prop: Node) {\n6. \tif (prop.value.type === \'ArrowFunctionExpression\') {\n7. \t\tif (usesThisOrArguments(prop.value.body)) {\n8. \t\t\tvalidator.error(\n9. \t\t\t\t`\'oncreate\' should be a function expression, not an arrow function expression`,\n10. \t\t\t\tprop.start\n11. \t\t\t);\n12. \t\t}\n13. \t}\n14. }\n\n--- END CONTEXT ---\nThese context should be enough to help you make the necessary code edits. Do NOT explore for more context in the codebase!\n\nAnalyzer agent has analyzed the issue and provided instruction on the issue:\n--- BEGIN ANALYZER MESSAGE ---\n1) Issue Understanding\n\n- Symptom: When a component defines an async lifecycle method in the default export object (e.g., async oncreate() { ... }), the compiled output removes the async keyword from the generated function. As a result, any await expressions inside the function are invalid at runtime because await is only allowed within async functions.\n- Unexpected behavior: The compiler transforms async functions (both object literal methods and arrow functions) into plain non-async functions. This breaks code that uses await inside oncreate (and potentially other template properties that accept functions).\n\n2) Code Analysis\n\n- Involved files and functions:\n  - File: src/generators/Generator.ts\n    - Function block: addArrowFunctionExpression (around lines 511–529)\n    - Function block: addFunctionExpression (around lines 531–537)\n    - Function block: addDeclaration (around lines 545–569) — calls the above for specific properties, including oncreate and ondestroy\n  - File: src/generators/dom/index.ts\n    - Constructor generation uses %oncreate and binds it: var _oncreate = %oncreate.bind(this); (around line 217), and calls @callAll(this._oncreate) later.\n\n- What the problematic code is doing:\n  - addArrowFunctionExpression takes an ArrowFunctionExpression node and generates a normal function declaration string: “function name(params) { … }” or “function name(params) { return expr; }” if the arrow function has a concise body. It does not consider node.async.\n  - addFunctionExpression takes a FunctionExpression node and builds a “function name(…params…) { … }” block by slicing the original source starting at the first “(”. It also does not consider node.async (or node.generator).\n  - addDeclaration wires these helpers to generate named functions for template properties such as oncreate and ondestroy. Because the helpers omit async, any async function becomes non-async in the output.\n\n3) Root Cause\n\n- The generator’s transformation logic does not preserve the async modifier when converting arrow functions or object/method FunctionExpressions into standalone named functions. Specifically:\n  - addArrowFunctionExpression ignores node.async and always emits a non-async function.\n  - addFunctionExpression rebuilds “function name(…)” from the source slice starting at the first “(”, thereby dropping any “async ” that precedes the “function” keyword and any “*” for generators. The reconstructed header never includes async, so await becomes illegal.\n- The bug manifests when templateProperties.oncreate.value is async (either as an object method “async oncreate() { … }” or an arrow “oncreate: async () => { … }”).\n\n4) Fix Suggestion\n\nA) Preserve async for ArrowFunctionExpression-based declarations\n- File: src/generators/Generator.ts\n- Function/block: addArrowFunctionExpression\n- Change: When node.async is true, prepend “async ” to the generated function header. That is, emit “async function name(…) { … }” (for a block body) or “async function name(…) { return [expr]; }” (for a concise body).\n- Why: This preserves the async semantics of the original arrow function so that await remains valid inside the function body. Without this, await causes a syntax/runtime error.\n\nB) Preserve async (and generator) for FunctionExpression-based declarations\n- File: src/generators/Generator.ts\n- Function/block: addFunctionExpression\n- Change: Inspect node.async and node.generator. Prepend “async ” when node.async is true, and include “*” after “function” when node.generator is true, in the constructed function header. For example, emit “async function name[✂c-end✂]” or “function* name[✂c-end✂]”, or “async function* name[✂c-end✂]” for async generators. Keep the slicing starting from “(” for parameters and body as-is.\n- Why: The current implementation discards modifiers that appear before the parameter list, specifically “async ” and the generator “*”. Restoring them ensures the generated function has the same semantics as the original (particularly vital for async oncreate with await).\n\nC) No changes needed in invocation sites\n- File: src/generators/dom/index.ts\n- Function/block: constructor body where %oncreate is bound and invoked (@callAll)\n- Change: None. Binding an async function with .bind(this) is correct and will still return a promise when called; the compiler does not need to await it. The important part is that the function remains async so await inside is legal.\n\nAfter these changes, async oncreate and other async template properties will retain their async nature in the compiled output, ensuring await expressions execute as intended without syntax errors.\n--- END ANALYZER MESSAGE ---\n\nIMPORTANT INSTRUCTION:\n- The context provided above should be sufficient for you to make the required code edits. Do NOT explore for more context in the codebase!\n- Do NOT FIND, WRITE or RUN any tests, your change will be tested automatically by reproduction tests and regression tests later!!!\n- Never write any tests yourself!!! (Very important!)\n\nPlease implement these changes precisely, following the exact specifications from the analyzer.\n' additional_kwargs={} response_metadata={}
2025-11-11 00:46:05,548 - thread-133013323122368.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_StVonBSHOXIflirVNWTDLi7g', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 95, 'prompt_tokens': 19461, 'total_tokens': 19556, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f672b34b-b2a0-483b-9a5d-b908079b88e8-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'src/generators/Generator.ts'}, 'id': 'call_StVonBSHOXIflirVNWTDLi7g', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19461, 'output_tokens': 95, 'total_tokens': 19556, 'input_token_details': {'audio': 0, 'cache_read': 1280}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-11 00:46:07,294 - thread-133013323122368.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_rlG5Ob50YxMKMJGV0mL0KD8Y', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 23936, 'total_tokens': 23961, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3220ec5b-077a-4952-a8b9-1139e224cb38-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'src/generators/Generator.ts'}, 'id': 'call_rlG5Ob50YxMKMJGV0mL0KD8Y', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23936, 'output_tokens': 25, 'total_tokens': 23961, 'input_token_details': {'audio': 0, 'cache_read': 1280}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:46:10,095 - thread-133013323122368.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_D1jxOUiz2X2F2xKZH0m0rJem', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts","start_line":498,"end_line":750}', 'name': 'read_file_with_line_numbers'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 28411, 'total_tokens': 28449, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--77dcbdfa-131d-472b-a37b-a32aa991d0f1-0' tool_calls=[{'name': 'read_file_with_line_numbers', 'args': {'relative_path': 'src/generators/Generator.ts', 'start_line': 498, 'end_line': 750}, 'id': 'call_D1jxOUiz2X2F2xKZH0m0rJem', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28411, 'output_tokens': 38, 'total_tokens': 28449, 'input_token_details': {'audio': 0, 'cache_read': 1280}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:46:34,859 - thread-133013323122368.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xUF4SlfZMMMNlD7EdCIgQoRX', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts","old_content":"\\t\\t\\t\\tconst addArrowFunctionExpression = (name: string, node: Node) => {\\n\\t\\t\\t\\t\\tconst { body, params } = node;\\n\\n\\t\\t\\t\\t\\tconst paramString = params.length ?\\n\\t\\t\\t\\t\\t\\t`[✂${params[0].start}-${params[params.length - 1].end}✂]` :\\n\\t\\t\\t\\t\\t\\t``;\\n\\n\\t\\t\\t\\t\\tif (body.type === \'BlockStatement\') {\\n\\t\\t\\t\\t\\t\\tcomponentDefinition.addBlock(deindent`\\n\\t\\t\\t\\t\\t\\t\\tfunction ${name}(${paramString}) [✂${body.start}-${body.end}✂]\\n\\t\\t\\t\\t\\t\\t`);\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\tcomponentDefinition.addBlock(deindent`\\n\\t\\t\\t\\t\\t\\t\\tfunction ${name}(${paramString}) {\\n\\t\\t\\t\\t\\t\\t\\t\\treturn [✂${body.start}-${body.end}✂];\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t`);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t};","new_content":"\\t\\t\\t\\tconst addArrowFunctionExpression = (name: string, node: Node) => {\\n\\t\\t\\t\\t\\tconst { body, params } = node;\\n\\t\\t\\t\\t\\tconst asyncKeyword = (node as any).async ? \'async \' : \'\';\\n\\n\\t\\t\\t\\t\\tconst paramString = params.length ?\\n\\t\\t\\t\\t\\t\\t`[✂${params[0].start}-${params[params.length - 1].end}✂]` :\\n\\t\\t\\t\\t\\t\\t``;\\n\\n\\t\\t\\t\\t\\tif (body.type === \'BlockStatement\') {\\n\\t\\t\\t\\t\\t\\tcomponentDefinition.addBlock(deindent`\\n\\t\\t\\t\\t\\t\\t\\t${asyncKeyword}function ${name}(${paramString}) [✂${body.start}-${body.end}✂]\\n\\t\\t\\t\\t\\t\\t`);\\n\\t\\t\\t\\t\\t} else {\\n\\t\\t\\t\\t\\t\\tcomponentDefinition.addBlock(deindent`\\n\\t\\t\\t\\t\\t\\t\\t${asyncKeyword}function ${name}(${paramString}) {\\n\\t\\t\\t\\t\\t\\t\\t\\treturn [✂${body.start}-${body.end}✂];\\n\\t\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t`);\\n\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t};"}', 'name': 'edit_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2572, 'prompt_tokens': 30420, 'total_tokens': 32992, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1984, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cebbf642-2cc9-4977-b5f9-09674af17a79-0' tool_calls=[{'name': 'edit_file', 'args': {'relative_path': 'src/generators/Generator.ts', 'old_content': "\t\t\t\tconst addArrowFunctionExpression = (name: string, node: Node) => {\n\t\t\t\t\tconst { body, params } = node;\n\n\t\t\t\t\tconst paramString = params.length ?\n\t\t\t\t\t\t`[✂${params[0].start}-${params[params.length - 1].end}✂]` :\n\t\t\t\t\t\t``;\n\n\t\t\t\t\tif (body.type === 'BlockStatement') {\n\t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n\t\t\t\t\t\t\tfunction ${name}(${paramString}) [✂${body.start}-${body.end}✂]\n\t\t\t\t\t\t`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n\t\t\t\t\t\t\tfunction ${name}(${paramString}) {\n\t\t\t\t\t\t\t\treturn [✂${body.start}-${body.end}✂];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t`);\n\t\t\t\t\t}\n\t\t\t\t};", 'new_content': "\t\t\t\tconst addArrowFunctionExpression = (name: string, node: Node) => {\n\t\t\t\t\tconst { body, params } = node;\n\t\t\t\t\tconst asyncKeyword = (node as any).async ? 'async ' : '';\n\n\t\t\t\t\tconst paramString = params.length ?\n\t\t\t\t\t\t`[✂${params[0].start}-${params[params.length - 1].end}✂]` :\n\t\t\t\t\t\t``;\n\n\t\t\t\t\tif (body.type === 'BlockStatement') {\n\t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n\t\t\t\t\t\t\t${asyncKeyword}function ${name}(${paramString}) [✂${body.start}-${body.end}✂]\n\t\t\t\t\t\t`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n\t\t\t\t\t\t\t${asyncKeyword}function ${name}(${paramString}) {\n\t\t\t\t\t\t\t\treturn [✂${body.start}-${body.end}✂];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t`);\n\t\t\t\t\t}\n\t\t\t\t};"}, 'id': 'call_xUF4SlfZMMMNlD7EdCIgQoRX', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30420, 'output_tokens': 2572, 'total_tokens': 32992, 'input_token_details': {'audio': 0, 'cache_read': 1280}, 'output_token_details': {'audio': 0, 'reasoning': 1984}}
2025-11-11 00:46:38,166 - thread-133013323122368.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WOtW17DWC35Bfi1PsmSrZULQ', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts","old_content":"\\t\\t\\t\\tconst addFunctionExpression = (name: string, node: Node) => {\\n\\t\\t\\t\\t\\tlet c = node.start;\\n\\t\\t\\t\\t\\twhile (this.source[c] !== \'(\') c += 1;\\n\\t\\t\\t\\t\\tcomponentDefinition.addBlock(deindent`\\n\\t\\t\\t\\t\\t\\tfunction ${name}[✂${c}-${node.end}✂];\\n\\t\\t\\t\\t\\t`);\\n\\t\\t\\t\\t};","new_content":"\\t\\t\\t\\tconst addFunctionExpression = (name: string, node: Node) => {\\n\\t\\t\\t\\t\\tlet c = node.start;\\n\\t\\t\\t\\t\\twhile (this.source[c] !== \'(\') c += 1;\\n\\t\\t\\t\\t\\tconst asyncKeyword = (node as any).async ? \'async \' : \'\';\\n\\t\\t\\t\\t\\tconst generatorMark = (node as any).generator ? \'*\' : \'\';\\n\\t\\t\\t\\t\\tcomponentDefinition.addBlock(deindent`\\n\\t\\t\\t\\t\\t\\t${asyncKeyword}function${generatorMark} ${name}[✂${c}-${node.end}✂];\\n\\t\\t\\t\\t\\t`);\\n\\t\\t\\t\\t};"}', 'name': 'edit_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 291, 'prompt_tokens': 31022, 'total_tokens': 31313, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--47a1ad3e-66df-498c-9c12-7dbb38e288b4-0' tool_calls=[{'name': 'edit_file', 'args': {'relative_path': 'src/generators/Generator.ts', 'old_content': "\t\t\t\tconst addFunctionExpression = (name: string, node: Node) => {\n\t\t\t\t\tlet c = node.start;\n\t\t\t\t\twhile (this.source[c] !== '(') c += 1;\n\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n\t\t\t\t\t\tfunction ${name}[✂${c}-${node.end}✂];\n\t\t\t\t\t`);\n\t\t\t\t};", 'new_content': "\t\t\t\tconst addFunctionExpression = (name: string, node: Node) => {\n\t\t\t\t\tlet c = node.start;\n\t\t\t\t\twhile (this.source[c] !== '(') c += 1;\n\t\t\t\t\tconst asyncKeyword = (node as any).async ? 'async ' : '';\n\t\t\t\t\tconst generatorMark = (node as any).generator ? '*' : '';\n\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n\t\t\t\t\t\t${asyncKeyword}function${generatorMark} ${name}[✂${c}-${node.end}✂];\n\t\t\t\t\t`);\n\t\t\t\t};"}, 'id': 'call_WOtW17DWC35Bfi1PsmSrZULQ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31022, 'output_tokens': 291, 'total_tokens': 31313, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:46:40,462 - thread-133013323122368.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_RiqNxKf3fm6mqfLoHhOOOppX', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts","start_line":498,"end_line":750}', 'name': 'read_file_with_line_numbers'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 31333, 'total_tokens': 31371, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f83a1152-dd1d-46c4-aab3-584ee6e954b0-0' tool_calls=[{'name': 'read_file_with_line_numbers', 'args': {'relative_path': 'src/generators/Generator.ts', 'start_line': 498, 'end_line': 750}, 'id': 'call_RiqNxKf3fm6mqfLoHhOOOppX', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31333, 'output_tokens': 38, 'total_tokens': 31371, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:46:42,647 - thread-133013323122368.prometheus.lang_graph.nodes.edit_node - DEBUG - content='I have implemented the necessary changes to preserve the async keyword (and generator marker) in generated functions:\n\n- Updated addArrowFunctionExpression to include “async ” when the original arrow function is async.\n- Updated addFunctionExpression to include “async ” and “*” when the original FunctionExpression is async and/or a generator.\n\nThese changes ensure that async lifecycle methods like oncreate retain their async semantics in the compiled output.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 88, 'prompt_tokens': 33416, 'total_tokens': 33504, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 23936}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--6fa7cb96-9b93-46b3-b1be-337aa0cdb315-0' usage_metadata={'input_tokens': 33416, 'output_tokens': 88, 'total_tokens': 33504, 'input_token_details': {'audio': 0, 'cache_read': 23936}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:46:42,686 - thread-133013323122368.prometheus.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/src/generators/Generator.ts b/src/generators/Generator.ts
index 5b7ec8f07..b449367a7 100644
--- a/src/generators/Generator.ts
+++ b/src/generators/Generator.ts
@@ -510,6 +510,7 @@ export default class Generator {
 
 				const addArrowFunctionExpression = (name: string, node: Node) => {
 					const { body, params } = node;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
 
 					const paramString = params.length ?
 						`[✂${params[0].start}-${params[params.length - 1].end}✂]` :
@@ -517,11 +518,11 @@ export default class Generator {
 
 					if (body.type === 'BlockStatement') {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
+							${asyncKeyword}function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
 						`);
 					} else {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) {
+							${asyncKeyword}function ${name}(${paramString}) {
 								return [✂${body.start}-${body.end}✂];
 							}
 						`);
@@ -531,8 +532,10 @@ export default class Generator {
 				const addFunctionExpression = (name: string, node: Node) => {
 					let c = node.start;
 					while (this.source[c] !== '(') c += 1;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
+					const generatorMark = (node as any).generator ? '*' : '';
 					componentDefinition.addBlock(deindent`
-						function ${name}[✂${c}-${node.end}✂];
+						${asyncKeyword}function${generatorMark} ${name}[✂${c}-${node.end}✂];
 					`);
 				};
 

2025-11-11 00:46:42,688 - thread-133013323122368.prometheus.lang_graph.nodes.git_reset_node - DEBUG - Resetting the git repository
2025-11-11 00:46:42,718 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - INFO - Enter bug_fix_verification_subgraph_node
2025-11-11 00:46:42,718 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproduced_bug_file: test/js-async/index.js
2025-11-11 00:46:42,718 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproduced_bug_commands: ['npm run build', './node_modules/.bin/mocha -r esm test/js-async/index.js']
2025-11-11 00:46:42,718 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproduced_bug_patch: diff --git a/test/js-async/index.js b/test/js-async/index.js
new file mode 100644
index 000000000..d8a0e8922
--- /dev/null
+++ b/test/js-async/index.js
@@ -0,0 +1,18 @@
+import assert from "assert";
+import { svelte } from "../helpers.js";
+
+describe("js", () => {
+  it("preserves async keyword on oncreate lifecycle method", () => {
+    const input = `<script>
+      export default {
+        async oncreate() {
+          const data = await fetch('foo.json').then(r => r.json());
+          console.log(data);
+        }
+      };
+    </script>`;
+
+    const { code } = svelte.compile(input, { shared: true });
+    assert.ok(/async function oncreate\s*\(/.test(code));
+  });
+});

2025-11-11 00:46:42,719 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - edit_patch: diff --git a/src/generators/Generator.ts b/src/generators/Generator.ts
index 5b7ec8f07..b449367a7 100644
--- a/src/generators/Generator.ts
+++ b/src/generators/Generator.ts
@@ -510,6 +510,7 @@ export default class Generator {
 
 				const addArrowFunctionExpression = (name: string, node: Node) => {
 					const { body, params } = node;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
 
 					const paramString = params.length ?
 						`[✂${params[0].start}-${params[params.length - 1].end}✂]` :
@@ -517,11 +518,11 @@ export default class Generator {
 
 					if (body.type === 'BlockStatement') {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
+							${asyncKeyword}function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
 						`);
 					} else {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) {
+							${asyncKeyword}function ${name}(${paramString}) {
 								return [✂${body.start}-${body.end}✂];
 							}
 						`);
@@ -531,8 +532,10 @@ export default class Generator {
 				const addFunctionExpression = (name: string, node: Node) => {
 					let c = node.start;
 					while (this.source[c] !== '(') c += 1;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
+					const generatorMark = (node as any).generator ? '*' : '';
 					componentDefinition.addBlock(deindent`
-						function ${name}[✂${c}-${node.end}✂];
+						${asyncKeyword}function${generatorMark} ${name}[✂${c}-${node.end}✂];
 					`);
 				};
 

2025-11-11 00:46:42,721 - thread-133013323122368.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Applying patch: diff --git a/src/generators/Generator.ts b/src/generators/Generator.ts
index 5b7ec8f07..b449367a7 100644
--- a/src/generators/Generator.ts
+++ b/src/generators/Generator.ts
@@ -510,6 +510,7 @@ export default class Generator {
 
 				const addArrowFunctionExpression = (name: string, node: Node) => {
 					const { body, params } = node;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
 
 					const paramString = params.length ?
 						`[✂${params[0].start}-${params[params.length - 1].end}✂]` :
@@ -517,11 +518,11 @@ export default class Generator {
 
 					if (body.type === 'BlockStatement') {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
+							${asyncKeyword}function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
 						`);
 					} else {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) {
+							${asyncKeyword}function ${name}(${paramString}) {
 								return [✂${body.start}-${body.end}✂];
 							}
 						`);
@@ -531,8 +532,10 @@ export default class Generator {
 				const addFunctionExpression = (name: string, node: Node) => {
 					let c = node.start;
 					while (this.source[c] !== '(') c += 1;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
+					const generatorMark = (node as any).generator ? '*' : '';
 					componentDefinition.addBlock(deindent`
-						function ${name}[✂${c}-${node.end}✂];
+						${asyncKeyword}function${generatorMark} ${name}[✂${c}-${node.end}✂];
 					`);
 				};
 

2025-11-11 00:46:42,726 - thread-133013323122368.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Patch applied successfully.
2025-11-11 00:46:42,727 - thread-133013323122368.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Applying patch: diff --git a/test/js-async/index.js b/test/js-async/index.js
new file mode 100644
index 000000000..d8a0e8922
--- /dev/null
+++ b/test/js-async/index.js
@@ -0,0 +1,18 @@
+import assert from "assert";
+import { svelte } from "../helpers.js";
+
+describe("js", () => {
+  it("preserves async keyword on oncreate lifecycle method", () => {
+    const input = `<script>
+      export default {
+        async oncreate() {
+          const data = await fetch('foo.json').then(r => r.json());
+          console.log(data);
+        }
+      };
+    </script>`;
+
+    const { code } = svelte.compile(input, { shared: true });
+    assert.ok(/async function oncreate\s*\(/.test(code));
+  });
+});

2025-11-11 00:46:42,731 - thread-133013323122368.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Patch applied successfully.
2025-11-11 00:46:42,732 - thread-133013323122368.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-11 00:46:42,764 - thread-133013323122368.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-11 00:46:42,764 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-11 00:46:42,866 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:46:42,866 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 1dad8f193 add test for #891
[?2004l
2025-11-11 00:46:42,866 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-11 00:46:42,968 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:46:42,968 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing test/js-async/
[?2004l
2025-11-11 00:46:42,969 - thread-133013323122368.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-11 00:46:42,969 - thread-133013323122368.prometheus.docker.base_container - INFO - Creating directory src/generators in the container
2025-11-11 00:46:42,969 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p src/generators
2025-11-11 00:46:43,071 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:46:43,071 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-11 00:46:43,071 - thread-133013323122368.prometheus.docker.base_container - INFO - Creating directory test/js-async in the container
2025-11-11 00:46:43,071 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p test/js-async
2025-11-11 00:46:43,173 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:46:43,173 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-11 00:46:43,174 - thread-133013323122368.prometheus.docker.base_container - INFO - Updating test/js-async/index.js in the container
2025-11-11 00:46:43,174 - thread-133013323122368.prometheus.docker.base_container - INFO - Updating src/generators/Generator.ts in the container
2025-11-11 00:46:43,183 - thread-133013323122368.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-11 00:46:45,493 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verify_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZnWismIXXguQpPrtpBOqVtuB', 'function': {'arguments': '{"command":"npm run build"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 452, 'total_tokens': 478, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--96e728c1-6579-4b61-96c3-ff68ec28390a-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm run build'}, 'id': 'call_ZnWismIXXguQpPrtpBOqVtuB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 452, 'output_tokens': 26, 'total_tokens': 478, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:46:45,496 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: npm run build
2025-11-11 00:46:50,670 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:46:50,670 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l

> svelte@1.41.1 build
> node src/shared/_build.js && rollup -c

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m4.3s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m25ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m35ms[22m[39m
[?2004l
2025-11-11 00:46:51,653 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verify_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_NdVc9xD6LFLsmUAsfQpnwpjX', 'function': {'arguments': '{"command":"./node_modules/.bin/mocha -r esm test/js-async/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 759, 'total_tokens': 792, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ba35244f-c372-4eb8-8ca8-c3e8c6c0f236-0' tool_calls=[{'name': 'run_command', 'args': {'command': './node_modules/.bin/mocha -r esm test/js-async/index.js'}, 'id': 'call_NdVc9xD6LFLsmUAsfQpnwpjX', 'type': 'tool_call'}] usage_metadata={'input_tokens': 759, 'output_tokens': 33, 'total_tokens': 792, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:46:51,657 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ./node_modules/.bin/mocha -r esm test/js-async/index.js
2025-11-11 00:46:51,893 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-11 00:46:51,893 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
 ./node_modules/.bin/mocha -r esm test/js-async/index.
.js
[?2004l
/testbed/test/js-async/index.js:1
(function (exports, require, module, __filename, __dirname) { import assert from "assert";
                                                              ^^^^^^

SyntaxError: Cannot use import statement outside a module
[90m    at new Script (node:vm:100:7)[39m
[90m    at createScript (node:vm:265:10)[39m
[90m    at Object.runInThisContext (node:vm:313:10)[39m
[90m    at wrapSafe (node:internal/modules/cjs/loader:1114:15)[39m
[90m    at Module._compile (node:internal/modules/cjs/loader:1162:27)[39m
[90m    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1252:10)[39m
[90m    at Module.load (node:internal/modules/cjs/loader:1076:32)[39m
[90m    at Function.Module._load (node:internal/modules/cjs/loader:911:12)[39m
[90m    at Module.require (node:internal/modules/cjs/loader:1100:19)[39m
[90m    at require (node:internal/modules/cjs/helpers:119:18)[39m
    at [90m/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:230:27
    at Array.forEach (<anonymous>)
    at Mocha.loadFiles [90m(/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:227:14[90m)[39m
    at Mocha.run [90m(/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:513:10[90m)[39m
    at Object.<anonymous> [90m(/testbed/[39mnode_modules/[4mmocha[24m/bin/_mocha:480:18[90m)[39m
[90m    at Module._compile (node:internal/modules/cjs/loader:1198:14)[39m
[90m    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1252:10)[39m
[90m    at Module.load (node:internal/modules/cjs/loader:1076:32)[39m
[90m    at Function.Module._load (node:internal/modules/cjs/loader:911:12)[39m
[90m    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)[39m
[90m    at node:internal/main/run_main_module:22:47[39m
[?2004l
2025-11-11 00:47:00,219 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verify_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_sCuDgErfQkgY1N0BwlMaN98s', 'function': {'arguments': '{"command":"cat package.json"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 602, 'prompt_tokens': 1514, 'total_tokens': 2116, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1782d508-3a3c-48ed-9439-14294f6ebd4f-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat package.json'}, 'id': 'call_sCuDgErfQkgY1N0BwlMaN98s', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1514, 'output_tokens': 602, 'total_tokens': 2116, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-11 00:47:00,221 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: cat package.json
2025-11-11 00:47:00,323 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:47:00,323 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
{
  "name": "svelte",
  "version": "1.41.1",
  "description": "The magical disappearing UI framework",
  "main": "compiler/svelte.js",
  "files": [
    "compiler",
    "ssr",
    "shared.js",
    "README.md"
  ],
  "scripts": {
    "test": "mocha --opts mocha.opts",
    "quicktest": "mocha --opts mocha.opts",
    "precoverage": "export COVERAGE=true && nyc mocha --opts mocha.coverage.opts",
    "coverage": "nyc report --reporter=text-lcov > coverage.lcov",
    "codecov": "codecov",
    "precodecov": "npm run coverage",
    "lint": "eslint src test/*.js",
    "build": "node src/shared/_build.js && rollup -c",
    "dev": "node src/shared/_build.js && rollup -c -w",
    "pretest": "npm run build",
    "prepublishOnly": "npm run lint && npm test",
    "prettier": "prettier --write \"src/**/*.ts\""
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/sveltejs/svelte.git"
  },
  "keywords": [
    "UI",
    "framework",
    "templates",
    "templating"
  ],
  "author": "Rich Harris",
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/sveltejs/svelte/issues"
  },
  "homepage": "https://github.com/sveltejs/svelte#README",
  "devDependencies": {
    "@types/mocha": "^2.2.41",
    "@types/node": "^8.0.17",
    "acorn": "^5.1.1",
    "chalk": "^2.0.1",
    "codecov": "^2.2.0",
    "console-group": "^0.3.2",
    "css-tree": "1.0.0-alpha22",
    "eslint": "^4.3.0",
    "eslint-plugin-html": "^3.0.0",
    "eslint-plugin-import": "^2.2.0",
    "estree-walker": "^0.5.0",
    "glob": "^7.1.1",
    "jsdom": "^11.1.0",
    "locate-character": "^2.0.0",
    "magic-string": "^0.22.3",
    "mocha": "^3.2.0",
    "nightmare": "^2.10.0",
    "node-resolve": "^1.3.3",
    "nyc": "^11.1.0",
    "prettier": "^1.7.0",
    "rollup": "^0.48.2",
    "rollup-plugin-buble": "^0.15.0",
    "rollup-plugin-commonjs": "^8.0.2",
    "rollup-plugin-json": "^2.1.0",
    "rollup-plugin-node-resolve": "^3.0.0",
    "rollup-plugin-typescript": "^0.8.1",
    "rollup-plugin-virtual": "^1.0.1",
    "rollup-watch": "^4.3.1",
    "source-map": "^0.5.6",
    "source-map-support": "^0.4.8",
    "typescript": "^2.3.2"
  },
  "nyc": {
    "include": [
      "src/**/*.js",
      "shared.js"
    ],
    "exclude": [
      "src/**/__test__.js",
      "src/shared/**"
    ]
  }
}
[?2004l
2025-11-11 00:47:08,720 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verify_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_HkRn0aztd2gk41ntfaUkUhC2', 'function': {'arguments': '{"command":"npm ls esm || true"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 476, 'prompt_tokens': 2369, 'total_tokens': 2845, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5718ea71-847b-4476-9de1-43f04ff413da-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm ls esm || true'}, 'id': 'call_HkRn0aztd2gk41ntfaUkUhC2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2369, 'output_tokens': 476, 'total_tokens': 2845, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-11 00:47:08,724 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: npm ls esm || true
2025-11-11 00:47:09,691 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:47:09,691 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[0msvelte@1.41.1 /testbed[0m
[0m`-- [33m[40mesm@3.2.25[49m[39m [32m[40mextraneous[49m[39m[0m
[0m[0m
[?2004l
2025-11-11 00:47:24,507 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verify_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_r9ShMXBEXJhIAoBK2D4rZL8y', 'function': {'arguments': '{"command":"node -r esm ./node_modules/mocha/bin/_mocha test/js-async/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 938, 'prompt_tokens': 2496, 'total_tokens': 3434, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 896, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--51aa64a9-ad57-4d02-8e5e-c2db0454a6b2-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'node -r esm ./node_modules/mocha/bin/_mocha test/js-async/index.js'}, 'id': 'call_r9ShMXBEXJhIAoBK2D4rZL8y', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2496, 'output_tokens': 938, 'total_tokens': 3434, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 896}}
2025-11-11 00:47:24,509 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: node -r esm ./node_modules/mocha/bin/_mocha test/js-async/index.js
2025-11-11 00:47:25,915 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:47:25,915 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
 node -r esm ./node_modules/mocha/bin/_mocha test/js-a
async/index.js
[?2004l

[0m[0m
[0m  js[0m
  [32m  ✓[0m[90m preserves async keyword on oncreate lifecycle method[0m


[92m [0m[32m 1 passing[0m[90m (20ms)[0m

[?2004l
2025-11-11 00:47:39,237 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verify_node - DEBUG - content='Result:\n\x1b[?2004l\n\n> svelte@1.41.1 build\n> node src/shared/_build.js && rollup -c\n\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/index.ts\x1b[22m → \x1b[1mcompiler/svelte.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mcompiler/svelte.js\x1b[22m in \x1b[1m4.3s\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/server-side-rendering/register.js\x1b[22m → \x1b[1mssr/register.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mssr/register.js\x1b[22m in \x1b[1m25ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/shared/index.js\x1b[22m → \x1b[1mshared.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mshared.js\x1b[22m in \x1b[1m35ms\x1b[22m\x1b[39m\n\x1b[?2004l\n node -r esm ./node_modules/mocha/bin/_mocha test/js-a\nasync/index.js\n\x1b[?2004l\n\n\x1b[0m\x1b[0m\n\x1b[0m  js\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m preserves async keyword on oncreate lifecycle method\x1b[0m\n\n\n\x1b[92m \x1b[0m\x1b[32m 1 passing\x1b[0m\x1b[90m (20ms)\x1b[0m\n\n\x1b[?2004l' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1750, 'prompt_tokens': 2658, 'total_tokens': 4408, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--23898029-6178-4468-863d-1642d91275a7-0' usage_metadata={'input_tokens': 2658, 'output_tokens': 1750, 'total_tokens': 4408, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-11 00:47:43,759 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verify_structured_node - DEBUG - reproducing_test_fail_log=''
2025-11-11 00:47:43,792 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - INFO - Passing bug reproducing test: True
2025-11-11 00:47:43,792 - thread-133013323122368.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproducing_test_fail_log: 
2025-11-11 00:47:43,794 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State max_refined_query_loop: 4
2025-11-11 00:47:43,794 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State number_of_candidate_patch: 3
2025-11-11 00:47:43,794 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_existing_test: False
2025-11-11 00:47:43,794 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_regression_test: True
2025-11-11 00:47:43,796 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State max_refined_query_loop: 4
2025-11-11 00:47:43,796 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State number_of_candidate_patch: 3
2025-11-11 00:47:43,796 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_existing_test: False
2025-11-11 00:47:43,796 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_regression_test: True
2025-11-11 00:47:43,797 - thread-133013323122368.prometheus.lang_graph.nodes.get_pass_regression_test_patch_subgraph_node - INFO - Enter get_pass_regression_test_patch_subgraph_node
2025-11-11 00:47:43,797 - thread-133013323122368.prometheus.lang_graph.nodes.get_pass_regression_test_patch_subgraph_node - DEBUG - selected_regression_tests: ['test/runtime/samples/set-in-oncreate', 'test/runtime/samples/onrender-fires-when-ready', 'test/runtime/samples/onrender-fires-when-ready-nested', 'test/runtime/samples/bindings-before-oncreate', 'test/runtime/samples/lifecycle-events']
2025-11-11 00:47:43,800 - thread-133013323122368.prometheus.lang_graph.nodes.get_pass_regression_test_patch_update_node - INFO - Applying patch: diff --git a/src/generators/Generator.ts b/src/generators/Generator.ts
index 5b7ec8f07..b449367a7 100644
--- a/src/generators/Generator.ts
+++ b/src/generators/Generator.ts
@@ -510,6 +510,7 @@ export default class Generator {
 
 				const addArrowFunctionExpression = (name: string, node: Node) => {
 					const { body, params } = node;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
 
 					const paramString = params.length ?
 						`[✂${params[0].start}-${params[params.length - 1].end}✂]` :
@@ -517,11 +518,11 @@ export default class Generator {
 
 					if (body.type === 'BlockStatement') {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
+							${asyncKeyword}function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
 						`);
 					} else {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) {
+							${asyncKeyword}function ${name}(${paramString}) {
 								return [✂${body.start}-${body.end}✂];
 							}
 						`);
@@ -531,8 +532,10 @@ export default class Generator {
 				const addFunctionExpression = (name: string, node: Node) => {
 					let c = node.start;
 					while (this.source[c] !== '(') c += 1;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
+					const generatorMark = (node as any).generator ? '*' : '';
 					componentDefinition.addBlock(deindent`
-						function ${name}[✂${c}-${node.end}✂];
+						${asyncKeyword}function${generatorMark} ${name}[✂${c}-${node.end}✂];
 					`);
 				};
 

2025-11-11 00:47:43,831 - thread-133013323122368.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-11 00:47:43,865 - thread-133013323122368.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-11 00:47:43,865 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-11 00:47:43,966 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:47:43,967 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 1dad8f193 add test for #891
[?2004l
2025-11-11 00:47:43,967 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-11 00:47:44,068 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:47:44,068 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing test/js-async/
[?2004l
2025-11-11 00:47:44,069 - thread-133013323122368.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-11 00:47:44,069 - thread-133013323122368.prometheus.docker.base_container - INFO - Creating directory src/generators in the container
2025-11-11 00:47:44,069 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p src/generators
2025-11-11 00:47:44,171 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:47:44,171 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-11 00:47:44,171 - thread-133013323122368.prometheus.docker.base_container - INFO - Updating src/generators/Generator.ts in the container
2025-11-11 00:47:44,180 - thread-133013323122368.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-11 00:47:44,181 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - INFO - Enter run_regression_tests_subgraph_node
2025-11-11 00:47:44,182 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - DEBUG - selected_regression_tests: ['test/runtime/samples/set-in-oncreate', 'test/runtime/samples/onrender-fires-when-ready', 'test/runtime/samples/onrender-fires-when-ready-nested', 'test/runtime/samples/bindings-before-oncreate', 'test/runtime/samples/lifecycle-events']
2025-11-11 00:47:48,564 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZFmJl3CcbYrHeV2WEuTZh9Te', 'function': {'arguments': '{"command":"ls -la"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 218, 'prompt_tokens': 598, 'total_tokens': 816, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--61619c23-4471-4f7a-aea8-a10aaa716383-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la'}, 'id': 'call_ZFmJl3CcbYrHeV2WEuTZh9Te', 'type': 'tool_call'}] usage_metadata={'input_tokens': 598, 'output_tokens': 218, 'total_tokens': 816, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-11 00:47:48,568 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ls -la
2025-11-11 00:47:48,669 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:47:48,670 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 744
drwxr-xr-x 1 root root   4096 Nov 11 00:46 [0m[01;34m.[0m
drwxr-xr-x 1 root root   4096 Nov 11 00:47 [01;34m..[0m
-rw-r--r-- 1 root root    227 Nov 11 00:35 .editorconfig
-rw-r--r-- 1 root root     76 Nov 11 00:35 .eslintignore
-rw-r--r-- 1 root root   1239 Nov 11 00:35 .eslintrc.json
-rw-r--r-- 1 root root     78 Nov 11 00:35 .flowconfig
drwxrwxr-x 1 root root   4096 Nov 11 00:47 [01;34m.git[0m
drwxrwxr-x 1 root root   4096 Nov 11 00:35 [01;34m.github[0m
-rw-r--r-- 1 root root    263 Nov 11 00:35 .gitignore
-rw-r--r-- 1 root root     51 Nov 11 00:35 .prettierrc
-rw-r--r-- 1 root root    270 Nov 11 00:35 .travis.yml
-rw-r--r-- 1 root root  37604 Nov 11 00:35 CHANGELOG.md
-rw-r--r-- 1 root root   1114 Nov 11 00:35 LICENSE
-rw-r--r-- 1 root root   6462 Nov 11 00:35 README.md
-rw-r--r-- 1 root root    556 Nov 11 00:35 appveyor.yml
drwxr-xr-x 2 root root   4096 Nov 11 00:27 [01;34mcompiler[0m
-rw-r--r-- 1 root root     70 Nov 11 00:35 mocha.coverage.opts
-rw-r--r-- 1 root root     12 Nov 11 00:35 mocha.opts
drwxr-xr-x 1 root root   4096 Nov 11 00:36 [01;34mnode_modules[0m
-rw-r--r-- 1 root root 471421 Nov 11 00:36 package-lock.json
-rw-r--r-- 1 root root   2295 Nov 11 00:46 package.json
-rw-r--r-- 1 root root   1668 Nov 11 00:35 rollup.config.js
-rw-r--r-- 1 root root  13810 Nov 11 00:46 shared.js
drwxrwxr-x 1 root root   4096 Nov 11 00:35 [01;34msrc[0m
drwxr-xr-x 2 root root   4096 Nov 11 00:27 [01;34mssr[0m
drwxrwxr-x 1 root root   4096 Nov 11 00:47 [01;34mtest[0m
-rw-r--r-- 1 root root    326 Nov 11 00:35 tsconfig.json
-rw-r--r-- 1 root root 109393 Nov 11 00:46 yarn.lock
[?2004l
2025-11-11 00:47:51,465 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ybDSsQ8gYiDx7EvcSmtBolhU', 'function': {'arguments': '{"command":"ls -la test/runtime/samples"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 94, 'prompt_tokens': 1421, 'total_tokens': 1515, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--eac0bc02-a06f-4b9a-b47a-e1403165f3ed-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test/runtime/samples'}, 'id': 'call_ybDSsQ8gYiDx7EvcSmtBolhU', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1421, 'output_tokens': 94, 'total_tokens': 1515, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-11 00:47:51,468 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/runtime/samples
2025-11-11 00:47:51,571 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:47:51,571 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 1140
drwxrwxr-x 1 root root 16384 Aug 28 02:25 [0m[01;34m.[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34m..[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-dynamic[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-dynamic-multiple[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-dynamic-reserved[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-dynamic-shorthand[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-dynamic-type[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-empty[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-empty-svg[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-namespaced[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-partial-number[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-prefer-expression[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-static[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-static-at-symbol[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-static-boolean[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mattribute-static-quotemarks[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mautofocus[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-audio-currenttime-duration[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-indirect[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-checkbox[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-checkbox-deep-contextual[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-checkbox-group[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-checkbox-group-outside-each[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-number[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-radio-group[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-range[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-range-change[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-text[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-text-contextual[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-text-deconflicted[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-text-deep[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-text-deep-computed[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-text-deep-computed-dynamic[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-text-deep-contextual[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-text-deep-contextual-computed-dynamic[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-input-with-event[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-select[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-select-in-each-block[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-select-in-yield[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-select-initial-value[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-select-initial-value-undefined[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-select-late[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-select-multiple[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbinding-textarea[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbindings-before-oncreate[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mbindings-coalesced[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-blowback[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-blowback-b[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-blowback-c[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-computed[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-conditional[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-conditional-b[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-deep[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-deep-b[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-each[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-each-nested[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-each-object[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-infinite-loop[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-nested[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-binding-parent-supercedes-child[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-data-dynamic[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-data-dynamic-late[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-data-dynamic-shorthand[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-data-empty[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-data-static[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-data-static-boolean[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-events[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-events-data[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-events-each[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-if-placement[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-nested-deep[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-nested-deeper[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-not-void[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-ref[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-slot-default[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-slot-fallback[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-slot-if-block[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-slot-if-block-before-node[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-slot-if-else-block-before-node[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-slot-named[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-slot-nested[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-slot-nested-component[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-static-at-symbol[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-yield[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-yield-follows-element[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-yield-if[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-yield-multiple-in-each[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-yield-multiple-in-if[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-yield-nested-if[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-yield-parent[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-yield-placement[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomponent-yield-static[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomputed-empty[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomputed-function[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomputed-values[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomputed-values-default[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcomputed-values-function-dependency[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcss[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcss-comments[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcss-false[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcss-space-in-attribute[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mcustom-method[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdeconflict-builtins[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdeconflict-contexts[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdeconflict-non-helpers[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdeconflict-self[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdeconflict-template-1[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdeconflict-template-2[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdeconflict-vars[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdefault-data[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdefault-data-function[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdefault-data-override[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdestroy-twice[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdestructuring[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdev-warning-bad-observe-arguments[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdev-warning-destroy-not-teardown[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdev-warning-destroy-twice[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdev-warning-helper[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdev-warning-missing-data[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdev-warning-missing-data-binding[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdev-warning-readonly-computed[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mdev-warning-readonly-window-binding[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-containing-component-in-if[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-containing-if[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-destructured-array[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-dynamic-else-static[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-else[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-else-starts-empty[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-indexed[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-keyed[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-keyed-dynamic[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-keyed-random-permute[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-keyed-unshift[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-random-permute[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-static[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-block-text-node[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-blocks-expression[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-blocks-nested[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34meach-blocks-nested-b[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34melement-invalid-name[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mempty-style-block[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mescape-template-literals[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mescaped-text[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-console-log[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-custom[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-custom-context[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-custom-each[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-custom-node-context[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-destroy[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-each[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-each-deconflicted[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-event-methods[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-hoisted[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-removal[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-sanitize[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-shorthand[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-shorthand-component[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevent-handler-this-methods[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevents-custom[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mevents-lifecycle[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mflush-before-bindings[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mfunction-in-expression[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mget-state[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mglobals-accessible-directly[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mglobals-not-dereferenced[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mglobals-shadowed-by-data[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mglobals-shadowed-by-helpers[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mhello-world[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mhelpers[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mhelpers-not-call-expression[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mhtml-entities[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mif-block[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mif-block-else[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mif-block-elseif[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mif-block-elseif-text[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mif-block-expression[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mif-block-or[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mif-block-widget[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mignore-unchanged-attribute[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mignore-unchanged-attribute-compound[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mignore-unchanged-raw[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mignore-unchanged-tag[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mimported-renamed-components[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34minline-expressions[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34minput-list[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mlifecycle-events[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mnames-deconflicted[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mnames-deconflicted-nested[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mnbsp[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mobserve-binding-ignores-unchanged[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mobserve-component-ignores-irrelevant-changes[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mobserve-deferred[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mobserve-prevents-loop[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mondestroy-before-cleanup[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34monrender-chain[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34monrender-fires-when-ready[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34monrender-fires-when-ready-nested[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34moptions[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mparen-wrapped-expressions[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mraw-anchor-first-child[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mraw-anchor-first-last-child[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mraw-anchor-last-child[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mraw-anchor-next-previous-sibling[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mraw-anchor-next-sibling[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mraw-anchor-previous-sibling[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mraw-mustaches[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mraw-mustaches-preserved[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mrefs[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mrefs-unset[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mselect[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mselect-bind-array[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mselect-bind-in-array[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mselect-change-handler[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mselect-no-whitespace[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mselect-one-way-bind[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mselect-one-way-bind-object[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mselect-props[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mself-reference[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mself-reference-tree[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mset-after-destroy[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mset-clones-input[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mset-in-observe[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mset-in-observe-dedupes-renders[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mset-in-oncreate[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mset-in-ondestroy[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mset-mutated-data[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mset-prevents-loop[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msetup[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msigil-static-#[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msigil-static-@[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msingle-static-element[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msingle-text-node[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mslot-in-custom-element[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mstate-deconflicted[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg-attributes[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg-child-component-declared-namespace[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg-child-component-declared-namespace-shorthand[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg-class[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg-each-block-anchor[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg-each-block-namespace[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg-multiple[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg-no-whitespace[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg-xlink[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34msvg-xmlns[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtextarea-children[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtextarea-value[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-css-delay[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-delay[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-delay-in-out[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-dynamic-if-block-bidi[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-each-block-intro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-each-block-intro-outro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-each-block-keyed-intro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-each-block-keyed-intro-outro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-each-block-keyed-outro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-each-block-outro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-events[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-if-block-bidi[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-if-block-in-each-block-bidi[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-if-block-in-each-block-bidi-2[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-if-block-in-each-block-bidi-3[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-if-block-intro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-if-block-intro-outro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-if-else-block-dynamic-outro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-if-else-block-intro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-if-else-block-outro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-if-elseif-block-outro[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mtransition-js-initial[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mwhitespace-each-block[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mwhitespace-normal[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mwindow-bind-scroll-update[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mwindow-binding-resize[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mwindow-event[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [01;34mwindow-event-context[0m
[?2004l
2025-11-11 00:47:53,177 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_UUf70I0Hz4cGySfZvCXtJtaN', 'function': {'arguments': '{"command":"cat package.json"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 11952, 'total_tokens': 11978, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2c835696-ad8c-4f9c-b8fb-97f79f91b5c0-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat package.json'}, 'id': 'call_UUf70I0Hz4cGySfZvCXtJtaN', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11952, 'output_tokens': 26, 'total_tokens': 11978, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:47:53,180 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: cat package.json
2025-11-11 00:47:53,282 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:47:53,282 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
{
  "name": "svelte",
  "version": "1.41.1",
  "description": "The magical disappearing UI framework",
  "main": "compiler/svelte.js",
  "files": [
    "compiler",
    "ssr",
    "shared.js",
    "README.md"
  ],
  "scripts": {
    "test": "mocha --opts mocha.opts",
    "quicktest": "mocha --opts mocha.opts",
    "precoverage": "export COVERAGE=true && nyc mocha --opts mocha.coverage.opts",
    "coverage": "nyc report --reporter=text-lcov > coverage.lcov",
    "codecov": "codecov",
    "precodecov": "npm run coverage",
    "lint": "eslint src test/*.js",
    "build": "node src/shared/_build.js && rollup -c",
    "dev": "node src/shared/_build.js && rollup -c -w",
    "pretest": "npm run build",
    "prepublishOnly": "npm run lint && npm test",
    "prettier": "prettier --write \"src/**/*.ts\""
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/sveltejs/svelte.git"
  },
  "keywords": [
    "UI",
    "framework",
    "templates",
    "templating"
  ],
  "author": "Rich Harris",
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/sveltejs/svelte/issues"
  },
  "homepage": "https://github.com/sveltejs/svelte#README",
  "devDependencies": {
    "@types/mocha": "^2.2.41",
    "@types/node": "^8.0.17",
    "acorn": "^5.1.1",
    "chalk": "^2.0.1",
    "codecov": "^2.2.0",
    "console-group": "^0.3.2",
    "css-tree": "1.0.0-alpha22",
    "eslint": "^4.3.0",
    "eslint-plugin-html": "^3.0.0",
    "eslint-plugin-import": "^2.2.0",
    "estree-walker": "^0.5.0",
    "glob": "^7.1.1",
    "jsdom": "^11.1.0",
    "locate-character": "^2.0.0",
    "magic-string": "^0.22.3",
    "mocha": "^3.2.0",
    "nightmare": "^2.10.0",
    "node-resolve": "^1.3.3",
    "nyc": "^11.1.0",
    "prettier": "^1.7.0",
    "rollup": "^0.48.2",
    "rollup-plugin-buble": "^0.15.0",
    "rollup-plugin-commonjs": "^8.0.2",
    "rollup-plugin-json": "^2.1.0",
    "rollup-plugin-node-resolve": "^3.0.0",
    "rollup-plugin-typescript": "^0.8.1",
    "rollup-plugin-virtual": "^1.0.1",
    "rollup-watch": "^4.3.1",
    "source-map": "^0.5.6",
    "source-map-support": "^0.4.8",
    "typescript": "^2.3.2"
  },
  "nyc": {
    "include": [
      "src/**/*.js",
      "shared.js"
    ],
    "exclude": [
      "src/**/__test__.js",
      "src/shared/**"
    ]
  }
}
[?2004l
2025-11-11 00:47:56,966 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4k3HN4Bg3JzrlamoykE07XFk', 'function': {'arguments': '{"command":"ls -la test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 219, 'prompt_tokens': 12807, 'total_tokens': 13026, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bfd6b523-8c56-4153-aaf1-6bc125efb9eb-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test'}, 'id': 'call_4k3HN4Bg3JzrlamoykE07XFk', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12807, 'output_tokens': 219, 'total_tokens': 13026, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-11 00:47:56,969 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ls -la test
2025-11-11 00:47:57,071 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:47:57,071 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 112
drwxrwxr-x 1 root root 4096 Nov 11 00:47 [0m[01;34m.[0m
drwxr-xr-x 1 root root 4096 Nov 11 00:46 [01;34m..[0m
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34mcreate[0m
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34mcss[0m
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34mcustom-elements[0m
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34mformats[0m
-rw-r--r-- 1 root root 5474 Nov 11 00:35 helpers.js
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34mhydration[0m
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34mjs[0m
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34mparser[0m
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34mruntime[0m
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34mserver-side-rendering[0m
-rw-r--r-- 1 root root 1077 Nov 11 00:35 setup.js
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34msourcemaps[0m
-rw-r--r-- 1 root root  247 Nov 11 00:35 test.js
drwxrwxr-x 1 root root 4096 Nov 11 00:35 [01;34mvalidator[0m
[?2004l
2025-11-11 00:47:59,933 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_MndN9DIzavAVMmfI9rU2OdsA', 'function': {'arguments': '{"command":"ls -la test/runtime"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 92, 'prompt_tokens': 13363, 'total_tokens': 13455, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--67ac12dd-96c1-424d-84a3-96eff7319bf7-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test/runtime'}, 'id': 'call_MndN9DIzavAVMmfI9rU2OdsA', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13363, 'output_tokens': 92, 'total_tokens': 13455, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-11 00:47:59,936 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/runtime
2025-11-11 00:48:00,037 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:48:00,037 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 44
drwxrwxr-x 1 root root  4096 Nov 11 00:35 [0m[01;34m.[0m
drwxrwxr-x 1 root root  4096 Nov 11 00:47 [01;34m..[0m
-rw-r--r-- 1 root root  6066 Nov 11 00:35 index.js
drwxrwxr-x 1 root root 16384 Aug 28 02:25 [01;34msamples[0m
[?2004l
2025-11-11 00:48:01,686 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1Jg5DxtcHaud8ulxffpb87Ic', 'function': {'arguments': '{"command":"cat mocha.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 13541, 'total_tokens': 13567, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 13312}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--722e6aae-3b49-47e6-ae9a-a13ef9455046-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat mocha.opts'}, 'id': 'call_1Jg5DxtcHaud8ulxffpb87Ic', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13541, 'output_tokens': 26, 'total_tokens': 13567, 'input_token_details': {'audio': 0, 'cache_read': 13312}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:48:01,689 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: cat mocha.opts
2025-11-11 00:48:01,791 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:48:01,791 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-11 00:48:05,623 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_jxAfeDZjGzyz2qJpk4i4NBEr', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/runtime/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 292, 'prompt_tokens': 13584, 'total_tokens': 13876, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--eb9f945c-fff8-46fd-84d8-de6b99a5d932-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/runtime/index.js"}, 'id': 'call_jxAfeDZjGzyz2qJpk4i4NBEr', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13584, 'output_tokens': 292, 'total_tokens': 13876, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-11 00:48:05,627 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/runtime/index.js
2025-11-11 00:48:05,728 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:48:05,729 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import assert from "assert";
import * as path from "path";
import * as fs from "fs";
import * as acorn from "acorn";
import { transitionManager } from "../../shared.js";

import {
	showOutput,
	loadConfig,
	loadSvelte,
	env,
	setupHtmlEqual,
	spaces
} from "../helpers.js";

let svelte;

let compileOptions = null;

function getName(filename) {
	const base = path.basename(filename).replace(".html", "");
	return base[0].toUpperCase() + base.slice(1);
}

describe("runtime", () => {
	before(() => {
		svelte = loadSvelte(true);

		require.extensions[".html"] = function(module, filename) {
			const options = Object.assign(
				{ filename, name: getName(filename), format: 'cjs' },
				compileOptions
			);

			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);

			return module._compile(code, filename);
		};

		return setupHtmlEqual();
	});

	const failed = new Set();

	function runTest(dir, shared, hydrate) {
		if (dir[0] === ".") return;

		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);

		if (config.solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
			if (failed.has(dir)) {
				// this makes debugging easier, by only printing compiled output once
				throw new Error('skipping test, already failed');
			}

			const cwd = path.resolve(`test/runtime/samples/${dir}`);

			compileOptions = config.compileOptions || {};
			compileOptions.shared = shared;
			compileOptions.hydratable = hydrate;
			compileOptions.dev = config.dev;

			// check that no ES2015+ syntax slipped in
			if (!config.allowES2015) {
				try {
					const source = fs.readFileSync(
						`test/runtime/samples/${dir}/main.html`,
						"utf-8"
					);
					const { code } = svelte.compile(source, compileOptions);
					const startIndex = code.indexOf("function create_main_fragment"); // may change!
					if (startIndex === -1) throw new Error("missing create_main_fragment");
					const endIndex = code.lastIndexOf("export default");
					const es5 =
						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
						code.slice(startIndex, endIndex);

					acorn.parse(es5, { ecmaVersion: 5 });

					if (/Object\.assign/.test(es5)) {
						throw new Error(
							"cannot use Object.assign in generated code, as it is not supported everywhere"
						);
					}
				} catch (err) {
					failed.add(dir);
					showOutput(cwd, { shared }, svelte); // eslint-disable-line no-console
					throw err;
				}
			}

			Object.keys(require.cache)
				.filter(x => x.endsWith(".html"))
				.forEach(file => {
					delete require.cache[file];
				});

			let SvelteComponent;

			let unintendedError = null;

			const window = env();

			try {
				// set of hacks to support transition tests
				transitionManager.running = false;
				transitionManager.transitions = [];

				const raf = {
					time: 0,
					callback: null,
					tick: now => {
						raf.time = now;
						if (raf.callback) raf.callback();
					}
				};
				window.performance = { now: () => raf.time };
				global.requestAnimationFrame = cb => {
					let called = false;
					raf.callback = () => {
						if (!called) {
							called = true;
							cb();
						}
					};
				};

				global.window = window;

				try {
					SvelteComponent = require(`./samples/${dir}/main.html`);
				} catch (err) {
					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
					throw err;
				}

				global.window = window;

				// Put the constructor on window for testing
				window.SvelteComponent = SvelteComponent;

				const target = window.document.querySelector("main");

				const warnings = [];
				const warn = console.warn;
				console.warn = warning => {
					warnings.push(warning);
				};

				const options = Object.assign({}, {
					target,
					hydrate,
					data: config.data
				}, config.options || {});

				const component = new SvelteComponent(options);

				console.warn = warn;

				if (config.error) {
					unintendedError = true;
					throw new Error("Expected a runtime error");
				}

				if (config.warnings) {
					assert.deepEqual(warnings, config.warnings);
				} else if (warnings.length) {
					unintendedError = true;
					throw new Error("Received unexpected warnings");
				}

				if (config.html) {
					assert.htmlEqual(target.innerHTML, config.html);
				}

				if (config.test) {
					config.test(assert, component, target, window, raf);
				} else {
					component.destroy();
					assert.equal(target.innerHTML, "");
				}
			} catch (err) {
				if (config.error && !unintendedError) {
					config.error(assert, err);
				} else {
					failed.add(dir);
					showOutput(cwd, { shared, hydratable: hydrate }, svelte); // eslint-disable-line no-console
					throw err;
				}
			}

			if (config.show) showOutput(cwd, { shared, hydratable: hydrate }, svelte);
		});
	}

	const shared = path.resolve("shared.js");
[?2004l
2025-11-11 00:48:07,335 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ozlbyzUIq7ImZhoBkAVfyjgE', 'function': {'arguments': '{"command":"sed -n \'200,500p\' test/runtime/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 14934, 'total_tokens': 14964, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--20622627-ea3e-44e8-8348-ec894afa4cc9-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '200,500p' test/runtime/index.js"}, 'id': 'call_ozlbyzUIq7ImZhoBkAVfyjgE', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14934, 'output_tokens': 30, 'total_tokens': 14964, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:48:07,338 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '200,500p' test/runtime/index.js
2025-11-11 00:48:07,440 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:48:07,440 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
	const shared = path.resolve("shared.js");
	fs.readdirSync("test/runtime/samples").forEach(dir => {
		runTest(dir, shared, false);
		runTest(dir, shared, true);
		runTest(dir, null, false);
	});

	it("fails if options.target is missing in dev mode", () => {
		const { code } = svelte.compile(`<div></div>`, {
			format: "iife",
			name: "SvelteComponent",
			dev: true
		});

		const SvelteComponent = eval(
			`(function () { ${code}; return SvelteComponent; }())`
		);

		assert.throws(() => {
			new SvelteComponent();
		}, /'target' is a required option/);
	});

	it("fails if options.hydrate is true but the component is non-hydratable", () => {
		const { code } = svelte.compile(`<div></div>`, {
			format: "iife",
			name: "SvelteComponent",
			dev: true
		});

		const SvelteComponent = eval(
			`(function () { ${code}; return SvelteComponent; }())`
		);

		assert.throws(() => {
			new SvelteComponent({
				target: {},
				hydrate: true
			});
		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
	});
});
[?2004l
2025-11-11 00:48:13,632 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Xhd5VFnXfvM6E0TdbwzkORXM', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/helpers.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 419, 'prompt_tokens': 15299, 'total_tokens': 15718, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--dd947f93-41b5-46d4-bed2-40da55537524-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/helpers.js"}, 'id': 'call_Xhd5VFnXfvM6E0TdbwzkORXM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15299, 'output_tokens': 419, 'total_tokens': 15718, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-11 00:48:13,635 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/helpers.js
2025-11-11 00:48:13,737 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:48:13,737 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import { JSDOM } from 'jsdom';
import assert from 'assert';
import glob from 'glob';
import fs from 'fs';
import path from 'path';
import chalk from 'chalk';

// for coverage purposes, we need to test source files,
// but for sanity purposes, we need to test dist files
export function loadSvelte(test) {
	if (test) global.__svelte_test = true;

	const resolved = process.env.COVERAGE
		? require.resolve('../src/index.js')
		: require.resolve('../compiler/svelte.js');

	delete require.cache[resolved];
	return require(resolved);
}

export const svelte = loadSvelte();

export function exists(path) {
	try {
		fs.statSync(path);
		return true;
	} catch (err) {
		return false;
	}
}

export function tryToLoadJson(file) {
	try {
		return JSON.parse(fs.readFileSync(file));
	} catch (err) {
		if (err.code !== 'ENOENT') throw err;
		return null;
	}
}

export function tryToReadFile(file) {
	try {
		return fs.readFileSync(file, 'utf-8');
	} catch (err) {
		if (err.code !== 'ENOENT') throw err;
		return null;
	}
}

const { window } = new JSDOM('<main></main>');
global.document = window.document;

export function env() {
	window._svelteTransitionManager = null;
	window.document.body.innerHTML = '<main></main>';

	return window;
}

function cleanChildren(node) {
	let previous = null;

	// sort attributes
	const attributes = Array.from(node.attributes).sort((a, b) => {
		return a.name < b.name ? -1 : 1;
	});

	attributes.forEach(attr => {
		node.removeAttribute(attr.name);
	});

	attributes.forEach(attr => {
		node.setAttribute(attr.name, attr.value);
	});

	// recurse
	[...node.childNodes].forEach(child => {
		if (child.nodeType === 3) {
			// text
			if (
				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
				node.tagName !== 'text' &&
				node.tagName !== 'tspan'
			) {
				node.removeChild(child);
			}

			child.data = child.data.replace(/\s{2,}/g, '\n');

			if (previous && previous.nodeType === 3) {
				previous.data += child.data;
				previous.data = previous.data.replace(/\s{2,}/g, '\n');

				node.removeChild(child);
				child = previous;
			}
		} else {
			cleanChildren(child);
		}

		previous = child;
	});

	// collapse whitespace
	if (node.firstChild && node.firstChild.nodeType === 3) {
		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
		if (!node.firstChild.data) node.removeChild(node.firstChild);
	}

	if (node.lastChild && node.lastChild.nodeType === 3) {
		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
		if (!node.lastChild.data) node.removeChild(node.lastChild);
	}
}

export function normalizeHtml(window, html) {
	try {
		const node = window.document.createElement('div');
		node.innerHTML = html
			.replace(/<!--.*?-->/g, '')
			.replace(/>[\s\r\n]+</g, '><')
			.trim();
		cleanChildren(node, '');
		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
	} catch (err) {
		throw new Error(`Failed to normalize HTML:\n${html}`);
	}
}

export function setupHtmlEqual() {
	const window = env();

	assert.htmlEqual = (actual, expected, message) => {
		assert.deepEqual(
			normalizeHtml(window, actual),
			normalizeHtml(window, expected),
			message
		);
	};
}

export function loadConfig(file) {
	try {
		const resolved = require.resolve(file);
		delete require.cache[resolved];

		const config = require(resolved);
		return config.default || config;
	} catch (err) {
		if (err.code === 'MODULE_NOT_FOUND') {
			return {};
		}

		throw err;
	}
}

export function addLineNumbers(code) {
	return code
		.split('\n')
		.map((line, i) => {
			i = String(i + 1);
			while (i.length < 3) i = ` ${i}`;

			return (
				chalk.grey(`  ${i}: `) +
				line.replace(/^\t+/, match => match.split('\t').join('    '))
			);
		})
		.join('\n');
}

function capitalise(str) {
	return str[0].toUpperCase() + str.slice(1);
}

export function showOutput(cwd, options = {}, s = svelte) {
	glob.sync('**/*.html', { cwd }).forEach(file => {
		if (file[0] === '_') return;
		const { code } = s.compile(
			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
			Object.assign(options, {
				filename: file,
				name: capitalise(path.basename(file).replace(/\.html$/, ''))
			})
		);

		console.log( // eslint-disable-line no-console
			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
		);
	});
}

const start = /\n(\t+)/;
export function deindent(strings, ...values) {
	const indentation = start.exec(strings[0])[1];
	const pattern = new RegExp(`^${indentation}`, 'gm');

	let result = strings[0].replace(start, '').replace(pattern, '');

[?2004l
2025-11-11 00:48:15,279 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3r44EGFz5nlKFN00aBHdtDEp', 'function': {'arguments': '{"command":"sed -n \'200,400p\' test/helpers.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 16596, 'total_tokens': 16625, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--99e9f206-852c-43e4-909a-d6193df80bd2-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '200,400p' test/helpers.js"}, 'id': 'call_3r44EGFz5nlKFN00aBHdtDEp', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16596, 'output_tokens': 29, 'total_tokens': 16625, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-11 00:48:15,283 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '200,400p' test/helpers.js
2025-11-11 00:48:15,384 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:48:15,385 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l

	let trailingIndentation = getTrailingIndentation(result);

	for (let i = 1; i < strings.length; i += 1) {
		let expression = values[i - 1];
		const string = strings[i].replace(pattern, '');

		if (Array.isArray(expression)) {
			expression = expression.length ? expression.join('\n') : null;
		}

		if (expression || expression === '') {
			const value = String(expression).replace(
				/\n/g,
				`\n${trailingIndentation}`
			);
			result += value + string;
		} else {
			let c = result.length;
			while (/\s/.test(result[c - 1])) c -= 1;
			result = result.slice(0, c) + string;
		}

		trailingIndentation = getTrailingIndentation(result);
	}

	return result.trim().replace(/\t+$/gm, '');
}

function getTrailingIndentation(str) {
	let i = str.length;
	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
	return str.slice(i, str.length);
}

export function spaces(i) {
	let result = '';
	while (i--) result += ' ';
	return result;
}
[?2004l
2025-11-11 00:48:20,460 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_gufvJbXrheRR3ZMvvzymY7iO', 'function': {'arguments': '{"command":"sed -n \'1,120p\' compiler/svelte.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 484, 'prompt_tokens': 16915, 'total_tokens': 17399, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6ea06e87-a793-46d7-93bc-72bee7170fa3-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,120p' compiler/svelte.js"}, 'id': 'call_gufvJbXrheRR3ZMvvzymY7iO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16915, 'output_tokens': 484, 'total_tokens': 17399, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-11 00:48:20,464 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,120p' compiler/svelte.js
2025-11-11 00:48:20,566 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:48:20,566 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :
	typeof define === 'function' && define.amd ? define(['exports'], factory) :
	(factory((global.svelte = {})));
}(this, (function (exports) { 'use strict';

// Reserved word lists for various dialects of the language

var reservedWords = {
  3: "abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",
  5: "class enum extends super const export import",
  6: "enum",
  strict: "implements interface let package private protected public static yield",
  strictBind: "eval arguments"
};

// And the keywords

var ecma5AndLessKeywords = "break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this";

var keywords = {
  5: ecma5AndLessKeywords,
  6: ecma5AndLessKeywords + " const class extends export import super"
};

// ## Character categories

// Big ugly regular expressions that match characters in the
// whitespace, identifier, and identifier-start categories. These
// are only applied when a character is found to actually have a
// code point above 128.
// Generated by `bin/generate-identifier-regex.js`.

var nonASCIIidentifierStartChars = "\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0-\u08b4\u08b6-\u08bd\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0af9\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58-\u0c5a\u0c60\u0c61\u0c80\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d54-\u0d56\u0d5f-\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f5\u13f8-\u13fd\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1c80-\u1c88\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2118-\u211d\u2124\u2126\u2128\u212a-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309b-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fd5\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua7ae\ua7b0-\ua7b7\ua7f7-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua8fd\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab65\uab70-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc";
var nonASCIIidentifierChars = "\u200c\u200d\xb7\u0300-\u036f\u0387\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08d4-\u08e1\u08e3-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c00-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c81-\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d01-\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0de6-\u0def\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19d0-\u19da\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1ab0-\u1abd\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1cf8\u1cf9\u1dc0-\u1df5\u1dfb-\u1dff\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69e\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c5\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\ua9e5\ua9f0-\ua9f9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b-\uaa7d\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe2f\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f";

var nonASCIIidentifierStart = new RegExp("[" + nonASCIIidentifierStartChars + "]");
var nonASCIIidentifier = new RegExp("[" + nonASCIIidentifierStartChars + nonASCIIidentifierChars + "]");

nonASCIIidentifierStartChars = nonASCIIidentifierChars = null;

// These are a run-length and offset encoded representation of the
// >0xffff code points that are a valid part of identifiers. The
// offset starts at 0x10000, and each pair of numbers represents an
// offset to the next range, and then a size of the range. They were
// generated by bin/generate-identifier-regex.js

// eslint-disable-next-line comma-spacing
var astralIdentifierStartCodes = [0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,17,26,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,26,45,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,785,52,76,44,33,24,27,35,42,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,25,391,63,32,0,449,56,264,8,2,36,18,0,50,29,881,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,881,68,12,0,67,12,65,0,32,6124,20,754,9486,1,3071,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,10591,541];

// eslint-disable-next-line comma-spacing
var astralIdentifierCodes = [509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,1306,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,52,0,13,2,49,13,10,2,4,9,83,11,7,0,161,11,6,9,7,3,57,0,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,87,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,423,9,838,7,2,7,17,9,57,21,2,13,19882,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239];

// This has a complexity linear to the value of the code. The
// assumption is that looking up astral identifier characters is
// rare.
function isInAstralSet(code, set) {
  var pos = 0x10000;
  for (var i = 0; i < set.length; i += 2) {
    pos += set[i];
    if (pos > code) { return false }
    pos += set[i + 1];
    if (pos >= code) { return true }
  }
}

// Test whether a given character code starts an identifier.

function isIdentifierStart(code, astral) {
  if (code < 65) { return code === 36 }
  if (code < 91) { return true }
  if (code < 97) { return code === 95 }
  if (code < 123) { return true }
  if (code <= 0xffff) { return code >= 0xaa && nonASCIIidentifierStart.test(String.fromCharCode(code)) }
  if (astral === false) { return false }
  return isInAstralSet(code, astralIdentifierStartCodes)
}

// Test whether a given character is part of an identifier.

function isIdentifierChar(code, astral) {
  if (code < 48) { return code === 36 }
  if (code < 58) { return true }
  if (code < 65) { return false }
  if (code < 91) { return true }
  if (code < 97) { return code === 95 }
  if (code < 123) { return true }
  if (code <= 0xffff) { return code >= 0xaa && nonASCIIidentifier.test(String.fromCharCode(code)) }
  if (astral === false) { return false }
  return isInAstralSet(code, astralIdentifierStartCodes) || isInAstralSet(code, astralIdentifierCodes)
}

// ## Token types

// The assignment of fine-grained, information-carrying type objects
// allows the tokenizer to store the information it has about a
// token in a way that is very cheap for the parser to look up.

// All token type variables start with an underscore, to make them
// easy to recognize.

// The `beforeExpr` property is used to disambiguate between regular
// expressions and divisions. It is set on all token types that can
// be followed by an expression (thus, a slash after them would be a
// regular expression).
//
// The `startsExpr` property is used to check if the token ends a
// `yield` expression. It is set on all token types that either can
// directly start an expression (like a quotation mark) or can
// continue an expression (like the body of a string).
//
// `isLoop` marks a keyword as starting a loop, which is important
// to know when parsing a label, in order to allow or disallow
// continue jumps to that label.

var TokenType = function TokenType(label, conf) {
  if ( conf === void 0 ) conf = {};

  this.label = label;
  this.keyword = conf.keyword;
[?2004l
2025-11-11 00:48:30,614 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_D5e40vIvfkNkdmQfvizYnd03', 'function': {'arguments': '{"command":"npm ci"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 985, 'prompt_tokens': 23549, 'total_tokens': 24534, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 14848}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--18766ab8-a73b-4a86-ab7b-a428d631aa23-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm ci'}, 'id': 'call_D5e40vIvfkNkdmQfvizYnd03', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23549, 'output_tokens': 985, 'total_tokens': 24534, 'input_token_details': {'audio': 0, 'cache_read': 14848}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-11 00:48:30,617 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: npm ci
2025-11-11 00:48:40,248 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:48:40,248 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?25l[[100;90m..................[0m] - idealTree: [7msill[0m [35mlogfile[0m done cleaning log files[0m[K

[K[?25h[?25l[[107;97m#########[0m[100;90m.........[0m] - reify: [32;40mtiming[0m [35mnpm-ci:rm[0m Completed in 573ms[0m[K
[[107;97m#########[0m[100;90m.........[0m] - reify: [32;40mtiming[0m [35mnpm-ci:rm[0m Completed in 573ms[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##############[0m[100;90m....[0m] | reify:fsevents: [7msill[0m [35mreify[0m mark deleted [ '/testbed/node[0m[K
[[107;97m##################[0m] \ reify:nyc: [32;40mtiming[0m [35mreifyNode:node_modules/fsevents[0m Comple[0m[K
[[107;97m##################[0m] \ reify:nyc: [32;40mtiming[0m [35mreifyNode:node_modules/fsevents[0m Comple[0m[K
[[107;97m##################[0m] - reify:@types/mocha: [7msill[0m [35maudit[0m bulk request {[0m[K
[[107;97m##################[0m] - reify:@types/mocha: [7msill[0m [35maudit[0m bulk request {[0m[K
[[107;97m##################[0m] - reify:@types/mocha: [7msill[0m [35maudit[0m bulk request {[0m[K
[[107;97m##################[0m] - reify:@types/mocha: [7msill[0m [35maudit[0m bulk request {[0m[K
[[107;97m##################[0m] - reify:@types/mocha: [7msill[0m [35maudit[0m bulk request {[0m[K
[[107;97m##################[0m] / reify:@types/mocha: [7msill[0m [35maudit[0m bulk request {[0m[K
[[107;97m##################[0m] \ reify:@types/mocha: [7msill[0m [35maudit[0m bulk request {[0m[K
[[107;97m##################[0m] \ reify:@types/mocha: [7msill[0m [35maudit[0m bulk request {[0m[K

[K[?25h[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m ini@1.3.4: Please update to ini >=1.3.6 to avoid a prototype pollution issue
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m inflight@1.0.6: This module is not supported, and leaks memory. Do not use it. Check out lru-cache if you want a good and tested way to coalesce async requests by a key value, which is much more comprehensive and powerful.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m domelementtype@1.3.0: update to domelementtype@1.3.1
[0m[?25l[[107;97m############[0m[100;90m......[0m] \ reify:acorn-object-spread: [32;40mtiming[0m [35mreifyNode:node_modules[0m[K

[K[?25h[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m content-type-parser@1.0.1: Use whatwg-mimetype instead
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m rimraf@2.6.1: Rimraf versions prior to v4 are no longer supported
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m rollup-plugin-buble@0.15.0: This module has been deprecated and is no longer maintained. Please use @rollup/plugin-buble.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m electron-download@3.3.0: Please use @electron/get moving forward.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m chalk@2.0.1: Please upgrade to Chalk 2.1.0 - template literals in this version (2.0.1) are quite buggy.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m rollup-plugin-virtual@1.0.1: This package has been deprecated and is no longer maintained. Please use @rollup/plugin-virtual.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m request-promise-native@1.0.4: request-promise-native has been deprecated because it extends the now deprecated request package, see https://github.com/request/request/issues/3142
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m is-buffer@1.1.5: This version of 'is-buffer' is out-of-date. You must update to v1.1.6 or newer
[0m[?25l[[107;97m##############[0m[100;90m....[0m] | reify:amdefine: [32;40mtiming[0m [35mreifyNode:node_modules/color-name[0m[0m[K

[K[?25h[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m abab@1.0.3: Use your platform's native atob() and btoa() methods instead
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m rollup-plugin-node-resolve@3.0.0: This package has been deprecated and is no longer maintained. Please use @rollup/plugin-node-resolve.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m cryptiles@2.0.5: This version has been deprecated in accordance with the hapi support policy (hapi.im/support). Please upgrade to the latest version to get the best features, bug fixes, and security patches. If you are unable to upgrade at this time, paid support is available for older versions (hapi.im/commercial).
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m json3@3.3.2: Please use the native JSON object instead of JSON 3
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m home-path@1.0.5: Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m deep-defaults@1.0.4: not actively maintained; find alternatives
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m clone@1.0.2: XSS vulnerability fixed in v1.0.3
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m rollup-plugin-json@2.3.0: This module has been deprecated and is no longer maintained. Please use @rollup/plugin-json.
[0m[?25l[[107;97m###############[0m[100;90m...[0m] \ reify:aws4: [32;40mtiming[0m [35mreifyNode:node_modules/chokidar[0m Compl[0m[K

[K[?25h[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m glob@7.1.2: Glob versions prior to v9 are no longer supported
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m circular-json@0.3.3: CircularJSON is in maintenance only, flatted is its successor.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m glob@7.1.1: Glob versions prior to v9 are no longer supported
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m rollup-plugin-typescript@0.8.1: This package has been deprecated and is no longer maintained. Please use @rollup/plugin-typescript.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m boom@2.10.1: This version has been deprecated in accordance with the hapi support policy (hapi.im/support). Please upgrade to the latest version to get the best features, bug fixes, and security patches. If you are unable to upgrade at this time, paid support is available for older versions (hapi.im/commercial).
[0m[?25l[[107;97m################[0m[100;90m..[0m] \ reify:boom: [30;43mWARN[0m [35mdeprecated[0m boom@2.10.1: This version ha[0m[K

[K[?25h[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m uuid@3.1.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See https://v8.dev/blog/math-random for details.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m sntp@1.0.9: This module moved to @hapi/sntp. Please make sure to switch over as this distribution is no longer supported and may contain bugs and critical security issues.
[0m[?25l[[107;97m################[0m[100;90m..[0m] | reify:domutils: [32;40mtiming[0m [35mreifyNode:node_modules/json-stabl[0m[K

[K[?25h[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m argv@0.0.2: Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m rollup-watch@4.3.1: rollup-watch functionality is now included in Rollup itself
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m mkdirp@0.5.0: Legacy versions of mkdirp are no longer supported. Please update to mkdirp 1.x. (Note that the API surface has changed to use Promises in 1.x.)
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m mkdirp@0.5.1: Legacy versions of mkdirp are no longer supported. Please update to mkdirp 1.x. (Note that the API surface has changed to use Promises in 1.x.)
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m hoek@2.16.3: This version has been deprecated in accordance with the hapi support policy (hapi.im/support). Please upgrade to the latest version to get the best features, bug fixes, and security patches. If you are unable to upgrade at this time, paid support is available for older versions (hapi.im/commercial).
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m request@2.81.0: request has been deprecated, see https://github.com/request/request/issues/3142
[0m[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m rollup-plugin-commonjs@8.1.0: This package has been deprecated and is no longer maintained. Please use @rollup/plugin-commonjs.
[0m[?25l[[107;97m#################[0m[100;90m.[0m] / reify:rollup-plugin-commonjs: [30;43mWARN[0m [35mdeprecated[0m rollup-plu[0m[K

[K[?25h[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m har-validator@4.2.1: this library is no longer supported
[0m[?25l[[107;97m#################[0m[100;90m.[0m] | reify:ajv-keywords: [32;40mtiming[0m [35mmetavuln:calculate:security-a[0m[K
[[107;97m#################[0m[100;90m.[0m] - reify:argparse: [32;40mtiming[0m [35mmetavuln:calculate:security-advis[0m[K
[[107;97m#################[0m[100;90m.[0m] / reify:magic-string: [32;40mtiming[0m [35mmetavuln:calculate:security-a[0m[K
[[107;97m#################[0m[100;90m.[0m] / reify:es6-promise: [32;40mtiming[0m [35mreifyNode:node_modules/whatwg-[0m[K

[K[?25h[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m hawk@3.1.3: This module moved to @hapi/hawk. Please make sure to switch over as this distribution is no longer supported and may contain bugs and critical security issues.
[0m[?25l[[107;97m#################[0m[100;90m.[0m] \ reify:parse5: [32;40mtiming[0m [35mreifyNode:node_modules/sshpk[0m Comple[0m[K
[[107;97m##################[0m] \ reify:table: [32;40mtiming[0m [35mmetavuln:calculate:security-advisory[0m[K
[[107;97m##################[0m] \ reify:resolve: [32;40mtiming[0m [35mmetavuln:calculate:security-adviso[0m[K
[[107;97m##################[0m] / reify:resolve: [32;40mtiming[0m [35mreifyNode:node_modules/jschardet[0m C[0m[K
[[107;97m##################[0m] | reify:css-tree: [32;40mtiming[0m [35mreifyNode:node_modules/browser-re[0m[K
[[107;97m##################[0m] - reify:ajv: [32;40mtiming[0m [35mreifyNode:node_modules/har-validator/n[0m[K
[[107;97m##################[0m] - reify:prettier: [32;40mtiming[0m [35mmetavuln:cache:get:security-advis[0m[K
[[107;97m##################[0m] | reify:cssstyle: [32;40mtiming[0m [35mreifyNode:node_modules/deep-defau[0m[K

[K[?25h[37;40mnpm[0m [0m[30;43mWARN[0m [0m[35mdeprecated[0m eslint@4.3.0: This version is no longer supported. Please see https://eslint.org/version-support for other options.
[0m[?25l[[107;97m##################[0m] / reify:eslint: [30;43mWARN[0m [35mdeprecated[0m eslint@4.3.0: This version[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mreifyNode:node_modules/eslint[0m C[0m[K
[[107;97m##################[0m] / reify:lodash: [32;40mtiming[0m [35mmetavuln:cache:get:security-advisor[0m[K
[[107;97m##################[0m] - reify:lodash: [32;40mtiming[0m [35mmetavuln:cache:get:security-advisor[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] - reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] / reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] \ reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K
[[107;97m##################[0m] | reify:typescript: [32;40mtiming[0m [35mmetavuln:cache:get:security-adv[0m[K

[K[?25h
added 469 packages, and audited 680 packages in 9s

[31m[1m78[22m[39m vulnerabilities (4 [1mlow[22m, 25 [33m[1mmoderate[22m[39m, 28 [31m[1mhigh[22m[39m, 21 [35m[1mcritical[22m[39m)

To address issues that do not require attention, run:
  npm audit fix

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
[?2004l
2025-11-11 00:48:47,028 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Ien0NO0ZUk5BVYyEvdtHWbnm', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/test.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 611, 'prompt_tokens': 34241, 'total_tokens': 34852, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 13568}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b885fe2e-4a38-493d-b948-b5f2f9666219-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/test.js"}, 'id': 'call_Ien0NO0ZUk5BVYyEvdtHWbnm', 'type': 'tool_call'}] usage_metadata={'input_tokens': 34241, 'output_tokens': 611, 'total_tokens': 34852, 'input_token_details': {'audio': 0, 'cache_read': 13568}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-11 00:48:47,032 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/test.js
2025-11-11 00:48:47,134 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:48:47,134 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
const glob = require("glob");

require("./setup");

glob.sync("**/__test__.js", { cwd: "src" }).forEach(function(file) {
	require("../src/" + file);
});

glob.sync("*/index.js", { cwd: "test" }).forEach(function(file) {
	require("./" + file);
});
[?2004l
2025-11-11 00:49:01,806 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Hnt7Xah3cn0L2MQzmEsVQ99e', 'function': {'arguments': '{"command":"./node_modules/.bin/mocha test/runtime/index.js --grep \'^(set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events) \'"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1415, 'prompt_tokens': 34361, 'total_tokens': 35776, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12800}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f8f334ef-5140-4de4-92b9-6f9d37c96774-0' tool_calls=[{'name': 'run_command', 'args': {'command': "./node_modules/.bin/mocha test/runtime/index.js --grep '^(set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events) '"}, 'id': 'call_Hnt7Xah3cn0L2MQzmEsVQ99e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 34361, 'output_tokens': 1415, 'total_tokens': 35776, 'input_token_details': {'audio': 0, 'cache_read': 12800}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-11 00:49:01,809 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ./node_modules/.bin/mocha test/runtime/index.js --grep '^(set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events) '
2025-11-11 00:49:02,020 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-11 00:49:02,020 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
 ./node_modules/.bin/mocha test/runtime/index.js --gre
ep '^(set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|
|bindings-before-oncreate|lifecycle-events) '
[?2004l
/testbed/test/runtime/index.js:1
import assert from "assert";
^^^^^^

SyntaxError: Cannot use import statement outside a module
[90m    at Object.compileFunction (node:vm:360:18)[39m
[90m    at wrapSafe (node:internal/modules/cjs/loader:1126:15)[39m
[90m    at Module._compile (node:internal/modules/cjs/loader:1162:27)[39m
[90m    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1252:10)[39m
[90m    at Module.load (node:internal/modules/cjs/loader:1076:32)[39m
[90m    at Function.Module._load (node:internal/modules/cjs/loader:911:12)[39m
[90m    at Module.require (node:internal/modules/cjs/loader:1100:19)[39m
[90m    at require (node:internal/modules/cjs/helpers:119:18)[39m
    at [90m/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:230:27
    at Array.forEach (<anonymous>)
    at Mocha.loadFiles [90m(/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:227:14[90m)[39m
    at Mocha.run [90m(/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:513:10[90m)[39m
    at Object.<anonymous> [90m(/testbed/[39mnode_modules/[4mmocha[24m/bin/_mocha:480:18[90m)[39m
[90m    at Module._compile (node:internal/modules/cjs/loader:1198:14)[39m
[90m    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1252:10)[39m
[90m    at Module.load (node:internal/modules/cjs/loader:1076:32)[39m
[90m    at Function.Module._load (node:internal/modules/cjs/loader:911:12)[39m
[90m    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)[39m
[90m    at node:internal/main/run_main_module:22:47[39m
[?2004l
2025-11-11 00:49:06,753 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_YS72aM2LCRJgQqVQvujVU7CM', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/setup.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 291, 'prompt_tokens': 35116, 'total_tokens': 35407, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 23424}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--711d2697-8560-441c-bbae-c37f3dba0dbf-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/setup.js"}, 'id': 'call_YS72aM2LCRJgQqVQvujVU7CM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 35116, 'output_tokens': 291, 'total_tokens': 35407, 'input_token_details': {'audio': 0, 'cache_read': 23424}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-11 00:49:06,756 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/setup.js
2025-11-11 00:49:06,858 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:49:06,858 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
const fs = require('fs');
const path = require('path');

require('console-group').install();
require('source-map-support').install();

require.extensions['.js'] = function(module, filename) {
	const exports = [];

	var code = fs.readFileSync(filename, 'utf-8')
		.replace(/^import (?:\* as )?(\w+) from ['"]([^'"]+)['"];?/gm, 'var $1 = require("$2");')
		.replace(/^import {([^}]+)} from ['"](.+)['"];?/gm, 'var {$1} = require("$2");')
		.replace(/^export default /gm, 'module.exports = ')
		.replace(/^export (const|let|var|class|function) (\w+)/gm, (match, type, name) => {
			exports.push(name);
			return `${type} ${name}`;
		})
		.replace(/^export \{([^}]+)\}/gm, (match, names) => {
			names.split(',').filter(Boolean).forEach(name => {
				exports.push(name);
			});

			return '';
		})
		.replace(/^export function (\w+)/gm, 'exports.$1 = function $1');

	exports.forEach(name => {
		code += `\nexports.${name} = ${name};`;
	});

	try {
		return module._compile(code, filename);
	} catch (err) {
		console.log(code); // eslint-disable-line no-console
		throw err;
	}
[?2004l
2025-11-11 00:49:13,846 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_vIgMNIUVsM9FmrBGk4q6Aowg', 'function': {'arguments': '{"command":"./node_modules/.bin/mocha test/test.js --grep \'^(set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events) \'"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 582, 'prompt_tokens': 35486, 'total_tokens': 36068, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 34176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--99bb2b26-3d25-4d6b-ad84-e7b86bc7507b-0' tool_calls=[{'name': 'run_command', 'args': {'command': "./node_modules/.bin/mocha test/test.js --grep '^(set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events) '"}, 'id': 'call_vIgMNIUVsM9FmrBGk4q6Aowg', 'type': 'tool_call'}] usage_metadata={'input_tokens': 35486, 'output_tokens': 582, 'total_tokens': 36068, 'input_token_details': {'audio': 0, 'cache_read': 34176}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-11 00:49:13,850 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ./node_modules/.bin/mocha test/test.js --grep '^(set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events) '
2025-11-11 00:49:14,789 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:49:14,789 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
 ./node_modules/.bin/mocha test/test.js --grep '^(set-
-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-
-before-oncreate|lifecycle-events) '
[?2004l


[92m [0m[32m 0 passing[0m[90m (2ms)[0m

[?2004l
2025-11-11 00:49:27,241 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_dMuNP77aLXvd8P4MNBS5rWKy', 'function': {'arguments': '{"command":"./node_modules/.bin/mocha test/test.js --grep \'^(set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events)\'}"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1030, 'prompt_tokens': 35655, 'total_tokens': 36685, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--75fcd6ef-079f-4ad7-9160-4734bbb30d77-0' tool_calls=[{'name': 'run_command', 'args': {'command': "./node_modules/.bin/mocha test/test.js --grep '^(set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events)'}"}, 'id': 'call_dMuNP77aLXvd8P4MNBS5rWKy', 'type': 'tool_call'}] usage_metadata={'input_tokens': 35655, 'output_tokens': 1030, 'total_tokens': 36685, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-11 00:49:27,244 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ./node_modules/.bin/mocha test/test.js --grep '^(set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events)'}
2025-11-11 00:49:28,168 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:49:28,168 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
 ./node_modules/.bin/mocha test/test.js --grep '^(set-
-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-
-before-oncreate|lifecycle-events)'}
[?2004l


[92m [0m[32m 0 passing[0m[90m (1ms)[0m

[?2004l
2025-11-11 00:49:40,792 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Gl0IqLMm6oKJr0iDkkODRA4Q', 'function': {'arguments': '{"command":"./node_modules/.bin/mocha test/test.js --grep \'set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events\'"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 836, 'prompt_tokens': 35824, 'total_tokens': 36660, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f2855827-4596-4107-9543-d611ab69ae1d-0' tool_calls=[{'name': 'run_command', 'args': {'command': "./node_modules/.bin/mocha test/test.js --grep 'set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events'"}, 'id': 'call_Gl0IqLMm6oKJr0iDkkODRA4Q', 'type': 'tool_call'}] usage_metadata={'input_tokens': 35824, 'output_tokens': 836, 'total_tokens': 36660, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-11 00:49:40,795 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Executing command: ./node_modules/.bin/mocha test/test.js --grep 'set-in-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-before-oncreate|lifecycle-events'
2025-11-11 00:49:42,051 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-11 00:49:42,051 - thread-133013323122368.prometheus.docker.base_container - DEBUG - Command output:
 ./node_modules/.bin/mocha test/test.js --grep 'set-in
n-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-be
efore-oncreate|lifecycle-events'
[?2004l

[0m[0m
[0m  runtime[0m
  [32m  ✓[0m[90m bindings-before-oncreate (shared helpers)[0m[33m (41ms)[0m
  [32m  ✓[0m[90m bindings-before-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m bindings-before-oncreate (inline helpers)[0m[33m (39ms)[0m
  [32m  ✓[0m[90m lifecycle-events (shared helpers)[0m
  [32m  ✓[0m[90m lifecycle-events (shared helpers)[0m
  [32m  ✓[0m[90m lifecycle-events (inline helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (inline helpers)[0m[33m (39ms)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (inline helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (inline helpers)[0m

[0m  ssr[0m
  [32m  ✓[0m[90m bindings-before-oncreate[0m
  [32m  ✓[0m[90m lifecycle-events[0m


[92m [0m[32m 17 passing[0m[90m (310ms)[0m

[?2004l
2025-11-11 00:49:58,000 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content="Result:\n ./node_modules/.bin/mocha test/test.js --grep 'set-in\nn-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-be\nefore-oncreate|lifecycle-events'\n\n\x1b[0m\x1b[0m\n\x1b[0m  runtime\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m bindings-before-oncreate (shared helpers)\x1b[0m\x1b[33m (41ms)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m bindings-before-oncreate (shared helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m bindings-before-oncreate (inline helpers)\x1b[0m\x1b[33m (39ms)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m lifecycle-events (shared helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m lifecycle-events (shared helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m lifecycle-events (inline helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m onrender-fires-when-ready (shared helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m onrender-fires-when-ready (shared helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m onrender-fires-when-ready (inline helpers)\x1b[0m\x1b[33m (39ms)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m onrender-fires-when-ready-nested (shared helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m onrender-fires-when-ready-nested (shared helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m onrender-fires-when-ready-nested (inline helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m set-in-oncreate (shared helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m set-in-oncreate (shared helpers)\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m set-in-oncreate (inline helpers)\x1b[0m\n\n\x1b[0m  ssr\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m bindings-before-oncreate\x1b[0m\n  \x1b[32m  ✓\x1b[0m\x1b[90m lifecycle-events\x1b[0m\n\n\n\x1b[92m \x1b[0m\x1b[32m 17 passing\x1b[0m\x1b[90m (310ms)\x1b[0m" additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1878, 'prompt_tokens': 36560, 'total_tokens': 38438, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1216, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 11904}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--f32689d9-9da4-4060-9354-e5d175a262e7-0' usage_metadata={'input_tokens': 36560, 'output_tokens': 1878, 'total_tokens': 38438, 'input_token_details': {'audio': 0, 'cache_read': 11904}, 'output_token_details': {'audio': 0, 'reasoning': 1216}}
2025-11-11 00:49:58,003 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_structure_node - DEBUG - Human Message: 
We have run the selected regression tests on the codebase.
The following regression tests were selected to run:
--- BEGIN SELECTED REGRESSION TESTS ---
test/runtime/samples/set-in-oncreate
test/runtime/samples/onrender-fires-when-ready
test/runtime/samples/onrender-fires-when-ready-nested
test/runtime/samples/bindings-before-oncreate
test/runtime/samples/lifecycle-events
--- END SELECTED REGRESSION TESTS ---

Run Regression Tests Logs:
--- BEGIN LOG ---
Result:
 ./node_modules/.bin/mocha test/test.js --grep 'set-in
n-oncreate|onrender-fires-when-ready|onrender-fires-when-ready-nested|bindings-be
efore-oncreate|lifecycle-events'

[0m[0m
[0m  runtime[0m
  [32m  ✓[0m[90m bindings-before-oncreate (shared helpers)[0m[33m (41ms)[0m
  [32m  ✓[0m[90m bindings-before-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m bindings-before-oncreate (inline helpers)[0m[33m (39ms)[0m
  [32m  ✓[0m[90m lifecycle-events (shared helpers)[0m
  [32m  ✓[0m[90m lifecycle-events (shared helpers)[0m
  [32m  ✓[0m[90m lifecycle-events (inline helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (inline helpers)[0m[33m (39ms)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (inline helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (inline helpers)[0m

[0m  ssr[0m
  [32m  ✓[0m[90m bindings-before-oncreate[0m
  [32m  ✓[0m[90m lifecycle-events[0m


[92m [0m[32m 17 passing[0m[90m (310ms)[0m
--- END LOG ---

Please analyze the logs and determine which regression tests passed!. You should return the exact test identifier 
that we give to you.
Don't forget to return the total number of tests run!

2025-11-11 00:50:06,051 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_structure_node - DEBUG - passed_regression_tests=['test/runtime/samples/set-in-oncreate', 'test/runtime/samples/onrender-fires-when-ready', 'test/runtime/samples/onrender-fires-when-ready-nested', 'test/runtime/samples/bindings-before-oncreate', 'test/runtime/samples/lifecycle-events'] regression_test_fail_log='' total_tests_run=17
2025-11-11 00:50:06,052 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - INFO - passed_regression_tests: ['test/runtime/samples/set-in-oncreate', 'test/runtime/samples/onrender-fires-when-ready', 'test/runtime/samples/onrender-fires-when-ready-nested', 'test/runtime/samples/bindings-before-oncreate', 'test/runtime/samples/lifecycle-events']
2025-11-11 00:50:06,052 - thread-133013323122368.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - DEBUG - regression_test_fail_log: 
2025-11-11 00:50:06,054 - thread-133013323122368.prometheus.lang_graph.nodes.get_pass_regression_test_patch_check_result_node - DEBUG - All regression tests ['test/runtime/samples/set-in-oncreate', 'test/runtime/samples/onrender-fires-when-ready', 'test/runtime/samples/onrender-fires-when-ready-nested', 'test/runtime/samples/bindings-before-oncreate', 'test/runtime/samples/lifecycle-events']
2025-11-11 00:50:06,054 - thread-133013323122368.prometheus.lang_graph.nodes.get_pass_regression_test_patch_check_result_node - DEBUG - Current passed tests ['test/runtime/samples/set-in-oncreate', 'test/runtime/samples/onrender-fires-when-ready', 'test/runtime/samples/onrender-fires-when-ready-nested', 'test/runtime/samples/bindings-before-oncreate', 'test/runtime/samples/lifecycle-events']
2025-11-11 00:50:06,054 - thread-133013323122368.prometheus.lang_graph.nodes.get_pass_regression_test_patch_check_result_node - DEBUG - True
2025-11-11 00:50:06,056 - thread-133013323122368.prometheus.lang_graph.nodes.get_pass_regression_test_patch_subgraph_node - DEBUG - tested_patch_result: [TestedPatchResult(patch="diff --git a/src/generators/Generator.ts b/src/generators/Generator.ts\nindex 5b7ec8f07..b449367a7 100644\n--- a/src/generators/Generator.ts\n+++ b/src/generators/Generator.ts\n@@ -510,6 +510,7 @@ export default class Generator {\n \n \t\t\t\tconst addArrowFunctionExpression = (name: string, node: Node) => {\n \t\t\t\t\tconst { body, params } = node;\n+\t\t\t\t\tconst asyncKeyword = (node as any).async ? 'async ' : '';\n \n \t\t\t\t\tconst paramString = params.length ?\n \t\t\t\t\t\t`[✂${params[0].start}-${params[params.length - 1].end}✂]` :\n@@ -517,11 +518,11 @@ export default class Generator {\n \n \t\t\t\t\tif (body.type === 'BlockStatement') {\n \t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n-\t\t\t\t\t\t\tfunction ${name}(${paramString}) [✂${body.start}-${body.end}✂]\n+\t\t\t\t\t\t\t${asyncKeyword}function ${name}(${paramString}) [✂${body.start}-${body.end}✂]\n \t\t\t\t\t\t`);\n \t\t\t\t\t} else {\n \t\t\t\t\t\tcomponentDefinition.addBlock(deindent`\n-\t\t\t\t\t\t\tfunction ${name}(${paramString}) {\n+\t\t\t\t\t\t\t${asyncKeyword}function ${name}(${paramString}) {\n \t\t\t\t\t\t\t\treturn [✂${body.start}-${body.end}✂];\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t`);\n@@ -531,8 +532,10 @@ export default class Generator {\n \t\t\t\tconst addFunctionExpression = (name: string, node: Node) => {\n \t\t\t\t\tlet c = node.start;\n \t\t\t\t\twhile (this.source[c] !== '(') c += 1;\n+\t\t\t\t\tconst asyncKeyword = (node as any).async ? 'async ' : '';\n+\t\t\t\t\tconst generatorMark = (node as any).generator ? '*' : '';\n \t\t\t\t\tcomponentDefinition.addBlock(deindent`\n-\t\t\t\t\t\tfunction ${name}[✂${c}-${node.end}✂];\n+\t\t\t\t\t\t${asyncKeyword}function${generatorMark} ${name}[✂${c}-${node.end}✂];\n \t\t\t\t\t`);\n \t\t\t\t};\n \n", passed=True, regression_test_failure_log='')]
2025-11-11 00:50:06,087 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State max_refined_query_loop: 4
2025-11-11 00:50:06,087 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State number_of_candidate_patch: 3
2025-11-11 00:50:06,087 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_existing_test: False
2025-11-11 00:50:06,087 - thread-133013323122368.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_regression_test: True
2025-11-11 00:50:06,117 - thread-133013323122368.prometheus.lang_graph.nodes.issue_verified_bug_subgraph_node - INFO - edit_patch: diff --git a/src/generators/Generator.ts b/src/generators/Generator.ts
index 5b7ec8f07..b449367a7 100644
--- a/src/generators/Generator.ts
+++ b/src/generators/Generator.ts
@@ -510,6 +510,7 @@ export default class Generator {
 
 				const addArrowFunctionExpression = (name: string, node: Node) => {
 					const { body, params } = node;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
 
 					const paramString = params.length ?
 						`[✂${params[0].start}-${params[params.length - 1].end}✂]` :
@@ -517,11 +518,11 @@ export default class Generator {
 
 					if (body.type === 'BlockStatement') {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
+							${asyncKeyword}function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
 						`);
 					} else {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) {
+							${asyncKeyword}function ${name}(${paramString}) {
 								return [✂${body.start}-${body.end}✂];
 							}
 						`);
@@ -531,8 +532,10 @@ export default class Generator {
 				const addFunctionExpression = (name: string, node: Node) => {
 					let c = node.start;
 					while (this.source[c] !== '(') c += 1;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
+					const generatorMark = (node as any).generator ? '*' : '';
 					componentDefinition.addBlock(deindent`
-						function ${name}[✂${c}-${node.end}✂];
+						${asyncKeyword}function${generatorMark} ${name}[✂${c}-${node.end}✂];
 					`);
 				};
 

2025-11-11 00:50:16,881 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_responder_node - DEBUG - content='Thanks for the report. We identified that the code generator was dropping the async keyword when lifting lifecycle methods and other functions into the component definition, which is why an async oncreate ended up compiled without async.\n\nFix implemented:\n- Updated the generator to preserve the async keyword for both arrow functions and function expressions when the original AST node is marked async.\n- For function expressions, we also preserve the generator marker (*) when present.\n\nSpecifically, the addArrowFunctionExpression and addFunctionExpression paths in Generator.ts now detect node.async and prefix “async ” appropriately (and node.generator for “*” on function expressions). This ensures oncreate remains async and awaits behave as expected.\n\nVerification:\n- The bug reproducing test now passes.\n- All selected regression tests pass successfully.\n\nPlease let us know if you still see any issues with async lifecycle methods after pulling the latest changes.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 951, 'prompt_tokens': 837, 'total_tokens': 1788, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--b9bc7a0a-36f9-4ba9-a15d-06a06931b5b6-0' usage_metadata={'input_tokens': 837, 'output_tokens': 951, 'total_tokens': 1788, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-11 00:50:16,883 - thread-133013323122368.prometheus.docker.base_container - INFO - Cleaning up container and temporary files
2025-11-11 00:50:16,883 - thread-133013323122368.prometheus.docker.base_container - INFO - Closing persistent shell...
2025-11-11 00:50:16,984 - thread-133013323122368.prometheus.docker.base_container - INFO - Cleaning up container and temporary files
2025-11-11 00:50:27,685 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - Generated patch:
diff --git a/src/generators/Generator.ts b/src/generators/Generator.ts
index 5b7ec8f07..b449367a7 100644
--- a/src/generators/Generator.ts
+++ b/src/generators/Generator.ts
@@ -510,6 +510,7 @@ export default class Generator {
 
 				const addArrowFunctionExpression = (name: string, node: Node) => {
 					const { body, params } = node;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
 
 					const paramString = params.length ?
 						`[✂${params[0].start}-${params[params.length - 1].end}✂]` :
@@ -517,11 +518,11 @@ export default class Generator {
 
 					if (body.type === 'BlockStatement') {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
+							${asyncKeyword}function ${name}(${paramString}) [✂${body.start}-${body.end}✂]
 						`);
 					} else {
 						componentDefinition.addBlock(deindent`
-							function ${name}(${paramString}) {
+							${asyncKeyword}function ${name}(${paramString}) {
 								return [✂${body.start}-${body.end}✂];
 							}
 						`);
@@ -531,8 +532,10 @@ export default class Generator {
 				const addFunctionExpression = (name: string, node: Node) => {
 					let c = node.start;
 					while (this.source[c] !== '(') c += 1;
+					const asyncKeyword = (node as any).async ? 'async ' : '';
+					const generatorMark = (node as any).generator ? '*' : '';
 					componentDefinition.addBlock(deindent`
-						function ${name}[✂${c}-${node.end}✂];
+						${asyncKeyword}function${generatorMark} ${name}[✂${c}-${node.end}✂];
 					`);
 				};
 

2025-11-11 00:50:27,685 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - passed_reproducing_test: True
2025-11-11 00:50:27,685 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - passed_regression_test: True
2025-11-11 00:50:27,685 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - passed_existing_test: False
2025-11-11 00:50:27,685 - thread-133013323122368.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - issue_response:
Thanks for the report. We identified that the code generator was dropping the async keyword when lifting lifecycle methods and other functions into the component definition, which is why an async oncreate ended up compiled without async.

Fix implemented:
- Updated the generator to preserve the async keyword for both arrow functions and function expressions when the original AST node is marked async.
- For function expressions, we also preserve the generator marker (*) when present.

Specifically, the addArrowFunctionExpression and addFunctionExpression paths in Generator.ts now detect node.async and prefix “async ” appropriately (and node.generator for “*” on function expressions). This ensures oncreate remains async and awaits behave as expected.

Verification:
- The bug reproducing test now passes.
- All selected regression tests pass successfully.

Please let us know if you still see any issues with async lifecycle methods after pulling the latest changes.
