2025-11-10 23:20:48,682 - thread-133013312636608.prometheus.docker.base_container - INFO - Created temporary project directory: /tmp/tmp0rsx61zz/svelte
2025-11-10 23:20:48,682 - thread-133013312636608.prometheus.docker.base_container - DEBUG - Using workdir: /testbed
2025-11-10 23:20:49,104 - thread-133013312636608.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_build: False
2025-11-10 23:20:49,104 - thread-133013312636608.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_existing_test: False
2025-11-10 23:20:49,104 - thread-133013312636608.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_regression_test: True
2025-11-10 23:20:49,104 - thread-133013312636608.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_reproduce_test: True
2025-11-10 23:20:49,104 - thread-133013312636608.prometheus.lang_graph.nodes.noop_node - DEBUG - State number_of_candidate_patch: 5
2025-11-10 23:20:49,105 - thread-133013312636608.prometheus.lang_graph.nodes.issue_classification_subgraph_node - INFO - Enter IssueClassificationSubgraphNode
2025-11-10 23:20:49,105 - thread-133013312636608.prometheus.lang_graph.nodes.issue_classification_context_message_node - DEBUG - Sending query to context provider:
Issue title:
using refs in css

Issue description: 
When I use a ref, I most often also want to get a handle to it with css, which leads to slightly annoying, duplicative markup.

```html
<style>
  .container {
    color: red
  }
</style>
<div class="container" ref:container></div>
```
 
The only solutions I can think of to mitigate this are untenable, but thought I raise this if others see something better.

- Make nodes with ids available as refs, like polymer's static node map
- Make svelte refs available as synthetic css selectors
- Make a syntax shortcut for declaring refs as classes, e.g. `<div ref:class:container ></div>`

Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

2025-11-10 23:20:49,106 - thread-133013312636608.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-10 23:20:49,107 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── getGlobals.ts
|   |           ├── getIntro.ts
|   |           ├── getOutro.ts
|   |           └── walkHtml.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getObject.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── reservedNames.ts
|   |   ├── spaces.ts
|   |   ├── stringify.ts
|   |   └── trim.ts
|   └── validate
|       ├── html
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── pass-no-options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-onrender
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
using refs in css

Issue description: 
When I use a ref, I most often also want to get a handle to it with css, which leads to slightly annoying, duplicative markup.

```html
<style>
  .container {
    color: red
  }
</style>
<div class="container" ref:container></div>
```
 
The only solutions I can think of to mitigate this are untenable, but thought I raise this if others see something better.

- Make nodes with ids available as refs, like polymer's static node map
- Make svelte refs available as synthetic css selectors
- Make a syntax shortcut for declaring refs as classes, e.g. `<div ref:class:container ></div>`

Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-10 23:21:15,327 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The file tree lacks actual code and documentation content; to classify whether “using refs in css” is a bug or feature request, I need to verify existing ref directive behavior and any CSS integration. Specifically, I must examine how refs are parsed and compiled, and check documentation and tests to confirm whether CSS selectors can target refs or if this is unsupported.' query='Please provide the full content with line numbers of src/parse/read/directives.ts, src/generators/dom/visitors/Element/index.ts (and any Element visitor files that handle ref directives), README.md sections covering refs and CSS scoping, and test/validator/samples/event-handler-ref/input.html plus event-handler-ref-invalid/input.html.' extra_requirements='If ref handling is implemented outside Element visitors, include the module where ref directives are compiled (DOM/SSR) and the CSS selector processing files (src/css/Selector.ts or Stylesheet.ts).' purpose='This context will confirm existing ref semantics and CSS capabilities so I can accurately classify the issue as a feature request, bug, documentation update, or question.'
2025-11-10 23:21:15,328 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content with line numbers of src/parse/read/directives.ts, src/generators/dom/visitors/Element/index.ts (and any Element visitor files that handle ref directives), README.md sections covering refs and CSS scoping, and test/validator/samples/event-handler-ref/input.html plus event-handler-ref-invalid/input.html.
2025-11-10 23:21:24,489 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-10 23:21:24,489 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-10 23:21:24,489 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-10 23:21:24,489 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-10 23:21:24,490 - thread-133013312636608.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-10 23:21:24,491 - thread-133013312636608.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-10 23:21:24,491 - thread-133013312636608.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content with line numbers of src/parse/read/directives.ts, src/generators/dom/visitors/Element/index.ts (and any Element visitor files that handle ref directives), README.md sections covering refs and CSS scoping, and test/validator/samples/event-handler-ref/input.html plus event-handler-ref-invalid/input.html.
Extra requirements: If ref handling is implemented outside Element visitors, include the module where ref directives are compiled (DOM/SSR) and the CSS selector processing files (src/css/Selector.ts or Stylesheet.ts).
Purpose: This context will confirm existing ref semantics and CSS capabilities so I can accurately classify the issue as a feature request, bug, documentation update, or question.
2025-11-10 23:21:42,727 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zVUumbDwWdqoCCV2czZ67Bow', 'function': {'arguments': '{"relative_path":"src/parse/read/directives.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2148, 'prompt_tokens': 2242, 'total_tokens': 4390, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2112, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--caed8572-e788-46c0-8aa0-9c4bd7e1b3df-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/parse/read/directives.ts'}, 'id': 'call_zVUumbDwWdqoCCV2czZ67Bow', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2242, 'output_tokens': 2148, 'total_tokens': 4390, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 2112}}
2025-11-10 23:21:53,370 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_baaaiO5TWlz90Us6iPmEiMTc', 'function': {'arguments': '{"relative_path":"test/validator/samples/event-handler-ref/input.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 999, 'prompt_tokens': 4117, 'total_tokens': 5116, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6a558d05-2714-47c2-83a8-f79088784bb9-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/validator/samples/event-handler-ref/input.html'}, 'id': 'call_baaaiO5TWlz90Us6iPmEiMTc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4117, 'output_tokens': 999, 'total_tokens': 5116, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-10 23:21:54,769 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_7eh86S2PmsklOi30wdG1OFeV', 'function': {'arguments': '{"relative_path":"test/validator/samples/event-handler-ref-invalid/input.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 4251, 'total_tokens': 4285, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--77e2f1f8-8955-449a-a9c5-69842bf156ce-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/validator/samples/event-handler-ref-invalid/input.html'}, 'id': 'call_7eh86S2PmsklOi30wdG1OFeV', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4251, 'output_tokens': 34, 'total_tokens': 4285, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:01,662 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_BGLTQKCLtCec1B8NXkgIAZqk', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 745, 'prompt_tokens': 4388, 'total_tokens': 5133, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0fb02537-8c34-407b-9e4e-bf7ae8de412f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/index.ts'}, 'id': 'call_BGLTQKCLtCec1B8NXkgIAZqk', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4388, 'output_tokens': 745, 'total_tokens': 5133, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-10 23:22:09,925 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OQU77BV3G5JzBzaKUu24ntpb', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 868, 'prompt_tokens': 4456, 'total_tokens': 5324, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9bf445f5-aec2-4c7c-9408-9809f02a183e-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/dom/visitors'}, 'id': 'call_OQU77BV3G5JzBzaKUu24ntpb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4456, 'output_tokens': 868, 'total_tokens': 5324, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-10 23:22:11,062 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_wuRnbHZccm1A0Q2Rx9Be3UUu', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 4537, 'total_tokens': 4568, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7c43e157-18f8-48b4-a3c8-f4e3adc1d956-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors'}, 'id': 'call_wuRnbHZccm1A0Q2Rx9Be3UUu', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4537, 'output_tokens': 31, 'total_tokens': 4568, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:13,354 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_GGi1r3eKK45GkTjsKNryLf3Y', 'function': {'arguments': '{"basename":"Element"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 156, 'prompt_tokens': 4602, 'total_tokens': 4758, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ccb7a36a-b45f-4468-b8ba-bd53fe91f5c3-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Element'}, 'id': 'call_GGi1r3eKK45GkTjsKNryLf3Y', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4602, 'output_tokens': 156, 'total_tokens': 4758, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-10 23:22:14,427 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hnfkg467Y9O2OCiqlOGK1onf', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 4676, 'total_tokens': 4708, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0fefa873-b714-4a5f-9604-38a3c2a66dd5-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/dom/visitors/Element'}, 'id': 'call_hnfkg467Y9O2OCiqlOGK1onf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4676, 'output_tokens': 32, 'total_tokens': 4708, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:15,703 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ngapChbIOnO9VVEjlcZAn2HM', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 4760, 'total_tokens': 4793, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4352}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c33a4778-cfe7-494b-baef-208dfa32d42a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element'}, 'id': 'call_ngapChbIOnO9VVEjlcZAn2HM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4760, 'output_tokens': 33, 'total_tokens': 4793, 'input_token_details': {'audio': 0, 'cache_read': 4352}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:21,626 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_kwZNgm76xdwq80xk3e1ehABn', 'function': {'arguments': '{"basename":"index.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 541, 'prompt_tokens': 4827, 'total_tokens': 5368, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4736}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--40ce18a3-f7fc-4398-8f39-d032d5384c90-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'index.ts'}, 'id': 'call_kwZNgm76xdwq80xk3e1ehABn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4827, 'output_tokens': 541, 'total_tokens': 5368, 'input_token_details': {'audio': 0, 'cache_read': 4736}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-10 23:22:29,834 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_CITyQ5NGWYu6FDT6h1H0PD4d', 'function': {'arguments': '{"relative_path":"src/parse/index.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 673, 'prompt_tokens': 5042, 'total_tokens': 5715, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b5cb8135-1e91-4b8b-852e-9ddc43cdb90c-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/parse/index.ts'}, 'id': 'call_CITyQ5NGWYu6FDT6h1H0PD4d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5042, 'output_tokens': 673, 'total_tokens': 5715, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-10 23:22:30,942 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0aUIuKWNXVYIg2P7rB40ZFt8', 'function': {'arguments': '{"relative_path":"src/parse/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 5117, 'total_tokens': 5145, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4096}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--28e00639-0fe1-4a32-a3ce-df6fa55f2261-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/parse/index.ts'}, 'id': 'call_0aUIuKWNXVYIg2P7rB40ZFt8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5117, 'output_tokens': 28, 'total_tokens': 5145, 'input_token_details': {'audio': 0, 'cache_read': 4096}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:36,026 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_r0Q0w6NyrubCMIRYkb8nZ3Ha', 'function': {'arguments': '{"basename":"Element.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 413, 'prompt_tokens': 7069, 'total_tokens': 7482, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4480}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0303292e-9b42-489c-90a6-745887301dfa-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Element.ts'}, 'id': 'call_r0Q0w6NyrubCMIRYkb8nZ3Ha', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7069, 'output_tokens': 413, 'total_tokens': 7482, 'input_token_details': {'audio': 0, 'cache_read': 4480}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-10 23:22:37,336 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_IMrzA0soreAGegZ5CP12Y9Gx', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/Element.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 7192, 'total_tokens': 7228, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c797feb9-df1d-466a-add5-9b0039bb3a6e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/Element.ts'}, 'id': 'call_IMrzA0soreAGegZ5CP12Y9Gx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7192, 'output_tokens': 36, 'total_tokens': 7228, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:38,932 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_EcrpIeVCXAsKiJHZWFdUoIG5', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/Ref.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 10242, 'total_tokens': 10278, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5eab89e1-38cc-4778-aead-2f00179d6e75-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/Ref.ts'}, 'id': 'call_EcrpIeVCXAsKiJHZWFdUoIG5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10242, 'output_tokens': 36, 'total_tokens': 10278, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:40,441 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hJhbs6VqWi4SgdBcsedpZTWK', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/EventHandler.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 10612, 'total_tokens': 10648, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4352}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2a9a82d8-f771-4006-8161-75d9320ab994-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/EventHandler.ts'}, 'id': 'call_hJhbs6VqWi4SgdBcsedpZTWK', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10612, 'output_tokens': 36, 'total_tokens': 10648, 'input_token_details': {'audio': 0, 'cache_read': 4352}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:42,127 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_sE65vLtrGUvb6WAz8OqwMUvW', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/Binding.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 12167, 'total_tokens': 12203, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 7168}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--315484d7-f515-4a4b-b82f-dafe27048cd5-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/Binding.ts'}, 'id': 'call_sE65vLtrGUvb6WAz8OqwMUvW', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12167, 'output_tokens': 36, 'total_tokens': 12203, 'input_token_details': {'audio': 0, 'cache_read': 7168}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:44,536 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_E3AGUgLIzc1k9swDwQn3P5ay', 'function': {'arguments': '{"relative_path":"src/css/Selector.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 27, 'prompt_tokens': 15520, 'total_tokens': 15547, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--31b870b0-9d81-4fae-91c6-8ef17e73d819-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/css/Selector.ts'}, 'id': 'call_E3AGUgLIzc1k9swDwQn3P5ay', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15520, 'output_tokens': 27, 'total_tokens': 15547, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:46,419 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0xbbMhQAJdmcUVe9Gbx6d9S6', 'function': {'arguments': '{"relative_path":"src/css/Selector.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 15595, 'total_tokens': 15623, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4b38784b-0571-498f-b06e-c33be66d5e57-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/css/Selector.ts'}, 'id': 'call_0xbbMhQAJdmcUVe9Gbx6d9S6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15595, 'output_tokens': 28, 'total_tokens': 15623, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:47,964 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_5Dc1ToutN7OVRb6obgdW8jzA', 'function': {'arguments': '{"relative_path":"src/css/Stylesheet.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 18954, 'total_tokens': 18982, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4608}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0d1dc6c3-5e02-407c-aa56-d3f7fb2b4c59-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/css/Stylesheet.ts'}, 'id': 'call_5Dc1ToutN7OVRb6obgdW8jzA', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18954, 'output_tokens': 28, 'total_tokens': 18982, 'input_token_details': {'audio': 0, 'cache_read': 4608}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:49,263 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OxgcjPc7jjocUae4vRGfWx2F', 'function': {'arguments': '{"relative_path":"src/css/Stylesheet.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 19032, 'total_tokens': 19061, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 18944}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ba934b55-844f-4008-9066-f103225cd392-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/css/Stylesheet.ts'}, 'id': 'call_OxgcjPc7jjocUae4vRGfWx2F', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19032, 'output_tokens': 29, 'total_tokens': 19061, 'input_token_details': {'audio': 0, 'cache_read': 18944}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:51,186 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_2gkaIoQf4A8OssVfpQyOHasT', 'function': {'arguments': '{"basename":"README.md"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 23493, 'total_tokens': 23516, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 7040}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e1847777-9d6d-4087-ab09-95d894e21bf1-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'README.md'}, 'id': 'call_2gkaIoQf4A8OssVfpQyOHasT', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23493, 'output_tokens': 23, 'total_tokens': 23516, 'input_token_details': {'audio': 0, 'cache_read': 7040}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:52,841 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_GeTW5xmpxAeY81l5Y827wRwj', 'function': {'arguments': '{"relative_path":"README.md"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 23596, 'total_tokens': 23621, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4480}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c9f5bdf8-42cb-4d5a-865f-074b6434e0c8-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'README.md'}, 'id': 'call_GeTW5xmpxAeY81l5Y827wRwj', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23596, 'output_tokens': 25, 'total_tokens': 23621, 'input_token_details': {'audio': 0, 'cache_read': 4480}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:22:59,021 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Ri0bfQw0i7QD9cD8ayxp21T6', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/Element.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 619, 'prompt_tokens': 25687, 'total_tokens': 26306, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4736}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d0b64a7e-79e1-4d0c-a401-99f5e9f705b7-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/Element.ts'}, 'id': 'call_Ri0bfQw0i7QD9cD8ayxp21T6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25687, 'output_tokens': 619, 'total_tokens': 26306, 'input_token_details': {'audio': 0, 'cache_read': 4736}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-10 23:23:14,791 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_CxhGXZS0NaRsZmWVNUjnbA68', 'function': {'arguments': '{"basename":"Ref.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 989, 'prompt_tokens': 26673, 'total_tokens': 27662, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8e4596bb-9e57-44bd-8940-7324dd7c80c5-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Ref.ts'}, 'id': 'call_CxhGXZS0NaRsZmWVNUjnbA68', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26673, 'output_tokens': 989, 'total_tokens': 27662, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-10 23:23:17,140 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_KT0C6uMWazC13J51aCqeOevA', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Component/Ref.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 26795, 'total_tokens': 26831, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1b2270df-947d-4843-9ccc-79d180df9c4a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Component/Ref.ts'}, 'id': 'call_KT0C6uMWazC13J51aCqeOevA', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26795, 'output_tokens': 36, 'total_tokens': 26831, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:23:19,798 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_MVdB3w4hAGexoSb7j9vu89bC', 'function': {'arguments': '{"basename":"Attribute.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 27136, 'total_tokens': 27159, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--82cfbfc0-7d62-4a5f-9405-a5f44058dd82-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Attribute.ts'}, 'id': 'call_MVdB3w4hAGexoSb7j9vu89bC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 27136, 'output_tokens': 23, 'total_tokens': 27159, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:23:21,441 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_wOWaJe6D4123Js9YWiaVUHwf', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/Attribute.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 27258, 'total_tokens': 27294, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 18944}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6361789a-27ee-4d1c-a4be-03b899d4297a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/Attribute.ts'}, 'id': 'call_wOWaJe6D4123Js9YWiaVUHwf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 27258, 'output_tokens': 36, 'total_tokens': 27294, 'input_token_details': {'audio': 0, 'cache_read': 18944}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:23:23,101 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ag9QbOHVAm9C1BTXnIrDukkf', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/meta/Window.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 29518, 'total_tokens': 29554, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 26752}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e49bc8e9-350f-4a9b-be3f-2632a55ac2ec-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/dom/visitors/Element/meta/Window.ts'}, 'id': 'call_ag9QbOHVAm9C1BTXnIrDukkf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 29518, 'output_tokens': 36, 'total_tokens': 29554, 'input_token_details': {'audio': 0, 'cache_read': 26752}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:23:25,106 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_XVNyey4tyAM5VHpFJXCvoAdA', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/meta/Window.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 29611, 'total_tokens': 29648, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 25600}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--824f37ca-aaeb-41e7-8745-74d5bf33c0c8-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/meta/Window.ts'}, 'id': 'call_XVNyey4tyAM5VHpFJXCvoAdA', 'type': 'tool_call'}] usage_metadata={'input_tokens': 29611, 'output_tokens': 37, 'total_tokens': 29648, 'input_token_details': {'audio': 0, 'cache_read': 25600}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:23:36,896 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Sj3cyTgsRh6ElVy17qqGRvnx', 'function': {'arguments': '{"relative_path":"src/generators/dom/index.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 611, 'prompt_tokens': 32172, 'total_tokens': 32783, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2aa5a4d9-22f1-4f11-a59e-183501c87256-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/dom/index.ts'}, 'id': 'call_Sj3cyTgsRh6ElVy17qqGRvnx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 32172, 'output_tokens': 611, 'total_tokens': 32783, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-10 23:23:38,969 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_aZc6kJJTDDrZsLx28dSF6Iek', 'function': {'arguments': '{"relative_path":"src/generators/dom/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 32251, 'total_tokens': 32281, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--13f09c8e-bf1d-475b-8fe9-5e170cbc657c-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/index.ts'}, 'id': 'call_aZc6kJJTDDrZsLx28dSF6Iek', 'type': 'tool_call'}] usage_metadata={'input_tokens': 32251, 'output_tokens': 30, 'total_tokens': 32281, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:23:41,062 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_K0nH5X2nR1v7c74Zc3cHDUCM', 'function': {'arguments': '{"basename":"Selector.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 37457, 'total_tokens': 37480, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 32256}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ca2758a4-89e9-441c-b393-2bef3e0a9f7c-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Selector.ts'}, 'id': 'call_K0nH5X2nR1v7c74Zc3cHDUCM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37457, 'output_tokens': 23, 'total_tokens': 37480, 'input_token_details': {'audio': 0, 'cache_read': 32256}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:23:42,939 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_vuAncPZuZZZsIF8hQWVHtcwF', 'function': {'arguments': '{"basename":"Stylesheet.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 37528, 'total_tokens': 37552, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 29440}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a8a7ba61-9987-4dc6-b1c3-06c23225885c-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Stylesheet.ts'}, 'id': 'call_vuAncPZuZZZsIF8hQWVHtcwF', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37528, 'output_tokens': 24, 'total_tokens': 37552, 'input_token_details': {'audio': 0, 'cache_read': 29440}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:23:45,300 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_pHvAG1SwzDMu67i71L36smH8', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 37602, 'total_tokens': 37634, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--43298405-fad7-4ca9-8f4d-30d1ff883203-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts'}, 'id': 'call_pHvAG1SwzDMu67i71L36smH8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37602, 'output_tokens': 32, 'total_tokens': 37634, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:23:46,991 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hAebp0mMsZEMbaRQJdEk0IVV', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 37687, 'total_tokens': 37720, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 37504}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a6e1f2f2-2b05-4fb3-a16f-733a880e9e10-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts'}, 'id': 'call_hAebp0mMsZEMbaRQJdEk0IVV', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37687, 'output_tokens': 33, 'total_tokens': 37720, 'input_token_details': {'audio': 0, 'cache_read': 37504}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:24:07,498 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_RZJ1Q1e0FPcspiBl4bqKLHj9', 'function': {'arguments': '{"relative_path":"src/parse/state"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1184, 'prompt_tokens': 39973, 'total_tokens': 41157, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1152, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 15616}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ae567776-c6d0-4e57-8e04-8e07cfca3292-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/parse/state'}, 'id': 'call_RZJ1Q1e0FPcspiBl4bqKLHj9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 39973, 'output_tokens': 1184, 'total_tokens': 41157, 'input_token_details': {'audio': 0, 'cache_read': 15616}, 'output_token_details': {'audio': 0, 'reasoning': 1152}}
2025-11-10 23:24:09,529 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ObRe02wPFmb1JnpPX4CgF64M', 'function': {'arguments': '{"basename":"fragment.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 40045, 'total_tokens': 40068, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 37376}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--261ad7c0-7a32-41a7-a717-f5cc5008be46-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'fragment.ts'}, 'id': 'call_ObRe02wPFmb1JnpPX4CgF64M', 'type': 'tool_call'}] usage_metadata={'input_tokens': 40045, 'output_tokens': 23, 'total_tokens': 40068, 'input_token_details': {'audio': 0, 'cache_read': 37376}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:24:11,573 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_AxOLNtpLZjTE8cyq7i3DtAO3', 'function': {'arguments': '{"relative_path":"src/parse/state/fragment.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 40118, 'total_tokens': 40148, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12160}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a3b589f3-44dd-49d5-9cc2-b220281472bd-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/parse/state/fragment.ts'}, 'id': 'call_AxOLNtpLZjTE8cyq7i3DtAO3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 40118, 'output_tokens': 30, 'total_tokens': 40148, 'input_token_details': {'audio': 0, 'cache_read': 12160}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:24:13,131 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_X50imB634yfIEGCn1Xy53wm4', 'function': {'arguments': '{"relative_path":"src/parse/state/tag.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 40354, 'total_tokens': 40382, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 40064}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--27eeb60a-0855-4a87-85c7-1c29db321674-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/parse/state/tag.ts'}, 'id': 'call_X50imB634yfIEGCn1Xy53wm4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 40354, 'output_tokens': 28, 'total_tokens': 40382, 'input_token_details': {'audio': 0, 'cache_read': 40064}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:24:15,438 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_SJR9dgGFF9ecXe3sZL5UKoK9', 'function': {'arguments': '{"relative_path":"src/parse/state/tag.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 40431, 'total_tokens': 40460, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 27136}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--488ede60-5c5f-4003-a15f-1cda17c226dd-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/parse/state/tag.ts'}, 'id': 'call_SJR9dgGFF9ecXe3sZL5UKoK9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 40431, 'output_tokens': 29, 'total_tokens': 40460, 'input_token_details': {'audio': 0, 'cache_read': 27136}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:24:38,650 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I retrieved the full contents with line numbers for src/parse/read/directives.ts, the Element visitor implementation (src/generators/dom/visitors/Element/Element.ts) and the specific ref/event/binding/attribute visitors (including src/generators/dom/visitors/Element/Ref.ts and Component/Ref.ts). I also fetched the requested README.md plus the CSS selector processing files src/css/Selector.ts and src/css/Stylesheet.ts to cover CSS scoping. The test samples for event-handler-ref and event-handler-ref-invalid were included, and I added relevant DOM/SSR modules (dom/index.ts and ssr/visitors/Element.ts) showing where refs are created/used in DOM and that SSR doesn’t compile refs. Note that src/generators/dom/visitors/Element/index.ts was not present; I used Element/Element.ts as the main Element visitor entry.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1473, 'prompt_tokens': 44830, 'total_tokens': 46303, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1280, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 15488}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--478623a6-9d5f-4e96-a47b-0b7ad76b3b96-0' usage_metadata={'input_tokens': 44830, 'output_tokens': 1473, 'total_tokens': 46303, 'input_token_details': {'audio': 0, 'cache_read': 15488}, 'output_token_details': {'audio': 0, 'reasoning': 1280}}
2025-11-10 23:24:38,656 - thread-133013312636608.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content with line numbers of src/parse/read/directives.ts, src/generators/dom/visitors/Element/index.ts (and any Element visitor files that handle ref directives), README.md sections covering refs and CSS scoping, and test/validator/samples/event-handler-ref/input.html plus event-handler-ref-invalid/input.html.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If ref handling is implemented outside Element visitors, include the module where ref directives are compiled (DOM/SSR) and the CSS selector processing files (src/css/Selector.ts or Stylesheet.ts).
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
This context will confirm existing ref semantics and CSS capabilities so I can accurately classify the issue as a feature request, bug, documentation update, or question.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: README.md
Line number range: 1 - 100
Content:
1. # Svelte
2. 
3. The magical disappearing UI framework.
4. 
5. * [Read the introductory blog post](https://svelte.technology/blog/frameworks-without-the-framework/)
6. * [Read the guide](https://svelte.technology/guide)
7. * [Try it out](https://svelte.technology/repl)
8. * [Chat on Gitter](https://gitter.im/sveltejs/svelte)
9. 
10. ---
11. 
12. This is the Svelte compiler, which is primarily intended for authors of tooling that integrates Svelte with different build systems. If you just want to write Svelte components and use them in your app, you probably want one of those tools:
13. 
14. * [svelte-cli](https://github.com/sveltejs/svelte-cli) – Command line interface for compiling components
15. * [rollup-plugin-svelte](https://github.com/rollup/rollup-plugin-svelte) – Rollup plugin
16. * [sveltify](https://github.com/tehshrike/sveltify) - Browserify transform
17. * [gulp-svelte](https://github.com/shinnn/gulp-svelte) - gulp plugin
18. * [metalsmith-svelte](https://github.com/shinnn/metalsmith-svelte) - Metalsmith plugin
19. * [system-svelte](https://github.com/CanopyTax/system-svelte) – System.js loader
20. * [svelte-loader](https://github.com/sveltejs/svelte-loader) – Webpack loader
21. * [meteor-svelte](https://github.com/klaussner/meteor-svelte) – Meteor build plugin
22. * More to come!
23. 
24. 
25. ## Example usage
26. 
27. ```js
28. import * as svelte from 'svelte';
29. 
30. const { code, map } = svelte.compile( source, {
31. 	// the target module format – defaults to 'es' (ES2015 modules), can
32. 	// also be 'amd', 'cjs', 'umd', 'iife' or 'eval'
33. 	format: 'umd',
34. 
35. 	// the filename of the source file, used in e.g. generating sourcemaps
36. 	filename: 'MyComponent.html',
37. 
38. 	// the name of the constructor. Required for 'iife' and 'umd' output,
39. 	// but otherwise mostly useful for debugging. Defaults to 'SvelteComponent'
40. 	name: 'MyComponent',
41. 
42. 	// for 'amd' and 'umd' output, you can optionally specify an AMD module ID
43. 	amd: {
44. 		id: 'my-component'
45. 	},
46. 
47. 	// custom error/warning handlers. By default, errors will throw, and
48. 	// warnings will be printed to the console. Where applicable, the
49. 	// error/warning object will have `pos`, `loc` and `frame` properties
50. 	onerror: err => {
51. 		console.error( err.message );
52. 	},
53. 
54. 	onwarn: warning => {
55. 		console.warn( warning.message );
56. 	}
57. });
58. ```
59. 
60. 
61. ## API
62. 
63. The Svelte compiler exposes the following API:
64. 
65. * `compile( source [, options ] ) => { code, map, ast, css }` - Compile the component with the given options (see below). Returns an object containing the compiled JavaScript, a sourcemap, an AST and transformed CSS.
66. * `create( source [, options ] ) => function` - Compile the component and return the component itself.
67. * `VERSION` - The version of this copy of the Svelte compiler as a string, `'x.x.x'`.
68. 
69. ### Options
70. 
71. The Svelte compiler optionally takes a second argument, an object of configuration options:
72. 
73. | | **Values** | **Description** | **Defaults** |
74. |---|---|---|---|
75. | `format` | `'es'`, `'amd'`, `'cjs'`, `'umd'`, `'iife'`, `'eval'` | The format to output in the compiled component.<br>`'es'` - ES6/ES2015 module, suitable for consumption by a bundler<br>`'amd'` - AMD module<br>`'cjs'` - CommonJS module<br>`'iife'` - IIFE-wrapped function defining a global variable, suitable for use directly in browser<br>`'eval'` - standalone function, suitable for passing to `eval()` | `'es'` for `generate: 'dom'`<br>`'cjs'` for `generate: 'ssr'` |
76. | `generate` | `'dom'`, `'ssr'` | Whether to generate JavaScript code intended for use on the client (`'dom'`), or for use in server-side rendering (`'ssr'`). | `'dom'` |
77. | `name` | `string` | The name of the constructor in the compiled component. | `'SvelteComponent'` |
78. | `filename` | `string` | The filename to use in sourcemaps and compiler error and warning messages. | `'SvelteComponent.html'` |
79. | `amd`.`id` | `string` | The AMD module ID to use for the `'amd'` and `'umd'` output formats. | `undefined` |
80. | `cascade` | `true`, `false` | Whether to cascade all of the component's styles to child components. If `false`, only selectors wrapped in `:global(...)` and keyframe IDs beginning with `-global-` are cascaded. | `true` |
81. | `shared` | `true`, `false`, `string` | Whether to import various helpers from a shared external library. When you have a project with multiple components, this reduces the overall size of your JavaScript bundle, at the expense of having immediately-usable component. You can pass a string of the module path to use, or `true` will import from `'svelte/shared.js'`. | `false` |
82. | `dev` | `true`, `false` | Whether to enable run-time checks in the compiled component. These are helpful during development, but slow your component down. | `false` |
83. | `css` | `true`, `false` | Whether to include code to inject your component's styles into the DOM. | `true` |
84. | `globals` | `object`, `function` | When outputting to the `'umd'`, `'iife'` or `'eval'` formats, an object or function mapping the names of imported dependencies to the names of global variables. | `{}` |
85. | `onerror` | `function` | Specify a callback for when Svelte encounters an error while compiling the component. | (exception is thrown) |
86. | `onwarn` | `function` | Specify a callback for when Svelte encounters a non-fatal warning while compiling the component. | (warning is logged to console) |
87. 
88. ## Example/starter repos
89. 
90. * [charpeni/svelte-example](https://github.com/charpeni/svelte-example) - Some Svelte examples with configured Rollup, Babel, ESLint, directives, Two-Way binding, and nested components
91. * [EmilTholin/svelte-test](https://github.com/EmilTholin/svelte-test)
92. * [lukechinworth/codenames](https://github.com/lukechinworth/codenames/tree/svelte) – example integration with Redux
93. 
94. ## BrowserStack
95. <img src="https://cdn.worldvectorlogo.com/logos/browserstack.svg" height="80" width="80" align="left">
96. <p>To keep Svelte's performance in check, we use BrowserStack to quickly run benchmarks for each PR that immediately give feedback to the contributor. You can see how we use BrowserStack in the <a href="https://github.com/sveltejs/svelte-bench">svelte-bench</a> project and check out BrowserStack's services on their <a href="https://www.browserstack.com/">website</a>.</p>
97. 
98. ## License
99. 
100. [MIT](LICENSE)


File: src/css/Selector.ts
Line number range: 1 - 266
Content:
1. import MagicString from 'magic-string';
2. import { gatherPossibleValues, UNKNOWN } from './gatherPossibleValues';
3. import { Validator } from '../validate/index';
4. import { Node } from '../interfaces';
5. 
6. export default class Selector {
7. 	node: Node;
8. 	blocks: Block[];
9. 	localBlocks: Block[];
10. 	used: boolean;
11. 
12. 	constructor(node: Node) {
13. 		this.node = node;
14. 
15. 		this.blocks = groupSelectors(node);
16. 
17. 		// take trailing :global(...) selectors out of consideration
18. 		let i = this.blocks.length;
19. 		while (i > 0) {
20. 			if (!this.blocks[i - 1].global) break;
21. 			i -= 1;
22. 		}
23. 
24. 		this.localBlocks = this.blocks.slice(0, i);
25. 		this.used = this.blocks[0].global;
26. 	}
27. 
28. 	apply(node: Node, stack: Node[]) {
29. 		const applies = selectorAppliesTo(this.localBlocks.slice(), node, stack.slice());
30. 
31. 		if (applies) {
32. 			this.used = true;
33. 
34. 			// add svelte-123xyz attribute to outermost and innermost
35. 			// elements — no need to add it to intermediate elements
36. 			node._needsCssAttribute = true;
37. 			if (stack[0] && this.node.children.find(isDescendantSelector)) stack[0]._needsCssAttribute = true;
38. 		}
39. 	}
40. 
41. 	minify(code: MagicString) {
42. 		let c: number = null;
43. 		this.blocks.forEach((block, i) => {
44. 			if (i > 0) {
45. 				if (block.start - c > 1) {
46. 					code.overwrite(c, block.start, block.combinator.name || ' ');
47. 				}
48. 			}
49. 
50. 			c = block.end;
51. 		});
52. 	}
53. 
54. 	transform(code: MagicString, attr: string) {
55. 		function encapsulateBlock(block: Block) {
56. 			let i = block.selectors.length;
57. 			while (i--) {
58. 				const selector = block.selectors[i];
59. 				if (selector.type === 'PseudoElementSelector' || selector.type === 'PseudoClassSelector') continue;
60. 
61. 				if (selector.type === 'TypeSelector' && selector.name === '*') {
62. 					code.overwrite(selector.start, selector.end, attr);
63. 				} else {
64. 					code.appendLeft(selector.end, attr);
65. 				}
66. 
67. 				return;
68. 			}
69. 		}
70. 
71. 		this.blocks.forEach((block, i) => {
72. 			if (block.global) {
73. 				const selector = block.selectors[0];
74. 				const first = selector.children[0];
75. 				const last = selector.children[selector.children.length - 1];
76. 				code.remove(selector.start, first.start).remove(last.end, selector.end);
77. 			} else if (i === 0 || i === this.blocks.length - 1) {
78. 				encapsulateBlock(block);
79. 			}
80. 		});
81. 	}
82. 
83. 	validate(validator: Validator) {
84. 		this.blocks.forEach((block) => {
85. 			let i = block.selectors.length;
86. 			while (i-- > 1) {
87. 				const selector = block.selectors[i];
88. 				if (selector.type === 'PseudoClassSelector' && selector.name === 'global') {
89. 					validator.error(`:global(...) must be the first element in a compound selector`, selector.start);
90. 				}
91. 			}
92. 		});
93. 
94. 		let start = 0;
95. 		let end = this.blocks.length;
96. 
97. 		for (; start < end; start += 1) {
98. 			if (!this.blocks[start].global) break;
99. 		}
100. 
101. 		for (; end > start; end -= 1) {
102. 			if (!this.blocks[end - 1].global) break;
103. 		}
104. 
105. 		for (let i = start; i < end; i += 1) {
106. 			if (this.blocks[i].global) {
107. 				validator.error(`:global(...) can be at the start or end of a selector sequence, but not in the middle`, this.blocks[i].selectors[0].start);
108. 			}
109. 		}
110. 	}
111. }
112. 
113. function isDescendantSelector(selector: Node) {
114. 	return selector.type === 'WhiteSpace' || selector.type === 'Combinator';
115. }
116. 
117. function selectorAppliesTo(blocks: Block[], node: Node, stack: Node[]): boolean {
118. 	const block = blocks.pop();
119. 	if (!block) return false;
120. 
121. 	if (!node) {
122. 		return blocks.every(block => block.global);
123. 	}
124. 
125. 	let i = block.selectors.length;
126. 	let j = stack.length;
127. 
128. 	while (i--) {
129. 		const selector = block.selectors[i];
130. 
131. 		if (selector.type === 'PseudoClassSelector' && selector.name === 'global') {
132. 			// TODO shouldn't see this here... maybe we should enforce that :global(...)
133. 			// cannot be sandwiched between non-global selectors?
134. 			return false;
135. 		}
136. 
137. 		if (selector.type === 'PseudoClassSelector' || selector.type === 'PseudoElementSelector') {
138. 			continue;
139. 		}
140. 
141. 		if (selector.type === 'ClassSelector') {
142. 			if (!attributeMatches(node, 'class', selector.name, '~=', false)) return false;
143. 		}
144. 
145. 		else if (selector.type === 'IdSelector') {
146. 			if (!attributeMatches(node, 'id', selector.name, '=', false)) return false;
147. 		}
148. 
149. 		else if (selector.type === 'AttributeSelector') {
150. 			if (!attributeMatches(node, selector.name.name, selector.value && unquote(selector.value.value), selector.operator, selector.flags)) return false;
151. 		}
152. 
153. 		else if (selector.type === 'TypeSelector') {
154. 			if (node.name !== selector.name && selector.name !== '*') return false;
155. 		}
156. 
157. 		else {
158. 			// bail. TODO figure out what these could be
159. 			return true;
160. 		}
161. 	}
162. 
163. 	if (block.combinator) {
164. 		if (block.combinator.type === 'WhiteSpace') {
165. 			while (stack.length) {
166. 				if (selectorAppliesTo(blocks.slice(), stack.pop(), stack)) {
167. 					return true;
168. 				}
169. 			}
170. 
171. 			return false;
172. 		} else if (block.combinator.name === '>') {
173. 			return selectorAppliesTo(blocks, stack.pop(), stack);
174. 		}
175. 
176. 		// TODO other combinators
177. 		return true;
178. 	}
179. 
180. 	return true;
181. }
182. 
183. const operators = {
184. 	'=' : (value: string, flags: string) => new RegExp(`^${value}$`, flags),
185. 	'~=': (value: string, flags: string) => new RegExp(`\\b${value}\\b`, flags),
186. 	'|=': (value: string, flags: string) => new RegExp(`^${value}(-.+)?$`, flags),
187. 	'^=': (value: string, flags: string) => new RegExp(`^${value}`, flags),
188. 	'$=': (value: string, flags: string) => new RegExp(`${value}$`, flags),
189. 	'*=': (value: string, flags: string) => new RegExp(value, flags)
190. };
191. 
192. function attributeMatches(node: Node, name: string, expectedValue: string, operator: string, caseInsensitive: boolean) {
193. 	const attr = node.attributes.find((attr: Node) => attr.name === name);
194. 	if (!attr) return false;
195. 	if (attr.value === true) return operator === null;
196. 	if (attr.value.length > 1) return true;
197. 
198. 	const pattern = operators[operator](expectedValue, caseInsensitive ? 'i' : '');
199. 	const value = attr.value[0];
200. 
201. 	if (value.type === 'Text') return pattern.test(value.data);
202. 
203. 	const possibleValues = new Set();
204. 	gatherPossibleValues(value.expression, possibleValues);
205. 	if (possibleValues.has(UNKNOWN)) return true;
206. 
207. 	for (const x of Array.from(possibleValues)) { // TypeScript for-of is slightly unlike JS
208. 		if (pattern.test(x)) return true;
209. 	}
210. 
211. 	return false;
212. }
213. 
214. function isDynamic(value: Node) {
215. 	return value.length > 1 || value[0].type !== 'Text';
216. }
217. 
218. function unquote(str: string) {
219. 	if (str[0] === str[str.length - 1] && str[0] === "'" || str[0] === '"') {
220. 		return str.slice(1, str.length - 1);
221. 	}
222. }
223. 
224. class Block {
225. 	global: boolean;
226. 	combinator: Node;
227. 	selectors: Node[]
228. 	start: number;
229. 	end: number;
230. 
231. 	constructor(combinator: Node) {
232. 		this.combinator = combinator;
233. 		this.global = false;
234. 		this.selectors = [];
235. 
236. 		this.start = null;
237. 		this.end = null;
238. 	}
239. 
240. 	add(selector: Node) {
241. 		if (this.selectors.length === 0) {
242. 			this.start = selector.start;
243. 			this.global = selector.type === 'PseudoClassSelector' && selector.name === 'global';
244. 		}
245. 
246. 		this.selectors.push(selector);
247. 		this.end = selector.end;
248. 	}
249. }
250. 
251. function groupSelectors(selector: Node) {
252. 	let block: Block = new Block(null);
253. 
254. 	const blocks = [block];
255. 
256. 	selector.children.forEach((child: Node, i: number) => {
257. 		if (child.type === 'WhiteSpace' || child.type === 'Combinator') {
258. 			block = new Block(child);
259. 			blocks.push(block);
260. 		} else {
261. 			block.add(child);
262. 		}
263. 	});
264. 
265. 	return blocks;
266. }


File: src/css/Stylesheet.ts
Line number range: 1 - 362
Content:
1. import MagicString from 'magic-string';
2. import { walk } from 'estree-walker';
3. import { getLocator } from 'locate-character';
4. import Selector from './Selector';
5. import getCodeFrame from '../utils/getCodeFrame';
6. import { Validator } from '../validate/index';
7. import { Node, Parsed, Warning } from '../interfaces';
8. 
9. class Rule {
10. 	selectors: Selector[];
11. 	declarations: Declaration[];
12. 	node: Node;
13. 	parent: Atrule;
14. 
15. 	constructor(node: Node, parent: Atrule) {
16. 		this.node = node;
17. 		this.parent = parent;
18. 		this.selectors = node.selector.children.map((node: Node) => new Selector(node));
19. 		this.declarations = node.block.children.map((node: Node) => new Declaration(node));
20. 
21. 		if (parent) parent.rules.push(this);
22. 	}
23. 
24. 	apply(node: Node, stack: Node[]) {
25. 		this.selectors.forEach(selector => selector.apply(node, stack)); // TODO move the logic in here?
26. 	}
27. 
28. 	isUsed() {
29. 		if (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;
30. 		return this.selectors.some(s => s.used);
31. 	}
32. 
33. 	minify(code: MagicString, cascade: boolean) {
34. 		let c = this.node.start;
35. 		this.selectors.forEach((selector, i) => {
36. 			if (cascade || selector.used) {
37. 				const separator = i > 0 ? ',' : '';
38. 				if ((selector.node.start - c) > separator.length) {
39. 					code.overwrite(c, selector.node.start, separator);
40. 				}
41. 
42. 				selector.minify(code);
43. 				c = selector.node.end;
44. 			}
45. 		});
46. 
47. 		code.remove(c, this.node.block.start);
48. 
49. 		c = this.node.block.start + 1;
50. 		this.declarations.forEach((declaration, i) => {
51. 			const separator = i > 0 ? ';' : '';
52. 			if ((declaration.node.start - c) > separator.length) {
53. 				code.overwrite(c, declaration.node.start, separator);
54. 			}
55. 
56. 			declaration.minify(code);
57. 
58. 			c = declaration.node.end;
59. 		});
60. 
61. 		code.remove(c, this.node.block.end - 1);
62. 	}
63. 
64. 	transform(code: MagicString, id: string, keyframes: Map<string, string>, cascade: boolean) {
65. 		if (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;
66. 
67. 		const attr = `[${id}]`;
68. 
69. 		if (cascade) {
70. 			this.selectors.forEach(selector => {
71. 				// TODO disable cascading (without :global(...)) in v2
72. 				const { start, end, children } = selector.node;
73. 
74. 				const css = code.original;
75. 				const selectorString = css.slice(start, end);
76. 
77. 				const firstToken = children[0];
78. 
79. 				let transformed;
80. 
81. 				if (firstToken.type === 'TypeSelector') {
82. 					const insert = firstToken.end;
83. 					const head = firstToken.name === '*' ? '' : css.slice(start, insert);
84. 					const tail = css.slice(insert, end);
85. 
86. 					transformed = `${head}${attr}${tail},${attr} ${selectorString}`;
87. 				} else {
88. 					transformed = `${attr}${selectorString},${attr} ${selectorString}`;
89. 				}
90. 
91. 				code.overwrite(start, end, transformed);
92. 			});
93. 		} else {
94. 			this.selectors.forEach(selector => selector.transform(code, attr));
95. 		}
96. 
97. 		this.declarations.forEach(declaration => declaration.transform(code, keyframes));
98. 	}
99. }
100. 
101. class Declaration {
102. 	node: Node;
103. 
104. 	constructor(node: Node) {
105. 		this.node = node;
106. 	}
107. 
108. 	transform(code: MagicString, keyframes: Map<string, string>) {
109. 		const property = this.node.property.toLowerCase();
110. 		if (property === 'animation' || property === 'animation-name') {
111. 			this.node.value.children.forEach((block: Node) => {
112. 				if (block.type === 'Identifier') {
113. 					const name = block.name;
114. 					if (keyframes.has(name)) {
115. 						code.overwrite(block.start, block.end, keyframes.get(name));
116. 					}
117. 				}
118. 			});
119. 		}
120. 	}
121. 
122. 	minify(code: MagicString) {
123. 		const c = this.node.start + this.node.property.length;
124. 		const first = this.node.value.children[0];
125. 
126. 		if (first.start - c > 1) {
127. 			code.overwrite(c, first.start, ':');
128. 		}
129. 	}
130. }
131. 
132. class Atrule {
133. 	node: Node;
134. 	rules: Rule[];
135. 
136. 	constructor(node: Node) {
137. 		this.node = node;
138. 		this.rules = [];
139. 	}
140. 
141. 	isUsed() {
142. 		return true; // TODO
143. 	}
144. 
145. 	minify(code: MagicString, cascade: boolean) {
146. 		if (this.node.name === 'media') {
147. 			let c = this.node.start + 6;
148. 			if (this.node.expression.start > c) code.remove(c, this.node.expression.start);
149. 
150. 			this.node.expression.children.forEach((query: Node) => {
151. 				// TODO minify queries
152. 				c = query.end;
153. 			});
154. 
155. 			code.remove(c, this.node.block.start);
156. 		} else if (this.node.name === 'keyframes') {
157. 			let c = this.node.start + 10;
158. 			if (this.node.expression.start - c > 1) code.overwrite(c, this.node.expression.start, ' ');
159. 			c = this.node.expression.end;
160. 			if (this.node.block.start - c > 0) code.remove(c, this.node.block.start);
161. 		}
162. 
163. 		// TODO other atrules
164. 
165. 		if (this.node.block) {
166. 			let c = this.node.block.start + 1;
167. 
168. 			this.rules.forEach(rule => {
169. 				if (cascade || rule.isUsed()) {
170. 					code.remove(c, rule.node.start);
171. 					rule.minify(code, cascade);
172. 					c = rule.node.end;
173. 				}
174. 			});
175. 
176. 			code.remove(c, this.node.block.end - 1);
177. 		}
178. 	}
179. 
180. 	transform(code: MagicString, id: string, keyframes: Map<string, string>) {
181. 		if (this.node.name !== 'keyframes') return;
182. 
183. 		this.node.expression.children.forEach((expression: Node) => {
184. 			if (expression.type === 'Identifier') {
185. 				if (expression.name.startsWith('-global-')) {
186. 					code.remove(expression.start, expression.start + 8);
187. 				} else {
188. 					const newName = `${id}-${expression.name}`;
189. 					code.overwrite(expression.start, expression.end, newName);
190. 					keyframes.set(expression.name, newName);
191. 				}
192. 			}
193. 		});
194. 	}
195. }
196. 
197. const keys = {};
198. 
199. export default class Stylesheet {
200. 	source: string;
201. 	parsed: Parsed;
202. 	cascade: boolean;
203. 	filename: string;
204. 
205. 	hasStyles: boolean;
206. 	id: string;
207. 
208. 	nodes: (Rule|Atrule)[];
209. 	rules: Rule[];
210. 	atrules: Atrule[];
211. 
212. 	constructor(source: string, parsed: Parsed, filename: string, cascade: boolean) {
213. 		this.source = source;
214. 		this.parsed = parsed;
215. 		this.cascade = cascade;
216. 		this.filename = filename;
217. 
218. 		this.id = `svelte-${parsed.hash}`;
219. 
220. 		this.nodes = [];
221. 		this.rules = [];
222. 		this.atrules = [];
223. 
224. 		if (parsed.css && parsed.css.children.length) {
225. 			this.hasStyles = true;
226. 
227. 			const stack: Atrule[] = [];
228. 			let currentAtrule: Atrule = null;
229. 
230. 			walk(this.parsed.css, {
231. 				enter: (node: Node) => {
232. 					if (node.type === 'Atrule') {
233. 						const atrule = currentAtrule = new Atrule(node);
234. 						stack.push(atrule);
235. 
236. 						this.nodes.push(atrule);
237. 						this.atrules.push(atrule);
238. 					}
239. 
240. 					if (node.type === 'Rule') {
241. 						// TODO this is a bit confusing. Don't have a separate
242. 						// array of rules, just transform top-level nodes and
243. 						// let them worry about their children
244. 						const rule = new Rule(node, currentAtrule);
245. 
246. 						this.rules.push(rule);
247. 
248. 						if (!currentAtrule) {
249. 							this.nodes.push(rule);
250. 						}
251. 					}
252. 				},
253. 
254. 				leave: (node: Node) => {
255. 					if (node.type === 'Atrule') {
256. 						stack.pop();
257. 						currentAtrule = stack[stack.length - 1];
258. 					}
259. 				}
260. 			});
261. 		} else {
262. 			this.hasStyles = false;
263. 		}
264. 	}
265. 
266. 	apply(node: Node, stack: Node[]) {
267. 		if (!this.hasStyles) return;
268. 
269. 		if (this.cascade) {
270. 			if (stack.length === 0) node._needsCssAttribute = true;
271. 			return;
272. 		}
273. 
274. 		for (let i = 0; i < this.rules.length; i += 1) {
275. 			const rule = this.rules[i];
276. 			rule.apply(node, stack);
277. 		}
278. 	}
279. 
280. 	render(cssOutputFilename: string) {
281. 		if (!this.hasStyles) {
282. 			return { css: null, cssMap: null };
283. 		}
284. 
285. 		const code = new MagicString(this.source);
286. 
287. 		walk(this.parsed.css, {
288. 			enter: (node: Node) => {
289. 				code.addSourcemapLocation(node.start);
290. 				code.addSourcemapLocation(node.end);
291. 			}
292. 		});
293. 
294. 		// TODO all transform/minify in single pass. The mutation of
295. 		// `keyframes` here is confusing
296. 		const keyframes = new Map();
297. 		this.atrules.forEach((atrule: Atrule) => {
298. 			atrule.transform(code, this.id, keyframes);
299. 		});
300. 
301. 		this.rules.forEach((rule: Rule) => {
302. 			rule.transform(code, this.id, keyframes, this.cascade);
303. 		});
304. 
305. 		let c = 0;
306. 		this.nodes.forEach(node => {
307. 			if (this.cascade || node.isUsed()) {
308. 				code.remove(c, node.node.start);
309. 				node.minify(code, this.cascade);
310. 				c = node.node.end;
311. 			}
312. 		});
313. 
314. 		code.remove(c, this.source.length);
315. 
316. 		return {
317. 			css: code.toString(),
318. 			cssMap: code.generateMap({
319. 				includeContent: true,
320. 				source: this.filename,
321. 				file: cssOutputFilename
322. 			})
323. 		};
324. 	}
325. 
326. 	validate(validator: Validator) {
327. 		this.rules.forEach(rule => {
328. 			rule.selectors.forEach(selector => {
329. 				selector.validate(validator);
330. 			});
331. 		});
332. 	}
333. 
334. 	warnOnUnusedSelectors(onwarn: (warning: Warning) => void) {
335. 		if (this.cascade) return;
336. 
337. 		let locator;
338. 
339. 		this.rules.forEach((rule: Rule) => {
340. 			rule.selectors.forEach(selector => {
341. 				if (!selector.used) {
342. 					const pos = selector.node.start;
343. 
344. 					if (!locator) locator = getLocator(this.source);
345. 					const { line, column } = locator(pos);
346. 
347. 					const frame = getCodeFrame(this.source, line, column);
348. 					const message = `Unused CSS selector`;
349. 
350. 					onwarn({
351. 						message,
352. 						frame,
353. 						loc: { line: line + 1, column },
354. 						pos,
355. 						filename: this.filename,
356. 						toString: () => `${message} (${line + 1}:${column})\n${frame}`,
357. 					});
358. 				}
359. 			});
360. 		});
361. 	}
362. }


File: src/generators/dom/index.ts
Line number range: 1 - 378
Content:
1. import MagicString from 'magic-string';
2. import { parseExpressionAt } from 'acorn';
3. import annotateWithScopes from '../../utils/annotateWithScopes';
4. import isReference from '../../utils/isReference';
5. import { walk } from 'estree-walker';
6. import deindent from '../../utils/deindent';
7. import stringify from '../../utils/stringify';
8. import CodeBuilder from '../../utils/CodeBuilder';
9. import visit from './visit';
10. import shared from './shared';
11. import Generator from '../Generator';
12. import Stylesheet from '../../css/Stylesheet';
13. import preprocess from './preprocess';
14. import Block from './Block';
15. import { Parsed, CompileOptions, Node } from '../../interfaces';
16. 
17. export class DomGenerator extends Generator {
18. 	blocks: Block[];
19. 	readonly: Set<string>;
20. 	metaBindings: string[];
21. 
22. 	hydratable: boolean;
23. 
24. 	hasIntroTransitions: boolean;
25. 	hasOutroTransitions: boolean;
26. 	hasComplexBindings: boolean;
27. 
28. 	needsEncapsulateHelper: boolean;
29. 
30. 	constructor(
31. 		parsed: Parsed,
32. 		source: string,
33. 		name: string,
34. 		stylesheet: Stylesheet,
35. 		options: CompileOptions
36. 	) {
37. 		super(parsed, source, name, stylesheet, options);
38. 		this.blocks = [];
39. 
40. 		this.readonly = new Set();
41. 
42. 		this.hydratable = options.hydratable;
43. 		this.needsEncapsulateHelper = false;
44. 
45. 		// initial values for e.g. window.innerWidth, if there's a <:Window> meta tag
46. 		this.metaBindings = [];
47. 	}
48. }
49. 
50. export default function dom(
51. 	parsed: Parsed,
52. 	source: string,
53. 	stylesheet: Stylesheet,
54. 	options: CompileOptions
55. ) {
56. 	const format = options.format || 'es';
57. 
58. 	const generator = new DomGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
59. 
60. 	const {
61. 		computations,
62. 		hasJs,
63. 		name,
64. 		templateProperties,
65. 		namespace,
66. 	} = generator;
67. 
68. 	const { block, state } = preprocess(generator, namespace, parsed.html);
69. 
70. 	generator.stylesheet.warnOnUnusedSelectors(options.onwarn);
71. 
72. 	parsed.html.children.forEach((node: Node) => {
73. 		visit(generator, block, state, node, []);
74. 	});
75. 
76. 	const builder = new CodeBuilder();
77. 
78. 	if (computations.length) {
79. 		const computationBuilder = new CodeBuilder();
80. 
81. 		computations.forEach(({ key, deps }) => {
82. 			if (generator.readonly.has(key)) {
83. 				// <:Window> bindings
84. 				throw new Error(
85. 					`Cannot have a computed value '${key}' that clashes with a read-only property`
86. 				);
87. 			}
88. 
89. 			generator.readonly.add(key);
90. 
91. 			const condition = `isInitial || ${deps
92. 				.map(
93. 					dep =>
94. 						`( '${dep}' in newState && @differs( state.${dep}, oldState.${dep} ) )`
95. 				)
96. 				.join(' || ')}`;
97. 			const statement = `state.${key} = newState.${key} = @template.computed.${key}( ${deps
98. 				.map(dep => `state.${dep}`)
99. 				.join(', ')} );`;
100. 
101. 			computationBuilder.addConditionalLine(condition, statement);
102. 		});
103. 
104. 		builder.addBlock(deindent`
105. 			function @recompute ( state, newState, oldState, isInitial ) {
106. 				${computationBuilder}
107. 			}
108. 		`);
109. 	}
110. 
111. 	const _set = deindent`
112. 		${options.dev &&
113. 			deindent`
114. 			if ( typeof newState !== 'object' ) {
115. 				throw new Error( 'Component .set was called without an object of data key-values to update.' );
116. 			}
117. 
118. 			${Array.from(generator.readonly).map(
119. 				prop =>
120. 					`if ( '${prop}' in newState && !this._updatingReadonlyProperty ) throw new Error( "Cannot set read-only property '${prop}'" );`
121. 			)}
122. 		`}
123. 
124. 		var oldState = this._state;
125. 		this._state = @assign( {}, oldState, newState );
126. 		${computations.length &&
127. 			`@recompute( this._state, newState, oldState, false )`}
128. 		@dispatchObservers( this, this._observers.pre, newState, oldState );
129. 		${block.hasUpdateMethod && `this._fragment.update( newState, this._state );`}
130. 		@dispatchObservers( this, this._observers.post, newState, oldState );
131. 	`;
132. 
133. 	if (hasJs) {
134. 		builder.addBlock(`[✂${parsed.js.content.start}-${parsed.js.content.end}✂]`);
135. 	}
136. 
137. 	if (generator.needsEncapsulateHelper) {
138. 		builder.addBlock(deindent`
139. 			function @encapsulateStyles ( node ) {
140. 				@setAttribute( node, '${generator.stylesheet.id}', '' );
141. 			}
142. 		`);
143. 	}
144. 
145. 	if (generator.stylesheet.hasStyles && options.css !== false) {
146. 		const { css, cssMap } = generator.stylesheet.render(options.filename);
147. 
148. 		const textContent = stringify(options.dev ?
149. 			`${css}\n/*# sourceMappingURL=${cssMap.toUrl()} */` :
150. 			css);
151. 
152. 		builder.addBlock(deindent`
153. 			function @add_css () {
154. 				var style = @createElement( 'style' );
155. 				style.id = '${generator.stylesheet.id}-style';
156. 				style.textContent = ${textContent};
157. 				@appendNode( style, document.head );
158. 			}
159. 		`);
160. 	}
161. 
162. 	generator.blocks.forEach(block => {
163. 		builder.addBlock(block.render());
164. 	});
165. 
166. 	const sharedPath = options.shared === true
167. 		? 'svelte/shared.js'
168. 		: options.shared;
169. 
170. 	const prototypeBase =
171. 		`${name}.prototype` +
172. 		(templateProperties.methods ? `, @template.methods` : '');
173. 	const proto = sharedPath
174. 		? `@proto `
175. 		: deindent`
176. 		{
177. 			${['get', 'fire', 'observe', 'on', 'set']
178. 				.map(n => `${n}: @${n}`)
179. 				.join(',\n')}
180. 		}`;
181. 
182. 	// TODO deprecate component.teardown()
183. 	builder.addBlock(deindent`
184. 		function ${name} ( options ) {
185. 			options = options || {};
186. 			${options.dev &&
187. 				`if ( !options.target && !options._root ) throw new Error( "'target' is a required option" );`}
188. 			${generator.usesRefs && `this.refs = {};`}
189. 			this._state = ${templateProperties.data
190. 				? `@assign( @template.data(), options.data )`
191. 				: `options.data || {}`};
192. 			${generator.metaBindings}
193. 			${computations.length && `@recompute( this._state, this._state, {}, true );`}
194. 			${options.dev &&
195. 				Array.from(generator.expectedProperties).map(
196. 					prop =>
197. 						`if ( !( '${prop}' in this._state ) ) console.warn( "Component was created without expected data property '${prop}'" );`
198. 				)}
199. 			${generator.bindingGroups.length &&
200. 				`this._bindingGroups = [ ${Array(generator.bindingGroups.length)
201. 					.fill('[]')
202. 					.join(', ')} ];`}
203. 
204. 			this._observers = {
205. 				pre: Object.create( null ),
206. 				post: Object.create( null )
207. 			};
208. 
209. 			this._handlers = Object.create( null );
210. 
211. 			this._root = options._root || this;
212. 			this._yield = options._yield;
213. 
214. 			this._destroyed = false;
215. 			${generator.stylesheet.hasStyles &&
216. 				options.css !== false &&
217. 				`if ( !document.getElementById( '${generator.stylesheet.id}-style' ) ) @add_css();`}
218. 
219. 			${templateProperties.oncreate && `var oncreate = @template.oncreate.bind( this );`}
220. 
221. 			${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`
222. 				if ( !options._root ) {
223. 					this._oncreate = [${templateProperties.oncreate && `oncreate`}];
224. 					${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}
225. 					${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}
226. 				} ${templateProperties.oncreate && deindent`
227. 					else {
228. 						this._root._oncreate.push(oncreate);
229. 					}
230. 				`}
231. 			`}
232. 
233. 			this._fragment = @create_main_fragment( this._state, this );
234. 
235. 			if ( options.target ) {
236. 				${generator.hydratable
237. 					? deindent`
238. 						var nodes = @children( options.target );
239. 						options.hydrate ? this._fragment.claim( nodes ) : this._fragment.create();
240. 						nodes.forEach( @detachNode );
241. 					` :
242. 					deindent`
243. 						${options.dev && `if ( options.hydrate ) throw new Error( 'options.hydrate only works if the component was compiled with the \`hydratable: true\` option' );`}
244. 						this._fragment.create();
245. 					`}
246. 				this._fragment.${block.hasIntroMethod ? 'intro' : 'mount'}( options.target, null );
247. 			}
248. 
249. 			${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`
250. 				if ( !options._root ) {
251. 					${generator.hasComponents && `this._lock = true;`}
252. 					${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}
253. 					${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}
254. 					${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}
255. 					${generator.hasComponents && `this._lock = false;`}
256. 				}
257. 			`}
258. 		}
259. 
260. 		@assign( ${prototypeBase}, ${proto});
261. 
262. 		${name}.prototype._set = function _set ( newState ) {
263. 			${_set}
264. 		};
265. 
266. 		${name}.prototype.teardown = ${name}.prototype.destroy = function destroy ( detach ) {
267. 			if ( this._destroyed ) return${options.dev && ` console.warn( 'Component was already destroyed' )`};
268. 			this.fire( 'destroy' );
269. 			${templateProperties.ondestroy && `@template.ondestroy.call( this );`}
270. 
271. 			if ( detach !== false ) this._fragment.unmount();
272. 			this._fragment.destroy();
273. 			this._fragment = null;
274. 
275. 			this._state = {};
276. 			this._destroyed = true;
277. 		};
278. 	`);
279. 
280. 	const usedHelpers = new Set();
281. 
282. 	let result = builder
283. 		.toString()
284. 		.replace(/(\\\\)?([@#])(\w*)/g, (match: string, escaped: string, sigil: string, name: string) => {
285. 			if (escaped) return match.slice(2);
286. 			if (sigil !== '@') return match;
287. 
288. 			if (name in shared) {
289. 				if (options.dev && `${name}Dev` in shared) name = `${name}Dev`;
290. 				usedHelpers.add(name);
291. 			}
292. 
293. 			return generator.alias(name);
294. 		});
295. 
296. 	if (sharedPath) {
297. 		const used = Array.from(usedHelpers).sort();
298. 		if (format === 'es') {
299. 			const names = used.map(name => {
300. 				const alias = generator.alias(name);
301. 				return name !== alias ? `${name} as ${alias}` : name;
302. 			});
303. 
304. 			result =
305. 				`import { ${names.join(', ')} } from ${stringify(sharedPath)};\n\n` +
306. 				result;
307. 		}
308. 
309. 		else if (format === 'cjs') {
310. 			const SHARED = '__shared';
311. 			let requires = `var ${SHARED} = require( ${stringify(sharedPath)} );`;
312. 			used.forEach(name => {
313. 				const alias = generator.alias(name);
314. 				requires += `\nvar ${alias} = ${SHARED}.${name};`;
315. 			});
316. 
317. 			result = `${requires}\n\n${result}`;
318. 		}
319. 
320. 		else {
321. 			throw new Error(`Components with shared helpers must be compiled with \`format: 'es'\` or \`format: 'cjs'\``);
322. 		}
323. 	} else {
324. 		usedHelpers.forEach(key => {
325. 			const str = shared[key];
326. 			const code = new MagicString(str);
327. 			const expression = parseExpressionAt(str, 0);
328. 
329. 			let scope = annotateWithScopes(expression);
330. 
331. 			walk(expression, {
332. 				enter(node: Node, parent: Node) {
333. 					if (node._scope) scope = node._scope;
334. 
335. 					if (
336. 						node.type === 'Identifier' &&
337. 						isReference(node, parent) &&
338. 						!scope.has(node.name)
339. 					) {
340. 						if (node.name in shared) {
341. 							// this helper function depends on another one
342. 							const dependency = node.name;
343. 							usedHelpers.add(dependency);
344. 
345. 							const alias = generator.alias(dependency);
346. 							if (alias !== node.name)
347. 								code.overwrite(node.start, node.end, alias);
348. 						}
349. 					}
350. 				},
351. 
352. 				leave(node: Node) {
353. 					if (node._scope) scope = scope.parent;
354. 				},
355. 			});
356. 
357. 			if (key === 'transitionManager') {
358. 				// special case
359. 				const global = `_svelteTransitionManager`;
360. 
361. 				result += `\n\nvar ${generator.alias(
362. 					'transitionManager'
363. 				)} = window.${global} || ( window.${global} = ${code});`;
364. 			} else {
365. 				const alias = generator.alias(expression.id.name);
366. 				if (alias !== expression.id.name)
367. 					code.overwrite(expression.id.start, expression.id.end, alias);
368. 
369. 				result += `\n\n${code}`;
370. 			}
371. 		});
372. 	}
373. 
374. 	return generator.generate(result, options, {
375. 		name,
376. 		format,
377. 	});
378. }


File: src/generators/dom/visitors/Component/Ref.ts
Line number range: 1 - 22
Content:
1. import deindent from '../../../../utils/deindent';
2. import { DomGenerator } from '../../index';
3. import Block from '../../Block';
4. import { Node } from '../../../../interfaces';
5. import { State } from '../../interfaces';
6. 
7. export default function visitRef(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	attribute: Node,
13. 	local
14. ) {
15. 	generator.usesRefs = true;
16. 
17. 	local.create.addLine(`#component.refs.${attribute.name} = ${local.name};`);
18. 
19. 	block.builders.destroy.addLine(deindent`
20. 		if ( #component.refs.${attribute.name} === ${local.name} ) #component.refs.${attribute.name} = null;
21. 	`);
22. }


File: src/generators/dom/visitors/Element/Attribute.ts
Line number range: 1 - 159
Content:
1. import attributeLookup from './lookup';
2. import deindent from '../../../../utils/deindent';
3. import stringify from '../../../../utils/stringify';
4. import getStaticAttributeValue from './getStaticAttributeValue';
5. import { DomGenerator } from '../../index';
6. import Block from '../../Block';
7. import { Node } from '../../../../interfaces';
8. import { State } from '../../interfaces';
9. 
10. export default function visitAttribute(
11. 	generator: DomGenerator,
12. 	block: Block,
13. 	state: State,
14. 	node: Node,
15. 	attribute: Node
16. ) {
17. 	const name = attribute.name;
18. 
19. 	let metadata = state.namespace ? null : attributeLookup[name];
20. 	if (metadata && metadata.appliesTo && !~metadata.appliesTo.indexOf(node.name))
21. 		metadata = null;
22. 
23. 	const isIndirectlyBoundValue =
24. 		name === 'value' &&
25. 		(node.name === 'option' || // TODO check it's actually bound
26. 			(node.name === 'input' &&
27. 				node.attributes.find(
28. 					(attribute: Node) =>
29. 						attribute.type === 'Binding' && /checked|group/.test(attribute.name)
30. 				)));
31. 
32. 	const propertyName = isIndirectlyBoundValue
33. 		? '__value'
34. 		: metadata && metadata.propertyName;
35. 
36. 	// xlink is a special case... we could maybe extend this to generic
37. 	// namespaced attributes but I'm not sure that's applicable in
38. 	// HTML5?
39. 	const method = name.slice(0, 6) === 'xlink:'
40. 		? '@setXlinkAttribute'
41. 		: '@setAttribute';
42. 
43. 	const isDynamic =
44. 		(attribute.value !== true && attribute.value.length > 1) ||
45. 		(attribute.value.length === 1 && attribute.value[0].type !== 'Text');
46. 
47. 	if (isDynamic) {
48. 		let value;
49. 
50. 		if (attribute.value.length === 1) {
51. 			// single {{tag}} — may be a non-string
52. 			const { snippet } = block.contextualise(attribute.value[0].expression);
53. 			value = snippet;
54. 		} else {
55. 			// '{{foo}} {{bar}}' — treat as string concatenation
56. 			value =
57. 				(attribute.value[0].type === 'Text' ? '' : `"" + `) +
58. 				attribute.value
59. 					.map((chunk: Node) => {
60. 						if (chunk.type === 'Text') {
61. 							return stringify(chunk.data);
62. 						} else {
63. 							const { snippet } = block.contextualise(chunk.expression);
64. 							return `( ${snippet} )`;
65. 						}
66. 					})
67. 					.join(' + ');
68. 		}
69. 
70. 		const last = block.getUniqueName(
71. 			`${state.parentNode}_${name.replace(/[^a-zA-Z_$]/g, '_')}_value`
72. 		);
73. 		block.addVariable(last);
74. 
75. 		const isSelectValueAttribute =
76. 			name === 'value' && state.parentNodeName === 'select';
77. 
78. 		let updater;
79. 
80. 		if (isSelectValueAttribute) {
81. 			// annoying special case
82. 			const isMultipleSelect =
83. 				node.name === 'select' &&
84. 				node.attributes.find(
85. 					(attr: Node) => attr.name.toLowerCase() === 'multiple'
86. 				); // TODO use getStaticAttributeValue
87. 			const i = block.getUniqueName('i');
88. 			const option = block.getUniqueName('option');
89. 
90. 			const ifStatement = isMultipleSelect
91. 				? deindent`
92. 					${option}.selected = ~${last}.indexOf( ${option}.__value );`
93. 				: deindent`
94. 					if ( ${option}.__value === ${last} ) {
95. 						${option}.selected = true;
96. 						break;
97. 					}`;
98. 
99. 			updater = deindent`
100. 				for ( var ${i} = 0; ${i} < ${state.parentNode}.options.length; ${i} += 1 ) {
101. 					var ${option} = ${state.parentNode}.options[${i}];
102. 
103. 					${ifStatement}
104. 				}
105. 			`;
106. 
107. 			block.builders.hydrate.addLine(deindent`
108. 				${last} = ${value}
109. 				${updater}
110. 			`);
111. 		} else if (propertyName) {
112. 			block.builders.hydrate.addLine(
113. 				`${state.parentNode}.${propertyName} = ${last} = ${value};`
114. 			);
115. 			updater = `${state.parentNode}.${propertyName} = ${last};`;
116. 		} else {
117. 			block.builders.hydrate.addLine(
118. 				`${method}( ${state.parentNode}, '${name}', ${last} = ${value} );`
119. 			);
120. 			updater = `${method}( ${state.parentNode}, '${name}', ${last} );`;
121. 		}
122. 
123. 		block.builders.update.addBlock(deindent`
124. 			if ( ${last} !== ( ${last} = ${value} ) ) {
125. 				${updater}
126. 			}
127. 		`);
128. 	} else {
129. 		const value = attribute.value === true
130. 			? 'true'
131. 			: attribute.value.length === 0
132. 				? `''`
133. 				: stringify(attribute.value[0].data);
134. 
135. 		const statement = propertyName
136. 			? `${state.parentNode}.${propertyName} = ${value};`
137. 			: `${method}( ${state.parentNode}, '${name}', ${value} );`;
138. 
139. 		block.builders.hydrate.addLine(statement);
140. 
141. 		// special case – autofocus. has to be handled in a bit of a weird way
142. 		if (attribute.value === true && name === 'autofocus') {
143. 			block.autofocus = state.parentNode;
144. 		}
145. 
146. 		// special case — xmlns
147. 		if (name === 'xmlns') {
148. 			// TODO this attribute must be static – enforce at compile time
149. 			state.namespace = attribute.value[0].data;
150. 		}
151. 	}
152. 
153. 	if (isIndirectlyBoundValue) {
154. 		const updateValue = `${state.parentNode}.value = ${state.parentNode}.__value;`;
155. 
156. 		block.builders.hydrate.addLine(updateValue);
157. 		if (isDynamic) block.builders.update.addLine(updateValue);
158. 	}
159. }


File: src/generators/dom/visitors/Element/Binding.ts
Line number range: 1 - 260
Content:
1. import deindent from '../../../../utils/deindent';
2. import flattenReference from '../../../../utils/flattenReference';
3. import getSetter from '../shared/binding/getSetter';
4. import getStaticAttributeValue from './getStaticAttributeValue';
5. import { DomGenerator } from '../../index';
6. import Block from '../../Block';
7. import { Node } from '../../../../interfaces';
8. import { State } from '../../interfaces';
9. import getObject from '../../../../utils/getObject';
10. import getTailSnippet from '../../../../utils/getTailSnippet';
11. 
12. export default function visitBinding(
13. 	generator: DomGenerator,
14. 	block: Block,
15. 	state: State,
16. 	node: Node,
17. 	attribute: Node
18. ) {
19. 	const { name } = getObject(attribute.value);
20. 	const { snippet, contexts, dependencies } = block.contextualise(
21. 		attribute.value
22. 	);
23. 
24. 	contexts.forEach(context => {
25. 		if (!~state.allUsedContexts.indexOf(context))
26. 			state.allUsedContexts.push(context);
27. 	});
28. 
29. 	const eventName = getBindingEventName(node, attribute);
30. 	const handler = block.getUniqueName(
31. 		`${state.parentNode}_${eventName}_handler`
32. 	);
33. 	const isMultipleSelect =
34. 		node.name === 'select' &&
35. 		node.attributes.find(
36. 			(attr: Node) => attr.name.toLowerCase() === 'multiple'
37. 		); // TODO use getStaticAttributeValue
38. 	const type = getStaticAttributeValue(node, 'type');
39. 	const bindingGroup = attribute.name === 'group'
40. 		? getBindingGroup(generator, attribute.value)
41. 		: null;
42. 	const value = getBindingValue(
43. 		generator,
44. 		block,
45. 		state,
46. 		node,
47. 		attribute,
48. 		isMultipleSelect,
49. 		bindingGroup,
50. 		type
51. 	);
52. 
53. 	let setter = getSetter({
54. 		block,
55. 		name,
56. 		snippet,
57. 		_this: state.parentNode,
58. 		props: '_svelte',
59. 		attribute,
60. 		dependencies,
61. 		value,
62. 	});
63. 	let updateElement = `${state.parentNode}.${attribute.name} = ${snippet};`;
64. 	const lock = `#${state.parentNode}_updating`;
65. 	let updateCondition = `!${lock}`;
66. 
67. 	block.addVariable(lock, 'false');
68. 
69. 	// <select> special case
70. 	if (node.name === 'select') {
71. 		if (!isMultipleSelect) {
72. 			setter = `var selectedOption = ${state.parentNode}.querySelector(':checked') || ${state.parentNode}.options[0];\n${setter}`;
73. 		}
74. 
75. 		const value = block.getUniqueName('value');
76. 		const option = block.getUniqueName('option');
77. 
78. 		const ifStatement = isMultipleSelect
79. 			? deindent`
80. 				${option}.selected = ~${value}.indexOf( ${option}.__value );`
81. 			: deindent`
82. 				if ( ${option}.__value === ${value} ) {
83. 					${option}.selected = true;
84. 					break;
85. 				}`;
86. 
87. 		const { name } = getObject(attribute.value);
88. 		const tailSnippet = getTailSnippet(attribute.value);
89. 
90. 		updateElement = deindent`
91. 			var ${value} = ${snippet};
92. 			for ( var #i = 0; #i < ${state.parentNode}.options.length; #i += 1 ) {
93. 				var ${option} = ${state.parentNode}.options[#i];
94. 
95. 				${ifStatement}
96. 			}
97. 		`;
98. 
99. 		generator.hasComplexBindings = true;
100. 		block.builders.hydrate.addBlock(
101. 			`if ( !('${name}' in state) ) #component._root._beforecreate.push( ${handler} );`
102. 		);
103. 	} else if (attribute.name === 'group') {
104. 		// <input type='checkbox|radio' bind:group='selected'> special case
105. 		if (type === 'radio') {
106. 			setter = deindent`
107. 				if ( !${state.parentNode}.checked ) return;
108. 				${setter}
109. 			`;
110. 		}
111. 
112. 		const condition = type === 'checkbox'
113. 			? `~${snippet}.indexOf( ${state.parentNode}.__value )`
114. 			: `${state.parentNode}.__value === ${snippet}`;
115. 
116. 		block.builders.hydrate.addLine(
117. 			`#component._bindingGroups[${bindingGroup}].push( ${state.parentNode} );`
118. 		);
119. 
120. 		block.builders.destroy.addBlock(
121. 			`#component._bindingGroups[${bindingGroup}].splice( #component._bindingGroups[${bindingGroup}].indexOf( ${state.parentNode} ), 1 );`
122. 		);
123. 
124. 		updateElement = `${state.parentNode}.checked = ${condition};`;
125. 	} else if (node.name === 'audio' || node.name === 'video') {
126. 		generator.hasComplexBindings = true;
127. 		block.builders.hydrate.addBlock(`#component._root._beforecreate.push( ${handler} );`);
128. 
129. 		if (attribute.name === 'currentTime') {
130. 			const frame = block.getUniqueName(`${state.parentNode}_animationframe`);
131. 			block.addVariable(frame);
132. 			setter = deindent`
133. 				cancelAnimationFrame( ${frame} );
134. 				if ( !${state.parentNode}.paused ) ${frame} = requestAnimationFrame( ${handler} );
135. 				${setter}
136. 			`;
137. 
138. 			updateCondition += ` && !isNaN( ${snippet} )`;
139. 		} else if (attribute.name === 'duration') {
140. 			updateCondition = null;
141. 		} else if (attribute.name === 'paused') {
142. 			// this is necessary to prevent the audio restarting by itself
143. 			const last = block.getUniqueName(`${state.parentNode}_paused_value`);
144. 			block.addVariable(last, 'true');
145. 
146. 			updateCondition = `${last} !== ( ${last} = ${snippet} )`;
147. 			updateElement = `${state.parentNode}[ ${last} ? 'pause' : 'play' ]();`;
148. 		}
149. 	}
150. 
151. 	block.builders.init.addBlock(deindent`
152. 		function ${handler} () {
153. 			${lock} = true;
154. 			${setter}
155. 			${lock} = false;
156. 		}
157. 	`);
158. 
159. 	block.builders.hydrate.addBlock(
160. 		`@addListener( ${state.parentNode}, '${eventName}', ${handler} );`
161. 	);
162. 
163. 	if (node.name !== 'audio' && node.name !== 'video') {
164. 		node.initialUpdate = updateElement;
165. 		node.initialUpdateNeedsStateObject = !block.contexts.has(name);
166. 	}
167. 
168. 	if (updateCondition !== null) {
169. 		// audio/video duration is read-only, it never updates
170. 		block.builders.update.addBlock(deindent`
171. 			if ( ${updateCondition} ) {
172. 				${updateElement}
173. 			}
174. 		`);
175. 	}
176. 
177. 	block.builders.destroy.addLine(
178. 		`@removeListener( ${state.parentNode}, '${eventName}', ${handler} );`
179. 	);
180. 
181. 	if (attribute.name === 'paused') {
182. 		block.builders.create.addLine(
183. 			`@addListener( ${state.parentNode}, 'play', ${handler} );`
184. 		);
185. 		block.builders.destroy.addLine(
186. 			`@removeListener( ${state.parentNode}, 'play', ${handler} );`
187. 		);
188. 	}
189. }
190. 
191. function getBindingEventName(node: Node, attribute: Node) {
192. 	if (node.name === 'input') {
193. 		const typeAttribute = node.attributes.find(
194. 			(attr: Node) => attr.type === 'Attribute' && attr.name === 'type'
195. 		);
196. 		const type = typeAttribute ? typeAttribute.value[0].data : 'text'; // TODO in validation, should throw if type attribute is not static
197. 
198. 		return type === 'checkbox' || type === 'radio' ? 'change' : 'input';
199. 	}
200. 
201. 	if (node.name === 'textarea') return 'input';
202. 	if (attribute.name === 'currentTime') return 'timeupdate';
203. 	if (attribute.name === 'duration') return 'durationchange';
204. 	if (attribute.name === 'paused') return 'pause';
205. 
206. 	return 'change';
207. }
208. 
209. function getBindingValue(
210. 	generator: DomGenerator,
211. 	block: Block,
212. 	state: State,
213. 	node: Node,
214. 	attribute: Node,
215. 	isMultipleSelect: boolean,
216. 	bindingGroup: number,
217. 	type: string
218. ) {
219. 	// <select multiple bind:value='selected>
220. 	if (isMultipleSelect) {
221. 		return `[].map.call( ${state.parentNode}.querySelectorAll(':checked'), function ( option ) { return option.__value; })`;
222. 	}
223. 
224. 	// <select bind:value='selected>
225. 	if (node.name === 'select') {
226. 		return 'selectedOption && selectedOption.__value';
227. 	}
228. 
229. 	// <input type='checkbox' bind:group='foo'>
230. 	if (attribute.name === 'group') {
231. 		if (type === 'checkbox') {
232. 			return `@getBindingGroupValue( #component._bindingGroups[${bindingGroup}] )`;
233. 		}
234. 
235. 		return `${state.parentNode}.__value`;
236. 	}
237. 
238. 	// <input type='range|number' bind:value>
239. 	if (type === 'range' || type === 'number') {
240. 		return `@toNumber( ${state.parentNode}.${attribute.name} )`;
241. 	}
242. 
243. 	// everything else
244. 	return `${state.parentNode}.${attribute.name}`;
245. }
246. 
247. function getBindingGroup(generator: DomGenerator, value: Node) {
248. 	const { parts } = flattenReference(value); // TODO handle cases involving computed member expressions
249. 	const keypath = parts.join('.');
250. 
251. 	// TODO handle contextual bindings — `keypath` should include unique ID of
252. 	// each block that provides context
253. 	let index = generator.bindingGroups.indexOf(keypath);
254. 	if (index === -1) {
255. 		index = generator.bindingGroups.length;
256. 		generator.bindingGroups.push(keypath);
257. 	}
258. 
259. 	return index;
260. }


File: src/generators/dom/visitors/Element/Element.ts
Line number range: 1 - 255
Content:
1. import deindent from '../../../../utils/deindent';
2. import visit from '../../visit';
3. import visitComponent from '../Component/Component';
4. import visitWindow from './meta/Window';
5. import visitAttribute from './Attribute';
6. import visitEventHandler from './EventHandler';
7. import visitBinding from './Binding';
8. import visitRef from './Ref';
9. import * as namespaces from '../../../../utils/namespaces';
10. import addTransitions from './addTransitions';
11. import { DomGenerator } from '../../index';
12. import Block from '../../Block';
13. import { Node } from '../../../../interfaces';
14. import { State } from '../../interfaces';
15. 
16. const meta = {
17. 	':Window': visitWindow,
18. };
19. 
20. const order = {
21. 	Attribute: 1,
22. 	Binding: 2,
23. 	EventHandler: 3,
24. 	Ref: 4,
25. };
26. 
27. const visitors = {
28. 	Attribute: visitAttribute,
29. 	EventHandler: visitEventHandler,
30. 	Binding: visitBinding,
31. 	Ref: visitRef,
32. };
33. 
34. export default function visitElement(
35. 	generator: DomGenerator,
36. 	block: Block,
37. 	state: State,
38. 	node: Node,
39. 	elementStack: Node[]
40. ) {
41. 	if (node.name in meta) {
42. 		return meta[node.name](generator, block, node);
43. 	}
44. 
45. 	if (generator.components.has(node.name) || node.name === ':Self') {
46. 		return visitComponent(generator, block, state, node, elementStack);
47. 	}
48. 
49. 	const childState = node._state;
50. 	const name = childState.parentNode;
51. 
52. 	const isToplevel = !state.parentNode;
53. 
54. 	block.addVariable(name);
55. 	block.builders.create.addLine(
56. 		`${name} = ${getRenderStatement(
57. 			generator,
58. 			childState.namespace,
59. 			node.name
60. 		)};`
61. 	);
62. 
63. 	if (generator.hydratable) {
64. 		block.builders.claim.addBlock(deindent`
65. 			${name} = ${getClaimStatement(
66. 			generator,
67. 			childState.namespace,
68. 			state.parentNodes,
69. 			node
70. 		)};
71. 			var ${childState.parentNodes} = @children( ${name} );
72. 		`);
73. 	}
74. 
75. 	if (state.parentNode) {
76. 		block.builders.mount.addLine(
77. 			`@appendNode( ${name}, ${state.parentNode} );`
78. 		);
79. 	} else {
80. 		block.builders.mount.addLine(`@insertNode( ${name}, #target, anchor );`);
81. 	}
82. 
83. 	// add CSS encapsulation attribute
84. 	// TODO add a helper for this, rather than repeating it
85. 	if (node._needsCssAttribute) {
86. 		generator.needsEncapsulateHelper = true;
87. 		block.builders.hydrate.addLine(
88. 			`@encapsulateStyles( ${name} );`
89. 		);
90. 	}
91. 
92. 	function visitAttributesAndAddProps() {
93. 		let intro;
94. 		let outro;
95. 
96. 		node.attributes
97. 			.sort((a: Node, b: Node) => order[a.type] - order[b.type])
98. 			.forEach((attribute: Node) => {
99. 				if (attribute.type === 'Transition') {
100. 					if (attribute.intro) intro = attribute;
101. 					if (attribute.outro) outro = attribute;
102. 					return;
103. 				}
104. 
105. 				visitors[attribute.type](generator, block, childState, node, attribute);
106. 			});
107. 
108. 		if (intro || outro)
109. 			addTransitions(generator, block, childState, node, intro, outro);
110. 
111. 		if (childState.allUsedContexts.length || childState.usesComponent) {
112. 			const initialProps: string[] = [];
113. 			const updates: string[] = [];
114. 
115. 			if (childState.usesComponent) {
116. 				initialProps.push(`component: #component`);
117. 			}
118. 
119. 			childState.allUsedContexts.forEach((contextName: string) => {
120. 				if (contextName === 'state') return;
121. 
122. 				const listName = block.listNames.get(contextName);
123. 				const indexName = block.indexNames.get(contextName);
124. 
125. 				initialProps.push(
126. 					`${listName}: ${listName},\n${indexName}: ${indexName}`
127. 				);
128. 				updates.push(
129. 					`${name}._svelte.${listName} = ${listName};\n${name}._svelte.${indexName} = ${indexName};`
130. 				);
131. 			});
132. 
133. 			if (initialProps.length) {
134. 				block.builders.hydrate.addBlock(deindent`
135. 					${name}._svelte = {
136. 						${initialProps.join(',\n')}
137. 					};
138. 				`);
139. 			}
140. 
141. 			if (updates.length) {
142. 				block.builders.update.addBlock(updates.join('\n'));
143. 			}
144. 		}
145. 	}
146. 
147. 	if (isToplevel) {
148. 		// TODO we eventually need to consider what happens to elements
149. 		// that belong to the same outgroup as an outroing element...
150. 		block.builders.unmount.addLine(`@detachNode( ${name} );`);
151. 	}
152. 
153. 	if (node.name !== 'select') {
154. 		if (node.name === 'textarea') {
155. 			// this is an egregious hack, but it's the easiest way to get <textarea>
156. 			// children treated the same way as a value attribute
157. 			if (node.children.length > 0) {
158. 				node.attributes.push({
159. 					type: 'Attribute',
160. 					name: 'value',
161. 					value: node.children,
162. 				});
163. 
164. 				node.children = [];
165. 			}
166. 		}
167. 
168. 		// <select> value attributes are an annoying special case — it must be handled
169. 		// *after* its children have been updated
170. 		visitAttributesAndAddProps();
171. 	}
172. 
173. 	// special case – bound <option> without a value attribute
174. 	if (
175. 		node.name === 'option' &&
176. 		!node.attributes.find(
177. 			(attribute: Node) =>
178. 				attribute.type === 'Attribute' && attribute.name === 'value'
179. 		)
180. 	) {
181. 		// TODO check it's bound
182. 		const statement = `${name}.__value = ${name}.textContent;`;
183. 		node.initialUpdate = node.lateUpdate = statement;
184. 	}
185. 
186. 	node.children.forEach((child: Node) => {
187. 		visit(generator, block, childState, child, elementStack.concat(node));
188. 	});
189. 
190. 	if (node.lateUpdate) {
191. 		block.builders.update.addLine(node.lateUpdate);
192. 	}
193. 
194. 	if (node.name === 'select') {
195. 		visitAttributesAndAddProps();
196. 	}
197. 
198. 	if (node.initialUpdate) {
199. 		// special case — if we're in a yield block, then we may call mount
200. 		// long after the fragment is created. We may therefore need to get
201. 		// the latest `state` object
202. 		// TODO what about contexts in yield blocks? do we need to do
203. 		// `var ${contextName} = [something complicated]`?
204. 		const needsStateObject = node.initialUpdateNeedsStateObject && state.isYield;
205. 
206. 		if ( needsStateObject ) {
207. 			block.builders.mount.addLine(`var state = #component.get()`);
208. 		}
209. 
210. 		block.builders.mount.addBlock(node.initialUpdate);
211. 	}
212. 
213. 	block.builders.claim.addLine(
214. 		`${childState.parentNodes}.forEach( @detachNode );`
215. 	);
216. }
217. 
218. function getRenderStatement(
219. 	generator: DomGenerator,
220. 	namespace: string,
221. 	name: string
222. ) {
223. 	if (namespace === 'http://www.w3.org/2000/svg') {
224. 		return `@createSvgElement( '${name}' )`;
225. 	}
226. 
227. 	if (namespace) {
228. 		return `document.createElementNS( '${namespace}', '${name}' )`;
229. 	}
230. 
231. 	return `@createElement( '${name}' )`;
232. }
233. 
234. function getClaimStatement(
235. 	generator: DomGenerator,
236. 	namespace: string,
237. 	nodes: string,
238. 	node: Node
239. ) {
240. 	const attributes = node.attributes
241. 		.filter((attr: Node) => attr.type === 'Attribute')
242. 		.map((attr: Node) => `${quoteProp(attr.name)}: true`)
243. 		.join(', ');
244. 
245. 	const name = namespace ? node.name : node.name.toUpperCase();
246. 
247. 	return `@claimElement( ${nodes}, '${name}', ${attributes
248. 		? `{ ${attributes} }`
249. 		: `{}`}, ${namespace === namespaces.svg ? true : false} )`;
250. }
251. 
252. function quoteProp(name: string) {
253. 	if (/[^a-zA-Z_$0-9]/.test(name)) return `'${name}'`;
254. 	return name;
255. }


File: src/generators/dom/visitors/Element/EventHandler.ts
Line number range: 1 - 114
Content:
1. import deindent from '../../../../utils/deindent';
2. import flattenReference from '../../../../utils/flattenReference';
3. import { DomGenerator } from '../../index';
4. import Block from '../../Block';
5. import { Node } from '../../../../interfaces';
6. import { State } from '../../interfaces';
7. 
8. export default function visitEventHandler(
9. 	generator: DomGenerator,
10. 	block: Block,
11. 	state: State,
12. 	node: Node,
13. 	attribute: Node
14. ) {
15. 	const name = attribute.name;
16. 	const isCustomEvent = generator.events.has(name);
17. 	const shouldHoist = !isCustomEvent && state.inEachBlock;
18. 
19. 	const context = shouldHoist ? null : state.parentNode;
20. 	const usedContexts: string[] = [];
21. 
22. 	if (attribute.expression) {
23. 		generator.addSourcemapLocations(attribute.expression);
24. 
25. 		const flattened = flattenReference(attribute.expression.callee);
26. 		if (flattened.name !== 'event' && flattened.name !== 'this') {
27. 			// allow event.stopPropagation(), this.select() etc
28. 			// TODO verify that it's a valid callee (i.e. built-in or declared method)
29. 			generator.code.prependRight(
30. 				attribute.expression.start,
31. 				`${block.alias('component')}.`
32. 			);
33. 			if (shouldHoist) state.usesComponent = true; // this feels a bit hacky but it works!
34. 		}
35. 
36. 		attribute.expression.arguments.forEach((arg: Node) => {
37. 			const { contexts } = block.contextualise(arg, context, true);
38. 
39. 			contexts.forEach(context => {
40. 				if (!~usedContexts.indexOf(context)) usedContexts.push(context);
41. 				if (!~state.allUsedContexts.indexOf(context))
42. 					state.allUsedContexts.push(context);
43. 			});
44. 		});
45. 	}
46. 
47. 	const _this = context || 'this';
48. 	const declarations = usedContexts.map(name => {
49. 		if (name === 'state') {
50. 			if (shouldHoist) state.usesComponent = true;
51. 			return `var state = ${block.alias('component')}.get();`;
52. 		}
53. 
54. 		const listName = block.listNames.get(name);
55. 		const indexName = block.indexNames.get(name);
56. 		const contextName = block.contexts.get(name);
57. 
58. 		return `var ${listName} = ${_this}._svelte.${listName}, ${indexName} = ${_this}._svelte.${indexName}, ${contextName} = ${listName}[${indexName}];`;
59. 	});
60. 
61. 	// get a name for the event handler that is globally unique
62. 	// if hoisted, locally unique otherwise
63. 	const handlerName = (shouldHoist ? generator : block).getUniqueName(
64. 		`${name.replace(/[^a-zA-Z0-9_$]/g, '_')}_handler`
65. 	);
66. 
67. 	// create the handler body
68. 	const handlerBody = deindent`
69. 		${state.usesComponent &&
70. 			`var ${block.alias('component')} = ${_this}._svelte.component;`}
71. 		${declarations}
72. 		${attribute.expression ?
73. 			`[✂${attribute.expression.start}-${attribute.expression.end}✂];` :
74. 			`${block.alias('component')}.fire('${attribute.name}', event);`}
75. 	`;
76. 
77. 	if (isCustomEvent) {
78. 		block.addVariable(handlerName);
79. 
80. 		block.builders.hydrate.addBlock(deindent`
81. 			${handlerName} = @template.events.${name}.call( #component, ${state.parentNode}, function ( event ) {
82. 				${handlerBody}
83. 			});
84. 		`);
85. 
86. 		block.builders.destroy.addLine(deindent`
87. 			${handlerName}.teardown();
88. 		`);
89. 	} else {
90. 		const handler = deindent`
91. 			function ${handlerName} ( event ) {
92. 				${handlerBody}
93. 			}
94. 		`;
95. 
96. 		if (shouldHoist) {
97. 			generator.blocks.push(
98. 				<Block>{
99. 					render: () => handler,
100. 				}
101. 			);
102. 		} else {
103. 			block.builders.init.addBlock(handler);
104. 		}
105. 
106. 		block.builders.hydrate.addLine(
107. 			`@addListener( ${state.parentNode}, '${name}', ${handlerName} );`
108. 		);
109. 
110. 		block.builders.destroy.addLine(
111. 			`@removeListener( ${state.parentNode}, '${name}', ${handlerName} );`
112. 		);
113. 	}
114. }


File: src/generators/dom/visitors/Element/Ref.ts
Line number range: 1 - 25
Content:
1. import deindent from '../../../../utils/deindent';
2. import { DomGenerator } from '../../index';
3. import Block from '../../Block';
4. import { Node } from '../../../../interfaces';
5. import { State } from '../../interfaces';
6. 
7. export default function visitRef(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	attribute: Node
13. ) {
14. 	const name = attribute.name;
15. 
16. 	block.builders.mount.addLine(
17. 		`#component.refs.${name} = ${state.parentNode};`
18. 	);
19. 
20. 	block.builders.destroy.addLine(deindent`
21. 		if ( #component.refs.${name} === ${state.parentNode} ) #component.refs.${name} = null;
22. 	`);
23. 
24. 	generator.usesRefs = true; // so this component.refs object is created
25. }


File: src/generators/dom/visitors/Element/meta/Window.ts
Line number range: 1 - 194
Content:
1. import flattenReference from '../../../../../utils/flattenReference';
2. import deindent from '../../../../../utils/deindent';
3. import { DomGenerator } from '../../../index';
4. import Block from '../../../Block';
5. import { Node } from '../../../../../interfaces';
6. 
7. const associatedEvents = {
8. 	innerWidth: 'resize',
9. 	innerHeight: 'resize',
10. 	outerWidth: 'resize',
11. 	outerHeight: 'resize',
12. 
13. 	scrollX: 'scroll',
14. 	scrollY: 'scroll',
15. };
16. 
17. const readonly = new Set([
18. 	'innerWidth',
19. 	'innerHeight',
20. 	'outerWidth',
21. 	'outerHeight',
22. 	'online',
23. ]);
24. 
25. export default function visitWindow(
26. 	generator: DomGenerator,
27. 	block: Block,
28. 	node: Node
29. ) {
30. 	const events = {};
31. 	const bindings = {};
32. 
33. 	node.attributes.forEach((attribute: Node) => {
34. 		if (attribute.type === 'EventHandler') {
35. 			// TODO verify that it's a valid callee (i.e. built-in or declared method)
36. 			generator.addSourcemapLocations(attribute.expression);
37. 
38. 			let usesState = false;
39. 
40. 			attribute.expression.arguments.forEach((arg: Node) => {
41. 				const { contexts } = block.contextualise(arg, null, true);
42. 				if (contexts.length) usesState = true;
43. 			});
44. 
45. 			const flattened = flattenReference(attribute.expression.callee);
46. 			if (flattened.name !== 'event' && flattened.name !== 'this') {
47. 				// allow event.stopPropagation(), this.select() etc
48. 				generator.code.prependRight(
49. 					attribute.expression.start,
50. 					`${block.alias('component')}.`
51. 				);
52. 			}
53. 
54. 			const handlerName = block.getUniqueName(`onwindow${attribute.name}`);
55. 			const handlerBody = deindent`
56. 				${usesState && `var state = #component.get();`}
57. 				[✂${attribute.expression.start}-${attribute.expression.end}✂];
58. 			`;
59. 
60. 			block.builders.init.addBlock(deindent`
61. 				function ${handlerName} ( event ) {
62. 					${handlerBody}
63. 				};
64. 				window.addEventListener( '${attribute.name}', ${handlerName} );
65. 			`);
66. 
67. 			block.builders.destroy.addBlock(deindent`
68. 				window.removeEventListener( '${attribute.name}', ${handlerName} );
69. 			`);
70. 		}
71. 
72. 		if (attribute.type === 'Binding') {
73. 			// in dev mode, throw if read-only values are written to
74. 			if (readonly.has(attribute.name)) {
75. 				generator.readonly.add(attribute.value.name);
76. 			}
77. 
78. 			bindings[attribute.name] = attribute.value.name;
79. 
80. 			// bind:online is a special case, we need to listen for two separate events
81. 			if (attribute.name === 'online') return;
82. 
83. 			const associatedEvent = associatedEvents[attribute.name];
84. 
85. 			if (!associatedEvent) {
86. 				throw new Error(`Cannot bind to ${attribute.name} on <:Window>`);
87. 			}
88. 
89. 			if (!events[associatedEvent]) events[associatedEvent] = [];
90. 			events[associatedEvent].push(
91. 				`${attribute.value.name}: this.${attribute.name}`
92. 			);
93. 
94. 			// add initial value
95. 			generator.metaBindings.push(
96. 				`this._state.${attribute.value.name} = window.${attribute.name};`
97. 			);
98. 		}
99. 	});
100. 
101. 	const lock = block.getUniqueName(`window_updating`);
102. 
103. 	Object.keys(events).forEach(event => {
104. 		const handlerName = block.getUniqueName(`onwindow${event}`);
105. 		const props = events[event].join(',\n');
106. 
107. 		if (event === 'scroll') {
108. 			// TODO other bidirectional bindings...
109. 			block.addVariable(lock, 'false');
110. 		}
111. 
112. 		const handlerBody = deindent`
113. 			${event === 'scroll' && `${lock} = true;`}
114. 			${generator.options.dev && `component._updatingReadonlyProperty = true;`}
115. 
116. 			#component.set({
117. 				${props}
118. 			});
119. 
120. 			${generator.options.dev && `component._updatingReadonlyProperty = false;`}
121. 			${event === 'scroll' && `${lock} = false;`}
122. 		`;
123. 
124. 		block.builders.init.addBlock(deindent`
125. 			function ${handlerName} ( event ) {
126. 				${handlerBody}
127. 			};
128. 			window.addEventListener( '${event}', ${handlerName} );
129. 		`);
130. 
131. 		block.builders.destroy.addBlock(deindent`
132. 			window.removeEventListener( '${event}', ${handlerName} );
133. 		`);
134. 	});
135. 
136. 	// special case... might need to abstract this out if we add more special cases
137. 	if (bindings.scrollX && bindings.scrollY) {
138. 		const observerCallback = block.getUniqueName(`scrollobserver`);
139. 
140. 		block.builders.init.addBlock(deindent`
141. 			function ${observerCallback} () {
142. 				if ( ${lock} ) return;
143. 				var x = ${bindings.scrollX
144. 					? `#component.get( '${bindings.scrollX}' )`
145. 					: `window.scrollX`};
146. 				var y = ${bindings.scrollY
147. 					? `#component.get( '${bindings.scrollY}' )`
148. 					: `window.scrollY`};
149. 				window.scrollTo( x, y );
150. 			};
151. 		`);
152. 
153. 		if (bindings.scrollX)
154. 			block.builders.init.addLine(
155. 				`#component.observe( '${bindings.scrollX}', ${observerCallback} );`
156. 			);
157. 		if (bindings.scrollY)
158. 			block.builders.init.addLine(
159. 				`#component.observe( '${bindings.scrollY}', ${observerCallback} );`
160. 			);
161. 	} else if (bindings.scrollX || bindings.scrollY) {
162. 		const isX = !!bindings.scrollX;
163. 
164. 		block.builders.init.addBlock(deindent`
165. 			#component.observe( '${bindings.scrollX ||
166. 				bindings.scrollY}', function ( ${isX ? 'x' : 'y'} ) {
167. 				if ( ${lock} ) return;
168. 				window.scrollTo( ${isX ? 'x, window.scrollY' : 'window.scrollX, y'} );
169. 			});
170. 		`);
171. 	}
172. 
173. 	// another special case. (I'm starting to think these are all special cases.)
174. 	if (bindings.online) {
175. 		const handlerName = block.getUniqueName(`onlinestatuschanged`);
176. 		block.builders.init.addBlock(deindent`
177. 			function ${handlerName} ( event ) {
178. 				#component.set({ ${bindings.online}: navigator.onLine });
179. 			};
180. 			window.addEventListener( 'online', ${handlerName} );
181. 			window.addEventListener( 'offline', ${handlerName} );
182. 		`);
183. 
184. 		// add initial value
185. 		generator.metaBindings.push(
186. 			`this._state.${bindings.online} = navigator.onLine;`
187. 		);
188. 
189. 		block.builders.destroy.addBlock(deindent`
190. 			window.removeEventListener( 'online', ${handlerName} );
191. 			window.removeEventListener( 'offline', ${handlerName} );
192. 		`);
193. 	}
194. }


File: src/generators/server-side-rendering/index.ts
Line number range: 1 - 184
Content:
1. import deindent from '../../utils/deindent';
2. import Generator from '../Generator';
3. import Stylesheet from '../../css/Stylesheet';
4. import Block from './Block';
5. import preprocess from './preprocess';
6. import visit from './visit';
7. import { removeNode, removeObjectKey } from '../../utils/removeNode';
8. import { Parsed, Node, CompileOptions } from '../../interfaces';
9. 
10. export class SsrGenerator extends Generator {
11. 	bindings: string[];
12. 	renderCode: string;
13. 	elementDepth: number;
14. 
15. 	constructor(
16. 		parsed: Parsed,
17. 		source: string,
18. 		name: string,
19. 		stylesheet: Stylesheet,
20. 		options: CompileOptions
21. 	) {
22. 		super(parsed, source, name, stylesheet, options);
23. 		this.bindings = [];
24. 		this.renderCode = '';
25. 		this.elementDepth = 0;
26. 
27. 		// in an SSR context, we don't need to include events, methods, oncreate or ondestroy
28. 		const { templateProperties, defaultExport } = this;
29. 
30. 		preprocess(this, parsed.html);
31. 
32. 		this.stylesheet.warnOnUnusedSelectors(options.onwarn);
33. 
34. 		if (templateProperties.oncreate)
35. 			removeNode(
36. 				this.code,
37. 				defaultExport.declaration,
38. 				templateProperties.oncreate
39. 			);
40. 		if (templateProperties.ondestroy)
41. 			removeNode(
42. 				this.code,
43. 				defaultExport.declaration,
44. 				templateProperties.ondestroy
45. 			);
46. 		if (templateProperties.methods)
47. 			removeNode(
48. 				this.code,
49. 				defaultExport.declaration,
50. 				templateProperties.methods
51. 			);
52. 		if (templateProperties.events)
53. 			removeNode(
54. 				this.code,
55. 				defaultExport.declaration,
56. 				templateProperties.events
57. 			);
58. 	}
59. 
60. 	append(code: string) {
61. 		this.renderCode += code;
62. 	}
63. }
64. 
65. export default function ssr(
66. 	parsed: Parsed,
67. 	source: string,
68. 	stylesheet: Stylesheet,
69. 	options: CompileOptions
70. ) {
71. 	const format = options.format || 'cjs';
72. 
73. 	const generator = new SsrGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
74. 
75. 	const { computations, name, hasJs, templateProperties } = generator;
76. 
77. 	// create main render() function
78. 	const mainBlock = new Block({
79. 		generator,
80. 		contexts: new Map(),
81. 		indexes: new Map(),
82. 		conditions: [],
83. 	});
84. 
85. 	parsed.html.children.forEach((node: Node) => {
86. 		visit(generator, mainBlock, node);
87. 	});
88. 
89. 	const { css, cssMap } = generator.stylesheet.render(options.filename);
90. 
91. 	const result = deindent`
92. 		${hasJs && `[✂${parsed.js.content.start}-${parsed.js.content.end}✂]`}
93. 
94. 		var ${name} = {};
95. 
96. 		${name}.filename = ${JSON.stringify(options.filename)};
97. 
98. 		${name}.data = function () {
99. 			return ${templateProperties.data ? `@template.data()` : `{}`};
100. 		};
101. 
102. 		${name}.render = function ( state, options ) {
103. 			${templateProperties.data
104. 				? `state = Object.assign( @template.data(), state || {} );`
105. 				: `state = state || {};`}
106. 
107. 			${computations.map(
108. 				({ key, deps }) =>
109. 					`state.${key} = @template.computed.${key}( ${deps
110. 						.map(dep => `state.${dep}`)
111. 						.join(', ')} );`
112. 			)}
113. 
114. 			${generator.bindings.length &&
115. 				deindent`
116. 				var settled = false;
117. 				var tmp;
118. 
119. 				while ( !settled ) {
120. 					settled = true;
121. 
122. 					${generator.bindings.join('\n\n')}
123. 				}
124. 			`}
125. 
126. 			return \`${generator.renderCode}\`.trim();
127. 		};
128. 
129. 		${name}.renderCss = function () {
130. 			var components = [];
131. 
132. 			${generator.stylesheet.hasStyles &&
133. 				deindent`
134. 				components.push({
135. 					filename: ${name}.filename,
136. 					css: ${JSON.stringify(css)},
137. 					map: ${JSON.stringify(cssMap)}
138. 				});
139. 			`}
140. 
141. 			${templateProperties.components &&
142. 				deindent`
143. 				var seen = {};
144. 
145. 				function addComponent ( component ) {
146. 					var result = component.renderCss();
147. 					result.components.forEach( x => {
148. 						if ( seen[ x.filename ] ) return;
149. 						seen[ x.filename ] = true;
150. 						components.push( x );
151. 					});
152. 				}
153. 
154. 				${templateProperties.components.value.properties.map(prop => {
155. 					const { name } = prop.key;
156. 					const expression =
157. 						generator.importedComponents.get(name) ||
158. 						`@template.components.${name}`;
159. 					return `addComponent( ${expression} );`;
160. 				})}
161. 			`}
162. 
163. 			return {
164. 				css: components.map( x => x.css ).join( '\\n' ),
165. 				map: null,
166. 				components
167. 			};
168. 		};
169. 
170. 		var escaped = {
171. 			'"': '&quot;',
172. 			"'": '&#39;',
173. 			'&': '&amp;',
174. 			'<': '&lt;',
175. 			'>': '&gt;'
176. 		};
177. 
178. 		function __escape ( html ) {
179. 			return String( html ).replace( /["'&<>]/g, match => escaped[ match ] );
180. 		}
181. 	`.replace(/(\\)?@(\w*)/g, (match: string, escaped: string, name: string) => escaped ? match.slice(1) : generator.alias(name));
182. 
183. 	return generator.generate(result, options, { name, format });
184. }


File: src/generators/server-side-rendering/visitors/Element.ts
Line number range: 1 - 82
Content:
1. import visitComponent from './Component';
2. import isVoidElementName from '../../../utils/isVoidElementName';
3. import visit from '../visit';
4. import visitWindow from './meta/Window';
5. import { SsrGenerator } from '../index';
6. import Block from '../Block';
7. import { Node } from '../../../interfaces';
8. 
9. const meta = {
10. 	':Window': visitWindow,
11. };
12. 
13. function stringifyAttributeValue(block: Block, chunks: Node[]) {
14. 	return chunks
15. 		.map((chunk: Node) => {
16. 			if (chunk.type === 'Text') {
17. 				return chunk.data;
18. 			}
19. 
20. 			const { snippet } = block.contextualise(chunk.expression);
21. 			return '${' + snippet + '}';
22. 		})
23. 		.join('');
24. }
25. 
26. export default function visitElement(
27. 	generator: SsrGenerator,
28. 	block: Block,
29. 	node: Node
30. ) {
31. 	if (node.name in meta) {
32. 		return meta[node.name](generator, block, node);
33. 	}
34. 
35. 	if (generator.components.has(node.name) || node.name === ':Self') {
36. 		visitComponent(generator, block, node);
37. 		return;
38. 	}
39. 
40. 	let openingTag = `<${node.name}`;
41. 	let textareaContents; // awkward special case
42. 
43. 	node.attributes.forEach((attribute: Node) => {
44. 		if (attribute.type !== 'Attribute') return;
45. 
46. 		if (attribute.name === 'value' && node.name === 'textarea') {
47. 			textareaContents = stringifyAttributeValue(block, attribute.value);
48. 		} else {
49. 			let str = ` ${attribute.name}`;
50. 
51. 			if (attribute.value !== true) {
52. 				str += `="${stringifyAttributeValue(block, attribute.value)}"`;
53. 			}
54. 
55. 			openingTag += str;
56. 		}
57. 	});
58. 
59. 	if (node._needsCssAttribute) {
60. 		openingTag += ` ${generator.stylesheet.id}`;
61. 	}
62. 
63. 	openingTag += '>';
64. 
65. 	generator.append(openingTag);
66. 
67. 	if (node.name === 'textarea' && textareaContents !== undefined) {
68. 		generator.append(textareaContents);
69. 	} else {
70. 		generator.elementDepth += 1;
71. 
72. 		node.children.forEach((child: Node) => {
73. 			visit(generator, block, child);
74. 		});
75. 
76. 		generator.elementDepth -= 1;
77. 	}
78. 
79. 	if (!isVoidElementName(node.name)) {
80. 		generator.append(`</${node.name}>`);
81. 	}
82. }


File: src/parse/index.ts
Line number range: 1 - 182
Content:
1. import { locate, Location } from 'locate-character';
2. import fragment from './state/fragment';
3. import { whitespace } from '../utils/patterns';
4. import { trimStart, trimEnd } from '../utils/trim';
5. import getCodeFrame from '../utils/getCodeFrame';
6. import hash from './utils/hash';
7. import { Node, Parsed } from '../interfaces';
8. import CompileError from '../utils/CompileError';
9. 
10. class ParseError extends CompileError {
11. 	constructor(
12. 		message: string,
13. 		template: string,
14. 		index: number,
15. 		filename: string
16. 	) {
17. 		super(message, template, index, filename);
18. 		this.name = 'ParseError';
19. 	}
20. }
21. 
22. interface ParserOptions {
23. 	filename?: string;
24. }
25. 
26. export class Parser {
27. 	readonly template: string;
28. 	readonly filename?: string;
29. 
30. 	index: number;
31. 	stack: Array<Node>;
32. 
33. 	html: Node;
34. 	css: Node;
35. 	js: Node;
36. 	metaTags: {};
37. 
38. 	constructor(template: string, options: ParserOptions) {
39. 		if (typeof template !== 'string') {
40. 			throw new TypeError('Template must be a string');
41. 		}
42. 
43. 		this.template = template.replace(/\s+$/, '');
44. 		this.filename = options.filename;
45. 
46. 		this.index = 0;
47. 		this.stack = [];
48. 		this.metaTags = {};
49. 
50. 		this.html = {
51. 			start: null,
52. 			end: null,
53. 			type: 'Fragment',
54. 			children: [],
55. 		};
56. 
57. 		this.css = null;
58. 		this.js = null;
59. 
60. 		this.stack.push(this.html);
61. 
62. 		let state = fragment;
63. 
64. 		while (this.index < this.template.length) {
65. 			state = state(this) || fragment;
66. 		}
67. 
68. 		if (this.stack.length > 1) {
69. 			const current = this.current();
70. 
71. 			const type = current.type === 'Element' ? `<${current.name}>` : 'Block';
72. 			this.error(`${type} was left open`, current.start);
73. 		}
74. 
75. 		if (state !== fragment) {
76. 			this.error('Unexpected end of input');
77. 		}
78. 
79. 		if (this.html.children.length) {
80. 			let start = this.html.children[0] && this.html.children[0].start;
81. 			while (/\s/.test(template[start])) start += 1;
82. 
83. 			let end = this.html.children[this.html.children.length - 1] && this.html.children[this.html.children.length - 1].end;
84. 			while (/\s/.test(template[end - 1])) end -= 1;
85. 
86. 			this.html.start = start;
87. 			this.html.end = end;
88. 		} else {
89. 			this.html.start = this.html.end = null;
90. 		}
91. 	}
92. 
93. 	current() {
94. 		return this.stack[this.stack.length - 1];
95. 	}
96. 
97. 	acornError(err: Error) {
98. 		this.error(err.message.replace(/ \(\d+:\d+\)$/, ''), err.pos);
99. 	}
100. 
101. 	error(message: string, index = this.index) {
102. 		throw new ParseError(message, this.template, index, this.filename);
103. 	}
104. 
105. 	eat(str: string, required?: boolean) {
106. 		if (this.match(str)) {
107. 			this.index += str.length;
108. 			return true;
109. 		}
110. 
111. 		if (required) {
112. 			this.error(`Expected ${str}`);
113. 		}
114. 
115. 		return false;
116. 	}
117. 
118. 	match(str: string) {
119. 		return this.template.slice(this.index, this.index + str.length) === str;
120. 	}
121. 
122. 	allowWhitespace() {
123. 		while (
124. 			this.index < this.template.length &&
125. 			whitespace.test(this.template[this.index])
126. 		) {
127. 			this.index++;
128. 		}
129. 	}
130. 
131. 	read(pattern: RegExp) {
132. 		const match = pattern.exec(this.template.slice(this.index));
133. 		if (!match || match.index !== 0) return null;
134. 
135. 		this.index += match[0].length;
136. 
137. 		return match[0];
138. 	}
139. 
140. 	readUntil(pattern: RegExp) {
141. 		if (this.index >= this.template.length)
142. 			this.error('Unexpected end of input');
143. 
144. 		const start = this.index;
145. 		const match = pattern.exec(this.template.slice(start));
146. 
147. 		if (match) {
148. 			const start = this.index;
149. 			this.index = start + match.index;
150. 			return this.template.slice(start, this.index);
151. 		}
152. 
153. 		this.index = this.template.length;
154. 		return this.template.slice(start);
155. 	}
156. 
157. 	remaining() {
158. 		return this.template.slice(this.index);
159. 	}
160. 
161. 	requireWhitespace() {
162. 		if (!whitespace.test(this.template[this.index])) {
163. 			this.error(`Expected whitespace`);
164. 		}
165. 
166. 		this.allowWhitespace();
167. 	}
168. }
169. 
170. export default function parse(
171. 	template: string,
172. 	options: ParserOptions = {}
173. ): Parsed {
174. 	const parser = new Parser(template, options);
175. 
176. 	return {
177. 		hash: hash(parser.template),
178. 		html: parser.html,
179. 		css: parser.css,
180. 		js: parser.js,
181. 	};
182. }


File: src/parse/read/directives.ts
Line number range: 1 - 164
Content:
1. import { parseExpressionAt } from 'acorn';
2. import spaces from '../../utils/spaces';
3. import { Parser } from '../index';
4. 
5. function readExpression(parser: Parser, start: number, quoteMark: string|null) {
6. 	let str = '';
7. 	let escaped = false;
8. 
9. 	for (let i = start; i < parser.template.length; i += 1) {
10. 		const char = parser.template[i];
11. 
12. 		if (quoteMark) {
13. 			if (char === quoteMark) {
14. 				if (escaped) {
15. 					str += quoteMark;
16. 				} else {
17. 					break;
18. 				}
19. 			} else if (escaped) {
20. 				str += '\\' + char;
21. 				escaped = false;
22. 			} else if (char === '\\') {
23. 				escaped = true;
24. 			} else {
25. 				str += char;
26. 			}
27. 		} else if (/\s/.test(char)) {
28. 			break;
29. 		} else {
30. 			str += char;
31. 		}
32. 	}
33. 
34. 	const expression = parseExpressionAt(spaces(start) + str, start);
35. 	parser.index = expression.end;
36. 
37. 	parser.allowWhitespace();
38. 	if (quoteMark) parser.eat(quoteMark, true);
39. 
40. 	return expression;
41. }
42. 
43. export function readEventHandlerDirective(
44. 	parser: Parser,
45. 	start: number,
46. 	name: string,
47. 	hasValue: boolean
48. ) {
49. 	let expression;
50. 
51. 	if (hasValue) {
52. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
53. 
54. 		const expressionStart = parser.index;
55. 
56. 		expression = readExpression(parser, expressionStart, quoteMark);
57. 
58. 		if (expression.type !== 'CallExpression') {
59. 			parser.error(`Expected call expression`, expressionStart);
60. 		}
61. 	}
62. 
63. 	return {
64. 		start,
65. 		end: parser.index,
66. 		type: 'EventHandler',
67. 		name,
68. 		expression,
69. 	};
70. }
71. 
72. export function readBindingDirective(
73. 	parser: Parser,
74. 	start: number,
75. 	name: string
76. ) {
77. 	let value;
78. 
79. 	if (parser.eat('=')) {
80. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
81. 
82. 		const a = parser.index;
83. 
84. 		if (parser.eat('{{')) {
85. 			let message = 'bound values should not be wrapped';
86. 			const b = parser.template.indexOf('}}', a);
87. 			if (b !== -1) {
88. 				const value = parser.template.slice(parser.index, b);
89. 				message += ` — use '${value}', not '{{${value}}}'`;
90. 			}
91. 
92. 			parser.error(message, a);
93. 		}
94. 
95. 		// this is a bit of a hack so that we can give Acorn something parseable
96. 		let b;
97. 		if (quoteMark) {
98. 			b = parser.index = parser.template.indexOf(quoteMark, parser.index);
99. 		} else {
100. 			parser.readUntil(/[\s\r\n\/>]/);
101. 			b = parser.index;
102. 		}
103. 
104. 		const source = spaces(a) + parser.template.slice(a, b);
105. 		value = parseExpressionAt(source, a);
106. 
107. 		if (value.type !== 'Identifier' && value.type !== 'MemberExpression') {
108. 			parser.error(`Cannot bind to rvalue`, value.start);
109. 		}
110. 
111. 		parser.allowWhitespace();
112. 
113. 		if (quoteMark) {
114. 			parser.eat(quoteMark, true);
115. 		}
116. 	} else {
117. 		// shorthand – bind:foo equivalent to bind:foo='foo'
118. 		value = {
119. 			type: 'Identifier',
120. 			start: start + 5,
121. 			end: parser.index,
122. 			name,
123. 		};
124. 	}
125. 
126. 	return {
127. 		start,
128. 		end: parser.index,
129. 		type: 'Binding',
130. 		name,
131. 		value,
132. 	};
133. }
134. 
135. export function readTransitionDirective(
136. 	parser: Parser,
137. 	start: number,
138. 	name: string,
139. 	type: string
140. ) {
141. 	let expression = null;
142. 
143. 	if (parser.eat('=')) {
144. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
145. 
146. 		const expressionStart = parser.index;
147. 
148. 		expression = readExpression(parser, expressionStart, quoteMark);
149. 
150. 		if (expression.type !== 'ObjectExpression') {
151. 			parser.error(`Expected object expression`, expressionStart);
152. 		}
153. 	}
154. 
155. 	return {
156. 		start,
157. 		end: parser.index,
158. 		type: 'Transition',
159. 		name,
160. 		intro: type === 'in' || type === 'transition',
161. 		outro: type === 'out' || type === 'transition',
162. 		expression,
163. 	};
164. }


File: src/parse/state/fragment.ts
Line number range: 1 - 16
Content:
1. import tag from './tag';
2. import mustache from './mustache';
3. import text from './text';
4. import { Parser } from '../index';
5. 
6. export default function fragment(parser: Parser) {
7. 	if (parser.match('<')) {
8. 		return tag;
9. 	}
10. 
11. 	if (parser.match('{{')) {
12. 		return mustache;
13. 	}
14. 
15. 	return text;
16. }


File: src/parse/state/tag.ts
Line number range: 1 - 390
Content:
1. import readExpression from '../read/expression';
2. import readScript from '../read/script';
3. import readStyle from '../read/style';
4. import {
5. 	readEventHandlerDirective,
6. 	readBindingDirective,
7. 	readTransitionDirective,
8. } from '../read/directives';
9. import { trimStart, trimEnd } from '../../utils/trim';
10. import { decodeCharacterReferences } from '../utils/html';
11. import isVoidElementName from '../../utils/isVoidElementName';
12. import { Parser } from '../index';
13. import { Node } from '../../interfaces';
14. 
15. const validTagName = /^\!?[a-zA-Z]{1,}:?[a-zA-Z0-9\-]*/;
16. 
17. const SELF = ':Self';
18. 
19. const metaTags = {
20. 	':Window': true,
21. };
22. 
23. const specials = new Map([
24. 	[
25. 		'script',
26. 		{
27. 			read: readScript,
28. 			property: 'js',
29. 		},
30. 	],
31. 	[
32. 		'style',
33. 		{
34. 			read: readStyle,
35. 			property: 'css',
36. 		},
37. 	],
38. ]);
39. 
40. // based on http://developers.whatwg.org/syntax.html#syntax-tag-omission
41. const disallowedContents = new Map([
42. 	['li', new Set(['li'])],
43. 	['dt', new Set(['dt', 'dd'])],
44. 	['dd', new Set(['dt', 'dd'])],
45. 	[
46. 		'p',
47. 		new Set(
48. 			'address article aside blockquote div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr main menu nav ol p pre section table ul'.split(
49. 				' '
50. 			)
51. 		),
52. 	],
53. 	['rt', new Set(['rt', 'rp'])],
54. 	['rp', new Set(['rt', 'rp'])],
55. 	['optgroup', new Set(['optgroup'])],
56. 	['option', new Set(['option', 'optgroup'])],
57. 	['thead', new Set(['tbody', 'tfoot'])],
58. 	['tbody', new Set(['tbody', 'tfoot'])],
59. 	['tfoot', new Set(['tbody'])],
60. 	['tr', new Set(['tr', 'tbody'])],
61. 	['td', new Set(['td', 'th', 'tr'])],
62. 	['th', new Set(['td', 'th', 'tr'])],
63. ]);
64. 
65. export default function tag(parser: Parser) {
66. 	const start = parser.index++;
67. 
68. 	let parent = parser.current();
69. 
70. 	if (parser.eat('!--')) {
71. 		const data = parser.readUntil(/-->/);
72. 		parser.eat('-->');
73. 
74. 		parser.current().children.push({
75. 			start,
76. 			end: parser.index,
77. 			type: 'Comment',
78. 			data,
79. 		});
80. 
81. 		return;
82. 	}
83. 
84. 	const isClosingTag = parser.eat('/');
85. 
86. 	const name = readTagName(parser);
87. 
88. 	if (name in metaTags) {
89. 		if (name in parser.metaTags) {
90. 			if (isClosingTag && parser.current().children.length) {
91. 				parser.error(
92. 					`<${name}> cannot have children`,
93. 					parser.current().children[0].start
94. 				);
95. 			}
96. 
97. 			parser.error(`A component can only have one <${name}> tag`, start);
98. 		}
99. 
100. 		parser.metaTags[name] = true;
101. 
102. 		if (parser.stack.length > 1) {
103. 			parser.error(`<${name}> tags cannot be inside elements or blocks`, start);
104. 		}
105. 	}
106. 
107. 	parser.allowWhitespace();
108. 
109. 	if (isClosingTag) {
110. 		if (isVoidElementName(name)) {
111. 			parser.error(
112. 				`<${name}> is a void element and cannot have children, or a closing tag`,
113. 				start
114. 			);
115. 		}
116. 
117. 		if (!parser.eat('>')) parser.error(`Expected '>'`);
118. 
119. 		// close any elements that don't have their own closing tags, e.g. <div><p></div>
120. 		while (parent.name !== name) {
121. 			if (parent.type !== 'Element')
122. 				parser.error(
123. 					`</${name}> attempted to close an element that was not open`,
124. 					start
125. 				);
126. 
127. 			parent.end = start;
128. 			parser.stack.pop();
129. 
130. 			parent = parser.current();
131. 		}
132. 
133. 		parent.end = parser.index;
134. 		parser.stack.pop();
135. 
136. 		return;
137. 	} else if (disallowedContents.has(parent.name)) {
138. 		// can this be a child of the parent element, or does it implicitly
139. 		// close it, like `<li>one<li>two`?
140. 		if (disallowedContents.get(parent.name).has(name)) {
141. 			parent.end = start;
142. 			parser.stack.pop();
143. 		}
144. 	}
145. 
146. 	const attributes = [];
147. 	const uniqueNames = new Set();
148. 
149. 	let attribute;
150. 	while ((attribute = readAttribute(parser, uniqueNames))) {
151. 		attributes.push(attribute);
152. 		parser.allowWhitespace();
153. 	}
154. 
155. 	parser.allowWhitespace();
156. 
157. 	// special cases – top-level <script> and <style>
158. 	if (specials.has(name) && parser.stack.length === 1) {
159. 		const special = specials.get(name);
160. 
161. 		if (parser[special.property]) {
162. 			parser.index = start;
163. 			parser.error(
164. 				`You can only have one top-level <${name}> tag per component`
165. 			);
166. 		}
167. 
168. 		parser.eat('>', true);
169. 		parser[special.property] = special.read(parser, start, attributes);
170. 		return;
171. 	}
172. 
173. 	const element: Node = {
174. 		start,
175. 		end: null, // filled in later
176. 		type: 'Element',
177. 		name,
178. 		attributes,
179. 		children: [],
180. 	};
181. 
182. 	parser.current().children.push(element);
183. 
184. 	const selfClosing = parser.eat('/') || isVoidElementName(name);
185. 
186. 	parser.eat('>', true);
187. 
188. 	if (selfClosing) {
189. 		element.end = parser.index;
190. 	} else if (name === 'textarea') {
191. 		// special case
192. 		element.children = readSequence(
193. 			parser,
194. 			() =>
195. 				parser.template.slice(parser.index, parser.index + 11) === '</textarea>'
196. 		);
197. 		parser.read(/<\/textarea>/);
198. 		element.end = parser.index;
199. 	} else {
200. 		// don't push self-closing elements onto the stack
201. 		parser.stack.push(element);
202. 	}
203. }
204. 
205. function readTagName(parser: Parser) {
206. 	const start = parser.index;
207. 
208. 	if (parser.eat(SELF)) {
209. 		// check we're inside a block, otherwise this
210. 		// will cause infinite recursion
211. 		let i = parser.stack.length;
212. 		let legal = false;
213. 
214. 		while (i--) {
215. 			const fragment = parser.stack[i];
216. 			if (fragment.type === 'IfBlock' || fragment.type === 'EachBlock') {
217. 				legal = true;
218. 				break;
219. 			}
220. 		}
221. 
222. 		if (!legal) {
223. 			parser.error(
224. 				`<${SELF}> components can only exist inside if-blocks or each-blocks`,
225. 				start
226. 			);
227. 		}
228. 
229. 		return SELF;
230. 	}
231. 
232. 	const name = parser.readUntil(/(\s|\/|>)/);
233. 
234. 	if (name in metaTags) return name;
235. 
236. 	if (!validTagName.test(name)) {
237. 		parser.error(`Expected valid tag name`, start);
238. 	}
239. 
240. 	return name;
241. }
242. 
243. function readAttribute(parser: Parser, uniqueNames: Set<string>) {
244. 	const start = parser.index;
245. 
246. 	let name = parser.readUntil(/(\s|=|\/|>)/);
247. 	if (!name) return null;
248. 	if (uniqueNames.has(name)) {
249. 		parser.error('Attributes need to be unique', start);
250. 	}
251. 
252. 	uniqueNames.add(name);
253. 
254. 	parser.allowWhitespace();
255. 
256. 	if (/^on:/.test(name)) {
257. 		return readEventHandlerDirective(parser, start, name.slice(3), parser.eat('='));
258. 	}
259. 
260. 	if (/^bind:/.test(name)) {
261. 		return readBindingDirective(parser, start, name.slice(5));
262. 	}
263. 
264. 	if (/^ref:/.test(name)) {
265. 		return {
266. 			start,
267. 			end: parser.index,
268. 			type: 'Ref',
269. 			name: name.slice(4),
270. 		};
271. 	}
272. 
273. 	const match = /^(in|out|transition):/.exec(name);
274. 	if (match) {
275. 		return readTransitionDirective(
276. 			parser,
277. 			start,
278. 			name.slice(match[0].length),
279. 			match[1]
280. 		);
281. 	}
282. 
283. 	let value;
284. 
285. 	// :foo is shorthand for foo='{{foo}}'
286. 	if (/^:\w+$/.test(name)) {
287. 		name = name.slice(1);
288. 		value = getShorthandValue(start + 1, name);
289. 	} else {
290. 		value = parser.eat('=') ? readAttributeValue(parser) : true;
291. 	}
292. 
293. 	return {
294. 		start,
295. 		end: parser.index,
296. 		type: 'Attribute',
297. 		name,
298. 		value,
299. 	};
300. }
301. 
302. function readAttributeValue(parser: Parser) {
303. 	const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
304. 
305. 	const regex = quoteMark === `'`
306. 		? /'/
307. 		: quoteMark === `"` ? /"/ : /[\s"'=<>\/`]/;
308. 
309. 	const value = readSequence(parser, () =>
310. 		regex.test(parser.template[parser.index])
311. 	);
312. 
313. 	if (quoteMark) parser.index += 1;
314. 	return value;
315. }
316. 
317. function getShorthandValue(start: number, name: string) {
318. 	const end = start + name.length;
319. 
320. 	return [
321. 		{
322. 			type: 'AttributeShorthand',
323. 			start,
324. 			end,
325. 			expression: {
326. 				type: 'Identifier',
327. 				start,
328. 				end,
329. 				name,
330. 			},
331. 		},
332. 	];
333. }
334. 
335. function readSequence(parser: Parser, done: () => boolean) {
336. 	let currentChunk: Node = {
337. 		start: parser.index,
338. 		end: null,
339. 		type: 'Text',
340. 		data: '',
341. 	};
342. 
343. 	const chunks = [];
344. 
345. 	while (parser.index < parser.template.length) {
346. 		const index = parser.index;
347. 
348. 		if (done()) {
349. 			currentChunk.end = parser.index;
350. 
351. 			if (currentChunk.data) chunks.push(currentChunk);
352. 
353. 			chunks.forEach(chunk => {
354. 				if (chunk.type === 'Text')
355. 					chunk.data = decodeCharacterReferences(chunk.data);
356. 			});
357. 
358. 			return chunks;
359. 		} else if (parser.eat('{{')) {
360. 			if (currentChunk.data) {
361. 				currentChunk.end = index;
362. 				chunks.push(currentChunk);
363. 			}
364. 
365. 			const expression = readExpression(parser);
366. 			parser.allowWhitespace();
367. 			if (!parser.eat('}}')) {
368. 				parser.error(`Expected }}`);
369. 			}
370. 
371. 			chunks.push({
372. 				start: index,
373. 				end: parser.index,
374. 				type: 'MustacheTag',
375. 				expression,
376. 			});
377. 
378. 			currentChunk = {
379. 				start: parser.index,
380. 				end: null,
381. 				type: 'Text',
382. 				data: '',
383. 			};
384. 		} else {
385. 			currentChunk.data += parser.template[parser.index++];
386. 		}
387. 	}
388. 
389. 	parser.error(`Unexpected end of input`);
390. }


File: test/validator/samples/event-handler-ref-invalid/input.html
Line number range: 1 - 2
Content:
1. <input ref:input>
2. <button on:click='refs.inputx.focus()'>focus input</button>


File: test/validator/samples/event-handler-ref/input.html
Line number range: 1 - 2
Content:
1. <input ref:input>
2. <button on:click='refs.input.focus()'>focus input</button>

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-10 23:25:20,364 - thread-133013312636608.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The query asks for the full content of src/parse/read/directives.ts to confirm how directives are parsed. This file contains parsing logic for event handlers, bindings, and transitions, and is directly requested.', relative_path='src/parse/read/directives.ts', start_line=1, end_line=164), ContextOutput(reasoning='The query asks for src/generators/dom/visitors/Element/index.ts; in this codebase, the central Element visitor is implemented in Element.ts, which orchestrates Element processing and includes handling and ordering of Attribute, Binding, EventHandler, and Ref directives. Providing full content satisfies the request and shows where Ref visitors are invoked.', relative_path='src/generators/dom/visitors/Element/Element.ts', start_line=1, end_line=255), ContextOutput(reasoning='Element ref directives are compiled here: assigns #component.refs[name] on mount and clears on destroy. This directly implements element ref handling in the DOM generator, as requested.', relative_path='src/generators/dom/visitors/Element/Ref.ts', start_line=1, end_line=25), ContextOutput(reasoning='Component refs (ref on component instances) are handled here, setting #component.refs[name] to the local component variable and clearing on destroy. This is an Element visitor file that handles ref directives and is needed to cover ref semantics fully.', relative_path='src/generators/dom/visitors/Component/Ref.ts', start_line=1, end_line=22), ContextOutput(reasoning='README section covering CSS scoping mentions the cascade option, which controls whether styles cascade or require :global(...). This is directly relevant to CSS scoping requested by the user.', relative_path='README.md', start_line=80, end_line=83), ContextOutput(reasoning='Tests referenced by the user to validate ref usage in event handlers; includes the valid case using refs.input.focus(). Providing full content of the file as requested.', relative_path='test/validator/samples/event-handler-ref/input.html', start_line=1, end_line=2), ContextOutput(reasoning='Tests referenced by the user to validate invalid ref usage in event handlers; includes the invalid case refs.inputx.focus(). Providing full content as requested.', relative_path='test/validator/samples/event-handler-ref-invalid/input.html', start_line=1, end_line=2), ContextOutput(reasoning='Extra requirement asks to include CSS selector processing files. Selector.ts contains logic for determining selector application, :global handling, encapsulation, and validation—core to CSS scoping semantics.', relative_path='src/css/Selector.ts', start_line=1, end_line=266), ContextOutput(reasoning='Extra requirement asks to include CSS selector processing files. Stylesheet.ts orchestrates applying selectors, transforming and scoping CSS, generating encapsulation attributes, and warnings for unused selectors—essential context for CSS capabilities.', relative_path='src/css/Stylesheet.ts', start_line=1, end_line=362), ContextOutput(reasoning='To confirm how refs are usable in event handler expressions, this snippet shows that non-event/this callees in on: handlers are prefixed with component., making refs accessible as component.refs. This is essential to understand refs semantics in event handlers.', relative_path='src/generators/dom/visitors/Element/EventHandler.ts', start_line=23, end_line=35), ContextOutput(reasoning='The DOM generator conditionally creates this.refs when generator.usesRefs is true (set by ref visitors). This snippet proves that a refs object exists on the component instance when refs are used.', relative_path='src/generators/dom/index.ts', start_line=182, end_line=191), ContextOutput(reasoning="Parsing of ref: directives is handled directly in tag.ts, producing nodes of type 'Ref'. Including this concise context shows where ref directives are recognized during parsing.", relative_path='src/parse/state/tag.ts', start_line=260, end_line=271)]
2025-11-10 23:25:20,371 - thread-133013312636608.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 12 contexts to memory for query: Please provide the full content with line numbers of src/parse/read/directives.ts, src/generators/dom/visitors/Element/index.ts (and any Element visitor files that handle ref directives), README.md sections covering refs and CSS scoping, and test/validator/samples/event-handler-ref/input.html plus event-handler-ref-invalid/input.html.
2025-11-10 23:25:21,876 - thread-133013312636608.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-10 23:25:21,877 - thread-133013312636608.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 12 new contexts to 0 existing contexts
2025-11-10 23:25:21,878 - thread-133013312636608.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 12 total contexts (removed 0 duplicates)
2025-11-10 23:25:21,880 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── getGlobals.ts
|   |           ├── getIntro.ts
|   |           ├── getOutro.ts
|   |           └── walkHtml.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getObject.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── reservedNames.ts
|   |   ├── spaces.ts
|   |   ├── stringify.ts
|   |   └── trim.ts
|   └── validate
|       ├── html
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── pass-no-options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-onrender
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
using refs in css

Issue description: 
When I use a ref, I most often also want to get a handle to it with css, which leads to slightly annoying, duplicative markup.

```html
<style>
  .container {
    color: red
  }
</style>
<div class="container" ref:container></div>
```
 
The only solutions I can think of to mitigate this are untenable, but thought I raise this if others see something better.

- Make nodes with ids available as refs, like polymer's static node map
- Make svelte refs available as synthetic css selectors
- Make a syntax shortcut for declaring refs as classes, e.g. `<div ref:class:container ></div>`

Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content with line numbers of src/parse/read/directives.ts, src/generators/dom/visitors/Element/index.ts (and any Element visitor files that handle ref directives), README.md sections covering refs and CSS scoping, and test/validator/samples/event-handler-ref/input.html plus event-handler-ref-invalid/input.html.
Extra Requirements: If ref handling is implemented outside Element visitors, include the module where ref directives are compiled (DOM/SSR) and the CSS selector processing files (src/css/Selector.ts or Stylesheet.ts).
Purpose: This context will confirm existing ref semantics and CSS capabilities so I can accurately classify the issue as a feature request, bug, documentation update, or question.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: README.md
Line number range: 80 - 83
Content:
80. | `cascade` | `true`, `false` | Whether to cascade all of the component's styles to child components. If `false`, only selectors wrapped in `:global(...)` and keyframe IDs beginning with `-global-` are cascaded. | `true` |
81. | `shared` | `true`, `false`, `string` | Whether to import various helpers from a shared external library. When you have a project with multiple components, this reduces the overall size of your JavaScript bundle, at the expense of having immediately-usable component. You can pass a string of the module path to use, or `true` will import from `'svelte/shared.js'`. | `false` |
82. | `dev` | `true`, `false` | Whether to enable run-time checks in the compiled component. These are helpful during development, but slow your component down. | `false` |
83. | `css` | `true`, `false` | Whether to include code to inject your component's styles into the DOM. | `true` |


File: src/css/Selector.ts
Line number range: 1 - 266
Content:
1. import MagicString from 'magic-string';
2. import { gatherPossibleValues, UNKNOWN } from './gatherPossibleValues';
3. import { Validator } from '../validate/index';
4. import { Node } from '../interfaces';
5. 
6. export default class Selector {
7. 	node: Node;
8. 	blocks: Block[];
9. 	localBlocks: Block[];
10. 	used: boolean;
11. 
12. 	constructor(node: Node) {
13. 		this.node = node;
14. 
15. 		this.blocks = groupSelectors(node);
16. 
17. 		// take trailing :global(...) selectors out of consideration
18. 		let i = this.blocks.length;
19. 		while (i > 0) {
20. 			if (!this.blocks[i - 1].global) break;
21. 			i -= 1;
22. 		}
23. 
24. 		this.localBlocks = this.blocks.slice(0, i);
25. 		this.used = this.blocks[0].global;
26. 	}
27. 
28. 	apply(node: Node, stack: Node[]) {
29. 		const applies = selectorAppliesTo(this.localBlocks.slice(), node, stack.slice());
30. 
31. 		if (applies) {
32. 			this.used = true;
33. 
34. 			// add svelte-123xyz attribute to outermost and innermost
35. 			// elements — no need to add it to intermediate elements
36. 			node._needsCssAttribute = true;
37. 			if (stack[0] && this.node.children.find(isDescendantSelector)) stack[0]._needsCssAttribute = true;
38. 		}
39. 	}
40. 
41. 	minify(code: MagicString) {
42. 		let c: number = null;
43. 		this.blocks.forEach((block, i) => {
44. 			if (i > 0) {
45. 				if (block.start - c > 1) {
46. 					code.overwrite(c, block.start, block.combinator.name || ' ');
47. 				}
48. 			}
49. 
50. 			c = block.end;
51. 		});
52. 	}
53. 
54. 	transform(code: MagicString, attr: string) {
55. 		function encapsulateBlock(block: Block) {
56. 			let i = block.selectors.length;
57. 			while (i--) {
58. 				const selector = block.selectors[i];
59. 				if (selector.type === 'PseudoElementSelector' || selector.type === 'PseudoClassSelector') continue;
60. 
61. 				if (selector.type === 'TypeSelector' && selector.name === '*') {
62. 					code.overwrite(selector.start, selector.end, attr);
63. 				} else {
64. 					code.appendLeft(selector.end, attr);
65. 				}
66. 
67. 				return;
68. 			}
69. 		}
70. 
71. 		this.blocks.forEach((block, i) => {
72. 			if (block.global) {
73. 				const selector = block.selectors[0];
74. 				const first = selector.children[0];
75. 				const last = selector.children[selector.children.length - 1];
76. 				code.remove(selector.start, first.start).remove(last.end, selector.end);
77. 			} else if (i === 0 || i === this.blocks.length - 1) {
78. 				encapsulateBlock(block);
79. 			}
80. 		});
81. 	}
82. 
83. 	validate(validator: Validator) {
84. 		this.blocks.forEach((block) => {
85. 			let i = block.selectors.length;
86. 			while (i-- > 1) {
87. 				const selector = block.selectors[i];
88. 				if (selector.type === 'PseudoClassSelector' && selector.name === 'global') {
89. 					validator.error(`:global(...) must be the first element in a compound selector`, selector.start);
90. 				}
91. 			}
92. 		});
93. 
94. 		let start = 0;
95. 		let end = this.blocks.length;
96. 
97. 		for (; start < end; start += 1) {
98. 			if (!this.blocks[start].global) break;
99. 		}
100. 
101. 		for (; end > start; end -= 1) {
102. 			if (!this.blocks[end - 1].global) break;
103. 		}
104. 
105. 		for (let i = start; i < end; i += 1) {
106. 			if (this.blocks[i].global) {
107. 				validator.error(`:global(...) can be at the start or end of a selector sequence, but not in the middle`, this.blocks[i].selectors[0].start);
108. 			}
109. 		}
110. 	}
111. }
112. 
113. function isDescendantSelector(selector: Node) {
114. 	return selector.type === 'WhiteSpace' || selector.type === 'Combinator';
115. }
116. 
117. function selectorAppliesTo(blocks: Block[], node: Node, stack: Node[]): boolean {
118. 	const block = blocks.pop();
119. 	if (!block) return false;
120. 
121. 	if (!node) {
122. 		return blocks.every(block => block.global);
123. 	}
124. 
125. 	let i = block.selectors.length;
126. 	let j = stack.length;
127. 
128. 	while (i--) {
129. 		const selector = block.selectors[i];
130. 
131. 		if (selector.type === 'PseudoClassSelector' && selector.name === 'global') {
132. 			// TODO shouldn't see this here... maybe we should enforce that :global(...)
133. 			// cannot be sandwiched between non-global selectors?
134. 			return false;
135. 		}
136. 
137. 		if (selector.type === 'PseudoClassSelector' || selector.type === 'PseudoElementSelector') {
138. 			continue;
139. 		}
140. 
141. 		if (selector.type === 'ClassSelector') {
142. 			if (!attributeMatches(node, 'class', selector.name, '~=', false)) return false;
143. 		}
144. 
145. 		else if (selector.type === 'IdSelector') {
146. 			if (!attributeMatches(node, 'id', selector.name, '=', false)) return false;
147. 		}
148. 
149. 		else if (selector.type === 'AttributeSelector') {
150. 			if (!attributeMatches(node, selector.name.name, selector.value && unquote(selector.value.value), selector.operator, selector.flags)) return false;
151. 		}
152. 
153. 		else if (selector.type === 'TypeSelector') {
154. 			if (node.name !== selector.name && selector.name !== '*') return false;
155. 		}
156. 
157. 		else {
158. 			// bail. TODO figure out what these could be
159. 			return true;
160. 		}
161. 	}
162. 
163. 	if (block.combinator) {
164. 		if (block.combinator.type === 'WhiteSpace') {
165. 			while (stack.length) {
166. 				if (selectorAppliesTo(blocks.slice(), stack.pop(), stack)) {
167. 					return true;
168. 				}
169. 			}
170. 
171. 			return false;
172. 		} else if (block.combinator.name === '>') {
173. 			return selectorAppliesTo(blocks, stack.pop(), stack);
174. 		}
175. 
176. 		// TODO other combinators
177. 		return true;
178. 	}
179. 
180. 	return true;
181. }
182. 
183. const operators = {
184. 	'=' : (value: string, flags: string) => new RegExp(`^${value}$`, flags),
185. 	'~=': (value: string, flags: string) => new RegExp(`\\b${value}\\b`, flags),
186. 	'|=': (value: string, flags: string) => new RegExp(`^${value}(-.+)?$`, flags),
187. 	'^=': (value: string, flags: string) => new RegExp(`^${value}`, flags),
188. 	'$=': (value: string, flags: string) => new RegExp(`${value}$`, flags),
189. 	'*=': (value: string, flags: string) => new RegExp(value, flags)
190. };
191. 
192. function attributeMatches(node: Node, name: string, expectedValue: string, operator: string, caseInsensitive: boolean) {
193. 	const attr = node.attributes.find((attr: Node) => attr.name === name);
194. 	if (!attr) return false;
195. 	if (attr.value === true) return operator === null;
196. 	if (attr.value.length > 1) return true;
197. 
198. 	const pattern = operators[operator](expectedValue, caseInsensitive ? 'i' : '');
199. 	const value = attr.value[0];
200. 
201. 	if (value.type === 'Text') return pattern.test(value.data);
202. 
203. 	const possibleValues = new Set();
204. 	gatherPossibleValues(value.expression, possibleValues);
205. 	if (possibleValues.has(UNKNOWN)) return true;
206. 
207. 	for (const x of Array.from(possibleValues)) { // TypeScript for-of is slightly unlike JS
208. 		if (pattern.test(x)) return true;
209. 	}
210. 
211. 	return false;
212. }
213. 
214. function isDynamic(value: Node) {
215. 	return value.length > 1 || value[0].type !== 'Text';
216. }
217. 
218. function unquote(str: string) {
219. 	if (str[0] === str[str.length - 1] && str[0] === "'" || str[0] === '"') {
220. 		return str.slice(1, str.length - 1);
221. 	}
222. }
223. 
224. class Block {
225. 	global: boolean;
226. 	combinator: Node;
227. 	selectors: Node[]
228. 	start: number;
229. 	end: number;
230. 
231. 	constructor(combinator: Node) {
232. 		this.combinator = combinator;
233. 		this.global = false;
234. 		this.selectors = [];
235. 
236. 		this.start = null;
237. 		this.end = null;
238. 	}
239. 
240. 	add(selector: Node) {
241. 		if (this.selectors.length === 0) {
242. 			this.start = selector.start;
243. 			this.global = selector.type === 'PseudoClassSelector' && selector.name === 'global';
244. 		}
245. 
246. 		this.selectors.push(selector);
247. 		this.end = selector.end;
248. 	}
249. }
250. 
251. function groupSelectors(selector: Node) {
252. 	let block: Block = new Block(null);
253. 
254. 	const blocks = [block];
255. 
256. 	selector.children.forEach((child: Node, i: number) => {
257. 		if (child.type === 'WhiteSpace' || child.type === 'Combinator') {
258. 			block = new Block(child);
259. 			blocks.push(block);
260. 		} else {
261. 			block.add(child);
262. 		}
263. 	});
264. 
265. 	return blocks;
266. }


File: src/css/Stylesheet.ts
Line number range: 1 - 362
Content:
1. import MagicString from 'magic-string';
2. import { walk } from 'estree-walker';
3. import { getLocator } from 'locate-character';
4. import Selector from './Selector';
5. import getCodeFrame from '../utils/getCodeFrame';
6. import { Validator } from '../validate/index';
7. import { Node, Parsed, Warning } from '../interfaces';
8. 
9. class Rule {
10. 	selectors: Selector[];
11. 	declarations: Declaration[];
12. 	node: Node;
13. 	parent: Atrule;
14. 
15. 	constructor(node: Node, parent: Atrule) {
16. 		this.node = node;
17. 		this.parent = parent;
18. 		this.selectors = node.selector.children.map((node: Node) => new Selector(node));
19. 		this.declarations = node.block.children.map((node: Node) => new Declaration(node));
20. 
21. 		if (parent) parent.rules.push(this);
22. 	}
23. 
24. 	apply(node: Node, stack: Node[]) {
25. 		this.selectors.forEach(selector => selector.apply(node, stack)); // TODO move the logic in here?
26. 	}
27. 
28. 	isUsed() {
29. 		if (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;
30. 		return this.selectors.some(s => s.used);
31. 	}
32. 
33. 	minify(code: MagicString, cascade: boolean) {
34. 		let c = this.node.start;
35. 		this.selectors.forEach((selector, i) => {
36. 			if (cascade || selector.used) {
37. 				const separator = i > 0 ? ',' : '';
38. 				if ((selector.node.start - c) > separator.length) {
39. 					code.overwrite(c, selector.node.start, separator);
40. 				}
41. 
42. 				selector.minify(code);
43. 				c = selector.node.end;
44. 			}
45. 		});
46. 
47. 		code.remove(c, this.node.block.start);
48. 
49. 		c = this.node.block.start + 1;
50. 		this.declarations.forEach((declaration, i) => {
51. 			const separator = i > 0 ? ';' : '';
52. 			if ((declaration.node.start - c) > separator.length) {
53. 				code.overwrite(c, declaration.node.start, separator);
54. 			}
55. 
56. 			declaration.minify(code);
57. 
58. 			c = declaration.node.end;
59. 		});
60. 
61. 		code.remove(c, this.node.block.end - 1);
62. 	}
63. 
64. 	transform(code: MagicString, id: string, keyframes: Map<string, string>, cascade: boolean) {
65. 		if (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;
66. 
67. 		const attr = `[${id}]`;
68. 
69. 		if (cascade) {
70. 			this.selectors.forEach(selector => {
71. 				// TODO disable cascading (without :global(...)) in v2
72. 				const { start, end, children } = selector.node;
73. 
74. 				const css = code.original;
75. 				const selectorString = css.slice(start, end);
76. 
77. 				const firstToken = children[0];
78. 
79. 				let transformed;
80. 
81. 				if (firstToken.type === 'TypeSelector') {
82. 					const insert = firstToken.end;
83. 					const head = firstToken.name === '*' ? '' : css.slice(start, insert);
84. 					const tail = css.slice(insert, end);
85. 
86. 					transformed = `${head}${attr}${tail},${attr} ${selectorString}`;
87. 				} else {
88. 					transformed = `${attr}${selectorString},${attr} ${selectorString}`;
89. 				}
90. 
91. 				code.overwrite(start, end, transformed);
92. 			});
93. 		} else {
94. 			this.selectors.forEach(selector => selector.transform(code, attr));
95. 		}
96. 
97. 		this.declarations.forEach(declaration => declaration.transform(code, keyframes));
98. 	}
99. }
100. 
101. class Declaration {
102. 	node: Node;
103. 
104. 	constructor(node: Node) {
105. 		this.node = node;
106. 	}
107. 
108. 	transform(code: MagicString, keyframes: Map<string, string>) {
109. 		const property = this.node.property.toLowerCase();
110. 		if (property === 'animation' || property === 'animation-name') {
111. 			this.node.value.children.forEach((block: Node) => {
112. 				if (block.type === 'Identifier') {
113. 					const name = block.name;
114. 					if (keyframes.has(name)) {
115. 						code.overwrite(block.start, block.end, keyframes.get(name));
116. 					}
117. 				}
118. 			});
119. 		}
120. 	}
121. 
122. 	minify(code: MagicString) {
123. 		const c = this.node.start + this.node.property.length;
124. 		const first = this.node.value.children[0];
125. 
126. 		if (first.start - c > 1) {
127. 			code.overwrite(c, first.start, ':');
128. 		}
129. 	}
130. }
131. 
132. class Atrule {
133. 	node: Node;
134. 	rules: Rule[];
135. 
136. 	constructor(node: Node) {
137. 		this.node = node;
138. 		this.rules = [];
139. 	}
140. 
141. 	isUsed() {
142. 		return true; // TODO
143. 	}
144. 
145. 	minify(code: MagicString, cascade: boolean) {
146. 		if (this.node.name === 'media') {
147. 			let c = this.node.start + 6;
148. 			if (this.node.expression.start > c) code.remove(c, this.node.expression.start);
149. 
150. 			this.node.expression.children.forEach((query: Node) => {
151. 				// TODO minify queries
152. 				c = query.end;
153. 			});
154. 
155. 			code.remove(c, this.node.block.start);
156. 		} else if (this.node.name === 'keyframes') {
157. 			let c = this.node.start + 10;
158. 			if (this.node.expression.start - c > 1) code.overwrite(c, this.node.expression.start, ' ');
159. 			c = this.node.expression.end;
160. 			if (this.node.block.start - c > 0) code.remove(c, this.node.block.start);
161. 		}
162. 
163. 		// TODO other atrules
164. 
165. 		if (this.node.block) {
166. 			let c = this.node.block.start + 1;
167. 
168. 			this.rules.forEach(rule => {
169. 				if (cascade || rule.isUsed()) {
170. 					code.remove(c, rule.node.start);
171. 					rule.minify(code, cascade);
172. 					c = rule.node.end;
173. 				}
174. 			});
175. 
176. 			code.remove(c, this.node.block.end - 1);
177. 		}
178. 	}
179. 
180. 	transform(code: MagicString, id: string, keyframes: Map<string, string>) {
181. 		if (this.node.name !== 'keyframes') return;
182. 
183. 		this.node.expression.children.forEach((expression: Node) => {
184. 			if (expression.type === 'Identifier') {
185. 				if (expression.name.startsWith('-global-')) {
186. 					code.remove(expression.start, expression.start + 8);
187. 				} else {
188. 					const newName = `${id}-${expression.name}`;
189. 					code.overwrite(expression.start, expression.end, newName);
190. 					keyframes.set(expression.name, newName);
191. 				}
192. 			}
193. 		});
194. 	}
195. }
196. 
197. const keys = {};
198. 
199. export default class Stylesheet {
200. 	source: string;
201. 	parsed: Parsed;
202. 	cascade: boolean;
203. 	filename: string;
204. 
205. 	hasStyles: boolean;
206. 	id: string;
207. 
208. 	nodes: (Rule|Atrule)[];
209. 	rules: Rule[];
210. 	atrules: Atrule[];
211. 
212. 	constructor(source: string, parsed: Parsed, filename: string, cascade: boolean) {
213. 		this.source = source;
214. 		this.parsed = parsed;
215. 		this.cascade = cascade;
216. 		this.filename = filename;
217. 
218. 		this.id = `svelte-${parsed.hash}`;
219. 
220. 		this.nodes = [];
221. 		this.rules = [];
222. 		this.atrules = [];
223. 
224. 		if (parsed.css && parsed.css.children.length) {
225. 			this.hasStyles = true;
226. 
227. 			const stack: Atrule[] = [];
228. 			let currentAtrule: Atrule = null;
229. 
230. 			walk(this.parsed.css, {
231. 				enter: (node: Node) => {
232. 					if (node.type === 'Atrule') {
233. 						const atrule = currentAtrule = new Atrule(node);
234. 						stack.push(atrule);
235. 
236. 						this.nodes.push(atrule);
237. 						this.atrules.push(atrule);
238. 					}
239. 
240. 					if (node.type === 'Rule') {
241. 						// TODO this is a bit confusing. Don't have a separate
242. 						// array of rules, just transform top-level nodes and
243. 						// let them worry about their children
244. 						const rule = new Rule(node, currentAtrule);
245. 
246. 						this.rules.push(rule);
247. 
248. 						if (!currentAtrule) {
249. 							this.nodes.push(rule);
250. 						}
251. 					}
252. 				},
253. 
254. 				leave: (node: Node) => {
255. 					if (node.type === 'Atrule') {
256. 						stack.pop();
257. 						currentAtrule = stack[stack.length - 1];
258. 					}
259. 				}
260. 			});
261. 		} else {
262. 			this.hasStyles = false;
263. 		}
264. 	}
265. 
266. 	apply(node: Node, stack: Node[]) {
267. 		if (!this.hasStyles) return;
268. 
269. 		if (this.cascade) {
270. 			if (stack.length === 0) node._needsCssAttribute = true;
271. 			return;
272. 		}
273. 
274. 		for (let i = 0; i < this.rules.length; i += 1) {
275. 			const rule = this.rules[i];
276. 			rule.apply(node, stack);
277. 		}
278. 	}
279. 
280. 	render(cssOutputFilename: string) {
281. 		if (!this.hasStyles) {
282. 			return { css: null, cssMap: null };
283. 		}
284. 
285. 		const code = new MagicString(this.source);
286. 
287. 		walk(this.parsed.css, {
288. 			enter: (node: Node) => {
289. 				code.addSourcemapLocation(node.start);
290. 				code.addSourcemapLocation(node.end);
291. 			}
292. 		});
293. 
294. 		// TODO all transform/minify in single pass. The mutation of
295. 		// `keyframes` here is confusing
296. 		const keyframes = new Map();
297. 		this.atrules.forEach((atrule: Atrule) => {
298. 			atrule.transform(code, this.id, keyframes);
299. 		});
300. 
301. 		this.rules.forEach((rule: Rule) => {
302. 			rule.transform(code, this.id, keyframes, this.cascade);
303. 		});
304. 
305. 		let c = 0;
306. 		this.nodes.forEach(node => {
307. 			if (this.cascade || node.isUsed()) {
308. 				code.remove(c, node.node.start);
309. 				node.minify(code, this.cascade);
310. 				c = node.node.end;
311. 			}
312. 		});
313. 
314. 		code.remove(c, this.source.length);
315. 
316. 		return {
317. 			css: code.toString(),
318. 			cssMap: code.generateMap({
319. 				includeContent: true,
320. 				source: this.filename,
321. 				file: cssOutputFilename
322. 			})
323. 		};
324. 	}
325. 
326. 	validate(validator: Validator) {
327. 		this.rules.forEach(rule => {
328. 			rule.selectors.forEach(selector => {
329. 				selector.validate(validator);
330. 			});
331. 		});
332. 	}
333. 
334. 	warnOnUnusedSelectors(onwarn: (warning: Warning) => void) {
335. 		if (this.cascade) return;
336. 
337. 		let locator;
338. 
339. 		this.rules.forEach((rule: Rule) => {
340. 			rule.selectors.forEach(selector => {
341. 				if (!selector.used) {
342. 					const pos = selector.node.start;
343. 
344. 					if (!locator) locator = getLocator(this.source);
345. 					const { line, column } = locator(pos);
346. 
347. 					const frame = getCodeFrame(this.source, line, column);
348. 					const message = `Unused CSS selector`;
349. 
350. 					onwarn({
351. 						message,
352. 						frame,
353. 						loc: { line: line + 1, column },
354. 						pos,
355. 						filename: this.filename,
356. 						toString: () => `${message} (${line + 1}:${column})\n${frame}`,
357. 					});
358. 				}
359. 			});
360. 		});
361. 	}
362. }


File: src/generators/dom/index.ts
Line number range: 182 - 191
Content:
182. 	// TODO deprecate component.teardown()
183. 	builder.addBlock(deindent`
184. 		function ${name} ( options ) {
185. 			options = options || {};
186. 			${options.dev &&
187. 				`if ( !options.target && !options._root ) throw new Error( "'target' is a required option" );`}
188. 			${generator.usesRefs && `this.refs = {};`}
189. 			this._state = ${templateProperties.data
190. 				? `@assign( @template.data(), options.data )`
191. 				: `options.data || {}`};


File: src/generators/dom/visitors/Component/Ref.ts
Line number range: 1 - 22
Content:
1. import deindent from '../../../../utils/deindent';
2. import { DomGenerator } from '../../index';
3. import Block from '../../Block';
4. import { Node } from '../../../../interfaces';
5. import { State } from '../../interfaces';
6. 
7. export default function visitRef(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	attribute: Node,
13. 	local
14. ) {
15. 	generator.usesRefs = true;
16. 
17. 	local.create.addLine(`#component.refs.${attribute.name} = ${local.name};`);
18. 
19. 	block.builders.destroy.addLine(deindent`
20. 		if ( #component.refs.${attribute.name} === ${local.name} ) #component.refs.${attribute.name} = null;
21. 	`);
22. }


File: src/generators/dom/visitors/Element/Element.ts
Line number range: 1 - 255
Content:
1. import deindent from '../../../../utils/deindent';
2. import visit from '../../visit';
3. import visitComponent from '../Component/Component';
4. import visitWindow from './meta/Window';
5. import visitAttribute from './Attribute';
6. import visitEventHandler from './EventHandler';
7. import visitBinding from './Binding';
8. import visitRef from './Ref';
9. import * as namespaces from '../../../../utils/namespaces';
10. import addTransitions from './addTransitions';
11. import { DomGenerator } from '../../index';
12. import Block from '../../Block';
13. import { Node } from '../../../../interfaces';
14. import { State } from '../../interfaces';
15. 
16. const meta = {
17. 	':Window': visitWindow,
18. };
19. 
20. const order = {
21. 	Attribute: 1,
22. 	Binding: 2,
23. 	EventHandler: 3,
24. 	Ref: 4,
25. };
26. 
27. const visitors = {
28. 	Attribute: visitAttribute,
29. 	EventHandler: visitEventHandler,
30. 	Binding: visitBinding,
31. 	Ref: visitRef,
32. };
33. 
34. export default function visitElement(
35. 	generator: DomGenerator,
36. 	block: Block,
37. 	state: State,
38. 	node: Node,
39. 	elementStack: Node[]
40. ) {
41. 	if (node.name in meta) {
42. 		return meta[node.name](generator, block, node);
43. 	}
44. 
45. 	if (generator.components.has(node.name) || node.name === ':Self') {
46. 		return visitComponent(generator, block, state, node, elementStack);
47. 	}
48. 
49. 	const childState = node._state;
50. 	const name = childState.parentNode;
51. 
52. 	const isToplevel = !state.parentNode;
53. 
54. 	block.addVariable(name);
55. 	block.builders.create.addLine(
56. 		`${name} = ${getRenderStatement(
57. 			generator,
58. 			childState.namespace,
59. 			node.name
60. 		)};`
61. 	);
62. 
63. 	if (generator.hydratable) {
64. 		block.builders.claim.addBlock(deindent`
65. 			${name} = ${getClaimStatement(
66. 			generator,
67. 			childState.namespace,
68. 			state.parentNodes,
69. 			node
70. 		)};
71. 			var ${childState.parentNodes} = @children( ${name} );
72. 		`);
73. 	}
74. 
75. 	if (state.parentNode) {
76. 		block.builders.mount.addLine(
77. 			`@appendNode( ${name}, ${state.parentNode} );`
78. 		);
79. 	} else {
80. 		block.builders.mount.addLine(`@insertNode( ${name}, #target, anchor );`);
81. 	}
82. 
83. 	// add CSS encapsulation attribute
84. 	// TODO add a helper for this, rather than repeating it
85. 	if (node._needsCssAttribute) {
86. 		generator.needsEncapsulateHelper = true;
87. 		block.builders.hydrate.addLine(
88. 			`@encapsulateStyles( ${name} );`
89. 		);
90. 	}
91. 
92. 	function visitAttributesAndAddProps() {
93. 		let intro;
94. 		let outro;
95. 
96. 		node.attributes
97. 			.sort((a: Node, b: Node) => order[a.type] - order[b.type])
98. 			.forEach((attribute: Node) => {
99. 				if (attribute.type === 'Transition') {
100. 					if (attribute.intro) intro = attribute;
101. 					if (attribute.outro) outro = attribute;
102. 					return;
103. 				}
104. 
105. 				visitors[attribute.type](generator, block, childState, node, attribute);
106. 			});
107. 
108. 		if (intro || outro)
109. 			addTransitions(generator, block, childState, node, intro, outro);
110. 
111. 		if (childState.allUsedContexts.length || childState.usesComponent) {
112. 			const initialProps: string[] = [];
113. 			const updates: string[] = [];
114. 
115. 			if (childState.usesComponent) {
116. 				initialProps.push(`component: #component`);
117. 			}
118. 
119. 			childState.allUsedContexts.forEach((contextName: string) => {
120. 				if (contextName === 'state') return;
121. 
122. 				const listName = block.listNames.get(contextName);
123. 				const indexName = block.indexNames.get(contextName);
124. 
125. 				initialProps.push(
126. 					`${listName}: ${listName},\n${indexName}: ${indexName}`
127. 				);
128. 				updates.push(
129. 					`${name}._svelte.${listName} = ${listName};\n${name}._svelte.${indexName} = ${indexName};`
130. 				);
131. 			});
132. 
133. 			if (initialProps.length) {
134. 				block.builders.hydrate.addBlock(deindent`
135. 					${name}._svelte = {
136. 						${initialProps.join(',\n')}
137. 					};
138. 				`);
139. 			}
140. 
141. 			if (updates.length) {
142. 				block.builders.update.addBlock(updates.join('\n'));
143. 			}
144. 		}
145. 	}
146. 
147. 	if (isToplevel) {
148. 		// TODO we eventually need to consider what happens to elements
149. 		// that belong to the same outgroup as an outroing element...
150. 		block.builders.unmount.addLine(`@detachNode( ${name} );`);
151. 	}
152. 
153. 	if (node.name !== 'select') {
154. 		if (node.name === 'textarea') {
155. 			// this is an egregious hack, but it's the easiest way to get <textarea>
156. 			// children treated the same way as a value attribute
157. 			if (node.children.length > 0) {
158. 				node.attributes.push({
159. 					type: 'Attribute',
160. 					name: 'value',
161. 					value: node.children,
162. 				});
163. 
164. 				node.children = [];
165. 			}
166. 		}
167. 
168. 		// <select> value attributes are an annoying special case — it must be handled
169. 		// *after* its children have been updated
170. 		visitAttributesAndAddProps();
171. 	}
172. 
173. 	// special case – bound <option> without a value attribute
174. 	if (
175. 		node.name === 'option' &&
176. 		!node.attributes.find(
177. 			(attribute: Node) =>
178. 				attribute.type === 'Attribute' && attribute.name === 'value'
179. 		)
180. 	) {
181. 		// TODO check it's bound
182. 		const statement = `${name}.__value = ${name}.textContent;`;
183. 		node.initialUpdate = node.lateUpdate = statement;
184. 	}
185. 
186. 	node.children.forEach((child: Node) => {
187. 		visit(generator, block, childState, child, elementStack.concat(node));
188. 	});
189. 
190. 	if (node.lateUpdate) {
191. 		block.builders.update.addLine(node.lateUpdate);
192. 	}
193. 
194. 	if (node.name === 'select') {
195. 		visitAttributesAndAddProps();
196. 	}
197. 
198. 	if (node.initialUpdate) {
199. 		// special case — if we're in a yield block, then we may call mount
200. 		// long after the fragment is created. We may therefore need to get
201. 		// the latest `state` object
202. 		// TODO what about contexts in yield blocks? do we need to do
203. 		// `var ${contextName} = [something complicated]`?
204. 		const needsStateObject = node.initialUpdateNeedsStateObject && state.isYield;
205. 
206. 		if ( needsStateObject ) {
207. 			block.builders.mount.addLine(`var state = #component.get()`);
208. 		}
209. 
210. 		block.builders.mount.addBlock(node.initialUpdate);
211. 	}
212. 
213. 	block.builders.claim.addLine(
214. 		`${childState.parentNodes}.forEach( @detachNode );`
215. 	);
216. }
217. 
218. function getRenderStatement(
219. 	generator: DomGenerator,
220. 	namespace: string,
221. 	name: string
222. ) {
223. 	if (namespace === 'http://www.w3.org/2000/svg') {
224. 		return `@createSvgElement( '${name}' )`;
225. 	}
226. 
227. 	if (namespace) {
228. 		return `document.createElementNS( '${namespace}', '${name}' )`;
229. 	}
230. 
231. 	return `@createElement( '${name}' )`;
232. }
233. 
234. function getClaimStatement(
235. 	generator: DomGenerator,
236. 	namespace: string,
237. 	nodes: string,
238. 	node: Node
239. ) {
240. 	const attributes = node.attributes
241. 		.filter((attr: Node) => attr.type === 'Attribute')
242. 		.map((attr: Node) => `${quoteProp(attr.name)}: true`)
243. 		.join(', ');
244. 
245. 	const name = namespace ? node.name : node.name.toUpperCase();
246. 
247. 	return `@claimElement( ${nodes}, '${name}', ${attributes
248. 		? `{ ${attributes} }`
249. 		: `{}`}, ${namespace === namespaces.svg ? true : false} )`;
250. }
251. 
252. function quoteProp(name: string) {
253. 	if (/[^a-zA-Z_$0-9]/.test(name)) return `'${name}'`;
254. 	return name;
255. }


File: src/generators/dom/visitors/Element/EventHandler.ts
Line number range: 23 - 35
Content:
23. 		generator.addSourcemapLocations(attribute.expression);
24. 
25. 		const flattened = flattenReference(attribute.expression.callee);
26. 		if (flattened.name !== 'event' && flattened.name !== 'this') {
27. 			// allow event.stopPropagation(), this.select() etc
28. 			// TODO verify that it's a valid callee (i.e. built-in or declared method)
29. 			generator.code.prependRight(
30. 				attribute.expression.start,
31. 				`${block.alias('component')}.`
32. 			);
33. 			if (shouldHoist) state.usesComponent = true; // this feels a bit hacky but it works!
34. 		}
35. 


File: src/generators/dom/visitors/Element/Ref.ts
Line number range: 1 - 25
Content:
1. import deindent from '../../../../utils/deindent';
2. import { DomGenerator } from '../../index';
3. import Block from '../../Block';
4. import { Node } from '../../../../interfaces';
5. import { State } from '../../interfaces';
6. 
7. export default function visitRef(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	attribute: Node
13. ) {
14. 	const name = attribute.name;
15. 
16. 	block.builders.mount.addLine(
17. 		`#component.refs.${name} = ${state.parentNode};`
18. 	);
19. 
20. 	block.builders.destroy.addLine(deindent`
21. 		if ( #component.refs.${name} === ${state.parentNode} ) #component.refs.${name} = null;
22. 	`);
23. 
24. 	generator.usesRefs = true; // so this component.refs object is created
25. }


File: src/parse/read/directives.ts
Line number range: 1 - 164
Content:
1. import { parseExpressionAt } from 'acorn';
2. import spaces from '../../utils/spaces';
3. import { Parser } from '../index';
4. 
5. function readExpression(parser: Parser, start: number, quoteMark: string|null) {
6. 	let str = '';
7. 	let escaped = false;
8. 
9. 	for (let i = start; i < parser.template.length; i += 1) {
10. 		const char = parser.template[i];
11. 
12. 		if (quoteMark) {
13. 			if (char === quoteMark) {
14. 				if (escaped) {
15. 					str += quoteMark;
16. 				} else {
17. 					break;
18. 				}
19. 			} else if (escaped) {
20. 				str += '\\' + char;
21. 				escaped = false;
22. 			} else if (char === '\\') {
23. 				escaped = true;
24. 			} else {
25. 				str += char;
26. 			}
27. 		} else if (/\s/.test(char)) {
28. 			break;
29. 		} else {
30. 			str += char;
31. 		}
32. 	}
33. 
34. 	const expression = parseExpressionAt(spaces(start) + str, start);
35. 	parser.index = expression.end;
36. 
37. 	parser.allowWhitespace();
38. 	if (quoteMark) parser.eat(quoteMark, true);
39. 
40. 	return expression;
41. }
42. 
43. export function readEventHandlerDirective(
44. 	parser: Parser,
45. 	start: number,
46. 	name: string,
47. 	hasValue: boolean
48. ) {
49. 	let expression;
50. 
51. 	if (hasValue) {
52. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
53. 
54. 		const expressionStart = parser.index;
55. 
56. 		expression = readExpression(parser, expressionStart, quoteMark);
57. 
58. 		if (expression.type !== 'CallExpression') {
59. 			parser.error(`Expected call expression`, expressionStart);
60. 		}
61. 	}
62. 
63. 	return {
64. 		start,
65. 		end: parser.index,
66. 		type: 'EventHandler',
67. 		name,
68. 		expression,
69. 	};
70. }
71. 
72. export function readBindingDirective(
73. 	parser: Parser,
74. 	start: number,
75. 	name: string
76. ) {
77. 	let value;
78. 
79. 	if (parser.eat('=')) {
80. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
81. 
82. 		const a = parser.index;
83. 
84. 		if (parser.eat('{{')) {
85. 			let message = 'bound values should not be wrapped';
86. 			const b = parser.template.indexOf('}}', a);
87. 			if (b !== -1) {
88. 				const value = parser.template.slice(parser.index, b);
89. 				message += ` — use '${value}', not '{{${value}}}'`;
90. 			}
91. 
92. 			parser.error(message, a);
93. 		}
94. 
95. 		// this is a bit of a hack so that we can give Acorn something parseable
96. 		let b;
97. 		if (quoteMark) {
98. 			b = parser.index = parser.template.indexOf(quoteMark, parser.index);
99. 		} else {
100. 			parser.readUntil(/[\s\r\n\/>]/);
101. 			b = parser.index;
102. 		}
103. 
104. 		const source = spaces(a) + parser.template.slice(a, b);
105. 		value = parseExpressionAt(source, a);
106. 
107. 		if (value.type !== 'Identifier' && value.type !== 'MemberExpression') {
108. 			parser.error(`Cannot bind to rvalue`, value.start);
109. 		}
110. 
111. 		parser.allowWhitespace();
112. 
113. 		if (quoteMark) {
114. 			parser.eat(quoteMark, true);
115. 		}
116. 	} else {
117. 		// shorthand – bind:foo equivalent to bind:foo='foo'
118. 		value = {
119. 			type: 'Identifier',
120. 			start: start + 5,
121. 			end: parser.index,
122. 			name,
123. 		};
124. 	}
125. 
126. 	return {
127. 		start,
128. 		end: parser.index,
129. 		type: 'Binding',
130. 		name,
131. 		value,
132. 	};
133. }
134. 
135. export function readTransitionDirective(
136. 	parser: Parser,
137. 	start: number,
138. 	name: string,
139. 	type: string
140. ) {
141. 	let expression = null;
142. 
143. 	if (parser.eat('=')) {
144. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
145. 
146. 		const expressionStart = parser.index;
147. 
148. 		expression = readExpression(parser, expressionStart, quoteMark);
149. 
150. 		if (expression.type !== 'ObjectExpression') {
151. 			parser.error(`Expected object expression`, expressionStart);
152. 		}
153. 	}
154. 
155. 	return {
156. 		start,
157. 		end: parser.index,
158. 		type: 'Transition',
159. 		name,
160. 		intro: type === 'in' || type === 'transition',
161. 		outro: type === 'out' || type === 'transition',
162. 		expression,
163. 	};
164. }


File: src/parse/state/tag.ts
Line number range: 260 - 271
Content:
260. 	if (/^bind:/.test(name)) {
261. 		return readBindingDirective(parser, start, name.slice(5));
262. 	}
263. 
264. 	if (/^ref:/.test(name)) {
265. 		return {
266. 			start,
267. 			end: parser.index,
268. 			type: 'Ref',
269. 			name: name.slice(4),
270. 		};
271. 	}


File: test/validator/samples/event-handler-ref-invalid/input.html
Line number range: 1 - 2
Content:
1. <input ref:input>
2. <button on:click='refs.inputx.focus()'>focus input</button>


File: test/validator/samples/event-handler-ref/input.html
Line number range: 1 - 2
Content:
1. <input ref:input>
2. <button on:click='refs.input.focus()'>focus input</button>

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-10 23:25:33,662 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The issue asks about using refs in CSS. The provided context includes: (a) parsing and representation of ref directives (src/parse/state/tag.ts), (b) DOM code that creates and assigns refs (src/generators/dom/index.ts, src/generators/dom/visitors/Element/Ref.ts, src/generators/dom/visitors/Component/Ref.ts), (c) tests showing refs used from event handlers (test/validator/samples/event-handler-ref/*.html), and (d) CSS selector handling and scoping (src/css/Selector.ts, src/css/Stylesheet.ts). These show that refs exist only in runtime component.refs and not as CSS selectors, and that CSS supports class/id/attribute/type selectors with scoping attributes. This is sufficient to classify the issue as a feature request without additional files or documentation. No further context is essential.' query='' extra_requirements='' purpose=''
2025-11-10 23:25:33,666 - thread-133013312636608.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='README.md', content="80. | `cascade` | `true`, `false` | Whether to cascade all of the component's styles to child components. If `false`, only selectors wrapped in `:global(...)` and keyframe IDs beginning with `-global-` are cascaded. | `true` |\n81. | `shared` | `true`, `false`, `string` | Whether to import various helpers from a shared external library. When you have a project with multiple components, this reduces the overall size of your JavaScript bundle, at the expense of having immediately-usable component. You can pass a string of the module path to use, or `true` will import from `'svelte/shared.js'`. | `false` |\n82. | `dev` | `true`, `false` | Whether to enable run-time checks in the compiled component. These are helpful during development, but slow your component down. | `false` |\n83. | `css` | `true`, `false` | Whether to include code to inject your component's styles into the DOM. | `true` |", start_line_number=80, end_line_number=83), Context(relative_path='src/css/Selector.ts', content='1. import MagicString from \'magic-string\';\n2. import { gatherPossibleValues, UNKNOWN } from \'./gatherPossibleValues\';\n3. import { Validator } from \'../validate/index\';\n4. import { Node } from \'../interfaces\';\n5. \n6. export default class Selector {\n7. \tnode: Node;\n8. \tblocks: Block[];\n9. \tlocalBlocks: Block[];\n10. \tused: boolean;\n11. \n12. \tconstructor(node: Node) {\n13. \t\tthis.node = node;\n14. \n15. \t\tthis.blocks = groupSelectors(node);\n16. \n17. \t\t// take trailing :global(...) selectors out of consideration\n18. \t\tlet i = this.blocks.length;\n19. \t\twhile (i > 0) {\n20. \t\t\tif (!this.blocks[i - 1].global) break;\n21. \t\t\ti -= 1;\n22. \t\t}\n23. \n24. \t\tthis.localBlocks = this.blocks.slice(0, i);\n25. \t\tthis.used = this.blocks[0].global;\n26. \t}\n27. \n28. \tapply(node: Node, stack: Node[]) {\n29. \t\tconst applies = selectorAppliesTo(this.localBlocks.slice(), node, stack.slice());\n30. \n31. \t\tif (applies) {\n32. \t\t\tthis.used = true;\n33. \n34. \t\t\t// add svelte-123xyz attribute to outermost and innermost\n35. \t\t\t// elements — no need to add it to intermediate elements\n36. \t\t\tnode._needsCssAttribute = true;\n37. \t\t\tif (stack[0] && this.node.children.find(isDescendantSelector)) stack[0]._needsCssAttribute = true;\n38. \t\t}\n39. \t}\n40. \n41. \tminify(code: MagicString) {\n42. \t\tlet c: number = null;\n43. \t\tthis.blocks.forEach((block, i) => {\n44. \t\t\tif (i > 0) {\n45. \t\t\t\tif (block.start - c > 1) {\n46. \t\t\t\t\tcode.overwrite(c, block.start, block.combinator.name || \' \');\n47. \t\t\t\t}\n48. \t\t\t}\n49. \n50. \t\t\tc = block.end;\n51. \t\t});\n52. \t}\n53. \n54. \ttransform(code: MagicString, attr: string) {\n55. \t\tfunction encapsulateBlock(block: Block) {\n56. \t\t\tlet i = block.selectors.length;\n57. \t\t\twhile (i--) {\n58. \t\t\t\tconst selector = block.selectors[i];\n59. \t\t\t\tif (selector.type === \'PseudoElementSelector\' || selector.type === \'PseudoClassSelector\') continue;\n60. \n61. \t\t\t\tif (selector.type === \'TypeSelector\' && selector.name === \'*\') {\n62. \t\t\t\t\tcode.overwrite(selector.start, selector.end, attr);\n63. \t\t\t\t} else {\n64. \t\t\t\t\tcode.appendLeft(selector.end, attr);\n65. \t\t\t\t}\n66. \n67. \t\t\t\treturn;\n68. \t\t\t}\n69. \t\t}\n70. \n71. \t\tthis.blocks.forEach((block, i) => {\n72. \t\t\tif (block.global) {\n73. \t\t\t\tconst selector = block.selectors[0];\n74. \t\t\t\tconst first = selector.children[0];\n75. \t\t\t\tconst last = selector.children[selector.children.length - 1];\n76. \t\t\t\tcode.remove(selector.start, first.start).remove(last.end, selector.end);\n77. \t\t\t} else if (i === 0 || i === this.blocks.length - 1) {\n78. \t\t\t\tencapsulateBlock(block);\n79. \t\t\t}\n80. \t\t});\n81. \t}\n82. \n83. \tvalidate(validator: Validator) {\n84. \t\tthis.blocks.forEach((block) => {\n85. \t\t\tlet i = block.selectors.length;\n86. \t\t\twhile (i-- > 1) {\n87. \t\t\t\tconst selector = block.selectors[i];\n88. \t\t\t\tif (selector.type === \'PseudoClassSelector\' && selector.name === \'global\') {\n89. \t\t\t\t\tvalidator.error(`:global(...) must be the first element in a compound selector`, selector.start);\n90. \t\t\t\t}\n91. \t\t\t}\n92. \t\t});\n93. \n94. \t\tlet start = 0;\n95. \t\tlet end = this.blocks.length;\n96. \n97. \t\tfor (; start < end; start += 1) {\n98. \t\t\tif (!this.blocks[start].global) break;\n99. \t\t}\n100. \n101. \t\tfor (; end > start; end -= 1) {\n102. \t\t\tif (!this.blocks[end - 1].global) break;\n103. \t\t}\n104. \n105. \t\tfor (let i = start; i < end; i += 1) {\n106. \t\t\tif (this.blocks[i].global) {\n107. \t\t\t\tvalidator.error(`:global(...) can be at the start or end of a selector sequence, but not in the middle`, this.blocks[i].selectors[0].start);\n108. \t\t\t}\n109. \t\t}\n110. \t}\n111. }\n112. \n113. function isDescendantSelector(selector: Node) {\n114. \treturn selector.type === \'WhiteSpace\' || selector.type === \'Combinator\';\n115. }\n116. \n117. function selectorAppliesTo(blocks: Block[], node: Node, stack: Node[]): boolean {\n118. \tconst block = blocks.pop();\n119. \tif (!block) return false;\n120. \n121. \tif (!node) {\n122. \t\treturn blocks.every(block => block.global);\n123. \t}\n124. \n125. \tlet i = block.selectors.length;\n126. \tlet j = stack.length;\n127. \n128. \twhile (i--) {\n129. \t\tconst selector = block.selectors[i];\n130. \n131. \t\tif (selector.type === \'PseudoClassSelector\' && selector.name === \'global\') {\n132. \t\t\t// TODO shouldn\'t see this here... maybe we should enforce that :global(...)\n133. \t\t\t// cannot be sandwiched between non-global selectors?\n134. \t\t\treturn false;\n135. \t\t}\n136. \n137. \t\tif (selector.type === \'PseudoClassSelector\' || selector.type === \'PseudoElementSelector\') {\n138. \t\t\tcontinue;\n139. \t\t}\n140. \n141. \t\tif (selector.type === \'ClassSelector\') {\n142. \t\t\tif (!attributeMatches(node, \'class\', selector.name, \'~=\', false)) return false;\n143. \t\t}\n144. \n145. \t\telse if (selector.type === \'IdSelector\') {\n146. \t\t\tif (!attributeMatches(node, \'id\', selector.name, \'=\', false)) return false;\n147. \t\t}\n148. \n149. \t\telse if (selector.type === \'AttributeSelector\') {\n150. \t\t\tif (!attributeMatches(node, selector.name.name, selector.value && unquote(selector.value.value), selector.operator, selector.flags)) return false;\n151. \t\t}\n152. \n153. \t\telse if (selector.type === \'TypeSelector\') {\n154. \t\t\tif (node.name !== selector.name && selector.name !== \'*\') return false;\n155. \t\t}\n156. \n157. \t\telse {\n158. \t\t\t// bail. TODO figure out what these could be\n159. \t\t\treturn true;\n160. \t\t}\n161. \t}\n162. \n163. \tif (block.combinator) {\n164. \t\tif (block.combinator.type === \'WhiteSpace\') {\n165. \t\t\twhile (stack.length) {\n166. \t\t\t\tif (selectorAppliesTo(blocks.slice(), stack.pop(), stack)) {\n167. \t\t\t\t\treturn true;\n168. \t\t\t\t}\n169. \t\t\t}\n170. \n171. \t\t\treturn false;\n172. \t\t} else if (block.combinator.name === \'>\') {\n173. \t\t\treturn selectorAppliesTo(blocks, stack.pop(), stack);\n174. \t\t}\n175. \n176. \t\t// TODO other combinators\n177. \t\treturn true;\n178. \t}\n179. \n180. \treturn true;\n181. }\n182. \n183. const operators = {\n184. \t\'=\' : (value: string, flags: string) => new RegExp(`^${value}$`, flags),\n185. \t\'~=\': (value: string, flags: string) => new RegExp(`\\\\b${value}\\\\b`, flags),\n186. \t\'|=\': (value: string, flags: string) => new RegExp(`^${value}(-.+)?$`, flags),\n187. \t\'^=\': (value: string, flags: string) => new RegExp(`^${value}`, flags),\n188. \t\'$=\': (value: string, flags: string) => new RegExp(`${value}$`, flags),\n189. \t\'*=\': (value: string, flags: string) => new RegExp(value, flags)\n190. };\n191. \n192. function attributeMatches(node: Node, name: string, expectedValue: string, operator: string, caseInsensitive: boolean) {\n193. \tconst attr = node.attributes.find((attr: Node) => attr.name === name);\n194. \tif (!attr) return false;\n195. \tif (attr.value === true) return operator === null;\n196. \tif (attr.value.length > 1) return true;\n197. \n198. \tconst pattern = operators[operator](expectedValue, caseInsensitive ? \'i\' : \'\');\n199. \tconst value = attr.value[0];\n200. \n201. \tif (value.type === \'Text\') return pattern.test(value.data);\n202. \n203. \tconst possibleValues = new Set();\n204. \tgatherPossibleValues(value.expression, possibleValues);\n205. \tif (possibleValues.has(UNKNOWN)) return true;\n206. \n207. \tfor (const x of Array.from(possibleValues)) { // TypeScript for-of is slightly unlike JS\n208. \t\tif (pattern.test(x)) return true;\n209. \t}\n210. \n211. \treturn false;\n212. }\n213. \n214. function isDynamic(value: Node) {\n215. \treturn value.length > 1 || value[0].type !== \'Text\';\n216. }\n217. \n218. function unquote(str: string) {\n219. \tif (str[0] === str[str.length - 1] && str[0] === "\'" || str[0] === \'"\') {\n220. \t\treturn str.slice(1, str.length - 1);\n221. \t}\n222. }\n223. \n224. class Block {\n225. \tglobal: boolean;\n226. \tcombinator: Node;\n227. \tselectors: Node[]\n228. \tstart: number;\n229. \tend: number;\n230. \n231. \tconstructor(combinator: Node) {\n232. \t\tthis.combinator = combinator;\n233. \t\tthis.global = false;\n234. \t\tthis.selectors = [];\n235. \n236. \t\tthis.start = null;\n237. \t\tthis.end = null;\n238. \t}\n239. \n240. \tadd(selector: Node) {\n241. \t\tif (this.selectors.length === 0) {\n242. \t\t\tthis.start = selector.start;\n243. \t\t\tthis.global = selector.type === \'PseudoClassSelector\' && selector.name === \'global\';\n244. \t\t}\n245. \n246. \t\tthis.selectors.push(selector);\n247. \t\tthis.end = selector.end;\n248. \t}\n249. }\n250. \n251. function groupSelectors(selector: Node) {\n252. \tlet block: Block = new Block(null);\n253. \n254. \tconst blocks = [block];\n255. \n256. \tselector.children.forEach((child: Node, i: number) => {\n257. \t\tif (child.type === \'WhiteSpace\' || child.type === \'Combinator\') {\n258. \t\t\tblock = new Block(child);\n259. \t\t\tblocks.push(block);\n260. \t\t} else {\n261. \t\t\tblock.add(child);\n262. \t\t}\n263. \t});\n264. \n265. \treturn blocks;\n266. }', start_line_number=1, end_line_number=266), Context(relative_path='src/css/Stylesheet.ts', content="1. import MagicString from 'magic-string';\n2. import { walk } from 'estree-walker';\n3. import { getLocator } from 'locate-character';\n4. import Selector from './Selector';\n5. import getCodeFrame from '../utils/getCodeFrame';\n6. import { Validator } from '../validate/index';\n7. import { Node, Parsed, Warning } from '../interfaces';\n8. \n9. class Rule {\n10. \tselectors: Selector[];\n11. \tdeclarations: Declaration[];\n12. \tnode: Node;\n13. \tparent: Atrule;\n14. \n15. \tconstructor(node: Node, parent: Atrule) {\n16. \t\tthis.node = node;\n17. \t\tthis.parent = parent;\n18. \t\tthis.selectors = node.selector.children.map((node: Node) => new Selector(node));\n19. \t\tthis.declarations = node.block.children.map((node: Node) => new Declaration(node));\n20. \n21. \t\tif (parent) parent.rules.push(this);\n22. \t}\n23. \n24. \tapply(node: Node, stack: Node[]) {\n25. \t\tthis.selectors.forEach(selector => selector.apply(node, stack)); // TODO move the logic in here?\n26. \t}\n27. \n28. \tisUsed() {\n29. \t\tif (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;\n30. \t\treturn this.selectors.some(s => s.used);\n31. \t}\n32. \n33. \tminify(code: MagicString, cascade: boolean) {\n34. \t\tlet c = this.node.start;\n35. \t\tthis.selectors.forEach((selector, i) => {\n36. \t\t\tif (cascade || selector.used) {\n37. \t\t\t\tconst separator = i > 0 ? ',' : '';\n38. \t\t\t\tif ((selector.node.start - c) > separator.length) {\n39. \t\t\t\t\tcode.overwrite(c, selector.node.start, separator);\n40. \t\t\t\t}\n41. \n42. \t\t\t\tselector.minify(code);\n43. \t\t\t\tc = selector.node.end;\n44. \t\t\t}\n45. \t\t});\n46. \n47. \t\tcode.remove(c, this.node.block.start);\n48. \n49. \t\tc = this.node.block.start + 1;\n50. \t\tthis.declarations.forEach((declaration, i) => {\n51. \t\t\tconst separator = i > 0 ? ';' : '';\n52. \t\t\tif ((declaration.node.start - c) > separator.length) {\n53. \t\t\t\tcode.overwrite(c, declaration.node.start, separator);\n54. \t\t\t}\n55. \n56. \t\t\tdeclaration.minify(code);\n57. \n58. \t\t\tc = declaration.node.end;\n59. \t\t});\n60. \n61. \t\tcode.remove(c, this.node.block.end - 1);\n62. \t}\n63. \n64. \ttransform(code: MagicString, id: string, keyframes: Map<string, string>, cascade: boolean) {\n65. \t\tif (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;\n66. \n67. \t\tconst attr = `[${id}]`;\n68. \n69. \t\tif (cascade) {\n70. \t\t\tthis.selectors.forEach(selector => {\n71. \t\t\t\t// TODO disable cascading (without :global(...)) in v2\n72. \t\t\t\tconst { start, end, children } = selector.node;\n73. \n74. \t\t\t\tconst css = code.original;\n75. \t\t\t\tconst selectorString = css.slice(start, end);\n76. \n77. \t\t\t\tconst firstToken = children[0];\n78. \n79. \t\t\t\tlet transformed;\n80. \n81. \t\t\t\tif (firstToken.type === 'TypeSelector') {\n82. \t\t\t\t\tconst insert = firstToken.end;\n83. \t\t\t\t\tconst head = firstToken.name === '*' ? '' : css.slice(start, insert);\n84. \t\t\t\t\tconst tail = css.slice(insert, end);\n85. \n86. \t\t\t\t\ttransformed = `${head}${attr}${tail},${attr} ${selectorString}`;\n87. \t\t\t\t} else {\n88. \t\t\t\t\ttransformed = `${attr}${selectorString},${attr} ${selectorString}`;\n89. \t\t\t\t}\n90. \n91. \t\t\t\tcode.overwrite(start, end, transformed);\n92. \t\t\t});\n93. \t\t} else {\n94. \t\t\tthis.selectors.forEach(selector => selector.transform(code, attr));\n95. \t\t}\n96. \n97. \t\tthis.declarations.forEach(declaration => declaration.transform(code, keyframes));\n98. \t}\n99. }\n100. \n101. class Declaration {\n102. \tnode: Node;\n103. \n104. \tconstructor(node: Node) {\n105. \t\tthis.node = node;\n106. \t}\n107. \n108. \ttransform(code: MagicString, keyframes: Map<string, string>) {\n109. \t\tconst property = this.node.property.toLowerCase();\n110. \t\tif (property === 'animation' || property === 'animation-name') {\n111. \t\t\tthis.node.value.children.forEach((block: Node) => {\n112. \t\t\t\tif (block.type === 'Identifier') {\n113. \t\t\t\t\tconst name = block.name;\n114. \t\t\t\t\tif (keyframes.has(name)) {\n115. \t\t\t\t\t\tcode.overwrite(block.start, block.end, keyframes.get(name));\n116. \t\t\t\t\t}\n117. \t\t\t\t}\n118. \t\t\t});\n119. \t\t}\n120. \t}\n121. \n122. \tminify(code: MagicString) {\n123. \t\tconst c = this.node.start + this.node.property.length;\n124. \t\tconst first = this.node.value.children[0];\n125. \n126. \t\tif (first.start - c > 1) {\n127. \t\t\tcode.overwrite(c, first.start, ':');\n128. \t\t}\n129. \t}\n130. }\n131. \n132. class Atrule {\n133. \tnode: Node;\n134. \trules: Rule[];\n135. \n136. \tconstructor(node: Node) {\n137. \t\tthis.node = node;\n138. \t\tthis.rules = [];\n139. \t}\n140. \n141. \tisUsed() {\n142. \t\treturn true; // TODO\n143. \t}\n144. \n145. \tminify(code: MagicString, cascade: boolean) {\n146. \t\tif (this.node.name === 'media') {\n147. \t\t\tlet c = this.node.start + 6;\n148. \t\t\tif (this.node.expression.start > c) code.remove(c, this.node.expression.start);\n149. \n150. \t\t\tthis.node.expression.children.forEach((query: Node) => {\n151. \t\t\t\t// TODO minify queries\n152. \t\t\t\tc = query.end;\n153. \t\t\t});\n154. \n155. \t\t\tcode.remove(c, this.node.block.start);\n156. \t\t} else if (this.node.name === 'keyframes') {\n157. \t\t\tlet c = this.node.start + 10;\n158. \t\t\tif (this.node.expression.start - c > 1) code.overwrite(c, this.node.expression.start, ' ');\n159. \t\t\tc = this.node.expression.end;\n160. \t\t\tif (this.node.block.start - c > 0) code.remove(c, this.node.block.start);\n161. \t\t}\n162. \n163. \t\t// TODO other atrules\n164. \n165. \t\tif (this.node.block) {\n166. \t\t\tlet c = this.node.block.start + 1;\n167. \n168. \t\t\tthis.rules.forEach(rule => {\n169. \t\t\t\tif (cascade || rule.isUsed()) {\n170. \t\t\t\t\tcode.remove(c, rule.node.start);\n171. \t\t\t\t\trule.minify(code, cascade);\n172. \t\t\t\t\tc = rule.node.end;\n173. \t\t\t\t}\n174. \t\t\t});\n175. \n176. \t\t\tcode.remove(c, this.node.block.end - 1);\n177. \t\t}\n178. \t}\n179. \n180. \ttransform(code: MagicString, id: string, keyframes: Map<string, string>) {\n181. \t\tif (this.node.name !== 'keyframes') return;\n182. \n183. \t\tthis.node.expression.children.forEach((expression: Node) => {\n184. \t\t\tif (expression.type === 'Identifier') {\n185. \t\t\t\tif (expression.name.startsWith('-global-')) {\n186. \t\t\t\t\tcode.remove(expression.start, expression.start + 8);\n187. \t\t\t\t} else {\n188. \t\t\t\t\tconst newName = `${id}-${expression.name}`;\n189. \t\t\t\t\tcode.overwrite(expression.start, expression.end, newName);\n190. \t\t\t\t\tkeyframes.set(expression.name, newName);\n191. \t\t\t\t}\n192. \t\t\t}\n193. \t\t});\n194. \t}\n195. }\n196. \n197. const keys = {};\n198. \n199. export default class Stylesheet {\n200. \tsource: string;\n201. \tparsed: Parsed;\n202. \tcascade: boolean;\n203. \tfilename: string;\n204. \n205. \thasStyles: boolean;\n206. \tid: string;\n207. \n208. \tnodes: (Rule|Atrule)[];\n209. \trules: Rule[];\n210. \tatrules: Atrule[];\n211. \n212. \tconstructor(source: string, parsed: Parsed, filename: string, cascade: boolean) {\n213. \t\tthis.source = source;\n214. \t\tthis.parsed = parsed;\n215. \t\tthis.cascade = cascade;\n216. \t\tthis.filename = filename;\n217. \n218. \t\tthis.id = `svelte-${parsed.hash}`;\n219. \n220. \t\tthis.nodes = [];\n221. \t\tthis.rules = [];\n222. \t\tthis.atrules = [];\n223. \n224. \t\tif (parsed.css && parsed.css.children.length) {\n225. \t\t\tthis.hasStyles = true;\n226. \n227. \t\t\tconst stack: Atrule[] = [];\n228. \t\t\tlet currentAtrule: Atrule = null;\n229. \n230. \t\t\twalk(this.parsed.css, {\n231. \t\t\t\tenter: (node: Node) => {\n232. \t\t\t\t\tif (node.type === 'Atrule') {\n233. \t\t\t\t\t\tconst atrule = currentAtrule = new Atrule(node);\n234. \t\t\t\t\t\tstack.push(atrule);\n235. \n236. \t\t\t\t\t\tthis.nodes.push(atrule);\n237. \t\t\t\t\t\tthis.atrules.push(atrule);\n238. \t\t\t\t\t}\n239. \n240. \t\t\t\t\tif (node.type === 'Rule') {\n241. \t\t\t\t\t\t// TODO this is a bit confusing. Don't have a separate\n242. \t\t\t\t\t\t// array of rules, just transform top-level nodes and\n243. \t\t\t\t\t\t// let them worry about their children\n244. \t\t\t\t\t\tconst rule = new Rule(node, currentAtrule);\n245. \n246. \t\t\t\t\t\tthis.rules.push(rule);\n247. \n248. \t\t\t\t\t\tif (!currentAtrule) {\n249. \t\t\t\t\t\t\tthis.nodes.push(rule);\n250. \t\t\t\t\t\t}\n251. \t\t\t\t\t}\n252. \t\t\t\t},\n253. \n254. \t\t\t\tleave: (node: Node) => {\n255. \t\t\t\t\tif (node.type === 'Atrule') {\n256. \t\t\t\t\t\tstack.pop();\n257. \t\t\t\t\t\tcurrentAtrule = stack[stack.length - 1];\n258. \t\t\t\t\t}\n259. \t\t\t\t}\n260. \t\t\t});\n261. \t\t} else {\n262. \t\t\tthis.hasStyles = false;\n263. \t\t}\n264. \t}\n265. \n266. \tapply(node: Node, stack: Node[]) {\n267. \t\tif (!this.hasStyles) return;\n268. \n269. \t\tif (this.cascade) {\n270. \t\t\tif (stack.length === 0) node._needsCssAttribute = true;\n271. \t\t\treturn;\n272. \t\t}\n273. \n274. \t\tfor (let i = 0; i < this.rules.length; i += 1) {\n275. \t\t\tconst rule = this.rules[i];\n276. \t\t\trule.apply(node, stack);\n277. \t\t}\n278. \t}\n279. \n280. \trender(cssOutputFilename: string) {\n281. \t\tif (!this.hasStyles) {\n282. \t\t\treturn { css: null, cssMap: null };\n283. \t\t}\n284. \n285. \t\tconst code = new MagicString(this.source);\n286. \n287. \t\twalk(this.parsed.css, {\n288. \t\t\tenter: (node: Node) => {\n289. \t\t\t\tcode.addSourcemapLocation(node.start);\n290. \t\t\t\tcode.addSourcemapLocation(node.end);\n291. \t\t\t}\n292. \t\t});\n293. \n294. \t\t// TODO all transform/minify in single pass. The mutation of\n295. \t\t// `keyframes` here is confusing\n296. \t\tconst keyframes = new Map();\n297. \t\tthis.atrules.forEach((atrule: Atrule) => {\n298. \t\t\tatrule.transform(code, this.id, keyframes);\n299. \t\t});\n300. \n301. \t\tthis.rules.forEach((rule: Rule) => {\n302. \t\t\trule.transform(code, this.id, keyframes, this.cascade);\n303. \t\t});\n304. \n305. \t\tlet c = 0;\n306. \t\tthis.nodes.forEach(node => {\n307. \t\t\tif (this.cascade || node.isUsed()) {\n308. \t\t\t\tcode.remove(c, node.node.start);\n309. \t\t\t\tnode.minify(code, this.cascade);\n310. \t\t\t\tc = node.node.end;\n311. \t\t\t}\n312. \t\t});\n313. \n314. \t\tcode.remove(c, this.source.length);\n315. \n316. \t\treturn {\n317. \t\t\tcss: code.toString(),\n318. \t\t\tcssMap: code.generateMap({\n319. \t\t\t\tincludeContent: true,\n320. \t\t\t\tsource: this.filename,\n321. \t\t\t\tfile: cssOutputFilename\n322. \t\t\t})\n323. \t\t};\n324. \t}\n325. \n326. \tvalidate(validator: Validator) {\n327. \t\tthis.rules.forEach(rule => {\n328. \t\t\trule.selectors.forEach(selector => {\n329. \t\t\t\tselector.validate(validator);\n330. \t\t\t});\n331. \t\t});\n332. \t}\n333. \n334. \twarnOnUnusedSelectors(onwarn: (warning: Warning) => void) {\n335. \t\tif (this.cascade) return;\n336. \n337. \t\tlet locator;\n338. \n339. \t\tthis.rules.forEach((rule: Rule) => {\n340. \t\t\trule.selectors.forEach(selector => {\n341. \t\t\t\tif (!selector.used) {\n342. \t\t\t\t\tconst pos = selector.node.start;\n343. \n344. \t\t\t\t\tif (!locator) locator = getLocator(this.source);\n345. \t\t\t\t\tconst { line, column } = locator(pos);\n346. \n347. \t\t\t\t\tconst frame = getCodeFrame(this.source, line, column);\n348. \t\t\t\t\tconst message = `Unused CSS selector`;\n349. \n350. \t\t\t\t\tonwarn({\n351. \t\t\t\t\t\tmessage,\n352. \t\t\t\t\t\tframe,\n353. \t\t\t\t\t\tloc: { line: line + 1, column },\n354. \t\t\t\t\t\tpos,\n355. \t\t\t\t\t\tfilename: this.filename,\n356. \t\t\t\t\t\ttoString: () => `${message} (${line + 1}:${column})\\n${frame}`,\n357. \t\t\t\t\t});\n358. \t\t\t\t}\n359. \t\t\t});\n360. \t\t});\n361. \t}\n362. }", start_line_number=1, end_line_number=362), Context(relative_path='src/generators/dom/index.ts', content='182. \t// TODO deprecate component.teardown()\n183. \tbuilder.addBlock(deindent`\n184. \t\tfunction ${name} ( options ) {\n185. \t\t\toptions = options || {};\n186. \t\t\t${options.dev &&\n187. \t\t\t\t`if ( !options.target && !options._root ) throw new Error( "\'target\' is a required option" );`}\n188. \t\t\t${generator.usesRefs && `this.refs = {};`}\n189. \t\t\tthis._state = ${templateProperties.data\n190. \t\t\t\t? `@assign( @template.data(), options.data )`\n191. \t\t\t\t: `options.data || {}`};', start_line_number=182, end_line_number=191), Context(relative_path='src/generators/dom/visitors/Component/Ref.ts', content="1. import deindent from '../../../../utils/deindent';\n2. import { DomGenerator } from '../../index';\n3. import Block from '../../Block';\n4. import { Node } from '../../../../interfaces';\n5. import { State } from '../../interfaces';\n6. \n7. export default function visitRef(\n8. \tgenerator: DomGenerator,\n9. \tblock: Block,\n10. \tstate: State,\n11. \tnode: Node,\n12. \tattribute: Node,\n13. \tlocal\n14. ) {\n15. \tgenerator.usesRefs = true;\n16. \n17. \tlocal.create.addLine(`#component.refs.${attribute.name} = ${local.name};`);\n18. \n19. \tblock.builders.destroy.addLine(deindent`\n20. \t\tif ( #component.refs.${attribute.name} === ${local.name} ) #component.refs.${attribute.name} = null;\n21. \t`);\n22. }", start_line_number=1, end_line_number=22), Context(relative_path='src/generators/dom/visitors/Element/Element.ts', content="1. import deindent from '../../../../utils/deindent';\n2. import visit from '../../visit';\n3. import visitComponent from '../Component/Component';\n4. import visitWindow from './meta/Window';\n5. import visitAttribute from './Attribute';\n6. import visitEventHandler from './EventHandler';\n7. import visitBinding from './Binding';\n8. import visitRef from './Ref';\n9. import * as namespaces from '../../../../utils/namespaces';\n10. import addTransitions from './addTransitions';\n11. import { DomGenerator } from '../../index';\n12. import Block from '../../Block';\n13. import { Node } from '../../../../interfaces';\n14. import { State } from '../../interfaces';\n15. \n16. const meta = {\n17. \t':Window': visitWindow,\n18. };\n19. \n20. const order = {\n21. \tAttribute: 1,\n22. \tBinding: 2,\n23. \tEventHandler: 3,\n24. \tRef: 4,\n25. };\n26. \n27. const visitors = {\n28. \tAttribute: visitAttribute,\n29. \tEventHandler: visitEventHandler,\n30. \tBinding: visitBinding,\n31. \tRef: visitRef,\n32. };\n33. \n34. export default function visitElement(\n35. \tgenerator: DomGenerator,\n36. \tblock: Block,\n37. \tstate: State,\n38. \tnode: Node,\n39. \telementStack: Node[]\n40. ) {\n41. \tif (node.name in meta) {\n42. \t\treturn meta[node.name](generator, block, node);\n43. \t}\n44. \n45. \tif (generator.components.has(node.name) || node.name === ':Self') {\n46. \t\treturn visitComponent(generator, block, state, node, elementStack);\n47. \t}\n48. \n49. \tconst childState = node._state;\n50. \tconst name = childState.parentNode;\n51. \n52. \tconst isToplevel = !state.parentNode;\n53. \n54. \tblock.addVariable(name);\n55. \tblock.builders.create.addLine(\n56. \t\t`${name} = ${getRenderStatement(\n57. \t\t\tgenerator,\n58. \t\t\tchildState.namespace,\n59. \t\t\tnode.name\n60. \t\t)};`\n61. \t);\n62. \n63. \tif (generator.hydratable) {\n64. \t\tblock.builders.claim.addBlock(deindent`\n65. \t\t\t${name} = ${getClaimStatement(\n66. \t\t\tgenerator,\n67. \t\t\tchildState.namespace,\n68. \t\t\tstate.parentNodes,\n69. \t\t\tnode\n70. \t\t)};\n71. \t\t\tvar ${childState.parentNodes} = @children( ${name} );\n72. \t\t`);\n73. \t}\n74. \n75. \tif (state.parentNode) {\n76. \t\tblock.builders.mount.addLine(\n77. \t\t\t`@appendNode( ${name}, ${state.parentNode} );`\n78. \t\t);\n79. \t} else {\n80. \t\tblock.builders.mount.addLine(`@insertNode( ${name}, #target, anchor );`);\n81. \t}\n82. \n83. \t// add CSS encapsulation attribute\n84. \t// TODO add a helper for this, rather than repeating it\n85. \tif (node._needsCssAttribute) {\n86. \t\tgenerator.needsEncapsulateHelper = true;\n87. \t\tblock.builders.hydrate.addLine(\n88. \t\t\t`@encapsulateStyles( ${name} );`\n89. \t\t);\n90. \t}\n91. \n92. \tfunction visitAttributesAndAddProps() {\n93. \t\tlet intro;\n94. \t\tlet outro;\n95. \n96. \t\tnode.attributes\n97. \t\t\t.sort((a: Node, b: Node) => order[a.type] - order[b.type])\n98. \t\t\t.forEach((attribute: Node) => {\n99. \t\t\t\tif (attribute.type === 'Transition') {\n100. \t\t\t\t\tif (attribute.intro) intro = attribute;\n101. \t\t\t\t\tif (attribute.outro) outro = attribute;\n102. \t\t\t\t\treturn;\n103. \t\t\t\t}\n104. \n105. \t\t\t\tvisitors[attribute.type](generator, block, childState, node, attribute);\n106. \t\t\t});\n107. \n108. \t\tif (intro || outro)\n109. \t\t\taddTransitions(generator, block, childState, node, intro, outro);\n110. \n111. \t\tif (childState.allUsedContexts.length || childState.usesComponent) {\n112. \t\t\tconst initialProps: string[] = [];\n113. \t\t\tconst updates: string[] = [];\n114. \n115. \t\t\tif (childState.usesComponent) {\n116. \t\t\t\tinitialProps.push(`component: #component`);\n117. \t\t\t}\n118. \n119. \t\t\tchildState.allUsedContexts.forEach((contextName: string) => {\n120. \t\t\t\tif (contextName === 'state') return;\n121. \n122. \t\t\t\tconst listName = block.listNames.get(contextName);\n123. \t\t\t\tconst indexName = block.indexNames.get(contextName);\n124. \n125. \t\t\t\tinitialProps.push(\n126. \t\t\t\t\t`${listName}: ${listName},\\n${indexName}: ${indexName}`\n127. \t\t\t\t);\n128. \t\t\t\tupdates.push(\n129. \t\t\t\t\t`${name}._svelte.${listName} = ${listName};\\n${name}._svelte.${indexName} = ${indexName};`\n130. \t\t\t\t);\n131. \t\t\t});\n132. \n133. \t\t\tif (initialProps.length) {\n134. \t\t\t\tblock.builders.hydrate.addBlock(deindent`\n135. \t\t\t\t\t${name}._svelte = {\n136. \t\t\t\t\t\t${initialProps.join(',\\n')}\n137. \t\t\t\t\t};\n138. \t\t\t\t`);\n139. \t\t\t}\n140. \n141. \t\t\tif (updates.length) {\n142. \t\t\t\tblock.builders.update.addBlock(updates.join('\\n'));\n143. \t\t\t}\n144. \t\t}\n145. \t}\n146. \n147. \tif (isToplevel) {\n148. \t\t// TODO we eventually need to consider what happens to elements\n149. \t\t// that belong to the same outgroup as an outroing element...\n150. \t\tblock.builders.unmount.addLine(`@detachNode( ${name} );`);\n151. \t}\n152. \n153. \tif (node.name !== 'select') {\n154. \t\tif (node.name === 'textarea') {\n155. \t\t\t// this is an egregious hack, but it's the easiest way to get <textarea>\n156. \t\t\t// children treated the same way as a value attribute\n157. \t\t\tif (node.children.length > 0) {\n158. \t\t\t\tnode.attributes.push({\n159. \t\t\t\t\ttype: 'Attribute',\n160. \t\t\t\t\tname: 'value',\n161. \t\t\t\t\tvalue: node.children,\n162. \t\t\t\t});\n163. \n164. \t\t\t\tnode.children = [];\n165. \t\t\t}\n166. \t\t}\n167. \n168. \t\t// <select> value attributes are an annoying special case — it must be handled\n169. \t\t// *after* its children have been updated\n170. \t\tvisitAttributesAndAddProps();\n171. \t}\n172. \n173. \t// special case – bound <option> without a value attribute\n174. \tif (\n175. \t\tnode.name === 'option' &&\n176. \t\t!node.attributes.find(\n177. \t\t\t(attribute: Node) =>\n178. \t\t\t\tattribute.type === 'Attribute' && attribute.name === 'value'\n179. \t\t)\n180. \t) {\n181. \t\t// TODO check it's bound\n182. \t\tconst statement = `${name}.__value = ${name}.textContent;`;\n183. \t\tnode.initialUpdate = node.lateUpdate = statement;\n184. \t}\n185. \n186. \tnode.children.forEach((child: Node) => {\n187. \t\tvisit(generator, block, childState, child, elementStack.concat(node));\n188. \t});\n189. \n190. \tif (node.lateUpdate) {\n191. \t\tblock.builders.update.addLine(node.lateUpdate);\n192. \t}\n193. \n194. \tif (node.name === 'select') {\n195. \t\tvisitAttributesAndAddProps();\n196. \t}\n197. \n198. \tif (node.initialUpdate) {\n199. \t\t// special case — if we're in a yield block, then we may call mount\n200. \t\t// long after the fragment is created. We may therefore need to get\n201. \t\t// the latest `state` object\n202. \t\t// TODO what about contexts in yield blocks? do we need to do\n203. \t\t// `var ${contextName} = [something complicated]`?\n204. \t\tconst needsStateObject = node.initialUpdateNeedsStateObject && state.isYield;\n205. \n206. \t\tif ( needsStateObject ) {\n207. \t\t\tblock.builders.mount.addLine(`var state = #component.get()`);\n208. \t\t}\n209. \n210. \t\tblock.builders.mount.addBlock(node.initialUpdate);\n211. \t}\n212. \n213. \tblock.builders.claim.addLine(\n214. \t\t`${childState.parentNodes}.forEach( @detachNode );`\n215. \t);\n216. }\n217. \n218. function getRenderStatement(\n219. \tgenerator: DomGenerator,\n220. \tnamespace: string,\n221. \tname: string\n222. ) {\n223. \tif (namespace === 'http://www.w3.org/2000/svg') {\n224. \t\treturn `@createSvgElement( '${name}' )`;\n225. \t}\n226. \n227. \tif (namespace) {\n228. \t\treturn `document.createElementNS( '${namespace}', '${name}' )`;\n229. \t}\n230. \n231. \treturn `@createElement( '${name}' )`;\n232. }\n233. \n234. function getClaimStatement(\n235. \tgenerator: DomGenerator,\n236. \tnamespace: string,\n237. \tnodes: string,\n238. \tnode: Node\n239. ) {\n240. \tconst attributes = node.attributes\n241. \t\t.filter((attr: Node) => attr.type === 'Attribute')\n242. \t\t.map((attr: Node) => `${quoteProp(attr.name)}: true`)\n243. \t\t.join(', ');\n244. \n245. \tconst name = namespace ? node.name : node.name.toUpperCase();\n246. \n247. \treturn `@claimElement( ${nodes}, '${name}', ${attributes\n248. \t\t? `{ ${attributes} }`\n249. \t\t: `{}`}, ${namespace === namespaces.svg ? true : false} )`;\n250. }\n251. \n252. function quoteProp(name: string) {\n253. \tif (/[^a-zA-Z_$0-9]/.test(name)) return `'${name}'`;\n254. \treturn name;\n255. }", start_line_number=1, end_line_number=255), Context(relative_path='src/generators/dom/visitors/Element/EventHandler.ts', content="23. \t\tgenerator.addSourcemapLocations(attribute.expression);\n24. \n25. \t\tconst flattened = flattenReference(attribute.expression.callee);\n26. \t\tif (flattened.name !== 'event' && flattened.name !== 'this') {\n27. \t\t\t// allow event.stopPropagation(), this.select() etc\n28. \t\t\t// TODO verify that it's a valid callee (i.e. built-in or declared method)\n29. \t\t\tgenerator.code.prependRight(\n30. \t\t\t\tattribute.expression.start,\n31. \t\t\t\t`${block.alias('component')}.`\n32. \t\t\t);\n33. \t\t\tif (shouldHoist) state.usesComponent = true; // this feels a bit hacky but it works!\n34. \t\t}\n35. ", start_line_number=23, end_line_number=35), Context(relative_path='src/generators/dom/visitors/Element/Ref.ts', content="1. import deindent from '../../../../utils/deindent';\n2. import { DomGenerator } from '../../index';\n3. import Block from '../../Block';\n4. import { Node } from '../../../../interfaces';\n5. import { State } from '../../interfaces';\n6. \n7. export default function visitRef(\n8. \tgenerator: DomGenerator,\n9. \tblock: Block,\n10. \tstate: State,\n11. \tnode: Node,\n12. \tattribute: Node\n13. ) {\n14. \tconst name = attribute.name;\n15. \n16. \tblock.builders.mount.addLine(\n17. \t\t`#component.refs.${name} = ${state.parentNode};`\n18. \t);\n19. \n20. \tblock.builders.destroy.addLine(deindent`\n21. \t\tif ( #component.refs.${name} === ${state.parentNode} ) #component.refs.${name} = null;\n22. \t`);\n23. \n24. \tgenerator.usesRefs = true; // so this component.refs object is created\n25. }", start_line_number=1, end_line_number=25), Context(relative_path='src/parse/read/directives.ts', content='1. import { parseExpressionAt } from \'acorn\';\n2. import spaces from \'../../utils/spaces\';\n3. import { Parser } from \'../index\';\n4. \n5. function readExpression(parser: Parser, start: number, quoteMark: string|null) {\n6. \tlet str = \'\';\n7. \tlet escaped = false;\n8. \n9. \tfor (let i = start; i < parser.template.length; i += 1) {\n10. \t\tconst char = parser.template[i];\n11. \n12. \t\tif (quoteMark) {\n13. \t\t\tif (char === quoteMark) {\n14. \t\t\t\tif (escaped) {\n15. \t\t\t\t\tstr += quoteMark;\n16. \t\t\t\t} else {\n17. \t\t\t\t\tbreak;\n18. \t\t\t\t}\n19. \t\t\t} else if (escaped) {\n20. \t\t\t\tstr += \'\\\\\' + char;\n21. \t\t\t\tescaped = false;\n22. \t\t\t} else if (char === \'\\\\\') {\n23. \t\t\t\tescaped = true;\n24. \t\t\t} else {\n25. \t\t\t\tstr += char;\n26. \t\t\t}\n27. \t\t} else if (/\\s/.test(char)) {\n28. \t\t\tbreak;\n29. \t\t} else {\n30. \t\t\tstr += char;\n31. \t\t}\n32. \t}\n33. \n34. \tconst expression = parseExpressionAt(spaces(start) + str, start);\n35. \tparser.index = expression.end;\n36. \n37. \tparser.allowWhitespace();\n38. \tif (quoteMark) parser.eat(quoteMark, true);\n39. \n40. \treturn expression;\n41. }\n42. \n43. export function readEventHandlerDirective(\n44. \tparser: Parser,\n45. \tstart: number,\n46. \tname: string,\n47. \thasValue: boolean\n48. ) {\n49. \tlet expression;\n50. \n51. \tif (hasValue) {\n52. \t\tconst quoteMark = parser.eat(`\'`) ? `\'` : parser.eat(`"`) ? `"` : null;\n53. \n54. \t\tconst expressionStart = parser.index;\n55. \n56. \t\texpression = readExpression(parser, expressionStart, quoteMark);\n57. \n58. \t\tif (expression.type !== \'CallExpression\') {\n59. \t\t\tparser.error(`Expected call expression`, expressionStart);\n60. \t\t}\n61. \t}\n62. \n63. \treturn {\n64. \t\tstart,\n65. \t\tend: parser.index,\n66. \t\ttype: \'EventHandler\',\n67. \t\tname,\n68. \t\texpression,\n69. \t};\n70. }\n71. \n72. export function readBindingDirective(\n73. \tparser: Parser,\n74. \tstart: number,\n75. \tname: string\n76. ) {\n77. \tlet value;\n78. \n79. \tif (parser.eat(\'=\')) {\n80. \t\tconst quoteMark = parser.eat(`\'`) ? `\'` : parser.eat(`"`) ? `"` : null;\n81. \n82. \t\tconst a = parser.index;\n83. \n84. \t\tif (parser.eat(\'{{\')) {\n85. \t\t\tlet message = \'bound values should not be wrapped\';\n86. \t\t\tconst b = parser.template.indexOf(\'}}\', a);\n87. \t\t\tif (b !== -1) {\n88. \t\t\t\tconst value = parser.template.slice(parser.index, b);\n89. \t\t\t\tmessage += ` — use \'${value}\', not \'{{${value}}}\'`;\n90. \t\t\t}\n91. \n92. \t\t\tparser.error(message, a);\n93. \t\t}\n94. \n95. \t\t// this is a bit of a hack so that we can give Acorn something parseable\n96. \t\tlet b;\n97. \t\tif (quoteMark) {\n98. \t\t\tb = parser.index = parser.template.indexOf(quoteMark, parser.index);\n99. \t\t} else {\n100. \t\t\tparser.readUntil(/[\\s\\r\\n\\/>]/);\n101. \t\t\tb = parser.index;\n102. \t\t}\n103. \n104. \t\tconst source = spaces(a) + parser.template.slice(a, b);\n105. \t\tvalue = parseExpressionAt(source, a);\n106. \n107. \t\tif (value.type !== \'Identifier\' && value.type !== \'MemberExpression\') {\n108. \t\t\tparser.error(`Cannot bind to rvalue`, value.start);\n109. \t\t}\n110. \n111. \t\tparser.allowWhitespace();\n112. \n113. \t\tif (quoteMark) {\n114. \t\t\tparser.eat(quoteMark, true);\n115. \t\t}\n116. \t} else {\n117. \t\t// shorthand – bind:foo equivalent to bind:foo=\'foo\'\n118. \t\tvalue = {\n119. \t\t\ttype: \'Identifier\',\n120. \t\t\tstart: start + 5,\n121. \t\t\tend: parser.index,\n122. \t\t\tname,\n123. \t\t};\n124. \t}\n125. \n126. \treturn {\n127. \t\tstart,\n128. \t\tend: parser.index,\n129. \t\ttype: \'Binding\',\n130. \t\tname,\n131. \t\tvalue,\n132. \t};\n133. }\n134. \n135. export function readTransitionDirective(\n136. \tparser: Parser,\n137. \tstart: number,\n138. \tname: string,\n139. \ttype: string\n140. ) {\n141. \tlet expression = null;\n142. \n143. \tif (parser.eat(\'=\')) {\n144. \t\tconst quoteMark = parser.eat(`\'`) ? `\'` : parser.eat(`"`) ? `"` : null;\n145. \n146. \t\tconst expressionStart = parser.index;\n147. \n148. \t\texpression = readExpression(parser, expressionStart, quoteMark);\n149. \n150. \t\tif (expression.type !== \'ObjectExpression\') {\n151. \t\t\tparser.error(`Expected object expression`, expressionStart);\n152. \t\t}\n153. \t}\n154. \n155. \treturn {\n156. \t\tstart,\n157. \t\tend: parser.index,\n158. \t\ttype: \'Transition\',\n159. \t\tname,\n160. \t\tintro: type === \'in\' || type === \'transition\',\n161. \t\toutro: type === \'out\' || type === \'transition\',\n162. \t\texpression,\n163. \t};\n164. }', start_line_number=1, end_line_number=164), Context(relative_path='src/parse/state/tag.ts', content="260. \tif (/^bind:/.test(name)) {\n261. \t\treturn readBindingDirective(parser, start, name.slice(5));\n262. \t}\n263. \n264. \tif (/^ref:/.test(name)) {\n265. \t\treturn {\n266. \t\t\tstart,\n267. \t\t\tend: parser.index,\n268. \t\t\ttype: 'Ref',\n269. \t\t\tname: name.slice(4),\n270. \t\t};\n271. \t}", start_line_number=260, end_line_number=271), Context(relative_path='test/validator/samples/event-handler-ref-invalid/input.html', content="1. <input ref:input>\n2. <button on:click='refs.inputx.focus()'>focus input</button>", start_line_number=1, end_line_number=2), Context(relative_path='test/validator/samples/event-handler-ref/input.html', content="1. <input ref:input>\n2. <button on:click='refs.input.focus()'>focus input</button>", start_line_number=1, end_line_number=2)]
2025-11-10 23:25:38,949 - thread-133013312636608.prometheus.lang_graph.nodes.issue_classifier_node - INFO - IssueClassifierNode classified the issue as: feature
2025-11-10 23:25:38,950 - thread-133013312636608.prometheus.lang_graph.nodes.issue_classification_subgraph_node - INFO - issue_type: feature
2025-11-10 23:25:38,951 - thread-133013312636608.prometheus.docker.base_container - INFO - Pulling docker image: ghcr.io/timesler/swe-polybench.eval.x86_64.sveltejs__svelte-738:latest
2025-11-10 23:26:06,705 - thread-133013312636608.prometheus.docker.base_container - INFO - Tagging pulled image as: prometheus_user_defined_container_7d148ce35c
2025-11-10 23:26:06,715 - thread-133013312636608.prometheus.docker.base_container - INFO - Starting container from image prometheus_user_defined_container_7d148ce35c
2025-11-10 23:26:07,336 - thread-133013312636608.prometheus.docker.base_container - INFO - Starting persistent shell for interactive mode...
2025-11-10 23:26:07,739 - thread-133013312636608.prometheus.docker.base_container - INFO - Persistent shell is ready
2025-11-10 23:26:07,739 - thread-133013312636608.prometheus.lang_graph.nodes.issue_feature_subgraph_node - INFO - Enter IssueFeatureSubgraphNode
2025-11-10 23:26:07,743 - thread-133013312636608.prometheus.lang_graph.nodes.bug_get_regression_tests_subgraph_node - INFO - Enter bug_get_regression_tests_subgraph_node
2025-11-10 23:26:07,744 - thread-133013312636608.prometheus.lang_graph.nodes.bug_get_regression_context_message_node - DEBUG - Sending query to context provider subgraph:
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
using refs in css

Issue description: 
When I use a ref, I most often also want to get a handle to it with css, which leads to slightly annoying, duplicative markup.

```html
<style>
  .container {
    color: red
  }
</style>
<div class="container" ref:container></div>
```
 
The only solutions I can think of to mitigate this are untenable, but thought I raise this if others see something better.

- Make nodes with ids available as refs, like polymer's static node map
- Make svelte refs available as synthetic css selectors
- Make a syntax shortcut for declaring refs as classes, e.g. `<div ref:class:container ></div>`

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

2025-11-10 23:26:07,745 - thread-133013312636608.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-10 23:26:07,747 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── getGlobals.ts
|   |           ├── getIntro.ts
|   |           ├── getOutro.ts
|   |           └── walkHtml.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getObject.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── reservedNames.ts
|   |   ├── spaces.ts
|   |   ├── stringify.ts
|   |   └── trim.ts
|   └── validate
|       ├── html
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── pass-no-options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-onrender
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
using refs in css

Issue description: 
When I use a ref, I most often also want to get a handle to it with css, which leads to slightly annoying, duplicative markup.

```html
<style>
  .container {
    color: red
  }
</style>
<div class="container" ref:container></div>
```
 
The only solutions I can think of to mitigate this are untenable, but thought I raise this if others see something better.

- Make nodes with ids available as refs, like polymer's static node map
- Make svelte refs available as synthetic css selectors
- Make a syntax shortcut for declaring refs as classes, e.g. `<div ref:class:container ></div>`

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-10 23:26:27,126 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The file tree shows where relevant tests likely live, but we don't have the actual test code or sample contents, which are required to return 8 complete test cases with exact imports, setup, assertions, and line numbers. Since the issue concerns refs and CSS, we need the test harness files and specific sample directories (element-ref, component-refs, omit-scoping-attribute*) to extract precise test cases." query='Please provide the full contents with line numbers of test/runtime/index.js, test/css/index.js, test/hydration/index.js, test/server-side-rendering/index.js, test/validator/index.js, test/helpers.js, plus the files in test/runtime/samples/element-ref, test/hydration/samples/element-ref, test/server-side-rendering/samples/component-refs and component-refs-and-attributes, and all test/css/samples/omit-scoping-attribute* directories.' extra_requirements='If providing everything is too large, at minimum share test/runtime/index.js and samples/element-ref, test/css/index.js and omit-scoping-attribute* samples, test/server-side-rendering/index.js and component-refs(+attributes) samples, and test/helpers.js.' purpose='To extract 8 complete, self-contained test cases with exact line numbers that will be affected by changes to ref/CSS behavior.'
2025-11-10 23:26:27,128 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents with line numbers of test/runtime/index.js, test/css/index.js, test/hydration/index.js, test/server-side-rendering/index.js, test/validator/index.js, test/helpers.js, plus the files in test/runtime/samples/element-ref, test/hydration/samples/element-ref, test/server-side-rendering/samples/component-refs and component-refs-and-attributes, and all test/css/samples/omit-scoping-attribute* directories.
2025-11-10 23:26:29,652 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-10 23:26:29,652 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-10 23:26:29,652 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-10 23:26:29,652 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-10 23:26:29,654 - thread-133013312636608.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-10 23:26:29,655 - thread-133013312636608.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-10 23:26:29,655 - thread-133013312636608.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents with line numbers of test/runtime/index.js, test/css/index.js, test/hydration/index.js, test/server-side-rendering/index.js, test/validator/index.js, test/helpers.js, plus the files in test/runtime/samples/element-ref, test/hydration/samples/element-ref, test/server-side-rendering/samples/component-refs and component-refs-and-attributes, and all test/css/samples/omit-scoping-attribute* directories.
Extra requirements: If providing everything is too large, at minimum share test/runtime/index.js and samples/element-ref, test/css/index.js and omit-scoping-attribute* samples, test/server-side-rendering/index.js and component-refs(+attributes) samples, and test/helpers.js.
Purpose: To extract 8 complete, self-contained test cases with exact line numbers that will be affected by changes to ref/CSS behavior.
2025-11-10 23:26:40,712 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_gljlzCqrBO8JFiU6kmzOffVi', 'function': {'arguments': '{"relative_path":"test/runtime/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1057, 'prompt_tokens': 2283, 'total_tokens': 3340, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1024, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--de8a6c18-f3db-47a9-9fcc-04d32c88a430-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/index.js'}, 'id': 'call_gljlzCqrBO8JFiU6kmzOffVi', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2283, 'output_tokens': 1057, 'total_tokens': 3340, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1024}}
2025-11-10 23:26:49,809 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_K5ls5g9yFfIWCjf7FBnw6TKL', 'function': {'arguments': '{"relative_path":"test/css/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 993, 'prompt_tokens': 5446, 'total_tokens': 6439, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bb39f2ef-7104-4ddd-a46c-e3ef3578089e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/css/index.js'}, 'id': 'call_K5ls5g9yFfIWCjf7FBnw6TKL', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5446, 'output_tokens': 993, 'total_tokens': 6439, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-10 23:26:50,952 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_BXVWHfC1H7EbfUVoes4jHbSy', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 6986, 'total_tokens': 7016, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--161d4da4-9e73-42cc-8e74-942743d568e2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/index.js'}, 'id': 'call_BXVWHfC1H7EbfUVoes4jHbSy', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6986, 'output_tokens': 30, 'total_tokens': 7016, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:26:52,128 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZLx9RpCqrcL9mByVN8vGsORx', 'function': {'arguments': '{"relative_path":"test/helpers.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 8424, 'total_tokens': 8450, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c1f662b4-3b4c-44df-8cb7-c4a8d02ffded-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/helpers.js'}, 'id': 'call_ZLx9RpCqrcL9mByVN8vGsORx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8424, 'output_tokens': 26, 'total_tokens': 8450, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:27:08,158 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_O94cLYLIczGyFl2Hr4alMrwk', 'function': {'arguments': '{"relative_path":"test/hydration/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1443, 'prompt_tokens': 11147, 'total_tokens': 12590, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1408, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--abfdc993-850e-4c0d-832c-a7376201de5a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/hydration/index.js'}, 'id': 'call_O94cLYLIczGyFl2Hr4alMrwk', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11147, 'output_tokens': 1443, 'total_tokens': 12590, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1408}}
2025-11-10 23:27:18,993 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_GxrT6VpejQoUhNwD8QUojjBd', 'function': {'arguments': '{"relative_path":"test/runtime/samples/element-ref"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1187, 'prompt_tokens': 12401, 'total_tokens': 13588, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1152, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--eeaaae6a-1424-4cf9-8d91-3e178bd53102-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/element-ref'}, 'id': 'call_GxrT6VpejQoUhNwD8QUojjBd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12401, 'output_tokens': 1187, 'total_tokens': 13588, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1152}}
2025-11-10 23:27:25,758 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_V32FVmTFzf1uwTBESerGw6Fg', 'function': {'arguments': '{"relative_path":"test/runtime/samples/element-ref/main.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 741, 'prompt_tokens': 12456, 'total_tokens': 13197, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5376}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2a1771b2-e7b6-412a-9441-81542c6e439c-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/element-ref/main.html'}, 'id': 'call_V32FVmTFzf1uwTBESerGw6Fg', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12456, 'output_tokens': 741, 'total_tokens': 13197, 'input_token_details': {'audio': 0, 'cache_read': 5376}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-10 23:27:30,463 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4of68FjC6cXD9oW77OqIghQ5', 'function': {'arguments': '{"basename":"element-ref"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 221, 'prompt_tokens': 12513, 'total_tokens': 12734, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--57f46ede-7b09-4e54-9ead-c3228a06a43c-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'element-ref'}, 'id': 'call_4of68FjC6cXD9oW77OqIghQ5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12513, 'output_tokens': 221, 'total_tokens': 12734, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-10 23:27:33,476 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZEWMLgUwZbm47T8kvYk2shJF', 'function': {'arguments': '{"relative_path":"test/validator/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 226, 'prompt_tokens': 12588, 'total_tokens': 12814, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12288}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8130d0de-136c-42ce-b9de-29f2eb694033-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/validator/index.js'}, 'id': 'call_ZEWMLgUwZbm47T8kvYk2shJF', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12588, 'output_tokens': 226, 'total_tokens': 12814, 'input_token_details': {'audio': 0, 'cache_read': 12288}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-10 23:27:38,532 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_I8YcM4t4IEkEF7ulqYJUxQON', 'function': {'arguments': '{"basename":"component-refs"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 414, 'prompt_tokens': 13769, 'total_tokens': 14183, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--82bb79cf-0c40-4204-9ae5-908a31be8b75-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'component-refs'}, 'id': 'call_I8YcM4t4IEkEF7ulqYJUxQON', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13769, 'output_tokens': 414, 'total_tokens': 14183, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-10 23:27:39,896 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_shAaSPdYOhix0Up1WCZUBcBk', 'function': {'arguments': '{"basename":"component-refs-and-attributes"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 27, 'prompt_tokens': 13847, 'total_tokens': 13874, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12416}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7d932ffb-e519-4a1f-9283-72bae42e25f7-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'component-refs-and-attributes'}, 'id': 'call_shAaSPdYOhix0Up1WCZUBcBk', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13847, 'output_tokens': 27, 'total_tokens': 13874, 'input_token_details': {'audio': 0, 'cache_read': 12416}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:27:50,534 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_QdJ0Z8SkVGcQtWN5MSmSp13u', 'function': {'arguments': '{"basename":"omit-scoping-attribute"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 736, 'prompt_tokens': 13934, 'total_tokens': 14670, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--21d5ea27-29b3-4a0a-bd18-5e384b7a7b01-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'omit-scoping-attribute'}, 'id': 'call_QdJ0Z8SkVGcQtWN5MSmSp13u', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13934, 'output_tokens': 736, 'total_tokens': 14670, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-10 23:27:51,984 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_W2X19hDrP6BVz6ZuwoiRF2RH', 'function': {'arguments': '{"basename":"omit-scoping-attribute.less"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 27, 'prompt_tokens': 14016, 'total_tokens': 14043, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6912}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4329d319-a974-4530-a5f7-5159d9636bc1-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'omit-scoping-attribute.less'}, 'id': 'call_W2X19hDrP6BVz6ZuwoiRF2RH', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14016, 'output_tokens': 27, 'total_tokens': 14043, 'input_token_details': {'audio': 0, 'cache_read': 6912}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:27:53,524 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_p7VQWyvMc9vlwecwxeGGG24D', 'function': {'arguments': '{"basename":"omit-scoping-attribute-postcss"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 14069, 'total_tokens': 14097, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12544}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--922b97c2-af27-438d-855b-fb52e353de45-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'omit-scoping-attribute-postcss'}, 'id': 'call_p7VQWyvMc9vlwecwxeGGG24D', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14069, 'output_tokens': 28, 'total_tokens': 14097, 'input_token_details': {'audio': 0, 'cache_read': 12544}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:27:57,869 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zNBDnVTNNiFiREQJ6bE9xgdS', 'function': {'arguments': '{"basename":"element-refs"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 478, 'prompt_tokens': 14123, 'total_tokens': 14601, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12416}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--45e6abed-cd8b-43c4-b04f-c9143ba89581-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'element-refs'}, 'id': 'call_zNBDnVTNNiFiREQJ6bE9xgdS', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14123, 'output_tokens': 478, 'total_tokens': 14601, 'input_token_details': {'audio': 0, 'cache_read': 12416}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-10 23:28:10,866 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_qg0jZ8eFohA5V5aMCT16mDKe', 'function': {'arguments': '{"basename":"main.html"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1373, 'prompt_tokens': 14173, 'total_tokens': 15546, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 13696}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6905e80e-43f5-4007-9b8f-c6bdf9614fa3-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'main.html'}, 'id': 'call_qg0jZ8eFohA5V5aMCT16mDKe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14173, 'output_tokens': 1373, 'total_tokens': 15546, 'input_token_details': {'audio': 0, 'cache_read': 13696}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-10 23:28:29,765 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_tcbO9aXdCHvWpNU7iHQdrURA', 'function': {'arguments': '{"relative_path":"test/hydration/samples/element-ref/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2024, 'prompt_tokens': 14417, 'total_tokens': 16441, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1984, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 8320}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--aa394986-eae8-4bae-a662-117097ac782f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/hydration/samples/element-ref/main.html'}, 'id': 'call_tcbO9aXdCHvWpNU7iHQdrURA', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14417, 'output_tokens': 2024, 'total_tokens': 16441, 'input_token_details': {'audio': 0, 'cache_read': 8320}, 'output_token_details': {'audio': 0, 'reasoning': 1984}}
2025-11-10 23:28:31,216 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_riLJ8LWu0B497hBYaD9rYpCf', 'function': {'arguments': '{"relative_path":"test/hydration/samples/element-ref/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 35, 'prompt_tokens': 14540, 'total_tokens': 14575, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 11136}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c0d4f948-8151-4736-ab72-a60697fbb011-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/hydration/samples/element-ref/_config.js'}, 'id': 'call_riLJ8LWu0B497hBYaD9rYpCf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14540, 'output_tokens': 35, 'total_tokens': 14575, 'input_token_details': {'audio': 0, 'cache_read': 11136}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:28:32,496 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_EaSxoxdTnPqyA7VVkK9NDmq9', 'function': {'arguments': '{"relative_path":"test/runtime/samples/element-ref/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 14803, 'total_tokens': 14835, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 14080}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1f9e0c10-07f8-42b4-9086-efeb1a2bc7fc-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/element-ref/main.html'}, 'id': 'call_EaSxoxdTnPqyA7VVkK9NDmq9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14803, 'output_tokens': 32, 'total_tokens': 14835, 'input_token_details': {'audio': 0, 'cache_read': 14080}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:28:38,188 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lA1OpTkp99UrqigNaaLrLRLb', 'function': {'arguments': '{"relative_path":"test/hydration/samples/element-ref/_before.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 553, 'prompt_tokens': 14865, 'total_tokens': 15418, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d8696222-8e94-4b74-a36b-85e18bbfdc9f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/hydration/samples/element-ref/_before.html'}, 'id': 'call_lA1OpTkp99UrqigNaaLrLRLb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14865, 'output_tokens': 553, 'total_tokens': 15418, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-10 23:28:40,679 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_UCxcQUp0GE0wx4Ybd8c5SzAe', 'function': {'arguments': '{"relative_path":"test/hydration/samples/element-ref/_after.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 35, 'prompt_tokens': 14987, 'total_tokens': 15022, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1aad0c1c-e312-4811-97a4-ec556221c4fa-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/hydration/samples/element-ref/_after.html'}, 'id': 'call_UCxcQUp0GE0wx4Ybd8c5SzAe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14987, 'output_tokens': 35, 'total_tokens': 15022, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:28:47,779 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_cyrSbAqzSKIcmUHLbksZHyXL', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 745, 'prompt_tokens': 15109, 'total_tokens': 15854, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 14336}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9f7fa1e8-0280-42a9-85da-3097cc8c23f5-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs/main.html'}, 'id': 'call_cyrSbAqzSKIcmUHLbksZHyXL', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15109, 'output_tokens': 745, 'total_tokens': 15854, 'input_token_details': {'audio': 0, 'cache_read': 14336}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-10 23:28:49,359 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_wH8oc1FoB4nVOgaJjt6o47T1', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs/Widget.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 15291, 'total_tokens': 15327, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 13824}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ee6b5d90-cdb6-4c00-80ac-86abbcbd9380-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs/Widget.html'}, 'id': 'call_wH8oc1FoB4nVOgaJjt6o47T1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15291, 'output_tokens': 36, 'total_tokens': 15327, 'input_token_details': {'audio': 0, 'cache_read': 13824}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:28:50,756 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_tLwbSxr61HPQZTLfZZuISkT3', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 15413, 'total_tokens': 15451, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 14720}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--44501f0b-ba17-48b5-bef2-016e5f07b5b3-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes/main.html'}, 'id': 'call_tLwbSxr61HPQZTLfZZuISkT3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15413, 'output_tokens': 38, 'total_tokens': 15451, 'input_token_details': {'audio': 0, 'cache_read': 14720}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:28:52,759 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1OdmVBsxGbAIPAIxUkefTNdx', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes/Widget.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 15642, 'total_tokens': 15681, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 15232}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5dc61f90-2d45-4a2a-b608-866064760baf-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes/Widget.html'}, 'id': 'call_1OdmVBsxGbAIPAIxUkefTNdx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15642, 'output_tokens': 39, 'total_tokens': 15681, 'input_token_details': {'audio': 0, 'cache_read': 15232}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:29:20,965 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Q54UTjF0ivFK141arOhgRMz8', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute/input.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2409, 'prompt_tokens': 15770, 'total_tokens': 18179, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2368, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 15616}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2e5ca322-ecac-4398-90b1-f6d99be17b1f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute/input.html'}, 'id': 'call_Q54UTjF0ivFK141arOhgRMz8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15770, 'output_tokens': 2409, 'total_tokens': 18179, 'input_token_details': {'audio': 0, 'cache_read': 15616}, 'output_token_details': {'audio': 0, 'reasoning': 2368}}
2025-11-10 23:29:22,528 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fKLA9mBo04RvxBGOwCECNXwp', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute/expected.css"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 15943, 'total_tokens': 15979, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--52aa3b8e-3e32-4fd4-a336-5aaed09b02e2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute/expected.css'}, 'id': 'call_fKLA9mBo04RvxBGOwCECNXwp', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15943, 'output_tokens': 36, 'total_tokens': 15979, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:29:25,534 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_meEoJQ3fKUiSCJ1iiNOYoMZD', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute/expected.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 16067, 'total_tokens': 16103, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 13824}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f47c2003-c238-4364-9222-dc546a1cf9fc-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute/expected.html'}, 'id': 'call_meEoJQ3fKUiSCJ1iiNOYoMZD', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16067, 'output_tokens': 36, 'total_tokens': 16103, 'input_token_details': {'audio': 0, 'cache_read': 13824}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:29:33,378 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_CGmZzZUVNFjb8Ha9HyCDSAh2', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs/_expected.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 682, 'prompt_tokens': 16199, 'total_tokens': 16881, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7366ee7a-718d-496e-a518-abafe0324a02-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs/_expected.html'}, 'id': 'call_CGmZzZUVNFjb8Ha9HyCDSAh2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16199, 'output_tokens': 682, 'total_tokens': 16881, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-10 23:29:34,898 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_SVO5IAoDYPoOeFgywBxOxtFb', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes/_expected.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 16325, 'total_tokens': 16364, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 15360}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--15f6ed4f-b19b-4791-a5de-a37dcf1ae9ba-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes/_expected.html'}, 'id': 'call_SVO5IAoDYPoOeFgywBxOxtFb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16325, 'output_tokens': 39, 'total_tokens': 16364, 'input_token_details': {'audio': 0, 'cache_read': 15360}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:29:43,346 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_8AKf7FJ13xL0qRDKpVCegts3', 'function': {'arguments': '{"basename":"omit-scoping-attribute-sass"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 866, 'prompt_tokens': 16457, 'total_tokens': 17323, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 14976}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6f6d686f-d5cd-42db-8ade-e06d5dd481d2-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'omit-scoping-attribute-sass'}, 'id': 'call_8AKf7FJ13xL0qRDKpVCegts3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16457, 'output_tokens': 866, 'total_tokens': 17323, 'input_token_details': {'audio': 0, 'cache_read': 14976}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-10 23:30:06,246 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I fetched the full, line-numbered contents of the core test harness files you requested: test/runtime/index.js, test/css/index.js, test/hydration/index.js, test/server-side-rendering/index.js, test/validator/index.js, and test/helpers.js. I also retrieved the complete files for the relevant sample tests: hydration/samples/element-ref (main.html, _config.js, _before.html, _after.html), server-side-rendering/samples/component-refs and component-refs-and-attributes (each with main.html, Widget.html, and _expected.html), and the css sample omit-scoping-attribute (input.html, expected.css, expected.html). I could not find a test/runtime/samples/element-ref directory in the graph; only the hydration version exists. No additional omit-scoping-attribute* variants were present beyond test/css/samples/omit-scoping-attribute.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2049, 'prompt_tokens': 16511, 'total_tokens': 18560, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1856, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--429e5d77-ebda-49e7-a013-bdefd172901b-0' usage_metadata={'input_tokens': 16511, 'output_tokens': 2049, 'total_tokens': 18560, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1856}}
2025-11-10 23:30:06,250 - thread-133013312636608.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents with line numbers of test/runtime/index.js, test/css/index.js, test/hydration/index.js, test/server-side-rendering/index.js, test/validator/index.js, test/helpers.js, plus the files in test/runtime/samples/element-ref, test/hydration/samples/element-ref, test/server-side-rendering/samples/component-refs and component-refs-and-attributes, and all test/css/samples/omit-scoping-attribute* directories.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If providing everything is too large, at minimum share test/runtime/index.js and samples/element-ref, test/css/index.js and omit-scoping-attribute* samples, test/server-side-rendering/index.js and component-refs(+attributes) samples, and test/helpers.js.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
To extract 8 complete, self-contained test cases with exact line numbers that will be affected by changes to ref/CSS behavior.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: test/css/index.js
Line number range: 1 - 110
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import { env, normalizeHtml, svelte } from "../helpers.js";
4. 
5. function tryRequire(file) {
6. 	try {
7. 		const mod = require(file);
8. 		return mod.default || mod;
9. 	} catch (err) {
10. 		if (err.code !== "MODULE_NOT_FOUND") throw err;
11. 		return null;
12. 	}
13. }
14. 
15. function normalizeWarning(warning) {
16. 	warning.frame = warning.frame.replace(/^\n/, '').replace(/^\t+/gm, '').replace(/\s+$/gm, '');
17. 	delete warning.filename;
18. 	delete warning.toString;
19. 	return warning;
20. }
21. 
22. describe("css", () => {
23. 	fs.readdirSync("test/css/samples").forEach(dir => {
24. 		if (dir[0] === ".") return;
25. 
26. 		// add .solo to a sample directory name to only run that test
27. 		const solo = /\.solo/.test(dir);
28. 		const skip = /\.skip/.test(dir);
29. 
30. 		if (solo && process.env.CI) {
31. 			throw new Error("Forgot to remove `solo: true` from test");
32. 		}
33. 
34. 		(solo ? it.only : skip ? it.skip : it)(dir, () => {
35. 			const config = tryRequire(`./samples/${dir}/_config.js`) || {};
36. 			const input = fs
37. 				.readFileSync(`test/css/samples/${dir}/input.html`, "utf-8")
38. 				.replace(/\s+$/, "");
39. 
40. 			const expectedWarnings = (config.warnings || []).map(normalizeWarning);
41. 			const domWarnings = [];
42. 			const ssrWarnings = [];
43. 
44. 			const dom = svelte.compile(input, Object.assign(config, {
45. 				format: 'iife',
46. 				name: 'SvelteComponent',
47. 				onwarn: warning => {
48. 					domWarnings.push(warning);
49. 				}
50. 			}));
51. 
52. 			const ssr = svelte.compile(input, Object.assign(config, {
53. 				format: 'iife',
54. 				generate: 'ssr',
55. 				name: 'SvelteComponent',
56. 				onwarn: warning => {
57. 					ssrWarnings.push(warning);
58. 				}
59. 			}));
60. 
61. 			assert.equal(dom.css, ssr.css);
62. 
63. 			assert.deepEqual(domWarnings.map(normalizeWarning), ssrWarnings.map(normalizeWarning));
64. 			assert.deepEqual(domWarnings.map(normalizeWarning), expectedWarnings);
65. 
66. 			fs.writeFileSync(`test/css/samples/${dir}/_actual.css`, dom.css);
67. 			const expected = {
68. 				html: read(`test/css/samples/${dir}/expected.html`),
69. 				css: read(`test/css/samples/${dir}/expected.css`)
70. 			};
71. 
72. 			assert.equal(dom.css.replace(/svelte-\d+/g, 'svelte-xyz'), expected.css);
73. 
74. 			// verify that the right elements have scoping selectors
75. 			if (expected.html !== null) {
76. 				const window = env();
77. 
78. 				const Component = eval(`(function () { ${dom.code}; return SvelteComponent; }())`);
79. 				const target = window.document.querySelector("main");
80. 
81. 				new Component({ target, data: config.data });
82. 				const html = target.innerHTML;
83. 
84. 				fs.writeFileSync(`test/css/samples/${dir}/_actual.html`, html);
85. 
86. 				// dom
87. 				assert.equal(
88. 					normalizeHtml(window, html).replace(/svelte-\d+/g, 'svelte-xyz'),
89. 					normalizeHtml(window, expected.html)
90. 				);
91. 
92. 				// ssr
93. 				const component = eval(`(function () { ${ssr.code}; return SvelteComponent; }())`);
94. 
95. 				assert.equal(
96. 					normalizeHtml(window, component.render(config.data)).replace(/svelte-\d+/g, 'svelte-xyz'),
97. 					normalizeHtml(window, expected.html)
98. 				);
99. 			}
100. 		});
101. 	});
102. });
103. 
104. function read(file) {
105. 	try {
106. 		return fs.readFileSync(file, 'utf-8');
107. 	} catch(err) {
108. 		return null;
109. 	}
110. }


File: test/css/samples/omit-scoping-attribute/expected.css
Line number range: 1 - 1
Content:
1. p[svelte-xyz]{color:red}


File: test/css/samples/omit-scoping-attribute/expected.html
Line number range: 1 - 1
Content:
1. <div><p svelte-xyz="">this is styled</p></div>


File: test/css/samples/omit-scoping-attribute/input.html
Line number range: 1 - 9
Content:
1. <div>
2. 	<p>this is styled</p>
3. </div>
4. 
5. <style>
6. 	p {
7. 		color: red;
8. 	}
9. </style>


File: test/helpers.js
Line number range: 1 - 240
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	if (test) global.__svelte_test = true;
12. 
13. 	const resolved = process.env.COVERAGE
14. 		? require.resolve('../src/index.js')
15. 		: require.resolve('../compiler/svelte.js');
16. 
17. 	delete require.cache[resolved];
18. 	return require(resolved);
19. }
20. 
21. export const svelte = loadSvelte();
22. 
23. export function exists(path) {
24. 	try {
25. 		fs.statSync(path);
26. 		return true;
27. 	} catch (err) {
28. 		return false;
29. 	}
30. }
31. 
32. export function tryToLoadJson(file) {
33. 	try {
34. 		return JSON.parse(fs.readFileSync(file));
35. 	} catch (err) {
36. 		if (err.code !== 'ENOENT') throw err;
37. 		return null;
38. 	}
39. }
40. 
41. export function tryToReadFile(file) {
42. 	try {
43. 		return fs.readFileSync(file, 'utf-8');
44. 	} catch (err) {
45. 		if (err.code !== 'ENOENT') throw err;
46. 		return null;
47. 	}
48. }
49. 
50. const { window } = new JSDOM('<main></main>');
51. global.document = window.document;
52. 
53. export function env() {
54. 	window._svelteTransitionManager = null;
55. 	window.document.body.innerHTML = '<main></main>';
56. 
57. 	return window;
58. }
59. 
60. function cleanChildren(node) {
61. 	let previous = null;
62. 
63. 	// sort attributes
64. 	const attributes = Array.from(node.attributes).sort((a, b) => {
65. 		return a.name < b.name ? -1 : 1;
66. 	});
67. 
68. 	attributes.forEach(attr => {
69. 		node.removeAttribute(attr.name);
70. 	});
71. 
72. 	attributes.forEach(attr => {
73. 		node.setAttribute(attr.name, attr.value);
74. 	});
75. 
76. 	// recurse
77. 	[...node.childNodes].forEach(child => {
78. 		if (child.nodeType === 8) {
79. 			// comment
80. 			node.removeChild(child);
81. 			return;
82. 		}
83. 
84. 		if (child.nodeType === 3) {
85. 			if (
86. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
87. 				node.tagName !== 'text' &&
88. 				node.tagName !== 'tspan'
89. 			) {
90. 				node.removeChild(child);
91. 			}
92. 
93. 			child.data = child.data.replace(/\s{2,}/, '\n');
94. 
95. 			// text
96. 			if (previous && previous.nodeType === 3) {
97. 				previous.data += child.data;
98. 				previous.data = previous.data.replace(/\s{2,}/, '\n');
99. 
100. 				node.removeChild(child);
101. 				child = previous;
102. 			}
103. 		} else {
104. 			cleanChildren(child);
105. 		}
106. 
107. 		previous = child;
108. 	});
109. 
110. 	// collapse whitespace
111. 	if (node.firstChild && node.firstChild.nodeType === 3) {
112. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
113. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
114. 	}
115. 
116. 	if (node.lastChild && node.lastChild.nodeType === 3) {
117. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
118. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
119. 	}
120. }
121. 
122. export function normalizeHtml(window, html) {
123. 	const node = window.document.createElement('div');
124. 	node.innerHTML = html
125. 		.replace(/>[\s\r\n]+</g, '><')
126. 		.trim();
127. 	cleanChildren(node, '');
128. 	return node.innerHTML;
129. }
130. 
131. export function setupHtmlEqual() {
132. 	const window = env();
133. 
134. 	assert.htmlEqual = (actual, expected, message) => {
135. 		assert.deepEqual(
136. 			normalizeHtml(window, actual),
137. 			normalizeHtml(window, expected),
138. 			message
139. 		);
140. 	};
141. }
142. 
143. export function loadConfig(file) {
144. 	try {
145. 		const resolved = require.resolve(file);
146. 		delete require.cache[resolved];
147. 
148. 		const config = require(resolved);
149. 		return config.default || config;
150. 	} catch (err) {
151. 		if (err.code === 'MODULE_NOT_FOUND') {
152. 			return {};
153. 		}
154. 
155. 		throw err;
156. 	}
157. }
158. 
159. export function addLineNumbers(code) {
160. 	return code
161. 		.split('\n')
162. 		.map((line, i) => {
163. 			i = String(i + 1);
164. 			while (i.length < 3) i = ` ${i}`;
165. 
166. 			return (
167. 				chalk.grey(`  ${i}: `) +
168. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
169. 			);
170. 		})
171. 		.join('\n');
172. }
173. 
174. function capitalise(str) {
175. 	return str[0].toUpperCase() + str.slice(1);
176. }
177. 
178. export function showOutput(cwd, options = {}) {
179. 	glob.sync('**/*.html', { cwd }).forEach(file => {
180. 		if (file[0] === '_') return;
181. 		const { code } = svelte.compile(
182. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
183. 			Object.assign(options, {
184. 				filename: file,
185. 				name: capitalise(path.basename(file).replace(/\.html$/, ''))
186. 			})
187. 		);
188. 
189. 		console.log( // eslint-disable-line no-console
190. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
191. 		);
192. 	});
193. }
194. 
195. const start = /\n(\t+)/;
196. export function deindent(strings, ...values) {
197. 	const indentation = start.exec(strings[0])[1];
198. 	const pattern = new RegExp(`^${indentation}`, 'gm');
199. 
200. 	let result = strings[0].replace(start, '').replace(pattern, '');
201. 
202. 	let trailingIndentation = getTrailingIndentation(result);
203. 
204. 	for (let i = 1; i < strings.length; i += 1) {
205. 		let expression = values[i - 1];
206. 		const string = strings[i].replace(pattern, '');
207. 
208. 		if (Array.isArray(expression)) {
209. 			expression = expression.length ? expression.join('\n') : null;
210. 		}
211. 
212. 		if (expression || expression === '') {
213. 			const value = String(expression).replace(
214. 				/\n/g,
215. 				`\n${trailingIndentation}`
216. 			);
217. 			result += value + string;
218. 		} else {
219. 			let c = result.length;
220. 			while (/\s/.test(result[c - 1])) c -= 1;
221. 			result = result.slice(0, c) + string;
222. 		}
223. 
224. 		trailingIndentation = getTrailingIndentation(result);
225. 	}
226. 
227. 	return result.trim().replace(/\t+$/gm, '');
228. }
229. 
230. function getTrailingIndentation(str) {
231. 	let i = str.length;
232. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
233. 	return str.slice(i, str.length);
234. }
235. 
236. export function spaces(i) {
237. 	let result = '';
238. 	while (i--) result += ' ';
239. 	return result;
240. }


File: test/hydration/index.js
Line number range: 1 - 99
Content:
1. import assert from 'assert';
2. import path from 'path';
3. import fs from 'fs';
4. 
5. import {
6. 	showOutput,
7. 	loadConfig,
8. 	loadSvelte,
9. 	env,
10. 	setupHtmlEqual
11. } from '../helpers.js';
12. 
13. let compileOptions = null;
14. 
15. function getName(filename) {
16. 	const base = path.basename(filename).replace('.html', '');
17. 	return base[0].toUpperCase() + base.slice(1);
18. }
19. 
20. describe('hydration', () => {
21. 	before(() => {
22. 		const svelte = loadSvelte();
23. 
24. 		require.extensions['.html'] = function(module, filename) {
25. 			const options = Object.assign(
26. 				{ filename, name: getName(filename), hydratable: true, format: 'cjs' },
27. 				compileOptions
28. 			);
29. 
30. 			const { code } = svelte.compile(fs.readFileSync(filename, 'utf-8'), options);
31. 
32. 			return module._compile(code, filename);
33. 		};
34. 
35. 		return setupHtmlEqual();
36. 	});
37. 
38. 	function runTest(dir) {
39. 		if (dir[0] === '.') return;
40. 
41. 		const config = loadConfig(`./hydration/samples/${dir}/_config.js`);
42. 
43. 		if (config.solo && process.env.CI) {
44. 			throw new Error('Forgot to remove `solo: true` from test');
45. 		}
46. 
47. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
48. 			const cwd = path.resolve(`test/hydration/samples/${dir}`);
49. 
50. 			compileOptions = config.compileOptions || {};
51. 			compileOptions.shared = path.resolve('shared.js');
52. 			compileOptions.dev = config.dev;
53. 			compileOptions.hydrate = true;
54. 
55. 			const window = env();
56. 
57. 			try {
58. 				global.window = window;
59. 
60. 				let SvelteComponent;
61. 
62. 				try {
63. 					SvelteComponent = require(`${cwd}/main.html`);
64. 				} catch (err) {
65. 					throw err;
66. 				}
67. 
68. 				const target = window.document.body;
69. 				target.innerHTML = fs.readFileSync(`${cwd}/_before.html`, 'utf-8');
70. 
71. 				const snapshot = config.snapshot ? config.snapshot(target) : {};
72. 
73. 				const component = new SvelteComponent({
74. 					target,
75. 					hydrate: true,
76. 					data: config.data
77. 				});
78. 
79. 				assert.htmlEqual(target.innerHTML, fs.readFileSync(`${cwd}/_after.html`, 'utf-8'));
80. 
81. 				if (config.test) {
82. 					config.test(assert, target, snapshot, component, window);
83. 				} else {
84. 					component.destroy();
85. 					assert.equal(target.innerHTML, '');
86. 				}
87. 			} catch (err) {
88. 				showOutput(cwd, { shared: 'svelte/shared.js' }); // eslint-disable-line no-console
89. 				throw err;
90. 			}
91. 
92. 			if (config.show) showOutput(cwd, { shared: 'svelte/shared.js' });
93. 		});
94. 	}
95. 
96. 	fs.readdirSync('test/hydration/samples').forEach(dir => {
97. 		runTest(dir, null);
98. 	});
99. });


File: test/hydration/samples/element-ref/_after.html
Line number range: 1 - 1
Content:
1. <h1>Hello world!</h1>


File: test/hydration/samples/element-ref/_before.html
Line number range: 1 - 1
Content:
1. <h1>Hello world!</h1>


File: test/hydration/samples/element-ref/_config.js
Line number range: 1 - 16
Content:
1. export default {
2. 	snapshot(target) {
3. 		const h1 = target.querySelector('h1');
4. 
5. 		return {
6. 			h1,
7. 		};
8. 	},
9. 
10. 	test(assert, target, snapshot, component) {
11. 		const h1 = target.querySelector('h1');
12. 
13. 		assert.equal(h1, snapshot.h1);
14. 		assert.equal(component.refs.h1, h1);
15. 	}
16. };


File: test/hydration/samples/element-ref/main.html
Line number range: 1 - 1
Content:
1. <h1 ref:h1>Hello world!</h1>


File: test/runtime/index.js
Line number range: 1 - 249
Content:
1. import assert from "assert";
2. import * as path from "path";
3. import * as fs from "fs";
4. import * as acorn from "acorn";
5. import { transitionManager } from "../../shared.js";
6. 
7. import {
8. 	showOutput,
9. 	loadConfig,
10. 	loadSvelte,
11. 	env,
12. 	setupHtmlEqual,
13. 	spaces
14. } from "../helpers.js";
15. 
16. let svelte;
17. 
18. let compileOptions = null;
19. 
20. function getName(filename) {
21. 	const base = path.basename(filename).replace(".html", "");
22. 	return base[0].toUpperCase() + base.slice(1);
23. }
24. 
25. const Object_assign = Object.assign;
26. 
27. describe("runtime", () => {
28. 	before(() => {
29. 		svelte = loadSvelte(true);
30. 
31. 		require.extensions[".html"] = function(module, filename) {
32. 			const options = Object.assign(
33. 				{ filename, name: getName(filename), format: 'cjs' },
34. 				compileOptions
35. 			);
36. 
37. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
38. 
39. 			return module._compile(code, filename);
40. 		};
41. 
42. 		return setupHtmlEqual();
43. 	});
44. 
45. 	const failed = new Set();
46. 
47. 	function runTest(dir, shared, hydrate) {
48. 		if (dir[0] === ".") return;
49. 
50. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
51. 
52. 		if (config.solo && process.env.CI) {
53. 			throw new Error("Forgot to remove `solo: true` from test");
54. 		}
55. 
56. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
57. 			if (failed.has(dir)) {
58. 				// this makes debugging easier, by only printing compiled output once
59. 				throw new Error('skipping test, already failed');
60. 			}
61. 
62. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
63. 
64. 			compileOptions = config.compileOptions || {};
65. 			compileOptions.shared = shared;
66. 			compileOptions.hydratable = hydrate;
67. 			compileOptions.dev = config.dev;
68. 
69. 			// check that no ES2015+ syntax slipped in
70. 			if (!config.allowES2015) {
71. 				try {
72. 					const source = fs.readFileSync(
73. 						`test/runtime/samples/${dir}/main.html`,
74. 						"utf-8"
75. 					);
76. 					const { code } = svelte.compile(source, compileOptions);
77. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
78. 					if (startIndex === -1)
79. 						throw new Error("missing create_main_fragment");
80. 					const es5 =
81. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
82. 						code.slice(startIndex).replace(/export default .+/, "");
83. 					acorn.parse(es5, { ecmaVersion: 5 });
84. 				} catch (err) {
85. 					failed.add(dir);
86. 					showOutput(cwd, { shared }); // eslint-disable-line no-console
87. 					throw err;
88. 				}
89. 			}
90. 
91. 			Object.keys(require.cache)
92. 				.filter(x => x.endsWith(".html"))
93. 				.forEach(file => {
94. 					delete require.cache[file];
95. 				});
96. 
97. 			let SvelteComponent;
98. 
99. 			let unintendedError = null;
100. 
101. 			const window = env();
102. 
103. 			try {
104. 				// set of hacks to support transition tests
105. 				transitionManager.running = false;
106. 				transitionManager.transitions = [];
107. 
108. 				const raf = {
109. 					time: 0,
110. 					callback: null,
111. 					tick: now => {
112. 						raf.time = now;
113. 						if (raf.callback) raf.callback();
114. 					}
115. 				};
116. 				window.performance = { now: () => raf.time };
117. 				global.requestAnimationFrame = cb => {
118. 					let called = false;
119. 					raf.callback = () => {
120. 						if (!called) {
121. 							called = true;
122. 							cb();
123. 						}
124. 					};
125. 				};
126. 
127. 				global.window = window;
128. 
129. 				try {
130. 					SvelteComponent = require(`./samples/${dir}/main.html`);
131. 				} catch (err) {
132. 					showOutput(cwd, { shared }); // eslint-disable-line no-console
133. 					throw err;
134. 				}
135. 
136. 				let usedObjectAssign = false;
137. 				Object.assign = () => {
138. 					usedObjectAssign = true;
139. 				};
140. 
141. 				global.window = window;
142. 
143. 				// Put the constructor on window for testing
144. 				window.SvelteComponent = SvelteComponent;
145. 
146. 				const target = window.document.querySelector("main");
147. 
148. 				const warnings = [];
149. 				const warn = console.warn;
150. 				console.warn = warning => {
151. 					warnings.push(warning);
152. 				};
153. 
154. 				const component = new SvelteComponent({
155. 					target,
156. 					hydrate,
157. 					data: config.data
158. 				});
159. 
160. 				Object.assign = Object_assign;
161. 
162. 				console.warn = warn;
163. 
164. 				if (config.error) {
165. 					unintendedError = true;
166. 					throw new Error("Expected a runtime error");
167. 				}
168. 
169. 				if (config.warnings) {
170. 					assert.deepEqual(warnings, config.warnings);
171. 				} else if (warnings.length) {
172. 					unintendedError = true;
173. 					throw new Error("Received unexpected warnings");
174. 				}
175. 
176. 				if (config.html) {
177. 					assert.htmlEqual(target.innerHTML, config.html);
178. 				}
179. 
180. 				if (config.test) {
181. 					config.test(assert, component, target, window, raf);
182. 				} else {
183. 					component.destroy();
184. 					assert.equal(target.innerHTML, "");
185. 				}
186. 
187. 				if (usedObjectAssign) {
188. 					throw new Error(
189. 						"cannot use Object.assign in generated code, as it is not supported everywhere"
190. 					);
191. 				}
192. 			} catch (err) {
193. 				Object.assign = Object_assign;
194. 
195. 				if (config.error && !unintendedError) {
196. 					config.error(assert, err);
197. 				} else {
198. 					failed.add(dir);
199. 					showOutput(cwd, { shared }); // eslint-disable-line no-console
200. 					throw err;
201. 				}
202. 			}
203. 
204. 			if (config.show) showOutput(cwd, { shared });
205. 		});
206. 	}
207. 
208. 	const shared = path.resolve("shared.js");
209. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
210. 		runTest(dir, shared, false);
211. 		runTest(dir, shared, true);
212. 		runTest(dir, null, false);
213. 	});
214. 
215. 	it("fails if options.target is missing in dev mode", () => {
216. 		const { code } = svelte.compile(`<div></div>`, {
217. 			format: "iife",
218. 			name: "SvelteComponent",
219. 			dev: true
220. 		});
221. 
222. 		const SvelteComponent = eval(
223. 			`(function () { ${code}; return SvelteComponent; }())`
224. 		);
225. 
226. 		assert.throws(() => {
227. 			new SvelteComponent();
228. 		}, /'target' is a required option/);
229. 	});
230. 
231. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
232. 		const { code } = svelte.compile(`<div></div>`, {
233. 			format: "iife",
234. 			name: "SvelteComponent",
235. 			dev: true
236. 		});
237. 
238. 		const SvelteComponent = eval(
239. 			`(function () { ${code}; return SvelteComponent; }())`
240. 		);
241. 
242. 		assert.throws(() => {
243. 			new SvelteComponent({
244. 				target: {},
245. 				hydrate: true
246. 			});
247. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
248. 	});
249. });


File: test/server-side-rendering/index.js
Line number range: 1 - 108
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require(process.env.COVERAGE
25. 			? "../../src/server-side-rendering/register.js"
26. 			: "../../ssr/register");
27. 
28. 		return setupHtmlEqual();
29. 	});
30. 
31. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
32. 		if (dir[0] === ".") return;
33. 
34. 		// add .solo to a sample directory name to only run that test, or
35. 		// .show to always show the output. or both
36. 		const solo = /\.solo/.test(dir);
37. 		const show = /\.show/.test(dir);
38. 
39. 		if (solo && process.env.CI) {
40. 			throw new Error("Forgot to remove `solo: true` from test");
41. 		}
42. 
43. 		(solo ? it.only : it)(dir, () => {
44. 			dir = path.resolve("test/server-side-rendering/samples", dir);
45. 			try {
46. 				const component = require(`${dir}/main.html`);
47. 
48. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
49. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
50. 
51. 				const data = tryToLoadJson(`${dir}/data.json`);
52. 
53. 				const html = component.render(data);
54. 				const css = component.renderCss().css;
55. 
56. 				fs.writeFileSync(`${dir}/_actual.html`, html);
57. 				if (css) fs.writeFileSync(`${dir}/_actual.css`, css);
58. 
59. 				assert.htmlEqual(html, expectedHtml);
60. 				assert.equal(
61. 					css.replace(/^\s+/gm, ""),
62. 					expectedCss.replace(/^\s+/gm, "")
63. 				);
64. 
65. 				if (show) showOutput(dir, { generate: 'ssr' });
66. 			} catch (err) {
67. 				showOutput(dir, { generate: 'ssr' });
68. 				throw err;
69. 			}
70. 		});
71. 	});
72. 
73. 	// duplicate client-side tests, as far as possible
74. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
75. 		if (dir[0] === ".") return;
76. 
77. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
78. 
79. 		if (config.solo && process.env.CI) {
80. 			throw new Error("Forgot to remove `solo: true` from test");
81. 		}
82. 
83. 		if (config["skip-ssr"]) return;
84. 
85. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
86. 			const cwd = path.resolve("test/runtime/samples", dir);
87. 
88. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
89. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
90. 				delete require.cache[resolved];
91. 			});
92. 
93. 			const component = require(`../runtime/samples/${dir}/main.html`);
94. 			let html;
95. 
96. 			try {
97. 				html = component.render(config.data);
98. 
99. 				if (config.html) {
100. 					assert.htmlEqual(html, config.html);
101. 				}
102. 			} catch (err) {
103. 				showOutput(cwd, { generate: "ssr" });
104. 				throw err;
105. 			}
106. 		});
107. 	});
108. });


File: test/server-side-rendering/samples/component-refs-and-attributes/Widget.html
Line number range: 1 - 1
Content:
1. <p>{{foo}}</p>


File: test/server-side-rendering/samples/component-refs-and-attributes/_expected.html
Line number range: 1 - 1
Content:
1. <div><p>42</p></div>


File: test/server-side-rendering/samples/component-refs-and-attributes/main.html
Line number range: 1 - 13
Content:
1. <div><Widget ref:widget foo='{{foo}}'/></div>
2. 
3. <script>
4. 	import Widget from './Widget.html';
5. 
6. 	export default {
7. 		components: { Widget },
8. 
9. 		data () {
10. 			return { foo: 42 }
11. 		}
12. 	};
13. </script>


File: test/server-side-rendering/samples/component-refs/Widget.html
Line number range: 1 - 1
Content:
1. <p>widget</p>


File: test/server-side-rendering/samples/component-refs/_expected.html
Line number range: 1 - 1
Content:
1. <div><p>widget</p></div>


File: test/server-side-rendering/samples/component-refs/main.html
Line number range: 1 - 9
Content:
1. <div><Widget ref:widget/></div>
2. 
3. <script>
4. 	import Widget from './Widget.html';
5. 
6. 	export default {
7. 		components: { Widget }
8. 	};
9. </script>


File: test/validator/index.js
Line number range: 1 - 88
Content:
1. import * as fs from "fs";
2. import assert from "assert";
3. import { svelte, tryToLoadJson } from "../helpers.js";
4. 
5. describe("validate", () => {
6. 	fs.readdirSync("test/validator/samples").forEach(dir => {
7. 		if (dir[0] === ".") return;
8. 
9. 		// add .solo to a sample directory name to only run that test
10. 		const solo = /\.solo/.test(dir);
11. 
12. 		if (solo && process.env.CI) {
13. 			throw new Error("Forgot to remove `solo: true` from test");
14. 		}
15. 
16. 		(solo ? it.only : it)(dir, () => {
17. 			const filename = `test/validator/samples/${dir}/input.html`;
18. 			const input = fs.readFileSync(filename, "utf-8").replace(/\s+$/, "");
19. 
20. 			const expectedWarnings = tryToLoadJson(`test/validator/samples/${dir}/warnings.json`) || [];
21. 			const expectedErrors = tryToLoadJson(`test/validator/samples/${dir}/errors.json`);
22. 			let error;
23. 
24. 			try {
25. 				const warnings = [];
26. 
27. 				svelte.compile(input, {
28. 					onwarn(warning) {
29. 						warnings.push({
30. 							message: warning.message,
31. 							pos: warning.pos,
32. 							loc: warning.loc
33. 						});
34. 					}
35. 				});
36. 
37. 				assert.deepEqual(warnings, expectedWarnings);
38. 			} catch (e) {
39. 				error = e;
40. 			}
41. 
42. 			const expected = expectedErrors && expectedErrors[0];
43. 
44. 			if (error || expected) {
45. 				if (error && !expected) {
46. 					throw error;
47. 				}
48. 
49. 				if (expected && !error) {
50. 					throw new Error(`Expected an error: ${expected.message}`);
51. 				}
52. 
53. 				assert.equal(error.message, expected.message);
54. 				assert.deepEqual(error.loc, expected.loc);
55. 				assert.equal(error.pos, expected.pos);
56. 			}
57. 		});
58. 	});
59. 
60. 	it("errors if options.name is illegal", () => {
61. 		assert.throws(() => {
62. 			svelte.compile("<div></div>", {
63. 				name: "not.valid"
64. 			});
65. 		}, /options\.name must be a valid identifier/);
66. 	});
67. 
68. 	it("warns if options.name is not capitalised", () => {
69. 		const warnings = [];
70. 		svelte.compile("<div></div>", {
71. 			name: "lowercase",
72. 			onwarn(warning) {
73. 				warnings.push({
74. 					message: warning.message,
75. 					pos: warning.pos,
76. 					loc: warning.loc
77. 				});
78. 			}
79. 		});
80. 		assert.deepEqual(warnings, [
81. 			{
82. 				message: "options.name should be capitalised",
83. 				pos: undefined,
84. 				loc: undefined
85. 			}
86. 		]);
87. 	});
88. });

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-10 23:30:36,378 - thread-133013312636608.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='Query explicitly requests the full contents with line numbers of test/runtime/index.js. This file orchestrates runtime tests including hydration and ref-related behavior checks, making it essential to the requested set.', relative_path='test/runtime/index.js', start_line=1, end_line=249), ContextOutput(reasoning='Query requests test/css/index.js. This file compiles CSS tests, compares DOM/SSR CSS output, and verifies scoping selectors — directly relevant to omit-scoping-attribute samples.', relative_path='test/css/index.js', start_line=1, end_line=110), ContextOutput(reasoning='Query requests test/hydration/index.js. It sets up hydratable compilation and runs hydration samples, including element-ref verification.', relative_path='test/hydration/index.js', start_line=1, end_line=99), ContextOutput(reasoning='Query requests test/server-side-rendering/index.js. It runs SSR samples and duplicates runtime tests for SSR, including component refs.', relative_path='test/server-side-rendering/index.js', start_line=1, end_line=108), ContextOutput(reasoning='Query requests test/validator/index.js. This file validates compiler warnings and errors; included per query requirement.', relative_path='test/validator/index.js', start_line=1, end_line=88), ContextOutput(reasoning='Query requests test/helpers.js. It provides core utilities (env, normalizeHtml, loadSvelte, setupHtmlEqual) required by tests, thus essential context.', relative_path='test/helpers.js', start_line=1, end_line=240), ContextOutput(reasoning='Query requests files in test/hydration/samples/element-ref. _before.html is part of the sample; include full content.', relative_path='test/hydration/samples/element-ref/_before.html', start_line=1, end_line=1), ContextOutput(reasoning='Query requests files in test/hydration/samples/element-ref. _after.html verifies expected hydrated output.', relative_path='test/hydration/samples/element-ref/_after.html', start_line=1, end_line=1), ContextOutput(reasoning='Query requests files in test/hydration/samples/element-ref. _config.js snapshots the DOM node and asserts refs after hydration; critical to ref behavior.', relative_path='test/hydration/samples/element-ref/_config.js', start_line=1, end_line=16), ContextOutput(reasoning='Query requests files in test/hydration/samples/element-ref. main.html contains the markup with ref:h1; include full content.', relative_path='test/hydration/samples/element-ref/main.html', start_line=1, end_line=1), ContextOutput(reasoning='Query requests files in test/server-side-rendering/samples/component-refs. Widget.html is the child component; include full content.', relative_path='test/server-side-rendering/samples/component-refs/Widget.html', start_line=1, end_line=1), ContextOutput(reasoning='Query requests files in test/server-side-rendering/samples/component-refs. _expected.html contains SSR output expectation; include full content.', relative_path='test/server-side-rendering/samples/component-refs/_expected.html', start_line=1, end_line=1), ContextOutput(reasoning='Query requests files in test/server-side-rendering/samples/component-refs. main.html uses ref:widget; include full content.', relative_path='test/server-side-rendering/samples/component-refs/main.html', start_line=1, end_line=9), ContextOutput(reasoning='Query requests files in test/server-side-rendering/samples/component-refs-and-attributes. Widget.html displays foo; include full content.', relative_path='test/server-side-rendering/samples/component-refs-and-attributes/Widget.html', start_line=1, end_line=1), ContextOutput(reasoning='Query requests files in test/server-side-rendering/samples/component-refs-and-attributes. _expected.html contains SSR expected output; include full content.', relative_path='test/server-side-rendering/samples/component-refs-and-attributes/_expected.html', start_line=1, end_line=1), ContextOutput(reasoning='Query requests files in test/server-side-rendering/samples/component-refs-and-attributes. main.html uses ref and attributes; include full content.', relative_path='test/server-side-rendering/samples/component-refs-and-attributes/main.html', start_line=1, end_line=13), ContextOutput(reasoning='Query requests all test/css/samples/omit-scoping-attribute* directories. We have omit-scoping-attribute; input.html defines simple CSS selecting p; include full content.', relative_path='test/css/samples/omit-scoping-attribute/input.html', start_line=1, end_line=9), ContextOutput(reasoning='Query requests omit-scoping-attribute directory expected.html showing scoped attribute presence; include full content.', relative_path='test/css/samples/omit-scoping-attribute/expected.html', start_line=1, end_line=1), ContextOutput(reasoning='Query requests omit-scoping-attribute directory expected.css showing scoped selector; include full content.', relative_path='test/css/samples/omit-scoping-attribute/expected.css', start_line=1, end_line=1)]
2025-11-10 23:30:36,384 - thread-133013312636608.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 19 contexts to memory for query: Please provide the full contents with line numbers of test/runtime/index.js, test/css/index.js, test/hydration/index.js, test/server-side-rendering/index.js, test/validator/index.js, test/helpers.js, plus the files in test/runtime/samples/element-ref, test/hydration/samples/element-ref, test/server-side-rendering/samples/component-refs and component-refs-and-attributes, and all test/css/samples/omit-scoping-attribute* directories.
2025-11-10 23:30:40,909 - thread-133013312636608.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-10 23:30:40,910 - thread-133013312636608.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 19 new contexts to 0 existing contexts
2025-11-10 23:30:40,910 - thread-133013312636608.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 19 total contexts (removed 0 duplicates)
2025-11-10 23:30:40,912 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── getGlobals.ts
|   |           ├── getIntro.ts
|   |           ├── getOutro.ts
|   |           └── walkHtml.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getObject.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── reservedNames.ts
|   |   ├── spaces.ts
|   |   ├── stringify.ts
|   |   └── trim.ts
|   └── validate
|       ├── html
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── pass-no-options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-onrender
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
using refs in css

Issue description: 
When I use a ref, I most often also want to get a handle to it with css, which leads to slightly annoying, duplicative markup.

```html
<style>
  .container {
    color: red
  }
</style>
<div class="container" ref:container></div>
```
 
The only solutions I can think of to mitigate this are untenable, but thought I raise this if others see something better.

- Make nodes with ids available as refs, like polymer's static node map
- Make svelte refs available as synthetic css selectors
- Make a syntax shortcut for declaring refs as classes, e.g. `<div ref:class:container ></div>`

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents with line numbers of test/runtime/index.js, test/css/index.js, test/hydration/index.js, test/server-side-rendering/index.js, test/validator/index.js, test/helpers.js, plus the files in test/runtime/samples/element-ref, test/hydration/samples/element-ref, test/server-side-rendering/samples/component-refs and component-refs-and-attributes, and all test/css/samples/omit-scoping-attribute* directories.
Extra Requirements: If providing everything is too large, at minimum share test/runtime/index.js and samples/element-ref, test/css/index.js and omit-scoping-attribute* samples, test/server-side-rendering/index.js and component-refs(+attributes) samples, and test/helpers.js.
Purpose: To extract 8 complete, self-contained test cases with exact line numbers that will be affected by changes to ref/CSS behavior.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: test/css/index.js
Line number range: 1 - 110
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import { env, normalizeHtml, svelte } from "../helpers.js";
4. 
5. function tryRequire(file) {
6. 	try {
7. 		const mod = require(file);
8. 		return mod.default || mod;
9. 	} catch (err) {
10. 		if (err.code !== "MODULE_NOT_FOUND") throw err;
11. 		return null;
12. 	}
13. }
14. 
15. function normalizeWarning(warning) {
16. 	warning.frame = warning.frame.replace(/^\n/, '').replace(/^\t+/gm, '').replace(/\s+$/gm, '');
17. 	delete warning.filename;
18. 	delete warning.toString;
19. 	return warning;
20. }
21. 
22. describe("css", () => {
23. 	fs.readdirSync("test/css/samples").forEach(dir => {
24. 		if (dir[0] === ".") return;
25. 
26. 		// add .solo to a sample directory name to only run that test
27. 		const solo = /\.solo/.test(dir);
28. 		const skip = /\.skip/.test(dir);
29. 
30. 		if (solo && process.env.CI) {
31. 			throw new Error("Forgot to remove `solo: true` from test");
32. 		}
33. 
34. 		(solo ? it.only : skip ? it.skip : it)(dir, () => {
35. 			const config = tryRequire(`./samples/${dir}/_config.js`) || {};
36. 			const input = fs
37. 				.readFileSync(`test/css/samples/${dir}/input.html`, "utf-8")
38. 				.replace(/\s+$/, "");
39. 
40. 			const expectedWarnings = (config.warnings || []).map(normalizeWarning);
41. 			const domWarnings = [];
42. 			const ssrWarnings = [];
43. 
44. 			const dom = svelte.compile(input, Object.assign(config, {
45. 				format: 'iife',
46. 				name: 'SvelteComponent',
47. 				onwarn: warning => {
48. 					domWarnings.push(warning);
49. 				}
50. 			}));
51. 
52. 			const ssr = svelte.compile(input, Object.assign(config, {
53. 				format: 'iife',
54. 				generate: 'ssr',
55. 				name: 'SvelteComponent',
56. 				onwarn: warning => {
57. 					ssrWarnings.push(warning);
58. 				}
59. 			}));
60. 
61. 			assert.equal(dom.css, ssr.css);
62. 
63. 			assert.deepEqual(domWarnings.map(normalizeWarning), ssrWarnings.map(normalizeWarning));
64. 			assert.deepEqual(domWarnings.map(normalizeWarning), expectedWarnings);
65. 
66. 			fs.writeFileSync(`test/css/samples/${dir}/_actual.css`, dom.css);
67. 			const expected = {
68. 				html: read(`test/css/samples/${dir}/expected.html`),
69. 				css: read(`test/css/samples/${dir}/expected.css`)
70. 			};
71. 
72. 			assert.equal(dom.css.replace(/svelte-\d+/g, 'svelte-xyz'), expected.css);
73. 
74. 			// verify that the right elements have scoping selectors
75. 			if (expected.html !== null) {
76. 				const window = env();
77. 
78. 				const Component = eval(`(function () { ${dom.code}; return SvelteComponent; }())`);
79. 				const target = window.document.querySelector("main");
80. 
81. 				new Component({ target, data: config.data });
82. 				const html = target.innerHTML;
83. 
84. 				fs.writeFileSync(`test/css/samples/${dir}/_actual.html`, html);
85. 
86. 				// dom
87. 				assert.equal(
88. 					normalizeHtml(window, html).replace(/svelte-\d+/g, 'svelte-xyz'),
89. 					normalizeHtml(window, expected.html)
90. 				);
91. 
92. 				// ssr
93. 				const component = eval(`(function () { ${ssr.code}; return SvelteComponent; }())`);
94. 
95. 				assert.equal(
96. 					normalizeHtml(window, component.render(config.data)).replace(/svelte-\d+/g, 'svelte-xyz'),
97. 					normalizeHtml(window, expected.html)
98. 				);
99. 			}
100. 		});
101. 	});
102. });
103. 
104. function read(file) {
105. 	try {
106. 		return fs.readFileSync(file, 'utf-8');
107. 	} catch(err) {
108. 		return null;
109. 	}
110. }


File: test/css/samples/omit-scoping-attribute/expected.css
Line number range: 1 - 1
Content:
1. p[svelte-xyz]{color:red}


File: test/css/samples/omit-scoping-attribute/expected.html
Line number range: 1 - 1
Content:
1. <div><p svelte-xyz="">this is styled</p></div>


File: test/css/samples/omit-scoping-attribute/input.html
Line number range: 1 - 9
Content:
1. <div>
2. 	<p>this is styled</p>
3. </div>
4. 
5. <style>
6. 	p {
7. 		color: red;
8. 	}
9. </style>


File: test/helpers.js
Line number range: 1 - 240
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	if (test) global.__svelte_test = true;
12. 
13. 	const resolved = process.env.COVERAGE
14. 		? require.resolve('../src/index.js')
15. 		: require.resolve('../compiler/svelte.js');
16. 
17. 	delete require.cache[resolved];
18. 	return require(resolved);
19. }
20. 
21. export const svelte = loadSvelte();
22. 
23. export function exists(path) {
24. 	try {
25. 		fs.statSync(path);
26. 		return true;
27. 	} catch (err) {
28. 		return false;
29. 	}
30. }
31. 
32. export function tryToLoadJson(file) {
33. 	try {
34. 		return JSON.parse(fs.readFileSync(file));
35. 	} catch (err) {
36. 		if (err.code !== 'ENOENT') throw err;
37. 		return null;
38. 	}
39. }
40. 
41. export function tryToReadFile(file) {
42. 	try {
43. 		return fs.readFileSync(file, 'utf-8');
44. 	} catch (err) {
45. 		if (err.code !== 'ENOENT') throw err;
46. 		return null;
47. 	}
48. }
49. 
50. const { window } = new JSDOM('<main></main>');
51. global.document = window.document;
52. 
53. export function env() {
54. 	window._svelteTransitionManager = null;
55. 	window.document.body.innerHTML = '<main></main>';
56. 
57. 	return window;
58. }
59. 
60. function cleanChildren(node) {
61. 	let previous = null;
62. 
63. 	// sort attributes
64. 	const attributes = Array.from(node.attributes).sort((a, b) => {
65. 		return a.name < b.name ? -1 : 1;
66. 	});
67. 
68. 	attributes.forEach(attr => {
69. 		node.removeAttribute(attr.name);
70. 	});
71. 
72. 	attributes.forEach(attr => {
73. 		node.setAttribute(attr.name, attr.value);
74. 	});
75. 
76. 	// recurse
77. 	[...node.childNodes].forEach(child => {
78. 		if (child.nodeType === 8) {
79. 			// comment
80. 			node.removeChild(child);
81. 			return;
82. 		}
83. 
84. 		if (child.nodeType === 3) {
85. 			if (
86. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
87. 				node.tagName !== 'text' &&
88. 				node.tagName !== 'tspan'
89. 			) {
90. 				node.removeChild(child);
91. 			}
92. 
93. 			child.data = child.data.replace(/\s{2,}/, '\n');
94. 
95. 			// text
96. 			if (previous && previous.nodeType === 3) {
97. 				previous.data += child.data;
98. 				previous.data = previous.data.replace(/\s{2,}/, '\n');
99. 
100. 				node.removeChild(child);
101. 				child = previous;
102. 			}
103. 		} else {
104. 			cleanChildren(child);
105. 		}
106. 
107. 		previous = child;
108. 	});
109. 
110. 	// collapse whitespace
111. 	if (node.firstChild && node.firstChild.nodeType === 3) {
112. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
113. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
114. 	}
115. 
116. 	if (node.lastChild && node.lastChild.nodeType === 3) {
117. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
118. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
119. 	}
120. }
121. 
122. export function normalizeHtml(window, html) {
123. 	const node = window.document.createElement('div');
124. 	node.innerHTML = html
125. 		.replace(/>[\s\r\n]+</g, '><')
126. 		.trim();
127. 	cleanChildren(node, '');
128. 	return node.innerHTML;
129. }
130. 
131. export function setupHtmlEqual() {
132. 	const window = env();
133. 
134. 	assert.htmlEqual = (actual, expected, message) => {
135. 		assert.deepEqual(
136. 			normalizeHtml(window, actual),
137. 			normalizeHtml(window, expected),
138. 			message
139. 		);
140. 	};
141. }
142. 
143. export function loadConfig(file) {
144. 	try {
145. 		const resolved = require.resolve(file);
146. 		delete require.cache[resolved];
147. 
148. 		const config = require(resolved);
149. 		return config.default || config;
150. 	} catch (err) {
151. 		if (err.code === 'MODULE_NOT_FOUND') {
152. 			return {};
153. 		}
154. 
155. 		throw err;
156. 	}
157. }
158. 
159. export function addLineNumbers(code) {
160. 	return code
161. 		.split('\n')
162. 		.map((line, i) => {
163. 			i = String(i + 1);
164. 			while (i.length < 3) i = ` ${i}`;
165. 
166. 			return (
167. 				chalk.grey(`  ${i}: `) +
168. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
169. 			);
170. 		})
171. 		.join('\n');
172. }
173. 
174. function capitalise(str) {
175. 	return str[0].toUpperCase() + str.slice(1);
176. }
177. 
178. export function showOutput(cwd, options = {}) {
179. 	glob.sync('**/*.html', { cwd }).forEach(file => {
180. 		if (file[0] === '_') return;
181. 		const { code } = svelte.compile(
182. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
183. 			Object.assign(options, {
184. 				filename: file,
185. 				name: capitalise(path.basename(file).replace(/\.html$/, ''))
186. 			})
187. 		);
188. 
189. 		console.log( // eslint-disable-line no-console
190. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
191. 		);
192. 	});
193. }
194. 
195. const start = /\n(\t+)/;
196. export function deindent(strings, ...values) {
197. 	const indentation = start.exec(strings[0])[1];
198. 	const pattern = new RegExp(`^${indentation}`, 'gm');
199. 
200. 	let result = strings[0].replace(start, '').replace(pattern, '');
201. 
202. 	let trailingIndentation = getTrailingIndentation(result);
203. 
204. 	for (let i = 1; i < strings.length; i += 1) {
205. 		let expression = values[i - 1];
206. 		const string = strings[i].replace(pattern, '');
207. 
208. 		if (Array.isArray(expression)) {
209. 			expression = expression.length ? expression.join('\n') : null;
210. 		}
211. 
212. 		if (expression || expression === '') {
213. 			const value = String(expression).replace(
214. 				/\n/g,
215. 				`\n${trailingIndentation}`
216. 			);
217. 			result += value + string;
218. 		} else {
219. 			let c = result.length;
220. 			while (/\s/.test(result[c - 1])) c -= 1;
221. 			result = result.slice(0, c) + string;
222. 		}
223. 
224. 		trailingIndentation = getTrailingIndentation(result);
225. 	}
226. 
227. 	return result.trim().replace(/\t+$/gm, '');
228. }
229. 
230. function getTrailingIndentation(str) {
231. 	let i = str.length;
232. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
233. 	return str.slice(i, str.length);
234. }
235. 
236. export function spaces(i) {
237. 	let result = '';
238. 	while (i--) result += ' ';
239. 	return result;
240. }


File: test/hydration/index.js
Line number range: 1 - 99
Content:
1. import assert from 'assert';
2. import path from 'path';
3. import fs from 'fs';
4. 
5. import {
6. 	showOutput,
7. 	loadConfig,
8. 	loadSvelte,
9. 	env,
10. 	setupHtmlEqual
11. } from '../helpers.js';
12. 
13. let compileOptions = null;
14. 
15. function getName(filename) {
16. 	const base = path.basename(filename).replace('.html', '');
17. 	return base[0].toUpperCase() + base.slice(1);
18. }
19. 
20. describe('hydration', () => {
21. 	before(() => {
22. 		const svelte = loadSvelte();
23. 
24. 		require.extensions['.html'] = function(module, filename) {
25. 			const options = Object.assign(
26. 				{ filename, name: getName(filename), hydratable: true, format: 'cjs' },
27. 				compileOptions
28. 			);
29. 
30. 			const { code } = svelte.compile(fs.readFileSync(filename, 'utf-8'), options);
31. 
32. 			return module._compile(code, filename);
33. 		};
34. 
35. 		return setupHtmlEqual();
36. 	});
37. 
38. 	function runTest(dir) {
39. 		if (dir[0] === '.') return;
40. 
41. 		const config = loadConfig(`./hydration/samples/${dir}/_config.js`);
42. 
43. 		if (config.solo && process.env.CI) {
44. 			throw new Error('Forgot to remove `solo: true` from test');
45. 		}
46. 
47. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
48. 			const cwd = path.resolve(`test/hydration/samples/${dir}`);
49. 
50. 			compileOptions = config.compileOptions || {};
51. 			compileOptions.shared = path.resolve('shared.js');
52. 			compileOptions.dev = config.dev;
53. 			compileOptions.hydrate = true;
54. 
55. 			const window = env();
56. 
57. 			try {
58. 				global.window = window;
59. 
60. 				let SvelteComponent;
61. 
62. 				try {
63. 					SvelteComponent = require(`${cwd}/main.html`);
64. 				} catch (err) {
65. 					throw err;
66. 				}
67. 
68. 				const target = window.document.body;
69. 				target.innerHTML = fs.readFileSync(`${cwd}/_before.html`, 'utf-8');
70. 
71. 				const snapshot = config.snapshot ? config.snapshot(target) : {};
72. 
73. 				const component = new SvelteComponent({
74. 					target,
75. 					hydrate: true,
76. 					data: config.data
77. 				});
78. 
79. 				assert.htmlEqual(target.innerHTML, fs.readFileSync(`${cwd}/_after.html`, 'utf-8'));
80. 
81. 				if (config.test) {
82. 					config.test(assert, target, snapshot, component, window);
83. 				} else {
84. 					component.destroy();
85. 					assert.equal(target.innerHTML, '');
86. 				}
87. 			} catch (err) {
88. 				showOutput(cwd, { shared: 'svelte/shared.js' }); // eslint-disable-line no-console
89. 				throw err;
90. 			}
91. 
92. 			if (config.show) showOutput(cwd, { shared: 'svelte/shared.js' });
93. 		});
94. 	}
95. 
96. 	fs.readdirSync('test/hydration/samples').forEach(dir => {
97. 		runTest(dir, null);
98. 	});
99. });


File: test/hydration/samples/element-ref/_after.html
Line number range: 1 - 1
Content:
1. <h1>Hello world!</h1>


File: test/hydration/samples/element-ref/_before.html
Line number range: 1 - 1
Content:
1. <h1>Hello world!</h1>


File: test/hydration/samples/element-ref/_config.js
Line number range: 1 - 16
Content:
1. export default {
2. 	snapshot(target) {
3. 		const h1 = target.querySelector('h1');
4. 
5. 		return {
6. 			h1,
7. 		};
8. 	},
9. 
10. 	test(assert, target, snapshot, component) {
11. 		const h1 = target.querySelector('h1');
12. 
13. 		assert.equal(h1, snapshot.h1);
14. 		assert.equal(component.refs.h1, h1);
15. 	}
16. };


File: test/hydration/samples/element-ref/main.html
Line number range: 1 - 1
Content:
1. <h1 ref:h1>Hello world!</h1>


File: test/runtime/index.js
Line number range: 1 - 249
Content:
1. import assert from "assert";
2. import * as path from "path";
3. import * as fs from "fs";
4. import * as acorn from "acorn";
5. import { transitionManager } from "../../shared.js";
6. 
7. import {
8. 	showOutput,
9. 	loadConfig,
10. 	loadSvelte,
11. 	env,
12. 	setupHtmlEqual,
13. 	spaces
14. } from "../helpers.js";
15. 
16. let svelte;
17. 
18. let compileOptions = null;
19. 
20. function getName(filename) {
21. 	const base = path.basename(filename).replace(".html", "");
22. 	return base[0].toUpperCase() + base.slice(1);
23. }
24. 
25. const Object_assign = Object.assign;
26. 
27. describe("runtime", () => {
28. 	before(() => {
29. 		svelte = loadSvelte(true);
30. 
31. 		require.extensions[".html"] = function(module, filename) {
32. 			const options = Object.assign(
33. 				{ filename, name: getName(filename), format: 'cjs' },
34. 				compileOptions
35. 			);
36. 
37. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
38. 
39. 			return module._compile(code, filename);
40. 		};
41. 
42. 		return setupHtmlEqual();
43. 	});
44. 
45. 	const failed = new Set();
46. 
47. 	function runTest(dir, shared, hydrate) {
48. 		if (dir[0] === ".") return;
49. 
50. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
51. 
52. 		if (config.solo && process.env.CI) {
53. 			throw new Error("Forgot to remove `solo: true` from test");
54. 		}
55. 
56. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers)`, () => {
57. 			if (failed.has(dir)) {
58. 				// this makes debugging easier, by only printing compiled output once
59. 				throw new Error('skipping test, already failed');
60. 			}
61. 
62. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
63. 
64. 			compileOptions = config.compileOptions || {};
65. 			compileOptions.shared = shared;
66. 			compileOptions.hydratable = hydrate;
67. 			compileOptions.dev = config.dev;
68. 
69. 			// check that no ES2015+ syntax slipped in
70. 			if (!config.allowES2015) {
71. 				try {
72. 					const source = fs.readFileSync(
73. 						`test/runtime/samples/${dir}/main.html`,
74. 						"utf-8"
75. 					);
76. 					const { code } = svelte.compile(source, compileOptions);
77. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
78. 					if (startIndex === -1)
79. 						throw new Error("missing create_main_fragment");
80. 					const es5 =
81. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
82. 						code.slice(startIndex).replace(/export default .+/, "");
83. 					acorn.parse(es5, { ecmaVersion: 5 });
84. 				} catch (err) {
85. 					failed.add(dir);
86. 					showOutput(cwd, { shared }); // eslint-disable-line no-console
87. 					throw err;
88. 				}
89. 			}
90. 
91. 			Object.keys(require.cache)
92. 				.filter(x => x.endsWith(".html"))
93. 				.forEach(file => {
94. 					delete require.cache[file];
95. 				});
96. 
97. 			let SvelteComponent;
98. 
99. 			let unintendedError = null;
100. 
101. 			const window = env();
102. 
103. 			try {
104. 				// set of hacks to support transition tests
105. 				transitionManager.running = false;
106. 				transitionManager.transitions = [];
107. 
108. 				const raf = {
109. 					time: 0,
110. 					callback: null,
111. 					tick: now => {
112. 						raf.time = now;
113. 						if (raf.callback) raf.callback();
114. 					}
115. 				};
116. 				window.performance = { now: () => raf.time };
117. 				global.requestAnimationFrame = cb => {
118. 					let called = false;
119. 					raf.callback = () => {
120. 						if (!called) {
121. 							called = true;
122. 							cb();
123. 						}
124. 					};
125. 				};
126. 
127. 				global.window = window;
128. 
129. 				try {
130. 					SvelteComponent = require(`./samples/${dir}/main.html`);
131. 				} catch (err) {
132. 					showOutput(cwd, { shared }); // eslint-disable-line no-console
133. 					throw err;
134. 				}
135. 
136. 				let usedObjectAssign = false;
137. 				Object.assign = () => {
138. 					usedObjectAssign = true;
139. 				};
140. 
141. 				global.window = window;
142. 
143. 				// Put the constructor on window for testing
144. 				window.SvelteComponent = SvelteComponent;
145. 
146. 				const target = window.document.querySelector("main");
147. 
148. 				const warnings = [];
149. 				const warn = console.warn;
150. 				console.warn = warning => {
151. 					warnings.push(warning);
152. 				};
153. 
154. 				const component = new SvelteComponent({
155. 					target,
156. 					hydrate,
157. 					data: config.data
158. 				});
159. 
160. 				Object.assign = Object_assign;
161. 
162. 				console.warn = warn;
163. 
164. 				if (config.error) {
165. 					unintendedError = true;
166. 					throw new Error("Expected a runtime error");
167. 				}
168. 
169. 				if (config.warnings) {
170. 					assert.deepEqual(warnings, config.warnings);
171. 				} else if (warnings.length) {
172. 					unintendedError = true;
173. 					throw new Error("Received unexpected warnings");
174. 				}
175. 
176. 				if (config.html) {
177. 					assert.htmlEqual(target.innerHTML, config.html);
178. 				}
179. 
180. 				if (config.test) {
181. 					config.test(assert, component, target, window, raf);
182. 				} else {
183. 					component.destroy();
184. 					assert.equal(target.innerHTML, "");
185. 				}
186. 
187. 				if (usedObjectAssign) {
188. 					throw new Error(
189. 						"cannot use Object.assign in generated code, as it is not supported everywhere"
190. 					);
191. 				}
192. 			} catch (err) {
193. 				Object.assign = Object_assign;
194. 
195. 				if (config.error && !unintendedError) {
196. 					config.error(assert, err);
197. 				} else {
198. 					failed.add(dir);
199. 					showOutput(cwd, { shared }); // eslint-disable-line no-console
200. 					throw err;
201. 				}
202. 			}
203. 
204. 			if (config.show) showOutput(cwd, { shared });
205. 		});
206. 	}
207. 
208. 	const shared = path.resolve("shared.js");
209. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
210. 		runTest(dir, shared, false);
211. 		runTest(dir, shared, true);
212. 		runTest(dir, null, false);
213. 	});
214. 
215. 	it("fails if options.target is missing in dev mode", () => {
216. 		const { code } = svelte.compile(`<div></div>`, {
217. 			format: "iife",
218. 			name: "SvelteComponent",
219. 			dev: true
220. 		});
221. 
222. 		const SvelteComponent = eval(
223. 			`(function () { ${code}; return SvelteComponent; }())`
224. 		);
225. 
226. 		assert.throws(() => {
227. 			new SvelteComponent();
228. 		}, /'target' is a required option/);
229. 	});
230. 
231. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
232. 		const { code } = svelte.compile(`<div></div>`, {
233. 			format: "iife",
234. 			name: "SvelteComponent",
235. 			dev: true
236. 		});
237. 
238. 		const SvelteComponent = eval(
239. 			`(function () { ${code}; return SvelteComponent; }())`
240. 		);
241. 
242. 		assert.throws(() => {
243. 			new SvelteComponent({
244. 				target: {},
245. 				hydrate: true
246. 			});
247. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
248. 	});
249. });


File: test/server-side-rendering/index.js
Line number range: 1 - 108
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require(process.env.COVERAGE
25. 			? "../../src/server-side-rendering/register.js"
26. 			: "../../ssr/register");
27. 
28. 		return setupHtmlEqual();
29. 	});
30. 
31. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
32. 		if (dir[0] === ".") return;
33. 
34. 		// add .solo to a sample directory name to only run that test, or
35. 		// .show to always show the output. or both
36. 		const solo = /\.solo/.test(dir);
37. 		const show = /\.show/.test(dir);
38. 
39. 		if (solo && process.env.CI) {
40. 			throw new Error("Forgot to remove `solo: true` from test");
41. 		}
42. 
43. 		(solo ? it.only : it)(dir, () => {
44. 			dir = path.resolve("test/server-side-rendering/samples", dir);
45. 			try {
46. 				const component = require(`${dir}/main.html`);
47. 
48. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
49. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
50. 
51. 				const data = tryToLoadJson(`${dir}/data.json`);
52. 
53. 				const html = component.render(data);
54. 				const css = component.renderCss().css;
55. 
56. 				fs.writeFileSync(`${dir}/_actual.html`, html);
57. 				if (css) fs.writeFileSync(`${dir}/_actual.css`, css);
58. 
59. 				assert.htmlEqual(html, expectedHtml);
60. 				assert.equal(
61. 					css.replace(/^\s+/gm, ""),
62. 					expectedCss.replace(/^\s+/gm, "")
63. 				);
64. 
65. 				if (show) showOutput(dir, { generate: 'ssr' });
66. 			} catch (err) {
67. 				showOutput(dir, { generate: 'ssr' });
68. 				throw err;
69. 			}
70. 		});
71. 	});
72. 
73. 	// duplicate client-side tests, as far as possible
74. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
75. 		if (dir[0] === ".") return;
76. 
77. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
78. 
79. 		if (config.solo && process.env.CI) {
80. 			throw new Error("Forgot to remove `solo: true` from test");
81. 		}
82. 
83. 		if (config["skip-ssr"]) return;
84. 
85. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
86. 			const cwd = path.resolve("test/runtime/samples", dir);
87. 
88. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
89. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
90. 				delete require.cache[resolved];
91. 			});
92. 
93. 			const component = require(`../runtime/samples/${dir}/main.html`);
94. 			let html;
95. 
96. 			try {
97. 				html = component.render(config.data);
98. 
99. 				if (config.html) {
100. 					assert.htmlEqual(html, config.html);
101. 				}
102. 			} catch (err) {
103. 				showOutput(cwd, { generate: "ssr" });
104. 				throw err;
105. 			}
106. 		});
107. 	});
108. });


File: test/server-side-rendering/samples/component-refs-and-attributes/Widget.html
Line number range: 1 - 1
Content:
1. <p>{{foo}}</p>


File: test/server-side-rendering/samples/component-refs-and-attributes/_expected.html
Line number range: 1 - 1
Content:
1. <div><p>42</p></div>


File: test/server-side-rendering/samples/component-refs-and-attributes/main.html
Line number range: 1 - 13
Content:
1. <div><Widget ref:widget foo='{{foo}}'/></div>
2. 
3. <script>
4. 	import Widget from './Widget.html';
5. 
6. 	export default {
7. 		components: { Widget },
8. 
9. 		data () {
10. 			return { foo: 42 }
11. 		}
12. 	};
13. </script>


File: test/server-side-rendering/samples/component-refs/Widget.html
Line number range: 1 - 1
Content:
1. <p>widget</p>


File: test/server-side-rendering/samples/component-refs/_expected.html
Line number range: 1 - 1
Content:
1. <div><p>widget</p></div>


File: test/server-side-rendering/samples/component-refs/main.html
Line number range: 1 - 9
Content:
1. <div><Widget ref:widget/></div>
2. 
3. <script>
4. 	import Widget from './Widget.html';
5. 
6. 	export default {
7. 		components: { Widget }
8. 	};
9. </script>


File: test/validator/index.js
Line number range: 1 - 88
Content:
1. import * as fs from "fs";
2. import assert from "assert";
3. import { svelte, tryToLoadJson } from "../helpers.js";
4. 
5. describe("validate", () => {
6. 	fs.readdirSync("test/validator/samples").forEach(dir => {
7. 		if (dir[0] === ".") return;
8. 
9. 		// add .solo to a sample directory name to only run that test
10. 		const solo = /\.solo/.test(dir);
11. 
12. 		if (solo && process.env.CI) {
13. 			throw new Error("Forgot to remove `solo: true` from test");
14. 		}
15. 
16. 		(solo ? it.only : it)(dir, () => {
17. 			const filename = `test/validator/samples/${dir}/input.html`;
18. 			const input = fs.readFileSync(filename, "utf-8").replace(/\s+$/, "");
19. 
20. 			const expectedWarnings = tryToLoadJson(`test/validator/samples/${dir}/warnings.json`) || [];
21. 			const expectedErrors = tryToLoadJson(`test/validator/samples/${dir}/errors.json`);
22. 			let error;
23. 
24. 			try {
25. 				const warnings = [];
26. 
27. 				svelte.compile(input, {
28. 					onwarn(warning) {
29. 						warnings.push({
30. 							message: warning.message,
31. 							pos: warning.pos,
32. 							loc: warning.loc
33. 						});
34. 					}
35. 				});
36. 
37. 				assert.deepEqual(warnings, expectedWarnings);
38. 			} catch (e) {
39. 				error = e;
40. 			}
41. 
42. 			const expected = expectedErrors && expectedErrors[0];
43. 
44. 			if (error || expected) {
45. 				if (error && !expected) {
46. 					throw error;
47. 				}
48. 
49. 				if (expected && !error) {
50. 					throw new Error(`Expected an error: ${expected.message}`);
51. 				}
52. 
53. 				assert.equal(error.message, expected.message);
54. 				assert.deepEqual(error.loc, expected.loc);
55. 				assert.equal(error.pos, expected.pos);
56. 			}
57. 		});
58. 	});
59. 
60. 	it("errors if options.name is illegal", () => {
61. 		assert.throws(() => {
62. 			svelte.compile("<div></div>", {
63. 				name: "not.valid"
64. 			});
65. 		}, /options\.name must be a valid identifier/);
66. 	});
67. 
68. 	it("warns if options.name is not capitalised", () => {
69. 		const warnings = [];
70. 		svelte.compile("<div></div>", {
71. 			name: "lowercase",
72. 			onwarn(warning) {
73. 				warnings.push({
74. 					message: warning.message,
75. 					pos: warning.pos,
76. 					loc: warning.loc
77. 				});
78. 			}
79. 		});
80. 		assert.deepEqual(warnings, [
81. 			{
82. 				message: "options.name should be capitalised",
83. 				pos: undefined,
84. 				loc: undefined
85. 			}
86. 		]);
87. 	});
88. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-10 23:36:09,544 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We have the harness files and some sample tests (hydration element-ref, SSR component refs, and one CSS omit-scoping-attribute sample), but we are missing the runtime samples for refs and most CSS omit-scoping-attribute variants. To construct 8 complete, self-contained tests with exact line numbers, we need the specific sample contents from runtime (element-ref, component-ref) and additional CSS samples that exercise scoping with classes related to refs.' query='Please provide line-numbered contents of test/runtime/samples/element-ref/main.html and _config.js; test/runtime/samples/component-ref/main.html and _config.js; and all files in test/css/samples/omit-scoping-attribute-class-static and omit-scoping-attribute-class-dynamic (input.html, expected.css, expected.html, and _config.js if present).' extra_requirements='If any requested directory lacks _config.js or expected.html, include whatever files exist and note the absence.' purpose='These files will let me assemble 8 self-contained tests focused on refs and CSS scoping that are most likely affected by implementing refs as CSS handles.'
2025-11-10 23:36:09,546 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide line-numbered contents of test/runtime/samples/element-ref/main.html and _config.js; test/runtime/samples/component-ref/main.html and _config.js; and all files in test/css/samples/omit-scoping-attribute-class-static and omit-scoping-attribute-class-dynamic (input.html, expected.css, expected.html, and _config.js if present).
2025-11-10 23:36:13,614 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-10 23:36:13,614 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-10 23:36:13,614 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-10 23:36:13,615 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-10 23:36:13,616 - thread-133013312636608.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-10 23:36:13,618 - thread-133013312636608.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-10 23:36:13,618 - thread-133013312636608.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide line-numbered contents of test/runtime/samples/element-ref/main.html and _config.js; test/runtime/samples/component-ref/main.html and _config.js; and all files in test/css/samples/omit-scoping-attribute-class-static and omit-scoping-attribute-class-dynamic (input.html, expected.css, expected.html, and _config.js if present).
Extra requirements: If any requested directory lacks _config.js or expected.html, include whatever files exist and note the absence.
Purpose: These files will let me assemble 8 self-contained tests focused on refs and CSS scoping that are most likely affected by implementing refs as CSS handles.
2025-11-10 23:36:22,055 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_CFQqoWrYoERkIKzaw6g3ljxa', 'function': {'arguments': '{"relative_path":"test/runtime/samples/element-ref/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 998, 'prompt_tokens': 2231, 'total_tokens': 3229, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7bfe2242-907d-45f8-8508-914fc32e3fbe-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/element-ref/main.html'}, 'id': 'call_CFQqoWrYoERkIKzaw6g3ljxa', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2231, 'output_tokens': 998, 'total_tokens': 3229, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-10 23:36:30,766 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_GkBtkJEfwJmWsWpBSPwkO2d2', 'function': {'arguments': '{"basename":"element-ref"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 861, 'prompt_tokens': 2293, 'total_tokens': 3154, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--fd8c71e2-5138-4f0e-b3f0-8805383afe14-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'element-ref'}, 'id': 'call_GkBtkJEfwJmWsWpBSPwkO2d2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2293, 'output_tokens': 861, 'total_tokens': 3154, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-10 23:36:42,965 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fIqFTm0Wq9fV3hpC38QOrzjS', 'function': {'arguments': '{"relative_path":"test/runtime/samples/element-ref/main.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 997, 'prompt_tokens': 2368, 'total_tokens': 3365, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--99f2f3af-1ba7-4a7e-aa6e-8a56d4ad4762-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/element-ref/main.html'}, 'id': 'call_fIqFTm0Wq9fV3hpC38QOrzjS', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2368, 'output_tokens': 997, 'total_tokens': 3365, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-10 23:36:50,320 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_qRwctWlvlA62ayzpDmrjlXZ3', 'function': {'arguments': '{"basename":"runtime"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 732, 'prompt_tokens': 2425, 'total_tokens': 3157, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0e49ed53-8836-423f-bbd3-ee1f5cf0309d-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'runtime'}, 'id': 'call_qRwctWlvlA62ayzpDmrjlXZ3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2425, 'output_tokens': 732, 'total_tokens': 3157, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-10 23:36:53,029 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_FiGY2kK2btPcnO49COlbPHxr', 'function': {'arguments': '{"basename":"samples"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 220, 'prompt_tokens': 2491, 'total_tokens': 2711, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4dbb2cc4-06f5-4b91-8898-2f2c14924ca4-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'samples'}, 'id': 'call_FiGY2kK2btPcnO49COlbPHxr', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2491, 'output_tokens': 220, 'total_tokens': 2711, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-10 23:36:54,458 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0q9Rldqn9B8VORKfEfyz7KwU', 'function': {'arguments': '{"relative_path":"test/runtime/samples/element-ref"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 2697, 'total_tokens': 2726, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d570a747-81f6-475e-8261-3543045b771b-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/element-ref'}, 'id': 'call_0q9Rldqn9B8VORKfEfyz7KwU', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2697, 'output_tokens': 29, 'total_tokens': 2726, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:36:57,692 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_a6dySwoBGG878ltAZXb0R7k0', 'function': {'arguments': '{"basename":"component-ref"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 285, 'prompt_tokens': 2752, 'total_tokens': 3037, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d00f3d40-96c6-4c77-8833-b04bd2343e91-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'component-ref'}, 'id': 'call_a6dySwoBGG878ltAZXb0R7k0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2752, 'output_tokens': 285, 'total_tokens': 3037, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-10 23:36:58,727 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_GIMoNe3y8CQ8jxfwmsG5m8SI', 'function': {'arguments': '{"relative_path":"test/runtime/samples/component-ref/main.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 2824, 'total_tokens': 2854, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--68e6f996-8c4b-482b-927d-f83bc8e8eb00-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/component-ref/main.html'}, 'id': 'call_GIMoNe3y8CQ8jxfwmsG5m8SI', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2824, 'output_tokens': 30, 'total_tokens': 2854, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:36:59,851 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zCehbym79qtqIc4ntG3BqEJH', 'function': {'arguments': '{"relative_path":"test/runtime/samples/component-ref/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 2905, 'total_tokens': 2936, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--efde2973-7b64-4957-ac4b-27bb505a849d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/component-ref/main.html'}, 'id': 'call_zCehbym79qtqIc4ntG3BqEJH', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2905, 'output_tokens': 31, 'total_tokens': 2936, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:01,013 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_kYbbDuc9TaH6TvB4ywUNthmx', 'function': {'arguments': '{"relative_path":"test/runtime/samples/component-ref/_config.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 3090, 'total_tokens': 3121, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--853532db-7e4c-4b74-9c78-90cade3d94ec-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/component-ref/_config.js'}, 'id': 'call_kYbbDuc9TaH6TvB4ywUNthmx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3090, 'output_tokens': 31, 'total_tokens': 3121, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:02,179 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_iNs7SER3QGNI76QqAVStgBut', 'function': {'arguments': '{"relative_path":"test/runtime/samples/component-ref/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 3173, 'total_tokens': 3205, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2816}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6a768e9b-21fb-4592-89f0-5ac6773d7341-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/component-ref/_config.js'}, 'id': 'call_iNs7SER3QGNI76QqAVStgBut', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3173, 'output_tokens': 32, 'total_tokens': 3205, 'input_token_details': {'audio': 0, 'cache_read': 2816}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:19,125 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Izj97XzxheqS1uXYpmrq89w0', 'function': {'arguments': '{"relative_path":"test/runtime/samples/element-ref/_config.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1702, 'prompt_tokens': 3355, 'total_tokens': 5057, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1664, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d357404c-9095-4a37-ae10-198152f7f4aa-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/element-ref/_config.js'}, 'id': 'call_Izj97XzxheqS1uXYpmrq89w0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3355, 'output_tokens': 1702, 'total_tokens': 5057, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1664}}
2025-11-10 23:37:27,807 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_UTanZjAkeRdlVMK6MtBoeMTC', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-static"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 680, 'prompt_tokens': 3413, 'total_tokens': 4093, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--219c4f98-94db-403b-ba19-aa9469cbdaf1-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-static'}, 'id': 'call_UTanZjAkeRdlVMK6MtBoeMTC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3413, 'output_tokens': 680, 'total_tokens': 4093, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-10 23:37:28,822 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_cOGSxPHste9xZ9lKf0pQecVI', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-static/input.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 3507, 'total_tokens': 3543, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3072}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8ac5b2a2-7e5d-40ec-a69e-e9c1eab2cd90-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-static/input.html'}, 'id': 'call_cOGSxPHste9xZ9lKf0pQecVI', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3507, 'output_tokens': 36, 'total_tokens': 3543, 'input_token_details': {'audio': 0, 'cache_read': 3072}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:30,472 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WLtgH5dFODsSuTiGTXjNV7bS', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-static/input.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 3600, 'total_tokens': 3637, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b0a4e5db-6fa2-474f-8d08-ed23dbb4d5f6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-static/input.html'}, 'id': 'call_WLtgH5dFODsSuTiGTXjNV7bS', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3600, 'output_tokens': 37, 'total_tokens': 3637, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:31,786 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_IZsnQsTaPFH18QqsMNw2xbgJ', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-static/expected.css"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 3784, 'total_tokens': 3821, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3200}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e4030a9b-ba53-4592-87fd-1cc1efeb92af-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-static/expected.css'}, 'id': 'call_IZsnQsTaPFH18QqsMNw2xbgJ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3784, 'output_tokens': 37, 'total_tokens': 3821, 'input_token_details': {'audio': 0, 'cache_read': 3200}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:32,976 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_HT0PflBGD662vcWFJlCNK2zt', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-static/expected.css"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 3879, 'total_tokens': 3917, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3328}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ba880995-1f61-49eb-abb3-3cb5b74af56d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-static/expected.css'}, 'id': 'call_HT0PflBGD662vcWFJlCNK2zt', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3879, 'output_tokens': 38, 'total_tokens': 3917, 'input_token_details': {'audio': 0, 'cache_read': 3328}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:34,221 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4dtMPM81OL4ZGnECKdXDe0tN', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-static/expected.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 4008, 'total_tokens': 4045, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2432}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--94f6004e-1329-4a75-a886-615de1449c1e-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-static/expected.html'}, 'id': 'call_4dtMPM81OL4ZGnECKdXDe0tN', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4008, 'output_tokens': 37, 'total_tokens': 4045, 'input_token_details': {'audio': 0, 'cache_read': 2432}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:35,313 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_pKOeowmQaxnXBMEfIgmhpGFc', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-static/expected.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 4103, 'total_tokens': 4141, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3712}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--89ec2d6c-a84a-4375-a0a3-0318d40f0049-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-static/expected.html'}, 'id': 'call_pKOeowmQaxnXBMEfIgmhpGFc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4103, 'output_tokens': 38, 'total_tokens': 4141, 'input_token_details': {'audio': 0, 'cache_read': 3712}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:36,371 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6Dsa5EpXUTGM9tRyWYj7JbYB', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-static/_config.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 4255, 'total_tokens': 4292, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4096}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b9743abe-04ff-4406-a895-c80b50bd2a75-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-static/_config.js'}, 'id': 'call_6Dsa5EpXUTGM9tRyWYj7JbYB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4255, 'output_tokens': 37, 'total_tokens': 4292, 'input_token_details': {'audio': 0, 'cache_read': 4096}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:37,427 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WOtLnxg9hHOP4fvByX3FIZqT', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-static/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 4350, 'total_tokens': 4388, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3584}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a13a384a-68c4-448d-8aeb-3fb83977f4d4-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-static/_config.js'}, 'id': 'call_WOtLnxg9hHOP4fvByX3FIZqT', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4350, 'output_tokens': 38, 'total_tokens': 4388, 'input_token_details': {'audio': 0, 'cache_read': 3584}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:38,594 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_sesubXWH5LWWzprIMeuYuXsa', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-dynamic"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 35, 'prompt_tokens': 4485, 'total_tokens': 4520, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b241ce90-d21d-432c-a57e-5210d472e4f6-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-dynamic'}, 'id': 'call_sesubXWH5LWWzprIMeuYuXsa', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4485, 'output_tokens': 35, 'total_tokens': 4520, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:39,702 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_SdnP5jiHe7BA6yRJht9jAOoj', 'function': {'arguments': '{"relative_path":"test/css/samples/omit-scoping-attribute-class-dynamic/input.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 4582, 'total_tokens': 4619, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9b77ee9a-df75-4cac-97da-7b658b9d4ab4-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/css/samples/omit-scoping-attribute-class-dynamic/input.html'}, 'id': 'call_SdnP5jiHe7BA6yRJht9jAOoj', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4582, 'output_tokens': 37, 'total_tokens': 4619, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:37:39,704 - thread-133013312636608.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - DEBUG - Graph recursion limit reached, returning empty context
2025-11-10 23:37:39,704 - thread-133013312636608.prometheus.lang_graph.nodes.bug_get_regression_tests_subgraph_node - INFO - Recursion limit reached, returning empty regression tests
2025-11-10 23:37:39,706 - thread-133013312636608.prometheus.lang_graph.nodes.issue_feature_context_message_node - DEBUG - Sending query to context provider:
Issue title:
using refs in css

Issue description: 
When I use a ref, I most often also want to get a handle to it with css, which leads to slightly annoying, duplicative markup.

```html
<style>
  .container {
    color: red
  }
</style>
<div class="container" ref:container></div>
```
 
The only solutions I can think of to mitigate this are untenable, but thought I raise this if others see something better.

- Make nodes with ids available as refs, like polymer's static node map
- Make svelte refs available as synthetic css selectors
- Make a syntax shortcut for declaring refs as classes, e.g. `<div ref:class:container ></div>`

Issue comments:


Find all relevant source code context and documentation needed to understand and implement this feature request.
Focus on production code (ignore test files) and follow these steps:
1. Identify similar existing features or components that this new feature should integrate with
2. Find relevant class definitions, interfaces, and API patterns used in the codebase
3. Locate related modules and services that the new feature will interact with
4. Include architectural patterns and code conventions used in similar implementations

Skip any test files

2025-11-10 23:37:39,707 - thread-133013312636608.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-10 23:37:39,709 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── getGlobals.ts
|   |           ├── getIntro.ts
|   |           ├── getOutro.ts
|   |           └── walkHtml.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getObject.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── reservedNames.ts
|   |   ├── spaces.ts
|   |   ├── stringify.ts
|   |   └── trim.ts
|   └── validate
|       ├── html
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── pass-no-options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-onrender
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
using refs in css

Issue description: 
When I use a ref, I most often also want to get a handle to it with css, which leads to slightly annoying, duplicative markup.

```html
<style>
  .container {
    color: red
  }
</style>
<div class="container" ref:container></div>
```
 
The only solutions I can think of to mitigate this are untenable, but thought I raise this if others see something better.

- Make nodes with ids available as refs, like polymer's static node map
- Make svelte refs available as synthetic css selectors
- Make a syntax shortcut for declaring refs as classes, e.g. `<div ref:class:container ></div>`

Issue comments:


Find all relevant source code context and documentation needed to understand and implement this feature request.
Focus on production code (ignore test files) and follow these steps:
1. Identify similar existing features or components that this new feature should integrate with
2. Find relevant class definitions, interfaces, and API patterns used in the codebase
3. Locate related modules and services that the new feature will interact with
4. Include architectural patterns and code conventions used in similar implementations

Skip any test files

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-10 23:38:00,076 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The file tree gives a high-level view but no code content. To identify how refs and CSS scoping currently work and where a new ref-as-selector feature should integrate, I need the actual implementations for directive parsing (refs), DOM/SSR code generation (ref handling), and CSS parsing/scoping. Documentation (README) may describe current ref/CSS conventions. Without these, I can’t map classes, interfaces, or architectural patterns.' query='Please provide the full contents of src/parse/read/directives.ts, src/parse/state/tag.ts, src/generators/dom/Block.ts, src/generators/dom/visit.ts, src/generators/server-side-rendering/visitors/Element.ts, src/css/Stylesheet.ts, src/css/Selector.ts, and README.md.' extra_requirements='If sending entire files is too large, include at minimum the functions/classes that parse and represent ref directives, apply refs in DOM/SSR generation, and implement CSS scoping and selector handling.' purpose='These files will reveal existing ref and CSS mechanisms, interfaces, and patterns needed to determine how to implement refs as CSS selectors or shortcuts and ensure architectural consistency.'
2025-11-10 23:38:00,078 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents of src/parse/read/directives.ts, src/parse/state/tag.ts, src/generators/dom/Block.ts, src/generators/dom/visit.ts, src/generators/server-side-rendering/visitors/Element.ts, src/css/Stylesheet.ts, src/css/Selector.ts, and README.md.
2025-11-10 23:38:03,294 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-10 23:38:03,295 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-10 23:38:03,295 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-10 23:38:03,295 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-10 23:38:03,296 - thread-133013312636608.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-10 23:38:03,298 - thread-133013312636608.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-10 23:38:03,298 - thread-133013312636608.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents of src/parse/read/directives.ts, src/parse/state/tag.ts, src/generators/dom/Block.ts, src/generators/dom/visit.ts, src/generators/server-side-rendering/visitors/Element.ts, src/css/Stylesheet.ts, src/css/Selector.ts, and README.md.
Extra requirements: If sending entire files is too large, include at minimum the functions/classes that parse and represent ref directives, apply refs in DOM/SSR generation, and implement CSS scoping and selector handling.
Purpose: These files will reveal existing ref and CSS mechanisms, interfaces, and patterns needed to determine how to implement refs as CSS selectors or shortcuts and ensure architectural consistency.
2025-11-10 23:38:06,896 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_042CV4CCKrtqi7Dt4ErsmyvF', 'function': {'arguments': '{"relative_path":"src/parse/read/directives.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 228, 'prompt_tokens': 2244, 'total_tokens': 2472, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8942121a-016f-4c9a-8c0c-e73a480717c4-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/parse/read/directives.ts'}, 'id': 'call_042CV4CCKrtqi7Dt4ErsmyvF', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2244, 'output_tokens': 228, 'total_tokens': 2472, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-10 23:38:12,599 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xLMG0gXNVMLSA6tYGRpl8lJu', 'function': {'arguments': '{"relative_path":"src/parse/state/tag.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 547, 'prompt_tokens': 4119, 'total_tokens': 4666, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--511478ca-ff97-40e4-bafd-31b04f26a4c8-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/parse/state/tag.ts'}, 'id': 'call_xLMG0gXNVMLSA6tYGRpl8lJu', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4119, 'output_tokens': 547, 'total_tokens': 4666, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-10 23:38:13,658 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VImG0WWiHd6o41zbSxQrSHcD', 'function': {'arguments': '{"relative_path":"src/generators/dom/Block.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 8518, 'total_tokens': 8549, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2740eab7-a20f-45e9-9417-347fbff7fe16-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/Block.ts'}, 'id': 'call_VImG0WWiHd6o41zbSxQrSHcD', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8518, 'output_tokens': 31, 'total_tokens': 8549, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:38:15,294 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_EGR3qpjWPS1JqtggKUccQObO', 'function': {'arguments': '{"relative_path":"src/generators/dom/visit.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 12869, 'total_tokens': 12900, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--69f8ed83-f74d-4df6-aab5-5a8b672ee548-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visit.ts'}, 'id': 'call_EGR3qpjWPS1JqtggKUccQObO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12869, 'output_tokens': 31, 'total_tokens': 12900, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:38:17,045 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3qEjpgUgGTU0M8f1hLJ3qpoQ', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/Element.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 13130, 'total_tokens': 13167, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--37c8bcf1-30af-43d7-80db-6af97d364407-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/Element.ts'}, 'id': 'call_3qEjpgUgGTU0M8f1hLJ3qpoQ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13130, 'output_tokens': 37, 'total_tokens': 13167, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:38:18,669 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ejWOBJoZCbCywWTJeKVany5m', 'function': {'arguments': '{"relative_path":"src/css/Stylesheet.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 14116, 'total_tokens': 14145, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c9769583-5ce2-4f04-a8eb-f74d4f599377-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/css/Stylesheet.ts'}, 'id': 'call_ejWOBJoZCbCywWTJeKVany5m', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14116, 'output_tokens': 29, 'total_tokens': 14145, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:38:19,998 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_7sl2MleW1OZUCIdXzieQqhaC', 'function': {'arguments': '{"relative_path":"src/css/Selector.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 18577, 'total_tokens': 18605, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12800}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f54caf12-1c92-4082-8277-a804d7f82272-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/css/Selector.ts'}, 'id': 'call_7sl2MleW1OZUCIdXzieQqhaC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18577, 'output_tokens': 28, 'total_tokens': 18605, 'input_token_details': {'audio': 0, 'cache_read': 12800}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:38:22,450 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ATMFq8mAwQ4fG9iKuCXh0eBh', 'function': {'arguments': '{"relative_path":"README.md"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 21936, 'total_tokens': 21961, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a180ae8a-81bf-408b-bc20-9aee28337a8f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'README.md'}, 'id': 'call_ATMFq8mAwQ4fG9iKuCXh0eBh', 'type': 'tool_call'}] usage_metadata={'input_tokens': 21936, 'output_tokens': 25, 'total_tokens': 21961, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:38:34,710 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content="I retrieved the full contents of all requested files: src/parse/read/directives.ts, src/parse/state/tag.ts, src/generators/dom/Block.ts, src/generators/dom/visit.ts, src/generators/server-side-rendering/visitors/Element.ts, src/css/Stylesheet.ts, src/css/Selector.ts, and README.md. The tag parsing shows how ref directives are represented (type 'Ref'), and the SSR Element visitor demonstrates CSS attribute injection for scoping. Stylesheet and Selector implement the CSS scoping/selector handling, including encapsulation via component-specific attributes and rules for global selectors. The DOM generator structure (Block and visit) is provided to understand where element visitors would apply refs during DOM generation." additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1185, 'prompt_tokens': 24027, 'total_tokens': 25212, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1024, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--4c791a35-5e99-46f3-aae2-eaeb3d9ac4dc-0' usage_metadata={'input_tokens': 24027, 'output_tokens': 1185, 'total_tokens': 25212, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1024}}
2025-11-10 23:38:34,714 - thread-133013312636608.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents of src/parse/read/directives.ts, src/parse/state/tag.ts, src/generators/dom/Block.ts, src/generators/dom/visit.ts, src/generators/server-side-rendering/visitors/Element.ts, src/css/Stylesheet.ts, src/css/Selector.ts, and README.md.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending entire files is too large, include at minimum the functions/classes that parse and represent ref directives, apply refs in DOM/SSR generation, and implement CSS scoping and selector handling.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These files will reveal existing ref and CSS mechanisms, interfaces, and patterns needed to determine how to implement refs as CSS selectors or shortcuts and ensure architectural consistency.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: README.md
Line number range: 1 - 100
Content:
1. # Svelte
2. 
3. The magical disappearing UI framework.
4. 
5. * [Read the introductory blog post](https://svelte.technology/blog/frameworks-without-the-framework/)
6. * [Read the guide](https://svelte.technology/guide)
7. * [Try it out](https://svelte.technology/repl)
8. * [Chat on Gitter](https://gitter.im/sveltejs/svelte)
9. 
10. ---
11. 
12. This is the Svelte compiler, which is primarily intended for authors of tooling that integrates Svelte with different build systems. If you just want to write Svelte components and use them in your app, you probably want one of those tools:
13. 
14. * [svelte-cli](https://github.com/sveltejs/svelte-cli) – Command line interface for compiling components
15. * [rollup-plugin-svelte](https://github.com/rollup/rollup-plugin-svelte) – Rollup plugin
16. * [sveltify](https://github.com/tehshrike/sveltify) - Browserify transform
17. * [gulp-svelte](https://github.com/shinnn/gulp-svelte) - gulp plugin
18. * [metalsmith-svelte](https://github.com/shinnn/metalsmith-svelte) - Metalsmith plugin
19. * [system-svelte](https://github.com/CanopyTax/system-svelte) – System.js loader
20. * [svelte-loader](https://github.com/sveltejs/svelte-loader) – Webpack loader
21. * [meteor-svelte](https://github.com/klaussner/meteor-svelte) – Meteor build plugin
22. * More to come!
23. 
24. 
25. ## Example usage
26. 
27. ```js
28. import * as svelte from 'svelte';
29. 
30. const { code, map } = svelte.compile( source, {
31. 	// the target module format – defaults to 'es' (ES2015 modules), can
32. 	// also be 'amd', 'cjs', 'umd', 'iife' or 'eval'
33. 	format: 'umd',
34. 
35. 	// the filename of the source file, used in e.g. generating sourcemaps
36. 	filename: 'MyComponent.html',
37. 
38. 	// the name of the constructor. Required for 'iife' and 'umd' output,
39. 	// but otherwise mostly useful for debugging. Defaults to 'SvelteComponent'
40. 	name: 'MyComponent',
41. 
42. 	// for 'amd' and 'umd' output, you can optionally specify an AMD module ID
43. 	amd: {
44. 		id: 'my-component'
45. 	},
46. 
47. 	// custom error/warning handlers. By default, errors will throw, and
48. 	// warnings will be printed to the console. Where applicable, the
49. 	// error/warning object will have `pos`, `loc` and `frame` properties
50. 	onerror: err => {
51. 		console.error( err.message );
52. 	},
53. 
54. 	onwarn: warning => {
55. 		console.warn( warning.message );
56. 	}
57. });
58. ```
59. 
60. 
61. ## API
62. 
63. The Svelte compiler exposes the following API:
64. 
65. * `compile( source [, options ] ) => { code, map, ast, css }` - Compile the component with the given options (see below). Returns an object containing the compiled JavaScript, a sourcemap, an AST and transformed CSS.
66. * `create( source [, options ] ) => function` - Compile the component and return the component itself.
67. * `VERSION` - The version of this copy of the Svelte compiler as a string, `'x.x.x'`.
68. 
69. ### Options
70. 
71. The Svelte compiler optionally takes a second argument, an object of configuration options:
72. 
73. | | **Values** | **Description** | **Defaults** |
74. |---|---|---|---|
75. | `format` | `'es'`, `'amd'`, `'cjs'`, `'umd'`, `'iife'`, `'eval'` | The format to output in the compiled component.<br>`'es'` - ES6/ES2015 module, suitable for consumption by a bundler<br>`'amd'` - AMD module<br>`'cjs'` - CommonJS module<br>`'iife'` - IIFE-wrapped function defining a global variable, suitable for use directly in browser<br>`'eval'` - standalone function, suitable for passing to `eval()` | `'es'` for `generate: 'dom'`<br>`'cjs'` for `generate: 'ssr'` |
76. | `generate` | `'dom'`, `'ssr'` | Whether to generate JavaScript code intended for use on the client (`'dom'`), or for use in server-side rendering (`'ssr'`). | `'dom'` |
77. | `name` | `string` | The name of the constructor in the compiled component. | `'SvelteComponent'` |
78. | `filename` | `string` | The filename to use in sourcemaps and compiler error and warning messages. | `'SvelteComponent.html'` |
79. | `amd`.`id` | `string` | The AMD module ID to use for the `'amd'` and `'umd'` output formats. | `undefined` |
80. | `cascade` | `true`, `false` | Whether to cascade all of the component's styles to child components. If `false`, only selectors wrapped in `:global(...)` and keyframe IDs beginning with `-global-` are cascaded. | `true` |
81. | `shared` | `true`, `false`, `string` | Whether to import various helpers from a shared external library. When you have a project with multiple components, this reduces the overall size of your JavaScript bundle, at the expense of having immediately-usable component. You can pass a string of the module path to use, or `true` will import from `'svelte/shared.js'`. | `false` |
82. | `dev` | `true`, `false` | Whether to enable run-time checks in the compiled component. These are helpful during development, but slow your component down. | `false` |
83. | `css` | `true`, `false` | Whether to include code to inject your component's styles into the DOM. | `true` |
84. | `globals` | `object`, `function` | When outputting to the `'umd'`, `'iife'` or `'eval'` formats, an object or function mapping the names of imported dependencies to the names of global variables. | `{}` |
85. | `onerror` | `function` | Specify a callback for when Svelte encounters an error while compiling the component. | (exception is thrown) |
86. | `onwarn` | `function` | Specify a callback for when Svelte encounters a non-fatal warning while compiling the component. | (warning is logged to console) |
87. 
88. ## Example/starter repos
89. 
90. * [charpeni/svelte-example](https://github.com/charpeni/svelte-example) - Some Svelte examples with configured Rollup, Babel, ESLint, directives, Two-Way binding, and nested components
91. * [EmilTholin/svelte-test](https://github.com/EmilTholin/svelte-test)
92. * [lukechinworth/codenames](https://github.com/lukechinworth/codenames/tree/svelte) – example integration with Redux
93. 
94. ## BrowserStack
95. <img src="https://cdn.worldvectorlogo.com/logos/browserstack.svg" height="80" width="80" align="left">
96. <p>To keep Svelte's performance in check, we use BrowserStack to quickly run benchmarks for each PR that immediately give feedback to the contributor. You can see how we use BrowserStack in the <a href="https://github.com/sveltejs/svelte-bench">svelte-bench</a> project and check out BrowserStack's services on their <a href="https://www.browserstack.com/">website</a>.</p>
97. 
98. ## License
99. 
100. [MIT](LICENSE)


File: src/css/Selector.ts
Line number range: 1 - 266
Content:
1. import MagicString from 'magic-string';
2. import { gatherPossibleValues, UNKNOWN } from './gatherPossibleValues';
3. import { Validator } from '../validate/index';
4. import { Node } from '../interfaces';
5. 
6. export default class Selector {
7. 	node: Node;
8. 	blocks: Block[];
9. 	localBlocks: Block[];
10. 	used: boolean;
11. 
12. 	constructor(node: Node) {
13. 		this.node = node;
14. 
15. 		this.blocks = groupSelectors(node);
16. 
17. 		// take trailing :global(...) selectors out of consideration
18. 		let i = this.blocks.length;
19. 		while (i > 0) {
20. 			if (!this.blocks[i - 1].global) break;
21. 			i -= 1;
22. 		}
23. 
24. 		this.localBlocks = this.blocks.slice(0, i);
25. 		this.used = this.blocks[0].global;
26. 	}
27. 
28. 	apply(node: Node, stack: Node[]) {
29. 		const applies = selectorAppliesTo(this.localBlocks.slice(), node, stack.slice());
30. 
31. 		if (applies) {
32. 			this.used = true;
33. 
34. 			// add svelte-123xyz attribute to outermost and innermost
35. 			// elements — no need to add it to intermediate elements
36. 			node._needsCssAttribute = true;
37. 			if (stack[0] && this.node.children.find(isDescendantSelector)) stack[0]._needsCssAttribute = true;
38. 		}
39. 	}
40. 
41. 	minify(code: MagicString) {
42. 		let c: number = null;
43. 		this.blocks.forEach((block, i) => {
44. 			if (i > 0) {
45. 				if (block.start - c > 1) {
46. 					code.overwrite(c, block.start, block.combinator.name || ' ');
47. 				}
48. 			}
49. 
50. 			c = block.end;
51. 		});
52. 	}
53. 
54. 	transform(code: MagicString, attr: string) {
55. 		function encapsulateBlock(block: Block) {
56. 			let i = block.selectors.length;
57. 			while (i--) {
58. 				const selector = block.selectors[i];
59. 				if (selector.type === 'PseudoElementSelector' || selector.type === 'PseudoClassSelector') continue;
60. 
61. 				if (selector.type === 'TypeSelector' && selector.name === '*') {
62. 					code.overwrite(selector.start, selector.end, attr);
63. 				} else {
64. 					code.appendLeft(selector.end, attr);
65. 				}
66. 
67. 				return;
68. 			}
69. 		}
70. 
71. 		this.blocks.forEach((block, i) => {
72. 			if (block.global) {
73. 				const selector = block.selectors[0];
74. 				const first = selector.children[0];
75. 				const last = selector.children[selector.children.length - 1];
76. 				code.remove(selector.start, first.start).remove(last.end, selector.end);
77. 			} else if (i === 0 || i === this.blocks.length - 1) {
78. 				encapsulateBlock(block);
79. 			}
80. 		});
81. 	}
82. 
83. 	validate(validator: Validator) {
84. 		this.blocks.forEach((block) => {
85. 			let i = block.selectors.length;
86. 			while (i-- > 1) {
87. 				const selector = block.selectors[i];
88. 				if (selector.type === 'PseudoClassSelector' && selector.name === 'global') {
89. 					validator.error(`:global(...) must be the first element in a compound selector`, selector.start);
90. 				}
91. 			}
92. 		});
93. 
94. 		let start = 0;
95. 		let end = this.blocks.length;
96. 
97. 		for (; start < end; start += 1) {
98. 			if (!this.blocks[start].global) break;
99. 		}
100. 
101. 		for (; end > start; end -= 1) {
102. 			if (!this.blocks[end - 1].global) break;
103. 		}
104. 
105. 		for (let i = start; i < end; i += 1) {
106. 			if (this.blocks[i].global) {
107. 				validator.error(`:global(...) can be at the start or end of a selector sequence, but not in the middle`, this.blocks[i].selectors[0].start);
108. 			}
109. 		}
110. 	}
111. }
112. 
113. function isDescendantSelector(selector: Node) {
114. 	return selector.type === 'WhiteSpace' || selector.type === 'Combinator';
115. }
116. 
117. function selectorAppliesTo(blocks: Block[], node: Node, stack: Node[]): boolean {
118. 	const block = blocks.pop();
119. 	if (!block) return false;
120. 
121. 	if (!node) {
122. 		return blocks.every(block => block.global);
123. 	}
124. 
125. 	let i = block.selectors.length;
126. 	let j = stack.length;
127. 
128. 	while (i--) {
129. 		const selector = block.selectors[i];
130. 
131. 		if (selector.type === 'PseudoClassSelector' && selector.name === 'global') {
132. 			// TODO shouldn't see this here... maybe we should enforce that :global(...)
133. 			// cannot be sandwiched between non-global selectors?
134. 			return false;
135. 		}
136. 
137. 		if (selector.type === 'PseudoClassSelector' || selector.type === 'PseudoElementSelector') {
138. 			continue;
139. 		}
140. 
141. 		if (selector.type === 'ClassSelector') {
142. 			if (!attributeMatches(node, 'class', selector.name, '~=', false)) return false;
143. 		}
144. 
145. 		else if (selector.type === 'IdSelector') {
146. 			if (!attributeMatches(node, 'id', selector.name, '=', false)) return false;
147. 		}
148. 
149. 		else if (selector.type === 'AttributeSelector') {
150. 			if (!attributeMatches(node, selector.name.name, selector.value && unquote(selector.value.value), selector.operator, selector.flags)) return false;
151. 		}
152. 
153. 		else if (selector.type === 'TypeSelector') {
154. 			if (node.name !== selector.name && selector.name !== '*') return false;
155. 		}
156. 
157. 		else {
158. 			// bail. TODO figure out what these could be
159. 			return true;
160. 		}
161. 	}
162. 
163. 	if (block.combinator) {
164. 		if (block.combinator.type === 'WhiteSpace') {
165. 			while (stack.length) {
166. 				if (selectorAppliesTo(blocks.slice(), stack.pop(), stack)) {
167. 					return true;
168. 				}
169. 			}
170. 
171. 			return false;
172. 		} else if (block.combinator.name === '>') {
173. 			return selectorAppliesTo(blocks, stack.pop(), stack);
174. 		}
175. 
176. 		// TODO other combinators
177. 		return true;
178. 	}
179. 
180. 	return true;
181. }
182. 
183. const operators = {
184. 	'=' : (value: string, flags: string) => new RegExp(`^${value}$`, flags),
185. 	'~=': (value: string, flags: string) => new RegExp(`\\b${value}\\b`, flags),
186. 	'|=': (value: string, flags: string) => new RegExp(`^${value}(-.+)?$`, flags),
187. 	'^=': (value: string, flags: string) => new RegExp(`^${value}`, flags),
188. 	'$=': (value: string, flags: string) => new RegExp(`${value}$`, flags),
189. 	'*=': (value: string, flags: string) => new RegExp(value, flags)
190. };
191. 
192. function attributeMatches(node: Node, name: string, expectedValue: string, operator: string, caseInsensitive: boolean) {
193. 	const attr = node.attributes.find((attr: Node) => attr.name === name);
194. 	if (!attr) return false;
195. 	if (attr.value === true) return operator === null;
196. 	if (attr.value.length > 1) return true;
197. 
198. 	const pattern = operators[operator](expectedValue, caseInsensitive ? 'i' : '');
199. 	const value = attr.value[0];
200. 
201. 	if (value.type === 'Text') return pattern.test(value.data);
202. 
203. 	const possibleValues = new Set();
204. 	gatherPossibleValues(value.expression, possibleValues);
205. 	if (possibleValues.has(UNKNOWN)) return true;
206. 
207. 	for (const x of Array.from(possibleValues)) { // TypeScript for-of is slightly unlike JS
208. 		if (pattern.test(x)) return true;
209. 	}
210. 
211. 	return false;
212. }
213. 
214. function isDynamic(value: Node) {
215. 	return value.length > 1 || value[0].type !== 'Text';
216. }
217. 
218. function unquote(str: string) {
219. 	if (str[0] === str[str.length - 1] && str[0] === "'" || str[0] === '"') {
220. 		return str.slice(1, str.length - 1);
221. 	}
222. }
223. 
224. class Block {
225. 	global: boolean;
226. 	combinator: Node;
227. 	selectors: Node[]
228. 	start: number;
229. 	end: number;
230. 
231. 	constructor(combinator: Node) {
232. 		this.combinator = combinator;
233. 		this.global = false;
234. 		this.selectors = [];
235. 
236. 		this.start = null;
237. 		this.end = null;
238. 	}
239. 
240. 	add(selector: Node) {
241. 		if (this.selectors.length === 0) {
242. 			this.start = selector.start;
243. 			this.global = selector.type === 'PseudoClassSelector' && selector.name === 'global';
244. 		}
245. 
246. 		this.selectors.push(selector);
247. 		this.end = selector.end;
248. 	}
249. }
250. 
251. function groupSelectors(selector: Node) {
252. 	let block: Block = new Block(null);
253. 
254. 	const blocks = [block];
255. 
256. 	selector.children.forEach((child: Node, i: number) => {
257. 		if (child.type === 'WhiteSpace' || child.type === 'Combinator') {
258. 			block = new Block(child);
259. 			blocks.push(block);
260. 		} else {
261. 			block.add(child);
262. 		}
263. 	});
264. 
265. 	return blocks;
266. }


File: src/css/Stylesheet.ts
Line number range: 1 - 362
Content:
1. import MagicString from 'magic-string';
2. import { walk } from 'estree-walker';
3. import { getLocator } from 'locate-character';
4. import Selector from './Selector';
5. import getCodeFrame from '../utils/getCodeFrame';
6. import { Validator } from '../validate/index';
7. import { Node, Parsed, Warning } from '../interfaces';
8. 
9. class Rule {
10. 	selectors: Selector[];
11. 	declarations: Declaration[];
12. 	node: Node;
13. 	parent: Atrule;
14. 
15. 	constructor(node: Node, parent: Atrule) {
16. 		this.node = node;
17. 		this.parent = parent;
18. 		this.selectors = node.selector.children.map((node: Node) => new Selector(node));
19. 		this.declarations = node.block.children.map((node: Node) => new Declaration(node));
20. 
21. 		if (parent) parent.rules.push(this);
22. 	}
23. 
24. 	apply(node: Node, stack: Node[]) {
25. 		this.selectors.forEach(selector => selector.apply(node, stack)); // TODO move the logic in here?
26. 	}
27. 
28. 	isUsed() {
29. 		if (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;
30. 		return this.selectors.some(s => s.used);
31. 	}
32. 
33. 	minify(code: MagicString, cascade: boolean) {
34. 		let c = this.node.start;
35. 		this.selectors.forEach((selector, i) => {
36. 			if (cascade || selector.used) {
37. 				const separator = i > 0 ? ',' : '';
38. 				if ((selector.node.start - c) > separator.length) {
39. 					code.overwrite(c, selector.node.start, separator);
40. 				}
41. 
42. 				selector.minify(code);
43. 				c = selector.node.end;
44. 			}
45. 		});
46. 
47. 		code.remove(c, this.node.block.start);
48. 
49. 		c = this.node.block.start + 1;
50. 		this.declarations.forEach((declaration, i) => {
51. 			const separator = i > 0 ? ';' : '';
52. 			if ((declaration.node.start - c) > separator.length) {
53. 				code.overwrite(c, declaration.node.start, separator);
54. 			}
55. 
56. 			declaration.minify(code);
57. 
58. 			c = declaration.node.end;
59. 		});
60. 
61. 		code.remove(c, this.node.block.end - 1);
62. 	}
63. 
64. 	transform(code: MagicString, id: string, keyframes: Map<string, string>, cascade: boolean) {
65. 		if (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;
66. 
67. 		const attr = `[${id}]`;
68. 
69. 		if (cascade) {
70. 			this.selectors.forEach(selector => {
71. 				// TODO disable cascading (without :global(...)) in v2
72. 				const { start, end, children } = selector.node;
73. 
74. 				const css = code.original;
75. 				const selectorString = css.slice(start, end);
76. 
77. 				const firstToken = children[0];
78. 
79. 				let transformed;
80. 
81. 				if (firstToken.type === 'TypeSelector') {
82. 					const insert = firstToken.end;
83. 					const head = firstToken.name === '*' ? '' : css.slice(start, insert);
84. 					const tail = css.slice(insert, end);
85. 
86. 					transformed = `${head}${attr}${tail},${attr} ${selectorString}`;
87. 				} else {
88. 					transformed = `${attr}${selectorString},${attr} ${selectorString}`;
89. 				}
90. 
91. 				code.overwrite(start, end, transformed);
92. 			});
93. 		} else {
94. 			this.selectors.forEach(selector => selector.transform(code, attr));
95. 		}
96. 
97. 		this.declarations.forEach(declaration => declaration.transform(code, keyframes));
98. 	}
99. }
100. 
101. class Declaration {
102. 	node: Node;
103. 
104. 	constructor(node: Node) {
105. 		this.node = node;
106. 	}
107. 
108. 	transform(code: MagicString, keyframes: Map<string, string>) {
109. 		const property = this.node.property.toLowerCase();
110. 		if (property === 'animation' || property === 'animation-name') {
111. 			this.node.value.children.forEach((block: Node) => {
112. 				if (block.type === 'Identifier') {
113. 					const name = block.name;
114. 					if (keyframes.has(name)) {
115. 						code.overwrite(block.start, block.end, keyframes.get(name));
116. 					}
117. 				}
118. 			});
119. 		}
120. 	}
121. 
122. 	minify(code: MagicString) {
123. 		const c = this.node.start + this.node.property.length;
124. 		const first = this.node.value.children[0];
125. 
126. 		if (first.start - c > 1) {
127. 			code.overwrite(c, first.start, ':');
128. 		}
129. 	}
130. }
131. 
132. class Atrule {
133. 	node: Node;
134. 	rules: Rule[];
135. 
136. 	constructor(node: Node) {
137. 		this.node = node;
138. 		this.rules = [];
139. 	}
140. 
141. 	isUsed() {
142. 		return true; // TODO
143. 	}
144. 
145. 	minify(code: MagicString, cascade: boolean) {
146. 		if (this.node.name === 'media') {
147. 			let c = this.node.start + 6;
148. 			if (this.node.expression.start > c) code.remove(c, this.node.expression.start);
149. 
150. 			this.node.expression.children.forEach((query: Node) => {
151. 				// TODO minify queries
152. 				c = query.end;
153. 			});
154. 
155. 			code.remove(c, this.node.block.start);
156. 		} else if (this.node.name === 'keyframes') {
157. 			let c = this.node.start + 10;
158. 			if (this.node.expression.start - c > 1) code.overwrite(c, this.node.expression.start, ' ');
159. 			c = this.node.expression.end;
160. 			if (this.node.block.start - c > 0) code.remove(c, this.node.block.start);
161. 		}
162. 
163. 		// TODO other atrules
164. 
165. 		if (this.node.block) {
166. 			let c = this.node.block.start + 1;
167. 
168. 			this.rules.forEach(rule => {
169. 				if (cascade || rule.isUsed()) {
170. 					code.remove(c, rule.node.start);
171. 					rule.minify(code, cascade);
172. 					c = rule.node.end;
173. 				}
174. 			});
175. 
176. 			code.remove(c, this.node.block.end - 1);
177. 		}
178. 	}
179. 
180. 	transform(code: MagicString, id: string, keyframes: Map<string, string>) {
181. 		if (this.node.name !== 'keyframes') return;
182. 
183. 		this.node.expression.children.forEach((expression: Node) => {
184. 			if (expression.type === 'Identifier') {
185. 				if (expression.name.startsWith('-global-')) {
186. 					code.remove(expression.start, expression.start + 8);
187. 				} else {
188. 					const newName = `${id}-${expression.name}`;
189. 					code.overwrite(expression.start, expression.end, newName);
190. 					keyframes.set(expression.name, newName);
191. 				}
192. 			}
193. 		});
194. 	}
195. }
196. 
197. const keys = {};
198. 
199. export default class Stylesheet {
200. 	source: string;
201. 	parsed: Parsed;
202. 	cascade: boolean;
203. 	filename: string;
204. 
205. 	hasStyles: boolean;
206. 	id: string;
207. 
208. 	nodes: (Rule|Atrule)[];
209. 	rules: Rule[];
210. 	atrules: Atrule[];
211. 
212. 	constructor(source: string, parsed: Parsed, filename: string, cascade: boolean) {
213. 		this.source = source;
214. 		this.parsed = parsed;
215. 		this.cascade = cascade;
216. 		this.filename = filename;
217. 
218. 		this.id = `svelte-${parsed.hash}`;
219. 
220. 		this.nodes = [];
221. 		this.rules = [];
222. 		this.atrules = [];
223. 
224. 		if (parsed.css && parsed.css.children.length) {
225. 			this.hasStyles = true;
226. 
227. 			const stack: Atrule[] = [];
228. 			let currentAtrule: Atrule = null;
229. 
230. 			walk(this.parsed.css, {
231. 				enter: (node: Node) => {
232. 					if (node.type === 'Atrule') {
233. 						const atrule = currentAtrule = new Atrule(node);
234. 						stack.push(atrule);
235. 
236. 						this.nodes.push(atrule);
237. 						this.atrules.push(atrule);
238. 					}
239. 
240. 					if (node.type === 'Rule') {
241. 						// TODO this is a bit confusing. Don't have a separate
242. 						// array of rules, just transform top-level nodes and
243. 						// let them worry about their children
244. 						const rule = new Rule(node, currentAtrule);
245. 
246. 						this.rules.push(rule);
247. 
248. 						if (!currentAtrule) {
249. 							this.nodes.push(rule);
250. 						}
251. 					}
252. 				},
253. 
254. 				leave: (node: Node) => {
255. 					if (node.type === 'Atrule') {
256. 						stack.pop();
257. 						currentAtrule = stack[stack.length - 1];
258. 					}
259. 				}
260. 			});
261. 		} else {
262. 			this.hasStyles = false;
263. 		}
264. 	}
265. 
266. 	apply(node: Node, stack: Node[]) {
267. 		if (!this.hasStyles) return;
268. 
269. 		if (this.cascade) {
270. 			if (stack.length === 0) node._needsCssAttribute = true;
271. 			return;
272. 		}
273. 
274. 		for (let i = 0; i < this.rules.length; i += 1) {
275. 			const rule = this.rules[i];
276. 			rule.apply(node, stack);
277. 		}
278. 	}
279. 
280. 	render(cssOutputFilename: string) {
281. 		if (!this.hasStyles) {
282. 			return { css: null, cssMap: null };
283. 		}
284. 
285. 		const code = new MagicString(this.source);
286. 
287. 		walk(this.parsed.css, {
288. 			enter: (node: Node) => {
289. 				code.addSourcemapLocation(node.start);
290. 				code.addSourcemapLocation(node.end);
291. 			}
292. 		});
293. 
294. 		// TODO all transform/minify in single pass. The mutation of
295. 		// `keyframes` here is confusing
296. 		const keyframes = new Map();
297. 		this.atrules.forEach((atrule: Atrule) => {
298. 			atrule.transform(code, this.id, keyframes);
299. 		});
300. 
301. 		this.rules.forEach((rule: Rule) => {
302. 			rule.transform(code, this.id, keyframes, this.cascade);
303. 		});
304. 
305. 		let c = 0;
306. 		this.nodes.forEach(node => {
307. 			if (this.cascade || node.isUsed()) {
308. 				code.remove(c, node.node.start);
309. 				node.minify(code, this.cascade);
310. 				c = node.node.end;
311. 			}
312. 		});
313. 
314. 		code.remove(c, this.source.length);
315. 
316. 		return {
317. 			css: code.toString(),
318. 			cssMap: code.generateMap({
319. 				includeContent: true,
320. 				source: this.filename,
321. 				file: cssOutputFilename
322. 			})
323. 		};
324. 	}
325. 
326. 	validate(validator: Validator) {
327. 		this.rules.forEach(rule => {
328. 			rule.selectors.forEach(selector => {
329. 				selector.validate(validator);
330. 			});
331. 		});
332. 	}
333. 
334. 	warnOnUnusedSelectors(onwarn: (warning: Warning) => void) {
335. 		if (this.cascade) return;
336. 
337. 		let locator;
338. 
339. 		this.rules.forEach((rule: Rule) => {
340. 			rule.selectors.forEach(selector => {
341. 				if (!selector.used) {
342. 					const pos = selector.node.start;
343. 
344. 					if (!locator) locator = getLocator(this.source);
345. 					const { line, column } = locator(pos);
346. 
347. 					const frame = getCodeFrame(this.source, line, column);
348. 					const message = `Unused CSS selector`;
349. 
350. 					onwarn({
351. 						message,
352. 						frame,
353. 						loc: { line: line + 1, column },
354. 						pos,
355. 						filename: this.filename,
356. 						toString: () => `${message} (${line + 1}:${column})\n${frame}`,
357. 					});
358. 				}
359. 			});
360. 		});
361. 	}
362. }


File: src/generators/dom/Block.ts
Line number range: 1 - 362
Content:
1. import CodeBuilder from '../../utils/CodeBuilder';
2. import deindent from '../../utils/deindent';
3. import { DomGenerator } from './index';
4. import { Node } from '../../interfaces';
5. import shared from './shared';
6. 
7. export interface BlockOptions {
8. 	name: string;
9. 	generator?: DomGenerator;
10. 	expression?: Node;
11. 	context?: string;
12. 	key?: string;
13. 	contexts?: Map<string, string>;
14. 	indexes?: Map<string, string>;
15. 	contextDependencies?: Map<string, string[]>;
16. 	params?: string[];
17. 	indexNames?: Map<string, string>;
18. 	listNames?: Map<string, string>;
19. 	indexName?: string;
20. 	listName?: string;
21. 	dependencies?: Set<string>;
22. }
23. 
24. export default class Block {
25. 	generator: DomGenerator;
26. 	name: string;
27. 	expression: Node;
28. 	context: string;
29. 
30. 	key: string;
31. 	first: string;
32. 
33. 	contexts: Map<string, string>;
34. 	indexes: Map<string, string>;
35. 	contextDependencies: Map<string, string[]>;
36. 	dependencies: Set<string>;
37. 	params: string[];
38. 	indexNames: Map<string, string>;
39. 	listNames: Map<string, string>;
40. 	indexName: string;
41. 	listName: string;
42. 
43. 	builders: {
44. 		init: CodeBuilder;
45. 		create: CodeBuilder;
46. 		claim: CodeBuilder;
47. 		hydrate: CodeBuilder;
48. 		mount: CodeBuilder;
49. 		intro: CodeBuilder;
50. 		update: CodeBuilder;
51. 		outro: CodeBuilder;
52. 		unmount: CodeBuilder;
53. 		detachRaw: CodeBuilder;
54. 		destroy: CodeBuilder;
55. 	};
56. 
57. 	hasIntroMethod: boolean;
58. 	hasOutroMethod: boolean;
59. 	outros: number;
60. 
61. 	aliases: Map<string, string>;
62. 	variables: Map<string, string>;
63. 	getUniqueName: (name: string) => string;
64. 
65. 	hasUpdateMethod: boolean;
66. 	autofocus: string;
67. 
68. 	constructor(options: BlockOptions) {
69. 		this.generator = options.generator;
70. 		this.name = options.name;
71. 		this.expression = options.expression;
72. 		this.context = options.context;
73. 
74. 		// for keyed each blocks
75. 		this.key = options.key;
76. 		this.first = null;
77. 
78. 		this.contexts = options.contexts;
79. 		this.indexes = options.indexes;
80. 		this.contextDependencies = options.contextDependencies;
81. 		this.dependencies = new Set();
82. 
83. 		this.params = options.params;
84. 		this.indexNames = options.indexNames;
85. 		this.listNames = options.listNames;
86. 
87. 		this.listName = options.listName;
88. 
89. 		this.builders = {
90. 			init: new CodeBuilder(),
91. 			create: new CodeBuilder(),
92. 			claim: new CodeBuilder(),
93. 			hydrate: new CodeBuilder(),
94. 			mount: new CodeBuilder(),
95. 			intro: new CodeBuilder(),
96. 			update: new CodeBuilder(),
97. 			outro: new CodeBuilder(),
98. 			unmount: new CodeBuilder(),
99. 			detachRaw: new CodeBuilder(),
100. 			destroy: new CodeBuilder(),
101. 		};
102. 
103. 		this.hasIntroMethod = false; // a block could have an intro method but not intro transitions, e.g. if a sibling block has intros
104. 		this.hasOutroMethod = false;
105. 		this.outros = 0;
106. 
107. 		this.aliases = new Map();
108. 		this.variables = new Map();
109. 		this.getUniqueName = this.generator.getUniqueNameMaker(options.params);
110. 
111. 		this.hasUpdateMethod = false; // determined later
112. 	}
113. 
114. 	addDependencies(dependencies: string[]) {
115. 		dependencies.forEach(dependency => {
116. 			this.dependencies.add(dependency);
117. 		});
118. 	}
119. 
120. 	addElement(
121. 		name: string,
122. 		renderStatement: string,
123. 		claimStatement: string,
124. 		parentNode: string,
125. 		needsIdentifier = false
126. 	) {
127. 		const isToplevel = !parentNode;
128. 
129. 		this.addVariable(name);
130. 		this.builders.create.addLine(`${name} = ${renderStatement};`);
131. 		this.builders.claim.addLine(`${name} = ${claimStatement};`);
132. 
133. 		this.mount(name, parentNode);
134. 
135. 		if (isToplevel) {
136. 			this.builders.unmount.addLine(`@detachNode( ${name} );`);
137. 		}
138. 	}
139. 
140. 	addVariable(name: string, init?: string) {
141. 		if (this.variables.has(name) && this.variables.get(name) !== init) {
142. 			throw new Error(
143. 				`Variable '${name}' already initialised with a different value`
144. 			);
145. 		}
146. 
147. 		this.variables.set(name, init);
148. 	}
149. 
150. 	alias(name: string) {
151. 		if (!this.aliases.has(name)) {
152. 			this.aliases.set(name, this.getUniqueName(name));
153. 		}
154. 
155. 		return this.aliases.get(name);
156. 	}
157. 
158. 	child(options: BlockOptions) {
159. 		return new Block(Object.assign({}, this, options, { parent: this }));
160. 	}
161. 
162. 	contextualise(expression: Node, context?: string, isEventHandler?: boolean) {
163. 		return this.generator.contextualise(
164. 			this,
165. 			expression,
166. 			context,
167. 			isEventHandler
168. 		);
169. 	}
170. 
171. 	findDependencies(expression: Node) {
172. 		return this.generator.findDependencies(
173. 			this.contextDependencies,
174. 			this.indexes,
175. 			expression
176. 		);
177. 	}
178. 
179. 	mount(name: string, parentNode: string) {
180. 		if (parentNode) {
181. 			this.builders.mount.addLine(`@appendNode( ${name}, ${parentNode} );`);
182. 		} else {
183. 			this.builders.mount.addLine(`@insertNode( ${name}, #target, anchor );`);
184. 		}
185. 	}
186. 
187. 	render() {
188. 		let introing;
189. 		const hasIntros = !this.builders.intro.isEmpty();
190. 		if (hasIntros) {
191. 			introing = this.getUniqueName('introing');
192. 			this.addVariable(introing);
193. 		}
194. 
195. 		let outroing;
196. 		const hasOutros = !this.builders.outro.isEmpty();
197. 		if (hasOutros) {
198. 			outroing = this.getUniqueName('outroing');
199. 			this.addVariable(outroing);
200. 		}
201. 
202. 		if (this.autofocus) {
203. 			this.builders.mount.addLine(`${this.autofocus}.focus();`);
204. 		}
205. 
206. 		// minor hack – we need to ensure that any {{{triples}}} are detached first
207. 		this.builders.unmount.addBlockAtStart(this.builders.detachRaw);
208. 
209. 		const properties = new CodeBuilder();
210. 
211. 		let localKey;
212. 		if (this.key) {
213. 			localKey = this.getUniqueName('key');
214. 			properties.addBlock(`key: ${localKey},`);
215. 		}
216. 
217. 		if (this.first) {
218. 			properties.addBlock(`first: null,`);
219. 			this.builders.hydrate.addLine(`this.first = ${this.first};`);
220. 		}
221. 
222. 		if (this.builders.create.isEmpty()) {
223. 			properties.addBlock(`create: @noop,`);
224. 		} else {
225. 			properties.addBlock(deindent`
226. 				create: function () {
227. 					${this.builders.create}
228. 					${!this.builders.hydrate.isEmpty() && `this.hydrate();`}
229. 				},
230. 			`);
231. 		}
232. 
233. 		if (this.generator.hydratable) {
234. 			if (this.builders.claim.isEmpty()) {
235. 				properties.addBlock(`claim: @noop,`);
236. 			} else {
237. 				properties.addBlock(deindent`
238. 					claim: function ( nodes ) {
239. 						${this.builders.claim}
240. 						${!this.builders.hydrate.isEmpty() && `this.hydrate();`}
241. 					},
242. 				`);
243. 			}
244. 		}
245. 
246. 		if (!this.builders.hydrate.isEmpty()) {
247. 			properties.addBlock(deindent`
248. 				hydrate: function ( nodes ) {
249. 					${this.builders.hydrate}
250. 				},
251. 			`);
252. 		}
253. 
254. 		if (this.builders.mount.isEmpty()) {
255. 			properties.addBlock(`mount: @noop,`);
256. 		} else {
257. 			properties.addBlock(deindent`
258. 				mount: function ( #target, anchor ) {
259. 					${this.builders.mount}
260. 				},
261. 			`);
262. 		}
263. 
264. 		if (this.hasUpdateMethod) {
265. 			if (this.builders.update.isEmpty()) {
266. 				properties.addBlock(`update: @noop,`);
267. 			} else {
268. 				properties.addBlock(deindent`
269. 					update: function ( changed, ${this.params.join(', ')} ) {
270. 						${this.builders.update}
271. 					},
272. 				`);
273. 			}
274. 		}
275. 
276. 		if (this.hasIntroMethod) {
277. 			if (hasIntros) {
278. 				properties.addBlock(deindent`
279. 					intro: function ( #target, anchor ) {
280. 						if ( ${introing} ) return;
281. 						${introing} = true;
282. 						${hasOutros && `${outroing} = false;`}
283. 
284. 						${this.builders.intro}
285. 
286. 						this.mount( #target, anchor );
287. 					},
288. 				`);
289. 			} else {
290. 				properties.addBlock(deindent`
291. 					intro: function ( #target, anchor ) {
292. 						this.mount( #target, anchor );
293. 					},
294. 				`);
295. 			}
296. 		}
297. 
298. 		if (this.hasOutroMethod) {
299. 			if (hasOutros) {
300. 				properties.addBlock(deindent`
301. 					outro: function ( ${this.alias('outrocallback')} ) {
302. 						if ( ${outroing} ) return;
303. 						${outroing} = true;
304. 						${hasIntros && `${introing} = false;`}
305. 
306. 						var ${this.alias('outros')} = ${this.outros};
307. 
308. 						${this.builders.outro}
309. 					},
310. 				`);
311. 			} else {
312. 				properties.addBlock(deindent`
313. 					outro: function ( outrocallback ) {
314. 						outrocallback();
315. 					},
316. 				`);
317. 			}
318. 		}
319. 
320. 		if (this.builders.unmount.isEmpty()) {
321. 			properties.addBlock(`unmount: @noop,`);
322. 		} else {
323. 			properties.addBlock(deindent`
324. 				unmount: function () {
325. 					${this.builders.unmount}
326. 				},
327. 			`);
328. 		}
329. 
330. 		if (this.builders.destroy.isEmpty()) {
331. 			properties.addBlock(`destroy: @noop`);
332. 		} else {
333. 			properties.addBlock(deindent`
334. 				destroy: function () {
335. 					${this.builders.destroy}
336. 				}
337. 			`);
338. 		}
339. 
340. 		return deindent`
341. 			function ${this.name} ( ${this.params.join(', ')}, #component${this.key
342. 			? `, ${localKey}`
343. 			: ''} ) {
344. 				${this.variables.size > 0 &&
345. 					`var ${Array.from(this.variables.keys())
346. 						.map(key => {
347. 							const init = this.variables.get(key);
348. 							return init !== undefined ? `${key} = ${init}` : key;
349. 						})
350. 						.join(', ')};`}
351. 
352. 				${!this.builders.init.isEmpty() && this.builders.init}
353. 
354. 				return {
355. 					${properties}
356. 				};
357. 			}
358. 		`.replace(/(\\\\)?#(\w*)/g, (match, escaped, name) => {
359. 			return escaped ? match.slice(2) : this.alias(name);
360. 		});
361. 	}
362. }


File: src/generators/dom/visit.ts
Line number range: 1 - 16
Content:
1. import visitors from './visitors/index';
2. import { DomGenerator } from './index';
3. import Block from './Block';
4. import { Node } from '../../interfaces';
5. import { State } from './interfaces';
6. 
7. export default function visit(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	elementStack: Node[]
13. ) {
14. 	const visitor = visitors[node.type];
15. 	visitor(generator, block, state, node, elementStack);
16. }


File: src/generators/server-side-rendering/visitors/Element.ts
Line number range: 1 - 82
Content:
1. import visitComponent from './Component';
2. import isVoidElementName from '../../../utils/isVoidElementName';
3. import visit from '../visit';
4. import visitWindow from './meta/Window';
5. import { SsrGenerator } from '../index';
6. import Block from '../Block';
7. import { Node } from '../../../interfaces';
8. 
9. const meta = {
10. 	':Window': visitWindow,
11. };
12. 
13. function stringifyAttributeValue(block: Block, chunks: Node[]) {
14. 	return chunks
15. 		.map((chunk: Node) => {
16. 			if (chunk.type === 'Text') {
17. 				return chunk.data;
18. 			}
19. 
20. 			const { snippet } = block.contextualise(chunk.expression);
21. 			return '${' + snippet + '}';
22. 		})
23. 		.join('');
24. }
25. 
26. export default function visitElement(
27. 	generator: SsrGenerator,
28. 	block: Block,
29. 	node: Node
30. ) {
31. 	if (node.name in meta) {
32. 		return meta[node.name](generator, block, node);
33. 	}
34. 
35. 	if (generator.components.has(node.name) || node.name === ':Self') {
36. 		visitComponent(generator, block, node);
37. 		return;
38. 	}
39. 
40. 	let openingTag = `<${node.name}`;
41. 	let textareaContents; // awkward special case
42. 
43. 	node.attributes.forEach((attribute: Node) => {
44. 		if (attribute.type !== 'Attribute') return;
45. 
46. 		if (attribute.name === 'value' && node.name === 'textarea') {
47. 			textareaContents = stringifyAttributeValue(block, attribute.value);
48. 		} else {
49. 			let str = ` ${attribute.name}`;
50. 
51. 			if (attribute.value !== true) {
52. 				str += `="${stringifyAttributeValue(block, attribute.value)}"`;
53. 			}
54. 
55. 			openingTag += str;
56. 		}
57. 	});
58. 
59. 	if (node._needsCssAttribute) {
60. 		openingTag += ` ${generator.stylesheet.id}`;
61. 	}
62. 
63. 	openingTag += '>';
64. 
65. 	generator.append(openingTag);
66. 
67. 	if (node.name === 'textarea' && textareaContents !== undefined) {
68. 		generator.append(textareaContents);
69. 	} else {
70. 		generator.elementDepth += 1;
71. 
72. 		node.children.forEach((child: Node) => {
73. 			visit(generator, block, child);
74. 		});
75. 
76. 		generator.elementDepth -= 1;
77. 	}
78. 
79. 	if (!isVoidElementName(node.name)) {
80. 		generator.append(`</${node.name}>`);
81. 	}
82. }


File: src/parse/read/directives.ts
Line number range: 1 - 164
Content:
1. import { parseExpressionAt } from 'acorn';
2. import spaces from '../../utils/spaces';
3. import { Parser } from '../index';
4. 
5. function readExpression(parser: Parser, start: number, quoteMark: string|null) {
6. 	let str = '';
7. 	let escaped = false;
8. 
9. 	for (let i = start; i < parser.template.length; i += 1) {
10. 		const char = parser.template[i];
11. 
12. 		if (quoteMark) {
13. 			if (char === quoteMark) {
14. 				if (escaped) {
15. 					str += quoteMark;
16. 				} else {
17. 					break;
18. 				}
19. 			} else if (escaped) {
20. 				str += '\\' + char;
21. 				escaped = false;
22. 			} else if (char === '\\') {
23. 				escaped = true;
24. 			} else {
25. 				str += char;
26. 			}
27. 		} else if (/\s/.test(char)) {
28. 			break;
29. 		} else {
30. 			str += char;
31. 		}
32. 	}
33. 
34. 	const expression = parseExpressionAt(spaces(start) + str, start);
35. 	parser.index = expression.end;
36. 
37. 	parser.allowWhitespace();
38. 	if (quoteMark) parser.eat(quoteMark, true);
39. 
40. 	return expression;
41. }
42. 
43. export function readEventHandlerDirective(
44. 	parser: Parser,
45. 	start: number,
46. 	name: string,
47. 	hasValue: boolean
48. ) {
49. 	let expression;
50. 
51. 	if (hasValue) {
52. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
53. 
54. 		const expressionStart = parser.index;
55. 
56. 		expression = readExpression(parser, expressionStart, quoteMark);
57. 
58. 		if (expression.type !== 'CallExpression') {
59. 			parser.error(`Expected call expression`, expressionStart);
60. 		}
61. 	}
62. 
63. 	return {
64. 		start,
65. 		end: parser.index,
66. 		type: 'EventHandler',
67. 		name,
68. 		expression,
69. 	};
70. }
71. 
72. export function readBindingDirective(
73. 	parser: Parser,
74. 	start: number,
75. 	name: string
76. ) {
77. 	let value;
78. 
79. 	if (parser.eat('=')) {
80. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
81. 
82. 		const a = parser.index;
83. 
84. 		if (parser.eat('{{')) {
85. 			let message = 'bound values should not be wrapped';
86. 			const b = parser.template.indexOf('}}', a);
87. 			if (b !== -1) {
88. 				const value = parser.template.slice(parser.index, b);
89. 				message += ` — use '${value}', not '{{${value}}}'`;
90. 			}
91. 
92. 			parser.error(message, a);
93. 		}
94. 
95. 		// this is a bit of a hack so that we can give Acorn something parseable
96. 		let b;
97. 		if (quoteMark) {
98. 			b = parser.index = parser.template.indexOf(quoteMark, parser.index);
99. 		} else {
100. 			parser.readUntil(/[\s\r\n\/>]/);
101. 			b = parser.index;
102. 		}
103. 
104. 		const source = spaces(a) + parser.template.slice(a, b);
105. 		value = parseExpressionAt(source, a);
106. 
107. 		if (value.type !== 'Identifier' && value.type !== 'MemberExpression') {
108. 			parser.error(`Cannot bind to rvalue`, value.start);
109. 		}
110. 
111. 		parser.allowWhitespace();
112. 
113. 		if (quoteMark) {
114. 			parser.eat(quoteMark, true);
115. 		}
116. 	} else {
117. 		// shorthand – bind:foo equivalent to bind:foo='foo'
118. 		value = {
119. 			type: 'Identifier',
120. 			start: start + 5,
121. 			end: parser.index,
122. 			name,
123. 		};
124. 	}
125. 
126. 	return {
127. 		start,
128. 		end: parser.index,
129. 		type: 'Binding',
130. 		name,
131. 		value,
132. 	};
133. }
134. 
135. export function readTransitionDirective(
136. 	parser: Parser,
137. 	start: number,
138. 	name: string,
139. 	type: string
140. ) {
141. 	let expression = null;
142. 
143. 	if (parser.eat('=')) {
144. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
145. 
146. 		const expressionStart = parser.index;
147. 
148. 		expression = readExpression(parser, expressionStart, quoteMark);
149. 
150. 		if (expression.type !== 'ObjectExpression') {
151. 			parser.error(`Expected object expression`, expressionStart);
152. 		}
153. 	}
154. 
155. 	return {
156. 		start,
157. 		end: parser.index,
158. 		type: 'Transition',
159. 		name,
160. 		intro: type === 'in' || type === 'transition',
161. 		outro: type === 'out' || type === 'transition',
162. 		expression,
163. 	};
164. }


File: src/parse/state/tag.ts
Line number range: 1 - 390
Content:
1. import readExpression from '../read/expression';
2. import readScript from '../read/script';
3. import readStyle from '../read/style';
4. import {
5. 	readEventHandlerDirective,
6. 	readBindingDirective,
7. 	readTransitionDirective,
8. } from '../read/directives';
9. import { trimStart, trimEnd } from '../../utils/trim';
10. import { decodeCharacterReferences } from '../utils/html';
11. import isVoidElementName from '../../utils/isVoidElementName';
12. import { Parser } from '../index';
13. import { Node } from '../../interfaces';
14. 
15. const validTagName = /^\!?[a-zA-Z]{1,}:?[a-zA-Z0-9\-]*/;
16. 
17. const SELF = ':Self';
18. 
19. const metaTags = {
20. 	':Window': true,
21. };
22. 
23. const specials = new Map([
24. 	[
25. 		'script',
26. 		{
27. 			read: readScript,
28. 			property: 'js',
29. 		},
30. 	],
31. 	[
32. 		'style',
33. 		{
34. 			read: readStyle,
35. 			property: 'css',
36. 		},
37. 	],
38. ]);
39. 
40. // based on http://developers.whatwg.org/syntax.html#syntax-tag-omission
41. const disallowedContents = new Map([
42. 	['li', new Set(['li'])],
43. 	['dt', new Set(['dt', 'dd'])],
44. 	['dd', new Set(['dt', 'dd'])],
45. 	[
46. 		'p',
47. 		new Set(
48. 			'address article aside blockquote div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr main menu nav ol p pre section table ul'.split(
49. 				' '
50. 			)
51. 		),
52. 	],
53. 	['rt', new Set(['rt', 'rp'])],
54. 	['rp', new Set(['rt', 'rp'])],
55. 	['optgroup', new Set(['optgroup'])],
56. 	['option', new Set(['option', 'optgroup'])],
57. 	['thead', new Set(['tbody', 'tfoot'])],
58. 	['tbody', new Set(['tbody', 'tfoot'])],
59. 	['tfoot', new Set(['tbody'])],
60. 	['tr', new Set(['tr', 'tbody'])],
61. 	['td', new Set(['td', 'th', 'tr'])],
62. 	['th', new Set(['td', 'th', 'tr'])],
63. ]);
64. 
65. export default function tag(parser: Parser) {
66. 	const start = parser.index++;
67. 
68. 	let parent = parser.current();
69. 
70. 	if (parser.eat('!--')) {
71. 		const data = parser.readUntil(/-->/);
72. 		parser.eat('-->');
73. 
74. 		parser.current().children.push({
75. 			start,
76. 			end: parser.index,
77. 			type: 'Comment',
78. 			data,
79. 		});
80. 
81. 		return;
82. 	}
83. 
84. 	const isClosingTag = parser.eat('/');
85. 
86. 	const name = readTagName(parser);
87. 
88. 	if (name in metaTags) {
89. 		if (name in parser.metaTags) {
90. 			if (isClosingTag && parser.current().children.length) {
91. 				parser.error(
92. 					`<${name}> cannot have children`,
93. 					parser.current().children[0].start
94. 				);
95. 			}
96. 
97. 			parser.error(`A component can only have one <${name}> tag`, start);
98. 		}
99. 
100. 		parser.metaTags[name] = true;
101. 
102. 		if (parser.stack.length > 1) {
103. 			parser.error(`<${name}> tags cannot be inside elements or blocks`, start);
104. 		}
105. 	}
106. 
107. 	parser.allowWhitespace();
108. 
109. 	if (isClosingTag) {
110. 		if (isVoidElementName(name)) {
111. 			parser.error(
112. 				`<${name}> is a void element and cannot have children, or a closing tag`,
113. 				start
114. 			);
115. 		}
116. 
117. 		if (!parser.eat('>')) parser.error(`Expected '>'`);
118. 
119. 		// close any elements that don't have their own closing tags, e.g. <div><p></div>
120. 		while (parent.name !== name) {
121. 			if (parent.type !== 'Element')
122. 				parser.error(
123. 					`</${name}> attempted to close an element that was not open`,
124. 					start
125. 				);
126. 
127. 			parent.end = start;
128. 			parser.stack.pop();
129. 
130. 			parent = parser.current();
131. 		}
132. 
133. 		parent.end = parser.index;
134. 		parser.stack.pop();
135. 
136. 		return;
137. 	} else if (disallowedContents.has(parent.name)) {
138. 		// can this be a child of the parent element, or does it implicitly
139. 		// close it, like `<li>one<li>two`?
140. 		if (disallowedContents.get(parent.name).has(name)) {
141. 			parent.end = start;
142. 			parser.stack.pop();
143. 		}
144. 	}
145. 
146. 	const attributes = [];
147. 	const uniqueNames = new Set();
148. 
149. 	let attribute;
150. 	while ((attribute = readAttribute(parser, uniqueNames))) {
151. 		attributes.push(attribute);
152. 		parser.allowWhitespace();
153. 	}
154. 
155. 	parser.allowWhitespace();
156. 
157. 	// special cases – top-level <script> and <style>
158. 	if (specials.has(name) && parser.stack.length === 1) {
159. 		const special = specials.get(name);
160. 
161. 		if (parser[special.property]) {
162. 			parser.index = start;
163. 			parser.error(
164. 				`You can only have one top-level <${name}> tag per component`
165. 			);
166. 		}
167. 
168. 		parser.eat('>', true);
169. 		parser[special.property] = special.read(parser, start, attributes);
170. 		return;
171. 	}
172. 
173. 	const element: Node = {
174. 		start,
175. 		end: null, // filled in later
176. 		type: 'Element',
177. 		name,
178. 		attributes,
179. 		children: [],
180. 	};
181. 
182. 	parser.current().children.push(element);
183. 
184. 	const selfClosing = parser.eat('/') || isVoidElementName(name);
185. 
186. 	parser.eat('>', true);
187. 
188. 	if (selfClosing) {
189. 		element.end = parser.index;
190. 	} else if (name === 'textarea') {
191. 		// special case
192. 		element.children = readSequence(
193. 			parser,
194. 			() =>
195. 				parser.template.slice(parser.index, parser.index + 11) === '</textarea>'
196. 		);
197. 		parser.read(/<\/textarea>/);
198. 		element.end = parser.index;
199. 	} else {
200. 		// don't push self-closing elements onto the stack
201. 		parser.stack.push(element);
202. 	}
203. }
204. 
205. function readTagName(parser: Parser) {
206. 	const start = parser.index;
207. 
208. 	if (parser.eat(SELF)) {
209. 		// check we're inside a block, otherwise this
210. 		// will cause infinite recursion
211. 		let i = parser.stack.length;
212. 		let legal = false;
213. 
214. 		while (i--) {
215. 			const fragment = parser.stack[i];
216. 			if (fragment.type === 'IfBlock' || fragment.type === 'EachBlock') {
217. 				legal = true;
218. 				break;
219. 			}
220. 		}
221. 
222. 		if (!legal) {
223. 			parser.error(
224. 				`<${SELF}> components can only exist inside if-blocks or each-blocks`,
225. 				start
226. 			);
227. 		}
228. 
229. 		return SELF;
230. 	}
231. 
232. 	const name = parser.readUntil(/(\s|\/|>)/);
233. 
234. 	if (name in metaTags) return name;
235. 
236. 	if (!validTagName.test(name)) {
237. 		parser.error(`Expected valid tag name`, start);
238. 	}
239. 
240. 	return name;
241. }
242. 
243. function readAttribute(parser: Parser, uniqueNames: Set<string>) {
244. 	const start = parser.index;
245. 
246. 	let name = parser.readUntil(/(\s|=|\/|>)/);
247. 	if (!name) return null;
248. 	if (uniqueNames.has(name)) {
249. 		parser.error('Attributes need to be unique', start);
250. 	}
251. 
252. 	uniqueNames.add(name);
253. 
254. 	parser.allowWhitespace();
255. 
256. 	if (/^on:/.test(name)) {
257. 		return readEventHandlerDirective(parser, start, name.slice(3), parser.eat('='));
258. 	}
259. 
260. 	if (/^bind:/.test(name)) {
261. 		return readBindingDirective(parser, start, name.slice(5));
262. 	}
263. 
264. 	if (/^ref:/.test(name)) {
265. 		return {
266. 			start,
267. 			end: parser.index,
268. 			type: 'Ref',
269. 			name: name.slice(4),
270. 		};
271. 	}
272. 
273. 	const match = /^(in|out|transition):/.exec(name);
274. 	if (match) {
275. 		return readTransitionDirective(
276. 			parser,
277. 			start,
278. 			name.slice(match[0].length),
279. 			match[1]
280. 		);
281. 	}
282. 
283. 	let value;
284. 
285. 	// :foo is shorthand for foo='{{foo}}'
286. 	if (/^:\w+$/.test(name)) {
287. 		name = name.slice(1);
288. 		value = getShorthandValue(start + 1, name);
289. 	} else {
290. 		value = parser.eat('=') ? readAttributeValue(parser) : true;
291. 	}
292. 
293. 	return {
294. 		start,
295. 		end: parser.index,
296. 		type: 'Attribute',
297. 		name,
298. 		value,
299. 	};
300. }
301. 
302. function readAttributeValue(parser: Parser) {
303. 	const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
304. 
305. 	const regex = quoteMark === `'`
306. 		? /'/
307. 		: quoteMark === `"` ? /"/ : /[\s"'=<>\/`]/;
308. 
309. 	const value = readSequence(parser, () =>
310. 		regex.test(parser.template[parser.index])
311. 	);
312. 
313. 	if (quoteMark) parser.index += 1;
314. 	return value;
315. }
316. 
317. function getShorthandValue(start: number, name: string) {
318. 	const end = start + name.length;
319. 
320. 	return [
321. 		{
322. 			type: 'AttributeShorthand',
323. 			start,
324. 			end,
325. 			expression: {
326. 				type: 'Identifier',
327. 				start,
328. 				end,
329. 				name,
330. 			},
331. 		},
332. 	];
333. }
334. 
335. function readSequence(parser: Parser, done: () => boolean) {
336. 	let currentChunk: Node = {
337. 		start: parser.index,
338. 		end: null,
339. 		type: 'Text',
340. 		data: '',
341. 	};
342. 
343. 	const chunks = [];
344. 
345. 	while (parser.index < parser.template.length) {
346. 		const index = parser.index;
347. 
348. 		if (done()) {
349. 			currentChunk.end = parser.index;
350. 
351. 			if (currentChunk.data) chunks.push(currentChunk);
352. 
353. 			chunks.forEach(chunk => {
354. 				if (chunk.type === 'Text')
355. 					chunk.data = decodeCharacterReferences(chunk.data);
356. 			});
357. 
358. 			return chunks;
359. 		} else if (parser.eat('{{')) {
360. 			if (currentChunk.data) {
361. 				currentChunk.end = index;
362. 				chunks.push(currentChunk);
363. 			}
364. 
365. 			const expression = readExpression(parser);
366. 			parser.allowWhitespace();
367. 			if (!parser.eat('}}')) {
368. 				parser.error(`Expected }}`);
369. 			}
370. 
371. 			chunks.push({
372. 				start: index,
373. 				end: parser.index,
374. 				type: 'MustacheTag',
375. 				expression,
376. 			});
377. 
378. 			currentChunk = {
379. 				start: parser.index,
380. 				end: null,
381. 				type: 'Text',
382. 				data: '',
383. 			};
384. 		} else {
385. 			currentChunk.data += parser.template[parser.index++];
386. 		}
387. 	}
388. 
389. 	parser.error(`Unexpected end of input`);
390. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-10 23:39:17,907 - thread-133013312636608.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n   - The query asks for parsing and representation of ref directives.\n   - This section of readAttribute detects directives including ref (ref:), returning a node of type 'Ref'.\n2. Extended relevance:\n   - It shows how attribute names are classified into event handlers, bindings, refs, and transitions within tag parsing.", relative_path='src/parse/state/tag.ts', start_line=243, end_line=271), ContextOutput(reasoning='1. Query requirement analysis:\n   - Transition directives are part of the directive parsing architecture; including them clarifies directive handling patterns.\n2. Extended relevance:\n   - Demonstrates how transitions are delegated to specialized readers, establishing consistency for directive parsing.', relative_path='src/parse/state/tag.ts', start_line=273, end_line=281), ContextOutput(reasoning='1. Query requirement analysis:\n   - The architecture for directive parsing is needed; readExpression is a core helper used by directive readers.\n2. Extended relevance:\n   - Shows how expressions are read and parsed (including quoted and unquoted), which is essential for understanding directive parsing mechanics.', relative_path='src/parse/read/directives.ts', start_line=5, end_line=41), ContextOutput(reasoning='1. Query requirement analysis:\n   - Event handler directive parsing demonstrates the directive pattern and validation.\n2. Extended relevance:\n   - Clarifies how directives with values are parsed and validated (expecting CallExpression), useful for consistency when handling refs.', relative_path='src/parse/read/directives.ts', start_line=43, end_line=70), ContextOutput(reasoning='1. Query requirement analysis:\n   - Binding directive parsing shows how directive values are handled and validated.\n2. Extended relevance:\n   - Understanding binding parsing helps maintain architectural consistency across directives, including refs.', relative_path='src/parse/read/directives.ts', start_line=72, end_line=133), ContextOutput(reasoning='1. Query requirement analysis:\n   - Transition directive parsing is part of directive handling.\n2. Extended relevance:\n   - Provides pattern for directives that accept object expressions and intro/outro flags.', relative_path='src/parse/read/directives.ts', start_line=135, end_line=164), ContextOutput(reasoning='1. Query requirement analysis:\n   - CSS scoping and selector handling are requested; Selector.apply determines whether a selector applies and sets the CSS attribute flags on nodes.\n2. Extended relevance:\n   - This method is central to marking nodes for CSS encapsulation.', relative_path='src/css/Selector.ts', start_line=28, end_line=39), ContextOutput(reasoning='1. Query requirement analysis:\n   - apply() uses sibling detection for descendant selectors via isDescendantSelector\n2. Extended relevance:\n   - This helper is necessary to understand when to set CSS attributes on both outermost and innermost elements.', relative_path='src/css/Selector.ts', start_line=113, end_line=115), ContextOutput(reasoning='1. Query requirement analysis:\n   - Determines if selectors apply to nodes, enabling CSS scoping logic.\n2. Extended relevance:\n   - Core algorithm for matching selectors to the element stack, necessary for understanding how CSS encapsulation marks nodes.', relative_path='src/css/Selector.ts', start_line=117, end_line=181), ContextOutput(reasoning='1. Query requirement analysis:\n   - Selector.transform inserts the scoping attribute into selectors.\n2. Extended relevance:\n   - Shows how :global(...) is handled and how the encapsulation attribute is applied to selectors.', relative_path='src/css/Selector.ts', start_line=54, end_line=81), ContextOutput(reasoning='1. Query requirement analysis:\n   - Stylesheet class assigns a unique CSS scope id used for DOM/SSR attribute injection.\n2. Extended relevance:\n   - The id format is required to understand how scoped attributes are named.', relative_path='src/css/Stylesheet.ts', start_line=218, end_line=219), ContextOutput(reasoning='1. Query requirement analysis:\n   - Rule.apply applies selectors to nodes, triggering CSS scoping.\n2. Extended relevance:\n   - Establishes the link between stylesheet rules and element nodes for setting _needsCssAttribute.', relative_path='src/css/Stylesheet.ts', start_line=24, end_line=26), ContextOutput(reasoning='1. Query requirement analysis:\n   - Rule.transform applies CSS scoping and handles cascading behavior.\n2. Extended relevance:\n   - Demonstrates how selectors are rewritten with the scoping attribute and how keyframes are handled in declarations.', relative_path='src/css/Stylesheet.ts', start_line=64, end_line=98), ContextOutput(reasoning='1. Query requirement analysis:\n   - Stylesheet.apply marks nodes for CSS attribute injection when encapsulation is active.\n2. Extended relevance:\n   - Shows cascade behavior and direct application of selectors to nodes.', relative_path='src/css/Stylesheet.ts', start_line=266, end_line=278), ContextOutput(reasoning='1. Query requirement analysis:\n   - Atrule.transform scopes keyframes identifiers with the component id.\n2. Extended relevance:\n   - Keyframes scoping is part of CSS encapsulation implementation.', relative_path='src/css/Stylesheet.ts', start_line=180, end_line=194), ContextOutput(reasoning='1. Query requirement analysis:\n   - SSR Element visitor injects the CSS scoping attribute when nodes are marked.\n2. Extended relevance:\n   - Shows where _needsCssAttribute translates into adding the scoped attribute to the rendered HTML.', relative_path='src/generators/server-side-rendering/visitors/Element.ts', start_line=59, end_line=63), ContextOutput(reasoning='1. Query requirement analysis:\n   - SSR Element visitor constructs attributes; context needed to understand injection placement.\n2. Extended relevance:\n   - How static and dynamic attributes are turned into HTML before CSS attribute appending.', relative_path='src/generators/server-side-rendering/visitors/Element.ts', start_line=43, end_line=57), ContextOutput(reasoning='1. Query requirement analysis:\n   - DOM visit dispatch ties node processing to specific visitors including Element.\n2. Extended relevance:\n   - Establishes the mechanism by which Element nodes are visited, relevant to applying CSS attributes and refs in DOM generation.', relative_path='src/generators/dom/visit.ts', start_line=7, end_line=16)]
2025-11-10 23:39:17,914 - thread-133013312636608.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 18 contexts to memory for query: Please provide the full contents of src/parse/read/directives.ts, src/parse/state/tag.ts, src/generators/dom/Block.ts, src/generators/dom/visit.ts, src/generators/server-side-rendering/visitors/Element.ts, src/css/Stylesheet.ts, src/css/Selector.ts, and README.md.
2025-11-10 23:39:18,992 - thread-133013312636608.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-10 23:39:18,993 - thread-133013312636608.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 18 new contexts to 0 existing contexts
2025-11-10 23:39:18,994 - thread-133013312636608.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 18 total contexts (removed 0 duplicates)
2025-11-10 23:39:18,995 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── getGlobals.ts
|   |           ├── getIntro.ts
|   |           ├── getOutro.ts
|   |           └── walkHtml.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getObject.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── reservedNames.ts
|   |   ├── spaces.ts
|   |   ├── stringify.ts
|   |   └── trim.ts
|   └── validate
|       ├── html
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── pass-no-options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-onrender
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
using refs in css

Issue description: 
When I use a ref, I most often also want to get a handle to it with css, which leads to slightly annoying, duplicative markup.

```html
<style>
  .container {
    color: red
  }
</style>
<div class="container" ref:container></div>
```
 
The only solutions I can think of to mitigate this are untenable, but thought I raise this if others see something better.

- Make nodes with ids available as refs, like polymer's static node map
- Make svelte refs available as synthetic css selectors
- Make a syntax shortcut for declaring refs as classes, e.g. `<div ref:class:container ></div>`

Issue comments:


Find all relevant source code context and documentation needed to understand and implement this feature request.
Focus on production code (ignore test files) and follow these steps:
1. Identify similar existing features or components that this new feature should integrate with
2. Find relevant class definitions, interfaces, and API patterns used in the codebase
3. Locate related modules and services that the new feature will interact with
4. Include architectural patterns and code conventions used in similar implementations

Skip any test files

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of src/parse/read/directives.ts, src/parse/state/tag.ts, src/generators/dom/Block.ts, src/generators/dom/visit.ts, src/generators/server-side-rendering/visitors/Element.ts, src/css/Stylesheet.ts, src/css/Selector.ts, and README.md.
Extra Requirements: If sending entire files is too large, include at minimum the functions/classes that parse and represent ref directives, apply refs in DOM/SSR generation, and implement CSS scoping and selector handling.
Purpose: These files will reveal existing ref and CSS mechanisms, interfaces, and patterns needed to determine how to implement refs as CSS selectors or shortcuts and ensure architectural consistency.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: src/css/Selector.ts
Line number range: 28 - 39
Content:
28. 	apply(node: Node, stack: Node[]) {
29. 		const applies = selectorAppliesTo(this.localBlocks.slice(), node, stack.slice());
30. 
31. 		if (applies) {
32. 			this.used = true;
33. 
34. 			// add svelte-123xyz attribute to outermost and innermost
35. 			// elements — no need to add it to intermediate elements
36. 			node._needsCssAttribute = true;
37. 			if (stack[0] && this.node.children.find(isDescendantSelector)) stack[0]._needsCssAttribute = true;
38. 		}
39. 	}


File: src/css/Selector.ts
Line number range: 54 - 81
Content:
54. 	transform(code: MagicString, attr: string) {
55. 		function encapsulateBlock(block: Block) {
56. 			let i = block.selectors.length;
57. 			while (i--) {
58. 				const selector = block.selectors[i];
59. 				if (selector.type === 'PseudoElementSelector' || selector.type === 'PseudoClassSelector') continue;
60. 
61. 				if (selector.type === 'TypeSelector' && selector.name === '*') {
62. 					code.overwrite(selector.start, selector.end, attr);
63. 				} else {
64. 					code.appendLeft(selector.end, attr);
65. 				}
66. 
67. 				return;
68. 			}
69. 		}
70. 
71. 		this.blocks.forEach((block, i) => {
72. 			if (block.global) {
73. 				const selector = block.selectors[0];
74. 				const first = selector.children[0];
75. 				const last = selector.children[selector.children.length - 1];
76. 				code.remove(selector.start, first.start).remove(last.end, selector.end);
77. 			} else if (i === 0 || i === this.blocks.length - 1) {
78. 				encapsulateBlock(block);
79. 			}
80. 		});
81. 	}


File: src/css/Selector.ts
Line number range: 113 - 115
Content:
113. function isDescendantSelector(selector: Node) {
114. 	return selector.type === 'WhiteSpace' || selector.type === 'Combinator';
115. }


File: src/css/Selector.ts
Line number range: 117 - 181
Content:
117. function selectorAppliesTo(blocks: Block[], node: Node, stack: Node[]): boolean {
118. 	const block = blocks.pop();
119. 	if (!block) return false;
120. 
121. 	if (!node) {
122. 		return blocks.every(block => block.global);
123. 	}
124. 
125. 	let i = block.selectors.length;
126. 	let j = stack.length;
127. 
128. 	while (i--) {
129. 		const selector = block.selectors[i];
130. 
131. 		if (selector.type === 'PseudoClassSelector' && selector.name === 'global') {
132. 			// TODO shouldn't see this here... maybe we should enforce that :global(...)
133. 			// cannot be sandwiched between non-global selectors?
134. 			return false;
135. 		}
136. 
137. 		if (selector.type === 'PseudoClassSelector' || selector.type === 'PseudoElementSelector') {
138. 			continue;
139. 		}
140. 
141. 		if (selector.type === 'ClassSelector') {
142. 			if (!attributeMatches(node, 'class', selector.name, '~=', false)) return false;
143. 		}
144. 
145. 		else if (selector.type === 'IdSelector') {
146. 			if (!attributeMatches(node, 'id', selector.name, '=', false)) return false;
147. 		}
148. 
149. 		else if (selector.type === 'AttributeSelector') {
150. 			if (!attributeMatches(node, selector.name.name, selector.value && unquote(selector.value.value), selector.operator, selector.flags)) return false;
151. 		}
152. 
153. 		else if (selector.type === 'TypeSelector') {
154. 			if (node.name !== selector.name && selector.name !== '*') return false;
155. 		}
156. 
157. 		else {
158. 			// bail. TODO figure out what these could be
159. 			return true;
160. 		}
161. 	}
162. 
163. 	if (block.combinator) {
164. 		if (block.combinator.type === 'WhiteSpace') {
165. 			while (stack.length) {
166. 				if (selectorAppliesTo(blocks.slice(), stack.pop(), stack)) {
167. 					return true;
168. 				}
169. 			}
170. 
171. 			return false;
172. 		} else if (block.combinator.name === '>') {
173. 			return selectorAppliesTo(blocks, stack.pop(), stack);
174. 		}
175. 
176. 		// TODO other combinators
177. 		return true;
178. 	}
179. 
180. 	return true;
181. }


File: src/css/Stylesheet.ts
Line number range: 24 - 26
Content:
24. 	apply(node: Node, stack: Node[]) {
25. 		this.selectors.forEach(selector => selector.apply(node, stack)); // TODO move the logic in here?
26. 	}


File: src/css/Stylesheet.ts
Line number range: 64 - 98
Content:
64. 	transform(code: MagicString, id: string, keyframes: Map<string, string>, cascade: boolean) {
65. 		if (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;
66. 
67. 		const attr = `[${id}]`;
68. 
69. 		if (cascade) {
70. 			this.selectors.forEach(selector => {
71. 				// TODO disable cascading (without :global(...)) in v2
72. 				const { start, end, children } = selector.node;
73. 
74. 				const css = code.original;
75. 				const selectorString = css.slice(start, end);
76. 
77. 				const firstToken = children[0];
78. 
79. 				let transformed;
80. 
81. 				if (firstToken.type === 'TypeSelector') {
82. 					const insert = firstToken.end;
83. 					const head = firstToken.name === '*' ? '' : css.slice(start, insert);
84. 					const tail = css.slice(insert, end);
85. 
86. 					transformed = `${head}${attr}${tail},${attr} ${selectorString}`;
87. 				} else {
88. 					transformed = `${attr}${selectorString},${attr} ${selectorString}`;
89. 				}
90. 
91. 				code.overwrite(start, end, transformed);
92. 			});
93. 		} else {
94. 			this.selectors.forEach(selector => selector.transform(code, attr));
95. 		}
96. 
97. 		this.declarations.forEach(declaration => declaration.transform(code, keyframes));
98. 	}


File: src/css/Stylesheet.ts
Line number range: 180 - 194
Content:
180. 	transform(code: MagicString, id: string, keyframes: Map<string, string>) {
181. 		if (this.node.name !== 'keyframes') return;
182. 
183. 		this.node.expression.children.forEach((expression: Node) => {
184. 			if (expression.type === 'Identifier') {
185. 				if (expression.name.startsWith('-global-')) {
186. 					code.remove(expression.start, expression.start + 8);
187. 				} else {
188. 					const newName = `${id}-${expression.name}`;
189. 					code.overwrite(expression.start, expression.end, newName);
190. 					keyframes.set(expression.name, newName);
191. 				}
192. 			}
193. 		});
194. 	}


File: src/css/Stylesheet.ts
Line number range: 218 - 219
Content:
218. 		this.id = `svelte-${parsed.hash}`;
219. 


File: src/css/Stylesheet.ts
Line number range: 266 - 278
Content:
266. 	apply(node: Node, stack: Node[]) {
267. 		if (!this.hasStyles) return;
268. 
269. 		if (this.cascade) {
270. 			if (stack.length === 0) node._needsCssAttribute = true;
271. 			return;
272. 		}
273. 
274. 		for (let i = 0; i < this.rules.length; i += 1) {
275. 			const rule = this.rules[i];
276. 			rule.apply(node, stack);
277. 		}
278. 	}


File: src/generators/dom/visit.ts
Line number range: 7 - 16
Content:
7. export default function visit(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	elementStack: Node[]
13. ) {
14. 	const visitor = visitors[node.type];
15. 	visitor(generator, block, state, node, elementStack);
16. }


File: src/generators/server-side-rendering/visitors/Element.ts
Line number range: 43 - 57
Content:
43. 	node.attributes.forEach((attribute: Node) => {
44. 		if (attribute.type !== 'Attribute') return;
45. 
46. 		if (attribute.name === 'value' && node.name === 'textarea') {
47. 			textareaContents = stringifyAttributeValue(block, attribute.value);
48. 		} else {
49. 			let str = ` ${attribute.name}`;
50. 
51. 			if (attribute.value !== true) {
52. 				str += `="${stringifyAttributeValue(block, attribute.value)}"`;
53. 			}
54. 
55. 			openingTag += str;
56. 		}
57. 	});


File: src/generators/server-side-rendering/visitors/Element.ts
Line number range: 59 - 63
Content:
59. 	if (node._needsCssAttribute) {
60. 		openingTag += ` ${generator.stylesheet.id}`;
61. 	}
62. 
63. 	openingTag += '>';


File: src/parse/read/directives.ts
Line number range: 5 - 41
Content:
5. function readExpression(parser: Parser, start: number, quoteMark: string|null) {
6. 	let str = '';
7. 	let escaped = false;
8. 
9. 	for (let i = start; i < parser.template.length; i += 1) {
10. 		const char = parser.template[i];
11. 
12. 		if (quoteMark) {
13. 			if (char === quoteMark) {
14. 				if (escaped) {
15. 					str += quoteMark;
16. 				} else {
17. 					break;
18. 				}
19. 			} else if (escaped) {
20. 				str += '\\' + char;
21. 				escaped = false;
22. 			} else if (char === '\\') {
23. 				escaped = true;
24. 			} else {
25. 				str += char;
26. 			}
27. 		} else if (/\s/.test(char)) {
28. 			break;
29. 		} else {
30. 			str += char;
31. 		}
32. 	}
33. 
34. 	const expression = parseExpressionAt(spaces(start) + str, start);
35. 	parser.index = expression.end;
36. 
37. 	parser.allowWhitespace();
38. 	if (quoteMark) parser.eat(quoteMark, true);
39. 
40. 	return expression;
41. }


File: src/parse/read/directives.ts
Line number range: 43 - 70
Content:
43. export function readEventHandlerDirective(
44. 	parser: Parser,
45. 	start: number,
46. 	name: string,
47. 	hasValue: boolean
48. ) {
49. 	let expression;
50. 
51. 	if (hasValue) {
52. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
53. 
54. 		const expressionStart = parser.index;
55. 
56. 		expression = readExpression(parser, expressionStart, quoteMark);
57. 
58. 		if (expression.type !== 'CallExpression') {
59. 			parser.error(`Expected call expression`, expressionStart);
60. 		}
61. 	}
62. 
63. 	return {
64. 		start,
65. 		end: parser.index,
66. 		type: 'EventHandler',
67. 		name,
68. 		expression,
69. 	};
70. }


File: src/parse/read/directives.ts
Line number range: 72 - 133
Content:
72. export function readBindingDirective(
73. 	parser: Parser,
74. 	start: number,
75. 	name: string
76. ) {
77. 	let value;
78. 
79. 	if (parser.eat('=')) {
80. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
81. 
82. 		const a = parser.index;
83. 
84. 		if (parser.eat('{{')) {
85. 			let message = 'bound values should not be wrapped';
86. 			const b = parser.template.indexOf('}}', a);
87. 			if (b !== -1) {
88. 				const value = parser.template.slice(parser.index, b);
89. 				message += ` — use '${value}', not '{{${value}}}'`;
90. 			}
91. 
92. 			parser.error(message, a);
93. 		}
94. 
95. 		// this is a bit of a hack so that we can give Acorn something parseable
96. 		let b;
97. 		if (quoteMark) {
98. 			b = parser.index = parser.template.indexOf(quoteMark, parser.index);
99. 		} else {
100. 			parser.readUntil(/[\s\r\n\/>]/);
101. 			b = parser.index;
102. 		}
103. 
104. 		const source = spaces(a) + parser.template.slice(a, b);
105. 		value = parseExpressionAt(source, a);
106. 
107. 		if (value.type !== 'Identifier' && value.type !== 'MemberExpression') {
108. 			parser.error(`Cannot bind to rvalue`, value.start);
109. 		}
110. 
111. 		parser.allowWhitespace();
112. 
113. 		if (quoteMark) {
114. 			parser.eat(quoteMark, true);
115. 		}
116. 	} else {
117. 		// shorthand – bind:foo equivalent to bind:foo='foo'
118. 		value = {
119. 			type: 'Identifier',
120. 			start: start + 5,
121. 			end: parser.index,
122. 			name,
123. 		};
124. 	}
125. 
126. 	return {
127. 		start,
128. 		end: parser.index,
129. 		type: 'Binding',
130. 		name,
131. 		value,
132. 	};
133. }


File: src/parse/read/directives.ts
Line number range: 135 - 164
Content:
135. export function readTransitionDirective(
136. 	parser: Parser,
137. 	start: number,
138. 	name: string,
139. 	type: string
140. ) {
141. 	let expression = null;
142. 
143. 	if (parser.eat('=')) {
144. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
145. 
146. 		const expressionStart = parser.index;
147. 
148. 		expression = readExpression(parser, expressionStart, quoteMark);
149. 
150. 		if (expression.type !== 'ObjectExpression') {
151. 			parser.error(`Expected object expression`, expressionStart);
152. 		}
153. 	}
154. 
155. 	return {
156. 		start,
157. 		end: parser.index,
158. 		type: 'Transition',
159. 		name,
160. 		intro: type === 'in' || type === 'transition',
161. 		outro: type === 'out' || type === 'transition',
162. 		expression,
163. 	};
164. }


File: src/parse/state/tag.ts
Line number range: 243 - 271
Content:
243. function readAttribute(parser: Parser, uniqueNames: Set<string>) {
244. 	const start = parser.index;
245. 
246. 	let name = parser.readUntil(/(\s|=|\/|>)/);
247. 	if (!name) return null;
248. 	if (uniqueNames.has(name)) {
249. 		parser.error('Attributes need to be unique', start);
250. 	}
251. 
252. 	uniqueNames.add(name);
253. 
254. 	parser.allowWhitespace();
255. 
256. 	if (/^on:/.test(name)) {
257. 		return readEventHandlerDirective(parser, start, name.slice(3), parser.eat('='));
258. 	}
259. 
260. 	if (/^bind:/.test(name)) {
261. 		return readBindingDirective(parser, start, name.slice(5));
262. 	}
263. 
264. 	if (/^ref:/.test(name)) {
265. 		return {
266. 			start,
267. 			end: parser.index,
268. 			type: 'Ref',
269. 			name: name.slice(4),
270. 		};
271. 	}


File: src/parse/state/tag.ts
Line number range: 273 - 281
Content:
273. 	const match = /^(in|out|transition):/.exec(name);
274. 	if (match) {
275. 		return readTransitionDirective(
276. 			parser,
277. 			start,
278. 			name.slice(match[0].length),
279. 			match[1]
280. 		);
281. 	}

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-10 23:39:44,651 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The current context shows how ref directives are parsed and how CSS scoping works and is applied (including SSR attribute injection), but it lacks critical DOM generation details for handling refs, runtime ref semantics, core interfaces/types, and overall compile pipeline/documentation. Specifically, we need the DOM Element visitor implementation (where attributes and refs are processed), the DOM Block and generator setup (where CSS attributes are applied on the client), the runtime code that exposes/uses refs, the core interfaces (Node, Block, Generator), and the README to understand the intended ref API. Without these, we cannot fully identify integration points or architectural patterns to implement refs as CSS selectors or class shortcuts.' query='Please provide the contents of src/generators/dom/Block.ts, src/generators/dom/index.ts, src/generators/dom/preprocess.ts, src/generators/dom/visitors/Element (main implementation file), src/interfaces.ts, src/shared/dom.js, src/shared/utils.js, and README.md.' extra_requirements='If sending full files is too large, include at minimum the functions that process ref directives in the DOM generator, how refs are exposed at runtime, the Node/Element interface definitions, and the section(s) in README describing refs and CSS scoping.' purpose='These files will reveal how refs are generated and used on the client, how CSS scoping attaches attributes, and the interfaces/patterns needed to design refs-as-selectors or shorthand class integration consistently.'
2025-11-10 23:39:44,653 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the contents of src/generators/dom/Block.ts, src/generators/dom/index.ts, src/generators/dom/preprocess.ts, src/generators/dom/visitors/Element (main implementation file), src/interfaces.ts, src/shared/dom.js, src/shared/utils.js, and README.md.
2025-11-10 23:39:47,090 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: [{'query_essential_query': 'Please provide the full contents of src/parse/read/directives.ts, src/parse/state/tag.ts, src/generators/dom/Block.ts, src/generators/dom/visit.ts, src/generators/server-side-rendering/visitors/Element.ts, src/css/Stylesheet.ts, src/css/Selector.ts, and README.md.', 'query_extra_requirements': 'If sending entire files is too large, include at minimum the functions/classes that parse and represent ref directives, apply refs in DOM/SSR generation, and implement CSS scoping and selector handling.', 'query_purpose': 'These files will reveal existing ref and CSS mechanisms, interfaces, and patterns needed to determine how to implement refs as CSS selectors or shortcuts and ensure architectural consistency.', 'memory_context_contexts': [{'relative_path': 'src/parse/state/tag.ts', 'content': "243. function readAttribute(parser: Parser, uniqueNames: Set<string>) {\n244. \tconst start = parser.index;\n245. \n246. \tlet name = parser.readUntil(/(\\s|=|\\/|>)/);\n247. \tif (!name) return null;\n248. \tif (uniqueNames.has(name)) {\n249. \t\tparser.error('Attributes need to be unique', start);\n250. \t}\n251. \n252. \tuniqueNames.add(name);\n253. \n254. \tparser.allowWhitespace();\n255. \n256. \tif (/^on:/.test(name)) {\n257. \t\treturn readEventHandlerDirective(parser, start, name.slice(3), parser.eat('='));\n258. \t}\n259. \n260. \tif (/^bind:/.test(name)) {\n261. \t\treturn readBindingDirective(parser, start, name.slice(5));\n262. \t}\n263. \n264. \tif (/^ref:/.test(name)) {\n265. \t\treturn {\n266. \t\t\tstart,\n267. \t\t\tend: parser.index,\n268. \t\t\ttype: 'Ref',\n269. \t\t\tname: name.slice(4),\n270. \t\t};\n271. \t}", 'start_line_number': 243, 'end_line_number': 271}, {'relative_path': 'src/parse/state/tag.ts', 'content': '273. \tconst match = /^(in|out|transition):/.exec(name);\n274. \tif (match) {\n275. \t\treturn readTransitionDirective(\n276. \t\t\tparser,\n277. \t\t\tstart,\n278. \t\t\tname.slice(match[0].length),\n279. \t\t\tmatch[1]\n280. \t\t);\n281. \t}', 'start_line_number': 273, 'end_line_number': 281}, {'relative_path': 'src/parse/read/directives.ts', 'content': "5. function readExpression(parser: Parser, start: number, quoteMark: string|null) {\n6. \tlet str = '';\n7. \tlet escaped = false;\n8. \n9. \tfor (let i = start; i < parser.template.length; i += 1) {\n10. \t\tconst char = parser.template[i];\n11. \n12. \t\tif (quoteMark) {\n13. \t\t\tif (char === quoteMark) {\n14. \t\t\t\tif (escaped) {\n15. \t\t\t\t\tstr += quoteMark;\n16. \t\t\t\t} else {\n17. \t\t\t\t\tbreak;\n18. \t\t\t\t}\n19. \t\t\t} else if (escaped) {\n20. \t\t\t\tstr += '\\\\' + char;\n21. \t\t\t\tescaped = false;\n22. \t\t\t} else if (char === '\\\\') {\n23. \t\t\t\tescaped = true;\n24. \t\t\t} else {\n25. \t\t\t\tstr += char;\n26. \t\t\t}\n27. \t\t} else if (/\\s/.test(char)) {\n28. \t\t\tbreak;\n29. \t\t} else {\n30. \t\t\tstr += char;\n31. \t\t}\n32. \t}\n33. \n34. \tconst expression = parseExpressionAt(spaces(start) + str, start);\n35. \tparser.index = expression.end;\n36. \n37. \tparser.allowWhitespace();\n38. \tif (quoteMark) parser.eat(quoteMark, true);\n39. \n40. \treturn expression;\n41. }", 'start_line_number': 5, 'end_line_number': 41}, {'relative_path': 'src/parse/read/directives.ts', 'content': '43. export function readEventHandlerDirective(\n44. \tparser: Parser,\n45. \tstart: number,\n46. \tname: string,\n47. \thasValue: boolean\n48. ) {\n49. \tlet expression;\n50. \n51. \tif (hasValue) {\n52. \t\tconst quoteMark = parser.eat(`\'`) ? `\'` : parser.eat(`"`) ? `"` : null;\n53. \n54. \t\tconst expressionStart = parser.index;\n55. \n56. \t\texpression = readExpression(parser, expressionStart, quoteMark);\n57. \n58. \t\tif (expression.type !== \'CallExpression\') {\n59. \t\t\tparser.error(`Expected call expression`, expressionStart);\n60. \t\t}\n61. \t}\n62. \n63. \treturn {\n64. \t\tstart,\n65. \t\tend: parser.index,\n66. \t\ttype: \'EventHandler\',\n67. \t\tname,\n68. \t\texpression,\n69. \t};\n70. }', 'start_line_number': 43, 'end_line_number': 70}, {'relative_path': 'src/parse/read/directives.ts', 'content': '72. export function readBindingDirective(\n73. \tparser: Parser,\n74. \tstart: number,\n75. \tname: string\n76. ) {\n77. \tlet value;\n78. \n79. \tif (parser.eat(\'=\')) {\n80. \t\tconst quoteMark = parser.eat(`\'`) ? `\'` : parser.eat(`"`) ? `"` : null;\n81. \n82. \t\tconst a = parser.index;\n83. \n84. \t\tif (parser.eat(\'{{\')) {\n85. \t\t\tlet message = \'bound values should not be wrapped\';\n86. \t\t\tconst b = parser.template.indexOf(\'}}\', a);\n87. \t\t\tif (b !== -1) {\n88. \t\t\t\tconst value = parser.template.slice(parser.index, b);\n89. \t\t\t\tmessage += ` — use \'${value}\', not \'{{${value}}}\'`;\n90. \t\t\t}\n91. \n92. \t\t\tparser.error(message, a);\n93. \t\t}\n94. \n95. \t\t// this is a bit of a hack so that we can give Acorn something parseable\n96. \t\tlet b;\n97. \t\tif (quoteMark) {\n98. \t\t\tb = parser.index = parser.template.indexOf(quoteMark, parser.index);\n99. \t\t} else {\n100. \t\t\tparser.readUntil(/[\\s\\r\\n\\/>]/);\n101. \t\t\tb = parser.index;\n102. \t\t}\n103. \n104. \t\tconst source = spaces(a) + parser.template.slice(a, b);\n105. \t\tvalue = parseExpressionAt(source, a);\n106. \n107. \t\tif (value.type !== \'Identifier\' && value.type !== \'MemberExpression\') {\n108. \t\t\tparser.error(`Cannot bind to rvalue`, value.start);\n109. \t\t}\n110. \n111. \t\tparser.allowWhitespace();\n112. \n113. \t\tif (quoteMark) {\n114. \t\t\tparser.eat(quoteMark, true);\n115. \t\t}\n116. \t} else {\n117. \t\t// shorthand – bind:foo equivalent to bind:foo=\'foo\'\n118. \t\tvalue = {\n119. \t\t\ttype: \'Identifier\',\n120. \t\t\tstart: start + 5,\n121. \t\t\tend: parser.index,\n122. \t\t\tname,\n123. \t\t};\n124. \t}\n125. \n126. \treturn {\n127. \t\tstart,\n128. \t\tend: parser.index,\n129. \t\ttype: \'Binding\',\n130. \t\tname,\n131. \t\tvalue,\n132. \t};\n133. }', 'start_line_number': 72, 'end_line_number': 133}, {'relative_path': 'src/parse/read/directives.ts', 'content': '135. export function readTransitionDirective(\n136. \tparser: Parser,\n137. \tstart: number,\n138. \tname: string,\n139. \ttype: string\n140. ) {\n141. \tlet expression = null;\n142. \n143. \tif (parser.eat(\'=\')) {\n144. \t\tconst quoteMark = parser.eat(`\'`) ? `\'` : parser.eat(`"`) ? `"` : null;\n145. \n146. \t\tconst expressionStart = parser.index;\n147. \n148. \t\texpression = readExpression(parser, expressionStart, quoteMark);\n149. \n150. \t\tif (expression.type !== \'ObjectExpression\') {\n151. \t\t\tparser.error(`Expected object expression`, expressionStart);\n152. \t\t}\n153. \t}\n154. \n155. \treturn {\n156. \t\tstart,\n157. \t\tend: parser.index,\n158. \t\ttype: \'Transition\',\n159. \t\tname,\n160. \t\tintro: type === \'in\' || type === \'transition\',\n161. \t\toutro: type === \'out\' || type === \'transition\',\n162. \t\texpression,\n163. \t};\n164. }', 'start_line_number': 135, 'end_line_number': 164}, {'relative_path': 'src/css/Selector.ts', 'content': '28. \tapply(node: Node, stack: Node[]) {\n29. \t\tconst applies = selectorAppliesTo(this.localBlocks.slice(), node, stack.slice());\n30. \n31. \t\tif (applies) {\n32. \t\t\tthis.used = true;\n33. \n34. \t\t\t// add svelte-123xyz attribute to outermost and innermost\n35. \t\t\t// elements — no need to add it to intermediate elements\n36. \t\t\tnode._needsCssAttribute = true;\n37. \t\t\tif (stack[0] && this.node.children.find(isDescendantSelector)) stack[0]._needsCssAttribute = true;\n38. \t\t}\n39. \t}', 'start_line_number': 28, 'end_line_number': 39}, {'relative_path': 'src/css/Selector.ts', 'content': "113. function isDescendantSelector(selector: Node) {\n114. \treturn selector.type === 'WhiteSpace' || selector.type === 'Combinator';\n115. }", 'start_line_number': 113, 'end_line_number': 115}, {'relative_path': 'src/css/Selector.ts', 'content': "117. function selectorAppliesTo(blocks: Block[], node: Node, stack: Node[]): boolean {\n118. \tconst block = blocks.pop();\n119. \tif (!block) return false;\n120. \n121. \tif (!node) {\n122. \t\treturn blocks.every(block => block.global);\n123. \t}\n124. \n125. \tlet i = block.selectors.length;\n126. \tlet j = stack.length;\n127. \n128. \twhile (i--) {\n129. \t\tconst selector = block.selectors[i];\n130. \n131. \t\tif (selector.type === 'PseudoClassSelector' && selector.name === 'global') {\n132. \t\t\t// TODO shouldn't see this here... maybe we should enforce that :global(...)\n133. \t\t\t// cannot be sandwiched between non-global selectors?\n134. \t\t\treturn false;\n135. \t\t}\n136. \n137. \t\tif (selector.type === 'PseudoClassSelector' || selector.type === 'PseudoElementSelector') {\n138. \t\t\tcontinue;\n139. \t\t}\n140. \n141. \t\tif (selector.type === 'ClassSelector') {\n142. \t\t\tif (!attributeMatches(node, 'class', selector.name, '~=', false)) return false;\n143. \t\t}\n144. \n145. \t\telse if (selector.type === 'IdSelector') {\n146. \t\t\tif (!attributeMatches(node, 'id', selector.name, '=', false)) return false;\n147. \t\t}\n148. \n149. \t\telse if (selector.type === 'AttributeSelector') {\n150. \t\t\tif (!attributeMatches(node, selector.name.name, selector.value && unquote(selector.value.value), selector.operator, selector.flags)) return false;\n151. \t\t}\n152. \n153. \t\telse if (selector.type === 'TypeSelector') {\n154. \t\t\tif (node.name !== selector.name && selector.name !== '*') return false;\n155. \t\t}\n156. \n157. \t\telse {\n158. \t\t\t// bail. TODO figure out what these could be\n159. \t\t\treturn true;\n160. \t\t}\n161. \t}\n162. \n163. \tif (block.combinator) {\n164. \t\tif (block.combinator.type === 'WhiteSpace') {\n165. \t\t\twhile (stack.length) {\n166. \t\t\t\tif (selectorAppliesTo(blocks.slice(), stack.pop(), stack)) {\n167. \t\t\t\t\treturn true;\n168. \t\t\t\t}\n169. \t\t\t}\n170. \n171. \t\t\treturn false;\n172. \t\t} else if (block.combinator.name === '>') {\n173. \t\t\treturn selectorAppliesTo(blocks, stack.pop(), stack);\n174. \t\t}\n175. \n176. \t\t// TODO other combinators\n177. \t\treturn true;\n178. \t}\n179. \n180. \treturn true;\n181. }", 'start_line_number': 117, 'end_line_number': 181}, {'relative_path': 'src/css/Selector.ts', 'content': "54. \ttransform(code: MagicString, attr: string) {\n55. \t\tfunction encapsulateBlock(block: Block) {\n56. \t\t\tlet i = block.selectors.length;\n57. \t\t\twhile (i--) {\n58. \t\t\t\tconst selector = block.selectors[i];\n59. \t\t\t\tif (selector.type === 'PseudoElementSelector' || selector.type === 'PseudoClassSelector') continue;\n60. \n61. \t\t\t\tif (selector.type === 'TypeSelector' && selector.name === '*') {\n62. \t\t\t\t\tcode.overwrite(selector.start, selector.end, attr);\n63. \t\t\t\t} else {\n64. \t\t\t\t\tcode.appendLeft(selector.end, attr);\n65. \t\t\t\t}\n66. \n67. \t\t\t\treturn;\n68. \t\t\t}\n69. \t\t}\n70. \n71. \t\tthis.blocks.forEach((block, i) => {\n72. \t\t\tif (block.global) {\n73. \t\t\t\tconst selector = block.selectors[0];\n74. \t\t\t\tconst first = selector.children[0];\n75. \t\t\t\tconst last = selector.children[selector.children.length - 1];\n76. \t\t\t\tcode.remove(selector.start, first.start).remove(last.end, selector.end);\n77. \t\t\t} else if (i === 0 || i === this.blocks.length - 1) {\n78. \t\t\t\tencapsulateBlock(block);\n79. \t\t\t}\n80. \t\t});\n81. \t}", 'start_line_number': 54, 'end_line_number': 81}, {'relative_path': 'src/css/Stylesheet.ts', 'content': '218. \t\tthis.id = `svelte-${parsed.hash}`;\n219. ', 'start_line_number': 218, 'end_line_number': 219}, {'relative_path': 'src/css/Stylesheet.ts', 'content': '24. \tapply(node: Node, stack: Node[]) {\n25. \t\tthis.selectors.forEach(selector => selector.apply(node, stack)); // TODO move the logic in here?\n26. \t}', 'start_line_number': 24, 'end_line_number': 26}, {'relative_path': 'src/css/Stylesheet.ts', 'content': "64. \ttransform(code: MagicString, id: string, keyframes: Map<string, string>, cascade: boolean) {\n65. \t\tif (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;\n66. \n67. \t\tconst attr = `[${id}]`;\n68. \n69. \t\tif (cascade) {\n70. \t\t\tthis.selectors.forEach(selector => {\n71. \t\t\t\t// TODO disable cascading (without :global(...)) in v2\n72. \t\t\t\tconst { start, end, children } = selector.node;\n73. \n74. \t\t\t\tconst css = code.original;\n75. \t\t\t\tconst selectorString = css.slice(start, end);\n76. \n77. \t\t\t\tconst firstToken = children[0];\n78. \n79. \t\t\t\tlet transformed;\n80. \n81. \t\t\t\tif (firstToken.type === 'TypeSelector') {\n82. \t\t\t\t\tconst insert = firstToken.end;\n83. \t\t\t\t\tconst head = firstToken.name === '*' ? '' : css.slice(start, insert);\n84. \t\t\t\t\tconst tail = css.slice(insert, end);\n85. \n86. \t\t\t\t\ttransformed = `${head}${attr}${tail},${attr} ${selectorString}`;\n87. \t\t\t\t} else {\n88. \t\t\t\t\ttransformed = `${attr}${selectorString},${attr} ${selectorString}`;\n89. \t\t\t\t}\n90. \n91. \t\t\t\tcode.overwrite(start, end, transformed);\n92. \t\t\t});\n93. \t\t} else {\n94. \t\t\tthis.selectors.forEach(selector => selector.transform(code, attr));\n95. \t\t}\n96. \n97. \t\tthis.declarations.forEach(declaration => declaration.transform(code, keyframes));\n98. \t}", 'start_line_number': 64, 'end_line_number': 98}, {'relative_path': 'src/css/Stylesheet.ts', 'content': '266. \tapply(node: Node, stack: Node[]) {\n267. \t\tif (!this.hasStyles) return;\n268. \n269. \t\tif (this.cascade) {\n270. \t\t\tif (stack.length === 0) node._needsCssAttribute = true;\n271. \t\t\treturn;\n272. \t\t}\n273. \n274. \t\tfor (let i = 0; i < this.rules.length; i += 1) {\n275. \t\t\tconst rule = this.rules[i];\n276. \t\t\trule.apply(node, stack);\n277. \t\t}\n278. \t}', 'start_line_number': 266, 'end_line_number': 278}, {'relative_path': 'src/css/Stylesheet.ts', 'content': "180. \ttransform(code: MagicString, id: string, keyframes: Map<string, string>) {\n181. \t\tif (this.node.name !== 'keyframes') return;\n182. \n183. \t\tthis.node.expression.children.forEach((expression: Node) => {\n184. \t\t\tif (expression.type === 'Identifier') {\n185. \t\t\t\tif (expression.name.startsWith('-global-')) {\n186. \t\t\t\t\tcode.remove(expression.start, expression.start + 8);\n187. \t\t\t\t} else {\n188. \t\t\t\t\tconst newName = `${id}-${expression.name}`;\n189. \t\t\t\t\tcode.overwrite(expression.start, expression.end, newName);\n190. \t\t\t\t\tkeyframes.set(expression.name, newName);\n191. \t\t\t\t}\n192. \t\t\t}\n193. \t\t});\n194. \t}", 'start_line_number': 180, 'end_line_number': 194}, {'relative_path': 'src/generators/server-side-rendering/visitors/Element.ts', 'content': "59. \tif (node._needsCssAttribute) {\n60. \t\topeningTag += ` ${generator.stylesheet.id}`;\n61. \t}\n62. \n63. \topeningTag += '>';", 'start_line_number': 59, 'end_line_number': 63}, {'relative_path': 'src/generators/server-side-rendering/visitors/Element.ts', 'content': '43. \tnode.attributes.forEach((attribute: Node) => {\n44. \t\tif (attribute.type !== \'Attribute\') return;\n45. \n46. \t\tif (attribute.name === \'value\' && node.name === \'textarea\') {\n47. \t\t\ttextareaContents = stringifyAttributeValue(block, attribute.value);\n48. \t\t} else {\n49. \t\t\tlet str = ` ${attribute.name}`;\n50. \n51. \t\t\tif (attribute.value !== true) {\n52. \t\t\t\tstr += `="${stringifyAttributeValue(block, attribute.value)}"`;\n53. \t\t\t}\n54. \n55. \t\t\topeningTag += str;\n56. \t\t}\n57. \t});', 'start_line_number': 43, 'end_line_number': 57}, {'relative_path': 'src/generators/dom/visit.ts', 'content': '7. export default function visit(\n8. \tgenerator: DomGenerator,\n9. \tblock: Block,\n10. \tstate: State,\n11. \tnode: Node,\n12. \telementStack: Node[]\n13. ) {\n14. \tconst visitor = visitors[node.type];\n15. \tvisitor(generator, block, state, node, elementStack);\n16. }', 'start_line_number': 7, 'end_line_number': 16}]}]
2025-11-10 23:39:47,090 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 1 memories from memory
2025-11-10 23:39:47,090 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 18 contexts from memory
2025-11-10 23:39:47,091 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 18 contexts from memory
2025-11-10 23:39:47,092 - thread-133013312636608.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 18 new contexts to 18 existing contexts
2025-11-10 23:39:47,093 - thread-133013312636608.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 18 total contexts (removed 18 duplicates)
2025-11-10 23:39:47,095 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── src
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Component
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── preprocess.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Text.ts
|   |   |       ├── YieldTag.ts
|   |   |       ├── index.ts
|   |   |       └── meta
|   |   └── shared
|   |       └── utils
|   |           ├── getGlobals.ts
|   |           ├── getIntro.ts
|   |           ├── getOutro.ts
|   |           └── walkHtml.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getObject.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isVoidElementName.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── reservedNames.ts
|   |   ├── spaces.ts
|   |   ├── stringify.ts
|   |   └── trim.ts
|   └── validate
|       ├── html
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           ├── fuzzymatch.ts
|           └── list.ts
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── use-elements-as-anchors
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── pass-no-options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-onrender
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-static-type
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
using refs in css

Issue description: 
When I use a ref, I most often also want to get a handle to it with css, which leads to slightly annoying, duplicative markup.

```html
<style>
  .container {
    color: red
  }
</style>
<div class="container" ref:container></div>
```
 
The only solutions I can think of to mitigate this are untenable, but thought I raise this if others see something better.

- Make nodes with ids available as refs, like polymer's static node map
- Make svelte refs available as synthetic css selectors
- Make a syntax shortcut for declaring refs as classes, e.g. `<div ref:class:container ></div>`

Issue comments:


Find all relevant source code context and documentation needed to understand and implement this feature request.
Focus on production code (ignore test files) and follow these steps:
1. Identify similar existing features or components that this new feature should integrate with
2. Find relevant class definitions, interfaces, and API patterns used in the codebase
3. Locate related modules and services that the new feature will interact with
4. Include architectural patterns and code conventions used in similar implementations

Skip any test files

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of src/parse/read/directives.ts, src/parse/state/tag.ts, src/generators/dom/Block.ts, src/generators/dom/visit.ts, src/generators/server-side-rendering/visitors/Element.ts, src/css/Stylesheet.ts, src/css/Selector.ts, and README.md.
Extra Requirements: If sending entire files is too large, include at minimum the functions/classes that parse and represent ref directives, apply refs in DOM/SSR generation, and implement CSS scoping and selector handling.
Purpose: These files will reveal existing ref and CSS mechanisms, interfaces, and patterns needed to determine how to implement refs as CSS selectors or shortcuts and ensure architectural consistency.

Previous refined query 2:
Essential Query: Please provide the contents of src/generators/dom/Block.ts, src/generators/dom/index.ts, src/generators/dom/preprocess.ts, src/generators/dom/visitors/Element (main implementation file), src/interfaces.ts, src/shared/dom.js, src/shared/utils.js, and README.md.
Extra Requirements: If sending full files is too large, include at minimum the functions that process ref directives in the DOM generator, how refs are exposed at runtime, the Node/Element interface definitions, and the section(s) in README describing refs and CSS scoping.
Purpose: These files will reveal how refs are generated and used on the client, how CSS scoping attaches attributes, and the interfaces/patterns needed to design refs-as-selectors or shorthand class integration consistently.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: src/css/Selector.ts
Line number range: 28 - 39
Content:
28. 	apply(node: Node, stack: Node[]) {
29. 		const applies = selectorAppliesTo(this.localBlocks.slice(), node, stack.slice());
30. 
31. 		if (applies) {
32. 			this.used = true;
33. 
34. 			// add svelte-123xyz attribute to outermost and innermost
35. 			// elements — no need to add it to intermediate elements
36. 			node._needsCssAttribute = true;
37. 			if (stack[0] && this.node.children.find(isDescendantSelector)) stack[0]._needsCssAttribute = true;
38. 		}
39. 	}


File: src/css/Selector.ts
Line number range: 54 - 81
Content:
54. 	transform(code: MagicString, attr: string) {
55. 		function encapsulateBlock(block: Block) {
56. 			let i = block.selectors.length;
57. 			while (i--) {
58. 				const selector = block.selectors[i];
59. 				if (selector.type === 'PseudoElementSelector' || selector.type === 'PseudoClassSelector') continue;
60. 
61. 				if (selector.type === 'TypeSelector' && selector.name === '*') {
62. 					code.overwrite(selector.start, selector.end, attr);
63. 				} else {
64. 					code.appendLeft(selector.end, attr);
65. 				}
66. 
67. 				return;
68. 			}
69. 		}
70. 
71. 		this.blocks.forEach((block, i) => {
72. 			if (block.global) {
73. 				const selector = block.selectors[0];
74. 				const first = selector.children[0];
75. 				const last = selector.children[selector.children.length - 1];
76. 				code.remove(selector.start, first.start).remove(last.end, selector.end);
77. 			} else if (i === 0 || i === this.blocks.length - 1) {
78. 				encapsulateBlock(block);
79. 			}
80. 		});
81. 	}


File: src/css/Selector.ts
Line number range: 113 - 115
Content:
113. function isDescendantSelector(selector: Node) {
114. 	return selector.type === 'WhiteSpace' || selector.type === 'Combinator';
115. }


File: src/css/Selector.ts
Line number range: 117 - 181
Content:
117. function selectorAppliesTo(blocks: Block[], node: Node, stack: Node[]): boolean {
118. 	const block = blocks.pop();
119. 	if (!block) return false;
120. 
121. 	if (!node) {
122. 		return blocks.every(block => block.global);
123. 	}
124. 
125. 	let i = block.selectors.length;
126. 	let j = stack.length;
127. 
128. 	while (i--) {
129. 		const selector = block.selectors[i];
130. 
131. 		if (selector.type === 'PseudoClassSelector' && selector.name === 'global') {
132. 			// TODO shouldn't see this here... maybe we should enforce that :global(...)
133. 			// cannot be sandwiched between non-global selectors?
134. 			return false;
135. 		}
136. 
137. 		if (selector.type === 'PseudoClassSelector' || selector.type === 'PseudoElementSelector') {
138. 			continue;
139. 		}
140. 
141. 		if (selector.type === 'ClassSelector') {
142. 			if (!attributeMatches(node, 'class', selector.name, '~=', false)) return false;
143. 		}
144. 
145. 		else if (selector.type === 'IdSelector') {
146. 			if (!attributeMatches(node, 'id', selector.name, '=', false)) return false;
147. 		}
148. 
149. 		else if (selector.type === 'AttributeSelector') {
150. 			if (!attributeMatches(node, selector.name.name, selector.value && unquote(selector.value.value), selector.operator, selector.flags)) return false;
151. 		}
152. 
153. 		else if (selector.type === 'TypeSelector') {
154. 			if (node.name !== selector.name && selector.name !== '*') return false;
155. 		}
156. 
157. 		else {
158. 			// bail. TODO figure out what these could be
159. 			return true;
160. 		}
161. 	}
162. 
163. 	if (block.combinator) {
164. 		if (block.combinator.type === 'WhiteSpace') {
165. 			while (stack.length) {
166. 				if (selectorAppliesTo(blocks.slice(), stack.pop(), stack)) {
167. 					return true;
168. 				}
169. 			}
170. 
171. 			return false;
172. 		} else if (block.combinator.name === '>') {
173. 			return selectorAppliesTo(blocks, stack.pop(), stack);
174. 		}
175. 
176. 		// TODO other combinators
177. 		return true;
178. 	}
179. 
180. 	return true;
181. }


File: src/css/Stylesheet.ts
Line number range: 24 - 26
Content:
24. 	apply(node: Node, stack: Node[]) {
25. 		this.selectors.forEach(selector => selector.apply(node, stack)); // TODO move the logic in here?
26. 	}


File: src/css/Stylesheet.ts
Line number range: 64 - 98
Content:
64. 	transform(code: MagicString, id: string, keyframes: Map<string, string>, cascade: boolean) {
65. 		if (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;
66. 
67. 		const attr = `[${id}]`;
68. 
69. 		if (cascade) {
70. 			this.selectors.forEach(selector => {
71. 				// TODO disable cascading (without :global(...)) in v2
72. 				const { start, end, children } = selector.node;
73. 
74. 				const css = code.original;
75. 				const selectorString = css.slice(start, end);
76. 
77. 				const firstToken = children[0];
78. 
79. 				let transformed;
80. 
81. 				if (firstToken.type === 'TypeSelector') {
82. 					const insert = firstToken.end;
83. 					const head = firstToken.name === '*' ? '' : css.slice(start, insert);
84. 					const tail = css.slice(insert, end);
85. 
86. 					transformed = `${head}${attr}${tail},${attr} ${selectorString}`;
87. 				} else {
88. 					transformed = `${attr}${selectorString},${attr} ${selectorString}`;
89. 				}
90. 
91. 				code.overwrite(start, end, transformed);
92. 			});
93. 		} else {
94. 			this.selectors.forEach(selector => selector.transform(code, attr));
95. 		}
96. 
97. 		this.declarations.forEach(declaration => declaration.transform(code, keyframes));
98. 	}


File: src/css/Stylesheet.ts
Line number range: 180 - 194
Content:
180. 	transform(code: MagicString, id: string, keyframes: Map<string, string>) {
181. 		if (this.node.name !== 'keyframes') return;
182. 
183. 		this.node.expression.children.forEach((expression: Node) => {
184. 			if (expression.type === 'Identifier') {
185. 				if (expression.name.startsWith('-global-')) {
186. 					code.remove(expression.start, expression.start + 8);
187. 				} else {
188. 					const newName = `${id}-${expression.name}`;
189. 					code.overwrite(expression.start, expression.end, newName);
190. 					keyframes.set(expression.name, newName);
191. 				}
192. 			}
193. 		});
194. 	}


File: src/css/Stylesheet.ts
Line number range: 218 - 219
Content:
218. 		this.id = `svelte-${parsed.hash}`;
219. 


File: src/css/Stylesheet.ts
Line number range: 266 - 278
Content:
266. 	apply(node: Node, stack: Node[]) {
267. 		if (!this.hasStyles) return;
268. 
269. 		if (this.cascade) {
270. 			if (stack.length === 0) node._needsCssAttribute = true;
271. 			return;
272. 		}
273. 
274. 		for (let i = 0; i < this.rules.length; i += 1) {
275. 			const rule = this.rules[i];
276. 			rule.apply(node, stack);
277. 		}
278. 	}


File: src/generators/dom/visit.ts
Line number range: 7 - 16
Content:
7. export default function visit(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	elementStack: Node[]
13. ) {
14. 	const visitor = visitors[node.type];
15. 	visitor(generator, block, state, node, elementStack);
16. }


File: src/generators/server-side-rendering/visitors/Element.ts
Line number range: 43 - 57
Content:
43. 	node.attributes.forEach((attribute: Node) => {
44. 		if (attribute.type !== 'Attribute') return;
45. 
46. 		if (attribute.name === 'value' && node.name === 'textarea') {
47. 			textareaContents = stringifyAttributeValue(block, attribute.value);
48. 		} else {
49. 			let str = ` ${attribute.name}`;
50. 
51. 			if (attribute.value !== true) {
52. 				str += `="${stringifyAttributeValue(block, attribute.value)}"`;
53. 			}
54. 
55. 			openingTag += str;
56. 		}
57. 	});


File: src/generators/server-side-rendering/visitors/Element.ts
Line number range: 59 - 63
Content:
59. 	if (node._needsCssAttribute) {
60. 		openingTag += ` ${generator.stylesheet.id}`;
61. 	}
62. 
63. 	openingTag += '>';


File: src/parse/read/directives.ts
Line number range: 5 - 41
Content:
5. function readExpression(parser: Parser, start: number, quoteMark: string|null) {
6. 	let str = '';
7. 	let escaped = false;
8. 
9. 	for (let i = start; i < parser.template.length; i += 1) {
10. 		const char = parser.template[i];
11. 
12. 		if (quoteMark) {
13. 			if (char === quoteMark) {
14. 				if (escaped) {
15. 					str += quoteMark;
16. 				} else {
17. 					break;
18. 				}
19. 			} else if (escaped) {
20. 				str += '\\' + char;
21. 				escaped = false;
22. 			} else if (char === '\\') {
23. 				escaped = true;
24. 			} else {
25. 				str += char;
26. 			}
27. 		} else if (/\s/.test(char)) {
28. 			break;
29. 		} else {
30. 			str += char;
31. 		}
32. 	}
33. 
34. 	const expression = parseExpressionAt(spaces(start) + str, start);
35. 	parser.index = expression.end;
36. 
37. 	parser.allowWhitespace();
38. 	if (quoteMark) parser.eat(quoteMark, true);
39. 
40. 	return expression;
41. }


File: src/parse/read/directives.ts
Line number range: 43 - 70
Content:
43. export function readEventHandlerDirective(
44. 	parser: Parser,
45. 	start: number,
46. 	name: string,
47. 	hasValue: boolean
48. ) {
49. 	let expression;
50. 
51. 	if (hasValue) {
52. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
53. 
54. 		const expressionStart = parser.index;
55. 
56. 		expression = readExpression(parser, expressionStart, quoteMark);
57. 
58. 		if (expression.type !== 'CallExpression') {
59. 			parser.error(`Expected call expression`, expressionStart);
60. 		}
61. 	}
62. 
63. 	return {
64. 		start,
65. 		end: parser.index,
66. 		type: 'EventHandler',
67. 		name,
68. 		expression,
69. 	};
70. }


File: src/parse/read/directives.ts
Line number range: 72 - 133
Content:
72. export function readBindingDirective(
73. 	parser: Parser,
74. 	start: number,
75. 	name: string
76. ) {
77. 	let value;
78. 
79. 	if (parser.eat('=')) {
80. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
81. 
82. 		const a = parser.index;
83. 
84. 		if (parser.eat('{{')) {
85. 			let message = 'bound values should not be wrapped';
86. 			const b = parser.template.indexOf('}}', a);
87. 			if (b !== -1) {
88. 				const value = parser.template.slice(parser.index, b);
89. 				message += ` — use '${value}', not '{{${value}}}'`;
90. 			}
91. 
92. 			parser.error(message, a);
93. 		}
94. 
95. 		// this is a bit of a hack so that we can give Acorn something parseable
96. 		let b;
97. 		if (quoteMark) {
98. 			b = parser.index = parser.template.indexOf(quoteMark, parser.index);
99. 		} else {
100. 			parser.readUntil(/[\s\r\n\/>]/);
101. 			b = parser.index;
102. 		}
103. 
104. 		const source = spaces(a) + parser.template.slice(a, b);
105. 		value = parseExpressionAt(source, a);
106. 
107. 		if (value.type !== 'Identifier' && value.type !== 'MemberExpression') {
108. 			parser.error(`Cannot bind to rvalue`, value.start);
109. 		}
110. 
111. 		parser.allowWhitespace();
112. 
113. 		if (quoteMark) {
114. 			parser.eat(quoteMark, true);
115. 		}
116. 	} else {
117. 		// shorthand – bind:foo equivalent to bind:foo='foo'
118. 		value = {
119. 			type: 'Identifier',
120. 			start: start + 5,
121. 			end: parser.index,
122. 			name,
123. 		};
124. 	}
125. 
126. 	return {
127. 		start,
128. 		end: parser.index,
129. 		type: 'Binding',
130. 		name,
131. 		value,
132. 	};
133. }


File: src/parse/read/directives.ts
Line number range: 135 - 164
Content:
135. export function readTransitionDirective(
136. 	parser: Parser,
137. 	start: number,
138. 	name: string,
139. 	type: string
140. ) {
141. 	let expression = null;
142. 
143. 	if (parser.eat('=')) {
144. 		const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
145. 
146. 		const expressionStart = parser.index;
147. 
148. 		expression = readExpression(parser, expressionStart, quoteMark);
149. 
150. 		if (expression.type !== 'ObjectExpression') {
151. 			parser.error(`Expected object expression`, expressionStart);
152. 		}
153. 	}
154. 
155. 	return {
156. 		start,
157. 		end: parser.index,
158. 		type: 'Transition',
159. 		name,
160. 		intro: type === 'in' || type === 'transition',
161. 		outro: type === 'out' || type === 'transition',
162. 		expression,
163. 	};
164. }


File: src/parse/state/tag.ts
Line number range: 243 - 271
Content:
243. function readAttribute(parser: Parser, uniqueNames: Set<string>) {
244. 	const start = parser.index;
245. 
246. 	let name = parser.readUntil(/(\s|=|\/|>)/);
247. 	if (!name) return null;
248. 	if (uniqueNames.has(name)) {
249. 		parser.error('Attributes need to be unique', start);
250. 	}
251. 
252. 	uniqueNames.add(name);
253. 
254. 	parser.allowWhitespace();
255. 
256. 	if (/^on:/.test(name)) {
257. 		return readEventHandlerDirective(parser, start, name.slice(3), parser.eat('='));
258. 	}
259. 
260. 	if (/^bind:/.test(name)) {
261. 		return readBindingDirective(parser, start, name.slice(5));
262. 	}
263. 
264. 	if (/^ref:/.test(name)) {
265. 		return {
266. 			start,
267. 			end: parser.index,
268. 			type: 'Ref',
269. 			name: name.slice(4),
270. 		};
271. 	}


File: src/parse/state/tag.ts
Line number range: 273 - 281
Content:
273. 	const match = /^(in|out|transition):/.exec(name);
274. 	if (match) {
275. 		return readTransitionDirective(
276. 			parser,
277. 			start,
278. 			name.slice(match[0].length),
279. 			match[1]
280. 		);
281. 	}

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-10 23:40:29,376 - thread-133013312636608.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We have parsing for ref directives and CSS scoping selectors plus an SSR element visitor, but we’re missing critical client-side generation and runtime pieces that consume Ref directives, the base Generator/Block architecture that applies CSS attributes, the Node/Element interfaces, and documentation about refs and CSS. Without DOM Element visitor/ref handling, runtime APIs (this.refs), and CSS attribute matching helpers, we can’t identify all integration points or follow established patterns.' query='Please provide the implementations and docs that handle Ref directives and CSS scoping: the Generator/Block classes, DOM Element visitor/runtime ref mapping, SSR index/preprocess, Node/Element interfaces, css attribute matching helpers, and README sections on refs/CSS.' extra_requirements='If full files are large, include at minimum the code that maps refs to this.refs, where the CSS scoping attribute is added in DOM/SSR, the Node/Element interface showing Ref representation, and the README sections describing refs and CSS scoping.' purpose='These contexts are essential to pinpoint integration points and conventions to design refs-as-selectors or shorthand class/id behavior consistently across DOM and SSR.'
2025-11-10 23:40:29,377 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the implementations and docs that handle Ref directives and CSS scoping: the Generator/Block classes, DOM Element visitor/runtime ref mapping, SSR index/preprocess, Node/Element interfaces, css attribute matching helpers, and README sections on refs/CSS.
2025-11-10 23:40:32,165 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-10 23:40:32,166 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-10 23:40:32,166 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-10 23:40:32,166 - thread-133013312636608.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-10 23:40:32,167 - thread-133013312636608.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-10 23:40:32,168 - thread-133013312636608.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-10 23:40:32,168 - thread-133013312636608.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the implementations and docs that handle Ref directives and CSS scoping: the Generator/Block classes, DOM Element visitor/runtime ref mapping, SSR index/preprocess, Node/Element interfaces, css attribute matching helpers, and README sections on refs/CSS.
Extra requirements: If full files are large, include at minimum the code that maps refs to this.refs, where the CSS scoping attribute is added in DOM/SSR, the Node/Element interface showing Ref representation, and the README sections describing refs and CSS scoping.
Purpose: These contexts are essential to pinpoint integration points and conventions to design refs-as-selectors or shorthand class/id behavior consistently across DOM and SSR.
2025-11-10 23:40:39,272 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_n1e4PhS0ygreVLEscim0DfgM', 'function': {'arguments': '{"basename":"README.md"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 669, 'prompt_tokens': 2233, 'total_tokens': 2902, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--146daba2-d079-4aa9-92d6-5330a800b8d0-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'README.md'}, 'id': 'call_n1e4PhS0ygreVLEscim0DfgM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2233, 'output_tokens': 669, 'total_tokens': 2902, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-10 23:40:48,500 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZXOnsvwaSvuOh0fVmXZqWaPD', 'function': {'arguments': '{"basename":"generator.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 925, 'prompt_tokens': 2336, 'total_tokens': 3261, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 896, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4bb23fe1-f286-478b-9861-d3661540a428-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'generator.ts'}, 'id': 'call_ZXOnsvwaSvuOh0fVmXZqWaPD', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2336, 'output_tokens': 925, 'total_tokens': 3261, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 896}}
2025-11-10 23:41:22,026 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Y7N2YBq873mUXoiMX3GSmK1e', 'function': {'arguments': '{"relative_path":"README.md"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2911, 'prompt_tokens': 2385, 'total_tokens': 5296, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2880, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1c328c14-5e35-46ae-9405-3dd3546e67ae-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'README.md'}, 'id': 'call_Y7N2YBq873mUXoiMX3GSmK1e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2385, 'output_tokens': 2911, 'total_tokens': 5296, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 2880}}
2025-11-10 23:41:25,142 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_GBHxToADB5Z3H7gLdzjCRzBE', 'function': {'arguments': '{"relative_path":"test/js/README.md"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 162, 'prompt_tokens': 4476, 'total_tokens': 4638, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--feb8a9a9-f178-4d51-8cce-aa49298a8003-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/js/README.md'}, 'id': 'call_GBHxToADB5Z3H7gLdzjCRzBE', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4476, 'output_tokens': 162, 'total_tokens': 4638, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-10 23:41:30,102 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_TTsYMQqp0XnDGGE9VdXtsODd', 'function': {'arguments': '{"basename":"src"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 348, 'prompt_tokens': 4595, 'total_tokens': 4943, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c511118e-4773-4c74-9e02-04ff38794510-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'src'}, 'id': 'call_TTsYMQqp0XnDGGE9VdXtsODd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4595, 'output_tokens': 348, 'total_tokens': 4943, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-10 23:41:31,157 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_mNDz5PwmLbTWdDo54gMwEAUb', 'function': {'arguments': '{"relative_path":"src"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 4660, 'total_tokens': 4683, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--33fd7c64-d942-4c9a-bf51-99ee06b90cd3-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src'}, 'id': 'call_mNDz5PwmLbTWdDo54gMwEAUb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4660, 'output_tokens': 23, 'total_tokens': 4683, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:41:32,471 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_edSFy7jCjm7aNLXftgDzL1pO', 'function': {'arguments': '{"basename":"index.js"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 4726, 'total_tokens': 4749, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a7223237-3ae9-4eb0-aa7e-0e416b63f767-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'index.js'}, 'id': 'call_edSFy7jCjm7aNLXftgDzL1pO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4726, 'output_tokens': 23, 'total_tokens': 4749, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:41:35,253 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_KxXR9Yh4UuFi6vSB0MOuXflX', 'function': {'arguments': '{"basename":"Block.js"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 157, 'prompt_tokens': 4938, 'total_tokens': 5095, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--40563979-fd68-4ea8-aaaf-6c2b9cd4d101-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Block.js'}, 'id': 'call_KxXR9Yh4UuFi6vSB0MOuXflX', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4938, 'output_tokens': 157, 'total_tokens': 5095, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-10 23:41:40,619 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_w8otH2fMewi5QpfP4mDVINwl', 'function': {'arguments': '{"relative_path":"src/compile/render_dom/Block.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 292, 'prompt_tokens': 4987, 'total_tokens': 5279, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3e25a8ae-8200-4805-8d3f-d51e81bd1e35-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/compile/render_dom/Block.js'}, 'id': 'call_w8otH2fMewi5QpfP4mDVINwl', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4987, 'output_tokens': 292, 'total_tokens': 5279, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-10 23:41:44,455 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_bNpU07yfgoJOAgXoo8anwONo', 'function': {'arguments': '{"basename":"shared.js"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 221, 'prompt_tokens': 5043, 'total_tokens': 5264, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4480}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3efe799f-50c5-49ed-80a0-8b25c6470db4-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'shared.js'}, 'id': 'call_bNpU07yfgoJOAgXoo8anwONo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5043, 'output_tokens': 221, 'total_tokens': 5264, 'input_token_details': {'audio': 0, 'cache_read': 4480}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-10 23:41:49,423 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_HmPVyWeB4vN40WUNptncLKLb', 'function': {'arguments': '{"basename":"Element.js"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 349, 'prompt_tokens': 5092, 'total_tokens': 5441, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4352}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--779ee354-f1f9-48f3-adcb-69e550845e3d-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Element.js'}, 'id': 'call_HmPVyWeB4vN40WUNptncLKLb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5092, 'output_tokens': 349, 'total_tokens': 5441, 'input_token_details': {'audio': 0, 'cache_read': 4352}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-10 23:41:54,289 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_LrVmQFgy14sBg94n35GHWw61', 'function': {'arguments': '{"basename":"compiler.js"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 221, 'prompt_tokens': 5141, 'total_tokens': 5362, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--474aade3-b441-433d-818f-0b2f2794914e-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'compiler.js'}, 'id': 'call_LrVmQFgy14sBg94n35GHWw61', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5141, 'output_tokens': 221, 'total_tokens': 5362, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-10 23:41:56,601 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3kta60f5AkJNYHsJWQKZ2QDc', 'function': {'arguments': '{"basename":"generator.js"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 157, 'prompt_tokens': 5190, 'total_tokens': 5347, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4608}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7a2270eb-f88d-490c-9d8e-b97f00cf1cc8-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'generator.js'}, 'id': 'call_3kta60f5AkJNYHsJWQKZ2QDc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5190, 'output_tokens': 157, 'total_tokens': 5347, 'input_token_details': {'audio': 0, 'cache_read': 4608}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-10 23:42:01,228 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_7cV82uXNkqqcBbyDUmZavkn5', 'function': {'arguments': '{"basename":"render_ssr"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 414, 'prompt_tokens': 5239, 'total_tokens': 5653, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5a413982-574c-4439-a4fb-bcfb11ea5e4b-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'render_ssr'}, 'id': 'call_7cV82uXNkqqcBbyDUmZavkn5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5239, 'output_tokens': 414, 'total_tokens': 5653, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-10 23:42:09,057 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_UVZEHCfsaYMCA5VOa2t9NC4U', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 804, 'prompt_tokens': 5289, 'total_tokens': 6093, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5120}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c4eedda4-0e78-40a6-ac53-16826cf10fdc-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/index.js'}, 'id': 'call_UVZEHCfsaYMCA5VOa2t9NC4U', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5289, 'output_tokens': 804, 'total_tokens': 6093, 'input_token_details': {'audio': 0, 'cache_read': 5120}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-10 23:42:11,245 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0F9MCknOVAkLOzHPOy4VrbVi', 'function': {'arguments': '{"basename":"docs"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 92, 'prompt_tokens': 6727, 'total_tokens': 6819, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5248}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f921ba25-0fc4-42f9-a592-3dd4ca3214bc-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'docs'}, 'id': 'call_0F9MCknOVAkLOzHPOy4VrbVi', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6727, 'output_tokens': 92, 'total_tokens': 6819, 'input_token_details': {'audio': 0, 'cache_read': 5248}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-10 23:42:16,258 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lwY1ZMlI0uSMMb2ffDjhYQCo', 'function': {'arguments': '{"text":"ref"}', 'name': 'find_text_node_with_text'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 347, 'prompt_tokens': 6775, 'total_tokens': 7122, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4864}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--59dd7909-d695-4c75-aafe-1969cf3b37dc-0' tool_calls=[{'name': 'find_text_node_with_text', 'args': {'text': 'ref'}, 'id': 'call_lwY1ZMlI0uSMMb2ffDjhYQCo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6775, 'output_tokens': 347, 'total_tokens': 7122, 'input_token_details': {'audio': 0, 'cache_read': 4864}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-10 23:42:21,027 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Grskv0ffZVHlt0brAiFSBrt8', 'function': {'arguments': '{"basename":"runtime"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 412, 'prompt_tokens': 13895, 'total_tokens': 14307, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6656}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2291c7c8-e334-4dd6-9f82-1e3b4d9b5c9a-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'runtime'}, 'id': 'call_Grskv0ffZVHlt0brAiFSBrt8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13895, 'output_tokens': 412, 'total_tokens': 14307, 'input_token_details': {'audio': 0, 'cache_read': 6656}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-10 23:42:26,251 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_e1Umyn98YPHZwd9mFUyqoJrD', 'function': {'arguments': '{"basename":"Element.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 285, 'prompt_tokens': 13961, 'total_tokens': 14246, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4873554d-fcd5-4421-af46-e74366964f7e-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Element.ts'}, 'id': 'call_e1Umyn98YPHZwd9mFUyqoJrD', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13961, 'output_tokens': 285, 'total_tokens': 14246, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-10 23:42:28,205 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_8lECEPVHFZ1czFB8cb6DT0P6', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/Element.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 14084, 'total_tokens': 14120, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6656}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--42a10094-9b12-4dcd-aa51-3f33575d7a0b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/Element.ts'}, 'id': 'call_8lECEPVHFZ1czFB8cb6DT0P6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14084, 'output_tokens': 36, 'total_tokens': 14120, 'input_token_details': {'audio': 0, 'cache_read': 6656}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:30,503 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_CuVRPLW77ZdjOcLtaUL13PGv', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/Element.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 17134, 'total_tokens': 17171, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4736}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9bee1520-f985-4d42-94ae-5aec659673c0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/Element.ts'}, 'id': 'call_CuVRPLW77ZdjOcLtaUL13PGv', 'type': 'tool_call'}] usage_metadata={'input_tokens': 17134, 'output_tokens': 37, 'total_tokens': 17171, 'input_token_details': {'audio': 0, 'cache_read': 4736}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:33,907 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hWAyopauSeaS4JAnDIYB3NsW', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/Ref.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 169, 'prompt_tokens': 18120, 'total_tokens': 18289, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 13952}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--dc239caa-7b0e-454c-a446-aa5df39477ef-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/dom/visitors/Element/Ref.ts'}, 'id': 'call_hWAyopauSeaS4JAnDIYB3NsW', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18120, 'output_tokens': 169, 'total_tokens': 18289, 'input_token_details': {'audio': 0, 'cache_read': 13952}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-10 23:42:36,361 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1uRV0PuoF3Ln18dMUjgFXn2c', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/Ref.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 18211, 'total_tokens': 18247, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 13824}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--de06045b-a670-43eb-ada8-9ca11fc41679-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/Ref.ts'}, 'id': 'call_1uRV0PuoF3Ln18dMUjgFXn2c', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18211, 'output_tokens': 36, 'total_tokens': 18247, 'input_token_details': {'audio': 0, 'cache_read': 13824}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:39,479 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0MdhK2RfoIrW5ENp2pcvVCsf', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/Ref.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 18581, 'total_tokens': 18617, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 17152}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0ce984a1-2ac7-4981-b9dc-89bc2f566abb-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/Ref.ts'}, 'id': 'call_0MdhK2RfoIrW5ENp2pcvVCsf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18581, 'output_tokens': 36, 'total_tokens': 18617, 'input_token_details': {'audio': 0, 'cache_read': 17152}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:41,213 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_kjOux1GWAv22kPPiehy0fkgw', 'function': {'arguments': '{"basename":"Block.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 18643, 'total_tokens': 18666, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 18560}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b77f9809-6053-42f2-8065-f01ee936a09c-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Block.ts'}, 'id': 'call_kjOux1GWAv22kPPiehy0fkgw', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18643, 'output_tokens': 23, 'total_tokens': 18666, 'input_token_details': {'audio': 0, 'cache_read': 18560}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:44,196 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_i0WLZa32tq0RFBg6OKrnGeMA', 'function': {'arguments': '{"relative_path":"src/generators/dom/Block.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 18758, 'total_tokens': 18789, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4992}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3374525d-56ef-46fa-9c1d-5fa392b1a90a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/Block.ts'}, 'id': 'call_i0WLZa32tq0RFBg6OKrnGeMA', 'type': 'tool_call'}] usage_metadata={'input_tokens': 18758, 'output_tokens': 31, 'total_tokens': 18789, 'input_token_details': {'audio': 0, 'cache_read': 4992}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:45,854 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_7nIr7GuZTwCnKbZ8AnTo9bp5', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/Block.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 23109, 'total_tokens': 23143, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ce7f06ce-9af0-43a9-9d78-bde8da490a0f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/Block.ts'}, 'id': 'call_7nIr7GuZTwCnKbZ8AnTo9bp5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23109, 'output_tokens': 34, 'total_tokens': 23143, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:47,305 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_i4Iaeqwi1Xv39QcwsMmV5QAe', 'function': {'arguments': '{"basename":"interfaces.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 23793, 'total_tokens': 23816, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 18176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3f922011-58ff-4a6c-a268-9965554e59b7-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'interfaces.ts'}, 'id': 'call_i4Iaeqwi1Xv39QcwsMmV5QAe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23793, 'output_tokens': 23, 'total_tokens': 23816, 'input_token_details': {'audio': 0, 'cache_read': 18176}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:49,325 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_qIXkhkaBofkVCU8gk3luzXOa', 'function': {'arguments': '{"relative_path":"src/interfaces.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 23899, 'total_tokens': 23925, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4864}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--be796010-265b-45e3-89b3-0e152b49b0ac-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/interfaces.ts'}, 'id': 'call_qIXkhkaBofkVCU8gk3luzXOa', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23899, 'output_tokens': 26, 'total_tokens': 23925, 'input_token_details': {'audio': 0, 'cache_read': 4864}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:51,630 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_rUGOkeVzgyySfWKbR3lKILM1', 'function': {'arguments': '{"relative_path":"src/generators/dom/interfaces.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 24594, 'total_tokens': 24624, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 18048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3cbe520c-4061-47b4-8f8f-05f1c3b6341c-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/interfaces.ts'}, 'id': 'call_rUGOkeVzgyySfWKbR3lKILM1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 24594, 'output_tokens': 30, 'total_tokens': 24624, 'input_token_details': {'audio': 0, 'cache_read': 18048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:53,605 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_G3C3063EuDJ7i6V36VOI9pwa', 'function': {'arguments': '{"basename":"Generator.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 24818, 'total_tokens': 24841, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 23808}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--256db1c3-2f1d-4fea-96f9-6966b67a3d17-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Generator.ts'}, 'id': 'call_G3C3063EuDJ7i6V36VOI9pwa', 'type': 'tool_call'}] usage_metadata={'input_tokens': 24818, 'output_tokens': 23, 'total_tokens': 24841, 'input_token_details': {'audio': 0, 'cache_read': 23808}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:55,215 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_im3ZWmTWtOEViXfKo32eS1GW', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 24891, 'total_tokens': 24921, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 24576}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--acda85a2-3848-4f2a-bf92-85379f15eb18-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/Generator.ts'}, 'id': 'call_im3ZWmTWtOEViXfKo32eS1GW', 'type': 'tool_call'}] usage_metadata={'input_tokens': 24891, 'output_tokens': 30, 'total_tokens': 24921, 'input_token_details': {'audio': 0, 'cache_read': 24576}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:42:57,352 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_IfV5wdtPhZgtJ1rmKYtxPTOs', 'function': {'arguments': '{"relative_path":"src/generators/Generator.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 31209, 'total_tokens': 31239, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5120}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--94376e1a-7684-4c81-8717-ea88d3cf738a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/Generator.ts'}, 'id': 'call_IfV5wdtPhZgtJ1rmKYtxPTOs', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31209, 'output_tokens': 30, 'total_tokens': 31239, 'input_token_details': {'audio': 0, 'cache_read': 5120}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:01,408 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_aXUxHIOItsR1818er5YXMLfC', 'function': {'arguments': '{"text":"encapsulateStyles", "relative_path":"src/generators/dom/visitors/Element/Element.ts"}', 'name': 'find_ast_node_with_text_in_file_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 47, 'prompt_tokens': 37527, 'total_tokens': 37574, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 14080}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--51fa3387-de8a-4c08-8da3-e935ce2c667d-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'encapsulateStyles', 'relative_path': 'src/generators/dom/visitors/Element/Element.ts'}, 'id': 'call_aXUxHIOItsR1818er5YXMLfC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37527, 'output_tokens': 47, 'total_tokens': 37574, 'input_token_details': {'audio': 0, 'cache_read': 14080}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:03,549 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_2I7j4eIW4bg1EzOsY4XrhcFC', 'function': {'arguments': '{"relative_path":"src/generators/dom/index.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 39333, 'total_tokens': 39362, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 23808}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9018eaf4-ced1-4eba-82c6-5472d3a76d69-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/dom/index.ts'}, 'id': 'call_2I7j4eIW4bg1EzOsY4XrhcFC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 39333, 'output_tokens': 29, 'total_tokens': 39362, 'input_token_details': {'audio': 0, 'cache_read': 23808}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:05,561 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JruDZvsTfntMmH4bqXvDB2xB', 'function': {'arguments': '{"relative_path":"src/generators/dom/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 39412, 'total_tokens': 39442, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 18560}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bbd00efe-9108-422a-8d3a-7fd0aa2828e2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/index.ts'}, 'id': 'call_JruDZvsTfntMmH4bqXvDB2xB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 39412, 'output_tokens': 30, 'total_tokens': 39442, 'input_token_details': {'audio': 0, 'cache_read': 18560}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:08,393 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_iaTmLMK2PcKluvtlQvlgtGhO', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 44618, 'total_tokens': 44650, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bf590c41-308b-4dd6-b51d-305abb7ee23c-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts'}, 'id': 'call_iaTmLMK2PcKluvtlQvlgtGhO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 44618, 'output_tokens': 32, 'total_tokens': 44650, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:12,442 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_RwOqIBMnSLjHSzYgcWN2rBUG', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 44703, 'total_tokens': 44736, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 24832}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a1bfdbf9-43ab-4323-9858-ef2c94aadb4f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts'}, 'id': 'call_RwOqIBMnSLjHSzYgcWN2rBUG', 'type': 'tool_call'}] usage_metadata={'input_tokens': 44703, 'output_tokens': 33, 'total_tokens': 44736, 'input_token_details': {'audio': 0, 'cache_read': 24832}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:15,566 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_F6IBul8QirpXwTmZgVmUWtiu', 'function': {'arguments': '{"basename":"preprocess.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 46989, 'total_tokens': 47013, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 18688}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cd27c9ac-c3ad-4316-92ae-8cbf8c728e08-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'preprocess.ts'}, 'id': 'call_F6IBul8QirpXwTmZgVmUWtiu', 'type': 'tool_call'}] usage_metadata={'input_tokens': 46989, 'output_tokens': 24, 'total_tokens': 47013, 'input_token_details': {'audio': 0, 'cache_read': 18688}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:18,577 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_aJjL7gEK13jLsjInm44PTmjO', 'function': {'arguments': '{"relative_path":"src/generators/dom/preprocess.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 47107, 'total_tokens': 47138, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 39296}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d05729d9-42a7-40aa-b7d8-8ffdcbdfa664-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/preprocess.ts'}, 'id': 'call_aJjL7gEK13jLsjInm44PTmjO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 47107, 'output_tokens': 31, 'total_tokens': 47138, 'input_token_details': {'audio': 0, 'cache_read': 39296}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:20,937 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_dU4uYVvTzjEzsHIxLr1kS4Nb', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/preprocess.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 52865, 'total_tokens': 52899, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 31232}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--83763ac6-058b-4645-badf-f632a6c75a76-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/preprocess.ts'}, 'id': 'call_dU4uYVvTzjEzsHIxLr1kS4Nb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 52865, 'output_tokens': 34, 'total_tokens': 52899, 'input_token_details': {'audio': 0, 'cache_read': 31232}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:23,858 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_nIKnfQ8xH3rkdeuVEsaNeDsT', 'function': {'arguments': '{"basename":"Stylesheet.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 53898, 'total_tokens': 53922, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ccba168f-0b87-4585-bea8-83e5689a85d8-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Stylesheet.ts'}, 'id': 'call_nIKnfQ8xH3rkdeuVEsaNeDsT', 'type': 'tool_call'}] usage_metadata={'input_tokens': 53898, 'output_tokens': 24, 'total_tokens': 53922, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:26,575 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_2Lx6lB28uXse2DdENo8imKQ6', 'function': {'arguments': '{"relative_path":"src/css/Stylesheet.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 53972, 'total_tokens': 54001, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 44672}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--100b6f67-94f3-4ae1-ac73-1070c55822e0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/css/Stylesheet.ts'}, 'id': 'call_2Lx6lB28uXse2DdENo8imKQ6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 53972, 'output_tokens': 29, 'total_tokens': 54001, 'input_token_details': {'audio': 0, 'cache_read': 44672}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:29,546 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_BFL8qa2Sq2yv7zCJLBTCNWYZ', 'function': {'arguments': '{"relative_path":"src/css/Selector.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 27, 'prompt_tokens': 58433, 'total_tokens': 58460, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 46976}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--807906f9-83ea-40af-8259-258655cf76eb-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/css/Selector.ts'}, 'id': 'call_BFL8qa2Sq2yv7zCJLBTCNWYZ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 58433, 'output_tokens': 27, 'total_tokens': 58460, 'input_token_details': {'audio': 0, 'cache_read': 46976}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:32,877 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_CrV7OLO5eOxZV9mTN7alF8Od', 'function': {'arguments': '{"relative_path":"src/css/Selector.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 58508, 'total_tokens': 58536, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 24832}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--539400d3-c7e9-4a29-a8c9-efa0f3bbf1c0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/css/Selector.ts'}, 'id': 'call_CrV7OLO5eOxZV9mTN7alF8Od', 'type': 'tool_call'}] usage_metadata={'input_tokens': 58508, 'output_tokens': 28, 'total_tokens': 58536, 'input_token_details': {'audio': 0, 'cache_read': 24832}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:34,943 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0oXlgsp5sG0DxlvCfj8honGI', 'function': {'arguments': '{"text":"CSS scoping"}', 'name': 'find_text_node_with_text'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 61867, 'total_tokens': 61890, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 53888}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cafc6c88-f6af-452a-b3f6-a2e63b0477b5-0' tool_calls=[{'name': 'find_text_node_with_text', 'args': {'text': 'CSS scoping'}, 'id': 'call_0oXlgsp5sG0DxlvCfj8honGI', 'type': 'tool_call'}] usage_metadata={'input_tokens': 61867, 'output_tokens': 23, 'total_tokens': 61890, 'input_token_details': {'audio': 0, 'cache_read': 53888}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:45,443 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VyCtNSO9OrgmC1ahZDBk0NyN', 'function': {'arguments': '{"text":"ref directive"}', 'name': 'find_text_node_with_text'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 732, 'prompt_tokens': 63483, 'total_tokens': 64215, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 53888}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0a8646f3-d757-4843-834a-618f1c9722a9-0' tool_calls=[{'name': 'find_text_node_with_text', 'args': {'text': 'ref directive'}, 'id': 'call_VyCtNSO9OrgmC1ahZDBk0NyN', 'type': 'tool_call'}] usage_metadata={'input_tokens': 63483, 'output_tokens': 732, 'total_tokens': 64215, 'input_token_details': {'audio': 0, 'cache_read': 53888}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-10 23:43:49,439 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_bJNP4KAgd0fyZgtTRnlSxoib', 'function': {'arguments': '{"basename":"README"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 22, 'prompt_tokens': 63530, 'total_tokens': 63552, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 37504}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--64b5c927-9fa7-45f1-ac1d-ce108844c182-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'README'}, 'id': 'call_bJNP4KAgd0fyZgtTRnlSxoib', 'type': 'tool_call'}] usage_metadata={'input_tokens': 63530, 'output_tokens': 22, 'total_tokens': 63552, 'input_token_details': {'audio': 0, 'cache_read': 37504}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:43:52,377 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_X27XZnW0Yo76S2YEgR9WTmFT', 'function': {'arguments': '{"text":"refs"}', 'name': 'find_text_node_with_text'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 21, 'prompt_tokens': 63578, 'total_tokens': 63599, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 58496}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4768324f-be89-465b-9af9-411c578794ed-0' tool_calls=[{'name': 'find_text_node_with_text', 'args': {'text': 'refs'}, 'id': 'call_X27XZnW0Yo76S2YEgR9WTmFT', 'type': 'tool_call'}] usage_metadata={'input_tokens': 63578, 'output_tokens': 21, 'total_tokens': 63599, 'input_token_details': {'audio': 0, 'cache_read': 58496}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:00,504 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_kwLY0uhHWC02xUyXiKHOUNRM', 'function': {'arguments': '{"basename":"parse"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 668, 'prompt_tokens': 65192, 'total_tokens': 65860, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 47104}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--dece53f1-9db6-4785-bc22-6412bd297e12-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'parse'}, 'id': 'call_kwLY0uhHWC02xUyXiKHOUNRM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 65192, 'output_tokens': 668, 'total_tokens': 65860, 'input_token_details': {'audio': 0, 'cache_read': 47104}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-10 23:44:02,662 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1OrqdBg7uRRlIpMy6fKlPDRZ', 'function': {'arguments': '{"relative_path":"src/parse"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 65259, 'total_tokens': 65284, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 52864}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--08862507-1e0a-4143-8b50-67f997a454c1-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/parse'}, 'id': 'call_1OrqdBg7uRRlIpMy6fKlPDRZ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 65259, 'output_tokens': 25, 'total_tokens': 65284, 'input_token_details': {'audio': 0, 'cache_read': 52864}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:06,441 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xYyRQNMex71WTcww02ekN75m', 'function': {'arguments': '{"basename":"index.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 65329, 'total_tokens': 65352, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c0496cb7-658a-484c-a9fb-7e308eae2e02-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'index.ts'}, 'id': 'call_xYyRQNMex71WTcww02ekN75m', 'type': 'tool_call'}] usage_metadata={'input_tokens': 65329, 'output_tokens': 23, 'total_tokens': 65352, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:09,197 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ka4HRBeNLNpsXDQYgKUIsfmj', 'function': {'arguments': '{"relative_path":"src/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 65544, 'total_tokens': 65570, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 63488}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1f2d6b4d-336c-4194-89a3-a9423cad4e6e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/index.ts'}, 'id': 'call_ka4HRBeNLNpsXDQYgKUIsfmj', 'type': 'tool_call'}] usage_metadata={'input_tokens': 65544, 'output_tokens': 26, 'total_tokens': 65570, 'input_token_details': {'audio': 0, 'cache_read': 63488}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:11,834 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_usi5PqJ1hdZsIkocVyNczYC2', 'function': {'arguments': '{"basename":"visit.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 66445, 'total_tokens': 66468, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 58368}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--82ca437d-c91b-413b-a025-411a8934a81e-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'visit.ts'}, 'id': 'call_usi5PqJ1hdZsIkocVyNczYC2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 66445, 'output_tokens': 23, 'total_tokens': 66468, 'input_token_details': {'audio': 0, 'cache_read': 58368}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:14,051 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VVgKnQQgf3WhWmqW7zmkMtZs', 'function': {'arguments': '{"relative_path":"src/generators/dom/visit.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 66560, 'total_tokens': 66591, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 65152}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--30826e4a-75b9-4fb5-bcd6-f241169f5c3b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visit.ts'}, 'id': 'call_VVgKnQQgf3WhWmqW7zmkMtZs', 'type': 'tool_call'}] usage_metadata={'input_tokens': 66560, 'output_tokens': 31, 'total_tokens': 66591, 'input_token_details': {'audio': 0, 'cache_read': 65152}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:16,214 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lX53Uzh2WMY0euWi4DGfJwOJ', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visit.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 66821, 'total_tokens': 66855, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 66560}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--255d8981-9057-4c13-a572-917f219e6d06-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/visit.ts'}, 'id': 'call_lX53Uzh2WMY0euWi4DGfJwOJ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 66821, 'output_tokens': 34, 'total_tokens': 66855, 'input_token_details': {'audio': 0, 'cache_read': 66560}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:21,707 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VtCdU6CHlQGY6B15kRi5aTs6', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/index.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 67052, 'total_tokens': 67084, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bd1edc5f-937d-4895-aa27-b03210110ff2-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/dom/visitors/index.ts'}, 'id': 'call_VtCdU6CHlQGY6B15kRi5aTs6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 67052, 'output_tokens': 32, 'total_tokens': 67084, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:24,472 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3XcRPKG8UlvIvwFTsvaqKChs', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 67137, 'total_tokens': 67170, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 65536}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--96c2e86a-63fa-43e0-9e97-640b37b3932e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/index.ts'}, 'id': 'call_3XcRPKG8UlvIvwFTsvaqKChs', 'type': 'tool_call'}] usage_metadata={'input_tokens': 67137, 'output_tokens': 33, 'total_tokens': 67170, 'input_token_details': {'audio': 0, 'cache_read': 65536}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:27,470 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_qOfXLyq0ruISuF3lQMcD4XDj', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/index.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 35, 'prompt_tokens': 67403, 'total_tokens': 67438, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 63488}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--02d1fd62-5459-4ee8-a1d1-90e202e71e17-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/index.ts'}, 'id': 'call_qOfXLyq0ruISuF3lQMcD4XDj', 'type': 'tool_call'}] usage_metadata={'input_tokens': 67403, 'output_tokens': 35, 'total_tokens': 67438, 'input_token_details': {'audio': 0, 'cache_read': 63488}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:29,277 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_dMVNb0tOtq8v2mNSMlQaavvh', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 67494, 'total_tokens': 67530, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 65280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d993cd0c-bd16-487a-b2ac-5e23bec6301e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/index.ts'}, 'id': 'call_dMVNb0tOtq8v2mNSMlQaavvh', 'type': 'tool_call'}] usage_metadata={'input_tokens': 67494, 'output_tokens': 36, 'total_tokens': 67530, 'input_token_details': {'audio': 0, 'cache_read': 65280}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:39,713 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_2iVvta2JArf5VMmRikzJnSej', 'function': {'arguments': '{"basename":"Attribute.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 861, 'prompt_tokens': 67781, 'total_tokens': 68642, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 61824}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ce909418-919c-45a1-a5da-88db11f4dbbd-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Attribute.ts'}, 'id': 'call_2iVvta2JArf5VMmRikzJnSej', 'type': 'tool_call'}] usage_metadata={'input_tokens': 67781, 'output_tokens': 861, 'total_tokens': 68642, 'input_token_details': {'audio': 0, 'cache_read': 61824}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-10 23:44:43,512 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lPD02FFq0vCS3DaGQXmBUouZ', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/Attribute.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 35, 'prompt_tokens': 67903, 'total_tokens': 67938, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--21fbc20d-1a9a-4d7f-bb2e-8dfd7bc174ce-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/generators/dom/visitors/Element/Attribute.ts'}, 'id': 'call_lPD02FFq0vCS3DaGQXmBUouZ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 67903, 'output_tokens': 35, 'total_tokens': 67938, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:46,544 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OqyubvQq2F6ic5gBfh6w9KCi', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/Attribute.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 36, 'prompt_tokens': 67994, 'total_tokens': 68030, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 39424}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7f3c659e-3971-4b1d-a140-bc89e458827a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/Attribute.ts'}, 'id': 'call_OqyubvQq2F6ic5gBfh6w9KCi', 'type': 'tool_call'}] usage_metadata={'input_tokens': 67994, 'output_tokens': 36, 'total_tokens': 68030, 'input_token_details': {'audio': 0, 'cache_read': 39424}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:48,384 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_H4d66VM4iyjosn4vyZtwdjI1', 'function': {'arguments': '{"relative_path":"src/css/gatherPossibleValues.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 70254, 'total_tokens': 70283, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 67712}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0b3dc472-1b49-4cf8-83fb-3b84cb9cc42b-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/css/gatherPossibleValues.ts'}, 'id': 'call_H4d66VM4iyjosn4vyZtwdjI1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 70254, 'output_tokens': 29, 'total_tokens': 70283, 'input_token_details': {'audio': 0, 'cache_read': 67712}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:50,857 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JsrDxU53XXFRhCGbwUpOm9vA', 'function': {'arguments': '{"relative_path":"src/css/gatherPossibleValues.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 70336, 'total_tokens': 70366, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 66432}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b24314ba-edef-447a-987f-53a6056e7906-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/css/gatherPossibleValues.ts'}, 'id': 'call_JsrDxU53XXFRhCGbwUpOm9vA', 'type': 'tool_call'}] usage_metadata={'input_tokens': 70336, 'output_tokens': 30, 'total_tokens': 70366, 'input_token_details': {'audio': 0, 'cache_read': 66432}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:44:57,681 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_2mm3hc3o3SDyJnThlQVcPRYa', 'function': {'arguments': '{"relative_path":"src/parse/index.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 545, 'prompt_tokens': 70611, 'total_tokens': 71156, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 66816}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bc93dd84-dc6a-4b08-a860-aea297a467be-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/parse/index.ts'}, 'id': 'call_2mm3hc3o3SDyJnThlQVcPRYa', 'type': 'tool_call'}] usage_metadata={'input_tokens': 70611, 'output_tokens': 545, 'total_tokens': 71156, 'input_token_details': {'audio': 0, 'cache_read': 66816}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-10 23:45:00,099 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_LVUD1ywtBOFNr8JeIWcNi76A', 'function': {'arguments': '{"relative_path":"src/parse/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 70686, 'total_tokens': 70714, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 70528}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--599bd4da-0bc4-4b8b-b8c7-e0ccf5b3b3d6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/parse/index.ts'}, 'id': 'call_LVUD1ywtBOFNr8JeIWcNi76A', 'type': 'tool_call'}] usage_metadata={'input_tokens': 70686, 'output_tokens': 28, 'total_tokens': 70714, 'input_token_details': {'audio': 0, 'cache_read': 70528}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:45:03,205 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_eiRetVl4dLnOBFz9j769VpSJ', 'function': {'arguments': '{"basename":"Attribute"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 22, 'prompt_tokens': 72638, 'total_tokens': 72660, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 23040}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--805065d1-4631-4e25-94a3-a37144df21b5-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Attribute'}, 'id': 'call_eiRetVl4dLnOBFz9j769VpSJ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 72638, 'output_tokens': 22, 'total_tokens': 72660, 'input_token_details': {'audio': 0, 'cache_read': 23040}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:45:17,751 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_wsEngtT85WICFZ33ROwcRdZC', 'function': {'arguments': '{"relative_path":"src/validate/html/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1379, 'prompt_tokens': 72686, 'total_tokens': 74065, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 67072}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--264af841-6085-4607-bfa0-2715fe17c0a6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/validate/html/index.ts'}, 'id': 'call_wsEngtT85WICFZ33ROwcRdZC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 72686, 'output_tokens': 1379, 'total_tokens': 74065, 'input_token_details': {'audio': 0, 'cache_read': 67072}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-10 23:45:20,261 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0O9sPwtXKAFxDlgXqHGN6AyR', 'function': {'arguments': '{"basename":"validateElement.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 74053, 'total_tokens': 74077, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 65280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5349b497-2679-4c3e-85db-3cefff79082c-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'validateElement.ts'}, 'id': 'call_0O9sPwtXKAFxDlgXqHGN6AyR', 'type': 'tool_call'}] usage_metadata={'input_tokens': 74053, 'output_tokens': 24, 'total_tokens': 74077, 'input_token_details': {'audio': 0, 'cache_read': 65280}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:45:22,996 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_RfYaJkSlNeingwLlnhG9QAIM', 'function': {'arguments': '{"relative_path":"src/validate/html/validateElement.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 74129, 'total_tokens': 74160, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 67840}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1a77b991-2659-49f9-ad27-b336000c4ee8-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/validate/html/validateElement.ts'}, 'id': 'call_RfYaJkSlNeingwLlnhG9QAIM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 74129, 'output_tokens': 31, 'total_tokens': 74160, 'input_token_details': {'audio': 0, 'cache_read': 67840}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:45:26,390 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fPbFPcEHAtdpfWDInQtgpAc6', 'function': {'arguments': '{"basename":"validateEventHandler.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 76414, 'total_tokens': 76439, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 70272}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e602694b-686f-4843-9a50-cc6719e5e4c6-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'validateEventHandler.ts'}, 'id': 'call_fPbFPcEHAtdpfWDInQtgpAc6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 76414, 'output_tokens': 25, 'total_tokens': 76439, 'input_token_details': {'audio': 0, 'cache_read': 70272}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:45:29,023 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_b2PfizXDNWN4u3rUiH69UfaO', 'function': {'arguments': '{"relative_path":"src/validate/html/validateEventHandler.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 76493, 'total_tokens': 76525, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 67456}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7909a76a-730e-4c9e-9061-ce5ee4b28bd2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/validate/html/validateEventHandler.ts'}, 'id': 'call_b2PfizXDNWN4u3rUiH69UfaO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 76493, 'output_tokens': 32, 'total_tokens': 76525, 'input_token_details': {'audio': 0, 'cache_read': 67456}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:45:37,241 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_pZOXPVZEjF3Mi43iO8LB9Zuo', 'function': {'arguments': '{"basename":"Window.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 77149, 'total_tokens': 77172, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c53ad47b-3018-4f09-9d6e-bdb70eca2685-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Window.ts'}, 'id': 'call_pZOXPVZEjF3Mi43iO8LB9Zuo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 77149, 'output_tokens': 23, 'total_tokens': 77172, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:45:39,405 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_UjVrAP4xv2gmf7rh06F2IW9i', 'function': {'arguments': '{"relative_path":"src/generators/dom/visitors/Element/meta/Window.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 77274, 'total_tokens': 77311, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 73984}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1e9e5773-cb93-4ded-86b4-60635fc0ad13-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/dom/visitors/Element/meta/Window.ts'}, 'id': 'call_UjVrAP4xv2gmf7rh06F2IW9i', 'type': 'tool_call'}] usage_metadata={'input_tokens': 77274, 'output_tokens': 37, 'total_tokens': 77311, 'input_token_details': {'audio': 0, 'cache_read': 73984}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:45:43,189 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_rRGTLu3pXjRECiLCXANvVTjM', 'function': {'arguments': '{"relative_path":"src/validate/html/validateWindow.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 79835, 'total_tokens': 79865, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 67072}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--dc180432-8fb7-47e9-a9af-2917e6a9ca1f-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/validate/html/validateWindow.ts'}, 'id': 'call_rRGTLu3pXjRECiLCXANvVTjM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 79835, 'output_tokens': 30, 'total_tokens': 79865, 'input_token_details': {'audio': 0, 'cache_read': 67072}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:45:45,945 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_UvyksQe2PSBQsTVquips1InU', 'function': {'arguments': '{"relative_path":"src/validate/html/validateWindow.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 79917, 'total_tokens': 79948, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 67328}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--71592dcb-1f61-4da9-87cf-94f661cd8839-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/validate/html/validateWindow.ts'}, 'id': 'call_UvyksQe2PSBQsTVquips1InU', 'type': 'tool_call'}] usage_metadata={'input_tokens': 79917, 'output_tokens': 31, 'total_tokens': 79948, 'input_token_details': {'audio': 0, 'cache_read': 67328}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:45:58,065 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_us7OUTZeJjSY56lgudD7gds2', 'function': {'arguments': '{"basename":"state"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 988, 'prompt_tokens': 80738, 'total_tokens': 81726, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 72576}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5b5c2fb0-582e-4781-819e-98f42dfbc67b-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'state'}, 'id': 'call_us7OUTZeJjSY56lgudD7gds2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 80738, 'output_tokens': 988, 'total_tokens': 81726, 'input_token_details': {'audio': 0, 'cache_read': 72576}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-10 23:46:00,142 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_XZ9yl1aYZ8VigQXes2fnLtMH', 'function': {'arguments': '{"relative_path":"src/parse/state"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 80806, 'total_tokens': 80832, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 77184}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--029a4cd8-9989-4bbd-8714-8a1291ded44c-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/parse/state'}, 'id': 'call_XZ9yl1aYZ8VigQXes2fnLtMH', 'type': 'tool_call'}] usage_metadata={'input_tokens': 80806, 'output_tokens': 26, 'total_tokens': 80832, 'input_token_details': {'audio': 0, 'cache_read': 77184}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:46:02,716 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hGaBHu5ixU1git0oeDeAb3vH', 'function': {'arguments': '{"basename":"element.ts"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 80878, 'total_tokens': 80901, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 74112}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--11aab50d-a6e2-4140-a519-6fb45f152418-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'element.ts'}, 'id': 'call_hGaBHu5ixU1git0oeDeAb3vH', 'type': 'tool_call'}] usage_metadata={'input_tokens': 80878, 'output_tokens': 23, 'total_tokens': 80901, 'input_token_details': {'audio': 0, 'cache_read': 74112}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:46:06,466 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WOd9lJDTcL6PTZgliyPQ8dSf', 'function': {'arguments': '{"relative_path":"src/parse/state/tag.ts"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 80927, 'total_tokens': 80955, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 80640}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--71e8e977-3c03-4594-b565-24c95a17a7f0-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'src/parse/state/tag.ts'}, 'id': 'call_WOd9lJDTcL6PTZgliyPQ8dSf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 80927, 'output_tokens': 28, 'total_tokens': 80955, 'input_token_details': {'audio': 0, 'cache_read': 80640}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:46:08,508 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_30sGqvr0pjp6JHbJTEPksPbG', 'function': {'arguments': '{"relative_path":"src/parse/state/tag.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 81004, 'total_tokens': 81033, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 80768}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b684d20b-f3b6-4a8e-942f-d5c818157263-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/parse/state/tag.ts'}, 'id': 'call_30sGqvr0pjp6JHbJTEPksPbG', 'type': 'tool_call'}] usage_metadata={'input_tokens': 81004, 'output_tokens': 29, 'total_tokens': 81033, 'input_token_details': {'audio': 0, 'cache_read': 80768}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-10 23:46:26,847 - thread-133013312636608.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located and read the DOM and SSR Element visitors to capture where CSS scoping attributes are added and confirmed the SSR path appends the stylesheet id on opening tags while the DOM path calls an encapsulateStyles helper. I retrieved the Ref directive handling that maps DOM elements to component.refs and clears them on destroy, and verified the constructor initializes this.refs when refs are used. I gathered Generator and Block implementations (DOM and SSR), both preprocess flows, the Node interface plus the parser code that represents ref directives, and the CSS selector/attribute matching helpers. I also pulled README option details on CSS cascading/scoping and changelog notes referencing refs usage in event handlers.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1422, 'prompt_tokens': 85403, 'total_tokens': 86825, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1280, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 80896}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--a914b133-965c-4b24-bb99-ec7505cd0db3-0' usage_metadata={'input_tokens': 85403, 'output_tokens': 1422, 'total_tokens': 86825, 'input_token_details': {'audio': 0, 'cache_read': 80896}, 'output_token_details': {'audio': 0, 'reasoning': 1280}}
2025-11-10 23:46:26,852 - thread-133013312636608.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the implementations and docs that handle Ref directives and CSS scoping: the Generator/Block classes, DOM Element visitor/runtime ref mapping, SSR index/preprocess, Node/Element interfaces, css attribute matching helpers, and README sections on refs/CSS.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If full files are large, include at minimum the code that maps refs to this.refs, where the CSS scoping attribute is added in DOM/SSR, the Node/Element interface showing Ref representation, and the README sections describing refs and CSS scoping.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These contexts are essential to pinpoint integration points and conventions to design refs-as-selectors or shorthand class/id behavior consistently across DOM and SSR.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: CHANGELOG.md
Line number range: 1 - 97
Content:
# Svelte changelog

## 1.27.0

* Minify CSS and remove unused styles ([#697](https://github.com/sveltejs/svelte/issues/697))
* Optimize ternary expressions when excluding unused CSS ([#696](https://github.com/sveltejs/svelte/issues/696))
* Clear refs after `ondestroy` callbacks fire ([#706](https://github.com/sveltejs/svelte/issues/706))
* Prevent certain forms of component binding blowback ([#721](https://github.com/sveltejs/svelte/issues/721))
* Use helper to encapsulate styles ([#375](https://github.com/sveltejs/svelte/issues/375))
* Event propagation shorthand — `on:foo` equals `on:foo='fire("foo", event)` ([#638](https://github.com/sveltejs/svelte/issues/638))
* Allow `refs.*` in event handlers, and validate them ([#686](https://github.com/sveltejs/svelte/issues/686))

## 1.26.2

* Unescape `#` characters ([#722](https://github.com/sveltejs/svelte/issues/722))

## 1.26.1

* Fix select binding regression  ([#724](https://github.com/sveltejs/svelte/issues/724))

## 1.26.0

* Enforce correct order of operations when initialising ([#708](https://github.com/sveltejs/svelte/issues/708) and [#714](https://github.com/sveltejs/svelte/issues/714))
* Ensure data is up-to-date when re-rendering yield block ([#711](https://github.com/sveltejs/svelte/issues/711))
* Fix unescaping of strings, preserve at-rules in CSS ([#712](https://github.com/sveltejs/svelte/issues/712))
* Preserve whitespace at end of each blocks ([#713](https://github.com/sveltejs/svelte/issues/713))

## 1.25.1

* Better CSS sourcemaps ([#716](https://github.com/sveltejs/svelte/pull/716))

## 1.25.0

* Fix hoisted event handlers ([#699](https://github.com/sveltejs/svelte/issues/699))
* Fire `intro.start` and `outro.start` events ([#702](https://github.com/sveltejs/svelte/issues/702))
* Preserve order of components in keyed each blocks ([#700](https://github.com/sveltejs/svelte/issues/700))
* Add `cssMap` property to compiler output ([#698](https://github.com/sveltejs/svelte/pull/698/))

## 1.24.0

* Deconflict names with imports in SSR compiler ([#655](https://github.com/sveltejs/svelte/issues/655))
* Improved transition performance ([#670](https://github.com/sveltejs/svelte/pull/670))
* Run transitions on initial render ([#651](https://github.com/sveltejs/svelte/issues/651))
* Add dev mode warning if `hydrate` is true but `hydratable` was false ([#664](https://github.com/sveltejs/svelte/issues/664))
* Manipulate sourcemap to make missing loop values obvious ([#683](https://github.com/sveltejs/svelte/pull/683))
* Only add CSS scoping attributes where necessary ([#679](https://github.com/sveltejs/svelte/issues/679))
* Warn on unused CSS selectors ([#678](https://github.com/sveltejs/svelte/issues/678))
* Fix `<select>` binding in loop ([#685](https://github.com/sveltejs/svelte/issues/685))
* Prevent bindings from calling `oncreate` functions prematurely ([#694](https://github.com/sveltejs/svelte/pull/694))
* Simpler codegen ([#673](https://github.com/sveltejs/svelte/pull/673))

## 1.23.4

* Don't recreate if blocks incorrectly ([#669](https://github.com/sveltejs/svelte/pull/669))

## 1.23.3

* Pass parameters to `get_block` ([#667](https://github.com/sveltejs/svelte/issues/667))

## 1.23.2

* Fix if blocks being recreated on update ([#665](https://github.com/sveltejs/svelte/issues/665))

## 1.23.1

* Fix each-else blocks that are empty on initial render ([#662](https://github.com/sveltejs/svelte/issues/662))

## 1.23.0

* Hydration ([#649](https://github.com/sveltejs/svelte/pull/649))
* Correctly transform CSS selectors with pseudo-elements ([#658](https://github.com/sveltejs/svelte/issues/658))

## 1.22.5

* Fix nested component unmounting bug ([#643](https://github.com/sveltejs/svelte/issues/643))

## 1.22.4

* Include `ast` in `svelte.compile` return value ([#632](https://github.com/sveltejs/svelte/issues/632))
* Set initial value of `<select>` binding, if unspecified ([#639](https://github.com/sveltejs/svelte/issues/639))
* Mark indirect dependencies of `<select>` bindings (i.e. the dependencies of their `<option>` values) ([#639](https://github.com/sveltejs/svelte/issues/639))

## 1.22.3

* Fix nested component unmounting bug ([#625](https://github.com/sveltejs/svelte/issues/625))
* Allow components to have computed member expression bindings ([#624](https://github.com/sveltejs/svelte/issues/624))
* Handle empty `<style>` tags ([#634](https://github.com/sveltejs/svelte/issues/634))
* Warn on missing component ([#623](https://github.com/sveltejs/svelte/issues/623))
* Allow dynamic `type` attribute for unbound inputs ([#620](https://github.com/sveltejs/svelte/issues/620))
* Rename `addEventListener` and `removeEventListener` directives ([#621](https://github.com/sveltejs/svelte/issues/621))

## 1.22.2

* Escape template strings correctly in SSR output ([#616](https://github.com/sveltejs/svelte/issues/616))
* Prevent magic-string deprecation warning ([#617](https://github.com/sveltejs/svelte/pull/617))

## 1.22.1


File: CHANGELOG.md
Line number range: 92 - 166
Content:
## 1.22.2

* Escape template strings correctly in SSR output ([#616](https://github.com/sveltejs/svelte/issues/616))
* Prevent magic-string deprecation warning ([#617](https://github.com/sveltejs/svelte/pull/617))

## 1.22.1

* Sanitise event handler names ([#612](https://github.com/sveltejs/svelte/issues/612))

## 1.22.0

* Symmetry between `mount` and `unmount`. This is potentially a breaking change if your components import other components that were precompiled with an earlier version of Svelte ([#592](https://github.com/sveltejs/svelte/issues/592))
* Add `cascade` option, which prevents styles affecting child components if `false`, unless selectors are wrapped in `:global(...)` and keyframe declaration IDs are prefixed with `-global-`. This will become the default behaviour in v2 ([#583](https://github.com/sveltejs/svelte/issues/583))
* Support binding to computed member expressions ([#602](https://github.com/sveltejs/svelte/issues/602))
* Coerce empty string in `number`/`range` inputs to `undefined`, not `0` ([#584](https://github.com/sveltejs/svelte/issues/584))
* Fix insert location of DOM elements in each/if/nested component edge cases ([#610](https://github.com/sveltejs/svelte/issues/610))

## 1.21.0

* Always use `helpers` if referenced, not just for call expressions ([#575](https://github.com/sveltejs/svelte/issues/575))
* Fix parsing of `<textarea>` children ([#599](https://github.com/sveltejs/svelte/pull/599))
* Treat `<textarea>` value attributes and children as equivalent, and fail validation if both are present ([#599](https://github.com/sveltejs/svelte/pull/599))
* Fix `<textarea>` SSR ([#599](https://github.com/sveltejs/svelte/pull/599))
* Apply CSS transition styles immediately if transition has delay ([#574](https://github.com/sveltejs/svelte/issues/574))
* Ensure `transitionManager` is treeshakeable ([#593](https://github.com/sveltejs/svelte/issues/593))
* Fix for environments where `node.style.animation` is undefined ([#587](https://github.com/sveltejs/svelte/issues/587))
* Fix order of operations when dealing with `<select>` elements ([#590](https://github.com/sveltejs/svelte/issues/590))
* Downgrade 'invalid callee' to a warning ([#579](https://github.com/sveltejs/svelte/issues/579))
* Convert to TypeScript ([#573](https://github.com/sveltejs/svelte/pull/573))

## 1.20.2

* Fix destruction of compound if-blocks with outros ([#572](https://github.com/sveltejs/svelte/pull/572))

## 1.20.1

* Fix insertion order of `if` blocks and their anchors ([#569](https://github.com/sveltejs/svelte/issues/569))

## 1.20.0

* Faster, better updates of keyed each blocks ([#373](https://github.com/sveltejs/svelte/issues/373), [#543](https://github.com/sveltejs/svelte/issues/543))
* Use element IDs to robustly track dynamically injected `<style>` tags ([#554](https://github.com/sveltejs/svelte/issues/554))
* Abort outros before corresponding intros ([#546](https://github.com/sveltejs/svelte/issues/546))
* Generate less code for `if` blocks with `else` blocks ([#540](https://github.com/sveltejs/svelte/issues/540))
* Ensure `{{yield}}` block content is injected into the right place ([#561](https://github.com/sveltejs/svelte/issues/561))
* Simpler, more readable codegen code ([#559](https://github.com/sveltejs/svelte/pull/559))
* Validate transition directives ([#564](https://github.com/sveltejs/svelte/issues/564))
* Apply delays to bidirectional transitions ([#562](https://github.com/sveltejs/svelte/issues/562))
* Handle all valid HTML entities ([#565](https://github.com/sveltejs/svelte/pull/565))
* Fix outros on compound `if` blocks ([#565](https://github.com/sveltejs/svelte/pull/565))
* Validation for `<:Window>` tags ([#565](https://github.com/sveltejs/svelte/pull/565))
* Increased test coverage ([#565](https://github.com/sveltejs/svelte/pull/565))

## 1.19.1

* Export `generateKeyframes`, so that CSS transitions work

## 1.19.0

* Experimental support for transitions ([#7](https://github.com/sveltejs/svelte/issues/7))
* Use `querySelector(':checked')` instead of `selectedOptions` ([#539](https://github.com/sveltejs/svelte/issues/539))
* Stringify helpers before bundling them, to avoid renaming errors ([#538](https://github.com/sveltejs/svelte/issues/538))

## 1.18.2

* Parenthesize if-block conditions ([#532](https://github.com/sveltejs/svelte/issues/532))
* Fix parsing of parenthesized expressions ([#534](https://github.com/sveltejs/svelte/issues/534))
* Fix error on `bind:checked` that doesn't belong to a checkbox input ([#529](https://github.com/sveltejs/svelte/pull/529))

## 1.18.1

* Allow `destroy()` in event handlers ([#523](https://github.com/sveltejs/svelte/issues/523))
* Fix bug with `{{yield}}` blocks following elements ([#524](https://github.com/sveltejs/svelte/issues/524))

## 1.18.0


File: CHANGELOG.md
Line number range: 161 - 234
Content:
## 1.18.1

* Allow `destroy()` in event handlers ([#523](https://github.com/sveltejs/svelte/issues/523))
* Fix bug with `{{yield}}` blocks following elements ([#524](https://github.com/sveltejs/svelte/issues/524))

## 1.18.0

* Visit `<select>` attributes after children, to ensure options are in the right state ([#521](https://github.com/sveltejs/svelte/pull/521))
* Use sibling elements as anchors rather than creating comment nodes wherever possible ([#3](https://github.com/sveltejs/svelte/issues/3))

## 1.17.2

* Replace bad characters when creating variable names based on element names ([#516](https://github.com/sveltejs/svelte/issues/516))

## 1.17.1

* Fixes for static each-else and yield blocks ([#509](https://github.com/sveltejs/svelte/issues/509)), ([#514](https://github.com/sveltejs/svelte/issues/514))
* Code generation tweaks ([#504](https://github.com/sveltejs/svelte/issues/504)), ([#507](https://github.com/sveltejs/svelte/issues/507))

## 1.17.0

* Add `currentTime`, `duration` and `paused` bindings for media elements ([#406](https://github.com/sveltejs/svelte/issues/406))
* Don't treat helpers as dependencies ([#492](https://github.com/sveltejs/svelte/issues/492))
* Allow `<:Window>` event handlers to access component state ([#497](https://github.com/sveltejs/svelte/pull/497))
* Allow two-way binding to properties named 'component' ([#495](https://github.com/sveltejs/svelte/issues/495))
* Group checkbox bindings correctly, to avoid erroneously unchecking siblings ([#498](https://github.com/sveltejs/svelte/issues/498))
* Validate two-way bindings ([#494](https://github.com/sveltejs/svelte/pull/494))
* Allow dynamic each-block to have static else-block ([#501](https://github.com/sveltejs/svelte/pull/501))
* Initialise `<select>` value correctly ([#502](https://github.com/sveltejs/svelte/pull/502))

## 1.16.0

* Better code generation ([#489](https://github.com/sveltejs/svelte/pull/489)), ([#490](https://github.com/sveltejs/svelte/pull/490)), ([#491](https://github.com/sveltejs/svelte/pull/491))
* Prevent binding blowback on initial render ([#488](https://github.com/sveltejs/svelte/pull/488))

## 1.15.1

* Clone data before merging it with state ([#479](https://github.com/sveltejs/svelte/issues/479))
* Apply binding event handlers before user event handlers ([#486](https://github.com/sveltejs/svelte/issues/486))

## 1.15.0

* Dev mode — downgrade 'missing data' to a warning, and ignore whitelisted globals ([#475](https://github.com/sveltejs/svelte/issues/475))
* Fix `<select>` value binding when options are updated late ([#476](https://github.com/sveltejs/svelte/issues/476))
* Throw at compile time if event handler references invalid callee ([#473](https://github.com/sveltejs/svelte/pull/473))
* Check for helper function purity ([#473](https://github.com/sveltejs/svelte/pull/473))
* Validate `namespace` option ([#473](https://github.com/sveltejs/svelte/pull/473))

## 1.14.1

* Replace bad characters when creating variable names based on attributes ([#470](https://github.com/sveltejs/svelte/issues/470))

## 1.14.0

* Better guard against naming conflicts ([#465](https://github.com/sveltejs/svelte/issues/465))
* Better error if getters and setters are used with `methods` ([#425](https://github.com/sveltejs/svelte/issues/425))
* Don't create whitespace nodes inside elements that can't use them ([#189](https://github.com/sveltejs/svelte/issues/189))
* Collapse consecutive `if` statements with the same condition ([#450](https://github.com/sveltejs/svelte/issues/450))
* Window `scroll` bindings are bidirectional ([#404](https://github.com/sveltejs/svelte/issues/404))
* Add `bind:online` to window ([#404](https://github.com/sveltejs/svelte/issues/404))
* In dev mode, throw if read-only properties are set ([#404](https://github.com/sveltejs/svelte/issues/404))
* Prevent conflicts with component name ([#464](https://github.com/sveltejs/svelte/pull/464))
* Ensure event handler names are deconflicted ([#466](https://github.com/sveltejs/svelte/issues/466))

## 1.13.7

* Fix observers — `defer: true` now triggers callback after DOM is updated ([#441](https://github.com/sveltejs/svelte/issues/441))
* Handle empty `computed` property ([#452](https://github.com/sveltejs/svelte/issues/452))
* Correctly bind one-way `<select>` value attributes with objects ([#423](https://github.com/sveltejs/svelte/issues/423))
* Hoist event handlers inside each blocks, where possible ([#456](https://github.com/sveltejs/svelte/pull/456))
* Don't bind event handler callbacks ([#433](https://github.com/sveltejs/svelte/issues/433))
* Internal refactoring and neater code generation ([#453](https://github.com/sveltejs/svelte/pull/453))

## 1.13.6


File: CHANGELOG.md
Line number range: 234 - 331
Content:
## 1.13.6

* Use `assign` helper instead of `Object.assign` for better performance and legacy compatibility ([#431](https://github.com/sveltejs/svelte/issues/431))
* Improved code generation ([#419](https://github.com/sveltejs/svelte/issues/419)), ([#440](https://github.com/sveltejs/svelte/issues/440)), ([#442](https://github.com/sveltejs/svelte/issues/442))

## 1.13.5

* Read `range` and `number` input values as numbers ([#436](https://github.com/sveltejs/svelte/issues/436))
* Better error for `bind:value='{{foo}}'` ([#437](https://github.com/sveltejs/svelte/issues/437))

## 1.13.4

* Prevent unclosed `<script>` tag causing infinite loop ([#435](https://github.com/sveltejs/svelte/pull/435))

## 1.13.3

* Correctly handle `{{true}}`, `{{false}}` and `{{null}}` ([#424](https://github.com/sveltejs/svelte/issues/424))
* Update `<select>` value attributes correctly ([#423](https://github.com/sveltejs/svelte/issues/423))
* Bind custom event handler callbacks ([#428](https://github.com/sveltejs/svelte/issues/428))
* Disallow `import root` ([#430](https://github.com/sveltejs/svelte/pull/430))
* Prevent component bindings mutating the wrong object ([#432](https://github.com/sveltejs/svelte/pull/432))

## 1.13.2

* Fix deep component bindings ([#420](https://github.com/sveltejs/svelte/issues/420))
* Include `css` property in compiler output ([#409](https://github.com/sveltejs/svelte/issues/409))
* Treat functions as mutable objects when recomputing ([#413](https://github.com/sveltejs/svelte/issues/413)
* Include magic-string in bundle ([#410](https://github.com/sveltejs/svelte/issues/410))
* Disable unneeded Bublé transformations for slimmer output ([#411](https://github.com/sveltejs/svelte/pull/411))

## 1.13.1

* Prevent infinite loops with pathological component bindings ([#398](https://github.com/sveltejs/svelte/issues/398))
* More robust deconflicting ([#401](https://github.com/sveltejs/svelte/pull/401))

## 1.13.0

* Add `<:Window>` meta tag with event listeners, and a handful of bindings ([#371](https://github.com/sveltejs/svelte/issues/371))
* Don't uncheck radios incorrectly ([#399](https://github.com/sveltejs/svelte/issues/399))

## 1.12.1

* Deconflict non-helper functions (`addCss` etc) ([#388](https://github.com/sveltejs/svelte/issues/388))
* Allow reserved words in tags, e.g. `{{class}}` ([#383](https://github.com/sveltejs/svelte/issues/383))

## 1.12.0

* Shorthand attributes — `<Widget :foo/>` is equivalent to `<Widget foo='{{foo}}'/>` ([#384](https://github.com/sveltejs/svelte/pull/384))
* Support `bind:group` for radio and checkbox inputs ([#311](https://github.com/sveltejs/svelte/issues/311), [#312](https://github.com/sveltejs/svelte/issues/312))
* Better sourcemap support for two-way bindings

## 1.11.4

* Dev mode warning for bad `component.observe` arguments ([#369](https://github.com/sveltejs/svelte/issues/369))
* Translate `component.on('teardown', ...)` to `component.on('destroy', ...)` and add dev warning ([#365](https://github.com/sveltejs/svelte/issues/365))
* Use shared prototype to save bytes ([#378](https://github.com/sveltejs/svelte/pull/378))

## 1.11.3

* Undo CSS behaviour change in 1.11.2 ([#372](https://github.com/sveltejs/svelte/issues/372))
* Pin version of css-tree ([#370](https://github.com/sveltejs/svelte/pull/370))

## 1.11.2

* Add component CSS to each document a component is rendered to ([#331](https://github.com/sveltejs/svelte/issues/331))

## 1.11.1

* Fix two-way binding for components inside `each` blocks ([#356](https://github.com/sveltejs/svelte/issues/356))

## 1.11.0

* Add `format: 'eval'` and `svelte.create`, to create components directly from source code ([#345](https://github.com/sveltejs/svelte/issues/345))
* Node 4 compatibility ([#109](https://github.com/sveltejs/svelte/issues/109))

## 1.10.3

* Prevent `'</script>'` string occurence breaking pages ([#349](https://github.com/sveltejs/svelte/pull/349))
* Allow reference to whitelisted globals without properties ([#333](https://github.com/sveltejs/svelte/pull/333))
* Don't remove `&nbsp;` incorrectly ([#348](https://github.com/sveltejs/svelte/issues/348))
* `let` -> `var` in `addCss` block ([#351](https://github.com/sveltejs/svelte/pull/351))

## 1.10.2

* Accept any case for doctype declarations ([#336](https://github.com/sveltejs/svelte/issues/336))
* Allow non-top-level `<script>` and `<style>` tags to pass through without processing ([#335](https://github.com/sveltejs/svelte/issues/335))

## 1.10.1

* typecheck argument in _set when in dev mode ([#342](https://github.com/sveltejs/svelte/issues/342))
* Prevent duplicate helpers in non-shared mode ([#337](https://github.com/sveltejs/svelte/issues/337))

## 1.10.0

* Component self-references with `<:Self/>` ([#51](https://github.com/sveltejs/svelte/issues/51))
* Two-way binding with `<select multiple>` ([#313](https://github.com/sveltejs/svelte/issues/313))

## 1.9.1


File: README.md
Line number range: 1 - 100
Content:
1. # Svelte
2. 
3. The magical disappearing UI framework.
4. 
5. * [Read the introductory blog post](https://svelte.technology/blog/frameworks-without-the-framework/)
6. * [Read the guide](https://svelte.technology/guide)
7. * [Try it out](https://svelte.technology/repl)
8. * [Chat on Gitter](https://gitter.im/sveltejs/svelte)
9. 
10. ---
11. 
12. This is the Svelte compiler, which is primarily intended for authors of tooling that integrates Svelte with different build systems. If you just want to write Svelte components and use them in your app, you probably want one of those tools:
13. 
14. * [svelte-cli](https://github.com/sveltejs/svelte-cli) – Command line interface for compiling components
15. * [rollup-plugin-svelte](https://github.com/rollup/rollup-plugin-svelte) – Rollup plugin
16. * [sveltify](https://github.com/tehshrike/sveltify) - Browserify transform
17. * [gulp-svelte](https://github.com/shinnn/gulp-svelte) - gulp plugin
18. * [metalsmith-svelte](https://github.com/shinnn/metalsmith-svelte) - Metalsmith plugin
19. * [system-svelte](https://github.com/CanopyTax/system-svelte) – System.js loader
20. * [svelte-loader](https://github.com/sveltejs/svelte-loader) – Webpack loader
21. * [meteor-svelte](https://github.com/klaussner/meteor-svelte) – Meteor build plugin
22. * More to come!
23. 
24. 
25. ## Example usage
26. 
27. ```js
28. import * as svelte from 'svelte';
29. 
30. const { code, map } = svelte.compile( source, {
31. 	// the target module format – defaults to 'es' (ES2015 modules), can
32. 	// also be 'amd', 'cjs', 'umd', 'iife' or 'eval'
33. 	format: 'umd',
34. 
35. 	// the filename of the source file, used in e.g. generating sourcemaps
36. 	filename: 'MyComponent.html',
37. 
38. 	// the name of the constructor. Required for 'iife' and 'umd' output,
39. 	// but otherwise mostly useful for debugging. Defaults to 'SvelteComponent'
40. 	name: 'MyComponent',
41. 
42. 	// for 'amd' and 'umd' output, you can optionally specify an AMD module ID
43. 	amd: {
44. 		id: 'my-component'
45. 	},
46. 
47. 	// custom error/warning handlers. By default, errors will throw, and
48. 	// warnings will be printed to the console. Where applicable, the
49. 	// error/warning object will have `pos`, `loc` and `frame` properties
50. 	onerror: err => {
51. 		console.error( err.message );
52. 	},
53. 
54. 	onwarn: warning => {
55. 		console.warn( warning.message );
56. 	}
57. });
58. ```
59. 
60. 
61. ## API
62. 
63. The Svelte compiler exposes the following API:
64. 
65. * `compile( source [, options ] ) => { code, map, ast, css }` - Compile the component with the given options (see below). Returns an object containing the compiled JavaScript, a sourcemap, an AST and transformed CSS.
66. * `create( source [, options ] ) => function` - Compile the component and return the component itself.
67. * `VERSION` - The version of this copy of the Svelte compiler as a string, `'x.x.x'`.
68. 
69. ### Options
70. 
71. The Svelte compiler optionally takes a second argument, an object of configuration options:
72. 
73. | | **Values** | **Description** | **Defaults** |
74. |---|---|---|---|
75. | `format` | `'es'`, `'amd'`, `'cjs'`, `'umd'`, `'iife'`, `'eval'` | The format to output in the compiled component.<br>`'es'` - ES6/ES2015 module, suitable for consumption by a bundler<br>`'amd'` - AMD module<br>`'cjs'` - CommonJS module<br>`'iife'` - IIFE-wrapped function defining a global variable, suitable for use directly in browser<br>`'eval'` - standalone function, suitable for passing to `eval()` | `'es'` for `generate: 'dom'`<br>`'cjs'` for `generate: 'ssr'` |
76. | `generate` | `'dom'`, `'ssr'` | Whether to generate JavaScript code intended for use on the client (`'dom'`), or for use in server-side rendering (`'ssr'`). | `'dom'` |
77. | `name` | `string` | The name of the constructor in the compiled component. | `'SvelteComponent'` |
78. | `filename` | `string` | The filename to use in sourcemaps and compiler error and warning messages. | `'SvelteComponent.html'` |
79. | `amd`.`id` | `string` | The AMD module ID to use for the `'amd'` and `'umd'` output formats. | `undefined` |
80. | `cascade` | `true`, `false` | Whether to cascade all of the component's styles to child components. If `false`, only selectors wrapped in `:global(...)` and keyframe IDs beginning with `-global-` are cascaded. | `true` |
81. | `shared` | `true`, `false`, `string` | Whether to import various helpers from a shared external library. When you have a project with multiple components, this reduces the overall size of your JavaScript bundle, at the expense of having immediately-usable component. You can pass a string of the module path to use, or `true` will import from `'svelte/shared.js'`. | `false` |
82. | `dev` | `true`, `false` | Whether to enable run-time checks in the compiled component. These are helpful during development, but slow your component down. | `false` |
83. | `css` | `true`, `false` | Whether to include code to inject your component's styles into the DOM. | `true` |
84. | `globals` | `object`, `function` | When outputting to the `'umd'`, `'iife'` or `'eval'` formats, an object or function mapping the names of imported dependencies to the names of global variables. | `{}` |
85. | `onerror` | `function` | Specify a callback for when Svelte encounters an error while compiling the component. | (exception is thrown) |
86. | `onwarn` | `function` | Specify a callback for when Svelte encounters a non-fatal warning while compiling the component. | (warning is logged to console) |
87. 
88. ## Example/starter repos
89. 
90. * [charpeni/svelte-example](https://github.com/charpeni/svelte-example) - Some Svelte examples with configured Rollup, Babel, ESLint, directives, Two-Way binding, and nested components
91. * [EmilTholin/svelte-test](https://github.com/EmilTholin/svelte-test)
92. * [lukechinworth/codenames](https://github.com/lukechinworth/codenames/tree/svelte) – example integration with Redux
93. 
94. ## BrowserStack
95. <img src="https://cdn.worldvectorlogo.com/logos/browserstack.svg" height="80" width="80" align="left">
96. <p>To keep Svelte's performance in check, we use BrowserStack to quickly run benchmarks for each PR that immediately give feedback to the contributor. You can see how we use BrowserStack in the <a href="https://github.com/sveltejs/svelte-bench">svelte-bench</a> project and check out BrowserStack's services on their <a href="https://www.browserstack.com/">website</a>.</p>
97. 
98. ## License
99. 
100. [MIT](LICENSE)


File: src/css/Selector.ts
Line number range: 1 - 266
Content:
1. import MagicString from 'magic-string';
2. import { gatherPossibleValues, UNKNOWN } from './gatherPossibleValues';
3. import { Validator } from '../validate/index';
4. import { Node } from '../interfaces';
5. 
6. export default class Selector {
7. 	node: Node;
8. 	blocks: Block[];
9. 	localBlocks: Block[];
10. 	used: boolean;
11. 
12. 	constructor(node: Node) {
13. 		this.node = node;
14. 
15. 		this.blocks = groupSelectors(node);
16. 
17. 		// take trailing :global(...) selectors out of consideration
18. 		let i = this.blocks.length;
19. 		while (i > 0) {
20. 			if (!this.blocks[i - 1].global) break;
21. 			i -= 1;
22. 		}
23. 
24. 		this.localBlocks = this.blocks.slice(0, i);
25. 		this.used = this.blocks[0].global;
26. 	}
27. 
28. 	apply(node: Node, stack: Node[]) {
29. 		const applies = selectorAppliesTo(this.localBlocks.slice(), node, stack.slice());
30. 
31. 		if (applies) {
32. 			this.used = true;
33. 
34. 			// add svelte-123xyz attribute to outermost and innermost
35. 			// elements — no need to add it to intermediate elements
36. 			node._needsCssAttribute = true;
37. 			if (stack[0] && this.node.children.find(isDescendantSelector)) stack[0]._needsCssAttribute = true;
38. 		}
39. 	}
40. 
41. 	minify(code: MagicString) {
42. 		let c: number = null;
43. 		this.blocks.forEach((block, i) => {
44. 			if (i > 0) {
45. 				if (block.start - c > 1) {
46. 					code.overwrite(c, block.start, block.combinator.name || ' ');
47. 				}
48. 			}
49. 
50. 			c = block.end;
51. 		});
52. 	}
53. 
54. 	transform(code: MagicString, attr: string) {
55. 		function encapsulateBlock(block: Block) {
56. 			let i = block.selectors.length;
57. 			while (i--) {
58. 				const selector = block.selectors[i];
59. 				if (selector.type === 'PseudoElementSelector' || selector.type === 'PseudoClassSelector') continue;
60. 
61. 				if (selector.type === 'TypeSelector' && selector.name === '*') {
62. 					code.overwrite(selector.start, selector.end, attr);
63. 				} else {
64. 					code.appendLeft(selector.end, attr);
65. 				}
66. 
67. 				return;
68. 			}
69. 		}
70. 
71. 		this.blocks.forEach((block, i) => {
72. 			if (block.global) {
73. 				const selector = block.selectors[0];
74. 				const first = selector.children[0];
75. 				const last = selector.children[selector.children.length - 1];
76. 				code.remove(selector.start, first.start).remove(last.end, selector.end);
77. 			} else if (i === 0 || i === this.blocks.length - 1) {
78. 				encapsulateBlock(block);
79. 			}
80. 		});
81. 	}
82. 
83. 	validate(validator: Validator) {
84. 		this.blocks.forEach((block) => {
85. 			let i = block.selectors.length;
86. 			while (i-- > 1) {
87. 				const selector = block.selectors[i];
88. 				if (selector.type === 'PseudoClassSelector' && selector.name === 'global') {
89. 					validator.error(`:global(...) must be the first element in a compound selector`, selector.start);
90. 				}
91. 			}
92. 		});
93. 
94. 		let start = 0;
95. 		let end = this.blocks.length;
96. 
97. 		for (; start < end; start += 1) {
98. 			if (!this.blocks[start].global) break;
99. 		}
100. 
101. 		for (; end > start; end -= 1) {
102. 			if (!this.blocks[end - 1].global) break;
103. 		}
104. 
105. 		for (let i = start; i < end; i += 1) {
106. 			if (this.blocks[i].global) {
107. 				validator.error(`:global(...) can be at the start or end of a selector sequence, but not in the middle`, this.blocks[i].selectors[0].start);
108. 			}
109. 		}
110. 	}
111. }
112. 
113. function isDescendantSelector(selector: Node) {
114. 	return selector.type === 'WhiteSpace' || selector.type === 'Combinator';
115. }
116. 
117. function selectorAppliesTo(blocks: Block[], node: Node, stack: Node[]): boolean {
118. 	const block = blocks.pop();
119. 	if (!block) return false;
120. 
121. 	if (!node) {
122. 		return blocks.every(block => block.global);
123. 	}
124. 
125. 	let i = block.selectors.length;
126. 	let j = stack.length;
127. 
128. 	while (i--) {
129. 		const selector = block.selectors[i];
130. 
131. 		if (selector.type === 'PseudoClassSelector' && selector.name === 'global') {
132. 			// TODO shouldn't see this here... maybe we should enforce that :global(...)
133. 			// cannot be sandwiched between non-global selectors?
134. 			return false;
135. 		}
136. 
137. 		if (selector.type === 'PseudoClassSelector' || selector.type === 'PseudoElementSelector') {
138. 			continue;
139. 		}
140. 
141. 		if (selector.type === 'ClassSelector') {
142. 			if (!attributeMatches(node, 'class', selector.name, '~=', false)) return false;
143. 		}
144. 
145. 		else if (selector.type === 'IdSelector') {
146. 			if (!attributeMatches(node, 'id', selector.name, '=', false)) return false;
147. 		}
148. 
149. 		else if (selector.type === 'AttributeSelector') {
150. 			if (!attributeMatches(node, selector.name.name, selector.value && unquote(selector.value.value), selector.operator, selector.flags)) return false;
151. 		}
152. 
153. 		else if (selector.type === 'TypeSelector') {
154. 			if (node.name !== selector.name && selector.name !== '*') return false;
155. 		}
156. 
157. 		else {
158. 			// bail. TODO figure out what these could be
159. 			return true;
160. 		}
161. 	}
162. 
163. 	if (block.combinator) {
164. 		if (block.combinator.type === 'WhiteSpace') {
165. 			while (stack.length) {
166. 				if (selectorAppliesTo(blocks.slice(), stack.pop(), stack)) {
167. 					return true;
168. 				}
169. 			}
170. 
171. 			return false;
172. 		} else if (block.combinator.name === '>') {
173. 			return selectorAppliesTo(blocks, stack.pop(), stack);
174. 		}
175. 
176. 		// TODO other combinators
177. 		return true;
178. 	}
179. 
180. 	return true;
181. }
182. 
183. const operators = {
184. 	'=' : (value: string, flags: string) => new RegExp(`^${value}$`, flags),
185. 	'~=': (value: string, flags: string) => new RegExp(`\\b${value}\\b`, flags),
186. 	'|=': (value: string, flags: string) => new RegExp(`^${value}(-.+)?$`, flags),
187. 	'^=': (value: string, flags: string) => new RegExp(`^${value}`, flags),
188. 	'$=': (value: string, flags: string) => new RegExp(`${value}$`, flags),
189. 	'*=': (value: string, flags: string) => new RegExp(value, flags)
190. };
191. 
192. function attributeMatches(node: Node, name: string, expectedValue: string, operator: string, caseInsensitive: boolean) {
193. 	const attr = node.attributes.find((attr: Node) => attr.name === name);
194. 	if (!attr) return false;
195. 	if (attr.value === true) return operator === null;
196. 	if (attr.value.length > 1) return true;
197. 
198. 	const pattern = operators[operator](expectedValue, caseInsensitive ? 'i' : '');
199. 	const value = attr.value[0];
200. 
201. 	if (value.type === 'Text') return pattern.test(value.data);
202. 
203. 	const possibleValues = new Set();
204. 	gatherPossibleValues(value.expression, possibleValues);
205. 	if (possibleValues.has(UNKNOWN)) return true;
206. 
207. 	for (const x of Array.from(possibleValues)) { // TypeScript for-of is slightly unlike JS
208. 		if (pattern.test(x)) return true;
209. 	}
210. 
211. 	return false;
212. }
213. 
214. function isDynamic(value: Node) {
215. 	return value.length > 1 || value[0].type !== 'Text';
216. }
217. 
218. function unquote(str: string) {
219. 	if (str[0] === str[str.length - 1] && str[0] === "'" || str[0] === '"') {
220. 		return str.slice(1, str.length - 1);
221. 	}
222. }
223. 
224. class Block {
225. 	global: boolean;
226. 	combinator: Node;
227. 	selectors: Node[]
228. 	start: number;
229. 	end: number;
230. 
231. 	constructor(combinator: Node) {
232. 		this.combinator = combinator;
233. 		this.global = false;
234. 		this.selectors = [];
235. 
236. 		this.start = null;
237. 		this.end = null;
238. 	}
239. 
240. 	add(selector: Node) {
241. 		if (this.selectors.length === 0) {
242. 			this.start = selector.start;
243. 			this.global = selector.type === 'PseudoClassSelector' && selector.name === 'global';
244. 		}
245. 
246. 		this.selectors.push(selector);
247. 		this.end = selector.end;
248. 	}
249. }
250. 
251. function groupSelectors(selector: Node) {
252. 	let block: Block = new Block(null);
253. 
254. 	const blocks = [block];
255. 
256. 	selector.children.forEach((child: Node, i: number) => {
257. 		if (child.type === 'WhiteSpace' || child.type === 'Combinator') {
258. 			block = new Block(child);
259. 			blocks.push(block);
260. 		} else {
261. 			block.add(child);
262. 		}
263. 	});
264. 
265. 	return blocks;
266. }


File: src/css/Stylesheet.ts
Line number range: 1 - 362
Content:
1. import MagicString from 'magic-string';
2. import { walk } from 'estree-walker';
3. import { getLocator } from 'locate-character';
4. import Selector from './Selector';
5. import getCodeFrame from '../utils/getCodeFrame';
6. import { Validator } from '../validate/index';
7. import { Node, Parsed, Warning } from '../interfaces';
8. 
9. class Rule {
10. 	selectors: Selector[];
11. 	declarations: Declaration[];
12. 	node: Node;
13. 	parent: Atrule;
14. 
15. 	constructor(node: Node, parent: Atrule) {
16. 		this.node = node;
17. 		this.parent = parent;
18. 		this.selectors = node.selector.children.map((node: Node) => new Selector(node));
19. 		this.declarations = node.block.children.map((node: Node) => new Declaration(node));
20. 
21. 		if (parent) parent.rules.push(this);
22. 	}
23. 
24. 	apply(node: Node, stack: Node[]) {
25. 		this.selectors.forEach(selector => selector.apply(node, stack)); // TODO move the logic in here?
26. 	}
27. 
28. 	isUsed() {
29. 		if (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;
30. 		return this.selectors.some(s => s.used);
31. 	}
32. 
33. 	minify(code: MagicString, cascade: boolean) {
34. 		let c = this.node.start;
35. 		this.selectors.forEach((selector, i) => {
36. 			if (cascade || selector.used) {
37. 				const separator = i > 0 ? ',' : '';
38. 				if ((selector.node.start - c) > separator.length) {
39. 					code.overwrite(c, selector.node.start, separator);
40. 				}
41. 
42. 				selector.minify(code);
43. 				c = selector.node.end;
44. 			}
45. 		});
46. 
47. 		code.remove(c, this.node.block.start);
48. 
49. 		c = this.node.block.start + 1;
50. 		this.declarations.forEach((declaration, i) => {
51. 			const separator = i > 0 ? ';' : '';
52. 			if ((declaration.node.start - c) > separator.length) {
53. 				code.overwrite(c, declaration.node.start, separator);
54. 			}
55. 
56. 			declaration.minify(code);
57. 
58. 			c = declaration.node.end;
59. 		});
60. 
61. 		code.remove(c, this.node.block.end - 1);
62. 	}
63. 
64. 	transform(code: MagicString, id: string, keyframes: Map<string, string>, cascade: boolean) {
65. 		if (this.parent && this.parent.node.type === 'Atrule' && this.parent.node.name === 'keyframes') return true;
66. 
67. 		const attr = `[${id}]`;
68. 
69. 		if (cascade) {
70. 			this.selectors.forEach(selector => {
71. 				// TODO disable cascading (without :global(...)) in v2
72. 				const { start, end, children } = selector.node;
73. 
74. 				const css = code.original;
75. 				const selectorString = css.slice(start, end);
76. 
77. 				const firstToken = children[0];
78. 
79. 				let transformed;
80. 
81. 				if (firstToken.type === 'TypeSelector') {
82. 					const insert = firstToken.end;
83. 					const head = firstToken.name === '*' ? '' : css.slice(start, insert);
84. 					const tail = css.slice(insert, end);
85. 
86. 					transformed = `${head}${attr}${tail},${attr} ${selectorString}`;
87. 				} else {
88. 					transformed = `${attr}${selectorString},${attr} ${selectorString}`;
89. 				}
90. 
91. 				code.overwrite(start, end, transformed);
92. 			});
93. 		} else {
94. 			this.selectors.forEach(selector => selector.transform(code, attr));
95. 		}
96. 
97. 		this.declarations.forEach(declaration => declaration.transform(code, keyframes));
98. 	}
99. }
100. 
101. class Declaration {
102. 	node: Node;
103. 
104. 	constructor(node: Node) {
105. 		this.node = node;
106. 	}
107. 
108. 	transform(code: MagicString, keyframes: Map<string, string>) {
109. 		const property = this.node.property.toLowerCase();
110. 		if (property === 'animation' || property === 'animation-name') {
111. 			this.node.value.children.forEach((block: Node) => {
112. 				if (block.type === 'Identifier') {
113. 					const name = block.name;
114. 					if (keyframes.has(name)) {
115. 						code.overwrite(block.start, block.end, keyframes.get(name));
116. 					}
117. 				}
118. 			});
119. 		}
120. 	}
121. 
122. 	minify(code: MagicString) {
123. 		const c = this.node.start + this.node.property.length;
124. 		const first = this.node.value.children[0];
125. 
126. 		if (first.start - c > 1) {
127. 			code.overwrite(c, first.start, ':');
128. 		}
129. 	}
130. }
131. 
132. class Atrule {
133. 	node: Node;
134. 	rules: Rule[];
135. 
136. 	constructor(node: Node) {
137. 		this.node = node;
138. 		this.rules = [];
139. 	}
140. 
141. 	isUsed() {
142. 		return true; // TODO
143. 	}
144. 
145. 	minify(code: MagicString, cascade: boolean) {
146. 		if (this.node.name === 'media') {
147. 			let c = this.node.start + 6;
148. 			if (this.node.expression.start > c) code.remove(c, this.node.expression.start);
149. 
150. 			this.node.expression.children.forEach((query: Node) => {
151. 				// TODO minify queries
152. 				c = query.end;
153. 			});
154. 
155. 			code.remove(c, this.node.block.start);
156. 		} else if (this.node.name === 'keyframes') {
157. 			let c = this.node.start + 10;
158. 			if (this.node.expression.start - c > 1) code.overwrite(c, this.node.expression.start, ' ');
159. 			c = this.node.expression.end;
160. 			if (this.node.block.start - c > 0) code.remove(c, this.node.block.start);
161. 		}
162. 
163. 		// TODO other atrules
164. 
165. 		if (this.node.block) {
166. 			let c = this.node.block.start + 1;
167. 
168. 			this.rules.forEach(rule => {
169. 				if (cascade || rule.isUsed()) {
170. 					code.remove(c, rule.node.start);
171. 					rule.minify(code, cascade);
172. 					c = rule.node.end;
173. 				}
174. 			});
175. 
176. 			code.remove(c, this.node.block.end - 1);
177. 		}
178. 	}
179. 
180. 	transform(code: MagicString, id: string, keyframes: Map<string, string>) {
181. 		if (this.node.name !== 'keyframes') return;
182. 
183. 		this.node.expression.children.forEach((expression: Node) => {
184. 			if (expression.type === 'Identifier') {
185. 				if (expression.name.startsWith('-global-')) {
186. 					code.remove(expression.start, expression.start + 8);
187. 				} else {
188. 					const newName = `${id}-${expression.name}`;
189. 					code.overwrite(expression.start, expression.end, newName);
190. 					keyframes.set(expression.name, newName);
191. 				}
192. 			}
193. 		});
194. 	}
195. }
196. 
197. const keys = {};
198. 
199. export default class Stylesheet {
200. 	source: string;
201. 	parsed: Parsed;
202. 	cascade: boolean;
203. 	filename: string;
204. 
205. 	hasStyles: boolean;
206. 	id: string;
207. 
208. 	nodes: (Rule|Atrule)[];
209. 	rules: Rule[];
210. 	atrules: Atrule[];
211. 
212. 	constructor(source: string, parsed: Parsed, filename: string, cascade: boolean) {
213. 		this.source = source;
214. 		this.parsed = parsed;
215. 		this.cascade = cascade;
216. 		this.filename = filename;
217. 
218. 		this.id = `svelte-${parsed.hash}`;
219. 
220. 		this.nodes = [];
221. 		this.rules = [];
222. 		this.atrules = [];
223. 
224. 		if (parsed.css && parsed.css.children.length) {
225. 			this.hasStyles = true;
226. 
227. 			const stack: Atrule[] = [];
228. 			let currentAtrule: Atrule = null;
229. 
230. 			walk(this.parsed.css, {
231. 				enter: (node: Node) => {
232. 					if (node.type === 'Atrule') {
233. 						const atrule = currentAtrule = new Atrule(node);
234. 						stack.push(atrule);
235. 
236. 						this.nodes.push(atrule);
237. 						this.atrules.push(atrule);
238. 					}
239. 
240. 					if (node.type === 'Rule') {
241. 						// TODO this is a bit confusing. Don't have a separate
242. 						// array of rules, just transform top-level nodes and
243. 						// let them worry about their children
244. 						const rule = new Rule(node, currentAtrule);
245. 
246. 						this.rules.push(rule);
247. 
248. 						if (!currentAtrule) {
249. 							this.nodes.push(rule);
250. 						}
251. 					}
252. 				},
253. 
254. 				leave: (node: Node) => {
255. 					if (node.type === 'Atrule') {
256. 						stack.pop();
257. 						currentAtrule = stack[stack.length - 1];
258. 					}
259. 				}
260. 			});
261. 		} else {
262. 			this.hasStyles = false;
263. 		}
264. 	}
265. 
266. 	apply(node: Node, stack: Node[]) {
267. 		if (!this.hasStyles) return;
268. 
269. 		if (this.cascade) {
270. 			if (stack.length === 0) node._needsCssAttribute = true;
271. 			return;
272. 		}
273. 
274. 		for (let i = 0; i < this.rules.length; i += 1) {
275. 			const rule = this.rules[i];
276. 			rule.apply(node, stack);
277. 		}
278. 	}
279. 
280. 	render(cssOutputFilename: string) {
281. 		if (!this.hasStyles) {
282. 			return { css: null, cssMap: null };
283. 		}
284. 
285. 		const code = new MagicString(this.source);
286. 
287. 		walk(this.parsed.css, {
288. 			enter: (node: Node) => {
289. 				code.addSourcemapLocation(node.start);
290. 				code.addSourcemapLocation(node.end);
291. 			}
292. 		});
293. 
294. 		// TODO all transform/minify in single pass. The mutation of
295. 		// `keyframes` here is confusing
296. 		const keyframes = new Map();
297. 		this.atrules.forEach((atrule: Atrule) => {
298. 			atrule.transform(code, this.id, keyframes);
299. 		});
300. 
301. 		this.rules.forEach((rule: Rule) => {
302. 			rule.transform(code, this.id, keyframes, this.cascade);
303. 		});
304. 
305. 		let c = 0;
306. 		this.nodes.forEach(node => {
307. 			if (this.cascade || node.isUsed()) {
308. 				code.remove(c, node.node.start);
309. 				node.minify(code, this.cascade);
310. 				c = node.node.end;
311. 			}
312. 		});
313. 
314. 		code.remove(c, this.source.length);
315. 
316. 		return {
317. 			css: code.toString(),
318. 			cssMap: code.generateMap({
319. 				includeContent: true,
320. 				source: this.filename,
321. 				file: cssOutputFilename
322. 			})
323. 		};
324. 	}
325. 
326. 	validate(validator: Validator) {
327. 		this.rules.forEach(rule => {
328. 			rule.selectors.forEach(selector => {
329. 				selector.validate(validator);
330. 			});
331. 		});
332. 	}
333. 
334. 	warnOnUnusedSelectors(onwarn: (warning: Warning) => void) {
335. 		if (this.cascade) return;
336. 
337. 		let locator;
338. 
339. 		this.rules.forEach((rule: Rule) => {
340. 			rule.selectors.forEach(selector => {
341. 				if (!selector.used) {
342. 					const pos = selector.node.start;
343. 
344. 					if (!locator) locator = getLocator(this.source);
345. 					const { line, column } = locator(pos);
346. 
347. 					const frame = getCodeFrame(this.source, line, column);
348. 					const message = `Unused CSS selector`;
349. 
350. 					onwarn({
351. 						message,
352. 						frame,
353. 						loc: { line: line + 1, column },
354. 						pos,
355. 						filename: this.filename,
356. 						toString: () => `${message} (${line + 1}:${column})\n${frame}`,
357. 					});
358. 				}
359. 			});
360. 		});
361. 	}
362. }


File: src/css/gatherPossibleValues.ts
Line number range: 1 - 18
Content:
1. import { Node } from '../interfaces';
2. 
3. export const UNKNOWN = {};
4. 
5. export function gatherPossibleValues(node: Node, set: Set<string|{}>) {
6. 	if (node.type === 'Literal') {
7. 		set.add(node.value);
8. 	}
9. 
10. 	else if (node.type === 'ConditionalExpression') {
11. 		gatherPossibleValues(node.consequent, set);
12. 		gatherPossibleValues(node.alternate, set);
13. 	}
14. 
15. 	else {
16. 		set.add(UNKNOWN);
17. 	}
18. }


File: src/generators/Generator.ts
Line number range: 1 - 500
Content:
1. import MagicString, { Bundle } from 'magic-string';
2. import { walk } from 'estree-walker';
3. import { getLocator } from 'locate-character';
4. import getCodeFrame from '../utils/getCodeFrame';
5. import isReference from '../utils/isReference';
6. import flattenReference from '../utils/flattenReference';
7. import globalWhitelist from '../utils/globalWhitelist';
8. import reservedNames from '../utils/reservedNames';
9. import namespaces from '../utils/namespaces';
10. import { removeNode, removeObjectKey } from '../utils/removeNode';
11. import getIntro from './shared/utils/getIntro';
12. import getOutro from './shared/utils/getOutro';
13. import annotateWithScopes from '../utils/annotateWithScopes';
14. import clone from '../utils/clone';
15. import DomBlock from './dom/Block';
16. import SsrBlock from './server-side-rendering/Block';
17. import Stylesheet from '../css/Stylesheet';
18. import { Node, GenerateOptions, Parsed, CompileOptions } from '../interfaces';
19. 
20. const test = typeof global !== 'undefined' && global.__svelte_test;
21. 
22. interface Computation {
23. 	key: string;
24. 	deps: string[]
25. }
26. 
27. export default class Generator {
28. 	ast: Parsed;
29. 	parsed: Parsed;
30. 	source: string;
31. 	name: string;
32. 	options: CompileOptions;
33. 
34. 	defaultExport: Node[];
35. 	imports: Node[];
36. 	helpers: Set<string>;
37. 	components: Set<string>;
38. 	events: Set<string>;
39. 	transitions: Set<string>;
40. 	importedComponents: Map<string, string>;
41. 	namespace: string;
42. 	hasComponents: boolean;
43. 	hasJs: boolean;
44. 	computations: Computation[];
45. 	templateProperties: Record<string, Node>;
46. 
47. 	code: MagicString;
48. 
49. 	bindingGroups: string[];
50. 	indirectDependencies: Map<string, Set<string>>;
51. 	expectedProperties: Set<string>;
52. 	usesRefs: boolean;
53. 
54. 	stylesheet: Stylesheet;
55. 
56. 	importedNames: Set<string>;
57. 	aliases: Map<string, string>;
58. 	usedNames: Set<string>;
59. 
60. 	constructor(
61. 		parsed: Parsed,
62. 		source: string,
63. 		name: string,
64. 		stylesheet: Stylesheet,
65. 		options: CompileOptions
66. 	) {
67. 		this.ast = clone(parsed);
68. 
69. 		this.parsed = parsed;
70. 		this.source = source;
71. 		this.options = options;
72. 
73. 		this.imports = [];
74. 		this.helpers = new Set();
75. 		this.components = new Set();
76. 		this.events = new Set();
77. 		this.transitions = new Set();
78. 		this.importedComponents = new Map();
79. 
80. 		this.bindingGroups = [];
81. 		this.indirectDependencies = new Map();
82. 
83. 		// track which properties are needed, so we can provide useful info
84. 		// in dev mode
85. 		this.expectedProperties = new Set();
86. 
87. 		this.code = new MagicString(source);
88. 		this.usesRefs = false;
89. 
90. 		// styles
91. 		this.stylesheet = stylesheet;
92. 
93. 		// allow compiler to deconflict user's `import { get } from 'whatever'` and
94. 		// Svelte's builtin `import { get, ... } from 'svelte/shared.ts'`;
95. 		this.importedNames = new Set();
96. 		this.aliases = new Map();
97. 		this.usedNames = new Set();
98. 
99. 		this.parseJs();
100. 		this.name = this.alias(name);
101. 	}
102. 
103. 	addSourcemapLocations(node: Node) {
104. 		walk(node, {
105. 			enter: (node: Node) => {
106. 				this.code.addSourcemapLocation(node.start);
107. 				this.code.addSourcemapLocation(node.end);
108. 			},
109. 		});
110. 	}
111. 
112. 	alias(name: string) {
113. 		if (!this.aliases.has(name)) {
114. 			this.aliases.set(name, this.getUniqueName(name));
115. 		}
116. 
117. 		return this.aliases.get(name);
118. 	}
119. 
120. 	contextualise(
121. 		block: DomBlock | SsrBlock,
122. 		expression: Node,
123. 		context: string,
124. 		isEventHandler: boolean
125. 	) {
126. 		this.addSourcemapLocations(expression);
127. 
128. 		const usedContexts: string[] = [];
129. 
130. 		const { code, helpers } = this;
131. 		const { contexts, indexes } = block;
132. 
133. 		let scope = annotateWithScopes(expression); // TODO this already happens in findDependencies
134. 		let lexicalDepth = 0;
135. 
136. 		const self = this;
137. 
138. 		walk(expression, {
139. 			enter(node: Node, parent: Node, key: string) {
140. 				if (/^Function/.test(node.type)) lexicalDepth += 1;
141. 
142. 				if (node._scope) {
143. 					scope = node._scope;
144. 					return;
145. 				}
146. 
147. 				if (node.type === 'ThisExpression') {
148. 					if (lexicalDepth === 0 && context)
149. 						code.overwrite(node.start, node.end, context, {
150. 							storeName: true,
151. 							contentOnly: false,
152. 						});
153. 				} else if (isReference(node, parent)) {
154. 					const { name } = flattenReference(node);
155. 					if (scope.has(name)) return;
156. 
157. 					if (name === 'event' && isEventHandler) {
158. 						// noop
159. 					} else if (contexts.has(name)) {
160. 						const contextName = contexts.get(name);
161. 						if (contextName !== name) {
162. 							// this is true for 'reserved' names like `state` and `component`
163. 							code.overwrite(
164. 								node.start,
165. 								node.start + name.length,
166. 								contextName,
167. 								{ storeName: true, contentOnly: false }
168. 							);
169. 						}
170. 
171. 						if (!~usedContexts.indexOf(name)) usedContexts.push(name);
172. 					} else if (helpers.has(name)) {
173. 						code.prependRight(node.start, `${self.alias('template')}.helpers.`);
174. 					} else if (indexes.has(name)) {
175. 						const context = indexes.get(name);
176. 						if (!~usedContexts.indexOf(context)) usedContexts.push(context);
177. 					} else {
178. 						// handle shorthand properties
179. 						if (parent && parent.type === 'Property' && parent.shorthand) {
180. 							if (key === 'key') {
181. 								code.appendLeft(node.start, `${name}: `);
182. 								return;
183. 							}
184. 						}
185. 
186. 						if (globalWhitelist.has(name)) {
187. 							code.prependRight(node.start, `( '${name}' in state ? state.`);
188. 							code.appendLeft(
189. 								node.object ? node.object.end : node.end,
190. 								` : ${name} )`
191. 							);
192. 						} else {
193. 							code.prependRight(node.start, `state.`);
194. 						}
195. 
196. 						if (!~usedContexts.indexOf('state')) usedContexts.push('state');
197. 					}
198. 
199. 					this.skip();
200. 				}
201. 			},
202. 
203. 			leave(node: Node) {
204. 				if (/^Function/.test(node.type)) lexicalDepth -= 1;
205. 				if (node._scope) scope = scope.parent;
206. 			},
207. 		});
208. 
209. 		const dependencies = new Set(expression._dependencies || []);
210. 
211. 		if (expression._dependencies) {
212. 			expression._dependencies.forEach((prop: string) => {
213. 				if (this.indirectDependencies.has(prop)) {
214. 					this.indirectDependencies.get(prop).forEach(dependency => {
215. 						dependencies.add(dependency);
216. 					});
217. 				}
218. 			});
219. 		}
220. 
221. 		return {
222. 			dependencies: Array.from(dependencies),
223. 			contexts: usedContexts,
224. 			snippet: `[✂${expression.start}-${expression.end}✂]`,
225. 		};
226. 	}
227. 
228. 	findDependencies(
229. 		contextDependencies: Map<string, string[]>,
230. 		indexes: Map<string, string>,
231. 		expression: Node
232. 	) {
233. 		if (expression._dependencies) return expression._dependencies;
234. 
235. 		let scope = annotateWithScopes(expression);
236. 		const dependencies: string[] = [];
237. 
238. 		const generator = this; // can't use arrow functions, because of this.skip()
239. 
240. 		walk(expression, {
241. 			enter(node: Node, parent: Node) {
242. 				if (node._scope) {
243. 					scope = node._scope;
244. 					return;
245. 				}
246. 
247. 				if (isReference(node, parent)) {
248. 					const { name } = flattenReference(node);
249. 					if (scope.has(name) || generator.helpers.has(name)) return;
250. 
251. 					if (contextDependencies.has(name)) {
252. 						dependencies.push(...contextDependencies.get(name));
253. 					} else if (!indexes.has(name)) {
254. 						dependencies.push(name);
255. 					}
256. 
257. 					this.skip();
258. 				}
259. 			},
260. 
261. 			leave(node: Node) {
262. 				if (node._scope) scope = scope.parent;
263. 			},
264. 		});
265. 
266. 		dependencies.forEach(name => {
267. 			if (!globalWhitelist.has(name)) {
268. 				this.expectedProperties.add(name);
269. 			}
270. 		});
271. 
272. 		return (expression._dependencies = dependencies);
273. 	}
274. 
275. 	generate(result: string, options: CompileOptions, { name, format }: GenerateOptions ) {
276. 		if (this.imports.length) {
277. 			const statements: string[] = [];
278. 
279. 			this.imports.forEach((declaration, i) => {
280. 				if (format === 'es') {
281. 					statements.push(
282. 						this.source.slice(declaration.start, declaration.end)
283. 					);
284. 					return;
285. 				}
286. 
287. 				const defaultImport = declaration.specifiers.find(
288. 					(x: Node) =>
289. 						x.type === 'ImportDefaultSpecifier' ||
290. 						(x.type === 'ImportSpecifier' && x.imported.name === 'default')
291. 				);
292. 				const namespaceImport = declaration.specifiers.find(
293. 					(x: Node) => x.type === 'ImportNamespaceSpecifier'
294. 				);
295. 				const namedImports = declaration.specifiers.filter(
296. 					(x: Node) =>
297. 						x.type === 'ImportSpecifier' && x.imported.name !== 'default'
298. 				);
299. 
300. 				const name = defaultImport || namespaceImport
301. 					? (defaultImport || namespaceImport).local.name
302. 					: `__import${i}`;
303. 				declaration.name = name; // hacky but makes life a bit easier later
304. 
305. 				namedImports.forEach((specifier: Node) => {
306. 					statements.push(
307. 						`var ${specifier.local.name} = ${name}.${specifier.imported.name}`
308. 					);
309. 				});
310. 
311. 				if (defaultImport) {
312. 					statements.push(
313. 						`${name} = ( ${name} && ${name}.__esModule ) ? ${name}['default'] : ${name};`
314. 					);
315. 				}
316. 			});
317. 
318. 			result = `${statements.join('\n')}\n\n${result}`;
319. 		}
320. 
321. 		const pattern = /\[✂(\d+)-(\d+)$/;
322. 
323. 		const parts = result.split('✂]');
324. 		const finalChunk = parts.pop();
325. 
326. 		const compiled = new Bundle({ separator: '' });
327. 
328. 		function addString(str: string) {
329. 			compiled.addSource({
330. 				content: new MagicString(str),
331. 			});
332. 		}
333. 
334. 		const intro = getIntro(format, options, this.imports);
335. 		if (intro) addString(intro);
336. 
337. 		const { filename } = options;
338. 
339. 		// special case — the source file doesn't actually get used anywhere. we need
340. 		// to add an empty file to populate map.sources and map.sourcesContent
341. 		if (!parts.length) {
342. 			compiled.addSource({
343. 				filename,
344. 				content: new MagicString(this.source).remove(0, this.source.length),
345. 			});
346. 		}
347. 
348. 		parts.forEach((str: string) => {
349. 			const chunk = str.replace(pattern, '');
350. 			if (chunk) addString(chunk);
351. 
352. 			const match = pattern.exec(str);
353. 
354. 			const snippet = this.code.snip(+match[1], +match[2]);
355. 
356. 			compiled.addSource({
357. 				filename,
358. 				content: snippet,
359. 			});
360. 		});
361. 
362. 		addString(finalChunk);
363. 		addString('\n\n' + getOutro(format, name, options, this.imports));
364. 
365. 		const { css, cssMap } = this.stylesheet.render(options.cssOutputFilename);
366. 
367. 		return {
368. 			ast: this.ast,
369. 			code: compiled.toString(),
370. 			map: compiled.generateMap({
371. 				includeContent: true,
372. 				file: options.outputFilename,
373. 			}),
374. 			css,
375. 			cssMap
376. 		};
377. 	}
378. 
379. 	getUniqueName(name: string) {
380. 		if (test) name = `${name}$`;
381. 		let alias = name;
382. 		for (
383. 			let i = 1;
384. 			reservedNames.has(alias) ||
385. 			this.importedNames.has(alias) ||
386. 			this.usedNames.has(alias);
387. 			alias = `${name}_${i++}`
388. 		);
389. 		this.usedNames.add(alias);
390. 		return alias;
391. 	}
392. 
393. 	getUniqueNameMaker(params: string[]) {
394. 		const localUsedNames = new Set(params);
395. 		return (name: string) => {
396. 			if (test) name = `${name}$`;
397. 			let alias = name;
398. 			for (
399. 				let i = 1;
400. 				reservedNames.has(alias) ||
401. 				this.importedNames.has(alias) ||
402. 				this.usedNames.has(alias) ||
403. 				localUsedNames.has(alias);
404. 				alias = `${name}_${i++}`
405. 			);
406. 			localUsedNames.add(alias);
407. 			return alias;
408. 		};
409. 	}
410. 
411. 	parseJs() {
412. 		const { source } = this;
413. 		const { js } = this.parsed;
414. 
415. 		const imports = this.imports;
416. 		const computations: Computation[] = [];
417. 		const templateProperties: Record<string, Node> = {};
418. 
419. 		let namespace = null;
420. 		let hasJs = !!js;
421. 
422. 		if (js) {
423. 			this.addSourcemapLocations(js.content);
424. 			const body = js.content.body.slice(); // slice, because we're going to be mutating the original
425. 
426. 			// imports need to be hoisted out of the IIFE
427. 			for (let i = 0; i < body.length; i += 1) {
428. 				const node = body[i];
429. 				if (node.type === 'ImportDeclaration') {
430. 					removeNode(this.code, js.content, node);
431. 					imports.push(node);
432. 
433. 					node.specifiers.forEach((specifier: Node) => {
434. 						this.importedNames.add(specifier.local.name);
435. 					});
436. 				}
437. 			}
438. 
439. 			const defaultExport = this.defaultExport = body.find(
440. 				(node: Node) => node.type === 'ExportDefaultDeclaration'
441. 			);
442. 
443. 			if (defaultExport) {
444. 				defaultExport.declaration.properties.forEach((prop: Node) => {
445. 					templateProperties[prop.key.name] = prop;
446. 				});
447. 			}
448. 
449. 			['helpers', 'events', 'components', 'transitions'].forEach(key => {
450. 				if (templateProperties[key]) {
451. 					templateProperties[key].value.properties.forEach((prop: Node) => {
452. 						this[key].add(prop.key.name);
453. 					});
454. 				}
455. 			});
456. 
457. 			if (templateProperties.computed) {
458. 				const dependencies = new Map();
459. 
460. 				templateProperties.computed.value.properties.forEach((prop: Node) => {
461. 					const key = prop.key.name;
462. 					const value = prop.value;
463. 
464. 					const deps = value.params.map(
465. 						(param: Node) =>
466. 							param.type === 'AssignmentPattern' ? param.left.name : param.name
467. 					);
468. 					dependencies.set(key, deps);
469. 				});
470. 
471. 				const visited = new Set();
472. 
473. 				const visit = function visit(key: string) {
474. 					if (!dependencies.has(key)) return; // not a computation
475. 
476. 					if (visited.has(key)) return;
477. 					visited.add(key);
478. 
479. 					const deps = dependencies.get(key);
480. 					deps.forEach(visit);
481. 
482. 					computations.push({ key, deps });
483. 				}
484. 
485. 				templateProperties.computed.value.properties.forEach((prop: Node) =>
486. 					visit(prop.key.name)
487. 				);
488. 			}
489. 
490. 			if (templateProperties.namespace) {
491. 				const ns = templateProperties.namespace.value.value;
492. 				namespace = namespaces[ns] || ns;
493. 
494. 				removeObjectKey(this.code, defaultExport.declaration, 'namespace');
495. 			}
496. 
497. 			if (templateProperties.components) {
498. 				let hasNonImportedComponent = false;
499. 				templateProperties.components.value.properties.forEach(
500. 					(property: Node) => {


File: src/generators/dom/Block.ts
Line number range: 1 - 362
Content:
1. import CodeBuilder from '../../utils/CodeBuilder';
2. import deindent from '../../utils/deindent';
3. import { DomGenerator } from './index';
4. import { Node } from '../../interfaces';
5. import shared from './shared';
6. 
7. export interface BlockOptions {
8. 	name: string;
9. 	generator?: DomGenerator;
10. 	expression?: Node;
11. 	context?: string;
12. 	key?: string;
13. 	contexts?: Map<string, string>;
14. 	indexes?: Map<string, string>;
15. 	contextDependencies?: Map<string, string[]>;
16. 	params?: string[];
17. 	indexNames?: Map<string, string>;
18. 	listNames?: Map<string, string>;
19. 	indexName?: string;
20. 	listName?: string;
21. 	dependencies?: Set<string>;
22. }
23. 
24. export default class Block {
25. 	generator: DomGenerator;
26. 	name: string;
27. 	expression: Node;
28. 	context: string;
29. 
30. 	key: string;
31. 	first: string;
32. 
33. 	contexts: Map<string, string>;
34. 	indexes: Map<string, string>;
35. 	contextDependencies: Map<string, string[]>;
36. 	dependencies: Set<string>;
37. 	params: string[];
38. 	indexNames: Map<string, string>;
39. 	listNames: Map<string, string>;
40. 	indexName: string;
41. 	listName: string;
42. 
43. 	builders: {
44. 		init: CodeBuilder;
45. 		create: CodeBuilder;
46. 		claim: CodeBuilder;
47. 		hydrate: CodeBuilder;
48. 		mount: CodeBuilder;
49. 		intro: CodeBuilder;
50. 		update: CodeBuilder;
51. 		outro: CodeBuilder;
52. 		unmount: CodeBuilder;
53. 		detachRaw: CodeBuilder;
54. 		destroy: CodeBuilder;
55. 	};
56. 
57. 	hasIntroMethod: boolean;
58. 	hasOutroMethod: boolean;
59. 	outros: number;
60. 
61. 	aliases: Map<string, string>;
62. 	variables: Map<string, string>;
63. 	getUniqueName: (name: string) => string;
64. 
65. 	hasUpdateMethod: boolean;
66. 	autofocus: string;
67. 
68. 	constructor(options: BlockOptions) {
69. 		this.generator = options.generator;
70. 		this.name = options.name;
71. 		this.expression = options.expression;
72. 		this.context = options.context;
73. 
74. 		// for keyed each blocks
75. 		this.key = options.key;
76. 		this.first = null;
77. 
78. 		this.contexts = options.contexts;
79. 		this.indexes = options.indexes;
80. 		this.contextDependencies = options.contextDependencies;
81. 		this.dependencies = new Set();
82. 
83. 		this.params = options.params;
84. 		this.indexNames = options.indexNames;
85. 		this.listNames = options.listNames;
86. 
87. 		this.listName = options.listName;
88. 
89. 		this.builders = {
90. 			init: new CodeBuilder(),
91. 			create: new CodeBuilder(),
92. 			claim: new CodeBuilder(),
93. 			hydrate: new CodeBuilder(),
94. 			mount: new CodeBuilder(),
95. 			intro: new CodeBuilder(),
96. 			update: new CodeBuilder(),
97. 			outro: new CodeBuilder(),
98. 			unmount: new CodeBuilder(),
99. 			detachRaw: new CodeBuilder(),
100. 			destroy: new CodeBuilder(),
101. 		};
102. 
103. 		this.hasIntroMethod = false; // a block could have an intro method but not intro transitions, e.g. if a sibling block has intros
104. 		this.hasOutroMethod = false;
105. 		this.outros = 0;
106. 
107. 		this.aliases = new Map();
108. 		this.variables = new Map();
109. 		this.getUniqueName = this.generator.getUniqueNameMaker(options.params);
110. 
111. 		this.hasUpdateMethod = false; // determined later
112. 	}
113. 
114. 	addDependencies(dependencies: string[]) {
115. 		dependencies.forEach(dependency => {
116. 			this.dependencies.add(dependency);
117. 		});
118. 	}
119. 
120. 	addElement(
121. 		name: string,
122. 		renderStatement: string,
123. 		claimStatement: string,
124. 		parentNode: string,
125. 		needsIdentifier = false
126. 	) {
127. 		const isToplevel = !parentNode;
128. 
129. 		this.addVariable(name);
130. 		this.builders.create.addLine(`${name} = ${renderStatement};`);
131. 		this.builders.claim.addLine(`${name} = ${claimStatement};`);
132. 
133. 		this.mount(name, parentNode);
134. 
135. 		if (isToplevel) {
136. 			this.builders.unmount.addLine(`@detachNode( ${name} );`);
137. 		}
138. 	}
139. 
140. 	addVariable(name: string, init?: string) {
141. 		if (this.variables.has(name) && this.variables.get(name) !== init) {
142. 			throw new Error(
143. 				`Variable '${name}' already initialised with a different value`
144. 			);
145. 		}
146. 
147. 		this.variables.set(name, init);
148. 	}
149. 
150. 	alias(name: string) {
151. 		if (!this.aliases.has(name)) {
152. 			this.aliases.set(name, this.getUniqueName(name));
153. 		}
154. 
155. 		return this.aliases.get(name);
156. 	}
157. 
158. 	child(options: BlockOptions) {
159. 		return new Block(Object.assign({}, this, options, { parent: this }));
160. 	}
161. 
162. 	contextualise(expression: Node, context?: string, isEventHandler?: boolean) {
163. 		return this.generator.contextualise(
164. 			this,
165. 			expression,
166. 			context,
167. 			isEventHandler
168. 		);
169. 	}
170. 
171. 	findDependencies(expression: Node) {
172. 		return this.generator.findDependencies(
173. 			this.contextDependencies,
174. 			this.indexes,
175. 			expression
176. 		);
177. 	}
178. 
179. 	mount(name: string, parentNode: string) {
180. 		if (parentNode) {
181. 			this.builders.mount.addLine(`@appendNode( ${name}, ${parentNode} );`);
182. 		} else {
183. 			this.builders.mount.addLine(`@insertNode( ${name}, #target, anchor );`);
184. 		}
185. 	}
186. 
187. 	render() {
188. 		let introing;
189. 		const hasIntros = !this.builders.intro.isEmpty();
190. 		if (hasIntros) {
191. 			introing = this.getUniqueName('introing');
192. 			this.addVariable(introing);
193. 		}
194. 
195. 		let outroing;
196. 		const hasOutros = !this.builders.outro.isEmpty();
197. 		if (hasOutros) {
198. 			outroing = this.getUniqueName('outroing');
199. 			this.addVariable(outroing);
200. 		}
201. 
202. 		if (this.autofocus) {
203. 			this.builders.mount.addLine(`${this.autofocus}.focus();`);
204. 		}
205. 
206. 		// minor hack – we need to ensure that any {{{triples}}} are detached first
207. 		this.builders.unmount.addBlockAtStart(this.builders.detachRaw);
208. 
209. 		const properties = new CodeBuilder();
210. 
211. 		let localKey;
212. 		if (this.key) {
213. 			localKey = this.getUniqueName('key');
214. 			properties.addBlock(`key: ${localKey},`);
215. 		}
216. 
217. 		if (this.first) {
218. 			properties.addBlock(`first: null,`);
219. 			this.builders.hydrate.addLine(`this.first = ${this.first};`);
220. 		}
221. 
222. 		if (this.builders.create.isEmpty()) {
223. 			properties.addBlock(`create: @noop,`);
224. 		} else {
225. 			properties.addBlock(deindent`
226. 				create: function () {
227. 					${this.builders.create}
228. 					${!this.builders.hydrate.isEmpty() && `this.hydrate();`}
229. 				},
230. 			`);
231. 		}
232. 
233. 		if (this.generator.hydratable) {
234. 			if (this.builders.claim.isEmpty()) {
235. 				properties.addBlock(`claim: @noop,`);
236. 			} else {
237. 				properties.addBlock(deindent`
238. 					claim: function ( nodes ) {
239. 						${this.builders.claim}
240. 						${!this.builders.hydrate.isEmpty() && `this.hydrate();`}
241. 					},
242. 				`);
243. 			}
244. 		}
245. 
246. 		if (!this.builders.hydrate.isEmpty()) {
247. 			properties.addBlock(deindent`
248. 				hydrate: function ( nodes ) {
249. 					${this.builders.hydrate}
250. 				},
251. 			`);
252. 		}
253. 
254. 		if (this.builders.mount.isEmpty()) {
255. 			properties.addBlock(`mount: @noop,`);
256. 		} else {
257. 			properties.addBlock(deindent`
258. 				mount: function ( #target, anchor ) {
259. 					${this.builders.mount}
260. 				},
261. 			`);
262. 		}
263. 
264. 		if (this.hasUpdateMethod) {
265. 			if (this.builders.update.isEmpty()) {
266. 				properties.addBlock(`update: @noop,`);
267. 			} else {
268. 				properties.addBlock(deindent`
269. 					update: function ( changed, ${this.params.join(', ')} ) {
270. 						${this.builders.update}
271. 					},
272. 				`);
273. 			}
274. 		}
275. 
276. 		if (this.hasIntroMethod) {
277. 			if (hasIntros) {
278. 				properties.addBlock(deindent`
279. 					intro: function ( #target, anchor ) {
280. 						if ( ${introing} ) return;
281. 						${introing} = true;
282. 						${hasOutros && `${outroing} = false;`}
283. 
284. 						${this.builders.intro}
285. 
286. 						this.mount( #target, anchor );
287. 					},
288. 				`);
289. 			} else {
290. 				properties.addBlock(deindent`
291. 					intro: function ( #target, anchor ) {
292. 						this.mount( #target, anchor );
293. 					},
294. 				`);
295. 			}
296. 		}
297. 
298. 		if (this.hasOutroMethod) {
299. 			if (hasOutros) {
300. 				properties.addBlock(deindent`
301. 					outro: function ( ${this.alias('outrocallback')} ) {
302. 						if ( ${outroing} ) return;
303. 						${outroing} = true;
304. 						${hasIntros && `${introing} = false;`}
305. 
306. 						var ${this.alias('outros')} = ${this.outros};
307. 
308. 						${this.builders.outro}
309. 					},
310. 				`);
311. 			} else {
312. 				properties.addBlock(deindent`
313. 					outro: function ( outrocallback ) {
314. 						outrocallback();
315. 					},
316. 				`);
317. 			}
318. 		}
319. 
320. 		if (this.builders.unmount.isEmpty()) {
321. 			properties.addBlock(`unmount: @noop,`);
322. 		} else {
323. 			properties.addBlock(deindent`
324. 				unmount: function () {
325. 					${this.builders.unmount}
326. 				},
327. 			`);
328. 		}
329. 
330. 		if (this.builders.destroy.isEmpty()) {
331. 			properties.addBlock(`destroy: @noop`);
332. 		} else {
333. 			properties.addBlock(deindent`
334. 				destroy: function () {
335. 					${this.builders.destroy}
336. 				}
337. 			`);
338. 		}
339. 
340. 		return deindent`
341. 			function ${this.name} ( ${this.params.join(', ')}, #component${this.key
342. 			? `, ${localKey}`
343. 			: ''} ) {
344. 				${this.variables.size > 0 &&
345. 					`var ${Array.from(this.variables.keys())
346. 						.map(key => {
347. 							const init = this.variables.get(key);
348. 							return init !== undefined ? `${key} = ${init}` : key;
349. 						})
350. 						.join(', ')};`}
351. 
352. 				${!this.builders.init.isEmpty() && this.builders.init}
353. 
354. 				return {
355. 					${properties}
356. 				};
357. 			}
358. 		`.replace(/(\\\\)?#(\w*)/g, (match, escaped, name) => {
359. 			return escaped ? match.slice(2) : this.alias(name);
360. 		});
361. 	}
362. }


File: src/generators/dom/index.ts
Line number range: 1 - 378
Content:
1. import MagicString from 'magic-string';
2. import { parseExpressionAt } from 'acorn';
3. import annotateWithScopes from '../../utils/annotateWithScopes';
4. import isReference from '../../utils/isReference';
5. import { walk } from 'estree-walker';
6. import deindent from '../../utils/deindent';
7. import stringify from '../../utils/stringify';
8. import CodeBuilder from '../../utils/CodeBuilder';
9. import visit from './visit';
10. import shared from './shared';
11. import Generator from '../Generator';
12. import Stylesheet from '../../css/Stylesheet';
13. import preprocess from './preprocess';
14. import Block from './Block';
15. import { Parsed, CompileOptions, Node } from '../../interfaces';
16. 
17. export class DomGenerator extends Generator {
18. 	blocks: Block[];
19. 	readonly: Set<string>;
20. 	metaBindings: string[];
21. 
22. 	hydratable: boolean;
23. 
24. 	hasIntroTransitions: boolean;
25. 	hasOutroTransitions: boolean;
26. 	hasComplexBindings: boolean;
27. 
28. 	needsEncapsulateHelper: boolean;
29. 
30. 	constructor(
31. 		parsed: Parsed,
32. 		source: string,
33. 		name: string,
34. 		stylesheet: Stylesheet,
35. 		options: CompileOptions
36. 	) {
37. 		super(parsed, source, name, stylesheet, options);
38. 		this.blocks = [];
39. 
40. 		this.readonly = new Set();
41. 
42. 		this.hydratable = options.hydratable;
43. 		this.needsEncapsulateHelper = false;
44. 
45. 		// initial values for e.g. window.innerWidth, if there's a <:Window> meta tag
46. 		this.metaBindings = [];
47. 	}
48. }
49. 
50. export default function dom(
51. 	parsed: Parsed,
52. 	source: string,
53. 	stylesheet: Stylesheet,
54. 	options: CompileOptions
55. ) {
56. 	const format = options.format || 'es';
57. 
58. 	const generator = new DomGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
59. 
60. 	const {
61. 		computations,
62. 		hasJs,
63. 		name,
64. 		templateProperties,
65. 		namespace,
66. 	} = generator;
67. 
68. 	const { block, state } = preprocess(generator, namespace, parsed.html);
69. 
70. 	generator.stylesheet.warnOnUnusedSelectors(options.onwarn);
71. 
72. 	parsed.html.children.forEach((node: Node) => {
73. 		visit(generator, block, state, node, []);
74. 	});
75. 
76. 	const builder = new CodeBuilder();
77. 
78. 	if (computations.length) {
79. 		const computationBuilder = new CodeBuilder();
80. 
81. 		computations.forEach(({ key, deps }) => {
82. 			if (generator.readonly.has(key)) {
83. 				// <:Window> bindings
84. 				throw new Error(
85. 					`Cannot have a computed value '${key}' that clashes with a read-only property`
86. 				);
87. 			}
88. 
89. 			generator.readonly.add(key);
90. 
91. 			const condition = `isInitial || ${deps
92. 				.map(
93. 					dep =>
94. 						`( '${dep}' in newState && @differs( state.${dep}, oldState.${dep} ) )`
95. 				)
96. 				.join(' || ')}`;
97. 			const statement = `state.${key} = newState.${key} = @template.computed.${key}( ${deps
98. 				.map(dep => `state.${dep}`)
99. 				.join(', ')} );`;
100. 
101. 			computationBuilder.addConditionalLine(condition, statement);
102. 		});
103. 
104. 		builder.addBlock(deindent`
105. 			function @recompute ( state, newState, oldState, isInitial ) {
106. 				${computationBuilder}
107. 			}
108. 		`);
109. 	}
110. 
111. 	const _set = deindent`
112. 		${options.dev &&
113. 			deindent`
114. 			if ( typeof newState !== 'object' ) {
115. 				throw new Error( 'Component .set was called without an object of data key-values to update.' );
116. 			}
117. 
118. 			${Array.from(generator.readonly).map(
119. 				prop =>
120. 					`if ( '${prop}' in newState && !this._updatingReadonlyProperty ) throw new Error( "Cannot set read-only property '${prop}'" );`
121. 			)}
122. 		`}
123. 
124. 		var oldState = this._state;
125. 		this._state = @assign( {}, oldState, newState );
126. 		${computations.length &&
127. 			`@recompute( this._state, newState, oldState, false )`}
128. 		@dispatchObservers( this, this._observers.pre, newState, oldState );
129. 		${block.hasUpdateMethod && `this._fragment.update( newState, this._state );`}
130. 		@dispatchObservers( this, this._observers.post, newState, oldState );
131. 	`;
132. 
133. 	if (hasJs) {
134. 		builder.addBlock(`[✂${parsed.js.content.start}-${parsed.js.content.end}✂]`);
135. 	}
136. 
137. 	if (generator.needsEncapsulateHelper) {
138. 		builder.addBlock(deindent`
139. 			function @encapsulateStyles ( node ) {
140. 				@setAttribute( node, '${generator.stylesheet.id}', '' );
141. 			}
142. 		`);
143. 	}
144. 
145. 	if (generator.stylesheet.hasStyles && options.css !== false) {
146. 		const { css, cssMap } = generator.stylesheet.render(options.filename);
147. 
148. 		const textContent = stringify(options.dev ?
149. 			`${css}\n/*# sourceMappingURL=${cssMap.toUrl()} */` :
150. 			css);
151. 
152. 		builder.addBlock(deindent`
153. 			function @add_css () {
154. 				var style = @createElement( 'style' );
155. 				style.id = '${generator.stylesheet.id}-style';
156. 				style.textContent = ${textContent};
157. 				@appendNode( style, document.head );
158. 			}
159. 		`);
160. 	}
161. 
162. 	generator.blocks.forEach(block => {
163. 		builder.addBlock(block.render());
164. 	});
165. 
166. 	const sharedPath = options.shared === true
167. 		? 'svelte/shared.js'
168. 		: options.shared;
169. 
170. 	const prototypeBase =
171. 		`${name}.prototype` +
172. 		(templateProperties.methods ? `, @template.methods` : '');
173. 	const proto = sharedPath
174. 		? `@proto `
175. 		: deindent`
176. 		{
177. 			${['get', 'fire', 'observe', 'on', 'set']
178. 				.map(n => `${n}: @${n}`)
179. 				.join(',\n')}
180. 		}`;
181. 
182. 	// TODO deprecate component.teardown()
183. 	builder.addBlock(deindent`
184. 		function ${name} ( options ) {
185. 			options = options || {};
186. 			${options.dev &&
187. 				`if ( !options.target && !options._root ) throw new Error( "'target' is a required option" );`}
188. 			${generator.usesRefs && `this.refs = {};`}
189. 			this._state = ${templateProperties.data
190. 				? `@assign( @template.data(), options.data )`
191. 				: `options.data || {}`};
192. 			${generator.metaBindings}
193. 			${computations.length && `@recompute( this._state, this._state, {}, true );`}
194. 			${options.dev &&
195. 				Array.from(generator.expectedProperties).map(
196. 					prop =>
197. 						`if ( !( '${prop}' in this._state ) ) console.warn( "Component was created without expected data property '${prop}'" );`
198. 				)}
199. 			${generator.bindingGroups.length &&
200. 				`this._bindingGroups = [ ${Array(generator.bindingGroups.length)
201. 					.fill('[]')
202. 					.join(', ')} ];`}
203. 
204. 			this._observers = {
205. 				pre: Object.create( null ),
206. 				post: Object.create( null )
207. 			};
208. 
209. 			this._handlers = Object.create( null );
210. 
211. 			this._root = options._root || this;
212. 			this._yield = options._yield;
213. 
214. 			this._destroyed = false;
215. 			${generator.stylesheet.hasStyles &&
216. 				options.css !== false &&
217. 				`if ( !document.getElementById( '${generator.stylesheet.id}-style' ) ) @add_css();`}
218. 
219. 			${templateProperties.oncreate && `var oncreate = @template.oncreate.bind( this );`}
220. 
221. 			${(templateProperties.oncreate || generator.hasComponents || generator.hasComplexBindings || generator.hasIntroTransitions) && deindent`
222. 				if ( !options._root ) {
223. 					this._oncreate = [${templateProperties.oncreate && `oncreate`}];
224. 					${(generator.hasComponents || generator.hasComplexBindings) && `this._beforecreate = [];`}
225. 					${(generator.hasComponents || generator.hasIntroTransitions) && `this._aftercreate = [];`}
226. 				} ${templateProperties.oncreate && deindent`
227. 					else {
228. 						this._root._oncreate.push(oncreate);
229. 					}
230. 				`}
231. 			`}
232. 
233. 			this._fragment = @create_main_fragment( this._state, this );
234. 
235. 			if ( options.target ) {
236. 				${generator.hydratable
237. 					? deindent`
238. 						var nodes = @children( options.target );
239. 						options.hydrate ? this._fragment.claim( nodes ) : this._fragment.create();
240. 						nodes.forEach( @detachNode );
241. 					` :
242. 					deindent`
243. 						${options.dev && `if ( options.hydrate ) throw new Error( 'options.hydrate only works if the component was compiled with the \`hydratable: true\` option' );`}
244. 						this._fragment.create();
245. 					`}
246. 				this._fragment.${block.hasIntroMethod ? 'intro' : 'mount'}( options.target, null );
247. 			}
248. 
249. 			${(generator.hasComponents || generator.hasComplexBindings || templateProperties.oncreate || generator.hasIntroTransitions) && deindent`
250. 				if ( !options._root ) {
251. 					${generator.hasComponents && `this._lock = true;`}
252. 					${(generator.hasComponents || generator.hasComplexBindings) && `@callAll(this._beforecreate);`}
253. 					${(generator.hasComponents || templateProperties.oncreate) && `@callAll(this._oncreate);`}
254. 					${(generator.hasComponents || generator.hasIntroTransitions) && `@callAll(this._aftercreate);`}
255. 					${generator.hasComponents && `this._lock = false;`}
256. 				}
257. 			`}
258. 		}
259. 
260. 		@assign( ${prototypeBase}, ${proto});
261. 
262. 		${name}.prototype._set = function _set ( newState ) {
263. 			${_set}
264. 		};
265. 
266. 		${name}.prototype.teardown = ${name}.prototype.destroy = function destroy ( detach ) {
267. 			if ( this._destroyed ) return${options.dev && ` console.warn( 'Component was already destroyed' )`};
268. 			this.fire( 'destroy' );
269. 			${templateProperties.ondestroy && `@template.ondestroy.call( this );`}
270. 
271. 			if ( detach !== false ) this._fragment.unmount();
272. 			this._fragment.destroy();
273. 			this._fragment = null;
274. 
275. 			this._state = {};
276. 			this._destroyed = true;
277. 		};
278. 	`);
279. 
280. 	const usedHelpers = new Set();
281. 
282. 	let result = builder
283. 		.toString()
284. 		.replace(/(\\\\)?([@#])(\w*)/g, (match: string, escaped: string, sigil: string, name: string) => {
285. 			if (escaped) return match.slice(2);
286. 			if (sigil !== '@') return match;
287. 
288. 			if (name in shared) {
289. 				if (options.dev && `${name}Dev` in shared) name = `${name}Dev`;
290. 				usedHelpers.add(name);
291. 			}
292. 
293. 			return generator.alias(name);
294. 		});
295. 
296. 	if (sharedPath) {
297. 		const used = Array.from(usedHelpers).sort();
298. 		if (format === 'es') {
299. 			const names = used.map(name => {
300. 				const alias = generator.alias(name);
301. 				return name !== alias ? `${name} as ${alias}` : name;
302. 			});
303. 
304. 			result =
305. 				`import { ${names.join(', ')} } from ${stringify(sharedPath)};\n\n` +
306. 				result;
307. 		}
308. 
309. 		else if (format === 'cjs') {
310. 			const SHARED = '__shared';
311. 			let requires = `var ${SHARED} = require( ${stringify(sharedPath)} );`;
312. 			used.forEach(name => {
313. 				const alias = generator.alias(name);
314. 				requires += `\nvar ${alias} = ${SHARED}.${name};`;
315. 			});
316. 
317. 			result = `${requires}\n\n${result}`;
318. 		}
319. 
320. 		else {
321. 			throw new Error(`Components with shared helpers must be compiled with \`format: 'es'\` or \`format: 'cjs'\``);
322. 		}
323. 	} else {
324. 		usedHelpers.forEach(key => {
325. 			const str = shared[key];
326. 			const code = new MagicString(str);
327. 			const expression = parseExpressionAt(str, 0);
328. 
329. 			let scope = annotateWithScopes(expression);
330. 
331. 			walk(expression, {
332. 				enter(node: Node, parent: Node) {
333. 					if (node._scope) scope = node._scope;
334. 
335. 					if (
336. 						node.type === 'Identifier' &&
337. 						isReference(node, parent) &&
338. 						!scope.has(node.name)
339. 					) {
340. 						if (node.name in shared) {
341. 							// this helper function depends on another one
342. 							const dependency = node.name;
343. 							usedHelpers.add(dependency);
344. 
345. 							const alias = generator.alias(dependency);
346. 							if (alias !== node.name)
347. 								code.overwrite(node.start, node.end, alias);
348. 						}
349. 					}
350. 				},
351. 
352. 				leave(node: Node) {
353. 					if (node._scope) scope = scope.parent;
354. 				},
355. 			});
356. 
357. 			if (key === 'transitionManager') {
358. 				// special case
359. 				const global = `_svelteTransitionManager`;
360. 
361. 				result += `\n\nvar ${generator.alias(
362. 					'transitionManager'
363. 				)} = window.${global} || ( window.${global} = ${code});`;
364. 			} else {
365. 				const alias = generator.alias(expression.id.name);
366. 				if (alias !== expression.id.name)
367. 					code.overwrite(expression.id.start, expression.id.end, alias);
368. 
369. 				result += `\n\n${code}`;
370. 			}
371. 		});
372. 	}
373. 
374. 	return generator.generate(result, options, {
375. 		name,
376. 		format,
377. 	});
378. }


File: src/generators/dom/interfaces.ts
Line number range: 1 - 13
Content:
1. export interface State {
2. 	name?: string;
3. 	namespace: string;
4. 	parentNode: string;
5. 	parentNodes: string;
6. 	isTopLevel: boolean;
7. 	parentNodeName?: string;
8. 	basename?: string;
9. 	inEachBlock?: boolean;
10. 	allUsedContexts?: string[];
11. 	usesComponent?: boolean;
12. 	selectBindingDependencies?: string[];
13. }


File: src/generators/dom/preprocess.ts
Line number range: 1 - 468
Content:
1. import Block from './Block';
2. import { trimStart, trimEnd } from '../../utils/trim';
3. import { assign } from '../../shared/index.js';
4. import { DomGenerator } from './index';
5. import { Node } from '../../interfaces';
6. import { State } from './interfaces';
7. 
8. function isElseIf(node: Node) {
9. 	return (
10. 		node && node.children.length === 1 && node.children[0].type === 'IfBlock'
11. 	);
12. }
13. 
14. function getChildState(parent: State, child = {}) {
15. 	return assign(
16. 		{},
17. 		parent,
18. 		{ name: null, parentNode: null, parentNodes: 'nodes' },
19. 		child || {}
20. 	);
21. }
22. 
23. // Whitespace inside one of these elements will not result in
24. // a whitespace node being created in any circumstances. (This
25. // list is almost certainly very incomplete)
26. const elementsWithoutText = new Set([
27. 	'audio',
28. 	'datalist',
29. 	'dl',
30. 	'ol',
31. 	'optgroup',
32. 	'select',
33. 	'ul',
34. 	'video',
35. ]);
36. 
37. const preprocessors = {
38. 	MustacheTag: (
39. 		generator: DomGenerator,
40. 		block: Block,
41. 		state: State,
42. 		node: Node,
43. 		elementStack: Node[],
44. 		stripWhitespace: boolean
45. 	) => {
46. 		const dependencies = block.findDependencies(node.expression);
47. 		block.addDependencies(dependencies);
48. 
49. 		node._state = getChildState(state, {
50. 			name: block.getUniqueName('text'),
51. 		});
52. 	},
53. 
54. 	RawMustacheTag: (
55. 		generator: DomGenerator,
56. 		block: Block,
57. 		state: State,
58. 		node: Node,
59. 		elementStack: Node[],
60. 		stripWhitespace: boolean
61. 	) => {
62. 		const dependencies = block.findDependencies(node.expression);
63. 		block.addDependencies(dependencies);
64. 
65. 		const basename = block.getUniqueName('raw');
66. 		const name = block.getUniqueName(`${basename}_before`);
67. 
68. 		node._state = getChildState(state, { basename, name });
69. 	},
70. 
71. 	Text: (
72. 		generator: DomGenerator,
73. 		block: Block,
74. 		state: State,
75. 		node: Node,
76. 		elementStack: Node[],
77. 		stripWhitespace: boolean
78. 	) => {
79. 		node._state = getChildState(state);
80. 
81. 		if (!/\S/.test(node.data)) {
82. 			if (state.namespace) return;
83. 			if (elementsWithoutText.has(state.parentNodeName)) return;
84. 		}
85. 
86. 		node._state.shouldCreate = true;
87. 		node._state.name = block.getUniqueName(`text`);
88. 	},
89. 
90. 	IfBlock: (
91. 		generator: DomGenerator,
92. 		block: Block,
93. 		state: State,
94. 		node: Node,
95. 		inEachBlock: boolean,
96. 		elementStack: Node[],
97. 		stripWhitespace: boolean,
98. 		nextSibling: Node
99. 	) => {
100. 		const blocks: Block[] = [];
101. 		let dynamic = false;
102. 		let hasIntros = false;
103. 		let hasOutros = false;
104. 
105. 		function attachBlocks(node: Node) {
106. 			const dependencies = block.findDependencies(node.expression);
107. 			block.addDependencies(dependencies);
108. 
109. 			node._block = block.child({
110. 				name: generator.getUniqueName(`create_if_block`),
111. 			});
112. 
113. 			node._state = getChildState(state);
114. 
115. 			blocks.push(node._block);
116. 			preprocessChildren(generator, node._block, node._state, node, inEachBlock, elementStack, stripWhitespace, nextSibling);
117. 
118. 			if (node._block.dependencies.size > 0) {
119. 				dynamic = true;
120. 				block.addDependencies(node._block.dependencies);
121. 			}
122. 
123. 			if (node._block.hasIntroMethod) hasIntros = true;
124. 			if (node._block.hasOutroMethod) hasOutros = true;
125. 
126. 			if (isElseIf(node.else)) {
127. 				attachBlocks(node.else.children[0]);
128. 			} else if (node.else) {
129. 				node.else._block = block.child({
130. 					name: generator.getUniqueName(`create_if_block`),
131. 				});
132. 
133. 				node.else._state = getChildState(state);
134. 
135. 				blocks.push(node.else._block);
136. 				preprocessChildren(
137. 					generator,
138. 					node.else._block,
139. 					node.else._state,
140. 					node.else,
141. 					inEachBlock,
142. 					elementStack,
143. 					stripWhitespace,
144. 					nextSibling
145. 				);
146. 
147. 				if (node.else._block.dependencies.size > 0) {
148. 					dynamic = true;
149. 					block.addDependencies(node.else._block.dependencies);
150. 				}
151. 			}
152. 		}
153. 
154. 		attachBlocks(node);
155. 
156. 		blocks.forEach(block => {
157. 			block.hasUpdateMethod = dynamic;
158. 			block.hasIntroMethod = hasIntros;
159. 			block.hasOutroMethod = hasOutros;
160. 		});
161. 
162. 		generator.blocks.push(...blocks);
163. 	},
164. 
165. 	EachBlock: (
166. 		generator: DomGenerator,
167. 		block: Block,
168. 		state: State,
169. 		node: Node,
170. 		inEachBlock: boolean,
171. 		elementStack: Node[],
172. 		stripWhitespace: boolean,
173. 		nextSibling: Node
174. 	) => {
175. 		const dependencies = block.findDependencies(node.expression);
176. 		block.addDependencies(dependencies);
177. 
178. 		const indexNames = new Map(block.indexNames);
179. 		const indexName =
180. 			node.index || block.getUniqueName(`${node.context}_index`);
181. 		indexNames.set(node.context, indexName);
182. 
183. 		const listNames = new Map(block.listNames);
184. 		const listName = block.getUniqueName(`each_block_value`);
185. 		listNames.set(node.context, listName);
186. 
187. 		const context = generator.getUniqueName(node.context);
188. 		const contexts = new Map(block.contexts);
189. 		contexts.set(node.context, context);
190. 
191. 		const indexes = new Map(block.indexes);
192. 		if (node.index) indexes.set(indexName, node.context);
193. 
194. 		const contextDependencies = new Map(block.contextDependencies);
195. 		contextDependencies.set(node.context, dependencies);
196. 
197. 		node._block = block.child({
198. 			name: generator.getUniqueName('create_each_block'),
199. 			expression: node.expression,
200. 			context: node.context,
201. 			key: node.key,
202. 
203. 			contextDependencies,
204. 			contexts,
205. 			indexes,
206. 
207. 			listName,
208. 			indexName,
209. 
210. 			indexNames,
211. 			listNames,
212. 			params: block.params.concat(listName, context, indexName),
213. 		});
214. 
215. 		node._state = getChildState(state, {
216. 			inEachBlock: true,
217. 		});
218. 
219. 		generator.blocks.push(node._block);
220. 		preprocessChildren(generator, node._block, node._state, node, true, elementStack, stripWhitespace, nextSibling);
221. 		block.addDependencies(node._block.dependencies);
222. 		node._block.hasUpdateMethod = node._block.dependencies.size > 0;
223. 
224. 		if (node.else) {
225. 			node.else._block = block.child({
226. 				name: generator.getUniqueName(`${node._block.name}_else`),
227. 			});
228. 
229. 			node.else._state = getChildState(state);
230. 
231. 			generator.blocks.push(node.else._block);
232. 			preprocessChildren(
233. 				generator,
234. 				node.else._block,
235. 				node.else._state,
236. 				node.else,
237. 				inEachBlock,
238. 				elementStack,
239. 				stripWhitespace,
240. 				nextSibling
241. 			);
242. 			node.else._block.hasUpdateMethod = node.else._block.dependencies.size > 0;
243. 		}
244. 	},
245. 
246. 	Element: (
247. 		generator: DomGenerator,
248. 		block: Block,
249. 		state: State,
250. 		node: Node,
251. 		inEachBlock: boolean,
252. 		elementStack: Node[],
253. 		stripWhitespace: boolean,
254. 		nextSibling: Node
255. 	) => {
256. 		node.attributes.forEach((attribute: Node) => {
257. 			if (attribute.type === 'Attribute' && attribute.value !== true) {
258. 				attribute.value.forEach((chunk: Node) => {
259. 					if (chunk.type !== 'Text') {
260. 						const dependencies = block.findDependencies(chunk.expression);
261. 						block.addDependencies(dependencies);
262. 
263. 						// special case — <option value='{{foo}}'> — see below
264. 						if (
265. 							node.name === 'option' &&
266. 							attribute.name === 'value' &&
267. 							state.selectBindingDependencies
268. 						) {
269. 							state.selectBindingDependencies.forEach(prop => {
270. 								dependencies.forEach((dependency: string) => {
271. 									generator.indirectDependencies.get(prop).add(dependency);
272. 								});
273. 							});
274. 						}
275. 					}
276. 				});
277. 			} else if (attribute.type === 'Binding') {
278. 				const dependencies = block.findDependencies(attribute.value);
279. 				block.addDependencies(dependencies);
280. 			} else if (attribute.type === 'Transition') {
281. 				if (attribute.intro)
282. 					generator.hasIntroTransitions = block.hasIntroMethod = true;
283. 				if (attribute.outro) {
284. 					generator.hasOutroTransitions = block.hasOutroMethod = true;
285. 					block.outros += 1;
286. 				}
287. 			}
288. 		});
289. 
290. 		// special case — in a case like this...
291. 		//
292. 		//   <select bind:value='foo'>
293. 		//     <option value='{{bar}}'>bar</option>
294. 		//     <option value='{{baz}}'>baz</option>
295. 		//   </option>
296. 		//
297. 		// ...we need to know that `foo` depends on `bar` and `baz`,
298. 		// so that if `foo.qux` changes, we know that we need to
299. 		// mark `bar` and `baz` as dirty too
300. 		if (node.name === 'select') {
301. 			const value = node.attributes.find(
302. 				(attribute: Node) => attribute.name === 'value'
303. 			);
304. 			if (value) {
305. 				// TODO does this also apply to e.g. `<input type='checkbox' bind:group='foo'>`?
306. 				const dependencies = block.findDependencies(value.value);
307. 				state.selectBindingDependencies = dependencies;
308. 				dependencies.forEach((prop: string) => {
309. 					generator.indirectDependencies.set(prop, new Set());
310. 				});
311. 			} else {
312. 				state.selectBindingDependencies = null;
313. 			}
314. 		}
315. 
316. 		const isComponent =
317. 			generator.components.has(node.name) || node.name === ':Self';
318. 
319. 		if (isComponent) {
320. 			node._state = getChildState(state, {
321. 				isYield: true
322. 			});
323. 		} else {
324. 			const name = block.getUniqueName(
325. 				node.name.replace(/[^a-zA-Z0-9_$]/g, '_')
326. 			);
327. 
328. 			node._state = getChildState(state, {
329. 				isTopLevel: false,
330. 				name,
331. 				parentNode: name,
332. 				parentNodes: block.getUniqueName(`${name}_nodes`),
333. 				parentNodeName: node.name,
334. 				namespace: node.name === 'svg'
335. 					? 'http://www.w3.org/2000/svg'
336. 					: state.namespace,
337. 				allUsedContexts: [],
338. 			});
339. 
340. 			generator.stylesheet.apply(node, elementStack);
341. 		}
342. 
343. 		if (node.children.length) {
344. 			if (isComponent) {
345. 				const name = block.getUniqueName(
346. 					(node.name === ':Self' ? generator.name : node.name).toLowerCase()
347. 				);
348. 
349. 				node._block = block.child({
350. 					name: generator.getUniqueName(`create_${name}_yield_fragment`),
351. 				});
352. 
353. 				generator.blocks.push(node._block);
354. 				preprocessChildren(generator, node._block, node._state, node, inEachBlock, elementStack, stripWhitespace, nextSibling);
355. 				block.addDependencies(node._block.dependencies);
356. 				node._block.hasUpdateMethod = node._block.dependencies.size > 0;
357. 			} else {
358. 				if (node.name === 'pre' || node.name === 'textarea') stripWhitespace = false;
359. 				preprocessChildren(generator, block, node._state, node, inEachBlock, elementStack.concat(node), stripWhitespace, nextSibling);
360. 			}
361. 		}
362. 	},
363. };
364. 
365. function preprocessChildren(
366. 	generator: DomGenerator,
367. 	block: Block,
368. 	state: State,
369. 	node: Node,
370. 	inEachBlock: boolean,
371. 	elementStack: Node[],
372. 	stripWhitespace: boolean,
373. 	nextSibling: Node
374. ) {
375. 	// glue text nodes together
376. 	const cleaned: Node[] = [];
377. 	let lastChild: Node;
378. 
379. 	node.children.forEach((child: Node) => {
380. 		if (child.type === 'Comment') return;
381. 
382. 		if (child.type === 'Text' && lastChild && lastChild.type === 'Text') {
383. 			lastChild.data += child.data;
384. 			lastChild.end = child.end;
385. 		} else {
386. 			if (child.type === 'Text' && stripWhitespace && cleaned.length === 0) {
387. 				child.data = trimStart(child.data);
388. 				if (child.data) cleaned.push(child);
389. 			} else {
390. 				cleaned.push(child);
391. 			}
392. 		}
393. 
394. 		lastChild = child;
395. 	});
396. 
397. 	lastChild = null;
398. 
399. 	cleaned.forEach((child: Node, i: number) => {
400. 		const preprocessor = preprocessors[child.type];
401. 		if (preprocessor) preprocessor(generator, block, state, child, inEachBlock, elementStack, stripWhitespace, cleaned[i + 1] || nextSibling);
402. 
403. 		if (lastChild) {
404. 			lastChild.next = child;
405. 			lastChild.needsAnchor = !child._state || !child._state.name;
406. 		}
407. 
408. 		lastChild = child;
409. 	});
410. 
411. 	// We want to remove trailing whitespace inside an element/component/block,
412. 	// *unless* there is no whitespace between this node and its next sibling
413. 	if (stripWhitespace && lastChild && lastChild.type === 'Text') {
414. 		const shouldTrim = (
415. 			nextSibling ?  (nextSibling.type === 'Text' && /^\s/.test(nextSibling.data)) : !inEachBlock
416. 		);
417. 
418. 		if (shouldTrim) {
419. 			lastChild.data = trimEnd(lastChild.data);
420. 			if (!lastChild.data) {
421. 				cleaned.pop();
422. 				lastChild = cleaned[cleaned.length - 1];
423. 				lastChild.next = null;
424. 			}
425. 		}
426. 	}
427. 
428. 	if (lastChild) {
429. 		lastChild.needsAnchor = !state.parentNode;
430. 	}
431. 
432. 	node.children = cleaned;
433. }
434. 
435. export default function preprocess(
436. 	generator: DomGenerator,
437. 	namespace: string,
438. 	node: Node
439. ) {
440. 	const block = new Block({
441. 		generator,
442. 		name: '@create_main_fragment',
443. 		key: null,
444. 
445. 		contexts: new Map(),
446. 		indexes: new Map(),
447. 		contextDependencies: new Map(),
448. 
449. 		params: ['state'],
450. 		indexNames: new Map(),
451. 		listNames: new Map(),
452. 
453. 		dependencies: new Set(),
454. 	});
455. 
456. 	const state: State = {
457. 		namespace,
458. 		parentNode: null,
459. 		parentNodes: 'nodes',
460. 		isTopLevel: true,
461. 	};
462. 
463. 	generator.blocks.push(block);
464. 	preprocessChildren(generator, block, state, node, false, [], true, null);
465. 	block.hasUpdateMethod = block.dependencies.size > 0;
466. 
467. 	return { block, state };
468. }


File: src/generators/dom/visit.ts
Line number range: 1 - 16
Content:
1. import visitors from './visitors/index';
2. import { DomGenerator } from './index';
3. import Block from './Block';
4. import { Node } from '../../interfaces';
5. import { State } from './interfaces';
6. 
7. export default function visit(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	elementStack: Node[]
13. ) {
14. 	const visitor = visitors[node.type];
15. 	visitor(generator, block, state, node, elementStack);
16. }


File: src/generators/dom/visitors/Element/Attribute.ts
Line number range: 1 - 159
Content:
1. import attributeLookup from './lookup';
2. import deindent from '../../../../utils/deindent';
3. import stringify from '../../../../utils/stringify';
4. import getStaticAttributeValue from './getStaticAttributeValue';
5. import { DomGenerator } from '../../index';
6. import Block from '../../Block';
7. import { Node } from '../../../../interfaces';
8. import { State } from '../../interfaces';
9. 
10. export default function visitAttribute(
11. 	generator: DomGenerator,
12. 	block: Block,
13. 	state: State,
14. 	node: Node,
15. 	attribute: Node
16. ) {
17. 	const name = attribute.name;
18. 
19. 	let metadata = state.namespace ? null : attributeLookup[name];
20. 	if (metadata && metadata.appliesTo && !~metadata.appliesTo.indexOf(node.name))
21. 		metadata = null;
22. 
23. 	const isIndirectlyBoundValue =
24. 		name === 'value' &&
25. 		(node.name === 'option' || // TODO check it's actually bound
26. 			(node.name === 'input' &&
27. 				node.attributes.find(
28. 					(attribute: Node) =>
29. 						attribute.type === 'Binding' && /checked|group/.test(attribute.name)
30. 				)));
31. 
32. 	const propertyName = isIndirectlyBoundValue
33. 		? '__value'
34. 		: metadata && metadata.propertyName;
35. 
36. 	// xlink is a special case... we could maybe extend this to generic
37. 	// namespaced attributes but I'm not sure that's applicable in
38. 	// HTML5?
39. 	const method = name.slice(0, 6) === 'xlink:'
40. 		? '@setXlinkAttribute'
41. 		: '@setAttribute';
42. 
43. 	const isDynamic =
44. 		(attribute.value !== true && attribute.value.length > 1) ||
45. 		(attribute.value.length === 1 && attribute.value[0].type !== 'Text');
46. 
47. 	if (isDynamic) {
48. 		let value;
49. 
50. 		if (attribute.value.length === 1) {
51. 			// single {{tag}} — may be a non-string
52. 			const { snippet } = block.contextualise(attribute.value[0].expression);
53. 			value = snippet;
54. 		} else {
55. 			// '{{foo}} {{bar}}' — treat as string concatenation
56. 			value =
57. 				(attribute.value[0].type === 'Text' ? '' : `"" + `) +
58. 				attribute.value
59. 					.map((chunk: Node) => {
60. 						if (chunk.type === 'Text') {
61. 							return stringify(chunk.data);
62. 						} else {
63. 							const { snippet } = block.contextualise(chunk.expression);
64. 							return `( ${snippet} )`;
65. 						}
66. 					})
67. 					.join(' + ');
68. 		}
69. 
70. 		const last = block.getUniqueName(
71. 			`${state.parentNode}_${name.replace(/[^a-zA-Z_$]/g, '_')}_value`
72. 		);
73. 		block.addVariable(last);
74. 
75. 		const isSelectValueAttribute =
76. 			name === 'value' && state.parentNodeName === 'select';
77. 
78. 		let updater;
79. 
80. 		if (isSelectValueAttribute) {
81. 			// annoying special case
82. 			const isMultipleSelect =
83. 				node.name === 'select' &&
84. 				node.attributes.find(
85. 					(attr: Node) => attr.name.toLowerCase() === 'multiple'
86. 				); // TODO use getStaticAttributeValue
87. 			const i = block.getUniqueName('i');
88. 			const option = block.getUniqueName('option');
89. 
90. 			const ifStatement = isMultipleSelect
91. 				? deindent`
92. 					${option}.selected = ~${last}.indexOf( ${option}.__value );`
93. 				: deindent`
94. 					if ( ${option}.__value === ${last} ) {
95. 						${option}.selected = true;
96. 						break;
97. 					}`;
98. 
99. 			updater = deindent`
100. 				for ( var ${i} = 0; ${i} < ${state.parentNode}.options.length; ${i} += 1 ) {
101. 					var ${option} = ${state.parentNode}.options[${i}];
102. 
103. 					${ifStatement}
104. 				}
105. 			`;
106. 
107. 			block.builders.hydrate.addLine(deindent`
108. 				${last} = ${value}
109. 				${updater}
110. 			`);
111. 		} else if (propertyName) {
112. 			block.builders.hydrate.addLine(
113. 				`${state.parentNode}.${propertyName} = ${last} = ${value};`
114. 			);
115. 			updater = `${state.parentNode}.${propertyName} = ${last};`;
116. 		} else {
117. 			block.builders.hydrate.addLine(
118. 				`${method}( ${state.parentNode}, '${name}', ${last} = ${value} );`
119. 			);
120. 			updater = `${method}( ${state.parentNode}, '${name}', ${last} );`;
121. 		}
122. 
123. 		block.builders.update.addBlock(deindent`
124. 			if ( ${last} !== ( ${last} = ${value} ) ) {
125. 				${updater}
126. 			}
127. 		`);
128. 	} else {
129. 		const value = attribute.value === true
130. 			? 'true'
131. 			: attribute.value.length === 0
132. 				? `''`
133. 				: stringify(attribute.value[0].data);
134. 
135. 		const statement = propertyName
136. 			? `${state.parentNode}.${propertyName} = ${value};`
137. 			: `${method}( ${state.parentNode}, '${name}', ${value} );`;
138. 
139. 		block.builders.hydrate.addLine(statement);
140. 
141. 		// special case – autofocus. has to be handled in a bit of a weird way
142. 		if (attribute.value === true && name === 'autofocus') {
143. 			block.autofocus = state.parentNode;
144. 		}
145. 
146. 		// special case — xmlns
147. 		if (name === 'xmlns') {
148. 			// TODO this attribute must be static – enforce at compile time
149. 			state.namespace = attribute.value[0].data;
150. 		}
151. 	}
152. 
153. 	if (isIndirectlyBoundValue) {
154. 		const updateValue = `${state.parentNode}.value = ${state.parentNode}.__value;`;
155. 
156. 		block.builders.hydrate.addLine(updateValue);
157. 		if (isDynamic) block.builders.update.addLine(updateValue);
158. 	}
159. }


File: src/generators/dom/visitors/Element/Element.ts
Line number range: 1 - 255
Content:
1. import deindent from '../../../../utils/deindent';
2. import visit from '../../visit';
3. import visitComponent from '../Component/Component';
4. import visitWindow from './meta/Window';
5. import visitAttribute from './Attribute';
6. import visitEventHandler from './EventHandler';
7. import visitBinding from './Binding';
8. import visitRef from './Ref';
9. import * as namespaces from '../../../../utils/namespaces';
10. import addTransitions from './addTransitions';
11. import { DomGenerator } from '../../index';
12. import Block from '../../Block';
13. import { Node } from '../../../../interfaces';
14. import { State } from '../../interfaces';
15. 
16. const meta = {
17. 	':Window': visitWindow,
18. };
19. 
20. const order = {
21. 	Attribute: 1,
22. 	Binding: 2,
23. 	EventHandler: 3,
24. 	Ref: 4,
25. };
26. 
27. const visitors = {
28. 	Attribute: visitAttribute,
29. 	EventHandler: visitEventHandler,
30. 	Binding: visitBinding,
31. 	Ref: visitRef,
32. };
33. 
34. export default function visitElement(
35. 	generator: DomGenerator,
36. 	block: Block,
37. 	state: State,
38. 	node: Node,
39. 	elementStack: Node[]
40. ) {
41. 	if (node.name in meta) {
42. 		return meta[node.name](generator, block, node);
43. 	}
44. 
45. 	if (generator.components.has(node.name) || node.name === ':Self') {
46. 		return visitComponent(generator, block, state, node, elementStack);
47. 	}
48. 
49. 	const childState = node._state;
50. 	const name = childState.parentNode;
51. 
52. 	const isToplevel = !state.parentNode;
53. 
54. 	block.addVariable(name);
55. 	block.builders.create.addLine(
56. 		`${name} = ${getRenderStatement(
57. 			generator,
58. 			childState.namespace,
59. 			node.name
60. 		)};`
61. 	);
62. 
63. 	if (generator.hydratable) {
64. 		block.builders.claim.addBlock(deindent`
65. 			${name} = ${getClaimStatement(
66. 			generator,
67. 			childState.namespace,
68. 			state.parentNodes,
69. 			node
70. 		)};
71. 			var ${childState.parentNodes} = @children( ${name} );
72. 		`);
73. 	}
74. 
75. 	if (state.parentNode) {
76. 		block.builders.mount.addLine(
77. 			`@appendNode( ${name}, ${state.parentNode} );`
78. 		);
79. 	} else {
80. 		block.builders.mount.addLine(`@insertNode( ${name}, #target, anchor );`);
81. 	}
82. 
83. 	// add CSS encapsulation attribute
84. 	// TODO add a helper for this, rather than repeating it
85. 	if (node._needsCssAttribute) {
86. 		generator.needsEncapsulateHelper = true;
87. 		block.builders.hydrate.addLine(
88. 			`@encapsulateStyles( ${name} );`
89. 		);
90. 	}
91. 
92. 	function visitAttributesAndAddProps() {
93. 		let intro;
94. 		let outro;
95. 
96. 		node.attributes
97. 			.sort((a: Node, b: Node) => order[a.type] - order[b.type])
98. 			.forEach((attribute: Node) => {
99. 				if (attribute.type === 'Transition') {
100. 					if (attribute.intro) intro = attribute;
101. 					if (attribute.outro) outro = attribute;
102. 					return;
103. 				}
104. 
105. 				visitors[attribute.type](generator, block, childState, node, attribute);
106. 			});
107. 
108. 		if (intro || outro)
109. 			addTransitions(generator, block, childState, node, intro, outro);
110. 
111. 		if (childState.allUsedContexts.length || childState.usesComponent) {
112. 			const initialProps: string[] = [];
113. 			const updates: string[] = [];
114. 
115. 			if (childState.usesComponent) {
116. 				initialProps.push(`component: #component`);
117. 			}
118. 
119. 			childState.allUsedContexts.forEach((contextName: string) => {
120. 				if (contextName === 'state') return;
121. 
122. 				const listName = block.listNames.get(contextName);
123. 				const indexName = block.indexNames.get(contextName);
124. 
125. 				initialProps.push(
126. 					`${listName}: ${listName},\n${indexName}: ${indexName}`
127. 				);
128. 				updates.push(
129. 					`${name}._svelte.${listName} = ${listName};\n${name}._svelte.${indexName} = ${indexName};`
130. 				);
131. 			});
132. 
133. 			if (initialProps.length) {
134. 				block.builders.hydrate.addBlock(deindent`
135. 					${name}._svelte = {
136. 						${initialProps.join(',\n')}
137. 					};
138. 				`);
139. 			}
140. 
141. 			if (updates.length) {
142. 				block.builders.update.addBlock(updates.join('\n'));
143. 			}
144. 		}
145. 	}
146. 
147. 	if (isToplevel) {
148. 		// TODO we eventually need to consider what happens to elements
149. 		// that belong to the same outgroup as an outroing element...
150. 		block.builders.unmount.addLine(`@detachNode( ${name} );`);
151. 	}
152. 
153. 	if (node.name !== 'select') {
154. 		if (node.name === 'textarea') {
155. 			// this is an egregious hack, but it's the easiest way to get <textarea>
156. 			// children treated the same way as a value attribute
157. 			if (node.children.length > 0) {
158. 				node.attributes.push({
159. 					type: 'Attribute',
160. 					name: 'value',
161. 					value: node.children,
162. 				});
163. 
164. 				node.children = [];
165. 			}
166. 		}
167. 
168. 		// <select> value attributes are an annoying special case — it must be handled
169. 		// *after* its children have been updated
170. 		visitAttributesAndAddProps();
171. 	}
172. 
173. 	// special case – bound <option> without a value attribute
174. 	if (
175. 		node.name === 'option' &&
176. 		!node.attributes.find(
177. 			(attribute: Node) =>
178. 				attribute.type === 'Attribute' && attribute.name === 'value'
179. 		)
180. 	) {
181. 		// TODO check it's bound
182. 		const statement = `${name}.__value = ${name}.textContent;`;
183. 		node.initialUpdate = node.lateUpdate = statement;
184. 	}
185. 
186. 	node.children.forEach((child: Node) => {
187. 		visit(generator, block, childState, child, elementStack.concat(node));
188. 	});
189. 
190. 	if (node.lateUpdate) {
191. 		block.builders.update.addLine(node.lateUpdate);
192. 	}
193. 
194. 	if (node.name === 'select') {
195. 		visitAttributesAndAddProps();
196. 	}
197. 
198. 	if (node.initialUpdate) {
199. 		// special case — if we're in a yield block, then we may call mount
200. 		// long after the fragment is created. We may therefore need to get
201. 		// the latest `state` object
202. 		// TODO what about contexts in yield blocks? do we need to do
203. 		// `var ${contextName} = [something complicated]`?
204. 		const needsStateObject = node.initialUpdateNeedsStateObject && state.isYield;
205. 
206. 		if ( needsStateObject ) {
207. 			block.builders.mount.addLine(`var state = #component.get()`);
208. 		}
209. 
210. 		block.builders.mount.addBlock(node.initialUpdate);
211. 	}
212. 
213. 	block.builders.claim.addLine(
214. 		`${childState.parentNodes}.forEach( @detachNode );`
215. 	);
216. }
217. 
218. function getRenderStatement(
219. 	generator: DomGenerator,
220. 	namespace: string,
221. 	name: string
222. ) {
223. 	if (namespace === 'http://www.w3.org/2000/svg') {
224. 		return `@createSvgElement( '${name}' )`;
225. 	}
226. 
227. 	if (namespace) {
228. 		return `document.createElementNS( '${namespace}', '${name}' )`;
229. 	}
230. 
231. 	return `@createElement( '${name}' )`;
232. }
233. 
234. function getClaimStatement(
235. 	generator: DomGenerator,
236. 	namespace: string,
237. 	nodes: string,
238. 	node: Node
239. ) {
240. 	const attributes = node.attributes
241. 		.filter((attr: Node) => attr.type === 'Attribute')
242. 		.map((attr: Node) => `${quoteProp(attr.name)}: true`)
243. 		.join(', ');
244. 
245. 	const name = namespace ? node.name : node.name.toUpperCase();
246. 
247. 	return `@claimElement( ${nodes}, '${name}', ${attributes
248. 		? `{ ${attributes} }`
249. 		: `{}`}, ${namespace === namespaces.svg ? true : false} )`;
250. }
251. 
252. function quoteProp(name: string) {
253. 	if (/[^a-zA-Z_$0-9]/.test(name)) return `'${name}'`;
254. 	return name;
255. }


File: src/generators/dom/visitors/Element/Ref.ts
Line number range: 1 - 25
Content:
1. import deindent from '../../../../utils/deindent';
2. import { DomGenerator } from '../../index';
3. import Block from '../../Block';
4. import { Node } from '../../../../interfaces';
5. import { State } from '../../interfaces';
6. 
7. export default function visitRef(
8. 	generator: DomGenerator,
9. 	block: Block,
10. 	state: State,
11. 	node: Node,
12. 	attribute: Node
13. ) {
14. 	const name = attribute.name;
15. 
16. 	block.builders.mount.addLine(
17. 		`#component.refs.${name} = ${state.parentNode};`
18. 	);
19. 
20. 	block.builders.destroy.addLine(deindent`
21. 		if ( #component.refs.${name} === ${state.parentNode} ) #component.refs.${name} = null;
22. 	`);
23. 
24. 	generator.usesRefs = true; // so this component.refs object is created
25. }


File: src/generators/dom/visitors/Element/meta/Window.ts
Line number range: 1 - 194
Content:
1. import flattenReference from '../../../../../utils/flattenReference';
2. import deindent from '../../../../../utils/deindent';
3. import { DomGenerator } from '../../../index';
4. import Block from '../../../Block';
5. import { Node } from '../../../../../interfaces';
6. 
7. const associatedEvents = {
8. 	innerWidth: 'resize',
9. 	innerHeight: 'resize',
10. 	outerWidth: 'resize',
11. 	outerHeight: 'resize',
12. 
13. 	scrollX: 'scroll',
14. 	scrollY: 'scroll',
15. };
16. 
17. const readonly = new Set([
18. 	'innerWidth',
19. 	'innerHeight',
20. 	'outerWidth',
21. 	'outerHeight',
22. 	'online',
23. ]);
24. 
25. export default function visitWindow(
26. 	generator: DomGenerator,
27. 	block: Block,
28. 	node: Node
29. ) {
30. 	const events = {};
31. 	const bindings = {};
32. 
33. 	node.attributes.forEach((attribute: Node) => {
34. 		if (attribute.type === 'EventHandler') {
35. 			// TODO verify that it's a valid callee (i.e. built-in or declared method)
36. 			generator.addSourcemapLocations(attribute.expression);
37. 
38. 			let usesState = false;
39. 
40. 			attribute.expression.arguments.forEach((arg: Node) => {
41. 				const { contexts } = block.contextualise(arg, null, true);
42. 				if (contexts.length) usesState = true;
43. 			});
44. 
45. 			const flattened = flattenReference(attribute.expression.callee);
46. 			if (flattened.name !== 'event' && flattened.name !== 'this') {
47. 				// allow event.stopPropagation(), this.select() etc
48. 				generator.code.prependRight(
49. 					attribute.expression.start,
50. 					`${block.alias('component')}.`
51. 				);
52. 			}
53. 
54. 			const handlerName = block.getUniqueName(`onwindow${attribute.name}`);
55. 			const handlerBody = deindent`
56. 				${usesState && `var state = #component.get();`}
57. 				[✂${attribute.expression.start}-${attribute.expression.end}✂];
58. 			`;
59. 
60. 			block.builders.init.addBlock(deindent`
61. 				function ${handlerName} ( event ) {
62. 					${handlerBody}
63. 				};
64. 				window.addEventListener( '${attribute.name}', ${handlerName} );
65. 			`);
66. 
67. 			block.builders.destroy.addBlock(deindent`
68. 				window.removeEventListener( '${attribute.name}', ${handlerName} );
69. 			`);
70. 		}
71. 
72. 		if (attribute.type === 'Binding') {
73. 			// in dev mode, throw if read-only values are written to
74. 			if (readonly.has(attribute.name)) {
75. 				generator.readonly.add(attribute.value.name);
76. 			}
77. 
78. 			bindings[attribute.name] = attribute.value.name;
79. 
80. 			// bind:online is a special case, we need to listen for two separate events
81. 			if (attribute.name === 'online') return;
82. 
83. 			const associatedEvent = associatedEvents[attribute.name];
84. 
85. 			if (!associatedEvent) {
86. 				throw new Error(`Cannot bind to ${attribute.name} on <:Window>`);
87. 			}
88. 
89. 			if (!events[associatedEvent]) events[associatedEvent] = [];
90. 			events[associatedEvent].push(
91. 				`${attribute.value.name}: this.${attribute.name}`
92. 			);
93. 
94. 			// add initial value
95. 			generator.metaBindings.push(
96. 				`this._state.${attribute.value.name} = window.${attribute.name};`
97. 			);
98. 		}
99. 	});
100. 
101. 	const lock = block.getUniqueName(`window_updating`);
102. 
103. 	Object.keys(events).forEach(event => {
104. 		const handlerName = block.getUniqueName(`onwindow${event}`);
105. 		const props = events[event].join(',\n');
106. 
107. 		if (event === 'scroll') {
108. 			// TODO other bidirectional bindings...
109. 			block.addVariable(lock, 'false');
110. 		}
111. 
112. 		const handlerBody = deindent`
113. 			${event === 'scroll' && `${lock} = true;`}
114. 			${generator.options.dev && `component._updatingReadonlyProperty = true;`}
115. 
116. 			#component.set({
117. 				${props}
118. 			});
119. 
120. 			${generator.options.dev && `component._updatingReadonlyProperty = false;`}
121. 			${event === 'scroll' && `${lock} = false;`}
122. 		`;
123. 
124. 		block.builders.init.addBlock(deindent`
125. 			function ${handlerName} ( event ) {
126. 				${handlerBody}
127. 			};
128. 			window.addEventListener( '${event}', ${handlerName} );
129. 		`);
130. 
131. 		block.builders.destroy.addBlock(deindent`
132. 			window.removeEventListener( '${event}', ${handlerName} );
133. 		`);
134. 	});
135. 
136. 	// special case... might need to abstract this out if we add more special cases
137. 	if (bindings.scrollX && bindings.scrollY) {
138. 		const observerCallback = block.getUniqueName(`scrollobserver`);
139. 
140. 		block.builders.init.addBlock(deindent`
141. 			function ${observerCallback} () {
142. 				if ( ${lock} ) return;
143. 				var x = ${bindings.scrollX
144. 					? `#component.get( '${bindings.scrollX}' )`
145. 					: `window.scrollX`};
146. 				var y = ${bindings.scrollY
147. 					? `#component.get( '${bindings.scrollY}' )`
148. 					: `window.scrollY`};
149. 				window.scrollTo( x, y );
150. 			};
151. 		`);
152. 
153. 		if (bindings.scrollX)
154. 			block.builders.init.addLine(
155. 				`#component.observe( '${bindings.scrollX}', ${observerCallback} );`
156. 			);
157. 		if (bindings.scrollY)
158. 			block.builders.init.addLine(
159. 				`#component.observe( '${bindings.scrollY}', ${observerCallback} );`
160. 			);
161. 	} else if (bindings.scrollX || bindings.scrollY) {
162. 		const isX = !!bindings.scrollX;
163. 
164. 		block.builders.init.addBlock(deindent`
165. 			#component.observe( '${bindings.scrollX ||
166. 				bindings.scrollY}', function ( ${isX ? 'x' : 'y'} ) {
167. 				if ( ${lock} ) return;
168. 				window.scrollTo( ${isX ? 'x, window.scrollY' : 'window.scrollX, y'} );
169. 			});
170. 		`);
171. 	}
172. 
173. 	// another special case. (I'm starting to think these are all special cases.)
174. 	if (bindings.online) {
175. 		const handlerName = block.getUniqueName(`onlinestatuschanged`);
176. 		block.builders.init.addBlock(deindent`
177. 			function ${handlerName} ( event ) {
178. 				#component.set({ ${bindings.online}: navigator.onLine });
179. 			};
180. 			window.addEventListener( 'online', ${handlerName} );
181. 			window.addEventListener( 'offline', ${handlerName} );
182. 		`);
183. 
184. 		// add initial value
185. 		generator.metaBindings.push(
186. 			`this._state.${bindings.online} = navigator.onLine;`
187. 		);
188. 
189. 		block.builders.destroy.addBlock(deindent`
190. 			window.removeEventListener( 'online', ${handlerName} );
191. 			window.removeEventListener( 'offline', ${handlerName} );
192. 		`);
193. 	}
194. }


File: src/generators/dom/visitors/index.ts
Line number range: 1 - 17
Content:
1. import EachBlock from './EachBlock';
2. import Element from './Element/Element';
3. import IfBlock from './IfBlock';
4. import MustacheTag from './MustacheTag';
5. import RawMustacheTag from './RawMustacheTag';
6. import Text from './Text';
7. import YieldTag from './YieldTag';
8. 
9. export default {
10. 	EachBlock,
11. 	Element,
12. 	IfBlock,
13. 	MustacheTag,
14. 	RawMustacheTag,
15. 	Text,
16. 	YieldTag,
17. };


File: src/generators/server-side-rendering/Block.ts
Line number range: 1 - 54
Content:
1. import deindent from '../../utils/deindent';
2. import flattenReference from '../../utils/flattenReference';
3. import { SsrGenerator } from './index';
4. import { Node } from '../../interfaces';
5. import getObject from '../../utils/getObject';
6. 
7. interface BlockOptions {
8. 	// TODO
9. }
10. 
11. export default class Block {
12. 	generator: SsrGenerator;
13. 	conditions: string[];
14. 
15. 	contexts: Map<string, string>;
16. 	indexes: Map<string, string>;
17. 	contextDependencies: Map<string, string[]>;
18. 
19. 	constructor(options: BlockOptions) {
20. 		Object.assign(this, options);
21. 	}
22. 
23. 	addBinding(binding: Node, name: string) {
24. 		const conditions = [`!( '${binding.name}' in state )`].concat(
25. 			// TODO handle contextual bindings...
26. 			this.conditions.map(c => `(${c})`)
27. 		);
28. 
29. 		const { name: prop } = getObject(binding.value);
30. 
31. 		this.generator.bindings.push(deindent`
32. 			if ( ${conditions.join('&&')} ) {
33. 				tmp = ${name}.data();
34. 				if ( '${prop}' in tmp ) {
35. 					state.${binding.name} = tmp.${prop};
36. 					settled = false;
37. 				}
38. 			}
39. 		`);
40. 	}
41. 
42. 	child(options: BlockOptions) {
43. 		return new Block(Object.assign({}, this, options, { parent: this }));
44. 	}
45. 
46. 	contextualise(expression: Node, context?: string, isEventHandler?: boolean) {
47. 		return this.generator.contextualise(
48. 			this,
49. 			expression,
50. 			context,
51. 			isEventHandler
52. 		);
53. 	}
54. }


File: src/generators/server-side-rendering/index.ts
Line number range: 1 - 184
Content:
1. import deindent from '../../utils/deindent';
2. import Generator from '../Generator';
3. import Stylesheet from '../../css/Stylesheet';
4. import Block from './Block';
5. import preprocess from './preprocess';
6. import visit from './visit';
7. import { removeNode, removeObjectKey } from '../../utils/removeNode';
8. import { Parsed, Node, CompileOptions } from '../../interfaces';
9. 
10. export class SsrGenerator extends Generator {
11. 	bindings: string[];
12. 	renderCode: string;
13. 	elementDepth: number;
14. 
15. 	constructor(
16. 		parsed: Parsed,
17. 		source: string,
18. 		name: string,
19. 		stylesheet: Stylesheet,
20. 		options: CompileOptions
21. 	) {
22. 		super(parsed, source, name, stylesheet, options);
23. 		this.bindings = [];
24. 		this.renderCode = '';
25. 		this.elementDepth = 0;
26. 
27. 		// in an SSR context, we don't need to include events, methods, oncreate or ondestroy
28. 		const { templateProperties, defaultExport } = this;
29. 
30. 		preprocess(this, parsed.html);
31. 
32. 		this.stylesheet.warnOnUnusedSelectors(options.onwarn);
33. 
34. 		if (templateProperties.oncreate)
35. 			removeNode(
36. 				this.code,
37. 				defaultExport.declaration,
38. 				templateProperties.oncreate
39. 			);
40. 		if (templateProperties.ondestroy)
41. 			removeNode(
42. 				this.code,
43. 				defaultExport.declaration,
44. 				templateProperties.ondestroy
45. 			);
46. 		if (templateProperties.methods)
47. 			removeNode(
48. 				this.code,
49. 				defaultExport.declaration,
50. 				templateProperties.methods
51. 			);
52. 		if (templateProperties.events)
53. 			removeNode(
54. 				this.code,
55. 				defaultExport.declaration,
56. 				templateProperties.events
57. 			);
58. 	}
59. 
60. 	append(code: string) {
61. 		this.renderCode += code;
62. 	}
63. }
64. 
65. export default function ssr(
66. 	parsed: Parsed,
67. 	source: string,
68. 	stylesheet: Stylesheet,
69. 	options: CompileOptions
70. ) {
71. 	const format = options.format || 'cjs';
72. 
73. 	const generator = new SsrGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
74. 
75. 	const { computations, name, hasJs, templateProperties } = generator;
76. 
77. 	// create main render() function
78. 	const mainBlock = new Block({
79. 		generator,
80. 		contexts: new Map(),
81. 		indexes: new Map(),
82. 		conditions: [],
83. 	});
84. 
85. 	parsed.html.children.forEach((node: Node) => {
86. 		visit(generator, mainBlock, node);
87. 	});
88. 
89. 	const { css, cssMap } = generator.stylesheet.render(options.filename);
90. 
91. 	const result = deindent`
92. 		${hasJs && `[✂${parsed.js.content.start}-${parsed.js.content.end}✂]`}
93. 
94. 		var ${name} = {};
95. 
96. 		${name}.filename = ${JSON.stringify(options.filename)};
97. 
98. 		${name}.data = function () {
99. 			return ${templateProperties.data ? `@template.data()` : `{}`};
100. 		};
101. 
102. 		${name}.render = function ( state, options ) {
103. 			${templateProperties.data
104. 				? `state = Object.assign( @template.data(), state || {} );`
105. 				: `state = state || {};`}
106. 
107. 			${computations.map(
108. 				({ key, deps }) =>
109. 					`state.${key} = @template.computed.${key}( ${deps
110. 						.map(dep => `state.${dep}`)
111. 						.join(', ')} );`
112. 			)}
113. 
114. 			${generator.bindings.length &&
115. 				deindent`
116. 				var settled = false;
117. 				var tmp;
118. 
119. 				while ( !settled ) {
120. 					settled = true;
121. 
122. 					${generator.bindings.join('\n\n')}
123. 				}
124. 			`}
125. 
126. 			return \`${generator.renderCode}\`.trim();
127. 		};
128. 
129. 		${name}.renderCss = function () {
130. 			var components = [];
131. 
132. 			${generator.stylesheet.hasStyles &&
133. 				deindent`
134. 				components.push({
135. 					filename: ${name}.filename,
136. 					css: ${JSON.stringify(css)},
137. 					map: ${JSON.stringify(cssMap)}
138. 				});
139. 			`}
140. 
141. 			${templateProperties.components &&
142. 				deindent`
143. 				var seen = {};
144. 
145. 				function addComponent ( component ) {
146. 					var result = component.renderCss();
147. 					result.components.forEach( x => {
148. 						if ( seen[ x.filename ] ) return;
149. 						seen[ x.filename ] = true;
150. 						components.push( x );
151. 					});
152. 				}
153. 
154. 				${templateProperties.components.value.properties.map(prop => {
155. 					const { name } = prop.key;
156. 					const expression =
157. 						generator.importedComponents.get(name) ||
158. 						`@template.components.${name}`;
159. 					return `addComponent( ${expression} );`;
160. 				})}
161. 			`}
162. 
163. 			return {
164. 				css: components.map( x => x.css ).join( '\\n' ),
165. 				map: null,
166. 				components
167. 			};
168. 		};
169. 
170. 		var escaped = {
171. 			'"': '&quot;',
172. 			"'": '&#39;',
173. 			'&': '&amp;',
174. 			'<': '&lt;',
175. 			'>': '&gt;'
176. 		};
177. 
178. 		function __escape ( html ) {
179. 			return String( html ).replace( /["'&<>]/g, match => escaped[ match ] );
180. 		}
181. 	`.replace(/(\\)?@(\w*)/g, (match: string, escaped: string, name: string) => escaped ? match.slice(1) : generator.alias(name));
182. 
183. 	return generator.generate(result, options, { name, format });
184. }


File: src/generators/server-side-rendering/preprocess.ts
Line number range: 1 - 90
Content:
1. import { SsrGenerator } from './index';
2. import { Node } from '../../interfaces';
3. 
4. function noop () {}
5. 
6. function isElseIf(node: Node) {
7. 	return (
8. 		node && node.children.length === 1 && node.children[0].type === 'IfBlock'
9. 	);
10. }
11. 
12. const preprocessors = {
13. 	MustacheTag: noop,
14. 	RawMustacheTag: noop,
15. 	Text: noop,
16. 
17. 	IfBlock: (
18. 		generator: SsrGenerator,
19. 		node: Node,
20. 		elementStack: Node[]
21. 	) => {
22. 		function attachBlocks(node: Node) {
23. 			preprocessChildren(generator, node, elementStack);
24. 
25. 			if (isElseIf(node.else)) {
26. 				attachBlocks(node.else.children[0]);
27. 			} else if (node.else) {
28. 				preprocessChildren(
29. 					generator,
30. 					node.else,
31. 					elementStack
32. 				);
33. 			}
34. 		}
35. 
36. 		attachBlocks(node);
37. 	},
38. 
39. 	EachBlock: (
40. 		generator: SsrGenerator,
41. 		node: Node,
42. 		elementStack: Node[]
43. 	) => {
44. 		preprocessChildren(generator, node, elementStack);
45. 
46. 		if (node.else) {
47. 			preprocessChildren(
48. 				generator,
49. 				node.else,
50. 				elementStack
51. 			);
52. 		}
53. 	},
54. 
55. 	Element: (
56. 		generator: SsrGenerator,
57. 		node: Node,
58. 		elementStack: Node[]
59. 	) => {
60. 		const isComponent =
61. 			generator.components.has(node.name) || node.name === ':Self';
62. 
63. 		if (!isComponent) {
64. 			generator.stylesheet.apply(node, elementStack);
65. 		}
66. 
67. 		if (node.children.length) {
68. 			if (isComponent) {
69. 				preprocessChildren(generator, node, elementStack);
70. 			} else {
71. 				preprocessChildren(generator, node, elementStack.concat(node));
72. 			}
73. 		}
74. 	},
75. };
76. 
77. function preprocessChildren(
78. 	generator: SsrGenerator,
79. 	node: Node,
80. 	elementStack: Node[]
81. ) {
82. 	node.children.forEach((child: Node, i: number) => {
83. 		const preprocessor = preprocessors[child.type];
84. 		if (preprocessor) preprocessor(generator, child, elementStack);
85. 	});
86. }
87. 
88. export default function preprocess(generator: SsrGenerator, html: Node) {
89. 	preprocessChildren(generator, html, []);
90. }


File: src/generators/server-side-rendering/visit.ts
Line number range: 1 - 13
Content:
1. import visitors from './visitors/index';
2. import { SsrGenerator } from './index';
3. import Block from './Block';
4. import { Node } from '../../interfaces';
5. 
6. export default function visit(
7. 	generator: SsrGenerator,
8. 	block: Block,
9. 	node: Node
10. ) {
11. 	const visitor = visitors[node.type];
12. 	visitor(generator, block, node);
13. }


File: src/generators/server-side-rendering/visitors/Element.ts
Line number range: 1 - 82
Content:
1. import visitComponent from './Component';
2. import isVoidElementName from '../../../utils/isVoidElementName';
3. import visit from '../visit';
4. import visitWindow from './meta/Window';
5. import { SsrGenerator } from '../index';
6. import Block from '../Block';
7. import { Node } from '../../../interfaces';
8. 
9. const meta = {
10. 	':Window': visitWindow,
11. };
12. 
13. function stringifyAttributeValue(block: Block, chunks: Node[]) {
14. 	return chunks
15. 		.map((chunk: Node) => {
16. 			if (chunk.type === 'Text') {
17. 				return chunk.data;
18. 			}
19. 
20. 			const { snippet } = block.contextualise(chunk.expression);
21. 			return '${' + snippet + '}';
22. 		})
23. 		.join('');
24. }
25. 
26. export default function visitElement(
27. 	generator: SsrGenerator,
28. 	block: Block,
29. 	node: Node
30. ) {
31. 	if (node.name in meta) {
32. 		return meta[node.name](generator, block, node);
33. 	}
34. 
35. 	if (generator.components.has(node.name) || node.name === ':Self') {
36. 		visitComponent(generator, block, node);
37. 		return;
38. 	}
39. 
40. 	let openingTag = `<${node.name}`;
41. 	let textareaContents; // awkward special case
42. 
43. 	node.attributes.forEach((attribute: Node) => {
44. 		if (attribute.type !== 'Attribute') return;
45. 
46. 		if (attribute.name === 'value' && node.name === 'textarea') {
47. 			textareaContents = stringifyAttributeValue(block, attribute.value);
48. 		} else {
49. 			let str = ` ${attribute.name}`;
50. 
51. 			if (attribute.value !== true) {
52. 				str += `="${stringifyAttributeValue(block, attribute.value)}"`;
53. 			}
54. 
55. 			openingTag += str;
56. 		}
57. 	});
58. 
59. 	if (node._needsCssAttribute) {
60. 		openingTag += ` ${generator.stylesheet.id}`;
61. 	}
62. 
63. 	openingTag += '>';
64. 
65. 	generator.append(openingTag);
66. 
67. 	if (node.name === 'textarea' && textareaContents !== undefined) {
68. 		generator.append(textareaContents);
69. 	} else {
70. 		generator.elementDepth += 1;
71. 
72. 		node.children.forEach((child: Node) => {
73. 			visit(generator, block, child);
74. 		});
75. 
76. 		generator.elementDepth -= 1;
77. 	}
78. 
79. 	if (!isVoidElementName(node.name)) {
80. 		generator.append(`</${node.name}>`);
81. 	}
82. }


File: src/generators/server-side-rendering/visitors/index.ts
Line number range: 1 - 19
Content:
1. import Comment from './Comment';
2. import EachBlock from './EachBlock';
3. import Element from './Element';
4. import IfBlock from './IfBlock';
5. import MustacheTag from './MustacheTag';
6. import RawMustacheTag from './RawMustacheTag';
7. import Text from './Text';
8. import YieldTag from './YieldTag';
9. 
10. export default {
11. 	Comment,
12. 	EachBlock,
13. 	Element,
14. 	IfBlock,
15. 	MustacheTag,
16. 	RawMustacheTag,
17. 	Text,
18. 	YieldTag,
19. };


File: src/index.ts
Line number range: 1 - 78
Content:
1. import parse from './parse/index';
2. import validate from './validate/index';
3. import generate from './generators/dom/index';
4. import generateSSR from './generators/server-side-rendering/index';
5. import { assign } from './shared/index.js';
6. import { version } from '../package.json';
7. import Stylesheet from './css/Stylesheet';
8. import { Parsed, CompileOptions, Warning } from './interfaces';
9. 
10. function normalizeOptions(options: CompileOptions): CompileOptions {
11. 	return assign(
12. 		{
13. 			generate: 'dom',
14. 
15. 			// a filename is necessary for sourcemap generation
16. 			filename: 'SvelteComponent.html',
17. 
18. 			onwarn: (warning: Warning) => {
19. 				if (warning.loc) {
20. 					console.warn(
21. 						`(${warning.loc.line}:${warning.loc.column}) – ${warning.message}`
22. 					); // eslint-disable-line no-console
23. 				} else {
24. 					console.warn(warning.message); // eslint-disable-line no-console
25. 				}
26. 			},
27. 
28. 			onerror: (error: Error) => {
29. 				throw error;
30. 			},
31. 		},
32. 		options
33. 	);
34. }
35. 
36. export function compile(source: string, _options: CompileOptions) {
37. 	const options = normalizeOptions(_options);
38. 
39. 	let parsed: Parsed;
40. 
41. 	try {
42. 		parsed = parse(source, options);
43. 	} catch (err) {
44. 		options.onerror(err);
45. 		return;
46. 	}
47. 
48. 	const stylesheet = new Stylesheet(source, parsed, options.filename, options.cascade !== false);
49. 
50. 	validate(parsed, source, stylesheet, options);
51. 
52. 	const compiler = options.generate === 'ssr' ? generateSSR : generate;
53. 
54. 	return compiler(parsed, source, stylesheet, options);
55. }
56. 
57. export function create(source: string, _options: CompileOptions = {}) {
58. 	_options.format = 'eval';
59. 
60. 	const compiled = compile(source, _options);
61. 
62. 	if (!compiled || !compiled.code) {
63. 		return;
64. 	}
65. 
66. 	try {
67. 		return new Function('return ' + compiled.code)();
68. 	} catch (err) {
69. 		if (_options.onerror) {
70. 			_options.onerror(err);
71. 			return;
72. 		} else {
73. 			throw err;
74. 		}
75. 	}
76. }
77. 
78. export { parse, validate, version as VERSION };


File: src/interfaces.ts
Line number range: 1 - 69
Content:
1. export interface Node {
2. 	start: number;
3. 	end: number;
4. 	type: string;
5. 	[propName: string]: any;
6. }
7. 
8. export interface Parser {
9. 	readonly template: string;
10. 	readonly filename?: string;
11. 
12. 	index: number;
13. 	stack: Array<Node>;
14. 
15. 	html: Node;
16. 	css: Node;
17. 	js: Node;
18. 	metaTags: {};
19. }
20. 
21. export interface Parsed {
22. 	hash: number;
23. 	html: Node;
24. 	css: Node;
25. 	js: Node;
26. }
27. 
28. export interface Warning {
29. 	loc?: { line: number; column: number; pos?: number };
30. 	pos?: number;
31. 	message: string;
32. 	filename?: string;
33. 	frame?: string;
34. 	toString: () => string;
35. }
36. 
37. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';
38. 
39. export interface CompileOptions {
40. 	format?: ModuleFormat;
41. 	name?: string;
42. 	filename?: string;
43. 	generate?: string;
44. 	globals?: ((id: string) => string) | object;
45. 	amd?: {
46. 		id?: string;
47. 	};
48. 
49. 	outputFilename?: string;
50. 	cssOutputFilename?: string;
51. 
52. 	dev?: boolean;
53. 	shared?: boolean | string;
54. 	cascade?: boolean;
55. 	hydratable?: boolean;
56. 
57. 	onerror?: (error: Error) => void;
58. 	onwarn?: (warning: Warning) => void;
59. }
60. 
61. export interface GenerateOptions {
62. 	name: string;
63. 	format: ModuleFormat;
64. }
65. 
66. export interface Visitor {
67. 	enter: (node: Node) => void;
68. 	leave?: (node: Node) => void;
69. }


File: src/parse/index.ts
Line number range: 1 - 182
Content:
1. import { locate, Location } from 'locate-character';
2. import fragment from './state/fragment';
3. import { whitespace } from '../utils/patterns';
4. import { trimStart, trimEnd } from '../utils/trim';
5. import getCodeFrame from '../utils/getCodeFrame';
6. import hash from './utils/hash';
7. import { Node, Parsed } from '../interfaces';
8. import CompileError from '../utils/CompileError';
9. 
10. class ParseError extends CompileError {
11. 	constructor(
12. 		message: string,
13. 		template: string,
14. 		index: number,
15. 		filename: string
16. 	) {
17. 		super(message, template, index, filename);
18. 		this.name = 'ParseError';
19. 	}
20. }
21. 
22. interface ParserOptions {
23. 	filename?: string;
24. }
25. 
26. export class Parser {
27. 	readonly template: string;
28. 	readonly filename?: string;
29. 
30. 	index: number;
31. 	stack: Array<Node>;
32. 
33. 	html: Node;
34. 	css: Node;
35. 	js: Node;
36. 	metaTags: {};
37. 
38. 	constructor(template: string, options: ParserOptions) {
39. 		if (typeof template !== 'string') {
40. 			throw new TypeError('Template must be a string');
41. 		}
42. 
43. 		this.template = template.replace(/\s+$/, '');
44. 		this.filename = options.filename;
45. 
46. 		this.index = 0;
47. 		this.stack = [];
48. 		this.metaTags = {};
49. 
50. 		this.html = {
51. 			start: null,
52. 			end: null,
53. 			type: 'Fragment',
54. 			children: [],
55. 		};
56. 
57. 		this.css = null;
58. 		this.js = null;
59. 
60. 		this.stack.push(this.html);
61. 
62. 		let state = fragment;
63. 
64. 		while (this.index < this.template.length) {
65. 			state = state(this) || fragment;
66. 		}
67. 
68. 		if (this.stack.length > 1) {
69. 			const current = this.current();
70. 
71. 			const type = current.type === 'Element' ? `<${current.name}>` : 'Block';
72. 			this.error(`${type} was left open`, current.start);
73. 		}
74. 
75. 		if (state !== fragment) {
76. 			this.error('Unexpected end of input');
77. 		}
78. 
79. 		if (this.html.children.length) {
80. 			let start = this.html.children[0] && this.html.children[0].start;
81. 			while (/\s/.test(template[start])) start += 1;
82. 
83. 			let end = this.html.children[this.html.children.length - 1] && this.html.children[this.html.children.length - 1].end;
84. 			while (/\s/.test(template[end - 1])) end -= 1;
85. 
86. 			this.html.start = start;
87. 			this.html.end = end;
88. 		} else {
89. 			this.html.start = this.html.end = null;
90. 		}
91. 	}
92. 
93. 	current() {
94. 		return this.stack[this.stack.length - 1];
95. 	}
96. 
97. 	acornError(err: Error) {
98. 		this.error(err.message.replace(/ \(\d+:\d+\)$/, ''), err.pos);
99. 	}
100. 
101. 	error(message: string, index = this.index) {
102. 		throw new ParseError(message, this.template, index, this.filename);
103. 	}
104. 
105. 	eat(str: string, required?: boolean) {
106. 		if (this.match(str)) {
107. 			this.index += str.length;
108. 			return true;
109. 		}
110. 
111. 		if (required) {
112. 			this.error(`Expected ${str}`);
113. 		}
114. 
115. 		return false;
116. 	}
117. 
118. 	match(str: string) {
119. 		return this.template.slice(this.index, this.index + str.length) === str;
120. 	}
121. 
122. 	allowWhitespace() {
123. 		while (
124. 			this.index < this.template.length &&
125. 			whitespace.test(this.template[this.index])
126. 		) {
127. 			this.index++;
128. 		}
129. 	}
130. 
131. 	read(pattern: RegExp) {
132. 		const match = pattern.exec(this.template.slice(this.index));
133. 		if (!match || match.index !== 0) return null;
134. 
135. 		this.index += match[0].length;
136. 
137. 		return match[0];
138. 	}
139. 
140. 	readUntil(pattern: RegExp) {
141. 		if (this.index >= this.template.length)
142. 			this.error('Unexpected end of input');
143. 
144. 		const start = this.index;
145. 		const match = pattern.exec(this.template.slice(start));
146. 
147. 		if (match) {
148. 			const start = this.index;
149. 			this.index = start + match.index;
150. 			return this.template.slice(start, this.index);
151. 		}
152. 
153. 		this.index = this.template.length;
154. 		return this.template.slice(start);
155. 	}
156. 
157. 	remaining() {
158. 		return this.template.slice(this.index);
159. 	}
160. 
161. 	requireWhitespace() {
162. 		if (!whitespace.test(this.template[this.index])) {
163. 			this.error(`Expected whitespace`);
164. 		}
165. 
166. 		this.allowWhitespace();
167. 	}
168. }
169. 
170. export default function parse(
171. 	template: string,
172. 	options: ParserOptions = {}
173. ): Parsed {
174. 	const parser = new Parser(template, options);
175. 
176. 	return {
177. 		hash: hash(parser.template),
178. 		html: parser.html,
179. 		css: parser.css,
180. 		js: parser.js,
181. 	};
182. }


File: src/parse/state/tag.ts
Line number range: 1 - 390
Content:
1. import readExpression from '../read/expression';
2. import readScript from '../read/script';
3. import readStyle from '../read/style';
4. import {
5. 	readEventHandlerDirective,
6. 	readBindingDirective,
7. 	readTransitionDirective,
8. } from '../read/directives';
9. import { trimStart, trimEnd } from '../../utils/trim';
10. import { decodeCharacterReferences } from '../utils/html';
11. import isVoidElementName from '../../utils/isVoidElementName';
12. import { Parser } from '../index';
13. import { Node } from '../../interfaces';
14. 
15. const validTagName = /^\!?[a-zA-Z]{1,}:?[a-zA-Z0-9\-]*/;
16. 
17. const SELF = ':Self';
18. 
19. const metaTags = {
20. 	':Window': true,
21. };
22. 
23. const specials = new Map([
24. 	[
25. 		'script',
26. 		{
27. 			read: readScript,
28. 			property: 'js',
29. 		},
30. 	],
31. 	[
32. 		'style',
33. 		{
34. 			read: readStyle,
35. 			property: 'css',
36. 		},
37. 	],
38. ]);
39. 
40. // based on http://developers.whatwg.org/syntax.html#syntax-tag-omission
41. const disallowedContents = new Map([
42. 	['li', new Set(['li'])],
43. 	['dt', new Set(['dt', 'dd'])],
44. 	['dd', new Set(['dt', 'dd'])],
45. 	[
46. 		'p',
47. 		new Set(
48. 			'address article aside blockquote div dl fieldset footer form h1 h2 h3 h4 h5 h6 header hgroup hr main menu nav ol p pre section table ul'.split(
49. 				' '
50. 			)
51. 		),
52. 	],
53. 	['rt', new Set(['rt', 'rp'])],
54. 	['rp', new Set(['rt', 'rp'])],
55. 	['optgroup', new Set(['optgroup'])],
56. 	['option', new Set(['option', 'optgroup'])],
57. 	['thead', new Set(['tbody', 'tfoot'])],
58. 	['tbody', new Set(['tbody', 'tfoot'])],
59. 	['tfoot', new Set(['tbody'])],
60. 	['tr', new Set(['tr', 'tbody'])],
61. 	['td', new Set(['td', 'th', 'tr'])],
62. 	['th', new Set(['td', 'th', 'tr'])],
63. ]);
64. 
65. export default function tag(parser: Parser) {
66. 	const start = parser.index++;
67. 
68. 	let parent = parser.current();
69. 
70. 	if (parser.eat('!--')) {
71. 		const data = parser.readUntil(/-->/);
72. 		parser.eat('-->');
73. 
74. 		parser.current().children.push({
75. 			start,
76. 			end: parser.index,
77. 			type: 'Comment',
78. 			data,
79. 		});
80. 
81. 		return;
82. 	}
83. 
84. 	const isClosingTag = parser.eat('/');
85. 
86. 	const name = readTagName(parser);
87. 
88. 	if (name in metaTags) {
89. 		if (name in parser.metaTags) {
90. 			if (isClosingTag && parser.current().children.length) {
91. 				parser.error(
92. 					`<${name}> cannot have children`,
93. 					parser.current().children[0].start
94. 				);
95. 			}
96. 
97. 			parser.error(`A component can only have one <${name}> tag`, start);
98. 		}
99. 
100. 		parser.metaTags[name] = true;
101. 
102. 		if (parser.stack.length > 1) {
103. 			parser.error(`<${name}> tags cannot be inside elements or blocks`, start);
104. 		}
105. 	}
106. 
107. 	parser.allowWhitespace();
108. 
109. 	if (isClosingTag) {
110. 		if (isVoidElementName(name)) {
111. 			parser.error(
112. 				`<${name}> is a void element and cannot have children, or a closing tag`,
113. 				start
114. 			);
115. 		}
116. 
117. 		if (!parser.eat('>')) parser.error(`Expected '>'`);
118. 
119. 		// close any elements that don't have their own closing tags, e.g. <div><p></div>
120. 		while (parent.name !== name) {
121. 			if (parent.type !== 'Element')
122. 				parser.error(
123. 					`</${name}> attempted to close an element that was not open`,
124. 					start
125. 				);
126. 
127. 			parent.end = start;
128. 			parser.stack.pop();
129. 
130. 			parent = parser.current();
131. 		}
132. 
133. 		parent.end = parser.index;
134. 		parser.stack.pop();
135. 
136. 		return;
137. 	} else if (disallowedContents.has(parent.name)) {
138. 		// can this be a child of the parent element, or does it implicitly
139. 		// close it, like `<li>one<li>two`?
140. 		if (disallowedContents.get(parent.name).has(name)) {
141. 			parent.end = start;
142. 			parser.stack.pop();
143. 		}
144. 	}
145. 
146. 	const attributes = [];
147. 	const uniqueNames = new Set();
148. 
149. 	let attribute;
150. 	while ((attribute = readAttribute(parser, uniqueNames))) {
151. 		attributes.push(attribute);
152. 		parser.allowWhitespace();
153. 	}
154. 
155. 	parser.allowWhitespace();
156. 
157. 	// special cases – top-level <script> and <style>
158. 	if (specials.has(name) && parser.stack.length === 1) {
159. 		const special = specials.get(name);
160. 
161. 		if (parser[special.property]) {
162. 			parser.index = start;
163. 			parser.error(
164. 				`You can only have one top-level <${name}> tag per component`
165. 			);
166. 		}
167. 
168. 		parser.eat('>', true);
169. 		parser[special.property] = special.read(parser, start, attributes);
170. 		return;
171. 	}
172. 
173. 	const element: Node = {
174. 		start,
175. 		end: null, // filled in later
176. 		type: 'Element',
177. 		name,
178. 		attributes,
179. 		children: [],
180. 	};
181. 
182. 	parser.current().children.push(element);
183. 
184. 	const selfClosing = parser.eat('/') || isVoidElementName(name);
185. 
186. 	parser.eat('>', true);
187. 
188. 	if (selfClosing) {
189. 		element.end = parser.index;
190. 	} else if (name === 'textarea') {
191. 		// special case
192. 		element.children = readSequence(
193. 			parser,
194. 			() =>
195. 				parser.template.slice(parser.index, parser.index + 11) === '</textarea>'
196. 		);
197. 		parser.read(/<\/textarea>/);
198. 		element.end = parser.index;
199. 	} else {
200. 		// don't push self-closing elements onto the stack
201. 		parser.stack.push(element);
202. 	}
203. }
204. 
205. function readTagName(parser: Parser) {
206. 	const start = parser.index;
207. 
208. 	if (parser.eat(SELF)) {
209. 		// check we're inside a block, otherwise this
210. 		// will cause infinite recursion
211. 		let i = parser.stack.length;
212. 		let legal = false;
213. 
214. 		while (i--) {
215. 			const fragment = parser.stack[i];
216. 			if (fragment.type === 'IfBlock' || fragment.type === 'EachBlock') {
217. 				legal = true;
218. 				break;
219. 			}
220. 		}
221. 
222. 		if (!legal) {
223. 			parser.error(
224. 				`<${SELF}> components can only exist inside if-blocks or each-blocks`,
225. 				start
226. 			);
227. 		}
228. 
229. 		return SELF;
230. 	}
231. 
232. 	const name = parser.readUntil(/(\s|\/|>)/);
233. 
234. 	if (name in metaTags) return name;
235. 
236. 	if (!validTagName.test(name)) {
237. 		parser.error(`Expected valid tag name`, start);
238. 	}
239. 
240. 	return name;
241. }
242. 
243. function readAttribute(parser: Parser, uniqueNames: Set<string>) {
244. 	const start = parser.index;
245. 
246. 	let name = parser.readUntil(/(\s|=|\/|>)/);
247. 	if (!name) return null;
248. 	if (uniqueNames.has(name)) {
249. 		parser.error('Attributes need to be unique', start);
250. 	}
251. 
252. 	uniqueNames.add(name);
253. 
254. 	parser.allowWhitespace();
255. 
256. 	if (/^on:/.test(name)) {
257. 		return readEventHandlerDirective(parser, start, name.slice(3), parser.eat('='));
258. 	}
259. 
260. 	if (/^bind:/.test(name)) {
261. 		return readBindingDirective(parser, start, name.slice(5));
262. 	}
263. 
264. 	if (/^ref:/.test(name)) {
265. 		return {
266. 			start,
267. 			end: parser.index,
268. 			type: 'Ref',
269. 			name: name.slice(4),
270. 		};
271. 	}
272. 
273. 	const match = /^(in|out|transition):/.exec(name);
274. 	if (match) {
275. 		return readTransitionDirective(
276. 			parser,
277. 			start,
278. 			name.slice(match[0].length),
279. 			match[1]
280. 		);
281. 	}
282. 
283. 	let value;
284. 
285. 	// :foo is shorthand for foo='{{foo}}'
286. 	if (/^:\w+$/.test(name)) {
287. 		name = name.slice(1);
288. 		value = getShorthandValue(start + 1, name);
289. 	} else {
290. 		value = parser.eat('=') ? readAttributeValue(parser) : true;
291. 	}
292. 
293. 	return {
294. 		start,
295. 		end: parser.index,
296. 		type: 'Attribute',
297. 		name,
298. 		value,
299. 	};
300. }
301. 
302. function readAttributeValue(parser: Parser) {
303. 	const quoteMark = parser.eat(`'`) ? `'` : parser.eat(`"`) ? `"` : null;
304. 
305. 	const regex = quoteMark === `'`
306. 		? /'/
307. 		: quoteMark === `"` ? /"/ : /[\s"'=<>\/`]/;
308. 
309. 	const value = readSequence(parser, () =>
310. 		regex.test(parser.template[parser.index])
311. 	);
312. 
313. 	if (quoteMark) parser.index += 1;
314. 	return value;
315. }
316. 
317. function getShorthandValue(start: number, name: string) {
318. 	const end = start + name.length;
319. 
320. 	return [
321. 		{
322. 			type: 'AttributeShorthand',
323. 			start,
324. 			end,
325. 			expression: {
326. 				type: 'Identifier',
327. 				start,
328. 				end,
329. 				name,
330. 			},
331. 		},
332. 	];
333. }
334. 
335. function readSequence(parser: Parser, done: () => boolean) {
336. 	let currentChunk: Node = {
337. 		start: parser.index,
338. 		end: null,
339. 		type: 'Text',
340. 		data: '',
341. 	};
342. 
343. 	const chunks = [];
344. 
345. 	while (parser.index < parser.template.length) {
346. 		const index = parser.index;
347. 
348. 		if (done()) {
349. 			currentChunk.end = parser.index;
350. 
351. 			if (currentChunk.data) chunks.push(currentChunk);
352. 
353. 			chunks.forEach(chunk => {
354. 				if (chunk.type === 'Text')
355. 					chunk.data = decodeCharacterReferences(chunk.data);
356. 			});
357. 
358. 			return chunks;
359. 		} else if (parser.eat('{{')) {
360. 			if (currentChunk.data) {
361. 				currentChunk.end = index;
362. 				chunks.push(currentChunk);
363. 			}
364. 
365. 			const expression = readExpression(parser);
366. 			parser.allowWhitespace();
367. 			if (!parser.eat('}}')) {
368. 				parser.error(`Expected }}`);
369. 			}
370. 
371. 			chunks.push({
372. 				start: index,
373. 				end: parser.index,
374. 				type: 'MustacheTag',
375. 				expression,
376. 			});
377. 
378. 			currentChunk = {
379. 				start: parser.index,
380. 				end: null,
381. 				type: 'Text',
382. 				data: '',
383. 			};
384. 		} else {
385. 			currentChunk.data += parser.template[parser.index++];
386. 		}
387. 	}
388. 
389. 	parser.error(`Unexpected end of input`);
390. }


File: src/validate/html/index.ts
Line number range: 1 - 85
Content:
1. import * as namespaces from '../../utils/namespaces';
2. import validateElement from './validateElement';
3. import validateWindow from './validateWindow';
4. import fuzzymatch from '../utils/fuzzymatch'
5. import flattenReference from '../../utils/flattenReference';
6. import { Validator } from '../index';
7. import { Node } from '../../interfaces';
8. 
9. const svg = /^(?:altGlyph|altGlyphDef|altGlyphItem|animate|animateColor|animateMotion|animateTransform|circle|clipPath|color-profile|cursor|defs|desc|discard|ellipse|feBlend|feColorMatrix|feComponentTransfer|feComposite|feConvolveMatrix|feDiffuseLighting|feDisplacementMap|feDistantLight|feDropShadow|feFlood|feFuncA|feFuncB|feFuncG|feFuncR|feGaussianBlur|feImage|feMerge|feMergeNode|feMorphology|feOffset|fePointLight|feSpecularLighting|feSpotLight|feTile|feTurbulence|filter|font|font-face|font-face-format|font-face-name|font-face-src|font-face-uri|foreignObject|g|glyph|glyphRef|hatch|hatchpath|hkern|image|line|linearGradient|marker|mask|mesh|meshgradient|meshpatch|meshrow|metadata|missing-glyph|mpath|path|pattern|polygon|polyline|radialGradient|rect|set|solidcolor|stop|switch|symbol|text|textPath|title|tref|tspan|unknown|use|view|vkern)$/;
10. 
11. const meta = new Map([[':Window', validateWindow]]);
12. 
13. export default function validateHtml(validator: Validator, html: Node) {
14. 	let elementDepth = 0;
15. 
16. 	const refs = new Map();
17. 	const refCallees: Node[] = [];
18. 
19. 	function visit(node: Node) {
20. 		if (node.type === 'Element') {
21. 			if (
22. 				elementDepth === 0 &&
23. 				validator.namespace !== namespaces.svg &&
24. 				svg.test(node.name)
25. 			) {
26. 				validator.warn(
27. 					`<${node.name}> is an SVG element – did you forget to add { namespace: 'svg' } ?`,
28. 					node.start
29. 				);
30. 			}
31. 
32. 			if (meta.has(node.name)) {
33. 				return meta.get(node.name)(validator, node, refs, refCallees);
34. 			}
35. 
36. 			elementDepth += 1;
37. 
38. 			validateElement(validator, node, refs, refCallees);
39. 		} else if (node.type === 'EachBlock') {
40. 			if (validator.helpers.has(node.context)) {
41. 				let c = node.expression.end;
42. 
43. 				// find start of context
44. 				while (/\s/.test(validator.source[c])) c += 1;
45. 				c += 2;
46. 				while (/\s/.test(validator.source[c])) c += 1;
47. 
48. 				validator.warn(
49. 					`Context clashes with a helper. Rename one or the other to eliminate any ambiguity`,
50. 					c
51. 				);
52. 			}
53. 		}
54. 
55. 		if (node.children) {
56. 			node.children.forEach(visit);
57. 		}
58. 
59. 		if (node.else) {
60. 			visit(node.else);
61. 		}
62. 
63. 		if (node.type === 'Element') {
64. 			elementDepth -= 1;
65. 		}
66. 	}
67. 
68. 	html.children.forEach(visit);
69. 
70. 	refCallees.forEach(callee => {
71. 		const { parts } = flattenReference(callee);
72. 		const ref = parts[1];
73. 
74. 		if (refs.has(ref)) {
75. 			// TODO check method is valid, e.g. `audio.stop()` should be `audio.pause()`
76. 		} else {
77. 			const match = fuzzymatch(ref, Array.from(refs.keys()));
78. 
79. 			let message = `'refs.${ref}' does not exist`;
80. 			if (match) message += ` (did you mean 'refs.${match}'?)`;
81. 
82. 			validator.error(message, callee.start);
83. 		}
84. 	});
85. }


File: src/validate/html/validateElement.ts
Line number range: 1 - 161
Content:
1. import validateEventHandler from './validateEventHandler';
2. import { Validator } from '../index';
3. import { Node } from '../../interfaces';
4. 
5. export default function validateElement(validator: Validator, node: Node, refs: Map<string, Node[]>, refCallees: Node[]) {
6. 	const isComponent =
7. 		node.name === ':Self' || validator.components.has(node.name);
8. 
9. 	if (!isComponent && /^[A-Z]/.test(node.name[0])) {
10. 		// TODO upgrade to validator.error in v2
11. 		validator.warn(`${node.name} component is not defined`, node.start);
12. 	}
13. 
14. 	let hasIntro: boolean;
15. 	let hasOutro: boolean;
16. 	let hasTransition: boolean;
17. 
18. 	node.attributes.forEach((attribute: Node) => {
19. 		if (attribute.type === 'Ref') {
20. 			if (!refs.has(attribute.name)) refs.set(attribute.name, []);
21. 			refs.get(attribute.name).push(node);
22. 		}
23. 
24. 		if (!isComponent && attribute.type === 'Binding') {
25. 			const { name } = attribute;
26. 
27. 			if (name === 'value') {
28. 				if (
29. 					node.name !== 'input' &&
30. 					node.name !== 'textarea' &&
31. 					node.name !== 'select'
32. 				) {
33. 					validator.error(
34. 						`'value' is not a valid binding on <${node.name}> elements`,
35. 						attribute.start
36. 					);
37. 				}
38. 
39. 				checkTypeAttribute(validator, node);
40. 			} else if (name === 'checked') {
41. 				if (node.name !== 'input') {
42. 					validator.error(
43. 						`'checked' is not a valid binding on <${node.name}> elements`,
44. 						attribute.start
45. 					);
46. 				}
47. 
48. 				if (checkTypeAttribute(validator, node) !== 'checkbox') {
49. 					validator.error(
50. 						`'checked' binding can only be used with <input type="checkbox">`,
51. 						attribute.start
52. 					);
53. 				}
54. 			} else if (name === 'group') {
55. 				if (node.name !== 'input') {
56. 					validator.error(
57. 						`'group' is not a valid binding on <${node.name}> elements`,
58. 						attribute.start
59. 					);
60. 				}
61. 
62. 				const type = checkTypeAttribute(validator, node);
63. 
64. 				if (type !== 'checkbox' && type !== 'radio') {
65. 					validator.error(
66. 						`'checked' binding can only be used with <input type="checkbox"> or <input type="radio">`,
67. 						attribute.start
68. 					);
69. 				}
70. 			} else if (
71. 				name === 'currentTime' ||
72. 				name === 'duration' ||
73. 				name === 'paused'
74. 			) {
75. 				if (node.name !== 'audio' && node.name !== 'video') {
76. 					validator.error(
77. 						`'${name}' binding can only be used with <audio> or <video>`,
78. 						attribute.start
79. 					);
80. 				}
81. 			} else {
82. 				validator.error(
83. 					`'${attribute.name}' is not a valid binding`,
84. 					attribute.start
85. 				);
86. 			}
87. 		} else if (attribute.type === 'EventHandler') {
88. 			validateEventHandler(validator, attribute, refCallees);
89. 		} else if (attribute.type === 'Transition') {
90. 			const bidi = attribute.intro && attribute.outro;
91. 
92. 			if (hasTransition) {
93. 				if (bidi)
94. 					validator.error(
95. 						`An element can only have one 'transition' directive`,
96. 						attribute.start
97. 					);
98. 				validator.error(
99. 					`An element cannot have both a 'transition' directive and an '${attribute.intro
100. 						? 'in'
101. 						: 'out'}' directive`,
102. 					attribute.start
103. 				);
104. 			}
105. 
106. 			if ((hasIntro && attribute.intro) || (hasOutro && attribute.outro)) {
107. 				if (bidi)
108. 					validator.error(
109. 						`An element cannot have both an '${hasIntro
110. 							? 'in'
111. 							: 'out'}' directive and a 'transition' directive`,
112. 						attribute.start
113. 					);
114. 				validator.error(
115. 					`An element can only have one '${hasIntro ? 'in' : 'out'}' directive`,
116. 					attribute.start
117. 				);
118. 			}
119. 
120. 			if (attribute.intro) hasIntro = true;
121. 			if (attribute.outro) hasOutro = true;
122. 			if (bidi) hasTransition = true;
123. 
124. 			if (!validator.transitions.has(attribute.name)) {
125. 				validator.error(
126. 					`Missing transition '${attribute.name}'`,
127. 					attribute.start
128. 				);
129. 			}
130. 		} else if (attribute.type === 'Attribute') {
131. 			if (attribute.name === 'value' && node.name === 'textarea') {
132. 				if (node.children.length) {
133. 					validator.error(
134. 						`A <textarea> can have either a value attribute or (equivalently) child content, but not both`,
135. 						attribute.start
136. 					);
137. 				}
138. 			}
139. 		}
140. 	});
141. }
142. 
143. function checkTypeAttribute(validator: Validator, node: Node) {
144. 	const attribute = node.attributes.find(
145. 		(attribute: Node) => attribute.name === 'type'
146. 	);
147. 	if (!attribute) return null;
148. 
149. 	if (attribute.value === true) {
150. 		validator.error(`'type' attribute must be specified`, attribute.start);
151. 	}
152. 
153. 	if (attribute.value.length > 1 || attribute.value[0].type !== 'Text') {
154. 		validator.error(
155. 			`'type' attribute cannot be dynamic if input uses two-way binding`,
156. 			attribute.start
157. 		);
158. 	}
159. 
160. 	return attribute.value[0].data;
161. }


File: src/validate/html/validateEventHandler.ts
Line number range: 1 - 51
Content:
1. import flattenReference from '../../utils/flattenReference';
2. import list from '../utils/list';
3. import { Validator } from '../index';
4. import { Node } from '../../interfaces';
5. 
6. const validBuiltins = new Set(['set', 'fire', 'destroy']);
7. 
8. export default function validateEventHandlerCallee(
9. 	validator: Validator,
10. 	attribute: Node,
11. 	refCallees: Node[]
12. ) {
13. 	if (!attribute.expression) return;
14. 
15. 	const { callee, start, type } = attribute.expression;
16. 
17. 	if (type !== 'CallExpression') {
18. 		validator.error(`Expected a call expression`, start);
19. 	}
20. 
21. 	const { name } = flattenReference(callee);
22. 
23. 	if (name === 'this' || name === 'event') return;
24. 
25. 	if (name === 'refs') {
26. 		refCallees.push(callee);
27. 		return;
28. 	}
29. 
30. 	if (
31. 		(callee.type === 'Identifier' && validBuiltins.has(callee.name)) ||
32. 		validator.methods.has(callee.name)
33. 	)
34. 		return;
35. 
36. 	const validCallees = ['this.*', 'event.*'].concat(
37. 		Array.from(validBuiltins),
38. 		Array.from(validator.methods.keys())
39. 	);
40. 
41. 	let message = `'${validator.source.slice(
42. 		callee.start,
43. 		callee.end
44. 	)}' is an invalid callee (should be one of ${list(validCallees)})`;
45. 
46. 	if (callee.type === 'Identifier' && validator.helpers.has(callee.name)) {
47. 		message += `. '${callee.name}' exists on 'helpers', did you put it in the wrong place?`;
48. 	}
49. 
50. 	validator.warn(message, start);
51. }


File: src/validate/html/validateWindow.ts
Line number range: 1 - 56
Content:
1. import flattenReference from '../../utils/flattenReference';
2. import fuzzymatch from '../utils/fuzzymatch';
3. import list from '../utils/list';
4. import validateEventHandler from './validateEventHandler';
5. import { Validator } from '../index';
6. import { Node } from '../../interfaces';
7. 
8. const validBindings = [
9. 	'innerWidth',
10. 	'innerHeight',
11. 	'outerWidth',
12. 	'outerHeight',
13. 	'scrollX',
14. 	'scrollY',
15. ];
16. 
17. export default function validateWindow(validator: Validator, node: Node, refs: Map<string, Node[]>, refCallees: Node[]) {
18. 	node.attributes.forEach((attribute: Node) => {
19. 		if (attribute.type === 'Binding') {
20. 			if (attribute.value.type !== 'Identifier') {
21. 				const { parts } = flattenReference(attribute.value);
22. 
23. 				validator.error(
24. 					`Bindings on <:Window/> must be to top-level properties, e.g. '${parts[
25. 						parts.length - 1
26. 					]}' rather than '${parts.join('.')}'`,
27. 					attribute.value.start
28. 				);
29. 			}
30. 
31. 			if (!~validBindings.indexOf(attribute.name)) {
32. 				const match = attribute.name === 'width'
33. 					? 'innerWidth'
34. 					: attribute.name === 'height'
35. 						? 'innerHeight'
36. 						: fuzzymatch(attribute.name, validBindings);
37. 
38. 				const message = `'${attribute.name}' is not a valid binding on <:Window>`;
39. 
40. 				if (match) {
41. 					validator.error(
42. 						`${message} (did you mean '${match}'?)`,
43. 						attribute.start
44. 					);
45. 				} else {
46. 					validator.error(
47. 						`${message} — valid bindings are ${list(validBindings)}`,
48. 						attribute.start
49. 					);
50. 				}
51. 			}
52. 		} else if (attribute.type === 'EventHandler') {
53. 			validateEventHandler(validator, attribute, refCallees);
54. 		}
55. 	});
56. }


File: test/js/README.md
Line number range: 1 - 1
Content:
1. Use these tests sparingly, as they will need to be updated frequently as the code generation changes.


File: test/server-side-rendering/index.js
Line number range: 1 - 108
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require(process.env.COVERAGE
25. 			? "../../src/server-side-rendering/register.js"
26. 			: "../../ssr/register");
27. 
28. 		return setupHtmlEqual();
29. 	});
30. 
31. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
32. 		if (dir[0] === ".") return;
33. 
34. 		// add .solo to a sample directory name to only run that test, or
35. 		// .show to always show the output. or both
36. 		const solo = /\.solo/.test(dir);
37. 		const show = /\.show/.test(dir);
38. 
39. 		if (solo && process.env.CI) {
40. 			throw new Error("Forgot to remove `solo: true` from test");
41. 		}
42. 
43. 		(solo ? it.only : it)(dir, () => {
44. 			dir = path.resolve("test/server-side-rendering/samples", dir);
45. 			try {
46. 				const component = require(`${dir}/main.html`);
47. 
48. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
49. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
50. 
51. 				const data = tryToLoadJson(`${dir}/data.json`);
52. 
53. 				const html = component.render(data);
54. 				const css = component.renderCss().css;
55. 
56. 				fs.writeFileSync(`${dir}/_actual.html`, html);
57. 				if (css) fs.writeFileSync(`${dir}/_actual.css`, css);
58. 
59. 				assert.htmlEqual(html, expectedHtml);
60. 				assert.equal(
61. 					css.replace(/^\s+/gm, ""),
62. 					expectedCss.replace(/^\s+/gm, "")
63. 				);
64. 
65. 				if (show) showOutput(dir, { generate: 'ssr' });
66. 			} catch (err) {
67. 				showOutput(dir, { generate: 'ssr' });
68. 				throw err;
69. 			}
70. 		});
71. 	});
72. 
73. 	// duplicate client-side tests, as far as possible
74. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
75. 		if (dir[0] === ".") return;
76. 
77. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
78. 
79. 		if (config.solo && process.env.CI) {
80. 			throw new Error("Forgot to remove `solo: true` from test");
81. 		}
82. 
83. 		if (config["skip-ssr"]) return;
84. 
85. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
86. 			const cwd = path.resolve("test/runtime/samples", dir);
87. 
88. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
89. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
90. 				delete require.cache[resolved];
91. 			});
92. 
93. 			const component = require(`../runtime/samples/${dir}/main.html`);
94. 			let html;
95. 
96. 			try {
97. 				html = component.render(config.data);
98. 
99. 				if (config.html) {
100. 					assert.htmlEqual(html, config.html);
101. 				}
102. 			} catch (err) {
103. 				showOutput(cwd, { generate: "ssr" });
104. 				throw err;
105. 			}
106. 		});
107. 	});
108. });

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-10 23:46:59,448 - thread-133013312636608.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="1. Query requirement analysis:\n- Needs Node/Element interface and Ref representation in the AST\n- This snippet shows how the parser creates a Ref directive node with type 'Ref' and its name\n2. Extended relevance:\n- Establishes how refs are represented in parsed nodes used downstream by visitors", relative_path='src/parse/state/tag.ts', start_line=264, end_line=271), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs the generic Node interface used across DOM/SSR\n2. Extended relevance:\n- Clarifies that Node is a flexible AST node shape with dynamic properties used by code for _needsCssAttribute and attributes', relative_path='src/interfaces.ts', start_line=1, end_line=6), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs DOM Element visitor/runtime ref mapping and where refs map to this.refs\n- This snippet sets component.refs[name] during mount and clears it on destroy; marks usesRefs\n2. Extended relevance:\n- Critical implementation of ref lifecycle on the DOM side', relative_path='src/generators/dom/visitors/Element/Ref.ts', start_line=16, end_line=25), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs where the runtime creates this.refs in the component constructor\n2. Extended relevance:\n- Ensures that refs mapping in visitors has a backing object created when refs are used', relative_path='src/generators/dom/index.ts', start_line=186, end_line=190), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs Generator/Block implementation that adds CSS scoping attribute in DOM\n- This defines encapsulateStyles helper used to add the scoping attribute\n2. Extended relevance:\n- Shows how DOM runtime adds scoping attribute by setting a stylesheet id attribute', relative_path='src/generators/dom/index.ts', start_line=138, end_line=143), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs DOM Element visitor where CSS scoping attribute is added to elements\n2. Extended relevance:\n- This snippet checks node._needsCssAttribute and invokes encapsulateStyles during hydrate', relative_path='src/generators/dom/visitors/Element/Element.ts', start_line=85, end_line=90), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs the CSS scoping logic which flags elements for attribute addition\n2. Extended relevance:\n- Selector.apply marks nodes and potentially ancestors with _needsCssAttribute based on selector matching', relative_path='src/css/Selector.ts', start_line=34, end_line=38), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs css attribute matching helpers\n2. Extended relevance:\n- These operators and attributeMatches function implement attribute selector matching used when determining CSS applicability', relative_path='src/css/Selector.ts', start_line=183, end_line=212), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs the CSS scoping attribute being set decision during stylesheet apply\n2. Extended relevance:\n- Stylesheet.apply marks top-level nodes or matched nodes with _needsCssAttribute; also shows id used for scoping', relative_path='src/css/Stylesheet.ts', start_line=218, end_line=219), ContextOutput(reasoning='1. Query requirement analysis:\n- Continues CSS scoping attribute decision path in DOM/SSR\n2. Extended relevance:\n- Shows apply method marking nodes and behavior when cascade is true', relative_path='src/css/Stylesheet.ts', start_line=266, end_line=278), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs SSR preprocess integration where CSS scoping attribute marking happens\n2. Extended relevance:\n- SSR preprocess calls stylesheet.apply to flag nodes before SSR render', relative_path='src/generators/server-side-rendering/preprocess.ts', start_line=63, end_line=66), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs SSR visitor where the scoping attribute is emitted into HTML\n2. Extended relevance:\n- Adds the scoping attribute (stylesheet id) to opening tag when node._needsCssAttribute is true', relative_path='src/generators/server-side-rendering/visitors/Element.ts', start_line=59, end_line=62), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs SSR index/preprocess overview\n2. Extended relevance:\n- Shows that SSR generator runs preprocess and warns on unused selectors, establishing pipeline before visiting nodes', relative_path='src/generators/server-side-rendering/index.ts', start_line=30, end_line=33), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs README documentation sections on CSS scoping and options\n2. Extended relevance:\n- The cascade option description explains CSS scoping behavior; combined with css option controlling style injection', relative_path='README.md', start_line=80, end_line=85), ContextOutput(reasoning='1. Query requirement analysis:\n- Needs Node/Element interface showing element structure in AST\n2. Extended relevance:\n- This snippet shows how Element nodes are constructed with attributes and children, providing context for where Ref attributes live', relative_path='src/parse/state/tag.ts', start_line=173, end_line=181)]
2025-11-10 23:46:59,454 - thread-133013312636608.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 15 contexts to memory for query: Please provide the implementations and docs that handle Ref directives and CSS scoping: the Generator/Block classes, DOM Element visitor/runtime ref mapping, SSR index/preprocess, Node/Element interfaces, css attribute matching helpers, and README sections on refs/CSS.
2025-11-10 23:47:00,444 - thread-133013312636608.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-10 23:47:00,445 - thread-133013312636608.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - DEBUG - Graph recursion limit reached, returning empty context
2025-11-10 23:47:00,445 - thread-133013312636608.prometheus.lang_graph.nodes.issue_feature_subgraph_node - CRITICAL - Please increase the recursion limit of IssueFeatureSubgraph
2025-11-10 23:47:00,499 - thread-133013312636608.prometheus.docker.base_container - INFO - Cleaning up container and temporary files
2025-11-10 23:47:00,499 - thread-133013312636608.prometheus.docker.base_container - INFO - Closing persistent shell...
2025-11-10 23:47:00,600 - thread-133013312636608.prometheus.docker.base_container - INFO - Cleaning up container and temporary files
