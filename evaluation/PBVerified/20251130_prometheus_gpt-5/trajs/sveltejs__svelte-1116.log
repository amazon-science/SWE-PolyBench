2025-11-12 13:27:33,877 - thread-135845298308800.prometheus.docker.base_container - INFO - Created temporary project directory: /tmp/tmp8sqrt0dl/svelte
2025-11-12 13:27:33,877 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Using workdir: /testbed
2025-11-12 13:27:34,324 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_build: False
2025-11-12 13:27:34,324 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_existing_test: False
2025-11-12 13:27:34,324 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_regression_test: True
2025-11-12 13:27:34,324 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_reproduce_test: True
2025-11-12 13:27:34,324 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State number_of_candidate_patch: 5
2025-11-12 13:27:34,325 - thread-135845298308800.prometheus.lang_graph.nodes.issue_classification_subgraph_node - INFO - Enter IssueClassificationSubgraphNode
2025-11-12 13:27:34,325 - thread-135845298308800.prometheus.lang_graph.nodes.issue_classification_context_message_node - DEBUG - Sending query to context provider:
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

2025-11-12 13:27:34,326 - thread-135845298308800.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-12 13:27:34,327 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 13:27:59,040 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The file tree is available but no source code is provided. To classify whether this is a bug (SSR passing parent store without initialization for nested components), I need to inspect the server-side rendering code that generates nested component calls and store handling. Critical implementations like the SSR Component visitor, SSR entry/index, Block generation, and store interfaces are missing, as are any tests validating SSR with stores. The task requires self-contained context with full implementations and line numbers.' query='Please provide the full contents with line numbers of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/interfaces.ts, src/generators/nodes/Component.ts, src/server-side-rendering/register.js, and store.js.' extra_requirements='If sending all files is too large, include at minimum the functions that generate SSR nested component rendering and store initialization, and the test harness at test/server-side-rendering/index.js; if no SSR store tests exist, please confirm.' purpose='To verify how SSR handles store initialization for nested components, determine if the behavior is inconsistent with the client renderer, and accurately classify the issue.'
2025-11-12 13:27:59,042 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents with line numbers of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/interfaces.ts, src/generators/nodes/Component.ts, src/server-side-rendering/register.js, and store.js.
2025-11-12 13:27:59,699 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 13:27:59,699 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 13:27:59,699 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 13:27:59,699 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 13:27:59,700 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 13:27:59,701 - thread-135845298308800.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 13:27:59,701 - thread-135845298308800.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents with line numbers of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/interfaces.ts, src/generators/nodes/Component.ts, src/server-side-rendering/register.js, and store.js.
Extra requirements: If sending all files is too large, include at minimum the functions that generate SSR nested component rendering and store initialization, and the test harness at test/server-side-rendering/index.js; if no SSR store tests exist, please confirm.
Purpose: To verify how SSR handles store initialization for nested components, determine if the behavior is inconsistent with the client renderer, and accurately classify the issue.
2025-11-12 13:28:04,023 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_sWMMMzlHFFZO9HkxQ9M0fs4s', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/Component.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 427, 'prompt_tokens': 2259, 'total_tokens': 2686, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cb052f97-5565-4d17-a9a4-53a59e8413c0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/Component.ts'}, 'id': 'call_sWMMMzlHFFZO9HkxQ9M0fs4s', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2259, 'output_tokens': 427, 'total_tokens': 2686, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 13:28:08,159 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xAG1pyOorhm0NGC4RIOXkD8A', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 295, 'prompt_tokens': 3794, 'total_tokens': 4089, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c2417eb5-42e6-43fc-aaf8-78a6fa237d24-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts'}, 'id': 'call_xAG1pyOorhm0NGC4RIOXkD8A', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3794, 'output_tokens': 295, 'total_tokens': 4089, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 13:28:09,586 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_eIGXB3C5gPIqrlI6EXYjUKwy', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/Block.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 7177, 'total_tokens': 7211, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5d9877ec-5f9c-4fd0-b053-aeeb7e1b5938-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/server-side-rendering/Block.ts'}, 'id': 'call_eIGXB3C5gPIqrlI6EXYjUKwy', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7177, 'output_tokens': 34, 'total_tokens': 7211, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:28:10,928 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1LqVRuwFiMxwbMQ7Y6aBWYus', 'function': {'arguments': '{"relative_path":"src/interfaces.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 7828, 'total_tokens': 7854, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6cf09e03-b494-4423-a218-a4117b2ebe81-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/interfaces.ts'}, 'id': 'call_1LqVRuwFiMxwbMQ7Y6aBWYus', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7828, 'output_tokens': 26, 'total_tokens': 7854, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:28:13,009 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_EImXVokWkEOwK2EDtYDVN3nN', 'function': {'arguments': '{"relative_path":"src/generators/nodes/Component.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 8779, 'total_tokens': 8811, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--085877b4-dcb9-4418-a194-4f11bd2c6aaf-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/nodes/Component.ts'}, 'id': 'call_EImXVokWkEOwK2EDtYDVN3nN', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8779, 'output_tokens': 32, 'total_tokens': 8811, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:28:14,651 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_RriuGjPwaUXQlJpJzxkr1ZC1', 'function': {'arguments': '{"relative_path":"src/generators/nodes/Component.ts"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 15577, 'total_tokens': 15609, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 7808}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--516011fe-ad48-4f20-b206-291377d7241c-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/generators/nodes/Component.ts'}, 'id': 'call_RriuGjPwaUXQlJpJzxkr1ZC1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15577, 'output_tokens': 32, 'total_tokens': 15609, 'input_token_details': {'audio': 0, 'cache_read': 7808}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:28:28,231 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6qwibs0CGg3AWx07T2Dhphc6', 'function': {'arguments': '{"relative_path":"src/generators/nodes/Component.ts","start_line":1,"end_line":2000}', 'name': 'read_code_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1199, 'prompt_tokens': 22375, 'total_tokens': 23574, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1152, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--561c0064-8ea3-4209-aafa-49ed9288077e-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'src/generators/nodes/Component.ts', 'start_line': 1, 'end_line': 2000}, 'id': 'call_6qwibs0CGg3AWx07T2Dhphc6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 22375, 'output_tokens': 1199, 'total_tokens': 23574, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1152}}
2025-11-12 13:28:34,969 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_LgfxOOKXjInvNuNEFkqyG5gF', 'function': {'arguments': '{"relative_path":"src/server-side-rendering/register.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 484, 'prompt_tokens': 30543, 'total_tokens': 31027, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 22272}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--753661f8-835c-44e0-b1db-6a7ea1670d0b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'src/server-side-rendering/register.js'}, 'id': 'call_LgfxOOKXjInvNuNEFkqyG5gF', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30543, 'output_tokens': 484, 'total_tokens': 31027, 'input_token_details': {'audio': 0, 'cache_read': 22272}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-12 13:28:37,217 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_QJRoTWMeoVLRRZjdRFDzdYH8', 'function': {'arguments': '{"relative_path":"store.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 31111, 'total_tokens': 31135, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0392c731-361f-42bb-8d9a-f7918c128f19-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'store.js'}, 'id': 'call_QJRoTWMeoVLRRZjdRFDzdYH8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31111, 'output_tokens': 24, 'total_tokens': 31135, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:28:39,467 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3pKD8yhm2CTGlADumLuUVbdD', 'function': {'arguments': '{"relative_path":"store.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 31179, 'total_tokens': 31204, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3d93c6df-1d5d-41f9-a811-9cd6a28ff38b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'store.js'}, 'id': 'call_3pKD8yhm2CTGlADumLuUVbdD', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31179, 'output_tokens': 25, 'total_tokens': 31204, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:28:41,078 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_CMTU3ZFoP3NWW8gqilnrIVAR', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/index.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 33128, 'total_tokens': 33157, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 31104}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ded505d5-d66f-4dde-83c7-174f13c40fc7-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/index.js'}, 'id': 'call_CMTU3ZFoP3NWW8gqilnrIVAR', 'type': 'tool_call'}] usage_metadata={'input_tokens': 33128, 'output_tokens': 29, 'total_tokens': 33157, 'input_token_details': {'audio': 0, 'cache_read': 31104}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:28:43,139 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_tlw0f88pU0EAFPAg0fpSySa1', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 33206, 'total_tokens': 33236, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 8704}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9fd03953-9129-41c9-9798-e9d6677df0e7-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/index.js'}, 'id': 'call_tlw0f88pU0EAFPAg0fpSySa1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 33206, 'output_tokens': 30, 'total_tokens': 33236, 'input_token_details': {'audio': 0, 'cache_read': 8704}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:29:02,869 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I fetched the full contents with line numbers for all requested files: the SSR Component visitor, SSR generator index, SSR Block, interfaces, the DOM Component generator, SSR register, store.js, and the SSR test harness. I specifically located the SSR nested component rendering in src/generators/server-side-rendering/visitors/Component.ts and the store initialization logic in src/generators/server-side-rendering/index.ts and store.js. I also retrieved test/server-side-rendering/index.js, which shows SSR tests running with store support (it calls ssr/register with store: true and handles store in duplicated runtime samples), so SSR store tests do exist. This provides the necessary context to compare SSR store initialization behavior with the client renderer for nested components.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1440, 'prompt_tokens': 34998, 'total_tokens': 36438, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1280, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--50f8f0b8-be2a-40ec-b6ff-7dad079f82e7-0' usage_metadata={'input_tokens': 34998, 'output_tokens': 1440, 'total_tokens': 36438, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1280}}
2025-11-12 13:29:02,873 - thread-135845298308800.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents with line numbers of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/interfaces.ts, src/generators/nodes/Component.ts, src/server-side-rendering/register.js, and store.js.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending all files is too large, include at minimum the functions that generate SSR nested component rendering and store initialization, and the test harness at test/server-side-rendering/index.js; if no SSR store tests exist, please confirm.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
To verify how SSR handles store initialization for nested components, determine if the behavior is inconsistent with the client renderer, and accurately classify the issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: src/generators/nodes/Component.ts
Line number range: 1 - 2000
Content:
1. import deindent from '../../utils/deindent';
2. import { stringify } from '../../utils/stringify';
3. import stringifyProps from '../../utils/stringifyProps';
4. import CodeBuilder from '../../utils/CodeBuilder';
5. import getTailSnippet from '../../utils/getTailSnippet';
6. import getObject from '../../utils/getObject';
7. import getExpressionPrecedence from '../../utils/getExpressionPrecedence';
8. import Node from './shared/Node';
9. import Block from '../dom/Block';
10. import Attribute from './Attribute';
11. 
12. export default class Component extends Node {
13. 	type: 'Component';
14. 	name: string;
15. 	attributes: Attribute[];
16. 	children: Node[];
17. 
18. 	init(
19. 		block: Block,
20. 		stripWhitespace: boolean,
21. 		nextSibling: Node
22. 	) {
23. 		this.cannotUseInnerHTML();
24. 
25. 		this.attributes.forEach((attribute: Node) => {
26. 			if (attribute.type === 'Attribute' && attribute.value !== true) {
27. 				attribute.value.forEach((chunk: Node) => {
28. 					if (chunk.type !== 'Text') {
29. 						const dependencies = chunk.metadata.dependencies;
30. 						block.addDependencies(dependencies);
31. 					}
32. 				});
33. 			} else {
34. 				if (attribute.type === 'EventHandler' && attribute.expression) {
35. 					attribute.expression.arguments.forEach((arg: Node) => {
36. 						block.addDependencies(arg.metadata.dependencies);
37. 					});
38. 				} else if (attribute.type === 'Binding') {
39. 					block.addDependencies(attribute.metadata.dependencies);
40. 				}
41. 			}
42. 		});
43. 
44. 		this.var = block.getUniqueName(
45. 			(
46. 				this.name === ':Self' ? this.generator.name :
47. 				this.name === ':Component' ? 'switch_instance' :
48. 				this.name
49. 			).toLowerCase()
50. 		);
51. 
52. 		if (this.children.length) {
53. 			this._slots = new Set(['default']);
54. 
55. 			this.children.forEach(child => {
56. 				child.init(block, stripWhitespace, nextSibling);
57. 			});
58. 		}
59. 	}
60. 
61. 	build(
62. 		block: Block,
63. 		parentNode: string,
64. 		parentNodes: string
65. 	) {
66. 		const { generator } = this;
67. 		generator.hasComponents = true;
68. 
69. 		const name = this.var;
70. 
71. 		const componentInitProperties = [`root: #component.root`];
72. 
73. 		if (this.children.length > 0) {
74. 			const slots = Array.from(this._slots).map(name => `${name}: @createFragment()`);
75. 			componentInitProperties.push(`slots: { ${slots.join(', ')} }`);
76. 
77. 			this.children.forEach((child: Node) => {
78. 				child.build(block, `${this.var}._slotted.default`, 'nodes');
79. 			});
80. 		}
81. 
82. 		const allContexts = new Set();
83. 		const statements: string[] = [];
84. 		const name_context = block.getUniqueName(`${name}_context`);
85. 
86. 		let name_updating: string;
87. 		let name_initial_data: string;
88. 		let beforecreate: string = null;
89. 
90. 		const attributes = this.attributes
91. 			.filter(a => a.type === 'Attribute')
92. 			.map(a => mungeAttribute(a, block));
93. 
94. 		const bindings = this.attributes
95. 			.filter(a => a.type === 'Binding')
96. 			.map(a => mungeBinding(a, block));
97. 
98. 		const eventHandlers = this.attributes
99. 			.filter((a: Node) => a.type === 'EventHandler')
100. 			.map(a => mungeEventHandler(generator, this, a, block, name_context, allContexts));
101. 
102. 		const ref = this.attributes.find((a: Node) => a.type === 'Ref');
103. 		if (ref) generator.usesRefs = true;
104. 
105. 		const updates: string[] = [];
106. 
107. 		if (attributes.length || bindings.length) {
108. 			const initialProps = attributes
109. 				.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);
110. 
111. 			const initialPropString = stringifyProps(initialProps);
112. 
113. 			attributes
114. 				.filter((attribute: Attribute) => attribute.dynamic)
115. 				.forEach((attribute: Attribute) => {
116. 					if (attribute.dependencies.length) {
117. 						updates.push(deindent`
118. 							if (${attribute.dependencies
119. 								.map(dependency => `changed.${dependency}`)
120. 								.join(' || ')}) ${name}_changes.${attribute.name} = ${attribute.value};
121. 						`);
122. 					}
123. 
124. 					else {
125. 						// TODO this is an odd situation to encounter – I *think* it should only happen with
126. 						// each block indices, in which case it may be possible to optimise this
127. 						updates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);
128. 					}
129. 				});
130. 
131. 			if (bindings.length) {
132. 				generator.hasComplexBindings = true;
133. 
134. 				name_updating = block.alias(`${name}_updating`);
135. 				name_initial_data = block.getUniqueName(`${name}_initial_data`);
136. 
137. 				block.addVariable(name_updating, '{}');
138. 				statements.push(`var ${name_initial_data} = ${initialPropString};`);
139. 
140. 				const setParentFromChildOnChange = new CodeBuilder();
141. 				const setParentFromChildOnInit = new CodeBuilder();
142. 
143. 				bindings.forEach((binding: Binding) => {
144. 					let setParentFromChild;
145. 
146. 					binding.contexts.forEach(context => {
147. 						allContexts.add(context);
148. 					});
149. 
150. 					const { name: key } = getObject(binding.value);
151. 
152. 					if (block.contexts.has(key)) {
153. 						const prop = binding.dependencies[0];
154. 						const computed = isComputed(binding.value);
155. 						const tail = binding.value.type === 'MemberExpression' ? getTailSnippet(binding.value) : '';
156. 
157. 						setParentFromChild = deindent`
158. 							var list = ${name_context}.${block.listNames.get(key)};
159. 							var index = ${name_context}.${block.indexNames.get(key)};
160. 							list[index]${tail} = childState.${binding.name};
161. 
162. 							${binding.dependencies
163. 								.map((prop: string) => `newState.${prop} = state.${prop};`)
164. 								.join('\n')}
165. 						`;
166. 					}
167. 
168. 					else if (binding.value.type === 'MemberExpression') {
169. 						setParentFromChild = deindent`
170. 							${binding.snippet} = childState.${binding.name};
171. 							${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join('\n')}
172. 						`;
173. 					}
174. 
175. 					else {
176. 						setParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;
177. 					}
178. 
179. 					statements.push(deindent`
180. 						if (${binding.prop} in ${binding.obj}) {
181. 							${name_initial_data}.${binding.name} = ${binding.snippet};
182. 							${name_updating}.${binding.name} = true;
183. 						}`
184. 					);
185. 
186. 					setParentFromChildOnChange.addConditional(
187. 						`!${name_updating}.${binding.name} && changed.${binding.name}`,
188. 						setParentFromChild
189. 					);
190. 
191. 					setParentFromChildOnInit.addConditional(
192. 						`!${name_updating}.${binding.name}`,
193. 						setParentFromChild
194. 					);
195. 
196. 					// TODO could binding.dependencies.length ever be 0?
197. 					if (binding.dependencies.length) {
198. 						updates.push(deindent`
199. 							if (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(' || ')}) {
200. 								${name}_changes.${binding.name} = ${binding.snippet};
201. 								${name_updating}.${binding.name} = true;
202. 							}
203. 						`);
204. 					}
205. 				});
206. 
207. 				componentInitProperties.push(`data: ${name_initial_data}`);
208. 
209. 				componentInitProperties.push(deindent`
210. 					_bind: function(changed, childState) {
211. 						var state = #component.get(), newState = {};
212. 						${setParentFromChildOnChange}
213. 						${name_updating} = @assign({}, changed);
214. 						#component._set(newState);
215. 						${name_updating} = {};
216. 					}
217. 				`);
218. 
219. 				beforecreate = deindent`
220. 					#component.root._beforecreate.push(function() {
221. 						var state = #component.get(), childState = ${name}.get(), newState = {};
222. 						if (!childState) return;
223. 						${setParentFromChildOnInit}
224. 						${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(', ')} };
225. 						#component._set(newState);
226. 						${name_updating} = {};
227. 					});
228. 				`;
229. 			} else if (initialProps.length) {
230. 				componentInitProperties.push(`data: ${initialPropString}`);
231. 			}
232. 		}
233. 
234. 		const isDynamicComponent = this.name === ':Component';
235. 
236. 		const switch_vars = isDynamicComponent && {
237. 			value: block.getUniqueName('switch_value'),
238. 			props: block.getUniqueName('switch_props')
239. 		};
240. 
241. 		const expression = (
242. 			this.name === ':Self' ? generator.name :
243. 			isDynamicComponent ? switch_vars.value :
244. 			`%components-${this.name}`
245. 		);
246. 
247. 		if (isDynamicComponent) {
248. 			block.contextualise(this.expression);
249. 			const { dependencies, snippet } = this.metadata;
250. 
251. 			const anchor = this.getOrCreateAnchor(block, parentNode, parentNodes);
252. 
253. 			const params = block.params.join(', ');
254. 
255. 			block.builders.init.addBlock(deindent`
256. 				var ${switch_vars.value} = ${snippet};
257. 
258. 				function ${switch_vars.props}(${params}) {
259. 					${statements.length > 0 && statements.join('\n')}
260. 					return {
261. 						${componentInitProperties.join(',\n')}
262. 					};
263. 				}
264. 
265. 				if (${switch_vars.value}) {
266. 					var ${name} = new ${expression}(${switch_vars.props}(${params}));
267. 
268. 					${beforecreate}
269. 				}
270. 
271. 				${eventHandlers.map(handler => deindent`
272. 					function ${handler.var}(event) {
273. 						${handler.body}
274. 					}
275. 
276. 					if (${name}) ${name}.on("${handler.name}", ${handler.var});
277. 				`)}
278. 			`);
279. 
280. 			block.builders.create.addLine(
281. 				`if (${name}) ${name}._fragment.c();`
282. 			);
283. 
284. 			if (parentNodes) {
285. 				block.builders.claim.addLine(
286. 					`if (${name}) ${name}._fragment.l(${parentNodes});`
287. 				);
288. 			}
289. 
290. 			block.builders.mount.addLine(
291. 				`if (${name}) ${name}._mount(${parentNode || '#target'}, ${parentNode ? 'null' : 'anchor'});`
292. 			);
293. 
294. 			const updateMountNode = this.getUpdateMountNode(anchor);
295. 
296. 			block.builders.update.addBlock(deindent`
297. 				if (${switch_vars.value} !== (${switch_vars.value} = ${snippet})) {
298. 					if (${name}) ${name}.destroy();
299. 
300. 					if (${switch_vars.value}) {
301. 						${name} = new ${switch_vars.value}(${switch_vars.props}(${params}));
302. 						${name}._fragment.c();
303. 
304. 						${this.children.map(child => remount(generator, child, name))}
305. 						${name}._mount(${updateMountNode}, ${anchor});
306. 
307. 						${eventHandlers.map(handler => deindent`
308. 							${name}.on("${handler.name}", ${handler.var});
309. 						`)}
310. 
311. 						${ref && `#component.refs.${ref.name} = ${name};`}
312. 					}
313. 
314. 					${ref && deindent`
315. 						else if (#component.refs.${ref.name} === ${name}) {
316. 							#component.refs.${ref.name} = null;
317. 						}`}
318. 				}
319. 			`);
320. 
321. 			if (updates.length) {
322. 				block.builders.update.addBlock(deindent`
323. 					else {
324. 						var ${name}_changes = {};
325. 						${updates.join('\n')}
326. 						${name}._set(${name}_changes);
327. 						${bindings.length && `${name_updating} = {};`}
328. 					}
329. 				`);
330. 			}
331. 
332. 			if (!parentNode) block.builders.unmount.addLine(`if (${name}) ${name}._unmount();`);
333. 
334. 			block.builders.destroy.addLine(`if (${name}) ${name}.destroy(false);`);
335. 		} else {
336. 			block.builders.init.addBlock(deindent`
337. 				${statements.join('\n')}
338. 				var ${name} = new ${expression}({
339. 					${componentInitProperties.join(',\n')}
340. 				});
341. 
342. 				${beforecreate}
343. 
344. 				${eventHandlers.map(handler => deindent`
345. 					${name}.on("${handler.name}", function(event) {
346. 						${handler.body}
347. 					});
348. 				`)}
349. 
350. 				${ref && `#component.refs.${ref.name} = ${name};`}
351. 			`);
352. 
353. 			block.builders.create.addLine(`${name}._fragment.c();`);
354. 
355. 			if (parentNodes) {
356. 				block.builders.claim.addLine(
357. 					`${name}._fragment.l(${parentNodes});`
358. 				);
359. 			}
360. 
361. 			block.builders.mount.addLine(
362. 				`${name}._mount(${parentNode || '#target'}, ${parentNode ? 'null' : 'anchor'});`
363. 			);
364. 
365. 			if (updates.length) {
366. 				block.builders.update.addBlock(deindent`
367. 					var ${name}_changes = {};
368. 					${updates.join('\n')}
369. 					${name}._set(${name}_changes);
370. 					${bindings.length && `${name_updating} = {};`}
371. 				`);
372. 			}
373. 
374. 			if (!parentNode) block.builders.unmount.addLine(`${name}._unmount();`);
375. 
376. 			block.builders.destroy.addLine(deindent`
377. 				${name}.destroy(false);
378. 				${ref && `if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;`}
379. 			`);
380. 		}
381. 
382. 		// maintain component context
383. 		if (allContexts.size) {
384. 			const contexts = Array.from(allContexts);
385. 
386. 			const initialProps = contexts
387. 				.map(contextName => {
388. 					if (contextName === 'state') return `state: state`;
389. 
390. 					const listName = block.listNames.get(contextName);
391. 					const indexName = block.indexNames.get(contextName);
392. 
393. 					return `${listName}: ${listName},\n${indexName}: ${indexName}`;
394. 				})
395. 				.join(',\n');
396. 
397. 			const updates = contexts
398. 				.map(contextName => {
399. 					if (contextName === 'state') return `${name_context}.state = state;`;
400. 
401. 					const listName = block.listNames.get(contextName);
402. 					const indexName = block.indexNames.get(contextName);
403. 
404. 					return `${name_context}.${listName} = ${listName};\n${name_context}.${indexName} = ${indexName};`;
405. 				})
406. 				.join('\n');
407. 
408. 			block.builders.init.addBlock(deindent`
409. 				var ${name_context} = {
410. 					${initialProps}
411. 				};
412. 			`);
413. 
414. 			block.builders.update.addBlock(updates);
415. 		}
416. 	}
417. }
418. 
419. function mungeAttribute(attribute: Node, block: Block): Attribute {
420. 	if (attribute.value === true) {
421. 		// attributes without values, e.g. <textarea readonly>
422. 		return {
423. 			name: attribute.name,
424. 			value: true,
425. 			dynamic: false
426. 		};
427. 	}
428. 
429. 	if (attribute.value.length === 0) {
430. 		return {
431. 			name: attribute.name,
432. 			value: `''`,
433. 			dynamic: false
434. 		};
435. 	}
436. 
437. 	if (attribute.value.length === 1) {
438. 		const value = attribute.value[0];
439. 
440. 		if (value.type === 'Text') {
441. 			// static attributes
442. 			return {
443. 				name: attribute.name,
444. 				value: isNaN(value.data) ? stringify(value.data) : value.data,
445. 				dynamic: false
446. 			};
447. 		}
448. 
449. 		// simple dynamic attributes
450. 		block.contextualise(value.expression); // TODO remove
451. 		const { dependencies, snippet } = value.metadata;
452. 
453. 		// TODO only update attributes that have changed
454. 		return {
455. 			name: attribute.name,
456. 			value: snippet,
457. 			dependencies,
458. 			dynamic: true
459. 		};
460. 	}
461. 
462. 	// otherwise we're dealing with a complex dynamic attribute
463. 	const allDependencies = new Set();
464. 
465. 	const value =
466. 		(attribute.value[0].type === 'Text' ? '' : `"" + `) +
467. 		attribute.value
468. 			.map((chunk: Node) => {
469. 				if (chunk.type === 'Text') {
470. 					return stringify(chunk.data);
471. 				} else {
472. 					block.contextualise(chunk.expression); // TODO remove
473. 					const { dependencies, snippet } = chunk.metadata;
474. 
475. 					dependencies.forEach((dependency: string) => {
476. 						allDependencies.add(dependency);
477. 					});
478. 
479. 					return getExpressionPrecedence(chunk.expression) <= 13 ? `(${snippet})` : snippet;
480. 				}
481. 			})
482. 			.join(' + ');
483. 
484. 	return {
485. 		name: attribute.name,
486. 		value,
487. 		dependencies: Array.from(allDependencies),
488. 		dynamic: true
489. 	};
490. }
491. 
492. function mungeBinding(binding: Node, block: Block): Binding {
493. 	const { name } = getObject(binding.value);
494. 	const { contexts } = block.contextualise(binding.value);
495. 	const { dependencies, snippet } = binding.metadata;
496. 
497. 	const contextual = block.contexts.has(name);
498. 
499. 	let obj;
500. 	let prop;
501. 
502. 	if (contextual) {
503. 		obj = block.listNames.get(name);
504. 		prop = block.indexNames.get(name);
505. 	} else if (binding.value.type === 'MemberExpression') {
506. 		prop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;
507. 		if (!binding.value.computed) prop = `'${prop}'`;
508. 		obj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;
509. 	} else {
510. 		obj = 'state';
511. 		prop = `'${name}'`;
512. 	}
513. 
514. 	return {
515. 		name: binding.name,
516. 		value: binding.value,
517. 		contexts,
518. 		snippet,
519. 		obj,
520. 		prop,
521. 		dependencies
522. 	};
523. }
524. 
525. function mungeEventHandler(generator: DomGenerator, node: Node, handler: Node, block: Block, name_context: string, allContexts: Set<string>) {
526. 	let body;
527. 
528. 	if (handler.expression) {
529. 		generator.addSourcemapLocations(handler.expression);
530. 		generator.code.prependRight(
531. 			handler.expression.start,
532. 			`${block.alias('component')}.`
533. 		);
534. 
535. 		const usedContexts: string[] = [];
536. 
537. 		handler.expression.arguments.forEach((arg: Node) => {
538. 			const { contexts } = block.contextualise(arg, null, true);
539. 
540. 			contexts.forEach(context => {
541. 				if (!~usedContexts.indexOf(context)) usedContexts.push(context);
542. 				allContexts.add(context);
543. 			});
544. 		});
545. 
546. 		// TODO hoist event handlers? can do `this.__component.method(...)`
547. 		const declarations = usedContexts.map(name => {
548. 			if (name === 'state') return `var state = ${name_context}.state;`;
549. 
550. 			const listName = block.listNames.get(name);
551. 			const indexName = block.indexNames.get(name);
552. 
553. 			return `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;
554. 		});
555. 
556. 		body = deindent`
557. 			${declarations}
558. 
559. 			[✂${handler.expression.start}-${handler.expression.end}✂];
560. 		`;
561. 	} else {
562. 		body = deindent`
563. 			${block.alias('component')}.fire('${handler.name}', event);
564. 		`;
565. 	}
566. 
567. 	return {
568. 		name: handler.name,
569. 		var: block.getUniqueName(`${node.var}_${handler.name}`),
570. 		body
571. 	};
572. }
573. 
574. function isComputed(node: Node) {
575. 	while (node.type === 'MemberExpression') {
576. 		if (node.computed) return true;
577. 		node = node.object;
578. 	}
579. 
580. 	return false;
581. }
582. 
583. function remount(generator: DomGenerator, node: Node, name: string) {
584. 	// TODO make this a method of the nodes
585. 
586. 	if (node.type === 'Component') {
587. 		return `${node.var}._mount(${name}._slotted.default, null);`;
588. 	}
589. 
590. 	if (node.type === 'Element') {
591. 		const slot = node.attributes.find(attribute => attribute.name === 'slot');
592. 		if (slot) {
593. 			return `@appendNode(${node.var}, ${name}._slotted.${node.getStaticAttributeValue('slot')});`;
594. 		}
595. 
596. 		return `@appendNode(${node.var}, ${name}._slotted.default);`;
597. 	}
598. 
599. 	if (node.type === 'Text' || node.type === 'MustacheTag' || node.type === 'RawMustacheTag') {
600. 		return `@appendNode(${node.var}, ${name}._slotted.default);`;
601. 	}
602. 
603. 	if (node.type === 'EachBlock') {
604. 		// TODO consider keyed blocks
605. 		return `for (var #i = 0; #i < ${node.iterations}.length; #i += 1) ${node.iterations}[#i].m(${name}._slotted.default, null);`;
606. 	}
607. 
608. 	return `${node.var}.m(${name}._slotted.default, null);`;
609. }


File: src/generators/server-side-rendering/Block.ts
Line number range: 1 - 49
Content:
1. import deindent from '../../utils/deindent';
2. import flattenReference from '../../utils/flattenReference';
3. import { SsrGenerator } from './index';
4. import { Node } from '../../interfaces';
5. import getObject from '../../utils/getObject';
6. 
7. interface BlockOptions {
8. 	// TODO
9. }
10. 
11. export default class Block {
12. 	generator: SsrGenerator;
13. 	conditions: string[];
14. 
15. 	contexts: Map<string, string>;
16. 	indexes: Map<string, string>;
17. 	contextDependencies: Map<string, string[]>;
18. 
19. 	constructor(options: BlockOptions) {
20. 		Object.assign(this, options);
21. 	}
22. 
23. 	addBinding(binding: Node, name: string) {
24. 		const conditions = [`!('${binding.name}' in state)`].concat(
25. 			// TODO handle contextual bindings...
26. 			this.conditions.map(c => `(${c})`)
27. 		);
28. 
29. 		const { name: prop } = getObject(binding.value);
30. 
31. 		this.generator.bindings.push(deindent`
32. 			if (${conditions.join('&&')}) {
33. 				tmp = ${name}.data();
34. 				if ('${prop}' in tmp) {
35. 					state.${binding.name} = tmp.${prop};
36. 					settled = false;
37. 				}
38. 			}
39. 		`);
40. 	}
41. 
42. 	child(options: BlockOptions) {
43. 		return new Block(Object.assign({}, this, options, { parent: this }));
44. 	}
45. 
46. 	contextualise(expression: Node, context?: string, isEventHandler?: boolean) {
47. 		return this.generator.contextualise(this.contexts, this.indexes, expression, context, isEventHandler);
48. 	}
49. }


File: src/generators/server-side-rendering/index.ts
Line number range: 1 - 268
Content:
1. import deindent from '../../utils/deindent';
2. import Generator from '../Generator';
3. import Stylesheet from '../../css/Stylesheet';
4. import Block from './Block';
5. import visit from './visit';
6. import { removeNode, removeObjectKey } from '../../utils/removeNode';
7. import getName from '../../utils/getName';
8. import globalWhitelist from '../../utils/globalWhitelist';
9. import { Parsed, Node, CompileOptions } from '../../interfaces';
10. import { AppendTarget } from './interfaces';
11. import { stringify } from '../../utils/stringify';
12. 
13. export class SsrGenerator extends Generator {
14. 	bindings: string[];
15. 	renderCode: string;
16. 	appendTargets: AppendTarget[];
17. 
18. 	constructor(
19. 		parsed: Parsed,
20. 		source: string,
21. 		name: string,
22. 		stylesheet: Stylesheet,
23. 		options: CompileOptions
24. 	) {
25. 		super(parsed, source, name, stylesheet, options, false);
26. 		this.bindings = [];
27. 		this.renderCode = '';
28. 		this.appendTargets = [];
29. 
30. 		this.stylesheet.warnOnUnusedSelectors(options.onwarn);
31. 	}
32. 
33. 	append(code: string) {
34. 		if (this.appendTargets.length) {
35. 			const appendTarget = this.appendTargets[this.appendTargets.length - 1];
36. 			const slotName = appendTarget.slotStack[appendTarget.slotStack.length - 1];
37. 			appendTarget.slots[slotName] += code;
38. 		} else {
39. 			this.renderCode += code;
40. 		}
41. 	}
42. }
43. 
44. export default function ssr(
45. 	parsed: Parsed,
46. 	source: string,
47. 	stylesheet: Stylesheet,
48. 	options: CompileOptions
49. ) {
50. 	const format = options.format || 'cjs';
51. 
52. 	const generator = new SsrGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
53. 
54. 	const { computations, name, templateProperties } = generator;
55. 
56. 	// create main render() function
57. 	const mainBlock = new Block({
58. 		generator,
59. 		contexts: new Map(),
60. 		indexes: new Map(),
61. 		conditions: [],
62. 	});
63. 
64. 	trim(parsed.html.children).forEach((node: Node) => {
65. 		visit(generator, mainBlock, node);
66. 	});
67. 
68. 	const { css, cssMap } = generator.customElement ?
69. 		{ css: null, cssMap: null } :
70. 		generator.stylesheet.render(options.filename, true);
71. 
72. 	// generate initial state object
73. 	const expectedProperties = Array.from(generator.expectedProperties);
74. 	const globals = expectedProperties.filter(prop => globalWhitelist.has(prop));
75. 	const storeProps = options.store || templateProperties.store ? expectedProperties.filter(prop => prop[0] === '$') : [];
76. 
77. 	const initialState = [];
78. 	if (globals.length > 0) {
79. 		initialState.push(`{ ${globals.map(prop => `${prop} : ${prop}`).join(', ')} }`);
80. 	}
81. 
82. 	if (storeProps.length > 0) {
83. 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
84. 		if (options.store || templateProperties.store) {
85. 			initialState.push(`options.store.${initialize}`);
86. 		}
87. 	}
88. 
89. 	if (templateProperties.data) {
90. 		initialState.push(`%data()`);
91. 	} else if (globals.length === 0 && storeProps.length === 0) {
92. 		initialState.push('{}');
93. 	}
94. 
95. 	initialState.push('state');
96. 
97. 	// TODO concatenate CSS maps
98. 	const result = deindent`
99. 		${generator.javascript}
100. 
101. 		var ${name} = {};
102. 
103. 		${options.filename && `${name}.filename = ${stringify(options.filename)}`};
104. 
105. 		${name}.data = function() {
106. 			return ${templateProperties.data ? `%data()` : `{}`};
107. 		};
108. 
109. 		${name}.render = function(state, options = {}) {
110. 			var components = new Set();
111. 
112. 			function addComponent(component) {
113. 				components.add(component);
114. 			}
115. 
116. 			var result = { head: '', addComponent };
117. 			${templateProperties.store && `options.store = %store();`}
118. 			var html = ${name}._render(result, state, options);
119. 
120. 			var cssCode = Array.from(components).map(c => c.css && c.css.code).filter(Boolean).join('\\n');
121. 
122. 			return {
123. 				html,
124. 				head: result.head,
125. 				css: { code: cssCode, map: null },
126. 				toString() {
127. 					return html;
128. 				}
129. 			};
130. 		}
131. 
132. 		${name}._render = function(__result, state, options) {
133. 			__result.addComponent(${name});
134. 
135. 			state = Object.assign(${initialState.join(', ')});
136. 
137. 			${computations.map(
138. 				({ key, deps }) =>
139. 					`state.${key} = %computed-${key}(${deps.map(dep => `state.${dep}`).join(', ')});`
140. 			)}
141. 
142. 			${generator.bindings.length &&
143. 				deindent`
144. 				var settled = false;
145. 				var tmp;
146. 
147. 				while (!settled) {
148. 					settled = true;
149. 
150. 					${generator.bindings.join('\n\n')}
151. 				}
152. 			`}
153. 
154. 			return \`${generator.renderCode}\`;
155. 		};
156. 
157. 		${name}.css = {
158. 			code: ${css ? stringify(css) : `''`},
159. 			map: ${cssMap ? stringify(cssMap.toString()) : 'null'}
160. 		};
161. 
162. 		var warned = false;
163. 		${name}.renderCss = function() {
164. 			if (!warned) {
165. 				console.error('Component.renderCss(...) is deprecated and will be removed in v2 — use Component.render(...).css instead');
166. 				warned = true;
167. 			}
168. 
169. 			var components = [];
170. 
171. 			${generator.stylesheet.hasStyles &&
172. 				deindent`
173. 				components.push({
174. 					filename: ${name}.filename,
175. 					css: ${name}.css && ${name}.css.code,
176. 					map: ${name}.css && ${name}.css.map
177. 				});
178. 			`}
179. 
180. 			${templateProperties.components &&
181. 				deindent`
182. 				var seen = {};
183. 
184. 				function addComponent(component) {
185. 					var result = component.renderCss();
186. 					result.components.forEach(x => {
187. 						if (seen[x.filename]) return;
188. 						seen[x.filename] = true;
189. 						components.push(x);
190. 					});
191. 				}
192. 
193. 				${templateProperties.components.value.properties.map((prop: Node) => {
194. 					return `addComponent(%components-${getName(prop.key)});`;
195. 				})}
196. 			`}
197. 
198. 			return {
199. 				css: components.map(x => x.css).join('\\n'),
200. 				map: null,
201. 				components
202. 			};
203. 		};
204. 
205. 		${templateProperties.preload && `${name}.preload = %preload;`}
206. 
207. 		${
208. 			// TODO this is a bit hacky
209. 			/__escape/.test(generator.renderCode) && deindent`
210. 				var escaped = {
211. 					'"': '&quot;',
212. 					"'": '&##39;',
213. 					'&': '&amp;',
214. 					'<': '&lt;',
215. 					'>': '&gt;'
216. 				};
217. 
218. 				function __escape(html) {
219. 					return String(html).replace(/["'&<>]/g, match => escaped[match]);
220. 				}
221. 			`
222. 		}
223. 
224. 		${
225. 			/__isPromise/.test(generator.renderCode) && deindent`
226. 				function __isPromise(value) {
227. 					return value && typeof value.then === 'function';
228. 				}
229. 			`
230. 		}
231. 
232. 		${
233. 			/__missingComponent/.test(generator.renderCode) && deindent`
234. 				var __missingComponent = {
235. 					_render: () => ''
236. 				};
237. 			`
238. 		}
239. 	`.replace(/(@+|#+|%+)(\w*(?:-\w*)?)/g, (match: string, sigil: string, name: string) => {
240. 		if (sigil === '@') return generator.alias(name);
241. 		if (sigil === '%') return generator.templateVars.get(name);
242. 		return sigil.slice(1) + name;
243. 	});
244. 
245. 	return generator.generate(result, options, { name, format });
246. }
247. 
248. function trim(nodes) {
249. 	let start = 0;
250. 	for (; start < nodes.length; start += 1) {
251. 		const node = nodes[start];
252. 		if (node.type !== 'Text') break;
253. 
254. 		node.data = node.data.replace(/^\s+/, '');
255. 		if (node.data) break;
256. 	}
257. 
258. 	let end = nodes.length;
259. 	for (; end > start; end -= 1) {
260. 		const node = nodes[end - 1];
261. 		if (node.type !== 'Text') break;
262. 
263. 		node.data = node.data.replace(/\s+$/, '');
264. 		if (node.data) break;
265. 	}
266. 
267. 	return nodes.slice(start, end);
268. }


File: src/generators/server-side-rendering/visitors/Component.ts
Line number range: 1 - 121
Content:
1. import flattenReference from '../../../utils/flattenReference';
2. import visit from '../visit';
3. import { SsrGenerator } from '../index';
4. import Block from '../Block';
5. import { AppendTarget } from '../interfaces';
6. import { Node } from '../../../interfaces';
7. import getObject from '../../../utils/getObject';
8. import getTailSnippet from '../../../utils/getTailSnippet';
9. import { stringify } from '../../../utils/stringify';
10. 
11. export default function visitComponent(
12. 	generator: SsrGenerator,
13. 	block: Block,
14. 	node: Node
15. ) {
16. 	function stringifyAttribute(chunk: Node) {
17. 		if (chunk.type === 'Text') return chunk.data;
18. 		if (chunk.type === 'MustacheTag') {
19. 			block.contextualise(chunk.expression);
20. 			const { snippet } = chunk.metadata;
21. 			return '${__escape( ' + snippet + ')}';
22. 		}
23. 	}
24. 
25. 	const attributes: Node[] = [];
26. 	const bindings: Node[] = [];
27. 
28. 	node.attributes.forEach((attribute: Node) => {
29. 		if (attribute.type === 'Attribute') {
30. 			attributes.push(attribute);
31. 		} else if (attribute.type === 'Binding') {
32. 			bindings.push(attribute);
33. 		}
34. 	});
35. 
36. 	const props = attributes
37. 		.map(attribute => {
38. 			let value;
39. 
40. 			if (attribute.value === true) {
41. 				value = `true`;
42. 			} else if (attribute.value.length === 0) {
43. 				value = `''`;
44. 			} else if (attribute.value.length === 1) {
45. 				const chunk = attribute.value[0];
46. 				if (chunk.type === 'Text') {
47. 					value = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;
48. 				} else {
49. 					block.contextualise(chunk.expression);
50. 					const { snippet } = chunk.metadata;
51. 					value = snippet;
52. 				}
53. 			} else {
54. 				value = '`' + attribute.value.map(stringifyAttribute).join('') + '`';
55. 			}
56. 
57. 			return `${attribute.name}: ${value}`;
58. 		})
59. 		.concat(
60. 			bindings.map(binding => {
61. 				const { name } = getObject(binding.value);
62. 				const tail = binding.value.type === 'MemberExpression'
63. 					? getTailSnippet(binding.value)
64. 					: '';
65. 
66. 				const keypath = block.contexts.has(name)
67. 					? `${name}${tail}`
68. 					: `state.${name}${tail}`;
69. 				return `${binding.name}: ${keypath}`;
70. 			})
71. 		)
72. 		.join(', ');
73. 
74. 	const isDynamicComponent = node.name === ':Component';
75. 	if (isDynamicComponent) block.contextualise(node.expression);
76. 
77. 	const expression = (
78. 		node.name === ':Self' ? generator.name :
79. 		isDynamicComponent ? `((${node.metadata.snippet}) || __missingComponent)` :
80. 		`%components-${node.name}`
81. 	);
82. 
83. 	bindings.forEach(binding => {
84. 		block.addBinding(binding, expression);
85. 	});
86. 
87. 	let open = `\${${expression}._render(__result, {${props}}`;
88. 
89. 	const options = [];
90. 	if (generator.options.store) {
91. 		options.push(`store: options.store`);
92. 	}
93. 
94. 	if (node.children.length) {
95. 		const appendTarget: AppendTarget = {
96. 			slots: { default: '' },
97. 			slotStack: ['default']
98. 		};
99. 
100. 		generator.appendTargets.push(appendTarget);
101. 
102. 		node.children.forEach((child: Node) => {
103. 			visit(generator, block, child);
104. 		});
105. 
106. 		const slotted = Object.keys(appendTarget.slots)
107. 			.map(name => `${name}: () => \`${appendTarget.slots[name]}\``)
108. 			.join(', ');
109. 
110. 		options.push(`slotted: { ${slotted} }`);
111. 
112. 		generator.appendTargets.pop();
113. 	}
114. 
115. 	if (options.length) {
116. 		open += `, { ${options.join(', ')} }`;
117. 	}
118. 
119. 	generator.append(open);
120. 	generator.append(')}');
121. }


File: src/interfaces.ts
Line number range: 1 - 92
Content:
1. import {SourceMap} from 'magic-string';
2. 
3. export interface Node {
4. 	start: number;
5. 	end: number;
6. 	type: string;
7. 	[propName: string]: any;
8. }
9. 
10. export interface Parser {
11. 	readonly template: string;
12. 	readonly filename?: string;
13. 
14. 	index: number;
15. 	stack: Array<Node>;
16. 
17. 	html: Node;
18. 	css: Node;
19. 	js: Node;
20. 	metaTags: {};
21. }
22. 
23. export interface Parsed {
24. 	hash: number;
25. 	html: Node;
26. 	css: Node;
27. 	js: Node;
28. }
29. 
30. export interface Warning {
31. 	loc?: { line: number; column: number; pos?: number };
32. 	pos?: number;
33. 	message: string;
34. 	filename?: string;
35. 	frame?: string;
36. 	toString: () => string;
37. }
38. 
39. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';
40. 
41. export interface CompileOptions {
42. 	format?: ModuleFormat;
43. 	name?: string;
44. 	filename?: string;
45. 	generate?: string;
46. 	globals?: ((id: string) => string) | object;
47. 	amd?: {
48. 		id?: string;
49. 	};
50. 
51. 	outputFilename?: string;
52. 	cssOutputFilename?: string;
53. 
54. 	dev?: boolean;
55. 	shared?: boolean | string;
56. 	cascade?: boolean;
57. 	hydratable?: boolean;
58. 	legacy?: boolean;
59. 	customElement?: CustomElementOptions | true;
60. 	css?: boolean;
61. 	store?: boolean;
62. 
63. 	onerror?: (error: Error) => void;
64. 	onwarn?: (warning: Warning) => void;
65. }
66. 
67. export interface GenerateOptions {
68. 	name: string;
69. 	format: ModuleFormat;
70. 	banner?: string;
71. 	sharedPath?: string;
72. 	helpers?: { name: string, alias: string }[];
73. }
74. 
75. export interface Visitor {
76. 	enter: (node: Node) => void;
77. 	leave?: (node: Node) => void;
78. }
79. 
80. export interface CustomElementOptions {
81. 	tag?: string;
82. 	props?: string[];
83. }
84. 
85. export interface PreprocessOptions {
86. 	markup?: (options: {content: string, filename: string}) => { code: string, map?: SourceMap | string };
87. 	style?: Preprocessor;
88. 	script?: Preprocessor;
89. 	filename?: string
90. }
91. 
92. export type Preprocessor = (options: {content: string, attributes: Record<string, string | boolean>, filename?: string}) => { code: string, map?: SourceMap | string };


File: src/server-side-rendering/register.js
Line number range: 1 - 46
Content:
1. import * as fs from 'fs';
2. import * as path from 'path';
3. import { compile } from '../index.ts';
4. 
5. const compileOptions = {};
6. 
7. function capitalise(name) {
8. 	return name[0].toUpperCase() + name.slice(1);
9. }
10. 
11. export default function register(options) {
12. 	const { extensions } = options;
13. 
14. 	if (extensions) {
15. 		_deregister('.html');
16. 		extensions.forEach(_register);
17. 	}
18. 
19. 	// TODO make this the default and remove in v2
20. 	if ('store' in options) compileOptions.store = options.store;
21. }
22. 
23. function _deregister(extension) {
24. 	delete require.extensions[extension];
25. }
26. 
27. function _register(extension) {
28. 	require.extensions[extension] = function(module, filename) {
29. 		const name = path.basename(filename)
30. 			.slice(0, -path.extname(filename).length)
31. 			.replace(/^\d/, '_$&')
32. 			.replace(/[^a-zA-Z0-9_$]/g, '');
33. 
34. 		const options = Object.assign({}, compileOptions, {
35. 			filename,
36. 			name: capitalise(name),
37. 			generate: 'ssr'
38. 		});
39. 
40. 		const {code} = compile(fs.readFileSync(filename, 'utf-8'), options);
41. 
42. 		return module._compile(code, filename);
43. 	};
44. }
45. 
46. _register('.html');


File: store.js
Line number range: 1 - 164
Content:
1. import {
2. 	assign,
3. 	blankObject,
4. 	differs,
5. 	dispatchObservers,
6. 	get,
7. 	observe
8. } from './shared.js';
9. 
10. function Store(state) {
11. 	this._observers = { pre: blankObject(), post: blankObject() };
12. 	this._changeHandlers = [];
13. 	this._dependents = [];
14. 
15. 	this._computed = blankObject();
16. 	this._sortedComputedProperties = [];
17. 
18. 	this._state = assign({}, state);
19. }
20. 
21. assign(Store.prototype, {
22. 	_add: function(component, props) {
23. 		this._dependents.push({
24. 			component: component,
25. 			props: props
26. 		});
27. 	},
28. 
29. 	_init: function(props) {
30. 		var state = {};
31. 		for (var i = 0; i < props.length; i += 1) {
32. 			var prop = props[i];
33. 			state['$' + prop] = this._state[prop];
34. 		}
35. 		return state;
36. 	},
37. 
38. 	_remove: function(component) {
39. 		var i = this._dependents.length;
40. 		while (i--) {
41. 			if (this._dependents[i].component === component) {
42. 				this._dependents.splice(i, 1);
43. 				return;
44. 			}
45. 		}
46. 	},
47. 
48. 	_sortComputedProperties: function() {
49. 		var computed = this._computed;
50. 		var sorted = this._sortedComputedProperties = [];
51. 		var cycles;
52. 		var visited = blankObject();
53. 
54. 		function visit(key) {
55. 			if (cycles[key]) {
56. 				throw new Error('Cyclical dependency detected');
57. 			}
58. 
59. 			if (visited[key]) return;
60. 			visited[key] = true;
61. 
62. 			var c = computed[key];
63. 
64. 			if (c) {
65. 				cycles[key] = true;
66. 				c.deps.forEach(visit);
67. 				sorted.push(c);
68. 			}
69. 		}
70. 
71. 		for (var key in this._computed) {
72. 			cycles = blankObject();
73. 			visit(key);
74. 		}
75. 	},
76. 
77. 	compute: function(key, deps, fn) {
78. 		var store = this;
79. 		var value;
80. 
81. 		var c = {
82. 			deps: deps,
83. 			update: function(state, changed, dirty) {
84. 				var values = deps.map(function(dep) {
85. 					if (dep in changed) dirty = true;
86. 					return state[dep];
87. 				});
88. 
89. 				if (dirty) {
90. 					var newValue = fn.apply(null, values);
91. 					if (differs(newValue, value)) {
92. 						value = newValue;
93. 						changed[key] = true;
94. 						state[key] = value;
95. 					}
96. 				}
97. 			}
98. 		};
99. 
100. 		c.update(this._state, {}, true);
101. 
102. 		this._computed[key] = c;
103. 		this._sortComputedProperties();
104. 	},
105. 
106. 	get: get,
107. 
108. 	observe: observe,
109. 
110. 	onchange: function(callback) {
111. 		this._changeHandlers.push(callback);
112. 		return {
113. 			cancel: function() {
114. 				var index = this._changeHandlers.indexOf(callback);
115. 				if (~index) this._changeHandlers.splice(index, 1);
116. 			}
117. 		};
118. 	},
119. 
120. 	set: function(newState) {
121. 		var oldState = this._state,
122. 			changed = this._changed = {},
123. 			dirty = false;
124. 
125. 		for (var key in newState) {
126. 			if (this._computed[key]) throw new Error("'" + key + "' is a read-only property");
127. 			if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
128. 		}
129. 		if (!dirty) return;
130. 
131. 		this._state = assign({}, oldState, newState);
132. 
133. 		for (var i = 0; i < this._sortedComputedProperties.length; i += 1) {
134. 			this._sortedComputedProperties[i].update(this._state, changed);
135. 		}
136. 
137. 		for (var i = 0; i < this._changeHandlers.length; i += 1) {
138. 			this._changeHandlers[i](this._state, changed);
139. 		}
140. 
141. 		dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
142. 
143. 		var dependents = this._dependents.slice(); // guard against mutations
144. 		for (var i = 0; i < dependents.length; i += 1) {
145. 			var dependent = dependents[i];
146. 			var componentState = {};
147. 			dirty = false;
148. 
149. 			for (var j = 0; j < dependent.props.length; j += 1) {
150. 				var prop = dependent.props[j];
151. 				if (prop in changed) {
152. 					componentState['$' + prop] = this._state[prop];
153. 					dirty = true;
154. 				}
155. 			}
156. 
157. 			if (dirty) dependent.component.set(componentState);
158. 		}
159. 
160. 		dispatchObservers(this, this._observers.post, changed, this._state, oldState);
161. 	}
162. });
163. 
164. export { Store };


File: test/server-side-rendering/index.js
Line number range: 1 - 132
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require("../../ssr/register")({
25. 			extensions: ['.svelte', '.html'],
26. 			store: true
27. 		});
28. 
29. 		return setupHtmlEqual();
30. 	});
31. 
32. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
33. 		if (dir[0] === ".") return;
34. 
35. 		// add .solo to a sample directory name to only run that test, or
36. 		// .show to always show the output. or both
37. 		const solo = /\.solo/.test(dir);
38. 		const show = /\.show/.test(dir);
39. 
40. 		if (solo && process.env.CI) {
41. 			throw new Error("Forgot to remove `solo: true` from test");
42. 		}
43. 
44. 		(solo ? it.only : it)(dir, () => {
45. 			dir = path.resolve("test/server-side-rendering/samples", dir);
46. 			try {
47. 				let component;
48. 
49. 				const mainHtmlFile = `${dir}/main.html`;
50. 				const mainSvelteFile = `${dir}/main.svelte`;
51. 				if (fs.existsSync(mainHtmlFile)) {
52. 					component = require(mainHtmlFile);
53. 				} else if (fs.existsSync(mainSvelteFile)) {
54. 					component = require(mainSvelteFile);
55. 				}
56. 
57. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
58. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
59. 
60. 				const data = tryToLoadJson(`${dir}/data.json`);
61. 
62. 				const rendered = component.render(data);
63. 				const { html, css, head } = rendered;
64. 
65. 				// rendered.toString() === rendered.html
66. 				assert.equal(rendered, html);
67. 
68. 				fs.writeFileSync(`${dir}/_actual.html`, html);
69. 				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);
70. 
71. 				assert.htmlEqual(html, expectedHtml);
72. 				assert.equal(
73. 					css.code.replace(/^\s+/gm, ""),
74. 					expectedCss.replace(/^\s+/gm, "")
75. 				);
76. 
77. 				if (fs.existsSync(`${dir}/_expected-head.html`)) {
78. 					fs.writeFileSync(`${dir}/_actual-head.html`, head);
79. 					assert.htmlEqual(
80. 						head,
81. 						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
82. 					);
83. 				}
84. 
85. 				if (show) showOutput(dir, { generate: 'ssr' });
86. 			} catch (err) {
87. 				showOutput(dir, { generate: 'ssr' });
88. 				throw err;
89. 			}
90. 		});
91. 	});
92. 
93. 	// duplicate client-side tests, as far as possible
94. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
95. 		if (dir[0] === ".") return;
96. 
97. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
98. 
99. 		if (config.solo && process.env.CI) {
100. 			throw new Error("Forgot to remove `solo: true` from test");
101. 		}
102. 
103. 		if (config["skip-ssr"]) return;
104. 
105. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
106. 			const cwd = path.resolve("test/runtime/samples", dir);
107. 
108. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
109. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
110. 				delete require.cache[resolved];
111. 			});
112. 
113. 			require("../../ssr/register")({
114. 				store: !!config.store
115. 			});
116. 
117. 			try {
118. 				const component = require(`../runtime/samples/${dir}/main.html`);
119. 				const { html } = component.render(config.data, {
120. 					store: (config.store !== true) && config.store
121. 				});
122. 
123. 				if (config.html) {
124. 					assert.htmlEqual(html, config.html);
125. 				}
126. 			} catch (err) {
127. 				showOutput(cwd, { generate: "ssr" });
128. 				throw err;
129. 			}
130. 		});
131. 	});
132. });

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 13:29:21,872 - thread-135845298308800.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The query asks for full contents with line numbers of this SSR visitor. It directly implements SSR nested component rendering, including dynamic component resolution, binding propagation via Block.addBinding, slot collection using appendTargets, and passing store via options to child components. Essential for understanding SSR nested component rendering.', relative_path='src/generators/server-side-rendering/visitors/Component.ts', start_line=1, end_line=121), ContextOutput(reasoning='The query requests full contents of the SSR generator index. This file constructs the render and _render functions, initializes state including store-derived props via options.store._init, manages components CSS aggregation, and sets up bindings evaluation. It provides critical implementation details for SSR store initialization and general SSR rendering.', relative_path='src/generators/server-side-rendering/index.ts', start_line=1, end_line=268), ContextOutput(reasoning='Requested and relevant to SSR nested components: Block.addBinding pulls child component data into parent state during SSR. It is essential to understand how SSR resolves bindings when rendering nested components.', relative_path='src/generators/server-side-rendering/Block.ts', start_line=1, end_line=49), ContextOutput(reasoning='The query asks for full contents of interfaces. It contains type definitions including CompileOptions with a store boolean flag used by SSR index and visitor to handle store initialization and passing. Necessary configuration context.', relative_path='src/interfaces.ts', start_line=1, end_line=92), ContextOutput(reasoning='The query includes client-side component generator file. While not part of SSR, it is necessary for comparing SSR behavior with the client renderer, particularly how nested components, bindings, and slots are handled on the client side.', relative_path='src/generators/nodes/Component.ts', start_line=1, end_line=609), ContextOutput(reasoning='Requested and relevant: register.js sets up SSR compilation and allows enabling store support via options. This influences how SSR code includes store initialization.', relative_path='src/server-side-rendering/register.js', start_line=1, end_line=46), ContextOutput(reasoning='Requested and highly relevant: Store implementation with _init used by SSR index to initialize $-prefixed props. Essential for understanding SSR store initialization flow.', relative_path='store.js', start_line=1, end_line=164), ContextOutput(reasoning='Extra requirement asks for the test harness. This file sets up SSR tests, includes registering SSR with store: true, and exercises component.render with optional store passing. Confirms existence of SSR store tests.', relative_path='test/server-side-rendering/index.js', start_line=1, end_line=132)]
2025-11-12 13:29:21,878 - thread-135845298308800.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 8 contexts to memory for query: Please provide the full contents with line numbers of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/interfaces.ts, src/generators/nodes/Component.ts, src/server-side-rendering/register.js, and store.js.
2025-11-12 13:29:22,460 - thread-135845298308800.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 13:29:22,461 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 8 new contexts to 0 existing contexts
2025-11-12 13:29:22,461 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 8 total contexts (removed 0 duplicates)
2025-11-12 13:29:22,462 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents with line numbers of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/interfaces.ts, src/generators/nodes/Component.ts, src/server-side-rendering/register.js, and store.js.
Extra Requirements: If sending all files is too large, include at minimum the functions that generate SSR nested component rendering and store initialization, and the test harness at test/server-side-rendering/index.js; if no SSR store tests exist, please confirm.
Purpose: To verify how SSR handles store initialization for nested components, determine if the behavior is inconsistent with the client renderer, and accurately classify the issue.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: src/generators/nodes/Component.ts
Line number range: 1 - 609
Content:
1. import deindent from '../../utils/deindent';
2. import { stringify } from '../../utils/stringify';
3. import stringifyProps from '../../utils/stringifyProps';
4. import CodeBuilder from '../../utils/CodeBuilder';
5. import getTailSnippet from '../../utils/getTailSnippet';
6. import getObject from '../../utils/getObject';
7. import getExpressionPrecedence from '../../utils/getExpressionPrecedence';
8. import Node from './shared/Node';
9. import Block from '../dom/Block';
10. import Attribute from './Attribute';
11. 
12. export default class Component extends Node {
13. 	type: 'Component';
14. 	name: string;
15. 	attributes: Attribute[];
16. 	children: Node[];
17. 
18. 	init(
19. 		block: Block,
20. 		stripWhitespace: boolean,
21. 		nextSibling: Node
22. 	) {
23. 		this.cannotUseInnerHTML();
24. 
25. 		this.attributes.forEach((attribute: Node) => {
26. 			if (attribute.type === 'Attribute' && attribute.value !== true) {
27. 				attribute.value.forEach((chunk: Node) => {
28. 					if (chunk.type !== 'Text') {
29. 						const dependencies = chunk.metadata.dependencies;
30. 						block.addDependencies(dependencies);
31. 					}
32. 				});
33. 			} else {
34. 				if (attribute.type === 'EventHandler' && attribute.expression) {
35. 					attribute.expression.arguments.forEach((arg: Node) => {
36. 						block.addDependencies(arg.metadata.dependencies);
37. 					});
38. 				} else if (attribute.type === 'Binding') {
39. 					block.addDependencies(attribute.metadata.dependencies);
40. 				}
41. 			}
42. 		});
43. 
44. 		this.var = block.getUniqueName(
45. 			(
46. 				this.name === ':Self' ? this.generator.name :
47. 				this.name === ':Component' ? 'switch_instance' :
48. 				this.name
49. 			).toLowerCase()
50. 		);
51. 
52. 		if (this.children.length) {
53. 			this._slots = new Set(['default']);
54. 
55. 			this.children.forEach(child => {
56. 				child.init(block, stripWhitespace, nextSibling);
57. 			});
58. 		}
59. 	}
60. 
61. 	build(
62. 		block: Block,
63. 		parentNode: string,
64. 		parentNodes: string
65. 	) {
66. 		const { generator } = this;
67. 		generator.hasComponents = true;
68. 
69. 		const name = this.var;
70. 
71. 		const componentInitProperties = [`root: #component.root`];
72. 
73. 		if (this.children.length > 0) {
74. 			const slots = Array.from(this._slots).map(name => `${name}: @createFragment()`);
75. 			componentInitProperties.push(`slots: { ${slots.join(', ')} }`);
76. 
77. 			this.children.forEach((child: Node) => {
78. 				child.build(block, `${this.var}._slotted.default`, 'nodes');
79. 			});
80. 		}
81. 
82. 		const allContexts = new Set();
83. 		const statements: string[] = [];
84. 		const name_context = block.getUniqueName(`${name}_context`);
85. 
86. 		let name_updating: string;
87. 		let name_initial_data: string;
88. 		let beforecreate: string = null;
89. 
90. 		const attributes = this.attributes
91. 			.filter(a => a.type === 'Attribute')
92. 			.map(a => mungeAttribute(a, block));
93. 
94. 		const bindings = this.attributes
95. 			.filter(a => a.type === 'Binding')
96. 			.map(a => mungeBinding(a, block));
97. 
98. 		const eventHandlers = this.attributes
99. 			.filter((a: Node) => a.type === 'EventHandler')
100. 			.map(a => mungeEventHandler(generator, this, a, block, name_context, allContexts));
101. 
102. 		const ref = this.attributes.find((a: Node) => a.type === 'Ref');
103. 		if (ref) generator.usesRefs = true;
104. 
105. 		const updates: string[] = [];
106. 
107. 		if (attributes.length || bindings.length) {
108. 			const initialProps = attributes
109. 				.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);
110. 
111. 			const initialPropString = stringifyProps(initialProps);
112. 
113. 			attributes
114. 				.filter((attribute: Attribute) => attribute.dynamic)
115. 				.forEach((attribute: Attribute) => {
116. 					if (attribute.dependencies.length) {
117. 						updates.push(deindent`
118. 							if (${attribute.dependencies
119. 								.map(dependency => `changed.${dependency}`)
120. 								.join(' || ')}) ${name}_changes.${attribute.name} = ${attribute.value};
121. 						`);
122. 					}
123. 
124. 					else {
125. 						// TODO this is an odd situation to encounter – I *think* it should only happen with
126. 						// each block indices, in which case it may be possible to optimise this
127. 						updates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);
128. 					}
129. 				});
130. 
131. 			if (bindings.length) {
132. 				generator.hasComplexBindings = true;
133. 
134. 				name_updating = block.alias(`${name}_updating`);
135. 				name_initial_data = block.getUniqueName(`${name}_initial_data`);
136. 
137. 				block.addVariable(name_updating, '{}');
138. 				statements.push(`var ${name_initial_data} = ${initialPropString};`);
139. 
140. 				const setParentFromChildOnChange = new CodeBuilder();
141. 				const setParentFromChildOnInit = new CodeBuilder();
142. 
143. 				bindings.forEach((binding: Binding) => {
144. 					let setParentFromChild;
145. 
146. 					binding.contexts.forEach(context => {
147. 						allContexts.add(context);
148. 					});
149. 
150. 					const { name: key } = getObject(binding.value);
151. 
152. 					if (block.contexts.has(key)) {
153. 						const prop = binding.dependencies[0];
154. 						const computed = isComputed(binding.value);
155. 						const tail = binding.value.type === 'MemberExpression' ? getTailSnippet(binding.value) : '';
156. 
157. 						setParentFromChild = deindent`
158. 							var list = ${name_context}.${block.listNames.get(key)};
159. 							var index = ${name_context}.${block.indexNames.get(key)};
160. 							list[index]${tail} = childState.${binding.name};
161. 
162. 							${binding.dependencies
163. 								.map((prop: string) => `newState.${prop} = state.${prop};`)
164. 								.join('\n')}
165. 						`;
166. 					}
167. 
168. 					else if (binding.value.type === 'MemberExpression') {
169. 						setParentFromChild = deindent`
170. 							${binding.snippet} = childState.${binding.name};
171. 							${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join('\n')}
172. 						`;
173. 					}
174. 
175. 					else {
176. 						setParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;
177. 					}
178. 
179. 					statements.push(deindent`
180. 						if (${binding.prop} in ${binding.obj}) {
181. 							${name_initial_data}.${binding.name} = ${binding.snippet};
182. 							${name_updating}.${binding.name} = true;
183. 						}`
184. 					);
185. 
186. 					setParentFromChildOnChange.addConditional(
187. 						`!${name_updating}.${binding.name} && changed.${binding.name}`,
188. 						setParentFromChild
189. 					);
190. 
191. 					setParentFromChildOnInit.addConditional(
192. 						`!${name_updating}.${binding.name}`,
193. 						setParentFromChild
194. 					);
195. 
196. 					// TODO could binding.dependencies.length ever be 0?
197. 					if (binding.dependencies.length) {
198. 						updates.push(deindent`
199. 							if (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(' || ')}) {
200. 								${name}_changes.${binding.name} = ${binding.snippet};
201. 								${name_updating}.${binding.name} = true;
202. 							}
203. 						`);
204. 					}
205. 				});
206. 
207. 				componentInitProperties.push(`data: ${name_initial_data}`);
208. 
209. 				componentInitProperties.push(deindent`
210. 					_bind: function(changed, childState) {
211. 						var state = #component.get(), newState = {};
212. 						${setParentFromChildOnChange}
213. 						${name_updating} = @assign({}, changed);
214. 						#component._set(newState);
215. 						${name_updating} = {};
216. 					}
217. 				`);
218. 
219. 				beforecreate = deindent`
220. 					#component.root._beforecreate.push(function() {
221. 						var state = #component.get(), childState = ${name}.get(), newState = {};
222. 						if (!childState) return;
223. 						${setParentFromChildOnInit}
224. 						${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(', ')} };
225. 						#component._set(newState);
226. 						${name_updating} = {};
227. 					});
228. 				`;
229. 			} else if (initialProps.length) {
230. 				componentInitProperties.push(`data: ${initialPropString}`);
231. 			}
232. 		}
233. 
234. 		const isDynamicComponent = this.name === ':Component';
235. 
236. 		const switch_vars = isDynamicComponent && {
237. 			value: block.getUniqueName('switch_value'),
238. 			props: block.getUniqueName('switch_props')
239. 		};
240. 
241. 		const expression = (
242. 			this.name === ':Self' ? generator.name :
243. 			isDynamicComponent ? switch_vars.value :
244. 			`%components-${this.name}`
245. 		);
246. 
247. 		if (isDynamicComponent) {
248. 			block.contextualise(this.expression);
249. 			const { dependencies, snippet } = this.metadata;
250. 
251. 			const anchor = this.getOrCreateAnchor(block, parentNode, parentNodes);
252. 
253. 			const params = block.params.join(', ');
254. 
255. 			block.builders.init.addBlock(deindent`
256. 				var ${switch_vars.value} = ${snippet};
257. 
258. 				function ${switch_vars.props}(${params}) {
259. 					${statements.length > 0 && statements.join('\n')}
260. 					return {
261. 						${componentInitProperties.join(',\n')}
262. 					};
263. 				}
264. 
265. 				if (${switch_vars.value}) {
266. 					var ${name} = new ${expression}(${switch_vars.props}(${params}));
267. 
268. 					${beforecreate}
269. 				}
270. 
271. 				${eventHandlers.map(handler => deindent`
272. 					function ${handler.var}(event) {
273. 						${handler.body}
274. 					}
275. 
276. 					if (${name}) ${name}.on("${handler.name}", ${handler.var});
277. 				`)}
278. 			`);
279. 
280. 			block.builders.create.addLine(
281. 				`if (${name}) ${name}._fragment.c();`
282. 			);
283. 
284. 			if (parentNodes) {
285. 				block.builders.claim.addLine(
286. 					`if (${name}) ${name}._fragment.l(${parentNodes});`
287. 				);
288. 			}
289. 
290. 			block.builders.mount.addLine(
291. 				`if (${name}) ${name}._mount(${parentNode || '#target'}, ${parentNode ? 'null' : 'anchor'});`
292. 			);
293. 
294. 			const updateMountNode = this.getUpdateMountNode(anchor);
295. 
296. 			block.builders.update.addBlock(deindent`
297. 				if (${switch_vars.value} !== (${switch_vars.value} = ${snippet})) {
298. 					if (${name}) ${name}.destroy();
299. 
300. 					if (${switch_vars.value}) {
301. 						${name} = new ${switch_vars.value}(${switch_vars.props}(${params}));
302. 						${name}._fragment.c();
303. 
304. 						${this.children.map(child => remount(generator, child, name))}
305. 						${name}._mount(${updateMountNode}, ${anchor});
306. 
307. 						${eventHandlers.map(handler => deindent`
308. 							${name}.on("${handler.name}", ${handler.var});
309. 						`)}
310. 
311. 						${ref && `#component.refs.${ref.name} = ${name};`}
312. 					}
313. 
314. 					${ref && deindent`
315. 						else if (#component.refs.${ref.name} === ${name}) {
316. 							#component.refs.${ref.name} = null;
317. 						}`}
318. 				}
319. 			`);
320. 
321. 			if (updates.length) {
322. 				block.builders.update.addBlock(deindent`
323. 					else {
324. 						var ${name}_changes = {};
325. 						${updates.join('\n')}
326. 						${name}._set(${name}_changes);
327. 						${bindings.length && `${name_updating} = {};`}
328. 					}
329. 				`);
330. 			}
331. 
332. 			if (!parentNode) block.builders.unmount.addLine(`if (${name}) ${name}._unmount();`);
333. 
334. 			block.builders.destroy.addLine(`if (${name}) ${name}.destroy(false);`);
335. 		} else {
336. 			block.builders.init.addBlock(deindent`
337. 				${statements.join('\n')}
338. 				var ${name} = new ${expression}({
339. 					${componentInitProperties.join(',\n')}
340. 				});
341. 
342. 				${beforecreate}
343. 
344. 				${eventHandlers.map(handler => deindent`
345. 					${name}.on("${handler.name}", function(event) {
346. 						${handler.body}
347. 					});
348. 				`)}
349. 
350. 				${ref && `#component.refs.${ref.name} = ${name};`}
351. 			`);
352. 
353. 			block.builders.create.addLine(`${name}._fragment.c();`);
354. 
355. 			if (parentNodes) {
356. 				block.builders.claim.addLine(
357. 					`${name}._fragment.l(${parentNodes});`
358. 				);
359. 			}
360. 
361. 			block.builders.mount.addLine(
362. 				`${name}._mount(${parentNode || '#target'}, ${parentNode ? 'null' : 'anchor'});`
363. 			);
364. 
365. 			if (updates.length) {
366. 				block.builders.update.addBlock(deindent`
367. 					var ${name}_changes = {};
368. 					${updates.join('\n')}
369. 					${name}._set(${name}_changes);
370. 					${bindings.length && `${name_updating} = {};`}
371. 				`);
372. 			}
373. 
374. 			if (!parentNode) block.builders.unmount.addLine(`${name}._unmount();`);
375. 
376. 			block.builders.destroy.addLine(deindent`
377. 				${name}.destroy(false);
378. 				${ref && `if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;`}
379. 			`);
380. 		}
381. 
382. 		// maintain component context
383. 		if (allContexts.size) {
384. 			const contexts = Array.from(allContexts);
385. 
386. 			const initialProps = contexts
387. 				.map(contextName => {
388. 					if (contextName === 'state') return `state: state`;
389. 
390. 					const listName = block.listNames.get(contextName);
391. 					const indexName = block.indexNames.get(contextName);
392. 
393. 					return `${listName}: ${listName},\n${indexName}: ${indexName}`;
394. 				})
395. 				.join(',\n');
396. 
397. 			const updates = contexts
398. 				.map(contextName => {
399. 					if (contextName === 'state') return `${name_context}.state = state;`;
400. 
401. 					const listName = block.listNames.get(contextName);
402. 					const indexName = block.indexNames.get(contextName);
403. 
404. 					return `${name_context}.${listName} = ${listName};\n${name_context}.${indexName} = ${indexName};`;
405. 				})
406. 				.join('\n');
407. 
408. 			block.builders.init.addBlock(deindent`
409. 				var ${name_context} = {
410. 					${initialProps}
411. 				};
412. 			`);
413. 
414. 			block.builders.update.addBlock(updates);
415. 		}
416. 	}
417. }
418. 
419. function mungeAttribute(attribute: Node, block: Block): Attribute {
420. 	if (attribute.value === true) {
421. 		// attributes without values, e.g. <textarea readonly>
422. 		return {
423. 			name: attribute.name,
424. 			value: true,
425. 			dynamic: false
426. 		};
427. 	}
428. 
429. 	if (attribute.value.length === 0) {
430. 		return {
431. 			name: attribute.name,
432. 			value: `''`,
433. 			dynamic: false
434. 		};
435. 	}
436. 
437. 	if (attribute.value.length === 1) {
438. 		const value = attribute.value[0];
439. 
440. 		if (value.type === 'Text') {
441. 			// static attributes
442. 			return {
443. 				name: attribute.name,
444. 				value: isNaN(value.data) ? stringify(value.data) : value.data,
445. 				dynamic: false
446. 			};
447. 		}
448. 
449. 		// simple dynamic attributes
450. 		block.contextualise(value.expression); // TODO remove
451. 		const { dependencies, snippet } = value.metadata;
452. 
453. 		// TODO only update attributes that have changed
454. 		return {
455. 			name: attribute.name,
456. 			value: snippet,
457. 			dependencies,
458. 			dynamic: true
459. 		};
460. 	}
461. 
462. 	// otherwise we're dealing with a complex dynamic attribute
463. 	const allDependencies = new Set();
464. 
465. 	const value =
466. 		(attribute.value[0].type === 'Text' ? '' : `"" + `) +
467. 		attribute.value
468. 			.map((chunk: Node) => {
469. 				if (chunk.type === 'Text') {
470. 					return stringify(chunk.data);
471. 				} else {
472. 					block.contextualise(chunk.expression); // TODO remove
473. 					const { dependencies, snippet } = chunk.metadata;
474. 
475. 					dependencies.forEach((dependency: string) => {
476. 						allDependencies.add(dependency);
477. 					});
478. 
479. 					return getExpressionPrecedence(chunk.expression) <= 13 ? `(${snippet})` : snippet;
480. 				}
481. 			})
482. 			.join(' + ');
483. 
484. 	return {
485. 		name: attribute.name,
486. 		value,
487. 		dependencies: Array.from(allDependencies),
488. 		dynamic: true
489. 	};
490. }
491. 
492. function mungeBinding(binding: Node, block: Block): Binding {
493. 	const { name } = getObject(binding.value);
494. 	const { contexts } = block.contextualise(binding.value);
495. 	const { dependencies, snippet } = binding.metadata;
496. 
497. 	const contextual = block.contexts.has(name);
498. 
499. 	let obj;
500. 	let prop;
501. 
502. 	if (contextual) {
503. 		obj = block.listNames.get(name);
504. 		prop = block.indexNames.get(name);
505. 	} else if (binding.value.type === 'MemberExpression') {
506. 		prop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;
507. 		if (!binding.value.computed) prop = `'${prop}'`;
508. 		obj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;
509. 	} else {
510. 		obj = 'state';
511. 		prop = `'${name}'`;
512. 	}
513. 
514. 	return {
515. 		name: binding.name,
516. 		value: binding.value,
517. 		contexts,
518. 		snippet,
519. 		obj,
520. 		prop,
521. 		dependencies
522. 	};
523. }
524. 
525. function mungeEventHandler(generator: DomGenerator, node: Node, handler: Node, block: Block, name_context: string, allContexts: Set<string>) {
526. 	let body;
527. 
528. 	if (handler.expression) {
529. 		generator.addSourcemapLocations(handler.expression);
530. 		generator.code.prependRight(
531. 			handler.expression.start,
532. 			`${block.alias('component')}.`
533. 		);
534. 
535. 		const usedContexts: string[] = [];
536. 
537. 		handler.expression.arguments.forEach((arg: Node) => {
538. 			const { contexts } = block.contextualise(arg, null, true);
539. 
540. 			contexts.forEach(context => {
541. 				if (!~usedContexts.indexOf(context)) usedContexts.push(context);
542. 				allContexts.add(context);
543. 			});
544. 		});
545. 
546. 		// TODO hoist event handlers? can do `this.__component.method(...)`
547. 		const declarations = usedContexts.map(name => {
548. 			if (name === 'state') return `var state = ${name_context}.state;`;
549. 
550. 			const listName = block.listNames.get(name);
551. 			const indexName = block.indexNames.get(name);
552. 
553. 			return `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;
554. 		});
555. 
556. 		body = deindent`
557. 			${declarations}
558. 
559. 			[✂${handler.expression.start}-${handler.expression.end}✂];
560. 		`;
561. 	} else {
562. 		body = deindent`
563. 			${block.alias('component')}.fire('${handler.name}', event);
564. 		`;
565. 	}
566. 
567. 	return {
568. 		name: handler.name,
569. 		var: block.getUniqueName(`${node.var}_${handler.name}`),
570. 		body
571. 	};
572. }
573. 
574. function isComputed(node: Node) {
575. 	while (node.type === 'MemberExpression') {
576. 		if (node.computed) return true;
577. 		node = node.object;
578. 	}
579. 
580. 	return false;
581. }
582. 
583. function remount(generator: DomGenerator, node: Node, name: string) {
584. 	// TODO make this a method of the nodes
585. 
586. 	if (node.type === 'Component') {
587. 		return `${node.var}._mount(${name}._slotted.default, null);`;
588. 	}
589. 
590. 	if (node.type === 'Element') {
591. 		const slot = node.attributes.find(attribute => attribute.name === 'slot');
592. 		if (slot) {
593. 			return `@appendNode(${node.var}, ${name}._slotted.${node.getStaticAttributeValue('slot')});`;
594. 		}
595. 
596. 		return `@appendNode(${node.var}, ${name}._slotted.default);`;
597. 	}
598. 
599. 	if (node.type === 'Text' || node.type === 'MustacheTag' || node.type === 'RawMustacheTag') {
600. 		return `@appendNode(${node.var}, ${name}._slotted.default);`;
601. 	}
602. 
603. 	if (node.type === 'EachBlock') {
604. 		// TODO consider keyed blocks
605. 		return `for (var #i = 0; #i < ${node.iterations}.length; #i += 1) ${node.iterations}[#i].m(${name}._slotted.default, null);`;
606. 	}
607. 
608. 	return `${node.var}.m(${name}._slotted.default, null);`;
609. }


File: src/generators/server-side-rendering/Block.ts
Line number range: 1 - 49
Content:
1. import deindent from '../../utils/deindent';
2. import flattenReference from '../../utils/flattenReference';
3. import { SsrGenerator } from './index';
4. import { Node } from '../../interfaces';
5. import getObject from '../../utils/getObject';
6. 
7. interface BlockOptions {
8. 	// TODO
9. }
10. 
11. export default class Block {
12. 	generator: SsrGenerator;
13. 	conditions: string[];
14. 
15. 	contexts: Map<string, string>;
16. 	indexes: Map<string, string>;
17. 	contextDependencies: Map<string, string[]>;
18. 
19. 	constructor(options: BlockOptions) {
20. 		Object.assign(this, options);
21. 	}
22. 
23. 	addBinding(binding: Node, name: string) {
24. 		const conditions = [`!('${binding.name}' in state)`].concat(
25. 			// TODO handle contextual bindings...
26. 			this.conditions.map(c => `(${c})`)
27. 		);
28. 
29. 		const { name: prop } = getObject(binding.value);
30. 
31. 		this.generator.bindings.push(deindent`
32. 			if (${conditions.join('&&')}) {
33. 				tmp = ${name}.data();
34. 				if ('${prop}' in tmp) {
35. 					state.${binding.name} = tmp.${prop};
36. 					settled = false;
37. 				}
38. 			}
39. 		`);
40. 	}
41. 
42. 	child(options: BlockOptions) {
43. 		return new Block(Object.assign({}, this, options, { parent: this }));
44. 	}
45. 
46. 	contextualise(expression: Node, context?: string, isEventHandler?: boolean) {
47. 		return this.generator.contextualise(this.contexts, this.indexes, expression, context, isEventHandler);
48. 	}
49. }


File: src/generators/server-side-rendering/index.ts
Line number range: 1 - 268
Content:
1. import deindent from '../../utils/deindent';
2. import Generator from '../Generator';
3. import Stylesheet from '../../css/Stylesheet';
4. import Block from './Block';
5. import visit from './visit';
6. import { removeNode, removeObjectKey } from '../../utils/removeNode';
7. import getName from '../../utils/getName';
8. import globalWhitelist from '../../utils/globalWhitelist';
9. import { Parsed, Node, CompileOptions } from '../../interfaces';
10. import { AppendTarget } from './interfaces';
11. import { stringify } from '../../utils/stringify';
12. 
13. export class SsrGenerator extends Generator {
14. 	bindings: string[];
15. 	renderCode: string;
16. 	appendTargets: AppendTarget[];
17. 
18. 	constructor(
19. 		parsed: Parsed,
20. 		source: string,
21. 		name: string,
22. 		stylesheet: Stylesheet,
23. 		options: CompileOptions
24. 	) {
25. 		super(parsed, source, name, stylesheet, options, false);
26. 		this.bindings = [];
27. 		this.renderCode = '';
28. 		this.appendTargets = [];
29. 
30. 		this.stylesheet.warnOnUnusedSelectors(options.onwarn);
31. 	}
32. 
33. 	append(code: string) {
34. 		if (this.appendTargets.length) {
35. 			const appendTarget = this.appendTargets[this.appendTargets.length - 1];
36. 			const slotName = appendTarget.slotStack[appendTarget.slotStack.length - 1];
37. 			appendTarget.slots[slotName] += code;
38. 		} else {
39. 			this.renderCode += code;
40. 		}
41. 	}
42. }
43. 
44. export default function ssr(
45. 	parsed: Parsed,
46. 	source: string,
47. 	stylesheet: Stylesheet,
48. 	options: CompileOptions
49. ) {
50. 	const format = options.format || 'cjs';
51. 
52. 	const generator = new SsrGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
53. 
54. 	const { computations, name, templateProperties } = generator;
55. 
56. 	// create main render() function
57. 	const mainBlock = new Block({
58. 		generator,
59. 		contexts: new Map(),
60. 		indexes: new Map(),
61. 		conditions: [],
62. 	});
63. 
64. 	trim(parsed.html.children).forEach((node: Node) => {
65. 		visit(generator, mainBlock, node);
66. 	});
67. 
68. 	const { css, cssMap } = generator.customElement ?
69. 		{ css: null, cssMap: null } :
70. 		generator.stylesheet.render(options.filename, true);
71. 
72. 	// generate initial state object
73. 	const expectedProperties = Array.from(generator.expectedProperties);
74. 	const globals = expectedProperties.filter(prop => globalWhitelist.has(prop));
75. 	const storeProps = options.store || templateProperties.store ? expectedProperties.filter(prop => prop[0] === '$') : [];
76. 
77. 	const initialState = [];
78. 	if (globals.length > 0) {
79. 		initialState.push(`{ ${globals.map(prop => `${prop} : ${prop}`).join(', ')} }`);
80. 	}
81. 
82. 	if (storeProps.length > 0) {
83. 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
84. 		if (options.store || templateProperties.store) {
85. 			initialState.push(`options.store.${initialize}`);
86. 		}
87. 	}
88. 
89. 	if (templateProperties.data) {
90. 		initialState.push(`%data()`);
91. 	} else if (globals.length === 0 && storeProps.length === 0) {
92. 		initialState.push('{}');
93. 	}
94. 
95. 	initialState.push('state');
96. 
97. 	// TODO concatenate CSS maps
98. 	const result = deindent`
99. 		${generator.javascript}
100. 
101. 		var ${name} = {};
102. 
103. 		${options.filename && `${name}.filename = ${stringify(options.filename)}`};
104. 
105. 		${name}.data = function() {
106. 			return ${templateProperties.data ? `%data()` : `{}`};
107. 		};
108. 
109. 		${name}.render = function(state, options = {}) {
110. 			var components = new Set();
111. 
112. 			function addComponent(component) {
113. 				components.add(component);
114. 			}
115. 
116. 			var result = { head: '', addComponent };
117. 			${templateProperties.store && `options.store = %store();`}
118. 			var html = ${name}._render(result, state, options);
119. 
120. 			var cssCode = Array.from(components).map(c => c.css && c.css.code).filter(Boolean).join('\\n');
121. 
122. 			return {
123. 				html,
124. 				head: result.head,
125. 				css: { code: cssCode, map: null },
126. 				toString() {
127. 					return html;
128. 				}
129. 			};
130. 		}
131. 
132. 		${name}._render = function(__result, state, options) {
133. 			__result.addComponent(${name});
134. 
135. 			state = Object.assign(${initialState.join(', ')});
136. 
137. 			${computations.map(
138. 				({ key, deps }) =>
139. 					`state.${key} = %computed-${key}(${deps.map(dep => `state.${dep}`).join(', ')});`
140. 			)}
141. 
142. 			${generator.bindings.length &&
143. 				deindent`
144. 				var settled = false;
145. 				var tmp;
146. 
147. 				while (!settled) {
148. 					settled = true;
149. 
150. 					${generator.bindings.join('\n\n')}
151. 				}
152. 			`}
153. 
154. 			return \`${generator.renderCode}\`;
155. 		};
156. 
157. 		${name}.css = {
158. 			code: ${css ? stringify(css) : `''`},
159. 			map: ${cssMap ? stringify(cssMap.toString()) : 'null'}
160. 		};
161. 
162. 		var warned = false;
163. 		${name}.renderCss = function() {
164. 			if (!warned) {
165. 				console.error('Component.renderCss(...) is deprecated and will be removed in v2 — use Component.render(...).css instead');
166. 				warned = true;
167. 			}
168. 
169. 			var components = [];
170. 
171. 			${generator.stylesheet.hasStyles &&
172. 				deindent`
173. 				components.push({
174. 					filename: ${name}.filename,
175. 					css: ${name}.css && ${name}.css.code,
176. 					map: ${name}.css && ${name}.css.map
177. 				});
178. 			`}
179. 
180. 			${templateProperties.components &&
181. 				deindent`
182. 				var seen = {};
183. 
184. 				function addComponent(component) {
185. 					var result = component.renderCss();
186. 					result.components.forEach(x => {
187. 						if (seen[x.filename]) return;
188. 						seen[x.filename] = true;
189. 						components.push(x);
190. 					});
191. 				}
192. 
193. 				${templateProperties.components.value.properties.map((prop: Node) => {
194. 					return `addComponent(%components-${getName(prop.key)});`;
195. 				})}
196. 			`}
197. 
198. 			return {
199. 				css: components.map(x => x.css).join('\\n'),
200. 				map: null,
201. 				components
202. 			};
203. 		};
204. 
205. 		${templateProperties.preload && `${name}.preload = %preload;`}
206. 
207. 		${
208. 			// TODO this is a bit hacky
209. 			/__escape/.test(generator.renderCode) && deindent`
210. 				var escaped = {
211. 					'"': '&quot;',
212. 					"'": '&##39;',
213. 					'&': '&amp;',
214. 					'<': '&lt;',
215. 					'>': '&gt;'
216. 				};
217. 
218. 				function __escape(html) {
219. 					return String(html).replace(/["'&<>]/g, match => escaped[match]);
220. 				}
221. 			`
222. 		}
223. 
224. 		${
225. 			/__isPromise/.test(generator.renderCode) && deindent`
226. 				function __isPromise(value) {
227. 					return value && typeof value.then === 'function';
228. 				}
229. 			`
230. 		}
231. 
232. 		${
233. 			/__missingComponent/.test(generator.renderCode) && deindent`
234. 				var __missingComponent = {
235. 					_render: () => ''
236. 				};
237. 			`
238. 		}
239. 	`.replace(/(@+|#+|%+)(\w*(?:-\w*)?)/g, (match: string, sigil: string, name: string) => {
240. 		if (sigil === '@') return generator.alias(name);
241. 		if (sigil === '%') return generator.templateVars.get(name);
242. 		return sigil.slice(1) + name;
243. 	});
244. 
245. 	return generator.generate(result, options, { name, format });
246. }
247. 
248. function trim(nodes) {
249. 	let start = 0;
250. 	for (; start < nodes.length; start += 1) {
251. 		const node = nodes[start];
252. 		if (node.type !== 'Text') break;
253. 
254. 		node.data = node.data.replace(/^\s+/, '');
255. 		if (node.data) break;
256. 	}
257. 
258. 	let end = nodes.length;
259. 	for (; end > start; end -= 1) {
260. 		const node = nodes[end - 1];
261. 		if (node.type !== 'Text') break;
262. 
263. 		node.data = node.data.replace(/\s+$/, '');
264. 		if (node.data) break;
265. 	}
266. 
267. 	return nodes.slice(start, end);
268. }


File: src/generators/server-side-rendering/visitors/Component.ts
Line number range: 1 - 121
Content:
1. import flattenReference from '../../../utils/flattenReference';
2. import visit from '../visit';
3. import { SsrGenerator } from '../index';
4. import Block from '../Block';
5. import { AppendTarget } from '../interfaces';
6. import { Node } from '../../../interfaces';
7. import getObject from '../../../utils/getObject';
8. import getTailSnippet from '../../../utils/getTailSnippet';
9. import { stringify } from '../../../utils/stringify';
10. 
11. export default function visitComponent(
12. 	generator: SsrGenerator,
13. 	block: Block,
14. 	node: Node
15. ) {
16. 	function stringifyAttribute(chunk: Node) {
17. 		if (chunk.type === 'Text') return chunk.data;
18. 		if (chunk.type === 'MustacheTag') {
19. 			block.contextualise(chunk.expression);
20. 			const { snippet } = chunk.metadata;
21. 			return '${__escape( ' + snippet + ')}';
22. 		}
23. 	}
24. 
25. 	const attributes: Node[] = [];
26. 	const bindings: Node[] = [];
27. 
28. 	node.attributes.forEach((attribute: Node) => {
29. 		if (attribute.type === 'Attribute') {
30. 			attributes.push(attribute);
31. 		} else if (attribute.type === 'Binding') {
32. 			bindings.push(attribute);
33. 		}
34. 	});
35. 
36. 	const props = attributes
37. 		.map(attribute => {
38. 			let value;
39. 
40. 			if (attribute.value === true) {
41. 				value = `true`;
42. 			} else if (attribute.value.length === 0) {
43. 				value = `''`;
44. 			} else if (attribute.value.length === 1) {
45. 				const chunk = attribute.value[0];
46. 				if (chunk.type === 'Text') {
47. 					value = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;
48. 				} else {
49. 					block.contextualise(chunk.expression);
50. 					const { snippet } = chunk.metadata;
51. 					value = snippet;
52. 				}
53. 			} else {
54. 				value = '`' + attribute.value.map(stringifyAttribute).join('') + '`';
55. 			}
56. 
57. 			return `${attribute.name}: ${value}`;
58. 		})
59. 		.concat(
60. 			bindings.map(binding => {
61. 				const { name } = getObject(binding.value);
62. 				const tail = binding.value.type === 'MemberExpression'
63. 					? getTailSnippet(binding.value)
64. 					: '';
65. 
66. 				const keypath = block.contexts.has(name)
67. 					? `${name}${tail}`
68. 					: `state.${name}${tail}`;
69. 				return `${binding.name}: ${keypath}`;
70. 			})
71. 		)
72. 		.join(', ');
73. 
74. 	const isDynamicComponent = node.name === ':Component';
75. 	if (isDynamicComponent) block.contextualise(node.expression);
76. 
77. 	const expression = (
78. 		node.name === ':Self' ? generator.name :
79. 		isDynamicComponent ? `((${node.metadata.snippet}) || __missingComponent)` :
80. 		`%components-${node.name}`
81. 	);
82. 
83. 	bindings.forEach(binding => {
84. 		block.addBinding(binding, expression);
85. 	});
86. 
87. 	let open = `\${${expression}._render(__result, {${props}}`;
88. 
89. 	const options = [];
90. 	if (generator.options.store) {
91. 		options.push(`store: options.store`);
92. 	}
93. 
94. 	if (node.children.length) {
95. 		const appendTarget: AppendTarget = {
96. 			slots: { default: '' },
97. 			slotStack: ['default']
98. 		};
99. 
100. 		generator.appendTargets.push(appendTarget);
101. 
102. 		node.children.forEach((child: Node) => {
103. 			visit(generator, block, child);
104. 		});
105. 
106. 		const slotted = Object.keys(appendTarget.slots)
107. 			.map(name => `${name}: () => \`${appendTarget.slots[name]}\``)
108. 			.join(', ');
109. 
110. 		options.push(`slotted: { ${slotted} }`);
111. 
112. 		generator.appendTargets.pop();
113. 	}
114. 
115. 	if (options.length) {
116. 		open += `, { ${options.join(', ')} }`;
117. 	}
118. 
119. 	generator.append(open);
120. 	generator.append(')}');
121. }


File: src/interfaces.ts
Line number range: 1 - 92
Content:
1. import {SourceMap} from 'magic-string';
2. 
3. export interface Node {
4. 	start: number;
5. 	end: number;
6. 	type: string;
7. 	[propName: string]: any;
8. }
9. 
10. export interface Parser {
11. 	readonly template: string;
12. 	readonly filename?: string;
13. 
14. 	index: number;
15. 	stack: Array<Node>;
16. 
17. 	html: Node;
18. 	css: Node;
19. 	js: Node;
20. 	metaTags: {};
21. }
22. 
23. export interface Parsed {
24. 	hash: number;
25. 	html: Node;
26. 	css: Node;
27. 	js: Node;
28. }
29. 
30. export interface Warning {
31. 	loc?: { line: number; column: number; pos?: number };
32. 	pos?: number;
33. 	message: string;
34. 	filename?: string;
35. 	frame?: string;
36. 	toString: () => string;
37. }
38. 
39. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';
40. 
41. export interface CompileOptions {
42. 	format?: ModuleFormat;
43. 	name?: string;
44. 	filename?: string;
45. 	generate?: string;
46. 	globals?: ((id: string) => string) | object;
47. 	amd?: {
48. 		id?: string;
49. 	};
50. 
51. 	outputFilename?: string;
52. 	cssOutputFilename?: string;
53. 
54. 	dev?: boolean;
55. 	shared?: boolean | string;
56. 	cascade?: boolean;
57. 	hydratable?: boolean;
58. 	legacy?: boolean;
59. 	customElement?: CustomElementOptions | true;
60. 	css?: boolean;
61. 	store?: boolean;
62. 
63. 	onerror?: (error: Error) => void;
64. 	onwarn?: (warning: Warning) => void;
65. }
66. 
67. export interface GenerateOptions {
68. 	name: string;
69. 	format: ModuleFormat;
70. 	banner?: string;
71. 	sharedPath?: string;
72. 	helpers?: { name: string, alias: string }[];
73. }
74. 
75. export interface Visitor {
76. 	enter: (node: Node) => void;
77. 	leave?: (node: Node) => void;
78. }
79. 
80. export interface CustomElementOptions {
81. 	tag?: string;
82. 	props?: string[];
83. }
84. 
85. export interface PreprocessOptions {
86. 	markup?: (options: {content: string, filename: string}) => { code: string, map?: SourceMap | string };
87. 	style?: Preprocessor;
88. 	script?: Preprocessor;
89. 	filename?: string
90. }
91. 
92. export type Preprocessor = (options: {content: string, attributes: Record<string, string | boolean>, filename?: string}) => { code: string, map?: SourceMap | string };


File: src/server-side-rendering/register.js
Line number range: 1 - 46
Content:
1. import * as fs from 'fs';
2. import * as path from 'path';
3. import { compile } from '../index.ts';
4. 
5. const compileOptions = {};
6. 
7. function capitalise(name) {
8. 	return name[0].toUpperCase() + name.slice(1);
9. }
10. 
11. export default function register(options) {
12. 	const { extensions } = options;
13. 
14. 	if (extensions) {
15. 		_deregister('.html');
16. 		extensions.forEach(_register);
17. 	}
18. 
19. 	// TODO make this the default and remove in v2
20. 	if ('store' in options) compileOptions.store = options.store;
21. }
22. 
23. function _deregister(extension) {
24. 	delete require.extensions[extension];
25. }
26. 
27. function _register(extension) {
28. 	require.extensions[extension] = function(module, filename) {
29. 		const name = path.basename(filename)
30. 			.slice(0, -path.extname(filename).length)
31. 			.replace(/^\d/, '_$&')
32. 			.replace(/[^a-zA-Z0-9_$]/g, '');
33. 
34. 		const options = Object.assign({}, compileOptions, {
35. 			filename,
36. 			name: capitalise(name),
37. 			generate: 'ssr'
38. 		});
39. 
40. 		const {code} = compile(fs.readFileSync(filename, 'utf-8'), options);
41. 
42. 		return module._compile(code, filename);
43. 	};
44. }
45. 
46. _register('.html');


File: store.js
Line number range: 1 - 164
Content:
1. import {
2. 	assign,
3. 	blankObject,
4. 	differs,
5. 	dispatchObservers,
6. 	get,
7. 	observe
8. } from './shared.js';
9. 
10. function Store(state) {
11. 	this._observers = { pre: blankObject(), post: blankObject() };
12. 	this._changeHandlers = [];
13. 	this._dependents = [];
14. 
15. 	this._computed = blankObject();
16. 	this._sortedComputedProperties = [];
17. 
18. 	this._state = assign({}, state);
19. }
20. 
21. assign(Store.prototype, {
22. 	_add: function(component, props) {
23. 		this._dependents.push({
24. 			component: component,
25. 			props: props
26. 		});
27. 	},
28. 
29. 	_init: function(props) {
30. 		var state = {};
31. 		for (var i = 0; i < props.length; i += 1) {
32. 			var prop = props[i];
33. 			state['$' + prop] = this._state[prop];
34. 		}
35. 		return state;
36. 	},
37. 
38. 	_remove: function(component) {
39. 		var i = this._dependents.length;
40. 		while (i--) {
41. 			if (this._dependents[i].component === component) {
42. 				this._dependents.splice(i, 1);
43. 				return;
44. 			}
45. 		}
46. 	},
47. 
48. 	_sortComputedProperties: function() {
49. 		var computed = this._computed;
50. 		var sorted = this._sortedComputedProperties = [];
51. 		var cycles;
52. 		var visited = blankObject();
53. 
54. 		function visit(key) {
55. 			if (cycles[key]) {
56. 				throw new Error('Cyclical dependency detected');
57. 			}
58. 
59. 			if (visited[key]) return;
60. 			visited[key] = true;
61. 
62. 			var c = computed[key];
63. 
64. 			if (c) {
65. 				cycles[key] = true;
66. 				c.deps.forEach(visit);
67. 				sorted.push(c);
68. 			}
69. 		}
70. 
71. 		for (var key in this._computed) {
72. 			cycles = blankObject();
73. 			visit(key);
74. 		}
75. 	},
76. 
77. 	compute: function(key, deps, fn) {
78. 		var store = this;
79. 		var value;
80. 
81. 		var c = {
82. 			deps: deps,
83. 			update: function(state, changed, dirty) {
84. 				var values = deps.map(function(dep) {
85. 					if (dep in changed) dirty = true;
86. 					return state[dep];
87. 				});
88. 
89. 				if (dirty) {
90. 					var newValue = fn.apply(null, values);
91. 					if (differs(newValue, value)) {
92. 						value = newValue;
93. 						changed[key] = true;
94. 						state[key] = value;
95. 					}
96. 				}
97. 			}
98. 		};
99. 
100. 		c.update(this._state, {}, true);
101. 
102. 		this._computed[key] = c;
103. 		this._sortComputedProperties();
104. 	},
105. 
106. 	get: get,
107. 
108. 	observe: observe,
109. 
110. 	onchange: function(callback) {
111. 		this._changeHandlers.push(callback);
112. 		return {
113. 			cancel: function() {
114. 				var index = this._changeHandlers.indexOf(callback);
115. 				if (~index) this._changeHandlers.splice(index, 1);
116. 			}
117. 		};
118. 	},
119. 
120. 	set: function(newState) {
121. 		var oldState = this._state,
122. 			changed = this._changed = {},
123. 			dirty = false;
124. 
125. 		for (var key in newState) {
126. 			if (this._computed[key]) throw new Error("'" + key + "' is a read-only property");
127. 			if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
128. 		}
129. 		if (!dirty) return;
130. 
131. 		this._state = assign({}, oldState, newState);
132. 
133. 		for (var i = 0; i < this._sortedComputedProperties.length; i += 1) {
134. 			this._sortedComputedProperties[i].update(this._state, changed);
135. 		}
136. 
137. 		for (var i = 0; i < this._changeHandlers.length; i += 1) {
138. 			this._changeHandlers[i](this._state, changed);
139. 		}
140. 
141. 		dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
142. 
143. 		var dependents = this._dependents.slice(); // guard against mutations
144. 		for (var i = 0; i < dependents.length; i += 1) {
145. 			var dependent = dependents[i];
146. 			var componentState = {};
147. 			dirty = false;
148. 
149. 			for (var j = 0; j < dependent.props.length; j += 1) {
150. 				var prop = dependent.props[j];
151. 				if (prop in changed) {
152. 					componentState['$' + prop] = this._state[prop];
153. 					dirty = true;
154. 				}
155. 			}
156. 
157. 			if (dirty) dependent.component.set(componentState);
158. 		}
159. 
160. 		dispatchObservers(this, this._observers.post, changed, this._state, oldState);
161. 	}
162. });
163. 
164. export { Store };


File: test/server-side-rendering/index.js
Line number range: 1 - 132
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require("../../ssr/register")({
25. 			extensions: ['.svelte', '.html'],
26. 			store: true
27. 		});
28. 
29. 		return setupHtmlEqual();
30. 	});
31. 
32. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
33. 		if (dir[0] === ".") return;
34. 
35. 		// add .solo to a sample directory name to only run that test, or
36. 		// .show to always show the output. or both
37. 		const solo = /\.solo/.test(dir);
38. 		const show = /\.show/.test(dir);
39. 
40. 		if (solo && process.env.CI) {
41. 			throw new Error("Forgot to remove `solo: true` from test");
42. 		}
43. 
44. 		(solo ? it.only : it)(dir, () => {
45. 			dir = path.resolve("test/server-side-rendering/samples", dir);
46. 			try {
47. 				let component;
48. 
49. 				const mainHtmlFile = `${dir}/main.html`;
50. 				const mainSvelteFile = `${dir}/main.svelte`;
51. 				if (fs.existsSync(mainHtmlFile)) {
52. 					component = require(mainHtmlFile);
53. 				} else if (fs.existsSync(mainSvelteFile)) {
54. 					component = require(mainSvelteFile);
55. 				}
56. 
57. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
58. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
59. 
60. 				const data = tryToLoadJson(`${dir}/data.json`);
61. 
62. 				const rendered = component.render(data);
63. 				const { html, css, head } = rendered;
64. 
65. 				// rendered.toString() === rendered.html
66. 				assert.equal(rendered, html);
67. 
68. 				fs.writeFileSync(`${dir}/_actual.html`, html);
69. 				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);
70. 
71. 				assert.htmlEqual(html, expectedHtml);
72. 				assert.equal(
73. 					css.code.replace(/^\s+/gm, ""),
74. 					expectedCss.replace(/^\s+/gm, "")
75. 				);
76. 
77. 				if (fs.existsSync(`${dir}/_expected-head.html`)) {
78. 					fs.writeFileSync(`${dir}/_actual-head.html`, head);
79. 					assert.htmlEqual(
80. 						head,
81. 						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
82. 					);
83. 				}
84. 
85. 				if (show) showOutput(dir, { generate: 'ssr' });
86. 			} catch (err) {
87. 				showOutput(dir, { generate: 'ssr' });
88. 				throw err;
89. 			}
90. 		});
91. 	});
92. 
93. 	// duplicate client-side tests, as far as possible
94. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
95. 		if (dir[0] === ".") return;
96. 
97. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
98. 
99. 		if (config.solo && process.env.CI) {
100. 			throw new Error("Forgot to remove `solo: true` from test");
101. 		}
102. 
103. 		if (config["skip-ssr"]) return;
104. 
105. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
106. 			const cwd = path.resolve("test/runtime/samples", dir);
107. 
108. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
109. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
110. 				delete require.cache[resolved];
111. 			});
112. 
113. 			require("../../ssr/register")({
114. 				store: !!config.store
115. 			});
116. 
117. 			try {
118. 				const component = require(`../runtime/samples/${dir}/main.html`);
119. 				const { html } = component.render(config.data, {
120. 					store: (config.store !== true) && config.store
121. 				});
122. 
123. 				if (config.html) {
124. 					assert.htmlEqual(html, config.html);
125. 				}
126. 			} catch (err) {
127. 				showOutput(cwd, { generate: "ssr" });
128. 				throw err;
129. 			}
130. 		});
131. 	});
132. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 13:29:58,177 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We need to determine if the issue can be classified with the current code context. The provided context includes the SSR generator (index.ts), the SSR Component visitor, the DOM generator for components, store implementation, SSR register, and SSR test harness. These show how options.store is propagated and how child _render expects options.store._init when compiled with store enabled. The bug arises because the parent render only initializes options.store if the root component declares a store, while nested components compiled with store enabled still call options.store._init, leading to undefined in SSR. This is sufficient to classify the issue as a bug without further context.' query='' extra_requirements='' purpose='No additional code is needed; the current files explain the SSR store propagation and reveal the root cause to classify the issue accurately.'
2025-11-12 13:29:58,180 - thread-135845298308800.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='src/generators/nodes/Component.ts', content='1. import deindent from \'../../utils/deindent\';\n2. import { stringify } from \'../../utils/stringify\';\n3. import stringifyProps from \'../../utils/stringifyProps\';\n4. import CodeBuilder from \'../../utils/CodeBuilder\';\n5. import getTailSnippet from \'../../utils/getTailSnippet\';\n6. import getObject from \'../../utils/getObject\';\n7. import getExpressionPrecedence from \'../../utils/getExpressionPrecedence\';\n8. import Node from \'./shared/Node\';\n9. import Block from \'../dom/Block\';\n10. import Attribute from \'./Attribute\';\n11. \n12. export default class Component extends Node {\n13. \ttype: \'Component\';\n14. \tname: string;\n15. \tattributes: Attribute[];\n16. \tchildren: Node[];\n17. \n18. \tinit(\n19. \t\tblock: Block,\n20. \t\tstripWhitespace: boolean,\n21. \t\tnextSibling: Node\n22. \t) {\n23. \t\tthis.cannotUseInnerHTML();\n24. \n25. \t\tthis.attributes.forEach((attribute: Node) => {\n26. \t\t\tif (attribute.type === \'Attribute\' && attribute.value !== true) {\n27. \t\t\t\tattribute.value.forEach((chunk: Node) => {\n28. \t\t\t\t\tif (chunk.type !== \'Text\') {\n29. \t\t\t\t\t\tconst dependencies = chunk.metadata.dependencies;\n30. \t\t\t\t\t\tblock.addDependencies(dependencies);\n31. \t\t\t\t\t}\n32. \t\t\t\t});\n33. \t\t\t} else {\n34. \t\t\t\tif (attribute.type === \'EventHandler\' && attribute.expression) {\n35. \t\t\t\t\tattribute.expression.arguments.forEach((arg: Node) => {\n36. \t\t\t\t\t\tblock.addDependencies(arg.metadata.dependencies);\n37. \t\t\t\t\t});\n38. \t\t\t\t} else if (attribute.type === \'Binding\') {\n39. \t\t\t\t\tblock.addDependencies(attribute.metadata.dependencies);\n40. \t\t\t\t}\n41. \t\t\t}\n42. \t\t});\n43. \n44. \t\tthis.var = block.getUniqueName(\n45. \t\t\t(\n46. \t\t\t\tthis.name === \':Self\' ? this.generator.name :\n47. \t\t\t\tthis.name === \':Component\' ? \'switch_instance\' :\n48. \t\t\t\tthis.name\n49. \t\t\t).toLowerCase()\n50. \t\t);\n51. \n52. \t\tif (this.children.length) {\n53. \t\t\tthis._slots = new Set([\'default\']);\n54. \n55. \t\t\tthis.children.forEach(child => {\n56. \t\t\t\tchild.init(block, stripWhitespace, nextSibling);\n57. \t\t\t});\n58. \t\t}\n59. \t}\n60. \n61. \tbuild(\n62. \t\tblock: Block,\n63. \t\tparentNode: string,\n64. \t\tparentNodes: string\n65. \t) {\n66. \t\tconst { generator } = this;\n67. \t\tgenerator.hasComponents = true;\n68. \n69. \t\tconst name = this.var;\n70. \n71. \t\tconst componentInitProperties = [`root: #component.root`];\n72. \n73. \t\tif (this.children.length > 0) {\n74. \t\t\tconst slots = Array.from(this._slots).map(name => `${name}: @createFragment()`);\n75. \t\t\tcomponentInitProperties.push(`slots: { ${slots.join(\', \')} }`);\n76. \n77. \t\t\tthis.children.forEach((child: Node) => {\n78. \t\t\t\tchild.build(block, `${this.var}._slotted.default`, \'nodes\');\n79. \t\t\t});\n80. \t\t}\n81. \n82. \t\tconst allContexts = new Set();\n83. \t\tconst statements: string[] = [];\n84. \t\tconst name_context = block.getUniqueName(`${name}_context`);\n85. \n86. \t\tlet name_updating: string;\n87. \t\tlet name_initial_data: string;\n88. \t\tlet beforecreate: string = null;\n89. \n90. \t\tconst attributes = this.attributes\n91. \t\t\t.filter(a => a.type === \'Attribute\')\n92. \t\t\t.map(a => mungeAttribute(a, block));\n93. \n94. \t\tconst bindings = this.attributes\n95. \t\t\t.filter(a => a.type === \'Binding\')\n96. \t\t\t.map(a => mungeBinding(a, block));\n97. \n98. \t\tconst eventHandlers = this.attributes\n99. \t\t\t.filter((a: Node) => a.type === \'EventHandler\')\n100. \t\t\t.map(a => mungeEventHandler(generator, this, a, block, name_context, allContexts));\n101. \n102. \t\tconst ref = this.attributes.find((a: Node) => a.type === \'Ref\');\n103. \t\tif (ref) generator.usesRefs = true;\n104. \n105. \t\tconst updates: string[] = [];\n106. \n107. \t\tif (attributes.length || bindings.length) {\n108. \t\t\tconst initialProps = attributes\n109. \t\t\t\t.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);\n110. \n111. \t\t\tconst initialPropString = stringifyProps(initialProps);\n112. \n113. \t\t\tattributes\n114. \t\t\t\t.filter((attribute: Attribute) => attribute.dynamic)\n115. \t\t\t\t.forEach((attribute: Attribute) => {\n116. \t\t\t\t\tif (attribute.dependencies.length) {\n117. \t\t\t\t\t\tupdates.push(deindent`\n118. \t\t\t\t\t\t\tif (${attribute.dependencies\n119. \t\t\t\t\t\t\t\t.map(dependency => `changed.${dependency}`)\n120. \t\t\t\t\t\t\t\t.join(\' || \')}) ${name}_changes.${attribute.name} = ${attribute.value};\n121. \t\t\t\t\t\t`);\n122. \t\t\t\t\t}\n123. \n124. \t\t\t\t\telse {\n125. \t\t\t\t\t\t// TODO this is an odd situation to encounter – I *think* it should only happen with\n126. \t\t\t\t\t\t// each block indices, in which case it may be possible to optimise this\n127. \t\t\t\t\t\tupdates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);\n128. \t\t\t\t\t}\n129. \t\t\t\t});\n130. \n131. \t\t\tif (bindings.length) {\n132. \t\t\t\tgenerator.hasComplexBindings = true;\n133. \n134. \t\t\t\tname_updating = block.alias(`${name}_updating`);\n135. \t\t\t\tname_initial_data = block.getUniqueName(`${name}_initial_data`);\n136. \n137. \t\t\t\tblock.addVariable(name_updating, \'{}\');\n138. \t\t\t\tstatements.push(`var ${name_initial_data} = ${initialPropString};`);\n139. \n140. \t\t\t\tconst setParentFromChildOnChange = new CodeBuilder();\n141. \t\t\t\tconst setParentFromChildOnInit = new CodeBuilder();\n142. \n143. \t\t\t\tbindings.forEach((binding: Binding) => {\n144. \t\t\t\t\tlet setParentFromChild;\n145. \n146. \t\t\t\t\tbinding.contexts.forEach(context => {\n147. \t\t\t\t\t\tallContexts.add(context);\n148. \t\t\t\t\t});\n149. \n150. \t\t\t\t\tconst { name: key } = getObject(binding.value);\n151. \n152. \t\t\t\t\tif (block.contexts.has(key)) {\n153. \t\t\t\t\t\tconst prop = binding.dependencies[0];\n154. \t\t\t\t\t\tconst computed = isComputed(binding.value);\n155. \t\t\t\t\t\tconst tail = binding.value.type === \'MemberExpression\' ? getTailSnippet(binding.value) : \'\';\n156. \n157. \t\t\t\t\t\tsetParentFromChild = deindent`\n158. \t\t\t\t\t\t\tvar list = ${name_context}.${block.listNames.get(key)};\n159. \t\t\t\t\t\t\tvar index = ${name_context}.${block.indexNames.get(key)};\n160. \t\t\t\t\t\t\tlist[index]${tail} = childState.${binding.name};\n161. \n162. \t\t\t\t\t\t\t${binding.dependencies\n163. \t\t\t\t\t\t\t\t.map((prop: string) => `newState.${prop} = state.${prop};`)\n164. \t\t\t\t\t\t\t\t.join(\'\\n\')}\n165. \t\t\t\t\t\t`;\n166. \t\t\t\t\t}\n167. \n168. \t\t\t\t\telse if (binding.value.type === \'MemberExpression\') {\n169. \t\t\t\t\t\tsetParentFromChild = deindent`\n170. \t\t\t\t\t\t\t${binding.snippet} = childState.${binding.name};\n171. \t\t\t\t\t\t\t${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join(\'\\n\')}\n172. \t\t\t\t\t\t`;\n173. \t\t\t\t\t}\n174. \n175. \t\t\t\t\telse {\n176. \t\t\t\t\t\tsetParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;\n177. \t\t\t\t\t}\n178. \n179. \t\t\t\t\tstatements.push(deindent`\n180. \t\t\t\t\t\tif (${binding.prop} in ${binding.obj}) {\n181. \t\t\t\t\t\t\t${name_initial_data}.${binding.name} = ${binding.snippet};\n182. \t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n183. \t\t\t\t\t\t}`\n184. \t\t\t\t\t);\n185. \n186. \t\t\t\t\tsetParentFromChildOnChange.addConditional(\n187. \t\t\t\t\t\t`!${name_updating}.${binding.name} && changed.${binding.name}`,\n188. \t\t\t\t\t\tsetParentFromChild\n189. \t\t\t\t\t);\n190. \n191. \t\t\t\t\tsetParentFromChildOnInit.addConditional(\n192. \t\t\t\t\t\t`!${name_updating}.${binding.name}`,\n193. \t\t\t\t\t\tsetParentFromChild\n194. \t\t\t\t\t);\n195. \n196. \t\t\t\t\t// TODO could binding.dependencies.length ever be 0?\n197. \t\t\t\t\tif (binding.dependencies.length) {\n198. \t\t\t\t\t\tupdates.push(deindent`\n199. \t\t\t\t\t\t\tif (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(\' || \')}) {\n200. \t\t\t\t\t\t\t\t${name}_changes.${binding.name} = ${binding.snippet};\n201. \t\t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n202. \t\t\t\t\t\t\t}\n203. \t\t\t\t\t\t`);\n204. \t\t\t\t\t}\n205. \t\t\t\t});\n206. \n207. \t\t\t\tcomponentInitProperties.push(`data: ${name_initial_data}`);\n208. \n209. \t\t\t\tcomponentInitProperties.push(deindent`\n210. \t\t\t\t\t_bind: function(changed, childState) {\n211. \t\t\t\t\t\tvar state = #component.get(), newState = {};\n212. \t\t\t\t\t\t${setParentFromChildOnChange}\n213. \t\t\t\t\t\t${name_updating} = @assign({}, changed);\n214. \t\t\t\t\t\t#component._set(newState);\n215. \t\t\t\t\t\t${name_updating} = {};\n216. \t\t\t\t\t}\n217. \t\t\t\t`);\n218. \n219. \t\t\t\tbeforecreate = deindent`\n220. \t\t\t\t\t#component.root._beforecreate.push(function() {\n221. \t\t\t\t\t\tvar state = #component.get(), childState = ${name}.get(), newState = {};\n222. \t\t\t\t\t\tif (!childState) return;\n223. \t\t\t\t\t\t${setParentFromChildOnInit}\n224. \t\t\t\t\t\t${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(\', \')} };\n225. \t\t\t\t\t\t#component._set(newState);\n226. \t\t\t\t\t\t${name_updating} = {};\n227. \t\t\t\t\t});\n228. \t\t\t\t`;\n229. \t\t\t} else if (initialProps.length) {\n230. \t\t\t\tcomponentInitProperties.push(`data: ${initialPropString}`);\n231. \t\t\t}\n232. \t\t}\n233. \n234. \t\tconst isDynamicComponent = this.name === \':Component\';\n235. \n236. \t\tconst switch_vars = isDynamicComponent && {\n237. \t\t\tvalue: block.getUniqueName(\'switch_value\'),\n238. \t\t\tprops: block.getUniqueName(\'switch_props\')\n239. \t\t};\n240. \n241. \t\tconst expression = (\n242. \t\t\tthis.name === \':Self\' ? generator.name :\n243. \t\t\tisDynamicComponent ? switch_vars.value :\n244. \t\t\t`%components-${this.name}`\n245. \t\t);\n246. \n247. \t\tif (isDynamicComponent) {\n248. \t\t\tblock.contextualise(this.expression);\n249. \t\t\tconst { dependencies, snippet } = this.metadata;\n250. \n251. \t\t\tconst anchor = this.getOrCreateAnchor(block, parentNode, parentNodes);\n252. \n253. \t\t\tconst params = block.params.join(\', \');\n254. \n255. \t\t\tblock.builders.init.addBlock(deindent`\n256. \t\t\t\tvar ${switch_vars.value} = ${snippet};\n257. \n258. \t\t\t\tfunction ${switch_vars.props}(${params}) {\n259. \t\t\t\t\t${statements.length > 0 && statements.join(\'\\n\')}\n260. \t\t\t\t\treturn {\n261. \t\t\t\t\t\t${componentInitProperties.join(\',\\n\')}\n262. \t\t\t\t\t};\n263. \t\t\t\t}\n264. \n265. \t\t\t\tif (${switch_vars.value}) {\n266. \t\t\t\t\tvar ${name} = new ${expression}(${switch_vars.props}(${params}));\n267. \n268. \t\t\t\t\t${beforecreate}\n269. \t\t\t\t}\n270. \n271. \t\t\t\t${eventHandlers.map(handler => deindent`\n272. \t\t\t\t\tfunction ${handler.var}(event) {\n273. \t\t\t\t\t\t${handler.body}\n274. \t\t\t\t\t}\n275. \n276. \t\t\t\t\tif (${name}) ${name}.on("${handler.name}", ${handler.var});\n277. \t\t\t\t`)}\n278. \t\t\t`);\n279. \n280. \t\t\tblock.builders.create.addLine(\n281. \t\t\t\t`if (${name}) ${name}._fragment.c();`\n282. \t\t\t);\n283. \n284. \t\t\tif (parentNodes) {\n285. \t\t\t\tblock.builders.claim.addLine(\n286. \t\t\t\t\t`if (${name}) ${name}._fragment.l(${parentNodes});`\n287. \t\t\t\t);\n288. \t\t\t}\n289. \n290. \t\t\tblock.builders.mount.addLine(\n291. \t\t\t\t`if (${name}) ${name}._mount(${parentNode || \'#target\'}, ${parentNode ? \'null\' : \'anchor\'});`\n292. \t\t\t);\n293. \n294. \t\t\tconst updateMountNode = this.getUpdateMountNode(anchor);\n295. \n296. \t\t\tblock.builders.update.addBlock(deindent`\n297. \t\t\t\tif (${switch_vars.value} !== (${switch_vars.value} = ${snippet})) {\n298. \t\t\t\t\tif (${name}) ${name}.destroy();\n299. \n300. \t\t\t\t\tif (${switch_vars.value}) {\n301. \t\t\t\t\t\t${name} = new ${switch_vars.value}(${switch_vars.props}(${params}));\n302. \t\t\t\t\t\t${name}._fragment.c();\n303. \n304. \t\t\t\t\t\t${this.children.map(child => remount(generator, child, name))}\n305. \t\t\t\t\t\t${name}._mount(${updateMountNode}, ${anchor});\n306. \n307. \t\t\t\t\t\t${eventHandlers.map(handler => deindent`\n308. \t\t\t\t\t\t\t${name}.on("${handler.name}", ${handler.var});\n309. \t\t\t\t\t\t`)}\n310. \n311. \t\t\t\t\t\t${ref && `#component.refs.${ref.name} = ${name};`}\n312. \t\t\t\t\t}\n313. \n314. \t\t\t\t\t${ref && deindent`\n315. \t\t\t\t\t\telse if (#component.refs.${ref.name} === ${name}) {\n316. \t\t\t\t\t\t\t#component.refs.${ref.name} = null;\n317. \t\t\t\t\t\t}`}\n318. \t\t\t\t}\n319. \t\t\t`);\n320. \n321. \t\t\tif (updates.length) {\n322. \t\t\t\tblock.builders.update.addBlock(deindent`\n323. \t\t\t\t\telse {\n324. \t\t\t\t\t\tvar ${name}_changes = {};\n325. \t\t\t\t\t\t${updates.join(\'\\n\')}\n326. \t\t\t\t\t\t${name}._set(${name}_changes);\n327. \t\t\t\t\t\t${bindings.length && `${name_updating} = {};`}\n328. \t\t\t\t\t}\n329. \t\t\t\t`);\n330. \t\t\t}\n331. \n332. \t\t\tif (!parentNode) block.builders.unmount.addLine(`if (${name}) ${name}._unmount();`);\n333. \n334. \t\t\tblock.builders.destroy.addLine(`if (${name}) ${name}.destroy(false);`);\n335. \t\t} else {\n336. \t\t\tblock.builders.init.addBlock(deindent`\n337. \t\t\t\t${statements.join(\'\\n\')}\n338. \t\t\t\tvar ${name} = new ${expression}({\n339. \t\t\t\t\t${componentInitProperties.join(\',\\n\')}\n340. \t\t\t\t});\n341. \n342. \t\t\t\t${beforecreate}\n343. \n344. \t\t\t\t${eventHandlers.map(handler => deindent`\n345. \t\t\t\t\t${name}.on("${handler.name}", function(event) {\n346. \t\t\t\t\t\t${handler.body}\n347. \t\t\t\t\t});\n348. \t\t\t\t`)}\n349. \n350. \t\t\t\t${ref && `#component.refs.${ref.name} = ${name};`}\n351. \t\t\t`);\n352. \n353. \t\t\tblock.builders.create.addLine(`${name}._fragment.c();`);\n354. \n355. \t\t\tif (parentNodes) {\n356. \t\t\t\tblock.builders.claim.addLine(\n357. \t\t\t\t\t`${name}._fragment.l(${parentNodes});`\n358. \t\t\t\t);\n359. \t\t\t}\n360. \n361. \t\t\tblock.builders.mount.addLine(\n362. \t\t\t\t`${name}._mount(${parentNode || \'#target\'}, ${parentNode ? \'null\' : \'anchor\'});`\n363. \t\t\t);\n364. \n365. \t\t\tif (updates.length) {\n366. \t\t\t\tblock.builders.update.addBlock(deindent`\n367. \t\t\t\t\tvar ${name}_changes = {};\n368. \t\t\t\t\t${updates.join(\'\\n\')}\n369. \t\t\t\t\t${name}._set(${name}_changes);\n370. \t\t\t\t\t${bindings.length && `${name_updating} = {};`}\n371. \t\t\t\t`);\n372. \t\t\t}\n373. \n374. \t\t\tif (!parentNode) block.builders.unmount.addLine(`${name}._unmount();`);\n375. \n376. \t\t\tblock.builders.destroy.addLine(deindent`\n377. \t\t\t\t${name}.destroy(false);\n378. \t\t\t\t${ref && `if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;`}\n379. \t\t\t`);\n380. \t\t}\n381. \n382. \t\t// maintain component context\n383. \t\tif (allContexts.size) {\n384. \t\t\tconst contexts = Array.from(allContexts);\n385. \n386. \t\t\tconst initialProps = contexts\n387. \t\t\t\t.map(contextName => {\n388. \t\t\t\t\tif (contextName === \'state\') return `state: state`;\n389. \n390. \t\t\t\t\tconst listName = block.listNames.get(contextName);\n391. \t\t\t\t\tconst indexName = block.indexNames.get(contextName);\n392. \n393. \t\t\t\t\treturn `${listName}: ${listName},\\n${indexName}: ${indexName}`;\n394. \t\t\t\t})\n395. \t\t\t\t.join(\',\\n\');\n396. \n397. \t\t\tconst updates = contexts\n398. \t\t\t\t.map(contextName => {\n399. \t\t\t\t\tif (contextName === \'state\') return `${name_context}.state = state;`;\n400. \n401. \t\t\t\t\tconst listName = block.listNames.get(contextName);\n402. \t\t\t\t\tconst indexName = block.indexNames.get(contextName);\n403. \n404. \t\t\t\t\treturn `${name_context}.${listName} = ${listName};\\n${name_context}.${indexName} = ${indexName};`;\n405. \t\t\t\t})\n406. \t\t\t\t.join(\'\\n\');\n407. \n408. \t\t\tblock.builders.init.addBlock(deindent`\n409. \t\t\t\tvar ${name_context} = {\n410. \t\t\t\t\t${initialProps}\n411. \t\t\t\t};\n412. \t\t\t`);\n413. \n414. \t\t\tblock.builders.update.addBlock(updates);\n415. \t\t}\n416. \t}\n417. }\n418. \n419. function mungeAttribute(attribute: Node, block: Block): Attribute {\n420. \tif (attribute.value === true) {\n421. \t\t// attributes without values, e.g. <textarea readonly>\n422. \t\treturn {\n423. \t\t\tname: attribute.name,\n424. \t\t\tvalue: true,\n425. \t\t\tdynamic: false\n426. \t\t};\n427. \t}\n428. \n429. \tif (attribute.value.length === 0) {\n430. \t\treturn {\n431. \t\t\tname: attribute.name,\n432. \t\t\tvalue: `\'\'`,\n433. \t\t\tdynamic: false\n434. \t\t};\n435. \t}\n436. \n437. \tif (attribute.value.length === 1) {\n438. \t\tconst value = attribute.value[0];\n439. \n440. \t\tif (value.type === \'Text\') {\n441. \t\t\t// static attributes\n442. \t\t\treturn {\n443. \t\t\t\tname: attribute.name,\n444. \t\t\t\tvalue: isNaN(value.data) ? stringify(value.data) : value.data,\n445. \t\t\t\tdynamic: false\n446. \t\t\t};\n447. \t\t}\n448. \n449. \t\t// simple dynamic attributes\n450. \t\tblock.contextualise(value.expression); // TODO remove\n451. \t\tconst { dependencies, snippet } = value.metadata;\n452. \n453. \t\t// TODO only update attributes that have changed\n454. \t\treturn {\n455. \t\t\tname: attribute.name,\n456. \t\t\tvalue: snippet,\n457. \t\t\tdependencies,\n458. \t\t\tdynamic: true\n459. \t\t};\n460. \t}\n461. \n462. \t// otherwise we\'re dealing with a complex dynamic attribute\n463. \tconst allDependencies = new Set();\n464. \n465. \tconst value =\n466. \t\t(attribute.value[0].type === \'Text\' ? \'\' : `"" + `) +\n467. \t\tattribute.value\n468. \t\t\t.map((chunk: Node) => {\n469. \t\t\t\tif (chunk.type === \'Text\') {\n470. \t\t\t\t\treturn stringify(chunk.data);\n471. \t\t\t\t} else {\n472. \t\t\t\t\tblock.contextualise(chunk.expression); // TODO remove\n473. \t\t\t\t\tconst { dependencies, snippet } = chunk.metadata;\n474. \n475. \t\t\t\t\tdependencies.forEach((dependency: string) => {\n476. \t\t\t\t\t\tallDependencies.add(dependency);\n477. \t\t\t\t\t});\n478. \n479. \t\t\t\t\treturn getExpressionPrecedence(chunk.expression) <= 13 ? `(${snippet})` : snippet;\n480. \t\t\t\t}\n481. \t\t\t})\n482. \t\t\t.join(\' + \');\n483. \n484. \treturn {\n485. \t\tname: attribute.name,\n486. \t\tvalue,\n487. \t\tdependencies: Array.from(allDependencies),\n488. \t\tdynamic: true\n489. \t};\n490. }\n491. \n492. function mungeBinding(binding: Node, block: Block): Binding {\n493. \tconst { name } = getObject(binding.value);\n494. \tconst { contexts } = block.contextualise(binding.value);\n495. \tconst { dependencies, snippet } = binding.metadata;\n496. \n497. \tconst contextual = block.contexts.has(name);\n498. \n499. \tlet obj;\n500. \tlet prop;\n501. \n502. \tif (contextual) {\n503. \t\tobj = block.listNames.get(name);\n504. \t\tprop = block.indexNames.get(name);\n505. \t} else if (binding.value.type === \'MemberExpression\') {\n506. \t\tprop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;\n507. \t\tif (!binding.value.computed) prop = `\'${prop}\'`;\n508. \t\tobj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;\n509. \t} else {\n510. \t\tobj = \'state\';\n511. \t\tprop = `\'${name}\'`;\n512. \t}\n513. \n514. \treturn {\n515. \t\tname: binding.name,\n516. \t\tvalue: binding.value,\n517. \t\tcontexts,\n518. \t\tsnippet,\n519. \t\tobj,\n520. \t\tprop,\n521. \t\tdependencies\n522. \t};\n523. }\n524. \n525. function mungeEventHandler(generator: DomGenerator, node: Node, handler: Node, block: Block, name_context: string, allContexts: Set<string>) {\n526. \tlet body;\n527. \n528. \tif (handler.expression) {\n529. \t\tgenerator.addSourcemapLocations(handler.expression);\n530. \t\tgenerator.code.prependRight(\n531. \t\t\thandler.expression.start,\n532. \t\t\t`${block.alias(\'component\')}.`\n533. \t\t);\n534. \n535. \t\tconst usedContexts: string[] = [];\n536. \n537. \t\thandler.expression.arguments.forEach((arg: Node) => {\n538. \t\t\tconst { contexts } = block.contextualise(arg, null, true);\n539. \n540. \t\t\tcontexts.forEach(context => {\n541. \t\t\t\tif (!~usedContexts.indexOf(context)) usedContexts.push(context);\n542. \t\t\t\tallContexts.add(context);\n543. \t\t\t});\n544. \t\t});\n545. \n546. \t\t// TODO hoist event handlers? can do `this.__component.method(...)`\n547. \t\tconst declarations = usedContexts.map(name => {\n548. \t\t\tif (name === \'state\') return `var state = ${name_context}.state;`;\n549. \n550. \t\t\tconst listName = block.listNames.get(name);\n551. \t\t\tconst indexName = block.indexNames.get(name);\n552. \n553. \t\t\treturn `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;\n554. \t\t});\n555. \n556. \t\tbody = deindent`\n557. \t\t\t${declarations}\n558. \n559. \t\t\t[✂${handler.expression.start}-${handler.expression.end}✂];\n560. \t\t`;\n561. \t} else {\n562. \t\tbody = deindent`\n563. \t\t\t${block.alias(\'component\')}.fire(\'${handler.name}\', event);\n564. \t\t`;\n565. \t}\n566. \n567. \treturn {\n568. \t\tname: handler.name,\n569. \t\tvar: block.getUniqueName(`${node.var}_${handler.name}`),\n570. \t\tbody\n571. \t};\n572. }\n573. \n574. function isComputed(node: Node) {\n575. \twhile (node.type === \'MemberExpression\') {\n576. \t\tif (node.computed) return true;\n577. \t\tnode = node.object;\n578. \t}\n579. \n580. \treturn false;\n581. }\n582. \n583. function remount(generator: DomGenerator, node: Node, name: string) {\n584. \t// TODO make this a method of the nodes\n585. \n586. \tif (node.type === \'Component\') {\n587. \t\treturn `${node.var}._mount(${name}._slotted.default, null);`;\n588. \t}\n589. \n590. \tif (node.type === \'Element\') {\n591. \t\tconst slot = node.attributes.find(attribute => attribute.name === \'slot\');\n592. \t\tif (slot) {\n593. \t\t\treturn `@appendNode(${node.var}, ${name}._slotted.${node.getStaticAttributeValue(\'slot\')});`;\n594. \t\t}\n595. \n596. \t\treturn `@appendNode(${node.var}, ${name}._slotted.default);`;\n597. \t}\n598. \n599. \tif (node.type === \'Text\' || node.type === \'MustacheTag\' || node.type === \'RawMustacheTag\') {\n600. \t\treturn `@appendNode(${node.var}, ${name}._slotted.default);`;\n601. \t}\n602. \n603. \tif (node.type === \'EachBlock\') {\n604. \t\t// TODO consider keyed blocks\n605. \t\treturn `for (var #i = 0; #i < ${node.iterations}.length; #i += 1) ${node.iterations}[#i].m(${name}._slotted.default, null);`;\n606. \t}\n607. \n608. \treturn `${node.var}.m(${name}._slotted.default, null);`;\n609. }', start_line_number=1, end_line_number=609), Context(relative_path='src/generators/server-side-rendering/Block.ts', content="1. import deindent from '../../utils/deindent';\n2. import flattenReference from '../../utils/flattenReference';\n3. import { SsrGenerator } from './index';\n4. import { Node } from '../../interfaces';\n5. import getObject from '../../utils/getObject';\n6. \n7. interface BlockOptions {\n8. \t// TODO\n9. }\n10. \n11. export default class Block {\n12. \tgenerator: SsrGenerator;\n13. \tconditions: string[];\n14. \n15. \tcontexts: Map<string, string>;\n16. \tindexes: Map<string, string>;\n17. \tcontextDependencies: Map<string, string[]>;\n18. \n19. \tconstructor(options: BlockOptions) {\n20. \t\tObject.assign(this, options);\n21. \t}\n22. \n23. \taddBinding(binding: Node, name: string) {\n24. \t\tconst conditions = [`!('${binding.name}' in state)`].concat(\n25. \t\t\t// TODO handle contextual bindings...\n26. \t\t\tthis.conditions.map(c => `(${c})`)\n27. \t\t);\n28. \n29. \t\tconst { name: prop } = getObject(binding.value);\n30. \n31. \t\tthis.generator.bindings.push(deindent`\n32. \t\t\tif (${conditions.join('&&')}) {\n33. \t\t\t\ttmp = ${name}.data();\n34. \t\t\t\tif ('${prop}' in tmp) {\n35. \t\t\t\t\tstate.${binding.name} = tmp.${prop};\n36. \t\t\t\t\tsettled = false;\n37. \t\t\t\t}\n38. \t\t\t}\n39. \t\t`);\n40. \t}\n41. \n42. \tchild(options: BlockOptions) {\n43. \t\treturn new Block(Object.assign({}, this, options, { parent: this }));\n44. \t}\n45. \n46. \tcontextualise(expression: Node, context?: string, isEventHandler?: boolean) {\n47. \t\treturn this.generator.contextualise(this.contexts, this.indexes, expression, context, isEventHandler);\n48. \t}\n49. }", start_line_number=1, end_line_number=49), Context(relative_path='src/generators/server-side-rendering/index.ts', content='1. import deindent from \'../../utils/deindent\';\n2. import Generator from \'../Generator\';\n3. import Stylesheet from \'../../css/Stylesheet\';\n4. import Block from \'./Block\';\n5. import visit from \'./visit\';\n6. import { removeNode, removeObjectKey } from \'../../utils/removeNode\';\n7. import getName from \'../../utils/getName\';\n8. import globalWhitelist from \'../../utils/globalWhitelist\';\n9. import { Parsed, Node, CompileOptions } from \'../../interfaces\';\n10. import { AppendTarget } from \'./interfaces\';\n11. import { stringify } from \'../../utils/stringify\';\n12. \n13. export class SsrGenerator extends Generator {\n14. \tbindings: string[];\n15. \trenderCode: string;\n16. \tappendTargets: AppendTarget[];\n17. \n18. \tconstructor(\n19. \t\tparsed: Parsed,\n20. \t\tsource: string,\n21. \t\tname: string,\n22. \t\tstylesheet: Stylesheet,\n23. \t\toptions: CompileOptions\n24. \t) {\n25. \t\tsuper(parsed, source, name, stylesheet, options, false);\n26. \t\tthis.bindings = [];\n27. \t\tthis.renderCode = \'\';\n28. \t\tthis.appendTargets = [];\n29. \n30. \t\tthis.stylesheet.warnOnUnusedSelectors(options.onwarn);\n31. \t}\n32. \n33. \tappend(code: string) {\n34. \t\tif (this.appendTargets.length) {\n35. \t\t\tconst appendTarget = this.appendTargets[this.appendTargets.length - 1];\n36. \t\t\tconst slotName = appendTarget.slotStack[appendTarget.slotStack.length - 1];\n37. \t\t\tappendTarget.slots[slotName] += code;\n38. \t\t} else {\n39. \t\t\tthis.renderCode += code;\n40. \t\t}\n41. \t}\n42. }\n43. \n44. export default function ssr(\n45. \tparsed: Parsed,\n46. \tsource: string,\n47. \tstylesheet: Stylesheet,\n48. \toptions: CompileOptions\n49. ) {\n50. \tconst format = options.format || \'cjs\';\n51. \n52. \tconst generator = new SsrGenerator(parsed, source, options.name || \'SvelteComponent\', stylesheet, options);\n53. \n54. \tconst { computations, name, templateProperties } = generator;\n55. \n56. \t// create main render() function\n57. \tconst mainBlock = new Block({\n58. \t\tgenerator,\n59. \t\tcontexts: new Map(),\n60. \t\tindexes: new Map(),\n61. \t\tconditions: [],\n62. \t});\n63. \n64. \ttrim(parsed.html.children).forEach((node: Node) => {\n65. \t\tvisit(generator, mainBlock, node);\n66. \t});\n67. \n68. \tconst { css, cssMap } = generator.customElement ?\n69. \t\t{ css: null, cssMap: null } :\n70. \t\tgenerator.stylesheet.render(options.filename, true);\n71. \n72. \t// generate initial state object\n73. \tconst expectedProperties = Array.from(generator.expectedProperties);\n74. \tconst globals = expectedProperties.filter(prop => globalWhitelist.has(prop));\n75. \tconst storeProps = options.store || templateProperties.store ? expectedProperties.filter(prop => prop[0] === \'$\') : [];\n76. \n77. \tconst initialState = [];\n78. \tif (globals.length > 0) {\n79. \t\tinitialState.push(`{ ${globals.map(prop => `${prop} : ${prop}`).join(\', \')} }`);\n80. \t}\n81. \n82. \tif (storeProps.length > 0) {\n83. \t\tconst initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`\n84. \t\tif (options.store || templateProperties.store) {\n85. \t\t\tinitialState.push(`options.store.${initialize}`);\n86. \t\t}\n87. \t}\n88. \n89. \tif (templateProperties.data) {\n90. \t\tinitialState.push(`%data()`);\n91. \t} else if (globals.length === 0 && storeProps.length === 0) {\n92. \t\tinitialState.push(\'{}\');\n93. \t}\n94. \n95. \tinitialState.push(\'state\');\n96. \n97. \t// TODO concatenate CSS maps\n98. \tconst result = deindent`\n99. \t\t${generator.javascript}\n100. \n101. \t\tvar ${name} = {};\n102. \n103. \t\t${options.filename && `${name}.filename = ${stringify(options.filename)}`};\n104. \n105. \t\t${name}.data = function() {\n106. \t\t\treturn ${templateProperties.data ? `%data()` : `{}`};\n107. \t\t};\n108. \n109. \t\t${name}.render = function(state, options = {}) {\n110. \t\t\tvar components = new Set();\n111. \n112. \t\t\tfunction addComponent(component) {\n113. \t\t\t\tcomponents.add(component);\n114. \t\t\t}\n115. \n116. \t\t\tvar result = { head: \'\', addComponent };\n117. \t\t\t${templateProperties.store && `options.store = %store();`}\n118. \t\t\tvar html = ${name}._render(result, state, options);\n119. \n120. \t\t\tvar cssCode = Array.from(components).map(c => c.css && c.css.code).filter(Boolean).join(\'\\\\n\');\n121. \n122. \t\t\treturn {\n123. \t\t\t\thtml,\n124. \t\t\t\thead: result.head,\n125. \t\t\t\tcss: { code: cssCode, map: null },\n126. \t\t\t\ttoString() {\n127. \t\t\t\t\treturn html;\n128. \t\t\t\t}\n129. \t\t\t};\n130. \t\t}\n131. \n132. \t\t${name}._render = function(__result, state, options) {\n133. \t\t\t__result.addComponent(${name});\n134. \n135. \t\t\tstate = Object.assign(${initialState.join(\', \')});\n136. \n137. \t\t\t${computations.map(\n138. \t\t\t\t({ key, deps }) =>\n139. \t\t\t\t\t`state.${key} = %computed-${key}(${deps.map(dep => `state.${dep}`).join(\', \')});`\n140. \t\t\t)}\n141. \n142. \t\t\t${generator.bindings.length &&\n143. \t\t\t\tdeindent`\n144. \t\t\t\tvar settled = false;\n145. \t\t\t\tvar tmp;\n146. \n147. \t\t\t\twhile (!settled) {\n148. \t\t\t\t\tsettled = true;\n149. \n150. \t\t\t\t\t${generator.bindings.join(\'\\n\\n\')}\n151. \t\t\t\t}\n152. \t\t\t`}\n153. \n154. \t\t\treturn \\`${generator.renderCode}\\`;\n155. \t\t};\n156. \n157. \t\t${name}.css = {\n158. \t\t\tcode: ${css ? stringify(css) : `\'\'`},\n159. \t\t\tmap: ${cssMap ? stringify(cssMap.toString()) : \'null\'}\n160. \t\t};\n161. \n162. \t\tvar warned = false;\n163. \t\t${name}.renderCss = function() {\n164. \t\t\tif (!warned) {\n165. \t\t\t\tconsole.error(\'Component.renderCss(...) is deprecated and will be removed in v2 — use Component.render(...).css instead\');\n166. \t\t\t\twarned = true;\n167. \t\t\t}\n168. \n169. \t\t\tvar components = [];\n170. \n171. \t\t\t${generator.stylesheet.hasStyles &&\n172. \t\t\t\tdeindent`\n173. \t\t\t\tcomponents.push({\n174. \t\t\t\t\tfilename: ${name}.filename,\n175. \t\t\t\t\tcss: ${name}.css && ${name}.css.code,\n176. \t\t\t\t\tmap: ${name}.css && ${name}.css.map\n177. \t\t\t\t});\n178. \t\t\t`}\n179. \n180. \t\t\t${templateProperties.components &&\n181. \t\t\t\tdeindent`\n182. \t\t\t\tvar seen = {};\n183. \n184. \t\t\t\tfunction addComponent(component) {\n185. \t\t\t\t\tvar result = component.renderCss();\n186. \t\t\t\t\tresult.components.forEach(x => {\n187. \t\t\t\t\t\tif (seen[x.filename]) return;\n188. \t\t\t\t\t\tseen[x.filename] = true;\n189. \t\t\t\t\t\tcomponents.push(x);\n190. \t\t\t\t\t});\n191. \t\t\t\t}\n192. \n193. \t\t\t\t${templateProperties.components.value.properties.map((prop: Node) => {\n194. \t\t\t\t\treturn `addComponent(%components-${getName(prop.key)});`;\n195. \t\t\t\t})}\n196. \t\t\t`}\n197. \n198. \t\t\treturn {\n199. \t\t\t\tcss: components.map(x => x.css).join(\'\\\\n\'),\n200. \t\t\t\tmap: null,\n201. \t\t\t\tcomponents\n202. \t\t\t};\n203. \t\t};\n204. \n205. \t\t${templateProperties.preload && `${name}.preload = %preload;`}\n206. \n207. \t\t${\n208. \t\t\t// TODO this is a bit hacky\n209. \t\t\t/__escape/.test(generator.renderCode) && deindent`\n210. \t\t\t\tvar escaped = {\n211. \t\t\t\t\t\'"\': \'&quot;\',\n212. \t\t\t\t\t"\'": \'&##39;\',\n213. \t\t\t\t\t\'&\': \'&amp;\',\n214. \t\t\t\t\t\'<\': \'&lt;\',\n215. \t\t\t\t\t\'>\': \'&gt;\'\n216. \t\t\t\t};\n217. \n218. \t\t\t\tfunction __escape(html) {\n219. \t\t\t\t\treturn String(html).replace(/["\'&<>]/g, match => escaped[match]);\n220. \t\t\t\t}\n221. \t\t\t`\n222. \t\t}\n223. \n224. \t\t${\n225. \t\t\t/__isPromise/.test(generator.renderCode) && deindent`\n226. \t\t\t\tfunction __isPromise(value) {\n227. \t\t\t\t\treturn value && typeof value.then === \'function\';\n228. \t\t\t\t}\n229. \t\t\t`\n230. \t\t}\n231. \n232. \t\t${\n233. \t\t\t/__missingComponent/.test(generator.renderCode) && deindent`\n234. \t\t\t\tvar __missingComponent = {\n235. \t\t\t\t\t_render: () => \'\'\n236. \t\t\t\t};\n237. \t\t\t`\n238. \t\t}\n239. \t`.replace(/(@+|#+|%+)(\\w*(?:-\\w*)?)/g, (match: string, sigil: string, name: string) => {\n240. \t\tif (sigil === \'@\') return generator.alias(name);\n241. \t\tif (sigil === \'%\') return generator.templateVars.get(name);\n242. \t\treturn sigil.slice(1) + name;\n243. \t});\n244. \n245. \treturn generator.generate(result, options, { name, format });\n246. }\n247. \n248. function trim(nodes) {\n249. \tlet start = 0;\n250. \tfor (; start < nodes.length; start += 1) {\n251. \t\tconst node = nodes[start];\n252. \t\tif (node.type !== \'Text\') break;\n253. \n254. \t\tnode.data = node.data.replace(/^\\s+/, \'\');\n255. \t\tif (node.data) break;\n256. \t}\n257. \n258. \tlet end = nodes.length;\n259. \tfor (; end > start; end -= 1) {\n260. \t\tconst node = nodes[end - 1];\n261. \t\tif (node.type !== \'Text\') break;\n262. \n263. \t\tnode.data = node.data.replace(/\\s+$/, \'\');\n264. \t\tif (node.data) break;\n265. \t}\n266. \n267. \treturn nodes.slice(start, end);\n268. }', start_line_number=1, end_line_number=268), Context(relative_path='src/generators/server-side-rendering/visitors/Component.ts', content="1. import flattenReference from '../../../utils/flattenReference';\n2. import visit from '../visit';\n3. import { SsrGenerator } from '../index';\n4. import Block from '../Block';\n5. import { AppendTarget } from '../interfaces';\n6. import { Node } from '../../../interfaces';\n7. import getObject from '../../../utils/getObject';\n8. import getTailSnippet from '../../../utils/getTailSnippet';\n9. import { stringify } from '../../../utils/stringify';\n10. \n11. export default function visitComponent(\n12. \tgenerator: SsrGenerator,\n13. \tblock: Block,\n14. \tnode: Node\n15. ) {\n16. \tfunction stringifyAttribute(chunk: Node) {\n17. \t\tif (chunk.type === 'Text') return chunk.data;\n18. \t\tif (chunk.type === 'MustacheTag') {\n19. \t\t\tblock.contextualise(chunk.expression);\n20. \t\t\tconst { snippet } = chunk.metadata;\n21. \t\t\treturn '${__escape( ' + snippet + ')}';\n22. \t\t}\n23. \t}\n24. \n25. \tconst attributes: Node[] = [];\n26. \tconst bindings: Node[] = [];\n27. \n28. \tnode.attributes.forEach((attribute: Node) => {\n29. \t\tif (attribute.type === 'Attribute') {\n30. \t\t\tattributes.push(attribute);\n31. \t\t} else if (attribute.type === 'Binding') {\n32. \t\t\tbindings.push(attribute);\n33. \t\t}\n34. \t});\n35. \n36. \tconst props = attributes\n37. \t\t.map(attribute => {\n38. \t\t\tlet value;\n39. \n40. \t\t\tif (attribute.value === true) {\n41. \t\t\t\tvalue = `true`;\n42. \t\t\t} else if (attribute.value.length === 0) {\n43. \t\t\t\tvalue = `''`;\n44. \t\t\t} else if (attribute.value.length === 1) {\n45. \t\t\t\tconst chunk = attribute.value[0];\n46. \t\t\t\tif (chunk.type === 'Text') {\n47. \t\t\t\t\tvalue = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;\n48. \t\t\t\t} else {\n49. \t\t\t\t\tblock.contextualise(chunk.expression);\n50. \t\t\t\t\tconst { snippet } = chunk.metadata;\n51. \t\t\t\t\tvalue = snippet;\n52. \t\t\t\t}\n53. \t\t\t} else {\n54. \t\t\t\tvalue = '`' + attribute.value.map(stringifyAttribute).join('') + '`';\n55. \t\t\t}\n56. \n57. \t\t\treturn `${attribute.name}: ${value}`;\n58. \t\t})\n59. \t\t.concat(\n60. \t\t\tbindings.map(binding => {\n61. \t\t\t\tconst { name } = getObject(binding.value);\n62. \t\t\t\tconst tail = binding.value.type === 'MemberExpression'\n63. \t\t\t\t\t? getTailSnippet(binding.value)\n64. \t\t\t\t\t: '';\n65. \n66. \t\t\t\tconst keypath = block.contexts.has(name)\n67. \t\t\t\t\t? `${name}${tail}`\n68. \t\t\t\t\t: `state.${name}${tail}`;\n69. \t\t\t\treturn `${binding.name}: ${keypath}`;\n70. \t\t\t})\n71. \t\t)\n72. \t\t.join(', ');\n73. \n74. \tconst isDynamicComponent = node.name === ':Component';\n75. \tif (isDynamicComponent) block.contextualise(node.expression);\n76. \n77. \tconst expression = (\n78. \t\tnode.name === ':Self' ? generator.name :\n79. \t\tisDynamicComponent ? `((${node.metadata.snippet}) || __missingComponent)` :\n80. \t\t`%components-${node.name}`\n81. \t);\n82. \n83. \tbindings.forEach(binding => {\n84. \t\tblock.addBinding(binding, expression);\n85. \t});\n86. \n87. \tlet open = `\\${${expression}._render(__result, {${props}}`;\n88. \n89. \tconst options = [];\n90. \tif (generator.options.store) {\n91. \t\toptions.push(`store: options.store`);\n92. \t}\n93. \n94. \tif (node.children.length) {\n95. \t\tconst appendTarget: AppendTarget = {\n96. \t\t\tslots: { default: '' },\n97. \t\t\tslotStack: ['default']\n98. \t\t};\n99. \n100. \t\tgenerator.appendTargets.push(appendTarget);\n101. \n102. \t\tnode.children.forEach((child: Node) => {\n103. \t\t\tvisit(generator, block, child);\n104. \t\t});\n105. \n106. \t\tconst slotted = Object.keys(appendTarget.slots)\n107. \t\t\t.map(name => `${name}: () => \\`${appendTarget.slots[name]}\\``)\n108. \t\t\t.join(', ');\n109. \n110. \t\toptions.push(`slotted: { ${slotted} }`);\n111. \n112. \t\tgenerator.appendTargets.pop();\n113. \t}\n114. \n115. \tif (options.length) {\n116. \t\topen += `, { ${options.join(', ')} }`;\n117. \t}\n118. \n119. \tgenerator.append(open);\n120. \tgenerator.append(')}');\n121. }", start_line_number=1, end_line_number=121), Context(relative_path='src/interfaces.ts', content="1. import {SourceMap} from 'magic-string';\n2. \n3. export interface Node {\n4. \tstart: number;\n5. \tend: number;\n6. \ttype: string;\n7. \t[propName: string]: any;\n8. }\n9. \n10. export interface Parser {\n11. \treadonly template: string;\n12. \treadonly filename?: string;\n13. \n14. \tindex: number;\n15. \tstack: Array<Node>;\n16. \n17. \thtml: Node;\n18. \tcss: Node;\n19. \tjs: Node;\n20. \tmetaTags: {};\n21. }\n22. \n23. export interface Parsed {\n24. \thash: number;\n25. \thtml: Node;\n26. \tcss: Node;\n27. \tjs: Node;\n28. }\n29. \n30. export interface Warning {\n31. \tloc?: { line: number; column: number; pos?: number };\n32. \tpos?: number;\n33. \tmessage: string;\n34. \tfilename?: string;\n35. \tframe?: string;\n36. \ttoString: () => string;\n37. }\n38. \n39. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';\n40. \n41. export interface CompileOptions {\n42. \tformat?: ModuleFormat;\n43. \tname?: string;\n44. \tfilename?: string;\n45. \tgenerate?: string;\n46. \tglobals?: ((id: string) => string) | object;\n47. \tamd?: {\n48. \t\tid?: string;\n49. \t};\n50. \n51. \toutputFilename?: string;\n52. \tcssOutputFilename?: string;\n53. \n54. \tdev?: boolean;\n55. \tshared?: boolean | string;\n56. \tcascade?: boolean;\n57. \thydratable?: boolean;\n58. \tlegacy?: boolean;\n59. \tcustomElement?: CustomElementOptions | true;\n60. \tcss?: boolean;\n61. \tstore?: boolean;\n62. \n63. \tonerror?: (error: Error) => void;\n64. \tonwarn?: (warning: Warning) => void;\n65. }\n66. \n67. export interface GenerateOptions {\n68. \tname: string;\n69. \tformat: ModuleFormat;\n70. \tbanner?: string;\n71. \tsharedPath?: string;\n72. \thelpers?: { name: string, alias: string }[];\n73. }\n74. \n75. export interface Visitor {\n76. \tenter: (node: Node) => void;\n77. \tleave?: (node: Node) => void;\n78. }\n79. \n80. export interface CustomElementOptions {\n81. \ttag?: string;\n82. \tprops?: string[];\n83. }\n84. \n85. export interface PreprocessOptions {\n86. \tmarkup?: (options: {content: string, filename: string}) => { code: string, map?: SourceMap | string };\n87. \tstyle?: Preprocessor;\n88. \tscript?: Preprocessor;\n89. \tfilename?: string\n90. }\n91. \n92. export type Preprocessor = (options: {content: string, attributes: Record<string, string | boolean>, filename?: string}) => { code: string, map?: SourceMap | string };", start_line_number=1, end_line_number=92), Context(relative_path='src/server-side-rendering/register.js', content="1. import * as fs from 'fs';\n2. import * as path from 'path';\n3. import { compile } from '../index.ts';\n4. \n5. const compileOptions = {};\n6. \n7. function capitalise(name) {\n8. \treturn name[0].toUpperCase() + name.slice(1);\n9. }\n10. \n11. export default function register(options) {\n12. \tconst { extensions } = options;\n13. \n14. \tif (extensions) {\n15. \t\t_deregister('.html');\n16. \t\textensions.forEach(_register);\n17. \t}\n18. \n19. \t// TODO make this the default and remove in v2\n20. \tif ('store' in options) compileOptions.store = options.store;\n21. }\n22. \n23. function _deregister(extension) {\n24. \tdelete require.extensions[extension];\n25. }\n26. \n27. function _register(extension) {\n28. \trequire.extensions[extension] = function(module, filename) {\n29. \t\tconst name = path.basename(filename)\n30. \t\t\t.slice(0, -path.extname(filename).length)\n31. \t\t\t.replace(/^\\d/, '_$&')\n32. \t\t\t.replace(/[^a-zA-Z0-9_$]/g, '');\n33. \n34. \t\tconst options = Object.assign({}, compileOptions, {\n35. \t\t\tfilename,\n36. \t\t\tname: capitalise(name),\n37. \t\t\tgenerate: 'ssr'\n38. \t\t});\n39. \n40. \t\tconst {code} = compile(fs.readFileSync(filename, 'utf-8'), options);\n41. \n42. \t\treturn module._compile(code, filename);\n43. \t};\n44. }\n45. \n46. _register('.html');", start_line_number=1, end_line_number=46), Context(relative_path='store.js', content='1. import {\n2. \tassign,\n3. \tblankObject,\n4. \tdiffers,\n5. \tdispatchObservers,\n6. \tget,\n7. \tobserve\n8. } from \'./shared.js\';\n9. \n10. function Store(state) {\n11. \tthis._observers = { pre: blankObject(), post: blankObject() };\n12. \tthis._changeHandlers = [];\n13. \tthis._dependents = [];\n14. \n15. \tthis._computed = blankObject();\n16. \tthis._sortedComputedProperties = [];\n17. \n18. \tthis._state = assign({}, state);\n19. }\n20. \n21. assign(Store.prototype, {\n22. \t_add: function(component, props) {\n23. \t\tthis._dependents.push({\n24. \t\t\tcomponent: component,\n25. \t\t\tprops: props\n26. \t\t});\n27. \t},\n28. \n29. \t_init: function(props) {\n30. \t\tvar state = {};\n31. \t\tfor (var i = 0; i < props.length; i += 1) {\n32. \t\t\tvar prop = props[i];\n33. \t\t\tstate[\'$\' + prop] = this._state[prop];\n34. \t\t}\n35. \t\treturn state;\n36. \t},\n37. \n38. \t_remove: function(component) {\n39. \t\tvar i = this._dependents.length;\n40. \t\twhile (i--) {\n41. \t\t\tif (this._dependents[i].component === component) {\n42. \t\t\t\tthis._dependents.splice(i, 1);\n43. \t\t\t\treturn;\n44. \t\t\t}\n45. \t\t}\n46. \t},\n47. \n48. \t_sortComputedProperties: function() {\n49. \t\tvar computed = this._computed;\n50. \t\tvar sorted = this._sortedComputedProperties = [];\n51. \t\tvar cycles;\n52. \t\tvar visited = blankObject();\n53. \n54. \t\tfunction visit(key) {\n55. \t\t\tif (cycles[key]) {\n56. \t\t\t\tthrow new Error(\'Cyclical dependency detected\');\n57. \t\t\t}\n58. \n59. \t\t\tif (visited[key]) return;\n60. \t\t\tvisited[key] = true;\n61. \n62. \t\t\tvar c = computed[key];\n63. \n64. \t\t\tif (c) {\n65. \t\t\t\tcycles[key] = true;\n66. \t\t\t\tc.deps.forEach(visit);\n67. \t\t\t\tsorted.push(c);\n68. \t\t\t}\n69. \t\t}\n70. \n71. \t\tfor (var key in this._computed) {\n72. \t\t\tcycles = blankObject();\n73. \t\t\tvisit(key);\n74. \t\t}\n75. \t},\n76. \n77. \tcompute: function(key, deps, fn) {\n78. \t\tvar store = this;\n79. \t\tvar value;\n80. \n81. \t\tvar c = {\n82. \t\t\tdeps: deps,\n83. \t\t\tupdate: function(state, changed, dirty) {\n84. \t\t\t\tvar values = deps.map(function(dep) {\n85. \t\t\t\t\tif (dep in changed) dirty = true;\n86. \t\t\t\t\treturn state[dep];\n87. \t\t\t\t});\n88. \n89. \t\t\t\tif (dirty) {\n90. \t\t\t\t\tvar newValue = fn.apply(null, values);\n91. \t\t\t\t\tif (differs(newValue, value)) {\n92. \t\t\t\t\t\tvalue = newValue;\n93. \t\t\t\t\t\tchanged[key] = true;\n94. \t\t\t\t\t\tstate[key] = value;\n95. \t\t\t\t\t}\n96. \t\t\t\t}\n97. \t\t\t}\n98. \t\t};\n99. \n100. \t\tc.update(this._state, {}, true);\n101. \n102. \t\tthis._computed[key] = c;\n103. \t\tthis._sortComputedProperties();\n104. \t},\n105. \n106. \tget: get,\n107. \n108. \tobserve: observe,\n109. \n110. \tonchange: function(callback) {\n111. \t\tthis._changeHandlers.push(callback);\n112. \t\treturn {\n113. \t\t\tcancel: function() {\n114. \t\t\t\tvar index = this._changeHandlers.indexOf(callback);\n115. \t\t\t\tif (~index) this._changeHandlers.splice(index, 1);\n116. \t\t\t}\n117. \t\t};\n118. \t},\n119. \n120. \tset: function(newState) {\n121. \t\tvar oldState = this._state,\n122. \t\t\tchanged = this._changed = {},\n123. \t\t\tdirty = false;\n124. \n125. \t\tfor (var key in newState) {\n126. \t\t\tif (this._computed[key]) throw new Error("\'" + key + "\' is a read-only property");\n127. \t\t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n128. \t\t}\n129. \t\tif (!dirty) return;\n130. \n131. \t\tthis._state = assign({}, oldState, newState);\n132. \n133. \t\tfor (var i = 0; i < this._sortedComputedProperties.length; i += 1) {\n134. \t\t\tthis._sortedComputedProperties[i].update(this._state, changed);\n135. \t\t}\n136. \n137. \t\tfor (var i = 0; i < this._changeHandlers.length; i += 1) {\n138. \t\t\tthis._changeHandlers[i](this._state, changed);\n139. \t\t}\n140. \n141. \t\tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n142. \n143. \t\tvar dependents = this._dependents.slice(); // guard against mutations\n144. \t\tfor (var i = 0; i < dependents.length; i += 1) {\n145. \t\t\tvar dependent = dependents[i];\n146. \t\t\tvar componentState = {};\n147. \t\t\tdirty = false;\n148. \n149. \t\t\tfor (var j = 0; j < dependent.props.length; j += 1) {\n150. \t\t\t\tvar prop = dependent.props[j];\n151. \t\t\t\tif (prop in changed) {\n152. \t\t\t\t\tcomponentState[\'$\' + prop] = this._state[prop];\n153. \t\t\t\t\tdirty = true;\n154. \t\t\t\t}\n155. \t\t\t}\n156. \n157. \t\t\tif (dirty) dependent.component.set(componentState);\n158. \t\t}\n159. \n160. \t\tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n161. \t}\n162. });\n163. \n164. export { Store };', start_line_number=1, end_line_number=164), Context(relative_path='test/server-side-rendering/index.js', content='1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";\n12. \n13. function tryToReadFile(file) {\n14. \ttry {\n15. \t\treturn fs.readFileSync(file, "utf-8");\n16. \t} catch (err) {\n17. \t\tif (err.code !== "ENOENT") throw err;\n18. \t\treturn null;\n19. \t}\n20. }\n21. \n22. describe("ssr", () => {\n23. \tbefore(() => {\n24. \t\trequire("../../ssr/register")({\n25. \t\t\textensions: [\'.svelte\', \'.html\'],\n26. \t\t\tstore: true\n27. \t\t});\n28. \n29. \t\treturn setupHtmlEqual();\n30. \t});\n31. \n32. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n33. \t\tif (dir[0] === ".") return;\n34. \n35. \t\t// add .solo to a sample directory name to only run that test, or\n36. \t\t// .show to always show the output. or both\n37. \t\tconst solo = /\\.solo/.test(dir);\n38. \t\tconst show = /\\.show/.test(dir);\n39. \n40. \t\tif (solo && process.env.CI) {\n41. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n42. \t\t}\n43. \n44. \t\t(solo ? it.only : it)(dir, () => {\n45. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n46. \t\t\ttry {\n47. \t\t\t\tlet component;\n48. \n49. \t\t\t\tconst mainHtmlFile = `${dir}/main.html`;\n50. \t\t\t\tconst mainSvelteFile = `${dir}/main.svelte`;\n51. \t\t\t\tif (fs.existsSync(mainHtmlFile)) {\n52. \t\t\t\t\tcomponent = require(mainHtmlFile);\n53. \t\t\t\t} else if (fs.existsSync(mainSvelteFile)) {\n54. \t\t\t\t\tcomponent = require(mainSvelteFile);\n55. \t\t\t\t}\n56. \n57. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n58. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n59. \n60. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n61. \n62. \t\t\t\tconst rendered = component.render(data);\n63. \t\t\t\tconst { html, css, head } = rendered;\n64. \n65. \t\t\t\t// rendered.toString() === rendered.html\n66. \t\t\t\tassert.equal(rendered, html);\n67. \n68. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n69. \t\t\t\tif (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);\n70. \n71. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n72. \t\t\t\tassert.equal(\n73. \t\t\t\t\tcss.code.replace(/^\\s+/gm, ""),\n74. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n75. \t\t\t\t);\n76. \n77. \t\t\t\tif (fs.existsSync(`${dir}/_expected-head.html`)) {\n78. \t\t\t\t\tfs.writeFileSync(`${dir}/_actual-head.html`, head);\n79. \t\t\t\t\tassert.htmlEqual(\n80. \t\t\t\t\t\thead,\n81. \t\t\t\t\t\tfs.readFileSync(`${dir}/_expected-head.html`, \'utf-8\')\n82. \t\t\t\t\t);\n83. \t\t\t\t}\n84. \n85. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n86. \t\t\t} catch (err) {\n87. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n88. \t\t\t\tthrow err;\n89. \t\t\t}\n90. \t\t});\n91. \t});\n92. \n93. \t// duplicate client-side tests, as far as possible\n94. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n95. \t\tif (dir[0] === ".") return;\n96. \n97. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n98. \n99. \t\tif (config.solo && process.env.CI) {\n100. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n101. \t\t}\n102. \n103. \t\tif (config["skip-ssr"]) return;\n104. \n105. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n106. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n107. \n108. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n109. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n110. \t\t\t\tdelete require.cache[resolved];\n111. \t\t\t});\n112. \n113. \t\t\trequire("../../ssr/register")({\n114. \t\t\t\tstore: !!config.store\n115. \t\t\t});\n116. \n117. \t\t\ttry {\n118. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n119. \t\t\t\tconst { html } = component.render(config.data, {\n120. \t\t\t\t\tstore: (config.store !== true) && config.store\n121. \t\t\t\t});\n122. \n123. \t\t\t\tif (config.html) {\n124. \t\t\t\t\tassert.htmlEqual(html, config.html);\n125. \t\t\t\t}\n126. \t\t\t} catch (err) {\n127. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n128. \t\t\t\tthrow err;\n129. \t\t\t}\n130. \t\t});\n131. \t});\n132. });', start_line_number=1, end_line_number=132)]
2025-11-12 13:30:07,768 - thread-135845298308800.prometheus.lang_graph.nodes.issue_classifier_node - INFO - IssueClassifierNode classified the issue as: bug
2025-11-12 13:30:07,769 - thread-135845298308800.prometheus.lang_graph.nodes.issue_classification_subgraph_node - INFO - issue_type: bug
2025-11-12 13:30:07,770 - thread-135845298308800.prometheus.docker.base_container - INFO - Pulling docker image: ghcr.io/timesler/swe-polybench.eval.x86_64.sveltejs__svelte-1116:latest
2025-11-12 13:30:08,333 - thread-135845298308800.prometheus.docker.base_container - INFO - Tagging pulled image as: prometheus_user_defined_container_042b3f92cc
2025-11-12 13:30:08,343 - thread-135845298308800.prometheus.docker.base_container - INFO - Starting container from image prometheus_user_defined_container_042b3f92cc
2025-11-12 13:30:08,519 - thread-135845298308800.prometheus.docker.base_container - INFO - Starting persistent shell for interactive mode...
2025-11-12 13:30:08,886 - thread-135845298308800.prometheus.docker.base_container - INFO - Persistent shell is ready
2025-11-12 13:30:08,887 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - Enter IssueBugSubgraphNode
2025-11-12 13:30:08,890 - thread-135845298308800.prometheus.lang_graph.nodes.bug_get_regression_tests_subgraph_node - INFO - Enter bug_get_regression_tests_subgraph_node
2025-11-12 13:30:08,892 - thread-135845298308800.prometheus.lang_graph.nodes.bug_get_regression_context_message_node - DEBUG - Sending query to context provider subgraph:
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

2025-11-12 13:30:08,892 - thread-135845298308800.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-12 13:30:08,894 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 13:30:23,768 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The task requires returning 8 specific existing test cases with exact file paths and line numbers, including full test content (imports, setup, assertions). The current context only provides the file tree without the contents of the test files, making it impossible to identify test names, structure, and line numbers. The primary files likely containing relevant SSR and store-related tests are under test/server-side-rendering, test/runtime, and test/store, plus shared test utilities.' query='Please provide the full content of test/server-side-rendering/index.js, test/runtime/index.js, test/store/index.js, and test/helpers.js.' extra_requirements='If sending all files is too large, please at minimum include test/server-side-rendering/index.js and test/helpers.js with their exact line numbers.' purpose='I need to extract 8 relevant test cases with precise line numbers and complete setup/assertions to use as regression tests for the SSR nested store issue.'
2025-11-12 13:30:23,769 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content of test/server-side-rendering/index.js, test/runtime/index.js, test/store/index.js, and test/helpers.js.
2025-11-12 13:30:25,364 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 13:30:25,364 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 13:30:25,364 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 13:30:25,364 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 13:30:25,366 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 13:30:25,367 - thread-135845298308800.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 13:30:25,367 - thread-135845298308800.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content of test/server-side-rendering/index.js, test/runtime/index.js, test/store/index.js, and test/helpers.js.
Extra requirements: If sending all files is too large, please at minimum include test/server-side-rendering/index.js and test/helpers.js with their exact line numbers.
Purpose: I need to extract 8 relevant test cases with precise line numbers and complete setup/assertions to use as regression tests for the SSR nested store issue.
2025-11-12 13:30:33,206 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_sJcXJcjzGihrojy7G2F5pm7x', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 484, 'prompt_tokens': 2200, 'total_tokens': 2684, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a6e06e8f-1657-41fa-9995-945f7836215b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/index.js'}, 'id': 'call_sJcXJcjzGihrojy7G2F5pm7x', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2200, 'output_tokens': 484, 'total_tokens': 2684, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-12 13:30:35,909 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1tixKDXng2lGHwq3flz9cP3F', 'function': {'arguments': '{"relative_path":"test/runtime/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 161, 'prompt_tokens': 3992, 'total_tokens': 4153, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--49ff7a96-fe68-4614-ba47-2951cc32032a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/index.js'}, 'id': 'call_1tixKDXng2lGHwq3flz9cP3F', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3992, 'output_tokens': 161, 'total_tokens': 4153, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 13:30:37,032 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lhN1khU8rhqqiEI9XnMO2efC', 'function': {'arguments': '{"relative_path":"test/store/index.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 27, 'prompt_tokens': 7421, 'total_tokens': 7448, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d311783d-a9da-423f-b7b5-914026783539-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/store/index.js'}, 'id': 'call_lhN1khU8rhqqiEI9XnMO2efC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7421, 'output_tokens': 27, 'total_tokens': 7448, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:30:38,258 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_QEXgsetToUW5ljVpITR6uDpY', 'function': {'arguments': '{"relative_path":"test/helpers.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 9711, 'total_tokens': 9737, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3e1e3235-17ca-416e-813c-a02b9b3a321c-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/helpers.js'}, 'id': 'call_QEXgsetToUW5ljVpITR6uDpY', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9711, 'output_tokens': 26, 'total_tokens': 9737, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:30:47,195 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I fetched the full contents of test/server-side-rendering/index.js, test/runtime/index.js, test/store/index.js, and test/helpers.js from the knowledge graph, with exact line numbers included for each file. Per your priority, test/server-side-rendering/index.js and test/helpers.js were fully retrieved with their precise line numbers to support SSR regression test extraction. These files contain the SSR registration/setup, HTML normalization/assertion helpers, runtime test harness, and store behavior tests, giving you complete setup and assertions needed. You can now identify and extract at least eight relevant test cases with accurate line references for the nested store SSR issue.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 776, 'prompt_tokens': 12508, 'total_tokens': 13284, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--84a9e200-c1f0-4a83-b2d1-a2d78749c9ba-0' usage_metadata={'input_tokens': 12508, 'output_tokens': 776, 'total_tokens': 13284, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-12 13:30:47,199 - thread-135845298308800.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content of test/server-side-rendering/index.js, test/runtime/index.js, test/store/index.js, and test/helpers.js.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending all files is too large, please at minimum include test/server-side-rendering/index.js and test/helpers.js with their exact line numbers.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
I need to extract 8 relevant test cases with precise line numbers and complete setup/assertions to use as regression tests for the SSR nested store issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: test/helpers.js
Line number range: 1 - 243
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	process.env.TEST = test ? 'true' : '';
12. 
13. 	const resolved = require.resolve('../compiler/svelte.js');
14. 
15. 	delete require.cache[resolved];
16. 	return require(resolved);
17. }
18. 
19. export const svelte = loadSvelte();
20. 
21. export function exists(path) {
22. 	try {
23. 		fs.statSync(path);
24. 		return true;
25. 	} catch (err) {
26. 		return false;
27. 	}
28. }
29. 
30. export function tryToLoadJson(file) {
31. 	try {
32. 		return JSON.parse(fs.readFileSync(file));
33. 	} catch (err) {
34. 		if (err.code !== 'ENOENT') throw err;
35. 		return null;
36. 	}
37. }
38. 
39. export function tryToReadFile(file) {
40. 	try {
41. 		return fs.readFileSync(file, 'utf-8');
42. 	} catch (err) {
43. 		if (err.code !== 'ENOENT') throw err;
44. 		return null;
45. 	}
46. }
47. 
48. const { window } = new JSDOM('<main></main>');
49. global.document = window.document;
50. 
51. export function env() {
52. 	window._svelteTransitionManager = null;
53. 	window.document.body.innerHTML = '<main></main>';
54. 
55. 	return window;
56. }
57. 
58. function cleanChildren(node) {
59. 	let previous = null;
60. 
61. 	// sort attributes
62. 	const attributes = Array.from(node.attributes).sort((a, b) => {
63. 		return a.name < b.name ? -1 : 1;
64. 	});
65. 
66. 	attributes.forEach(attr => {
67. 		node.removeAttribute(attr.name);
68. 	});
69. 
70. 	attributes.forEach(attr => {
71. 		node.setAttribute(attr.name, attr.value);
72. 	});
73. 
74. 	// recurse
75. 	[...node.childNodes].forEach(child => {
76. 		if (child.nodeType === 3) {
77. 			// text
78. 			if (
79. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
80. 				node.tagName !== 'text' &&
81. 				node.tagName !== 'tspan'
82. 			) {
83. 				node.removeChild(child);
84. 			}
85. 
86. 			child.data = child.data.replace(/\s{2,}/g, '\n');
87. 
88. 			if (previous && previous.nodeType === 3) {
89. 				previous.data += child.data;
90. 				previous.data = previous.data.replace(/\s{2,}/g, '\n');
91. 
92. 				node.removeChild(child);
93. 				child = previous;
94. 			}
95. 		} else {
96. 			cleanChildren(child);
97. 		}
98. 
99. 		previous = child;
100. 	});
101. 
102. 	// collapse whitespace
103. 	if (node.firstChild && node.firstChild.nodeType === 3) {
104. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
105. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
106. 	}
107. 
108. 	if (node.lastChild && node.lastChild.nodeType === 3) {
109. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
110. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
111. 	}
112. }
113. 
114. export function normalizeHtml(window, html) {
115. 	try {
116. 		const node = window.document.createElement('div');
117. 		node.innerHTML = html
118. 			.replace(/<!--.*?-->/g, '')
119. 			.replace(/>[\s\r\n]+</g, '><')
120. 			.trim();
121. 		cleanChildren(node, '');
122. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
123. 	} catch (err) {
124. 		throw new Error(`Failed to normalize HTML:\n${html}`);
125. 	}
126. }
127. 
128. export function setupHtmlEqual() {
129. 	const window = env();
130. 
131. 	assert.htmlEqual = (actual, expected, message) => {
132. 		assert.deepEqual(
133. 			normalizeHtml(window, actual),
134. 			normalizeHtml(window, expected),
135. 			message
136. 		);
137. 	};
138. }
139. 
140. export function loadConfig(file) {
141. 	try {
142. 		const resolved = require.resolve(file);
143. 		delete require.cache[resolved];
144. 
145. 		const config = require(resolved);
146. 		return config.default || config;
147. 	} catch (err) {
148. 		if (err.code === 'MODULE_NOT_FOUND') {
149. 			return {};
150. 		}
151. 
152. 		throw err;
153. 	}
154. }
155. 
156. export function addLineNumbers(code) {
157. 	return code
158. 		.split('\n')
159. 		.map((line, i) => {
160. 			i = String(i + 1);
161. 			while (i.length < 3) i = ` ${i}`;
162. 
163. 			return (
164. 				chalk.grey(`  ${i}: `) +
165. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
166. 			);
167. 		})
168. 		.join('\n');
169. }
170. 
171. function capitalise(str) {
172. 	return str[0].toUpperCase() + str.slice(1);
173. }
174. 
175. export function showOutput(cwd, options = {}, s = svelte) {
176. 	glob.sync('**/*.html', { cwd }).forEach(file => {
177. 		if (file[0] === '_') return;
178. 
179. 		const name = path.basename(file)
180. 			.slice(0, -path.extname(file).length)
181. 			.replace(/^\d/, '_$&')
182. 			.replace(/[^a-zA-Z0-9_$]/g, '');
183. 
184. 		const { code } = s.compile(
185. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
186. 			Object.assign(options, {
187. 				filename: file,
188. 				name: capitalise(name)
189. 			})
190. 		);
191. 
192. 		console.log( // eslint-disable-line no-console
193. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
194. 		);
195. 	});
196. }
197. 
198. const start = /\n(\t+)/;
199. export function deindent(strings, ...values) {
200. 	const indentation = start.exec(strings[0])[1];
201. 	const pattern = new RegExp(`^${indentation}`, 'gm');
202. 
203. 	let result = strings[0].replace(start, '').replace(pattern, '');
204. 
205. 	let trailingIndentation = getTrailingIndentation(result);
206. 
207. 	for (let i = 1; i < strings.length; i += 1) {
208. 		let expression = values[i - 1];
209. 		const string = strings[i].replace(pattern, '');
210. 
211. 		if (Array.isArray(expression)) {
212. 			expression = expression.length ? expression.join('\n') : null;
213. 		}
214. 
215. 		if (expression || expression === '') {
216. 			const value = String(expression).replace(
217. 				/\n/g,
218. 				`\n${trailingIndentation}`
219. 			);
220. 			result += value + string;
221. 		} else {
222. 			let c = result.length;
223. 			while (/\s/.test(result[c - 1])) c -= 1;
224. 			result = result.slice(0, c) + string;
225. 		}
226. 
227. 		trailingIndentation = getTrailingIndentation(result);
228. 	}
229. 
230. 	return result.trim().replace(/\t+$/gm, '');
231. }
232. 
233. function getTrailingIndentation(str) {
234. 	let i = str.length;
235. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
236. 	return str.slice(i, str.length);
237. }
238. 
239. export function spaces(i) {
240. 	let result = '';
241. 	while (i--) result += ' ';
242. 	return result;
243. }


File: test/runtime/index.js
Line number range: 1 - 251
Content:
1. import assert from "assert";
2. import chalk from 'chalk';
3. import * as path from "path";
4. import * as fs from "fs";
5. import * as acorn from "acorn";
6. import { transitionManager } from "../../shared.js";
7. 
8. import {
9. 	showOutput,
10. 	loadConfig,
11. 	loadSvelte,
12. 	env,
13. 	setupHtmlEqual,
14. 	spaces
15. } from "../helpers.js";
16. 
17. let svelte;
18. 
19. let compileOptions = null;
20. 
21. function getName(filename) {
22. 	const base = path.basename(filename).replace(".html", "");
23. 	return base[0].toUpperCase() + base.slice(1);
24. }
25. 
26. describe("runtime", () => {
27. 	before(() => {
28. 		svelte = loadSvelte(true);
29. 
30. 		require.extensions[".html"] = function(module, filename) {
31. 			const options = Object.assign(
32. 				{ filename, name: getName(filename), format: 'cjs' },
33. 				compileOptions
34. 			);
35. 
36. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
37. 
38. 			return module._compile(code, filename);
39. 		};
40. 
41. 		return setupHtmlEqual();
42. 	});
43. 
44. 	const failed = new Set();
45. 
46. 	function runTest(dir, shared, hydrate) {
47. 		if (dir[0] === ".") return;
48. 
49. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
50. 
51. 		if (config.solo && process.env.CI) {
52. 			throw new Error("Forgot to remove `solo: true` from test");
53. 		}
54. 
55. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers${hydrate ? ' , hydration' : ''})`, () => {
56. 			if (failed.has(dir)) {
57. 				// this makes debugging easier, by only printing compiled output once
58. 				throw new Error('skipping test, already failed');
59. 			}
60. 
61. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
62. 			global.document.title = '';
63. 
64. 			compileOptions = config.compileOptions || {};
65. 			compileOptions.shared = shared;
66. 			compileOptions.hydratable = hydrate;
67. 			compileOptions.dev = config.dev;
68. 			compileOptions.store = !!config.store;
69. 
70. 			// check that no ES2015+ syntax slipped in
71. 			if (!config.allowES2015) {
72. 				try {
73. 					const source = fs.readFileSync(
74. 						`test/runtime/samples/${dir}/main.html`,
75. 						"utf-8"
76. 					);
77. 					const { code } = svelte.compile(source, compileOptions);
78. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
79. 					if (startIndex === -1) throw new Error("missing create_main_fragment");
80. 					const endIndex = code.lastIndexOf("export default");
81. 					const es5 =
82. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
83. 						code.slice(startIndex, endIndex);
84. 
85. 					acorn.parse(es5, { ecmaVersion: 5 });
86. 
87. 					if (/Object\.assign/.test(es5)) {
88. 						throw new Error(
89. 							"cannot use Object.assign in generated code, as it is not supported everywhere"
90. 						);
91. 					}
92. 				} catch (err) {
93. 					failed.add(dir);
94. 					if (err.frame) {
95. 						console.error(chalk.red(err.frame)); // eslint-disable-line no-console
96. 					}
97. 					showOutput(cwd, { shared, format: 'cjs', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
98. 					throw err;
99. 				}
100. 			}
101. 
102. 			Object.keys(require.cache)
103. 				.filter(x => x.endsWith(".html"))
104. 				.forEach(file => {
105. 					delete require.cache[file];
106. 				});
107. 
108. 			let SvelteComponent;
109. 
110. 			let unintendedError = null;
111. 
112. 			const window = env();
113. 
114. 			return Promise.resolve()
115. 				.then(() => {
116. 					// set of hacks to support transition tests
117. 					transitionManager.running = false;
118. 					transitionManager.transitions = [];
119. 
120. 					const raf = {
121. 						time: 0,
122. 						callback: null,
123. 						tick: now => {
124. 							raf.time = now;
125. 							if (raf.callback) raf.callback();
126. 						}
127. 					};
128. 					window.performance = { now: () => raf.time };
129. 					global.requestAnimationFrame = cb => {
130. 						let called = false;
131. 						raf.callback = () => {
132. 							if (!called) {
133. 								called = true;
134. 								cb();
135. 							}
136. 						};
137. 					};
138. 
139. 					try {
140. 						SvelteComponent = require(`./samples/${dir}/main.html`);
141. 					} catch (err) {
142. 						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
143. 						throw err;
144. 					}
145. 
146. 					global.window = window;
147. 
148. 					// Put the constructor on window for testing
149. 					window.SvelteComponent = SvelteComponent;
150. 
151. 					const target = window.document.querySelector("main");
152. 
153. 					const warnings = [];
154. 					const warn = console.warn;
155. 					console.warn = warning => {
156. 						warnings.push(warning);
157. 					};
158. 
159. 					const options = Object.assign({}, {
160. 						target,
161. 						hydrate,
162. 						data: config.data,
163. 						store: (config.store !== true && config.store)
164. 					}, config.options || {});
165. 
166. 					const component = new SvelteComponent(options);
167. 
168. 					console.warn = warn;
169. 
170. 					if (config.error) {
171. 						unintendedError = true;
172. 						throw new Error("Expected a runtime error");
173. 					}
174. 
175. 					if (config.warnings) {
176. 						assert.deepEqual(warnings, config.warnings);
177. 					} else if (warnings.length) {
178. 						unintendedError = true;
179. 						throw new Error("Received unexpected warnings");
180. 					}
181. 
182. 					if (config.html) {
183. 						assert.htmlEqual(target.innerHTML, config.html);
184. 					}
185. 
186. 					if (config.test) {
187. 						return Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {
188. 							component.destroy();
189. 						});
190. 					} else {
191. 						component.destroy();
192. 						assert.equal(target.innerHTML, "");
193. 					}
194. 				})
195. 				.catch(err => {
196. 					if (config.error && !unintendedError) {
197. 						config.error(assert, err);
198. 					} else {
199. 						failed.add(dir);
200. 						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
201. 						throw err;
202. 					}
203. 				})
204. 				.then(() => {
205. 					if (config.show) showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte);
206. 				});
207. 		});
208. 	}
209. 
210. 	const shared = path.resolve("shared.js");
211. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
212. 		runTest(dir, shared, false);
213. 		runTest(dir, shared, true);
214. 		runTest(dir, null, false);
215. 	});
216. 
217. 	it("fails if options.target is missing in dev mode", () => {
218. 		const { code } = svelte.compile(`<div></div>`, {
219. 			format: "iife",
220. 			name: "SvelteComponent",
221. 			dev: true
222. 		});
223. 
224. 		const SvelteComponent = eval(
225. 			`(function () { ${code}; return SvelteComponent; }())`
226. 		);
227. 
228. 		assert.throws(() => {
229. 			new SvelteComponent();
230. 		}, /'target' is a required option/);
231. 	});
232. 
233. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
234. 		const { code } = svelte.compile(`<div></div>`, {
235. 			format: "iife",
236. 			name: "SvelteComponent",
237. 			dev: true
238. 		});
239. 
240. 		const SvelteComponent = eval(
241. 			`(function () { ${code}; return SvelteComponent; }())`
242. 		);
243. 
244. 		assert.throws(() => {
245. 			new SvelteComponent({
246. 				target: {},
247. 				hydrate: true
248. 			});
249. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
250. 	});
251. });


File: test/server-side-rendering/index.js
Line number range: 1 - 132
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require("../../ssr/register")({
25. 			extensions: ['.svelte', '.html'],
26. 			store: true
27. 		});
28. 
29. 		return setupHtmlEqual();
30. 	});
31. 
32. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
33. 		if (dir[0] === ".") return;
34. 
35. 		// add .solo to a sample directory name to only run that test, or
36. 		// .show to always show the output. or both
37. 		const solo = /\.solo/.test(dir);
38. 		const show = /\.show/.test(dir);
39. 
40. 		if (solo && process.env.CI) {
41. 			throw new Error("Forgot to remove `solo: true` from test");
42. 		}
43. 
44. 		(solo ? it.only : it)(dir, () => {
45. 			dir = path.resolve("test/server-side-rendering/samples", dir);
46. 			try {
47. 				let component;
48. 
49. 				const mainHtmlFile = `${dir}/main.html`;
50. 				const mainSvelteFile = `${dir}/main.svelte`;
51. 				if (fs.existsSync(mainHtmlFile)) {
52. 					component = require(mainHtmlFile);
53. 				} else if (fs.existsSync(mainSvelteFile)) {
54. 					component = require(mainSvelteFile);
55. 				}
56. 
57. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
58. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
59. 
60. 				const data = tryToLoadJson(`${dir}/data.json`);
61. 
62. 				const rendered = component.render(data);
63. 				const { html, css, head } = rendered;
64. 
65. 				// rendered.toString() === rendered.html
66. 				assert.equal(rendered, html);
67. 
68. 				fs.writeFileSync(`${dir}/_actual.html`, html);
69. 				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);
70. 
71. 				assert.htmlEqual(html, expectedHtml);
72. 				assert.equal(
73. 					css.code.replace(/^\s+/gm, ""),
74. 					expectedCss.replace(/^\s+/gm, "")
75. 				);
76. 
77. 				if (fs.existsSync(`${dir}/_expected-head.html`)) {
78. 					fs.writeFileSync(`${dir}/_actual-head.html`, head);
79. 					assert.htmlEqual(
80. 						head,
81. 						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
82. 					);
83. 				}
84. 
85. 				if (show) showOutput(dir, { generate: 'ssr' });
86. 			} catch (err) {
87. 				showOutput(dir, { generate: 'ssr' });
88. 				throw err;
89. 			}
90. 		});
91. 	});
92. 
93. 	// duplicate client-side tests, as far as possible
94. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
95. 		if (dir[0] === ".") return;
96. 
97. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
98. 
99. 		if (config.solo && process.env.CI) {
100. 			throw new Error("Forgot to remove `solo: true` from test");
101. 		}
102. 
103. 		if (config["skip-ssr"]) return;
104. 
105. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
106. 			const cwd = path.resolve("test/runtime/samples", dir);
107. 
108. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
109. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
110. 				delete require.cache[resolved];
111. 			});
112. 
113. 			require("../../ssr/register")({
114. 				store: !!config.store
115. 			});
116. 
117. 			try {
118. 				const component = require(`../runtime/samples/${dir}/main.html`);
119. 				const { html } = component.render(config.data, {
120. 					store: (config.store !== true) && config.store
121. 				});
122. 
123. 				if (config.html) {
124. 					assert.htmlEqual(html, config.html);
125. 				}
126. 			} catch (err) {
127. 				showOutput(cwd, { generate: "ssr" });
128. 				throw err;
129. 			}
130. 		});
131. 	});
132. });


File: test/store/index.js
Line number range: 1 - 190
Content:
1. import fs from 'fs';
2. import assert from 'assert';
3. import MagicString from 'magic-string';
4. import { parse } from 'acorn';
5. import { Store } from '../../store.js';
6. 
7. describe('store', () => {
8. 	it('is written in ES5', () => {
9. 		const source = fs.readFileSync('store.js', 'utf-8');
10. 
11. 		const ast = parse(source, {
12. 			sourceType: 'module'
13. 		});
14. 
15. 		const magicString = new MagicString(source);
16. 		ast.body.forEach(node => {
17. 			if (/^(Im|Ex)port/.test(node.type)) magicString.remove(node.start, node.end);
18. 		});
19. 
20. 		parse(magicString.toString(), {
21. 			ecmaVersion: 5
22. 		});
23. 	});
24. 
25. 	describe('get', () => {
26. 		it('gets a specific key', () => {
27. 			const store = new Store({
28. 				foo: 'bar'
29. 			});
30. 
31. 			assert.equal(store.get('foo'), 'bar');
32. 		});
33. 
34. 		it('gets the entire state object', () => {
35. 			const store = new Store({
36. 				foo: 'bar'
37. 			});
38. 
39. 			assert.deepEqual(store.get(), { foo: 'bar' });
40. 		});
41. 	});
42. 
43. 	describe('set', () => {
44. 		it('sets state', () => {
45. 			const store = new Store();
46. 
47. 			store.set({
48. 				foo: 'bar'
49. 			});
50. 
51. 			assert.equal(store.get('foo'), 'bar');
52. 		});
53. 	});
54. 
55. 	describe('observe', () => {
56. 		it('observes state', () => {
57. 			let newFoo;
58. 			let oldFoo;
59. 
60. 			const store = new Store({
61. 				foo: 'bar'
62. 			});
63. 
64. 			store.observe('foo', (n, o) => {
65. 				newFoo = n;
66. 				oldFoo = o;
67. 			});
68. 
69. 			assert.equal(newFoo, 'bar');
70. 			assert.equal(oldFoo, undefined);
71. 
72. 			store.set({
73. 				foo: 'baz'
74. 			});
75. 
76. 			assert.equal(newFoo, 'baz');
77. 			assert.equal(oldFoo, 'bar');
78. 		});
79. 	});
80. 
81. 	describe('onchange', () => {
82. 		it('fires a callback when state changes', () => {
83. 			const store = new Store();
84. 
85. 			let count = 0;
86. 			let args;
87. 
88. 			store.onchange((state, changed) => {
89. 				count += 1;
90. 				args = { state, changed };
91. 			});
92. 
93. 			store.set({ foo: 'bar' });
94. 
95. 			assert.equal(count, 1);
96. 			assert.deepEqual(args, {
97. 				state: { foo: 'bar' },
98. 				changed: { foo: true }
99. 			});
100. 
101. 			// this should be a noop
102. 			store.set({ foo: 'bar' });
103. 			assert.equal(count, 1);
104. 
105. 			// this shouldn't
106. 			store.set({ foo: 'baz' });
107. 
108. 			assert.equal(count, 2);
109. 			assert.deepEqual(args, {
110. 				state: { foo: 'baz' },
111. 				changed: { foo: true }
112. 			});
113. 		});
114. 	});
115. 
116. 	describe('computed', () => {
117. 		it('computes a property based on data', () => {
118. 			const store = new Store({
119. 				foo: 1
120. 			});
121. 
122. 			store.compute('bar', ['foo'], foo => foo * 2);
123. 			assert.equal(store.get('bar'), 2);
124. 
125. 			const values = [];
126. 
127. 			store.observe('bar', bar => {
128. 				values.push(bar);
129. 			});
130. 
131. 			store.set({ foo: 2 });
132. 			assert.deepEqual(values, [2, 4]);
133. 		});
134. 
135. 		it('computes a property based on another computed property', () => {
136. 			const store = new Store({
137. 				foo: 1
138. 			});
139. 
140. 			store.compute('bar', ['foo'], foo => foo * 2);
141. 			store.compute('baz', ['bar'], bar => bar * 2);
142. 			assert.equal(store.get('baz'), 4);
143. 
144. 			const values = [];
145. 
146. 			store.observe('baz', baz => {
147. 				values.push(baz);
148. 			});
149. 
150. 			store.set({ foo: 2 });
151. 			assert.deepEqual(values, [4, 8]);
152. 		});
153. 
154. 		it('prevents computed properties from being set', () => {
155. 			const store = new Store({
156. 				foo: 1
157. 			});
158. 
159. 			store.compute('bar', ['foo'], foo => foo * 2);
160. 
161. 			assert.throws(() => {
162. 				store.set({ bar: 'whatever' });
163. 			}, /'bar' is a read-only property/);
164. 		});
165. 
166. 		it('allows multiple dependents to depend on the same computed property', () => {
167. 			const store = new Store({
168. 				a: 1
169. 			});
170. 
171. 			store.compute('b', ['a'], a => a * 2);
172. 			store.compute('c', ['b'], b => b * 3);
173. 			store.compute('d', ['b'], b => b * 4);
174. 
175. 			assert.deepEqual(store.get(), { a: 1, b: 2, c: 6, d: 8 });
176. 
177. 			// bit cheeky, testing a private property, but whatever
178. 			assert.equal(store._sortedComputedProperties.length, 3);
179. 		});
180. 
181. 		it('prevents cyclical dependencies', () => {
182. 			const store = new Store();
183. 
184. 			assert.throws(() => {
185. 				store.compute('a', ['b'], b => b + 1);
186. 				store.compute('b', ['a'], a => a + 1);
187. 			}, /Cyclical dependency detected/);
188. 		});
189. 	});
190. });

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 13:31:08,470 - thread-135845298308800.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n   - The user explicitly requests the full content of test/server-side-rendering/index.js.\n2. Direct relevance:\n   - This file defines the SSR test runner, registers the SSR environment with store support, reads expected outputs, renders components server-side, and asserts HTML/CSS/head — all critical to SSR regression testing and the nested store issue.\n3. Extended relevance:\n   - It duplicates runtime tests under SSR, passing store options into render, which is essential context for nested store behavior during SSR.\n4. Completeness:\n   - Selecting the entire file (lines 1–132) ensures all setup, configuration, and assertions are included with exact line numbers as requested.', relative_path='test/server-side-rendering/index.js', start_line=1, end_line=132), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user requests the full content of test/runtime/index.js.\n2. Direct relevance:\n   - This file implements the runtime test harness, including compile options (store, hydratable), environment setup, component instantiation, and assertion flow.\n3. Extended relevance:\n   - SSR tests duplicate these runtime samples; understanding runtime setup and store handling here is essential to interpret and reproduce SSR tests for nested store issues.\n4. Completeness:\n   - Selecting the entire file (lines 1–251) captures all configuration, dependencies, and test execution details needed.', relative_path='test/runtime/index.js', start_line=1, end_line=251), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user requests the full content of test/store/index.js.\n2. Direct relevance:\n   - This file contains unit tests for the Store (get, set, observe, onchange, computed), which are essential to validate store behavior that impacts SSR nested store scenarios.\n3. Extended relevance:\n   - Provides the expected semantics of the Store used by SSR/render paths, helping to craft regression tests.\n4. Completeness:\n   - Selecting the entire file (lines 1–190) ensures all test cases with setup and assertions are available.', relative_path='test/store/index.js', start_line=1, end_line=190), ContextOutput(reasoning='1. Query requirement analysis:\n   - The user requests the full content of test/helpers.js and exact line numbers at minimum along with SSR index.\n2. Direct relevance:\n   - This file defines critical test utilities used by SSR and runtime tests: loadSvelte, env, setupHtmlEqual, normalization, loadConfig, showOutput, deindent.\n3. Extended relevance:\n   - These helpers establish the test environment (JSDOM, HTML normalization) and configuration loading necessary to run/understand SSR tests.\n4. Completeness:\n   - Selecting the entire file (lines 1–243) provides all utility functions with precise line numbers.', relative_path='test/helpers.js', start_line=1, end_line=243)]
2025-11-12 13:31:08,474 - thread-135845298308800.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 4 contexts to memory for query: Please provide the full content of test/server-side-rendering/index.js, test/runtime/index.js, test/store/index.js, and test/helpers.js.
2025-11-12 13:31:09,162 - thread-135845298308800.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 13:31:09,164 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 4 new contexts to 0 existing contexts
2025-11-12 13:31:09,164 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 4 total contexts (removed 0 duplicates)
2025-11-12 13:31:09,166 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of test/server-side-rendering/index.js, test/runtime/index.js, test/store/index.js, and test/helpers.js.
Extra Requirements: If sending all files is too large, please at minimum include test/server-side-rendering/index.js and test/helpers.js with their exact line numbers.
Purpose: I need to extract 8 relevant test cases with precise line numbers and complete setup/assertions to use as regression tests for the SSR nested store issue.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: test/helpers.js
Line number range: 1 - 243
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	process.env.TEST = test ? 'true' : '';
12. 
13. 	const resolved = require.resolve('../compiler/svelte.js');
14. 
15. 	delete require.cache[resolved];
16. 	return require(resolved);
17. }
18. 
19. export const svelte = loadSvelte();
20. 
21. export function exists(path) {
22. 	try {
23. 		fs.statSync(path);
24. 		return true;
25. 	} catch (err) {
26. 		return false;
27. 	}
28. }
29. 
30. export function tryToLoadJson(file) {
31. 	try {
32. 		return JSON.parse(fs.readFileSync(file));
33. 	} catch (err) {
34. 		if (err.code !== 'ENOENT') throw err;
35. 		return null;
36. 	}
37. }
38. 
39. export function tryToReadFile(file) {
40. 	try {
41. 		return fs.readFileSync(file, 'utf-8');
42. 	} catch (err) {
43. 		if (err.code !== 'ENOENT') throw err;
44. 		return null;
45. 	}
46. }
47. 
48. const { window } = new JSDOM('<main></main>');
49. global.document = window.document;
50. 
51. export function env() {
52. 	window._svelteTransitionManager = null;
53. 	window.document.body.innerHTML = '<main></main>';
54. 
55. 	return window;
56. }
57. 
58. function cleanChildren(node) {
59. 	let previous = null;
60. 
61. 	// sort attributes
62. 	const attributes = Array.from(node.attributes).sort((a, b) => {
63. 		return a.name < b.name ? -1 : 1;
64. 	});
65. 
66. 	attributes.forEach(attr => {
67. 		node.removeAttribute(attr.name);
68. 	});
69. 
70. 	attributes.forEach(attr => {
71. 		node.setAttribute(attr.name, attr.value);
72. 	});
73. 
74. 	// recurse
75. 	[...node.childNodes].forEach(child => {
76. 		if (child.nodeType === 3) {
77. 			// text
78. 			if (
79. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
80. 				node.tagName !== 'text' &&
81. 				node.tagName !== 'tspan'
82. 			) {
83. 				node.removeChild(child);
84. 			}
85. 
86. 			child.data = child.data.replace(/\s{2,}/g, '\n');
87. 
88. 			if (previous && previous.nodeType === 3) {
89. 				previous.data += child.data;
90. 				previous.data = previous.data.replace(/\s{2,}/g, '\n');
91. 
92. 				node.removeChild(child);
93. 				child = previous;
94. 			}
95. 		} else {
96. 			cleanChildren(child);
97. 		}
98. 
99. 		previous = child;
100. 	});
101. 
102. 	// collapse whitespace
103. 	if (node.firstChild && node.firstChild.nodeType === 3) {
104. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
105. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
106. 	}
107. 
108. 	if (node.lastChild && node.lastChild.nodeType === 3) {
109. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
110. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
111. 	}
112. }
113. 
114. export function normalizeHtml(window, html) {
115. 	try {
116. 		const node = window.document.createElement('div');
117. 		node.innerHTML = html
118. 			.replace(/<!--.*?-->/g, '')
119. 			.replace(/>[\s\r\n]+</g, '><')
120. 			.trim();
121. 		cleanChildren(node, '');
122. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
123. 	} catch (err) {
124. 		throw new Error(`Failed to normalize HTML:\n${html}`);
125. 	}
126. }
127. 
128. export function setupHtmlEqual() {
129. 	const window = env();
130. 
131. 	assert.htmlEqual = (actual, expected, message) => {
132. 		assert.deepEqual(
133. 			normalizeHtml(window, actual),
134. 			normalizeHtml(window, expected),
135. 			message
136. 		);
137. 	};
138. }
139. 
140. export function loadConfig(file) {
141. 	try {
142. 		const resolved = require.resolve(file);
143. 		delete require.cache[resolved];
144. 
145. 		const config = require(resolved);
146. 		return config.default || config;
147. 	} catch (err) {
148. 		if (err.code === 'MODULE_NOT_FOUND') {
149. 			return {};
150. 		}
151. 
152. 		throw err;
153. 	}
154. }
155. 
156. export function addLineNumbers(code) {
157. 	return code
158. 		.split('\n')
159. 		.map((line, i) => {
160. 			i = String(i + 1);
161. 			while (i.length < 3) i = ` ${i}`;
162. 
163. 			return (
164. 				chalk.grey(`  ${i}: `) +
165. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
166. 			);
167. 		})
168. 		.join('\n');
169. }
170. 
171. function capitalise(str) {
172. 	return str[0].toUpperCase() + str.slice(1);
173. }
174. 
175. export function showOutput(cwd, options = {}, s = svelte) {
176. 	glob.sync('**/*.html', { cwd }).forEach(file => {
177. 		if (file[0] === '_') return;
178. 
179. 		const name = path.basename(file)
180. 			.slice(0, -path.extname(file).length)
181. 			.replace(/^\d/, '_$&')
182. 			.replace(/[^a-zA-Z0-9_$]/g, '');
183. 
184. 		const { code } = s.compile(
185. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
186. 			Object.assign(options, {
187. 				filename: file,
188. 				name: capitalise(name)
189. 			})
190. 		);
191. 
192. 		console.log( // eslint-disable-line no-console
193. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
194. 		);
195. 	});
196. }
197. 
198. const start = /\n(\t+)/;
199. export function deindent(strings, ...values) {
200. 	const indentation = start.exec(strings[0])[1];
201. 	const pattern = new RegExp(`^${indentation}`, 'gm');
202. 
203. 	let result = strings[0].replace(start, '').replace(pattern, '');
204. 
205. 	let trailingIndentation = getTrailingIndentation(result);
206. 
207. 	for (let i = 1; i < strings.length; i += 1) {
208. 		let expression = values[i - 1];
209. 		const string = strings[i].replace(pattern, '');
210. 
211. 		if (Array.isArray(expression)) {
212. 			expression = expression.length ? expression.join('\n') : null;
213. 		}
214. 
215. 		if (expression || expression === '') {
216. 			const value = String(expression).replace(
217. 				/\n/g,
218. 				`\n${trailingIndentation}`
219. 			);
220. 			result += value + string;
221. 		} else {
222. 			let c = result.length;
223. 			while (/\s/.test(result[c - 1])) c -= 1;
224. 			result = result.slice(0, c) + string;
225. 		}
226. 
227. 		trailingIndentation = getTrailingIndentation(result);
228. 	}
229. 
230. 	return result.trim().replace(/\t+$/gm, '');
231. }
232. 
233. function getTrailingIndentation(str) {
234. 	let i = str.length;
235. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
236. 	return str.slice(i, str.length);
237. }
238. 
239. export function spaces(i) {
240. 	let result = '';
241. 	while (i--) result += ' ';
242. 	return result;
243. }


File: test/runtime/index.js
Line number range: 1 - 251
Content:
1. import assert from "assert";
2. import chalk from 'chalk';
3. import * as path from "path";
4. import * as fs from "fs";
5. import * as acorn from "acorn";
6. import { transitionManager } from "../../shared.js";
7. 
8. import {
9. 	showOutput,
10. 	loadConfig,
11. 	loadSvelte,
12. 	env,
13. 	setupHtmlEqual,
14. 	spaces
15. } from "../helpers.js";
16. 
17. let svelte;
18. 
19. let compileOptions = null;
20. 
21. function getName(filename) {
22. 	const base = path.basename(filename).replace(".html", "");
23. 	return base[0].toUpperCase() + base.slice(1);
24. }
25. 
26. describe("runtime", () => {
27. 	before(() => {
28. 		svelte = loadSvelte(true);
29. 
30. 		require.extensions[".html"] = function(module, filename) {
31. 			const options = Object.assign(
32. 				{ filename, name: getName(filename), format: 'cjs' },
33. 				compileOptions
34. 			);
35. 
36. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
37. 
38. 			return module._compile(code, filename);
39. 		};
40. 
41. 		return setupHtmlEqual();
42. 	});
43. 
44. 	const failed = new Set();
45. 
46. 	function runTest(dir, shared, hydrate) {
47. 		if (dir[0] === ".") return;
48. 
49. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
50. 
51. 		if (config.solo && process.env.CI) {
52. 			throw new Error("Forgot to remove `solo: true` from test");
53. 		}
54. 
55. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers${hydrate ? ' , hydration' : ''})`, () => {
56. 			if (failed.has(dir)) {
57. 				// this makes debugging easier, by only printing compiled output once
58. 				throw new Error('skipping test, already failed');
59. 			}
60. 
61. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
62. 			global.document.title = '';
63. 
64. 			compileOptions = config.compileOptions || {};
65. 			compileOptions.shared = shared;
66. 			compileOptions.hydratable = hydrate;
67. 			compileOptions.dev = config.dev;
68. 			compileOptions.store = !!config.store;
69. 
70. 			// check that no ES2015+ syntax slipped in
71. 			if (!config.allowES2015) {
72. 				try {
73. 					const source = fs.readFileSync(
74. 						`test/runtime/samples/${dir}/main.html`,
75. 						"utf-8"
76. 					);
77. 					const { code } = svelte.compile(source, compileOptions);
78. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
79. 					if (startIndex === -1) throw new Error("missing create_main_fragment");
80. 					const endIndex = code.lastIndexOf("export default");
81. 					const es5 =
82. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
83. 						code.slice(startIndex, endIndex);
84. 
85. 					acorn.parse(es5, { ecmaVersion: 5 });
86. 
87. 					if (/Object\.assign/.test(es5)) {
88. 						throw new Error(
89. 							"cannot use Object.assign in generated code, as it is not supported everywhere"
90. 						);
91. 					}
92. 				} catch (err) {
93. 					failed.add(dir);
94. 					if (err.frame) {
95. 						console.error(chalk.red(err.frame)); // eslint-disable-line no-console
96. 					}
97. 					showOutput(cwd, { shared, format: 'cjs', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
98. 					throw err;
99. 				}
100. 			}
101. 
102. 			Object.keys(require.cache)
103. 				.filter(x => x.endsWith(".html"))
104. 				.forEach(file => {
105. 					delete require.cache[file];
106. 				});
107. 
108. 			let SvelteComponent;
109. 
110. 			let unintendedError = null;
111. 
112. 			const window = env();
113. 
114. 			return Promise.resolve()
115. 				.then(() => {
116. 					// set of hacks to support transition tests
117. 					transitionManager.running = false;
118. 					transitionManager.transitions = [];
119. 
120. 					const raf = {
121. 						time: 0,
122. 						callback: null,
123. 						tick: now => {
124. 							raf.time = now;
125. 							if (raf.callback) raf.callback();
126. 						}
127. 					};
128. 					window.performance = { now: () => raf.time };
129. 					global.requestAnimationFrame = cb => {
130. 						let called = false;
131. 						raf.callback = () => {
132. 							if (!called) {
133. 								called = true;
134. 								cb();
135. 							}
136. 						};
137. 					};
138. 
139. 					try {
140. 						SvelteComponent = require(`./samples/${dir}/main.html`);
141. 					} catch (err) {
142. 						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
143. 						throw err;
144. 					}
145. 
146. 					global.window = window;
147. 
148. 					// Put the constructor on window for testing
149. 					window.SvelteComponent = SvelteComponent;
150. 
151. 					const target = window.document.querySelector("main");
152. 
153. 					const warnings = [];
154. 					const warn = console.warn;
155. 					console.warn = warning => {
156. 						warnings.push(warning);
157. 					};
158. 
159. 					const options = Object.assign({}, {
160. 						target,
161. 						hydrate,
162. 						data: config.data,
163. 						store: (config.store !== true && config.store)
164. 					}, config.options || {});
165. 
166. 					const component = new SvelteComponent(options);
167. 
168. 					console.warn = warn;
169. 
170. 					if (config.error) {
171. 						unintendedError = true;
172. 						throw new Error("Expected a runtime error");
173. 					}
174. 
175. 					if (config.warnings) {
176. 						assert.deepEqual(warnings, config.warnings);
177. 					} else if (warnings.length) {
178. 						unintendedError = true;
179. 						throw new Error("Received unexpected warnings");
180. 					}
181. 
182. 					if (config.html) {
183. 						assert.htmlEqual(target.innerHTML, config.html);
184. 					}
185. 
186. 					if (config.test) {
187. 						return Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {
188. 							component.destroy();
189. 						});
190. 					} else {
191. 						component.destroy();
192. 						assert.equal(target.innerHTML, "");
193. 					}
194. 				})
195. 				.catch(err => {
196. 					if (config.error && !unintendedError) {
197. 						config.error(assert, err);
198. 					} else {
199. 						failed.add(dir);
200. 						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
201. 						throw err;
202. 					}
203. 				})
204. 				.then(() => {
205. 					if (config.show) showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte);
206. 				});
207. 		});
208. 	}
209. 
210. 	const shared = path.resolve("shared.js");
211. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
212. 		runTest(dir, shared, false);
213. 		runTest(dir, shared, true);
214. 		runTest(dir, null, false);
215. 	});
216. 
217. 	it("fails if options.target is missing in dev mode", () => {
218. 		const { code } = svelte.compile(`<div></div>`, {
219. 			format: "iife",
220. 			name: "SvelteComponent",
221. 			dev: true
222. 		});
223. 
224. 		const SvelteComponent = eval(
225. 			`(function () { ${code}; return SvelteComponent; }())`
226. 		);
227. 
228. 		assert.throws(() => {
229. 			new SvelteComponent();
230. 		}, /'target' is a required option/);
231. 	});
232. 
233. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
234. 		const { code } = svelte.compile(`<div></div>`, {
235. 			format: "iife",
236. 			name: "SvelteComponent",
237. 			dev: true
238. 		});
239. 
240. 		const SvelteComponent = eval(
241. 			`(function () { ${code}; return SvelteComponent; }())`
242. 		);
243. 
244. 		assert.throws(() => {
245. 			new SvelteComponent({
246. 				target: {},
247. 				hydrate: true
248. 			});
249. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
250. 	});
251. });


File: test/server-side-rendering/index.js
Line number range: 1 - 132
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require("../../ssr/register")({
25. 			extensions: ['.svelte', '.html'],
26. 			store: true
27. 		});
28. 
29. 		return setupHtmlEqual();
30. 	});
31. 
32. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
33. 		if (dir[0] === ".") return;
34. 
35. 		// add .solo to a sample directory name to only run that test, or
36. 		// .show to always show the output. or both
37. 		const solo = /\.solo/.test(dir);
38. 		const show = /\.show/.test(dir);
39. 
40. 		if (solo && process.env.CI) {
41. 			throw new Error("Forgot to remove `solo: true` from test");
42. 		}
43. 
44. 		(solo ? it.only : it)(dir, () => {
45. 			dir = path.resolve("test/server-side-rendering/samples", dir);
46. 			try {
47. 				let component;
48. 
49. 				const mainHtmlFile = `${dir}/main.html`;
50. 				const mainSvelteFile = `${dir}/main.svelte`;
51. 				if (fs.existsSync(mainHtmlFile)) {
52. 					component = require(mainHtmlFile);
53. 				} else if (fs.existsSync(mainSvelteFile)) {
54. 					component = require(mainSvelteFile);
55. 				}
56. 
57. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
58. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
59. 
60. 				const data = tryToLoadJson(`${dir}/data.json`);
61. 
62. 				const rendered = component.render(data);
63. 				const { html, css, head } = rendered;
64. 
65. 				// rendered.toString() === rendered.html
66. 				assert.equal(rendered, html);
67. 
68. 				fs.writeFileSync(`${dir}/_actual.html`, html);
69. 				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);
70. 
71. 				assert.htmlEqual(html, expectedHtml);
72. 				assert.equal(
73. 					css.code.replace(/^\s+/gm, ""),
74. 					expectedCss.replace(/^\s+/gm, "")
75. 				);
76. 
77. 				if (fs.existsSync(`${dir}/_expected-head.html`)) {
78. 					fs.writeFileSync(`${dir}/_actual-head.html`, head);
79. 					assert.htmlEqual(
80. 						head,
81. 						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
82. 					);
83. 				}
84. 
85. 				if (show) showOutput(dir, { generate: 'ssr' });
86. 			} catch (err) {
87. 				showOutput(dir, { generate: 'ssr' });
88. 				throw err;
89. 			}
90. 		});
91. 	});
92. 
93. 	// duplicate client-side tests, as far as possible
94. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
95. 		if (dir[0] === ".") return;
96. 
97. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
98. 
99. 		if (config.solo && process.env.CI) {
100. 			throw new Error("Forgot to remove `solo: true` from test");
101. 		}
102. 
103. 		if (config["skip-ssr"]) return;
104. 
105. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
106. 			const cwd = path.resolve("test/runtime/samples", dir);
107. 
108. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
109. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
110. 				delete require.cache[resolved];
111. 			});
112. 
113. 			require("../../ssr/register")({
114. 				store: !!config.store
115. 			});
116. 
117. 			try {
118. 				const component = require(`../runtime/samples/${dir}/main.html`);
119. 				const { html } = component.render(config.data, {
120. 					store: (config.store !== true) && config.store
121. 				});
122. 
123. 				if (config.html) {
124. 					assert.htmlEqual(html, config.html);
125. 				}
126. 			} catch (err) {
127. 				showOutput(cwd, { generate: "ssr" });
128. 				throw err;
129. 			}
130. 		});
131. 	});
132. });


File: test/store/index.js
Line number range: 1 - 190
Content:
1. import fs from 'fs';
2. import assert from 'assert';
3. import MagicString from 'magic-string';
4. import { parse } from 'acorn';
5. import { Store } from '../../store.js';
6. 
7. describe('store', () => {
8. 	it('is written in ES5', () => {
9. 		const source = fs.readFileSync('store.js', 'utf-8');
10. 
11. 		const ast = parse(source, {
12. 			sourceType: 'module'
13. 		});
14. 
15. 		const magicString = new MagicString(source);
16. 		ast.body.forEach(node => {
17. 			if (/^(Im|Ex)port/.test(node.type)) magicString.remove(node.start, node.end);
18. 		});
19. 
20. 		parse(magicString.toString(), {
21. 			ecmaVersion: 5
22. 		});
23. 	});
24. 
25. 	describe('get', () => {
26. 		it('gets a specific key', () => {
27. 			const store = new Store({
28. 				foo: 'bar'
29. 			});
30. 
31. 			assert.equal(store.get('foo'), 'bar');
32. 		});
33. 
34. 		it('gets the entire state object', () => {
35. 			const store = new Store({
36. 				foo: 'bar'
37. 			});
38. 
39. 			assert.deepEqual(store.get(), { foo: 'bar' });
40. 		});
41. 	});
42. 
43. 	describe('set', () => {
44. 		it('sets state', () => {
45. 			const store = new Store();
46. 
47. 			store.set({
48. 				foo: 'bar'
49. 			});
50. 
51. 			assert.equal(store.get('foo'), 'bar');
52. 		});
53. 	});
54. 
55. 	describe('observe', () => {
56. 		it('observes state', () => {
57. 			let newFoo;
58. 			let oldFoo;
59. 
60. 			const store = new Store({
61. 				foo: 'bar'
62. 			});
63. 
64. 			store.observe('foo', (n, o) => {
65. 				newFoo = n;
66. 				oldFoo = o;
67. 			});
68. 
69. 			assert.equal(newFoo, 'bar');
70. 			assert.equal(oldFoo, undefined);
71. 
72. 			store.set({
73. 				foo: 'baz'
74. 			});
75. 
76. 			assert.equal(newFoo, 'baz');
77. 			assert.equal(oldFoo, 'bar');
78. 		});
79. 	});
80. 
81. 	describe('onchange', () => {
82. 		it('fires a callback when state changes', () => {
83. 			const store = new Store();
84. 
85. 			let count = 0;
86. 			let args;
87. 
88. 			store.onchange((state, changed) => {
89. 				count += 1;
90. 				args = { state, changed };
91. 			});
92. 
93. 			store.set({ foo: 'bar' });
94. 
95. 			assert.equal(count, 1);
96. 			assert.deepEqual(args, {
97. 				state: { foo: 'bar' },
98. 				changed: { foo: true }
99. 			});
100. 
101. 			// this should be a noop
102. 			store.set({ foo: 'bar' });
103. 			assert.equal(count, 1);
104. 
105. 			// this shouldn't
106. 			store.set({ foo: 'baz' });
107. 
108. 			assert.equal(count, 2);
109. 			assert.deepEqual(args, {
110. 				state: { foo: 'baz' },
111. 				changed: { foo: true }
112. 			});
113. 		});
114. 	});
115. 
116. 	describe('computed', () => {
117. 		it('computes a property based on data', () => {
118. 			const store = new Store({
119. 				foo: 1
120. 			});
121. 
122. 			store.compute('bar', ['foo'], foo => foo * 2);
123. 			assert.equal(store.get('bar'), 2);
124. 
125. 			const values = [];
126. 
127. 			store.observe('bar', bar => {
128. 				values.push(bar);
129. 			});
130. 
131. 			store.set({ foo: 2 });
132. 			assert.deepEqual(values, [2, 4]);
133. 		});
134. 
135. 		it('computes a property based on another computed property', () => {
136. 			const store = new Store({
137. 				foo: 1
138. 			});
139. 
140. 			store.compute('bar', ['foo'], foo => foo * 2);
141. 			store.compute('baz', ['bar'], bar => bar * 2);
142. 			assert.equal(store.get('baz'), 4);
143. 
144. 			const values = [];
145. 
146. 			store.observe('baz', baz => {
147. 				values.push(baz);
148. 			});
149. 
150. 			store.set({ foo: 2 });
151. 			assert.deepEqual(values, [4, 8]);
152. 		});
153. 
154. 		it('prevents computed properties from being set', () => {
155. 			const store = new Store({
156. 				foo: 1
157. 			});
158. 
159. 			store.compute('bar', ['foo'], foo => foo * 2);
160. 
161. 			assert.throws(() => {
162. 				store.set({ bar: 'whatever' });
163. 			}, /'bar' is a read-only property/);
164. 		});
165. 
166. 		it('allows multiple dependents to depend on the same computed property', () => {
167. 			const store = new Store({
168. 				a: 1
169. 			});
170. 
171. 			store.compute('b', ['a'], a => a * 2);
172. 			store.compute('c', ['b'], b => b * 3);
173. 			store.compute('d', ['b'], b => b * 4);
174. 
175. 			assert.deepEqual(store.get(), { a: 1, b: 2, c: 6, d: 8 });
176. 
177. 			// bit cheeky, testing a private property, but whatever
178. 			assert.equal(store._sortedComputedProperties.length, 3);
179. 		});
180. 
181. 		it('prevents cyclical dependencies', () => {
182. 			const store = new Store();
183. 
184. 			assert.throws(() => {
185. 				store.compute('a', ['b'], b => b + 1);
186. 				store.compute('b', ['a'], a => a + 1);
187. 			}, /Cyclical dependency detected/);
188. 		});
189. 	});
190. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 13:31:37,604 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The current context provides the generic test harness files but lacks the actual sample test contents (_config.js, main.html, nested components) where store-enabled behavior is exercised. To extract 8 relevant, self-contained regression tests with exact line numbers, I need the specific runtime sample directories that use a store and nested components. Without these files, I cannot enumerate the tests, their imports, assertions, or line ranges.' query='Please provide the full contents (with line numbers) of test/runtime/samples/store-root, store-binding, store-computed, and store-event, plus any other test/runtime/samples whose _config.js sets store to a truthy value.' extra_requirements='Include all files in those directories: _config.js, main.html, any nested component .html files, expected outputs, and data.json if present.' purpose='These samples define the actual store-enabled and nested-component tests needed to select 8 precise regression cases for the SSR nested store issue with complete setups and assertions.'
2025-11-12 13:31:37,606 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents (with line numbers) of test/runtime/samples/store-root, store-binding, store-computed, and store-event, plus any other test/runtime/samples whose _config.js sets store to a truthy value.
2025-11-12 13:31:38,438 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 13:31:38,438 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 13:31:38,438 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 13:31:38,438 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 13:31:38,439 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 13:31:38,441 - thread-135845298308800.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 13:31:38,441 - thread-135845298308800.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents (with line numbers) of test/runtime/samples/store-root, store-binding, store-computed, and store-event, plus any other test/runtime/samples whose _config.js sets store to a truthy value.
Extra requirements: Include all files in those directories: _config.js, main.html, any nested component .html files, expected outputs, and data.json if present.
Purpose: These samples define the actual store-enabled and nested-component tests needed to select 8 precise regression cases for the SSR nested store issue with complete setups and assertions.
2025-11-12 13:31:56,933 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_PhLgCN0WEaA1K6e8mbwd331d', 'function': {'arguments': '{"text":"store:", "basename":"_config.js"}', 'name': 'find_ast_node_with_text_in_file_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2087, 'prompt_tokens': 2221, 'total_tokens': 4308, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2048, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d297db44-922b-4687-9aef-5bc86c5cc6b5-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'text': 'store:', 'basename': '_config.js'}, 'id': 'call_PhLgCN0WEaA1K6e8mbwd331d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2221, 'output_tokens': 2087, 'total_tokens': 4308, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 2048}}
2025-11-12 13:32:15,755 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_nq6dYSfJUYxgWbrRQAOa8vje', 'function': {'arguments': '{"text":"store: true","basename":"_config.js"}', 'name': 'find_ast_node_with_text_in_file_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1704, 'prompt_tokens': 2478, 'total_tokens': 4182, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1664, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ece53a91-9f73-4ba6-96c2-52f6f9b6aaf1-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'text': 'store: true', 'basename': '_config.js'}, 'id': 'call_nq6dYSfJUYxgWbrRQAOa8vje', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2478, 'output_tokens': 1704, 'total_tokens': 4182, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1664}}
2025-11-12 13:32:33,244 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Upe65pVD1ceHv8f3QcFg5Ves', 'function': {'arguments': '{"text":"store:","relative_path":"test/runtime/samples"}', 'name': 'find_ast_node_with_text_in_file_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1513, 'prompt_tokens': 2736, 'total_tokens': 4249, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1472, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f8ab8d5c-9018-44dc-9816-3036fe72cf5a-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'store:', 'relative_path': 'test/runtime/samples'}, 'id': 'call_Upe65pVD1ceHv8f3QcFg5Ves', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2736, 'output_tokens': 1513, 'total_tokens': 4249, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1472}}
2025-11-12 13:32:50,905 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_822qB5CunWpEQS5204e1oPZZ', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-root/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1894, 'prompt_tokens': 2802, 'total_tokens': 4696, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1856, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f7af1c0c-eb45-47af-b28a-c20367204c6f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-root/_config.js'}, 'id': 'call_822qB5CunWpEQS5204e1oPZZ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2802, 'output_tokens': 1894, 'total_tokens': 4696, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1856}}
2025-11-12 13:33:17,379 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_nbvAyv3giGjjFssP5455JtGs', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-binding/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2214, 'prompt_tokens': 3086, 'total_tokens': 5300, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2176, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3b10a054-ed7e-4359-a6a6-41d482b11bd7-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-binding/_config.js'}, 'id': 'call_nbvAyv3giGjjFssP5455JtGs', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3086, 'output_tokens': 2214, 'total_tokens': 5300, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 2176}}
2025-11-12 13:33:18,679 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_2zkgK4eLyrx7LpKkAfG0hKwa', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-computed/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 3450, 'total_tokens': 3483, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2688}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5b6a96f0-ac61-4465-9066-9a4d5112ed6d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-computed/_config.js'}, 'id': 'call_2zkgK4eLyrx7LpKkAfG0hKwa', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3450, 'output_tokens': 33, 'total_tokens': 3483, 'input_token_details': {'audio': 0, 'cache_read': 2688}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:33:20,467 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_B3aDcJJ6d7iAFb78YWHyIleg', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-event/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 4178, 'total_tokens': 4210, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--86dbdd75-b188-4016-a83e-48a2d72669a1-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-event/_config.js'}, 'id': 'call_B3aDcJJ6d7iAFb78YWHyIleg', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4178, 'output_tokens': 32, 'total_tokens': 4210, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:33:41,609 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_XH2nYhVk7gifrDZwtsRq4jUe', 'function': {'arguments': '{"text":"store,","basename":"_config.js"}', 'name': 'find_ast_node_with_text_in_file_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1703, 'prompt_tokens': 4588, 'total_tokens': 6291, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1664, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4096}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f89512b3-df14-46d9-8c00-91882c52c7c0-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'text': 'store,', 'basename': '_config.js'}, 'id': 'call_XH2nYhVk7gifrDZwtsRq4jUe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4588, 'output_tokens': 1703, 'total_tokens': 6291, 'input_token_details': {'audio': 0, 'cache_read': 4096}, 'output_token_details': {'audio': 0, 'reasoning': 1664}}
2025-11-12 13:33:53,512 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_aP81kUZtjisTijVMigYYQgc8', 'function': {'arguments': '{"basename":"_config.js"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 990, 'prompt_tokens': 5545, 'total_tokens': 6535, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3456}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--10bdf7c9-596b-4b22-931f-ce56cda133d1-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': '_config.js'}, 'id': 'call_aP81kUZtjisTijVMigYYQgc8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5545, 'output_tokens': 990, 'total_tokens': 6535, 'input_token_details': {'audio': 0, 'cache_read': 3456}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 13:34:04,852 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_EtCZjzZYG55RRzAy4gOAjBOZ', 'function': {'arguments': '{"basename":"main.html"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 861, 'prompt_tokens': 5782, 'total_tokens': 6643, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4480}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1846a68d-6e81-4a35-ac9b-b2ae6bba4524-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'main.html'}, 'id': 'call_EtCZjzZYG55RRzAy4gOAjBOZ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5782, 'output_tokens': 861, 'total_tokens': 6643, 'input_token_details': {'audio': 0, 'cache_read': 4480}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 13:34:08,565 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_IAmW66XoJnmo6Bmmmqm9maI6', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-root/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 229, 'prompt_tokens': 6021, 'total_tokens': 6250, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--34f83fc9-1b9b-4bc4-90fa-bb73577be1b5-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-root/main.html'}, 'id': 'call_IAmW66XoJnmo6Bmmmqm9maI6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6021, 'output_tokens': 229, 'total_tokens': 6250, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 13:34:10,030 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lzjCvpzssF1SOscN8z3bTu2a', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-root/Nested.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 6285, 'total_tokens': 6317, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c746310a-b139-4995-a39e-c652d09e4e6a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-root/Nested.html'}, 'id': 'call_lzjCvpzssF1SOscN8z3bTu2a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6285, 'output_tokens': 32, 'total_tokens': 6317, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:34:11,602 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ehYCLE6MiKjrkId57UWiPMXB', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-binding/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 6406, 'total_tokens': 6437, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5760}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a825f3fc-6662-4c98-aa13-cb2742336053-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-binding/main.html'}, 'id': 'call_ehYCLE6MiKjrkId57UWiPMXB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6406, 'output_tokens': 31, 'total_tokens': 6437, 'input_token_details': {'audio': 0, 'cache_read': 5760}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:34:13,222 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4oKUfp8ikd6XEkWEkm1l8FSk', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-binding/NameInput.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 6591, 'total_tokens': 6624, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ea16b3f5-0278-4946-9e31-1db092e73252-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-binding/NameInput.html'}, 'id': 'call_4oKUfp8ikd6XEkWEkm1l8FSk', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6591, 'output_tokens': 33, 'total_tokens': 6624, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:34:14,747 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hwIp4pqZ5Rb237U3Id8WuhEO', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-computed/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 6707, 'total_tokens': 6739, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6400}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5bf3f60a-943b-4ac1-9708-9fedfaf0e024-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-computed/main.html'}, 'id': 'call_hwIp4pqZ5Rb237U3Id8WuhEO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6707, 'output_tokens': 32, 'total_tokens': 6739, 'input_token_details': {'audio': 0, 'cache_read': 6400}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:34:16,446 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_O4obLviM9dumf6ST1rgPNpdB', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-computed/Todo.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 6898, 'total_tokens': 6931, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1b187590-3163-4e38-9c62-cb89a5c6c349-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-computed/Todo.html'}, 'id': 'call_O4obLviM9dumf6ST1rgPNpdB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6898, 'output_tokens': 33, 'total_tokens': 6931, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:34:17,716 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ucGPHzKzfo7EVF3pUzpDbLsG', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-event/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 7177, 'total_tokens': 7208, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5504}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e8584e70-c230-4177-9997-63a97a1ae0ea-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-event/main.html'}, 'id': 'call_ucGPHzKzfo7EVF3pUzpDbLsG', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7177, 'output_tokens': 31, 'total_tokens': 7208, 'input_token_details': {'audio': 0, 'cache_read': 5504}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:34:18,928 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_IGDwa6EfKoTUKI14GV5flg6U', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-event/NameInput.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 7362, 'total_tokens': 7395, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6272}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--62260945-cbef-4993-8dcf-f15cc5acf779-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-event/NameInput.html'}, 'id': 'call_IGDwa6EfKoTUKI14GV5flg6U', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7362, 'output_tokens': 33, 'total_tokens': 7395, 'input_token_details': {'audio': 0, 'cache_read': 6272}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:34:43,579 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OXbX6J7fHbWYjYP3c9Qk5Sm8', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1509, 'prompt_tokens': 7485, 'total_tokens': 8994, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1472, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--609a445a-0f7d-4ebb-9e22-b477609b3a04-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store/_config.js'}, 'id': 'call_OXbX6J7fHbWYjYP3c9Qk5Sm8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7485, 'output_tokens': 1509, 'total_tokens': 8994, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1472}}
2025-11-12 13:34:45,213 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_n2kuYdrblPcpgZsldcLdAF4H', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 7739, 'total_tokens': 7769, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6656}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--71e53e30-7df2-4ce8-8ffb-c72fd788abda-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store/main.html'}, 'id': 'call_n2kuYdrblPcpgZsldcLdAF4H', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7739, 'output_tokens': 30, 'total_tokens': 7769, 'input_token_details': {'audio': 0, 'cache_read': 6656}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:35:10,844 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lUdUoEoyaGer15E6IuYabnR1', 'function': {'arguments': '{"basename":"data.json"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2589, 'prompt_tokens': 7852, 'total_tokens': 10441, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2560, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 7168}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--36b14127-e7e0-4ac0-8b63-71121d5f264f-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'data.json'}, 'id': 'call_lUdUoEoyaGer15E6IuYabnR1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7852, 'output_tokens': 2589, 'total_tokens': 10441, 'input_token_details': {'audio': 0, 'cache_read': 7168}, 'output_token_details': {'audio': 0, 'reasoning': 2560}}
2025-11-12 13:35:44,314 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located the specified sample directories and retrieved the full, line-numbered contents for store-root, store-binding, store-computed, and store-event, including their _config.js, main.html, and nested component .html files. I also identified another test/runtime sample with a truthy store setting (test/runtime/samples/store) and fetched its _config.js and main.html. I checked for data.json and any separate expected output files in these directories; none were present, and the expected HTML assertions are embedded within each _config.js. This provides the complete setups and assertions for all store-enabled runtime samples relevant to the SSR nested store issue.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2251, 'prompt_tokens': 7901, 'total_tokens': 10152, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2112, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--bdfacb2d-3f19-4968-b40c-43beeaeb7025-0' usage_metadata={'input_tokens': 7901, 'output_tokens': 2251, 'total_tokens': 10152, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 2112}}
2025-11-12 13:35:44,332 - thread-135845298308800.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents (with line numbers) of test/runtime/samples/store-root, store-binding, store-computed, and store-event, plus any other test/runtime/samples whose _config.js sets store to a truthy value.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
Include all files in those directories: _config.js, main.html, any nested component .html files, expected outputs, and data.json if present.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These samples define the actual store-enabled and nested-component tests needed to select 8 precise regression cases for the SSR nested store issue with complete setups and assertions.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: test/runtime/samples/store-binding/NameInput.html
Line number range: 1 - 1
Content:
1. <input bind:value=$name>


File: test/runtime/samples/store-binding/_config.js
Line number range: 1 - 28
Content:
1. import { Store } from '../../../../store.js';
2. 
3. const store = new Store({
4. 	name: 'world'
5. });
6. 
7. export default {
8. 	store,
9. 
10. 	html: `
11. 		<h1>Hello world!</h1>
12. 		<input>
13. 	`,
14. 
15. 	test(assert, component, target, window) {
16. 		const input = target.querySelector('input');
17. 		const event = new window.Event('input');
18. 
19. 		input.value = 'everybody';
20. 		input.dispatchEvent(event);
21. 
22. 		assert.equal(store.get('name'), 'everybody');
23. 		assert.htmlEqual(target.innerHTML, `
24. 			<h1>Hello everybody!</h1>
25. 			<input>
26. 		`);
27. 	}
28. };


File: test/runtime/samples/store-binding/main.html
Line number range: 1 - 10
Content:
1. <h1>Hello {{$name}}!</h1>
2. <NameInput/>
3. 
4. <script>
5. 	import NameInput from './NameInput.html';
6. 
7. 	export default {
8. 		components: { NameInput }
9. 	};
10. </script>


File: test/runtime/samples/store-computed/Todo.html
Line number range: 1 - 15
Content:
1. {{#if isVisible}}
2. 	<div class='{{todo.done ? "done": "pending"}}'>{{todo.description}}</div>
3. {{/if}}
4. 
5. <script>
6. 	export default {
7. 		computed: {
8. 			isVisible: ($filter, todo) => {
9. 				if ($filter === 'all') return true;
10. 				if ($filter === 'done') return todo.done;
11. 				if ($filter === 'pending') return !todo.done;
12. 			}
13. 		}
14. 	};
15. </script>


File: test/runtime/samples/store-computed/_config.js
Line number range: 1 - 63
Content:
1. import { Store } from '../../../../store.js';
2. 
3. class MyStore extends Store {
4. 	setFilter(filter) {
5. 		this.set({ filter });
6. 	}
7. 
8. 	toggleTodo(todo) {
9. 		todo.done = !todo.done;
10. 		this.set({ todos: this.get('todos') });
11. 	}
12. }
13. 
14. const todos = [
15. 	{
16. 		description: 'Buy some milk',
17. 		done: true,
18. 	},
19. 	{
20. 		description: 'Do the laundry',
21. 		done: true,
22. 	},
23. 	{
24. 		description: "Find life's true purpose",
25. 		done: false,
26. 	}
27. ];
28. 
29. const store = new MyStore({
30. 	filter: 'all',
31. 	todos
32. });
33. 
34. export default {
35. 	store,
36. 
37. 	html: `
38. 		<div class='done'>Buy some milk</div>
39. 		<div class='done'>Do the laundry</div>
40. 		<div class='pending'>Find life's true purpose</div>
41. 	`,
42. 
43. 	test(assert, component, target) {
44. 		store.setFilter('pending');
45. 
46. 		assert.htmlEqual(target.innerHTML, `
47. 			<div class='pending'>Find life's true purpose</div>
48. 		`);
49. 
50. 		store.toggleTodo(todos[1]);
51. 
52. 		assert.htmlEqual(target.innerHTML, `
53. 			<div class='pending'>Do the laundry</div>
54. 			<div class='pending'>Find life's true purpose</div>
55. 		`);
56. 
57. 		store.setFilter('done');
58. 
59. 		assert.htmlEqual(target.innerHTML, `
60. 			<div class='done'>Buy some milk</div>
61. 		`);
62. 	}
63. };


File: test/runtime/samples/store-computed/main.html
Line number range: 1 - 11
Content:
1. {{#each $todos as todo}}
2. 	<Todo :todo/>
3. {{/each}}
4. 
5. <script>
6. 	import Todo from './Todo.html';
7. 
8. 	export default {
9. 		components: { Todo }
10. 	};
11. </script>


File: test/runtime/samples/store-event/NameInput.html
Line number range: 1 - 1
Content:
1. <input on:input='store.setName(this.value)'>


File: test/runtime/samples/store-event/_config.js
Line number range: 1 - 34
Content:
1. import { Store } from '../../../../store.js';
2. 
3. class MyStore extends Store {
4. 	setName(name) {
5. 		this.set({ name });
6. 	}
7. }
8. 
9. const store = new MyStore({
10. 	name: 'world'
11. });
12. 
13. export default {
14. 	store,
15. 
16. 	html: `
17. 		<h1>Hello world!</h1>
18. 		<input>
19. 	`,
20. 
21. 	test(assert, component, target, window) {
22. 		const input = target.querySelector('input');
23. 		const event = new window.Event('input');
24. 
25. 		input.value = 'everybody';
26. 		input.dispatchEvent(event);
27. 
28. 		assert.equal(store.get('name'), 'everybody');
29. 		assert.htmlEqual(target.innerHTML, `
30. 			<h1>Hello everybody!</h1>
31. 			<input>
32. 		`);
33. 	}
34. };


File: test/runtime/samples/store-event/main.html
Line number range: 1 - 10
Content:
1. <h1>Hello {{$name}}!</h1>
2. <NameInput/>
3. 
4. <script>
5. 	import NameInput from './NameInput.html';
6. 
7. 	export default {
8. 		components: { NameInput }
9. 	};
10. </script>


File: test/runtime/samples/store-root/Nested.html
Line number range: 1 - 1
Content:
1. <p>It's nice to see you, {{$name}}.</p>


File: test/runtime/samples/store-root/_config.js
Line number range: 1 - 17
Content:
export default {
	store: true, // TODO remove this in v2

	html: `
		<h1>Hello world!</h1>
		<p>It's nice to see you, world.</p>
	`,

	test(assert, component, target) {
		component.store.set({ name: 'everybody' });

		assert.htmlEqual(target.innerHTML, `
			<h1>Hello everybody!</h1>
			<p>It's nice to see you, everybody.</p>
		`);
	}
};


File: test/runtime/samples/store-root/main.html
Line number range: 1 - 19
Content:
1. <h1>Hello {{$name}}!</h1>
2. <Nested/>
3. 
4. <script>
5. 	import { Store } from '../../../../store.js';
6. 	import Nested from './Nested.html';
7. 
8. 	export default {
9. 		store () {
10. 			return new Store({
11. 				name: 'world'
12. 			});
13. 		},
14. 
15. 		components: {
16. 			Nested
17. 		}
18. 	};
19. </script>


File: test/runtime/samples/store/_config.js
Line number range: 1 - 17
Content:
1. import { Store } from '../../../../store.js';
2. 
3. const store = new Store({
4. 	name: 'world'
5. });
6. 
7. export default {
8. 	store,
9. 
10. 	html: `<h1>Hello world!</h1>`,
11. 
12. 	test(assert, component, target) {
13. 		store.set({ name: 'everybody' });
14. 
15. 		assert.htmlEqual(target.innerHTML, `<h1>Hello everybody!</h1>`);
16. 	}
17. };


File: test/runtime/samples/store/main.html
Line number range: 1 - 1
Content:
1. <h1>Hello {{$name}}!</h1>

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 13:36:03,301 - thread-135845298308800.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='Query requires full contents of store-binding directory including nested component files; this _config.js sets a truthy store and includes expected HTML and test assertions.', relative_path='test/runtime/samples/store-binding/_config.js', start_line=1, end_line=28), ContextOutput(reasoning='Query requires full contents of store-binding; this is the main component file.', relative_path='test/runtime/samples/store-binding/main.html', start_line=1, end_line=10), ContextOutput(reasoning='Query requires nested component files within store-binding; NameInput.html binds to $name via store.', relative_path='test/runtime/samples/store-binding/NameInput.html', start_line=1, end_line=1), ContextOutput(reasoning='Query requires full contents of store-computed directory; this _config.js sets a truthy store and defines tests and expected HTML.', relative_path='test/runtime/samples/store-computed/_config.js', start_line=1, end_line=63), ContextOutput(reasoning='Query requires full contents of store-computed; main component iterates over $todos from the store.', relative_path='test/runtime/samples/store-computed/main.html', start_line=1, end_line=11), ContextOutput(reasoning='Query requires nested component files within store-computed; Todo.html uses computed property based on $filter and todo.', relative_path='test/runtime/samples/store-computed/Todo.html', start_line=1, end_line=15), ContextOutput(reasoning='Query requires full contents of store-event directory; this _config.js sets a truthy store and defines tests and expected HTML.', relative_path='test/runtime/samples/store-event/_config.js', start_line=1, end_line=34), ContextOutput(reasoning='Query requires full contents of store-event; main component uses $name and includes NameInput.', relative_path='test/runtime/samples/store-event/main.html', start_line=1, end_line=10), ContextOutput(reasoning='Query requires nested component files within store-event; NameInput.html dispatches input to store method.', relative_path='test/runtime/samples/store-event/NameInput.html', start_line=1, end_line=1), ContextOutput(reasoning='Query requires full contents of store-root directory; this _config.js sets store to true and includes expected HTML and test.', relative_path='test/runtime/samples/store-root/_config.js', start_line=1, end_line=17), ContextOutput(reasoning='Query requires full contents of store-root; main component provides a Store via store() and includes Nested.', relative_path='test/runtime/samples/store-root/main.html', start_line=1, end_line=19), ContextOutput(reasoning='Query requires nested component files within store-root; Nested.html uses $name from the store.', relative_path='test/runtime/samples/store-root/Nested.html', start_line=1, end_line=1), ContextOutput(reasoning="Additionally include any other samples whose _config.js sets store to a truthy value; this store sample's _config.js sets a Store instance as 'store' and defines expected HTML and test.", relative_path='test/runtime/samples/store/_config.js', start_line=1, end_line=17), ContextOutput(reasoning='Include all files in the store directory as it matches the truthy store criterion; this is the main component file.', relative_path='test/runtime/samples/store/main.html', start_line=1, end_line=1)]
2025-11-12 13:36:03,919 - thread-135845298308800.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 14 contexts to memory for query: Please provide the full contents (with line numbers) of test/runtime/samples/store-root, store-binding, store-computed, and store-event, plus any other test/runtime/samples whose _config.js sets store to a truthy value.
2025-11-12 13:36:04,358 - thread-135845298308800.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 13:36:04,374 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 14 new contexts to 4 existing contexts
2025-11-12 13:36:04,374 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 18 total contexts (removed 0 duplicates)
2025-11-12 13:36:04,376 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content of test/server-side-rendering/index.js, test/runtime/index.js, test/store/index.js, and test/helpers.js.
Extra Requirements: If sending all files is too large, please at minimum include test/server-side-rendering/index.js and test/helpers.js with their exact line numbers.
Purpose: I need to extract 8 relevant test cases with precise line numbers and complete setup/assertions to use as regression tests for the SSR nested store issue.

Previous refined query 2:
Essential Query: Please provide the full contents (with line numbers) of test/runtime/samples/store-root, store-binding, store-computed, and store-event, plus any other test/runtime/samples whose _config.js sets store to a truthy value.
Extra Requirements: Include all files in those directories: _config.js, main.html, any nested component .html files, expected outputs, and data.json if present.
Purpose: These samples define the actual store-enabled and nested-component tests needed to select 8 precise regression cases for the SSR nested store issue with complete setups and assertions.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: test/helpers.js
Line number range: 1 - 243
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	process.env.TEST = test ? 'true' : '';
12. 
13. 	const resolved = require.resolve('../compiler/svelte.js');
14. 
15. 	delete require.cache[resolved];
16. 	return require(resolved);
17. }
18. 
19. export const svelte = loadSvelte();
20. 
21. export function exists(path) {
22. 	try {
23. 		fs.statSync(path);
24. 		return true;
25. 	} catch (err) {
26. 		return false;
27. 	}
28. }
29. 
30. export function tryToLoadJson(file) {
31. 	try {
32. 		return JSON.parse(fs.readFileSync(file));
33. 	} catch (err) {
34. 		if (err.code !== 'ENOENT') throw err;
35. 		return null;
36. 	}
37. }
38. 
39. export function tryToReadFile(file) {
40. 	try {
41. 		return fs.readFileSync(file, 'utf-8');
42. 	} catch (err) {
43. 		if (err.code !== 'ENOENT') throw err;
44. 		return null;
45. 	}
46. }
47. 
48. const { window } = new JSDOM('<main></main>');
49. global.document = window.document;
50. 
51. export function env() {
52. 	window._svelteTransitionManager = null;
53. 	window.document.body.innerHTML = '<main></main>';
54. 
55. 	return window;
56. }
57. 
58. function cleanChildren(node) {
59. 	let previous = null;
60. 
61. 	// sort attributes
62. 	const attributes = Array.from(node.attributes).sort((a, b) => {
63. 		return a.name < b.name ? -1 : 1;
64. 	});
65. 
66. 	attributes.forEach(attr => {
67. 		node.removeAttribute(attr.name);
68. 	});
69. 
70. 	attributes.forEach(attr => {
71. 		node.setAttribute(attr.name, attr.value);
72. 	});
73. 
74. 	// recurse
75. 	[...node.childNodes].forEach(child => {
76. 		if (child.nodeType === 3) {
77. 			// text
78. 			if (
79. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
80. 				node.tagName !== 'text' &&
81. 				node.tagName !== 'tspan'
82. 			) {
83. 				node.removeChild(child);
84. 			}
85. 
86. 			child.data = child.data.replace(/\s{2,}/g, '\n');
87. 
88. 			if (previous && previous.nodeType === 3) {
89. 				previous.data += child.data;
90. 				previous.data = previous.data.replace(/\s{2,}/g, '\n');
91. 
92. 				node.removeChild(child);
93. 				child = previous;
94. 			}
95. 		} else {
96. 			cleanChildren(child);
97. 		}
98. 
99. 		previous = child;
100. 	});
101. 
102. 	// collapse whitespace
103. 	if (node.firstChild && node.firstChild.nodeType === 3) {
104. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
105. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
106. 	}
107. 
108. 	if (node.lastChild && node.lastChild.nodeType === 3) {
109. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
110. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
111. 	}
112. }
113. 
114. export function normalizeHtml(window, html) {
115. 	try {
116. 		const node = window.document.createElement('div');
117. 		node.innerHTML = html
118. 			.replace(/<!--.*?-->/g, '')
119. 			.replace(/>[\s\r\n]+</g, '><')
120. 			.trim();
121. 		cleanChildren(node, '');
122. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
123. 	} catch (err) {
124. 		throw new Error(`Failed to normalize HTML:\n${html}`);
125. 	}
126. }
127. 
128. export function setupHtmlEqual() {
129. 	const window = env();
130. 
131. 	assert.htmlEqual = (actual, expected, message) => {
132. 		assert.deepEqual(
133. 			normalizeHtml(window, actual),
134. 			normalizeHtml(window, expected),
135. 			message
136. 		);
137. 	};
138. }
139. 
140. export function loadConfig(file) {
141. 	try {
142. 		const resolved = require.resolve(file);
143. 		delete require.cache[resolved];
144. 
145. 		const config = require(resolved);
146. 		return config.default || config;
147. 	} catch (err) {
148. 		if (err.code === 'MODULE_NOT_FOUND') {
149. 			return {};
150. 		}
151. 
152. 		throw err;
153. 	}
154. }
155. 
156. export function addLineNumbers(code) {
157. 	return code
158. 		.split('\n')
159. 		.map((line, i) => {
160. 			i = String(i + 1);
161. 			while (i.length < 3) i = ` ${i}`;
162. 
163. 			return (
164. 				chalk.grey(`  ${i}: `) +
165. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
166. 			);
167. 		})
168. 		.join('\n');
169. }
170. 
171. function capitalise(str) {
172. 	return str[0].toUpperCase() + str.slice(1);
173. }
174. 
175. export function showOutput(cwd, options = {}, s = svelte) {
176. 	glob.sync('**/*.html', { cwd }).forEach(file => {
177. 		if (file[0] === '_') return;
178. 
179. 		const name = path.basename(file)
180. 			.slice(0, -path.extname(file).length)
181. 			.replace(/^\d/, '_$&')
182. 			.replace(/[^a-zA-Z0-9_$]/g, '');
183. 
184. 		const { code } = s.compile(
185. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
186. 			Object.assign(options, {
187. 				filename: file,
188. 				name: capitalise(name)
189. 			})
190. 		);
191. 
192. 		console.log( // eslint-disable-line no-console
193. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
194. 		);
195. 	});
196. }
197. 
198. const start = /\n(\t+)/;
199. export function deindent(strings, ...values) {
200. 	const indentation = start.exec(strings[0])[1];
201. 	const pattern = new RegExp(`^${indentation}`, 'gm');
202. 
203. 	let result = strings[0].replace(start, '').replace(pattern, '');
204. 
205. 	let trailingIndentation = getTrailingIndentation(result);
206. 
207. 	for (let i = 1; i < strings.length; i += 1) {
208. 		let expression = values[i - 1];
209. 		const string = strings[i].replace(pattern, '');
210. 
211. 		if (Array.isArray(expression)) {
212. 			expression = expression.length ? expression.join('\n') : null;
213. 		}
214. 
215. 		if (expression || expression === '') {
216. 			const value = String(expression).replace(
217. 				/\n/g,
218. 				`\n${trailingIndentation}`
219. 			);
220. 			result += value + string;
221. 		} else {
222. 			let c = result.length;
223. 			while (/\s/.test(result[c - 1])) c -= 1;
224. 			result = result.slice(0, c) + string;
225. 		}
226. 
227. 		trailingIndentation = getTrailingIndentation(result);
228. 	}
229. 
230. 	return result.trim().replace(/\t+$/gm, '');
231. }
232. 
233. function getTrailingIndentation(str) {
234. 	let i = str.length;
235. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
236. 	return str.slice(i, str.length);
237. }
238. 
239. export function spaces(i) {
240. 	let result = '';
241. 	while (i--) result += ' ';
242. 	return result;
243. }


File: test/runtime/index.js
Line number range: 1 - 251
Content:
1. import assert from "assert";
2. import chalk from 'chalk';
3. import * as path from "path";
4. import * as fs from "fs";
5. import * as acorn from "acorn";
6. import { transitionManager } from "../../shared.js";
7. 
8. import {
9. 	showOutput,
10. 	loadConfig,
11. 	loadSvelte,
12. 	env,
13. 	setupHtmlEqual,
14. 	spaces
15. } from "../helpers.js";
16. 
17. let svelte;
18. 
19. let compileOptions = null;
20. 
21. function getName(filename) {
22. 	const base = path.basename(filename).replace(".html", "");
23. 	return base[0].toUpperCase() + base.slice(1);
24. }
25. 
26. describe("runtime", () => {
27. 	before(() => {
28. 		svelte = loadSvelte(true);
29. 
30. 		require.extensions[".html"] = function(module, filename) {
31. 			const options = Object.assign(
32. 				{ filename, name: getName(filename), format: 'cjs' },
33. 				compileOptions
34. 			);
35. 
36. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
37. 
38. 			return module._compile(code, filename);
39. 		};
40. 
41. 		return setupHtmlEqual();
42. 	});
43. 
44. 	const failed = new Set();
45. 
46. 	function runTest(dir, shared, hydrate) {
47. 		if (dir[0] === ".") return;
48. 
49. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
50. 
51. 		if (config.solo && process.env.CI) {
52. 			throw new Error("Forgot to remove `solo: true` from test");
53. 		}
54. 
55. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers${hydrate ? ' , hydration' : ''})`, () => {
56. 			if (failed.has(dir)) {
57. 				// this makes debugging easier, by only printing compiled output once
58. 				throw new Error('skipping test, already failed');
59. 			}
60. 
61. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
62. 			global.document.title = '';
63. 
64. 			compileOptions = config.compileOptions || {};
65. 			compileOptions.shared = shared;
66. 			compileOptions.hydratable = hydrate;
67. 			compileOptions.dev = config.dev;
68. 			compileOptions.store = !!config.store;
69. 
70. 			// check that no ES2015+ syntax slipped in
71. 			if (!config.allowES2015) {
72. 				try {
73. 					const source = fs.readFileSync(
74. 						`test/runtime/samples/${dir}/main.html`,
75. 						"utf-8"
76. 					);
77. 					const { code } = svelte.compile(source, compileOptions);
78. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
79. 					if (startIndex === -1) throw new Error("missing create_main_fragment");
80. 					const endIndex = code.lastIndexOf("export default");
81. 					const es5 =
82. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
83. 						code.slice(startIndex, endIndex);
84. 
85. 					acorn.parse(es5, { ecmaVersion: 5 });
86. 
87. 					if (/Object\.assign/.test(es5)) {
88. 						throw new Error(
89. 							"cannot use Object.assign in generated code, as it is not supported everywhere"
90. 						);
91. 					}
92. 				} catch (err) {
93. 					failed.add(dir);
94. 					if (err.frame) {
95. 						console.error(chalk.red(err.frame)); // eslint-disable-line no-console
96. 					}
97. 					showOutput(cwd, { shared, format: 'cjs', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
98. 					throw err;
99. 				}
100. 			}
101. 
102. 			Object.keys(require.cache)
103. 				.filter(x => x.endsWith(".html"))
104. 				.forEach(file => {
105. 					delete require.cache[file];
106. 				});
107. 
108. 			let SvelteComponent;
109. 
110. 			let unintendedError = null;
111. 
112. 			const window = env();
113. 
114. 			return Promise.resolve()
115. 				.then(() => {
116. 					// set of hacks to support transition tests
117. 					transitionManager.running = false;
118. 					transitionManager.transitions = [];
119. 
120. 					const raf = {
121. 						time: 0,
122. 						callback: null,
123. 						tick: now => {
124. 							raf.time = now;
125. 							if (raf.callback) raf.callback();
126. 						}
127. 					};
128. 					window.performance = { now: () => raf.time };
129. 					global.requestAnimationFrame = cb => {
130. 						let called = false;
131. 						raf.callback = () => {
132. 							if (!called) {
133. 								called = true;
134. 								cb();
135. 							}
136. 						};
137. 					};
138. 
139. 					try {
140. 						SvelteComponent = require(`./samples/${dir}/main.html`);
141. 					} catch (err) {
142. 						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
143. 						throw err;
144. 					}
145. 
146. 					global.window = window;
147. 
148. 					// Put the constructor on window for testing
149. 					window.SvelteComponent = SvelteComponent;
150. 
151. 					const target = window.document.querySelector("main");
152. 
153. 					const warnings = [];
154. 					const warn = console.warn;
155. 					console.warn = warning => {
156. 						warnings.push(warning);
157. 					};
158. 
159. 					const options = Object.assign({}, {
160. 						target,
161. 						hydrate,
162. 						data: config.data,
163. 						store: (config.store !== true && config.store)
164. 					}, config.options || {});
165. 
166. 					const component = new SvelteComponent(options);
167. 
168. 					console.warn = warn;
169. 
170. 					if (config.error) {
171. 						unintendedError = true;
172. 						throw new Error("Expected a runtime error");
173. 					}
174. 
175. 					if (config.warnings) {
176. 						assert.deepEqual(warnings, config.warnings);
177. 					} else if (warnings.length) {
178. 						unintendedError = true;
179. 						throw new Error("Received unexpected warnings");
180. 					}
181. 
182. 					if (config.html) {
183. 						assert.htmlEqual(target.innerHTML, config.html);
184. 					}
185. 
186. 					if (config.test) {
187. 						return Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {
188. 							component.destroy();
189. 						});
190. 					} else {
191. 						component.destroy();
192. 						assert.equal(target.innerHTML, "");
193. 					}
194. 				})
195. 				.catch(err => {
196. 					if (config.error && !unintendedError) {
197. 						config.error(assert, err);
198. 					} else {
199. 						failed.add(dir);
200. 						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
201. 						throw err;
202. 					}
203. 				})
204. 				.then(() => {
205. 					if (config.show) showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte);
206. 				});
207. 		});
208. 	}
209. 
210. 	const shared = path.resolve("shared.js");
211. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
212. 		runTest(dir, shared, false);
213. 		runTest(dir, shared, true);
214. 		runTest(dir, null, false);
215. 	});
216. 
217. 	it("fails if options.target is missing in dev mode", () => {
218. 		const { code } = svelte.compile(`<div></div>`, {
219. 			format: "iife",
220. 			name: "SvelteComponent",
221. 			dev: true
222. 		});
223. 
224. 		const SvelteComponent = eval(
225. 			`(function () { ${code}; return SvelteComponent; }())`
226. 		);
227. 
228. 		assert.throws(() => {
229. 			new SvelteComponent();
230. 		}, /'target' is a required option/);
231. 	});
232. 
233. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
234. 		const { code } = svelte.compile(`<div></div>`, {
235. 			format: "iife",
236. 			name: "SvelteComponent",
237. 			dev: true
238. 		});
239. 
240. 		const SvelteComponent = eval(
241. 			`(function () { ${code}; return SvelteComponent; }())`
242. 		);
243. 
244. 		assert.throws(() => {
245. 			new SvelteComponent({
246. 				target: {},
247. 				hydrate: true
248. 			});
249. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
250. 	});
251. });


File: test/runtime/samples/store-binding/NameInput.html
Line number range: 1 - 1
Content:
1. <input bind:value=$name>


File: test/runtime/samples/store-binding/_config.js
Line number range: 1 - 28
Content:
1. import { Store } from '../../../../store.js';
2. 
3. const store = new Store({
4. 	name: 'world'
5. });
6. 
7. export default {
8. 	store,
9. 
10. 	html: `
11. 		<h1>Hello world!</h1>
12. 		<input>
13. 	`,
14. 
15. 	test(assert, component, target, window) {
16. 		const input = target.querySelector('input');
17. 		const event = new window.Event('input');
18. 
19. 		input.value = 'everybody';
20. 		input.dispatchEvent(event);
21. 
22. 		assert.equal(store.get('name'), 'everybody');
23. 		assert.htmlEqual(target.innerHTML, `
24. 			<h1>Hello everybody!</h1>
25. 			<input>
26. 		`);
27. 	}
28. };


File: test/runtime/samples/store-binding/main.html
Line number range: 1 - 10
Content:
1. <h1>Hello {{$name}}!</h1>
2. <NameInput/>
3. 
4. <script>
5. 	import NameInput from './NameInput.html';
6. 
7. 	export default {
8. 		components: { NameInput }
9. 	};
10. </script>


File: test/runtime/samples/store-computed/Todo.html
Line number range: 1 - 15
Content:
1. {{#if isVisible}}
2. 	<div class='{{todo.done ? "done": "pending"}}'>{{todo.description}}</div>
3. {{/if}}
4. 
5. <script>
6. 	export default {
7. 		computed: {
8. 			isVisible: ($filter, todo) => {
9. 				if ($filter === 'all') return true;
10. 				if ($filter === 'done') return todo.done;
11. 				if ($filter === 'pending') return !todo.done;
12. 			}
13. 		}
14. 	};
15. </script>


File: test/runtime/samples/store-computed/_config.js
Line number range: 1 - 63
Content:
1. import { Store } from '../../../../store.js';
2. 
3. class MyStore extends Store {
4. 	setFilter(filter) {
5. 		this.set({ filter });
6. 	}
7. 
8. 	toggleTodo(todo) {
9. 		todo.done = !todo.done;
10. 		this.set({ todos: this.get('todos') });
11. 	}
12. }
13. 
14. const todos = [
15. 	{
16. 		description: 'Buy some milk',
17. 		done: true,
18. 	},
19. 	{
20. 		description: 'Do the laundry',
21. 		done: true,
22. 	},
23. 	{
24. 		description: "Find life's true purpose",
25. 		done: false,
26. 	}
27. ];
28. 
29. const store = new MyStore({
30. 	filter: 'all',
31. 	todos
32. });
33. 
34. export default {
35. 	store,
36. 
37. 	html: `
38. 		<div class='done'>Buy some milk</div>
39. 		<div class='done'>Do the laundry</div>
40. 		<div class='pending'>Find life's true purpose</div>
41. 	`,
42. 
43. 	test(assert, component, target) {
44. 		store.setFilter('pending');
45. 
46. 		assert.htmlEqual(target.innerHTML, `
47. 			<div class='pending'>Find life's true purpose</div>
48. 		`);
49. 
50. 		store.toggleTodo(todos[1]);
51. 
52. 		assert.htmlEqual(target.innerHTML, `
53. 			<div class='pending'>Do the laundry</div>
54. 			<div class='pending'>Find life's true purpose</div>
55. 		`);
56. 
57. 		store.setFilter('done');
58. 
59. 		assert.htmlEqual(target.innerHTML, `
60. 			<div class='done'>Buy some milk</div>
61. 		`);
62. 	}
63. };


File: test/runtime/samples/store-computed/main.html
Line number range: 1 - 11
Content:
1. {{#each $todos as todo}}
2. 	<Todo :todo/>
3. {{/each}}
4. 
5. <script>
6. 	import Todo from './Todo.html';
7. 
8. 	export default {
9. 		components: { Todo }
10. 	};
11. </script>


File: test/runtime/samples/store-event/NameInput.html
Line number range: 1 - 1
Content:
1. <input on:input='store.setName(this.value)'>


File: test/runtime/samples/store-event/_config.js
Line number range: 1 - 34
Content:
1. import { Store } from '../../../../store.js';
2. 
3. class MyStore extends Store {
4. 	setName(name) {
5. 		this.set({ name });
6. 	}
7. }
8. 
9. const store = new MyStore({
10. 	name: 'world'
11. });
12. 
13. export default {
14. 	store,
15. 
16. 	html: `
17. 		<h1>Hello world!</h1>
18. 		<input>
19. 	`,
20. 
21. 	test(assert, component, target, window) {
22. 		const input = target.querySelector('input');
23. 		const event = new window.Event('input');
24. 
25. 		input.value = 'everybody';
26. 		input.dispatchEvent(event);
27. 
28. 		assert.equal(store.get('name'), 'everybody');
29. 		assert.htmlEqual(target.innerHTML, `
30. 			<h1>Hello everybody!</h1>
31. 			<input>
32. 		`);
33. 	}
34. };


File: test/runtime/samples/store-event/main.html
Line number range: 1 - 10
Content:
1. <h1>Hello {{$name}}!</h1>
2. <NameInput/>
3. 
4. <script>
5. 	import NameInput from './NameInput.html';
6. 
7. 	export default {
8. 		components: { NameInput }
9. 	};
10. </script>


File: test/runtime/samples/store-root/Nested.html
Line number range: 1 - 1
Content:
1. <p>It's nice to see you, {{$name}}.</p>


File: test/runtime/samples/store-root/_config.js
Line number range: 1 - 17
Content:
1. export default {
2. 	store: true, // TODO remove this in v2
3. 
4. 	html: `
5. 		<h1>Hello world!</h1>
6. 		<p>It's nice to see you, world.</p>
7. 	`,
8. 
9. 	test(assert, component, target) {
10. 		component.store.set({ name: 'everybody' });
11. 
12. 		assert.htmlEqual(target.innerHTML, `
13. 			<h1>Hello everybody!</h1>
14. 			<p>It's nice to see you, everybody.</p>
15. 		`);
16. 	}
17. };


File: test/runtime/samples/store-root/main.html
Line number range: 1 - 19
Content:
1. <h1>Hello {{$name}}!</h1>
2. <Nested/>
3. 
4. <script>
5. 	import { Store } from '../../../../store.js';
6. 	import Nested from './Nested.html';
7. 
8. 	export default {
9. 		store () {
10. 			return new Store({
11. 				name: 'world'
12. 			});
13. 		},
14. 
15. 		components: {
16. 			Nested
17. 		}
18. 	};
19. </script>


File: test/runtime/samples/store/_config.js
Line number range: 1 - 17
Content:
1. import { Store } from '../../../../store.js';
2. 
3. const store = new Store({
4. 	name: 'world'
5. });
6. 
7. export default {
8. 	store,
9. 
10. 	html: `<h1>Hello world!</h1>`,
11. 
12. 	test(assert, component, target) {
13. 		store.set({ name: 'everybody' });
14. 
15. 		assert.htmlEqual(target.innerHTML, `<h1>Hello everybody!</h1>`);
16. 	}
17. };


File: test/runtime/samples/store/main.html
Line number range: 1 - 1
Content:
1. <h1>Hello {{$name}}!</h1>


File: test/server-side-rendering/index.js
Line number range: 1 - 132
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require("../../ssr/register")({
25. 			extensions: ['.svelte', '.html'],
26. 			store: true
27. 		});
28. 
29. 		return setupHtmlEqual();
30. 	});
31. 
32. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
33. 		if (dir[0] === ".") return;
34. 
35. 		// add .solo to a sample directory name to only run that test, or
36. 		// .show to always show the output. or both
37. 		const solo = /\.solo/.test(dir);
38. 		const show = /\.show/.test(dir);
39. 
40. 		if (solo && process.env.CI) {
41. 			throw new Error("Forgot to remove `solo: true` from test");
42. 		}
43. 
44. 		(solo ? it.only : it)(dir, () => {
45. 			dir = path.resolve("test/server-side-rendering/samples", dir);
46. 			try {
47. 				let component;
48. 
49. 				const mainHtmlFile = `${dir}/main.html`;
50. 				const mainSvelteFile = `${dir}/main.svelte`;
51. 				if (fs.existsSync(mainHtmlFile)) {
52. 					component = require(mainHtmlFile);
53. 				} else if (fs.existsSync(mainSvelteFile)) {
54. 					component = require(mainSvelteFile);
55. 				}
56. 
57. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
58. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
59. 
60. 				const data = tryToLoadJson(`${dir}/data.json`);
61. 
62. 				const rendered = component.render(data);
63. 				const { html, css, head } = rendered;
64. 
65. 				// rendered.toString() === rendered.html
66. 				assert.equal(rendered, html);
67. 
68. 				fs.writeFileSync(`${dir}/_actual.html`, html);
69. 				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);
70. 
71. 				assert.htmlEqual(html, expectedHtml);
72. 				assert.equal(
73. 					css.code.replace(/^\s+/gm, ""),
74. 					expectedCss.replace(/^\s+/gm, "")
75. 				);
76. 
77. 				if (fs.existsSync(`${dir}/_expected-head.html`)) {
78. 					fs.writeFileSync(`${dir}/_actual-head.html`, head);
79. 					assert.htmlEqual(
80. 						head,
81. 						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
82. 					);
83. 				}
84. 
85. 				if (show) showOutput(dir, { generate: 'ssr' });
86. 			} catch (err) {
87. 				showOutput(dir, { generate: 'ssr' });
88. 				throw err;
89. 			}
90. 		});
91. 	});
92. 
93. 	// duplicate client-side tests, as far as possible
94. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
95. 		if (dir[0] === ".") return;
96. 
97. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
98. 
99. 		if (config.solo && process.env.CI) {
100. 			throw new Error("Forgot to remove `solo: true` from test");
101. 		}
102. 
103. 		if (config["skip-ssr"]) return;
104. 
105. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
106. 			const cwd = path.resolve("test/runtime/samples", dir);
107. 
108. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
109. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
110. 				delete require.cache[resolved];
111. 			});
112. 
113. 			require("../../ssr/register")({
114. 				store: !!config.store
115. 			});
116. 
117. 			try {
118. 				const component = require(`../runtime/samples/${dir}/main.html`);
119. 				const { html } = component.render(config.data, {
120. 					store: (config.store !== true) && config.store
121. 				});
122. 
123. 				if (config.html) {
124. 					assert.htmlEqual(html, config.html);
125. 				}
126. 			} catch (err) {
127. 				showOutput(cwd, { generate: "ssr" });
128. 				throw err;
129. 			}
130. 		});
131. 	});
132. });


File: test/store/index.js
Line number range: 1 - 190
Content:
1. import fs from 'fs';
2. import assert from 'assert';
3. import MagicString from 'magic-string';
4. import { parse } from 'acorn';
5. import { Store } from '../../store.js';
6. 
7. describe('store', () => {
8. 	it('is written in ES5', () => {
9. 		const source = fs.readFileSync('store.js', 'utf-8');
10. 
11. 		const ast = parse(source, {
12. 			sourceType: 'module'
13. 		});
14. 
15. 		const magicString = new MagicString(source);
16. 		ast.body.forEach(node => {
17. 			if (/^(Im|Ex)port/.test(node.type)) magicString.remove(node.start, node.end);
18. 		});
19. 
20. 		parse(magicString.toString(), {
21. 			ecmaVersion: 5
22. 		});
23. 	});
24. 
25. 	describe('get', () => {
26. 		it('gets a specific key', () => {
27. 			const store = new Store({
28. 				foo: 'bar'
29. 			});
30. 
31. 			assert.equal(store.get('foo'), 'bar');
32. 		});
33. 
34. 		it('gets the entire state object', () => {
35. 			const store = new Store({
36. 				foo: 'bar'
37. 			});
38. 
39. 			assert.deepEqual(store.get(), { foo: 'bar' });
40. 		});
41. 	});
42. 
43. 	describe('set', () => {
44. 		it('sets state', () => {
45. 			const store = new Store();
46. 
47. 			store.set({
48. 				foo: 'bar'
49. 			});
50. 
51. 			assert.equal(store.get('foo'), 'bar');
52. 		});
53. 	});
54. 
55. 	describe('observe', () => {
56. 		it('observes state', () => {
57. 			let newFoo;
58. 			let oldFoo;
59. 
60. 			const store = new Store({
61. 				foo: 'bar'
62. 			});
63. 
64. 			store.observe('foo', (n, o) => {
65. 				newFoo = n;
66. 				oldFoo = o;
67. 			});
68. 
69. 			assert.equal(newFoo, 'bar');
70. 			assert.equal(oldFoo, undefined);
71. 
72. 			store.set({
73. 				foo: 'baz'
74. 			});
75. 
76. 			assert.equal(newFoo, 'baz');
77. 			assert.equal(oldFoo, 'bar');
78. 		});
79. 	});
80. 
81. 	describe('onchange', () => {
82. 		it('fires a callback when state changes', () => {
83. 			const store = new Store();
84. 
85. 			let count = 0;
86. 			let args;
87. 
88. 			store.onchange((state, changed) => {
89. 				count += 1;
90. 				args = { state, changed };
91. 			});
92. 
93. 			store.set({ foo: 'bar' });
94. 
95. 			assert.equal(count, 1);
96. 			assert.deepEqual(args, {
97. 				state: { foo: 'bar' },
98. 				changed: { foo: true }
99. 			});
100. 
101. 			// this should be a noop
102. 			store.set({ foo: 'bar' });
103. 			assert.equal(count, 1);
104. 
105. 			// this shouldn't
106. 			store.set({ foo: 'baz' });
107. 
108. 			assert.equal(count, 2);
109. 			assert.deepEqual(args, {
110. 				state: { foo: 'baz' },
111. 				changed: { foo: true }
112. 			});
113. 		});
114. 	});
115. 
116. 	describe('computed', () => {
117. 		it('computes a property based on data', () => {
118. 			const store = new Store({
119. 				foo: 1
120. 			});
121. 
122. 			store.compute('bar', ['foo'], foo => foo * 2);
123. 			assert.equal(store.get('bar'), 2);
124. 
125. 			const values = [];
126. 
127. 			store.observe('bar', bar => {
128. 				values.push(bar);
129. 			});
130. 
131. 			store.set({ foo: 2 });
132. 			assert.deepEqual(values, [2, 4]);
133. 		});
134. 
135. 		it('computes a property based on another computed property', () => {
136. 			const store = new Store({
137. 				foo: 1
138. 			});
139. 
140. 			store.compute('bar', ['foo'], foo => foo * 2);
141. 			store.compute('baz', ['bar'], bar => bar * 2);
142. 			assert.equal(store.get('baz'), 4);
143. 
144. 			const values = [];
145. 
146. 			store.observe('baz', baz => {
147. 				values.push(baz);
148. 			});
149. 
150. 			store.set({ foo: 2 });
151. 			assert.deepEqual(values, [4, 8]);
152. 		});
153. 
154. 		it('prevents computed properties from being set', () => {
155. 			const store = new Store({
156. 				foo: 1
157. 			});
158. 
159. 			store.compute('bar', ['foo'], foo => foo * 2);
160. 
161. 			assert.throws(() => {
162. 				store.set({ bar: 'whatever' });
163. 			}, /'bar' is a read-only property/);
164. 		});
165. 
166. 		it('allows multiple dependents to depend on the same computed property', () => {
167. 			const store = new Store({
168. 				a: 1
169. 			});
170. 
171. 			store.compute('b', ['a'], a => a * 2);
172. 			store.compute('c', ['b'], b => b * 3);
173. 			store.compute('d', ['b'], b => b * 4);
174. 
175. 			assert.deepEqual(store.get(), { a: 1, b: 2, c: 6, d: 8 });
176. 
177. 			// bit cheeky, testing a private property, but whatever
178. 			assert.equal(store._sortedComputedProperties.length, 3);
179. 		});
180. 
181. 		it('prevents cyclical dependencies', () => {
182. 			const store = new Store();
183. 
184. 			assert.throws(() => {
185. 				store.compute('a', ['b'], b => b + 1);
186. 				store.compute('b', ['a'], a => a + 1);
187. 			}, /Cyclical dependency detected/);
188. 		});
189. 	});
190. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 13:36:42,861 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We need to identify 8 existing tests relevant to SSR nested store propagation. The provided context already contains the SSR test harness (test/server-side-rendering/index.js), the runtime test harness (test/runtime/index.js), and the specific store-related sample tests (store-root, store-binding, store-event, store-computed) with their _config.js and component files. These are sufficient to extract 4 SSR-duplicated tests (each runtime sample is executed in SSR) and 4 runtime tests, totaling 8. No additional files appear necessary to fulfill the request with exact paths and line numbers.' query='' extra_requirements='' purpose='Proceed to list 8 precise test cases with their files, line numbers, and full content as regression tests for SSR nested store propagation.'
2025-11-12 13:36:42,865 - thread-135845298308800.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='test/helpers.js', content="1. import { JSDOM } from 'jsdom';\n2. import assert from 'assert';\n3. import glob from 'glob';\n4. import fs from 'fs';\n5. import path from 'path';\n6. import chalk from 'chalk';\n7. \n8. // for coverage purposes, we need to test source files,\n9. // but for sanity purposes, we need to test dist files\n10. export function loadSvelte(test) {\n11. \tprocess.env.TEST = test ? 'true' : '';\n12. \n13. \tconst resolved = require.resolve('../compiler/svelte.js');\n14. \n15. \tdelete require.cache[resolved];\n16. \treturn require(resolved);\n17. }\n18. \n19. export const svelte = loadSvelte();\n20. \n21. export function exists(path) {\n22. \ttry {\n23. \t\tfs.statSync(path);\n24. \t\treturn true;\n25. \t} catch (err) {\n26. \t\treturn false;\n27. \t}\n28. }\n29. \n30. export function tryToLoadJson(file) {\n31. \ttry {\n32. \t\treturn JSON.parse(fs.readFileSync(file));\n33. \t} catch (err) {\n34. \t\tif (err.code !== 'ENOENT') throw err;\n35. \t\treturn null;\n36. \t}\n37. }\n38. \n39. export function tryToReadFile(file) {\n40. \ttry {\n41. \t\treturn fs.readFileSync(file, 'utf-8');\n42. \t} catch (err) {\n43. \t\tif (err.code !== 'ENOENT') throw err;\n44. \t\treturn null;\n45. \t}\n46. }\n47. \n48. const { window } = new JSDOM('<main></main>');\n49. global.document = window.document;\n50. \n51. export function env() {\n52. \twindow._svelteTransitionManager = null;\n53. \twindow.document.body.innerHTML = '<main></main>';\n54. \n55. \treturn window;\n56. }\n57. \n58. function cleanChildren(node) {\n59. \tlet previous = null;\n60. \n61. \t// sort attributes\n62. \tconst attributes = Array.from(node.attributes).sort((a, b) => {\n63. \t\treturn a.name < b.name ? -1 : 1;\n64. \t});\n65. \n66. \tattributes.forEach(attr => {\n67. \t\tnode.removeAttribute(attr.name);\n68. \t});\n69. \n70. \tattributes.forEach(attr => {\n71. \t\tnode.setAttribute(attr.name, attr.value);\n72. \t});\n73. \n74. \t// recurse\n75. \t[...node.childNodes].forEach(child => {\n76. \t\tif (child.nodeType === 3) {\n77. \t\t\t// text\n78. \t\t\tif (\n79. \t\t\t\tnode.namespaceURI === 'http://www.w3.org/2000/svg' &&\n80. \t\t\t\tnode.tagName !== 'text' &&\n81. \t\t\t\tnode.tagName !== 'tspan'\n82. \t\t\t) {\n83. \t\t\t\tnode.removeChild(child);\n84. \t\t\t}\n85. \n86. \t\t\tchild.data = child.data.replace(/\\s{2,}/g, '\\n');\n87. \n88. \t\t\tif (previous && previous.nodeType === 3) {\n89. \t\t\t\tprevious.data += child.data;\n90. \t\t\t\tprevious.data = previous.data.replace(/\\s{2,}/g, '\\n');\n91. \n92. \t\t\t\tnode.removeChild(child);\n93. \t\t\t\tchild = previous;\n94. \t\t\t}\n95. \t\t} else {\n96. \t\t\tcleanChildren(child);\n97. \t\t}\n98. \n99. \t\tprevious = child;\n100. \t});\n101. \n102. \t// collapse whitespace\n103. \tif (node.firstChild && node.firstChild.nodeType === 3) {\n104. \t\tnode.firstChild.data = node.firstChild.data.replace(/^\\s+/, '');\n105. \t\tif (!node.firstChild.data) node.removeChild(node.firstChild);\n106. \t}\n107. \n108. \tif (node.lastChild && node.lastChild.nodeType === 3) {\n109. \t\tnode.lastChild.data = node.lastChild.data.replace(/\\s+$/, '');\n110. \t\tif (!node.lastChild.data) node.removeChild(node.lastChild);\n111. \t}\n112. }\n113. \n114. export function normalizeHtml(window, html) {\n115. \ttry {\n116. \t\tconst node = window.document.createElement('div');\n117. \t\tnode.innerHTML = html\n118. \t\t\t.replace(/<!--.*?-->/g, '')\n119. \t\t\t.replace(/>[\\s\\r\\n]+</g, '><')\n120. \t\t\t.trim();\n121. \t\tcleanChildren(node, '');\n122. \t\treturn node.innerHTML.replace(/<\\/?noscript\\/?>/g, '');\n123. \t} catch (err) {\n124. \t\tthrow new Error(`Failed to normalize HTML:\\n${html}`);\n125. \t}\n126. }\n127. \n128. export function setupHtmlEqual() {\n129. \tconst window = env();\n130. \n131. \tassert.htmlEqual = (actual, expected, message) => {\n132. \t\tassert.deepEqual(\n133. \t\t\tnormalizeHtml(window, actual),\n134. \t\t\tnormalizeHtml(window, expected),\n135. \t\t\tmessage\n136. \t\t);\n137. \t};\n138. }\n139. \n140. export function loadConfig(file) {\n141. \ttry {\n142. \t\tconst resolved = require.resolve(file);\n143. \t\tdelete require.cache[resolved];\n144. \n145. \t\tconst config = require(resolved);\n146. \t\treturn config.default || config;\n147. \t} catch (err) {\n148. \t\tif (err.code === 'MODULE_NOT_FOUND') {\n149. \t\t\treturn {};\n150. \t\t}\n151. \n152. \t\tthrow err;\n153. \t}\n154. }\n155. \n156. export function addLineNumbers(code) {\n157. \treturn code\n158. \t\t.split('\\n')\n159. \t\t.map((line, i) => {\n160. \t\t\ti = String(i + 1);\n161. \t\t\twhile (i.length < 3) i = ` ${i}`;\n162. \n163. \t\t\treturn (\n164. \t\t\t\tchalk.grey(`  ${i}: `) +\n165. \t\t\t\tline.replace(/^\\t+/, match => match.split('\\t').join('    '))\n166. \t\t\t);\n167. \t\t})\n168. \t\t.join('\\n');\n169. }\n170. \n171. function capitalise(str) {\n172. \treturn str[0].toUpperCase() + str.slice(1);\n173. }\n174. \n175. export function showOutput(cwd, options = {}, s = svelte) {\n176. \tglob.sync('**/*.html', { cwd }).forEach(file => {\n177. \t\tif (file[0] === '_') return;\n178. \n179. \t\tconst name = path.basename(file)\n180. \t\t\t.slice(0, -path.extname(file).length)\n181. \t\t\t.replace(/^\\d/, '_$&')\n182. \t\t\t.replace(/[^a-zA-Z0-9_$]/g, '');\n183. \n184. \t\tconst { code } = s.compile(\n185. \t\t\tfs.readFileSync(`${cwd}/${file}`, 'utf-8'),\n186. \t\t\tObject.assign(options, {\n187. \t\t\t\tfilename: file,\n188. \t\t\t\tname: capitalise(name)\n189. \t\t\t})\n190. \t\t);\n191. \n192. \t\tconsole.log( // eslint-disable-line no-console\n193. \t\t\t`\\n>> ${chalk.cyan.bold(file)}\\n${addLineNumbers(code)}\\n<< ${chalk.cyan.bold(file)}`\n194. \t\t);\n195. \t});\n196. }\n197. \n198. const start = /\\n(\\t+)/;\n199. export function deindent(strings, ...values) {\n200. \tconst indentation = start.exec(strings[0])[1];\n201. \tconst pattern = new RegExp(`^${indentation}`, 'gm');\n202. \n203. \tlet result = strings[0].replace(start, '').replace(pattern, '');\n204. \n205. \tlet trailingIndentation = getTrailingIndentation(result);\n206. \n207. \tfor (let i = 1; i < strings.length; i += 1) {\n208. \t\tlet expression = values[i - 1];\n209. \t\tconst string = strings[i].replace(pattern, '');\n210. \n211. \t\tif (Array.isArray(expression)) {\n212. \t\t\texpression = expression.length ? expression.join('\\n') : null;\n213. \t\t}\n214. \n215. \t\tif (expression || expression === '') {\n216. \t\t\tconst value = String(expression).replace(\n217. \t\t\t\t/\\n/g,\n218. \t\t\t\t`\\n${trailingIndentation}`\n219. \t\t\t);\n220. \t\t\tresult += value + string;\n221. \t\t} else {\n222. \t\t\tlet c = result.length;\n223. \t\t\twhile (/\\s/.test(result[c - 1])) c -= 1;\n224. \t\t\tresult = result.slice(0, c) + string;\n225. \t\t}\n226. \n227. \t\ttrailingIndentation = getTrailingIndentation(result);\n228. \t}\n229. \n230. \treturn result.trim().replace(/\\t+$/gm, '');\n231. }\n232. \n233. function getTrailingIndentation(str) {\n234. \tlet i = str.length;\n235. \twhile (str[i - 1] === ' ' || str[i - 1] === '\\t') i -= 1;\n236. \treturn str.slice(i, str.length);\n237. }\n238. \n239. export function spaces(i) {\n240. \tlet result = '';\n241. \twhile (i--) result += ' ';\n242. \treturn result;\n243. }", start_line_number=1, end_line_number=243), Context(relative_path='test/runtime/index.js', content='1. import assert from "assert";\n2. import chalk from \'chalk\';\n3. import * as path from "path";\n4. import * as fs from "fs";\n5. import * as acorn from "acorn";\n6. import { transitionManager } from "../../shared.js";\n7. \n8. import {\n9. \tshowOutput,\n10. \tloadConfig,\n11. \tloadSvelte,\n12. \tenv,\n13. \tsetupHtmlEqual,\n14. \tspaces\n15. } from "../helpers.js";\n16. \n17. let svelte;\n18. \n19. let compileOptions = null;\n20. \n21. function getName(filename) {\n22. \tconst base = path.basename(filename).replace(".html", "");\n23. \treturn base[0].toUpperCase() + base.slice(1);\n24. }\n25. \n26. describe("runtime", () => {\n27. \tbefore(() => {\n28. \t\tsvelte = loadSvelte(true);\n29. \n30. \t\trequire.extensions[".html"] = function(module, filename) {\n31. \t\t\tconst options = Object.assign(\n32. \t\t\t\t{ filename, name: getName(filename), format: \'cjs\' },\n33. \t\t\t\tcompileOptions\n34. \t\t\t);\n35. \n36. \t\t\tconst { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);\n37. \n38. \t\t\treturn module._compile(code, filename);\n39. \t\t};\n40. \n41. \t\treturn setupHtmlEqual();\n42. \t});\n43. \n44. \tconst failed = new Set();\n45. \n46. \tfunction runTest(dir, shared, hydrate) {\n47. \t\tif (dir[0] === ".") return;\n48. \n49. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n50. \n51. \t\tif (config.solo && process.env.CI) {\n52. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n53. \t\t}\n54. \n55. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? \'shared\' : \'inline\'} helpers${hydrate ? \' , hydration\' : \'\'})`, () => {\n56. \t\t\tif (failed.has(dir)) {\n57. \t\t\t\t// this makes debugging easier, by only printing compiled output once\n58. \t\t\t\tthrow new Error(\'skipping test, already failed\');\n59. \t\t\t}\n60. \n61. \t\t\tconst cwd = path.resolve(`test/runtime/samples/${dir}`);\n62. \t\t\tglobal.document.title = \'\';\n63. \n64. \t\t\tcompileOptions = config.compileOptions || {};\n65. \t\t\tcompileOptions.shared = shared;\n66. \t\t\tcompileOptions.hydratable = hydrate;\n67. \t\t\tcompileOptions.dev = config.dev;\n68. \t\t\tcompileOptions.store = !!config.store;\n69. \n70. \t\t\t// check that no ES2015+ syntax slipped in\n71. \t\t\tif (!config.allowES2015) {\n72. \t\t\t\ttry {\n73. \t\t\t\t\tconst source = fs.readFileSync(\n74. \t\t\t\t\t\t`test/runtime/samples/${dir}/main.html`,\n75. \t\t\t\t\t\t"utf-8"\n76. \t\t\t\t\t);\n77. \t\t\t\t\tconst { code } = svelte.compile(source, compileOptions);\n78. \t\t\t\t\tconst startIndex = code.indexOf("function create_main_fragment"); // may change!\n79. \t\t\t\t\tif (startIndex === -1) throw new Error("missing create_main_fragment");\n80. \t\t\t\t\tconst endIndex = code.lastIndexOf("export default");\n81. \t\t\t\t\tconst es5 =\n82. \t\t\t\t\t\tcode.slice(0, startIndex).split(\'\\n\').map(x => spaces(x.length)).join(\'\\n\') +\n83. \t\t\t\t\t\tcode.slice(startIndex, endIndex);\n84. \n85. \t\t\t\t\tacorn.parse(es5, { ecmaVersion: 5 });\n86. \n87. \t\t\t\t\tif (/Object\\.assign/.test(es5)) {\n88. \t\t\t\t\t\tthrow new Error(\n89. \t\t\t\t\t\t\t"cannot use Object.assign in generated code, as it is not supported everywhere"\n90. \t\t\t\t\t\t);\n91. \t\t\t\t\t}\n92. \t\t\t\t} catch (err) {\n93. \t\t\t\t\tfailed.add(dir);\n94. \t\t\t\t\tif (err.frame) {\n95. \t\t\t\t\t\tconsole.error(chalk.red(err.frame)); // eslint-disable-line no-console\n96. \t\t\t\t\t}\n97. \t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n98. \t\t\t\t\tthrow err;\n99. \t\t\t\t}\n100. \t\t\t}\n101. \n102. \t\t\tObject.keys(require.cache)\n103. \t\t\t\t.filter(x => x.endsWith(".html"))\n104. \t\t\t\t.forEach(file => {\n105. \t\t\t\t\tdelete require.cache[file];\n106. \t\t\t\t});\n107. \n108. \t\t\tlet SvelteComponent;\n109. \n110. \t\t\tlet unintendedError = null;\n111. \n112. \t\t\tconst window = env();\n113. \n114. \t\t\treturn Promise.resolve()\n115. \t\t\t\t.then(() => {\n116. \t\t\t\t\t// set of hacks to support transition tests\n117. \t\t\t\t\ttransitionManager.running = false;\n118. \t\t\t\t\ttransitionManager.transitions = [];\n119. \n120. \t\t\t\t\tconst raf = {\n121. \t\t\t\t\t\ttime: 0,\n122. \t\t\t\t\t\tcallback: null,\n123. \t\t\t\t\t\ttick: now => {\n124. \t\t\t\t\t\t\traf.time = now;\n125. \t\t\t\t\t\t\tif (raf.callback) raf.callback();\n126. \t\t\t\t\t\t}\n127. \t\t\t\t\t};\n128. \t\t\t\t\twindow.performance = { now: () => raf.time };\n129. \t\t\t\t\tglobal.requestAnimationFrame = cb => {\n130. \t\t\t\t\t\tlet called = false;\n131. \t\t\t\t\t\traf.callback = () => {\n132. \t\t\t\t\t\t\tif (!called) {\n133. \t\t\t\t\t\t\t\tcalled = true;\n134. \t\t\t\t\t\t\t\tcb();\n135. \t\t\t\t\t\t\t}\n136. \t\t\t\t\t\t};\n137. \t\t\t\t\t};\n138. \n139. \t\t\t\t\ttry {\n140. \t\t\t\t\t\tSvelteComponent = require(`./samples/${dir}/main.html`);\n141. \t\t\t\t\t} catch (err) {\n142. \t\t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n143. \t\t\t\t\t\tthrow err;\n144. \t\t\t\t\t}\n145. \n146. \t\t\t\t\tglobal.window = window;\n147. \n148. \t\t\t\t\t// Put the constructor on window for testing\n149. \t\t\t\t\twindow.SvelteComponent = SvelteComponent;\n150. \n151. \t\t\t\t\tconst target = window.document.querySelector("main");\n152. \n153. \t\t\t\t\tconst warnings = [];\n154. \t\t\t\t\tconst warn = console.warn;\n155. \t\t\t\t\tconsole.warn = warning => {\n156. \t\t\t\t\t\twarnings.push(warning);\n157. \t\t\t\t\t};\n158. \n159. \t\t\t\t\tconst options = Object.assign({}, {\n160. \t\t\t\t\t\ttarget,\n161. \t\t\t\t\t\thydrate,\n162. \t\t\t\t\t\tdata: config.data,\n163. \t\t\t\t\t\tstore: (config.store !== true && config.store)\n164. \t\t\t\t\t}, config.options || {});\n165. \n166. \t\t\t\t\tconst component = new SvelteComponent(options);\n167. \n168. \t\t\t\t\tconsole.warn = warn;\n169. \n170. \t\t\t\t\tif (config.error) {\n171. \t\t\t\t\t\tunintendedError = true;\n172. \t\t\t\t\t\tthrow new Error("Expected a runtime error");\n173. \t\t\t\t\t}\n174. \n175. \t\t\t\t\tif (config.warnings) {\n176. \t\t\t\t\t\tassert.deepEqual(warnings, config.warnings);\n177. \t\t\t\t\t} else if (warnings.length) {\n178. \t\t\t\t\t\tunintendedError = true;\n179. \t\t\t\t\t\tthrow new Error("Received unexpected warnings");\n180. \t\t\t\t\t}\n181. \n182. \t\t\t\t\tif (config.html) {\n183. \t\t\t\t\t\tassert.htmlEqual(target.innerHTML, config.html);\n184. \t\t\t\t\t}\n185. \n186. \t\t\t\t\tif (config.test) {\n187. \t\t\t\t\t\treturn Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {\n188. \t\t\t\t\t\t\tcomponent.destroy();\n189. \t\t\t\t\t\t});\n190. \t\t\t\t\t} else {\n191. \t\t\t\t\t\tcomponent.destroy();\n192. \t\t\t\t\t\tassert.equal(target.innerHTML, "");\n193. \t\t\t\t\t}\n194. \t\t\t\t})\n195. \t\t\t\t.catch(err => {\n196. \t\t\t\t\tif (config.error && !unintendedError) {\n197. \t\t\t\t\t\tconfig.error(assert, err);\n198. \t\t\t\t\t} else {\n199. \t\t\t\t\t\tfailed.add(dir);\n200. \t\t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n201. \t\t\t\t\t\tthrow err;\n202. \t\t\t\t\t}\n203. \t\t\t\t})\n204. \t\t\t\t.then(() => {\n205. \t\t\t\t\tif (config.show) showOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte);\n206. \t\t\t\t});\n207. \t\t});\n208. \t}\n209. \n210. \tconst shared = path.resolve("shared.js");\n211. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n212. \t\trunTest(dir, shared, false);\n213. \t\trunTest(dir, shared, true);\n214. \t\trunTest(dir, null, false);\n215. \t});\n216. \n217. \tit("fails if options.target is missing in dev mode", () => {\n218. \t\tconst { code } = svelte.compile(`<div></div>`, {\n219. \t\t\tformat: "iife",\n220. \t\t\tname: "SvelteComponent",\n221. \t\t\tdev: true\n222. \t\t});\n223. \n224. \t\tconst SvelteComponent = eval(\n225. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n226. \t\t);\n227. \n228. \t\tassert.throws(() => {\n229. \t\t\tnew SvelteComponent();\n230. \t\t}, /\'target\' is a required option/);\n231. \t});\n232. \n233. \tit("fails if options.hydrate is true but the component is non-hydratable", () => {\n234. \t\tconst { code } = svelte.compile(`<div></div>`, {\n235. \t\t\tformat: "iife",\n236. \t\t\tname: "SvelteComponent",\n237. \t\t\tdev: true\n238. \t\t});\n239. \n240. \t\tconst SvelteComponent = eval(\n241. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n242. \t\t);\n243. \n244. \t\tassert.throws(() => {\n245. \t\t\tnew SvelteComponent({\n246. \t\t\t\ttarget: {},\n247. \t\t\t\thydrate: true\n248. \t\t\t});\n249. \t\t}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);\n250. \t});\n251. });', start_line_number=1, end_line_number=251), Context(relative_path='test/runtime/samples/store-binding/NameInput.html', content='1. <input bind:value=$name>', start_line_number=1, end_line_number=1), Context(relative_path='test/runtime/samples/store-binding/_config.js', content="1. import { Store } from '../../../../store.js';\n2. \n3. const store = new Store({\n4. \tname: 'world'\n5. });\n6. \n7. export default {\n8. \tstore,\n9. \n10. \thtml: `\n11. \t\t<h1>Hello world!</h1>\n12. \t\t<input>\n13. \t`,\n14. \n15. \ttest(assert, component, target, window) {\n16. \t\tconst input = target.querySelector('input');\n17. \t\tconst event = new window.Event('input');\n18. \n19. \t\tinput.value = 'everybody';\n20. \t\tinput.dispatchEvent(event);\n21. \n22. \t\tassert.equal(store.get('name'), 'everybody');\n23. \t\tassert.htmlEqual(target.innerHTML, `\n24. \t\t\t<h1>Hello everybody!</h1>\n25. \t\t\t<input>\n26. \t\t`);\n27. \t}\n28. };", start_line_number=1, end_line_number=28), Context(relative_path='test/runtime/samples/store-binding/main.html', content="1. <h1>Hello {{$name}}!</h1>\n2. <NameInput/>\n3. \n4. <script>\n5. \timport NameInput from './NameInput.html';\n6. \n7. \texport default {\n8. \t\tcomponents: { NameInput }\n9. \t};\n10. </script>", start_line_number=1, end_line_number=10), Context(relative_path='test/runtime/samples/store-computed/Todo.html', content='1. {{#if isVisible}}\n2. \t<div class=\'{{todo.done ? "done": "pending"}}\'>{{todo.description}}</div>\n3. {{/if}}\n4. \n5. <script>\n6. \texport default {\n7. \t\tcomputed: {\n8. \t\t\tisVisible: ($filter, todo) => {\n9. \t\t\t\tif ($filter === \'all\') return true;\n10. \t\t\t\tif ($filter === \'done\') return todo.done;\n11. \t\t\t\tif ($filter === \'pending\') return !todo.done;\n12. \t\t\t}\n13. \t\t}\n14. \t};\n15. </script>', start_line_number=1, end_line_number=15), Context(relative_path='test/runtime/samples/store-computed/_config.js', content='1. import { Store } from \'../../../../store.js\';\n2. \n3. class MyStore extends Store {\n4. \tsetFilter(filter) {\n5. \t\tthis.set({ filter });\n6. \t}\n7. \n8. \ttoggleTodo(todo) {\n9. \t\ttodo.done = !todo.done;\n10. \t\tthis.set({ todos: this.get(\'todos\') });\n11. \t}\n12. }\n13. \n14. const todos = [\n15. \t{\n16. \t\tdescription: \'Buy some milk\',\n17. \t\tdone: true,\n18. \t},\n19. \t{\n20. \t\tdescription: \'Do the laundry\',\n21. \t\tdone: true,\n22. \t},\n23. \t{\n24. \t\tdescription: "Find life\'s true purpose",\n25. \t\tdone: false,\n26. \t}\n27. ];\n28. \n29. const store = new MyStore({\n30. \tfilter: \'all\',\n31. \ttodos\n32. });\n33. \n34. export default {\n35. \tstore,\n36. \n37. \thtml: `\n38. \t\t<div class=\'done\'>Buy some milk</div>\n39. \t\t<div class=\'done\'>Do the laundry</div>\n40. \t\t<div class=\'pending\'>Find life\'s true purpose</div>\n41. \t`,\n42. \n43. \ttest(assert, component, target) {\n44. \t\tstore.setFilter(\'pending\');\n45. \n46. \t\tassert.htmlEqual(target.innerHTML, `\n47. \t\t\t<div class=\'pending\'>Find life\'s true purpose</div>\n48. \t\t`);\n49. \n50. \t\tstore.toggleTodo(todos[1]);\n51. \n52. \t\tassert.htmlEqual(target.innerHTML, `\n53. \t\t\t<div class=\'pending\'>Do the laundry</div>\n54. \t\t\t<div class=\'pending\'>Find life\'s true purpose</div>\n55. \t\t`);\n56. \n57. \t\tstore.setFilter(\'done\');\n58. \n59. \t\tassert.htmlEqual(target.innerHTML, `\n60. \t\t\t<div class=\'done\'>Buy some milk</div>\n61. \t\t`);\n62. \t}\n63. };', start_line_number=1, end_line_number=63), Context(relative_path='test/runtime/samples/store-computed/main.html', content="1. {{#each $todos as todo}}\n2. \t<Todo :todo/>\n3. {{/each}}\n4. \n5. <script>\n6. \timport Todo from './Todo.html';\n7. \n8. \texport default {\n9. \t\tcomponents: { Todo }\n10. \t};\n11. </script>", start_line_number=1, end_line_number=11), Context(relative_path='test/runtime/samples/store-event/NameInput.html', content="1. <input on:input='store.setName(this.value)'>", start_line_number=1, end_line_number=1), Context(relative_path='test/runtime/samples/store-event/_config.js', content="1. import { Store } from '../../../../store.js';\n2. \n3. class MyStore extends Store {\n4. \tsetName(name) {\n5. \t\tthis.set({ name });\n6. \t}\n7. }\n8. \n9. const store = new MyStore({\n10. \tname: 'world'\n11. });\n12. \n13. export default {\n14. \tstore,\n15. \n16. \thtml: `\n17. \t\t<h1>Hello world!</h1>\n18. \t\t<input>\n19. \t`,\n20. \n21. \ttest(assert, component, target, window) {\n22. \t\tconst input = target.querySelector('input');\n23. \t\tconst event = new window.Event('input');\n24. \n25. \t\tinput.value = 'everybody';\n26. \t\tinput.dispatchEvent(event);\n27. \n28. \t\tassert.equal(store.get('name'), 'everybody');\n29. \t\tassert.htmlEqual(target.innerHTML, `\n30. \t\t\t<h1>Hello everybody!</h1>\n31. \t\t\t<input>\n32. \t\t`);\n33. \t}\n34. };", start_line_number=1, end_line_number=34), Context(relative_path='test/runtime/samples/store-event/main.html', content="1. <h1>Hello {{$name}}!</h1>\n2. <NameInput/>\n3. \n4. <script>\n5. \timport NameInput from './NameInput.html';\n6. \n7. \texport default {\n8. \t\tcomponents: { NameInput }\n9. \t};\n10. </script>", start_line_number=1, end_line_number=10), Context(relative_path='test/runtime/samples/store-root/Nested.html', content="1. <p>It's nice to see you, {{$name}}.</p>", start_line_number=1, end_line_number=1), Context(relative_path='test/runtime/samples/store-root/_config.js', content="1. export default {\n2. \tstore: true, // TODO remove this in v2\n3. \n4. \thtml: `\n5. \t\t<h1>Hello world!</h1>\n6. \t\t<p>It's nice to see you, world.</p>\n7. \t`,\n8. \n9. \ttest(assert, component, target) {\n10. \t\tcomponent.store.set({ name: 'everybody' });\n11. \n12. \t\tassert.htmlEqual(target.innerHTML, `\n13. \t\t\t<h1>Hello everybody!</h1>\n14. \t\t\t<p>It's nice to see you, everybody.</p>\n15. \t\t`);\n16. \t}\n17. };", start_line_number=1, end_line_number=17), Context(relative_path='test/runtime/samples/store-root/main.html', content="1. <h1>Hello {{$name}}!</h1>\n2. <Nested/>\n3. \n4. <script>\n5. \timport { Store } from '../../../../store.js';\n6. \timport Nested from './Nested.html';\n7. \n8. \texport default {\n9. \t\tstore () {\n10. \t\t\treturn new Store({\n11. \t\t\t\tname: 'world'\n12. \t\t\t});\n13. \t\t},\n14. \n15. \t\tcomponents: {\n16. \t\t\tNested\n17. \t\t}\n18. \t};\n19. </script>", start_line_number=1, end_line_number=19), Context(relative_path='test/runtime/samples/store/_config.js', content="1. import { Store } from '../../../../store.js';\n2. \n3. const store = new Store({\n4. \tname: 'world'\n5. });\n6. \n7. export default {\n8. \tstore,\n9. \n10. \thtml: `<h1>Hello world!</h1>`,\n11. \n12. \ttest(assert, component, target) {\n13. \t\tstore.set({ name: 'everybody' });\n14. \n15. \t\tassert.htmlEqual(target.innerHTML, `<h1>Hello everybody!</h1>`);\n16. \t}\n17. };", start_line_number=1, end_line_number=17), Context(relative_path='test/runtime/samples/store/main.html', content='1. <h1>Hello {{$name}}!</h1>', start_line_number=1, end_line_number=1), Context(relative_path='test/server-side-rendering/index.js', content='1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";\n12. \n13. function tryToReadFile(file) {\n14. \ttry {\n15. \t\treturn fs.readFileSync(file, "utf-8");\n16. \t} catch (err) {\n17. \t\tif (err.code !== "ENOENT") throw err;\n18. \t\treturn null;\n19. \t}\n20. }\n21. \n22. describe("ssr", () => {\n23. \tbefore(() => {\n24. \t\trequire("../../ssr/register")({\n25. \t\t\textensions: [\'.svelte\', \'.html\'],\n26. \t\t\tstore: true\n27. \t\t});\n28. \n29. \t\treturn setupHtmlEqual();\n30. \t});\n31. \n32. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n33. \t\tif (dir[0] === ".") return;\n34. \n35. \t\t// add .solo to a sample directory name to only run that test, or\n36. \t\t// .show to always show the output. or both\n37. \t\tconst solo = /\\.solo/.test(dir);\n38. \t\tconst show = /\\.show/.test(dir);\n39. \n40. \t\tif (solo && process.env.CI) {\n41. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n42. \t\t}\n43. \n44. \t\t(solo ? it.only : it)(dir, () => {\n45. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n46. \t\t\ttry {\n47. \t\t\t\tlet component;\n48. \n49. \t\t\t\tconst mainHtmlFile = `${dir}/main.html`;\n50. \t\t\t\tconst mainSvelteFile = `${dir}/main.svelte`;\n51. \t\t\t\tif (fs.existsSync(mainHtmlFile)) {\n52. \t\t\t\t\tcomponent = require(mainHtmlFile);\n53. \t\t\t\t} else if (fs.existsSync(mainSvelteFile)) {\n54. \t\t\t\t\tcomponent = require(mainSvelteFile);\n55. \t\t\t\t}\n56. \n57. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n58. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n59. \n60. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n61. \n62. \t\t\t\tconst rendered = component.render(data);\n63. \t\t\t\tconst { html, css, head } = rendered;\n64. \n65. \t\t\t\t// rendered.toString() === rendered.html\n66. \t\t\t\tassert.equal(rendered, html);\n67. \n68. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n69. \t\t\t\tif (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);\n70. \n71. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n72. \t\t\t\tassert.equal(\n73. \t\t\t\t\tcss.code.replace(/^\\s+/gm, ""),\n74. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n75. \t\t\t\t);\n76. \n77. \t\t\t\tif (fs.existsSync(`${dir}/_expected-head.html`)) {\n78. \t\t\t\t\tfs.writeFileSync(`${dir}/_actual-head.html`, head);\n79. \t\t\t\t\tassert.htmlEqual(\n80. \t\t\t\t\t\thead,\n81. \t\t\t\t\t\tfs.readFileSync(`${dir}/_expected-head.html`, \'utf-8\')\n82. \t\t\t\t\t);\n83. \t\t\t\t}\n84. \n85. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n86. \t\t\t} catch (err) {\n87. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n88. \t\t\t\tthrow err;\n89. \t\t\t}\n90. \t\t});\n91. \t});\n92. \n93. \t// duplicate client-side tests, as far as possible\n94. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n95. \t\tif (dir[0] === ".") return;\n96. \n97. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n98. \n99. \t\tif (config.solo && process.env.CI) {\n100. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n101. \t\t}\n102. \n103. \t\tif (config["skip-ssr"]) return;\n104. \n105. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n106. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n107. \n108. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n109. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n110. \t\t\t\tdelete require.cache[resolved];\n111. \t\t\t});\n112. \n113. \t\t\trequire("../../ssr/register")({\n114. \t\t\t\tstore: !!config.store\n115. \t\t\t});\n116. \n117. \t\t\ttry {\n118. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n119. \t\t\t\tconst { html } = component.render(config.data, {\n120. \t\t\t\t\tstore: (config.store !== true) && config.store\n121. \t\t\t\t});\n122. \n123. \t\t\t\tif (config.html) {\n124. \t\t\t\t\tassert.htmlEqual(html, config.html);\n125. \t\t\t\t}\n126. \t\t\t} catch (err) {\n127. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n128. \t\t\t\tthrow err;\n129. \t\t\t}\n130. \t\t});\n131. \t});\n132. });', start_line_number=1, end_line_number=132), Context(relative_path='test/store/index.js', content="1. import fs from 'fs';\n2. import assert from 'assert';\n3. import MagicString from 'magic-string';\n4. import { parse } from 'acorn';\n5. import { Store } from '../../store.js';\n6. \n7. describe('store', () => {\n8. \tit('is written in ES5', () => {\n9. \t\tconst source = fs.readFileSync('store.js', 'utf-8');\n10. \n11. \t\tconst ast = parse(source, {\n12. \t\t\tsourceType: 'module'\n13. \t\t});\n14. \n15. \t\tconst magicString = new MagicString(source);\n16. \t\tast.body.forEach(node => {\n17. \t\t\tif (/^(Im|Ex)port/.test(node.type)) magicString.remove(node.start, node.end);\n18. \t\t});\n19. \n20. \t\tparse(magicString.toString(), {\n21. \t\t\tecmaVersion: 5\n22. \t\t});\n23. \t});\n24. \n25. \tdescribe('get', () => {\n26. \t\tit('gets a specific key', () => {\n27. \t\t\tconst store = new Store({\n28. \t\t\t\tfoo: 'bar'\n29. \t\t\t});\n30. \n31. \t\t\tassert.equal(store.get('foo'), 'bar');\n32. \t\t});\n33. \n34. \t\tit('gets the entire state object', () => {\n35. \t\t\tconst store = new Store({\n36. \t\t\t\tfoo: 'bar'\n37. \t\t\t});\n38. \n39. \t\t\tassert.deepEqual(store.get(), { foo: 'bar' });\n40. \t\t});\n41. \t});\n42. \n43. \tdescribe('set', () => {\n44. \t\tit('sets state', () => {\n45. \t\t\tconst store = new Store();\n46. \n47. \t\t\tstore.set({\n48. \t\t\t\tfoo: 'bar'\n49. \t\t\t});\n50. \n51. \t\t\tassert.equal(store.get('foo'), 'bar');\n52. \t\t});\n53. \t});\n54. \n55. \tdescribe('observe', () => {\n56. \t\tit('observes state', () => {\n57. \t\t\tlet newFoo;\n58. \t\t\tlet oldFoo;\n59. \n60. \t\t\tconst store = new Store({\n61. \t\t\t\tfoo: 'bar'\n62. \t\t\t});\n63. \n64. \t\t\tstore.observe('foo', (n, o) => {\n65. \t\t\t\tnewFoo = n;\n66. \t\t\t\toldFoo = o;\n67. \t\t\t});\n68. \n69. \t\t\tassert.equal(newFoo, 'bar');\n70. \t\t\tassert.equal(oldFoo, undefined);\n71. \n72. \t\t\tstore.set({\n73. \t\t\t\tfoo: 'baz'\n74. \t\t\t});\n75. \n76. \t\t\tassert.equal(newFoo, 'baz');\n77. \t\t\tassert.equal(oldFoo, 'bar');\n78. \t\t});\n79. \t});\n80. \n81. \tdescribe('onchange', () => {\n82. \t\tit('fires a callback when state changes', () => {\n83. \t\t\tconst store = new Store();\n84. \n85. \t\t\tlet count = 0;\n86. \t\t\tlet args;\n87. \n88. \t\t\tstore.onchange((state, changed) => {\n89. \t\t\t\tcount += 1;\n90. \t\t\t\targs = { state, changed };\n91. \t\t\t});\n92. \n93. \t\t\tstore.set({ foo: 'bar' });\n94. \n95. \t\t\tassert.equal(count, 1);\n96. \t\t\tassert.deepEqual(args, {\n97. \t\t\t\tstate: { foo: 'bar' },\n98. \t\t\t\tchanged: { foo: true }\n99. \t\t\t});\n100. \n101. \t\t\t// this should be a noop\n102. \t\t\tstore.set({ foo: 'bar' });\n103. \t\t\tassert.equal(count, 1);\n104. \n105. \t\t\t// this shouldn't\n106. \t\t\tstore.set({ foo: 'baz' });\n107. \n108. \t\t\tassert.equal(count, 2);\n109. \t\t\tassert.deepEqual(args, {\n110. \t\t\t\tstate: { foo: 'baz' },\n111. \t\t\t\tchanged: { foo: true }\n112. \t\t\t});\n113. \t\t});\n114. \t});\n115. \n116. \tdescribe('computed', () => {\n117. \t\tit('computes a property based on data', () => {\n118. \t\t\tconst store = new Store({\n119. \t\t\t\tfoo: 1\n120. \t\t\t});\n121. \n122. \t\t\tstore.compute('bar', ['foo'], foo => foo * 2);\n123. \t\t\tassert.equal(store.get('bar'), 2);\n124. \n125. \t\t\tconst values = [];\n126. \n127. \t\t\tstore.observe('bar', bar => {\n128. \t\t\t\tvalues.push(bar);\n129. \t\t\t});\n130. \n131. \t\t\tstore.set({ foo: 2 });\n132. \t\t\tassert.deepEqual(values, [2, 4]);\n133. \t\t});\n134. \n135. \t\tit('computes a property based on another computed property', () => {\n136. \t\t\tconst store = new Store({\n137. \t\t\t\tfoo: 1\n138. \t\t\t});\n139. \n140. \t\t\tstore.compute('bar', ['foo'], foo => foo * 2);\n141. \t\t\tstore.compute('baz', ['bar'], bar => bar * 2);\n142. \t\t\tassert.equal(store.get('baz'), 4);\n143. \n144. \t\t\tconst values = [];\n145. \n146. \t\t\tstore.observe('baz', baz => {\n147. \t\t\t\tvalues.push(baz);\n148. \t\t\t});\n149. \n150. \t\t\tstore.set({ foo: 2 });\n151. \t\t\tassert.deepEqual(values, [4, 8]);\n152. \t\t});\n153. \n154. \t\tit('prevents computed properties from being set', () => {\n155. \t\t\tconst store = new Store({\n156. \t\t\t\tfoo: 1\n157. \t\t\t});\n158. \n159. \t\t\tstore.compute('bar', ['foo'], foo => foo * 2);\n160. \n161. \t\t\tassert.throws(() => {\n162. \t\t\t\tstore.set({ bar: 'whatever' });\n163. \t\t\t}, /'bar' is a read-only property/);\n164. \t\t});\n165. \n166. \t\tit('allows multiple dependents to depend on the same computed property', () => {\n167. \t\t\tconst store = new Store({\n168. \t\t\t\ta: 1\n169. \t\t\t});\n170. \n171. \t\t\tstore.compute('b', ['a'], a => a * 2);\n172. \t\t\tstore.compute('c', ['b'], b => b * 3);\n173. \t\t\tstore.compute('d', ['b'], b => b * 4);\n174. \n175. \t\t\tassert.deepEqual(store.get(), { a: 1, b: 2, c: 6, d: 8 });\n176. \n177. \t\t\t// bit cheeky, testing a private property, but whatever\n178. \t\t\tassert.equal(store._sortedComputedProperties.length, 3);\n179. \t\t});\n180. \n181. \t\tit('prevents cyclical dependencies', () => {\n182. \t\t\tconst store = new Store();\n183. \n184. \t\t\tassert.throws(() => {\n185. \t\t\t\tstore.compute('a', ['b'], b => b + 1);\n186. \t\t\t\tstore.compute('b', ['a'], a => a + 1);\n187. \t\t\t}, /Cyclical dependency detected/);\n188. \t\t});\n189. \t});\n190. });", start_line_number=1, end_line_number=190)]
2025-11-12 13:37:22,445 - thread-135845298308800.prometheus.lang_graph.nodes.bug_get_regression_tests_selection_node - DEBUG - Model response: selected_tests=[RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: This SSR-duplicated test exercises a component that initializes its own store in the root (via store()) and renders a nested component that consumes $name. The reported bug is specifically about nested components failing to receive an initialized store during server-side rendering.\n2. Impact likelihood: The fix will alter how stores are propagated/initialized for nested components in SSR. This test will directly catch regressions because the nested component relies on the parent’s store during SSR, matching the failure mode described (options.store being undefined in child _render).', test_identifier='test/server-side-rendering/index.js::store-root'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: The Todo child component defines a computed property that depends on $filter from the store. During SSR, correct store propagation to nested components is required for the computed visibility logic to render the expected items.\n2. Impact likelihood: Adjusting SSR store handling for nested components could easily break computed properties in children. This test will detect if SSR no longer provides the store to the child component, leading to wrong HTML or runtime errors in SSR.', test_identifier='test/server-side-rendering/index.js::store-computed'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: This test renders a nested NameInput component that uses a store binding ($name). While the SSR duplicate checks initial render only, it still requires proper store availability across component boundaries.\n2. Impact likelihood: Changes to SSR store propagation for nested components can cause the child to malfunction or crash during SSR. This test will reveal regressions in handling of bound store values in nested components.', test_identifier='test/server-side-rendering/index.js::store-binding'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: Similar to store-binding, this test includes a nested component (NameInput) that interacts with the store. Even though SSR does not simulate events, the initial render requires the store to be present to render $name correctly.\n2. Impact likelihood: Fixes to SSR store handling could inadvertently affect how nested components receive the store. This test adds coverage for another nested pattern and will catch regressions in SSR rendering with stores.', test_identifier='test/server-side-rendering/index.js::store-event'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: Although the bug manifests in SSR, any refactoring to how stores are initialized/passed to components could impact client/runtime behavior. This runtime test verifies that a root-initialized store updates both the root and nested component correctly.\n2. Impact likelihood: Ensuring the fix doesn’t break client-side nested store behavior is important. This test will detect regressions where nested components no longer reflect store updates after changes to store handling logic.', test_identifier='test/runtime/index.js::store-root (inline helpers)')]
2025-11-12 13:37:22,446 - thread-135845298308800.prometheus.lang_graph.nodes.bug_get_regression_tests_selection_node - DEBUG - 5 tests selected as regression tests
2025-11-12 13:37:22,447 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - INFO - Enter run_regression_tests_subgraph_node
2025-11-12 13:37:22,447 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - DEBUG - selected_regression_tests: ['test/server-side-rendering/index.js::store-root', 'test/server-side-rendering/index.js::store-computed', 'test/server-side-rendering/index.js::store-binding', 'test/server-side-rendering/index.js::store-event', 'test/runtime/index.js::store-root (inline helpers)']
2025-11-12 13:37:26,088 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6bPXdyy9uhkeRBmrxzZRpWDn', 'function': {'arguments': '{"command":"ls -la"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 154, 'prompt_tokens': 600, 'total_tokens': 754, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f18f68d5-4dd5-49c3-9f4c-043ec2eb675c-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la'}, 'id': 'call_6bPXdyy9uhkeRBmrxzZRpWDn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 600, 'output_tokens': 154, 'total_tokens': 754, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 13:37:26,091 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la
2025-11-12 13:37:26,193 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:37:26,193 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 836
drwxr-xr-x   1 root root   4096 Aug 28 02:30 [0m[01;34m.[0m
drwxr-xr-x   1 root root   4096 Nov 12 13:30 [01;34m..[0m
-rw-rw-r--   1 root root    227 Aug 28 02:29 .editorconfig
-rw-rw-r--   1 root root     85 Aug 28 02:29 .eslintignore
-rw-rw-r--   1 root root   1239 Aug 28 02:29 .eslintrc.json
-rw-rw-r--   1 root root     78 Aug 28 02:29 .flowconfig
drwxrwxr-x   7 root root   4096 Aug 28 02:29 [01;34m.git[0m
drwxrwxr-x   2 root root   4096 Aug 28 02:29 [01;34m.github[0m
-rw-rw-r--   1 root root    289 Aug 28 02:29 .gitignore
-rw-rw-r--   1 root root     51 Aug 28 02:29 .prettierrc
-rw-rw-r--   1 root root    270 Aug 28 02:29 .travis.yml
-rw-rw-r--   1 root root  44966 Aug 28 02:29 CHANGELOG.md
-rw-rw-r--   1 root root    251 Aug 28 02:29 Dockerfile
-rw-rw-r--   1 root root   1114 Aug 28 02:29 LICENSE
-rw-rw-r--   1 root root   8621 Aug 28 02:29 README.md
-rw-rw-r--   1 root root    556 Aug 28 02:29 appveyor.yml
drwxr-xr-x   2 root root   4096 Aug 28 02:30 [01;34mcompiler[0m
-rw-rw-r--   1 root root    105 Aug 28 02:29 mocha.coverage.opts
-rw-rw-r--   1 root root     12 Aug 28 02:29 mocha.opts
drwxr-xr-x 408 root root  16384 Aug 28 02:30 [01;34mnode_modules[0m
-rw-r--r--   1 root root 500424 Aug 28 02:30 package-lock.json
-rw-rw-r--   1 root root   2547 Aug 28 02:30 package.json
-rw-rw-r--   1 root root   1796 Aug 28 02:29 rollup.config.js
-rw-rw-r--   1 root root    128 Aug 28 02:29 rollup.store.config.js
-rw-r--r--   1 root root  14889 Aug 28 02:30 shared.js
drwxrwxr-x   1 root root   4096 Aug 28 02:29 [01;34msrc[0m
drwxr-xr-x   2 root root   4096 Aug 28 02:30 [01;34mssr[0m
-rw-rw-r--   1 root root   3515 Aug 28 02:29 store.js
-rw-r--r--   1 root root   5166 Aug 28 02:30 store.umd.js
drwxrwxr-x  15 root root   4096 Aug 28 02:29 [01;34mtest[0m
-rw-rw-r--   1 root root    326 Aug 28 02:29 tsconfig.json
-rw-rw-r--   1 root root 149327 Aug 28 02:30 yarn.lock
[?2004l
2025-11-12 13:37:28,837 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_KBpWYtfoTuPO0Q21JVz2AzIm', 'function': {'arguments': '{"command":"ls -la test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 155, 'prompt_tokens': 1553, 'total_tokens': 1708, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9dac85d8-3d69-4559-bb7b-87dec74140a8-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test'}, 'id': 'call_KBpWYtfoTuPO0Q21JVz2AzIm', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1553, 'output_tokens': 155, 'total_tokens': 1708, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 13:37:28,840 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test
2025-11-12 13:37:28,941 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:37:28,942 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 76
drwxrwxr-x 15 root root 4096 Aug 28 02:29 [0m[01;34m.[0m
drwxr-xr-x  1 root root 4096 Aug 28 02:30 [01;34m..[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcreate[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:29 [01;34mcss[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:29 [01;34mcustom-elements[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mformats[0m
-rw-rw-r--  1 root root 5512 Aug 28 02:29 helpers.js
drwxrwxr-x  3 root root 4096 Aug 28 02:29 [01;34mhydration[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:29 [01;34mjs[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:29 [01;34mparser[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mpreprocess[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:29 [01;34mruntime[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:29 [01;34mserver-side-rendering[0m
-rw-rw-r--  1 root root 1103 Aug 28 02:29 setup.js
drwxrwxr-x  3 root root 4096 Aug 28 02:29 [01;34msourcemaps[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mstore[0m
-rw-rw-r--  1 root root  247 Aug 28 02:29 test.js
drwxrwxr-x  3 root root 4096 Aug 28 02:29 [01;34mvalidator[0m
[?2004l
2025-11-12 13:37:30,969 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Ne90bMAdI0IcxgFpBf7uJSxh', 'function': {'arguments': '{"command":"cat package.json"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 90, 'prompt_tokens': 2193, 'total_tokens': 2283, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ad1fa9bb-47a6-4524-b42e-37cf57cfd3c4-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat package.json'}, 'id': 'call_Ne90bMAdI0IcxgFpBf7uJSxh', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2193, 'output_tokens': 90, 'total_tokens': 2283, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 13:37:30,973 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat package.json
2025-11-12 13:37:31,075 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:37:31,075 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
{
  "name": "svelte",
  "version": "1.51.1",
  "description": "The magical disappearing UI framework",
  "main": "compiler/svelte.js",
  "files": [
    "compiler",
    "ssr",
    "shared.js",
    "store.js",
    "store.umd.js",
    "README.md"
  ],
  "scripts": {
    "test": "mocha --opts mocha.opts",
    "quicktest": "mocha --opts mocha.opts",
    "precoverage": "export COVERAGE=true && nyc mocha --opts mocha.coverage.opts",
    "coverage": "nyc report --reporter=text-lcov > coverage.lcov",
    "codecov": "codecov",
    "precodecov": "npm run coverage",
    "lint": "echo noop",
    "build": "node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js",
    "prepare": "npm run build",
    "dev": "node src/shared/_build.js && rollup -c -w",
    "pretest": "npm run build",
    "prepublishOnly": "npm run lint && npm test",
    "prettier": "prettier --write \"src/**/*.ts\""
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/sveltejs/svelte.git"
  },
  "keywords": [
    "UI",
    "framework",
    "templates",
    "templating"
  ],
  "author": "Rich Harris",
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/sveltejs/svelte/issues"
  },
  "homepage": "https://github.com/sveltejs/svelte#README",
  "devDependencies": {
    "@types/mocha": "^2.2.41",
    "@types/node": "^8.0.17",
    "acorn": "^5.1.1",
    "acorn-dynamic-import": "^2.0.2",
    "chalk": "^2.0.1",
    "codecov": "^2.2.0",
    "console-group": "^0.3.2",
    "css-tree": "1.0.0-alpha22",
    "eslint": "^4.3.0",
    "eslint-plugin-html": "^3.0.0",
    "eslint-plugin-import": "^2.2.0",
    "estree-walker": "^0.5.1",
    "glob": "^7.1.1",
    "is-reference": "^1.1.0",
    "jsdom": "^11.1.0",
    "locate-character": "^2.0.0",
    "magic-string": "^0.22.3",
    "mocha": "^3.2.0",
    "nightmare": "^2.10.0",
    "node-resolve": "^1.3.3",
    "nyc": "^11.1.0",
    "prettier": "^1.7.0",
    "reify": "^0.12.3",
    "rollup": "^0.48.2",
    "rollup-plugin-buble": "^0.15.0",
    "rollup-plugin-commonjs": "^8.0.2",
    "rollup-plugin-json": "^2.1.0",
    "rollup-plugin-node-resolve": "^3.0.0",
    "rollup-plugin-replace": "^2.0.0",
    "rollup-plugin-typescript": "^0.8.1",
    "rollup-plugin-virtual": "^1.0.1",
    "rollup-watch": "^4.3.1",
    "source-map": "^0.5.6",
    "source-map-support": "^0.4.8",
    "ts-node": "^3.3.0",
    "tslib": "^1.8.0",
    "typescript": "^2.6.1"
  },
  "nyc": {
    "include": [
      "compiler/svelte.js",
      "shared.js"
    ],
    "sourceMap": true,
    "instrument": true
  }
}
[?2004l
2025-11-12 13:37:33,433 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_5cu8nB09BAzaR22zV4lmygZ6', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/server-side-rendering/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 103, 'prompt_tokens': 3146, 'total_tokens': 3249, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d24353d1-7bcc-4c6a-a4d5-526cf8cc9517-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/server-side-rendering/index.js"}, 'id': 'call_5cu8nB09BAzaR22zV4lmygZ6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3146, 'output_tokens': 103, 'total_tokens': 3249, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 13:37:33,436 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/server-side-rendering/index.js
2025-11-12 13:37:33,538 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:37:33,538 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import assert from "assert";
import * as fs from "fs";
import * as path from "path";
import glob from 'glob';

import {
	showOutput,
	loadConfig,
	setupHtmlEqual,
	tryToLoadJson
} from "../helpers.js";

function tryToReadFile(file) {
	try {
		return fs.readFileSync(file, "utf-8");
	} catch (err) {
		if (err.code !== "ENOENT") throw err;
		return null;
	}
}

describe("ssr", () => {
	before(() => {
		require("../../ssr/register")({
			extensions: ['.svelte', '.html'],
			store: true
		});

		return setupHtmlEqual();
	});

	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
		if (dir[0] === ".") return;

		// add .solo to a sample directory name to only run that test, or
		// .show to always show the output. or both
		const solo = /\.solo/.test(dir);
		const show = /\.show/.test(dir);

		if (solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		(solo ? it.only : it)(dir, () => {
			dir = path.resolve("test/server-side-rendering/samples", dir);
			try {
				let component;

				const mainHtmlFile = `${dir}/main.html`;
				const mainSvelteFile = `${dir}/main.svelte`;
				if (fs.existsSync(mainHtmlFile)) {
					component = require(mainHtmlFile);
				} else if (fs.existsSync(mainSvelteFile)) {
					component = require(mainSvelteFile);
				}

				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";

				const data = tryToLoadJson(`${dir}/data.json`);

				const rendered = component.render(data);
				const { html, css, head } = rendered;

				// rendered.toString() === rendered.html
				assert.equal(rendered, html);

				fs.writeFileSync(`${dir}/_actual.html`, html);
				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);

				assert.htmlEqual(html, expectedHtml);
				assert.equal(
					css.code.replace(/^\s+/gm, ""),
					expectedCss.replace(/^\s+/gm, "")
				);

				if (fs.existsSync(`${dir}/_expected-head.html`)) {
					fs.writeFileSync(`${dir}/_actual-head.html`, head);
					assert.htmlEqual(
						head,
						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
					);
				}

				if (show) showOutput(dir, { generate: 'ssr' });
			} catch (err) {
				showOutput(dir, { generate: 'ssr' });
				throw err;
			}
		});
	});

	// duplicate client-side tests, as far as possible
	fs.readdirSync("test/runtime/samples").forEach(dir => {
		if (dir[0] === ".") return;

		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);

		if (config.solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		if (config["skip-ssr"]) return;

		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
			const cwd = path.resolve("test/runtime/samples", dir);

			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
				delete require.cache[resolved];
			});

			require("../../ssr/register")({
				store: !!config.store
			});

			try {
				const component = require(`../runtime/samples/${dir}/main.html`);
				const { html } = component.render(config.data, {
					store: (config.store !== true) && config.store
				});

				if (config.html) {
					assert.htmlEqual(html, config.html);
				}
			} catch (err) {
				showOutput(cwd, { generate: "ssr" });
				throw err;
			}
		});
	});
});
[?2004l
2025-11-12 13:37:34,581 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_aIWxuyRGKTd6GgWLbzPpWQkY', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/runtime/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 4155, 'total_tokens': 4185, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a18395c3-c123-4a6d-b448-d1c8e2ca2922-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/runtime/index.js"}, 'id': 'call_aIWxuyRGKTd6GgWLbzPpWQkY', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4155, 'output_tokens': 30, 'total_tokens': 4185, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:37:34,583 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/runtime/index.js
2025-11-12 13:37:34,685 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:37:34,685 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import assert from "assert";
import chalk from 'chalk';
import * as path from "path";
import * as fs from "fs";
import * as acorn from "acorn";
import { transitionManager } from "../../shared.js";

import {
	showOutput,
	loadConfig,
	loadSvelte,
	env,
	setupHtmlEqual,
	spaces
} from "../helpers.js";

let svelte;

let compileOptions = null;

function getName(filename) {
	const base = path.basename(filename).replace(".html", "");
	return base[0].toUpperCase() + base.slice(1);
}

describe("runtime", () => {
	before(() => {
		svelte = loadSvelte(true);

		require.extensions[".html"] = function(module, filename) {
			const options = Object.assign(
				{ filename, name: getName(filename), format: 'cjs' },
				compileOptions
			);

			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);

			return module._compile(code, filename);
		};

		return setupHtmlEqual();
	});

	const failed = new Set();

	function runTest(dir, shared, hydrate) {
		if (dir[0] === ".") return;

		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);

		if (config.solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers${hydrate ? ' , hydration' : ''})`, () => {
			if (failed.has(dir)) {
				// this makes debugging easier, by only printing compiled output once
				throw new Error('skipping test, already failed');
			}

			const cwd = path.resolve(`test/runtime/samples/${dir}`);
			global.document.title = '';

			compileOptions = config.compileOptions || {};
			compileOptions.shared = shared;
			compileOptions.hydratable = hydrate;
			compileOptions.dev = config.dev;
			compileOptions.store = !!config.store;

			// check that no ES2015+ syntax slipped in
			if (!config.allowES2015) {
				try {
					const source = fs.readFileSync(
						`test/runtime/samples/${dir}/main.html`,
						"utf-8"
					);
					const { code } = svelte.compile(source, compileOptions);
					const startIndex = code.indexOf("function create_main_fragment"); // may change!
					if (startIndex === -1) throw new Error("missing create_main_fragment");
					const endIndex = code.lastIndexOf("export default");
					const es5 =
						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
						code.slice(startIndex, endIndex);

					acorn.parse(es5, { ecmaVersion: 5 });

					if (/Object\.assign/.test(es5)) {
						throw new Error(
							"cannot use Object.assign in generated code, as it is not supported everywhere"
						);
					}
				} catch (err) {
					failed.add(dir);
					if (err.frame) {
						console.error(chalk.red(err.frame)); // eslint-disable-line no-console
					}
					showOutput(cwd, { shared, format: 'cjs', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
					throw err;
				}
			}

			Object.keys(require.cache)
				.filter(x => x.endsWith(".html"))
				.forEach(file => {
					delete require.cache[file];
				});

			let SvelteComponent;

			let unintendedError = null;

			const window = env();

			return Promise.resolve()
				.then(() => {
					// set of hacks to support transition tests
					transitionManager.running = false;
					transitionManager.transitions = [];

					const raf = {
						time: 0,
						callback: null,
						tick: now => {
							raf.time = now;
							if (raf.callback) raf.callback();
						}
					};
					window.performance = { now: () => raf.time };
					global.requestAnimationFrame = cb => {
						let called = false;
						raf.callback = () => {
							if (!called) {
								called = true;
								cb();
							}
						};
					};

					try {
						SvelteComponent = require(`./samples/${dir}/main.html`);
					} catch (err) {
						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
						throw err;
					}

					global.window = window;

					// Put the constructor on window for testing
					window.SvelteComponent = SvelteComponent;

					const target = window.document.querySelector("main");

					const warnings = [];
					const warn = console.warn;
					console.warn = warning => {
						warnings.push(warning);
					};

					const options = Object.assign({}, {
						target,
						hydrate,
						data: config.data,
						store: (config.store !== true && config.store)
					}, config.options || {});

					const component = new SvelteComponent(options);

					console.warn = warn;

					if (config.error) {
						unintendedError = true;
						throw new Error("Expected a runtime error");
					}

					if (config.warnings) {
						assert.deepEqual(warnings, config.warnings);
					} else if (warnings.length) {
						unintendedError = true;
						throw new Error("Received unexpected warnings");
					}

					if (config.html) {
						assert.htmlEqual(target.innerHTML, config.html);
					}

					if (config.test) {
						return Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {
							component.destroy();
						});
					} else {
						component.destroy();
						assert.equal(target.innerHTML, "");
					}
				})
				.catch(err => {
					if (config.error && !unintendedError) {
						config.error(assert, err);
					} else {
						failed.add(dir);
						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
[?2004l
2025-11-12 13:37:35,817 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lZWA3oyyhUnidH3xTxbhhtcl', 'function': {'arguments': '{"command":"sed -n \'200,400p\' test/runtime/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 5583, 'total_tokens': 5613, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--420208ef-3b9e-4e28-bffc-e1bcd43adea6-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '200,400p' test/runtime/index.js"}, 'id': 'call_lZWA3oyyhUnidH3xTxbhhtcl', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5583, 'output_tokens': 30, 'total_tokens': 5613, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:37:35,821 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '200,400p' test/runtime/index.js
2025-11-12 13:37:35,922 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:37:35,922 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
						throw err;
					}
				})
				.then(() => {
					if (config.show) showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte);
				});
		});
	}

	const shared = path.resolve("shared.js");
	fs.readdirSync("test/runtime/samples").forEach(dir => {
		runTest(dir, shared, false);
		runTest(dir, shared, true);
		runTest(dir, null, false);
	});

	it("fails if options.target is missing in dev mode", () => {
		const { code } = svelte.compile(`<div></div>`, {
			format: "iife",
			name: "SvelteComponent",
			dev: true
		});

		const SvelteComponent = eval(
			`(function () { ${code}; return SvelteComponent; }())`
		);

		assert.throws(() => {
			new SvelteComponent();
		}, /'target' is a required option/);
	});

	it("fails if options.hydrate is true but the component is non-hydratable", () => {
		const { code } = svelte.compile(`<div></div>`, {
			format: "iife",
			name: "SvelteComponent",
			dev: true
		});

		const SvelteComponent = eval(
			`(function () { ${code}; return SvelteComponent; }())`
		);

		assert.throws(() => {
			new SvelteComponent({
				target: {},
				hydrate: true
			});
		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
	});
});
[?2004l
2025-11-12 13:37:37,854 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_qvsrcLfMpdd7tO82WeSJUP1a', 'function': {'arguments': '{"command":"ls -la test/server-side-rendering/samples"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 161, 'prompt_tokens': 6046, 'total_tokens': 6207, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5504}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8ae6d255-898b-4e00-8722-23f898010af7-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test/server-side-rendering/samples'}, 'id': 'call_qvsrcLfMpdd7tO82WeSJUP1a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6046, 'output_tokens': 161, 'total_tokens': 6207, 'input_token_details': {'audio': 0, 'cache_read': 5504}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 13:37:37,857 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/server-side-rendering/samples
2025-11-12 13:37:37,959 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:37:37,959 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 156
drwxrwxr-x 39 root root 4096 Aug 28 02:29 [0m[01;34m.[0m
drwxrwxr-x  3 root root 4096 Aug 28 02:29 [01;34m..[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mattribute-boolean[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mattribute-dynamic[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mattribute-static[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomment[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomponent[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomponent-binding[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomponent-binding-renamed[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomponent-data-dynamic[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomponent-data-empty[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomponent-data-static[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomponent-refs[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomponent-refs-and-attributes[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomponent-with-different-extension[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomponent-yield[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mcomputed[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mdefault-data[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mdefault-data-override[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mdirectives[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mdynamic-text[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mdynamic-text-escaped[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34meach-block[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mempty-elements-closed[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mentities[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mhead-title[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mhelpers[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mif-block-false[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mif-block-true[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mimport-non-component[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mraw-mustaches[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34msanitize-name[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mstatic-div[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mstatic-text[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mstyles[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mstyles-nested[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mtextarea-children[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mtextarea-value[0m
drwxrwxr-x  2 root root 4096 Aug 28 02:29 [01;34mtriple[0m
[?2004l
2025-11-12 13:37:40,664 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_H4ZNrWwOZUENVjDF3Mdrg6eg', 'function': {'arguments': '{"command":"ls -la test/server-side-rendering/samples | grep store"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 164, 'prompt_tokens': 7493, 'total_tokens': 7657, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6016}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4f20163c-d8e9-4c5f-b399-17875e1a22ab-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test/server-side-rendering/samples | grep store'}, 'id': 'call_H4ZNrWwOZUENVjDF3Mdrg6eg', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7493, 'output_tokens': 164, 'total_tokens': 7657, 'input_token_details': {'audio': 0, 'cache_read': 6016}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 13:37:40,669 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/server-side-rendering/samples | grep store
2025-11-12 13:37:40,770 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 13:37:40,771 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 ls -la test/server-side-rendering/samples | grep stor
re
[?2004l
[?2004l
2025-11-12 13:37:43,992 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6sfI4N968cQYmt9kFAuUaL0O', 'function': {'arguments': '{"command":"ls -la test/runtime/samples"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 222, 'prompt_tokens': 7562, 'total_tokens': 7784, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--050be358-b418-4206-a085-315a4547e3ae-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test/runtime/samples'}, 'id': 'call_6sfI4N968cQYmt9kFAuUaL0O', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7562, 'output_tokens': 222, 'total_tokens': 7784, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 13:37:43,996 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/runtime/samples
2025-11-12 13:37:44,099 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:37:44,099 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 1320
drwxrwxr-x 326 root root 20480 Aug 28 02:29 [0m[01;34m.[0m
drwxrwxr-x   3 root root  4096 Aug 28 02:29 [01;34m..[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-boolean-indeterminate[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-casing[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-dynamic-multiple[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-dynamic-reserved[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-dynamic-shorthand[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-dynamic-type[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-empty[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-empty-svg[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-namespaced[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-partial-number[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-prefer-expression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-static-at-symbol[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-static-boolean[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mattribute-static-quotemarks[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mautofocus[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mawait-component-oncreate[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mawait-then-catch[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mawait-then-catch-anchor[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mawait-then-catch-event[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mawait-then-catch-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mawait-then-catch-in-slot[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mawait-then-catch-multiple[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mawait-then-catch-non-promise[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mawait-then-shorthand[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-audio-currenttime-duration[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-indirect[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-indirect-computed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-checkbox[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-checkbox-deep-contextual[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-checkbox-group[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-checkbox-group-outside-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-checkbox-indeterminate[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-number[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-radio-group[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-range[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-range-change[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-text[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-text-contextual[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-text-deconflicted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-text-deep[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-text-deep-computed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-text-deep-computed-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-text-deep-contextual[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-text-deep-contextual-computed-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-input-with-event[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-select[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-select-implicit-option-value[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-select-in-each-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-select-in-yield[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-select-initial-value[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-select-initial-value-undefined[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-select-late[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-select-multiple[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-select-optgroup[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbinding-textarea[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbindings-before-oncreate[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mbindings-coalesced[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-blowback[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-blowback-b[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-blowback-c[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-computed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-conditional[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-conditional-b[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-deep[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-deep-b[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-each-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-each-object[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-infinite-loop[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-parent-supercedes-child[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-binding-self-destroying[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-data-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-data-dynamic-late[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-data-dynamic-shorthand[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-data-empty[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-data-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-data-static-boolean[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-data-static-boolean-regression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-events[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-events-data[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-events-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-if-placement[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-nested-deep[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-nested-deeper[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-not-void[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-ref[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-slot-default[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-slot-each-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-slot-empty[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-slot-fallback[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-slot-if-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-slot-if-block-before-node[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-slot-if-else-block-before-node[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-slot-named[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-slot-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-slot-nested-component[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-static-at-symbol[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-yield[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-yield-follows-element[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-yield-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-yield-multiple-in-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-yield-multiple-in-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-yield-nested-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-yield-parent[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-yield-placement[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomponent-yield-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomputed-empty[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomputed-function[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomputed-values[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomputed-values-deconflicted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomputed-values-default[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcomputed-values-function-dependency[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcss[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcss-comments[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcss-false[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcss-space-in-attribute[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mcustom-method[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdeconflict-builtins[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdeconflict-contexts[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdeconflict-non-helpers[0m
drwxrwxr-x   3 root root  4096 Aug 28 02:29 [01;34mdeconflict-self[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdeconflict-template-1[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdeconflict-template-2[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdeconflict-vars[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdefault-data[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdefault-data-function[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdefault-data-override[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdestroy-twice[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdestructuring[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-bad-observe-arguments[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-bad-set-argument[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-destroy-not-teardown[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-destroy-twice[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-dynamic-components-misplaced[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-helper[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-missing-data[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-missing-data-binding[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-missing-data-excludes-event[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-readonly-computed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdev-warning-readonly-window-binding[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdynamic-component[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdynamic-component-bindings[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdynamic-component-bindings-recreated[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdynamic-component-events[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdynamic-component-inside-element[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdynamic-component-slot[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mdynamic-component-update-existing-instance[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-containing-component-in-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-containing-if[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-destructured-array[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-dynamic-else-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-else[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-else-starts-empty[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-indexed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-keyed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-keyed-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-keyed-random-permute[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-keyed-unshift[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-random-permute[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-block-text-node[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-blocks-expression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-blocks-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34meach-blocks-nested-b[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34melement-invalid-name[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mempty-style-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mescape-template-literals[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mescaped-text[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-console-log[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-custom[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-custom-context[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-custom-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-custom-node-context[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-destroy[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-each[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-each-deconflicted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-event-methods[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-hoisted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-removal[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-sanitize[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-shorthand[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-shorthand-component[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevent-handler-this-methods[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevents-custom[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mevents-lifecycle[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mflush-before-bindings[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mfunction-in-expression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mget-state[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mglobals-accessible-directly[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mglobals-not-dereferenced[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mglobals-not-overwritten-by-bindings[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mglobals-shadowed-by-data[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mglobals-shadowed-by-helpers[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mhead-title-dynamic[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mhead-title-static[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mhello-world[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mhelpers[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mhelpers-not-call-expression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mhtml-entities[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mhtml-entities-inside-elements[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mhtml-non-entities-inside-elements[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mif-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mif-block-else[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mif-block-elseif[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mif-block-elseif-text[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mif-block-expression[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mif-block-or[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mif-block-widget[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mignore-unchanged-attribute[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mignore-unchanged-attribute-compound[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mignore-unchanged-raw[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mignore-unchanged-tag[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mimported-renamed-components[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34minline-expressions[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34minput-list[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mlifecycle-events[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mnames-deconflicted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mnames-deconflicted-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mnbsp[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mobserve-binding-ignores-unchanged[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mobserve-component-ignores-irrelevant-changes[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mobserve-deferred[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mobserve-prevents-loop[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34moncreate-async[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34moncreate-async-arrow[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34moncreate-async-arrow-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mondestroy-before-cleanup[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34monrender-chain[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34monrender-fires-when-ready[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34monrender-fires-when-ready-nested[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34moption-without-select[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34moptions[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mparen-wrapped-expressions[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mpreload[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mraw-anchor-first-child[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mraw-anchor-first-last-child[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mraw-anchor-last-child[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mraw-anchor-next-previous-sibling[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mraw-anchor-next-sibling[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mraw-anchor-previous-sibling[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mraw-mustaches[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mraw-mustaches-preserved[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mrefs[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mrefs-unset[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mselect[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mselect-bind-array[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mselect-bind-in-array[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mselect-change-handler[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mselect-no-whitespace[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mselect-one-way-bind[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mselect-one-way-bind-object[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mselect-props[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mself-reference[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mself-reference-tree[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mset-after-destroy[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mset-clones-input[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mset-in-observe[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mset-in-observe-dedupes-renders[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mset-in-oncreate[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mset-in-ondestroy[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mset-mutated-data[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mset-prevents-loop[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msetup[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msigil-static-#[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msigil-static-@[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msingle-static-element[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msingle-text-node[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mslot-in-custom-element[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mstate-deconflicted[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mstore[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mstore-binding[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mstore-computed[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mstore-event[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mstore-root[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg-attributes[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg-child-component-declared-namespace[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg-child-component-declared-namespace-shorthand[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg-class[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg-each-block-anchor[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg-each-block-namespace[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg-multiple[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg-no-whitespace[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg-xlink[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34msvg-xmlns[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtextarea-children[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtextarea-value[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-css-delay[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-delay[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-delay-in-out[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-dynamic-if-block-bidi[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-each-block-intro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-each-block-intro-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-each-block-keyed-intro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-each-block-keyed-intro-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-each-block-keyed-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-each-block-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-events[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-if-block-bidi[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-if-block-in-each-block-bidi[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-if-block-in-each-block-bidi-2[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-if-block-in-each-block-bidi-3[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-if-block-intro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-if-block-intro-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-if-else-block-dynamic-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-if-else-block-intro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-if-else-block-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-if-elseif-block-outro[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-initial[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-parameterised[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mtransition-js-parameterised-with-state[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mwhitespace-each-block[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mwhitespace-normal[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mwindow-bind-scroll-update[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mwindow-binding-resize[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mwindow-event[0m
drwxrwxr-x   2 root root  4096 Aug 28 02:29 [01;34mwindow-event-context[0m
[?2004l
2025-11-12 13:37:52,218 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_18IITXVOh25ZWed0DQzIT6cC', 'function': {'arguments': '{"command":"cat mocha.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 538, 'prompt_tokens': 20196, 'total_tokens': 20734, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c9ee21fa-acb2-42cb-a116-b71f8bd01bfc-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat mocha.opts'}, 'id': 'call_18IITXVOh25ZWed0DQzIT6cC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20196, 'output_tokens': 538, 'total_tokens': 20734, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 13:37:52,222 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat mocha.opts
2025-11-12 13:37:52,323 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:37:52,323 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 13:37:55,772 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_uXmNiaJlsuqKSHAaug4zA4ke', 'function': {'arguments': '{"command":"cat test/test.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 21, 'prompt_tokens': 20239, 'total_tokens': 20260, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3072}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2daae1d0-aad2-4386-905b-272189d1d5f4-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat test/test.js'}, 'id': 'call_uXmNiaJlsuqKSHAaug4zA4ke', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20239, 'output_tokens': 21, 'total_tokens': 20260, 'input_token_details': {'audio': 0, 'cache_read': 3072}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:37:55,775 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat test/test.js
2025-11-12 13:37:55,877 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:37:55,877 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
const glob = require("glob");

require("./setup");

glob.sync("**/__test__.js", { cwd: "src" }).forEach(function(file) {
	require("../src/" + file);
});

glob.sync("*/index.js", { cwd: "test" }).forEach(function(file) {
	require("./" + file);
});
[?2004l
2025-11-12 13:38:10,494 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_51cZJDjI9vsNxmoJVbkYlSYk', 'function': {'arguments': '{"command":"npm test -- --grep \\"(ssr.*(store-root|store-computed|store-binding|store-event))|(runtime.*store-root \\\\(inline helpers\\\\))\\""}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1403, 'prompt_tokens': 20351, 'total_tokens': 21754, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4096}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--25358ae7-2b3d-4197-b345-6e2827edc070-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm test -- --grep "(ssr.*(store-root|store-computed|store-binding|store-event))|(runtime.*store-root \\(inline helpers\\))"'}, 'id': 'call_51cZJDjI9vsNxmoJVbkYlSYk', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20351, 'output_tokens': 1403, 'total_tokens': 21754, 'input_token_details': {'audio': 0, 'cache_read': 4096}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-12 13:38:10,498 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: npm test -- --grep "(ssr.*(store-root|store-computed|store-binding|store-event))|(runtime.*store-root \(inline helpers\))"
2025-11-12 13:38:17,842 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:38:17,843 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 npm test -- --grep "(ssr.*(store-root|store-computed|
|store-binding|store-event))|(runtime.*store-root \(inline helpers\))"
[?2004l

> svelte@1.51.1 pretest
> npm run build


> svelte@1.51.1 build
> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m4.7s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m29ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m39ms[22m[39m
[36m[39m
[36m[1mstore.js[22m → [1mstore.umd.js[22m...[39m
[32mcreated [1mstore.umd.js[22m in [1m82ms[22m[39m

> svelte@1.51.1 test
> mocha --opts mocha.opts --grep (ssr.*(store-root|store-computed|store-binding|store-event))|(runtime.*store-root \(inline helpers\))


[0m[0m
[0m  runtime[0m
  [32m  ✓[0m[90m store-root (inline helpers)[0m[31m (92ms)[0m

[0m  ssr[0m
  [32m  ✓[0m[90m store-binding[0m
  [32m  ✓[0m[90m store-computed[0m
  [32m  ✓[0m[90m store-event[0m
  [32m  ✓[0m[90m store-root[0m


[92m [0m[32m 5 passing[0m[90m (171ms)[0m

[37;40mnpm[0m [0m[36;40mnotice[0m[35m[0m 
[0m[37;40mnpm[0m [0m[36;40mnotice[0m[35m[0m New [31mmajor[39m version of npm available! [31m8.19.4[39m -> [32m11.6.2[39m
[0m[37;40mnpm[0m [0m[36;40mnotice[0m[35m[0m Changelog: [36mhttps://github.com/npm/cli/releases/tag/v11.6.2[39m
[0m[37;40mnpm[0m [0m[36;40mnotice[0m[35m[0m Run [32mnpm install -g npm@11.6.2[39m to update!
[0m[37;40mnpm[0m [0m[36;40mnotice[0m[35m[0m 
[?2004l
2025-11-12 13:38:20,426 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='Result:\n5 tests run\nAll selected tests passed\nOutput detail:\n- runtime: ✓ store-root (inline helpers)\n- ssr: ✓ store-binding, ✓ store-computed, ✓ store-event, ✓ store-root\nTiming: 171ms total (approx)' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 58, 'prompt_tokens': 21366, 'total_tokens': 21424, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--3ecdf96e-d291-4064-aed9-d5aeace78232-0' usage_metadata={'input_tokens': 21366, 'output_tokens': 58, 'total_tokens': 21424, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:38:20,428 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_structure_node - DEBUG - Human Message: 
We have run the selected regression tests on the codebase.
The following regression tests were selected to run:
--- BEGIN SELECTED REGRESSION TESTS ---
test/server-side-rendering/index.js::store-root
test/server-side-rendering/index.js::store-computed
test/server-side-rendering/index.js::store-binding
test/server-side-rendering/index.js::store-event
test/runtime/index.js::store-root (inline helpers)
--- END SELECTED REGRESSION TESTS ---

Run Regression Tests Logs:
--- BEGIN LOG ---
Result:
5 tests run
All selected tests passed
Output detail:
- runtime: ✓ store-root (inline helpers)
- ssr: ✓ store-binding, ✓ store-computed, ✓ store-event, ✓ store-root
Timing: 171ms total (approx)
--- END LOG ---

Please analyze the logs and determine which regression tests passed!. You should return the exact test identifier 
that we give to you.
Don't forget to return the total number of tests run!

2025-11-12 13:38:26,806 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_structure_node - DEBUG - passed_regression_tests=['test/server-side-rendering/index.js::store-root', 'test/server-side-rendering/index.js::store-computed', 'test/server-side-rendering/index.js::store-binding', 'test/server-side-rendering/index.js::store-event', 'test/runtime/index.js::store-root (inline helpers)'] regression_test_fail_log='' total_tests_run=5
2025-11-12 13:38:26,808 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - INFO - passed_regression_tests: ['test/server-side-rendering/index.js::store-root', 'test/server-side-rendering/index.js::store-computed', 'test/server-side-rendering/index.js::store-binding', 'test/server-side-rendering/index.js::store-event', 'test/runtime/index.js::store-root (inline helpers)']
2025-11-12 13:38:26,808 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - DEBUG - regression_test_fail_log: 
2025-11-12 13:38:26,810 - thread-135845298308800.prometheus.lang_graph.nodes.bug_get_regression_tests_subgraph_node - DEBUG - Selected 5 regression tests: ['test/server-side-rendering/index.js::store-root', 'test/server-side-rendering/index.js::store-computed', 'test/server-side-rendering/index.js::store-binding', 'test/server-side-rendering/index.js::store-event', 'test/runtime/index.js::store-root (inline helpers)']
2025-11-12 13:38:26,812 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - Enter bug_reproduction_subgraph
2025-11-12 13:38:26,816 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_reproduction_context_message_node - DEBUG - Sending query to context provider subgraph:
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-11-12 13:38:26,817 - thread-135845298308800.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-12 13:38:26,820 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 13:38:50,523 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user asks for 5 complete, self-contained existing test cases with exact imports, setup, assertions, and line numbers. We only have the file tree, not the contents of any tests or sample files. To extract and present accurate test cases, we need the actual test harness files and the specific sample directories that are most relevant to SSR nesting and store usage. These include the server-side-rendering test runner, the runtime test runner (which contains store-related samples), shared test helpers, and the contents of selected sample directories.' query='Please provide the full contents of test/server-side-rendering/index.js, test/runtime/index.js, test/helpers.js, and all files in test/runtime/samples/{store-root,store-binding,store-computed} and test/server-side-rendering/samples/{component,component-data-dynamic}.' extra_requirements='If sending everything is too large, at minimum include the test definitions invoking these samples and helper functions they use, plus each sample’s main.html, _config.js, expected files, with their exact line numbers.' purpose='I need these files to extract 5 relevant existing tests demonstrating SSR with nested components and store usage, and present them with exact imports, setup, assertions, and line numbers.'
2025-11-12 13:38:50,524 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents of test/server-side-rendering/index.js, test/runtime/index.js, test/helpers.js, and all files in test/runtime/samples/{store-root,store-binding,store-computed} and test/server-side-rendering/samples/{component,component-data-dynamic}.
2025-11-12 13:38:54,954 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: [{'query_essential_query': 'Please provide the full content of test/server-side-rendering/index.js, test/runtime/index.js, test/store/index.js, and test/helpers.js.', 'query_extra_requirements': 'If sending all files is too large, please at minimum include test/server-side-rendering/index.js and test/helpers.js with their exact line numbers.', 'query_purpose': 'I need to extract 8 relevant test cases with precise line numbers and complete setup/assertions to use as regression tests for the SSR nested store issue.', 'memory_context_contexts': [{'relative_path': 'test/server-side-rendering/index.js', 'content': '1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";\n12. \n13. function tryToReadFile(file) {\n14. \ttry {\n15. \t\treturn fs.readFileSync(file, "utf-8");\n16. \t} catch (err) {\n17. \t\tif (err.code !== "ENOENT") throw err;\n18. \t\treturn null;\n19. \t}\n20. }\n21. \n22. describe("ssr", () => {\n23. \tbefore(() => {\n24. \t\trequire("../../ssr/register")({\n25. \t\t\textensions: [\'.svelte\', \'.html\'],\n26. \t\t\tstore: true\n27. \t\t});\n28. \n29. \t\treturn setupHtmlEqual();\n30. \t});\n31. \n32. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n33. \t\tif (dir[0] === ".") return;\n34. \n35. \t\t// add .solo to a sample directory name to only run that test, or\n36. \t\t// .show to always show the output. or both\n37. \t\tconst solo = /\\.solo/.test(dir);\n38. \t\tconst show = /\\.show/.test(dir);\n39. \n40. \t\tif (solo && process.env.CI) {\n41. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n42. \t\t}\n43. \n44. \t\t(solo ? it.only : it)(dir, () => {\n45. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n46. \t\t\ttry {\n47. \t\t\t\tlet component;\n48. \n49. \t\t\t\tconst mainHtmlFile = `${dir}/main.html`;\n50. \t\t\t\tconst mainSvelteFile = `${dir}/main.svelte`;\n51. \t\t\t\tif (fs.existsSync(mainHtmlFile)) {\n52. \t\t\t\t\tcomponent = require(mainHtmlFile);\n53. \t\t\t\t} else if (fs.existsSync(mainSvelteFile)) {\n54. \t\t\t\t\tcomponent = require(mainSvelteFile);\n55. \t\t\t\t}\n56. \n57. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n58. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n59. \n60. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n61. \n62. \t\t\t\tconst rendered = component.render(data);\n63. \t\t\t\tconst { html, css, head } = rendered;\n64. \n65. \t\t\t\t// rendered.toString() === rendered.html\n66. \t\t\t\tassert.equal(rendered, html);\n67. \n68. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n69. \t\t\t\tif (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);\n70. \n71. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n72. \t\t\t\tassert.equal(\n73. \t\t\t\t\tcss.code.replace(/^\\s+/gm, ""),\n74. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n75. \t\t\t\t);\n76. \n77. \t\t\t\tif (fs.existsSync(`${dir}/_expected-head.html`)) {\n78. \t\t\t\t\tfs.writeFileSync(`${dir}/_actual-head.html`, head);\n79. \t\t\t\t\tassert.htmlEqual(\n80. \t\t\t\t\t\thead,\n81. \t\t\t\t\t\tfs.readFileSync(`${dir}/_expected-head.html`, \'utf-8\')\n82. \t\t\t\t\t);\n83. \t\t\t\t}\n84. \n85. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n86. \t\t\t} catch (err) {\n87. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n88. \t\t\t\tthrow err;\n89. \t\t\t}\n90. \t\t});\n91. \t});\n92. \n93. \t// duplicate client-side tests, as far as possible\n94. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n95. \t\tif (dir[0] === ".") return;\n96. \n97. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n98. \n99. \t\tif (config.solo && process.env.CI) {\n100. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n101. \t\t}\n102. \n103. \t\tif (config["skip-ssr"]) return;\n104. \n105. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n106. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n107. \n108. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n109. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n110. \t\t\t\tdelete require.cache[resolved];\n111. \t\t\t});\n112. \n113. \t\t\trequire("../../ssr/register")({\n114. \t\t\t\tstore: !!config.store\n115. \t\t\t});\n116. \n117. \t\t\ttry {\n118. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n119. \t\t\t\tconst { html } = component.render(config.data, {\n120. \t\t\t\t\tstore: (config.store !== true) && config.store\n121. \t\t\t\t});\n122. \n123. \t\t\t\tif (config.html) {\n124. \t\t\t\t\tassert.htmlEqual(html, config.html);\n125. \t\t\t\t}\n126. \t\t\t} catch (err) {\n127. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n128. \t\t\t\tthrow err;\n129. \t\t\t}\n130. \t\t});\n131. \t});\n132. });', 'start_line_number': 1, 'end_line_number': 132}, {'relative_path': 'test/runtime/index.js', 'content': '1. import assert from "assert";\n2. import chalk from \'chalk\';\n3. import * as path from "path";\n4. import * as fs from "fs";\n5. import * as acorn from "acorn";\n6. import { transitionManager } from "../../shared.js";\n7. \n8. import {\n9. \tshowOutput,\n10. \tloadConfig,\n11. \tloadSvelte,\n12. \tenv,\n13. \tsetupHtmlEqual,\n14. \tspaces\n15. } from "../helpers.js";\n16. \n17. let svelte;\n18. \n19. let compileOptions = null;\n20. \n21. function getName(filename) {\n22. \tconst base = path.basename(filename).replace(".html", "");\n23. \treturn base[0].toUpperCase() + base.slice(1);\n24. }\n25. \n26. describe("runtime", () => {\n27. \tbefore(() => {\n28. \t\tsvelte = loadSvelte(true);\n29. \n30. \t\trequire.extensions[".html"] = function(module, filename) {\n31. \t\t\tconst options = Object.assign(\n32. \t\t\t\t{ filename, name: getName(filename), format: \'cjs\' },\n33. \t\t\t\tcompileOptions\n34. \t\t\t);\n35. \n36. \t\t\tconst { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);\n37. \n38. \t\t\treturn module._compile(code, filename);\n39. \t\t};\n40. \n41. \t\treturn setupHtmlEqual();\n42. \t});\n43. \n44. \tconst failed = new Set();\n45. \n46. \tfunction runTest(dir, shared, hydrate) {\n47. \t\tif (dir[0] === ".") return;\n48. \n49. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n50. \n51. \t\tif (config.solo && process.env.CI) {\n52. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n53. \t\t}\n54. \n55. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? \'shared\' : \'inline\'} helpers${hydrate ? \' , hydration\' : \'\'})`, () => {\n56. \t\t\tif (failed.has(dir)) {\n57. \t\t\t\t// this makes debugging easier, by only printing compiled output once\n58. \t\t\t\tthrow new Error(\'skipping test, already failed\');\n59. \t\t\t}\n60. \n61. \t\t\tconst cwd = path.resolve(`test/runtime/samples/${dir}`);\n62. \t\t\tglobal.document.title = \'\';\n63. \n64. \t\t\tcompileOptions = config.compileOptions || {};\n65. \t\t\tcompileOptions.shared = shared;\n66. \t\t\tcompileOptions.hydratable = hydrate;\n67. \t\t\tcompileOptions.dev = config.dev;\n68. \t\t\tcompileOptions.store = !!config.store;\n69. \n70. \t\t\t// check that no ES2015+ syntax slipped in\n71. \t\t\tif (!config.allowES2015) {\n72. \t\t\t\ttry {\n73. \t\t\t\t\tconst source = fs.readFileSync(\n74. \t\t\t\t\t\t`test/runtime/samples/${dir}/main.html`,\n75. \t\t\t\t\t\t"utf-8"\n76. \t\t\t\t\t);\n77. \t\t\t\t\tconst { code } = svelte.compile(source, compileOptions);\n78. \t\t\t\t\tconst startIndex = code.indexOf("function create_main_fragment"); // may change!\n79. \t\t\t\t\tif (startIndex === -1) throw new Error("missing create_main_fragment");\n80. \t\t\t\t\tconst endIndex = code.lastIndexOf("export default");\n81. \t\t\t\t\tconst es5 =\n82. \t\t\t\t\t\tcode.slice(0, startIndex).split(\'\\n\').map(x => spaces(x.length)).join(\'\\n\') +\n83. \t\t\t\t\t\tcode.slice(startIndex, endIndex);\n84. \n85. \t\t\t\t\tacorn.parse(es5, { ecmaVersion: 5 });\n86. \n87. \t\t\t\t\tif (/Object\\.assign/.test(es5)) {\n88. \t\t\t\t\t\tthrow new Error(\n89. \t\t\t\t\t\t\t"cannot use Object.assign in generated code, as it is not supported everywhere"\n90. \t\t\t\t\t\t);\n91. \t\t\t\t\t}\n92. \t\t\t\t} catch (err) {\n93. \t\t\t\t\tfailed.add(dir);\n94. \t\t\t\t\tif (err.frame) {\n95. \t\t\t\t\t\tconsole.error(chalk.red(err.frame)); // eslint-disable-line no-console\n96. \t\t\t\t\t}\n97. \t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n98. \t\t\t\t\tthrow err;\n99. \t\t\t\t}\n100. \t\t\t}\n101. \n102. \t\t\tObject.keys(require.cache)\n103. \t\t\t\t.filter(x => x.endsWith(".html"))\n104. \t\t\t\t.forEach(file => {\n105. \t\t\t\t\tdelete require.cache[file];\n106. \t\t\t\t});\n107. \n108. \t\t\tlet SvelteComponent;\n109. \n110. \t\t\tlet unintendedError = null;\n111. \n112. \t\t\tconst window = env();\n113. \n114. \t\t\treturn Promise.resolve()\n115. \t\t\t\t.then(() => {\n116. \t\t\t\t\t// set of hacks to support transition tests\n117. \t\t\t\t\ttransitionManager.running = false;\n118. \t\t\t\t\ttransitionManager.transitions = [];\n119. \n120. \t\t\t\t\tconst raf = {\n121. \t\t\t\t\t\ttime: 0,\n122. \t\t\t\t\t\tcallback: null,\n123. \t\t\t\t\t\ttick: now => {\n124. \t\t\t\t\t\t\traf.time = now;\n125. \t\t\t\t\t\t\tif (raf.callback) raf.callback();\n126. \t\t\t\t\t\t}\n127. \t\t\t\t\t};\n128. \t\t\t\t\twindow.performance = { now: () => raf.time };\n129. \t\t\t\t\tglobal.requestAnimationFrame = cb => {\n130. \t\t\t\t\t\tlet called = false;\n131. \t\t\t\t\t\traf.callback = () => {\n132. \t\t\t\t\t\t\tif (!called) {\n133. \t\t\t\t\t\t\t\tcalled = true;\n134. \t\t\t\t\t\t\t\tcb();\n135. \t\t\t\t\t\t\t}\n136. \t\t\t\t\t\t};\n137. \t\t\t\t\t};\n138. \n139. \t\t\t\t\ttry {\n140. \t\t\t\t\t\tSvelteComponent = require(`./samples/${dir}/main.html`);\n141. \t\t\t\t\t} catch (err) {\n142. \t\t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n143. \t\t\t\t\t\tthrow err;\n144. \t\t\t\t\t}\n145. \n146. \t\t\t\t\tglobal.window = window;\n147. \n148. \t\t\t\t\t// Put the constructor on window for testing\n149. \t\t\t\t\twindow.SvelteComponent = SvelteComponent;\n150. \n151. \t\t\t\t\tconst target = window.document.querySelector("main");\n152. \n153. \t\t\t\t\tconst warnings = [];\n154. \t\t\t\t\tconst warn = console.warn;\n155. \t\t\t\t\tconsole.warn = warning => {\n156. \t\t\t\t\t\twarnings.push(warning);\n157. \t\t\t\t\t};\n158. \n159. \t\t\t\t\tconst options = Object.assign({}, {\n160. \t\t\t\t\t\ttarget,\n161. \t\t\t\t\t\thydrate,\n162. \t\t\t\t\t\tdata: config.data,\n163. \t\t\t\t\t\tstore: (config.store !== true && config.store)\n164. \t\t\t\t\t}, config.options || {});\n165. \n166. \t\t\t\t\tconst component = new SvelteComponent(options);\n167. \n168. \t\t\t\t\tconsole.warn = warn;\n169. \n170. \t\t\t\t\tif (config.error) {\n171. \t\t\t\t\t\tunintendedError = true;\n172. \t\t\t\t\t\tthrow new Error("Expected a runtime error");\n173. \t\t\t\t\t}\n174. \n175. \t\t\t\t\tif (config.warnings) {\n176. \t\t\t\t\t\tassert.deepEqual(warnings, config.warnings);\n177. \t\t\t\t\t} else if (warnings.length) {\n178. \t\t\t\t\t\tunintendedError = true;\n179. \t\t\t\t\t\tthrow new Error("Received unexpected warnings");\n180. \t\t\t\t\t}\n181. \n182. \t\t\t\t\tif (config.html) {\n183. \t\t\t\t\t\tassert.htmlEqual(target.innerHTML, config.html);\n184. \t\t\t\t\t}\n185. \n186. \t\t\t\t\tif (config.test) {\n187. \t\t\t\t\t\treturn Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {\n188. \t\t\t\t\t\t\tcomponent.destroy();\n189. \t\t\t\t\t\t});\n190. \t\t\t\t\t} else {\n191. \t\t\t\t\t\tcomponent.destroy();\n192. \t\t\t\t\t\tassert.equal(target.innerHTML, "");\n193. \t\t\t\t\t}\n194. \t\t\t\t})\n195. \t\t\t\t.catch(err => {\n196. \t\t\t\t\tif (config.error && !unintendedError) {\n197. \t\t\t\t\t\tconfig.error(assert, err);\n198. \t\t\t\t\t} else {\n199. \t\t\t\t\t\tfailed.add(dir);\n200. \t\t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n201. \t\t\t\t\t\tthrow err;\n202. \t\t\t\t\t}\n203. \t\t\t\t})\n204. \t\t\t\t.then(() => {\n205. \t\t\t\t\tif (config.show) showOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte);\n206. \t\t\t\t});\n207. \t\t});\n208. \t}\n209. \n210. \tconst shared = path.resolve("shared.js");\n211. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n212. \t\trunTest(dir, shared, false);\n213. \t\trunTest(dir, shared, true);\n214. \t\trunTest(dir, null, false);\n215. \t});\n216. \n217. \tit("fails if options.target is missing in dev mode", () => {\n218. \t\tconst { code } = svelte.compile(`<div></div>`, {\n219. \t\t\tformat: "iife",\n220. \t\t\tname: "SvelteComponent",\n221. \t\t\tdev: true\n222. \t\t});\n223. \n224. \t\tconst SvelteComponent = eval(\n225. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n226. \t\t);\n227. \n228. \t\tassert.throws(() => {\n229. \t\t\tnew SvelteComponent();\n230. \t\t}, /\'target\' is a required option/);\n231. \t});\n232. \n233. \tit("fails if options.hydrate is true but the component is non-hydratable", () => {\n234. \t\tconst { code } = svelte.compile(`<div></div>`, {\n235. \t\t\tformat: "iife",\n236. \t\t\tname: "SvelteComponent",\n237. \t\t\tdev: true\n238. \t\t});\n239. \n240. \t\tconst SvelteComponent = eval(\n241. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n242. \t\t);\n243. \n244. \t\tassert.throws(() => {\n245. \t\t\tnew SvelteComponent({\n246. \t\t\t\ttarget: {},\n247. \t\t\t\thydrate: true\n248. \t\t\t});\n249. \t\t}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);\n250. \t});\n251. });', 'start_line_number': 1, 'end_line_number': 251}, {'relative_path': 'test/store/index.js', 'content': "1. import fs from 'fs';\n2. import assert from 'assert';\n3. import MagicString from 'magic-string';\n4. import { parse } from 'acorn';\n5. import { Store } from '../../store.js';\n6. \n7. describe('store', () => {\n8. \tit('is written in ES5', () => {\n9. \t\tconst source = fs.readFileSync('store.js', 'utf-8');\n10. \n11. \t\tconst ast = parse(source, {\n12. \t\t\tsourceType: 'module'\n13. \t\t});\n14. \n15. \t\tconst magicString = new MagicString(source);\n16. \t\tast.body.forEach(node => {\n17. \t\t\tif (/^(Im|Ex)port/.test(node.type)) magicString.remove(node.start, node.end);\n18. \t\t});\n19. \n20. \t\tparse(magicString.toString(), {\n21. \t\t\tecmaVersion: 5\n22. \t\t});\n23. \t});\n24. \n25. \tdescribe('get', () => {\n26. \t\tit('gets a specific key', () => {\n27. \t\t\tconst store = new Store({\n28. \t\t\t\tfoo: 'bar'\n29. \t\t\t});\n30. \n31. \t\t\tassert.equal(store.get('foo'), 'bar');\n32. \t\t});\n33. \n34. \t\tit('gets the entire state object', () => {\n35. \t\t\tconst store = new Store({\n36. \t\t\t\tfoo: 'bar'\n37. \t\t\t});\n38. \n39. \t\t\tassert.deepEqual(store.get(), { foo: 'bar' });\n40. \t\t});\n41. \t});\n42. \n43. \tdescribe('set', () => {\n44. \t\tit('sets state', () => {\n45. \t\t\tconst store = new Store();\n46. \n47. \t\t\tstore.set({\n48. \t\t\t\tfoo: 'bar'\n49. \t\t\t});\n50. \n51. \t\t\tassert.equal(store.get('foo'), 'bar');\n52. \t\t});\n53. \t});\n54. \n55. \tdescribe('observe', () => {\n56. \t\tit('observes state', () => {\n57. \t\t\tlet newFoo;\n58. \t\t\tlet oldFoo;\n59. \n60. \t\t\tconst store = new Store({\n61. \t\t\t\tfoo: 'bar'\n62. \t\t\t});\n63. \n64. \t\t\tstore.observe('foo', (n, o) => {\n65. \t\t\t\tnewFoo = n;\n66. \t\t\t\toldFoo = o;\n67. \t\t\t});\n68. \n69. \t\t\tassert.equal(newFoo, 'bar');\n70. \t\t\tassert.equal(oldFoo, undefined);\n71. \n72. \t\t\tstore.set({\n73. \t\t\t\tfoo: 'baz'\n74. \t\t\t});\n75. \n76. \t\t\tassert.equal(newFoo, 'baz');\n77. \t\t\tassert.equal(oldFoo, 'bar');\n78. \t\t});\n79. \t});\n80. \n81. \tdescribe('onchange', () => {\n82. \t\tit('fires a callback when state changes', () => {\n83. \t\t\tconst store = new Store();\n84. \n85. \t\t\tlet count = 0;\n86. \t\t\tlet args;\n87. \n88. \t\t\tstore.onchange((state, changed) => {\n89. \t\t\t\tcount += 1;\n90. \t\t\t\targs = { state, changed };\n91. \t\t\t});\n92. \n93. \t\t\tstore.set({ foo: 'bar' });\n94. \n95. \t\t\tassert.equal(count, 1);\n96. \t\t\tassert.deepEqual(args, {\n97. \t\t\t\tstate: { foo: 'bar' },\n98. \t\t\t\tchanged: { foo: true }\n99. \t\t\t});\n100. \n101. \t\t\t// this should be a noop\n102. \t\t\tstore.set({ foo: 'bar' });\n103. \t\t\tassert.equal(count, 1);\n104. \n105. \t\t\t// this shouldn't\n106. \t\t\tstore.set({ foo: 'baz' });\n107. \n108. \t\t\tassert.equal(count, 2);\n109. \t\t\tassert.deepEqual(args, {\n110. \t\t\t\tstate: { foo: 'baz' },\n111. \t\t\t\tchanged: { foo: true }\n112. \t\t\t});\n113. \t\t});\n114. \t});\n115. \n116. \tdescribe('computed', () => {\n117. \t\tit('computes a property based on data', () => {\n118. \t\t\tconst store = new Store({\n119. \t\t\t\tfoo: 1\n120. \t\t\t});\n121. \n122. \t\t\tstore.compute('bar', ['foo'], foo => foo * 2);\n123. \t\t\tassert.equal(store.get('bar'), 2);\n124. \n125. \t\t\tconst values = [];\n126. \n127. \t\t\tstore.observe('bar', bar => {\n128. \t\t\t\tvalues.push(bar);\n129. \t\t\t});\n130. \n131. \t\t\tstore.set({ foo: 2 });\n132. \t\t\tassert.deepEqual(values, [2, 4]);\n133. \t\t});\n134. \n135. \t\tit('computes a property based on another computed property', () => {\n136. \t\t\tconst store = new Store({\n137. \t\t\t\tfoo: 1\n138. \t\t\t});\n139. \n140. \t\t\tstore.compute('bar', ['foo'], foo => foo * 2);\n141. \t\t\tstore.compute('baz', ['bar'], bar => bar * 2);\n142. \t\t\tassert.equal(store.get('baz'), 4);\n143. \n144. \t\t\tconst values = [];\n145. \n146. \t\t\tstore.observe('baz', baz => {\n147. \t\t\t\tvalues.push(baz);\n148. \t\t\t});\n149. \n150. \t\t\tstore.set({ foo: 2 });\n151. \t\t\tassert.deepEqual(values, [4, 8]);\n152. \t\t});\n153. \n154. \t\tit('prevents computed properties from being set', () => {\n155. \t\t\tconst store = new Store({\n156. \t\t\t\tfoo: 1\n157. \t\t\t});\n158. \n159. \t\t\tstore.compute('bar', ['foo'], foo => foo * 2);\n160. \n161. \t\t\tassert.throws(() => {\n162. \t\t\t\tstore.set({ bar: 'whatever' });\n163. \t\t\t}, /'bar' is a read-only property/);\n164. \t\t});\n165. \n166. \t\tit('allows multiple dependents to depend on the same computed property', () => {\n167. \t\t\tconst store = new Store({\n168. \t\t\t\ta: 1\n169. \t\t\t});\n170. \n171. \t\t\tstore.compute('b', ['a'], a => a * 2);\n172. \t\t\tstore.compute('c', ['b'], b => b * 3);\n173. \t\t\tstore.compute('d', ['b'], b => b * 4);\n174. \n175. \t\t\tassert.deepEqual(store.get(), { a: 1, b: 2, c: 6, d: 8 });\n176. \n177. \t\t\t// bit cheeky, testing a private property, but whatever\n178. \t\t\tassert.equal(store._sortedComputedProperties.length, 3);\n179. \t\t});\n180. \n181. \t\tit('prevents cyclical dependencies', () => {\n182. \t\t\tconst store = new Store();\n183. \n184. \t\t\tassert.throws(() => {\n185. \t\t\t\tstore.compute('a', ['b'], b => b + 1);\n186. \t\t\t\tstore.compute('b', ['a'], a => a + 1);\n187. \t\t\t}, /Cyclical dependency detected/);\n188. \t\t});\n189. \t});\n190. });", 'start_line_number': 1, 'end_line_number': 190}, {'relative_path': 'test/helpers.js', 'content': "1. import { JSDOM } from 'jsdom';\n2. import assert from 'assert';\n3. import glob from 'glob';\n4. import fs from 'fs';\n5. import path from 'path';\n6. import chalk from 'chalk';\n7. \n8. // for coverage purposes, we need to test source files,\n9. // but for sanity purposes, we need to test dist files\n10. export function loadSvelte(test) {\n11. \tprocess.env.TEST = test ? 'true' : '';\n12. \n13. \tconst resolved = require.resolve('../compiler/svelte.js');\n14. \n15. \tdelete require.cache[resolved];\n16. \treturn require(resolved);\n17. }\n18. \n19. export const svelte = loadSvelte();\n20. \n21. export function exists(path) {\n22. \ttry {\n23. \t\tfs.statSync(path);\n24. \t\treturn true;\n25. \t} catch (err) {\n26. \t\treturn false;\n27. \t}\n28. }\n29. \n30. export function tryToLoadJson(file) {\n31. \ttry {\n32. \t\treturn JSON.parse(fs.readFileSync(file));\n33. \t} catch (err) {\n34. \t\tif (err.code !== 'ENOENT') throw err;\n35. \t\treturn null;\n36. \t}\n37. }\n38. \n39. export function tryToReadFile(file) {\n40. \ttry {\n41. \t\treturn fs.readFileSync(file, 'utf-8');\n42. \t} catch (err) {\n43. \t\tif (err.code !== 'ENOENT') throw err;\n44. \t\treturn null;\n45. \t}\n46. }\n47. \n48. const { window } = new JSDOM('<main></main>');\n49. global.document = window.document;\n50. \n51. export function env() {\n52. \twindow._svelteTransitionManager = null;\n53. \twindow.document.body.innerHTML = '<main></main>';\n54. \n55. \treturn window;\n56. }\n57. \n58. function cleanChildren(node) {\n59. \tlet previous = null;\n60. \n61. \t// sort attributes\n62. \tconst attributes = Array.from(node.attributes).sort((a, b) => {\n63. \t\treturn a.name < b.name ? -1 : 1;\n64. \t});\n65. \n66. \tattributes.forEach(attr => {\n67. \t\tnode.removeAttribute(attr.name);\n68. \t});\n69. \n70. \tattributes.forEach(attr => {\n71. \t\tnode.setAttribute(attr.name, attr.value);\n72. \t});\n73. \n74. \t// recurse\n75. \t[...node.childNodes].forEach(child => {\n76. \t\tif (child.nodeType === 3) {\n77. \t\t\t// text\n78. \t\t\tif (\n79. \t\t\t\tnode.namespaceURI === 'http://www.w3.org/2000/svg' &&\n80. \t\t\t\tnode.tagName !== 'text' &&\n81. \t\t\t\tnode.tagName !== 'tspan'\n82. \t\t\t) {\n83. \t\t\t\tnode.removeChild(child);\n84. \t\t\t}\n85. \n86. \t\t\tchild.data = child.data.replace(/\\s{2,}/g, '\\n');\n87. \n88. \t\t\tif (previous && previous.nodeType === 3) {\n89. \t\t\t\tprevious.data += child.data;\n90. \t\t\t\tprevious.data = previous.data.replace(/\\s{2,}/g, '\\n');\n91. \n92. \t\t\t\tnode.removeChild(child);\n93. \t\t\t\tchild = previous;\n94. \t\t\t}\n95. \t\t} else {\n96. \t\t\tcleanChildren(child);\n97. \t\t}\n98. \n99. \t\tprevious = child;\n100. \t});\n101. \n102. \t// collapse whitespace\n103. \tif (node.firstChild && node.firstChild.nodeType === 3) {\n104. \t\tnode.firstChild.data = node.firstChild.data.replace(/^\\s+/, '');\n105. \t\tif (!node.firstChild.data) node.removeChild(node.firstChild);\n106. \t}\n107. \n108. \tif (node.lastChild && node.lastChild.nodeType === 3) {\n109. \t\tnode.lastChild.data = node.lastChild.data.replace(/\\s+$/, '');\n110. \t\tif (!node.lastChild.data) node.removeChild(node.lastChild);\n111. \t}\n112. }\n113. \n114. export function normalizeHtml(window, html) {\n115. \ttry {\n116. \t\tconst node = window.document.createElement('div');\n117. \t\tnode.innerHTML = html\n118. \t\t\t.replace(/<!--.*?-->/g, '')\n119. \t\t\t.replace(/>[\\s\\r\\n]+</g, '><')\n120. \t\t\t.trim();\n121. \t\tcleanChildren(node, '');\n122. \t\treturn node.innerHTML.replace(/<\\/?noscript\\/?>/g, '');\n123. \t} catch (err) {\n124. \t\tthrow new Error(`Failed to normalize HTML:\\n${html}`);\n125. \t}\n126. }\n127. \n128. export function setupHtmlEqual() {\n129. \tconst window = env();\n130. \n131. \tassert.htmlEqual = (actual, expected, message) => {\n132. \t\tassert.deepEqual(\n133. \t\t\tnormalizeHtml(window, actual),\n134. \t\t\tnormalizeHtml(window, expected),\n135. \t\t\tmessage\n136. \t\t);\n137. \t};\n138. }\n139. \n140. export function loadConfig(file) {\n141. \ttry {\n142. \t\tconst resolved = require.resolve(file);\n143. \t\tdelete require.cache[resolved];\n144. \n145. \t\tconst config = require(resolved);\n146. \t\treturn config.default || config;\n147. \t} catch (err) {\n148. \t\tif (err.code === 'MODULE_NOT_FOUND') {\n149. \t\t\treturn {};\n150. \t\t}\n151. \n152. \t\tthrow err;\n153. \t}\n154. }\n155. \n156. export function addLineNumbers(code) {\n157. \treturn code\n158. \t\t.split('\\n')\n159. \t\t.map((line, i) => {\n160. \t\t\ti = String(i + 1);\n161. \t\t\twhile (i.length < 3) i = ` ${i}`;\n162. \n163. \t\t\treturn (\n164. \t\t\t\tchalk.grey(`  ${i}: `) +\n165. \t\t\t\tline.replace(/^\\t+/, match => match.split('\\t').join('    '))\n166. \t\t\t);\n167. \t\t})\n168. \t\t.join('\\n');\n169. }\n170. \n171. function capitalise(str) {\n172. \treturn str[0].toUpperCase() + str.slice(1);\n173. }\n174. \n175. export function showOutput(cwd, options = {}, s = svelte) {\n176. \tglob.sync('**/*.html', { cwd }).forEach(file => {\n177. \t\tif (file[0] === '_') return;\n178. \n179. \t\tconst name = path.basename(file)\n180. \t\t\t.slice(0, -path.extname(file).length)\n181. \t\t\t.replace(/^\\d/, '_$&')\n182. \t\t\t.replace(/[^a-zA-Z0-9_$]/g, '');\n183. \n184. \t\tconst { code } = s.compile(\n185. \t\t\tfs.readFileSync(`${cwd}/${file}`, 'utf-8'),\n186. \t\t\tObject.assign(options, {\n187. \t\t\t\tfilename: file,\n188. \t\t\t\tname: capitalise(name)\n189. \t\t\t})\n190. \t\t);\n191. \n192. \t\tconsole.log( // eslint-disable-line no-console\n193. \t\t\t`\\n>> ${chalk.cyan.bold(file)}\\n${addLineNumbers(code)}\\n<< ${chalk.cyan.bold(file)}`\n194. \t\t);\n195. \t});\n196. }\n197. \n198. const start = /\\n(\\t+)/;\n199. export function deindent(strings, ...values) {\n200. \tconst indentation = start.exec(strings[0])[1];\n201. \tconst pattern = new RegExp(`^${indentation}`, 'gm');\n202. \n203. \tlet result = strings[0].replace(start, '').replace(pattern, '');\n204. \n205. \tlet trailingIndentation = getTrailingIndentation(result);\n206. \n207. \tfor (let i = 1; i < strings.length; i += 1) {\n208. \t\tlet expression = values[i - 1];\n209. \t\tconst string = strings[i].replace(pattern, '');\n210. \n211. \t\tif (Array.isArray(expression)) {\n212. \t\t\texpression = expression.length ? expression.join('\\n') : null;\n213. \t\t}\n214. \n215. \t\tif (expression || expression === '') {\n216. \t\t\tconst value = String(expression).replace(\n217. \t\t\t\t/\\n/g,\n218. \t\t\t\t`\\n${trailingIndentation}`\n219. \t\t\t);\n220. \t\t\tresult += value + string;\n221. \t\t} else {\n222. \t\t\tlet c = result.length;\n223. \t\t\twhile (/\\s/.test(result[c - 1])) c -= 1;\n224. \t\t\tresult = result.slice(0, c) + string;\n225. \t\t}\n226. \n227. \t\ttrailingIndentation = getTrailingIndentation(result);\n228. \t}\n229. \n230. \treturn result.trim().replace(/\\t+$/gm, '');\n231. }\n232. \n233. function getTrailingIndentation(str) {\n234. \tlet i = str.length;\n235. \twhile (str[i - 1] === ' ' || str[i - 1] === '\\t') i -= 1;\n236. \treturn str.slice(i, str.length);\n237. }\n238. \n239. export function spaces(i) {\n240. \tlet result = '';\n241. \twhile (i--) result += ' ';\n242. \treturn result;\n243. }", 'start_line_number': 1, 'end_line_number': 243}]}]
2025-11-12 13:38:54,954 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 1 memories from memory
2025-11-12 13:38:54,954 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 4 contexts from memory
2025-11-12 13:38:54,954 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 4 contexts from memory
2025-11-12 13:38:54,956 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 4 new contexts to 0 existing contexts
2025-11-12 13:38:54,956 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 4 total contexts (removed 0 duplicates)
2025-11-12 13:38:54,958 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of test/server-side-rendering/index.js, test/runtime/index.js, test/helpers.js, and all files in test/runtime/samples/{store-root,store-binding,store-computed} and test/server-side-rendering/samples/{component,component-data-dynamic}.
Extra Requirements: If sending everything is too large, at minimum include the test definitions invoking these samples and helper functions they use, plus each sample’s main.html, _config.js, expected files, with their exact line numbers.
Purpose: I need these files to extract 5 relevant existing tests demonstrating SSR with nested components and store usage, and present them with exact imports, setup, assertions, and line numbers.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: test/helpers.js
Line number range: 1 - 243
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	process.env.TEST = test ? 'true' : '';
12. 
13. 	const resolved = require.resolve('../compiler/svelte.js');
14. 
15. 	delete require.cache[resolved];
16. 	return require(resolved);
17. }
18. 
19. export const svelte = loadSvelte();
20. 
21. export function exists(path) {
22. 	try {
23. 		fs.statSync(path);
24. 		return true;
25. 	} catch (err) {
26. 		return false;
27. 	}
28. }
29. 
30. export function tryToLoadJson(file) {
31. 	try {
32. 		return JSON.parse(fs.readFileSync(file));
33. 	} catch (err) {
34. 		if (err.code !== 'ENOENT') throw err;
35. 		return null;
36. 	}
37. }
38. 
39. export function tryToReadFile(file) {
40. 	try {
41. 		return fs.readFileSync(file, 'utf-8');
42. 	} catch (err) {
43. 		if (err.code !== 'ENOENT') throw err;
44. 		return null;
45. 	}
46. }
47. 
48. const { window } = new JSDOM('<main></main>');
49. global.document = window.document;
50. 
51. export function env() {
52. 	window._svelteTransitionManager = null;
53. 	window.document.body.innerHTML = '<main></main>';
54. 
55. 	return window;
56. }
57. 
58. function cleanChildren(node) {
59. 	let previous = null;
60. 
61. 	// sort attributes
62. 	const attributes = Array.from(node.attributes).sort((a, b) => {
63. 		return a.name < b.name ? -1 : 1;
64. 	});
65. 
66. 	attributes.forEach(attr => {
67. 		node.removeAttribute(attr.name);
68. 	});
69. 
70. 	attributes.forEach(attr => {
71. 		node.setAttribute(attr.name, attr.value);
72. 	});
73. 
74. 	// recurse
75. 	[...node.childNodes].forEach(child => {
76. 		if (child.nodeType === 3) {
77. 			// text
78. 			if (
79. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
80. 				node.tagName !== 'text' &&
81. 				node.tagName !== 'tspan'
82. 			) {
83. 				node.removeChild(child);
84. 			}
85. 
86. 			child.data = child.data.replace(/\s{2,}/g, '\n');
87. 
88. 			if (previous && previous.nodeType === 3) {
89. 				previous.data += child.data;
90. 				previous.data = previous.data.replace(/\s{2,}/g, '\n');
91. 
92. 				node.removeChild(child);
93. 				child = previous;
94. 			}
95. 		} else {
96. 			cleanChildren(child);
97. 		}
98. 
99. 		previous = child;
100. 	});
101. 
102. 	// collapse whitespace
103. 	if (node.firstChild && node.firstChild.nodeType === 3) {
104. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
105. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
106. 	}
107. 
108. 	if (node.lastChild && node.lastChild.nodeType === 3) {
109. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
110. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
111. 	}
112. }
113. 
114. export function normalizeHtml(window, html) {
115. 	try {
116. 		const node = window.document.createElement('div');
117. 		node.innerHTML = html
118. 			.replace(/<!--.*?-->/g, '')
119. 			.replace(/>[\s\r\n]+</g, '><')
120. 			.trim();
121. 		cleanChildren(node, '');
122. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
123. 	} catch (err) {
124. 		throw new Error(`Failed to normalize HTML:\n${html}`);
125. 	}
126. }
127. 
128. export function setupHtmlEqual() {
129. 	const window = env();
130. 
131. 	assert.htmlEqual = (actual, expected, message) => {
132. 		assert.deepEqual(
133. 			normalizeHtml(window, actual),
134. 			normalizeHtml(window, expected),
135. 			message
136. 		);
137. 	};
138. }
139. 
140. export function loadConfig(file) {
141. 	try {
142. 		const resolved = require.resolve(file);
143. 		delete require.cache[resolved];
144. 
145. 		const config = require(resolved);
146. 		return config.default || config;
147. 	} catch (err) {
148. 		if (err.code === 'MODULE_NOT_FOUND') {
149. 			return {};
150. 		}
151. 
152. 		throw err;
153. 	}
154. }
155. 
156. export function addLineNumbers(code) {
157. 	return code
158. 		.split('\n')
159. 		.map((line, i) => {
160. 			i = String(i + 1);
161. 			while (i.length < 3) i = ` ${i}`;
162. 
163. 			return (
164. 				chalk.grey(`  ${i}: `) +
165. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
166. 			);
167. 		})
168. 		.join('\n');
169. }
170. 
171. function capitalise(str) {
172. 	return str[0].toUpperCase() + str.slice(1);
173. }
174. 
175. export function showOutput(cwd, options = {}, s = svelte) {
176. 	glob.sync('**/*.html', { cwd }).forEach(file => {
177. 		if (file[0] === '_') return;
178. 
179. 		const name = path.basename(file)
180. 			.slice(0, -path.extname(file).length)
181. 			.replace(/^\d/, '_$&')
182. 			.replace(/[^a-zA-Z0-9_$]/g, '');
183. 
184. 		const { code } = s.compile(
185. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
186. 			Object.assign(options, {
187. 				filename: file,
188. 				name: capitalise(name)
189. 			})
190. 		);
191. 
192. 		console.log( // eslint-disable-line no-console
193. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
194. 		);
195. 	});
196. }
197. 
198. const start = /\n(\t+)/;
199. export function deindent(strings, ...values) {
200. 	const indentation = start.exec(strings[0])[1];
201. 	const pattern = new RegExp(`^${indentation}`, 'gm');
202. 
203. 	let result = strings[0].replace(start, '').replace(pattern, '');
204. 
205. 	let trailingIndentation = getTrailingIndentation(result);
206. 
207. 	for (let i = 1; i < strings.length; i += 1) {
208. 		let expression = values[i - 1];
209. 		const string = strings[i].replace(pattern, '');
210. 
211. 		if (Array.isArray(expression)) {
212. 			expression = expression.length ? expression.join('\n') : null;
213. 		}
214. 
215. 		if (expression || expression === '') {
216. 			const value = String(expression).replace(
217. 				/\n/g,
218. 				`\n${trailingIndentation}`
219. 			);
220. 			result += value + string;
221. 		} else {
222. 			let c = result.length;
223. 			while (/\s/.test(result[c - 1])) c -= 1;
224. 			result = result.slice(0, c) + string;
225. 		}
226. 
227. 		trailingIndentation = getTrailingIndentation(result);
228. 	}
229. 
230. 	return result.trim().replace(/\t+$/gm, '');
231. }
232. 
233. function getTrailingIndentation(str) {
234. 	let i = str.length;
235. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
236. 	return str.slice(i, str.length);
237. }
238. 
239. export function spaces(i) {
240. 	let result = '';
241. 	while (i--) result += ' ';
242. 	return result;
243. }


File: test/runtime/index.js
Line number range: 1 - 251
Content:
1. import assert from "assert";
2. import chalk from 'chalk';
3. import * as path from "path";
4. import * as fs from "fs";
5. import * as acorn from "acorn";
6. import { transitionManager } from "../../shared.js";
7. 
8. import {
9. 	showOutput,
10. 	loadConfig,
11. 	loadSvelte,
12. 	env,
13. 	setupHtmlEqual,
14. 	spaces
15. } from "../helpers.js";
16. 
17. let svelte;
18. 
19. let compileOptions = null;
20. 
21. function getName(filename) {
22. 	const base = path.basename(filename).replace(".html", "");
23. 	return base[0].toUpperCase() + base.slice(1);
24. }
25. 
26. describe("runtime", () => {
27. 	before(() => {
28. 		svelte = loadSvelte(true);
29. 
30. 		require.extensions[".html"] = function(module, filename) {
31. 			const options = Object.assign(
32. 				{ filename, name: getName(filename), format: 'cjs' },
33. 				compileOptions
34. 			);
35. 
36. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
37. 
38. 			return module._compile(code, filename);
39. 		};
40. 
41. 		return setupHtmlEqual();
42. 	});
43. 
44. 	const failed = new Set();
45. 
46. 	function runTest(dir, shared, hydrate) {
47. 		if (dir[0] === ".") return;
48. 
49. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
50. 
51. 		if (config.solo && process.env.CI) {
52. 			throw new Error("Forgot to remove `solo: true` from test");
53. 		}
54. 
55. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers${hydrate ? ' , hydration' : ''})`, () => {
56. 			if (failed.has(dir)) {
57. 				// this makes debugging easier, by only printing compiled output once
58. 				throw new Error('skipping test, already failed');
59. 			}
60. 
61. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
62. 			global.document.title = '';
63. 
64. 			compileOptions = config.compileOptions || {};
65. 			compileOptions.shared = shared;
66. 			compileOptions.hydratable = hydrate;
67. 			compileOptions.dev = config.dev;
68. 			compileOptions.store = !!config.store;
69. 
70. 			// check that no ES2015+ syntax slipped in
71. 			if (!config.allowES2015) {
72. 				try {
73. 					const source = fs.readFileSync(
74. 						`test/runtime/samples/${dir}/main.html`,
75. 						"utf-8"
76. 					);
77. 					const { code } = svelte.compile(source, compileOptions);
78. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
79. 					if (startIndex === -1) throw new Error("missing create_main_fragment");
80. 					const endIndex = code.lastIndexOf("export default");
81. 					const es5 =
82. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
83. 						code.slice(startIndex, endIndex);
84. 
85. 					acorn.parse(es5, { ecmaVersion: 5 });
86. 
87. 					if (/Object\.assign/.test(es5)) {
88. 						throw new Error(
89. 							"cannot use Object.assign in generated code, as it is not supported everywhere"
90. 						);
91. 					}
92. 				} catch (err) {
93. 					failed.add(dir);
94. 					if (err.frame) {
95. 						console.error(chalk.red(err.frame)); // eslint-disable-line no-console
96. 					}
97. 					showOutput(cwd, { shared, format: 'cjs', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
98. 					throw err;
99. 				}
100. 			}
101. 
102. 			Object.keys(require.cache)
103. 				.filter(x => x.endsWith(".html"))
104. 				.forEach(file => {
105. 					delete require.cache[file];
106. 				});
107. 
108. 			let SvelteComponent;
109. 
110. 			let unintendedError = null;
111. 
112. 			const window = env();
113. 
114. 			return Promise.resolve()
115. 				.then(() => {
116. 					// set of hacks to support transition tests
117. 					transitionManager.running = false;
118. 					transitionManager.transitions = [];
119. 
120. 					const raf = {
121. 						time: 0,
122. 						callback: null,
123. 						tick: now => {
124. 							raf.time = now;
125. 							if (raf.callback) raf.callback();
126. 						}
127. 					};
128. 					window.performance = { now: () => raf.time };
129. 					global.requestAnimationFrame = cb => {
130. 						let called = false;
131. 						raf.callback = () => {
132. 							if (!called) {
133. 								called = true;
134. 								cb();
135. 							}
136. 						};
137. 					};
138. 
139. 					try {
140. 						SvelteComponent = require(`./samples/${dir}/main.html`);
141. 					} catch (err) {
142. 						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
143. 						throw err;
144. 					}
145. 
146. 					global.window = window;
147. 
148. 					// Put the constructor on window for testing
149. 					window.SvelteComponent = SvelteComponent;
150. 
151. 					const target = window.document.querySelector("main");
152. 
153. 					const warnings = [];
154. 					const warn = console.warn;
155. 					console.warn = warning => {
156. 						warnings.push(warning);
157. 					};
158. 
159. 					const options = Object.assign({}, {
160. 						target,
161. 						hydrate,
162. 						data: config.data,
163. 						store: (config.store !== true && config.store)
164. 					}, config.options || {});
165. 
166. 					const component = new SvelteComponent(options);
167. 
168. 					console.warn = warn;
169. 
170. 					if (config.error) {
171. 						unintendedError = true;
172. 						throw new Error("Expected a runtime error");
173. 					}
174. 
175. 					if (config.warnings) {
176. 						assert.deepEqual(warnings, config.warnings);
177. 					} else if (warnings.length) {
178. 						unintendedError = true;
179. 						throw new Error("Received unexpected warnings");
180. 					}
181. 
182. 					if (config.html) {
183. 						assert.htmlEqual(target.innerHTML, config.html);
184. 					}
185. 
186. 					if (config.test) {
187. 						return Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {
188. 							component.destroy();
189. 						});
190. 					} else {
191. 						component.destroy();
192. 						assert.equal(target.innerHTML, "");
193. 					}
194. 				})
195. 				.catch(err => {
196. 					if (config.error && !unintendedError) {
197. 						config.error(assert, err);
198. 					} else {
199. 						failed.add(dir);
200. 						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
201. 						throw err;
202. 					}
203. 				})
204. 				.then(() => {
205. 					if (config.show) showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte);
206. 				});
207. 		});
208. 	}
209. 
210. 	const shared = path.resolve("shared.js");
211. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
212. 		runTest(dir, shared, false);
213. 		runTest(dir, shared, true);
214. 		runTest(dir, null, false);
215. 	});
216. 
217. 	it("fails if options.target is missing in dev mode", () => {
218. 		const { code } = svelte.compile(`<div></div>`, {
219. 			format: "iife",
220. 			name: "SvelteComponent",
221. 			dev: true
222. 		});
223. 
224. 		const SvelteComponent = eval(
225. 			`(function () { ${code}; return SvelteComponent; }())`
226. 		);
227. 
228. 		assert.throws(() => {
229. 			new SvelteComponent();
230. 		}, /'target' is a required option/);
231. 	});
232. 
233. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
234. 		const { code } = svelte.compile(`<div></div>`, {
235. 			format: "iife",
236. 			name: "SvelteComponent",
237. 			dev: true
238. 		});
239. 
240. 		const SvelteComponent = eval(
241. 			`(function () { ${code}; return SvelteComponent; }())`
242. 		);
243. 
244. 		assert.throws(() => {
245. 			new SvelteComponent({
246. 				target: {},
247. 				hydrate: true
248. 			});
249. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
250. 	});
251. });


File: test/server-side-rendering/index.js
Line number range: 1 - 132
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require("../../ssr/register")({
25. 			extensions: ['.svelte', '.html'],
26. 			store: true
27. 		});
28. 
29. 		return setupHtmlEqual();
30. 	});
31. 
32. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
33. 		if (dir[0] === ".") return;
34. 
35. 		// add .solo to a sample directory name to only run that test, or
36. 		// .show to always show the output. or both
37. 		const solo = /\.solo/.test(dir);
38. 		const show = /\.show/.test(dir);
39. 
40. 		if (solo && process.env.CI) {
41. 			throw new Error("Forgot to remove `solo: true` from test");
42. 		}
43. 
44. 		(solo ? it.only : it)(dir, () => {
45. 			dir = path.resolve("test/server-side-rendering/samples", dir);
46. 			try {
47. 				let component;
48. 
49. 				const mainHtmlFile = `${dir}/main.html`;
50. 				const mainSvelteFile = `${dir}/main.svelte`;
51. 				if (fs.existsSync(mainHtmlFile)) {
52. 					component = require(mainHtmlFile);
53. 				} else if (fs.existsSync(mainSvelteFile)) {
54. 					component = require(mainSvelteFile);
55. 				}
56. 
57. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
58. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
59. 
60. 				const data = tryToLoadJson(`${dir}/data.json`);
61. 
62. 				const rendered = component.render(data);
63. 				const { html, css, head } = rendered;
64. 
65. 				// rendered.toString() === rendered.html
66. 				assert.equal(rendered, html);
67. 
68. 				fs.writeFileSync(`${dir}/_actual.html`, html);
69. 				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);
70. 
71. 				assert.htmlEqual(html, expectedHtml);
72. 				assert.equal(
73. 					css.code.replace(/^\s+/gm, ""),
74. 					expectedCss.replace(/^\s+/gm, "")
75. 				);
76. 
77. 				if (fs.existsSync(`${dir}/_expected-head.html`)) {
78. 					fs.writeFileSync(`${dir}/_actual-head.html`, head);
79. 					assert.htmlEqual(
80. 						head,
81. 						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
82. 					);
83. 				}
84. 
85. 				if (show) showOutput(dir, { generate: 'ssr' });
86. 			} catch (err) {
87. 				showOutput(dir, { generate: 'ssr' });
88. 				throw err;
89. 			}
90. 		});
91. 	});
92. 
93. 	// duplicate client-side tests, as far as possible
94. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
95. 		if (dir[0] === ".") return;
96. 
97. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
98. 
99. 		if (config.solo && process.env.CI) {
100. 			throw new Error("Forgot to remove `solo: true` from test");
101. 		}
102. 
103. 		if (config["skip-ssr"]) return;
104. 
105. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
106. 			const cwd = path.resolve("test/runtime/samples", dir);
107. 
108. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
109. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
110. 				delete require.cache[resolved];
111. 			});
112. 
113. 			require("../../ssr/register")({
114. 				store: !!config.store
115. 			});
116. 
117. 			try {
118. 				const component = require(`../runtime/samples/${dir}/main.html`);
119. 				const { html } = component.render(config.data, {
120. 					store: (config.store !== true) && config.store
121. 				});
122. 
123. 				if (config.html) {
124. 					assert.htmlEqual(html, config.html);
125. 				}
126. 			} catch (err) {
127. 				showOutput(cwd, { generate: "ssr" });
128. 				throw err;
129. 			}
130. 		});
131. 	});
132. });


File: test/store/index.js
Line number range: 1 - 190
Content:
1. import fs from 'fs';
2. import assert from 'assert';
3. import MagicString from 'magic-string';
4. import { parse } from 'acorn';
5. import { Store } from '../../store.js';
6. 
7. describe('store', () => {
8. 	it('is written in ES5', () => {
9. 		const source = fs.readFileSync('store.js', 'utf-8');
10. 
11. 		const ast = parse(source, {
12. 			sourceType: 'module'
13. 		});
14. 
15. 		const magicString = new MagicString(source);
16. 		ast.body.forEach(node => {
17. 			if (/^(Im|Ex)port/.test(node.type)) magicString.remove(node.start, node.end);
18. 		});
19. 
20. 		parse(magicString.toString(), {
21. 			ecmaVersion: 5
22. 		});
23. 	});
24. 
25. 	describe('get', () => {
26. 		it('gets a specific key', () => {
27. 			const store = new Store({
28. 				foo: 'bar'
29. 			});
30. 
31. 			assert.equal(store.get('foo'), 'bar');
32. 		});
33. 
34. 		it('gets the entire state object', () => {
35. 			const store = new Store({
36. 				foo: 'bar'
37. 			});
38. 
39. 			assert.deepEqual(store.get(), { foo: 'bar' });
40. 		});
41. 	});
42. 
43. 	describe('set', () => {
44. 		it('sets state', () => {
45. 			const store = new Store();
46. 
47. 			store.set({
48. 				foo: 'bar'
49. 			});
50. 
51. 			assert.equal(store.get('foo'), 'bar');
52. 		});
53. 	});
54. 
55. 	describe('observe', () => {
56. 		it('observes state', () => {
57. 			let newFoo;
58. 			let oldFoo;
59. 
60. 			const store = new Store({
61. 				foo: 'bar'
62. 			});
63. 
64. 			store.observe('foo', (n, o) => {
65. 				newFoo = n;
66. 				oldFoo = o;
67. 			});
68. 
69. 			assert.equal(newFoo, 'bar');
70. 			assert.equal(oldFoo, undefined);
71. 
72. 			store.set({
73. 				foo: 'baz'
74. 			});
75. 
76. 			assert.equal(newFoo, 'baz');
77. 			assert.equal(oldFoo, 'bar');
78. 		});
79. 	});
80. 
81. 	describe('onchange', () => {
82. 		it('fires a callback when state changes', () => {
83. 			const store = new Store();
84. 
85. 			let count = 0;
86. 			let args;
87. 
88. 			store.onchange((state, changed) => {
89. 				count += 1;
90. 				args = { state, changed };
91. 			});
92. 
93. 			store.set({ foo: 'bar' });
94. 
95. 			assert.equal(count, 1);
96. 			assert.deepEqual(args, {
97. 				state: { foo: 'bar' },
98. 				changed: { foo: true }
99. 			});
100. 
101. 			// this should be a noop
102. 			store.set({ foo: 'bar' });
103. 			assert.equal(count, 1);
104. 
105. 			// this shouldn't
106. 			store.set({ foo: 'baz' });
107. 
108. 			assert.equal(count, 2);
109. 			assert.deepEqual(args, {
110. 				state: { foo: 'baz' },
111. 				changed: { foo: true }
112. 			});
113. 		});
114. 	});
115. 
116. 	describe('computed', () => {
117. 		it('computes a property based on data', () => {
118. 			const store = new Store({
119. 				foo: 1
120. 			});
121. 
122. 			store.compute('bar', ['foo'], foo => foo * 2);
123. 			assert.equal(store.get('bar'), 2);
124. 
125. 			const values = [];
126. 
127. 			store.observe('bar', bar => {
128. 				values.push(bar);
129. 			});
130. 
131. 			store.set({ foo: 2 });
132. 			assert.deepEqual(values, [2, 4]);
133. 		});
134. 
135. 		it('computes a property based on another computed property', () => {
136. 			const store = new Store({
137. 				foo: 1
138. 			});
139. 
140. 			store.compute('bar', ['foo'], foo => foo * 2);
141. 			store.compute('baz', ['bar'], bar => bar * 2);
142. 			assert.equal(store.get('baz'), 4);
143. 
144. 			const values = [];
145. 
146. 			store.observe('baz', baz => {
147. 				values.push(baz);
148. 			});
149. 
150. 			store.set({ foo: 2 });
151. 			assert.deepEqual(values, [4, 8]);
152. 		});
153. 
154. 		it('prevents computed properties from being set', () => {
155. 			const store = new Store({
156. 				foo: 1
157. 			});
158. 
159. 			store.compute('bar', ['foo'], foo => foo * 2);
160. 
161. 			assert.throws(() => {
162. 				store.set({ bar: 'whatever' });
163. 			}, /'bar' is a read-only property/);
164. 		});
165. 
166. 		it('allows multiple dependents to depend on the same computed property', () => {
167. 			const store = new Store({
168. 				a: 1
169. 			});
170. 
171. 			store.compute('b', ['a'], a => a * 2);
172. 			store.compute('c', ['b'], b => b * 3);
173. 			store.compute('d', ['b'], b => b * 4);
174. 
175. 			assert.deepEqual(store.get(), { a: 1, b: 2, c: 6, d: 8 });
176. 
177. 			// bit cheeky, testing a private property, but whatever
178. 			assert.equal(store._sortedComputedProperties.length, 3);
179. 		});
180. 
181. 		it('prevents cyclical dependencies', () => {
182. 			const store = new Store();
183. 
184. 			assert.throws(() => {
185. 				store.compute('a', ['b'], b => b + 1);
186. 				store.compute('b', ['a'], a => a + 1);
187. 			}, /Cyclical dependency detected/);
188. 		});
189. 	});
190. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 13:39:24,327 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The task requires compiling 5 complete, self-contained test cases demonstrating SSR with nested components and store usage, including exact imports, setup, assertions, file paths, and line numbers. While we have the core test harness files (helpers.js, runtime/index.js, server-side-rendering/index.js), we lack the actual sample test files’ contents (main.html, _config.js, nested component files, and expected outputs) from the relevant directories. These sample files are critical to extract and present the exact test cases with their implementations and line numbers. To avoid repeating the previous request, I will ask for a slightly different but still relevant set of SSR samples showcasing nested components and refs along with the store runtime samples.' query='Please provide the full contents (with exact line numbers) of test/runtime/samples/store-root, test/runtime/samples/store-binding, test/runtime/samples/store-computed, and test/server-side-rendering/samples/component and component-refs-and-attributes.' extra_requirements='If sharing everything is too large, include at minimum each directory’s main.html, _config.js, all nested component .html files, and any _expected.html/_expected.css files, with their line numbers.' purpose='I need these sample files to extract 5 relevant tests demonstrating SSR nested components and store usage and present them with precise imports, setup, assertions, and file paths/line numbers.'
2025-11-12 13:39:24,329 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents (with exact line numbers) of test/runtime/samples/store-root, test/runtime/samples/store-binding, test/runtime/samples/store-computed, and test/server-side-rendering/samples/component and component-refs-and-attributes.
2025-11-12 13:39:28,728 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 13:39:28,728 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 13:39:28,729 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 13:39:28,729 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 13:39:28,730 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 13:39:28,731 - thread-135845298308800.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 13:39:28,731 - thread-135845298308800.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents (with exact line numbers) of test/runtime/samples/store-root, test/runtime/samples/store-binding, test/runtime/samples/store-computed, and test/server-side-rendering/samples/component and component-refs-and-attributes.
Extra requirements: If sharing everything is too large, include at minimum each directory’s main.html, _config.js, all nested component .html files, and any _expected.html/_expected.css files, with their line numbers.
Purpose: I need these sample files to extract 5 relevant tests demonstrating SSR nested components and store usage and present them with precise imports, setup, assertions, and file paths/line numbers.
2025-11-12 13:39:49,261 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hBq2GUAPi2t3qNC9ufXnVHdE', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-root"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1698, 'prompt_tokens': 2241, 'total_tokens': 3939, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1664, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--dc1c5c23-3da6-44fc-b366-e540161de455-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/store-root'}, 'id': 'call_hBq2GUAPi2t3qNC9ufXnVHdE', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2241, 'output_tokens': 1698, 'total_tokens': 3939, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1664}}
2025-11-12 13:39:50,350 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_PSSmD5jag5zyGB3g8cv4flr1', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-root"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 2317, 'total_tokens': 2346, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d32c9504-c628-4ca6-934d-6966d91134d1-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-root'}, 'id': 'call_PSSmD5jag5zyGB3g8cv4flr1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2317, 'output_tokens': 29, 'total_tokens': 2346, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:07,162 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_PaI7K2COioDLw9IQkfDxo6hC', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-root/main.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1252, 'prompt_tokens': 2380, 'total_tokens': 3632, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1216, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--19eeeae4-c21f-4694-8262-4334b6aec3ab-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/store-root/main.html'}, 'id': 'call_PaI7K2COioDLw9IQkfDxo6hC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2380, 'output_tokens': 1252, 'total_tokens': 3632, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1216}}
2025-11-12 13:40:08,711 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_qiOBzCfFgpTADdmMvFayPzRU', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-root/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 2460, 'total_tokens': 2491, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--413bae80-4c97-4b8f-97f1-0254621350ae-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-root/main.html'}, 'id': 'call_qiOBzCfFgpTADdmMvFayPzRU', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2460, 'output_tokens': 31, 'total_tokens': 2491, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:19,687 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_YgTRxftgw9RYCW7ooLNZf90y', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-root/Nested.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 678, 'prompt_tokens': 2724, 'total_tokens': 3402, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2432}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--440a46d0-68b7-4c4c-8c0a-67691ef2ded6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-root/Nested.html'}, 'id': 'call_YgTRxftgw9RYCW7ooLNZf90y', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2724, 'output_tokens': 678, 'total_tokens': 3402, 'input_token_details': {'audio': 0, 'cache_read': 2432}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-12 13:40:20,827 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_kaYchEcePhGDLQGt2tx1wP9r', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-binding"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 2845, 'total_tokens': 2873, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--15185c07-de1c-4b14-96bc-6843d998afae-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/store-binding'}, 'id': 'call_kaYchEcePhGDLQGt2tx1wP9r', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2845, 'output_tokens': 28, 'total_tokens': 2873, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:21,982 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fyNL50zyzG9vmfZeyY9IPzp7', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-binding/main.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 2921, 'total_tokens': 2951, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--494b4e51-ff11-433a-8293-14ee72e96290-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/store-binding/main.html'}, 'id': 'call_fyNL50zyzG9vmfZeyY9IPzp7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2921, 'output_tokens': 30, 'total_tokens': 2951, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:23,416 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_dFSZJikXHTCAn11D66PwxFJP', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-binding/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 3001, 'total_tokens': 3032, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7c284384-92af-48e3-8159-0227ee7abe05-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-binding/main.html'}, 'id': 'call_dFSZJikXHTCAn11D66PwxFJP', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3001, 'output_tokens': 31, 'total_tokens': 3032, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:24,638 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_SDyTIZLCMrW1PswzcnEfZeRn', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-binding/NameInput.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 3186, 'total_tokens': 3219, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2944}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9d0637cd-3286-4ce6-8a24-362f9b592560-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-binding/NameInput.html'}, 'id': 'call_SDyTIZLCMrW1PswzcnEfZeRn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3186, 'output_tokens': 33, 'total_tokens': 3219, 'input_token_details': {'audio': 0, 'cache_read': 2944}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:26,516 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1nHCl3DyzoRd74ZrAZ82VHDB', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-computed"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 3302, 'total_tokens': 3331, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--24ff62e6-e046-4bf5-9d0b-b6d61b9f85bb-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/store-computed'}, 'id': 'call_1nHCl3DyzoRd74ZrAZ82VHDB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3302, 'output_tokens': 29, 'total_tokens': 3331, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:27,758 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_I0S5sF0SDNMN2aw0rY1SC0Jc', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-computed/main.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 3381, 'total_tokens': 3412, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3200}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5f6f0fcd-713f-4954-b38a-b2adc3f81d21-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/runtime/samples/store-computed/main.html'}, 'id': 'call_I0S5sF0SDNMN2aw0rY1SC0Jc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3381, 'output_tokens': 31, 'total_tokens': 3412, 'input_token_details': {'audio': 0, 'cache_read': 3200}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:29,339 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_iuVTKBhINCN6HkpGHnBtoZ6B', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-computed/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 3463, 'total_tokens': 3495, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--63385f17-5f62-4c2b-997c-b37ca4cdb0a6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-computed/main.html'}, 'id': 'call_iuVTKBhINCN6HkpGHnBtoZ6B', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3463, 'output_tokens': 32, 'total_tokens': 3495, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:30,774 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_bi4EPW9TNJP978DhU8rxp6ke', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-computed/Todo.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 3654, 'total_tokens': 3687, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3200}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--27dd96d9-dd67-42c8-b784-8d60f9fc0f8a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-computed/Todo.html'}, 'id': 'call_bi4EPW9TNJP978DhU8rxp6ke', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3654, 'output_tokens': 33, 'total_tokens': 3687, 'input_token_details': {'audio': 0, 'cache_read': 3200}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:31,922 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fnJFg36ONSPjFwn0j9kgheab', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 3933, 'total_tokens': 3963, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2816}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a0bfcb76-6fea-4447-87f7-946175454100-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/samples/component'}, 'id': 'call_fnJFg36ONSPjFwn0j9kgheab', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3933, 'output_tokens': 30, 'total_tokens': 3963, 'input_token_details': {'audio': 0, 'cache_read': 2816}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:33,308 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZAWYb3VlrWJYQ7GgGtj450hd', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component/main.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 4012, 'total_tokens': 4044, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3584}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2db73759-9c0a-48cc-91a6-ac6540f2576e-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/samples/component/main.html'}, 'id': 'call_ZAWYb3VlrWJYQ7GgGtj450hd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4012, 'output_tokens': 32, 'total_tokens': 4044, 'input_token_details': {'audio': 0, 'cache_read': 3584}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:34,608 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_M4ldEpdFwng2HnacEUbRfNuM', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 4096, 'total_tokens': 4129, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9cd6b44a-c9e8-45c2-be67-1a3b7556206d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component/main.html'}, 'id': 'call_M4ldEpdFwng2HnacEUbRfNuM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4096, 'output_tokens': 33, 'total_tokens': 4129, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:35,843 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_EevTk9qsBnZp2nH47uGzdiTn', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component/Widget.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 4281, 'total_tokens': 4315, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d9978011-2d90-4f92-999b-4032af2c507d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component/Widget.html'}, 'id': 'call_EevTk9qsBnZp2nH47uGzdiTn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4281, 'output_tokens': 34, 'total_tokens': 4315, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:37,105 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_EhuEDKlHv0nSjrSuYqb5CKLc', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 35, 'prompt_tokens': 4401, 'total_tokens': 4436, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4096}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0270a770-0399-4249-a969-d5fae9d8a0cd-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes'}, 'id': 'call_EhuEDKlHv0nSjrSuYqb5CKLc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4401, 'output_tokens': 35, 'total_tokens': 4436, 'input_token_details': {'audio': 0, 'cache_read': 4096}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:38,335 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_yFtAfeSN6aMrdPhgnwkc1zqV', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes/main.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 37, 'prompt_tokens': 4495, 'total_tokens': 4532, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4224}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--584702f5-f1a5-4ba1-8afc-1dc7fc717e85-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes/main.html'}, 'id': 'call_yFtAfeSN6aMrdPhgnwkc1zqV', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4495, 'output_tokens': 37, 'total_tokens': 4532, 'input_token_details': {'audio': 0, 'cache_read': 4224}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:39,584 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ffwW9ZKWcjvYwabmNxHeE90r', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes/main.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 4589, 'total_tokens': 4627, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4480}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--488a4d3e-1960-4fa4-b06b-e4d4aa80b71f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes/main.html'}, 'id': 'call_ffwW9ZKWcjvYwabmNxHeE90r', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4589, 'output_tokens': 38, 'total_tokens': 4627, 'input_token_details': {'audio': 0, 'cache_read': 4480}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:41,344 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Dbvuio7MCMqSuhuYkmxf9f89', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes/Widget.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 4817, 'total_tokens': 4856, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--554e9949-6657-40c2-9c64-8586c29a294e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes/Widget.html'}, 'id': 'call_Dbvuio7MCMqSuhuYkmxf9f89', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4817, 'output_tokens': 39, 'total_tokens': 4856, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:50,863 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_CJIYpmWeQ8QBMSPIJxXX1NTp', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-root/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 614, 'prompt_tokens': 4944, 'total_tokens': 5558, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2688}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5f1ba549-63ac-46b7-be2b-29b6f96a6d48-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-root/_config.js'}, 'id': 'call_CJIYpmWeQ8QBMSPIJxXX1NTp', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4944, 'output_tokens': 614, 'total_tokens': 5558, 'input_token_details': {'audio': 0, 'cache_read': 2688}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 13:40:52,531 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_k2TspiY4wTbqmGtijjiPhwcV', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-binding/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 5228, 'total_tokens': 5260, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ea99c541-693a-40ba-9a61-d357fcd8c8a8-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-binding/_config.js'}, 'id': 'call_k2TspiY4wTbqmGtijjiPhwcV', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5228, 'output_tokens': 32, 'total_tokens': 5260, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:40:53,872 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_vOYeFLBwCMa4qYdRdnlHlT68', 'function': {'arguments': '{"relative_path":"test/runtime/samples/store-computed/_config.js"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 33, 'prompt_tokens': 5592, 'total_tokens': 5625, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2e7ff947-f152-4bf6-8c6e-51a5fd4531a6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/runtime/samples/store-computed/_config.js'}, 'id': 'call_vOYeFLBwCMa4qYdRdnlHlT68', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5592, 'output_tokens': 33, 'total_tokens': 5625, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:41:01,816 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_m9KuCRHzFqX5OZpkLArcZ3Je', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component/_config.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 807, 'prompt_tokens': 6320, 'total_tokens': 7127, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9c8e3c80-a457-423b-bbfc-b875c3678ef8-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/samples/component/_config.js'}, 'id': 'call_m9KuCRHzFqX5OZpkLArcZ3Je', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6320, 'output_tokens': 807, 'total_tokens': 7127, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 13:41:09,457 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_p8mFUGvq7m5f4hm9J2zLVWFK', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component/_expected.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 679, 'prompt_tokens': 6379, 'total_tokens': 7058, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4352}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6a2b61b3-55b9-4757-8c12-7e427d24c32d-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/samples/component/_expected.html'}, 'id': 'call_p8mFUGvq7m5f4hm9J2zLVWFK', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6379, 'output_tokens': 679, 'total_tokens': 7058, 'input_token_details': {'audio': 0, 'cache_read': 4352}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-12 13:41:10,896 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_7GzGJUOo322Fw3z1zzSw2ocO', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component/_expected.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 6465, 'total_tokens': 6499, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6272}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7ff60588-b267-4800-a68b-62213aa1b04e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component/_expected.html'}, 'id': 'call_7GzGJUOo322Fw3z1zzSw2ocO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6465, 'output_tokens': 34, 'total_tokens': 6499, 'input_token_details': {'audio': 0, 'cache_read': 6272}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:41:13,389 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_mGUvq1uY2gv1o4D0wgsRDuTE', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes/_expected.html"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 38, 'prompt_tokens': 6589, 'total_tokens': 6627, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4864}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b6cf66d8-610e-4ed5-b4ff-901f6ff4bfcd-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes/_expected.html'}, 'id': 'call_mGUvq1uY2gv1o4D0wgsRDuTE', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6589, 'output_tokens': 38, 'total_tokens': 6627, 'input_token_details': {'audio': 0, 'cache_read': 4864}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:41:14,782 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ATiyZcrfD87ZdbY3GsVZUE2V', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes/_expected.html"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 6685, 'total_tokens': 6724, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--abbcbc61-8bc8-43f9-8976-2b8bdc9f4d74-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes/_expected.html'}, 'id': 'call_ATiyZcrfD87ZdbY3GsVZUE2V', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6685, 'output_tokens': 39, 'total_tokens': 6724, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:41:33,752 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_AYgZ2g49UVrfWs2tgn6rwaUP', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component/_expected.css"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1127, 'prompt_tokens': 6816, 'total_tokens': 7943, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1088, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6656}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--99054bae-f569-45e2-bd38-55b8923e1a3a-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/samples/component/_expected.css'}, 'id': 'call_AYgZ2g49UVrfWs2tgn6rwaUP', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6816, 'output_tokens': 1127, 'total_tokens': 7943, 'input_token_details': {'audio': 0, 'cache_read': 6656}, 'output_token_details': {'audio': 0, 'reasoning': 1088}}
2025-11-12 13:41:45,570 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_KnzkosUw18864d1gahV8Uiey', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes/_expected.css"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 876, 'prompt_tokens': 6875, 'total_tokens': 7751, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4608}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ecbc8a84-4f85-4ec7-94f8-47c4ef77f3ea-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes/_expected.css'}, 'id': 'call_KnzkosUw18864d1gahV8Uiey', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6875, 'output_tokens': 876, 'total_tokens': 7751, 'input_token_details': {'audio': 0, 'cache_read': 4608}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 13:42:09,177 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_85vVsNhaMEx4nFTWTsWHH5ey', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/component-refs-and-attributes/_config.js"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1644, 'prompt_tokens': 6939, 'total_tokens': 8583, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1600, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4736}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6ec3c02c-6087-4de2-b65b-3490f2a073fa-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'test/server-side-rendering/samples/component-refs-and-attributes/_config.js'}, 'id': 'call_85vVsNhaMEx4nFTWTsWHH5ey', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6939, 'output_tokens': 1644, 'total_tokens': 8583, 'input_token_details': {'audio': 0, 'cache_read': 4736}, 'output_token_details': {'audio': 0, 'reasoning': 1600}}
2025-11-12 13:42:23,265 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located each requested sample directory and read the pertinent files with line-numbered content: main.html, nested component .html files, and _config.js for the runtime samples (store-root, store-binding, store-computed). For the SSR samples (component and component-refs-and-attributes), I read main.html, Widget.html, and their _expected.html files; no _config.js or _expected.css files were present. The outputs include precise imports, setup, and assertions where applicable (in the _config.js files) along with exact paths and line numbers. This should give you five relevant tests demonstrating SSR nested components and store usage.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1483, 'prompt_tokens': 7003, 'total_tokens': 8486, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2944}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--6c5535a6-3005-4cd0-805e-cc923e922cce-0' usage_metadata={'input_tokens': 7003, 'output_tokens': 1483, 'total_tokens': 8486, 'input_token_details': {'audio': 0, 'cache_read': 2944}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-12 13:42:23,269 - thread-135845298308800.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents (with exact line numbers) of test/runtime/samples/store-root, test/runtime/samples/store-binding, test/runtime/samples/store-computed, and test/server-side-rendering/samples/component and component-refs-and-attributes.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sharing everything is too large, include at minimum each directory’s main.html, _config.js, all nested component .html files, and any _expected.html/_expected.css files, with their line numbers.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
I need these sample files to extract 5 relevant tests demonstrating SSR nested components and store usage and present them with precise imports, setup, assertions, and file paths/line numbers.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: test/runtime/samples/store-binding/NameInput.html
Line number range: 1 - 1
Content:
1. <input bind:value=$name>


File: test/runtime/samples/store-binding/_config.js
Line number range: 1 - 28
Content:
1. import { Store } from '../../../../store.js';
2. 
3. const store = new Store({
4. 	name: 'world'
5. });
6. 
7. export default {
8. 	store,
9. 
10. 	html: `
11. 		<h1>Hello world!</h1>
12. 		<input>
13. 	`,
14. 
15. 	test(assert, component, target, window) {
16. 		const input = target.querySelector('input');
17. 		const event = new window.Event('input');
18. 
19. 		input.value = 'everybody';
20. 		input.dispatchEvent(event);
21. 
22. 		assert.equal(store.get('name'), 'everybody');
23. 		assert.htmlEqual(target.innerHTML, `
24. 			<h1>Hello everybody!</h1>
25. 			<input>
26. 		`);
27. 	}
28. };


File: test/runtime/samples/store-binding/main.html
Line number range: 1 - 10
Content:
1. <h1>Hello {{$name}}!</h1>
2. <NameInput/>
3. 
4. <script>
5. 	import NameInput from './NameInput.html';
6. 
7. 	export default {
8. 		components: { NameInput }
9. 	};
10. </script>


File: test/runtime/samples/store-computed/Todo.html
Line number range: 1 - 15
Content:
1. {{#if isVisible}}
2. 	<div class='{{todo.done ? "done": "pending"}}'>{{todo.description}}</div>
3. {{/if}}
4. 
5. <script>
6. 	export default {
7. 		computed: {
8. 			isVisible: ($filter, todo) => {
9. 				if ($filter === 'all') return true;
10. 				if ($filter === 'done') return todo.done;
11. 				if ($filter === 'pending') return !todo.done;
12. 			}
13. 		}
14. 	};
15. </script>


File: test/runtime/samples/store-computed/_config.js
Line number range: 1 - 63
Content:
1. import { Store } from '../../../../store.js';
2. 
3. class MyStore extends Store {
4. 	setFilter(filter) {
5. 		this.set({ filter });
6. 	}
7. 
8. 	toggleTodo(todo) {
9. 		todo.done = !todo.done;
10. 		this.set({ todos: this.get('todos') });
11. 	}
12. }
13. 
14. const todos = [
15. 	{
16. 		description: 'Buy some milk',
17. 		done: true,
18. 	},
19. 	{
20. 		description: 'Do the laundry',
21. 		done: true,
22. 	},
23. 	{
24. 		description: "Find life's true purpose",
25. 		done: false,
26. 	}
27. ];
28. 
29. const store = new MyStore({
30. 	filter: 'all',
31. 	todos
32. });
33. 
34. export default {
35. 	store,
36. 
37. 	html: `
38. 		<div class='done'>Buy some milk</div>
39. 		<div class='done'>Do the laundry</div>
40. 		<div class='pending'>Find life's true purpose</div>
41. 	`,
42. 
43. 	test(assert, component, target) {
44. 		store.setFilter('pending');
45. 
46. 		assert.htmlEqual(target.innerHTML, `
47. 			<div class='pending'>Find life's true purpose</div>
48. 		`);
49. 
50. 		store.toggleTodo(todos[1]);
51. 
52. 		assert.htmlEqual(target.innerHTML, `
53. 			<div class='pending'>Do the laundry</div>
54. 			<div class='pending'>Find life's true purpose</div>
55. 		`);
56. 
57. 		store.setFilter('done');
58. 
59. 		assert.htmlEqual(target.innerHTML, `
60. 			<div class='done'>Buy some milk</div>
61. 		`);
62. 	}
63. };


File: test/runtime/samples/store-computed/main.html
Line number range: 1 - 11
Content:
1. {{#each $todos as todo}}
2. 	<Todo :todo/>
3. {{/each}}
4. 
5. <script>
6. 	import Todo from './Todo.html';
7. 
8. 	export default {
9. 		components: { Todo }
10. 	};
11. </script>


File: test/runtime/samples/store-root/Nested.html
Line number range: 1 - 1
Content:
1. <p>It's nice to see you, {{$name}}.</p>


File: test/runtime/samples/store-root/_config.js
Line number range: 1 - 17
Content:
1. export default {
2. 	store: true, // TODO remove this in v2
3. 
4. 	html: `
5. 		<h1>Hello world!</h1>
6. 		<p>It's nice to see you, world.</p>
7. 	`,
8. 
9. 	test(assert, component, target) {
10. 		component.store.set({ name: 'everybody' });
11. 
12. 		assert.htmlEqual(target.innerHTML, `
13. 			<h1>Hello everybody!</h1>
14. 			<p>It's nice to see you, everybody.</p>
15. 		`);
16. 	}
17. };


File: test/runtime/samples/store-root/main.html
Line number range: 1 - 19
Content:
1. <h1>Hello {{$name}}!</h1>
2. <Nested/>
3. 
4. <script>
5. 	import { Store } from '../../../../store.js';
6. 	import Nested from './Nested.html';
7. 
8. 	export default {
9. 		store () {
10. 			return new Store({
11. 				name: 'world'
12. 			});
13. 		},
14. 
15. 		components: {
16. 			Nested
17. 		}
18. 	};
19. </script>


File: test/server-side-rendering/samples/component-refs-and-attributes/Widget.html
Line number range: 1 - 1
Content:
1. <p>{{foo}}</p>


File: test/server-side-rendering/samples/component-refs-and-attributes/_expected.html
Line number range: 1 - 1
Content:
1. <div><p>42</p></div>


File: test/server-side-rendering/samples/component-refs-and-attributes/main.html
Line number range: 1 - 13
Content:
1. <div><Widget ref:widget foo='{{foo}}'/></div>
2. 
3. <script>
4. 	import Widget from './Widget.html';
5. 
6. 	export default {
7. 		components: { Widget },
8. 
9. 		data () {
10. 			return { foo: 42 }
11. 		}
12. 	};
13. </script>


File: test/server-side-rendering/samples/component/Widget.html
Line number range: 1 - 1
Content:
1. <p>i am a widget</p>


File: test/server-side-rendering/samples/component/_expected.html
Line number range: 1 - 1
Content:
1. <div><p>i am a widget</p></div>


File: test/server-side-rendering/samples/component/main.html
Line number range: 1 - 11
Content:
1. <div>
2. 	<Widget/>
3. </div>
4. 
5. <script>
6. 	import Widget from './Widget.html';
7. 
8. 	export default {
9. 		components: { Widget }
10. 	};
11. </script>

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 13:42:44,210 - thread-135845298308800.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The query requests full contents of store-binding sample files with line numbers. This file defines the store setup, initial HTML, and test assertions for binding, which directly matches the requested directory and is essential to understand imports, setup, and assertions.', relative_path='test/runtime/samples/store-binding/_config.js', start_line=1, end_line=28), ContextOutput(reasoning='The query requests full contents of store-binding sample files. This is the main component demonstrating binding and includes the import of the nested component, satisfying the request for main.html with line numbers.', relative_path='test/runtime/samples/store-binding/main.html', start_line=1, end_line=10), ContextOutput(reasoning='The query requests all nested component .html files within store-binding. NameInput.html is the nested component used by main.html and shows the bind directive; including its full single line fulfills the requirement.', relative_path='test/runtime/samples/store-binding/NameInput.html', start_line=1, end_line=1), ContextOutput(reasoning='The query requests full contents of store-computed sample files. This file sets up a custom Store, initial data, expected HTML, and test assertions, directly addressing the store usage and computed visibility logic.', relative_path='test/runtime/samples/store-computed/_config.js', start_line=1, end_line=63), ContextOutput(reasoning='The query requests main.html for store-computed. This file contains the main component with import of Todo and iteration over $todos, necessary to understand component composition and store usage.', relative_path='test/runtime/samples/store-computed/main.html', start_line=1, end_line=11), ContextOutput(reasoning='The query asks for all nested component .html files within store-computed. Todo.html is the nested component using computed properties dependent on the store, essential to the sample.', relative_path='test/runtime/samples/store-computed/Todo.html', start_line=1, end_line=15), ContextOutput(reasoning='The query requests full contents of store-root sample files. This config file specifies that a store is used and contains the test assertions, which are critical for understanding setup and behavior.', relative_path='test/runtime/samples/store-root/_config.js', start_line=1, end_line=17), ContextOutput(reasoning='The query requests main.html for store-root. This file defines the store creation, imports Nested, and renders based on $name, satisfying the requirement with imports and setup.', relative_path='test/runtime/samples/store-root/main.html', start_line=1, end_line=19), ContextOutput(reasoning='The query requests all nested component .html files for store-root. Nested.html shows consumption of the store value in a nested component; including its single line fulfills the requirement.', relative_path='test/runtime/samples/store-root/Nested.html', start_line=1, end_line=1), ContextOutput(reasoning='The query requests SSR sample component files including expected outputs. This expected HTML is required to show SSR output and line numbers.', relative_path='test/server-side-rendering/samples/component/_expected.html', start_line=1, end_line=1), ContextOutput(reasoning='The query requests SSR sample component main.html with exact line numbers. This file imports Widget and renders it, essential for understanding SSR setup.', relative_path='test/server-side-rendering/samples/component/main.html', start_line=1, end_line=11), ContextOutput(reasoning='The query requests all nested component .html files in the SSR component sample. Widget.html is the nested component content used in SSR, included in full.', relative_path='test/server-side-rendering/samples/component/Widget.html', start_line=1, end_line=1), ContextOutput(reasoning='The query requests SSR sample component-refs-and-attributes files including expected outputs. This expected HTML shows SSR rendering result, necessary for assertions.', relative_path='test/server-side-rendering/samples/component-refs-and-attributes/_expected.html', start_line=1, end_line=1), ContextOutput(reasoning='The query requests main.html for component-refs-and-attributes with precise imports and setup. This file demonstrates refs and attribute binding with data(), meeting the requirement.', relative_path='test/server-side-rendering/samples/component-refs-and-attributes/main.html', start_line=1, end_line=13), ContextOutput(reasoning='The query requests nested component .html files for component-refs-and-attributes. Widget.html shows rendering of the passed attribute, necessary to understand SSR behavior.', relative_path='test/server-side-rendering/samples/component-refs-and-attributes/Widget.html', start_line=1, end_line=1)]
2025-11-12 13:42:44,214 - thread-135845298308800.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 15 contexts to memory for query: Please provide the full contents (with exact line numbers) of test/runtime/samples/store-root, test/runtime/samples/store-binding, test/runtime/samples/store-computed, and test/server-side-rendering/samples/component and component-refs-and-attributes.
2025-11-12 13:42:48,680 - thread-135845298308800.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 13:42:48,682 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 15 new contexts to 4 existing contexts
2025-11-12 13:42:48,682 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 19 total contexts (removed 0 duplicates)
2025-11-12 13:42:48,684 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of test/server-side-rendering/index.js, test/runtime/index.js, test/helpers.js, and all files in test/runtime/samples/{store-root,store-binding,store-computed} and test/server-side-rendering/samples/{component,component-data-dynamic}.
Extra Requirements: If sending everything is too large, at minimum include the test definitions invoking these samples and helper functions they use, plus each sample’s main.html, _config.js, expected files, with their exact line numbers.
Purpose: I need these files to extract 5 relevant existing tests demonstrating SSR with nested components and store usage, and present them with exact imports, setup, assertions, and line numbers.

Previous refined query 2:
Essential Query: Please provide the full contents (with exact line numbers) of test/runtime/samples/store-root, test/runtime/samples/store-binding, test/runtime/samples/store-computed, and test/server-side-rendering/samples/component and component-refs-and-attributes.
Extra Requirements: If sharing everything is too large, include at minimum each directory’s main.html, _config.js, all nested component .html files, and any _expected.html/_expected.css files, with their line numbers.
Purpose: I need these sample files to extract 5 relevant tests demonstrating SSR nested components and store usage and present them with precise imports, setup, assertions, and file paths/line numbers.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: test/helpers.js
Line number range: 1 - 243
Content:
1. import { JSDOM } from 'jsdom';
2. import assert from 'assert';
3. import glob from 'glob';
4. import fs from 'fs';
5. import path from 'path';
6. import chalk from 'chalk';
7. 
8. // for coverage purposes, we need to test source files,
9. // but for sanity purposes, we need to test dist files
10. export function loadSvelte(test) {
11. 	process.env.TEST = test ? 'true' : '';
12. 
13. 	const resolved = require.resolve('../compiler/svelte.js');
14. 
15. 	delete require.cache[resolved];
16. 	return require(resolved);
17. }
18. 
19. export const svelte = loadSvelte();
20. 
21. export function exists(path) {
22. 	try {
23. 		fs.statSync(path);
24. 		return true;
25. 	} catch (err) {
26. 		return false;
27. 	}
28. }
29. 
30. export function tryToLoadJson(file) {
31. 	try {
32. 		return JSON.parse(fs.readFileSync(file));
33. 	} catch (err) {
34. 		if (err.code !== 'ENOENT') throw err;
35. 		return null;
36. 	}
37. }
38. 
39. export function tryToReadFile(file) {
40. 	try {
41. 		return fs.readFileSync(file, 'utf-8');
42. 	} catch (err) {
43. 		if (err.code !== 'ENOENT') throw err;
44. 		return null;
45. 	}
46. }
47. 
48. const { window } = new JSDOM('<main></main>');
49. global.document = window.document;
50. 
51. export function env() {
52. 	window._svelteTransitionManager = null;
53. 	window.document.body.innerHTML = '<main></main>';
54. 
55. 	return window;
56. }
57. 
58. function cleanChildren(node) {
59. 	let previous = null;
60. 
61. 	// sort attributes
62. 	const attributes = Array.from(node.attributes).sort((a, b) => {
63. 		return a.name < b.name ? -1 : 1;
64. 	});
65. 
66. 	attributes.forEach(attr => {
67. 		node.removeAttribute(attr.name);
68. 	});
69. 
70. 	attributes.forEach(attr => {
71. 		node.setAttribute(attr.name, attr.value);
72. 	});
73. 
74. 	// recurse
75. 	[...node.childNodes].forEach(child => {
76. 		if (child.nodeType === 3) {
77. 			// text
78. 			if (
79. 				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
80. 				node.tagName !== 'text' &&
81. 				node.tagName !== 'tspan'
82. 			) {
83. 				node.removeChild(child);
84. 			}
85. 
86. 			child.data = child.data.replace(/\s{2,}/g, '\n');
87. 
88. 			if (previous && previous.nodeType === 3) {
89. 				previous.data += child.data;
90. 				previous.data = previous.data.replace(/\s{2,}/g, '\n');
91. 
92. 				node.removeChild(child);
93. 				child = previous;
94. 			}
95. 		} else {
96. 			cleanChildren(child);
97. 		}
98. 
99. 		previous = child;
100. 	});
101. 
102. 	// collapse whitespace
103. 	if (node.firstChild && node.firstChild.nodeType === 3) {
104. 		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
105. 		if (!node.firstChild.data) node.removeChild(node.firstChild);
106. 	}
107. 
108. 	if (node.lastChild && node.lastChild.nodeType === 3) {
109. 		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
110. 		if (!node.lastChild.data) node.removeChild(node.lastChild);
111. 	}
112. }
113. 
114. export function normalizeHtml(window, html) {
115. 	try {
116. 		const node = window.document.createElement('div');
117. 		node.innerHTML = html
118. 			.replace(/<!--.*?-->/g, '')
119. 			.replace(/>[\s\r\n]+</g, '><')
120. 			.trim();
121. 		cleanChildren(node, '');
122. 		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
123. 	} catch (err) {
124. 		throw new Error(`Failed to normalize HTML:\n${html}`);
125. 	}
126. }
127. 
128. export function setupHtmlEqual() {
129. 	const window = env();
130. 
131. 	assert.htmlEqual = (actual, expected, message) => {
132. 		assert.deepEqual(
133. 			normalizeHtml(window, actual),
134. 			normalizeHtml(window, expected),
135. 			message
136. 		);
137. 	};
138. }
139. 
140. export function loadConfig(file) {
141. 	try {
142. 		const resolved = require.resolve(file);
143. 		delete require.cache[resolved];
144. 
145. 		const config = require(resolved);
146. 		return config.default || config;
147. 	} catch (err) {
148. 		if (err.code === 'MODULE_NOT_FOUND') {
149. 			return {};
150. 		}
151. 
152. 		throw err;
153. 	}
154. }
155. 
156. export function addLineNumbers(code) {
157. 	return code
158. 		.split('\n')
159. 		.map((line, i) => {
160. 			i = String(i + 1);
161. 			while (i.length < 3) i = ` ${i}`;
162. 
163. 			return (
164. 				chalk.grey(`  ${i}: `) +
165. 				line.replace(/^\t+/, match => match.split('\t').join('    '))
166. 			);
167. 		})
168. 		.join('\n');
169. }
170. 
171. function capitalise(str) {
172. 	return str[0].toUpperCase() + str.slice(1);
173. }
174. 
175. export function showOutput(cwd, options = {}, s = svelte) {
176. 	glob.sync('**/*.html', { cwd }).forEach(file => {
177. 		if (file[0] === '_') return;
178. 
179. 		const name = path.basename(file)
180. 			.slice(0, -path.extname(file).length)
181. 			.replace(/^\d/, '_$&')
182. 			.replace(/[^a-zA-Z0-9_$]/g, '');
183. 
184. 		const { code } = s.compile(
185. 			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
186. 			Object.assign(options, {
187. 				filename: file,
188. 				name: capitalise(name)
189. 			})
190. 		);
191. 
192. 		console.log( // eslint-disable-line no-console
193. 			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
194. 		);
195. 	});
196. }
197. 
198. const start = /\n(\t+)/;
199. export function deindent(strings, ...values) {
200. 	const indentation = start.exec(strings[0])[1];
201. 	const pattern = new RegExp(`^${indentation}`, 'gm');
202. 
203. 	let result = strings[0].replace(start, '').replace(pattern, '');
204. 
205. 	let trailingIndentation = getTrailingIndentation(result);
206. 
207. 	for (let i = 1; i < strings.length; i += 1) {
208. 		let expression = values[i - 1];
209. 		const string = strings[i].replace(pattern, '');
210. 
211. 		if (Array.isArray(expression)) {
212. 			expression = expression.length ? expression.join('\n') : null;
213. 		}
214. 
215. 		if (expression || expression === '') {
216. 			const value = String(expression).replace(
217. 				/\n/g,
218. 				`\n${trailingIndentation}`
219. 			);
220. 			result += value + string;
221. 		} else {
222. 			let c = result.length;
223. 			while (/\s/.test(result[c - 1])) c -= 1;
224. 			result = result.slice(0, c) + string;
225. 		}
226. 
227. 		trailingIndentation = getTrailingIndentation(result);
228. 	}
229. 
230. 	return result.trim().replace(/\t+$/gm, '');
231. }
232. 
233. function getTrailingIndentation(str) {
234. 	let i = str.length;
235. 	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
236. 	return str.slice(i, str.length);
237. }
238. 
239. export function spaces(i) {
240. 	let result = '';
241. 	while (i--) result += ' ';
242. 	return result;
243. }


File: test/runtime/index.js
Line number range: 1 - 251
Content:
1. import assert from "assert";
2. import chalk from 'chalk';
3. import * as path from "path";
4. import * as fs from "fs";
5. import * as acorn from "acorn";
6. import { transitionManager } from "../../shared.js";
7. 
8. import {
9. 	showOutput,
10. 	loadConfig,
11. 	loadSvelte,
12. 	env,
13. 	setupHtmlEqual,
14. 	spaces
15. } from "../helpers.js";
16. 
17. let svelte;
18. 
19. let compileOptions = null;
20. 
21. function getName(filename) {
22. 	const base = path.basename(filename).replace(".html", "");
23. 	return base[0].toUpperCase() + base.slice(1);
24. }
25. 
26. describe("runtime", () => {
27. 	before(() => {
28. 		svelte = loadSvelte(true);
29. 
30. 		require.extensions[".html"] = function(module, filename) {
31. 			const options = Object.assign(
32. 				{ filename, name: getName(filename), format: 'cjs' },
33. 				compileOptions
34. 			);
35. 
36. 			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);
37. 
38. 			return module._compile(code, filename);
39. 		};
40. 
41. 		return setupHtmlEqual();
42. 	});
43. 
44. 	const failed = new Set();
45. 
46. 	function runTest(dir, shared, hydrate) {
47. 		if (dir[0] === ".") return;
48. 
49. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
50. 
51. 		if (config.solo && process.env.CI) {
52. 			throw new Error("Forgot to remove `solo: true` from test");
53. 		}
54. 
55. 		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers${hydrate ? ' , hydration' : ''})`, () => {
56. 			if (failed.has(dir)) {
57. 				// this makes debugging easier, by only printing compiled output once
58. 				throw new Error('skipping test, already failed');
59. 			}
60. 
61. 			const cwd = path.resolve(`test/runtime/samples/${dir}`);
62. 			global.document.title = '';
63. 
64. 			compileOptions = config.compileOptions || {};
65. 			compileOptions.shared = shared;
66. 			compileOptions.hydratable = hydrate;
67. 			compileOptions.dev = config.dev;
68. 			compileOptions.store = !!config.store;
69. 
70. 			// check that no ES2015+ syntax slipped in
71. 			if (!config.allowES2015) {
72. 				try {
73. 					const source = fs.readFileSync(
74. 						`test/runtime/samples/${dir}/main.html`,
75. 						"utf-8"
76. 					);
77. 					const { code } = svelte.compile(source, compileOptions);
78. 					const startIndex = code.indexOf("function create_main_fragment"); // may change!
79. 					if (startIndex === -1) throw new Error("missing create_main_fragment");
80. 					const endIndex = code.lastIndexOf("export default");
81. 					const es5 =
82. 						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
83. 						code.slice(startIndex, endIndex);
84. 
85. 					acorn.parse(es5, { ecmaVersion: 5 });
86. 
87. 					if (/Object\.assign/.test(es5)) {
88. 						throw new Error(
89. 							"cannot use Object.assign in generated code, as it is not supported everywhere"
90. 						);
91. 					}
92. 				} catch (err) {
93. 					failed.add(dir);
94. 					if (err.frame) {
95. 						console.error(chalk.red(err.frame)); // eslint-disable-line no-console
96. 					}
97. 					showOutput(cwd, { shared, format: 'cjs', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
98. 					throw err;
99. 				}
100. 			}
101. 
102. 			Object.keys(require.cache)
103. 				.filter(x => x.endsWith(".html"))
104. 				.forEach(file => {
105. 					delete require.cache[file];
106. 				});
107. 
108. 			let SvelteComponent;
109. 
110. 			let unintendedError = null;
111. 
112. 			const window = env();
113. 
114. 			return Promise.resolve()
115. 				.then(() => {
116. 					// set of hacks to support transition tests
117. 					transitionManager.running = false;
118. 					transitionManager.transitions = [];
119. 
120. 					const raf = {
121. 						time: 0,
122. 						callback: null,
123. 						tick: now => {
124. 							raf.time = now;
125. 							if (raf.callback) raf.callback();
126. 						}
127. 					};
128. 					window.performance = { now: () => raf.time };
129. 					global.requestAnimationFrame = cb => {
130. 						let called = false;
131. 						raf.callback = () => {
132. 							if (!called) {
133. 								called = true;
134. 								cb();
135. 							}
136. 						};
137. 					};
138. 
139. 					try {
140. 						SvelteComponent = require(`./samples/${dir}/main.html`);
141. 					} catch (err) {
142. 						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
143. 						throw err;
144. 					}
145. 
146. 					global.window = window;
147. 
148. 					// Put the constructor on window for testing
149. 					window.SvelteComponent = SvelteComponent;
150. 
151. 					const target = window.document.querySelector("main");
152. 
153. 					const warnings = [];
154. 					const warn = console.warn;
155. 					console.warn = warning => {
156. 						warnings.push(warning);
157. 					};
158. 
159. 					const options = Object.assign({}, {
160. 						target,
161. 						hydrate,
162. 						data: config.data,
163. 						store: (config.store !== true && config.store)
164. 					}, config.options || {});
165. 
166. 					const component = new SvelteComponent(options);
167. 
168. 					console.warn = warn;
169. 
170. 					if (config.error) {
171. 						unintendedError = true;
172. 						throw new Error("Expected a runtime error");
173. 					}
174. 
175. 					if (config.warnings) {
176. 						assert.deepEqual(warnings, config.warnings);
177. 					} else if (warnings.length) {
178. 						unintendedError = true;
179. 						throw new Error("Received unexpected warnings");
180. 					}
181. 
182. 					if (config.html) {
183. 						assert.htmlEqual(target.innerHTML, config.html);
184. 					}
185. 
186. 					if (config.test) {
187. 						return Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {
188. 							component.destroy();
189. 						});
190. 					} else {
191. 						component.destroy();
192. 						assert.equal(target.innerHTML, "");
193. 					}
194. 				})
195. 				.catch(err => {
196. 					if (config.error && !unintendedError) {
197. 						config.error(assert, err);
198. 					} else {
199. 						failed.add(dir);
200. 						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
201. 						throw err;
202. 					}
203. 				})
204. 				.then(() => {
205. 					if (config.show) showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte);
206. 				});
207. 		});
208. 	}
209. 
210. 	const shared = path.resolve("shared.js");
211. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
212. 		runTest(dir, shared, false);
213. 		runTest(dir, shared, true);
214. 		runTest(dir, null, false);
215. 	});
216. 
217. 	it("fails if options.target is missing in dev mode", () => {
218. 		const { code } = svelte.compile(`<div></div>`, {
219. 			format: "iife",
220. 			name: "SvelteComponent",
221. 			dev: true
222. 		});
223. 
224. 		const SvelteComponent = eval(
225. 			`(function () { ${code}; return SvelteComponent; }())`
226. 		);
227. 
228. 		assert.throws(() => {
229. 			new SvelteComponent();
230. 		}, /'target' is a required option/);
231. 	});
232. 
233. 	it("fails if options.hydrate is true but the component is non-hydratable", () => {
234. 		const { code } = svelte.compile(`<div></div>`, {
235. 			format: "iife",
236. 			name: "SvelteComponent",
237. 			dev: true
238. 		});
239. 
240. 		const SvelteComponent = eval(
241. 			`(function () { ${code}; return SvelteComponent; }())`
242. 		);
243. 
244. 		assert.throws(() => {
245. 			new SvelteComponent({
246. 				target: {},
247. 				hydrate: true
248. 			});
249. 		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
250. 	});
251. });


File: test/runtime/samples/store-binding/NameInput.html
Line number range: 1 - 1
Content:
1. <input bind:value=$name>


File: test/runtime/samples/store-binding/_config.js
Line number range: 1 - 28
Content:
1. import { Store } from '../../../../store.js';
2. 
3. const store = new Store({
4. 	name: 'world'
5. });
6. 
7. export default {
8. 	store,
9. 
10. 	html: `
11. 		<h1>Hello world!</h1>
12. 		<input>
13. 	`,
14. 
15. 	test(assert, component, target, window) {
16. 		const input = target.querySelector('input');
17. 		const event = new window.Event('input');
18. 
19. 		input.value = 'everybody';
20. 		input.dispatchEvent(event);
21. 
22. 		assert.equal(store.get('name'), 'everybody');
23. 		assert.htmlEqual(target.innerHTML, `
24. 			<h1>Hello everybody!</h1>
25. 			<input>
26. 		`);
27. 	}
28. };


File: test/runtime/samples/store-binding/main.html
Line number range: 1 - 10
Content:
1. <h1>Hello {{$name}}!</h1>
2. <NameInput/>
3. 
4. <script>
5. 	import NameInput from './NameInput.html';
6. 
7. 	export default {
8. 		components: { NameInput }
9. 	};
10. </script>


File: test/runtime/samples/store-computed/Todo.html
Line number range: 1 - 15
Content:
1. {{#if isVisible}}
2. 	<div class='{{todo.done ? "done": "pending"}}'>{{todo.description}}</div>
3. {{/if}}
4. 
5. <script>
6. 	export default {
7. 		computed: {
8. 			isVisible: ($filter, todo) => {
9. 				if ($filter === 'all') return true;
10. 				if ($filter === 'done') return todo.done;
11. 				if ($filter === 'pending') return !todo.done;
12. 			}
13. 		}
14. 	};
15. </script>


File: test/runtime/samples/store-computed/_config.js
Line number range: 1 - 63
Content:
1. import { Store } from '../../../../store.js';
2. 
3. class MyStore extends Store {
4. 	setFilter(filter) {
5. 		this.set({ filter });
6. 	}
7. 
8. 	toggleTodo(todo) {
9. 		todo.done = !todo.done;
10. 		this.set({ todos: this.get('todos') });
11. 	}
12. }
13. 
14. const todos = [
15. 	{
16. 		description: 'Buy some milk',
17. 		done: true,
18. 	},
19. 	{
20. 		description: 'Do the laundry',
21. 		done: true,
22. 	},
23. 	{
24. 		description: "Find life's true purpose",
25. 		done: false,
26. 	}
27. ];
28. 
29. const store = new MyStore({
30. 	filter: 'all',
31. 	todos
32. });
33. 
34. export default {
35. 	store,
36. 
37. 	html: `
38. 		<div class='done'>Buy some milk</div>
39. 		<div class='done'>Do the laundry</div>
40. 		<div class='pending'>Find life's true purpose</div>
41. 	`,
42. 
43. 	test(assert, component, target) {
44. 		store.setFilter('pending');
45. 
46. 		assert.htmlEqual(target.innerHTML, `
47. 			<div class='pending'>Find life's true purpose</div>
48. 		`);
49. 
50. 		store.toggleTodo(todos[1]);
51. 
52. 		assert.htmlEqual(target.innerHTML, `
53. 			<div class='pending'>Do the laundry</div>
54. 			<div class='pending'>Find life's true purpose</div>
55. 		`);
56. 
57. 		store.setFilter('done');
58. 
59. 		assert.htmlEqual(target.innerHTML, `
60. 			<div class='done'>Buy some milk</div>
61. 		`);
62. 	}
63. };


File: test/runtime/samples/store-computed/main.html
Line number range: 1 - 11
Content:
1. {{#each $todos as todo}}
2. 	<Todo :todo/>
3. {{/each}}
4. 
5. <script>
6. 	import Todo from './Todo.html';
7. 
8. 	export default {
9. 		components: { Todo }
10. 	};
11. </script>


File: test/runtime/samples/store-root/Nested.html
Line number range: 1 - 1
Content:
1. <p>It's nice to see you, {{$name}}.</p>


File: test/runtime/samples/store-root/_config.js
Line number range: 1 - 17
Content:
1. export default {
2. 	store: true, // TODO remove this in v2
3. 
4. 	html: `
5. 		<h1>Hello world!</h1>
6. 		<p>It's nice to see you, world.</p>
7. 	`,
8. 
9. 	test(assert, component, target) {
10. 		component.store.set({ name: 'everybody' });
11. 
12. 		assert.htmlEqual(target.innerHTML, `
13. 			<h1>Hello everybody!</h1>
14. 			<p>It's nice to see you, everybody.</p>
15. 		`);
16. 	}
17. };


File: test/runtime/samples/store-root/main.html
Line number range: 1 - 19
Content:
1. <h1>Hello {{$name}}!</h1>
2. <Nested/>
3. 
4. <script>
5. 	import { Store } from '../../../../store.js';
6. 	import Nested from './Nested.html';
7. 
8. 	export default {
9. 		store () {
10. 			return new Store({
11. 				name: 'world'
12. 			});
13. 		},
14. 
15. 		components: {
16. 			Nested
17. 		}
18. 	};
19. </script>


File: test/server-side-rendering/index.js
Line number range: 1 - 132
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require("../../ssr/register")({
25. 			extensions: ['.svelte', '.html'],
26. 			store: true
27. 		});
28. 
29. 		return setupHtmlEqual();
30. 	});
31. 
32. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
33. 		if (dir[0] === ".") return;
34. 
35. 		// add .solo to a sample directory name to only run that test, or
36. 		// .show to always show the output. or both
37. 		const solo = /\.solo/.test(dir);
38. 		const show = /\.show/.test(dir);
39. 
40. 		if (solo && process.env.CI) {
41. 			throw new Error("Forgot to remove `solo: true` from test");
42. 		}
43. 
44. 		(solo ? it.only : it)(dir, () => {
45. 			dir = path.resolve("test/server-side-rendering/samples", dir);
46. 			try {
47. 				let component;
48. 
49. 				const mainHtmlFile = `${dir}/main.html`;
50. 				const mainSvelteFile = `${dir}/main.svelte`;
51. 				if (fs.existsSync(mainHtmlFile)) {
52. 					component = require(mainHtmlFile);
53. 				} else if (fs.existsSync(mainSvelteFile)) {
54. 					component = require(mainSvelteFile);
55. 				}
56. 
57. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
58. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
59. 
60. 				const data = tryToLoadJson(`${dir}/data.json`);
61. 
62. 				const rendered = component.render(data);
63. 				const { html, css, head } = rendered;
64. 
65. 				// rendered.toString() === rendered.html
66. 				assert.equal(rendered, html);
67. 
68. 				fs.writeFileSync(`${dir}/_actual.html`, html);
69. 				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);
70. 
71. 				assert.htmlEqual(html, expectedHtml);
72. 				assert.equal(
73. 					css.code.replace(/^\s+/gm, ""),
74. 					expectedCss.replace(/^\s+/gm, "")
75. 				);
76. 
77. 				if (fs.existsSync(`${dir}/_expected-head.html`)) {
78. 					fs.writeFileSync(`${dir}/_actual-head.html`, head);
79. 					assert.htmlEqual(
80. 						head,
81. 						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
82. 					);
83. 				}
84. 
85. 				if (show) showOutput(dir, { generate: 'ssr' });
86. 			} catch (err) {
87. 				showOutput(dir, { generate: 'ssr' });
88. 				throw err;
89. 			}
90. 		});
91. 	});
92. 
93. 	// duplicate client-side tests, as far as possible
94. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
95. 		if (dir[0] === ".") return;
96. 
97. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
98. 
99. 		if (config.solo && process.env.CI) {
100. 			throw new Error("Forgot to remove `solo: true` from test");
101. 		}
102. 
103. 		if (config["skip-ssr"]) return;
104. 
105. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
106. 			const cwd = path.resolve("test/runtime/samples", dir);
107. 
108. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
109. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
110. 				delete require.cache[resolved];
111. 			});
112. 
113. 			require("../../ssr/register")({
114. 				store: !!config.store
115. 			});
116. 
117. 			try {
118. 				const component = require(`../runtime/samples/${dir}/main.html`);
119. 				const { html } = component.render(config.data, {
120. 					store: (config.store !== true) && config.store
121. 				});
122. 
123. 				if (config.html) {
124. 					assert.htmlEqual(html, config.html);
125. 				}
126. 			} catch (err) {
127. 				showOutput(cwd, { generate: "ssr" });
128. 				throw err;
129. 			}
130. 		});
131. 	});
132. });


File: test/server-side-rendering/samples/component-refs-and-attributes/Widget.html
Line number range: 1 - 1
Content:
1. <p>{{foo}}</p>


File: test/server-side-rendering/samples/component-refs-and-attributes/_expected.html
Line number range: 1 - 1
Content:
1. <div><p>42</p></div>


File: test/server-side-rendering/samples/component-refs-and-attributes/main.html
Line number range: 1 - 13
Content:
1. <div><Widget ref:widget foo='{{foo}}'/></div>
2. 
3. <script>
4. 	import Widget from './Widget.html';
5. 
6. 	export default {
7. 		components: { Widget },
8. 
9. 		data () {
10. 			return { foo: 42 }
11. 		}
12. 	};
13. </script>


File: test/server-side-rendering/samples/component/Widget.html
Line number range: 1 - 1
Content:
1. <p>i am a widget</p>


File: test/server-side-rendering/samples/component/_expected.html
Line number range: 1 - 1
Content:
1. <div><p>i am a widget</p></div>


File: test/server-side-rendering/samples/component/main.html
Line number range: 1 - 11
Content:
1. <div>
2. 	<Widget/>
3. </div>
4. 
5. <script>
6. 	import Widget from './Widget.html';
7. 
8. 	export default {
9. 		components: { Widget }
10. 	};
11. </script>


File: test/store/index.js
Line number range: 1 - 190
Content:
1. import fs from 'fs';
2. import assert from 'assert';
3. import MagicString from 'magic-string';
4. import { parse } from 'acorn';
5. import { Store } from '../../store.js';
6. 
7. describe('store', () => {
8. 	it('is written in ES5', () => {
9. 		const source = fs.readFileSync('store.js', 'utf-8');
10. 
11. 		const ast = parse(source, {
12. 			sourceType: 'module'
13. 		});
14. 
15. 		const magicString = new MagicString(source);
16. 		ast.body.forEach(node => {
17. 			if (/^(Im|Ex)port/.test(node.type)) magicString.remove(node.start, node.end);
18. 		});
19. 
20. 		parse(magicString.toString(), {
21. 			ecmaVersion: 5
22. 		});
23. 	});
24. 
25. 	describe('get', () => {
26. 		it('gets a specific key', () => {
27. 			const store = new Store({
28. 				foo: 'bar'
29. 			});
30. 
31. 			assert.equal(store.get('foo'), 'bar');
32. 		});
33. 
34. 		it('gets the entire state object', () => {
35. 			const store = new Store({
36. 				foo: 'bar'
37. 			});
38. 
39. 			assert.deepEqual(store.get(), { foo: 'bar' });
40. 		});
41. 	});
42. 
43. 	describe('set', () => {
44. 		it('sets state', () => {
45. 			const store = new Store();
46. 
47. 			store.set({
48. 				foo: 'bar'
49. 			});
50. 
51. 			assert.equal(store.get('foo'), 'bar');
52. 		});
53. 	});
54. 
55. 	describe('observe', () => {
56. 		it('observes state', () => {
57. 			let newFoo;
58. 			let oldFoo;
59. 
60. 			const store = new Store({
61. 				foo: 'bar'
62. 			});
63. 
64. 			store.observe('foo', (n, o) => {
65. 				newFoo = n;
66. 				oldFoo = o;
67. 			});
68. 
69. 			assert.equal(newFoo, 'bar');
70. 			assert.equal(oldFoo, undefined);
71. 
72. 			store.set({
73. 				foo: 'baz'
74. 			});
75. 
76. 			assert.equal(newFoo, 'baz');
77. 			assert.equal(oldFoo, 'bar');
78. 		});
79. 	});
80. 
81. 	describe('onchange', () => {
82. 		it('fires a callback when state changes', () => {
83. 			const store = new Store();
84. 
85. 			let count = 0;
86. 			let args;
87. 
88. 			store.onchange((state, changed) => {
89. 				count += 1;
90. 				args = { state, changed };
91. 			});
92. 
93. 			store.set({ foo: 'bar' });
94. 
95. 			assert.equal(count, 1);
96. 			assert.deepEqual(args, {
97. 				state: { foo: 'bar' },
98. 				changed: { foo: true }
99. 			});
100. 
101. 			// this should be a noop
102. 			store.set({ foo: 'bar' });
103. 			assert.equal(count, 1);
104. 
105. 			// this shouldn't
106. 			store.set({ foo: 'baz' });
107. 
108. 			assert.equal(count, 2);
109. 			assert.deepEqual(args, {
110. 				state: { foo: 'baz' },
111. 				changed: { foo: true }
112. 			});
113. 		});
114. 	});
115. 
116. 	describe('computed', () => {
117. 		it('computes a property based on data', () => {
118. 			const store = new Store({
119. 				foo: 1
120. 			});
121. 
122. 			store.compute('bar', ['foo'], foo => foo * 2);
123. 			assert.equal(store.get('bar'), 2);
124. 
125. 			const values = [];
126. 
127. 			store.observe('bar', bar => {
128. 				values.push(bar);
129. 			});
130. 
131. 			store.set({ foo: 2 });
132. 			assert.deepEqual(values, [2, 4]);
133. 		});
134. 
135. 		it('computes a property based on another computed property', () => {
136. 			const store = new Store({
137. 				foo: 1
138. 			});
139. 
140. 			store.compute('bar', ['foo'], foo => foo * 2);
141. 			store.compute('baz', ['bar'], bar => bar * 2);
142. 			assert.equal(store.get('baz'), 4);
143. 
144. 			const values = [];
145. 
146. 			store.observe('baz', baz => {
147. 				values.push(baz);
148. 			});
149. 
150. 			store.set({ foo: 2 });
151. 			assert.deepEqual(values, [4, 8]);
152. 		});
153. 
154. 		it('prevents computed properties from being set', () => {
155. 			const store = new Store({
156. 				foo: 1
157. 			});
158. 
159. 			store.compute('bar', ['foo'], foo => foo * 2);
160. 
161. 			assert.throws(() => {
162. 				store.set({ bar: 'whatever' });
163. 			}, /'bar' is a read-only property/);
164. 		});
165. 
166. 		it('allows multiple dependents to depend on the same computed property', () => {
167. 			const store = new Store({
168. 				a: 1
169. 			});
170. 
171. 			store.compute('b', ['a'], a => a * 2);
172. 			store.compute('c', ['b'], b => b * 3);
173. 			store.compute('d', ['b'], b => b * 4);
174. 
175. 			assert.deepEqual(store.get(), { a: 1, b: 2, c: 6, d: 8 });
176. 
177. 			// bit cheeky, testing a private property, but whatever
178. 			assert.equal(store._sortedComputedProperties.length, 3);
179. 		});
180. 
181. 		it('prevents cyclical dependencies', () => {
182. 			const store = new Store();
183. 
184. 			assert.throws(() => {
185. 				store.compute('a', ['b'], b => b + 1);
186. 				store.compute('b', ['a'], a => a + 1);
187. 			}, /Cyclical dependency detected/);
188. 		});
189. 	});
190. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 13:43:30,197 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The aggregated context already includes the key test harness files (test/runtime/index.js, test/server-side-rendering/index.js), helpers (test/helpers.js), and store-related runtime samples (store-root, store-binding, store-computed) with their configs and nested components, plus SSR samples for nested components. This is sufficient to extract 5 relevant tests demonstrating nested components and store usage under runtime and SSR without requesting more files.' query='' extra_requirements='If you need additional SSR store-specific samples beyond these, let me know which directory names to fetch.' purpose='I can now present 5 complete existing tests with imports, setup, assertions, and line numbers that closely match the reported SSR/store/nested-components scenario.'
2025-11-12 13:43:30,202 - thread-135845298308800.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='test/helpers.js', content="1. import { JSDOM } from 'jsdom';\n2. import assert from 'assert';\n3. import glob from 'glob';\n4. import fs from 'fs';\n5. import path from 'path';\n6. import chalk from 'chalk';\n7. \n8. // for coverage purposes, we need to test source files,\n9. // but for sanity purposes, we need to test dist files\n10. export function loadSvelte(test) {\n11. \tprocess.env.TEST = test ? 'true' : '';\n12. \n13. \tconst resolved = require.resolve('../compiler/svelte.js');\n14. \n15. \tdelete require.cache[resolved];\n16. \treturn require(resolved);\n17. }\n18. \n19. export const svelte = loadSvelte();\n20. \n21. export function exists(path) {\n22. \ttry {\n23. \t\tfs.statSync(path);\n24. \t\treturn true;\n25. \t} catch (err) {\n26. \t\treturn false;\n27. \t}\n28. }\n29. \n30. export function tryToLoadJson(file) {\n31. \ttry {\n32. \t\treturn JSON.parse(fs.readFileSync(file));\n33. \t} catch (err) {\n34. \t\tif (err.code !== 'ENOENT') throw err;\n35. \t\treturn null;\n36. \t}\n37. }\n38. \n39. export function tryToReadFile(file) {\n40. \ttry {\n41. \t\treturn fs.readFileSync(file, 'utf-8');\n42. \t} catch (err) {\n43. \t\tif (err.code !== 'ENOENT') throw err;\n44. \t\treturn null;\n45. \t}\n46. }\n47. \n48. const { window } = new JSDOM('<main></main>');\n49. global.document = window.document;\n50. \n51. export function env() {\n52. \twindow._svelteTransitionManager = null;\n53. \twindow.document.body.innerHTML = '<main></main>';\n54. \n55. \treturn window;\n56. }\n57. \n58. function cleanChildren(node) {\n59. \tlet previous = null;\n60. \n61. \t// sort attributes\n62. \tconst attributes = Array.from(node.attributes).sort((a, b) => {\n63. \t\treturn a.name < b.name ? -1 : 1;\n64. \t});\n65. \n66. \tattributes.forEach(attr => {\n67. \t\tnode.removeAttribute(attr.name);\n68. \t});\n69. \n70. \tattributes.forEach(attr => {\n71. \t\tnode.setAttribute(attr.name, attr.value);\n72. \t});\n73. \n74. \t// recurse\n75. \t[...node.childNodes].forEach(child => {\n76. \t\tif (child.nodeType === 3) {\n77. \t\t\t// text\n78. \t\t\tif (\n79. \t\t\t\tnode.namespaceURI === 'http://www.w3.org/2000/svg' &&\n80. \t\t\t\tnode.tagName !== 'text' &&\n81. \t\t\t\tnode.tagName !== 'tspan'\n82. \t\t\t) {\n83. \t\t\t\tnode.removeChild(child);\n84. \t\t\t}\n85. \n86. \t\t\tchild.data = child.data.replace(/\\s{2,}/g, '\\n');\n87. \n88. \t\t\tif (previous && previous.nodeType === 3) {\n89. \t\t\t\tprevious.data += child.data;\n90. \t\t\t\tprevious.data = previous.data.replace(/\\s{2,}/g, '\\n');\n91. \n92. \t\t\t\tnode.removeChild(child);\n93. \t\t\t\tchild = previous;\n94. \t\t\t}\n95. \t\t} else {\n96. \t\t\tcleanChildren(child);\n97. \t\t}\n98. \n99. \t\tprevious = child;\n100. \t});\n101. \n102. \t// collapse whitespace\n103. \tif (node.firstChild && node.firstChild.nodeType === 3) {\n104. \t\tnode.firstChild.data = node.firstChild.data.replace(/^\\s+/, '');\n105. \t\tif (!node.firstChild.data) node.removeChild(node.firstChild);\n106. \t}\n107. \n108. \tif (node.lastChild && node.lastChild.nodeType === 3) {\n109. \t\tnode.lastChild.data = node.lastChild.data.replace(/\\s+$/, '');\n110. \t\tif (!node.lastChild.data) node.removeChild(node.lastChild);\n111. \t}\n112. }\n113. \n114. export function normalizeHtml(window, html) {\n115. \ttry {\n116. \t\tconst node = window.document.createElement('div');\n117. \t\tnode.innerHTML = html\n118. \t\t\t.replace(/<!--.*?-->/g, '')\n119. \t\t\t.replace(/>[\\s\\r\\n]+</g, '><')\n120. \t\t\t.trim();\n121. \t\tcleanChildren(node, '');\n122. \t\treturn node.innerHTML.replace(/<\\/?noscript\\/?>/g, '');\n123. \t} catch (err) {\n124. \t\tthrow new Error(`Failed to normalize HTML:\\n${html}`);\n125. \t}\n126. }\n127. \n128. export function setupHtmlEqual() {\n129. \tconst window = env();\n130. \n131. \tassert.htmlEqual = (actual, expected, message) => {\n132. \t\tassert.deepEqual(\n133. \t\t\tnormalizeHtml(window, actual),\n134. \t\t\tnormalizeHtml(window, expected),\n135. \t\t\tmessage\n136. \t\t);\n137. \t};\n138. }\n139. \n140. export function loadConfig(file) {\n141. \ttry {\n142. \t\tconst resolved = require.resolve(file);\n143. \t\tdelete require.cache[resolved];\n144. \n145. \t\tconst config = require(resolved);\n146. \t\treturn config.default || config;\n147. \t} catch (err) {\n148. \t\tif (err.code === 'MODULE_NOT_FOUND') {\n149. \t\t\treturn {};\n150. \t\t}\n151. \n152. \t\tthrow err;\n153. \t}\n154. }\n155. \n156. export function addLineNumbers(code) {\n157. \treturn code\n158. \t\t.split('\\n')\n159. \t\t.map((line, i) => {\n160. \t\t\ti = String(i + 1);\n161. \t\t\twhile (i.length < 3) i = ` ${i}`;\n162. \n163. \t\t\treturn (\n164. \t\t\t\tchalk.grey(`  ${i}: `) +\n165. \t\t\t\tline.replace(/^\\t+/, match => match.split('\\t').join('    '))\n166. \t\t\t);\n167. \t\t})\n168. \t\t.join('\\n');\n169. }\n170. \n171. function capitalise(str) {\n172. \treturn str[0].toUpperCase() + str.slice(1);\n173. }\n174. \n175. export function showOutput(cwd, options = {}, s = svelte) {\n176. \tglob.sync('**/*.html', { cwd }).forEach(file => {\n177. \t\tif (file[0] === '_') return;\n178. \n179. \t\tconst name = path.basename(file)\n180. \t\t\t.slice(0, -path.extname(file).length)\n181. \t\t\t.replace(/^\\d/, '_$&')\n182. \t\t\t.replace(/[^a-zA-Z0-9_$]/g, '');\n183. \n184. \t\tconst { code } = s.compile(\n185. \t\t\tfs.readFileSync(`${cwd}/${file}`, 'utf-8'),\n186. \t\t\tObject.assign(options, {\n187. \t\t\t\tfilename: file,\n188. \t\t\t\tname: capitalise(name)\n189. \t\t\t})\n190. \t\t);\n191. \n192. \t\tconsole.log( // eslint-disable-line no-console\n193. \t\t\t`\\n>> ${chalk.cyan.bold(file)}\\n${addLineNumbers(code)}\\n<< ${chalk.cyan.bold(file)}`\n194. \t\t);\n195. \t});\n196. }\n197. \n198. const start = /\\n(\\t+)/;\n199. export function deindent(strings, ...values) {\n200. \tconst indentation = start.exec(strings[0])[1];\n201. \tconst pattern = new RegExp(`^${indentation}`, 'gm');\n202. \n203. \tlet result = strings[0].replace(start, '').replace(pattern, '');\n204. \n205. \tlet trailingIndentation = getTrailingIndentation(result);\n206. \n207. \tfor (let i = 1; i < strings.length; i += 1) {\n208. \t\tlet expression = values[i - 1];\n209. \t\tconst string = strings[i].replace(pattern, '');\n210. \n211. \t\tif (Array.isArray(expression)) {\n212. \t\t\texpression = expression.length ? expression.join('\\n') : null;\n213. \t\t}\n214. \n215. \t\tif (expression || expression === '') {\n216. \t\t\tconst value = String(expression).replace(\n217. \t\t\t\t/\\n/g,\n218. \t\t\t\t`\\n${trailingIndentation}`\n219. \t\t\t);\n220. \t\t\tresult += value + string;\n221. \t\t} else {\n222. \t\t\tlet c = result.length;\n223. \t\t\twhile (/\\s/.test(result[c - 1])) c -= 1;\n224. \t\t\tresult = result.slice(0, c) + string;\n225. \t\t}\n226. \n227. \t\ttrailingIndentation = getTrailingIndentation(result);\n228. \t}\n229. \n230. \treturn result.trim().replace(/\\t+$/gm, '');\n231. }\n232. \n233. function getTrailingIndentation(str) {\n234. \tlet i = str.length;\n235. \twhile (str[i - 1] === ' ' || str[i - 1] === '\\t') i -= 1;\n236. \treturn str.slice(i, str.length);\n237. }\n238. \n239. export function spaces(i) {\n240. \tlet result = '';\n241. \twhile (i--) result += ' ';\n242. \treturn result;\n243. }", start_line_number=1, end_line_number=243), Context(relative_path='test/runtime/index.js', content='1. import assert from "assert";\n2. import chalk from \'chalk\';\n3. import * as path from "path";\n4. import * as fs from "fs";\n5. import * as acorn from "acorn";\n6. import { transitionManager } from "../../shared.js";\n7. \n8. import {\n9. \tshowOutput,\n10. \tloadConfig,\n11. \tloadSvelte,\n12. \tenv,\n13. \tsetupHtmlEqual,\n14. \tspaces\n15. } from "../helpers.js";\n16. \n17. let svelte;\n18. \n19. let compileOptions = null;\n20. \n21. function getName(filename) {\n22. \tconst base = path.basename(filename).replace(".html", "");\n23. \treturn base[0].toUpperCase() + base.slice(1);\n24. }\n25. \n26. describe("runtime", () => {\n27. \tbefore(() => {\n28. \t\tsvelte = loadSvelte(true);\n29. \n30. \t\trequire.extensions[".html"] = function(module, filename) {\n31. \t\t\tconst options = Object.assign(\n32. \t\t\t\t{ filename, name: getName(filename), format: \'cjs\' },\n33. \t\t\t\tcompileOptions\n34. \t\t\t);\n35. \n36. \t\t\tconst { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);\n37. \n38. \t\t\treturn module._compile(code, filename);\n39. \t\t};\n40. \n41. \t\treturn setupHtmlEqual();\n42. \t});\n43. \n44. \tconst failed = new Set();\n45. \n46. \tfunction runTest(dir, shared, hydrate) {\n47. \t\tif (dir[0] === ".") return;\n48. \n49. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n50. \n51. \t\tif (config.solo && process.env.CI) {\n52. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n53. \t\t}\n54. \n55. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? \'shared\' : \'inline\'} helpers${hydrate ? \' , hydration\' : \'\'})`, () => {\n56. \t\t\tif (failed.has(dir)) {\n57. \t\t\t\t// this makes debugging easier, by only printing compiled output once\n58. \t\t\t\tthrow new Error(\'skipping test, already failed\');\n59. \t\t\t}\n60. \n61. \t\t\tconst cwd = path.resolve(`test/runtime/samples/${dir}`);\n62. \t\t\tglobal.document.title = \'\';\n63. \n64. \t\t\tcompileOptions = config.compileOptions || {};\n65. \t\t\tcompileOptions.shared = shared;\n66. \t\t\tcompileOptions.hydratable = hydrate;\n67. \t\t\tcompileOptions.dev = config.dev;\n68. \t\t\tcompileOptions.store = !!config.store;\n69. \n70. \t\t\t// check that no ES2015+ syntax slipped in\n71. \t\t\tif (!config.allowES2015) {\n72. \t\t\t\ttry {\n73. \t\t\t\t\tconst source = fs.readFileSync(\n74. \t\t\t\t\t\t`test/runtime/samples/${dir}/main.html`,\n75. \t\t\t\t\t\t"utf-8"\n76. \t\t\t\t\t);\n77. \t\t\t\t\tconst { code } = svelte.compile(source, compileOptions);\n78. \t\t\t\t\tconst startIndex = code.indexOf("function create_main_fragment"); // may change!\n79. \t\t\t\t\tif (startIndex === -1) throw new Error("missing create_main_fragment");\n80. \t\t\t\t\tconst endIndex = code.lastIndexOf("export default");\n81. \t\t\t\t\tconst es5 =\n82. \t\t\t\t\t\tcode.slice(0, startIndex).split(\'\\n\').map(x => spaces(x.length)).join(\'\\n\') +\n83. \t\t\t\t\t\tcode.slice(startIndex, endIndex);\n84. \n85. \t\t\t\t\tacorn.parse(es5, { ecmaVersion: 5 });\n86. \n87. \t\t\t\t\tif (/Object\\.assign/.test(es5)) {\n88. \t\t\t\t\t\tthrow new Error(\n89. \t\t\t\t\t\t\t"cannot use Object.assign in generated code, as it is not supported everywhere"\n90. \t\t\t\t\t\t);\n91. \t\t\t\t\t}\n92. \t\t\t\t} catch (err) {\n93. \t\t\t\t\tfailed.add(dir);\n94. \t\t\t\t\tif (err.frame) {\n95. \t\t\t\t\t\tconsole.error(chalk.red(err.frame)); // eslint-disable-line no-console\n96. \t\t\t\t\t}\n97. \t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n98. \t\t\t\t\tthrow err;\n99. \t\t\t\t}\n100. \t\t\t}\n101. \n102. \t\t\tObject.keys(require.cache)\n103. \t\t\t\t.filter(x => x.endsWith(".html"))\n104. \t\t\t\t.forEach(file => {\n105. \t\t\t\t\tdelete require.cache[file];\n106. \t\t\t\t});\n107. \n108. \t\t\tlet SvelteComponent;\n109. \n110. \t\t\tlet unintendedError = null;\n111. \n112. \t\t\tconst window = env();\n113. \n114. \t\t\treturn Promise.resolve()\n115. \t\t\t\t.then(() => {\n116. \t\t\t\t\t// set of hacks to support transition tests\n117. \t\t\t\t\ttransitionManager.running = false;\n118. \t\t\t\t\ttransitionManager.transitions = [];\n119. \n120. \t\t\t\t\tconst raf = {\n121. \t\t\t\t\t\ttime: 0,\n122. \t\t\t\t\t\tcallback: null,\n123. \t\t\t\t\t\ttick: now => {\n124. \t\t\t\t\t\t\traf.time = now;\n125. \t\t\t\t\t\t\tif (raf.callback) raf.callback();\n126. \t\t\t\t\t\t}\n127. \t\t\t\t\t};\n128. \t\t\t\t\twindow.performance = { now: () => raf.time };\n129. \t\t\t\t\tglobal.requestAnimationFrame = cb => {\n130. \t\t\t\t\t\tlet called = false;\n131. \t\t\t\t\t\traf.callback = () => {\n132. \t\t\t\t\t\t\tif (!called) {\n133. \t\t\t\t\t\t\t\tcalled = true;\n134. \t\t\t\t\t\t\t\tcb();\n135. \t\t\t\t\t\t\t}\n136. \t\t\t\t\t\t};\n137. \t\t\t\t\t};\n138. \n139. \t\t\t\t\ttry {\n140. \t\t\t\t\t\tSvelteComponent = require(`./samples/${dir}/main.html`);\n141. \t\t\t\t\t} catch (err) {\n142. \t\t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n143. \t\t\t\t\t\tthrow err;\n144. \t\t\t\t\t}\n145. \n146. \t\t\t\t\tglobal.window = window;\n147. \n148. \t\t\t\t\t// Put the constructor on window for testing\n149. \t\t\t\t\twindow.SvelteComponent = SvelteComponent;\n150. \n151. \t\t\t\t\tconst target = window.document.querySelector("main");\n152. \n153. \t\t\t\t\tconst warnings = [];\n154. \t\t\t\t\tconst warn = console.warn;\n155. \t\t\t\t\tconsole.warn = warning => {\n156. \t\t\t\t\t\twarnings.push(warning);\n157. \t\t\t\t\t};\n158. \n159. \t\t\t\t\tconst options = Object.assign({}, {\n160. \t\t\t\t\t\ttarget,\n161. \t\t\t\t\t\thydrate,\n162. \t\t\t\t\t\tdata: config.data,\n163. \t\t\t\t\t\tstore: (config.store !== true && config.store)\n164. \t\t\t\t\t}, config.options || {});\n165. \n166. \t\t\t\t\tconst component = new SvelteComponent(options);\n167. \n168. \t\t\t\t\tconsole.warn = warn;\n169. \n170. \t\t\t\t\tif (config.error) {\n171. \t\t\t\t\t\tunintendedError = true;\n172. \t\t\t\t\t\tthrow new Error("Expected a runtime error");\n173. \t\t\t\t\t}\n174. \n175. \t\t\t\t\tif (config.warnings) {\n176. \t\t\t\t\t\tassert.deepEqual(warnings, config.warnings);\n177. \t\t\t\t\t} else if (warnings.length) {\n178. \t\t\t\t\t\tunintendedError = true;\n179. \t\t\t\t\t\tthrow new Error("Received unexpected warnings");\n180. \t\t\t\t\t}\n181. \n182. \t\t\t\t\tif (config.html) {\n183. \t\t\t\t\t\tassert.htmlEqual(target.innerHTML, config.html);\n184. \t\t\t\t\t}\n185. \n186. \t\t\t\t\tif (config.test) {\n187. \t\t\t\t\t\treturn Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {\n188. \t\t\t\t\t\t\tcomponent.destroy();\n189. \t\t\t\t\t\t});\n190. \t\t\t\t\t} else {\n191. \t\t\t\t\t\tcomponent.destroy();\n192. \t\t\t\t\t\tassert.equal(target.innerHTML, "");\n193. \t\t\t\t\t}\n194. \t\t\t\t})\n195. \t\t\t\t.catch(err => {\n196. \t\t\t\t\tif (config.error && !unintendedError) {\n197. \t\t\t\t\t\tconfig.error(assert, err);\n198. \t\t\t\t\t} else {\n199. \t\t\t\t\t\tfailed.add(dir);\n200. \t\t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n201. \t\t\t\t\t\tthrow err;\n202. \t\t\t\t\t}\n203. \t\t\t\t})\n204. \t\t\t\t.then(() => {\n205. \t\t\t\t\tif (config.show) showOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte);\n206. \t\t\t\t});\n207. \t\t});\n208. \t}\n209. \n210. \tconst shared = path.resolve("shared.js");\n211. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n212. \t\trunTest(dir, shared, false);\n213. \t\trunTest(dir, shared, true);\n214. \t\trunTest(dir, null, false);\n215. \t});\n216. \n217. \tit("fails if options.target is missing in dev mode", () => {\n218. \t\tconst { code } = svelte.compile(`<div></div>`, {\n219. \t\t\tformat: "iife",\n220. \t\t\tname: "SvelteComponent",\n221. \t\t\tdev: true\n222. \t\t});\n223. \n224. \t\tconst SvelteComponent = eval(\n225. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n226. \t\t);\n227. \n228. \t\tassert.throws(() => {\n229. \t\t\tnew SvelteComponent();\n230. \t\t}, /\'target\' is a required option/);\n231. \t});\n232. \n233. \tit("fails if options.hydrate is true but the component is non-hydratable", () => {\n234. \t\tconst { code } = svelte.compile(`<div></div>`, {\n235. \t\t\tformat: "iife",\n236. \t\t\tname: "SvelteComponent",\n237. \t\t\tdev: true\n238. \t\t});\n239. \n240. \t\tconst SvelteComponent = eval(\n241. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n242. \t\t);\n243. \n244. \t\tassert.throws(() => {\n245. \t\t\tnew SvelteComponent({\n246. \t\t\t\ttarget: {},\n247. \t\t\t\thydrate: true\n248. \t\t\t});\n249. \t\t}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);\n250. \t});\n251. });', start_line_number=1, end_line_number=251), Context(relative_path='test/runtime/samples/store-binding/NameInput.html', content='1. <input bind:value=$name>', start_line_number=1, end_line_number=1), Context(relative_path='test/runtime/samples/store-binding/_config.js', content="1. import { Store } from '../../../../store.js';\n2. \n3. const store = new Store({\n4. \tname: 'world'\n5. });\n6. \n7. export default {\n8. \tstore,\n9. \n10. \thtml: `\n11. \t\t<h1>Hello world!</h1>\n12. \t\t<input>\n13. \t`,\n14. \n15. \ttest(assert, component, target, window) {\n16. \t\tconst input = target.querySelector('input');\n17. \t\tconst event = new window.Event('input');\n18. \n19. \t\tinput.value = 'everybody';\n20. \t\tinput.dispatchEvent(event);\n21. \n22. \t\tassert.equal(store.get('name'), 'everybody');\n23. \t\tassert.htmlEqual(target.innerHTML, `\n24. \t\t\t<h1>Hello everybody!</h1>\n25. \t\t\t<input>\n26. \t\t`);\n27. \t}\n28. };", start_line_number=1, end_line_number=28), Context(relative_path='test/runtime/samples/store-binding/main.html', content="1. <h1>Hello {{$name}}!</h1>\n2. <NameInput/>\n3. \n4. <script>\n5. \timport NameInput from './NameInput.html';\n6. \n7. \texport default {\n8. \t\tcomponents: { NameInput }\n9. \t};\n10. </script>", start_line_number=1, end_line_number=10), Context(relative_path='test/runtime/samples/store-computed/Todo.html', content='1. {{#if isVisible}}\n2. \t<div class=\'{{todo.done ? "done": "pending"}}\'>{{todo.description}}</div>\n3. {{/if}}\n4. \n5. <script>\n6. \texport default {\n7. \t\tcomputed: {\n8. \t\t\tisVisible: ($filter, todo) => {\n9. \t\t\t\tif ($filter === \'all\') return true;\n10. \t\t\t\tif ($filter === \'done\') return todo.done;\n11. \t\t\t\tif ($filter === \'pending\') return !todo.done;\n12. \t\t\t}\n13. \t\t}\n14. \t};\n15. </script>', start_line_number=1, end_line_number=15), Context(relative_path='test/runtime/samples/store-computed/_config.js', content='1. import { Store } from \'../../../../store.js\';\n2. \n3. class MyStore extends Store {\n4. \tsetFilter(filter) {\n5. \t\tthis.set({ filter });\n6. \t}\n7. \n8. \ttoggleTodo(todo) {\n9. \t\ttodo.done = !todo.done;\n10. \t\tthis.set({ todos: this.get(\'todos\') });\n11. \t}\n12. }\n13. \n14. const todos = [\n15. \t{\n16. \t\tdescription: \'Buy some milk\',\n17. \t\tdone: true,\n18. \t},\n19. \t{\n20. \t\tdescription: \'Do the laundry\',\n21. \t\tdone: true,\n22. \t},\n23. \t{\n24. \t\tdescription: "Find life\'s true purpose",\n25. \t\tdone: false,\n26. \t}\n27. ];\n28. \n29. const store = new MyStore({\n30. \tfilter: \'all\',\n31. \ttodos\n32. });\n33. \n34. export default {\n35. \tstore,\n36. \n37. \thtml: `\n38. \t\t<div class=\'done\'>Buy some milk</div>\n39. \t\t<div class=\'done\'>Do the laundry</div>\n40. \t\t<div class=\'pending\'>Find life\'s true purpose</div>\n41. \t`,\n42. \n43. \ttest(assert, component, target) {\n44. \t\tstore.setFilter(\'pending\');\n45. \n46. \t\tassert.htmlEqual(target.innerHTML, `\n47. \t\t\t<div class=\'pending\'>Find life\'s true purpose</div>\n48. \t\t`);\n49. \n50. \t\tstore.toggleTodo(todos[1]);\n51. \n52. \t\tassert.htmlEqual(target.innerHTML, `\n53. \t\t\t<div class=\'pending\'>Do the laundry</div>\n54. \t\t\t<div class=\'pending\'>Find life\'s true purpose</div>\n55. \t\t`);\n56. \n57. \t\tstore.setFilter(\'done\');\n58. \n59. \t\tassert.htmlEqual(target.innerHTML, `\n60. \t\t\t<div class=\'done\'>Buy some milk</div>\n61. \t\t`);\n62. \t}\n63. };', start_line_number=1, end_line_number=63), Context(relative_path='test/runtime/samples/store-computed/main.html', content="1. {{#each $todos as todo}}\n2. \t<Todo :todo/>\n3. {{/each}}\n4. \n5. <script>\n6. \timport Todo from './Todo.html';\n7. \n8. \texport default {\n9. \t\tcomponents: { Todo }\n10. \t};\n11. </script>", start_line_number=1, end_line_number=11), Context(relative_path='test/runtime/samples/store-root/Nested.html', content="1. <p>It's nice to see you, {{$name}}.</p>", start_line_number=1, end_line_number=1), Context(relative_path='test/runtime/samples/store-root/_config.js', content="1. export default {\n2. \tstore: true, // TODO remove this in v2\n3. \n4. \thtml: `\n5. \t\t<h1>Hello world!</h1>\n6. \t\t<p>It's nice to see you, world.</p>\n7. \t`,\n8. \n9. \ttest(assert, component, target) {\n10. \t\tcomponent.store.set({ name: 'everybody' });\n11. \n12. \t\tassert.htmlEqual(target.innerHTML, `\n13. \t\t\t<h1>Hello everybody!</h1>\n14. \t\t\t<p>It's nice to see you, everybody.</p>\n15. \t\t`);\n16. \t}\n17. };", start_line_number=1, end_line_number=17), Context(relative_path='test/runtime/samples/store-root/main.html', content="1. <h1>Hello {{$name}}!</h1>\n2. <Nested/>\n3. \n4. <script>\n5. \timport { Store } from '../../../../store.js';\n6. \timport Nested from './Nested.html';\n7. \n8. \texport default {\n9. \t\tstore () {\n10. \t\t\treturn new Store({\n11. \t\t\t\tname: 'world'\n12. \t\t\t});\n13. \t\t},\n14. \n15. \t\tcomponents: {\n16. \t\t\tNested\n17. \t\t}\n18. \t};\n19. </script>", start_line_number=1, end_line_number=19), Context(relative_path='test/server-side-rendering/index.js', content='1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";\n12. \n13. function tryToReadFile(file) {\n14. \ttry {\n15. \t\treturn fs.readFileSync(file, "utf-8");\n16. \t} catch (err) {\n17. \t\tif (err.code !== "ENOENT") throw err;\n18. \t\treturn null;\n19. \t}\n20. }\n21. \n22. describe("ssr", () => {\n23. \tbefore(() => {\n24. \t\trequire("../../ssr/register")({\n25. \t\t\textensions: [\'.svelte\', \'.html\'],\n26. \t\t\tstore: true\n27. \t\t});\n28. \n29. \t\treturn setupHtmlEqual();\n30. \t});\n31. \n32. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n33. \t\tif (dir[0] === ".") return;\n34. \n35. \t\t// add .solo to a sample directory name to only run that test, or\n36. \t\t// .show to always show the output. or both\n37. \t\tconst solo = /\\.solo/.test(dir);\n38. \t\tconst show = /\\.show/.test(dir);\n39. \n40. \t\tif (solo && process.env.CI) {\n41. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n42. \t\t}\n43. \n44. \t\t(solo ? it.only : it)(dir, () => {\n45. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n46. \t\t\ttry {\n47. \t\t\t\tlet component;\n48. \n49. \t\t\t\tconst mainHtmlFile = `${dir}/main.html`;\n50. \t\t\t\tconst mainSvelteFile = `${dir}/main.svelte`;\n51. \t\t\t\tif (fs.existsSync(mainHtmlFile)) {\n52. \t\t\t\t\tcomponent = require(mainHtmlFile);\n53. \t\t\t\t} else if (fs.existsSync(mainSvelteFile)) {\n54. \t\t\t\t\tcomponent = require(mainSvelteFile);\n55. \t\t\t\t}\n56. \n57. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n58. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n59. \n60. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n61. \n62. \t\t\t\tconst rendered = component.render(data);\n63. \t\t\t\tconst { html, css, head } = rendered;\n64. \n65. \t\t\t\t// rendered.toString() === rendered.html\n66. \t\t\t\tassert.equal(rendered, html);\n67. \n68. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n69. \t\t\t\tif (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);\n70. \n71. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n72. \t\t\t\tassert.equal(\n73. \t\t\t\t\tcss.code.replace(/^\\s+/gm, ""),\n74. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n75. \t\t\t\t);\n76. \n77. \t\t\t\tif (fs.existsSync(`${dir}/_expected-head.html`)) {\n78. \t\t\t\t\tfs.writeFileSync(`${dir}/_actual-head.html`, head);\n79. \t\t\t\t\tassert.htmlEqual(\n80. \t\t\t\t\t\thead,\n81. \t\t\t\t\t\tfs.readFileSync(`${dir}/_expected-head.html`, \'utf-8\')\n82. \t\t\t\t\t);\n83. \t\t\t\t}\n84. \n85. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n86. \t\t\t} catch (err) {\n87. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n88. \t\t\t\tthrow err;\n89. \t\t\t}\n90. \t\t});\n91. \t});\n92. \n93. \t// duplicate client-side tests, as far as possible\n94. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n95. \t\tif (dir[0] === ".") return;\n96. \n97. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n98. \n99. \t\tif (config.solo && process.env.CI) {\n100. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n101. \t\t}\n102. \n103. \t\tif (config["skip-ssr"]) return;\n104. \n105. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n106. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n107. \n108. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n109. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n110. \t\t\t\tdelete require.cache[resolved];\n111. \t\t\t});\n112. \n113. \t\t\trequire("../../ssr/register")({\n114. \t\t\t\tstore: !!config.store\n115. \t\t\t});\n116. \n117. \t\t\ttry {\n118. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n119. \t\t\t\tconst { html } = component.render(config.data, {\n120. \t\t\t\t\tstore: (config.store !== true) && config.store\n121. \t\t\t\t});\n122. \n123. \t\t\t\tif (config.html) {\n124. \t\t\t\t\tassert.htmlEqual(html, config.html);\n125. \t\t\t\t}\n126. \t\t\t} catch (err) {\n127. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n128. \t\t\t\tthrow err;\n129. \t\t\t}\n130. \t\t});\n131. \t});\n132. });', start_line_number=1, end_line_number=132), Context(relative_path='test/server-side-rendering/samples/component-refs-and-attributes/Widget.html', content='1. <p>{{foo}}</p>', start_line_number=1, end_line_number=1), Context(relative_path='test/server-side-rendering/samples/component-refs-and-attributes/_expected.html', content='1. <div><p>42</p></div>', start_line_number=1, end_line_number=1), Context(relative_path='test/server-side-rendering/samples/component-refs-and-attributes/main.html', content="1. <div><Widget ref:widget foo='{{foo}}'/></div>\n2. \n3. <script>\n4. \timport Widget from './Widget.html';\n5. \n6. \texport default {\n7. \t\tcomponents: { Widget },\n8. \n9. \t\tdata () {\n10. \t\t\treturn { foo: 42 }\n11. \t\t}\n12. \t};\n13. </script>", start_line_number=1, end_line_number=13), Context(relative_path='test/server-side-rendering/samples/component/Widget.html', content='1. <p>i am a widget</p>', start_line_number=1, end_line_number=1), Context(relative_path='test/server-side-rendering/samples/component/_expected.html', content='1. <div><p>i am a widget</p></div>', start_line_number=1, end_line_number=1), Context(relative_path='test/server-side-rendering/samples/component/main.html', content="1. <div>\n2. \t<Widget/>\n3. </div>\n4. \n5. <script>\n6. \timport Widget from './Widget.html';\n7. \n8. \texport default {\n9. \t\tcomponents: { Widget }\n10. \t};\n11. </script>", start_line_number=1, end_line_number=11), Context(relative_path='test/store/index.js', content="1. import fs from 'fs';\n2. import assert from 'assert';\n3. import MagicString from 'magic-string';\n4. import { parse } from 'acorn';\n5. import { Store } from '../../store.js';\n6. \n7. describe('store', () => {\n8. \tit('is written in ES5', () => {\n9. \t\tconst source = fs.readFileSync('store.js', 'utf-8');\n10. \n11. \t\tconst ast = parse(source, {\n12. \t\t\tsourceType: 'module'\n13. \t\t});\n14. \n15. \t\tconst magicString = new MagicString(source);\n16. \t\tast.body.forEach(node => {\n17. \t\t\tif (/^(Im|Ex)port/.test(node.type)) magicString.remove(node.start, node.end);\n18. \t\t});\n19. \n20. \t\tparse(magicString.toString(), {\n21. \t\t\tecmaVersion: 5\n22. \t\t});\n23. \t});\n24. \n25. \tdescribe('get', () => {\n26. \t\tit('gets a specific key', () => {\n27. \t\t\tconst store = new Store({\n28. \t\t\t\tfoo: 'bar'\n29. \t\t\t});\n30. \n31. \t\t\tassert.equal(store.get('foo'), 'bar');\n32. \t\t});\n33. \n34. \t\tit('gets the entire state object', () => {\n35. \t\t\tconst store = new Store({\n36. \t\t\t\tfoo: 'bar'\n37. \t\t\t});\n38. \n39. \t\t\tassert.deepEqual(store.get(), { foo: 'bar' });\n40. \t\t});\n41. \t});\n42. \n43. \tdescribe('set', () => {\n44. \t\tit('sets state', () => {\n45. \t\t\tconst store = new Store();\n46. \n47. \t\t\tstore.set({\n48. \t\t\t\tfoo: 'bar'\n49. \t\t\t});\n50. \n51. \t\t\tassert.equal(store.get('foo'), 'bar');\n52. \t\t});\n53. \t});\n54. \n55. \tdescribe('observe', () => {\n56. \t\tit('observes state', () => {\n57. \t\t\tlet newFoo;\n58. \t\t\tlet oldFoo;\n59. \n60. \t\t\tconst store = new Store({\n61. \t\t\t\tfoo: 'bar'\n62. \t\t\t});\n63. \n64. \t\t\tstore.observe('foo', (n, o) => {\n65. \t\t\t\tnewFoo = n;\n66. \t\t\t\toldFoo = o;\n67. \t\t\t});\n68. \n69. \t\t\tassert.equal(newFoo, 'bar');\n70. \t\t\tassert.equal(oldFoo, undefined);\n71. \n72. \t\t\tstore.set({\n73. \t\t\t\tfoo: 'baz'\n74. \t\t\t});\n75. \n76. \t\t\tassert.equal(newFoo, 'baz');\n77. \t\t\tassert.equal(oldFoo, 'bar');\n78. \t\t});\n79. \t});\n80. \n81. \tdescribe('onchange', () => {\n82. \t\tit('fires a callback when state changes', () => {\n83. \t\t\tconst store = new Store();\n84. \n85. \t\t\tlet count = 0;\n86. \t\t\tlet args;\n87. \n88. \t\t\tstore.onchange((state, changed) => {\n89. \t\t\t\tcount += 1;\n90. \t\t\t\targs = { state, changed };\n91. \t\t\t});\n92. \n93. \t\t\tstore.set({ foo: 'bar' });\n94. \n95. \t\t\tassert.equal(count, 1);\n96. \t\t\tassert.deepEqual(args, {\n97. \t\t\t\tstate: { foo: 'bar' },\n98. \t\t\t\tchanged: { foo: true }\n99. \t\t\t});\n100. \n101. \t\t\t// this should be a noop\n102. \t\t\tstore.set({ foo: 'bar' });\n103. \t\t\tassert.equal(count, 1);\n104. \n105. \t\t\t// this shouldn't\n106. \t\t\tstore.set({ foo: 'baz' });\n107. \n108. \t\t\tassert.equal(count, 2);\n109. \t\t\tassert.deepEqual(args, {\n110. \t\t\t\tstate: { foo: 'baz' },\n111. \t\t\t\tchanged: { foo: true }\n112. \t\t\t});\n113. \t\t});\n114. \t});\n115. \n116. \tdescribe('computed', () => {\n117. \t\tit('computes a property based on data', () => {\n118. \t\t\tconst store = new Store({\n119. \t\t\t\tfoo: 1\n120. \t\t\t});\n121. \n122. \t\t\tstore.compute('bar', ['foo'], foo => foo * 2);\n123. \t\t\tassert.equal(store.get('bar'), 2);\n124. \n125. \t\t\tconst values = [];\n126. \n127. \t\t\tstore.observe('bar', bar => {\n128. \t\t\t\tvalues.push(bar);\n129. \t\t\t});\n130. \n131. \t\t\tstore.set({ foo: 2 });\n132. \t\t\tassert.deepEqual(values, [2, 4]);\n133. \t\t});\n134. \n135. \t\tit('computes a property based on another computed property', () => {\n136. \t\t\tconst store = new Store({\n137. \t\t\t\tfoo: 1\n138. \t\t\t});\n139. \n140. \t\t\tstore.compute('bar', ['foo'], foo => foo * 2);\n141. \t\t\tstore.compute('baz', ['bar'], bar => bar * 2);\n142. \t\t\tassert.equal(store.get('baz'), 4);\n143. \n144. \t\t\tconst values = [];\n145. \n146. \t\t\tstore.observe('baz', baz => {\n147. \t\t\t\tvalues.push(baz);\n148. \t\t\t});\n149. \n150. \t\t\tstore.set({ foo: 2 });\n151. \t\t\tassert.deepEqual(values, [4, 8]);\n152. \t\t});\n153. \n154. \t\tit('prevents computed properties from being set', () => {\n155. \t\t\tconst store = new Store({\n156. \t\t\t\tfoo: 1\n157. \t\t\t});\n158. \n159. \t\t\tstore.compute('bar', ['foo'], foo => foo * 2);\n160. \n161. \t\t\tassert.throws(() => {\n162. \t\t\t\tstore.set({ bar: 'whatever' });\n163. \t\t\t}, /'bar' is a read-only property/);\n164. \t\t});\n165. \n166. \t\tit('allows multiple dependents to depend on the same computed property', () => {\n167. \t\t\tconst store = new Store({\n168. \t\t\t\ta: 1\n169. \t\t\t});\n170. \n171. \t\t\tstore.compute('b', ['a'], a => a * 2);\n172. \t\t\tstore.compute('c', ['b'], b => b * 3);\n173. \t\t\tstore.compute('d', ['b'], b => b * 4);\n174. \n175. \t\t\tassert.deepEqual(store.get(), { a: 1, b: 2, c: 6, d: 8 });\n176. \n177. \t\t\t// bit cheeky, testing a private property, but whatever\n178. \t\t\tassert.equal(store._sortedComputedProperties.length, 3);\n179. \t\t});\n180. \n181. \t\tit('prevents cyclical dependencies', () => {\n182. \t\t\tconst store = new Store();\n183. \n184. \t\t\tassert.throws(() => {\n185. \t\t\t\tstore.compute('a', ['b'], b => b + 1);\n186. \t\t\t\tstore.compute('b', ['a'], a => a + 1);\n187. \t\t\t}, /Cyclical dependency detected/);\n188. \t\t});\n189. \t});\n190. });", start_line_number=1, end_line_number=190)]
2025-11-12 13:43:30,205 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_write_message_node - DEBUG - Sending message to BugReproducingWriteNode:
content='Issue title:\ncan\'t supply store to nested components server side\n\nIssue description: \nHey, I\'m trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.\n\nE.g. I have a manage account page like so:\n```html\n<div class="page">\n    <h1>Manage Account</h1>\n\n    <div>\n        <h3>Two Factor Auth</h3>\n        <TwoFactorAuth />\n    </div>\n</div>\n\n<style>\n    .page {\n        width: 400px;\n        margin: 50px auto;\n    }\n</style>\n\n<script>\n    import TwoFactorAuth from \'./_components/TwoFactorAuth\';\n\n    export default {\n        components: {\n            TwoFactorAuth,\n        },\n    }\n</script>\n```\n\nAnd in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)\n```html\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n    import { connect } from \'../../_redux\';\n\n    export default {\n        store: connect(state => ({\n            hasTwoFactor: state.user && state.user.hasTwoFactor,\n        })),\n    }\n</script>\n```\n\nAs mentioned this fails on the server side, but not when navigation to the page on the client side.\n\nI dug into the generated code a bit and I see it generates the template like so:\n```js\nreturn `<div class="page" svelte-1782208320>\n    <h1>Manage Account</h1>\n\n    <div>\n        <h3>Two Factor Auth</h3>\n        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}\n    </div>\n</div>`\n```\n\nThis is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.\n\nIt errors on the following line in the TwoFactorAuth\'s `_render` method, as the store is undefined\n```js\nstate = Object.assign(options.store._init(["hasTwoFactor"]), state);\n```\n```\nCannot read property \'_init\' of undefined\n```\n\nIssue comments:\n\n\nBug reproducing context:\nFile: test/helpers.js\nLine number range: 1 - 243\nContent:\n1. import { JSDOM } from \'jsdom\';\n2. import assert from \'assert\';\n3. import glob from \'glob\';\n4. import fs from \'fs\';\n5. import path from \'path\';\n6. import chalk from \'chalk\';\n7. \n8. // for coverage purposes, we need to test source files,\n9. // but for sanity purposes, we need to test dist files\n10. export function loadSvelte(test) {\n11. \tprocess.env.TEST = test ? \'true\' : \'\';\n12. \n13. \tconst resolved = require.resolve(\'../compiler/svelte.js\');\n14. \n15. \tdelete require.cache[resolved];\n16. \treturn require(resolved);\n17. }\n18. \n19. export const svelte = loadSvelte();\n20. \n21. export function exists(path) {\n22. \ttry {\n23. \t\tfs.statSync(path);\n24. \t\treturn true;\n25. \t} catch (err) {\n26. \t\treturn false;\n27. \t}\n28. }\n29. \n30. export function tryToLoadJson(file) {\n31. \ttry {\n32. \t\treturn JSON.parse(fs.readFileSync(file));\n33. \t} catch (err) {\n34. \t\tif (err.code !== \'ENOENT\') throw err;\n35. \t\treturn null;\n36. \t}\n37. }\n38. \n39. export function tryToReadFile(file) {\n40. \ttry {\n41. \t\treturn fs.readFileSync(file, \'utf-8\');\n42. \t} catch (err) {\n43. \t\tif (err.code !== \'ENOENT\') throw err;\n44. \t\treturn null;\n45. \t}\n46. }\n47. \n48. const { window } = new JSDOM(\'<main></main>\');\n49. global.document = window.document;\n50. \n51. export function env() {\n52. \twindow._svelteTransitionManager = null;\n53. \twindow.document.body.innerHTML = \'<main></main>\';\n54. \n55. \treturn window;\n56. }\n57. \n58. function cleanChildren(node) {\n59. \tlet previous = null;\n60. \n61. \t// sort attributes\n62. \tconst attributes = Array.from(node.attributes).sort((a, b) => {\n63. \t\treturn a.name < b.name ? -1 : 1;\n64. \t});\n65. \n66. \tattributes.forEach(attr => {\n67. \t\tnode.removeAttribute(attr.name);\n68. \t});\n69. \n70. \tattributes.forEach(attr => {\n71. \t\tnode.setAttribute(attr.name, attr.value);\n72. \t});\n73. \n74. \t// recurse\n75. \t[...node.childNodes].forEach(child => {\n76. \t\tif (child.nodeType === 3) {\n77. \t\t\t// text\n78. \t\t\tif (\n79. \t\t\t\tnode.namespaceURI === \'http://www.w3.org/2000/svg\' &&\n80. \t\t\t\tnode.tagName !== \'text\' &&\n81. \t\t\t\tnode.tagName !== \'tspan\'\n82. \t\t\t) {\n83. \t\t\t\tnode.removeChild(child);\n84. \t\t\t}\n85. \n86. \t\t\tchild.data = child.data.replace(/\\s{2,}/g, \'\\n\');\n87. \n88. \t\t\tif (previous && previous.nodeType === 3) {\n89. \t\t\t\tprevious.data += child.data;\n90. \t\t\t\tprevious.data = previous.data.replace(/\\s{2,}/g, \'\\n\');\n91. \n92. \t\t\t\tnode.removeChild(child);\n93. \t\t\t\tchild = previous;\n94. \t\t\t}\n95. \t\t} else {\n96. \t\t\tcleanChildren(child);\n97. \t\t}\n98. \n99. \t\tprevious = child;\n100. \t});\n101. \n102. \t// collapse whitespace\n103. \tif (node.firstChild && node.firstChild.nodeType === 3) {\n104. \t\tnode.firstChild.data = node.firstChild.data.replace(/^\\s+/, \'\');\n105. \t\tif (!node.firstChild.data) node.removeChild(node.firstChild);\n106. \t}\n107. \n108. \tif (node.lastChild && node.lastChild.nodeType === 3) {\n109. \t\tnode.lastChild.data = node.lastChild.data.replace(/\\s+$/, \'\');\n110. \t\tif (!node.lastChild.data) node.removeChild(node.lastChild);\n111. \t}\n112. }\n113. \n114. export function normalizeHtml(window, html) {\n115. \ttry {\n116. \t\tconst node = window.document.createElement(\'div\');\n117. \t\tnode.innerHTML = html\n118. \t\t\t.replace(/<!--.*?-->/g, \'\')\n119. \t\t\t.replace(/>[\\s\\r\\n]+</g, \'><\')\n120. \t\t\t.trim();\n121. \t\tcleanChildren(node, \'\');\n122. \t\treturn node.innerHTML.replace(/<\\/?noscript\\/?>/g, \'\');\n123. \t} catch (err) {\n124. \t\tthrow new Error(`Failed to normalize HTML:\\n${html}`);\n125. \t}\n126. }\n127. \n128. export function setupHtmlEqual() {\n129. \tconst window = env();\n130. \n131. \tassert.htmlEqual = (actual, expected, message) => {\n132. \t\tassert.deepEqual(\n133. \t\t\tnormalizeHtml(window, actual),\n134. \t\t\tnormalizeHtml(window, expected),\n135. \t\t\tmessage\n136. \t\t);\n137. \t};\n138. }\n139. \n140. export function loadConfig(file) {\n141. \ttry {\n142. \t\tconst resolved = require.resolve(file);\n143. \t\tdelete require.cache[resolved];\n144. \n145. \t\tconst config = require(resolved);\n146. \t\treturn config.default || config;\n147. \t} catch (err) {\n148. \t\tif (err.code === \'MODULE_NOT_FOUND\') {\n149. \t\t\treturn {};\n150. \t\t}\n151. \n152. \t\tthrow err;\n153. \t}\n154. }\n155. \n156. export function addLineNumbers(code) {\n157. \treturn code\n158. \t\t.split(\'\\n\')\n159. \t\t.map((line, i) => {\n160. \t\t\ti = String(i + 1);\n161. \t\t\twhile (i.length < 3) i = ` ${i}`;\n162. \n163. \t\t\treturn (\n164. \t\t\t\tchalk.grey(`  ${i}: `) +\n165. \t\t\t\tline.replace(/^\\t+/, match => match.split(\'\\t\').join(\'    \'))\n166. \t\t\t);\n167. \t\t})\n168. \t\t.join(\'\\n\');\n169. }\n170. \n171. function capitalise(str) {\n172. \treturn str[0].toUpperCase() + str.slice(1);\n173. }\n174. \n175. export function showOutput(cwd, options = {}, s = svelte) {\n176. \tglob.sync(\'**/*.html\', { cwd }).forEach(file => {\n177. \t\tif (file[0] === \'_\') return;\n178. \n179. \t\tconst name = path.basename(file)\n180. \t\t\t.slice(0, -path.extname(file).length)\n181. \t\t\t.replace(/^\\d/, \'_$&\')\n182. \t\t\t.replace(/[^a-zA-Z0-9_$]/g, \'\');\n183. \n184. \t\tconst { code } = s.compile(\n185. \t\t\tfs.readFileSync(`${cwd}/${file}`, \'utf-8\'),\n186. \t\t\tObject.assign(options, {\n187. \t\t\t\tfilename: file,\n188. \t\t\t\tname: capitalise(name)\n189. \t\t\t})\n190. \t\t);\n191. \n192. \t\tconsole.log( // eslint-disable-line no-console\n193. \t\t\t`\\n>> ${chalk.cyan.bold(file)}\\n${addLineNumbers(code)}\\n<< ${chalk.cyan.bold(file)}`\n194. \t\t);\n195. \t});\n196. }\n197. \n198. const start = /\\n(\\t+)/;\n199. export function deindent(strings, ...values) {\n200. \tconst indentation = start.exec(strings[0])[1];\n201. \tconst pattern = new RegExp(`^${indentation}`, \'gm\');\n202. \n203. \tlet result = strings[0].replace(start, \'\').replace(pattern, \'\');\n204. \n205. \tlet trailingIndentation = getTrailingIndentation(result);\n206. \n207. \tfor (let i = 1; i < strings.length; i += 1) {\n208. \t\tlet expression = values[i - 1];\n209. \t\tconst string = strings[i].replace(pattern, \'\');\n210. \n211. \t\tif (Array.isArray(expression)) {\n212. \t\t\texpression = expression.length ? expression.join(\'\\n\') : null;\n213. \t\t}\n214. \n215. \t\tif (expression || expression === \'\') {\n216. \t\t\tconst value = String(expression).replace(\n217. \t\t\t\t/\\n/g,\n218. \t\t\t\t`\\n${trailingIndentation}`\n219. \t\t\t);\n220. \t\t\tresult += value + string;\n221. \t\t} else {\n222. \t\t\tlet c = result.length;\n223. \t\t\twhile (/\\s/.test(result[c - 1])) c -= 1;\n224. \t\t\tresult = result.slice(0, c) + string;\n225. \t\t}\n226. \n227. \t\ttrailingIndentation = getTrailingIndentation(result);\n228. \t}\n229. \n230. \treturn result.trim().replace(/\\t+$/gm, \'\');\n231. }\n232. \n233. function getTrailingIndentation(str) {\n234. \tlet i = str.length;\n235. \twhile (str[i - 1] === \' \' || str[i - 1] === \'\\t\') i -= 1;\n236. \treturn str.slice(i, str.length);\n237. }\n238. \n239. export function spaces(i) {\n240. \tlet result = \'\';\n241. \twhile (i--) result += \' \';\n242. \treturn result;\n243. }\n\n\nFile: test/runtime/index.js\nLine number range: 1 - 251\nContent:\n1. import assert from "assert";\n2. import chalk from \'chalk\';\n3. import * as path from "path";\n4. import * as fs from "fs";\n5. import * as acorn from "acorn";\n6. import { transitionManager } from "../../shared.js";\n7. \n8. import {\n9. \tshowOutput,\n10. \tloadConfig,\n11. \tloadSvelte,\n12. \tenv,\n13. \tsetupHtmlEqual,\n14. \tspaces\n15. } from "../helpers.js";\n16. \n17. let svelte;\n18. \n19. let compileOptions = null;\n20. \n21. function getName(filename) {\n22. \tconst base = path.basename(filename).replace(".html", "");\n23. \treturn base[0].toUpperCase() + base.slice(1);\n24. }\n25. \n26. describe("runtime", () => {\n27. \tbefore(() => {\n28. \t\tsvelte = loadSvelte(true);\n29. \n30. \t\trequire.extensions[".html"] = function(module, filename) {\n31. \t\t\tconst options = Object.assign(\n32. \t\t\t\t{ filename, name: getName(filename), format: \'cjs\' },\n33. \t\t\t\tcompileOptions\n34. \t\t\t);\n35. \n36. \t\t\tconst { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);\n37. \n38. \t\t\treturn module._compile(code, filename);\n39. \t\t};\n40. \n41. \t\treturn setupHtmlEqual();\n42. \t});\n43. \n44. \tconst failed = new Set();\n45. \n46. \tfunction runTest(dir, shared, hydrate) {\n47. \t\tif (dir[0] === ".") return;\n48. \n49. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n50. \n51. \t\tif (config.solo && process.env.CI) {\n52. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n53. \t\t}\n54. \n55. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? \'shared\' : \'inline\'} helpers${hydrate ? \' , hydration\' : \'\'})`, () => {\n56. \t\t\tif (failed.has(dir)) {\n57. \t\t\t\t// this makes debugging easier, by only printing compiled output once\n58. \t\t\t\tthrow new Error(\'skipping test, already failed\');\n59. \t\t\t}\n60. \n61. \t\t\tconst cwd = path.resolve(`test/runtime/samples/${dir}`);\n62. \t\t\tglobal.document.title = \'\';\n63. \n64. \t\t\tcompileOptions = config.compileOptions || {};\n65. \t\t\tcompileOptions.shared = shared;\n66. \t\t\tcompileOptions.hydratable = hydrate;\n67. \t\t\tcompileOptions.dev = config.dev;\n68. \t\t\tcompileOptions.store = !!config.store;\n69. \n70. \t\t\t// check that no ES2015+ syntax slipped in\n71. \t\t\tif (!config.allowES2015) {\n72. \t\t\t\ttry {\n73. \t\t\t\t\tconst source = fs.readFileSync(\n74. \t\t\t\t\t\t`test/runtime/samples/${dir}/main.html`,\n75. \t\t\t\t\t\t"utf-8"\n76. \t\t\t\t\t);\n77. \t\t\t\t\tconst { code } = svelte.compile(source, compileOptions);\n78. \t\t\t\t\tconst startIndex = code.indexOf("function create_main_fragment"); // may change!\n79. \t\t\t\t\tif (startIndex === -1) throw new Error("missing create_main_fragment");\n80. \t\t\t\t\tconst endIndex = code.lastIndexOf("export default");\n81. \t\t\t\t\tconst es5 =\n82. \t\t\t\t\t\tcode.slice(0, startIndex).split(\'\\n\').map(x => spaces(x.length)).join(\'\\n\') +\n83. \t\t\t\t\t\tcode.slice(startIndex, endIndex);\n84. \n85. \t\t\t\t\tacorn.parse(es5, { ecmaVersion: 5 });\n86. \n87. \t\t\t\t\tif (/Object\\.assign/.test(es5)) {\n88. \t\t\t\t\t\tthrow new Error(\n89. \t\t\t\t\t\t\t"cannot use Object.assign in generated code, as it is not supported everywhere"\n90. \t\t\t\t\t\t);\n91. \t\t\t\t\t}\n92. \t\t\t\t} catch (err) {\n93. \t\t\t\t\tfailed.add(dir);\n94. \t\t\t\t\tif (err.frame) {\n95. \t\t\t\t\t\tconsole.error(chalk.red(err.frame)); // eslint-disable-line no-console\n96. \t\t\t\t\t}\n97. \t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n98. \t\t\t\t\tthrow err;\n99. \t\t\t\t}\n100. \t\t\t}\n101. \n102. \t\t\tObject.keys(require.cache)\n103. \t\t\t\t.filter(x => x.endsWith(".html"))\n104. \t\t\t\t.forEach(file => {\n105. \t\t\t\t\tdelete require.cache[file];\n106. \t\t\t\t});\n107. \n108. \t\t\tlet SvelteComponent;\n109. \n110. \t\t\tlet unintendedError = null;\n111. \n112. \t\t\tconst window = env();\n113. \n114. \t\t\treturn Promise.resolve()\n115. \t\t\t\t.then(() => {\n116. \t\t\t\t\t// set of hacks to support transition tests\n117. \t\t\t\t\ttransitionManager.running = false;\n118. \t\t\t\t\ttransitionManager.transitions = [];\n119. \n120. \t\t\t\t\tconst raf = {\n121. \t\t\t\t\t\ttime: 0,\n122. \t\t\t\t\t\tcallback: null,\n123. \t\t\t\t\t\ttick: now => {\n124. \t\t\t\t\t\t\traf.time = now;\n125. \t\t\t\t\t\t\tif (raf.callback) raf.callback();\n126. \t\t\t\t\t\t}\n127. \t\t\t\t\t};\n128. \t\t\t\t\twindow.performance = { now: () => raf.time };\n129. \t\t\t\t\tglobal.requestAnimationFrame = cb => {\n130. \t\t\t\t\t\tlet called = false;\n131. \t\t\t\t\t\traf.callback = () => {\n132. \t\t\t\t\t\t\tif (!called) {\n133. \t\t\t\t\t\t\t\tcalled = true;\n134. \t\t\t\t\t\t\t\tcb();\n135. \t\t\t\t\t\t\t}\n136. \t\t\t\t\t\t};\n137. \t\t\t\t\t};\n138. \n139. \t\t\t\t\ttry {\n140. \t\t\t\t\t\tSvelteComponent = require(`./samples/${dir}/main.html`);\n141. \t\t\t\t\t} catch (err) {\n142. \t\t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n143. \t\t\t\t\t\tthrow err;\n144. \t\t\t\t\t}\n145. \n146. \t\t\t\t\tglobal.window = window;\n147. \n148. \t\t\t\t\t// Put the constructor on window for testing\n149. \t\t\t\t\twindow.SvelteComponent = SvelteComponent;\n150. \n151. \t\t\t\t\tconst target = window.document.querySelector("main");\n152. \n153. \t\t\t\t\tconst warnings = [];\n154. \t\t\t\t\tconst warn = console.warn;\n155. \t\t\t\t\tconsole.warn = warning => {\n156. \t\t\t\t\t\twarnings.push(warning);\n157. \t\t\t\t\t};\n158. \n159. \t\t\t\t\tconst options = Object.assign({}, {\n160. \t\t\t\t\t\ttarget,\n161. \t\t\t\t\t\thydrate,\n162. \t\t\t\t\t\tdata: config.data,\n163. \t\t\t\t\t\tstore: (config.store !== true && config.store)\n164. \t\t\t\t\t}, config.options || {});\n165. \n166. \t\t\t\t\tconst component = new SvelteComponent(options);\n167. \n168. \t\t\t\t\tconsole.warn = warn;\n169. \n170. \t\t\t\t\tif (config.error) {\n171. \t\t\t\t\t\tunintendedError = true;\n172. \t\t\t\t\t\tthrow new Error("Expected a runtime error");\n173. \t\t\t\t\t}\n174. \n175. \t\t\t\t\tif (config.warnings) {\n176. \t\t\t\t\t\tassert.deepEqual(warnings, config.warnings);\n177. \t\t\t\t\t} else if (warnings.length) {\n178. \t\t\t\t\t\tunintendedError = true;\n179. \t\t\t\t\t\tthrow new Error("Received unexpected warnings");\n180. \t\t\t\t\t}\n181. \n182. \t\t\t\t\tif (config.html) {\n183. \t\t\t\t\t\tassert.htmlEqual(target.innerHTML, config.html);\n184. \t\t\t\t\t}\n185. \n186. \t\t\t\t\tif (config.test) {\n187. \t\t\t\t\t\treturn Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {\n188. \t\t\t\t\t\t\tcomponent.destroy();\n189. \t\t\t\t\t\t});\n190. \t\t\t\t\t} else {\n191. \t\t\t\t\t\tcomponent.destroy();\n192. \t\t\t\t\t\tassert.equal(target.innerHTML, "");\n193. \t\t\t\t\t}\n194. \t\t\t\t})\n195. \t\t\t\t.catch(err => {\n196. \t\t\t\t\tif (config.error && !unintendedError) {\n197. \t\t\t\t\t\tconfig.error(assert, err);\n198. \t\t\t\t\t} else {\n199. \t\t\t\t\t\tfailed.add(dir);\n200. \t\t\t\t\t\tshowOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console\n201. \t\t\t\t\t\tthrow err;\n202. \t\t\t\t\t}\n203. \t\t\t\t})\n204. \t\t\t\t.then(() => {\n205. \t\t\t\t\tif (config.show) showOutput(cwd, { shared, format: \'cjs\', hydratable: hydrate, store: !!compileOptions.store }, svelte);\n206. \t\t\t\t});\n207. \t\t});\n208. \t}\n209. \n210. \tconst shared = path.resolve("shared.js");\n211. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n212. \t\trunTest(dir, shared, false);\n213. \t\trunTest(dir, shared, true);\n214. \t\trunTest(dir, null, false);\n215. \t});\n216. \n217. \tit("fails if options.target is missing in dev mode", () => {\n218. \t\tconst { code } = svelte.compile(`<div></div>`, {\n219. \t\t\tformat: "iife",\n220. \t\t\tname: "SvelteComponent",\n221. \t\t\tdev: true\n222. \t\t});\n223. \n224. \t\tconst SvelteComponent = eval(\n225. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n226. \t\t);\n227. \n228. \t\tassert.throws(() => {\n229. \t\t\tnew SvelteComponent();\n230. \t\t}, /\'target\' is a required option/);\n231. \t});\n232. \n233. \tit("fails if options.hydrate is true but the component is non-hydratable", () => {\n234. \t\tconst { code } = svelte.compile(`<div></div>`, {\n235. \t\t\tformat: "iife",\n236. \t\t\tname: "SvelteComponent",\n237. \t\t\tdev: true\n238. \t\t});\n239. \n240. \t\tconst SvelteComponent = eval(\n241. \t\t\t`(function () { ${code}; return SvelteComponent; }())`\n242. \t\t);\n243. \n244. \t\tassert.throws(() => {\n245. \t\t\tnew SvelteComponent({\n246. \t\t\t\ttarget: {},\n247. \t\t\t\thydrate: true\n248. \t\t\t});\n249. \t\t}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);\n250. \t});\n251. });\n\n\nFile: test/runtime/samples/store-binding/NameInput.html\nLine number range: 1 - 1\nContent:\n1. <input bind:value=$name>\n\n\nFile: test/runtime/samples/store-binding/_config.js\nLine number range: 1 - 28\nContent:\n1. import { Store } from \'../../../../store.js\';\n2. \n3. const store = new Store({\n4. \tname: \'world\'\n5. });\n6. \n7. export default {\n8. \tstore,\n9. \n10. \thtml: `\n11. \t\t<h1>Hello world!</h1>\n12. \t\t<input>\n13. \t`,\n14. \n15. \ttest(assert, component, target, window) {\n16. \t\tconst input = target.querySelector(\'input\');\n17. \t\tconst event = new window.Event(\'input\');\n18. \n19. \t\tinput.value = \'everybody\';\n20. \t\tinput.dispatchEvent(event);\n21. \n22. \t\tassert.equal(store.get(\'name\'), \'everybody\');\n23. \t\tassert.htmlEqual(target.innerHTML, `\n24. \t\t\t<h1>Hello everybody!</h1>\n25. \t\t\t<input>\n26. \t\t`);\n27. \t}\n28. };\n\n\nFile: test/runtime/samples/store-binding/main.html\nLine number range: 1 - 10\nContent:\n1. <h1>Hello {{$name}}!</h1>\n2. <NameInput/>\n3. \n4. <script>\n5. \timport NameInput from \'./NameInput.html\';\n6. \n7. \texport default {\n8. \t\tcomponents: { NameInput }\n9. \t};\n10. </script>\n\n\nFile: test/runtime/samples/store-computed/Todo.html\nLine number range: 1 - 15\nContent:\n1. {{#if isVisible}}\n2. \t<div class=\'{{todo.done ? "done": "pending"}}\'>{{todo.description}}</div>\n3. {{/if}}\n4. \n5. <script>\n6. \texport default {\n7. \t\tcomputed: {\n8. \t\t\tisVisible: ($filter, todo) => {\n9. \t\t\t\tif ($filter === \'all\') return true;\n10. \t\t\t\tif ($filter === \'done\') return todo.done;\n11. \t\t\t\tif ($filter === \'pending\') return !todo.done;\n12. \t\t\t}\n13. \t\t}\n14. \t};\n15. </script>\n\n\nFile: test/runtime/samples/store-computed/_config.js\nLine number range: 1 - 63\nContent:\n1. import { Store } from \'../../../../store.js\';\n2. \n3. class MyStore extends Store {\n4. \tsetFilter(filter) {\n5. \t\tthis.set({ filter });\n6. \t}\n7. \n8. \ttoggleTodo(todo) {\n9. \t\ttodo.done = !todo.done;\n10. \t\tthis.set({ todos: this.get(\'todos\') });\n11. \t}\n12. }\n13. \n14. const todos = [\n15. \t{\n16. \t\tdescription: \'Buy some milk\',\n17. \t\tdone: true,\n18. \t},\n19. \t{\n20. \t\tdescription: \'Do the laundry\',\n21. \t\tdone: true,\n22. \t},\n23. \t{\n24. \t\tdescription: "Find life\'s true purpose",\n25. \t\tdone: false,\n26. \t}\n27. ];\n28. \n29. const store = new MyStore({\n30. \tfilter: \'all\',\n31. \ttodos\n32. });\n33. \n34. export default {\n35. \tstore,\n36. \n37. \thtml: `\n38. \t\t<div class=\'done\'>Buy some milk</div>\n39. \t\t<div class=\'done\'>Do the laundry</div>\n40. \t\t<div class=\'pending\'>Find life\'s true purpose</div>\n41. \t`,\n42. \n43. \ttest(assert, component, target) {\n44. \t\tstore.setFilter(\'pending\');\n45. \n46. \t\tassert.htmlEqual(target.innerHTML, `\n47. \t\t\t<div class=\'pending\'>Find life\'s true purpose</div>\n48. \t\t`);\n49. \n50. \t\tstore.toggleTodo(todos[1]);\n51. \n52. \t\tassert.htmlEqual(target.innerHTML, `\n53. \t\t\t<div class=\'pending\'>Do the laundry</div>\n54. \t\t\t<div class=\'pending\'>Find life\'s true purpose</div>\n55. \t\t`);\n56. \n57. \t\tstore.setFilter(\'done\');\n58. \n59. \t\tassert.htmlEqual(target.innerHTML, `\n60. \t\t\t<div class=\'done\'>Buy some milk</div>\n61. \t\t`);\n62. \t}\n63. };\n\n\nFile: test/runtime/samples/store-computed/main.html\nLine number range: 1 - 11\nContent:\n1. {{#each $todos as todo}}\n2. \t<Todo :todo/>\n3. {{/each}}\n4. \n5. <script>\n6. \timport Todo from \'./Todo.html\';\n7. \n8. \texport default {\n9. \t\tcomponents: { Todo }\n10. \t};\n11. </script>\n\n\nFile: test/runtime/samples/store-root/Nested.html\nLine number range: 1 - 1\nContent:\n1. <p>It\'s nice to see you, {{$name}}.</p>\n\n\nFile: test/runtime/samples/store-root/_config.js\nLine number range: 1 - 17\nContent:\n1. export default {\n2. \tstore: true, // TODO remove this in v2\n3. \n4. \thtml: `\n5. \t\t<h1>Hello world!</h1>\n6. \t\t<p>It\'s nice to see you, world.</p>\n7. \t`,\n8. \n9. \ttest(assert, component, target) {\n10. \t\tcomponent.store.set({ name: \'everybody\' });\n11. \n12. \t\tassert.htmlEqual(target.innerHTML, `\n13. \t\t\t<h1>Hello everybody!</h1>\n14. \t\t\t<p>It\'s nice to see you, everybody.</p>\n15. \t\t`);\n16. \t}\n17. };\n\n\nFile: test/runtime/samples/store-root/main.html\nLine number range: 1 - 19\nContent:\n1. <h1>Hello {{$name}}!</h1>\n2. <Nested/>\n3. \n4. <script>\n5. \timport { Store } from \'../../../../store.js\';\n6. \timport Nested from \'./Nested.html\';\n7. \n8. \texport default {\n9. \t\tstore () {\n10. \t\t\treturn new Store({\n11. \t\t\t\tname: \'world\'\n12. \t\t\t});\n13. \t\t},\n14. \n15. \t\tcomponents: {\n16. \t\t\tNested\n17. \t\t}\n18. \t};\n19. </script>\n\n\nFile: test/server-side-rendering/index.js\nLine number range: 1 - 132\nContent:\n1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";\n12. \n13. function tryToReadFile(file) {\n14. \ttry {\n15. \t\treturn fs.readFileSync(file, "utf-8");\n16. \t} catch (err) {\n17. \t\tif (err.code !== "ENOENT") throw err;\n18. \t\treturn null;\n19. \t}\n20. }\n21. \n22. describe("ssr", () => {\n23. \tbefore(() => {\n24. \t\trequire("../../ssr/register")({\n25. \t\t\textensions: [\'.svelte\', \'.html\'],\n26. \t\t\tstore: true\n27. \t\t});\n28. \n29. \t\treturn setupHtmlEqual();\n30. \t});\n31. \n32. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n33. \t\tif (dir[0] === ".") return;\n34. \n35. \t\t// add .solo to a sample directory name to only run that test, or\n36. \t\t// .show to always show the output. or both\n37. \t\tconst solo = /\\.solo/.test(dir);\n38. \t\tconst show = /\\.show/.test(dir);\n39. \n40. \t\tif (solo && process.env.CI) {\n41. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n42. \t\t}\n43. \n44. \t\t(solo ? it.only : it)(dir, () => {\n45. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n46. \t\t\ttry {\n47. \t\t\t\tlet component;\n48. \n49. \t\t\t\tconst mainHtmlFile = `${dir}/main.html`;\n50. \t\t\t\tconst mainSvelteFile = `${dir}/main.svelte`;\n51. \t\t\t\tif (fs.existsSync(mainHtmlFile)) {\n52. \t\t\t\t\tcomponent = require(mainHtmlFile);\n53. \t\t\t\t} else if (fs.existsSync(mainSvelteFile)) {\n54. \t\t\t\t\tcomponent = require(mainSvelteFile);\n55. \t\t\t\t}\n56. \n57. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n58. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n59. \n60. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n61. \n62. \t\t\t\tconst rendered = component.render(data);\n63. \t\t\t\tconst { html, css, head } = rendered;\n64. \n65. \t\t\t\t// rendered.toString() === rendered.html\n66. \t\t\t\tassert.equal(rendered, html);\n67. \n68. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n69. \t\t\t\tif (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);\n70. \n71. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n72. \t\t\t\tassert.equal(\n73. \t\t\t\t\tcss.code.replace(/^\\s+/gm, ""),\n74. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n75. \t\t\t\t);\n76. \n77. \t\t\t\tif (fs.existsSync(`${dir}/_expected-head.html`)) {\n78. \t\t\t\t\tfs.writeFileSync(`${dir}/_actual-head.html`, head);\n79. \t\t\t\t\tassert.htmlEqual(\n80. \t\t\t\t\t\thead,\n81. \t\t\t\t\t\tfs.readFileSync(`${dir}/_expected-head.html`, \'utf-8\')\n82. \t\t\t\t\t);\n83. \t\t\t\t}\n84. \n85. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n86. \t\t\t} catch (err) {\n87. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n88. \t\t\t\tthrow err;\n89. \t\t\t}\n90. \t\t});\n91. \t});\n92. \n93. \t// duplicate client-side tests, as far as possible\n94. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n95. \t\tif (dir[0] === ".") return;\n96. \n97. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n98. \n99. \t\tif (config.solo && process.env.CI) {\n100. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n101. \t\t}\n102. \n103. \t\tif (config["skip-ssr"]) return;\n104. \n105. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n106. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n107. \n108. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n109. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n110. \t\t\t\tdelete require.cache[resolved];\n111. \t\t\t});\n112. \n113. \t\t\trequire("../../ssr/register")({\n114. \t\t\t\tstore: !!config.store\n115. \t\t\t});\n116. \n117. \t\t\ttry {\n118. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n119. \t\t\t\tconst { html } = component.render(config.data, {\n120. \t\t\t\t\tstore: (config.store !== true) && config.store\n121. \t\t\t\t});\n122. \n123. \t\t\t\tif (config.html) {\n124. \t\t\t\t\tassert.htmlEqual(html, config.html);\n125. \t\t\t\t}\n126. \t\t\t} catch (err) {\n127. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n128. \t\t\t\tthrow err;\n129. \t\t\t}\n130. \t\t});\n131. \t});\n132. });\n\n\nFile: test/server-side-rendering/samples/component-refs-and-attributes/Widget.html\nLine number range: 1 - 1\nContent:\n1. <p>{{foo}}</p>\n\n\nFile: test/server-side-rendering/samples/component-refs-and-attributes/_expected.html\nLine number range: 1 - 1\nContent:\n1. <div><p>42</p></div>\n\n\nFile: test/server-side-rendering/samples/component-refs-and-attributes/main.html\nLine number range: 1 - 13\nContent:\n1. <div><Widget ref:widget foo=\'{{foo}}\'/></div>\n2. \n3. <script>\n4. \timport Widget from \'./Widget.html\';\n5. \n6. \texport default {\n7. \t\tcomponents: { Widget },\n8. \n9. \t\tdata () {\n10. \t\t\treturn { foo: 42 }\n11. \t\t}\n12. \t};\n13. </script>\n\n\nFile: test/server-side-rendering/samples/component/Widget.html\nLine number range: 1 - 1\nContent:\n1. <p>i am a widget</p>\n\n\nFile: test/server-side-rendering/samples/component/_expected.html\nLine number range: 1 - 1\nContent:\n1. <div><p>i am a widget</p></div>\n\n\nFile: test/server-side-rendering/samples/component/main.html\nLine number range: 1 - 11\nContent:\n1. <div>\n2. \t<Widget/>\n3. </div>\n4. \n5. <script>\n6. \timport Widget from \'./Widget.html\';\n7. \n8. \texport default {\n9. \t\tcomponents: { Widget }\n10. \t};\n11. </script>\n\n\nFile: test/store/index.js\nLine number range: 1 - 190\nContent:\n1. import fs from \'fs\';\n2. import assert from \'assert\';\n3. import MagicString from \'magic-string\';\n4. import { parse } from \'acorn\';\n5. import { Store } from \'../../store.js\';\n6. \n7. describe(\'store\', () => {\n8. \tit(\'is written in ES5\', () => {\n9. \t\tconst source = fs.readFileSync(\'store.js\', \'utf-8\');\n10. \n11. \t\tconst ast = parse(source, {\n12. \t\t\tsourceType: \'module\'\n13. \t\t});\n14. \n15. \t\tconst magicString = new MagicString(source);\n16. \t\tast.body.forEach(node => {\n17. \t\t\tif (/^(Im|Ex)port/.test(node.type)) magicString.remove(node.start, node.end);\n18. \t\t});\n19. \n20. \t\tparse(magicString.toString(), {\n21. \t\t\tecmaVersion: 5\n22. \t\t});\n23. \t});\n24. \n25. \tdescribe(\'get\', () => {\n26. \t\tit(\'gets a specific key\', () => {\n27. \t\t\tconst store = new Store({\n28. \t\t\t\tfoo: \'bar\'\n29. \t\t\t});\n30. \n31. \t\t\tassert.equal(store.get(\'foo\'), \'bar\');\n32. \t\t});\n33. \n34. \t\tit(\'gets the entire state object\', () => {\n35. \t\t\tconst store = new Store({\n36. \t\t\t\tfoo: \'bar\'\n37. \t\t\t});\n38. \n39. \t\t\tassert.deepEqual(store.get(), { foo: \'bar\' });\n40. \t\t});\n41. \t});\n42. \n43. \tdescribe(\'set\', () => {\n44. \t\tit(\'sets state\', () => {\n45. \t\t\tconst store = new Store();\n46. \n47. \t\t\tstore.set({\n48. \t\t\t\tfoo: \'bar\'\n49. \t\t\t});\n50. \n51. \t\t\tassert.equal(store.get(\'foo\'), \'bar\');\n52. \t\t});\n53. \t});\n54. \n55. \tdescribe(\'observe\', () => {\n56. \t\tit(\'observes state\', () => {\n57. \t\t\tlet newFoo;\n58. \t\t\tlet oldFoo;\n59. \n60. \t\t\tconst store = new Store({\n61. \t\t\t\tfoo: \'bar\'\n62. \t\t\t});\n63. \n64. \t\t\tstore.observe(\'foo\', (n, o) => {\n65. \t\t\t\tnewFoo = n;\n66. \t\t\t\toldFoo = o;\n67. \t\t\t});\n68. \n69. \t\t\tassert.equal(newFoo, \'bar\');\n70. \t\t\tassert.equal(oldFoo, undefined);\n71. \n72. \t\t\tstore.set({\n73. \t\t\t\tfoo: \'baz\'\n74. \t\t\t});\n75. \n76. \t\t\tassert.equal(newFoo, \'baz\');\n77. \t\t\tassert.equal(oldFoo, \'bar\');\n78. \t\t});\n79. \t});\n80. \n81. \tdescribe(\'onchange\', () => {\n82. \t\tit(\'fires a callback when state changes\', () => {\n83. \t\t\tconst store = new Store();\n84. \n85. \t\t\tlet count = 0;\n86. \t\t\tlet args;\n87. \n88. \t\t\tstore.onchange((state, changed) => {\n89. \t\t\t\tcount += 1;\n90. \t\t\t\targs = { state, changed };\n91. \t\t\t});\n92. \n93. \t\t\tstore.set({ foo: \'bar\' });\n94. \n95. \t\t\tassert.equal(count, 1);\n96. \t\t\tassert.deepEqual(args, {\n97. \t\t\t\tstate: { foo: \'bar\' },\n98. \t\t\t\tchanged: { foo: true }\n99. \t\t\t});\n100. \n101. \t\t\t// this should be a noop\n102. \t\t\tstore.set({ foo: \'bar\' });\n103. \t\t\tassert.equal(count, 1);\n104. \n105. \t\t\t// this shouldn\'t\n106. \t\t\tstore.set({ foo: \'baz\' });\n107. \n108. \t\t\tassert.equal(count, 2);\n109. \t\t\tassert.deepEqual(args, {\n110. \t\t\t\tstate: { foo: \'baz\' },\n111. \t\t\t\tchanged: { foo: true }\n112. \t\t\t});\n113. \t\t});\n114. \t});\n115. \n116. \tdescribe(\'computed\', () => {\n117. \t\tit(\'computes a property based on data\', () => {\n118. \t\t\tconst store = new Store({\n119. \t\t\t\tfoo: 1\n120. \t\t\t});\n121. \n122. \t\t\tstore.compute(\'bar\', [\'foo\'], foo => foo * 2);\n123. \t\t\tassert.equal(store.get(\'bar\'), 2);\n124. \n125. \t\t\tconst values = [];\n126. \n127. \t\t\tstore.observe(\'bar\', bar => {\n128. \t\t\t\tvalues.push(bar);\n129. \t\t\t});\n130. \n131. \t\t\tstore.set({ foo: 2 });\n132. \t\t\tassert.deepEqual(values, [2, 4]);\n133. \t\t});\n134. \n135. \t\tit(\'computes a property based on another computed property\', () => {\n136. \t\t\tconst store = new Store({\n137. \t\t\t\tfoo: 1\n138. \t\t\t});\n139. \n140. \t\t\tstore.compute(\'bar\', [\'foo\'], foo => foo * 2);\n141. \t\t\tstore.compute(\'baz\', [\'bar\'], bar => bar * 2);\n142. \t\t\tassert.equal(store.get(\'baz\'), 4);\n143. \n144. \t\t\tconst values = [];\n145. \n146. \t\t\tstore.observe(\'baz\', baz => {\n147. \t\t\t\tvalues.push(baz);\n148. \t\t\t});\n149. \n150. \t\t\tstore.set({ foo: 2 });\n151. \t\t\tassert.deepEqual(values, [4, 8]);\n152. \t\t});\n153. \n154. \t\tit(\'prevents computed properties from being set\', () => {\n155. \t\t\tconst store = new Store({\n156. \t\t\t\tfoo: 1\n157. \t\t\t});\n158. \n159. \t\t\tstore.compute(\'bar\', [\'foo\'], foo => foo * 2);\n160. \n161. \t\t\tassert.throws(() => {\n162. \t\t\t\tstore.set({ bar: \'whatever\' });\n163. \t\t\t}, /\'bar\' is a read-only property/);\n164. \t\t});\n165. \n166. \t\tit(\'allows multiple dependents to depend on the same computed property\', () => {\n167. \t\t\tconst store = new Store({\n168. \t\t\t\ta: 1\n169. \t\t\t});\n170. \n171. \t\t\tstore.compute(\'b\', [\'a\'], a => a * 2);\n172. \t\t\tstore.compute(\'c\', [\'b\'], b => b * 3);\n173. \t\t\tstore.compute(\'d\', [\'b\'], b => b * 4);\n174. \n175. \t\t\tassert.deepEqual(store.get(), { a: 1, b: 2, c: 6, d: 8 });\n176. \n177. \t\t\t// bit cheeky, testing a private property, but whatever\n178. \t\t\tassert.equal(store._sortedComputedProperties.length, 3);\n179. \t\t});\n180. \n181. \t\tit(\'prevents cyclical dependencies\', () => {\n182. \t\t\tconst store = new Store();\n183. \n184. \t\t\tassert.throws(() => {\n185. \t\t\t\tstore.compute(\'a\', [\'b\'], b => b + 1);\n186. \t\t\t\tstore.compute(\'b\', [\'a\'], a => a + 1);\n187. \t\t\t}, /Cyclical dependency detected/);\n188. \t\t});\n189. \t});\n190. });\n\n\nNow generate the complete self-contained test case that reproduces the bug with the same error/exception.\n' additional_kwargs={} response_metadata={}
2025-11-12 13:44:17,589 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content="Create a new SSR sample to reproduce the issue where a nested component defines its own store but SSR passes the parent (undefined) store, causing options.store._init to throw.\n\nAdd these files:\n\nFile: test/server-side-rendering/samples/nested-component-store/main.html\n<div>\n\t<TwoFactorAuth/>\n</div>\n\n<script>\n\timport TwoFactorAuth from './TwoFactorAuth.html';\n\n\texport default {\n\t\tcomponents: { TwoFactorAuth }\n\t};\n</script>\n\nFile: test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n\timport { Store } from '../../../../store.js';\n\n\texport default {\n\t\tstore() {\n\t\t\treturn new Store({\n\t\t\t\thasTwoFactor: true\n\t\t\t});\n\t\t}\n\t};\n</script>\n\nFile: test/server-side-rendering/samples/nested-component-store/_expected.html\n<div><div>yay its enabled</div></div>\n\nThis SSR test will currently fail with:\nCannot read property '_init' of undefined\nfrom the nested component’s _render because the store passed to the child is undefined. After the bug is fixed (child store initialization respected during SSR), the test will pass by matching the expected HTML." additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 4253, 'prompt_tokens': 10534, 'total_tokens': 14787, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 3968, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--331e7624-3bd2-4d9b-a4a4-a95f670feaa7-0' usage_metadata={'input_tokens': 10534, 'output_tokens': 4253, 'total_tokens': 14787, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 3968}}
2025-11-12 13:44:36,683 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_LSuMly4ePulgNodZShNY5XQr', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/nested-component-store/main.html","content":"<div>\\n\\t<TwoFactorAuth/>\\n</div>\\n\\n<script>\\n\\timport TwoFactorAuth from \'./TwoFactorAuth.html\';\\n\\n\\texport default {\\n\\t\\tcomponents: { TwoFactorAuth }\\n\\t};\\n</script>\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1891, 'prompt_tokens': 26373, 'total_tokens': 28264, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1792, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--83b8bc47-1eb3-4620-bafe-d30cb7393b71-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'test/server-side-rendering/samples/nested-component-store/main.html', 'content': "<div>\n\t<TwoFactorAuth/>\n</div>\n\n<script>\n\timport TwoFactorAuth from './TwoFactorAuth.html';\n\n\texport default {\n\t\tcomponents: { TwoFactorAuth }\n\t};\n</script>\n"}, 'id': 'call_LSuMly4ePulgNodZShNY5XQr', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26373, 'output_tokens': 1891, 'total_tokens': 28264, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1792}}
2025-11-12 13:44:39,133 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_qHekptCFXP8TyrZS6cNmyX4h', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html","content":"{{#if $hasTwoFactor}}\\n<div>yay its enabled</div>\\n{{else}}\\n<div>oh no its not enabled</div>\\n{{/if}}\\n\\n<script>\\n\\timport { Store } from \'../../../../store.js\';\\n\\n\\texport default {\\n\\t\\tstore() {\\n\\t\\t\\treturn new Store({\\n\\t\\t\\t\\thasTwoFactor: true\\n\\t\\t\\t});\\n\\t\\t}\\n\\t};\\n</script>\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 142, 'prompt_tokens': 26495, 'total_tokens': 26637, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f3487608-0603-48cb-974b-bc1290de2192-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html', 'content': "{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n\timport { Store } from '../../../../store.js';\n\n\texport default {\n\t\tstore() {\n\t\t\treturn new Store({\n\t\t\t\thasTwoFactor: true\n\t\t\t});\n\t\t}\n\t};\n</script>\n"}, 'id': 'call_qHekptCFXP8TyrZS6cNmyX4h', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26495, 'output_tokens': 142, 'total_tokens': 26637, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:44:42,133 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zIyddHv4LtdelFsZ29tVhYpO', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/nested-component-store/_expected.html","content":"<div><div>yay its enabled</div></div>\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 49, 'prompt_tokens': 26669, 'total_tokens': 26718, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8b50e7b0-2247-43d1-a22f-db8ce04da8e0-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'test/server-side-rendering/samples/nested-component-store/_expected.html', 'content': '<div><div>yay its enabled</div></div>\n'}, 'id': 'call_zIyddHv4LtdelFsZ29tVhYpO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26669, 'output_tokens': 49, 'total_tokens': 26718, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:44:45,290 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='test/server-side-rendering/samples/nested-component-store/main.html' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 17, 'prompt_tokens': 26748, 'total_tokens': 26765, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--d5721721-abea-448e-a98b-eabf5cb1d760-0' usage_metadata={'input_tokens': 26748, 'output_tokens': 17, 'total_tokens': 26765, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:44:45,374 - thread-135845298308800.prometheus.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html b/test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html
new file mode 100644
index 000000000..0429fe601
--- /dev/null
+++ b/test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html
@@ -0,0 +1,17 @@
+{{#if $hasTwoFactor}}
+<div>yay its enabled</div>
+{{else}}
+<div>oh no its not enabled</div>
+{{/if}}
+
+<script>
+	import { Store } from '../../../../store.js';
+
+	export default {
+		store() {
+			return new Store({
+				hasTwoFactor: true
+			});
+		}
+	};
+</script>
diff --git a/test/server-side-rendering/samples/nested-component-store/_expected.html b/test/server-side-rendering/samples/nested-component-store/_expected.html
new file mode 100644
index 000000000..fdf4ef302
--- /dev/null
+++ b/test/server-side-rendering/samples/nested-component-store/_expected.html
@@ -0,0 +1 @@
+<div><div>yay its enabled</div></div>
diff --git a/test/server-side-rendering/samples/nested-component-store/main.html b/test/server-side-rendering/samples/nested-component-store/main.html
new file mode 100644
index 000000000..e0d3d1b53
--- /dev/null
+++ b/test/server-side-rendering/samples/nested-component-store/main.html
@@ -0,0 +1,11 @@
+<div>
+	<TwoFactorAuth/>
+</div>
+
+<script>
+	import TwoFactorAuth from './TwoFactorAuth.html';
+
+	export default {
+		components: { TwoFactorAuth }
+	};
+</script>

2025-11-12 13:44:45,376 - thread-135845298308800.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-12 13:44:45,416 - thread-135845298308800.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-12 13:44:45,416 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-12 13:44:45,680 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:44:45,680 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 8057884cb Merge pull request #1097 from sveltejs/gh-1082-b
[?2004l
2025-11-12 13:44:45,680 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-12 13:44:45,782 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:44:45,782 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing Dockerfile
[?2004l
2025-11-12 13:44:45,783 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-12 13:44:45,783 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory test/server-side-rendering/samples/nested-component-store in the container
2025-11-12 13:44:45,783 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p test/server-side-rendering/samples/nested-component-store
2025-11-12 13:44:45,885 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:44:45,885 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 mkdir -p test/server-side-rendering/samples/nested-co
omponent-store
[?2004l
[?2004l
2025-11-12 13:44:45,886 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html in the container
2025-11-12 13:44:45,887 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/samples/nested-component-store/_expected.html in the container
2025-11-12 13:44:45,887 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/samples/nested-component-store/main.html in the container
2025-11-12 13:44:45,897 - thread-135845298308800.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-12 13:44:45,900 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - ERROR - Error in bug reproducing execute node: The bug reproducing patch added not one files
2025-11-12 13:45:15,090 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_structured_node - DEBUG - reproduced_bug=False reproduced_bug_failure_log="Test execution aborted.\n\nError output:\nTHE TEST WAS NOT EXECUTED BECAUSE OF AN ERROR: The bug reproducing patch added not one files\n\nExplanation:\n- The SSR sample 'test/server-side-rendering/samples/nested-component-store' was not fully added, so the test harness could not run it. As a result, no test was executed and the bug was not reproduced.\n- In addition, the sample does not use the exact example provided in the issue. The issue demonstrates a child component store defined via svelte-redux's connect, while the test uses a custom Store directly. To meet the reproduction requirements, the test should use the exact example:\n\nSuggested TwoFactorAuth.html (matching the issue example):\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n    import { connect } from '../../_redux';\n\n    export default {\n        store: connect(state => ({\n            hasTwoFactor: state.user && state.user.hasTwoFactor,\n        })),\n    };\n</script>\n\nAfter ensuring all files are added (main.html, TwoFactorAuth.html, and _expected.html) and using the exact example, running the SSR sample should fail with:\nCannot read property '_init' of undefined\nfrom the nested component’s _render (options.store._init), matching the reported bug." reproduced_bug_commands=['N/A - test did not execute due to patch error']
2025-11-12 13:45:15,093 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting bug_reproducing_file_messages in state.
2025-11-12 13:45:15,094 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting bug_reproducing_execute_messages in state.
2025-11-12 13:45:15,096 - thread-135845298308800.prometheus.lang_graph.nodes.git_reset_node - DEBUG - Resetting the git repository
2025-11-12 13:45:15,132 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_write_message_node - DEBUG - Sending message to BugReproducingWriteNode:
content="Your previous test case failed to reproduce the bug. Here is the failure log:\nTest execution aborted.\n\nError output:\nTHE TEST WAS NOT EXECUTED BECAUSE OF AN ERROR: The bug reproducing patch added not one files\n\nExplanation:\n- The SSR sample 'test/server-side-rendering/samples/nested-component-store' was not fully added, so the test harness could not run it. As a result, no test was executed and the bug was not reproduced.\n- In addition, the sample does not use the exact example provided in the issue. The issue demonstrates a child component store defined via svelte-redux's connect, while the test uses a custom Store directly. To meet the reproduction requirements, the test should use the exact example:\n\nSuggested TwoFactorAuth.html (matching the issue example):\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n    import { connect } from '../../_redux';\n\n    export default {\n        store: connect(state => ({\n            hasTwoFactor: state.user && state.user.hasTwoFactor,\n        })),\n    };\n</script>\n\nAfter ensuring all files are added (main.html, TwoFactorAuth.html, and _expected.html) and using the exact example, running the SSR sample should fail with:\nCannot read property '_init' of undefined\nfrom the nested component’s _render (options.store._init), matching the reported bug.\n\nNow think about what went wrong and generate the complete self-contained test case that reproduces the bug with the same error/exception again.\n" additional_kwargs={} response_metadata={}
2025-11-12 13:45:56,963 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='Add the following self-contained SSR sample and helper to reproduce the server-side error when a nested component defines its own store via svelte-redux connect. This uses the exact example from the issue and will currently fail with “Cannot read property \'_init\' of undefined” during SSR.\n\nFile: test/server-side-rendering/_redux.js\nexports.connect = function (mapFn) {\n  // Minimal mock of svelte-redux connect for SSR.\n  // Provides only _init to satisfy the compiler\'s SSR path.\n  return {\n    _init(keys) {\n      const mapped = mapFn({}); // emulate empty Redux state\n      const state = {};\n      keys.forEach(k => {\n        state[k] = mapped[k];\n      });\n      return state;\n    }\n  };\n};\n\nFile: test/server-side-rendering/samples/nested-component-store/main.html\n<div class="page">\n\t<h1>Manage Account</h1>\n\n\t<div>\n\t\t<h3>Two Factor Auth</h3>\n\t\t<TwoFactorAuth/>\n\t</div>\n</div>\n\n<script>\n\timport TwoFactorAuth from \'./TwoFactorAuth.html\';\n\n\texport default {\n\t\tcomponents: {\n\t\t\tTwoFactorAuth\n\t\t}\n\t};\n</script>\n\nFile: test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n\timport { connect } from \'../../_redux\';\n\n\texport default {\n\t\tstore: connect(state => ({\n\t\t\thasTwoFactor: state.user && state.user.hasTwoFactor,\n\t\t})),\n\t};\n</script>\n\nFile: test/server-side-rendering/samples/nested-component-store/_expected.html\n<div><div>oh no its not enabled</div></div>' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 3779, 'prompt_tokens': 11144, 'total_tokens': 14923, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 3392, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--fa8f9b6b-eb29-4b97-b772-a99a93157b72-0' usage_metadata={'input_tokens': 11144, 'output_tokens': 3779, 'total_tokens': 14923, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 3392}}
2025-11-12 13:46:08,983 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_NitOfQsMxKbJyB7hLk7vqi9l', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/index.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 863, 'prompt_tokens': 26475, 'total_tokens': 27338, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b5a47f2f-a2b6-42b3-81f3-6d1ce5425c8b-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/server-side-rendering/index.js'}, 'id': 'call_NitOfQsMxKbJyB7hLk7vqi9l', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26475, 'output_tokens': 863, 'total_tokens': 27338, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 13:46:57,851 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Ae8IkJ1lOx95cphWWJG96Adq', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/_redux.js","content":"exports.connect = function (mapFn) {\\n  // Minimal mock of svelte-redux connect for SSR.\\n  // Provides only _init to satisfy the compiler\'s SSR path.\\n  return {\\n    _init(keys) {\\n      const mapped = mapFn({}); // emulate empty Redux state\\n      const state = {};\\n      keys.forEach(k => {\\n        state[k] = mapped[k];\\n      });\\n      return state;\\n    }\\n  };\\n};\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 4046, 'prompt_tokens': 27767, 'total_tokens': 31813, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 3904, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--826bae7a-422a-44b3-8299-69eec5b91334-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'test/server-side-rendering/_redux.js', 'content': "exports.connect = function (mapFn) {\n  // Minimal mock of svelte-redux connect for SSR.\n  // Provides only _init to satisfy the compiler's SSR path.\n  return {\n    _init(keys) {\n      const mapped = mapFn({}); // emulate empty Redux state\n      const state = {};\n      keys.forEach(k => {\n        state[k] = mapped[k];\n      });\n      return state;\n    }\n  };\n};\n"}, 'id': 'call_Ae8IkJ1lOx95cphWWJG96Adq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 27767, 'output_tokens': 4046, 'total_tokens': 31813, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 3904}}
2025-11-12 13:46:59,904 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ICml7VYypzpmxhklGKLHpVxM', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/nested-component-store/main.html","content":"<div class=\\"page\\">\\n\\t<h1>Manage Account</h1>\\n\\n\\t<div>\\n\\t\\t<h3>Two Factor Auth</h3>\\n\\t\\t<TwoFactorAuth/>\\n\\t</div>\\n</div>\\n\\n<script>\\n\\timport TwoFactorAuth from \'./TwoFactorAuth.html\';\\n\\n\\texport default {\\n\\t\\tcomponents: {\\n\\t\\t\\tTwoFactorAuth\\n\\t\\t}\\n\\t};\\n</script>\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 138, 'prompt_tokens': 27927, 'total_tokens': 28065, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 26368}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3d4707cf-60ca-4053-b705-17ea318415f9-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'test/server-side-rendering/samples/nested-component-store/main.html', 'content': '<div class="page">\n\t<h1>Manage Account</h1>\n\n\t<div>\n\t\t<h3>Two Factor Auth</h3>\n\t\t<TwoFactorAuth/>\n\t</div>\n</div>\n\n<script>\n\timport TwoFactorAuth from \'./TwoFactorAuth.html\';\n\n\texport default {\n\t\tcomponents: {\n\t\t\tTwoFactorAuth\n\t\t}\n\t};\n</script>\n'}, 'id': 'call_ICml7VYypzpmxhklGKLHpVxM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 27927, 'output_tokens': 138, 'total_tokens': 28065, 'input_token_details': {'audio': 0, 'cache_read': 26368}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:47:02,428 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6xkSLOQyJHcohjzfpYCzOTwD', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html","content":"{{#if $hasTwoFactor}}\\n<div>yay its enabled</div>\\n{{else}}\\n<div>oh no its not enabled</div>\\n{{/if}}\\n\\n<script>\\n\\timport { connect } from \'../../_redux\';\\n\\n\\texport default {\\n\\t\\tstore: connect(state => ({\\n\\t\\t\\thasTwoFactor: state.user && state.user.hasTwoFactor,\\n\\t\\t})),\\n\\t};\\n</script>\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 140, 'prompt_tokens': 28094, 'total_tokens': 28234, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--609f601e-28ca-4478-9c23-86f558ba2ddb-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html', 'content': "{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n\timport { connect } from '../../_redux';\n\n\texport default {\n\t\tstore: connect(state => ({\n\t\t\thasTwoFactor: state.user && state.user.hasTwoFactor,\n\t\t})),\n\t};\n</script>\n"}, 'id': 'call_6xkSLOQyJHcohjzfpYCzOTwD', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28094, 'output_tokens': 140, 'total_tokens': 28234, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:47:06,448 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ajq34CCnYb1hcFINE9IU2dJs', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/samples/nested-component-store/_expected.html","content":"<div><div>oh no its not enabled</div></div>\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 51, 'prompt_tokens': 28266, 'total_tokens': 28317, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--94660b09-3689-421f-9245-8b62472df5ec-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'test/server-side-rendering/samples/nested-component-store/_expected.html', 'content': '<div><div>oh no its not enabled</div></div>\n'}, 'id': 'call_ajq34CCnYb1hcFINE9IU2dJs', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28266, 'output_tokens': 51, 'total_tokens': 28317, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:47:08,757 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='test/server-side-rendering/samples/nested-component-store/main.html' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 17, 'prompt_tokens': 28347, 'total_tokens': 28364, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--f21e2000-0ede-4916-9a12-ea2a95a2a8e2-0' usage_metadata={'input_tokens': 28347, 'output_tokens': 17, 'total_tokens': 28364, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:47:08,801 - thread-135845298308800.prometheus.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/test/server-side-rendering/_redux.js b/test/server-side-rendering/_redux.js
new file mode 100644
index 000000000..ef33b733d
--- /dev/null
+++ b/test/server-side-rendering/_redux.js
@@ -0,0 +1,14 @@
+exports.connect = function (mapFn) {
+  // Minimal mock of svelte-redux connect for SSR.
+  // Provides only _init to satisfy the compiler's SSR path.
+  return {
+    _init(keys) {
+      const mapped = mapFn({}); // emulate empty Redux state
+      const state = {};
+      keys.forEach(k => {
+        state[k] = mapped[k];
+      });
+      return state;
+    }
+  };
+};
diff --git a/test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html b/test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html
new file mode 100644
index 000000000..c9449d5f4
--- /dev/null
+++ b/test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html
@@ -0,0 +1,15 @@
+{{#if $hasTwoFactor}}
+<div>yay its enabled</div>
+{{else}}
+<div>oh no its not enabled</div>
+{{/if}}
+
+<script>
+	import { connect } from '../../_redux';
+
+	export default {
+		store: connect(state => ({
+			hasTwoFactor: state.user && state.user.hasTwoFactor,
+		})),
+	};
+</script>
diff --git a/test/server-side-rendering/samples/nested-component-store/_expected.html b/test/server-side-rendering/samples/nested-component-store/_expected.html
new file mode 100644
index 000000000..f0b1eba05
--- /dev/null
+++ b/test/server-side-rendering/samples/nested-component-store/_expected.html
@@ -0,0 +1 @@
+<div><div>oh no its not enabled</div></div>
diff --git a/test/server-side-rendering/samples/nested-component-store/main.html b/test/server-side-rendering/samples/nested-component-store/main.html
new file mode 100644
index 000000000..dfedeb445
--- /dev/null
+++ b/test/server-side-rendering/samples/nested-component-store/main.html
@@ -0,0 +1,18 @@
+<div class="page">
+	<h1>Manage Account</h1>
+
+	<div>
+		<h3>Two Factor Auth</h3>
+		<TwoFactorAuth/>
+	</div>
+</div>
+
+<script>
+	import TwoFactorAuth from './TwoFactorAuth.html';
+
+	export default {
+		components: {
+			TwoFactorAuth
+		}
+	};
+</script>

2025-11-12 13:47:08,803 - thread-135845298308800.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-12 13:47:08,840 - thread-135845298308800.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-12 13:47:08,840 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-12 13:47:08,960 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:47:08,960 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 8057884cb Merge pull request #1097 from sveltejs/gh-1082-b
[?2004l
2025-11-12 13:47:08,960 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-12 13:47:09,062 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:47:09,062 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing test/server-side-rendering/samples/nested-component-store/
[?2004l
2025-11-12 13:47:09,063 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-12 13:47:09,063 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory test/server-side-rendering in the container
2025-11-12 13:47:09,063 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p test/server-side-rendering
2025-11-12 13:47:09,165 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:47:09,165 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 13:47:09,165 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory test/server-side-rendering/samples/nested-component-store in the container
2025-11-12 13:47:09,165 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p test/server-side-rendering/samples/nested-component-store
2025-11-12 13:47:09,267 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:47:09,267 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 mkdir -p test/server-side-rendering/samples/nested-co
omponent-store
[?2004l
[?2004l
2025-11-12 13:47:09,268 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/_redux.js in the container
2025-11-12 13:47:09,269 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/samples/nested-component-store/TwoFactorAuth.html in the container
2025-11-12 13:47:09,270 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/samples/nested-component-store/_expected.html in the container
2025-11-12 13:47:09,270 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/samples/nested-component-store/main.html in the container
2025-11-12 13:47:09,280 - thread-135845298308800.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-12 13:47:09,282 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - ERROR - Error in bug reproducing execute node: The bug reproducing patch added not one files
2025-11-12 13:47:40,564 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_structured_node - DEBUG - reproduced_bug=False reproduced_bug_failure_log='THE TEST WAS NOT EXECUTED BECAUSE OF AN ERROR: The bug reproducing patch added not one files\n\nExplanation:\nThe SSR bug reproduction was not run at all due to a repository/test harness constraint that only allows adding exactly one file in the patch. The provided reproduction adds multiple files (redux mock, main component, nested component, and expected output), so the harness aborted before executing the sample. Because the test never executed, we cannot verify the failure "Cannot read property \'_init\' of undefined" as described in the issue.\n\nTo properly reproduce the bug, the test needs to be integrated in a way that complies with the single-file addition requirement (e.g., consolidate the sample into a single test file or follow the repository\'s prescribed test fixture format). Once executed, the sample should render the nested component during SSR and fail with "Cannot read property \'_init\' of undefined" originating from TwoFactorAuth\'s _render when options.store is undefined, matching the issue.' reproduced_bug_commands=[]
2025-11-12 13:47:40,566 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting bug_reproducing_file_messages in state.
2025-11-12 13:47:40,567 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting bug_reproducing_execute_messages in state.
2025-11-12 13:47:40,568 - thread-135845298308800.prometheus.lang_graph.nodes.git_reset_node - DEBUG - Resetting the git repository
2025-11-12 13:47:40,605 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_write_message_node - DEBUG - Sending message to BugReproducingWriteNode:
content='Your previous test case failed to reproduce the bug. Here is the failure log:\nTHE TEST WAS NOT EXECUTED BECAUSE OF AN ERROR: The bug reproducing patch added not one files\n\nExplanation:\nThe SSR bug reproduction was not run at all due to a repository/test harness constraint that only allows adding exactly one file in the patch. The provided reproduction adds multiple files (redux mock, main component, nested component, and expected output), so the harness aborted before executing the sample. Because the test never executed, we cannot verify the failure "Cannot read property \'_init\' of undefined" as described in the issue.\n\nTo properly reproduce the bug, the test needs to be integrated in a way that complies with the single-file addition requirement (e.g., consolidate the sample into a single test file or follow the repository\'s prescribed test fixture format). Once executed, the sample should render the nested component during SSR and fail with "Cannot read property \'_init\' of undefined" originating from TwoFactorAuth\'s _render when options.store is undefined, matching the issue.\n\nNow think about what went wrong and generate the complete self-contained test case that reproduces the bug with the same error/exception again.\n' additional_kwargs={} response_metadata={}
2025-11-12 13:49:14,717 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='File: test/server-side-rendering/nested-component-store.spec.js\nimport assert from \'assert\';\nimport { loadSvelte, setupHtmlEqual } from \'../helpers.js\';\n\ndescribe(\'ssr nested component store via connect\', () => {\n  let svelte;\n\n  before(() => {\n    svelte = loadSvelte(true);\n    setupHtmlEqual();\n  });\n\n  function compileCjs(source, options) {\n    const { code } = svelte.compile(source, Object.assign({ format: \'cjs\' }, options));\n    const module = { exports: {} };\n    const exports = module.exports;\n    const fn = new Function(\'module\', \'exports\', \'TwoFactorAuth\', `${code}; return module.exports;`);\n    return {\n      evalWith(scope = {}) {\n        return fn(module, exports, scope.TwoFactorAuth);\n      }\n    };\n  }\n\n  it(\'renders nested component that defines its own store via connect without crashing\', () => {\n    const childSource = `\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n  // Minimal inline connect to mirror svelte-redux\'s API shape for SSR\n  function connect(mapFn) {\n    return {\n      _init(keys) {\n        const mapped = mapFn({}); // emulate empty Redux state server-side\n        const state = {};\n        keys.forEach(k => { state[k] = mapped[k]; });\n        return state;\n      }\n    };\n  }\n\n  export default {\n    store: connect(state => ({\n      hasTwoFactor: state.user && state.user.hasTwoFactor,\n    })),\n  };\n</script>\n    `;\n\n    const parentSource = `\n<div class="page">\n  <h1>Manage Account</h1>\n  <div>\n    <h3>Two Factor Auth</h3>\n    <TwoFactorAuth/>\n  </div>\n</div>\n\n<script>\n  export default {\n    components: { TwoFactorAuth }\n  };\n</script>\n    `;\n\n    // Compile child (TwoFactorAuth) for SSR\n    const childMod = compileCjs(childSource, { generate: \'ssr\', name: \'TwoFactorAuth\' }).evalWith();\n    const TwoFactorAuth = childMod.default || childMod;\n\n    // Compile parent for SSR, injecting the child component via components mapping\n    const parentMod = compileCjs(parentSource, { generate: \'ssr\', name: \'ManageAccount\' }).evalWith({ TwoFactorAuth });\n    const Parent = parentMod.default || parentMod;\n\n    // This will currently throw: Cannot read property \'_init\' of undefined\n    // because SSR passes the parent options.store (undefined) to child._render.\n    const { html } = Parent.render();\n\n    assert.htmlEqual(\n      html,\n      \'<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>\'\n    );\n  });\n})' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 7234, 'prompt_tokens': 11770, 'total_tokens': 19004, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 6592, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--7cb66efb-10d2-4688-a794-cb6dc7c2f3a0-0' usage_metadata={'input_tokens': 11770, 'output_tokens': 7234, 'total_tokens': 19004, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 6592}}
2025-11-12 13:49:19,355 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_2658lKXbtfg2fR6p5VDIDWAR', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/index.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 95, 'prompt_tokens': 26730, 'total_tokens': 26825, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0370fd58-ffc7-4fef-850b-c7245f68d4a4-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/server-side-rendering/index.js'}, 'id': 'call_2658lKXbtfg2fR6p5VDIDWAR', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26730, 'output_tokens': 95, 'total_tokens': 26825, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 13:49:22,963 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6AsHgISW9hBv2XRZz4Jx4HZB', 'function': {'arguments': '{"relative_path":"test/test.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 91, 'prompt_tokens': 28022, 'total_tokens': 28113, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--087f1b26-38d4-4ef9-949c-72da5151a5c2-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/test.js'}, 'id': 'call_6AsHgISW9hBv2XRZz4Jx4HZB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28022, 'output_tokens': 91, 'total_tokens': 28113, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 13:49:26,960 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Q9PA06XyMq2xweibo1gZiVZi', 'function': {'arguments': '{"relative_path":"test/helpers.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 219, 'prompt_tokens': 28148, 'total_tokens': 28367, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--69024c55-6a29-41cd-acda-553cfaff971a-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/helpers.js'}, 'id': 'call_Q9PA06XyMq2xweibo1gZiVZi', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28148, 'output_tokens': 219, 'total_tokens': 28367, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 13:49:34,578 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ckKzxTEhN1e8ZEwQ1Fusiinq', 'function': {'arguments': '{"relative_path":"test/js/index.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 540, 'prompt_tokens': 30302, 'total_tokens': 30842, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--55719c8e-e25e-4e45-bd2e-2a5aacedbd80-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/js/index.js'}, 'id': 'call_ckKzxTEhN1e8ZEwQ1Fusiinq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30302, 'output_tokens': 540, 'total_tokens': 30842, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 13:49:50,617 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_9EIDsdQoy3BQoLxzxpzpeTah', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/nested-component-store.spec.js","content":"import assert from \'assert\';\\nimport { loadSvelte, setupHtmlEqual } from \'../helpers.js\';\\n\\ndescribe(\'ssr nested component store via connect\', () => {\\n  let svelte;\\n\\n  before(() => {\\n    svelte = loadSvelte(true);\\n    setupHtmlEqual();\\n  });\\n\\n  function compileCjs(source, options) {\\n    const { code } = svelte.compile(source, Object.assign({ format: \'cjs\' }, options));\\n    const module = { exports: {} };\\n    const exports = module.exports;\\n    const fn = new Function(\'module\', \'exports\', \'TwoFactorAuth\', `${code}; return module.exports;`);\\n    return {\\n      evalWith(scope = {}) {\\n        return fn(module, exports, scope.TwoFactorAuth);\\n      }\\n    };\\n  }\\n\\n  it(\'renders nested component that defines its own store via connect without crashing\', () => {\\n    const childSource = `\\n{{#if $hasTwoFactor}}\\n<div>yay its enabled</div>\\n{{else}}\\n<div>oh no its not enabled</div>\\n{{/if}}\\n\\n<script>\\n  // Minimal inline connect to mirror svelte-redux\'s API shape for SSR\\n  function connect(mapFn) {\\n    return {\\n      _init(keys) {\\n        const mapped = mapFn({}); // emulate empty Redux state server-side\\n        const state = {};\\n        keys.forEach(k => { state[k] = mapped[k]; });\\n        return state;\\n      }\\n    };\\n  }\\n\\n  export default {\\n    store: connect(state => ({\\n      hasTwoFactor: state.user && state.user.hasTwoFactor,\\n    })),\\n  };\\n</script>\\n    `;\\n\\n    const parentSource = `\\n<div class=\\"page\\">\\n  <h1>Manage Account</h1>\\n  <div>\\n    <h3>Two Factor Auth</h3>\\n    <TwoFactorAuth/>\\n  </div>\\n</div>\\n\\n<script>\\n  export default {\\n    components: { TwoFactorAuth }\\n  };\\n</script>\\n    `;\\n\\n    // Compile child (TwoFactorAuth) for SSR\\n    const childMod = compileCjs(childSource, { generate: \'ssr\', name: \'TwoFactorAuth\' }).evalWith();\\n    const TwoFactorAuth = childMod.default || childMod;\\n\\n    // Compile parent for SSR, injecting the child component via components mapping\\n    const parentMod = compileCjs(parentSource, { generate: \'ssr\', name: \'ManageAccount\' }).evalWith({ TwoFactorAuth });\\n    const Parent = parentMod.default || parentMod;\\n\\n    // This will currently throw: Cannot read property \'_init\' of undefined\\n    // because SSR passes the parent options.store (undefined) to child._render.\\n    const { html } = Parent.render();\\n\\n    assert.htmlEqual(\\n      html,\\n      \'<div class=\\"page\\"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>\'\\n    );\\n  });\\n})\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1917, 'prompt_tokens': 31083, 'total_tokens': 33000, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1152, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8ed66de6-e62b-4ae8-acf3-0b9790b1cb0e-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'test/server-side-rendering/nested-component-store.spec.js', 'content': 'import assert from \'assert\';\nimport { loadSvelte, setupHtmlEqual } from \'../helpers.js\';\n\ndescribe(\'ssr nested component store via connect\', () => {\n  let svelte;\n\n  before(() => {\n    svelte = loadSvelte(true);\n    setupHtmlEqual();\n  });\n\n  function compileCjs(source, options) {\n    const { code } = svelte.compile(source, Object.assign({ format: \'cjs\' }, options));\n    const module = { exports: {} };\n    const exports = module.exports;\n    const fn = new Function(\'module\', \'exports\', \'TwoFactorAuth\', `${code}; return module.exports;`);\n    return {\n      evalWith(scope = {}) {\n        return fn(module, exports, scope.TwoFactorAuth);\n      }\n    };\n  }\n\n  it(\'renders nested component that defines its own store via connect without crashing\', () => {\n    const childSource = `\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n  // Minimal inline connect to mirror svelte-redux\'s API shape for SSR\n  function connect(mapFn) {\n    return {\n      _init(keys) {\n        const mapped = mapFn({}); // emulate empty Redux state server-side\n        const state = {};\n        keys.forEach(k => { state[k] = mapped[k]; });\n        return state;\n      }\n    };\n  }\n\n  export default {\n    store: connect(state => ({\n      hasTwoFactor: state.user && state.user.hasTwoFactor,\n    })),\n  };\n</script>\n    `;\n\n    const parentSource = `\n<div class="page">\n  <h1>Manage Account</h1>\n  <div>\n    <h3>Two Factor Auth</h3>\n    <TwoFactorAuth/>\n  </div>\n</div>\n\n<script>\n  export default {\n    components: { TwoFactorAuth }\n  };\n</script>\n    `;\n\n    // Compile child (TwoFactorAuth) for SSR\n    const childMod = compileCjs(childSource, { generate: \'ssr\', name: \'TwoFactorAuth\' }).evalWith();\n    const TwoFactorAuth = childMod.default || childMod;\n\n    // Compile parent for SSR, injecting the child component via components mapping\n    const parentMod = compileCjs(parentSource, { generate: \'ssr\', name: \'ManageAccount\' }).evalWith({ TwoFactorAuth });\n    const Parent = parentMod.default || parentMod;\n\n    // This will currently throw: Cannot read property \'_init\' of undefined\n    // because SSR passes the parent options.store (undefined) to child._render.\n    const { html } = Parent.render();\n\n    assert.htmlEqual(\n      html,\n      \'<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>\'\n    );\n  });\n})\n'}, 'id': 'call_9EIDsdQoy3BQoLxzxpzpeTah', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31083, 'output_tokens': 1917, 'total_tokens': 33000, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1152}}
2025-11-12 13:49:53,460 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='test/server-side-rendering/nested-component-store.spec.js' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 15, 'prompt_tokens': 31869, 'total_tokens': 31884, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--a90e0384-9662-440a-b3de-c6089ba45bdf-0' usage_metadata={'input_tokens': 31869, 'output_tokens': 15, 'total_tokens': 31884, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:49:53,531 - thread-135845298308800.prometheus.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/test/server-side-rendering/nested-component-store.spec.js b/test/server-side-rendering/nested-component-store.spec.js
new file mode 100644
index 000000000..89d3c1faa
--- /dev/null
+++ b/test/server-side-rendering/nested-component-store.spec.js
@@ -0,0 +1,86 @@
+import assert from 'assert';
+import { loadSvelte, setupHtmlEqual } from '../helpers.js';
+
+describe('ssr nested component store via connect', () => {
+  let svelte;
+
+  before(() => {
+    svelte = loadSvelte(true);
+    setupHtmlEqual();
+  });
+
+  function compileCjs(source, options) {
+    const { code } = svelte.compile(source, Object.assign({ format: 'cjs' }, options));
+    const module = { exports: {} };
+    const exports = module.exports;
+    const fn = new Function('module', 'exports', 'TwoFactorAuth', `${code}; return module.exports;`);
+    return {
+      evalWith(scope = {}) {
+        return fn(module, exports, scope.TwoFactorAuth);
+      }
+    };
+  }
+
+  it('renders nested component that defines its own store via connect without crashing', () => {
+    const childSource = `
+{{#if $hasTwoFactor}}
+<div>yay its enabled</div>
+{{else}}
+<div>oh no its not enabled</div>
+{{/if}}
+
+<script>
+  // Minimal inline connect to mirror svelte-redux's API shape for SSR
+  function connect(mapFn) {
+    return {
+      _init(keys) {
+        const mapped = mapFn({}); // emulate empty Redux state server-side
+        const state = {};
+        keys.forEach(k => { state[k] = mapped[k]; });
+        return state;
+      }
+    };
+  }
+
+  export default {
+    store: connect(state => ({
+      hasTwoFactor: state.user && state.user.hasTwoFactor,
+    })),
+  };
+</script>
+    `;
+
+    const parentSource = `
+<div class="page">
+  <h1>Manage Account</h1>
+  <div>
+    <h3>Two Factor Auth</h3>
+    <TwoFactorAuth/>
+  </div>
+</div>
+
+<script>
+  export default {
+    components: { TwoFactorAuth }
+  };
+</script>
+    `;
+
+    // Compile child (TwoFactorAuth) for SSR
+    const childMod = compileCjs(childSource, { generate: 'ssr', name: 'TwoFactorAuth' }).evalWith();
+    const TwoFactorAuth = childMod.default || childMod;
+
+    // Compile parent for SSR, injecting the child component via components mapping
+    const parentMod = compileCjs(parentSource, { generate: 'ssr', name: 'ManageAccount' }).evalWith({ TwoFactorAuth });
+    const Parent = parentMod.default || parentMod;
+
+    // This will currently throw: Cannot read property '_init' of undefined
+    // because SSR passes the parent options.store (undefined) to child._render.
+    const { html } = Parent.render();
+
+    assert.htmlEqual(
+      html,
+      '<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>'
+    );
+  });
+})

2025-11-12 13:49:53,533 - thread-135845298308800.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-12 13:49:53,566 - thread-135845298308800.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-12 13:49:53,566 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-12 13:49:53,668 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:49:53,668 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 8057884cb Merge pull request #1097 from sveltejs/gh-1082-b
[?2004l
2025-11-12 13:49:53,668 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-12 13:49:53,770 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:49:53,770 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing test/server-side-rendering/_redux.js
Removing test/server-side-rendering/samples/nested-component-store/
[?2004l
2025-11-12 13:49:53,771 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-12 13:49:53,771 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory test/server-side-rendering in the container
2025-11-12 13:49:53,771 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p test/server-side-rendering
2025-11-12 13:49:53,873 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:49:53,873 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 13:49:53,874 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/nested-component-store.spec.js in the container
2025-11-12 13:49:53,882 - thread-135845298308800.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-12 13:49:58,753 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_7xVqxKGazozefAAPwigZgGCi', 'function': {'arguments': '{"command":"ls -la"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 218, 'prompt_tokens': 810, 'total_tokens': 1028, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8589f01c-e0ae-414b-91ab-451c65f834cc-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la'}, 'id': 'call_7xVqxKGazozefAAPwigZgGCi', 'type': 'tool_call'}] usage_metadata={'input_tokens': 810, 'output_tokens': 218, 'total_tokens': 1028, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 13:49:58,757 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la
2025-11-12 13:49:58,858 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:49:58,858 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 824
drwxr-xr-x   1 root root   4096 Nov 12 13:44 [0m[01;34m.[0m
drwxr-xr-x   1 root root   4096 Nov 12 13:49 [01;34m..[0m
-rw-r--r--   1 root root    227 Nov 12 13:44 .editorconfig
-rw-r--r--   1 root root     85 Nov 12 13:44 .eslintignore
-rw-r--r--   1 root root   1239 Nov 12 13:44 .eslintrc.json
-rw-r--r--   1 root root     78 Nov 12 13:44 .flowconfig
drwxrwxr-x   1 root root   4096 Nov 12 13:49 [01;34m.git[0m
drwxrwxr-x   1 root root   4096 Nov 12 13:44 [01;34m.github[0m
-rw-r--r--   1 root root    289 Nov 12 13:44 .gitignore
-rw-r--r--   1 root root     51 Nov 12 13:44 .prettierrc
-rw-r--r--   1 root root    270 Nov 12 13:44 .travis.yml
-rw-r--r--   1 root root  44966 Nov 12 13:44 CHANGELOG.md
-rw-r--r--   1 root root   1114 Nov 12 13:44 LICENSE
-rw-r--r--   1 root root   8621 Nov 12 13:44 README.md
-rw-r--r--   1 root root    556 Nov 12 13:44 appveyor.yml
drwxr-xr-x   1 root root   4096 Aug 28 02:30 [01;34mcompiler[0m
-rw-r--r--   1 root root    105 Nov 12 13:44 mocha.coverage.opts
-rw-r--r--   1 root root     12 Nov 12 13:44 mocha.opts
drwxr-xr-x 408 root root  16384 Aug 28 02:30 [01;34mnode_modules[0m
-rw-r--r--   1 root root 500424 Aug 28 02:30 package-lock.json
-rw-r--r--   1 root root   2558 Nov 12 13:44 package.json
-rw-r--r--   1 root root   1796 Nov 12 13:44 rollup.config.js
-rw-r--r--   1 root root    128 Nov 12 13:44 rollup.store.config.js
-rw-r--r--   1 root root  14889 Nov 12 13:38 shared.js
drwxrwxr-x   1 root root   4096 Nov 12 13:44 [01;34msrc[0m
drwxr-xr-x   1 root root   4096 Aug 28 02:30 [01;34mssr[0m
-rw-r--r--   1 root root   3515 Nov 12 13:44 store.js
-rw-r--r--   1 root root   5166 Nov 12 13:38 store.umd.js
drwxrwxr-x   1 root root   4096 Nov 12 13:44 [01;34mtest[0m
-rw-r--r--   1 root root    326 Nov 12 13:44 tsconfig.json
-rw-r--r--   1 root root 120024 Nov 12 13:44 yarn.lock
[?2004l
2025-11-12 13:50:01,127 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_wxk3UW86DQnumosoF0Ca8gCn', 'function': {'arguments': '{"command":"cat package.json"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 1739, 'total_tokens': 1765, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--767e3279-e89a-4496-9fff-83279f2e0da0-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat package.json'}, 'id': 'call_wxk3UW86DQnumosoF0Ca8gCn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1739, 'output_tokens': 26, 'total_tokens': 1765, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:50:01,132 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat package.json
2025-11-12 13:50:01,234 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:01,234 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
{
  "name": "svelte",
  "version": "1.51.1",
  "description": "The magical disappearing UI framework",
  "main": "compiler/svelte.js",
  "files": [
    "compiler",
    "ssr",
    "shared.js",
    "store.js",
    "store.umd.js",
    "README.md"
  ],
  "scripts": {
    "test": "mocha --opts mocha.opts",
    "quicktest": "mocha --opts mocha.opts",
    "precoverage": "export COVERAGE=true && nyc mocha --opts mocha.coverage.opts",
    "coverage": "nyc report --reporter=text-lcov > coverage.lcov",
    "codecov": "codecov",
    "precodecov": "npm run coverage",
    "lint": "eslint src test/*.js",
    "build": "node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js",
    "prepare": "npm run build",
    "dev": "node src/shared/_build.js && rollup -c -w",
    "pretest": "npm run build",
    "prepublishOnly": "npm run lint && npm test",
    "prettier": "prettier --write \"src/**/*.ts\""
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/sveltejs/svelte.git"
  },
  "keywords": [
    "UI",
    "framework",
    "templates",
    "templating"
  ],
  "author": "Rich Harris",
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/sveltejs/svelte/issues"
  },
  "homepage": "https://github.com/sveltejs/svelte#README",
  "devDependencies": {
    "@types/mocha": "^2.2.41",
    "@types/node": "^8.0.17",
    "acorn": "^5.1.1",
    "acorn-dynamic-import": "^2.0.2",
    "chalk": "^2.0.1",
    "codecov": "^2.2.0",
    "console-group": "^0.3.2",
    "css-tree": "1.0.0-alpha22",
    "eslint": "^4.3.0",
    "eslint-plugin-html": "^3.0.0",
    "eslint-plugin-import": "^2.2.0",
    "estree-walker": "^0.5.1",
    "glob": "^7.1.1",
    "is-reference": "^1.1.0",
    "jsdom": "^11.1.0",
    "locate-character": "^2.0.0",
    "magic-string": "^0.22.3",
    "mocha": "^3.2.0",
    "nightmare": "^2.10.0",
    "node-resolve": "^1.3.3",
    "nyc": "^11.1.0",
    "prettier": "^1.7.0",
    "reify": "^0.12.3",
    "rollup": "^0.48.2",
    "rollup-plugin-buble": "^0.15.0",
    "rollup-plugin-commonjs": "^8.0.2",
    "rollup-plugin-json": "^2.1.0",
    "rollup-plugin-node-resolve": "^3.0.0",
    "rollup-plugin-replace": "^2.0.0",
    "rollup-plugin-typescript": "^0.8.1",
    "rollup-plugin-virtual": "^1.0.1",
    "rollup-watch": "^4.3.1",
    "source-map": "^0.5.6",
    "source-map-support": "^0.4.8",
    "ts-node": "^3.3.0",
    "tslib": "^1.8.0",
    "typescript": "^2.6.1"
  },
  "nyc": {
    "include": [
      "compiler/svelte.js",
      "shared.js"
    ],
    "sourceMap": true,
    "instrument": true
  }
}
[?2004l
2025-11-12 13:50:07,759 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hzawvrF4PqBJm0zTMGnW67c1', 'function': {'arguments': '{"command":"cat mocha.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 410, 'prompt_tokens': 2695, 'total_tokens': 3105, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d320d1e1-3fd7-4847-8a5d-cab6d03ee03d-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat mocha.opts'}, 'id': 'call_hzawvrF4PqBJm0zTMGnW67c1', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2695, 'output_tokens': 410, 'total_tokens': 3105, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 13:50:07,762 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat mocha.opts
2025-11-12 13:50:07,864 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:07,864 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 13:50:13,937 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_jkdG2qBq3gAEKnww3yWIUZvt', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/server-side-rendering/nested-component-store.spec.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 363, 'prompt_tokens': 2738, 'total_tokens': 3101, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2688}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--80c2279b-ce8a-4e5d-a0b1-e06b7ead0b66-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/server-side-rendering/nested-component-store.spec.js"}, 'id': 'call_jkdG2qBq3gAEKnww3yWIUZvt', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2738, 'output_tokens': 363, 'total_tokens': 3101, 'input_token_details': {'audio': 0, 'cache_read': 2688}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 13:50:13,940 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/server-side-rendering/nested-component-store.spec.js
2025-11-12 13:50:14,042 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:14,042 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 sed -n '1,200p' test/server-side-rendering/nested-com
mponent-store.spec.js
[?2004l
import assert from 'assert';
import { loadSvelte, setupHtmlEqual } from '../helpers.js';

describe('ssr nested component store via connect', () => {
  let svelte;

  before(() => {
    svelte = loadSvelte(true);
    setupHtmlEqual();
  });

  function compileCjs(source, options) {
    const { code } = svelte.compile(source, Object.assign({ format: 'cjs' }, options));
    const module = { exports: {} };
    const exports = module.exports;
    const fn = new Function('module', 'exports', 'TwoFactorAuth', `${code}; return module.exports;`);
    return {
      evalWith(scope = {}) {
        return fn(module, exports, scope.TwoFactorAuth);
      }
    };
  }

  it('renders nested component that defines its own store via connect without crashing', () => {
    const childSource = `
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
  // Minimal inline connect to mirror svelte-redux's API shape for SSR
  function connect(mapFn) {
    return {
      _init(keys) {
        const mapped = mapFn({}); // emulate empty Redux state server-side
        const state = {};
        keys.forEach(k => { state[k] = mapped[k]; });
        return state;
      }
    };
  }

  export default {
    store: connect(state => ({
      hasTwoFactor: state.user && state.user.hasTwoFactor,
    })),
  };
</script>
    `;

    const parentSource = `
<div class="page">
  <h1>Manage Account</h1>
  <div>
    <h3>Two Factor Auth</h3>
    <TwoFactorAuth/>
  </div>
</div>

<script>
  export default {
    components: { TwoFactorAuth }
  };
</script>
    `;

    // Compile child (TwoFactorAuth) for SSR
    const childMod = compileCjs(childSource, { generate: 'ssr', name: 'TwoFactorAuth' }).evalWith();
    const TwoFactorAuth = childMod.default || childMod;

    // Compile parent for SSR, injecting the child component via components mapping
    const parentMod = compileCjs(parentSource, { generate: 'ssr', name: 'ManageAccount' }).evalWith({ TwoFactorAuth });
    const Parent = parentMod.default || parentMod;

    // This will currently throw: Cannot read property '_init' of undefined
    // because SSR passes the parent options.store (undefined) to child._render.
    const { html } = Parent.render();

    assert.htmlEqual(
      html,
      '<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>'
    );
  });
})
[?2004l
2025-11-12 13:50:18,767 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_dZNNOqYK26ZwO1ZSUMkcQkCU', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/helpers.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 291, 'prompt_tokens': 3440, 'total_tokens': 3731, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--301c28df-689b-4af0-94f0-173d4fd126cb-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/helpers.js"}, 'id': 'call_dZNNOqYK26ZwO1ZSUMkcQkCU', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3440, 'output_tokens': 291, 'total_tokens': 3731, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 13:50:18,771 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/helpers.js
2025-11-12 13:50:18,872 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:18,872 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import { JSDOM } from 'jsdom';
import assert from 'assert';
import glob from 'glob';
import fs from 'fs';
import path from 'path';
import chalk from 'chalk';

// for coverage purposes, we need to test source files,
// but for sanity purposes, we need to test dist files
export function loadSvelte(test) {
	process.env.TEST = test ? 'true' : '';

	const resolved = require.resolve('../compiler/svelte.js');

	delete require.cache[resolved];
	return require(resolved);
}

export const svelte = loadSvelte();

export function exists(path) {
	try {
		fs.statSync(path);
		return true;
	} catch (err) {
		return false;
	}
}

export function tryToLoadJson(file) {
	try {
		return JSON.parse(fs.readFileSync(file));
	} catch (err) {
		if (err.code !== 'ENOENT') throw err;
		return null;
	}
}

export function tryToReadFile(file) {
	try {
		return fs.readFileSync(file, 'utf-8');
	} catch (err) {
		if (err.code !== 'ENOENT') throw err;
		return null;
	}
}

const { window } = new JSDOM('<main></main>');
global.document = window.document;

export function env() {
	window._svelteTransitionManager = null;
	window.document.body.innerHTML = '<main></main>';

	return window;
}

function cleanChildren(node) {
	let previous = null;

	// sort attributes
	const attributes = Array.from(node.attributes).sort((a, b) => {
		return a.name < b.name ? -1 : 1;
	});

	attributes.forEach(attr => {
		node.removeAttribute(attr.name);
	});

	attributes.forEach(attr => {
		node.setAttribute(attr.name, attr.value);
	});

	// recurse
	[...node.childNodes].forEach(child => {
		if (child.nodeType === 3) {
			// text
			if (
				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
				node.tagName !== 'text' &&
				node.tagName !== 'tspan'
			) {
				node.removeChild(child);
			}

			child.data = child.data.replace(/\s{2,}/g, '\n');

			if (previous && previous.nodeType === 3) {
				previous.data += child.data;
				previous.data = previous.data.replace(/\s{2,}/g, '\n');

				node.removeChild(child);
				child = previous;
			}
		} else {
			cleanChildren(child);
		}

		previous = child;
	});

	// collapse whitespace
	if (node.firstChild && node.firstChild.nodeType === 3) {
		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
		if (!node.firstChild.data) node.removeChild(node.firstChild);
	}

	if (node.lastChild && node.lastChild.nodeType === 3) {
		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
		if (!node.lastChild.data) node.removeChild(node.lastChild);
	}
}

export function normalizeHtml(window, html) {
	try {
		const node = window.document.createElement('div');
		node.innerHTML = html
			.replace(/<!--.*?-->/g, '')
			.replace(/>[\s\r\n]+</g, '><')
			.trim();
		cleanChildren(node, '');
		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
	} catch (err) {
		throw new Error(`Failed to normalize HTML:\n${html}`);
	}
}

export function setupHtmlEqual() {
	const window = env();

	assert.htmlEqual = (actual, expected, message) => {
		assert.deepEqual(
			normalizeHtml(window, actual),
			normalizeHtml(window, expected),
			message
		);
	};
}

export function loadConfig(file) {
	try {
		const resolved = require.resolve(file);
		delete require.cache[resolved];

		const config = require(resolved);
		return config.default || config;
	} catch (err) {
		if (err.code === 'MODULE_NOT_FOUND') {
			return {};
		}

		throw err;
	}
}

export function addLineNumbers(code) {
	return code
		.split('\n')
		.map((line, i) => {
			i = String(i + 1);
			while (i.length < 3) i = ` ${i}`;

			return (
				chalk.grey(`  ${i}: `) +
				line.replace(/^\t+/, match => match.split('\t').join('    '))
			);
		})
		.join('\n');
}

function capitalise(str) {
	return str[0].toUpperCase() + str.slice(1);
}

export function showOutput(cwd, options = {}, s = svelte) {
	glob.sync('**/*.html', { cwd }).forEach(file => {
		if (file[0] === '_') return;

		const name = path.basename(file)
			.slice(0, -path.extname(file).length)
			.replace(/^\d/, '_$&')
			.replace(/[^a-zA-Z0-9_$]/g, '');

		const { code } = s.compile(
			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
			Object.assign(options, {
				filename: file,
				name: capitalise(name)
			})
		);

		console.log( // eslint-disable-line no-console
			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
		);
	});
}

const start = /\n(\t+)/;
export function deindent(strings, ...values) {
	const indentation = start.exec(strings[0])[1];
[?2004l
2025-11-12 13:50:20,348 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_yze4ZJRtAr3XvA0IgwqIa28P', 'function': {'arguments': '{"command":"sed -n \'200,400p\' test/helpers.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 4728, 'total_tokens': 4757, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1664}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--376d4d08-c966-4bb5-9201-5d4930479a40-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '200,400p' test/helpers.js"}, 'id': 'call_yze4ZJRtAr3XvA0IgwqIa28P', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4728, 'output_tokens': 29, 'total_tokens': 4757, 'input_token_details': {'audio': 0, 'cache_read': 1664}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:50:20,351 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '200,400p' test/helpers.js
2025-11-12 13:50:20,454 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:20,454 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
	const indentation = start.exec(strings[0])[1];
	const pattern = new RegExp(`^${indentation}`, 'gm');

	let result = strings[0].replace(start, '').replace(pattern, '');

	let trailingIndentation = getTrailingIndentation(result);

	for (let i = 1; i < strings.length; i += 1) {
		let expression = values[i - 1];
		const string = strings[i].replace(pattern, '');

		if (Array.isArray(expression)) {
			expression = expression.length ? expression.join('\n') : null;
		}

		if (expression || expression === '') {
			const value = String(expression).replace(
				/\n/g,
				`\n${trailingIndentation}`
			);
			result += value + string;
		} else {
			let c = result.length;
			while (/\s/.test(result[c - 1])) c -= 1;
			result = result.slice(0, c) + string;
		}

		trailingIndentation = getTrailingIndentation(result);
	}

	return result.trim().replace(/\t+$/gm, '');
}

function getTrailingIndentation(str) {
	let i = str.length;
	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
	return str.slice(i, str.length);
}

export function spaces(i) {
	let result = '';
	while (i--) result += ' ';
	return result;
}
[?2004l
2025-11-12 13:50:24,006 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_XAKVRVXsXhH9XysGGEnJcpe5', 'function': {'arguments': '{"command":"ls -la compiler"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 283, 'prompt_tokens': 5088, 'total_tokens': 5371, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--38e7417d-4f79-4182-80a1-3aac723683da-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la compiler'}, 'id': 'call_XAKVRVXsXhH9XysGGEnJcpe5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5088, 'output_tokens': 283, 'total_tokens': 5371, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 13:50:24,009 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la compiler
2025-11-12 13:50:24,111 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:24,111 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 2156
drwxr-xr-x 1 root root    4096 Aug 28 02:30 [0m[01;34m.[0m
drwxr-xr-x 1 root root    4096 Nov 12 13:44 [01;34m..[0m
-rw-r--r-- 1 root root  775716 Nov 12 13:38 svelte.js
-rw-r--r-- 1 root root 1412288 Nov 12 13:38 svelte.js.map
[?2004l
2025-11-12 13:50:31,417 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OXCNxJolUujwQN7CaRk049bw', 'function': {'arguments': '{"command":"cat mocha.coverage.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 412, 'prompt_tokens': 5260, 'total_tokens': 5672, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ee396c8d-19ce-4e91-9c9f-cdaad4e65188-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat mocha.coverage.opts'}, 'id': 'call_OXCNxJolUujwQN7CaRk049bw', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5260, 'output_tokens': 412, 'total_tokens': 5672, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 13:50:31,421 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat mocha.coverage.opts
2025-11-12 13:50:31,522 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:31,523 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
--compilers ts-node/register
--require source-map-support/register
--full-trace
--recursive
test/test.js
[?2004l
2025-11-12 13:50:35,936 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_QGGbeOwDqksVtemR6ipUFi6y', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/test.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 291, 'prompt_tokens': 5331, 'total_tokens': 5622, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5ce779cc-4a86-445c-8ecc-a2a562b77277-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/test.js"}, 'id': 'call_QGGbeOwDqksVtemR6ipUFi6y', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5331, 'output_tokens': 291, 'total_tokens': 5622, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 13:50:35,940 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/test.js
2025-11-12 13:50:36,041 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:36,041 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
const glob = require("glob");

require("./setup");

glob.sync("**/__test__.js", { cwd: "src" }).forEach(function(file) {
	require("../src/" + file);
});

glob.sync("*/index.js", { cwd: "test" }).forEach(function(file) {
	require("./" + file);
});
[?2004l
2025-11-12 13:50:37,449 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_5JhYWMGXbdjOk3OVougpFVOq', 'function': {'arguments': '{"command":"ls -la test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 21, 'prompt_tokens': 5451, 'total_tokens': 5472, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--08345d22-5f77-4c6f-8e6a-9487a3fd3480-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test'}, 'id': 'call_5JhYWMGXbdjOk3OVougpFVOq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5451, 'output_tokens': 21, 'total_tokens': 5472, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:50:37,452 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test
2025-11-12 13:50:37,554 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:37,554 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 120
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [0m[01;34m.[0m
drwxr-xr-x 1 root root 4096 Nov 12 13:44 [01;34m..[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mcreate[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mcss[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mcustom-elements[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mformats[0m
-rw-r--r-- 1 root root 5512 Nov 12 13:44 helpers.js
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mhydration[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mjs[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mparser[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mpreprocess[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mruntime[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:49 [01;34mserver-side-rendering[0m
-rw-r--r-- 1 root root 1103 Nov 12 13:44 setup.js
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34msourcemaps[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mstore[0m
-rw-r--r-- 1 root root  247 Nov 12 13:44 test.js
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mvalidator[0m
[?2004l
2025-11-12 13:50:38,943 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WwdGPCGJaMn3X6Ac1uptHH8m', 'function': {'arguments': '{"command":"ls -la test/server-side-rendering"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 6074, 'total_tokens': 6099, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ad6caa9b-d025-4ad2-aa97-3e9368fd7ba0-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test/server-side-rendering'}, 'id': 'call_WwdGPCGJaMn3X6Ac1uptHH8m', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6074, 'output_tokens': 25, 'total_tokens': 6099, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:50:38,946 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/server-side-rendering
2025-11-12 13:50:39,048 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:39,048 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 32
drwxrwxr-x 1 root root 4096 Nov 12 13:49 [0m[01;34m.[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34m..[0m
-rw-r--r-- 1 root root 3413 Nov 12 13:44 index.js
-rw-r--r-- 1 root root 2425 Nov 12 13:49 nested-component-store.spec.js
drwxrwxr-x 1 root root 4096 Nov 12 13:49 [01;34msamples[0m
[?2004l
2025-11-12 13:50:41,748 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_RxBuOwk4J67RXoTy8R8paDJ4', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/server-side-rendering/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 167, 'prompt_tokens': 6278, 'total_tokens': 6445, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c0b29bda-4419-41b3-9a4d-4d4b95e047c4-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/server-side-rendering/index.js"}, 'id': 'call_RxBuOwk4J67RXoTy8R8paDJ4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6278, 'output_tokens': 167, 'total_tokens': 6445, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 13:50:41,752 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/server-side-rendering/index.js
2025-11-12 13:50:41,854 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:41,854 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import assert from "assert";
import * as fs from "fs";
import * as path from "path";
import glob from 'glob';

import {
	showOutput,
	loadConfig,
	setupHtmlEqual,
	tryToLoadJson
} from "../helpers.js";

function tryToReadFile(file) {
	try {
		return fs.readFileSync(file, "utf-8");
	} catch (err) {
		if (err.code !== "ENOENT") throw err;
		return null;
	}
}

describe("ssr", () => {
	before(() => {
		require("../../ssr/register")({
			extensions: ['.svelte', '.html'],
			store: true
		});

		return setupHtmlEqual();
	});

	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
		if (dir[0] === ".") return;

		// add .solo to a sample directory name to only run that test, or
		// .show to always show the output. or both
		const solo = /\.solo/.test(dir);
		const show = /\.show/.test(dir);

		if (solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		(solo ? it.only : it)(dir, () => {
			dir = path.resolve("test/server-side-rendering/samples", dir);
			try {
				let component;

				const mainHtmlFile = `${dir}/main.html`;
				const mainSvelteFile = `${dir}/main.svelte`;
				if (fs.existsSync(mainHtmlFile)) {
					component = require(mainHtmlFile);
				} else if (fs.existsSync(mainSvelteFile)) {
					component = require(mainSvelteFile);
				}

				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";

				const data = tryToLoadJson(`${dir}/data.json`);

				const rendered = component.render(data);
				const { html, css, head } = rendered;

				// rendered.toString() === rendered.html
				assert.equal(rendered, html);

				fs.writeFileSync(`${dir}/_actual.html`, html);
				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);

				assert.htmlEqual(html, expectedHtml);
				assert.equal(
					css.code.replace(/^\s+/gm, ""),
					expectedCss.replace(/^\s+/gm, "")
				);

				if (fs.existsSync(`${dir}/_expected-head.html`)) {
					fs.writeFileSync(`${dir}/_actual-head.html`, head);
					assert.htmlEqual(
						head,
						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
					);
				}

				if (show) showOutput(dir, { generate: 'ssr' });
			} catch (err) {
				showOutput(dir, { generate: 'ssr' });
				throw err;
			}
		});
	});

	// duplicate client-side tests, as far as possible
	fs.readdirSync("test/runtime/samples").forEach(dir => {
		if (dir[0] === ".") return;

		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);

		if (config.solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		if (config["skip-ssr"]) return;

		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
			const cwd = path.resolve("test/runtime/samples", dir);

			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
				delete require.cache[resolved];
			});

			require("../../ssr/register")({
				store: !!config.store
			});

			try {
				const component = require(`../runtime/samples/${dir}/main.html`);
				const { html } = component.render(config.data, {
					store: (config.store !== true) && config.store
				});

				if (config.html) {
					assert.htmlEqual(html, config.html);
				}
			} catch (err) {
				showOutput(cwd, { generate: "ssr" });
				throw err;
			}
		});
	});
});
[?2004l
2025-11-12 13:50:47,272 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_kEsrPdVF6I3c4R4bSD9AEXzC', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/setup.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 227, 'prompt_tokens': 7287, 'total_tokens': 7514, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5376}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6bb569cb-8c2a-4ab3-85c7-2c828c900f70-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/setup.js"}, 'id': 'call_kEsrPdVF6I3c4R4bSD9AEXzC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7287, 'output_tokens': 227, 'total_tokens': 7514, 'input_token_details': {'audio': 0, 'cache_read': 5376}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 13:50:47,277 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/setup.js
2025-11-12 13:50:47,378 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:50:47,379 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
const fs = require('fs');
const path = require('path');

require('console-group').install();
require('source-map-support').install();

process.env.TEST = true;

require.extensions['.js'] = function(module, filename) {
	const exports = [];

	var code = fs.readFileSync(filename, 'utf-8')
		.replace(/^import (?:\* as )?(\w+) from ['"]([^'"]+)['"];?/gm, 'var $1 = require("$2");')
		.replace(/^import {([^}]+)} from ['"](.+)['"];?/gm, 'var {$1} = require("$2");')
		.replace(/^export default /gm, 'module.exports = ')
		.replace(/^export (const|let|var|class|function) (\w+)/gm, (match, type, name) => {
			exports.push(name);
			return `${type} ${name}`;
		})
		.replace(/^export \{([^}]+)\}/gm, (match, names) => {
			names.split(',').filter(Boolean).forEach(name => {
				exports.push(name);
			});

			return '';
		})
		.replace(/^export function (\w+)/gm, 'exports.$1 = function $1');

	exports.forEach(name => {
		code += `\nexports.${name} = ${name};`;
	});

	try {
		return module._compile(code, filename);
	} catch (err) {
		console.log(code); // eslint-disable-line no-console
		throw err;
	}
[?2004l
2025-11-12 13:50:59,260 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_c2EBhpL5BJv8DzZunh12GFRm', 'function': {'arguments': '{"command":"npx mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 810, 'prompt_tokens': 7663, 'total_tokens': 8473, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--93ae7f0f-3f67-4463-bf27-a3f005b4c7b2-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npx mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js'}, 'id': 'call_c2EBhpL5BJv8DzZunh12GFRm', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7663, 'output_tokens': 810, 'total_tokens': 8473, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 13:50:59,265 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: npx mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js
2025-11-12 13:51:00,353 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 13:51:00,353 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 npx mocha --require test/setup.js test/server-side-re
endering/nested-component-store.spec.js
[?2004l

[0m[0m
[0m  ssr nested component store via connect[0m
  [31m  1) renders nested component that defines its own store via connect without crashing[0m


[92m [0m[32m 0 passing[0m[90m (52ms)[0m
[31m  1 failing[0m

[0m  1) ssr nested component store via connect renders nested component that defines its own store via connect without crashing:
[0m[31m     TypeError: Cannot read properties of undefined (reading 'store')[0m[90m
      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:53:32)
      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)
      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)
      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)
      at processImmediate (node:internal/timers:466:21)
[0m


[?2004l
2025-11-12 13:51:16,956 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content=" npx mocha --require test/setup.js test/server-side-re\nendering/nested-component-store.spec.js\n\x1b[?2004l\n\n\x1b[0m\x1b[0m\n\x1b[0m  ssr nested component store via connect\x1b[0m\n  \x1b[31m  1) renders nested component that defines its own store via connect without crashing\x1b[0m\n\n\n\x1b[92m \x1b[0m\x1b[32m 0 passing\x1b[0m\x1b[90m (52ms)\x1b[0m\n\x1b[31m  1 failing\x1b[0m\n\n\x1b[0m  1) ssr nested component store via connect renders nested component that defines its own store via connect without crashing:\n\x1b[0m\x1b[31m     TypeError: Cannot read properties of undefined (reading 'store')\x1b[0m\x1b[90m\n      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:53:32)\n      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)\n      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)\n      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)\n      at processImmediate (node:internal/timers:466:21)\n\x1b[0m\n\n\x1b[?2004l" additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1451, 'prompt_tokens': 8062, 'total_tokens': 9513, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1088, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--972995fe-d42d-4f9e-84b5-b129556a80a5-0' usage_metadata={'input_tokens': 8062, 'output_tokens': 1451, 'total_tokens': 9513, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1088}}
2025-11-12 13:51:50,531 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_structured_node - DEBUG - reproduced_bug=False reproduced_bug_failure_log='Command: npx mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js\n\n  ssr nested component store via connect\n    1) renders nested component that defines its own store via connect without crashing\n\n\n  0 passing (52ms)\n  1 failing\n\n  1) ssr nested component store via connect renders nested component that defines its own store via connect without crashing:\n     TypeError: Cannot read properties of undefined (reading \'store\')\n      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:53:32)\n      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)\n      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)\n      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)\n      at processImmediate (node:internal/timers:466:21)\n\nTest fails, but not in the exact way described in the issue. The issue reports the server-side error as:\n  "Cannot read property \'_init\' of undefined"\nwhich occurs when the child component\'s SSR _render calls options.store._init([...]) with options.store being undefined. In the current test, the failure is:\n  "Cannot read properties of undefined (reading \'store\')"\nwhich indicates that the options object itself is undefined inside the child _render, not that options.store is undefined. To reproduce the exact reported error, ensure that the parent render is invoked with an options object so that the parent passes { store: options.store } to the child. For example, change\n  const { html } = Parent.render();\nto\n  const { html } = Parent.render(null, {});\nThis will result in the child receiving an options object where store is undefined, causing the exact error "Cannot read property \'_init\' of undefined" as described in the issue.' reproduced_bug_commands=['npx mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js']
2025-11-12 13:51:50,533 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting bug_reproducing_file_messages in state.
2025-11-12 13:51:50,534 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting bug_reproducing_execute_messages in state.
2025-11-12 13:51:50,535 - thread-135845298308800.prometheus.lang_graph.nodes.git_reset_node - DEBUG - Resetting the git repository
2025-11-12 13:51:50,571 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_write_message_node - DEBUG - Sending message to BugReproducingWriteNode:
content='Your previous test case failed to reproduce the bug. Here is the failure log:\nCommand: npx mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js\n\n  ssr nested component store via connect\n    1) renders nested component that defines its own store via connect without crashing\n\n\n  0 passing (52ms)\n  1 failing\n\n  1) ssr nested component store via connect renders nested component that defines its own store via connect without crashing:\n     TypeError: Cannot read properties of undefined (reading \'store\')\n      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:53:32)\n      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)\n      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)\n      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)\n      at processImmediate (node:internal/timers:466:21)\n\nTest fails, but not in the exact way described in the issue. The issue reports the server-side error as:\n  "Cannot read property \'_init\' of undefined"\nwhich occurs when the child component\'s SSR _render calls options.store._init([...]) with options.store being undefined. In the current test, the failure is:\n  "Cannot read properties of undefined (reading \'store\')"\nwhich indicates that the options object itself is undefined inside the child _render, not that options.store is undefined. To reproduce the exact reported error, ensure that the parent render is invoked with an options object so that the parent passes { store: options.store } to the child. For example, change\n  const { html } = Parent.render();\nto\n  const { html } = Parent.render(null, {});\nThis will result in the child receiving an options object where store is undefined, causing the exact error "Cannot read property \'_init\' of undefined" as described in the issue.\n\nNow think about what went wrong and generate the complete self-contained test case that reproduces the bug with the same error/exception again.\n' additional_kwargs={} response_metadata={}
2025-11-12 13:52:31,572 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='File: test/server-side-rendering/nested-component-store.spec.js\nimport assert from \'assert\';\nimport { loadSvelte, setupHtmlEqual } from \'../helpers.js\';\n\ndescribe(\'ssr nested component store via connect\', () => {\n  let svelte;\n\n  before(() => {\n    svelte = loadSvelte(true);\n    setupHtmlEqual();\n  });\n\n  function compileCjs(source, options) {\n    const { code } = svelte.compile(source, Object.assign({ format: \'cjs\' }, options));\n    const module = { exports: {} };\n    const exports = module.exports;\n    const fn = new Function(\'module\', \'exports\', \'TwoFactorAuth\', `${code}; return module.exports;`);\n    return {\n      evalWith(scope = {}) {\n        return fn(module, exports, scope.TwoFactorAuth);\n      }\n    };\n  }\n\n  it(\'server renders nested component with connect()-provided store\', () => {\n    const childSource = `\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n  // Minimal inline connect to mirror svelte-redux\'s connect API for SSR\n  function connect(mapFn) {\n    return {\n      _init(keys) {\n        const mapped = mapFn({}); // emulate empty Redux state on server\n        const state = {};\n        keys.forEach(k => { state[k] = mapped[k]; });\n        return state;\n      }\n    };\n  }\n\n  export default {\n    store: connect(state => ({\n      hasTwoFactor: state.user && state.user.hasTwoFactor,\n    })),\n  };\n</script>\n    `;\n\n    const parentSource = `\n<div class="page">\n  <h1>Manage Account</h1>\n  <div>\n    <h3>Two Factor Auth</h3>\n    <TwoFactorAuth/>\n  </div>\n</div>\n\n<script>\n  export default {\n    components: { TwoFactorAuth }\n  };\n</script>\n    `;\n\n    // Compile child (TwoFactorAuth) for SSR\n    const childMod = compileCjs(childSource, { generate: \'ssr\', name: \'TwoFactorAuth\', store: true }).evalWith();\n    const TwoFactorAuth = childMod.default || childMod;\n\n    // Compile parent for SSR, injecting the child component via components mapping\n    const parentMod = compileCjs(parentSource, { generate: \'ssr\', name: \'ManageAccount\', store: true }).evalWith({ TwoFactorAuth });\n    const Parent = parentMod.default || parentMod;\n\n    // Reproduce the exact SSR issue by passing an options object (with no store) to Parent.render\n    // This currently throws: "Cannot read property \'_init\' of undefined"\n    const { html } = Parent.render(null, {});\n\n    assert.htmlEqual(\n      html,\n      \'<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>\'\n    );\n  });\n});' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 3341, 'prompt_tokens': 12905, 'total_tokens': 16246, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2688, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--1a93f1f5-6ea9-4ae6-9ee1-75fccf97415d-0' usage_metadata={'input_tokens': 12905, 'output_tokens': 3341, 'total_tokens': 16246, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 2688}}
2025-11-12 13:52:38,459 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_nZvlEziIUVJfYR82kpZAOhFh', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/index.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 351, 'prompt_tokens': 26741, 'total_tokens': 27092, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b61b292b-801c-491c-bdb8-53177419f8b2-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/server-side-rendering/index.js'}, 'id': 'call_nZvlEziIUVJfYR82kpZAOhFh', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26741, 'output_tokens': 351, 'total_tokens': 27092, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 13:52:42,842 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ED23GxBWEgNFcKsY0dSY7lTo', 'function': {'arguments': '{"relative_path":"test/helpers.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 155, 'prompt_tokens': 28033, 'total_tokens': 28188, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--aa0d8294-95c7-4868-bd22-59494071fca9-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/helpers.js'}, 'id': 'call_ED23GxBWEgNFcKsY0dSY7lTo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28033, 'output_tokens': 155, 'total_tokens': 28188, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 13:52:49,804 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ImPYnwVFahARfa1s85eLjQxv', 'function': {'arguments': '{"relative_path":"test/test.js"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 283, 'prompt_tokens': 30187, 'total_tokens': 30470, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6b2b20d9-d05d-418c-9ae3-7416b0790a0a-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'test/test.js'}, 'id': 'call_ImPYnwVFahARfa1s85eLjQxv', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30187, 'output_tokens': 283, 'total_tokens': 30470, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 13:53:10,742 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6Bg1VPzRzxMEk4djjSLBNR9m', 'function': {'arguments': '{"relative_path":"test/server-side-rendering/nested-component-store.spec.js","content":"import assert from \'assert\';\\nimport { loadSvelte, setupHtmlEqual } from \'../helpers.js\';\\n\\ndescribe(\'ssr nested component store via connect\', () => {\\n  let svelte;\\n\\n  before(() => {\\n    svelte = loadSvelte(true);\\n    setupHtmlEqual();\\n  });\\n\\n  function compileCjs(source, options) {\\n    const { code } = svelte.compile(source, Object.assign({ format: \'cjs\' }, options));\\n    const module = { exports: {} };\\n    const exports = module.exports;\\n    const fn = new Function(\'module\', \'exports\', \'TwoFactorAuth\', `${code}; return module.exports;`);\\n    return {\\n      evalWith(scope = {}) {\\n        return fn(module, exports, scope.TwoFactorAuth);\\n      }\\n    };\\n  }\\n\\n  it(\'server renders nested component with connect()-provided store\', () => {\\n    const childSource = `\\n{{#if $hasTwoFactor}}\\n<div>yay its enabled</div>\\n{{else}}\\n<div>oh no its not enabled</div>\\n{{/if}}\\n\\n<script>\\n  // Minimal inline connect to mirror svelte-redux\'s connect API for SSR\\n  function connect(mapFn) {\\n    return {\\n      _init(keys) {\\n        const mapped = mapFn({}); // emulate empty Redux state on server\\n        const state = {};\\n        keys.forEach(k => { state[k] = mapped[k]; });\\n        return state;\\n      }\\n    };\\n  }\\n\\n  export default {\\n    store: connect(state => ({\\n      hasTwoFactor: state.user && state.user.hasTwoFactor,\\n    })),\\n  };\\n</script>\\n    `;\\n\\n    const parentSource = `\\n<div class=\\"page\\">\\n  <h1>Manage Account</h1>\\n  <div>\\n    <h3>Two Factor Auth</h3>\\n    <TwoFactorAuth/>\\n  </div>\\n</div>\\n\\n<script>\\n  export default {\\n    components: { TwoFactorAuth }\\n  };\\n</script>\\n    `;\\n\\n    // Compile child (TwoFactorAuth) for SSR\\n    const childMod = compileCjs(childSource, { generate: \'ssr\', name: \'TwoFactorAuth\', store: true }).evalWith();\\n    const TwoFactorAuth = childMod.default || childMod;\\n\\n    // Compile parent for SSR, injecting the child component via components mapping\\n    const parentMod = compileCjs(parentSource, { generate: \'ssr\', name: \'ManageAccount\', store: true }).evalWith({ TwoFactorAuth });\\n    const Parent = parentMod.default || parentMod;\\n\\n    // Reproduce the exact SSR issue by passing an options object (with no store) to Parent.render\\n    // This currently throws: \\"Cannot read property \'_init\' of undefined\\"\\n    const { html } = Parent.render(null, {});\\n\\n    assert.htmlEqual(\\n      html,\\n      \'<div class=\\"page\\"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>\'\\n    );\\n  });\\n});\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2375, 'prompt_tokens': 30313, 'total_tokens': 32688, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1600, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c282d627-a588-4c32-8890-4ec09ea94a8a-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'test/server-side-rendering/nested-component-store.spec.js', 'content': 'import assert from \'assert\';\nimport { loadSvelte, setupHtmlEqual } from \'../helpers.js\';\n\ndescribe(\'ssr nested component store via connect\', () => {\n  let svelte;\n\n  before(() => {\n    svelte = loadSvelte(true);\n    setupHtmlEqual();\n  });\n\n  function compileCjs(source, options) {\n    const { code } = svelte.compile(source, Object.assign({ format: \'cjs\' }, options));\n    const module = { exports: {} };\n    const exports = module.exports;\n    const fn = new Function(\'module\', \'exports\', \'TwoFactorAuth\', `${code}; return module.exports;`);\n    return {\n      evalWith(scope = {}) {\n        return fn(module, exports, scope.TwoFactorAuth);\n      }\n    };\n  }\n\n  it(\'server renders nested component with connect()-provided store\', () => {\n    const childSource = `\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n  // Minimal inline connect to mirror svelte-redux\'s connect API for SSR\n  function connect(mapFn) {\n    return {\n      _init(keys) {\n        const mapped = mapFn({}); // emulate empty Redux state on server\n        const state = {};\n        keys.forEach(k => { state[k] = mapped[k]; });\n        return state;\n      }\n    };\n  }\n\n  export default {\n    store: connect(state => ({\n      hasTwoFactor: state.user && state.user.hasTwoFactor,\n    })),\n  };\n</script>\n    `;\n\n    const parentSource = `\n<div class="page">\n  <h1>Manage Account</h1>\n  <div>\n    <h3>Two Factor Auth</h3>\n    <TwoFactorAuth/>\n  </div>\n</div>\n\n<script>\n  export default {\n    components: { TwoFactorAuth }\n  };\n</script>\n    `;\n\n    // Compile child (TwoFactorAuth) for SSR\n    const childMod = compileCjs(childSource, { generate: \'ssr\', name: \'TwoFactorAuth\', store: true }).evalWith();\n    const TwoFactorAuth = childMod.default || childMod;\n\n    // Compile parent for SSR, injecting the child component via components mapping\n    const parentMod = compileCjs(parentSource, { generate: \'ssr\', name: \'ManageAccount\', store: true }).evalWith({ TwoFactorAuth });\n    const Parent = parentMod.default || parentMod;\n\n    // Reproduce the exact SSR issue by passing an options object (with no store) to Parent.render\n    // This currently throws: "Cannot read property \'_init\' of undefined"\n    const { html } = Parent.render(null, {});\n\n    assert.htmlEqual(\n      html,\n      \'<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>\'\n    );\n  });\n});\n'}, 'id': 'call_6Bg1VPzRzxMEk4djjSLBNR9m', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30313, 'output_tokens': 2375, 'total_tokens': 32688, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1600}}
2025-11-12 13:53:13,203 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='test/server-side-rendering/nested-component-store.spec.js' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 15, 'prompt_tokens': 31109, 'total_tokens': 31124, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--be242ac1-fc0b-4ed1-a9a9-3a0ea5b3b0dd-0' usage_metadata={'input_tokens': 31109, 'output_tokens': 15, 'total_tokens': 31124, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:53:13,247 - thread-135845298308800.prometheus.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/test/server-side-rendering/nested-component-store.spec.js b/test/server-side-rendering/nested-component-store.spec.js
new file mode 100644
index 000000000..4f51c982c
--- /dev/null
+++ b/test/server-side-rendering/nested-component-store.spec.js
@@ -0,0 +1,86 @@
+import assert from 'assert';
+import { loadSvelte, setupHtmlEqual } from '../helpers.js';
+
+describe('ssr nested component store via connect', () => {
+  let svelte;
+
+  before(() => {
+    svelte = loadSvelte(true);
+    setupHtmlEqual();
+  });
+
+  function compileCjs(source, options) {
+    const { code } = svelte.compile(source, Object.assign({ format: 'cjs' }, options));
+    const module = { exports: {} };
+    const exports = module.exports;
+    const fn = new Function('module', 'exports', 'TwoFactorAuth', `${code}; return module.exports;`);
+    return {
+      evalWith(scope = {}) {
+        return fn(module, exports, scope.TwoFactorAuth);
+      }
+    };
+  }
+
+  it('server renders nested component with connect()-provided store', () => {
+    const childSource = `
+{{#if $hasTwoFactor}}
+<div>yay its enabled</div>
+{{else}}
+<div>oh no its not enabled</div>
+{{/if}}
+
+<script>
+  // Minimal inline connect to mirror svelte-redux's connect API for SSR
+  function connect(mapFn) {
+    return {
+      _init(keys) {
+        const mapped = mapFn({}); // emulate empty Redux state on server
+        const state = {};
+        keys.forEach(k => { state[k] = mapped[k]; });
+        return state;
+      }
+    };
+  }
+
+  export default {
+    store: connect(state => ({
+      hasTwoFactor: state.user && state.user.hasTwoFactor,
+    })),
+  };
+</script>
+    `;
+
+    const parentSource = `
+<div class="page">
+  <h1>Manage Account</h1>
+  <div>
+    <h3>Two Factor Auth</h3>
+    <TwoFactorAuth/>
+  </div>
+</div>
+
+<script>
+  export default {
+    components: { TwoFactorAuth }
+  };
+</script>
+    `;
+
+    // Compile child (TwoFactorAuth) for SSR
+    const childMod = compileCjs(childSource, { generate: 'ssr', name: 'TwoFactorAuth', store: true }).evalWith();
+    const TwoFactorAuth = childMod.default || childMod;
+
+    // Compile parent for SSR, injecting the child component via components mapping
+    const parentMod = compileCjs(parentSource, { generate: 'ssr', name: 'ManageAccount', store: true }).evalWith({ TwoFactorAuth });
+    const Parent = parentMod.default || parentMod;
+
+    // Reproduce the exact SSR issue by passing an options object (with no store) to Parent.render
+    // This currently throws: "Cannot read property '_init' of undefined"
+    const { html } = Parent.render(null, {});
+
+    assert.htmlEqual(
+      html,
+      '<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>'
+    );
+  });
+});

2025-11-12 13:53:13,249 - thread-135845298308800.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-12 13:53:13,283 - thread-135845298308800.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-12 13:53:13,283 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-12 13:53:13,385 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:53:13,385 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 8057884cb Merge pull request #1097 from sveltejs/gh-1082-b
[?2004l
2025-11-12 13:53:13,385 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-12 13:53:13,487 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:53:13,487 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing test/server-side-rendering/nested-component-store.spec.js
[?2004l
2025-11-12 13:53:13,488 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-12 13:53:13,488 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory test/server-side-rendering in the container
2025-11-12 13:53:13,488 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p test/server-side-rendering
2025-11-12 13:53:13,590 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:53:13,590 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 13:53:13,591 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/nested-component-store.spec.js in the container
2025-11-12 13:53:13,599 - thread-135845298308800.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-12 13:53:17,436 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_qbXemVO30KFLY4UJ8BAvQtm4', 'function': {'arguments': '{"command":"ls -la"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 282, 'prompt_tokens': 810, 'total_tokens': 1092, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e71a3968-8709-491a-bd16-c907e2467dfa-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la'}, 'id': 'call_qbXemVO30KFLY4UJ8BAvQtm4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 810, 'output_tokens': 282, 'total_tokens': 1092, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 13:53:17,439 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la
2025-11-12 13:53:17,541 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:53:17,541 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 824
drwxr-xr-x   1 root root   4096 Nov 12 13:44 [0m[01;34m.[0m
drwxr-xr-x   1 root root   4096 Nov 12 13:53 [01;34m..[0m
-rw-r--r--   1 root root    227 Nov 12 13:44 .editorconfig
-rw-r--r--   1 root root     85 Nov 12 13:44 .eslintignore
-rw-r--r--   1 root root   1239 Nov 12 13:44 .eslintrc.json
-rw-r--r--   1 root root     78 Nov 12 13:44 .flowconfig
drwxrwxr-x   1 root root   4096 Nov 12 13:53 [01;34m.git[0m
drwxrwxr-x   1 root root   4096 Nov 12 13:44 [01;34m.github[0m
-rw-r--r--   1 root root    289 Nov 12 13:44 .gitignore
-rw-r--r--   1 root root     51 Nov 12 13:44 .prettierrc
-rw-r--r--   1 root root    270 Nov 12 13:44 .travis.yml
-rw-r--r--   1 root root  44966 Nov 12 13:44 CHANGELOG.md
-rw-r--r--   1 root root   1114 Nov 12 13:44 LICENSE
-rw-r--r--   1 root root   8621 Nov 12 13:44 README.md
-rw-r--r--   1 root root    556 Nov 12 13:44 appveyor.yml
drwxr-xr-x   1 root root   4096 Aug 28 02:30 [01;34mcompiler[0m
-rw-r--r--   1 root root    105 Nov 12 13:44 mocha.coverage.opts
-rw-r--r--   1 root root     12 Nov 12 13:44 mocha.opts
drwxr-xr-x 408 root root  16384 Aug 28 02:30 [01;34mnode_modules[0m
-rw-r--r--   1 root root 500424 Aug 28 02:30 package-lock.json
-rw-r--r--   1 root root   2558 Nov 12 13:44 package.json
-rw-r--r--   1 root root   1796 Nov 12 13:44 rollup.config.js
-rw-r--r--   1 root root    128 Nov 12 13:44 rollup.store.config.js
-rw-r--r--   1 root root  14889 Nov 12 13:38 shared.js
drwxrwxr-x   1 root root   4096 Nov 12 13:44 [01;34msrc[0m
drwxr-xr-x   1 root root   4096 Aug 28 02:30 [01;34mssr[0m
-rw-r--r--   1 root root   3515 Nov 12 13:44 store.js
-rw-r--r--   1 root root   5166 Nov 12 13:38 store.umd.js
drwxrwxr-x   1 root root   4096 Nov 12 13:44 [01;34mtest[0m
-rw-r--r--   1 root root    326 Nov 12 13:44 tsconfig.json
-rw-r--r--   1 root root 120024 Nov 12 13:44 yarn.lock
[?2004l
2025-11-12 13:53:20,079 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_R7I9Y6jkdyCIl1xThc4ctBsX', 'function': {'arguments': '{"command":"cat package.json"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 90, 'prompt_tokens': 1739, 'total_tokens': 1829, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c902622f-9b6e-48df-ace2-343ed6d39144-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat package.json'}, 'id': 'call_R7I9Y6jkdyCIl1xThc4ctBsX', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1739, 'output_tokens': 90, 'total_tokens': 1829, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 13:53:20,082 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat package.json
2025-11-12 13:53:20,184 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:53:20,184 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
{
  "name": "svelte",
  "version": "1.51.1",
  "description": "The magical disappearing UI framework",
  "main": "compiler/svelte.js",
  "files": [
    "compiler",
    "ssr",
    "shared.js",
    "store.js",
    "store.umd.js",
    "README.md"
  ],
  "scripts": {
    "test": "mocha --opts mocha.opts",
    "quicktest": "mocha --opts mocha.opts",
    "precoverage": "export COVERAGE=true && nyc mocha --opts mocha.coverage.opts",
    "coverage": "nyc report --reporter=text-lcov > coverage.lcov",
    "codecov": "codecov",
    "precodecov": "npm run coverage",
    "lint": "eslint src test/*.js",
    "build": "node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js",
    "prepare": "npm run build",
    "dev": "node src/shared/_build.js && rollup -c -w",
    "pretest": "npm run build",
    "prepublishOnly": "npm run lint && npm test",
    "prettier": "prettier --write \"src/**/*.ts\""
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/sveltejs/svelte.git"
  },
  "keywords": [
    "UI",
    "framework",
    "templates",
    "templating"
  ],
  "author": "Rich Harris",
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/sveltejs/svelte/issues"
  },
  "homepage": "https://github.com/sveltejs/svelte#README",
  "devDependencies": {
    "@types/mocha": "^2.2.41",
    "@types/node": "^8.0.17",
    "acorn": "^5.1.1",
    "acorn-dynamic-import": "^2.0.2",
    "chalk": "^2.0.1",
    "codecov": "^2.2.0",
    "console-group": "^0.3.2",
    "css-tree": "1.0.0-alpha22",
    "eslint": "^4.3.0",
    "eslint-plugin-html": "^3.0.0",
    "eslint-plugin-import": "^2.2.0",
    "estree-walker": "^0.5.1",
    "glob": "^7.1.1",
    "is-reference": "^1.1.0",
    "jsdom": "^11.1.0",
    "locate-character": "^2.0.0",
    "magic-string": "^0.22.3",
    "mocha": "^3.2.0",
    "nightmare": "^2.10.0",
    "node-resolve": "^1.3.3",
    "nyc": "^11.1.0",
    "prettier": "^1.7.0",
    "reify": "^0.12.3",
    "rollup": "^0.48.2",
    "rollup-plugin-buble": "^0.15.0",
    "rollup-plugin-commonjs": "^8.0.2",
    "rollup-plugin-json": "^2.1.0",
    "rollup-plugin-node-resolve": "^3.0.0",
    "rollup-plugin-replace": "^2.0.0",
    "rollup-plugin-typescript": "^0.8.1",
    "rollup-plugin-virtual": "^1.0.1",
    "rollup-watch": "^4.3.1",
    "source-map": "^0.5.6",
    "source-map-support": "^0.4.8",
    "ts-node": "^3.3.0",
    "tslib": "^1.8.0",
    "typescript": "^2.6.1"
  },
  "nyc": {
    "include": [
      "compiler/svelte.js",
      "shared.js"
    ],
    "sourceMap": true,
    "instrument": true
  }
}
[?2004l
2025-11-12 13:53:26,752 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_v4PryrmJaeQAGikQZNML3KJO', 'function': {'arguments': '{"command":"npm test -- test/server-side-rendering/nested-component-store.spec.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 549, 'prompt_tokens': 2695, 'total_tokens': 3244, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b3f2ac43-a977-47dd-9110-ca8fa78292f1-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm test -- test/server-side-rendering/nested-component-store.spec.js'}, 'id': 'call_v4PryrmJaeQAGikQZNML3KJO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2695, 'output_tokens': 549, 'total_tokens': 3244, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 13:53:26,756 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: npm test -- test/server-side-rendering/nested-component-store.spec.js
2025-11-12 13:54:44,892 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 10
2025-11-12 13:54:44,892 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 npm test -- test/server-side-rendering/nested-compone
ent-store.spec.js
[?2004l

> svelte@1.51.1 pretest
> npm run build


> svelte@1.51.1 build
> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m4.8s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m32ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m37ms[22m[39m
[36m[39m
[36m[1mstore.js[22m → [1mstore.umd.js[22m...[39m
[32mcreated [1mstore.umd.js[22m in [1m84ms[22m[39m

> svelte@1.51.1 test
> mocha --opts mocha.opts test/server-side-rendering/nested-component-store.spec.js


[0m[0m
[0m  create[0m
  [32m  ✓[0m[90m should return a component constructor[0m
  [32m  ✓[0m[90m should throw error when source is invalid [0m
  [32m  ✓[0m[90m should return undefined when source is invalid [0m

[0m  css[0m
  [32m  ✓[0m[90m attribute-selector-only-name[0m
  [32m  ✓[0m[90m attribute-selector-unquoted[0m
  [32m  ✓[0m[90m basic[0m
  [32m  ✓[0m[90m cascade-false[0m
  [32m  ✓[0m[90m cascade-false-global[0m
  [32m  ✓[0m[90m cascade-false-global-keyframes[0m
  [32m  ✓[0m[90m cascade-false-keyframes[0m
  [32m  ✓[0m[90m cascade-false-keyframes-from-to[0m
  [32m  ✓[0m[90m cascade-false-pseudo-element[0m
  [32m  ✓[0m[90m cascade-false-universal-selector[0m
  [32m  ✓[0m[90m combinator-child[0m
  [32m  ✓[0m[90m css-vars[0m
  [32m  ✓[0m[90m descendant-selector-non-top-level-outer[0m
  [32m  ✓[0m[90m empty-class[0m
  [32m  ✓[0m[90m keyframes[0m
  [32m  ✓[0m[90m media-query[0m
  [32m  ✓[0m[90m media-query-word[0m
  [32m  ✓[0m[90m omit-scoping-attribute[0m
  [32m  ✓[0m[90m omit-scoping-attribute-attribute-selector[0m
  [32m  ✓[0m[90m omit-scoping-attribute-attribute-selector-contains[0m
  [32m  ✓[0m[90m omit-scoping-attribute-attribute-selector-equals[0m
  [32m  ✓[0m[90m omit-scoping-attribute-attribute-selector-equals-case-insensitive[0m
  [32m  ✓[0m[90m omit-scoping-attribute-attribute-selector-equals-dynamic[0m
  [32m  ✓[0m[90m omit-scoping-attribute-attribute-selector-pipe-equals[0m
  [32m  ✓[0m[90m omit-scoping-attribute-attribute-selector-prefix[0m
  [32m  ✓[0m[90m omit-scoping-attribute-attribute-selector-suffix[0m
  [32m  ✓[0m[90m omit-scoping-attribute-attribute-selector-word-equals[0m
  [32m  ✓[0m[90m omit-scoping-attribute-class-dynamic[0m
  [32m  ✓[0m[90m omit-scoping-attribute-class-static[0m
  [32m  ✓[0m[90m omit-scoping-attribute-descendant[0m
  [32m  ✓[0m[90m omit-scoping-attribute-descendant-global-inner[0m
  [32m  ✓[0m[90m omit-scoping-attribute-descendant-global-inner-class[0m
  [32m  ✓[0m[90m omit-scoping-attribute-descendant-global-inner-multiple[0m
  [32m  ✓[0m[90m omit-scoping-attribute-descendant-global-outer[0m
  [32m  ✓[0m[90m omit-scoping-attribute-descendant-global-outer-multiple[0m
  [32m  ✓[0m[90m omit-scoping-attribute-global[0m
  [32m  ✓[0m[90m omit-scoping-attribute-id[0m
  [32m  ✓[0m[90m omit-scoping-attribute-whitespace[0m
  [32m  ✓[0m[90m omit-scoping-attribute-whitespace-multiple[0m
  [32m  ✓[0m[90m refs[0m
  [32m  ✓[0m[90m refs-qualified[0m
  [32m  ✓[0m[90m universal-selector[0m
  [32m  ✓[0m[90m unknown-at-rule[0m
  [32m  ✓[0m[90m unused-selector[0m
  [32m  ✓[0m[90m unused-selector-leading[0m
  [32m  ✓[0m[90m unused-selector-ternary[0m

[0m  custom-elements[0m
  [31m  1) escaped-css[0m
  [31m  2) html[0m
  [31m  3) html-slots[0m
  [31m  4) nested[0m
  [31m  5) new[0m
  [31m  6) new-styled[0m

[0m  formats[0m
[0m    amd[0m
    [32m  ✓[0m[90m generates an AMD module[0m
[0m    cjs[0m
    [32m  ✓[0m[90m generates a CommonJS module[0m
[0m    iife[0m
    [32m  ✓[0m[90m generates a self-executing script[0m
    [32m  ✓[0m[90m requires options.name[0m
    [32m  ✓[0m[90m suggests using options.globals for default imports[0m
    [32m  ✓[0m[90m insists on options.globals for named imports[0m
[0m    umd[0m
    [32m  ✓[0m[90m generates a UMD build[0m
    [32m  ✓[0m[90m requires options.name[0m
[0m    eval[0m
    [32m  ✓[0m[90m generates a self-executing script that returns the component on eval[0m
[0m    unknown format[0m
    [32m  ✓[0m[90m throws an error[0m

[0m  hydration[0m
  [32m  ✓[0m[90m basic[0m
  [32m  ✓[0m[90m binding-input[0m
  [32m  ✓[0m[90m component[0m
  [32m  ✓[0m[90m component-in-element[0m
  [32m  ✓[0m[90m dynamic-text[0m
  [32m  ✓[0m[90m dynamic-text-changed[0m
  [32m  ✓[0m[90m each-block[0m
  [32m  ✓[0m[90m each-block-arg-clash[0m
  [32m  ✓[0m[90m element-attribute-added[0m
  [32m  ✓[0m[90m element-attribute-changed[0m
  [32m  ✓[0m[90m element-attribute-removed[0m
  [32m  ✓[0m[90m element-attribute-unchanged[0m
  [32m  ✓[0m[90m element-nested[0m
  [32m  ✓[0m[90m element-ref[0m
  [32m  ✓[0m[90m event-handler[0m
  [32m  ✓[0m[90m if-block[0m
  [32m  ✓[0m[90m if-block-anchor[0m
  [32m  ✓[0m[90m if-block-false[0m
  [32m  ✓[0m[90m if-block-update[0m
  [36m  - raw[0m
  [32m  ✓[0m[90m top-level-text[0m

[0m  js[0m
  [32m  ✓[0m[90m collapses-text-around-comments[0m[33m (57ms)[0m
  [32m  ✓[0m[90m component-static[0m[33m (69ms)[0m
  [32m  ✓[0m[90m computed-collapsed-if[0m[33m (43ms)[0m
  [32m  ✓[0m[90m css-media-query[0m[33m (51ms)[0m
  [32m  ✓[0m[90m css-shadow-dom-keyframes[0m[33m (39ms)[0m
  [32m  ✓[0m[90m deconflict-globals[0m[33m (52ms)[0m
  [32m  ✓[0m[90m do-use-dataset[0m
  [32m  ✓[0m[90m dont-use-dataset-in-legacy[0m
  [32m  ✓[0m[90m dont-use-dataset-in-svg[0m[33m (43ms)[0m
  [32m  ✓[0m[90m each-block-changed-check[0m[33m (50ms)[0m
  [32m  ✓[0m[90m event-handlers-custom[0m
  [32m  ✓[0m[90m head-no-whitespace[0m
  [32m  ✓[0m[90m if-block-no-update[0m
  [32m  ✓[0m[90m if-block-simple[0m[33m (40ms)[0m
  [32m  ✓[0m[90m inline-style-optimized[0m
  [32m  ✓[0m[90m inline-style-optimized-multiple[0m
  [32m  ✓[0m[90m inline-style-optimized-url[0m
  [32m  ✓[0m[90m inline-style-unoptimized[0m[33m (39ms)[0m
  [32m  ✓[0m[90m input-without-blowback-guard[0m
  [32m  ✓[0m[90m legacy-input-type[0m
  [32m  ✓[0m[90m legacy-quote-class[0m
  [32m  ✓[0m[90m media-bindings[0m[33m (38ms)[0m
'Imported.html' is imported by test/js/samples/non-imported-component/_actual.js, but could not be resolved – treating it as an external dependency
  [32m  ✓[0m[90m non-imported-component[0m
(4:2) – 'onrender' has been deprecated in favour of 'oncreate', and will cause an error in Svelte 2.x
(5:2) – 'onteardown' has been deprecated in favour of 'ondestroy', and will cause an error in Svelte 2.x
  [32m  ✓[0m[90m onrender-onteardown-rewritten[0m
  [32m  ✓[0m[90m setup-method[0m
(18:3) – The 'swipe' event definition is unused
  [32m  ✓[0m[90m ssr-no-oncreate-etc[0m
  [32m  ✓[0m[90m svg-title[0m
  [32m  ✓[0m[90m title[0m
  [32m  ✓[0m[90m use-elements-as-anchors[0m[33m (51ms)[0m
  [32m  ✓[0m[90m window-binding-scroll[0m

[0m  parse[0m
  [32m  ✓[0m[90m attribute-dynamic[0m
  [32m  ✓[0m[90m attribute-dynamic-boolean[0m
  [32m  ✓[0m[90m attribute-dynamic-reserved[0m
  [32m  ✓[0m[90m attribute-escaped[0m
  [32m  ✓[0m[90m attribute-multiple[0m
  [32m  ✓[0m[90m attribute-shorthand[0m
  [32m  ✓[0m[90m attribute-static[0m
  [32m  ✓[0m[90m attribute-static-boolean[0m
  [32m  ✓[0m[90m attribute-unique-error[0m
  [32m  ✓[0m[90m attribute-unquoted[0m
  [32m  ✓[0m[90m await-then-catch[0m
  [32m  ✓[0m[90m binding[0m
  [32m  ✓[0m[90m binding-shorthand[0m
  [32m  ✓[0m[90m comment[0m
  [32m  ✓[0m[90m component-dynamic[0m
  [32m  ✓[0m[90m convert-entities[0m
  [32m  ✓[0m[90m convert-entities-in-element[0m
  [32m  ✓[0m[90m css[0m
  [32m  ✓[0m[90m css-ref-selector[0m
  [32m  ✓[0m[90m dynamic-import[0m
  [32m  ✓[0m[90m each-block[0m
  [32m  ✓[0m[90m each-block-destructured[0m
  [32m  ✓[0m[90m each-block-else[0m
  [32m  ✓[0m[90m each-block-indexed[0m
  [32m  ✓[0m[90m each-block-keyed[0m
  [32m  ✓[0m[90m element-with-mustache[0m
  [32m  ✓[0m[90m element-with-text[0m
  [32m  ✓[0m[90m elements[0m
  [32m  ✓[0m[90m error-binding-disabled[0m
  [32m  ✓[0m[90m error-binding-mustaches[0m
  [32m  ✓[0m[90m error-binding-rvalue[0m
  [32m  ✓[0m[90m error-css[0m[31m (163ms)[0m
  [32m  ✓[0m[90m error-event-handler[0m
  [32m  ✓[0m[90m error-illegal-expression[0m
  [32m  ✓[0m[90m error-multiple-styles[0m
  [32m  ✓[0m[90m error-script-unclosed[0m
  [32m  ✓[0m[90m error-self-reference[0m
  [32m  ✓[0m[90m error-unexpected-end-of-input[0m
  [32m  ✓[0m[90m error-unexpected-end-of-input-b[0m
  [32m  ✓[0m[90m error-unexpected-end-of-input-c[0m
  [32m  ✓[0m[90m error-unexpected-end-of-input-d[0m
  [32m  ✓[0m[90m error-unmatched-closing-tag[0m
  [32m  ✓[0m[90m error-void-closing[0m
  [32m  ✓[0m[90m error-window-children[0m
  [32m  ✓[0m[90m error-window-duplicate[0m
[
  { start: null, end: null, type: 'Fragment', children: [ [Object] ] },
  {
    start: 0,
    end: null,
    type: 'IfBlock',
    expression: { type: 'Identifier', start: 6, end: 9, name: 'foo' },
    children: [ [Object] ]
  }
]
  [32m  ✓[0m[90m error-window-inside-block[0m
[
  { start: null, end: null, type: 'Fragment', children: [ [Object] ] },
  {
    start: 0,
    end: null,
    type: 'Element',
    name: 'div',
    attributes: [],
    children: [ [Object] ]
  }
]
  [32m  ✓[0m[90m error-window-inside-element[0m
  [32m  ✓[0m[90m event-handler[0m
  [32m  ✓[0m[90m if-block[0m
  [32m  ✓[0m[90m if-block-else[0m
  [32m  ✓[0m[90m if-block-elseif[0m
  [32m  ✓[0m[90m implicitly-closed-li[0m
  [32m  ✓[0m[90m nbsp[0m
  [32m  ✓[0m[90m raw-mustaches[0m
  [32m  ✓[0m[90m refs[0m
  [32m  ✓[0m[90m script[0m
  [32m  ✓[0m[90m script-comment-only[0m
  [32m  ✓[0m[90m script-comment-trailing[0m
  [32m  ✓[0m[90m script-comment-trailing-multiline[0m
  [32m  ✓[0m[90m self-closing-element[0m
  [32m  ✓[0m[90m self-reference[0m
  [32m  ✓[0m[90m space-between-mustaches[0m
  [32m  ✓[0m[90m textarea-children[0m
  [32m  ✓[0m[90m transition-intro[0m
  [32m  ✓[0m[90m transition-intro-no-params[0m
  [32m  ✓[0m[90m whitespace-leading-trailing[0m
  [32m  ✓[0m[90m whitespace-normal[0m
  [32m  ✓[0m[90m yield[0m
  [32m  ✓[0m[90m handles errors with options.onerror[0m
  [32m  ✓[0m[90m throws without options.onerror[0m
  [32m  ✓[0m[90m includes AST in svelte.compile output[0m

[0m  preprocess[0m
  [32m  ✓[0m[90m preprocesses entire component[0m
  [32m  ✓[0m[90m preprocesses style[0m
  [32m  ✓[0m[90m preprocesses style asynchronously[0m
  [32m  ✓[0m[90m preprocesses script[0m
  [32m  ✓[0m[90m parses attributes[0m
  [32m  ✓[0m[90m provides filename to processing hooks[0m
  [32m  ✓[0m[90m ignores null/undefined returned from preprocessor[0m

[0m  runtime[0m
  [32m  ✓[0m[90m attribute-boolean-indeterminate (shared helpers)[0m
  [32m  ✓[0m[90m attribute-boolean-indeterminate (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-boolean-indeterminate (inline helpers)[0m
  [32m  ✓[0m[90m attribute-casing (shared helpers)[0m
  [32m  ✓[0m[90m attribute-casing (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-casing (inline helpers)[0m
  [32m  ✓[0m[90m attribute-dynamic (shared helpers)[0m
  [32m  ✓[0m[90m attribute-dynamic (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-dynamic (inline helpers)[0m
  [32m  ✓[0m[90m attribute-dynamic-multiple (shared helpers)[0m
  [32m  ✓[0m[90m attribute-dynamic-multiple (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-dynamic-multiple (inline helpers)[0m
  [32m  ✓[0m[90m attribute-dynamic-reserved (shared helpers)[0m
  [32m  ✓[0m[90m attribute-dynamic-reserved (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-dynamic-reserved (inline helpers)[0m
  [32m  ✓[0m[90m attribute-dynamic-shorthand (shared helpers)[0m
  [32m  ✓[0m[90m attribute-dynamic-shorthand (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-dynamic-shorthand (inline helpers)[0m
  [32m  ✓[0m[90m attribute-dynamic-type (shared helpers)[0m
  [32m  ✓[0m[90m attribute-dynamic-type (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-dynamic-type (inline helpers)[0m
  [32m  ✓[0m[90m attribute-empty (shared helpers)[0m
  [32m  ✓[0m[90m attribute-empty (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-empty (inline helpers)[0m
  [32m  ✓[0m[90m attribute-empty-svg (shared helpers)[0m
  [32m  ✓[0m[90m attribute-empty-svg (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-empty-svg (inline helpers)[0m
  [32m  ✓[0m[90m attribute-namespaced (shared helpers)[0m
  [32m  ✓[0m[90m attribute-namespaced (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-namespaced (inline helpers)[0m
  [32m  ✓[0m[90m attribute-partial-number (shared helpers)[0m
  [32m  ✓[0m[90m attribute-partial-number (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-partial-number (inline helpers)[0m
  [32m  ✓[0m[90m attribute-prefer-expression (shared helpers)[0m
  [32m  ✓[0m[90m attribute-prefer-expression (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-prefer-expression (inline helpers)[0m
  [32m  ✓[0m[90m attribute-static (shared helpers)[0m
  [32m  ✓[0m[90m attribute-static (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-static (inline helpers)[0m
  [32m  ✓[0m[90m attribute-static-at-symbol (shared helpers)[0m
  [32m  ✓[0m[90m attribute-static-at-symbol (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-static-at-symbol (inline helpers)[0m
  [32m  ✓[0m[90m attribute-static-boolean (shared helpers)[0m
  [32m  ✓[0m[90m attribute-static-boolean (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-static-boolean (inline helpers)[0m
  [32m  ✓[0m[90m attribute-static-quotemarks (shared helpers)[0m
  [32m  ✓[0m[90m attribute-static-quotemarks (shared helpers , hydration)[0m
  [32m  ✓[0m[90m attribute-static-quotemarks (inline helpers)[0m
(2:18) – A11y: Avoid using autofocus
(2:18) – A11y: Avoid using autofocus
  [32m  ✓[0m[90m autofocus (shared helpers)[0m
(2:18) – A11y: Avoid using autofocus
(2:18) – A11y: Avoid using autofocus
  [32m  ✓[0m[90m autofocus (shared helpers , hydration)[0m
(2:18) – A11y: Avoid using autofocus
(2:18) – A11y: Avoid using autofocus
  [32m  ✓[0m[90m autofocus (inline helpers)[0m
  [32m  ✓[0m[90m await-component-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m await-component-oncreate (shared helpers , hydration)[0m
  [32m  ✓[0m[90m await-component-oncreate (inline helpers)[0m
  [32m  ✓[0m[90m await-then-catch (shared helpers)[0m
  [32m  ✓[0m[90m await-then-catch (shared helpers , hydration)[0m
  [32m  ✓[0m[90m await-then-catch (inline helpers)[0m
  [32m  ✓[0m[90m await-then-catch-anchor (shared helpers)[0m
  [32m  ✓[0m[90m await-then-catch-anchor (shared helpers , hydration)[0m
  [32m  ✓[0m[90m await-then-catch-anchor (inline helpers)[0m
  [32m  ✓[0m[90m await-then-catch-event (shared helpers)[0m
  [32m  ✓[0m[90m await-then-catch-event (shared helpers , hydration)[0m
  [32m  ✓[0m[90m await-then-catch-event (inline helpers)[0m
  [32m  ✓[0m[90m await-then-catch-if (shared helpers)[0m
  [32m  ✓[0m[90m await-then-catch-if (shared helpers , hydration)[0m
  [32m  ✓[0m[90m await-then-catch-if (inline helpers)[0m
  [32m  ✓[0m[90m await-then-catch-in-slot (shared helpers)[0m
  [32m  ✓[0m[90m await-then-catch-in-slot (shared helpers , hydration)[0m
  [32m  ✓[0m[90m await-then-catch-in-slot (inline helpers)[0m
  [32m  ✓[0m[90m await-then-catch-multiple (shared helpers)[0m
  [32m  ✓[0m[90m await-then-catch-multiple (shared helpers , hydration)[0m
  [32m  ✓[0m[90m await-then-catch-multiple (inline helpers)[0m
  [32m  ✓[0m[90m await-then-catch-non-promise (shared helpers)[0m
  [32m  ✓[0m[90m await-then-catch-non-promise (shared helpers , hydration)[0m
  [32m  ✓[0m[90m await-then-catch-non-promise (inline helpers)[0m
  [32m  ✓[0m[90m await-then-shorthand (shared helpers)[0m
  [32m  ✓[0m[90m await-then-shorthand (shared helpers , hydration)[0m
  [32m  ✓[0m[90m await-then-shorthand (inline helpers)[0m
  [36m  - binding-audio-currenttime-duration (shared helpers)[0m
  [36m  - binding-audio-currenttime-duration (shared helpers , hydration)[0m
  [36m  - binding-audio-currenttime-duration (inline helpers)[0m
  [32m  ✓[0m[90m binding-indirect (shared helpers)[0m
  [32m  ✓[0m[90m binding-indirect (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-indirect (inline helpers)[0m
  [32m  ✓[0m[90m binding-indirect-computed (shared helpers)[0m
  [32m  ✓[0m[90m binding-indirect-computed (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-indirect-computed (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-checkbox (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-checkbox (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-checkbox (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-checkbox-deep-contextual (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-checkbox-deep-contextual (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-checkbox-deep-contextual (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-checkbox-group (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-checkbox-group (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-checkbox-group (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-checkbox-group-outside-each (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-checkbox-group-outside-each (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-checkbox-group-outside-each (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-checkbox-indeterminate (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-checkbox-indeterminate (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-checkbox-indeterminate (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-number (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-number (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-number (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-radio-group (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-radio-group (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-radio-group (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-range (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-range (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-range (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-range-change (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-range-change (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-range-change (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-text (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-text (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-text (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-text-contextual (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-text-contextual (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-text-contextual (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deconflicted (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deconflicted (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-text-deconflicted (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deep (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deep (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-text-deep (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deep-computed (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deep-computed (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-text-deep-computed (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deep-computed-dynamic (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deep-computed-dynamic (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-text-deep-computed-dynamic (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deep-contextual (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deep-contextual (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-text-deep-contextual (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deep-contextual-computed-dynamic (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-text-deep-contextual-computed-dynamic (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-text-deep-contextual-computed-dynamic (inline helpers)[0m
  [32m  ✓[0m[90m binding-input-with-event (shared helpers)[0m
  [32m  ✓[0m[90m binding-input-with-event (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-input-with-event (inline helpers)[0m

>> [36m[1mmain.html[22m[39m
[90m    1: [39m/* main.html generated by Svelte v1.51.1 */
[90m    2: [39m"use strict";
[90m    3: [39m
[90m    4: [39mvar __shared = require("/testbed/shared.js");
[90m    5: [39mvar addListener$ = __shared.addListener;
[90m    6: [39mvar appendNode$ = __shared.appendNode;
[90m    7: [39mvar assign$ = __shared.assign;
[90m    8: [39mvar callAll$ = __shared.callAll;
[90m    9: [39mvar createElement$ = __shared.createElement;
[90m   10: [39mvar createText$ = __shared.createText;
[90m   11: [39mvar detachNode$ = __shared.detachNode;
[90m   12: [39mvar init$ = __shared.init;
[90m   13: [39mvar insertNode$ = __shared.insertNode;
[90m   14: [39mvar proto$ = __shared.proto;
[90m   15: [39mvar removeListener$ = __shared.removeListener;
[90m   16: [39mvar selectOption$ = __shared.selectOption;
[90m   17: [39mvar selectValue$ = __shared.selectValue;
[90m   18: [39m
[90m   19: [39mfunction create_main_fragment$(state, component$) {
[90m   20: [39m    var p$, text$, text$_1, text$_2, select$, option$, text$_3, option$_1, text$_4, option$_2, text$_5, select$_updating$ = false, text$_6, p$_1, text$_7, text$_8;
[90m   21: [39m
[90m   22: [39m    function select$_change_handler$() {
[90m   23: [39m        select$_updating$ = true;
[90m   24: [39m        component$.set({ selected: selectValue$(select$) });
[90m   25: [39m        select$_updating$ = false;
[90m   26: [39m    }
[90m   27: [39m
[90m   28: [39m    return {
[90m   29: [39m        c: function create() {
[90m   30: [39m            p$ = createElement$("p");
[90m   31: [39m            text$ = createText$("selected: ");
[90m   32: [39m            text$_1 = createText$(state.selected);
[90m   33: [39m            text$_2 = createText$("\n\n");
[90m   34: [39m            select$ = createElement$("select");
[90m   35: [39m            option$ = createElement$("option");
[90m   36: [39m            text$_3 = createText$("one");
[90m   37: [39m            option$_1 = createElement$("option");
[90m   38: [39m            text$_4 = createText$("two");
[90m   39: [39m            option$_2 = createElement$("option");
[90m   40: [39m            text$_5 = createText$("three");
[90m   41: [39m            text$_6 = createText$("\n\n");
[90m   42: [39m            p$_1 = createElement$("p");
[90m   43: [39m            text$_7 = createText$("selected: ");
[90m   44: [39m            text$_8 = createText$(state.selected);
[90m   45: [39m            this.h();
[90m   46: [39m        },
[90m   47: [39m
[90m   48: [39m        h: function hydrate() {
[90m   49: [39m            option$.__value = "one";
[90m   50: [39m            option$.value = option$.__value;
[90m   51: [39m            option$_1.__value = "two";
[90m   52: [39m            option$_1.value = option$_1.__value;
[90m   53: [39m            option$_2.__value = "three";
[90m   54: [39m            option$_2.value = option$_2.__value;
[90m   55: [39m            addListener$(select$, "change", select$_change_handler$);
[90m   56: [39m            if (!('selected' in state)) component$.root._beforecreate.push(select$_change_handler$);
[90m   57: [39m        },
[90m   58: [39m
[90m   59: [39m        m: function mount(target$, anchor) {
[90m   60: [39m            insertNode$(p$, target$, anchor);
[90m   61: [39m            appendNode$(text$, p$);
[90m   62: [39m            appendNode$(text$_1, p$);
[90m   63: [39m            insertNode$(text$_2, target$, anchor);
[90m   64: [39m            insertNode$(select$, target$, anchor);
[90m   65: [39m            appendNode$(option$, select$);
[90m   66: [39m            appendNode$(text$_3, option$);
[90m   67: [39m            appendNode$(option$_1, select$);
[90m   68: [39m            appendNode$(text$_4, option$_1);
[90m   69: [39m            appendNode$(option$_2, select$);
[90m   70: [39m            appendNode$(text$_5, option$_2);
[90m   71: [39m
[90m   72: [39m            selectOption$(select$, state.selected)
[90m   73: [39m
[90m   74: [39m            insertNode$(text$_6, target$, anchor);
[90m   75: [39m            insertNode$(p$_1, target$, anchor);
[90m   76: [39m            appendNode$(text$_7, p$_1);
[90m   77: [39m            appendNode$(text$_8, p$_1);
[90m   78: [39m        },
[90m   79: [39m
[90m   80: [39m        p: function update(changed, state) {
[90m   81: [39m            if (changed.selected) {
[90m   82: [39m                text$_1.data = state.selected;
[90m   83: [39m            }
[90m   84: [39m
[90m   85: [39m            if (!select$_updating$) selectOption$(select$, state.selected)
[90m   86: [39m            if (changed.selected) {
[90m   87: [39m                text$_8.data = state.selected;
[90m   88: [39m            }
[90m   89: [39m        },
[90m   90: [39m
[90m   91: [39m        u: function unmount() {
[90m   92: [39m            detachNode$(p$);
[90m   93: [39m            detachNode$(text$_2);
[90m   94: [39m            detachNode$(select$);
[90m   95: [39m            detachNode$(text$_6);
[90m   96: [39m            detachNode$(p$_1);
[90m   97: [39m        },
[90m   98: [39m
[90m   99: [39m        d: function destroy() {
[90m  100: [39m            removeListener$(select$, "change", select$_change_handler$);
[90m  101: [39m        }
[90m  102: [39m    };
[90m  103: [39m}
[90m  104: [39m
[90m  105: [39mfunction Main$(options) {
[90m  106: [39m    init$(this, options);
[90m  107: [39m    this._state = assign$({}, options.data);
[90m  108: [39m
[90m  109: [39m    if (!options.root) {
[90m  110: [39m        this._oncreate = [];
[90m  111: [39m        this._beforecreate = [];
[90m  112: [39m    }
[90m  113: [39m
[90m  114: [39m    this._fragment = create_main_fragment$(this._state, this);
[90m  115: [39m
[90m  116: [39m    if (options.target) {
[90m  117: [39m        this._fragment.c();
[90m  118: [39m        this._fragment.m(options.target, options.anchor || null);
[90m  119: [39m
[90m  120: [39m        callAll$(this._beforecreate);
[90m  121: [39m    }
[90m  122: [39m}
[90m  123: [39m
[90m  124: [39massign$(Main$.prototype, proto$);
[90m  125: [39m
[90m  126: [39mmodule.exports = Main$;
<< [36m[1mmain.html[22m[39m
  [31m  7) binding-select (shared helpers)[0m
  [31m  8) binding-select (shared helpers , hydration)[0m
  [31m  9) binding-select (inline helpers)[0m
  [32m  ✓[0m[90m binding-select-implicit-option-value (shared helpers)[0m
  [32m  ✓[0m[90m binding-select-implicit-option-value (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-select-implicit-option-value (inline helpers)[0m
  [36m  - binding-select-in-each-block (shared helpers)[0m
  [36m  - binding-select-in-each-block (shared helpers , hydration)[0m
  [36m  - binding-select-in-each-block (inline helpers)[0m
  [32m  ✓[0m[90m binding-select-in-yield (shared helpers)[0m
  [32m  ✓[0m[90m binding-select-in-yield (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-select-in-yield (inline helpers)[0m
  [32m  ✓[0m[90m binding-select-initial-value (shared helpers)[0m
  [32m  ✓[0m[90m binding-select-initial-value (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-select-initial-value (inline helpers)[0m
  [32m  ✓[0m[90m binding-select-initial-value-undefined (shared helpers)[0m
  [32m  ✓[0m[90m binding-select-initial-value-undefined (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-select-initial-value-undefined (inline helpers)[0m
  [32m  ✓[0m[90m binding-select-late (shared helpers)[0m
  [32m  ✓[0m[90m binding-select-late (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-select-late (inline helpers)[0m
  [36m  - binding-select-multiple (shared helpers)[0m
  [36m  - binding-select-multiple (shared helpers , hydration)[0m
  [36m  - binding-select-multiple (inline helpers)[0m
  [36m  - binding-select-optgroup (shared helpers)[0m
  [36m  - binding-select-optgroup (shared helpers , hydration)[0m
  [36m  - binding-select-optgroup (inline helpers)[0m
  [32m  ✓[0m[90m binding-textarea (shared helpers)[0m
  [32m  ✓[0m[90m binding-textarea (shared helpers , hydration)[0m
  [32m  ✓[0m[90m binding-textarea (inline helpers)[0m
  [32m  ✓[0m[90m bindings-before-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m bindings-before-oncreate (shared helpers , hydration)[0m
  [32m  ✓[0m[90m bindings-before-oncreate (inline helpers)[0m
  [32m  ✓[0m[90m bindings-coalesced (shared helpers)[0m
  [32m  ✓[0m[90m bindings-coalesced (shared helpers , hydration)[0m
  [32m  ✓[0m[90m bindings-coalesced (inline helpers)[0m
  [32m  ✓[0m[90m component (shared helpers)[0m
  [32m  ✓[0m[90m component (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component (inline helpers)[0m
  [32m  ✓[0m[90m component-binding (shared helpers)[0m
  [32m  ✓[0m[90m component-binding (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-blowback (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-blowback (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-blowback (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-blowback-b (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-blowback-b (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-blowback-b (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-blowback-c (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-blowback-c (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-blowback-c (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-computed (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-computed (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-computed (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-conditional (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-conditional (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-conditional (inline helpers)[0m
  [36m  - component-binding-conditional-b (shared helpers)[0m
  [36m  - component-binding-conditional-b (shared helpers , hydration)[0m
  [36m  - component-binding-conditional-b (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-deep (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-deep (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-deep (inline helpers)[0m
  [36m  - component-binding-deep-b (shared helpers)[0m
  [36m  - component-binding-deep-b (shared helpers , hydration)[0m
  [36m  - component-binding-deep-b (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-each (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-each (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-each (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-each-nested (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-each-nested (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-each-nested (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-each-object (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-each-object (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-each-object (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-infinite-loop (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-infinite-loop (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-infinite-loop (inline helpers)[0m[33m (39ms)[0m
  [32m  ✓[0m[90m component-binding-nested (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-nested (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-nested (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-parent-supercedes-child (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-parent-supercedes-child (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-parent-supercedes-child (inline helpers)[0m
  [32m  ✓[0m[90m component-binding-self-destroying (shared helpers)[0m
  [32m  ✓[0m[90m component-binding-self-destroying (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-binding-self-destroying (inline helpers)[0m
  [32m  ✓[0m[90m component-data-dynamic (shared helpers)[0m
  [32m  ✓[0m[90m component-data-dynamic (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-data-dynamic (inline helpers)[0m
  [32m  ✓[0m[90m component-data-dynamic-late (shared helpers)[0m
  [32m  ✓[0m[90m component-data-dynamic-late (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-data-dynamic-late (inline helpers)[0m
  [32m  ✓[0m[90m component-data-dynamic-shorthand (shared helpers)[0m
  [32m  ✓[0m[90m component-data-dynamic-shorthand (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-data-dynamic-shorthand (inline helpers)[0m
  [32m  ✓[0m[90m component-data-empty (shared helpers)[0m
  [32m  ✓[0m[90m component-data-empty (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-data-empty (inline helpers)[0m
  [32m  ✓[0m[90m component-data-static (shared helpers)[0m
  [32m  ✓[0m[90m component-data-static (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-data-static (inline helpers)[0m
  [32m  ✓[0m[90m component-data-static-boolean (shared helpers)[0m
  [32m  ✓[0m[90m component-data-static-boolean (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-data-static-boolean (inline helpers)[0m
  [32m  ✓[0m[90m component-data-static-boolean-regression (shared helpers)[0m
  [32m  ✓[0m[90m component-data-static-boolean-regression (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-data-static-boolean-regression (inline helpers)[0m
  [32m  ✓[0m[90m component-events (shared helpers)[0m
  [32m  ✓[0m[90m component-events (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-events (inline helpers)[0m
  [32m  ✓[0m[90m component-events-data (shared helpers)[0m
  [32m  ✓[0m[90m component-events-data (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-events-data (inline helpers)[0m
  [32m  ✓[0m[90m component-events-each (shared helpers)[0m
  [32m  ✓[0m[90m component-events-each (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-events-each (inline helpers)[0m
  [32m  ✓[0m[90m component-if-placement (shared helpers)[0m
  [32m  ✓[0m[90m component-if-placement (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-if-placement (inline helpers)[0m
(9:3) – The 'Level3' component is unused
  [32m  ✓[0m[90m component-nested-deep (shared helpers)[0m
(9:3) – The 'Level3' component is unused
  [32m  ✓[0m[90m component-nested-deep (shared helpers , hydration)[0m
(9:3) – The 'Level3' component is unused
  [32m  ✓[0m[90m component-nested-deep (inline helpers)[0m
  [32m  ✓[0m[90m component-nested-deeper (shared helpers)[0m
  [32m  ✓[0m[90m component-nested-deeper (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-nested-deeper (inline helpers)[0m
  [32m  ✓[0m[90m component-not-void (shared helpers)[0m
  [32m  ✓[0m[90m component-not-void (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-not-void (inline helpers)[0m
  [32m  ✓[0m[90m component-ref (shared helpers)[0m
  [32m  ✓[0m[90m component-ref (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-ref (inline helpers)[0m
  [32m  ✓[0m[90m component-slot-default (shared helpers)[0m
  [32m  ✓[0m[90m component-slot-default (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-slot-default (inline helpers)[0m
  [32m  ✓[0m[90m component-slot-each-block (shared helpers)[0m
  [32m  ✓[0m[90m component-slot-each-block (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-slot-each-block (inline helpers)[0m
  [32m  ✓[0m[90m component-slot-empty (shared helpers)[0m
  [32m  ✓[0m[90m component-slot-empty (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-slot-empty (inline helpers)[0m
  [32m  ✓[0m[90m component-slot-fallback (shared helpers)[0m
  [32m  ✓[0m[90m component-slot-fallback (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-slot-fallback (inline helpers)[0m
  [32m  ✓[0m[90m component-slot-if-block (shared helpers)[0m
  [32m  ✓[0m[90m component-slot-if-block (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-slot-if-block (inline helpers)[0m
  [32m  ✓[0m[90m component-slot-if-block-before-node (shared helpers)[0m
  [32m  ✓[0m[90m component-slot-if-block-before-node (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-slot-if-block-before-node (inline helpers)[0m
  [32m  ✓[0m[90m component-slot-if-else-block-before-node (shared helpers)[0m
  [32m  ✓[0m[90m component-slot-if-else-block-before-node (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-slot-if-else-block-before-node (inline helpers)[0m
  [32m  ✓[0m[90m component-slot-named (shared helpers)[0m
  [32m  ✓[0m[90m component-slot-named (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-slot-named (inline helpers)[0m
  [32m  ✓[0m[90m component-slot-nested (shared helpers)[0m
  [32m  ✓[0m[90m component-slot-nested (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-slot-nested (inline helpers)[0m
  [32m  ✓[0m[90m component-slot-nested-component (shared helpers)[0m
  [32m  ✓[0m[90m component-slot-nested-component (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-slot-nested-component (inline helpers)[0m
  [32m  ✓[0m[90m component-static-at-symbol (shared helpers)[0m
  [32m  ✓[0m[90m component-static-at-symbol (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-static-at-symbol (inline helpers)[0m
  [32m  ✓[0m[90m component-yield (shared helpers)[0m
  [32m  ✓[0m[90m component-yield (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-yield (inline helpers)[0m
  [32m  ✓[0m[90m component-yield-follows-element (shared helpers)[0m
  [32m  ✓[0m[90m component-yield-follows-element (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-yield-follows-element (inline helpers)[0m
  [32m  ✓[0m[90m component-yield-if (shared helpers)[0m
  [32m  ✓[0m[90m component-yield-if (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-yield-if (inline helpers)[0m
  [32m  ✓[0m[90m component-yield-multiple-in-each (shared helpers)[0m
  [32m  ✓[0m[90m component-yield-multiple-in-each (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-yield-multiple-in-each (inline helpers)[0m
  [32m  ✓[0m[90m component-yield-multiple-in-if (shared helpers)[0m
  [32m  ✓[0m[90m component-yield-multiple-in-if (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-yield-multiple-in-if (inline helpers)[0m
  [32m  ✓[0m[90m component-yield-nested-if (shared helpers)[0m
  [32m  ✓[0m[90m component-yield-nested-if (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-yield-nested-if (inline helpers)[0m
  [32m  ✓[0m[90m component-yield-parent (shared helpers)[0m
  [32m  ✓[0m[90m component-yield-parent (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-yield-parent (inline helpers)[0m
Error: Uncaught [TypeError: Cannot read properties of null (reading 'removeChild')]
    at reportException (/testbed/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at invokeEventListeners (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:209:9)
    at HTMLButtonElementImpl._dispatch (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:82:17)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/nodes/HTMLElement-impl.js:30:27)
    at HTMLButtonElement.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:143:21)
    at Object.test (/testbed/test/runtime/samples/component-yield-placement/_config.js:19:10)
    at /testbed/test/runtime/index.js:187:37 TypeError: Cannot read properties of null (reading 'removeChild')
    at detachNode (/testbed/shared.js:25:18)
    at Object.unmount [as u] (/testbed/test/runtime/samples/component-yield-placement/Modal.html:65:4)
    at Modal$.destroy (/testbed/shared.js:411:39)
    at HTMLButtonElement.click_handler$_1 (/testbed/test/runtime/samples/component-yield-placement/Modal.html:27:14)
    at invokeEventListeners (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
    at HTMLButtonElementImpl._dispatch (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:82:17)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/nodes/HTMLElement-impl.js:30:27)
    at HTMLButtonElement.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:143:21)
    at Object.test (/testbed/test/runtime/samples/component-yield-placement/_config.js:19:10)
    at /testbed/test/runtime/index.js:187:37
  [32m  ✓[0m[90m component-yield-placement (shared helpers)[0m
Error: Uncaught [TypeError: Cannot read properties of null (reading 'removeChild')]
    at reportException (/testbed/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at invokeEventListeners (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:209:9)
    at HTMLButtonElementImpl._dispatch (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:82:17)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/nodes/HTMLElement-impl.js:30:27)
    at HTMLButtonElement.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:143:21)
    at Object.test (/testbed/test/runtime/samples/component-yield-placement/_config.js:19:10)
    at /testbed/test/runtime/index.js:187:37 TypeError: Cannot read properties of null (reading 'removeChild')
    at detachNode (/testbed/shared.js:25:18)
    at Object.unmount [as u] (/testbed/test/runtime/samples/component-yield-placement/Modal.html:90:4)
    at Modal$.destroy (/testbed/shared.js:411:39)
    at HTMLButtonElement.click_handler$_1 (/testbed/test/runtime/samples/component-yield-placement/Modal.html:30:14)
    at invokeEventListeners (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
    at HTMLButtonElementImpl._dispatch (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:82:17)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/nodes/HTMLElement-impl.js:30:27)
    at HTMLButtonElement.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:143:21)
    at Object.test (/testbed/test/runtime/samples/component-yield-placement/_config.js:19:10)
    at /testbed/test/runtime/index.js:187:37
  [32m  ✓[0m[90m component-yield-placement (shared helpers , hydration)[0m
Error: Uncaught [TypeError: Cannot read properties of null (reading 'removeChild')]
    at reportException (/testbed/node_modules/jsdom/lib/jsdom/living/helpers/runtime-script-errors.js:66:24)
    at invokeEventListeners (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:209:9)
    at HTMLButtonElementImpl._dispatch (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:82:17)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/nodes/HTMLElement-impl.js:30:27)
    at HTMLButtonElement.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:143:21)
    at Object.test (/testbed/test/runtime/samples/component-yield-placement/_config.js:19:10)
    at /testbed/test/runtime/index.js:187:37 TypeError: Cannot read properties of null (reading 'removeChild')
    at detachNode$ (/testbed/test/runtime/samples/component-yield-placement/Modal.html:124:18)
    at Object.unmount [as u] (/testbed/test/runtime/samples/component-yield-placement/Modal.html:50:4)
    at Modal$.destroy$ (/testbed/test/runtime/samples/component-yield-placement/Modal.html:164:39)
    at HTMLButtonElement.click_handler$_1 (/testbed/test/runtime/samples/component-yield-placement/Modal.html:12:14)
    at invokeEventListeners (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:193:27)
    at HTMLButtonElementImpl._dispatch (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:119:9)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/events/EventTarget-impl.js:82:17)
    at HTMLButtonElementImpl.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/nodes/HTMLElement-impl.js:30:27)
    at HTMLButtonElement.dispatchEvent (/testbed/node_modules/jsdom/lib/jsdom/living/generated/EventTarget.js:143:21)
    at Object.test (/testbed/test/runtime/samples/component-yield-placement/_config.js:19:10)
    at /testbed/test/runtime/index.js:187:37
  [32m  ✓[0m[90m component-yield-placement (inline helpers)[0m
  [32m  ✓[0m[90m component-yield-static (shared helpers)[0m
  [32m  ✓[0m[90m component-yield-static (shared helpers , hydration)[0m
  [32m  ✓[0m[90m component-yield-static (inline helpers)[0m
  [32m  ✓[0m[90m computed-empty (shared helpers)[0m
  [32m  ✓[0m[90m computed-empty (shared helpers , hydration)[0m
  [32m  ✓[0m[90m computed-empty (inline helpers)[0m
  [32m  ✓[0m[90m computed-function (shared helpers)[0m
  [32m  ✓[0m[90m computed-function (shared helpers , hydration)[0m
  [32m  ✓[0m[90m computed-function (inline helpers)[0m
  [32m  ✓[0m[90m computed-values (shared helpers)[0m
  [32m  ✓[0m[90m computed-values (shared helpers , hydration)[0m
  [32m  ✓[0m[90m computed-values (inline helpers)[0m
  [32m  ✓[0m[90m computed-values-deconflicted (shared helpers)[0m
  [32m  ✓[0m[90m computed-values-deconflicted (shared helpers , hydration)[0m
  [32m  ✓[0m[90m computed-values-deconflicted (inline helpers)[0m
  [32m  ✓[0m[90m computed-values-default (shared helpers)[0m
  [32m  ✓[0m[90m computed-values-default (shared helpers , hydration)[0m
  [32m  ✓[0m[90m computed-values-default (inline helpers)[0m
  [32m  ✓[0m[90m computed-values-function-dependency (shared helpers)[0m
  [32m  ✓[0m[90m computed-values-function-dependency (shared helpers , hydration)[0m
  [32m  ✓[0m[90m computed-values-function-dependency (inline helpers)[0m
  [32m  ✓[0m[90m css (shared helpers)[0m
  [32m  ✓[0m[90m css (shared helpers , hydration)[0m
  [32m  ✓[0m[90m css (inline helpers)[0m
  [32m  ✓[0m[90m css-comments (shared helpers)[0m
  [32m  ✓[0m[90m css-comments (shared helpers , hydration)[0m
  [32m  ✓[0m[90m css-comments (inline helpers)[0m
  [32m  ✓[0m[90m css-false (shared helpers)[0m
  [32m  ✓[0m[90m css-false (shared helpers , hydration)[0m
  [32m  ✓[0m[90m css-false (inline helpers)[0m
  [32m  ✓[0m[90m css-space-in-attribute (shared helpers)[0m
  [32m  ✓[0m[90m css-space-in-attribute (shared helpers , hydration)[0m
  [32m  ✓[0m[90m css-space-in-attribute (inline helpers)[0m
  [32m  ✓[0m[90m custom-method (shared helpers)[0m
  [32m  ✓[0m[90m custom-method (shared helpers , hydration)[0m
  [32m  ✓[0m[90m custom-method (inline helpers)[0m
  [32m  ✓[0m[90m deconflict-builtins (shared helpers)[0m
  [32m  ✓[0m[90m deconflict-builtins (shared helpers , hydration)[0m
  [32m  ✓[0m[90m deconflict-builtins (inline helpers)[0m
  [32m  ✓[0m[90m deconflict-contexts (shared helpers)[0m
  [32m  ✓[0m[90m deconflict-contexts (shared helpers , hydration)[0m
  [32m  ✓[0m[90m deconflict-contexts (inline helpers)[0m
  [32m  ✓[0m[90m deconflict-non-helpers (shared helpers)[0m
  [32m  ✓[0m[90m deconflict-non-helpers (shared helpers , hydration)[0m
  [32m  ✓[0m[90m deconflict-non-helpers (inline helpers)[0m
  [32m  ✓[0m[90m deconflict-self (shared helpers)[0m
  [32m  ✓[0m[90m deconflict-self (shared helpers , hydration)[0m
  [32m  ✓[0m[90m deconflict-self (inline helpers)[0m
  [32m  ✓[0m[90m deconflict-template-1 (shared helpers)[0m
  [32m  ✓[0m[90m deconflict-template-1 (shared helpers , hydration)[0m
  [32m  ✓[0m[90m deconflict-template-1 (inline helpers)[0m
  [32m  ✓[0m[90m deconflict-template-2 (shared helpers)[0m
  [32m  ✓[0m[90m deconflict-template-2 (shared helpers , hydration)[0m
  [32m  ✓[0m[90m deconflict-template-2 (inline helpers)[0m
  [32m  ✓[0m[90m deconflict-vars (shared helpers)[0m
  [32m  ✓[0m[90m deconflict-vars (shared helpers , hydration)[0m
  [32m  ✓[0m[90m deconflict-vars (inline helpers)[0m
  [32m  ✓[0m[90m default-data (shared helpers)[0m
  [32m  ✓[0m[90m default-data (shared helpers , hydration)[0m
  [32m  ✓[0m[90m default-data (inline helpers)[0m
  [32m  ✓[0m[90m default-data-function (shared helpers)[0m
  [32m  ✓[0m[90m default-data-function (shared helpers , hydration)[0m
  [32m  ✓[0m[90m default-data-function (inline helpers)[0m
  [32m  ✓[0m[90m default-data-override (shared helpers)[0m
  [32m  ✓[0m[90m default-data-override (shared helpers , hydration)[0m
  [32m  ✓[0m[90m default-data-override (inline helpers)[0m
  [32m  ✓[0m[90m destroy-twice (shared helpers)[0m
  [32m  ✓[0m[90m destroy-twice (shared helpers , hydration)[0m
  [32m  ✓[0m[90m destroy-twice (inline helpers)[0m
  [32m  ✓[0m[90m destructuring (shared helpers)[0m
  [32m  ✓[0m[90m destructuring (shared helpers , hydration)[0m
  [32m  ✓[0m[90m destructuring (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-bad-observe-arguments (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-bad-observe-arguments (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-bad-observe-arguments (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-bad-set-argument (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-bad-set-argument (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-bad-set-argument (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-destroy-not-teardown (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-destroy-not-teardown (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-destroy-not-teardown (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-destroy-twice (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-destroy-twice (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-destroy-twice (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-dynamic-components-misplaced (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-dynamic-components-misplaced (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-dynamic-components-misplaced (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-helper (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-helper (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-helper (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-missing-data (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-missing-data (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-missing-data (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-missing-data-binding (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-missing-data-binding (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-missing-data-binding (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-missing-data-excludes-event (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-missing-data-excludes-event (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-missing-data-excludes-event (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-readonly-computed (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-readonly-computed (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-readonly-computed (inline helpers)[0m
  [32m  ✓[0m[90m dev-warning-readonly-window-binding (shared helpers)[0m
  [32m  ✓[0m[90m dev-warning-readonly-window-binding (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dev-warning-readonly-window-binding (inline helpers)[0m
  [32m  ✓[0m[90m dynamic-component (shared helpers)[0m
  [32m  ✓[0m[90m dynamic-component (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dynamic-component (inline helpers)[0m
  [32m  ✓[0m[90m dynamic-component-bindings (shared helpers)[0m
  [32m  ✓[0m[90m dynamic-component-bindings (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dynamic-component-bindings (inline helpers)[0m
  [32m  ✓[0m[90m dynamic-component-bindings-recreated (shared helpers)[0m
  [32m  ✓[0m[90m dynamic-component-bindings-recreated (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dynamic-component-bindings-recreated (inline helpers)[0m
  [32m  ✓[0m[90m dynamic-component-events (shared helpers)[0m
  [32m  ✓[0m[90m dynamic-component-events (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dynamic-component-events (inline helpers)[0m
  [32m  ✓[0m[90m dynamic-component-inside-element (shared helpers)[0m
  [32m  ✓[0m[90m dynamic-component-inside-element (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dynamic-component-inside-element (inline helpers)[0m
  [32m  ✓[0m[90m dynamic-component-slot (shared helpers)[0m
  [32m  ✓[0m[90m dynamic-component-slot (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dynamic-component-slot (inline helpers)[0m[33m (53ms)[0m
  [32m  ✓[0m[90m dynamic-component-update-existing-instance (shared helpers)[0m
  [32m  ✓[0m[90m dynamic-component-update-existing-instance (shared helpers , hydration)[0m
  [32m  ✓[0m[90m dynamic-component-update-existing-instance (inline helpers)[0m
  [32m  ✓[0m[90m each-block (shared helpers)[0m
  [32m  ✓[0m[90m each-block (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block (inline helpers)[0m
  [32m  ✓[0m[90m each-block-containing-component-in-if (shared helpers)[0m
  [32m  ✓[0m[90m each-block-containing-component-in-if (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-containing-component-in-if (inline helpers)[0m
  [32m  ✓[0m[90m each-block-containing-if (shared helpers)[0m
  [32m  ✓[0m[90m each-block-containing-if (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-containing-if (inline helpers)[0m
  [32m  ✓[0m[90m each-block-destructured-array (shared helpers)[0m
  [32m  ✓[0m[90m each-block-destructured-array (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-destructured-array (inline helpers)[0m
  [32m  ✓[0m[90m each-block-dynamic-else-static (shared helpers)[0m
  [32m  ✓[0m[90m each-block-dynamic-else-static (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-dynamic-else-static (inline helpers)[0m
  [32m  ✓[0m[90m each-block-else (shared helpers)[0m
  [32m  ✓[0m[90m each-block-else (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-else (inline helpers)[0m
  [32m  ✓[0m[90m each-block-else-starts-empty (shared helpers)[0m
  [32m  ✓[0m[90m each-block-else-starts-empty (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-else-starts-empty (inline helpers)[0m
  [32m  ✓[0m[90m each-block-indexed (shared helpers)[0m
  [32m  ✓[0m[90m each-block-indexed (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-indexed (inline helpers)[0m
  [32m  ✓[0m[90m each-block-keyed (shared helpers)[0m
  [32m  ✓[0m[90m each-block-keyed (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-keyed (inline helpers)[0m
  [32m  ✓[0m[90m each-block-keyed-dynamic (shared helpers)[0m
  [32m  ✓[0m[90m each-block-keyed-dynamic (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-keyed-dynamic (inline helpers)[0m
  [32m  ✓[0m[90m each-block-keyed-random-permute (shared helpers)[0m[33m (49ms)[0m
  [32m  ✓[0m[90m each-block-keyed-random-permute (shared helpers , hydration)[0m[33m (55ms)[0m
  [32m  ✓[0m[90m each-block-keyed-random-permute (inline helpers)[0m[33m (42ms)[0m
  [32m  ✓[0m[90m each-block-keyed-unshift (shared helpers)[0m
  [32m  ✓[0m[90m each-block-keyed-unshift (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-keyed-unshift (inline helpers)[0m
  [32m  ✓[0m[90m each-block-random-permute (shared helpers)[0m
  [32m  ✓[0m[90m each-block-random-permute (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-random-permute (inline helpers)[0m
  [32m  ✓[0m[90m each-block-static (shared helpers)[0m
  [32m  ✓[0m[90m each-block-static (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-static (inline helpers)[0m
  [32m  ✓[0m[90m each-block-text-node (shared helpers)[0m
  [32m  ✓[0m[90m each-block-text-node (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-block-text-node (inline helpers)[0m
  [32m  ✓[0m[90m each-blocks-expression (shared helpers)[0m
  [32m  ✓[0m[90m each-blocks-expression (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-blocks-expression (inline helpers)[0m
  [32m  ✓[0m[90m each-blocks-nested (shared helpers)[0m
  [32m  ✓[0m[90m each-blocks-nested (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-blocks-nested (inline helpers)[0m
  [32m  ✓[0m[90m each-blocks-nested-b (shared helpers)[0m
  [32m  ✓[0m[90m each-blocks-nested-b (shared helpers , hydration)[0m
  [32m  ✓[0m[90m each-blocks-nested-b (inline helpers)[0m
  [32m  ✓[0m[90m element-invalid-name (shared helpers)[0m
  [32m  ✓[0m[90m element-invalid-name (shared helpers , hydration)[0m
  [32m  ✓[0m[90m element-invalid-name (inline helpers)[0m
  [32m  ✓[0m[90m empty-style-block (shared helpers)[0m
  [32m  ✓[0m[90m empty-style-block (shared helpers , hydration)[0m
  [32m  ✓[0m[90m empty-style-block (inline helpers)[0m
  [32m  ✓[0m[90m escape-template-literals (shared helpers)[0m
  [32m  ✓[0m[90m escape-template-literals (shared helpers , hydration)[0m
  [32m  ✓[0m[90m escape-template-literals (inline helpers)[0m
  [32m  ✓[0m[90m escaped-text (shared helpers)[0m
  [32m  ✓[0m[90m escaped-text (shared helpers , hydration)[0m
  [32m  ✓[0m[90m escaped-text (inline helpers)[0m
  [32m  ✓[0m[90m event-handler (shared helpers)[0m
  [32m  ✓[0m[90m event-handler (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-console-log (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-console-log (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-console-log (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-custom (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-custom (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-custom (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-custom-context (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-custom-context (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-custom-context (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-custom-each (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-custom-each (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-custom-each (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-custom-node-context (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-custom-node-context (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-custom-node-context (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-destroy (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-destroy (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-destroy (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-each (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-each (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-each (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-each-deconflicted (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-each-deconflicted (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-each-deconflicted (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-event-methods (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-event-methods (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-event-methods (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-hoisted (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-hoisted (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-hoisted (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-removal (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-removal (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-removal (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-sanitize (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-sanitize (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-sanitize (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-shorthand (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-shorthand (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-shorthand (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-shorthand-component (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-shorthand-component (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-shorthand-component (inline helpers)[0m
  [32m  ✓[0m[90m event-handler-this-methods (shared helpers)[0m
  [32m  ✓[0m[90m event-handler-this-methods (shared helpers , hydration)[0m
  [32m  ✓[0m[90m event-handler-this-methods (inline helpers)[0m
  [32m  ✓[0m[90m events-custom (shared helpers)[0m
  [32m  ✓[0m[90m events-custom (shared helpers , hydration)[0m
  [32m  ✓[0m[90m events-custom (inline helpers)[0m
  [32m  ✓[0m[90m events-lifecycle (shared helpers)[0m
  [32m  ✓[0m[90m events-lifecycle (shared helpers , hydration)[0m
  [32m  ✓[0m[90m events-lifecycle (inline helpers)[0m
  [32m  ✓[0m[90m flush-before-bindings (shared helpers)[0m
  [32m  ✓[0m[90m flush-before-bindings (shared helpers , hydration)[0m
  [32m  ✓[0m[90m flush-before-bindings (inline helpers)[0m
  [32m  ✓[0m[90m function-in-expression (shared helpers)[0m
  [32m  ✓[0m[90m function-in-expression (shared helpers , hydration)[0m
  [32m  ✓[0m[90m function-in-expression (inline helpers)[0m
  [32m  ✓[0m[90m get-state (shared helpers)[0m
  [32m  ✓[0m[90m get-state (shared helpers , hydration)[0m
  [32m  ✓[0m[90m get-state (inline helpers)[0m
  [32m  ✓[0m[90m globals-accessible-directly (shared helpers)[0m
  [32m  ✓[0m[90m globals-accessible-directly (shared helpers , hydration)[0m
  [32m  ✓[0m[90m globals-accessible-directly (inline helpers)[0m
  [32m  ✓[0m[90m globals-not-dereferenced (shared helpers)[0m
  [32m  ✓[0m[90m globals-not-dereferenced (shared helpers , hydration)[0m
  [32m  ✓[0m[90m globals-not-dereferenced (inline helpers)[0m
  [32m  ✓[0m[90m globals-not-overwritten-by-bindings (shared helpers)[0m
  [32m  ✓[0m[90m globals-not-overwritten-by-bindings (shared helpers , hydration)[0m
  [32m  ✓[0m[90m globals-not-overwritten-by-bindings (inline helpers)[0m
  [32m  ✓[0m[90m globals-shadowed-by-data (shared helpers)[0m
  [32m  ✓[0m[90m globals-shadowed-by-data (shared helpers , hydration)[0m
  [32m  ✓[0m[90m globals-shadowed-by-data (inline helpers)[0m
  [32m  ✓[0m[90m globals-shadowed-by-helpers (shared helpers)[0m
  [32m  ✓[0m[90m globals-shadowed-by-helpers (shared helpers , hydration)[0m
  [32m  ✓[0m[90m globals-shadowed-by-helpers (inline helpers)[0m
  [32m  ✓[0m[90m head-title-dynamic (shared helpers)[0m
  [32m  ✓[0m[90m head-title-dynamic (shared helpers , hydration)[0m
  [32m  ✓[0m[90m head-title-dynamic (inline helpers)[0m
  [32m  ✓[0m[90m head-title-static (shared helpers)[0m
  [32m  ✓[0m[90m head-title-static (shared helpers , hydration)[0m
  [32m  ✓[0m[90m head-title-static (inline helpers)[0m
  [32m  ✓[0m[90m hello-world (shared helpers)[0m
  [32m  ✓[0m[90m hello-world (shared helpers , hydration)[0m
  [32m  ✓[0m[90m hello-world (inline helpers)[0m
  [32m  ✓[0m[90m helpers (shared helpers)[0m
  [32m  ✓[0m[90m helpers (shared helpers , hydration)[0m
  [32m  ✓[0m[90m helpers (inline helpers)[0m
  [32m  ✓[0m[90m helpers-not-call-expression (shared helpers)[0m
  [32m  ✓[0m[90m helpers-not-call-expression (shared helpers , hydration)[0m
  [32m  ✓[0m[90m helpers-not-call-expression (inline helpers)[0m
  [32m  ✓[0m[90m html-entities (shared helpers)[0m
  [32m  ✓[0m[90m html-entities (shared helpers , hydration)[0m
  [32m  ✓[0m[90m html-entities (inline helpers)[0m
  [32m  ✓[0m[90m html-entities-inside-elements (shared helpers)[0m
  [32m  ✓[0m[90m html-entities-inside-elements (shared helpers , hydration)[0m
  [32m  ✓[0m[90m html-entities-inside-elements (inline helpers)[0m
  [32m  ✓[0m[90m html-non-entities-inside-elements (shared helpers)[0m
  [32m  ✓[0m[90m html-non-entities-inside-elements (shared helpers , hydration)[0m
  [32m  ✓[0m[90m html-non-entities-inside-elements (inline helpers)[0m
  [32m  ✓[0m[90m if-block (shared helpers)[0m
  [32m  ✓[0m[90m if-block (shared helpers , hydration)[0m
  [32m  ✓[0m[90m if-block (inline helpers)[0m
  [32m  ✓[0m[90m if-block-else (shared helpers)[0m
  [32m  ✓[0m[90m if-block-else (shared helpers , hydration)[0m
  [32m  ✓[0m[90m if-block-else (inline helpers)[0m
  [32m  ✓[0m[90m if-block-elseif (shared helpers)[0m
  [32m  ✓[0m[90m if-block-elseif (shared helpers , hydration)[0m
  [32m  ✓[0m[90m if-block-elseif (inline helpers)[0m
  [32m  ✓[0m[90m if-block-elseif-text (shared helpers)[0m
  [32m  ✓[0m[90m if-block-elseif-text (shared helpers , hydration)[0m
  [32m  ✓[0m[90m if-block-elseif-text (inline helpers)[0m
  [32m  ✓[0m[90m if-block-expression (shared helpers)[0m
  [32m  ✓[0m[90m if-block-expression (shared helpers , hydration)[0m
  [32m  ✓[0m[90m if-block-expression (inline helpers)[0m
  [32m  ✓[0m[90m if-block-or (shared helpers)[0m
  [32m  ✓[0m[90m if-block-or (shared helpers , hydration)[0m
  [32m  ✓[0m[90m if-block-or (inline helpers)[0m
  [32m  ✓[0m[90m if-block-widget (shared helpers)[0m
  [32m  ✓[0m[90m if-block-widget (shared helpers , hydration)[0m
  [32m  ✓[0m[90m if-block-widget (inline helpers)[0m
  [32m  ✓[0m[90m ignore-unchanged-attribute (shared helpers)[0m
  [32m  ✓[0m[90m ignore-unchanged-attribute (shared helpers , hydration)[0m
  [32m  ✓[0m[90m ignore-unchanged-attribute (inline helpers)[0m
  [32m  ✓[0m[90m ignore-unchanged-attribute-compound (shared helpers)[0m
  [32m  ✓[0m[90m ignore-unchanged-attribute-compound (shared helpers , hydration)[0m
  [32m  ✓[0m[90m ignore-unchanged-attribute-compound (inline helpers)[0m
  [32m  ✓[0m[90m ignore-unchanged-raw (shared helpers)[0m
  [32m  ✓[0m[90m ignore-unchanged-raw (shared helpers , hydration)[0m
  [32m  ✓[0m[90m ignore-unchanged-raw (inline helpers)[0m
  [32m  ✓[0m[90m ignore-unchanged-tag (shared helpers)[0m
  [32m  ✓[0m[90m ignore-unchanged-tag (shared helpers , hydration)[0m
  [32m  ✓[0m[90m ignore-unchanged-tag (inline helpers)[0m
  [32m  ✓[0m[90m imported-renamed-components (shared helpers)[0m
  [32m  ✓[0m[90m imported-renamed-components (shared helpers , hydration)[0m
  [32m  ✓[0m[90m imported-renamed-components (inline helpers)[0m
  [32m  ✓[0m[90m inline-expressions (shared helpers)[0m
  [32m  ✓[0m[90m inline-expressions (shared helpers , hydration)[0m
  [32m  ✓[0m[90m inline-expressions (inline helpers)[0m
  [32m  ✓[0m[90m input-list (shared helpers)[0m
  [32m  ✓[0m[90m input-list (shared helpers , hydration)[0m
  [32m  ✓[0m[90m input-list (inline helpers)[0m
  [32m  ✓[0m[90m lifecycle-events (shared helpers)[0m
  [32m  ✓[0m[90m lifecycle-events (shared helpers , hydration)[0m
  [32m  ✓[0m[90m lifecycle-events (inline helpers)[0m
  [32m  ✓[0m[90m names-deconflicted (shared helpers)[0m
  [32m  ✓[0m[90m names-deconflicted (shared helpers , hydration)[0m
  [32m  ✓[0m[90m names-deconflicted (inline helpers)[0m
  [32m  ✓[0m[90m names-deconflicted-nested (shared helpers)[0m
  [32m  ✓[0m[90m names-deconflicted-nested (shared helpers , hydration)[0m
  [32m  ✓[0m[90m names-deconflicted-nested (inline helpers)[0m
  [32m  ✓[0m[90m nbsp (shared helpers)[0m
  [32m  ✓[0m[90m nbsp (shared helpers , hydration)[0m
  [32m  ✓[0m[90m nbsp (inline helpers)[0m
  [32m  ✓[0m[90m observe-binding-ignores-unchanged (shared helpers)[0m
  [32m  ✓[0m[90m observe-binding-ignores-unchanged (shared helpers , hydration)[0m
  [32m  ✓[0m[90m observe-binding-ignores-unchanged (inline helpers)[0m
  [32m  ✓[0m[90m observe-component-ignores-irrelevant-changes (shared helpers)[0m
  [32m  ✓[0m[90m observe-component-ignores-irrelevant-changes (shared helpers , hydration)[0m
  [32m  ✓[0m[90m observe-component-ignores-irrelevant-changes (inline helpers)[0m
  [32m  ✓[0m[90m observe-deferred (shared helpers)[0m
  [32m  ✓[0m[90m observe-deferred (shared helpers , hydration)[0m
  [32m  ✓[0m[90m observe-deferred (inline helpers)[0m
  [32m  ✓[0m[90m observe-prevents-loop (shared helpers)[0m
  [32m  ✓[0m[90m observe-prevents-loop (shared helpers , hydration)[0m
  [32m  ✓[0m[90m observe-prevents-loop (inline helpers)[0m
  [36m  - oncreate-async (shared helpers)[0m
  [36m  - oncreate-async (shared helpers , hydration)[0m
  [36m  - oncreate-async (inline helpers)[0m
  [36m  - oncreate-async-arrow (shared helpers)[0m
  [36m  - oncreate-async-arrow (shared helpers , hydration)[0m
  [36m  - oncreate-async-arrow (inline helpers)[0m
  [36m  - oncreate-async-arrow-block (shared helpers)[0m
  [36m  - oncreate-async-arrow-block (shared helpers , hydration)[0m
  [36m  - oncreate-async-arrow-block (inline helpers)[0m
  [32m  ✓[0m[90m ondestroy-before-cleanup (shared helpers)[0m
  [32m  ✓[0m[90m ondestroy-before-cleanup (shared helpers , hydration)[0m
  [32m  ✓[0m[90m ondestroy-before-cleanup (inline helpers)[0m
  [32m  ✓[0m[90m onrender-chain (shared helpers)[0m
  [32m  ✓[0m[90m onrender-chain (shared helpers , hydration)[0m
  [32m  ✓[0m[90m onrender-chain (inline helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (shared helpers , hydration)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready (inline helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (shared helpers)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (shared helpers , hydration)[0m
  [32m  ✓[0m[90m onrender-fires-when-ready-nested (inline helpers)[0m
  [32m  ✓[0m[90m option-without-select (shared helpers)[0m
  [32m  ✓[0m[90m option-without-select (shared helpers , hydration)[0m
  [32m  ✓[0m[90m option-without-select (inline helpers)[0m
  [32m  ✓[0m[90m options (shared helpers)[0m
  [32m  ✓[0m[90m options (shared helpers , hydration)[0m
  [32m  ✓[0m[90m options (inline helpers)[0m
  [32m  ✓[0m[90m paren-wrapped-expressions (shared helpers)[0m
  [32m  ✓[0m[90m paren-wrapped-expressions (shared helpers , hydration)[0m
  [32m  ✓[0m[90m paren-wrapped-expressions (inline helpers)[0m
  [32m  ✓[0m[90m preload (shared helpers)[0m
  [32m  ✓[0m[90m preload (shared helpers , hydration)[0m
  [32m  ✓[0m[90m preload (inline helpers)[0m
  [32m  ✓[0m[90m raw-anchor-first-child (shared helpers)[0m
  [32m  ✓[0m[90m raw-anchor-first-child (shared helpers , hydration)[0m
  [32m  ✓[0m[90m raw-anchor-first-child (inline helpers)[0m
  [32m  ✓[0m[90m raw-anchor-first-last-child (shared helpers)[0m
  [32m  ✓[0m[90m raw-anchor-first-last-child (shared helpers , hydration)[0m
  [32m  ✓[0m[90m raw-anchor-first-last-child (inline helpers)[0m
  [32m  ✓[0m[90m raw-anchor-last-child (shared helpers)[0m
  [32m  ✓[0m[90m raw-anchor-last-child (shared helpers , hydration)[0m
  [32m  ✓[0m[90m raw-anchor-last-child (inline helpers)[0m
  [32m  ✓[0m[90m raw-anchor-next-previous-sibling (shared helpers)[0m
  [32m  ✓[0m[90m raw-anchor-next-previous-sibling (shared helpers , hydration)[0m
  [32m  ✓[0m[90m raw-anchor-next-previous-sibling (inline helpers)[0m
  [32m  ✓[0m[90m raw-anchor-next-sibling (shared helpers)[0m
  [32m  ✓[0m[90m raw-anchor-next-sibling (shared helpers , hydration)[0m
  [32m  ✓[0m[90m raw-anchor-next-sibling (inline helpers)[0m
  [32m  ✓[0m[90m raw-anchor-previous-sibling (shared helpers)[0m
  [32m  ✓[0m[90m raw-anchor-previous-sibling (shared helpers , hydration)[0m
  [32m  ✓[0m[90m raw-anchor-previous-sibling (inline helpers)[0m
  [32m  ✓[0m[90m raw-mustaches (shared helpers)[0m
  [32m  ✓[0m[90m raw-mustaches (shared helpers , hydration)[0m
  [32m  ✓[0m[90m raw-mustaches (inline helpers)[0m
  [32m  ✓[0m[90m raw-mustaches-preserved (shared helpers)[0m
  [32m  ✓[0m[90m raw-mustaches-preserved (shared helpers , hydration)[0m
  [32m  ✓[0m[90m raw-mustaches-preserved (inline helpers)[0m
  [32m  ✓[0m[90m refs (shared helpers)[0m
  [32m  ✓[0m[90m refs (shared helpers , hydration)[0m
  [32m  ✓[0m[90m refs (inline helpers)[0m
  [32m  ✓[0m[90m refs-unset (shared helpers)[0m
  [32m  ✓[0m[90m refs-unset (shared helpers , hydration)[0m
  [32m  ✓[0m[90m refs-unset (inline helpers)[0m
  [32m  ✓[0m[90m select (shared helpers)[0m
  [32m  ✓[0m[90m select (shared helpers , hydration)[0m
  [32m  ✓[0m[90m select (inline helpers)[0m
  [32m  ✓[0m[90m select-bind-array (shared helpers)[0m
  [32m  ✓[0m[90m select-bind-array (shared helpers , hydration)[0m
  [32m  ✓[0m[90m select-bind-array (inline helpers)[0m
  [32m  ✓[0m[90m select-bind-in-array (shared helpers)[0m
  [32m  ✓[0m[90m select-bind-in-array (shared helpers , hydration)[0m
  [32m  ✓[0m[90m select-bind-in-array (inline helpers)[0m
  [32m  ✓[0m[90m select-change-handler (shared helpers)[0m
  [32m  ✓[0m[90m select-change-handler (shared helpers , hydration)[0m
  [32m  ✓[0m[90m select-change-handler (inline helpers)[0m
  [32m  ✓[0m[90m select-no-whitespace (shared helpers)[0m
  [32m  ✓[0m[90m select-no-whitespace (shared helpers , hydration)[0m
  [32m  ✓[0m[90m select-no-whitespace (inline helpers)[0m
  [32m  ✓[0m[90m select-one-way-bind (shared helpers)[0m
  [32m  ✓[0m[90m select-one-way-bind (shared helpers , hydration)[0m
  [32m  ✓[0m[90m select-one-way-bind (inline helpers)[0m
  [32m  ✓[0m[90m select-one-way-bind-object (shared helpers)[0m
  [32m  ✓[0m[90m select-one-way-bind-object (shared helpers , hydration)[0m
  [32m  ✓[0m[90m select-one-way-bind-object (inline helpers)[0m
  [32m  ✓[0m[90m select-props (shared helpers)[0m
  [32m  ✓[0m[90m select-props (shared helpers , hydration)[0m
  [32m  ✓[0m[90m select-props (inline helpers)[0m
  [32m  ✓[0m[90m self-reference (shared helpers)[0m
  [32m  ✓[0m[90m self-reference (shared helpers , hydration)[0m
  [32m  ✓[0m[90m self-reference (inline helpers)[0m
  [32m  ✓[0m[90m self-reference-tree (shared helpers)[0m
  [32m  ✓[0m[90m self-reference-tree (shared helpers , hydration)[0m
  [32m  ✓[0m[90m self-reference-tree (inline helpers)[0m
  [32m  ✓[0m[90m set-after-destroy (shared helpers)[0m
  [32m  ✓[0m[90m set-after-destroy (shared helpers , hydration)[0m
  [32m  ✓[0m[90m set-after-destroy (inline helpers)[0m
  [32m  ✓[0m[90m set-clones-input (shared helpers)[0m
  [32m  ✓[0m[90m set-clones-input (shared helpers , hydration)[0m
  [32m  ✓[0m[90m set-clones-input (inline helpers)[0m
  [32m  ✓[0m[90m set-in-observe (shared helpers)[0m
  [32m  ✓[0m[90m set-in-observe (shared helpers , hydration)[0m
  [32m  ✓[0m[90m set-in-observe (inline helpers)[0m
  [36m  - set-in-observe-dedupes-renders (shared helpers)[0m
  [36m  - set-in-observe-dedupes-renders (shared helpers , hydration)[0m
  [36m  - set-in-observe-dedupes-renders (inline helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (shared helpers)[0m
  [32m  ✓[0m[90m set-in-oncreate (shared helpers , hydration)[0m
  [32m  ✓[0m[90m set-in-oncreate (inline helpers)[0m
  [32m  ✓[0m[90m set-in-ondestroy (shared helpers)[0m
  [32m  ✓[0m[90m set-in-ondestroy (shared helpers , hydration)[0m
  [32m  ✓[0m[90m set-in-ondestroy (inline helpers)[0m
  [32m  ✓[0m[90m set-mutated-data (shared helpers)[0m
  [32m  ✓[0m[90m set-mutated-data (shared helpers , hydration)[0m
  [32m  ✓[0m[90m set-mutated-data (inline helpers)[0m
  [32m  ✓[0m[90m set-prevents-loop (shared helpers)[0m
  [32m  ✓[0m[90m set-prevents-loop (shared helpers , hydration)[0m
  [32m  ✓[0m[90m set-prevents-loop (inline helpers)[0m
  [32m  ✓[0m[90m setup (shared helpers)[0m
  [32m  ✓[0m[90m setup (shared helpers , hydration)[0m
  [32m  ✓[0m[90m setup (inline helpers)[0m
  [32m  ✓[0m[90m sigil-static-# (shared helpers)[0m
  [32m  ✓[0m[90m sigil-static-# (shared helpers , hydration)[0m
  [32m  ✓[0m[90m sigil-static-# (inline helpers)[0m
  [32m  ✓[0m[90m sigil-static-@ (shared helpers)[0m
  [32m  ✓[0m[90m sigil-static-@ (shared helpers , hydration)[0m
  [32m  ✓[0m[90m sigil-static-@ (inline helpers)[0m
  [32m  ✓[0m[90m single-static-element (shared helpers)[0m
  [32m  ✓[0m[90m single-static-element (shared helpers , hydration)[0m
  [32m  ✓[0m[90m single-static-element (inline helpers)[0m
  [32m  ✓[0m[90m single-text-node (shared helpers)[0m
  [32m  ✓[0m[90m single-text-node (shared helpers , hydration)[0m
  [32m  ✓[0m[90m single-text-node (inline helpers)[0m
  [32m  ✓[0m[90m slot-in-custom-element (shared helpers)[0m
  [32m  ✓[0m[90m slot-in-custom-element (shared helpers , hydration)[0m
  [32m  ✓[0m[90m slot-in-custom-element (inline helpers)[0m
  [32m  ✓[0m[90m state-deconflicted (shared helpers)[0m
  [32m  ✓[0m[90m state-deconflicted (shared helpers , hydration)[0m
  [32m  ✓[0m[90m state-deconflicted (inline helpers)[0m
  [32m  ✓[0m[90m store (shared helpers)[0m
  [32m  ✓[0m[90m store (shared helpers , hydration)[0m
  [32m  ✓[0m[90m store (inline helpers)[0m
  [32m  ✓[0m[90m store-binding (shared helpers)[0m
  [32m  ✓[0m[90m store-binding (shared helpers , hydration)[0m
  [32m  ✓[0m[90m store-binding (inline helpers)[0m
  [32m  ✓[0m[90m store-computed (shared helpers)[0m
  [32m  ✓[0m[90m store-computed (shared helpers , hydration)[0m
  [32m  ✓[0m[90m store-computed (inline helpers)[0m
  [32m  ✓[0m[90m store-event (shared helpers)[0m
  [32m  ✓[0m[90m store-event (shared helpers , hydration)[0m
  [32m  ✓[0m[90m store-event (inline helpers)[0m
  [32m  ✓[0m[90m store-root (shared helpers)[0m
  [32m  ✓[0m[90m store-root (shared helpers , hydration)[0m
  [32m  ✓[0m[90m store-root (inline helpers)[0m
  [32m  ✓[0m[90m svg (shared helpers)[0m
  [32m  ✓[0m[90m svg (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg (inline helpers)[0m
  [32m  ✓[0m[90m svg-attributes (shared helpers)[0m
  [32m  ✓[0m[90m svg-attributes (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg-attributes (inline helpers)[0m
  [32m  ✓[0m[90m svg-child-component-declared-namespace (shared helpers)[0m
  [32m  ✓[0m[90m svg-child-component-declared-namespace (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg-child-component-declared-namespace (inline helpers)[0m
  [32m  ✓[0m[90m svg-child-component-declared-namespace-shorthand (shared helpers)[0m
  [32m  ✓[0m[90m svg-child-component-declared-namespace-shorthand (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg-child-component-declared-namespace-shorthand (inline helpers)[0m
  [32m  ✓[0m[90m svg-class (shared helpers)[0m
  [32m  ✓[0m[90m svg-class (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg-class (inline helpers)[0m
  [32m  ✓[0m[90m svg-each-block-anchor (shared helpers)[0m
  [32m  ✓[0m[90m svg-each-block-anchor (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg-each-block-anchor (inline helpers)[0m
  [32m  ✓[0m[90m svg-each-block-namespace (shared helpers)[0m
  [32m  ✓[0m[90m svg-each-block-namespace (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg-each-block-namespace (inline helpers)[0m
  [32m  ✓[0m[90m svg-multiple (shared helpers)[0m
  [32m  ✓[0m[90m svg-multiple (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg-multiple (inline helpers)[0m
  [32m  ✓[0m[90m svg-no-whitespace (shared helpers)[0m
  [32m  ✓[0m[90m svg-no-whitespace (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg-no-whitespace (inline helpers)[0m
  [32m  ✓[0m[90m svg-xlink (shared helpers)[0m
  [32m  ✓[0m[90m svg-xlink (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg-xlink (inline helpers)[0m
  [32m  ✓[0m[90m svg-xmlns (shared helpers)[0m
  [32m  ✓[0m[90m svg-xmlns (shared helpers , hydration)[0m
  [32m  ✓[0m[90m svg-xmlns (inline helpers)[0m
  [32m  ✓[0m[90m textarea-children (shared helpers)[0m
  [32m  ✓[0m[90m textarea-children (shared helpers , hydration)[0m
  [32m  ✓[0m[90m textarea-children (inline helpers)[0m
  [32m  ✓[0m[90m textarea-value (shared helpers)[0m
  [32m  ✓[0m[90m textarea-value (shared helpers , hydration)[0m
  [32m  ✓[0m[90m textarea-value (inline helpers)[0m
  [32m  ✓[0m[90m transition-css-delay (shared helpers)[0m
  [32m  ✓[0m[90m transition-css-delay (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-css-delay (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-delay (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-delay (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-delay (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-delay-in-out (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-delay-in-out (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-delay-in-out (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-dynamic-if-block-bidi (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-dynamic-if-block-bidi (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-dynamic-if-block-bidi (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-intro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-intro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-each-block-intro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-intro-outro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-intro-outro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-each-block-intro-outro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-intro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-intro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-intro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-intro-outro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-intro-outro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-intro-outro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-outro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-outro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-outro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-outro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-each-block-outro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-each-block-outro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-events (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-events (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-events (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-bidi (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-bidi (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-if-block-bidi (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi-2 (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi-2 (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi-2 (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi-3 (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi-3 (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi-3 (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-intro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-intro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-if-block-intro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-intro-outro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-if-block-intro-outro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-if-block-intro-outro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-if-else-block-dynamic-outro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-if-else-block-dynamic-outro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-if-else-block-dynamic-outro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-if-else-block-intro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-if-else-block-intro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-if-else-block-intro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-if-else-block-outro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-if-else-block-outro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-if-else-block-outro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-if-elseif-block-outro (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-if-elseif-block-outro (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-if-elseif-block-outro (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-initial (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-initial (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-initial (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-parameterised (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-parameterised (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-parameterised (inline helpers)[0m
  [32m  ✓[0m[90m transition-js-parameterised-with-state (shared helpers)[0m
  [32m  ✓[0m[90m transition-js-parameterised-with-state (shared helpers , hydration)[0m
  [32m  ✓[0m[90m transition-js-parameterised-with-state (inline helpers)[0m
  [32m  ✓[0m[90m whitespace-each-block (shared helpers)[0m
  [32m  ✓[0m[90m whitespace-each-block (shared helpers , hydration)[0m
  [32m  ✓[0m[90m whitespace-each-block (inline helpers)[0m
  [32m  ✓[0m[90m whitespace-normal (shared helpers)[0m
  [32m  ✓[0m[90m whitespace-normal (shared helpers , hydration)[0m
  [32m  ✓[0m[90m whitespace-normal (inline helpers)[0m
  [36m  - window-bind-scroll-update (shared helpers)[0m
  [36m  - window-bind-scroll-update (shared helpers , hydration)[0m
  [36m  - window-bind-scroll-update (inline helpers)[0m
  [36m  - window-binding-resize (shared helpers)[0m
  [36m  - window-binding-resize (shared helpers , hydration)[0m
  [36m  - window-binding-resize (inline helpers)[0m
  [36m  - window-event (shared helpers)[0m
  [36m  - window-event (shared helpers , hydration)[0m
  [36m  - window-event (inline helpers)[0m
  [32m  ✓[0m[90m window-event-context (shared helpers)[0m
  [32m  ✓[0m[90m window-event-context (shared helpers , hydration)[0m
  [32m  ✓[0m[90m window-event-context (inline helpers)[0m
  [32m  ✓[0m[90m fails if options.target is missing in dev mode[0m
  [32m  ✓[0m[90m fails if options.hydrate is true but the component is non-hydratable[0m

[0m  ssr[0m
  [32m  ✓[0m[90m attribute-boolean[0m
  [32m  ✓[0m[90m attribute-dynamic[0m
  [32m  ✓[0m[90m attribute-static[0m
  [32m  ✓[0m[90m comment[0m
  [32m  ✓[0m[90m component[0m
  [32m  ✓[0m[90m component-binding[0m
  [32m  ✓[0m[90m component-binding-renamed[0m
  [32m  ✓[0m[90m component-data-dynamic[0m
  [32m  ✓[0m[90m component-data-empty[0m
  [32m  ✓[0m[90m component-data-static[0m
  [32m  ✓[0m[90m component-refs[0m
  [32m  ✓[0m[90m component-refs-and-attributes[0m
  [32m  ✓[0m[90m component-with-different-extension[0m
  [32m  ✓[0m[90m component-yield[0m
  [32m  ✓[0m[90m computed[0m
  [32m  ✓[0m[90m default-data[0m
  [32m  ✓[0m[90m default-data-override[0m
  [32m  ✓[0m[90m directives[0m
  [32m  ✓[0m[90m dynamic-text[0m
  [32m  ✓[0m[90m dynamic-text-escaped[0m
  [32m  ✓[0m[90m each-block[0m
  [32m  ✓[0m[90m empty-elements-closed[0m
  [32m  ✓[0m[90m entities[0m
  [32m  ✓[0m[90m head-title[0m
  [32m  ✓[0m[90m helpers[0m
  [32m  ✓[0m[90m if-block-false[0m
  [32m  ✓[0m[90m if-block-true[0m
  [32m  ✓[0m[90m import-non-component[0m
  [32m  ✓[0m[90m raw-mustaches[0m
  [32m  ✓[0m[90m sanitize-name[0m
  [32m  ✓[0m[90m static-div[0m
  [32m  ✓[0m[90m static-text[0m
  [32m  ✓[0m[90m styles[0m
  [32m  ✓[0m[90m styles-nested[0m
  [32m  ✓[0m[90m textarea-children[0m
  [32m  ✓[0m[90m textarea-value[0m
  [32m  ✓[0m[90m triple[0m
  [32m  ✓[0m[90m attribute-casing[0m
  [32m  ✓[0m[90m attribute-dynamic[0m
  [32m  ✓[0m[90m attribute-dynamic-multiple[0m
  [32m  ✓[0m[90m attribute-dynamic-reserved[0m
  [32m  ✓[0m[90m attribute-dynamic-shorthand[0m
  [32m  ✓[0m[90m attribute-empty[0m
  [32m  ✓[0m[90m attribute-empty-svg[0m
  [32m  ✓[0m[90m attribute-namespaced[0m
  [32m  ✓[0m[90m attribute-partial-number[0m
  [32m  ✓[0m[90m attribute-static[0m
  [32m  ✓[0m[90m attribute-static-at-symbol[0m
  [32m  ✓[0m[90m attribute-static-boolean[0m
  [32m  ✓[0m[90m attribute-static-quotemarks[0m
  [32m  ✓[0m[90m autofocus[0m
  [32m  ✓[0m[90m await-component-oncreate[0m
  [32m  ✓[0m[90m await-then-catch[0m
  [32m  ✓[0m[90m await-then-catch-anchor[0m
  [32m  ✓[0m[90m await-then-catch-event[0m
  [32m  ✓[0m[90m await-then-catch-if[0m
  [32m  ✓[0m[90m await-then-catch-in-slot[0m
  [32m  ✓[0m[90m await-then-catch-multiple[0m
  [32m  ✓[0m[90m await-then-catch-non-promise[0m
  [32m  ✓[0m[90m await-then-shorthand[0m
  [36m  - binding-audio-currenttime-duration[0m
  [32m  ✓[0m[90m binding-indirect-computed[0m
  [32m  ✓[0m[90m binding-input-checkbox[0m
  [32m  ✓[0m[90m binding-input-checkbox-deep-contextual[0m
  [32m  ✓[0m[90m binding-input-checkbox-group[0m
  [32m  ✓[0m[90m binding-input-checkbox-group-outside-each[0m
  [32m  ✓[0m[90m binding-input-number[0m
  [32m  ✓[0m[90m binding-input-radio-group[0m
  [32m  ✓[0m[90m binding-input-range[0m
  [32m  ✓[0m[90m binding-input-range-change[0m
  [32m  ✓[0m[90m binding-input-text[0m
  [32m  ✓[0m[90m binding-input-text-contextual[0m
  [32m  ✓[0m[90m binding-input-text-deconflicted[0m
  [32m  ✓[0m[90m binding-input-text-deep[0m
  [32m  ✓[0m[90m binding-input-text-deep-computed[0m
  [32m  ✓[0m[90m binding-input-text-deep-computed-dynamic[0m
  [32m  ✓[0m[90m binding-input-text-deep-contextual[0m
  [32m  ✓[0m[90m binding-input-text-deep-contextual-computed-dynamic[0m
  [32m  ✓[0m[90m binding-input-with-event[0m
  [32m  ✓[0m[90m binding-select[0m
  [32m  ✓[0m[90m binding-select-implicit-option-value[0m
  [36m  - binding-select-in-each-block[0m
  [32m  ✓[0m[90m binding-select-in-yield[0m
  [32m  ✓[0m[90m binding-select-initial-value[0m
  [32m  ✓[0m[90m binding-select-late[0m
  [36m  - binding-select-multiple[0m
  [36m  - binding-select-optgroup[0m
  [32m  ✓[0m[90m binding-textarea[0m
  [32m  ✓[0m[90m bindings-before-oncreate[0m
  [32m  ✓[0m[90m bindings-coalesced[0m
  [32m  ✓[0m[90m component[0m
  [32m  ✓[0m[90m component-binding-blowback[0m
  [32m  ✓[0m[90m component-binding-computed[0m
  [32m  ✓[0m[90m component-binding-deep[0m
  [36m  - component-binding-deep-b[0m
  [32m  ✓[0m[90m component-binding-each[0m
  [32m  ✓[0m[90m component-binding-each-nested[0m
  [32m  ✓[0m[90m component-binding-each-object[0m
  [32m  ✓[0m[90m component-binding-infinite-loop[0m
  [32m  ✓[0m[90m component-binding-parent-supercedes-child[0m
  [32m  ✓[0m[90m component-binding-self-destroying[0m
  [32m  ✓[0m[90m component-data-dynamic[0m
  [32m  ✓[0m[90m component-data-dynamic-late[0m
  [32m  ✓[0m[90m component-data-dynamic-shorthand[0m
  [32m  ✓[0m[90m component-data-empty[0m
  [32m  ✓[0m[90m component-data-static[0m
  [32m  ✓[0m[90m component-data-static-boolean[0m
  [32m  ✓[0m[90m component-data-static-boolean-regression[0m
  [32m  ✓[0m[90m component-events[0m
  [32m  ✓[0m[90m component-events-data[0m
  [32m  ✓[0m[90m component-events-each[0m
  [32m  ✓[0m[90m component-if-placement[0m
  [32m  ✓[0m[90m component-nested-deep[0m
  [32m  ✓[0m[90m component-nested-deeper[0m
  [32m  ✓[0m[90m component-not-void[0m
  [32m  ✓[0m[90m component-ref[0m
  [32m  ✓[0m[90m component-slot-default[0m
  [32m  ✓[0m[90m component-slot-each-block[0m
  [32m  ✓[0m[90m component-slot-empty[0m
  [32m  ✓[0m[90m component-slot-fallback[0m
  [32m  ✓[0m[90m component-slot-if-block[0m
  [32m  ✓[0m[90m component-slot-if-block-before-node[0m
  [32m  ✓[0m[90m component-slot-if-else-block-before-node[0m
  [32m  ✓[0m[90m component-slot-named[0m
  [32m  ✓[0m[90m component-slot-nested[0m
  [32m  ✓[0m[90m component-slot-nested-component[0m
  [32m  ✓[0m[90m component-static-at-symbol[0m
  [32m  ✓[0m[90m component-yield[0m
  [32m  ✓[0m[90m component-yield-follows-element[0m
  [32m  ✓[0m[90m component-yield-if[0m
  [32m  ✓[0m[90m component-yield-multiple-in-each[0m
  [32m  ✓[0m[90m component-yield-multiple-in-if[0m
  [32m  ✓[0m[90m component-yield-nested-if[0m
  [32m  ✓[0m[90m component-yield-parent[0m
  [32m  ✓[0m[90m component-yield-placement[0m
  [32m  ✓[0m[90m component-yield-static[0m
  [32m  ✓[0m[90m computed-empty[0m
  [32m  ✓[0m[90m computed-function[0m
  [32m  ✓[0m[90m computed-values[0m
  [32m  ✓[0m[90m computed-values-deconflicted[0m
  [32m  ✓[0m[90m computed-values-default[0m
  [32m  ✓[0m[90m computed-values-function-dependency[0m
  [32m  ✓[0m[90m css[0m
  [32m  ✓[0m[90m css-comments[0m
  [32m  ✓[0m[90m css-false[0m
  [32m  ✓[0m[90m css-space-in-attribute[0m
  [32m  ✓[0m[90m custom-method[0m
  [32m  ✓[0m[90m deconflict-builtins[0m
  [32m  ✓[0m[90m deconflict-contexts[0m
  [32m  ✓[0m[90m deconflict-non-helpers[0m
  [32m  ✓[0m[90m deconflict-self[0m
  [32m  ✓[0m[90m deconflict-template-1[0m
  [32m  ✓[0m[90m deconflict-template-2[0m
  [32m  ✓[0m[90m deconflict-vars[0m
  [32m  ✓[0m[90m default-data[0m
  [32m  ✓[0m[90m default-data-function[0m
  [32m  ✓[0m[90m default-data-override[0m
  [32m  ✓[0m[90m destroy-twice[0m
  [32m  ✓[0m[90m destructuring[0m
  [32m  ✓[0m[90m dev-warning-bad-observe-arguments[0m
  [32m  ✓[0m[90m dev-warning-bad-set-argument[0m
  [32m  ✓[0m[90m dev-warning-destroy-not-teardown[0m
  [32m  ✓[0m[90m dev-warning-destroy-twice[0m
  [32m  ✓[0m[90m dev-warning-dynamic-components-misplaced[0m
  [32m  ✓[0m[90m dev-warning-helper[0m
  [32m  ✓[0m[90m dev-warning-missing-data[0m
  [32m  ✓[0m[90m dev-warning-missing-data-binding[0m
  [32m  ✓[0m[90m dev-warning-missing-data-excludes-event[0m
  [32m  ✓[0m[90m dev-warning-readonly-computed[0m
  [32m  ✓[0m[90m dev-warning-readonly-window-binding[0m
  [32m  ✓[0m[90m dynamic-component[0m
  [32m  ✓[0m[90m dynamic-component-bindings[0m
  [32m  ✓[0m[90m dynamic-component-bindings-recreated[0m
  [32m  ✓[0m[90m dynamic-component-events[0m
  [32m  ✓[0m[90m dynamic-component-inside-element[0m
  [32m  ✓[0m[90m dynamic-component-slot[0m
  [32m  ✓[0m[90m dynamic-component-update-existing-instance[0m
  [32m  ✓[0m[90m each-block[0m
  [32m  ✓[0m[90m each-block-containing-component-in-if[0m
  [32m  ✓[0m[90m each-block-containing-if[0m
  [32m  ✓[0m[90m each-block-destructured-array[0m
  [32m  ✓[0m[90m each-block-dynamic-else-static[0m
  [32m  ✓[0m[90m each-block-else[0m
  [32m  ✓[0m[90m each-block-else-starts-empty[0m
  [32m  ✓[0m[90m each-block-indexed[0m
  [32m  ✓[0m[90m each-block-keyed[0m
  [32m  ✓[0m[90m each-block-keyed-dynamic[0m
  [32m  ✓[0m[90m each-block-keyed-random-permute[0m
  [32m  ✓[0m[90m each-block-keyed-unshift[0m
  [32m  ✓[0m[90m each-block-random-permute[0m
  [32m  ✓[0m[90m each-block-static[0m
  [32m  ✓[0m[90m each-block-text-node[0m
  [32m  ✓[0m[90m each-blocks-expression[0m
  [32m  ✓[0m[90m each-blocks-nested[0m
  [32m  ✓[0m[90m each-blocks-nested-b[0m
  [32m  ✓[0m[90m element-invalid-name[0m
  [32m  ✓[0m[90m empty-style-block[0m
  [32m  ✓[0m[90m escape-template-literals[0m
  [32m  ✓[0m[90m escaped-text[0m
  [32m  ✓[0m[90m event-handler[0m
  [32m  ✓[0m[90m event-handler-console-log[0m
  [32m  ✓[0m[90m event-handler-custom[0m
  [32m  ✓[0m[90m event-handler-custom-context[0m
  [32m  ✓[0m[90m event-handler-custom-each[0m
  [32m  ✓[0m[90m event-handler-destroy[0m
  [32m  ✓[0m[90m event-handler-each[0m
  [32m  ✓[0m[90m event-handler-each-deconflicted[0m
  [32m  ✓[0m[90m event-handler-event-methods[0m
  [32m  ✓[0m[90m event-handler-hoisted[0m
  [32m  ✓[0m[90m event-handler-removal[0m
  [32m  ✓[0m[90m event-handler-sanitize[0m
  [32m  ✓[0m[90m event-handler-shorthand[0m
  [32m  ✓[0m[90m event-handler-shorthand-component[0m
  [32m  ✓[0m[90m event-handler-this-methods[0m
  [32m  ✓[0m[90m events-custom[0m
  [32m  ✓[0m[90m events-lifecycle[0m
  [32m  ✓[0m[90m function-in-expression[0m
  [32m  ✓[0m[90m get-state[0m
  [32m  ✓[0m[90m globals-accessible-directly[0m
  [32m  ✓[0m[90m globals-not-dereferenced[0m
  [32m  ✓[0m[90m globals-not-overwritten-by-bindings[0m
  [32m  ✓[0m[90m globals-shadowed-by-data[0m
  [32m  ✓[0m[90m globals-shadowed-by-helpers[0m
  [32m  ✓[0m[90m head-title-dynamic[0m
  [32m  ✓[0m[90m head-title-static[0m
  [32m  ✓[0m[90m hello-world[0m
  [32m  ✓[0m[90m helpers[0m
  [32m  ✓[0m[90m helpers-not-call-expression[0m
  [32m  ✓[0m[90m html-entities[0m
  [32m  ✓[0m[90m html-entities-inside-elements[0m
  [32m  ✓[0m[90m html-non-entities-inside-elements[0m
  [32m  ✓[0m[90m if-block[0m
  [32m  ✓[0m[90m if-block-else[0m
  [32m  ✓[0m[90m if-block-elseif[0m
  [32m  ✓[0m[90m if-block-elseif-text[0m
  [32m  ✓[0m[90m if-block-expression[0m
  [32m  ✓[0m[90m if-block-or[0m
  [32m  ✓[0m[90m if-block-widget[0m
  [32m  ✓[0m[90m ignore-unchanged-attribute[0m
  [32m  ✓[0m[90m ignore-unchanged-attribute-compound[0m
  [32m  ✓[0m[90m ignore-unchanged-raw[0m
  [32m  ✓[0m[90m ignore-unchanged-tag[0m
  [32m  ✓[0m[90m imported-renamed-components[0m
  [32m  ✓[0m[90m inline-expressions[0m
  [32m  ✓[0m[90m input-list[0m
  [32m  ✓[0m[90m lifecycle-events[0m
  [32m  ✓[0m[90m names-deconflicted[0m
  [32m  ✓[0m[90m names-deconflicted-nested[0m
  [32m  ✓[0m[90m nbsp[0m
  [32m  ✓[0m[90m observe-binding-ignores-unchanged[0m
  [32m  ✓[0m[90m observe-component-ignores-irrelevant-changes[0m
  [32m  ✓[0m[90m observe-prevents-loop[0m
  [36m  - oncreate-async[0m
  [36m  - oncreate-async-arrow[0m
  [36m  - oncreate-async-arrow-block[0m
  [32m  ✓[0m[90m ondestroy-before-cleanup[0m
  [32m  ✓[0m[90m option-without-select[0m
  [32m  ✓[0m[90m paren-wrapped-expressions[0m
  [32m  ✓[0m[90m preload[0m
  [32m  ✓[0m[90m raw-anchor-first-child[0m
  [32m  ✓[0m[90m raw-anchor-first-last-child[0m
  [32m  ✓[0m[90m raw-anchor-last-child[0m
  [32m  ✓[0m[90m raw-anchor-next-previous-sibling[0m
  [32m  ✓[0m[90m raw-anchor-next-sibling[0m
  [32m  ✓[0m[90m raw-anchor-previous-sibling[0m
  [32m  ✓[0m[90m refs[0m
  [32m  ✓[0m[90m refs-unset[0m
  [32m  ✓[0m[90m select[0m
  [32m  ✓[0m[90m select-change-handler[0m
  [32m  ✓[0m[90m select-no-whitespace[0m
  [32m  ✓[0m[90m select-props[0m
  [32m  ✓[0m[90m self-reference[0m
  [32m  ✓[0m[90m self-reference-tree[0m
  [32m  ✓[0m[90m set-after-destroy[0m
  [32m  ✓[0m[90m set-clones-input[0m
  [36m  - set-in-observe-dedupes-renders[0m
  [32m  ✓[0m[90m set-mutated-data[0m
  [32m  ✓[0m[90m set-prevents-loop[0m
  [32m  ✓[0m[90m setup[0m
  [32m  ✓[0m[90m sigil-static-#[0m
  [32m  ✓[0m[90m sigil-static-@[0m
  [32m  ✓[0m[90m single-static-element[0m
  [32m  ✓[0m[90m single-text-node[0m
  [32m  ✓[0m[90m slot-in-custom-element[0m
  [32m  ✓[0m[90m state-deconflicted[0m
  [32m  ✓[0m[90m store[0m
  [32m  ✓[0m[90m store-binding[0m
  [32m  ✓[0m[90m store-computed[0m
  [32m  ✓[0m[90m store-event[0m
  [32m  ✓[0m[90m store-root[0m
  [32m  ✓[0m[90m svg[0m
  [32m  ✓[0m[90m svg-attributes[0m
  [32m  ✓[0m[90m svg-child-component-declared-namespace[0m
  [32m  ✓[0m[90m svg-child-component-declared-namespace-shorthand[0m
  [32m  ✓[0m[90m svg-class[0m
  [32m  ✓[0m[90m svg-each-block-anchor[0m
  [32m  ✓[0m[90m svg-each-block-namespace[0m
  [32m  ✓[0m[90m svg-multiple[0m
  [32m  ✓[0m[90m svg-no-whitespace[0m
  [32m  ✓[0m[90m svg-xlink[0m
  [32m  ✓[0m[90m transition-css-delay[0m
  [32m  ✓[0m[90m transition-js-delay[0m
  [32m  ✓[0m[90m transition-js-delay-in-out[0m
  [32m  ✓[0m[90m transition-js-dynamic-if-block-bidi[0m
  [32m  ✓[0m[90m transition-js-each-block-intro[0m
  [32m  ✓[0m[90m transition-js-each-block-intro-outro[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-intro[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-intro-outro[0m
  [32m  ✓[0m[90m transition-js-each-block-keyed-outro[0m
  [32m  ✓[0m[90m transition-js-each-block-outro[0m
  [32m  ✓[0m[90m transition-js-events[0m
  [32m  ✓[0m[90m transition-js-if-block-bidi[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi-2[0m
  [32m  ✓[0m[90m transition-js-if-block-in-each-block-bidi-3[0m
  [32m  ✓[0m[90m transition-js-if-block-intro[0m
  [32m  ✓[0m[90m transition-js-if-block-intro-outro[0m
  [32m  ✓[0m[90m transition-js-if-else-block-dynamic-outro[0m
  [32m  ✓[0m[90m transition-js-if-else-block-intro[0m
  [32m  ✓[0m[90m transition-js-if-else-block-outro[0m
  [32m  ✓[0m[90m transition-js-if-elseif-block-outro[0m
  [32m  ✓[0m[90m transition-js-initial[0m
  [32m  ✓[0m[90m transition-js-parameterised[0m
  [32m  ✓[0m[90m transition-js-parameterised-with-state[0m
  [32m  ✓[0m[90m whitespace-each-block[0m
  [32m  ✓[0m[90m whitespace-normal[0m
  [36m  - window-bind-scroll-update[0m

[0m  sourcemaps[0m
  [32m  ✓[0m[90m basic[0m
  [32m  ✓[0m[90m binding[0m
  [32m  ✓[0m[90m binding-shorthand[0m
  [32m  ✓[0m[90m css[0m
  [32m  ✓[0m[90m css-cascade-false[0m
  [32m  ✓[0m[90m each-block[0m
  [32m  ✓[0m[90m script[0m
  [32m  ✓[0m[90m static-no-script[0m

[0m  store[0m
  [32m  ✓[0m[90m is written in ES5[0m
[0m    get[0m
    [32m  ✓[0m[90m gets a specific key[0m
    [32m  ✓[0m[90m gets the entire state object[0m
[0m    set[0m
    [32m  ✓[0m[90m sets state[0m
[0m    observe[0m
    [32m  ✓[0m[90m observes state[0m
[0m    onchange[0m
    [32m  ✓[0m[90m fires a callback when state changes[0m
[0m    computed[0m
    [32m  ✓[0m[90m computes a property based on data[0m
    [32m  ✓[0m[90m computes a property based on another computed property[0m
    [32m  ✓[0m[90m prevents computed properties from being set[0m
    [32m  ✓[0m[90m allows multiple dependents to depend on the same computed property[0m
    [32m  ✓[0m[90m prevents cyclical dependencies[0m

[0m  validate[0m
  [32m  ✓[0m[90m a11y-alt-text[0m
  [32m  ✓[0m[90m a11y-anchor-has-content[0m
  [32m  ✓[0m[90m a11y-anchor-in-svg-is-valid[0m
  [32m  ✓[0m[90m a11y-anchor-is-valid[0m
  [32m  ✓[0m[90m a11y-aria-props[0m
  [32m  ✓[0m[90m a11y-aria-role[0m
  [32m  ✓[0m[90m a11y-aria-unsupported-element[0m
  [32m  ✓[0m[90m a11y-figcaption-right-place[0m
  [32m  ✓[0m[90m a11y-figcaption-wrong-place[0m
  [32m  ✓[0m[90m a11y-heading-has-content[0m
  [32m  ✓[0m[90m a11y-html-has-lang[0m
  [32m  ✓[0m[90m a11y-iframe-has-title[0m
  [32m  ✓[0m[90m a11y-no-access-key[0m
  [32m  ✓[0m[90m a11y-no-autofocus[0m
  [32m  ✓[0m[90m a11y-no-distracting-elements[0m
  [32m  ✓[0m[90m a11y-scope[0m
  [32m  ✓[0m[90m a11y-tabindex-no-positive[0m
  [32m  ✓[0m[90m await-component-is-used[0m
  [32m  ✓[0m[90m binding-input-checked[0m
  [32m  ✓[0m[90m binding-input-type-boolean[0m
  [32m  ✓[0m[90m binding-input-type-dynamic[0m
  [32m  ✓[0m[90m binding-invalid[0m
  [32m  ✓[0m[90m binding-invalid-on-element[0m
  [32m  ✓[0m[90m component-cannot-be-called-state[0m
  [36m  - component-slot-default-duplicate.skip[0m
  [32m  ✓[0m[90m component-slot-default-reserved[0m
  [32m  ✓[0m[90m component-slot-dynamic[0m
  [32m  ✓[0m[90m component-slot-dynamic-attribute[0m
  [32m  ✓[0m[90m component-slot-each-block[0m
  [36m  - component-slot-named-duplicate.skip[0m
  [32m  ✓[0m[90m component-slotted-each-block[0m
  [32m  ✓[0m[90m component-slotted-if-block[0m
  [32m  ✓[0m[90m computed-purity-check-no-this[0m
  [32m  ✓[0m[90m computed-purity-check-this-get[0m
  [32m  ✓[0m[90m css-invalid-global[0m
  [32m  ✓[0m[90m css-invalid-global-placement[0m
  [32m  ✓[0m[90m each-block-invalid-context[0m
  [32m  ✓[0m[90m each-block-invalid-context-destructured[0m
  [32m  ✓[0m[90m event-handler-ref[0m
  [32m  ✓[0m[90m event-handler-ref-invalid[0m
  [32m  ✓[0m[90m export-default-duplicated[0m
  [32m  ✓[0m[90m export-default-must-be-object[0m
  [32m  ✓[0m[90m helper-clash-context[0m
  [32m  ✓[0m[90m helper-purity-check-needs-arguments[0m
  [32m  ✓[0m[90m helper-purity-check-no-this[0m
  [32m  ✓[0m[90m helper-purity-check-this-get[0m
  [32m  ✓[0m[90m helper-purity-check-uses-arguments[0m
  [32m  ✓[0m[90m method-arrow-no-this[0m
  [32m  ✓[0m[90m method-arrow-this[0m
  [32m  ✓[0m[90m method-nonexistent[0m
  [32m  ✓[0m[90m method-nonexistent-helper[0m
  [32m  ✓[0m[90m method-quoted[0m
  [32m  ✓[0m[90m missing-component[0m
  [32m  ✓[0m[90m named-export[0m
  [32m  ✓[0m[90m namespace-invalid[0m
  [32m  ✓[0m[90m namespace-invalid-unguessable[0m
  [32m  ✓[0m[90m namespace-non-literal[0m
  [32m  ✓[0m[90m non-object-literal-components[0m
  [32m  ✓[0m[90m non-object-literal-events[0m
  [32m  ✓[0m[90m non-object-literal-helpers[0m
  [32m  ✓[0m[90m non-object-literal-methods[0m
  [32m  ✓[0m[90m non-object-literal-transitions[0m
  [32m  ✓[0m[90m oncreate-arrow-no-this[0m
  [32m  ✓[0m[90m oncreate-arrow-this[0m
  [32m  ✓[0m[90m ondestroy-arrow-no-this[0m
  [32m  ✓[0m[90m ondestroy-arrow-this[0m
  [32m  ✓[0m[90m properties-components-should-be-capitalised[0m
  [32m  ✓[0m[90m properties-computed-must-be-an-object[0m
  [32m  ✓[0m[90m properties-computed-must-be-functions[0m
  [32m  ✓[0m[90m properties-computed-no-destructuring[0m
  [32m  ✓[0m[90m properties-computed-values-needs-arguments[0m
  [32m  ✓[0m[90m properties-data-must-be-function[0m
  [32m  ✓[0m[90m properties-duplicated[0m
  [32m  ✓[0m[90m properties-methods-getters-setters[0m
  [32m  ✓[0m[90m properties-unexpected[0m
  [32m  ✓[0m[90m properties-unexpected-b[0m
  [32m  ✓[0m[90m slot-attribute-invalid[0m
  [32m  ✓[0m[90m store-unexpected[0m
  [32m  ✓[0m[90m svg-child-component-declared-namespace[0m
  [32m  ✓[0m[90m svg-child-component-undeclared-namespace[0m
  [32m  ✓[0m[90m tag-invalid[0m
  [32m  ✓[0m[90m tag-non-string[0m
  [32m  ✓[0m[90m textarea-value-children[0m
  [32m  ✓[0m[90m title-no-attributes[0m
  [32m  ✓[0m[90m title-no-children[0m
  [32m  ✓[0m[90m transition-duplicate-in[0m
  [32m  ✓[0m[90m transition-duplicate-in-transition[0m
  [32m  ✓[0m[90m transition-duplicate-out[0m
  [32m  ✓[0m[90m transition-duplicate-out-transition[0m
  [32m  ✓[0m[90m transition-duplicate-transition[0m
  [32m  ✓[0m[90m transition-duplicate-transition-in[0m
  [32m  ✓[0m[90m transition-duplicate-transition-out[0m
  [32m  ✓[0m[90m transition-missing[0m
  [32m  ✓[0m[90m transition-on-component[0m
  [32m  ✓[0m[90m unused-components[0m
  [32m  ✓[0m[90m unused-event[0m
  [36m  - unused-helper.skip[0m
  [32m  ✓[0m[90m unused-transition[0m
  [32m  ✓[0m[90m window-binding-invalid[0m
  [32m  ✓[0m[90m window-binding-invalid-innerwidth[0m
  [32m  ✓[0m[90m window-binding-invalid-value[0m
  [32m  ✓[0m[90m window-binding-invalid-width[0m
  [32m  ✓[0m[90m window-binding-online[0m
  [32m  ✓[0m[90m window-event-invalid[0m
  [32m  ✓[0m[90m errors if options.name is illegal[0m
  [32m  ✓[0m[90m warns if options.name is not capitalised[0m

[0m  ssr nested component store via connect[0m
  [31m  10) server renders nested component with connect()-provided store[0m


[92m [0m[32m 1558 passing[0m[90m (1m)[0m
[36m [0m[36m 53 pending[0m
[31m  10 failing[0m

[0m  1) custom-elements escaped-css:
[0m[31m     Error: Timeout of 10000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
      at listOnTimeout (node:internal/timers:559:17)
      at processTimers (node:internal/timers:502:7)
[0m
[0m  2) custom-elements html:
[0m[31m     Error: Timeout of 10000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
      at listOnTimeout (node:internal/timers:559:17)
      at processTimers (node:internal/timers:502:7)
[0m
[0m  3) custom-elements html-slots:
[0m[31m     Error: Timeout of 10000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
      at listOnTimeout (node:internal/timers:559:17)
      at processTimers (node:internal/timers:502:7)
[0m
[0m  4) custom-elements nested:
[0m[31m     Error: Timeout of 10000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
      at listOnTimeout (node:internal/timers:559:17)
      at processTimers (node:internal/timers:502:7)
[0m
[0m  5) custom-elements new:
[0m[31m     Error: Timeout of 10000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
      at listOnTimeout (node:internal/timers:559:17)
      at processTimers (node:internal/timers:502:7)
[0m
[0m  6) custom-elements new-styled:
[0m[31m     Error: Timeout of 10000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves.[0m[90m
      at listOnTimeout (node:internal/timers:559:17)
      at processTimers (node:internal/timers:502:7)
[0m
[0m  7) runtime binding-select (shared helpers):
[0m[31m     AssertionError [ERR_ASSERTION] [ERR_ASSERTION]: Expected values to be loosely deep-equal:

[
  HTMLOptionElement {
    [Symbol(SameObject caches)]: [Object: null prototype] {
      attributes: NamedNodeMap {},
      childNodes: NodeList {}
    },
    __value: 'one'
  },
  HTMLOptionElement {
    [Symbol(SameObject caches)]: [Object: null prototype] {
      attributes: NamedNodeMap {},
      childNodes: NodeList {}
    },
    __value: 'two'
  },
  HTMLOptionElement {
    [Symbol(SameObject caches)]: [Object: null prototype] {
      attributes: NamedNodeMap {},
      childNodes: NodeList {}
    ...

should loosely deep-equal

HTMLOptionsCollection {}[0m[90m
      at Object.test (test/runtime/samples/binding-select/_config.js:22:10)
      at test/runtime/index.js:187:37
[0m
[0m  8) runtime binding-select (shared helpers , hydration):
[0m[31m     Error: skipping test, already failed[0m[90m
      at Context.<anonymous> (test/runtime/index.js:58:11)
      at processImmediate (node:internal/timers:466:21)
[0m
[0m  9) runtime binding-select (inline helpers):
[0m[31m     Error: skipping test, already failed[0m[90m
      at Context.<anonymous> (test/runtime/index.js:58:11)
      at processImmediate (node:internal/timers:466:21)
[0m
[0m  10) ssr nested component store via connect server renders nested component with connect()-provided store:
[0m[31m     TypeError: Cannot read properties of undefined (reading '_init')[0m[90m
      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:53:38)
      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)
      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)
      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)
      at processImmediate (node:internal/timers:466:21)
[0m


[?2004l
2025-11-12 13:54:52,317 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_UBrYwBScuXe6LKS8FlcGsbyQ', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/server-side-rendering/nested-component-store.spec.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 427, 'prompt_tokens': 55141, 'total_tokens': 55568, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c4922a0f-70f4-4f16-b8aa-ec4e1aae79b0-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/server-side-rendering/nested-component-store.spec.js"}, 'id': 'call_UBrYwBScuXe6LKS8FlcGsbyQ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 55141, 'output_tokens': 427, 'total_tokens': 55568, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 13:54:52,321 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/server-side-rendering/nested-component-store.spec.js
2025-11-12 13:54:52,423 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:54:52,423 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 sed -n '1,200p' test/server-side-rendering/nested-com
mponent-store.spec.js
[?2004l
import assert from 'assert';
import { loadSvelte, setupHtmlEqual } from '../helpers.js';

describe('ssr nested component store via connect', () => {
  let svelte;

  before(() => {
    svelte = loadSvelte(true);
    setupHtmlEqual();
  });

  function compileCjs(source, options) {
    const { code } = svelte.compile(source, Object.assign({ format: 'cjs' }, options));
    const module = { exports: {} };
    const exports = module.exports;
    const fn = new Function('module', 'exports', 'TwoFactorAuth', `${code}; return module.exports;`);
    return {
      evalWith(scope = {}) {
        return fn(module, exports, scope.TwoFactorAuth);
      }
    };
  }

  it('server renders nested component with connect()-provided store', () => {
    const childSource = `
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
  // Minimal inline connect to mirror svelte-redux's connect API for SSR
  function connect(mapFn) {
    return {
      _init(keys) {
        const mapped = mapFn({}); // emulate empty Redux state on server
        const state = {};
        keys.forEach(k => { state[k] = mapped[k]; });
        return state;
      }
    };
  }

  export default {
    store: connect(state => ({
      hasTwoFactor: state.user && state.user.hasTwoFactor,
    })),
  };
</script>
    `;

    const parentSource = `
<div class="page">
  <h1>Manage Account</h1>
  <div>
    <h3>Two Factor Auth</h3>
    <TwoFactorAuth/>
  </div>
</div>

<script>
  export default {
    components: { TwoFactorAuth }
  };
</script>
    `;

    // Compile child (TwoFactorAuth) for SSR
    const childMod = compileCjs(childSource, { generate: 'ssr', name: 'TwoFactorAuth', store: true }).evalWith();
    const TwoFactorAuth = childMod.default || childMod;

    // Compile parent for SSR, injecting the child component via components mapping
    const parentMod = compileCjs(parentSource, { generate: 'ssr', name: 'ManageAccount', store: true }).evalWith({ TwoFactorAuth });
    const Parent = parentMod.default || parentMod;

    // Reproduce the exact SSR issue by passing an options object (with no store) to Parent.render
    // This currently throws: "Cannot read property '_init' of undefined"
    const { html } = Parent.render(null, {});

    assert.htmlEqual(
      html,
      '<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>'
    );
  });
});
[?2004l
2025-11-12 13:54:58,881 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_uB57ZaXMTtWn9NxU9FnjjHYo', 'function': {'arguments': '{"command":"cat mocha.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 218, 'prompt_tokens': 55854, 'total_tokens': 56072, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ebba7beb-fdb3-4e3c-9a0e-ffeb1f36c732-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat mocha.opts'}, 'id': 'call_uB57ZaXMTtWn9NxU9FnjjHYo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 55854, 'output_tokens': 218, 'total_tokens': 56072, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 13:54:58,885 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat mocha.opts
2025-11-12 13:54:58,987 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:54:58,987 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 13:55:08,406 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_PwEmhAcy6rqAP6Z6cxyU2Uj2', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/helpers.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 419, 'prompt_tokens': 55897, 'total_tokens': 56316, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c2835eb7-649d-491c-bf1b-b22a1619cfeb-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/helpers.js"}, 'id': 'call_PwEmhAcy6rqAP6Z6cxyU2Uj2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 55897, 'output_tokens': 419, 'total_tokens': 56316, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 13:55:08,410 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/helpers.js
2025-11-12 13:55:08,512 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:55:08,512 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import { JSDOM } from 'jsdom';
import assert from 'assert';
import glob from 'glob';
import fs from 'fs';
import path from 'path';
import chalk from 'chalk';

// for coverage purposes, we need to test source files,
// but for sanity purposes, we need to test dist files
export function loadSvelte(test) {
	process.env.TEST = test ? 'true' : '';

	const resolved = require.resolve('../compiler/svelte.js');

	delete require.cache[resolved];
	return require(resolved);
}

export const svelte = loadSvelte();

export function exists(path) {
	try {
		fs.statSync(path);
		return true;
	} catch (err) {
		return false;
	}
}

export function tryToLoadJson(file) {
	try {
		return JSON.parse(fs.readFileSync(file));
	} catch (err) {
		if (err.code !== 'ENOENT') throw err;
		return null;
	}
}

export function tryToReadFile(file) {
	try {
		return fs.readFileSync(file, 'utf-8');
	} catch (err) {
		if (err.code !== 'ENOENT') throw err;
		return null;
	}
}

const { window } = new JSDOM('<main></main>');
global.document = window.document;

export function env() {
	window._svelteTransitionManager = null;
	window.document.body.innerHTML = '<main></main>';

	return window;
}

function cleanChildren(node) {
	let previous = null;

	// sort attributes
	const attributes = Array.from(node.attributes).sort((a, b) => {
		return a.name < b.name ? -1 : 1;
	});

	attributes.forEach(attr => {
		node.removeAttribute(attr.name);
	});

	attributes.forEach(attr => {
		node.setAttribute(attr.name, attr.value);
	});

	// recurse
	[...node.childNodes].forEach(child => {
		if (child.nodeType === 3) {
			// text
			if (
				node.namespaceURI === 'http://www.w3.org/2000/svg' &&
				node.tagName !== 'text' &&
				node.tagName !== 'tspan'
			) {
				node.removeChild(child);
			}

			child.data = child.data.replace(/\s{2,}/g, '\n');

			if (previous && previous.nodeType === 3) {
				previous.data += child.data;
				previous.data = previous.data.replace(/\s{2,}/g, '\n');

				node.removeChild(child);
				child = previous;
			}
		} else {
			cleanChildren(child);
		}

		previous = child;
	});

	// collapse whitespace
	if (node.firstChild && node.firstChild.nodeType === 3) {
		node.firstChild.data = node.firstChild.data.replace(/^\s+/, '');
		if (!node.firstChild.data) node.removeChild(node.firstChild);
	}

	if (node.lastChild && node.lastChild.nodeType === 3) {
		node.lastChild.data = node.lastChild.data.replace(/\s+$/, '');
		if (!node.lastChild.data) node.removeChild(node.lastChild);
	}
}

export function normalizeHtml(window, html) {
	try {
		const node = window.document.createElement('div');
		node.innerHTML = html
			.replace(/<!--.*?-->/g, '')
			.replace(/>[\s\r\n]+</g, '><')
			.trim();
		cleanChildren(node, '');
		return node.innerHTML.replace(/<\/?noscript\/?>/g, '');
	} catch (err) {
		throw new Error(`Failed to normalize HTML:\n${html}`);
	}
}

export function setupHtmlEqual() {
	const window = env();

	assert.htmlEqual = (actual, expected, message) => {
		assert.deepEqual(
			normalizeHtml(window, actual),
			normalizeHtml(window, expected),
			message
		);
	};
}

export function loadConfig(file) {
	try {
		const resolved = require.resolve(file);
		delete require.cache[resolved];

		const config = require(resolved);
		return config.default || config;
	} catch (err) {
		if (err.code === 'MODULE_NOT_FOUND') {
			return {};
		}

		throw err;
	}
}

export function addLineNumbers(code) {
	return code
		.split('\n')
		.map((line, i) => {
			i = String(i + 1);
			while (i.length < 3) i = ` ${i}`;

			return (
				chalk.grey(`  ${i}: `) +
				line.replace(/^\t+/, match => match.split('\t').join('    '))
			);
		})
		.join('\n');
}

function capitalise(str) {
	return str[0].toUpperCase() + str.slice(1);
}

export function showOutput(cwd, options = {}, s = svelte) {
	glob.sync('**/*.html', { cwd }).forEach(file => {
		if (file[0] === '_') return;

		const name = path.basename(file)
			.slice(0, -path.extname(file).length)
			.replace(/^\d/, '_$&')
			.replace(/[^a-zA-Z0-9_$]/g, '');

		const { code } = s.compile(
			fs.readFileSync(`${cwd}/${file}`, 'utf-8'),
			Object.assign(options, {
				filename: file,
				name: capitalise(name)
			})
		);

		console.log( // eslint-disable-line no-console
			`\n>> ${chalk.cyan.bold(file)}\n${addLineNumbers(code)}\n<< ${chalk.cyan.bold(file)}`
		);
	});
}

const start = /\n(\t+)/;
export function deindent(strings, ...values) {
	const indentation = start.exec(strings[0])[1];
[?2004l
2025-11-12 13:55:10,112 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ntRsbrVQcqqeJ4FaioSSEfRZ', 'function': {'arguments': '{"command":"sed -n \'200,400p\' test/helpers.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 57185, 'total_tokens': 57214, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 55040}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--fa35cd86-ca74-4820-97ed-89faefbd304f-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '200,400p' test/helpers.js"}, 'id': 'call_ntRsbrVQcqqeJ4FaioSSEfRZ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 57185, 'output_tokens': 29, 'total_tokens': 57214, 'input_token_details': {'audio': 0, 'cache_read': 55040}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:55:10,116 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '200,400p' test/helpers.js
2025-11-12 13:55:10,217 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:55:10,217 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
	const indentation = start.exec(strings[0])[1];
	const pattern = new RegExp(`^${indentation}`, 'gm');

	let result = strings[0].replace(start, '').replace(pattern, '');

	let trailingIndentation = getTrailingIndentation(result);

	for (let i = 1; i < strings.length; i += 1) {
		let expression = values[i - 1];
		const string = strings[i].replace(pattern, '');

		if (Array.isArray(expression)) {
			expression = expression.length ? expression.join('\n') : null;
		}

		if (expression || expression === '') {
			const value = String(expression).replace(
				/\n/g,
				`\n${trailingIndentation}`
			);
			result += value + string;
		} else {
			let c = result.length;
			while (/\s/.test(result[c - 1])) c -= 1;
			result = result.slice(0, c) + string;
		}

		trailingIndentation = getTrailingIndentation(result);
	}

	return result.trim().replace(/\t+$/gm, '');
}

function getTrailingIndentation(str) {
	let i = str.length;
	while (str[i - 1] === ' ' || str[i - 1] === '\t') i -= 1;
	return str.slice(i, str.length);
}

export function spaces(i) {
	let result = '';
	while (i--) result += ' ';
	return result;
}
[?2004l
2025-11-12 13:55:18,313 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_YxiMkMdI7T3GN6Sfs3MgrLkw', 'function': {'arguments': '{"command":"ls -la test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 347, 'prompt_tokens': 57545, 'total_tokens': 57892, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5be45804-3598-4312-a5be-27def708a925-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test'}, 'id': 'call_YxiMkMdI7T3GN6Sfs3MgrLkw', 'type': 'tool_call'}] usage_metadata={'input_tokens': 57545, 'output_tokens': 347, 'total_tokens': 57892, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 13:55:18,315 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test
2025-11-12 13:55:18,417 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:55:18,417 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 120
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [0m[01;34m.[0m
drwxr-xr-x 1 root root 4096 Nov 12 13:44 [01;34m..[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mcreate[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mcss[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mcustom-elements[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mformats[0m
-rw-r--r-- 1 root root 5512 Nov 12 13:44 helpers.js
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mhydration[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mjs[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mparser[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mpreprocess[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mruntime[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:53 [01;34mserver-side-rendering[0m
-rw-r--r-- 1 root root 1103 Nov 12 13:44 setup.js
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34msourcemaps[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mstore[0m
-rw-r--r-- 1 root root  247 Nov 12 13:44 test.js
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mvalidator[0m
[?2004l
2025-11-12 13:55:23,031 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_AA7SMLJtNMujlD2GaAcLJlns', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/test.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 227, 'prompt_tokens': 58168, 'total_tokens': 58395, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 57472}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cce425ec-fccb-4736-8446-653f97cbc524-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/test.js"}, 'id': 'call_AA7SMLJtNMujlD2GaAcLJlns', 'type': 'tool_call'}] usage_metadata={'input_tokens': 58168, 'output_tokens': 227, 'total_tokens': 58395, 'input_token_details': {'audio': 0, 'cache_read': 57472}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 13:55:23,035 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/test.js
2025-11-12 13:55:23,137 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:55:23,137 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
const glob = require("glob");

require("./setup");

glob.sync("**/__test__.js", { cwd: "src" }).forEach(function(file) {
	require("../src/" + file);
});

glob.sync("*/index.js", { cwd: "test" }).forEach(function(file) {
	require("./" + file);
});
[?2004l
2025-11-12 13:55:37,598 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fGec4yF2Ecv0BBCbTX2Wmvoj', 'function': {'arguments': '{"command":"cat mocha.coverage.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 860, 'prompt_tokens': 58288, 'total_tokens': 59148, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 55808}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cf688364-a9f0-4b7a-a52b-6c9f704c4fa4-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat mocha.coverage.opts'}, 'id': 'call_fGec4yF2Ecv0BBCbTX2Wmvoj', 'type': 'tool_call'}] usage_metadata={'input_tokens': 58288, 'output_tokens': 860, 'total_tokens': 59148, 'input_token_details': {'audio': 0, 'cache_read': 55808}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 13:55:37,602 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat mocha.coverage.opts
2025-11-12 13:55:37,703 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:55:37,703 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
--compilers ts-node/register
--require source-map-support/register
--full-trace
--recursive
test/test.js
[?2004l
2025-11-12 13:55:47,565 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_FZuz8ooU1M8XI60WT6PlDFoS', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/server-side-rendering/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 615, 'prompt_tokens': 58359, 'total_tokens': 58974, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 58240}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2e1f8543-da7a-4fa2-845e-7defe0c1c32a-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/server-side-rendering/index.js"}, 'id': 'call_FZuz8ooU1M8XI60WT6PlDFoS', 'type': 'tool_call'}] usage_metadata={'input_tokens': 58359, 'output_tokens': 615, 'total_tokens': 58974, 'input_token_details': {'audio': 0, 'cache_read': 58240}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 13:55:47,569 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/server-side-rendering/index.js
2025-11-12 13:55:47,670 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:55:47,670 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import assert from "assert";
import * as fs from "fs";
import * as path from "path";
import glob from 'glob';

import {
	showOutput,
	loadConfig,
	setupHtmlEqual,
	tryToLoadJson
} from "../helpers.js";

function tryToReadFile(file) {
	try {
		return fs.readFileSync(file, "utf-8");
	} catch (err) {
		if (err.code !== "ENOENT") throw err;
		return null;
	}
}

describe("ssr", () => {
	before(() => {
		require("../../ssr/register")({
			extensions: ['.svelte', '.html'],
			store: true
		});

		return setupHtmlEqual();
	});

	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
		if (dir[0] === ".") return;

		// add .solo to a sample directory name to only run that test, or
		// .show to always show the output. or both
		const solo = /\.solo/.test(dir);
		const show = /\.show/.test(dir);

		if (solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		(solo ? it.only : it)(dir, () => {
			dir = path.resolve("test/server-side-rendering/samples", dir);
			try {
				let component;

				const mainHtmlFile = `${dir}/main.html`;
				const mainSvelteFile = `${dir}/main.svelte`;
				if (fs.existsSync(mainHtmlFile)) {
					component = require(mainHtmlFile);
				} else if (fs.existsSync(mainSvelteFile)) {
					component = require(mainSvelteFile);
				}

				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";

				const data = tryToLoadJson(`${dir}/data.json`);

				const rendered = component.render(data);
				const { html, css, head } = rendered;

				// rendered.toString() === rendered.html
				assert.equal(rendered, html);

				fs.writeFileSync(`${dir}/_actual.html`, html);
				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);

				assert.htmlEqual(html, expectedHtml);
				assert.equal(
					css.code.replace(/^\s+/gm, ""),
					expectedCss.replace(/^\s+/gm, "")
				);

				if (fs.existsSync(`${dir}/_expected-head.html`)) {
					fs.writeFileSync(`${dir}/_actual-head.html`, head);
					assert.htmlEqual(
						head,
						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
					);
				}

				if (show) showOutput(dir, { generate: 'ssr' });
			} catch (err) {
				showOutput(dir, { generate: 'ssr' });
				throw err;
			}
		});
	});

	// duplicate client-side tests, as far as possible
	fs.readdirSync("test/runtime/samples").forEach(dir => {
		if (dir[0] === ".") return;

		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);

		if (config.solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		if (config["skip-ssr"]) return;

		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
			const cwd = path.resolve("test/runtime/samples", dir);

			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
				delete require.cache[resolved];
			});

			require("../../ssr/register")({
				store: !!config.store
			});

			try {
				const component = require(`../runtime/samples/${dir}/main.html`);
				const { html } = component.render(config.data, {
					store: (config.store !== true) && config.store
				});

				if (config.html) {
					assert.htmlEqual(html, config.html);
				}
			} catch (err) {
				showOutput(cwd, { generate: "ssr" });
				throw err;
			}
		});
	});
});
[?2004l
2025-11-12 13:56:00,213 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_jy8CJf0Mo1OK3ICnb1NNSZfH', 'function': {'arguments': '{"command":"xxd -g 1 -c 200 mocha.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1187, 'prompt_tokens': 59368, 'total_tokens': 60555, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1152, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 57088}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--387659ca-5343-46e8-9b9e-dce039b47aab-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'xxd -g 1 -c 200 mocha.opts'}, 'id': 'call_jy8CJf0Mo1OK3ICnb1NNSZfH', 'type': 'tool_call'}] usage_metadata={'input_tokens': 59368, 'output_tokens': 1187, 'total_tokens': 60555, 'input_token_details': {'audio': 0, 'cache_read': 57088}, 'output_token_details': {'audio': 0, 'reasoning': 1152}}
2025-11-12 13:56:00,217 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: xxd -g 1 -c 200 mocha.opts
2025-11-12 13:56:00,318 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 127
2025-11-12 13:56:00,318 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
bash: xxd: command not found
[?2004l
2025-11-12 13:56:08,623 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_uawVaTCAidKYo1J1MKXDt40Y', 'function': {'arguments': '{"command":"wc -c mocha.opts; od -An -t c mocha.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 357, 'prompt_tokens': 59429, 'total_tokens': 59786, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7c3c17de-c4f6-4005-8367-1863d3642c5b-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'wc -c mocha.opts; od -An -t c mocha.opts'}, 'id': 'call_uawVaTCAidKYo1J1MKXDt40Y', 'type': 'tool_call'}] usage_metadata={'input_tokens': 59429, 'output_tokens': 357, 'total_tokens': 59786, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 13:56:08,627 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: wc -c mocha.opts; od -An -t c mocha.opts
2025-11-12 13:56:08,728 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:56:08,728 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
12 mocha.opts
   t   e   s   t   /   t   e   s   t   .   j   s
[?2004l
2025-11-12 13:56:17,748 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_DUHXXT8A8AI0puhBSFigeAZg', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/setup.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 547, 'prompt_tokens': 59512, 'total_tokens': 60059, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 55808}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7a390e74-eaff-4793-81b7-ed12ecc4de44-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/setup.js"}, 'id': 'call_DUHXXT8A8AI0puhBSFigeAZg', 'type': 'tool_call'}] usage_metadata={'input_tokens': 59512, 'output_tokens': 547, 'total_tokens': 60059, 'input_token_details': {'audio': 0, 'cache_read': 55808}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 13:56:17,751 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/setup.js
2025-11-12 13:56:17,853 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:56:17,853 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
const fs = require('fs');
const path = require('path');

require('console-group').install();
require('source-map-support').install();

process.env.TEST = true;

require.extensions['.js'] = function(module, filename) {
	const exports = [];

	var code = fs.readFileSync(filename, 'utf-8')
		.replace(/^import (?:\* as )?(\w+) from ['"]([^'"]+)['"];?/gm, 'var $1 = require("$2");')
		.replace(/^import {([^}]+)} from ['"](.+)['"];?/gm, 'var {$1} = require("$2");')
		.replace(/^export default /gm, 'module.exports = ')
		.replace(/^export (const|let|var|class|function) (\w+)/gm, (match, type, name) => {
			exports.push(name);
			return `${type} ${name}`;
		})
		.replace(/^export \{([^}]+)\}/gm, (match, names) => {
			names.split(',').filter(Boolean).forEach(name => {
				exports.push(name);
			});

			return '';
		})
		.replace(/^export function (\w+)/gm, 'exports.$1 = function $1');

	exports.forEach(name => {
		code += `\nexports.${name} = ${name};`;
	});

	try {
		return module._compile(code, filename);
	} catch (err) {
		console.log(code); // eslint-disable-line no-console
		throw err;
	}
[?2004l
2025-11-12 13:56:28,706 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_FbawxZlzpJi0zxfZvHwaJonh', 'function': {'arguments': '{"command":"npm run build"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 602, 'prompt_tokens': 59888, 'total_tokens': 60490, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d34d76fd-4bf6-4656-a067-f2b45aca66de-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm run build'}, 'id': 'call_FbawxZlzpJi0zxfZvHwaJonh', 'type': 'tool_call'}] usage_metadata={'input_tokens': 59888, 'output_tokens': 602, 'total_tokens': 60490, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 13:56:28,710 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: npm run build
2025-11-12 13:56:34,715 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 13:56:34,715 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l

> svelte@1.51.1 build
> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m4.8s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m33ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m68ms[22m[39m
[36m[39m
[36m[1mstore.js[22m → [1mstore.umd.js[22m...[39m
[32mcreated [1mstore.umd.js[22m in [1m84ms[22m[39m
[?2004l
2025-11-12 13:56:45,728 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ws5wah8rAcqFziyW8NCh0ChW', 'function': {'arguments': '{"command":"npm run build && node ./node_modules/mocha/bin/mocha test/server-side-rendering/nested-component-store.spec.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 815, 'prompt_tokens': 60283, 'total_tokens': 61098, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--653ccd5c-1693-45e1-ad5e-00c302a46854-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm run build && node ./node_modules/mocha/bin/mocha test/server-side-rendering/nested-component-store.spec.js'}, 'id': 'call_ws5wah8rAcqFziyW8NCh0ChW', 'type': 'tool_call'}] usage_metadata={'input_tokens': 60283, 'output_tokens': 815, 'total_tokens': 61098, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 13:56:45,732 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: npm run build && node ./node_modules/mocha/bin/mocha test/server-side-rendering/nested-component-store.spec.js
2025-11-12 13:56:51,780 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 13:56:51,780 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 npm run build && node ./node_modules/mocha/bin/mocha 
 test/server-side-rendering/nested-component-store.spec.js
[?2004l

> svelte@1.51.1 build
> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m4.7s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m28ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m38ms[22m[39m
[36m[39m
[36m[1mstore.js[22m → [1mstore.umd.js[22m...[39m
[32mcreated [1mstore.umd.js[22m in [1m90ms[22m[39m
/testbed/test/server-side-rendering/nested-component-store.spec.js:1
import assert from 'assert';
^^^^^^

SyntaxError: Cannot use import statement outside a module
[90m    at Object.compileFunction (node:vm:360:18)[39m
[90m    at wrapSafe (node:internal/modules/cjs/loader:1126:15)[39m
[90m    at Module._compile (node:internal/modules/cjs/loader:1162:27)[39m
[90m    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1252:10)[39m
[90m    at Module.load (node:internal/modules/cjs/loader:1076:32)[39m
[90m    at Function.Module._load (node:internal/modules/cjs/loader:911:12)[39m
[90m    at Module.require (node:internal/modules/cjs/loader:1100:19)[39m
[90m    at require (node:internal/modules/cjs/helpers:119:18)[39m
    at [90m/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:231:27
    at Array.forEach (<anonymous>)
    at Mocha.loadFiles [90m(/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:228:14[90m)[39m
    at Mocha.run [90m(/testbed/[39mnode_modules/[4mmocha[24m/lib/mocha.js:514:10[90m)[39m
    at Object.<anonymous> [90m(/testbed/[39mnode_modules/[4mmocha[24m/bin/_mocha:480:18[90m)[39m
[90m    at Module._compile (node:internal/modules/cjs/loader:1198:14)[39m
[90m    at Object.Module._extensions..js (node:internal/modules/cjs/loader:1252:10)[39m
[90m    at Module.load (node:internal/modules/cjs/loader:1076:32)[39m
[90m    at Function.Module._load (node:internal/modules/cjs/loader:911:12)[39m
[90m    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:81:12)[39m
[90m    at node:internal/main/run_main_module:22:47[39m
[?2004l
2025-11-12 13:57:04,327 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hw6Z9C6Q3gilSEdazX5U2SMx', 'function': {'arguments': '{"command":"npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 628, 'prompt_tokens': 61348, 'total_tokens': 61976, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3d4b37f6-e9a5-4955-aa7b-cb269f9f16a9-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js'}, 'id': 'call_hw6Z9C6Q3gilSEdazX5U2SMx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 61348, 'output_tokens': 628, 'total_tokens': 61976, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 13:57:04,331 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js
2025-11-12 13:57:11,064 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 13:57:11,064 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 npm run build && node ./node_modules/mocha/bin/mocha 
 --require test/setup.js test/server-side-rendering/nested-component-store.spec.j
js
[?2004l

> svelte@1.51.1 build
> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m5s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m30ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m43ms[22m[39m
[36m[39m
[36m[1mstore.js[22m → [1mstore.umd.js[22m...[39m
[32mcreated [1mstore.umd.js[22m in [1m82ms[22m[39m

[0m[0m
[0m  ssr nested component store via connect[0m
  [31m  1) server renders nested component with connect()-provided store[0m


[92m [0m[32m 0 passing[0m[90m (54ms)[0m
[31m  1 failing[0m

[0m  1) ssr nested component store via connect server renders nested component with connect()-provided store:
[0m[31m     TypeError: Cannot read properties of undefined (reading '_init')[0m[90m
      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:53:38)
      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)
      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)
      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)
      at processImmediate (node:internal/timers:466:21)
[0m


[?2004l
2025-11-12 13:57:27,878 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content=" npm run build && node ./node_modules/mocha/bin/mocha \n --require test/setup.js test/server-side-rendering/nested-component-store.spec.j\njs\n\x1b[?2004l\n\n> svelte@1.51.1 build\n> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js\n\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/index.ts\x1b[22m → \x1b[1mcompiler/svelte.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mcompiler/svelte.js\x1b[22m in \x1b[1m5s\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/server-side-rendering/register.js\x1b[22m → \x1b[1mssr/register.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mssr/register.js\x1b[22m in \x1b[1m30ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/shared/index.js\x1b[22m → \x1b[1mshared.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mshared.js\x1b[22m in \x1b[1m43ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1mstore.js\x1b[22m → \x1b[1mstore.umd.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mstore.umd.js\x1b[22m in \x1b[1m82ms\x1b[22m\x1b[39m\n\n\x1b[0m\x1b[0m\n\x1b[0m  ssr nested component store via connect\x1b[0m\n  \x1b[31m  1) server renders nested component with connect()-provided store\x1b[0m\n\n\n\x1b[92m \x1b[0m\x1b[32m 0 passing\x1b[0m\x1b[90m (54ms)\x1b[0m\n\x1b[31m  1 failing\x1b[0m\n\n\x1b[0m  1) ssr nested component store via connect server renders nested component with connect()-provided store:\n\x1b[0m\x1b[31m     TypeError: Cannot read properties of undefined (reading '_init')\x1b[0m\x1b[90m\n      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:53:38)\n      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)\n      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)\n      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)\n      at processImmediate (node:internal/timers:466:21)\n\x1b[0m\n\n\n\x1b[?2004l" additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1358, 'prompt_tokens': 62112, 'total_tokens': 63470, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--cb1b1f10-b02f-42ce-93bf-eb12554439b4-0' usage_metadata={'input_tokens': 62112, 'output_tokens': 1358, 'total_tokens': 63470, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-12 13:57:46,480 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproducing_structured_node - DEBUG - reproduced_bug=True reproduced_bug_failure_log="npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js\n\n> svelte@1.51.1 build\n> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js\n\nsrc/index.ts → compiler/svelte.js...\ncreated compiler/svelte.js in 5s\n\nsrc/server-side-rendering/register.js → ssr/register.js...\ncreated ssr/register.js in 30ms\n\nsrc/shared/index.js → shared.js...\ncreated shared.js in 43ms\n\nstore.js → store.umd.js...\ncreated store.umd.js in 82ms\n\n  ssr nested component store via connect\n    1) server renders nested component with connect()-provided store\n\n\n  0 passing (54ms)\n  1 failing\n\n  1) ssr nested component store via connect server renders nested component with connect()-provided store:\n     TypeError: Cannot read properties of undefined (reading '_init')\n      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:53:38)\n      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)\n      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)\n      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)\n      at processImmediate (node:internal/timers:466:21)\n" reproduced_bug_commands=['npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js']
2025-11-12 13:57:46,518 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - reproduced_bug: True
2025-11-12 13:57:46,518 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - reproduced_bug_file: test/server-side-rendering/nested-component-store.spec.js
2025-11-12 13:57:46,519 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - reproduced_bug_commands: ['npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js']
2025-11-12 13:57:46,519 - thread-135845298308800.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - reproduced_bug_patch: diff --git a/test/server-side-rendering/nested-component-store.spec.js b/test/server-side-rendering/nested-component-store.spec.js
new file mode 100644
index 000000000..4f51c982c
--- /dev/null
+++ b/test/server-side-rendering/nested-component-store.spec.js
@@ -0,0 +1,86 @@
+import assert from 'assert';
+import { loadSvelte, setupHtmlEqual } from '../helpers.js';
+
+describe('ssr nested component store via connect', () => {
+  let svelte;
+
+  before(() => {
+    svelte = loadSvelte(true);
+    setupHtmlEqual();
+  });
+
+  function compileCjs(source, options) {
+    const { code } = svelte.compile(source, Object.assign({ format: 'cjs' }, options));
+    const module = { exports: {} };
+    const exports = module.exports;
+    const fn = new Function('module', 'exports', 'TwoFactorAuth', `${code}; return module.exports;`);
+    return {
+      evalWith(scope = {}) {
+        return fn(module, exports, scope.TwoFactorAuth);
+      }
+    };
+  }
+
+  it('server renders nested component with connect()-provided store', () => {
+    const childSource = `
+{{#if $hasTwoFactor}}
+<div>yay its enabled</div>
+{{else}}
+<div>oh no its not enabled</div>
+{{/if}}
+
+<script>
+  // Minimal inline connect to mirror svelte-redux's connect API for SSR
+  function connect(mapFn) {
+    return {
+      _init(keys) {
+        const mapped = mapFn({}); // emulate empty Redux state on server
+        const state = {};
+        keys.forEach(k => { state[k] = mapped[k]; });
+        return state;
+      }
+    };
+  }
+
+  export default {
+    store: connect(state => ({
+      hasTwoFactor: state.user && state.user.hasTwoFactor,
+    })),
+  };
+</script>
+    `;
+
+    const parentSource = `
+<div class="page">
+  <h1>Manage Account</h1>
+  <div>
+    <h3>Two Factor Auth</h3>
+    <TwoFactorAuth/>
+  </div>
+</div>
+
+<script>
+  export default {
+    components: { TwoFactorAuth }
+  };
+</script>
+    `;
+
+    // Compile child (TwoFactorAuth) for SSR
+    const childMod = compileCjs(childSource, { generate: 'ssr', name: 'TwoFactorAuth', store: true }).evalWith();
+    const TwoFactorAuth = childMod.default || childMod;
+
+    // Compile parent for SSR, injecting the child component via components mapping
+    const parentMod = compileCjs(parentSource, { generate: 'ssr', name: 'ManageAccount', store: true }).evalWith({ TwoFactorAuth });
+    const Parent = parentMod.default || parentMod;
+
+    // Reproduce the exact SSR issue by passing an options object (with no store) to Parent.render
+    // This currently throws: "Cannot read property '_init' of undefined"
+    const { html } = Parent.render(null, {});
+
+    assert.htmlEqual(
+      html,
+      '<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>'
+    );
+  });
+});

2025-11-12 13:57:46,522 - thread-135845298308800.prometheus.lang_graph.nodes.issue_verified_bug_subgraph_node - INFO - Enter IssueVerifiedBugSubgraphNode
2025-11-12 13:57:46,526 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_context_message_node - DEBUG - Sending query to context provider:
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

2025-11-12 13:57:46,528 - thread-135845298308800.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-12 13:57:46,531 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 13:58:10,753 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We only have the repository file tree; no implementation details are available. The issue concerns server-side rendering of nested components and store propagation, which requires inspecting the SSR code generation for components and the module wrapper that defines render/_render and store initialization. These critical pieces are in the SSR generator (especially the Component visitor), and wrapModule plus the client-side Component generator for comparison. Without these files’ contents we cannot identify where options.store is passed or where store is initialized.' query='Please provide the full contents of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/generators/server-side-rendering/visit.ts, src/generators/wrapModule.ts, and src/generators/nodes/Component.ts.' extra_requirements='If full files are too large, include at minimum the functions that emit SSR output for nested components, any code that passes options/store to child components, and the wrapper code that initializes a component’s store in render/_render.' purpose='To trace how SSR emits nested component calls and how the store is propagated/initialized, so we can pinpoint the bug and propose a fix.'
2025-11-12 13:58:10,756 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/generators/server-side-rendering/visit.ts, src/generators/wrapModule.ts, and src/generators/nodes/Component.ts.
2025-11-12 13:58:11,271 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: [{'query_essential_query': 'Please provide the full contents with line numbers of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/interfaces.ts, src/generators/nodes/Component.ts, src/server-side-rendering/register.js, and store.js.', 'query_extra_requirements': 'If sending all files is too large, include at minimum the functions that generate SSR nested component rendering and store initialization, and the test harness at test/server-side-rendering/index.js; if no SSR store tests exist, please confirm.', 'query_purpose': 'To verify how SSR handles store initialization for nested components, determine if the behavior is inconsistent with the client renderer, and accurately classify the issue.', 'memory_context_contexts': [{'relative_path': 'src/generators/server-side-rendering/visitors/Component.ts', 'content': "1. import flattenReference from '../../../utils/flattenReference';\n2. import visit from '../visit';\n3. import { SsrGenerator } from '../index';\n4. import Block from '../Block';\n5. import { AppendTarget } from '../interfaces';\n6. import { Node } from '../../../interfaces';\n7. import getObject from '../../../utils/getObject';\n8. import getTailSnippet from '../../../utils/getTailSnippet';\n9. import { stringify } from '../../../utils/stringify';\n10. \n11. export default function visitComponent(\n12. \tgenerator: SsrGenerator,\n13. \tblock: Block,\n14. \tnode: Node\n15. ) {\n16. \tfunction stringifyAttribute(chunk: Node) {\n17. \t\tif (chunk.type === 'Text') return chunk.data;\n18. \t\tif (chunk.type === 'MustacheTag') {\n19. \t\t\tblock.contextualise(chunk.expression);\n20. \t\t\tconst { snippet } = chunk.metadata;\n21. \t\t\treturn '${__escape( ' + snippet + ')}';\n22. \t\t}\n23. \t}\n24. \n25. \tconst attributes: Node[] = [];\n26. \tconst bindings: Node[] = [];\n27. \n28. \tnode.attributes.forEach((attribute: Node) => {\n29. \t\tif (attribute.type === 'Attribute') {\n30. \t\t\tattributes.push(attribute);\n31. \t\t} else if (attribute.type === 'Binding') {\n32. \t\t\tbindings.push(attribute);\n33. \t\t}\n34. \t});\n35. \n36. \tconst props = attributes\n37. \t\t.map(attribute => {\n38. \t\t\tlet value;\n39. \n40. \t\t\tif (attribute.value === true) {\n41. \t\t\t\tvalue = `true`;\n42. \t\t\t} else if (attribute.value.length === 0) {\n43. \t\t\t\tvalue = `''`;\n44. \t\t\t} else if (attribute.value.length === 1) {\n45. \t\t\t\tconst chunk = attribute.value[0];\n46. \t\t\t\tif (chunk.type === 'Text') {\n47. \t\t\t\t\tvalue = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;\n48. \t\t\t\t} else {\n49. \t\t\t\t\tblock.contextualise(chunk.expression);\n50. \t\t\t\t\tconst { snippet } = chunk.metadata;\n51. \t\t\t\t\tvalue = snippet;\n52. \t\t\t\t}\n53. \t\t\t} else {\n54. \t\t\t\tvalue = '`' + attribute.value.map(stringifyAttribute).join('') + '`';\n55. \t\t\t}\n56. \n57. \t\t\treturn `${attribute.name}: ${value}`;\n58. \t\t})\n59. \t\t.concat(\n60. \t\t\tbindings.map(binding => {\n61. \t\t\t\tconst { name } = getObject(binding.value);\n62. \t\t\t\tconst tail = binding.value.type === 'MemberExpression'\n63. \t\t\t\t\t? getTailSnippet(binding.value)\n64. \t\t\t\t\t: '';\n65. \n66. \t\t\t\tconst keypath = block.contexts.has(name)\n67. \t\t\t\t\t? `${name}${tail}`\n68. \t\t\t\t\t: `state.${name}${tail}`;\n69. \t\t\t\treturn `${binding.name}: ${keypath}`;\n70. \t\t\t})\n71. \t\t)\n72. \t\t.join(', ');\n73. \n74. \tconst isDynamicComponent = node.name === ':Component';\n75. \tif (isDynamicComponent) block.contextualise(node.expression);\n76. \n77. \tconst expression = (\n78. \t\tnode.name === ':Self' ? generator.name :\n79. \t\tisDynamicComponent ? `((${node.metadata.snippet}) || __missingComponent)` :\n80. \t\t`%components-${node.name}`\n81. \t);\n82. \n83. \tbindings.forEach(binding => {\n84. \t\tblock.addBinding(binding, expression);\n85. \t});\n86. \n87. \tlet open = `\\${${expression}._render(__result, {${props}}`;\n88. \n89. \tconst options = [];\n90. \tif (generator.options.store) {\n91. \t\toptions.push(`store: options.store`);\n92. \t}\n93. \n94. \tif (node.children.length) {\n95. \t\tconst appendTarget: AppendTarget = {\n96. \t\t\tslots: { default: '' },\n97. \t\t\tslotStack: ['default']\n98. \t\t};\n99. \n100. \t\tgenerator.appendTargets.push(appendTarget);\n101. \n102. \t\tnode.children.forEach((child: Node) => {\n103. \t\t\tvisit(generator, block, child);\n104. \t\t});\n105. \n106. \t\tconst slotted = Object.keys(appendTarget.slots)\n107. \t\t\t.map(name => `${name}: () => \\`${appendTarget.slots[name]}\\``)\n108. \t\t\t.join(', ');\n109. \n110. \t\toptions.push(`slotted: { ${slotted} }`);\n111. \n112. \t\tgenerator.appendTargets.pop();\n113. \t}\n114. \n115. \tif (options.length) {\n116. \t\topen += `, { ${options.join(', ')} }`;\n117. \t}\n118. \n119. \tgenerator.append(open);\n120. \tgenerator.append(')}');\n121. }", 'start_line_number': 1, 'end_line_number': 121}, {'relative_path': 'src/generators/server-side-rendering/index.ts', 'content': '1. import deindent from \'../../utils/deindent\';\n2. import Generator from \'../Generator\';\n3. import Stylesheet from \'../../css/Stylesheet\';\n4. import Block from \'./Block\';\n5. import visit from \'./visit\';\n6. import { removeNode, removeObjectKey } from \'../../utils/removeNode\';\n7. import getName from \'../../utils/getName\';\n8. import globalWhitelist from \'../../utils/globalWhitelist\';\n9. import { Parsed, Node, CompileOptions } from \'../../interfaces\';\n10. import { AppendTarget } from \'./interfaces\';\n11. import { stringify } from \'../../utils/stringify\';\n12. \n13. export class SsrGenerator extends Generator {\n14. \tbindings: string[];\n15. \trenderCode: string;\n16. \tappendTargets: AppendTarget[];\n17. \n18. \tconstructor(\n19. \t\tparsed: Parsed,\n20. \t\tsource: string,\n21. \t\tname: string,\n22. \t\tstylesheet: Stylesheet,\n23. \t\toptions: CompileOptions\n24. \t) {\n25. \t\tsuper(parsed, source, name, stylesheet, options, false);\n26. \t\tthis.bindings = [];\n27. \t\tthis.renderCode = \'\';\n28. \t\tthis.appendTargets = [];\n29. \n30. \t\tthis.stylesheet.warnOnUnusedSelectors(options.onwarn);\n31. \t}\n32. \n33. \tappend(code: string) {\n34. \t\tif (this.appendTargets.length) {\n35. \t\t\tconst appendTarget = this.appendTargets[this.appendTargets.length - 1];\n36. \t\t\tconst slotName = appendTarget.slotStack[appendTarget.slotStack.length - 1];\n37. \t\t\tappendTarget.slots[slotName] += code;\n38. \t\t} else {\n39. \t\t\tthis.renderCode += code;\n40. \t\t}\n41. \t}\n42. }\n43. \n44. export default function ssr(\n45. \tparsed: Parsed,\n46. \tsource: string,\n47. \tstylesheet: Stylesheet,\n48. \toptions: CompileOptions\n49. ) {\n50. \tconst format = options.format || \'cjs\';\n51. \n52. \tconst generator = new SsrGenerator(parsed, source, options.name || \'SvelteComponent\', stylesheet, options);\n53. \n54. \tconst { computations, name, templateProperties } = generator;\n55. \n56. \t// create main render() function\n57. \tconst mainBlock = new Block({\n58. \t\tgenerator,\n59. \t\tcontexts: new Map(),\n60. \t\tindexes: new Map(),\n61. \t\tconditions: [],\n62. \t});\n63. \n64. \ttrim(parsed.html.children).forEach((node: Node) => {\n65. \t\tvisit(generator, mainBlock, node);\n66. \t});\n67. \n68. \tconst { css, cssMap } = generator.customElement ?\n69. \t\t{ css: null, cssMap: null } :\n70. \t\tgenerator.stylesheet.render(options.filename, true);\n71. \n72. \t// generate initial state object\n73. \tconst expectedProperties = Array.from(generator.expectedProperties);\n74. \tconst globals = expectedProperties.filter(prop => globalWhitelist.has(prop));\n75. \tconst storeProps = options.store || templateProperties.store ? expectedProperties.filter(prop => prop[0] === \'$\') : [];\n76. \n77. \tconst initialState = [];\n78. \tif (globals.length > 0) {\n79. \t\tinitialState.push(`{ ${globals.map(prop => `${prop} : ${prop}`).join(\', \')} }`);\n80. \t}\n81. \n82. \tif (storeProps.length > 0) {\n83. \t\tconst initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`\n84. \t\tif (options.store || templateProperties.store) {\n85. \t\t\tinitialState.push(`options.store.${initialize}`);\n86. \t\t}\n87. \t}\n88. \n89. \tif (templateProperties.data) {\n90. \t\tinitialState.push(`%data()`);\n91. \t} else if (globals.length === 0 && storeProps.length === 0) {\n92. \t\tinitialState.push(\'{}\');\n93. \t}\n94. \n95. \tinitialState.push(\'state\');\n96. \n97. \t// TODO concatenate CSS maps\n98. \tconst result = deindent`\n99. \t\t${generator.javascript}\n100. \n101. \t\tvar ${name} = {};\n102. \n103. \t\t${options.filename && `${name}.filename = ${stringify(options.filename)}`};\n104. \n105. \t\t${name}.data = function() {\n106. \t\t\treturn ${templateProperties.data ? `%data()` : `{}`};\n107. \t\t};\n108. \n109. \t\t${name}.render = function(state, options = {}) {\n110. \t\t\tvar components = new Set();\n111. \n112. \t\t\tfunction addComponent(component) {\n113. \t\t\t\tcomponents.add(component);\n114. \t\t\t}\n115. \n116. \t\t\tvar result = { head: \'\', addComponent };\n117. \t\t\t${templateProperties.store && `options.store = %store();`}\n118. \t\t\tvar html = ${name}._render(result, state, options);\n119. \n120. \t\t\tvar cssCode = Array.from(components).map(c => c.css && c.css.code).filter(Boolean).join(\'\\\\n\');\n121. \n122. \t\t\treturn {\n123. \t\t\t\thtml,\n124. \t\t\t\thead: result.head,\n125. \t\t\t\tcss: { code: cssCode, map: null },\n126. \t\t\t\ttoString() {\n127. \t\t\t\t\treturn html;\n128. \t\t\t\t}\n129. \t\t\t};\n130. \t\t}\n131. \n132. \t\t${name}._render = function(__result, state, options) {\n133. \t\t\t__result.addComponent(${name});\n134. \n135. \t\t\tstate = Object.assign(${initialState.join(\', \')});\n136. \n137. \t\t\t${computations.map(\n138. \t\t\t\t({ key, deps }) =>\n139. \t\t\t\t\t`state.${key} = %computed-${key}(${deps.map(dep => `state.${dep}`).join(\', \')});`\n140. \t\t\t)}\n141. \n142. \t\t\t${generator.bindings.length &&\n143. \t\t\t\tdeindent`\n144. \t\t\t\tvar settled = false;\n145. \t\t\t\tvar tmp;\n146. \n147. \t\t\t\twhile (!settled) {\n148. \t\t\t\t\tsettled = true;\n149. \n150. \t\t\t\t\t${generator.bindings.join(\'\\n\\n\')}\n151. \t\t\t\t}\n152. \t\t\t`}\n153. \n154. \t\t\treturn \\`${generator.renderCode}\\`;\n155. \t\t};\n156. \n157. \t\t${name}.css = {\n158. \t\t\tcode: ${css ? stringify(css) : `\'\'`},\n159. \t\t\tmap: ${cssMap ? stringify(cssMap.toString()) : \'null\'}\n160. \t\t};\n161. \n162. \t\tvar warned = false;\n163. \t\t${name}.renderCss = function() {\n164. \t\t\tif (!warned) {\n165. \t\t\t\tconsole.error(\'Component.renderCss(...) is deprecated and will be removed in v2 — use Component.render(...).css instead\');\n166. \t\t\t\twarned = true;\n167. \t\t\t}\n168. \n169. \t\t\tvar components = [];\n170. \n171. \t\t\t${generator.stylesheet.hasStyles &&\n172. \t\t\t\tdeindent`\n173. \t\t\t\tcomponents.push({\n174. \t\t\t\t\tfilename: ${name}.filename,\n175. \t\t\t\t\tcss: ${name}.css && ${name}.css.code,\n176. \t\t\t\t\tmap: ${name}.css && ${name}.css.map\n177. \t\t\t\t});\n178. \t\t\t`}\n179. \n180. \t\t\t${templateProperties.components &&\n181. \t\t\t\tdeindent`\n182. \t\t\t\tvar seen = {};\n183. \n184. \t\t\t\tfunction addComponent(component) {\n185. \t\t\t\t\tvar result = component.renderCss();\n186. \t\t\t\t\tresult.components.forEach(x => {\n187. \t\t\t\t\t\tif (seen[x.filename]) return;\n188. \t\t\t\t\t\tseen[x.filename] = true;\n189. \t\t\t\t\t\tcomponents.push(x);\n190. \t\t\t\t\t});\n191. \t\t\t\t}\n192. \n193. \t\t\t\t${templateProperties.components.value.properties.map((prop: Node) => {\n194. \t\t\t\t\treturn `addComponent(%components-${getName(prop.key)});`;\n195. \t\t\t\t})}\n196. \t\t\t`}\n197. \n198. \t\t\treturn {\n199. \t\t\t\tcss: components.map(x => x.css).join(\'\\\\n\'),\n200. \t\t\t\tmap: null,\n201. \t\t\t\tcomponents\n202. \t\t\t};\n203. \t\t};\n204. \n205. \t\t${templateProperties.preload && `${name}.preload = %preload;`}\n206. \n207. \t\t${\n208. \t\t\t// TODO this is a bit hacky\n209. \t\t\t/__escape/.test(generator.renderCode) && deindent`\n210. \t\t\t\tvar escaped = {\n211. \t\t\t\t\t\'"\': \'&quot;\',\n212. \t\t\t\t\t"\'": \'&##39;\',\n213. \t\t\t\t\t\'&\': \'&amp;\',\n214. \t\t\t\t\t\'<\': \'&lt;\',\n215. \t\t\t\t\t\'>\': \'&gt;\'\n216. \t\t\t\t};\n217. \n218. \t\t\t\tfunction __escape(html) {\n219. \t\t\t\t\treturn String(html).replace(/["\'&<>]/g, match => escaped[match]);\n220. \t\t\t\t}\n221. \t\t\t`\n222. \t\t}\n223. \n224. \t\t${\n225. \t\t\t/__isPromise/.test(generator.renderCode) && deindent`\n226. \t\t\t\tfunction __isPromise(value) {\n227. \t\t\t\t\treturn value && typeof value.then === \'function\';\n228. \t\t\t\t}\n229. \t\t\t`\n230. \t\t}\n231. \n232. \t\t${\n233. \t\t\t/__missingComponent/.test(generator.renderCode) && deindent`\n234. \t\t\t\tvar __missingComponent = {\n235. \t\t\t\t\t_render: () => \'\'\n236. \t\t\t\t};\n237. \t\t\t`\n238. \t\t}\n239. \t`.replace(/(@+|#+|%+)(\\w*(?:-\\w*)?)/g, (match: string, sigil: string, name: string) => {\n240. \t\tif (sigil === \'@\') return generator.alias(name);\n241. \t\tif (sigil === \'%\') return generator.templateVars.get(name);\n242. \t\treturn sigil.slice(1) + name;\n243. \t});\n244. \n245. \treturn generator.generate(result, options, { name, format });\n246. }\n247. \n248. function trim(nodes) {\n249. \tlet start = 0;\n250. \tfor (; start < nodes.length; start += 1) {\n251. \t\tconst node = nodes[start];\n252. \t\tif (node.type !== \'Text\') break;\n253. \n254. \t\tnode.data = node.data.replace(/^\\s+/, \'\');\n255. \t\tif (node.data) break;\n256. \t}\n257. \n258. \tlet end = nodes.length;\n259. \tfor (; end > start; end -= 1) {\n260. \t\tconst node = nodes[end - 1];\n261. \t\tif (node.type !== \'Text\') break;\n262. \n263. \t\tnode.data = node.data.replace(/\\s+$/, \'\');\n264. \t\tif (node.data) break;\n265. \t}\n266. \n267. \treturn nodes.slice(start, end);\n268. }', 'start_line_number': 1, 'end_line_number': 268}, {'relative_path': 'src/generators/server-side-rendering/Block.ts', 'content': "1. import deindent from '../../utils/deindent';\n2. import flattenReference from '../../utils/flattenReference';\n3. import { SsrGenerator } from './index';\n4. import { Node } from '../../interfaces';\n5. import getObject from '../../utils/getObject';\n6. \n7. interface BlockOptions {\n8. \t// TODO\n9. }\n10. \n11. export default class Block {\n12. \tgenerator: SsrGenerator;\n13. \tconditions: string[];\n14. \n15. \tcontexts: Map<string, string>;\n16. \tindexes: Map<string, string>;\n17. \tcontextDependencies: Map<string, string[]>;\n18. \n19. \tconstructor(options: BlockOptions) {\n20. \t\tObject.assign(this, options);\n21. \t}\n22. \n23. \taddBinding(binding: Node, name: string) {\n24. \t\tconst conditions = [`!('${binding.name}' in state)`].concat(\n25. \t\t\t// TODO handle contextual bindings...\n26. \t\t\tthis.conditions.map(c => `(${c})`)\n27. \t\t);\n28. \n29. \t\tconst { name: prop } = getObject(binding.value);\n30. \n31. \t\tthis.generator.bindings.push(deindent`\n32. \t\t\tif (${conditions.join('&&')}) {\n33. \t\t\t\ttmp = ${name}.data();\n34. \t\t\t\tif ('${prop}' in tmp) {\n35. \t\t\t\t\tstate.${binding.name} = tmp.${prop};\n36. \t\t\t\t\tsettled = false;\n37. \t\t\t\t}\n38. \t\t\t}\n39. \t\t`);\n40. \t}\n41. \n42. \tchild(options: BlockOptions) {\n43. \t\treturn new Block(Object.assign({}, this, options, { parent: this }));\n44. \t}\n45. \n46. \tcontextualise(expression: Node, context?: string, isEventHandler?: boolean) {\n47. \t\treturn this.generator.contextualise(this.contexts, this.indexes, expression, context, isEventHandler);\n48. \t}\n49. }", 'start_line_number': 1, 'end_line_number': 49}, {'relative_path': 'src/interfaces.ts', 'content': "1. import {SourceMap} from 'magic-string';\n2. \n3. export interface Node {\n4. \tstart: number;\n5. \tend: number;\n6. \ttype: string;\n7. \t[propName: string]: any;\n8. }\n9. \n10. export interface Parser {\n11. \treadonly template: string;\n12. \treadonly filename?: string;\n13. \n14. \tindex: number;\n15. \tstack: Array<Node>;\n16. \n17. \thtml: Node;\n18. \tcss: Node;\n19. \tjs: Node;\n20. \tmetaTags: {};\n21. }\n22. \n23. export interface Parsed {\n24. \thash: number;\n25. \thtml: Node;\n26. \tcss: Node;\n27. \tjs: Node;\n28. }\n29. \n30. export interface Warning {\n31. \tloc?: { line: number; column: number; pos?: number };\n32. \tpos?: number;\n33. \tmessage: string;\n34. \tfilename?: string;\n35. \tframe?: string;\n36. \ttoString: () => string;\n37. }\n38. \n39. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';\n40. \n41. export interface CompileOptions {\n42. \tformat?: ModuleFormat;\n43. \tname?: string;\n44. \tfilename?: string;\n45. \tgenerate?: string;\n46. \tglobals?: ((id: string) => string) | object;\n47. \tamd?: {\n48. \t\tid?: string;\n49. \t};\n50. \n51. \toutputFilename?: string;\n52. \tcssOutputFilename?: string;\n53. \n54. \tdev?: boolean;\n55. \tshared?: boolean | string;\n56. \tcascade?: boolean;\n57. \thydratable?: boolean;\n58. \tlegacy?: boolean;\n59. \tcustomElement?: CustomElementOptions | true;\n60. \tcss?: boolean;\n61. \tstore?: boolean;\n62. \n63. \tonerror?: (error: Error) => void;\n64. \tonwarn?: (warning: Warning) => void;\n65. }\n66. \n67. export interface GenerateOptions {\n68. \tname: string;\n69. \tformat: ModuleFormat;\n70. \tbanner?: string;\n71. \tsharedPath?: string;\n72. \thelpers?: { name: string, alias: string }[];\n73. }\n74. \n75. export interface Visitor {\n76. \tenter: (node: Node) => void;\n77. \tleave?: (node: Node) => void;\n78. }\n79. \n80. export interface CustomElementOptions {\n81. \ttag?: string;\n82. \tprops?: string[];\n83. }\n84. \n85. export interface PreprocessOptions {\n86. \tmarkup?: (options: {content: string, filename: string}) => { code: string, map?: SourceMap | string };\n87. \tstyle?: Preprocessor;\n88. \tscript?: Preprocessor;\n89. \tfilename?: string\n90. }\n91. \n92. export type Preprocessor = (options: {content: string, attributes: Record<string, string | boolean>, filename?: string}) => { code: string, map?: SourceMap | string };", 'start_line_number': 1, 'end_line_number': 92}, {'relative_path': 'src/generators/nodes/Component.ts', 'content': '1. import deindent from \'../../utils/deindent\';\n2. import { stringify } from \'../../utils/stringify\';\n3. import stringifyProps from \'../../utils/stringifyProps\';\n4. import CodeBuilder from \'../../utils/CodeBuilder\';\n5. import getTailSnippet from \'../../utils/getTailSnippet\';\n6. import getObject from \'../../utils/getObject\';\n7. import getExpressionPrecedence from \'../../utils/getExpressionPrecedence\';\n8. import Node from \'./shared/Node\';\n9. import Block from \'../dom/Block\';\n10. import Attribute from \'./Attribute\';\n11. \n12. export default class Component extends Node {\n13. \ttype: \'Component\';\n14. \tname: string;\n15. \tattributes: Attribute[];\n16. \tchildren: Node[];\n17. \n18. \tinit(\n19. \t\tblock: Block,\n20. \t\tstripWhitespace: boolean,\n21. \t\tnextSibling: Node\n22. \t) {\n23. \t\tthis.cannotUseInnerHTML();\n24. \n25. \t\tthis.attributes.forEach((attribute: Node) => {\n26. \t\t\tif (attribute.type === \'Attribute\' && attribute.value !== true) {\n27. \t\t\t\tattribute.value.forEach((chunk: Node) => {\n28. \t\t\t\t\tif (chunk.type !== \'Text\') {\n29. \t\t\t\t\t\tconst dependencies = chunk.metadata.dependencies;\n30. \t\t\t\t\t\tblock.addDependencies(dependencies);\n31. \t\t\t\t\t}\n32. \t\t\t\t});\n33. \t\t\t} else {\n34. \t\t\t\tif (attribute.type === \'EventHandler\' && attribute.expression) {\n35. \t\t\t\t\tattribute.expression.arguments.forEach((arg: Node) => {\n36. \t\t\t\t\t\tblock.addDependencies(arg.metadata.dependencies);\n37. \t\t\t\t\t});\n38. \t\t\t\t} else if (attribute.type === \'Binding\') {\n39. \t\t\t\t\tblock.addDependencies(attribute.metadata.dependencies);\n40. \t\t\t\t}\n41. \t\t\t}\n42. \t\t});\n43. \n44. \t\tthis.var = block.getUniqueName(\n45. \t\t\t(\n46. \t\t\t\tthis.name === \':Self\' ? this.generator.name :\n47. \t\t\t\tthis.name === \':Component\' ? \'switch_instance\' :\n48. \t\t\t\tthis.name\n49. \t\t\t).toLowerCase()\n50. \t\t);\n51. \n52. \t\tif (this.children.length) {\n53. \t\t\tthis._slots = new Set([\'default\']);\n54. \n55. \t\t\tthis.children.forEach(child => {\n56. \t\t\t\tchild.init(block, stripWhitespace, nextSibling);\n57. \t\t\t});\n58. \t\t}\n59. \t}\n60. \n61. \tbuild(\n62. \t\tblock: Block,\n63. \t\tparentNode: string,\n64. \t\tparentNodes: string\n65. \t) {\n66. \t\tconst { generator } = this;\n67. \t\tgenerator.hasComponents = true;\n68. \n69. \t\tconst name = this.var;\n70. \n71. \t\tconst componentInitProperties = [`root: #component.root`];\n72. \n73. \t\tif (this.children.length > 0) {\n74. \t\t\tconst slots = Array.from(this._slots).map(name => `${name}: @createFragment()`);\n75. \t\t\tcomponentInitProperties.push(`slots: { ${slots.join(\', \')} }`);\n76. \n77. \t\t\tthis.children.forEach((child: Node) => {\n78. \t\t\t\tchild.build(block, `${this.var}._slotted.default`, \'nodes\');\n79. \t\t\t});\n80. \t\t}\n81. \n82. \t\tconst allContexts = new Set();\n83. \t\tconst statements: string[] = [];\n84. \t\tconst name_context = block.getUniqueName(`${name}_context`);\n85. \n86. \t\tlet name_updating: string;\n87. \t\tlet name_initial_data: string;\n88. \t\tlet beforecreate: string = null;\n89. \n90. \t\tconst attributes = this.attributes\n91. \t\t\t.filter(a => a.type === \'Attribute\')\n92. \t\t\t.map(a => mungeAttribute(a, block));\n93. \n94. \t\tconst bindings = this.attributes\n95. \t\t\t.filter(a => a.type === \'Binding\')\n96. \t\t\t.map(a => mungeBinding(a, block));\n97. \n98. \t\tconst eventHandlers = this.attributes\n99. \t\t\t.filter((a: Node) => a.type === \'EventHandler\')\n100. \t\t\t.map(a => mungeEventHandler(generator, this, a, block, name_context, allContexts));\n101. \n102. \t\tconst ref = this.attributes.find((a: Node) => a.type === \'Ref\');\n103. \t\tif (ref) generator.usesRefs = true;\n104. \n105. \t\tconst updates: string[] = [];\n106. \n107. \t\tif (attributes.length || bindings.length) {\n108. \t\t\tconst initialProps = attributes\n109. \t\t\t\t.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);\n110. \n111. \t\t\tconst initialPropString = stringifyProps(initialProps);\n112. \n113. \t\t\tattributes\n114. \t\t\t\t.filter((attribute: Attribute) => attribute.dynamic)\n115. \t\t\t\t.forEach((attribute: Attribute) => {\n116. \t\t\t\t\tif (attribute.dependencies.length) {\n117. \t\t\t\t\t\tupdates.push(deindent`\n118. \t\t\t\t\t\t\tif (${attribute.dependencies\n119. \t\t\t\t\t\t\t\t.map(dependency => `changed.${dependency}`)\n120. \t\t\t\t\t\t\t\t.join(\' || \')}) ${name}_changes.${attribute.name} = ${attribute.value};\n121. \t\t\t\t\t\t`);\n122. \t\t\t\t\t}\n123. \n124. \t\t\t\t\telse {\n125. \t\t\t\t\t\t// TODO this is an odd situation to encounter – I *think* it should only happen with\n126. \t\t\t\t\t\t// each block indices, in which case it may be possible to optimise this\n127. \t\t\t\t\t\tupdates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);\n128. \t\t\t\t\t}\n129. \t\t\t\t});\n130. \n131. \t\t\tif (bindings.length) {\n132. \t\t\t\tgenerator.hasComplexBindings = true;\n133. \n134. \t\t\t\tname_updating = block.alias(`${name}_updating`);\n135. \t\t\t\tname_initial_data = block.getUniqueName(`${name}_initial_data`);\n136. \n137. \t\t\t\tblock.addVariable(name_updating, \'{}\');\n138. \t\t\t\tstatements.push(`var ${name_initial_data} = ${initialPropString};`);\n139. \n140. \t\t\t\tconst setParentFromChildOnChange = new CodeBuilder();\n141. \t\t\t\tconst setParentFromChildOnInit = new CodeBuilder();\n142. \n143. \t\t\t\tbindings.forEach((binding: Binding) => {\n144. \t\t\t\t\tlet setParentFromChild;\n145. \n146. \t\t\t\t\tbinding.contexts.forEach(context => {\n147. \t\t\t\t\t\tallContexts.add(context);\n148. \t\t\t\t\t});\n149. \n150. \t\t\t\t\tconst { name: key } = getObject(binding.value);\n151. \n152. \t\t\t\t\tif (block.contexts.has(key)) {\n153. \t\t\t\t\t\tconst prop = binding.dependencies[0];\n154. \t\t\t\t\t\tconst computed = isComputed(binding.value);\n155. \t\t\t\t\t\tconst tail = binding.value.type === \'MemberExpression\' ? getTailSnippet(binding.value) : \'\';\n156. \n157. \t\t\t\t\t\tsetParentFromChild = deindent`\n158. \t\t\t\t\t\t\tvar list = ${name_context}.${block.listNames.get(key)};\n159. \t\t\t\t\t\t\tvar index = ${name_context}.${block.indexNames.get(key)};\n160. \t\t\t\t\t\t\tlist[index]${tail} = childState.${binding.name};\n161. \n162. \t\t\t\t\t\t\t${binding.dependencies\n163. \t\t\t\t\t\t\t\t.map((prop: string) => `newState.${prop} = state.${prop};`)\n164. \t\t\t\t\t\t\t\t.join(\'\\n\')}\n165. \t\t\t\t\t\t`;\n166. \t\t\t\t\t}\n167. \n168. \t\t\t\t\telse if (binding.value.type === \'MemberExpression\') {\n169. \t\t\t\t\t\tsetParentFromChild = deindent`\n170. \t\t\t\t\t\t\t${binding.snippet} = childState.${binding.name};\n171. \t\t\t\t\t\t\t${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join(\'\\n\')}\n172. \t\t\t\t\t\t`;\n173. \t\t\t\t\t}\n174. \n175. \t\t\t\t\telse {\n176. \t\t\t\t\t\tsetParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;\n177. \t\t\t\t\t}\n178. \n179. \t\t\t\t\tstatements.push(deindent`\n180. \t\t\t\t\t\tif (${binding.prop} in ${binding.obj}) {\n181. \t\t\t\t\t\t\t${name_initial_data}.${binding.name} = ${binding.snippet};\n182. \t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n183. \t\t\t\t\t\t}`\n184. \t\t\t\t\t);\n185. \n186. \t\t\t\t\tsetParentFromChildOnChange.addConditional(\n187. \t\t\t\t\t\t`!${name_updating}.${binding.name} && changed.${binding.name}`,\n188. \t\t\t\t\t\tsetParentFromChild\n189. \t\t\t\t\t);\n190. \n191. \t\t\t\t\tsetParentFromChildOnInit.addConditional(\n192. \t\t\t\t\t\t`!${name_updating}.${binding.name}`,\n193. \t\t\t\t\t\tsetParentFromChild\n194. \t\t\t\t\t);\n195. \n196. \t\t\t\t\t// TODO could binding.dependencies.length ever be 0?\n197. \t\t\t\t\tif (binding.dependencies.length) {\n198. \t\t\t\t\t\tupdates.push(deindent`\n199. \t\t\t\t\t\t\tif (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(\' || \')}) {\n200. \t\t\t\t\t\t\t\t${name}_changes.${binding.name} = ${binding.snippet};\n201. \t\t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n202. \t\t\t\t\t\t\t}\n203. \t\t\t\t\t\t`);\n204. \t\t\t\t\t}\n205. \t\t\t\t});\n206. \n207. \t\t\t\tcomponentInitProperties.push(`data: ${name_initial_data}`);\n208. \n209. \t\t\t\tcomponentInitProperties.push(deindent`\n210. \t\t\t\t\t_bind: function(changed, childState) {\n211. \t\t\t\t\t\tvar state = #component.get(), newState = {};\n212. \t\t\t\t\t\t${setParentFromChildOnChange}\n213. \t\t\t\t\t\t${name_updating} = @assign({}, changed);\n214. \t\t\t\t\t\t#component._set(newState);\n215. \t\t\t\t\t\t${name_updating} = {};\n216. \t\t\t\t\t}\n217. \t\t\t\t`);\n218. \n219. \t\t\t\tbeforecreate = deindent`\n220. \t\t\t\t\t#component.root._beforecreate.push(function() {\n221. \t\t\t\t\t\tvar state = #component.get(), childState = ${name}.get(), newState = {};\n222. \t\t\t\t\t\tif (!childState) return;\n223. \t\t\t\t\t\t${setParentFromChildOnInit}\n224. \t\t\t\t\t\t${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(\', \')} };\n225. \t\t\t\t\t\t#component._set(newState);\n226. \t\t\t\t\t\t${name_updating} = {};\n227. \t\t\t\t\t});\n228. \t\t\t\t`;\n229. \t\t\t} else if (initialProps.length) {\n230. \t\t\t\tcomponentInitProperties.push(`data: ${initialPropString}`);\n231. \t\t\t}\n232. \t\t}\n233. \n234. \t\tconst isDynamicComponent = this.name === \':Component\';\n235. \n236. \t\tconst switch_vars = isDynamicComponent && {\n237. \t\t\tvalue: block.getUniqueName(\'switch_value\'),\n238. \t\t\tprops: block.getUniqueName(\'switch_props\')\n239. \t\t};\n240. \n241. \t\tconst expression = (\n242. \t\t\tthis.name === \':Self\' ? generator.name :\n243. \t\t\tisDynamicComponent ? switch_vars.value :\n244. \t\t\t`%components-${this.name}`\n245. \t\t);\n246. \n247. \t\tif (isDynamicComponent) {\n248. \t\t\tblock.contextualise(this.expression);\n249. \t\t\tconst { dependencies, snippet } = this.metadata;\n250. \n251. \t\t\tconst anchor = this.getOrCreateAnchor(block, parentNode, parentNodes);\n252. \n253. \t\t\tconst params = block.params.join(\', \');\n254. \n255. \t\t\tblock.builders.init.addBlock(deindent`\n256. \t\t\t\tvar ${switch_vars.value} = ${snippet};\n257. \n258. \t\t\t\tfunction ${switch_vars.props}(${params}) {\n259. \t\t\t\t\t${statements.length > 0 && statements.join(\'\\n\')}\n260. \t\t\t\t\treturn {\n261. \t\t\t\t\t\t${componentInitProperties.join(\',\\n\')}\n262. \t\t\t\t\t};\n263. \t\t\t\t}\n264. \n265. \t\t\t\tif (${switch_vars.value}) {\n266. \t\t\t\t\tvar ${name} = new ${expression}(${switch_vars.props}(${params}));\n267. \n268. \t\t\t\t\t${beforecreate}\n269. \t\t\t\t}\n270. \n271. \t\t\t\t${eventHandlers.map(handler => deindent`\n272. \t\t\t\t\tfunction ${handler.var}(event) {\n273. \t\t\t\t\t\t${handler.body}\n274. \t\t\t\t\t}\n275. \n276. \t\t\t\t\tif (${name}) ${name}.on("${handler.name}", ${handler.var});\n277. \t\t\t\t`)}\n278. \t\t\t`);\n279. \n280. \t\t\tblock.builders.create.addLine(\n281. \t\t\t\t`if (${name}) ${name}._fragment.c();`\n282. \t\t\t);\n283. \n284. \t\t\tif (parentNodes) {\n285. \t\t\t\tblock.builders.claim.addLine(\n286. \t\t\t\t\t`if (${name}) ${name}._fragment.l(${parentNodes});`\n287. \t\t\t\t);\n288. \t\t\t}\n289. \n290. \t\t\tblock.builders.mount.addLine(\n291. \t\t\t\t`if (${name}) ${name}._mount(${parentNode || \'#target\'}, ${parentNode ? \'null\' : \'anchor\'});`\n292. \t\t\t);\n293. \n294. \t\t\tconst updateMountNode = this.getUpdateMountNode(anchor);\n295. \n296. \t\t\tblock.builders.update.addBlock(deindent`\n297. \t\t\t\tif (${switch_vars.value} !== (${switch_vars.value} = ${snippet})) {\n298. \t\t\t\t\tif (${name}) ${name}.destroy();\n299. \n300. \t\t\t\t\tif (${switch_vars.value}) {\n301. \t\t\t\t\t\t${name} = new ${switch_vars.value}(${switch_vars.props}(${params}));\n302. \t\t\t\t\t\t${name}._fragment.c();\n303. \n304. \t\t\t\t\t\t${this.children.map(child => remount(generator, child, name))}\n305. \t\t\t\t\t\t${name}._mount(${updateMountNode}, ${anchor});\n306. \n307. \t\t\t\t\t\t${eventHandlers.map(handler => deindent`\n308. \t\t\t\t\t\t\t${name}.on("${handler.name}", ${handler.var});\n309. \t\t\t\t\t\t`)}\n310. \n311. \t\t\t\t\t\t${ref && `#component.refs.${ref.name} = ${name};`}\n312. \t\t\t\t\t}\n313. \n314. \t\t\t\t\t${ref && deindent`\n315. \t\t\t\t\t\telse if (#component.refs.${ref.name} === ${name}) {\n316. \t\t\t\t\t\t\t#component.refs.${ref.name} = null;\n317. \t\t\t\t\t\t}`}\n318. \t\t\t\t}\n319. \t\t\t`);\n320. \n321. \t\t\tif (updates.length) {\n322. \t\t\t\tblock.builders.update.addBlock(deindent`\n323. \t\t\t\t\telse {\n324. \t\t\t\t\t\tvar ${name}_changes = {};\n325. \t\t\t\t\t\t${updates.join(\'\\n\')}\n326. \t\t\t\t\t\t${name}._set(${name}_changes);\n327. \t\t\t\t\t\t${bindings.length && `${name_updating} = {};`}\n328. \t\t\t\t\t}\n329. \t\t\t\t`);\n330. \t\t\t}\n331. \n332. \t\t\tif (!parentNode) block.builders.unmount.addLine(`if (${name}) ${name}._unmount();`);\n333. \n334. \t\t\tblock.builders.destroy.addLine(`if (${name}) ${name}.destroy(false);`);\n335. \t\t} else {\n336. \t\t\tblock.builders.init.addBlock(deindent`\n337. \t\t\t\t${statements.join(\'\\n\')}\n338. \t\t\t\tvar ${name} = new ${expression}({\n339. \t\t\t\t\t${componentInitProperties.join(\',\\n\')}\n340. \t\t\t\t});\n341. \n342. \t\t\t\t${beforecreate}\n343. \n344. \t\t\t\t${eventHandlers.map(handler => deindent`\n345. \t\t\t\t\t${name}.on("${handler.name}", function(event) {\n346. \t\t\t\t\t\t${handler.body}\n347. \t\t\t\t\t});\n348. \t\t\t\t`)}\n349. \n350. \t\t\t\t${ref && `#component.refs.${ref.name} = ${name};`}\n351. \t\t\t`);\n352. \n353. \t\t\tblock.builders.create.addLine(`${name}._fragment.c();`);\n354. \n355. \t\t\tif (parentNodes) {\n356. \t\t\t\tblock.builders.claim.addLine(\n357. \t\t\t\t\t`${name}._fragment.l(${parentNodes});`\n358. \t\t\t\t);\n359. \t\t\t}\n360. \n361. \t\t\tblock.builders.mount.addLine(\n362. \t\t\t\t`${name}._mount(${parentNode || \'#target\'}, ${parentNode ? \'null\' : \'anchor\'});`\n363. \t\t\t);\n364. \n365. \t\t\tif (updates.length) {\n366. \t\t\t\tblock.builders.update.addBlock(deindent`\n367. \t\t\t\t\tvar ${name}_changes = {};\n368. \t\t\t\t\t${updates.join(\'\\n\')}\n369. \t\t\t\t\t${name}._set(${name}_changes);\n370. \t\t\t\t\t${bindings.length && `${name_updating} = {};`}\n371. \t\t\t\t`);\n372. \t\t\t}\n373. \n374. \t\t\tif (!parentNode) block.builders.unmount.addLine(`${name}._unmount();`);\n375. \n376. \t\t\tblock.builders.destroy.addLine(deindent`\n377. \t\t\t\t${name}.destroy(false);\n378. \t\t\t\t${ref && `if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;`}\n379. \t\t\t`);\n380. \t\t}\n381. \n382. \t\t// maintain component context\n383. \t\tif (allContexts.size) {\n384. \t\t\tconst contexts = Array.from(allContexts);\n385. \n386. \t\t\tconst initialProps = contexts\n387. \t\t\t\t.map(contextName => {\n388. \t\t\t\t\tif (contextName === \'state\') return `state: state`;\n389. \n390. \t\t\t\t\tconst listName = block.listNames.get(contextName);\n391. \t\t\t\t\tconst indexName = block.indexNames.get(contextName);\n392. \n393. \t\t\t\t\treturn `${listName}: ${listName},\\n${indexName}: ${indexName}`;\n394. \t\t\t\t})\n395. \t\t\t\t.join(\',\\n\');\n396. \n397. \t\t\tconst updates = contexts\n398. \t\t\t\t.map(contextName => {\n399. \t\t\t\t\tif (contextName === \'state\') return `${name_context}.state = state;`;\n400. \n401. \t\t\t\t\tconst listName = block.listNames.get(contextName);\n402. \t\t\t\t\tconst indexName = block.indexNames.get(contextName);\n403. \n404. \t\t\t\t\treturn `${name_context}.${listName} = ${listName};\\n${name_context}.${indexName} = ${indexName};`;\n405. \t\t\t\t})\n406. \t\t\t\t.join(\'\\n\');\n407. \n408. \t\t\tblock.builders.init.addBlock(deindent`\n409. \t\t\t\tvar ${name_context} = {\n410. \t\t\t\t\t${initialProps}\n411. \t\t\t\t};\n412. \t\t\t`);\n413. \n414. \t\t\tblock.builders.update.addBlock(updates);\n415. \t\t}\n416. \t}\n417. }\n418. \n419. function mungeAttribute(attribute: Node, block: Block): Attribute {\n420. \tif (attribute.value === true) {\n421. \t\t// attributes without values, e.g. <textarea readonly>\n422. \t\treturn {\n423. \t\t\tname: attribute.name,\n424. \t\t\tvalue: true,\n425. \t\t\tdynamic: false\n426. \t\t};\n427. \t}\n428. \n429. \tif (attribute.value.length === 0) {\n430. \t\treturn {\n431. \t\t\tname: attribute.name,\n432. \t\t\tvalue: `\'\'`,\n433. \t\t\tdynamic: false\n434. \t\t};\n435. \t}\n436. \n437. \tif (attribute.value.length === 1) {\n438. \t\tconst value = attribute.value[0];\n439. \n440. \t\tif (value.type === \'Text\') {\n441. \t\t\t// static attributes\n442. \t\t\treturn {\n443. \t\t\t\tname: attribute.name,\n444. \t\t\t\tvalue: isNaN(value.data) ? stringify(value.data) : value.data,\n445. \t\t\t\tdynamic: false\n446. \t\t\t};\n447. \t\t}\n448. \n449. \t\t// simple dynamic attributes\n450. \t\tblock.contextualise(value.expression); // TODO remove\n451. \t\tconst { dependencies, snippet } = value.metadata;\n452. \n453. \t\t// TODO only update attributes that have changed\n454. \t\treturn {\n455. \t\t\tname: attribute.name,\n456. \t\t\tvalue: snippet,\n457. \t\t\tdependencies,\n458. \t\t\tdynamic: true\n459. \t\t};\n460. \t}\n461. \n462. \t// otherwise we\'re dealing with a complex dynamic attribute\n463. \tconst allDependencies = new Set();\n464. \n465. \tconst value =\n466. \t\t(attribute.value[0].type === \'Text\' ? \'\' : `"" + `) +\n467. \t\tattribute.value\n468. \t\t\t.map((chunk: Node) => {\n469. \t\t\t\tif (chunk.type === \'Text\') {\n470. \t\t\t\t\treturn stringify(chunk.data);\n471. \t\t\t\t} else {\n472. \t\t\t\t\tblock.contextualise(chunk.expression); // TODO remove\n473. \t\t\t\t\tconst { dependencies, snippet } = chunk.metadata;\n474. \n475. \t\t\t\t\tdependencies.forEach((dependency: string) => {\n476. \t\t\t\t\t\tallDependencies.add(dependency);\n477. \t\t\t\t\t});\n478. \n479. \t\t\t\t\treturn getExpressionPrecedence(chunk.expression) <= 13 ? `(${snippet})` : snippet;\n480. \t\t\t\t}\n481. \t\t\t})\n482. \t\t\t.join(\' + \');\n483. \n484. \treturn {\n485. \t\tname: attribute.name,\n486. \t\tvalue,\n487. \t\tdependencies: Array.from(allDependencies),\n488. \t\tdynamic: true\n489. \t};\n490. }\n491. \n492. function mungeBinding(binding: Node, block: Block): Binding {\n493. \tconst { name } = getObject(binding.value);\n494. \tconst { contexts } = block.contextualise(binding.value);\n495. \tconst { dependencies, snippet } = binding.metadata;\n496. \n497. \tconst contextual = block.contexts.has(name);\n498. \n499. \tlet obj;\n500. \tlet prop;\n501. \n502. \tif (contextual) {\n503. \t\tobj = block.listNames.get(name);\n504. \t\tprop = block.indexNames.get(name);\n505. \t} else if (binding.value.type === \'MemberExpression\') {\n506. \t\tprop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;\n507. \t\tif (!binding.value.computed) prop = `\'${prop}\'`;\n508. \t\tobj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;\n509. \t} else {\n510. \t\tobj = \'state\';\n511. \t\tprop = `\'${name}\'`;\n512. \t}\n513. \n514. \treturn {\n515. \t\tname: binding.name,\n516. \t\tvalue: binding.value,\n517. \t\tcontexts,\n518. \t\tsnippet,\n519. \t\tobj,\n520. \t\tprop,\n521. \t\tdependencies\n522. \t};\n523. }\n524. \n525. function mungeEventHandler(generator: DomGenerator, node: Node, handler: Node, block: Block, name_context: string, allContexts: Set<string>) {\n526. \tlet body;\n527. \n528. \tif (handler.expression) {\n529. \t\tgenerator.addSourcemapLocations(handler.expression);\n530. \t\tgenerator.code.prependRight(\n531. \t\t\thandler.expression.start,\n532. \t\t\t`${block.alias(\'component\')}.`\n533. \t\t);\n534. \n535. \t\tconst usedContexts: string[] = [];\n536. \n537. \t\thandler.expression.arguments.forEach((arg: Node) => {\n538. \t\t\tconst { contexts } = block.contextualise(arg, null, true);\n539. \n540. \t\t\tcontexts.forEach(context => {\n541. \t\t\t\tif (!~usedContexts.indexOf(context)) usedContexts.push(context);\n542. \t\t\t\tallContexts.add(context);\n543. \t\t\t});\n544. \t\t});\n545. \n546. \t\t// TODO hoist event handlers? can do `this.__component.method(...)`\n547. \t\tconst declarations = usedContexts.map(name => {\n548. \t\t\tif (name === \'state\') return `var state = ${name_context}.state;`;\n549. \n550. \t\t\tconst listName = block.listNames.get(name);\n551. \t\t\tconst indexName = block.indexNames.get(name);\n552. \n553. \t\t\treturn `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;\n554. \t\t});\n555. \n556. \t\tbody = deindent`\n557. \t\t\t${declarations}\n558. \n559. \t\t\t[✂${handler.expression.start}-${handler.expression.end}✂];\n560. \t\t`;\n561. \t} else {\n562. \t\tbody = deindent`\n563. \t\t\t${block.alias(\'component\')}.fire(\'${handler.name}\', event);\n564. \t\t`;\n565. \t}\n566. \n567. \treturn {\n568. \t\tname: handler.name,\n569. \t\tvar: block.getUniqueName(`${node.var}_${handler.name}`),\n570. \t\tbody\n571. \t};\n572. }\n573. \n574. function isComputed(node: Node) {\n575. \twhile (node.type === \'MemberExpression\') {\n576. \t\tif (node.computed) return true;\n577. \t\tnode = node.object;\n578. \t}\n579. \n580. \treturn false;\n581. }\n582. \n583. function remount(generator: DomGenerator, node: Node, name: string) {\n584. \t// TODO make this a method of the nodes\n585. \n586. \tif (node.type === \'Component\') {\n587. \t\treturn `${node.var}._mount(${name}._slotted.default, null);`;\n588. \t}\n589. \n590. \tif (node.type === \'Element\') {\n591. \t\tconst slot = node.attributes.find(attribute => attribute.name === \'slot\');\n592. \t\tif (slot) {\n593. \t\t\treturn `@appendNode(${node.var}, ${name}._slotted.${node.getStaticAttributeValue(\'slot\')});`;\n594. \t\t}\n595. \n596. \t\treturn `@appendNode(${node.var}, ${name}._slotted.default);`;\n597. \t}\n598. \n599. \tif (node.type === \'Text\' || node.type === \'MustacheTag\' || node.type === \'RawMustacheTag\') {\n600. \t\treturn `@appendNode(${node.var}, ${name}._slotted.default);`;\n601. \t}\n602. \n603. \tif (node.type === \'EachBlock\') {\n604. \t\t// TODO consider keyed blocks\n605. \t\treturn `for (var #i = 0; #i < ${node.iterations}.length; #i += 1) ${node.iterations}[#i].m(${name}._slotted.default, null);`;\n606. \t}\n607. \n608. \treturn `${node.var}.m(${name}._slotted.default, null);`;\n609. }', 'start_line_number': 1, 'end_line_number': 609}, {'relative_path': 'src/server-side-rendering/register.js', 'content': "1. import * as fs from 'fs';\n2. import * as path from 'path';\n3. import { compile } from '../index.ts';\n4. \n5. const compileOptions = {};\n6. \n7. function capitalise(name) {\n8. \treturn name[0].toUpperCase() + name.slice(1);\n9. }\n10. \n11. export default function register(options) {\n12. \tconst { extensions } = options;\n13. \n14. \tif (extensions) {\n15. \t\t_deregister('.html');\n16. \t\textensions.forEach(_register);\n17. \t}\n18. \n19. \t// TODO make this the default and remove in v2\n20. \tif ('store' in options) compileOptions.store = options.store;\n21. }\n22. \n23. function _deregister(extension) {\n24. \tdelete require.extensions[extension];\n25. }\n26. \n27. function _register(extension) {\n28. \trequire.extensions[extension] = function(module, filename) {\n29. \t\tconst name = path.basename(filename)\n30. \t\t\t.slice(0, -path.extname(filename).length)\n31. \t\t\t.replace(/^\\d/, '_$&')\n32. \t\t\t.replace(/[^a-zA-Z0-9_$]/g, '');\n33. \n34. \t\tconst options = Object.assign({}, compileOptions, {\n35. \t\t\tfilename,\n36. \t\t\tname: capitalise(name),\n37. \t\t\tgenerate: 'ssr'\n38. \t\t});\n39. \n40. \t\tconst {code} = compile(fs.readFileSync(filename, 'utf-8'), options);\n41. \n42. \t\treturn module._compile(code, filename);\n43. \t};\n44. }\n45. \n46. _register('.html');", 'start_line_number': 1, 'end_line_number': 46}, {'relative_path': 'store.js', 'content': '1. import {\n2. \tassign,\n3. \tblankObject,\n4. \tdiffers,\n5. \tdispatchObservers,\n6. \tget,\n7. \tobserve\n8. } from \'./shared.js\';\n9. \n10. function Store(state) {\n11. \tthis._observers = { pre: blankObject(), post: blankObject() };\n12. \tthis._changeHandlers = [];\n13. \tthis._dependents = [];\n14. \n15. \tthis._computed = blankObject();\n16. \tthis._sortedComputedProperties = [];\n17. \n18. \tthis._state = assign({}, state);\n19. }\n20. \n21. assign(Store.prototype, {\n22. \t_add: function(component, props) {\n23. \t\tthis._dependents.push({\n24. \t\t\tcomponent: component,\n25. \t\t\tprops: props\n26. \t\t});\n27. \t},\n28. \n29. \t_init: function(props) {\n30. \t\tvar state = {};\n31. \t\tfor (var i = 0; i < props.length; i += 1) {\n32. \t\t\tvar prop = props[i];\n33. \t\t\tstate[\'$\' + prop] = this._state[prop];\n34. \t\t}\n35. \t\treturn state;\n36. \t},\n37. \n38. \t_remove: function(component) {\n39. \t\tvar i = this._dependents.length;\n40. \t\twhile (i--) {\n41. \t\t\tif (this._dependents[i].component === component) {\n42. \t\t\t\tthis._dependents.splice(i, 1);\n43. \t\t\t\treturn;\n44. \t\t\t}\n45. \t\t}\n46. \t},\n47. \n48. \t_sortComputedProperties: function() {\n49. \t\tvar computed = this._computed;\n50. \t\tvar sorted = this._sortedComputedProperties = [];\n51. \t\tvar cycles;\n52. \t\tvar visited = blankObject();\n53. \n54. \t\tfunction visit(key) {\n55. \t\t\tif (cycles[key]) {\n56. \t\t\t\tthrow new Error(\'Cyclical dependency detected\');\n57. \t\t\t}\n58. \n59. \t\t\tif (visited[key]) return;\n60. \t\t\tvisited[key] = true;\n61. \n62. \t\t\tvar c = computed[key];\n63. \n64. \t\t\tif (c) {\n65. \t\t\t\tcycles[key] = true;\n66. \t\t\t\tc.deps.forEach(visit);\n67. \t\t\t\tsorted.push(c);\n68. \t\t\t}\n69. \t\t}\n70. \n71. \t\tfor (var key in this._computed) {\n72. \t\t\tcycles = blankObject();\n73. \t\t\tvisit(key);\n74. \t\t}\n75. \t},\n76. \n77. \tcompute: function(key, deps, fn) {\n78. \t\tvar store = this;\n79. \t\tvar value;\n80. \n81. \t\tvar c = {\n82. \t\t\tdeps: deps,\n83. \t\t\tupdate: function(state, changed, dirty) {\n84. \t\t\t\tvar values = deps.map(function(dep) {\n85. \t\t\t\t\tif (dep in changed) dirty = true;\n86. \t\t\t\t\treturn state[dep];\n87. \t\t\t\t});\n88. \n89. \t\t\t\tif (dirty) {\n90. \t\t\t\t\tvar newValue = fn.apply(null, values);\n91. \t\t\t\t\tif (differs(newValue, value)) {\n92. \t\t\t\t\t\tvalue = newValue;\n93. \t\t\t\t\t\tchanged[key] = true;\n94. \t\t\t\t\t\tstate[key] = value;\n95. \t\t\t\t\t}\n96. \t\t\t\t}\n97. \t\t\t}\n98. \t\t};\n99. \n100. \t\tc.update(this._state, {}, true);\n101. \n102. \t\tthis._computed[key] = c;\n103. \t\tthis._sortComputedProperties();\n104. \t},\n105. \n106. \tget: get,\n107. \n108. \tobserve: observe,\n109. \n110. \tonchange: function(callback) {\n111. \t\tthis._changeHandlers.push(callback);\n112. \t\treturn {\n113. \t\t\tcancel: function() {\n114. \t\t\t\tvar index = this._changeHandlers.indexOf(callback);\n115. \t\t\t\tif (~index) this._changeHandlers.splice(index, 1);\n116. \t\t\t}\n117. \t\t};\n118. \t},\n119. \n120. \tset: function(newState) {\n121. \t\tvar oldState = this._state,\n122. \t\t\tchanged = this._changed = {},\n123. \t\t\tdirty = false;\n124. \n125. \t\tfor (var key in newState) {\n126. \t\t\tif (this._computed[key]) throw new Error("\'" + key + "\' is a read-only property");\n127. \t\t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n128. \t\t}\n129. \t\tif (!dirty) return;\n130. \n131. \t\tthis._state = assign({}, oldState, newState);\n132. \n133. \t\tfor (var i = 0; i < this._sortedComputedProperties.length; i += 1) {\n134. \t\t\tthis._sortedComputedProperties[i].update(this._state, changed);\n135. \t\t}\n136. \n137. \t\tfor (var i = 0; i < this._changeHandlers.length; i += 1) {\n138. \t\t\tthis._changeHandlers[i](this._state, changed);\n139. \t\t}\n140. \n141. \t\tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n142. \n143. \t\tvar dependents = this._dependents.slice(); // guard against mutations\n144. \t\tfor (var i = 0; i < dependents.length; i += 1) {\n145. \t\t\tvar dependent = dependents[i];\n146. \t\t\tvar componentState = {};\n147. \t\t\tdirty = false;\n148. \n149. \t\t\tfor (var j = 0; j < dependent.props.length; j += 1) {\n150. \t\t\t\tvar prop = dependent.props[j];\n151. \t\t\t\tif (prop in changed) {\n152. \t\t\t\t\tcomponentState[\'$\' + prop] = this._state[prop];\n153. \t\t\t\t\tdirty = true;\n154. \t\t\t\t}\n155. \t\t\t}\n156. \n157. \t\t\tif (dirty) dependent.component.set(componentState);\n158. \t\t}\n159. \n160. \t\tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n161. \t}\n162. });\n163. \n164. export { Store };', 'start_line_number': 1, 'end_line_number': 164}, {'relative_path': 'test/server-side-rendering/index.js', 'content': '1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";\n12. \n13. function tryToReadFile(file) {\n14. \ttry {\n15. \t\treturn fs.readFileSync(file, "utf-8");\n16. \t} catch (err) {\n17. \t\tif (err.code !== "ENOENT") throw err;\n18. \t\treturn null;\n19. \t}\n20. }\n21. \n22. describe("ssr", () => {\n23. \tbefore(() => {\n24. \t\trequire("../../ssr/register")({\n25. \t\t\textensions: [\'.svelte\', \'.html\'],\n26. \t\t\tstore: true\n27. \t\t});\n28. \n29. \t\treturn setupHtmlEqual();\n30. \t});\n31. \n32. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n33. \t\tif (dir[0] === ".") return;\n34. \n35. \t\t// add .solo to a sample directory name to only run that test, or\n36. \t\t// .show to always show the output. or both\n37. \t\tconst solo = /\\.solo/.test(dir);\n38. \t\tconst show = /\\.show/.test(dir);\n39. \n40. \t\tif (solo && process.env.CI) {\n41. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n42. \t\t}\n43. \n44. \t\t(solo ? it.only : it)(dir, () => {\n45. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n46. \t\t\ttry {\n47. \t\t\t\tlet component;\n48. \n49. \t\t\t\tconst mainHtmlFile = `${dir}/main.html`;\n50. \t\t\t\tconst mainSvelteFile = `${dir}/main.svelte`;\n51. \t\t\t\tif (fs.existsSync(mainHtmlFile)) {\n52. \t\t\t\t\tcomponent = require(mainHtmlFile);\n53. \t\t\t\t} else if (fs.existsSync(mainSvelteFile)) {\n54. \t\t\t\t\tcomponent = require(mainSvelteFile);\n55. \t\t\t\t}\n56. \n57. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n58. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n59. \n60. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n61. \n62. \t\t\t\tconst rendered = component.render(data);\n63. \t\t\t\tconst { html, css, head } = rendered;\n64. \n65. \t\t\t\t// rendered.toString() === rendered.html\n66. \t\t\t\tassert.equal(rendered, html);\n67. \n68. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n69. \t\t\t\tif (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);\n70. \n71. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n72. \t\t\t\tassert.equal(\n73. \t\t\t\t\tcss.code.replace(/^\\s+/gm, ""),\n74. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n75. \t\t\t\t);\n76. \n77. \t\t\t\tif (fs.existsSync(`${dir}/_expected-head.html`)) {\n78. \t\t\t\t\tfs.writeFileSync(`${dir}/_actual-head.html`, head);\n79. \t\t\t\t\tassert.htmlEqual(\n80. \t\t\t\t\t\thead,\n81. \t\t\t\t\t\tfs.readFileSync(`${dir}/_expected-head.html`, \'utf-8\')\n82. \t\t\t\t\t);\n83. \t\t\t\t}\n84. \n85. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n86. \t\t\t} catch (err) {\n87. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n88. \t\t\t\tthrow err;\n89. \t\t\t}\n90. \t\t});\n91. \t});\n92. \n93. \t// duplicate client-side tests, as far as possible\n94. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n95. \t\tif (dir[0] === ".") return;\n96. \n97. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n98. \n99. \t\tif (config.solo && process.env.CI) {\n100. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n101. \t\t}\n102. \n103. \t\tif (config["skip-ssr"]) return;\n104. \n105. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n106. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n107. \n108. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n109. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n110. \t\t\t\tdelete require.cache[resolved];\n111. \t\t\t});\n112. \n113. \t\t\trequire("../../ssr/register")({\n114. \t\t\t\tstore: !!config.store\n115. \t\t\t});\n116. \n117. \t\t\ttry {\n118. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n119. \t\t\t\tconst { html } = component.render(config.data, {\n120. \t\t\t\t\tstore: (config.store !== true) && config.store\n121. \t\t\t\t});\n122. \n123. \t\t\t\tif (config.html) {\n124. \t\t\t\t\tassert.htmlEqual(html, config.html);\n125. \t\t\t\t}\n126. \t\t\t} catch (err) {\n127. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n128. \t\t\t\tthrow err;\n129. \t\t\t}\n130. \t\t});\n131. \t});\n132. });', 'start_line_number': 1, 'end_line_number': 132}]}]
2025-11-12 13:58:11,272 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 1 memories from memory
2025-11-12 13:58:11,272 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 8 contexts from memory
2025-11-12 13:58:11,272 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 8 contexts from memory
2025-11-12 13:58:11,274 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 8 new contexts to 0 existing contexts
2025-11-12 13:58:11,274 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 8 total contexts (removed 0 duplicates)
2025-11-12 13:58:11,276 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/generators/server-side-rendering/visit.ts, src/generators/wrapModule.ts, and src/generators/nodes/Component.ts.
Extra Requirements: If full files are too large, include at minimum the functions that emit SSR output for nested components, any code that passes options/store to child components, and the wrapper code that initializes a component’s store in render/_render.
Purpose: To trace how SSR emits nested component calls and how the store is propagated/initialized, so we can pinpoint the bug and propose a fix.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: src/generators/nodes/Component.ts
Line number range: 1 - 609
Content:
1. import deindent from '../../utils/deindent';
2. import { stringify } from '../../utils/stringify';
3. import stringifyProps from '../../utils/stringifyProps';
4. import CodeBuilder from '../../utils/CodeBuilder';
5. import getTailSnippet from '../../utils/getTailSnippet';
6. import getObject from '../../utils/getObject';
7. import getExpressionPrecedence from '../../utils/getExpressionPrecedence';
8. import Node from './shared/Node';
9. import Block from '../dom/Block';
10. import Attribute from './Attribute';
11. 
12. export default class Component extends Node {
13. 	type: 'Component';
14. 	name: string;
15. 	attributes: Attribute[];
16. 	children: Node[];
17. 
18. 	init(
19. 		block: Block,
20. 		stripWhitespace: boolean,
21. 		nextSibling: Node
22. 	) {
23. 		this.cannotUseInnerHTML();
24. 
25. 		this.attributes.forEach((attribute: Node) => {
26. 			if (attribute.type === 'Attribute' && attribute.value !== true) {
27. 				attribute.value.forEach((chunk: Node) => {
28. 					if (chunk.type !== 'Text') {
29. 						const dependencies = chunk.metadata.dependencies;
30. 						block.addDependencies(dependencies);
31. 					}
32. 				});
33. 			} else {
34. 				if (attribute.type === 'EventHandler' && attribute.expression) {
35. 					attribute.expression.arguments.forEach((arg: Node) => {
36. 						block.addDependencies(arg.metadata.dependencies);
37. 					});
38. 				} else if (attribute.type === 'Binding') {
39. 					block.addDependencies(attribute.metadata.dependencies);
40. 				}
41. 			}
42. 		});
43. 
44. 		this.var = block.getUniqueName(
45. 			(
46. 				this.name === ':Self' ? this.generator.name :
47. 				this.name === ':Component' ? 'switch_instance' :
48. 				this.name
49. 			).toLowerCase()
50. 		);
51. 
52. 		if (this.children.length) {
53. 			this._slots = new Set(['default']);
54. 
55. 			this.children.forEach(child => {
56. 				child.init(block, stripWhitespace, nextSibling);
57. 			});
58. 		}
59. 	}
60. 
61. 	build(
62. 		block: Block,
63. 		parentNode: string,
64. 		parentNodes: string
65. 	) {
66. 		const { generator } = this;
67. 		generator.hasComponents = true;
68. 
69. 		const name = this.var;
70. 
71. 		const componentInitProperties = [`root: #component.root`];
72. 
73. 		if (this.children.length > 0) {
74. 			const slots = Array.from(this._slots).map(name => `${name}: @createFragment()`);
75. 			componentInitProperties.push(`slots: { ${slots.join(', ')} }`);
76. 
77. 			this.children.forEach((child: Node) => {
78. 				child.build(block, `${this.var}._slotted.default`, 'nodes');
79. 			});
80. 		}
81. 
82. 		const allContexts = new Set();
83. 		const statements: string[] = [];
84. 		const name_context = block.getUniqueName(`${name}_context`);
85. 
86. 		let name_updating: string;
87. 		let name_initial_data: string;
88. 		let beforecreate: string = null;
89. 
90. 		const attributes = this.attributes
91. 			.filter(a => a.type === 'Attribute')
92. 			.map(a => mungeAttribute(a, block));
93. 
94. 		const bindings = this.attributes
95. 			.filter(a => a.type === 'Binding')
96. 			.map(a => mungeBinding(a, block));
97. 
98. 		const eventHandlers = this.attributes
99. 			.filter((a: Node) => a.type === 'EventHandler')
100. 			.map(a => mungeEventHandler(generator, this, a, block, name_context, allContexts));
101. 
102. 		const ref = this.attributes.find((a: Node) => a.type === 'Ref');
103. 		if (ref) generator.usesRefs = true;
104. 
105. 		const updates: string[] = [];
106. 
107. 		if (attributes.length || bindings.length) {
108. 			const initialProps = attributes
109. 				.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);
110. 
111. 			const initialPropString = stringifyProps(initialProps);
112. 
113. 			attributes
114. 				.filter((attribute: Attribute) => attribute.dynamic)
115. 				.forEach((attribute: Attribute) => {
116. 					if (attribute.dependencies.length) {
117. 						updates.push(deindent`
118. 							if (${attribute.dependencies
119. 								.map(dependency => `changed.${dependency}`)
120. 								.join(' || ')}) ${name}_changes.${attribute.name} = ${attribute.value};
121. 						`);
122. 					}
123. 
124. 					else {
125. 						// TODO this is an odd situation to encounter – I *think* it should only happen with
126. 						// each block indices, in which case it may be possible to optimise this
127. 						updates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);
128. 					}
129. 				});
130. 
131. 			if (bindings.length) {
132. 				generator.hasComplexBindings = true;
133. 
134. 				name_updating = block.alias(`${name}_updating`);
135. 				name_initial_data = block.getUniqueName(`${name}_initial_data`);
136. 
137. 				block.addVariable(name_updating, '{}');
138. 				statements.push(`var ${name_initial_data} = ${initialPropString};`);
139. 
140. 				const setParentFromChildOnChange = new CodeBuilder();
141. 				const setParentFromChildOnInit = new CodeBuilder();
142. 
143. 				bindings.forEach((binding: Binding) => {
144. 					let setParentFromChild;
145. 
146. 					binding.contexts.forEach(context => {
147. 						allContexts.add(context);
148. 					});
149. 
150. 					const { name: key } = getObject(binding.value);
151. 
152. 					if (block.contexts.has(key)) {
153. 						const prop = binding.dependencies[0];
154. 						const computed = isComputed(binding.value);
155. 						const tail = binding.value.type === 'MemberExpression' ? getTailSnippet(binding.value) : '';
156. 
157. 						setParentFromChild = deindent`
158. 							var list = ${name_context}.${block.listNames.get(key)};
159. 							var index = ${name_context}.${block.indexNames.get(key)};
160. 							list[index]${tail} = childState.${binding.name};
161. 
162. 							${binding.dependencies
163. 								.map((prop: string) => `newState.${prop} = state.${prop};`)
164. 								.join('\n')}
165. 						`;
166. 					}
167. 
168. 					else if (binding.value.type === 'MemberExpression') {
169. 						setParentFromChild = deindent`
170. 							${binding.snippet} = childState.${binding.name};
171. 							${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join('\n')}
172. 						`;
173. 					}
174. 
175. 					else {
176. 						setParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;
177. 					}
178. 
179. 					statements.push(deindent`
180. 						if (${binding.prop} in ${binding.obj}) {
181. 							${name_initial_data}.${binding.name} = ${binding.snippet};
182. 							${name_updating}.${binding.name} = true;
183. 						}`
184. 					);
185. 
186. 					setParentFromChildOnChange.addConditional(
187. 						`!${name_updating}.${binding.name} && changed.${binding.name}`,
188. 						setParentFromChild
189. 					);
190. 
191. 					setParentFromChildOnInit.addConditional(
192. 						`!${name_updating}.${binding.name}`,
193. 						setParentFromChild
194. 					);
195. 
196. 					// TODO could binding.dependencies.length ever be 0?
197. 					if (binding.dependencies.length) {
198. 						updates.push(deindent`
199. 							if (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(' || ')}) {
200. 								${name}_changes.${binding.name} = ${binding.snippet};
201. 								${name_updating}.${binding.name} = true;
202. 							}
203. 						`);
204. 					}
205. 				});
206. 
207. 				componentInitProperties.push(`data: ${name_initial_data}`);
208. 
209. 				componentInitProperties.push(deindent`
210. 					_bind: function(changed, childState) {
211. 						var state = #component.get(), newState = {};
212. 						${setParentFromChildOnChange}
213. 						${name_updating} = @assign({}, changed);
214. 						#component._set(newState);
215. 						${name_updating} = {};
216. 					}
217. 				`);
218. 
219. 				beforecreate = deindent`
220. 					#component.root._beforecreate.push(function() {
221. 						var state = #component.get(), childState = ${name}.get(), newState = {};
222. 						if (!childState) return;
223. 						${setParentFromChildOnInit}
224. 						${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(', ')} };
225. 						#component._set(newState);
226. 						${name_updating} = {};
227. 					});
228. 				`;
229. 			} else if (initialProps.length) {
230. 				componentInitProperties.push(`data: ${initialPropString}`);
231. 			}
232. 		}
233. 
234. 		const isDynamicComponent = this.name === ':Component';
235. 
236. 		const switch_vars = isDynamicComponent && {
237. 			value: block.getUniqueName('switch_value'),
238. 			props: block.getUniqueName('switch_props')
239. 		};
240. 
241. 		const expression = (
242. 			this.name === ':Self' ? generator.name :
243. 			isDynamicComponent ? switch_vars.value :
244. 			`%components-${this.name}`
245. 		);
246. 
247. 		if (isDynamicComponent) {
248. 			block.contextualise(this.expression);
249. 			const { dependencies, snippet } = this.metadata;
250. 
251. 			const anchor = this.getOrCreateAnchor(block, parentNode, parentNodes);
252. 
253. 			const params = block.params.join(', ');
254. 
255. 			block.builders.init.addBlock(deindent`
256. 				var ${switch_vars.value} = ${snippet};
257. 
258. 				function ${switch_vars.props}(${params}) {
259. 					${statements.length > 0 && statements.join('\n')}
260. 					return {
261. 						${componentInitProperties.join(',\n')}
262. 					};
263. 				}
264. 
265. 				if (${switch_vars.value}) {
266. 					var ${name} = new ${expression}(${switch_vars.props}(${params}));
267. 
268. 					${beforecreate}
269. 				}
270. 
271. 				${eventHandlers.map(handler => deindent`
272. 					function ${handler.var}(event) {
273. 						${handler.body}
274. 					}
275. 
276. 					if (${name}) ${name}.on("${handler.name}", ${handler.var});
277. 				`)}
278. 			`);
279. 
280. 			block.builders.create.addLine(
281. 				`if (${name}) ${name}._fragment.c();`
282. 			);
283. 
284. 			if (parentNodes) {
285. 				block.builders.claim.addLine(
286. 					`if (${name}) ${name}._fragment.l(${parentNodes});`
287. 				);
288. 			}
289. 
290. 			block.builders.mount.addLine(
291. 				`if (${name}) ${name}._mount(${parentNode || '#target'}, ${parentNode ? 'null' : 'anchor'});`
292. 			);
293. 
294. 			const updateMountNode = this.getUpdateMountNode(anchor);
295. 
296. 			block.builders.update.addBlock(deindent`
297. 				if (${switch_vars.value} !== (${switch_vars.value} = ${snippet})) {
298. 					if (${name}) ${name}.destroy();
299. 
300. 					if (${switch_vars.value}) {
301. 						${name} = new ${switch_vars.value}(${switch_vars.props}(${params}));
302. 						${name}._fragment.c();
303. 
304. 						${this.children.map(child => remount(generator, child, name))}
305. 						${name}._mount(${updateMountNode}, ${anchor});
306. 
307. 						${eventHandlers.map(handler => deindent`
308. 							${name}.on("${handler.name}", ${handler.var});
309. 						`)}
310. 
311. 						${ref && `#component.refs.${ref.name} = ${name};`}
312. 					}
313. 
314. 					${ref && deindent`
315. 						else if (#component.refs.${ref.name} === ${name}) {
316. 							#component.refs.${ref.name} = null;
317. 						}`}
318. 				}
319. 			`);
320. 
321. 			if (updates.length) {
322. 				block.builders.update.addBlock(deindent`
323. 					else {
324. 						var ${name}_changes = {};
325. 						${updates.join('\n')}
326. 						${name}._set(${name}_changes);
327. 						${bindings.length && `${name_updating} = {};`}
328. 					}
329. 				`);
330. 			}
331. 
332. 			if (!parentNode) block.builders.unmount.addLine(`if (${name}) ${name}._unmount();`);
333. 
334. 			block.builders.destroy.addLine(`if (${name}) ${name}.destroy(false);`);
335. 		} else {
336. 			block.builders.init.addBlock(deindent`
337. 				${statements.join('\n')}
338. 				var ${name} = new ${expression}({
339. 					${componentInitProperties.join(',\n')}
340. 				});
341. 
342. 				${beforecreate}
343. 
344. 				${eventHandlers.map(handler => deindent`
345. 					${name}.on("${handler.name}", function(event) {
346. 						${handler.body}
347. 					});
348. 				`)}
349. 
350. 				${ref && `#component.refs.${ref.name} = ${name};`}
351. 			`);
352. 
353. 			block.builders.create.addLine(`${name}._fragment.c();`);
354. 
355. 			if (parentNodes) {
356. 				block.builders.claim.addLine(
357. 					`${name}._fragment.l(${parentNodes});`
358. 				);
359. 			}
360. 
361. 			block.builders.mount.addLine(
362. 				`${name}._mount(${parentNode || '#target'}, ${parentNode ? 'null' : 'anchor'});`
363. 			);
364. 
365. 			if (updates.length) {
366. 				block.builders.update.addBlock(deindent`
367. 					var ${name}_changes = {};
368. 					${updates.join('\n')}
369. 					${name}._set(${name}_changes);
370. 					${bindings.length && `${name_updating} = {};`}
371. 				`);
372. 			}
373. 
374. 			if (!parentNode) block.builders.unmount.addLine(`${name}._unmount();`);
375. 
376. 			block.builders.destroy.addLine(deindent`
377. 				${name}.destroy(false);
378. 				${ref && `if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;`}
379. 			`);
380. 		}
381. 
382. 		// maintain component context
383. 		if (allContexts.size) {
384. 			const contexts = Array.from(allContexts);
385. 
386. 			const initialProps = contexts
387. 				.map(contextName => {
388. 					if (contextName === 'state') return `state: state`;
389. 
390. 					const listName = block.listNames.get(contextName);
391. 					const indexName = block.indexNames.get(contextName);
392. 
393. 					return `${listName}: ${listName},\n${indexName}: ${indexName}`;
394. 				})
395. 				.join(',\n');
396. 
397. 			const updates = contexts
398. 				.map(contextName => {
399. 					if (contextName === 'state') return `${name_context}.state = state;`;
400. 
401. 					const listName = block.listNames.get(contextName);
402. 					const indexName = block.indexNames.get(contextName);
403. 
404. 					return `${name_context}.${listName} = ${listName};\n${name_context}.${indexName} = ${indexName};`;
405. 				})
406. 				.join('\n');
407. 
408. 			block.builders.init.addBlock(deindent`
409. 				var ${name_context} = {
410. 					${initialProps}
411. 				};
412. 			`);
413. 
414. 			block.builders.update.addBlock(updates);
415. 		}
416. 	}
417. }
418. 
419. function mungeAttribute(attribute: Node, block: Block): Attribute {
420. 	if (attribute.value === true) {
421. 		// attributes without values, e.g. <textarea readonly>
422. 		return {
423. 			name: attribute.name,
424. 			value: true,
425. 			dynamic: false
426. 		};
427. 	}
428. 
429. 	if (attribute.value.length === 0) {
430. 		return {
431. 			name: attribute.name,
432. 			value: `''`,
433. 			dynamic: false
434. 		};
435. 	}
436. 
437. 	if (attribute.value.length === 1) {
438. 		const value = attribute.value[0];
439. 
440. 		if (value.type === 'Text') {
441. 			// static attributes
442. 			return {
443. 				name: attribute.name,
444. 				value: isNaN(value.data) ? stringify(value.data) : value.data,
445. 				dynamic: false
446. 			};
447. 		}
448. 
449. 		// simple dynamic attributes
450. 		block.contextualise(value.expression); // TODO remove
451. 		const { dependencies, snippet } = value.metadata;
452. 
453. 		// TODO only update attributes that have changed
454. 		return {
455. 			name: attribute.name,
456. 			value: snippet,
457. 			dependencies,
458. 			dynamic: true
459. 		};
460. 	}
461. 
462. 	// otherwise we're dealing with a complex dynamic attribute
463. 	const allDependencies = new Set();
464. 
465. 	const value =
466. 		(attribute.value[0].type === 'Text' ? '' : `"" + `) +
467. 		attribute.value
468. 			.map((chunk: Node) => {
469. 				if (chunk.type === 'Text') {
470. 					return stringify(chunk.data);
471. 				} else {
472. 					block.contextualise(chunk.expression); // TODO remove
473. 					const { dependencies, snippet } = chunk.metadata;
474. 
475. 					dependencies.forEach((dependency: string) => {
476. 						allDependencies.add(dependency);
477. 					});
478. 
479. 					return getExpressionPrecedence(chunk.expression) <= 13 ? `(${snippet})` : snippet;
480. 				}
481. 			})
482. 			.join(' + ');
483. 
484. 	return {
485. 		name: attribute.name,
486. 		value,
487. 		dependencies: Array.from(allDependencies),
488. 		dynamic: true
489. 	};
490. }
491. 
492. function mungeBinding(binding: Node, block: Block): Binding {
493. 	const { name } = getObject(binding.value);
494. 	const { contexts } = block.contextualise(binding.value);
495. 	const { dependencies, snippet } = binding.metadata;
496. 
497. 	const contextual = block.contexts.has(name);
498. 
499. 	let obj;
500. 	let prop;
501. 
502. 	if (contextual) {
503. 		obj = block.listNames.get(name);
504. 		prop = block.indexNames.get(name);
505. 	} else if (binding.value.type === 'MemberExpression') {
506. 		prop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;
507. 		if (!binding.value.computed) prop = `'${prop}'`;
508. 		obj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;
509. 	} else {
510. 		obj = 'state';
511. 		prop = `'${name}'`;
512. 	}
513. 
514. 	return {
515. 		name: binding.name,
516. 		value: binding.value,
517. 		contexts,
518. 		snippet,
519. 		obj,
520. 		prop,
521. 		dependencies
522. 	};
523. }
524. 
525. function mungeEventHandler(generator: DomGenerator, node: Node, handler: Node, block: Block, name_context: string, allContexts: Set<string>) {
526. 	let body;
527. 
528. 	if (handler.expression) {
529. 		generator.addSourcemapLocations(handler.expression);
530. 		generator.code.prependRight(
531. 			handler.expression.start,
532. 			`${block.alias('component')}.`
533. 		);
534. 
535. 		const usedContexts: string[] = [];
536. 
537. 		handler.expression.arguments.forEach((arg: Node) => {
538. 			const { contexts } = block.contextualise(arg, null, true);
539. 
540. 			contexts.forEach(context => {
541. 				if (!~usedContexts.indexOf(context)) usedContexts.push(context);
542. 				allContexts.add(context);
543. 			});
544. 		});
545. 
546. 		// TODO hoist event handlers? can do `this.__component.method(...)`
547. 		const declarations = usedContexts.map(name => {
548. 			if (name === 'state') return `var state = ${name_context}.state;`;
549. 
550. 			const listName = block.listNames.get(name);
551. 			const indexName = block.indexNames.get(name);
552. 
553. 			return `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;
554. 		});
555. 
556. 		body = deindent`
557. 			${declarations}
558. 
559. 			[✂${handler.expression.start}-${handler.expression.end}✂];
560. 		`;
561. 	} else {
562. 		body = deindent`
563. 			${block.alias('component')}.fire('${handler.name}', event);
564. 		`;
565. 	}
566. 
567. 	return {
568. 		name: handler.name,
569. 		var: block.getUniqueName(`${node.var}_${handler.name}`),
570. 		body
571. 	};
572. }
573. 
574. function isComputed(node: Node) {
575. 	while (node.type === 'MemberExpression') {
576. 		if (node.computed) return true;
577. 		node = node.object;
578. 	}
579. 
580. 	return false;
581. }
582. 
583. function remount(generator: DomGenerator, node: Node, name: string) {
584. 	// TODO make this a method of the nodes
585. 
586. 	if (node.type === 'Component') {
587. 		return `${node.var}._mount(${name}._slotted.default, null);`;
588. 	}
589. 
590. 	if (node.type === 'Element') {
591. 		const slot = node.attributes.find(attribute => attribute.name === 'slot');
592. 		if (slot) {
593. 			return `@appendNode(${node.var}, ${name}._slotted.${node.getStaticAttributeValue('slot')});`;
594. 		}
595. 
596. 		return `@appendNode(${node.var}, ${name}._slotted.default);`;
597. 	}
598. 
599. 	if (node.type === 'Text' || node.type === 'MustacheTag' || node.type === 'RawMustacheTag') {
600. 		return `@appendNode(${node.var}, ${name}._slotted.default);`;
601. 	}
602. 
603. 	if (node.type === 'EachBlock') {
604. 		// TODO consider keyed blocks
605. 		return `for (var #i = 0; #i < ${node.iterations}.length; #i += 1) ${node.iterations}[#i].m(${name}._slotted.default, null);`;
606. 	}
607. 
608. 	return `${node.var}.m(${name}._slotted.default, null);`;
609. }


File: src/generators/server-side-rendering/Block.ts
Line number range: 1 - 49
Content:
1. import deindent from '../../utils/deindent';
2. import flattenReference from '../../utils/flattenReference';
3. import { SsrGenerator } from './index';
4. import { Node } from '../../interfaces';
5. import getObject from '../../utils/getObject';
6. 
7. interface BlockOptions {
8. 	// TODO
9. }
10. 
11. export default class Block {
12. 	generator: SsrGenerator;
13. 	conditions: string[];
14. 
15. 	contexts: Map<string, string>;
16. 	indexes: Map<string, string>;
17. 	contextDependencies: Map<string, string[]>;
18. 
19. 	constructor(options: BlockOptions) {
20. 		Object.assign(this, options);
21. 	}
22. 
23. 	addBinding(binding: Node, name: string) {
24. 		const conditions = [`!('${binding.name}' in state)`].concat(
25. 			// TODO handle contextual bindings...
26. 			this.conditions.map(c => `(${c})`)
27. 		);
28. 
29. 		const { name: prop } = getObject(binding.value);
30. 
31. 		this.generator.bindings.push(deindent`
32. 			if (${conditions.join('&&')}) {
33. 				tmp = ${name}.data();
34. 				if ('${prop}' in tmp) {
35. 					state.${binding.name} = tmp.${prop};
36. 					settled = false;
37. 				}
38. 			}
39. 		`);
40. 	}
41. 
42. 	child(options: BlockOptions) {
43. 		return new Block(Object.assign({}, this, options, { parent: this }));
44. 	}
45. 
46. 	contextualise(expression: Node, context?: string, isEventHandler?: boolean) {
47. 		return this.generator.contextualise(this.contexts, this.indexes, expression, context, isEventHandler);
48. 	}
49. }


File: src/generators/server-side-rendering/index.ts
Line number range: 1 - 268
Content:
1. import deindent from '../../utils/deindent';
2. import Generator from '../Generator';
3. import Stylesheet from '../../css/Stylesheet';
4. import Block from './Block';
5. import visit from './visit';
6. import { removeNode, removeObjectKey } from '../../utils/removeNode';
7. import getName from '../../utils/getName';
8. import globalWhitelist from '../../utils/globalWhitelist';
9. import { Parsed, Node, CompileOptions } from '../../interfaces';
10. import { AppendTarget } from './interfaces';
11. import { stringify } from '../../utils/stringify';
12. 
13. export class SsrGenerator extends Generator {
14. 	bindings: string[];
15. 	renderCode: string;
16. 	appendTargets: AppendTarget[];
17. 
18. 	constructor(
19. 		parsed: Parsed,
20. 		source: string,
21. 		name: string,
22. 		stylesheet: Stylesheet,
23. 		options: CompileOptions
24. 	) {
25. 		super(parsed, source, name, stylesheet, options, false);
26. 		this.bindings = [];
27. 		this.renderCode = '';
28. 		this.appendTargets = [];
29. 
30. 		this.stylesheet.warnOnUnusedSelectors(options.onwarn);
31. 	}
32. 
33. 	append(code: string) {
34. 		if (this.appendTargets.length) {
35. 			const appendTarget = this.appendTargets[this.appendTargets.length - 1];
36. 			const slotName = appendTarget.slotStack[appendTarget.slotStack.length - 1];
37. 			appendTarget.slots[slotName] += code;
38. 		} else {
39. 			this.renderCode += code;
40. 		}
41. 	}
42. }
43. 
44. export default function ssr(
45. 	parsed: Parsed,
46. 	source: string,
47. 	stylesheet: Stylesheet,
48. 	options: CompileOptions
49. ) {
50. 	const format = options.format || 'cjs';
51. 
52. 	const generator = new SsrGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
53. 
54. 	const { computations, name, templateProperties } = generator;
55. 
56. 	// create main render() function
57. 	const mainBlock = new Block({
58. 		generator,
59. 		contexts: new Map(),
60. 		indexes: new Map(),
61. 		conditions: [],
62. 	});
63. 
64. 	trim(parsed.html.children).forEach((node: Node) => {
65. 		visit(generator, mainBlock, node);
66. 	});
67. 
68. 	const { css, cssMap } = generator.customElement ?
69. 		{ css: null, cssMap: null } :
70. 		generator.stylesheet.render(options.filename, true);
71. 
72. 	// generate initial state object
73. 	const expectedProperties = Array.from(generator.expectedProperties);
74. 	const globals = expectedProperties.filter(prop => globalWhitelist.has(prop));
75. 	const storeProps = options.store || templateProperties.store ? expectedProperties.filter(prop => prop[0] === '$') : [];
76. 
77. 	const initialState = [];
78. 	if (globals.length > 0) {
79. 		initialState.push(`{ ${globals.map(prop => `${prop} : ${prop}`).join(', ')} }`);
80. 	}
81. 
82. 	if (storeProps.length > 0) {
83. 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
84. 		if (options.store || templateProperties.store) {
85. 			initialState.push(`options.store.${initialize}`);
86. 		}
87. 	}
88. 
89. 	if (templateProperties.data) {
90. 		initialState.push(`%data()`);
91. 	} else if (globals.length === 0 && storeProps.length === 0) {
92. 		initialState.push('{}');
93. 	}
94. 
95. 	initialState.push('state');
96. 
97. 	// TODO concatenate CSS maps
98. 	const result = deindent`
99. 		${generator.javascript}
100. 
101. 		var ${name} = {};
102. 
103. 		${options.filename && `${name}.filename = ${stringify(options.filename)}`};
104. 
105. 		${name}.data = function() {
106. 			return ${templateProperties.data ? `%data()` : `{}`};
107. 		};
108. 
109. 		${name}.render = function(state, options = {}) {
110. 			var components = new Set();
111. 
112. 			function addComponent(component) {
113. 				components.add(component);
114. 			}
115. 
116. 			var result = { head: '', addComponent };
117. 			${templateProperties.store && `options.store = %store();`}
118. 			var html = ${name}._render(result, state, options);
119. 
120. 			var cssCode = Array.from(components).map(c => c.css && c.css.code).filter(Boolean).join('\\n');
121. 
122. 			return {
123. 				html,
124. 				head: result.head,
125. 				css: { code: cssCode, map: null },
126. 				toString() {
127. 					return html;
128. 				}
129. 			};
130. 		}
131. 
132. 		${name}._render = function(__result, state, options) {
133. 			__result.addComponent(${name});
134. 
135. 			state = Object.assign(${initialState.join(', ')});
136. 
137. 			${computations.map(
138. 				({ key, deps }) =>
139. 					`state.${key} = %computed-${key}(${deps.map(dep => `state.${dep}`).join(', ')});`
140. 			)}
141. 
142. 			${generator.bindings.length &&
143. 				deindent`
144. 				var settled = false;
145. 				var tmp;
146. 
147. 				while (!settled) {
148. 					settled = true;
149. 
150. 					${generator.bindings.join('\n\n')}
151. 				}
152. 			`}
153. 
154. 			return \`${generator.renderCode}\`;
155. 		};
156. 
157. 		${name}.css = {
158. 			code: ${css ? stringify(css) : `''`},
159. 			map: ${cssMap ? stringify(cssMap.toString()) : 'null'}
160. 		};
161. 
162. 		var warned = false;
163. 		${name}.renderCss = function() {
164. 			if (!warned) {
165. 				console.error('Component.renderCss(...) is deprecated and will be removed in v2 — use Component.render(...).css instead');
166. 				warned = true;
167. 			}
168. 
169. 			var components = [];
170. 
171. 			${generator.stylesheet.hasStyles &&
172. 				deindent`
173. 				components.push({
174. 					filename: ${name}.filename,
175. 					css: ${name}.css && ${name}.css.code,
176. 					map: ${name}.css && ${name}.css.map
177. 				});
178. 			`}
179. 
180. 			${templateProperties.components &&
181. 				deindent`
182. 				var seen = {};
183. 
184. 				function addComponent(component) {
185. 					var result = component.renderCss();
186. 					result.components.forEach(x => {
187. 						if (seen[x.filename]) return;
188. 						seen[x.filename] = true;
189. 						components.push(x);
190. 					});
191. 				}
192. 
193. 				${templateProperties.components.value.properties.map((prop: Node) => {
194. 					return `addComponent(%components-${getName(prop.key)});`;
195. 				})}
196. 			`}
197. 
198. 			return {
199. 				css: components.map(x => x.css).join('\\n'),
200. 				map: null,
201. 				components
202. 			};
203. 		};
204. 
205. 		${templateProperties.preload && `${name}.preload = %preload;`}
206. 
207. 		${
208. 			// TODO this is a bit hacky
209. 			/__escape/.test(generator.renderCode) && deindent`
210. 				var escaped = {
211. 					'"': '&quot;',
212. 					"'": '&##39;',
213. 					'&': '&amp;',
214. 					'<': '&lt;',
215. 					'>': '&gt;'
216. 				};
217. 
218. 				function __escape(html) {
219. 					return String(html).replace(/["'&<>]/g, match => escaped[match]);
220. 				}
221. 			`
222. 		}
223. 
224. 		${
225. 			/__isPromise/.test(generator.renderCode) && deindent`
226. 				function __isPromise(value) {
227. 					return value && typeof value.then === 'function';
228. 				}
229. 			`
230. 		}
231. 
232. 		${
233. 			/__missingComponent/.test(generator.renderCode) && deindent`
234. 				var __missingComponent = {
235. 					_render: () => ''
236. 				};
237. 			`
238. 		}
239. 	`.replace(/(@+|#+|%+)(\w*(?:-\w*)?)/g, (match: string, sigil: string, name: string) => {
240. 		if (sigil === '@') return generator.alias(name);
241. 		if (sigil === '%') return generator.templateVars.get(name);
242. 		return sigil.slice(1) + name;
243. 	});
244. 
245. 	return generator.generate(result, options, { name, format });
246. }
247. 
248. function trim(nodes) {
249. 	let start = 0;
250. 	for (; start < nodes.length; start += 1) {
251. 		const node = nodes[start];
252. 		if (node.type !== 'Text') break;
253. 
254. 		node.data = node.data.replace(/^\s+/, '');
255. 		if (node.data) break;
256. 	}
257. 
258. 	let end = nodes.length;
259. 	for (; end > start; end -= 1) {
260. 		const node = nodes[end - 1];
261. 		if (node.type !== 'Text') break;
262. 
263. 		node.data = node.data.replace(/\s+$/, '');
264. 		if (node.data) break;
265. 	}
266. 
267. 	return nodes.slice(start, end);
268. }


File: src/generators/server-side-rendering/visitors/Component.ts
Line number range: 1 - 121
Content:
1. import flattenReference from '../../../utils/flattenReference';
2. import visit from '../visit';
3. import { SsrGenerator } from '../index';
4. import Block from '../Block';
5. import { AppendTarget } from '../interfaces';
6. import { Node } from '../../../interfaces';
7. import getObject from '../../../utils/getObject';
8. import getTailSnippet from '../../../utils/getTailSnippet';
9. import { stringify } from '../../../utils/stringify';
10. 
11. export default function visitComponent(
12. 	generator: SsrGenerator,
13. 	block: Block,
14. 	node: Node
15. ) {
16. 	function stringifyAttribute(chunk: Node) {
17. 		if (chunk.type === 'Text') return chunk.data;
18. 		if (chunk.type === 'MustacheTag') {
19. 			block.contextualise(chunk.expression);
20. 			const { snippet } = chunk.metadata;
21. 			return '${__escape( ' + snippet + ')}';
22. 		}
23. 	}
24. 
25. 	const attributes: Node[] = [];
26. 	const bindings: Node[] = [];
27. 
28. 	node.attributes.forEach((attribute: Node) => {
29. 		if (attribute.type === 'Attribute') {
30. 			attributes.push(attribute);
31. 		} else if (attribute.type === 'Binding') {
32. 			bindings.push(attribute);
33. 		}
34. 	});
35. 
36. 	const props = attributes
37. 		.map(attribute => {
38. 			let value;
39. 
40. 			if (attribute.value === true) {
41. 				value = `true`;
42. 			} else if (attribute.value.length === 0) {
43. 				value = `''`;
44. 			} else if (attribute.value.length === 1) {
45. 				const chunk = attribute.value[0];
46. 				if (chunk.type === 'Text') {
47. 					value = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;
48. 				} else {
49. 					block.contextualise(chunk.expression);
50. 					const { snippet } = chunk.metadata;
51. 					value = snippet;
52. 				}
53. 			} else {
54. 				value = '`' + attribute.value.map(stringifyAttribute).join('') + '`';
55. 			}
56. 
57. 			return `${attribute.name}: ${value}`;
58. 		})
59. 		.concat(
60. 			bindings.map(binding => {
61. 				const { name } = getObject(binding.value);
62. 				const tail = binding.value.type === 'MemberExpression'
63. 					? getTailSnippet(binding.value)
64. 					: '';
65. 
66. 				const keypath = block.contexts.has(name)
67. 					? `${name}${tail}`
68. 					: `state.${name}${tail}`;
69. 				return `${binding.name}: ${keypath}`;
70. 			})
71. 		)
72. 		.join(', ');
73. 
74. 	const isDynamicComponent = node.name === ':Component';
75. 	if (isDynamicComponent) block.contextualise(node.expression);
76. 
77. 	const expression = (
78. 		node.name === ':Self' ? generator.name :
79. 		isDynamicComponent ? `((${node.metadata.snippet}) || __missingComponent)` :
80. 		`%components-${node.name}`
81. 	);
82. 
83. 	bindings.forEach(binding => {
84. 		block.addBinding(binding, expression);
85. 	});
86. 
87. 	let open = `\${${expression}._render(__result, {${props}}`;
88. 
89. 	const options = [];
90. 	if (generator.options.store) {
91. 		options.push(`store: options.store`);
92. 	}
93. 
94. 	if (node.children.length) {
95. 		const appendTarget: AppendTarget = {
96. 			slots: { default: '' },
97. 			slotStack: ['default']
98. 		};
99. 
100. 		generator.appendTargets.push(appendTarget);
101. 
102. 		node.children.forEach((child: Node) => {
103. 			visit(generator, block, child);
104. 		});
105. 
106. 		const slotted = Object.keys(appendTarget.slots)
107. 			.map(name => `${name}: () => \`${appendTarget.slots[name]}\``)
108. 			.join(', ');
109. 
110. 		options.push(`slotted: { ${slotted} }`);
111. 
112. 		generator.appendTargets.pop();
113. 	}
114. 
115. 	if (options.length) {
116. 		open += `, { ${options.join(', ')} }`;
117. 	}
118. 
119. 	generator.append(open);
120. 	generator.append(')}');
121. }


File: src/interfaces.ts
Line number range: 1 - 92
Content:
1. import {SourceMap} from 'magic-string';
2. 
3. export interface Node {
4. 	start: number;
5. 	end: number;
6. 	type: string;
7. 	[propName: string]: any;
8. }
9. 
10. export interface Parser {
11. 	readonly template: string;
12. 	readonly filename?: string;
13. 
14. 	index: number;
15. 	stack: Array<Node>;
16. 
17. 	html: Node;
18. 	css: Node;
19. 	js: Node;
20. 	metaTags: {};
21. }
22. 
23. export interface Parsed {
24. 	hash: number;
25. 	html: Node;
26. 	css: Node;
27. 	js: Node;
28. }
29. 
30. export interface Warning {
31. 	loc?: { line: number; column: number; pos?: number };
32. 	pos?: number;
33. 	message: string;
34. 	filename?: string;
35. 	frame?: string;
36. 	toString: () => string;
37. }
38. 
39. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';
40. 
41. export interface CompileOptions {
42. 	format?: ModuleFormat;
43. 	name?: string;
44. 	filename?: string;
45. 	generate?: string;
46. 	globals?: ((id: string) => string) | object;
47. 	amd?: {
48. 		id?: string;
49. 	};
50. 
51. 	outputFilename?: string;
52. 	cssOutputFilename?: string;
53. 
54. 	dev?: boolean;
55. 	shared?: boolean | string;
56. 	cascade?: boolean;
57. 	hydratable?: boolean;
58. 	legacy?: boolean;
59. 	customElement?: CustomElementOptions | true;
60. 	css?: boolean;
61. 	store?: boolean;
62. 
63. 	onerror?: (error: Error) => void;
64. 	onwarn?: (warning: Warning) => void;
65. }
66. 
67. export interface GenerateOptions {
68. 	name: string;
69. 	format: ModuleFormat;
70. 	banner?: string;
71. 	sharedPath?: string;
72. 	helpers?: { name: string, alias: string }[];
73. }
74. 
75. export interface Visitor {
76. 	enter: (node: Node) => void;
77. 	leave?: (node: Node) => void;
78. }
79. 
80. export interface CustomElementOptions {
81. 	tag?: string;
82. 	props?: string[];
83. }
84. 
85. export interface PreprocessOptions {
86. 	markup?: (options: {content: string, filename: string}) => { code: string, map?: SourceMap | string };
87. 	style?: Preprocessor;
88. 	script?: Preprocessor;
89. 	filename?: string
90. }
91. 
92. export type Preprocessor = (options: {content: string, attributes: Record<string, string | boolean>, filename?: string}) => { code: string, map?: SourceMap | string };


File: src/server-side-rendering/register.js
Line number range: 1 - 46
Content:
1. import * as fs from 'fs';
2. import * as path from 'path';
3. import { compile } from '../index.ts';
4. 
5. const compileOptions = {};
6. 
7. function capitalise(name) {
8. 	return name[0].toUpperCase() + name.slice(1);
9. }
10. 
11. export default function register(options) {
12. 	const { extensions } = options;
13. 
14. 	if (extensions) {
15. 		_deregister('.html');
16. 		extensions.forEach(_register);
17. 	}
18. 
19. 	// TODO make this the default and remove in v2
20. 	if ('store' in options) compileOptions.store = options.store;
21. }
22. 
23. function _deregister(extension) {
24. 	delete require.extensions[extension];
25. }
26. 
27. function _register(extension) {
28. 	require.extensions[extension] = function(module, filename) {
29. 		const name = path.basename(filename)
30. 			.slice(0, -path.extname(filename).length)
31. 			.replace(/^\d/, '_$&')
32. 			.replace(/[^a-zA-Z0-9_$]/g, '');
33. 
34. 		const options = Object.assign({}, compileOptions, {
35. 			filename,
36. 			name: capitalise(name),
37. 			generate: 'ssr'
38. 		});
39. 
40. 		const {code} = compile(fs.readFileSync(filename, 'utf-8'), options);
41. 
42. 		return module._compile(code, filename);
43. 	};
44. }
45. 
46. _register('.html');


File: store.js
Line number range: 1 - 164
Content:
1. import {
2. 	assign,
3. 	blankObject,
4. 	differs,
5. 	dispatchObservers,
6. 	get,
7. 	observe
8. } from './shared.js';
9. 
10. function Store(state) {
11. 	this._observers = { pre: blankObject(), post: blankObject() };
12. 	this._changeHandlers = [];
13. 	this._dependents = [];
14. 
15. 	this._computed = blankObject();
16. 	this._sortedComputedProperties = [];
17. 
18. 	this._state = assign({}, state);
19. }
20. 
21. assign(Store.prototype, {
22. 	_add: function(component, props) {
23. 		this._dependents.push({
24. 			component: component,
25. 			props: props
26. 		});
27. 	},
28. 
29. 	_init: function(props) {
30. 		var state = {};
31. 		for (var i = 0; i < props.length; i += 1) {
32. 			var prop = props[i];
33. 			state['$' + prop] = this._state[prop];
34. 		}
35. 		return state;
36. 	},
37. 
38. 	_remove: function(component) {
39. 		var i = this._dependents.length;
40. 		while (i--) {
41. 			if (this._dependents[i].component === component) {
42. 				this._dependents.splice(i, 1);
43. 				return;
44. 			}
45. 		}
46. 	},
47. 
48. 	_sortComputedProperties: function() {
49. 		var computed = this._computed;
50. 		var sorted = this._sortedComputedProperties = [];
51. 		var cycles;
52. 		var visited = blankObject();
53. 
54. 		function visit(key) {
55. 			if (cycles[key]) {
56. 				throw new Error('Cyclical dependency detected');
57. 			}
58. 
59. 			if (visited[key]) return;
60. 			visited[key] = true;
61. 
62. 			var c = computed[key];
63. 
64. 			if (c) {
65. 				cycles[key] = true;
66. 				c.deps.forEach(visit);
67. 				sorted.push(c);
68. 			}
69. 		}
70. 
71. 		for (var key in this._computed) {
72. 			cycles = blankObject();
73. 			visit(key);
74. 		}
75. 	},
76. 
77. 	compute: function(key, deps, fn) {
78. 		var store = this;
79. 		var value;
80. 
81. 		var c = {
82. 			deps: deps,
83. 			update: function(state, changed, dirty) {
84. 				var values = deps.map(function(dep) {
85. 					if (dep in changed) dirty = true;
86. 					return state[dep];
87. 				});
88. 
89. 				if (dirty) {
90. 					var newValue = fn.apply(null, values);
91. 					if (differs(newValue, value)) {
92. 						value = newValue;
93. 						changed[key] = true;
94. 						state[key] = value;
95. 					}
96. 				}
97. 			}
98. 		};
99. 
100. 		c.update(this._state, {}, true);
101. 
102. 		this._computed[key] = c;
103. 		this._sortComputedProperties();
104. 	},
105. 
106. 	get: get,
107. 
108. 	observe: observe,
109. 
110. 	onchange: function(callback) {
111. 		this._changeHandlers.push(callback);
112. 		return {
113. 			cancel: function() {
114. 				var index = this._changeHandlers.indexOf(callback);
115. 				if (~index) this._changeHandlers.splice(index, 1);
116. 			}
117. 		};
118. 	},
119. 
120. 	set: function(newState) {
121. 		var oldState = this._state,
122. 			changed = this._changed = {},
123. 			dirty = false;
124. 
125. 		for (var key in newState) {
126. 			if (this._computed[key]) throw new Error("'" + key + "' is a read-only property");
127. 			if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
128. 		}
129. 		if (!dirty) return;
130. 
131. 		this._state = assign({}, oldState, newState);
132. 
133. 		for (var i = 0; i < this._sortedComputedProperties.length; i += 1) {
134. 			this._sortedComputedProperties[i].update(this._state, changed);
135. 		}
136. 
137. 		for (var i = 0; i < this._changeHandlers.length; i += 1) {
138. 			this._changeHandlers[i](this._state, changed);
139. 		}
140. 
141. 		dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
142. 
143. 		var dependents = this._dependents.slice(); // guard against mutations
144. 		for (var i = 0; i < dependents.length; i += 1) {
145. 			var dependent = dependents[i];
146. 			var componentState = {};
147. 			dirty = false;
148. 
149. 			for (var j = 0; j < dependent.props.length; j += 1) {
150. 				var prop = dependent.props[j];
151. 				if (prop in changed) {
152. 					componentState['$' + prop] = this._state[prop];
153. 					dirty = true;
154. 				}
155. 			}
156. 
157. 			if (dirty) dependent.component.set(componentState);
158. 		}
159. 
160. 		dispatchObservers(this, this._observers.post, changed, this._state, oldState);
161. 	}
162. });
163. 
164. export { Store };


File: test/server-side-rendering/index.js
Line number range: 1 - 132
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require("../../ssr/register")({
25. 			extensions: ['.svelte', '.html'],
26. 			store: true
27. 		});
28. 
29. 		return setupHtmlEqual();
30. 	});
31. 
32. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
33. 		if (dir[0] === ".") return;
34. 
35. 		// add .solo to a sample directory name to only run that test, or
36. 		// .show to always show the output. or both
37. 		const solo = /\.solo/.test(dir);
38. 		const show = /\.show/.test(dir);
39. 
40. 		if (solo && process.env.CI) {
41. 			throw new Error("Forgot to remove `solo: true` from test");
42. 		}
43. 
44. 		(solo ? it.only : it)(dir, () => {
45. 			dir = path.resolve("test/server-side-rendering/samples", dir);
46. 			try {
47. 				let component;
48. 
49. 				const mainHtmlFile = `${dir}/main.html`;
50. 				const mainSvelteFile = `${dir}/main.svelte`;
51. 				if (fs.existsSync(mainHtmlFile)) {
52. 					component = require(mainHtmlFile);
53. 				} else if (fs.existsSync(mainSvelteFile)) {
54. 					component = require(mainSvelteFile);
55. 				}
56. 
57. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
58. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
59. 
60. 				const data = tryToLoadJson(`${dir}/data.json`);
61. 
62. 				const rendered = component.render(data);
63. 				const { html, css, head } = rendered;
64. 
65. 				// rendered.toString() === rendered.html
66. 				assert.equal(rendered, html);
67. 
68. 				fs.writeFileSync(`${dir}/_actual.html`, html);
69. 				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);
70. 
71. 				assert.htmlEqual(html, expectedHtml);
72. 				assert.equal(
73. 					css.code.replace(/^\s+/gm, ""),
74. 					expectedCss.replace(/^\s+/gm, "")
75. 				);
76. 
77. 				if (fs.existsSync(`${dir}/_expected-head.html`)) {
78. 					fs.writeFileSync(`${dir}/_actual-head.html`, head);
79. 					assert.htmlEqual(
80. 						head,
81. 						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
82. 					);
83. 				}
84. 
85. 				if (show) showOutput(dir, { generate: 'ssr' });
86. 			} catch (err) {
87. 				showOutput(dir, { generate: 'ssr' });
88. 				throw err;
89. 			}
90. 		});
91. 	});
92. 
93. 	// duplicate client-side tests, as far as possible
94. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
95. 		if (dir[0] === ".") return;
96. 
97. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
98. 
99. 		if (config.solo && process.env.CI) {
100. 			throw new Error("Forgot to remove `solo: true` from test");
101. 		}
102. 
103. 		if (config["skip-ssr"]) return;
104. 
105. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
106. 			const cwd = path.resolve("test/runtime/samples", dir);
107. 
108. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
109. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
110. 				delete require.cache[resolved];
111. 			});
112. 
113. 			require("../../ssr/register")({
114. 				store: !!config.store
115. 			});
116. 
117. 			try {
118. 				const component = require(`../runtime/samples/${dir}/main.html`);
119. 				const { html } = component.render(config.data, {
120. 					store: (config.store !== true) && config.store
121. 				});
122. 
123. 				if (config.html) {
124. 					assert.htmlEqual(html, config.html);
125. 				}
126. 			} catch (err) {
127. 				showOutput(cwd, { generate: "ssr" });
128. 				throw err;
129. 			}
130. 		});
131. 	});
132. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 13:58:52,938 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We have SSR index and Component visitor code showing nested components are rendered via _render and pass { store: options.store } only if the parent compile option store is true. The reported bug stems from bypassing child .render, which initializes its own store via templateProperties.store. To confirm and fix, we need to see how components expose their store function and how templateProperties/templateVars are generated, which is defined in wrapModule.ts, and the overall SSR visit flow in visit.ts. These critical implementation details are missing from the current context.' query='Please provide the full contents of src/generators/wrapModule.ts and src/generators/server-side-rendering/visit.ts.' extra_requirements='If full files are too large, include at minimum how templateProperties.store and templateVars are created/exposed and the code path that builds nested component options for SSR.' purpose='To verify how a component’s store function is exposed and ensure SSR nested component calls initialize their own store instead of relying solely on the parent’s options.store, enabling a precise bug fix.'
2025-11-12 13:58:52,940 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents of src/generators/wrapModule.ts and src/generators/server-side-rendering/visit.ts.
2025-11-12 13:58:54,035 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 13:58:54,035 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 13:58:54,035 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 13:58:54,035 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 13:58:54,037 - thread-135845298308800.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 13:58:54,038 - thread-135845298308800.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 13:58:54,038 - thread-135845298308800.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full contents of src/generators/wrapModule.ts and src/generators/server-side-rendering/visit.ts.
Extra requirements: If full files are too large, include at minimum how templateProperties.store and templateVars are created/exposed and the code path that builds nested component options for SSR.
Purpose: To verify how a component’s store function is exposed and ensure SSR nested component calls initialize their own store instead of relying solely on the parent’s options.store, enabling a precise bug fix.
2025-11-12 13:59:00,847 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_elOPdiAQGOgWvbWJQUvPoojM', 'function': {'arguments': '{"relative_path":"src/generators/wrapModule.ts","start_line":1,"end_line":5000}', 'name': 'read_code_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 686, 'prompt_tokens': 2209, 'total_tokens': 2895, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a1245418-51a3-4775-aa67-01e1ff0c81fb-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'src/generators/wrapModule.ts', 'start_line': 1, 'end_line': 5000}, 'id': 'call_elOPdiAQGOgWvbWJQUvPoojM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2209, 'output_tokens': 686, 'total_tokens': 2895, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-12 13:59:02,578 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lRnp98Bm3etBjDNiVm82ARBu', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visit.ts","start_line":1,"end_line":5000}', 'name': 'read_code_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 49, 'prompt_tokens': 5663, 'total_tokens': 5712, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--584ef26b-292c-4b3d-a15c-ead9686f3098-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'src/generators/server-side-rendering/visit.ts', 'start_line': 1, 'end_line': 5000}, 'id': 'call_lRnp98Bm3etBjDNiVm82ARBu', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5663, 'output_tokens': 49, 'total_tokens': 5712, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 13:59:12,038 - thread-135845298308800.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located the two requested source files by their relative paths and read them in full. The complete contents of src/generators/wrapModule.ts (module wrapping for various formats) and src/generators/server-side-rendering/visit.ts (SSR visitor dispatcher) are provided. These files are small enough to include entirely, so no additional fallback context was needed. If you need to trace templateProperties.store/templateVars or nested SSR component option construction, those are likely implemented in the SSR generator and visitors submodules referenced by visit.ts.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 885, 'prompt_tokens': 5902, 'total_tokens': 6787, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--c85a2ec7-0253-4bbd-90ee-95caec319771-0' usage_metadata={'input_tokens': 5902, 'output_tokens': 885, 'total_tokens': 6787, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 13:59:12,042 - thread-135845298308800.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full contents of src/generators/wrapModule.ts and src/generators/server-side-rendering/visit.ts.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If full files are too large, include at minimum how templateProperties.store and templateVars are created/exposed and the code path that builds nested component options for SSR.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
To verify how a component’s store function is exposed and ensure SSR nested component calls initialize their own store instead of relying solely on the parent’s options.store, enabling a precise bug fix.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: src/generators/server-side-rendering/visit.ts
Line number range: 1 - 5000
Content:
1. import visitors from './visitors/index';
2. import { SsrGenerator } from './index';
3. import Block from './Block';
4. import { Node } from '../../interfaces';
5. 
6. export default function visit(
7. 	generator: SsrGenerator,
8. 	block: Block,
9. 	node: Node
10. ) {
11. 	const visitor = visitors[node.type];
12. 	visitor(generator, block, node);
13. }


File: src/generators/wrapModule.ts
Line number range: 1 - 5000
Content:
1. import deindent from '../utils/deindent';
2. import list from '../utils/list';
3. import { CompileOptions, ModuleFormat, Node } from '../interfaces';
4. 
5. interface Dependency {
6. 	name: string;
7. 	statements: string[];
8. 	source: string;
9. }
10. 
11. const wrappers = { es, amd, cjs, iife, umd, eval: expr };
12. 
13. export default function wrapModule(
14. 	code: string,
15. 	format: ModuleFormat,
16. 	name: string,
17. 	options: CompileOptions,
18. 	banner: string,
19. 	sharedPath: string,
20. 	helpers: { name: string, alias: string }[],
21. 	imports: Node[],
22. 	source: string
23. ): string {
24. 	if (format === 'es') return es(code, name, options, banner, sharedPath, helpers, imports, source);
25. 
26. 	const dependencies = imports.map((declaration, i) => {
27. 		const defaultImport = declaration.specifiers.find(
28. 			(x: Node) =>
29. 				x.type === 'ImportDefaultSpecifier' ||
30. 				(x.type === 'ImportSpecifier' && x.imported.name === 'default')
31. 		);
32. 
33. 		const namespaceImport = declaration.specifiers.find(
34. 			(x: Node) => x.type === 'ImportNamespaceSpecifier'
35. 		);
36. 
37. 		const namedImports = declaration.specifiers.filter(
38. 			(x: Node) =>
39. 				x.type === 'ImportSpecifier' && x.imported.name !== 'default'
40. 		);
41. 
42. 		const name = defaultImport || namespaceImport
43. 			? (defaultImport || namespaceImport).local.name
44. 			: `__import${i}`;
45. 
46. 		const statements: string[] = [];
47. 
48. 		namedImports.forEach((specifier: Node) => {
49. 			statements.push(
50. 				`var ${specifier.local.name} = ${name}.${specifier.imported.name};`
51. 			);
52. 		});
53. 
54. 		if (defaultImport) {
55. 			statements.push(
56. 				`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`
57. 			);
58. 		}
59. 
60. 		return { name, statements, source: declaration.source.value };
61. 	});
62. 
63. 	if (format === 'amd') return amd(code, name, options, banner, dependencies);
64. 	if (format === 'cjs') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);
65. 	if (format === 'iife') return iife(code, name, options, banner, dependencies);
66. 	if (format === 'umd') return umd(code, name, options, banner, dependencies);
67. 	if (format === 'eval') return expr(code, name, options, banner, dependencies);
68. 
69. 	throw new Error(`options.format is invalid (must be ${list(Object.keys(wrappers))})`);
70. }
71. 
72. function es(
73. 	code: string,
74. 	name: string,
75. 	options: CompileOptions,
76. 	banner: string,
77. 	sharedPath: string,
78. 	helpers: { name: string, alias: string }[],
79. 	imports: Node[],
80. 	source: string
81. ) {
82. 	const importHelpers = helpers && (
83. 		`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(', ')} } from ${JSON.stringify(sharedPath)};`
84. 	);
85. 
86. 	const importBlock = imports.length > 0 && (
87. 		imports
88. 			.map((declaration: Node) => source.slice(declaration.start, declaration.end))
89. 			.join('\n')
90. 	);
91. 
92. 	return deindent`
93. 		${banner}
94. 		${importHelpers}
95. 		${importBlock}
96. 
97. 		${code}
98. 		export default ${name};`;
99. }
100. 
101. function amd(
102. 	code: string,
103. 	name: string,
104. 	options: CompileOptions,
105. 	banner: string,
106. 	dependencies: Dependency[]
107. ) {
108. 	const sourceString = dependencies.length
109. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
110. 		: '';
111. 
112. 	const id = options.amd && options.amd.id;
113. 
114. 	return deindent`
115. 		define(${id ? `"${id}", ` : ''}${sourceString}function(${paramString(dependencies)}) { "use strict";
116. 			${getCompatibilityStatements(dependencies)}
117. 
118. 			${code}
119. 			return ${name};
120. 		});`;
121. }
122. 
123. function cjs(
124. 	code: string,
125. 	name: string,
126. 	options: CompileOptions,
127. 	banner: string,
128. 	sharedPath: string,
129. 	helpers: { name: string, alias: string }[],
130. 	dependencies: Dependency[]
131. ) {
132. 	const SHARED = '__shared';
133. 	const helperBlock = helpers && (
134. 		`var ${SHARED} = require(${JSON.stringify(sharedPath)});\n` +
135. 		helpers.map(helper => {
136. 			return `var ${helper.alias} = ${SHARED}.${helper.name};`;
137. 		}).join('\n')
138. 	);
139. 
140. 	const requireBlock = dependencies.length > 0 && (
141. 		dependencies
142. 			.map(d => `var ${d.name} = require("${d.source}");`)
143. 			.join('\n\n')
144. 	);
145. 
146. 	return deindent`
147. 		${banner}
148. 		"use strict";
149. 
150. 		${helperBlock}
151. 		${requireBlock}
152. 		${getCompatibilityStatements(dependencies)}
153. 
154. 		${code}
155. 
156. 		module.exports = ${name};`
157. }
158. 
159. function iife(
160. 	code: string,
161. 	name: string,
162. 	options: CompileOptions,
163. 	banner: string,
164. 	dependencies: Dependency[]
165. ) {
166. 	if (!options.name) {
167. 		throw new Error(`Missing required 'name' option for IIFE export`);
168. 	}
169. 
170. 	const globals = getGlobals(dependencies, options);
171. 
172. 	return deindent`
173. 		${banner}
174. 		var ${options.name} = (function(${paramString(dependencies)}) { "use strict";
175. 			${getCompatibilityStatements(dependencies)}
176. 
177. 			${code}
178. 			return ${name};
179. 		}(${globals.join(', ')}));`;
180. }
181. 
182. function umd(
183. 	code: string,
184. 	name: string,
185. 	options: CompileOptions,
186. 	banner: string,
187. 	dependencies: Dependency[]
188. ) {
189. 	if (!options.name) {
190. 		throw new Error(`Missing required 'name' option for UMD export`);
191. 	}
192. 
193. 	const amdId = options.amd && options.amd.id ? `'${options.amd.id}', ` : '';
194. 
195. 	const amdDeps = dependencies.length
196. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
197. 		: '';
198. 
199. 	const cjsDeps = dependencies
200. 		.map(d => `require("${d.source}")`)
201. 		.join(', ');
202. 
203. 	const globals = getGlobals(dependencies, options);
204. 
205. 	return deindent`
206. 		${banner}
207. 		(function(global, factory) {
208. 			typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :
209. 			typeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :
210. 			(global.${options.name} = factory(${globals.join(', ')}));
211. 		}(this, (function (${paramString(dependencies)}) { "use strict";
212. 
213. 			${getCompatibilityStatements(dependencies)}
214. 
215. 			${code}
216. 
217. 			return ${name};
218. 
219. 		})));`;
220. }
221. 
222. function expr(
223. 	code: string,
224. 	name: string,
225. 	options: CompileOptions,
226. 	banner: string,
227. 	dependencies: Dependency[]
228. ) {
229. 	const globals = getGlobals(dependencies, options);
230. 
231. 	return deindent`
232. 		(function (${paramString(dependencies)}) { "use strict";
233. 			${banner}
234. 
235. 			${getCompatibilityStatements(dependencies)}
236. 
237. 			${code}
238. 
239. 			return ${name};
240. 		}(${globals.join(', ')}))`;
241. }
242. 
243. function paramString(dependencies: Dependency[]) {
244. 	return dependencies.map(dep => dep.name).join(', ');
245. }
246. 
247. function removeExtension(file: string) {
248. 	const index = file.lastIndexOf('.');
249. 	return ~index ? file.slice(0, index) : file;
250. }
251. 
252. function getCompatibilityStatements(dependencies: Dependency[]) {
253. 	if (!dependencies.length) return null;
254. 
255. 	const statements: string[] = [];
256. 
257. 	dependencies.forEach(dependency => {
258. 		statements.push(...dependency.statements);
259. 	});
260. 
261. 	return statements.join('\n');
262. }
263. 
264. function getGlobals(dependencies: Dependency[], options: CompileOptions) {
265. 	const { globals, onerror, onwarn } = options;
266. 	const globalFn = getGlobalFn(globals);
267. 
268. 	return dependencies.map(d => {
269. 		let name = globalFn(d.source);
270. 
271. 		if (!name) {
272. 			if (d.name.startsWith('__import')) {
273. 				const error = new Error(
274. 					`Could not determine name for imported module '${d.source}' – use options.globals`
275. 				);
276. 				onerror(error);
277. 			} else {
278. 				const warning = {
279. 					message: `No name was supplied for imported module '${d.source}'. Guessing '${d.name}', but you should use options.globals`,
280. 				};
281. 
282. 				onwarn(warning);
283. 			}
284. 
285. 			name = d.name;
286. 		}
287. 
288. 		return name;
289. 	});
290. }
291. 
292. function getGlobalFn(globals: any): (id: string) => string {
293. 	if (typeof globals === 'function') return globals;
294. 	if (typeof globals === 'object') {
295. 		return id => globals[id];
296. 	}
297. 
298. 	return () => undefined;
299. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 13:59:24,344 - thread-135845298308800.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n- The user asks for the full contents of src/generators/wrapModule.ts.\n2. Extended relevance:\n- This file contains module format wrappers and import handling which are part of the requested content. Providing the entire file satisfies the query directly.', relative_path='src/generators/wrapModule.ts', start_line=1, end_line=299), ContextOutput(reasoning='1. Query requirement analysis:\n- The user asks for the full contents of src/generators/server-side-rendering/visit.ts.\n2. Extended relevance:\n- This file defines the SSR visitor dispatch function used in traversal, which is part of the requested content and relevant to understanding the SSR code path.', relative_path='src/generators/server-side-rendering/visit.ts', start_line=1, end_line=13)]
2025-11-12 13:59:24,347 - thread-135845298308800.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 2 contexts to memory for query: Please provide the full contents of src/generators/wrapModule.ts and src/generators/server-side-rendering/visit.ts.
2025-11-12 13:59:27,089 - thread-135845298308800.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 13:59:27,090 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 8 existing contexts
2025-11-12 13:59:27,091 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 10 total contexts (removed 0 duplicates)
2025-11-12 13:59:27,092 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/generators/server-side-rendering/visit.ts, src/generators/wrapModule.ts, and src/generators/nodes/Component.ts.
Extra Requirements: If full files are too large, include at minimum the functions that emit SSR output for nested components, any code that passes options/store to child components, and the wrapper code that initializes a component’s store in render/_render.
Purpose: To trace how SSR emits nested component calls and how the store is propagated/initialized, so we can pinpoint the bug and propose a fix.

Previous refined query 2:
Essential Query: Please provide the full contents of src/generators/wrapModule.ts and src/generators/server-side-rendering/visit.ts.
Extra Requirements: If full files are too large, include at minimum how templateProperties.store and templateVars are created/exposed and the code path that builds nested component options for SSR.
Purpose: To verify how a component’s store function is exposed and ensure SSR nested component calls initialize their own store instead of relying solely on the parent’s options.store, enabling a precise bug fix.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: src/generators/nodes/Component.ts
Line number range: 1 - 609
Content:
1. import deindent from '../../utils/deindent';
2. import { stringify } from '../../utils/stringify';
3. import stringifyProps from '../../utils/stringifyProps';
4. import CodeBuilder from '../../utils/CodeBuilder';
5. import getTailSnippet from '../../utils/getTailSnippet';
6. import getObject from '../../utils/getObject';
7. import getExpressionPrecedence from '../../utils/getExpressionPrecedence';
8. import Node from './shared/Node';
9. import Block from '../dom/Block';
10. import Attribute from './Attribute';
11. 
12. export default class Component extends Node {
13. 	type: 'Component';
14. 	name: string;
15. 	attributes: Attribute[];
16. 	children: Node[];
17. 
18. 	init(
19. 		block: Block,
20. 		stripWhitespace: boolean,
21. 		nextSibling: Node
22. 	) {
23. 		this.cannotUseInnerHTML();
24. 
25. 		this.attributes.forEach((attribute: Node) => {
26. 			if (attribute.type === 'Attribute' && attribute.value !== true) {
27. 				attribute.value.forEach((chunk: Node) => {
28. 					if (chunk.type !== 'Text') {
29. 						const dependencies = chunk.metadata.dependencies;
30. 						block.addDependencies(dependencies);
31. 					}
32. 				});
33. 			} else {
34. 				if (attribute.type === 'EventHandler' && attribute.expression) {
35. 					attribute.expression.arguments.forEach((arg: Node) => {
36. 						block.addDependencies(arg.metadata.dependencies);
37. 					});
38. 				} else if (attribute.type === 'Binding') {
39. 					block.addDependencies(attribute.metadata.dependencies);
40. 				}
41. 			}
42. 		});
43. 
44. 		this.var = block.getUniqueName(
45. 			(
46. 				this.name === ':Self' ? this.generator.name :
47. 				this.name === ':Component' ? 'switch_instance' :
48. 				this.name
49. 			).toLowerCase()
50. 		);
51. 
52. 		if (this.children.length) {
53. 			this._slots = new Set(['default']);
54. 
55. 			this.children.forEach(child => {
56. 				child.init(block, stripWhitespace, nextSibling);
57. 			});
58. 		}
59. 	}
60. 
61. 	build(
62. 		block: Block,
63. 		parentNode: string,
64. 		parentNodes: string
65. 	) {
66. 		const { generator } = this;
67. 		generator.hasComponents = true;
68. 
69. 		const name = this.var;
70. 
71. 		const componentInitProperties = [`root: #component.root`];
72. 
73. 		if (this.children.length > 0) {
74. 			const slots = Array.from(this._slots).map(name => `${name}: @createFragment()`);
75. 			componentInitProperties.push(`slots: { ${slots.join(', ')} }`);
76. 
77. 			this.children.forEach((child: Node) => {
78. 				child.build(block, `${this.var}._slotted.default`, 'nodes');
79. 			});
80. 		}
81. 
82. 		const allContexts = new Set();
83. 		const statements: string[] = [];
84. 		const name_context = block.getUniqueName(`${name}_context`);
85. 
86. 		let name_updating: string;
87. 		let name_initial_data: string;
88. 		let beforecreate: string = null;
89. 
90. 		const attributes = this.attributes
91. 			.filter(a => a.type === 'Attribute')
92. 			.map(a => mungeAttribute(a, block));
93. 
94. 		const bindings = this.attributes
95. 			.filter(a => a.type === 'Binding')
96. 			.map(a => mungeBinding(a, block));
97. 
98. 		const eventHandlers = this.attributes
99. 			.filter((a: Node) => a.type === 'EventHandler')
100. 			.map(a => mungeEventHandler(generator, this, a, block, name_context, allContexts));
101. 
102. 		const ref = this.attributes.find((a: Node) => a.type === 'Ref');
103. 		if (ref) generator.usesRefs = true;
104. 
105. 		const updates: string[] = [];
106. 
107. 		if (attributes.length || bindings.length) {
108. 			const initialProps = attributes
109. 				.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);
110. 
111. 			const initialPropString = stringifyProps(initialProps);
112. 
113. 			attributes
114. 				.filter((attribute: Attribute) => attribute.dynamic)
115. 				.forEach((attribute: Attribute) => {
116. 					if (attribute.dependencies.length) {
117. 						updates.push(deindent`
118. 							if (${attribute.dependencies
119. 								.map(dependency => `changed.${dependency}`)
120. 								.join(' || ')}) ${name}_changes.${attribute.name} = ${attribute.value};
121. 						`);
122. 					}
123. 
124. 					else {
125. 						// TODO this is an odd situation to encounter – I *think* it should only happen with
126. 						// each block indices, in which case it may be possible to optimise this
127. 						updates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);
128. 					}
129. 				});
130. 
131. 			if (bindings.length) {
132. 				generator.hasComplexBindings = true;
133. 
134. 				name_updating = block.alias(`${name}_updating`);
135. 				name_initial_data = block.getUniqueName(`${name}_initial_data`);
136. 
137. 				block.addVariable(name_updating, '{}');
138. 				statements.push(`var ${name_initial_data} = ${initialPropString};`);
139. 
140. 				const setParentFromChildOnChange = new CodeBuilder();
141. 				const setParentFromChildOnInit = new CodeBuilder();
142. 
143. 				bindings.forEach((binding: Binding) => {
144. 					let setParentFromChild;
145. 
146. 					binding.contexts.forEach(context => {
147. 						allContexts.add(context);
148. 					});
149. 
150. 					const { name: key } = getObject(binding.value);
151. 
152. 					if (block.contexts.has(key)) {
153. 						const prop = binding.dependencies[0];
154. 						const computed = isComputed(binding.value);
155. 						const tail = binding.value.type === 'MemberExpression' ? getTailSnippet(binding.value) : '';
156. 
157. 						setParentFromChild = deindent`
158. 							var list = ${name_context}.${block.listNames.get(key)};
159. 							var index = ${name_context}.${block.indexNames.get(key)};
160. 							list[index]${tail} = childState.${binding.name};
161. 
162. 							${binding.dependencies
163. 								.map((prop: string) => `newState.${prop} = state.${prop};`)
164. 								.join('\n')}
165. 						`;
166. 					}
167. 
168. 					else if (binding.value.type === 'MemberExpression') {
169. 						setParentFromChild = deindent`
170. 							${binding.snippet} = childState.${binding.name};
171. 							${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join('\n')}
172. 						`;
173. 					}
174. 
175. 					else {
176. 						setParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;
177. 					}
178. 
179. 					statements.push(deindent`
180. 						if (${binding.prop} in ${binding.obj}) {
181. 							${name_initial_data}.${binding.name} = ${binding.snippet};
182. 							${name_updating}.${binding.name} = true;
183. 						}`
184. 					);
185. 
186. 					setParentFromChildOnChange.addConditional(
187. 						`!${name_updating}.${binding.name} && changed.${binding.name}`,
188. 						setParentFromChild
189. 					);
190. 
191. 					setParentFromChildOnInit.addConditional(
192. 						`!${name_updating}.${binding.name}`,
193. 						setParentFromChild
194. 					);
195. 
196. 					// TODO could binding.dependencies.length ever be 0?
197. 					if (binding.dependencies.length) {
198. 						updates.push(deindent`
199. 							if (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(' || ')}) {
200. 								${name}_changes.${binding.name} = ${binding.snippet};
201. 								${name_updating}.${binding.name} = true;
202. 							}
203. 						`);
204. 					}
205. 				});
206. 
207. 				componentInitProperties.push(`data: ${name_initial_data}`);
208. 
209. 				componentInitProperties.push(deindent`
210. 					_bind: function(changed, childState) {
211. 						var state = #component.get(), newState = {};
212. 						${setParentFromChildOnChange}
213. 						${name_updating} = @assign({}, changed);
214. 						#component._set(newState);
215. 						${name_updating} = {};
216. 					}
217. 				`);
218. 
219. 				beforecreate = deindent`
220. 					#component.root._beforecreate.push(function() {
221. 						var state = #component.get(), childState = ${name}.get(), newState = {};
222. 						if (!childState) return;
223. 						${setParentFromChildOnInit}
224. 						${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(', ')} };
225. 						#component._set(newState);
226. 						${name_updating} = {};
227. 					});
228. 				`;
229. 			} else if (initialProps.length) {
230. 				componentInitProperties.push(`data: ${initialPropString}`);
231. 			}
232. 		}
233. 
234. 		const isDynamicComponent = this.name === ':Component';
235. 
236. 		const switch_vars = isDynamicComponent && {
237. 			value: block.getUniqueName('switch_value'),
238. 			props: block.getUniqueName('switch_props')
239. 		};
240. 
241. 		const expression = (
242. 			this.name === ':Self' ? generator.name :
243. 			isDynamicComponent ? switch_vars.value :
244. 			`%components-${this.name}`
245. 		);
246. 
247. 		if (isDynamicComponent) {
248. 			block.contextualise(this.expression);
249. 			const { dependencies, snippet } = this.metadata;
250. 
251. 			const anchor = this.getOrCreateAnchor(block, parentNode, parentNodes);
252. 
253. 			const params = block.params.join(', ');
254. 
255. 			block.builders.init.addBlock(deindent`
256. 				var ${switch_vars.value} = ${snippet};
257. 
258. 				function ${switch_vars.props}(${params}) {
259. 					${statements.length > 0 && statements.join('\n')}
260. 					return {
261. 						${componentInitProperties.join(',\n')}
262. 					};
263. 				}
264. 
265. 				if (${switch_vars.value}) {
266. 					var ${name} = new ${expression}(${switch_vars.props}(${params}));
267. 
268. 					${beforecreate}
269. 				}
270. 
271. 				${eventHandlers.map(handler => deindent`
272. 					function ${handler.var}(event) {
273. 						${handler.body}
274. 					}
275. 
276. 					if (${name}) ${name}.on("${handler.name}", ${handler.var});
277. 				`)}
278. 			`);
279. 
280. 			block.builders.create.addLine(
281. 				`if (${name}) ${name}._fragment.c();`
282. 			);
283. 
284. 			if (parentNodes) {
285. 				block.builders.claim.addLine(
286. 					`if (${name}) ${name}._fragment.l(${parentNodes});`
287. 				);
288. 			}
289. 
290. 			block.builders.mount.addLine(
291. 				`if (${name}) ${name}._mount(${parentNode || '#target'}, ${parentNode ? 'null' : 'anchor'});`
292. 			);
293. 
294. 			const updateMountNode = this.getUpdateMountNode(anchor);
295. 
296. 			block.builders.update.addBlock(deindent`
297. 				if (${switch_vars.value} !== (${switch_vars.value} = ${snippet})) {
298. 					if (${name}) ${name}.destroy();
299. 
300. 					if (${switch_vars.value}) {
301. 						${name} = new ${switch_vars.value}(${switch_vars.props}(${params}));
302. 						${name}._fragment.c();
303. 
304. 						${this.children.map(child => remount(generator, child, name))}
305. 						${name}._mount(${updateMountNode}, ${anchor});
306. 
307. 						${eventHandlers.map(handler => deindent`
308. 							${name}.on("${handler.name}", ${handler.var});
309. 						`)}
310. 
311. 						${ref && `#component.refs.${ref.name} = ${name};`}
312. 					}
313. 
314. 					${ref && deindent`
315. 						else if (#component.refs.${ref.name} === ${name}) {
316. 							#component.refs.${ref.name} = null;
317. 						}`}
318. 				}
319. 			`);
320. 
321. 			if (updates.length) {
322. 				block.builders.update.addBlock(deindent`
323. 					else {
324. 						var ${name}_changes = {};
325. 						${updates.join('\n')}
326. 						${name}._set(${name}_changes);
327. 						${bindings.length && `${name_updating} = {};`}
328. 					}
329. 				`);
330. 			}
331. 
332. 			if (!parentNode) block.builders.unmount.addLine(`if (${name}) ${name}._unmount();`);
333. 
334. 			block.builders.destroy.addLine(`if (${name}) ${name}.destroy(false);`);
335. 		} else {
336. 			block.builders.init.addBlock(deindent`
337. 				${statements.join('\n')}
338. 				var ${name} = new ${expression}({
339. 					${componentInitProperties.join(',\n')}
340. 				});
341. 
342. 				${beforecreate}
343. 
344. 				${eventHandlers.map(handler => deindent`
345. 					${name}.on("${handler.name}", function(event) {
346. 						${handler.body}
347. 					});
348. 				`)}
349. 
350. 				${ref && `#component.refs.${ref.name} = ${name};`}
351. 			`);
352. 
353. 			block.builders.create.addLine(`${name}._fragment.c();`);
354. 
355. 			if (parentNodes) {
356. 				block.builders.claim.addLine(
357. 					`${name}._fragment.l(${parentNodes});`
358. 				);
359. 			}
360. 
361. 			block.builders.mount.addLine(
362. 				`${name}._mount(${parentNode || '#target'}, ${parentNode ? 'null' : 'anchor'});`
363. 			);
364. 
365. 			if (updates.length) {
366. 				block.builders.update.addBlock(deindent`
367. 					var ${name}_changes = {};
368. 					${updates.join('\n')}
369. 					${name}._set(${name}_changes);
370. 					${bindings.length && `${name_updating} = {};`}
371. 				`);
372. 			}
373. 
374. 			if (!parentNode) block.builders.unmount.addLine(`${name}._unmount();`);
375. 
376. 			block.builders.destroy.addLine(deindent`
377. 				${name}.destroy(false);
378. 				${ref && `if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;`}
379. 			`);
380. 		}
381. 
382. 		// maintain component context
383. 		if (allContexts.size) {
384. 			const contexts = Array.from(allContexts);
385. 
386. 			const initialProps = contexts
387. 				.map(contextName => {
388. 					if (contextName === 'state') return `state: state`;
389. 
390. 					const listName = block.listNames.get(contextName);
391. 					const indexName = block.indexNames.get(contextName);
392. 
393. 					return `${listName}: ${listName},\n${indexName}: ${indexName}`;
394. 				})
395. 				.join(',\n');
396. 
397. 			const updates = contexts
398. 				.map(contextName => {
399. 					if (contextName === 'state') return `${name_context}.state = state;`;
400. 
401. 					const listName = block.listNames.get(contextName);
402. 					const indexName = block.indexNames.get(contextName);
403. 
404. 					return `${name_context}.${listName} = ${listName};\n${name_context}.${indexName} = ${indexName};`;
405. 				})
406. 				.join('\n');
407. 
408. 			block.builders.init.addBlock(deindent`
409. 				var ${name_context} = {
410. 					${initialProps}
411. 				};
412. 			`);
413. 
414. 			block.builders.update.addBlock(updates);
415. 		}
416. 	}
417. }
418. 
419. function mungeAttribute(attribute: Node, block: Block): Attribute {
420. 	if (attribute.value === true) {
421. 		// attributes without values, e.g. <textarea readonly>
422. 		return {
423. 			name: attribute.name,
424. 			value: true,
425. 			dynamic: false
426. 		};
427. 	}
428. 
429. 	if (attribute.value.length === 0) {
430. 		return {
431. 			name: attribute.name,
432. 			value: `''`,
433. 			dynamic: false
434. 		};
435. 	}
436. 
437. 	if (attribute.value.length === 1) {
438. 		const value = attribute.value[0];
439. 
440. 		if (value.type === 'Text') {
441. 			// static attributes
442. 			return {
443. 				name: attribute.name,
444. 				value: isNaN(value.data) ? stringify(value.data) : value.data,
445. 				dynamic: false
446. 			};
447. 		}
448. 
449. 		// simple dynamic attributes
450. 		block.contextualise(value.expression); // TODO remove
451. 		const { dependencies, snippet } = value.metadata;
452. 
453. 		// TODO only update attributes that have changed
454. 		return {
455. 			name: attribute.name,
456. 			value: snippet,
457. 			dependencies,
458. 			dynamic: true
459. 		};
460. 	}
461. 
462. 	// otherwise we're dealing with a complex dynamic attribute
463. 	const allDependencies = new Set();
464. 
465. 	const value =
466. 		(attribute.value[0].type === 'Text' ? '' : `"" + `) +
467. 		attribute.value
468. 			.map((chunk: Node) => {
469. 				if (chunk.type === 'Text') {
470. 					return stringify(chunk.data);
471. 				} else {
472. 					block.contextualise(chunk.expression); // TODO remove
473. 					const { dependencies, snippet } = chunk.metadata;
474. 
475. 					dependencies.forEach((dependency: string) => {
476. 						allDependencies.add(dependency);
477. 					});
478. 
479. 					return getExpressionPrecedence(chunk.expression) <= 13 ? `(${snippet})` : snippet;
480. 				}
481. 			})
482. 			.join(' + ');
483. 
484. 	return {
485. 		name: attribute.name,
486. 		value,
487. 		dependencies: Array.from(allDependencies),
488. 		dynamic: true
489. 	};
490. }
491. 
492. function mungeBinding(binding: Node, block: Block): Binding {
493. 	const { name } = getObject(binding.value);
494. 	const { contexts } = block.contextualise(binding.value);
495. 	const { dependencies, snippet } = binding.metadata;
496. 
497. 	const contextual = block.contexts.has(name);
498. 
499. 	let obj;
500. 	let prop;
501. 
502. 	if (contextual) {
503. 		obj = block.listNames.get(name);
504. 		prop = block.indexNames.get(name);
505. 	} else if (binding.value.type === 'MemberExpression') {
506. 		prop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;
507. 		if (!binding.value.computed) prop = `'${prop}'`;
508. 		obj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;
509. 	} else {
510. 		obj = 'state';
511. 		prop = `'${name}'`;
512. 	}
513. 
514. 	return {
515. 		name: binding.name,
516. 		value: binding.value,
517. 		contexts,
518. 		snippet,
519. 		obj,
520. 		prop,
521. 		dependencies
522. 	};
523. }
524. 
525. function mungeEventHandler(generator: DomGenerator, node: Node, handler: Node, block: Block, name_context: string, allContexts: Set<string>) {
526. 	let body;
527. 
528. 	if (handler.expression) {
529. 		generator.addSourcemapLocations(handler.expression);
530. 		generator.code.prependRight(
531. 			handler.expression.start,
532. 			`${block.alias('component')}.`
533. 		);
534. 
535. 		const usedContexts: string[] = [];
536. 
537. 		handler.expression.arguments.forEach((arg: Node) => {
538. 			const { contexts } = block.contextualise(arg, null, true);
539. 
540. 			contexts.forEach(context => {
541. 				if (!~usedContexts.indexOf(context)) usedContexts.push(context);
542. 				allContexts.add(context);
543. 			});
544. 		});
545. 
546. 		// TODO hoist event handlers? can do `this.__component.method(...)`
547. 		const declarations = usedContexts.map(name => {
548. 			if (name === 'state') return `var state = ${name_context}.state;`;
549. 
550. 			const listName = block.listNames.get(name);
551. 			const indexName = block.indexNames.get(name);
552. 
553. 			return `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;
554. 		});
555. 
556. 		body = deindent`
557. 			${declarations}
558. 
559. 			[✂${handler.expression.start}-${handler.expression.end}✂];
560. 		`;
561. 	} else {
562. 		body = deindent`
563. 			${block.alias('component')}.fire('${handler.name}', event);
564. 		`;
565. 	}
566. 
567. 	return {
568. 		name: handler.name,
569. 		var: block.getUniqueName(`${node.var}_${handler.name}`),
570. 		body
571. 	};
572. }
573. 
574. function isComputed(node: Node) {
575. 	while (node.type === 'MemberExpression') {
576. 		if (node.computed) return true;
577. 		node = node.object;
578. 	}
579. 
580. 	return false;
581. }
582. 
583. function remount(generator: DomGenerator, node: Node, name: string) {
584. 	// TODO make this a method of the nodes
585. 
586. 	if (node.type === 'Component') {
587. 		return `${node.var}._mount(${name}._slotted.default, null);`;
588. 	}
589. 
590. 	if (node.type === 'Element') {
591. 		const slot = node.attributes.find(attribute => attribute.name === 'slot');
592. 		if (slot) {
593. 			return `@appendNode(${node.var}, ${name}._slotted.${node.getStaticAttributeValue('slot')});`;
594. 		}
595. 
596. 		return `@appendNode(${node.var}, ${name}._slotted.default);`;
597. 	}
598. 
599. 	if (node.type === 'Text' || node.type === 'MustacheTag' || node.type === 'RawMustacheTag') {
600. 		return `@appendNode(${node.var}, ${name}._slotted.default);`;
601. 	}
602. 
603. 	if (node.type === 'EachBlock') {
604. 		// TODO consider keyed blocks
605. 		return `for (var #i = 0; #i < ${node.iterations}.length; #i += 1) ${node.iterations}[#i].m(${name}._slotted.default, null);`;
606. 	}
607. 
608. 	return `${node.var}.m(${name}._slotted.default, null);`;
609. }


File: src/generators/server-side-rendering/Block.ts
Line number range: 1 - 49
Content:
1. import deindent from '../../utils/deindent';
2. import flattenReference from '../../utils/flattenReference';
3. import { SsrGenerator } from './index';
4. import { Node } from '../../interfaces';
5. import getObject from '../../utils/getObject';
6. 
7. interface BlockOptions {
8. 	// TODO
9. }
10. 
11. export default class Block {
12. 	generator: SsrGenerator;
13. 	conditions: string[];
14. 
15. 	contexts: Map<string, string>;
16. 	indexes: Map<string, string>;
17. 	contextDependencies: Map<string, string[]>;
18. 
19. 	constructor(options: BlockOptions) {
20. 		Object.assign(this, options);
21. 	}
22. 
23. 	addBinding(binding: Node, name: string) {
24. 		const conditions = [`!('${binding.name}' in state)`].concat(
25. 			// TODO handle contextual bindings...
26. 			this.conditions.map(c => `(${c})`)
27. 		);
28. 
29. 		const { name: prop } = getObject(binding.value);
30. 
31. 		this.generator.bindings.push(deindent`
32. 			if (${conditions.join('&&')}) {
33. 				tmp = ${name}.data();
34. 				if ('${prop}' in tmp) {
35. 					state.${binding.name} = tmp.${prop};
36. 					settled = false;
37. 				}
38. 			}
39. 		`);
40. 	}
41. 
42. 	child(options: BlockOptions) {
43. 		return new Block(Object.assign({}, this, options, { parent: this }));
44. 	}
45. 
46. 	contextualise(expression: Node, context?: string, isEventHandler?: boolean) {
47. 		return this.generator.contextualise(this.contexts, this.indexes, expression, context, isEventHandler);
48. 	}
49. }


File: src/generators/server-side-rendering/index.ts
Line number range: 1 - 268
Content:
1. import deindent from '../../utils/deindent';
2. import Generator from '../Generator';
3. import Stylesheet from '../../css/Stylesheet';
4. import Block from './Block';
5. import visit from './visit';
6. import { removeNode, removeObjectKey } from '../../utils/removeNode';
7. import getName from '../../utils/getName';
8. import globalWhitelist from '../../utils/globalWhitelist';
9. import { Parsed, Node, CompileOptions } from '../../interfaces';
10. import { AppendTarget } from './interfaces';
11. import { stringify } from '../../utils/stringify';
12. 
13. export class SsrGenerator extends Generator {
14. 	bindings: string[];
15. 	renderCode: string;
16. 	appendTargets: AppendTarget[];
17. 
18. 	constructor(
19. 		parsed: Parsed,
20. 		source: string,
21. 		name: string,
22. 		stylesheet: Stylesheet,
23. 		options: CompileOptions
24. 	) {
25. 		super(parsed, source, name, stylesheet, options, false);
26. 		this.bindings = [];
27. 		this.renderCode = '';
28. 		this.appendTargets = [];
29. 
30. 		this.stylesheet.warnOnUnusedSelectors(options.onwarn);
31. 	}
32. 
33. 	append(code: string) {
34. 		if (this.appendTargets.length) {
35. 			const appendTarget = this.appendTargets[this.appendTargets.length - 1];
36. 			const slotName = appendTarget.slotStack[appendTarget.slotStack.length - 1];
37. 			appendTarget.slots[slotName] += code;
38. 		} else {
39. 			this.renderCode += code;
40. 		}
41. 	}
42. }
43. 
44. export default function ssr(
45. 	parsed: Parsed,
46. 	source: string,
47. 	stylesheet: Stylesheet,
48. 	options: CompileOptions
49. ) {
50. 	const format = options.format || 'cjs';
51. 
52. 	const generator = new SsrGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
53. 
54. 	const { computations, name, templateProperties } = generator;
55. 
56. 	// create main render() function
57. 	const mainBlock = new Block({
58. 		generator,
59. 		contexts: new Map(),
60. 		indexes: new Map(),
61. 		conditions: [],
62. 	});
63. 
64. 	trim(parsed.html.children).forEach((node: Node) => {
65. 		visit(generator, mainBlock, node);
66. 	});
67. 
68. 	const { css, cssMap } = generator.customElement ?
69. 		{ css: null, cssMap: null } :
70. 		generator.stylesheet.render(options.filename, true);
71. 
72. 	// generate initial state object
73. 	const expectedProperties = Array.from(generator.expectedProperties);
74. 	const globals = expectedProperties.filter(prop => globalWhitelist.has(prop));
75. 	const storeProps = options.store || templateProperties.store ? expectedProperties.filter(prop => prop[0] === '$') : [];
76. 
77. 	const initialState = [];
78. 	if (globals.length > 0) {
79. 		initialState.push(`{ ${globals.map(prop => `${prop} : ${prop}`).join(', ')} }`);
80. 	}
81. 
82. 	if (storeProps.length > 0) {
83. 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
84. 		if (options.store || templateProperties.store) {
85. 			initialState.push(`options.store.${initialize}`);
86. 		}
87. 	}
88. 
89. 	if (templateProperties.data) {
90. 		initialState.push(`%data()`);
91. 	} else if (globals.length === 0 && storeProps.length === 0) {
92. 		initialState.push('{}');
93. 	}
94. 
95. 	initialState.push('state');
96. 
97. 	// TODO concatenate CSS maps
98. 	const result = deindent`
99. 		${generator.javascript}
100. 
101. 		var ${name} = {};
102. 
103. 		${options.filename && `${name}.filename = ${stringify(options.filename)}`};
104. 
105. 		${name}.data = function() {
106. 			return ${templateProperties.data ? `%data()` : `{}`};
107. 		};
108. 
109. 		${name}.render = function(state, options = {}) {
110. 			var components = new Set();
111. 
112. 			function addComponent(component) {
113. 				components.add(component);
114. 			}
115. 
116. 			var result = { head: '', addComponent };
117. 			${templateProperties.store && `options.store = %store();`}
118. 			var html = ${name}._render(result, state, options);
119. 
120. 			var cssCode = Array.from(components).map(c => c.css && c.css.code).filter(Boolean).join('\\n');
121. 
122. 			return {
123. 				html,
124. 				head: result.head,
125. 				css: { code: cssCode, map: null },
126. 				toString() {
127. 					return html;
128. 				}
129. 			};
130. 		}
131. 
132. 		${name}._render = function(__result, state, options) {
133. 			__result.addComponent(${name});
134. 
135. 			state = Object.assign(${initialState.join(', ')});
136. 
137. 			${computations.map(
138. 				({ key, deps }) =>
139. 					`state.${key} = %computed-${key}(${deps.map(dep => `state.${dep}`).join(', ')});`
140. 			)}
141. 
142. 			${generator.bindings.length &&
143. 				deindent`
144. 				var settled = false;
145. 				var tmp;
146. 
147. 				while (!settled) {
148. 					settled = true;
149. 
150. 					${generator.bindings.join('\n\n')}
151. 				}
152. 			`}
153. 
154. 			return \`${generator.renderCode}\`;
155. 		};
156. 
157. 		${name}.css = {
158. 			code: ${css ? stringify(css) : `''`},
159. 			map: ${cssMap ? stringify(cssMap.toString()) : 'null'}
160. 		};
161. 
162. 		var warned = false;
163. 		${name}.renderCss = function() {
164. 			if (!warned) {
165. 				console.error('Component.renderCss(...) is deprecated and will be removed in v2 — use Component.render(...).css instead');
166. 				warned = true;
167. 			}
168. 
169. 			var components = [];
170. 
171. 			${generator.stylesheet.hasStyles &&
172. 				deindent`
173. 				components.push({
174. 					filename: ${name}.filename,
175. 					css: ${name}.css && ${name}.css.code,
176. 					map: ${name}.css && ${name}.css.map
177. 				});
178. 			`}
179. 
180. 			${templateProperties.components &&
181. 				deindent`
182. 				var seen = {};
183. 
184. 				function addComponent(component) {
185. 					var result = component.renderCss();
186. 					result.components.forEach(x => {
187. 						if (seen[x.filename]) return;
188. 						seen[x.filename] = true;
189. 						components.push(x);
190. 					});
191. 				}
192. 
193. 				${templateProperties.components.value.properties.map((prop: Node) => {
194. 					return `addComponent(%components-${getName(prop.key)});`;
195. 				})}
196. 			`}
197. 
198. 			return {
199. 				css: components.map(x => x.css).join('\\n'),
200. 				map: null,
201. 				components
202. 			};
203. 		};
204. 
205. 		${templateProperties.preload && `${name}.preload = %preload;`}
206. 
207. 		${
208. 			// TODO this is a bit hacky
209. 			/__escape/.test(generator.renderCode) && deindent`
210. 				var escaped = {
211. 					'"': '&quot;',
212. 					"'": '&##39;',
213. 					'&': '&amp;',
214. 					'<': '&lt;',
215. 					'>': '&gt;'
216. 				};
217. 
218. 				function __escape(html) {
219. 					return String(html).replace(/["'&<>]/g, match => escaped[match]);
220. 				}
221. 			`
222. 		}
223. 
224. 		${
225. 			/__isPromise/.test(generator.renderCode) && deindent`
226. 				function __isPromise(value) {
227. 					return value && typeof value.then === 'function';
228. 				}
229. 			`
230. 		}
231. 
232. 		${
233. 			/__missingComponent/.test(generator.renderCode) && deindent`
234. 				var __missingComponent = {
235. 					_render: () => ''
236. 				};
237. 			`
238. 		}
239. 	`.replace(/(@+|#+|%+)(\w*(?:-\w*)?)/g, (match: string, sigil: string, name: string) => {
240. 		if (sigil === '@') return generator.alias(name);
241. 		if (sigil === '%') return generator.templateVars.get(name);
242. 		return sigil.slice(1) + name;
243. 	});
244. 
245. 	return generator.generate(result, options, { name, format });
246. }
247. 
248. function trim(nodes) {
249. 	let start = 0;
250. 	for (; start < nodes.length; start += 1) {
251. 		const node = nodes[start];
252. 		if (node.type !== 'Text') break;
253. 
254. 		node.data = node.data.replace(/^\s+/, '');
255. 		if (node.data) break;
256. 	}
257. 
258. 	let end = nodes.length;
259. 	for (; end > start; end -= 1) {
260. 		const node = nodes[end - 1];
261. 		if (node.type !== 'Text') break;
262. 
263. 		node.data = node.data.replace(/\s+$/, '');
264. 		if (node.data) break;
265. 	}
266. 
267. 	return nodes.slice(start, end);
268. }


File: src/generators/server-side-rendering/visit.ts
Line number range: 1 - 13
Content:
1. import visitors from './visitors/index';
2. import { SsrGenerator } from './index';
3. import Block from './Block';
4. import { Node } from '../../interfaces';
5. 
6. export default function visit(
7. 	generator: SsrGenerator,
8. 	block: Block,
9. 	node: Node
10. ) {
11. 	const visitor = visitors[node.type];
12. 	visitor(generator, block, node);
13. }


File: src/generators/server-side-rendering/visitors/Component.ts
Line number range: 1 - 121
Content:
1. import flattenReference from '../../../utils/flattenReference';
2. import visit from '../visit';
3. import { SsrGenerator } from '../index';
4. import Block from '../Block';
5. import { AppendTarget } from '../interfaces';
6. import { Node } from '../../../interfaces';
7. import getObject from '../../../utils/getObject';
8. import getTailSnippet from '../../../utils/getTailSnippet';
9. import { stringify } from '../../../utils/stringify';
10. 
11. export default function visitComponent(
12. 	generator: SsrGenerator,
13. 	block: Block,
14. 	node: Node
15. ) {
16. 	function stringifyAttribute(chunk: Node) {
17. 		if (chunk.type === 'Text') return chunk.data;
18. 		if (chunk.type === 'MustacheTag') {
19. 			block.contextualise(chunk.expression);
20. 			const { snippet } = chunk.metadata;
21. 			return '${__escape( ' + snippet + ')}';
22. 		}
23. 	}
24. 
25. 	const attributes: Node[] = [];
26. 	const bindings: Node[] = [];
27. 
28. 	node.attributes.forEach((attribute: Node) => {
29. 		if (attribute.type === 'Attribute') {
30. 			attributes.push(attribute);
31. 		} else if (attribute.type === 'Binding') {
32. 			bindings.push(attribute);
33. 		}
34. 	});
35. 
36. 	const props = attributes
37. 		.map(attribute => {
38. 			let value;
39. 
40. 			if (attribute.value === true) {
41. 				value = `true`;
42. 			} else if (attribute.value.length === 0) {
43. 				value = `''`;
44. 			} else if (attribute.value.length === 1) {
45. 				const chunk = attribute.value[0];
46. 				if (chunk.type === 'Text') {
47. 					value = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;
48. 				} else {
49. 					block.contextualise(chunk.expression);
50. 					const { snippet } = chunk.metadata;
51. 					value = snippet;
52. 				}
53. 			} else {
54. 				value = '`' + attribute.value.map(stringifyAttribute).join('') + '`';
55. 			}
56. 
57. 			return `${attribute.name}: ${value}`;
58. 		})
59. 		.concat(
60. 			bindings.map(binding => {
61. 				const { name } = getObject(binding.value);
62. 				const tail = binding.value.type === 'MemberExpression'
63. 					? getTailSnippet(binding.value)
64. 					: '';
65. 
66. 				const keypath = block.contexts.has(name)
67. 					? `${name}${tail}`
68. 					: `state.${name}${tail}`;
69. 				return `${binding.name}: ${keypath}`;
70. 			})
71. 		)
72. 		.join(', ');
73. 
74. 	const isDynamicComponent = node.name === ':Component';
75. 	if (isDynamicComponent) block.contextualise(node.expression);
76. 
77. 	const expression = (
78. 		node.name === ':Self' ? generator.name :
79. 		isDynamicComponent ? `((${node.metadata.snippet}) || __missingComponent)` :
80. 		`%components-${node.name}`
81. 	);
82. 
83. 	bindings.forEach(binding => {
84. 		block.addBinding(binding, expression);
85. 	});
86. 
87. 	let open = `\${${expression}._render(__result, {${props}}`;
88. 
89. 	const options = [];
90. 	if (generator.options.store) {
91. 		options.push(`store: options.store`);
92. 	}
93. 
94. 	if (node.children.length) {
95. 		const appendTarget: AppendTarget = {
96. 			slots: { default: '' },
97. 			slotStack: ['default']
98. 		};
99. 
100. 		generator.appendTargets.push(appendTarget);
101. 
102. 		node.children.forEach((child: Node) => {
103. 			visit(generator, block, child);
104. 		});
105. 
106. 		const slotted = Object.keys(appendTarget.slots)
107. 			.map(name => `${name}: () => \`${appendTarget.slots[name]}\``)
108. 			.join(', ');
109. 
110. 		options.push(`slotted: { ${slotted} }`);
111. 
112. 		generator.appendTargets.pop();
113. 	}
114. 
115. 	if (options.length) {
116. 		open += `, { ${options.join(', ')} }`;
117. 	}
118. 
119. 	generator.append(open);
120. 	generator.append(')}');
121. }


File: src/generators/wrapModule.ts
Line number range: 1 - 299
Content:
1. import deindent from '../utils/deindent';
2. import list from '../utils/list';
3. import { CompileOptions, ModuleFormat, Node } from '../interfaces';
4. 
5. interface Dependency {
6. 	name: string;
7. 	statements: string[];
8. 	source: string;
9. }
10. 
11. const wrappers = { es, amd, cjs, iife, umd, eval: expr };
12. 
13. export default function wrapModule(
14. 	code: string,
15. 	format: ModuleFormat,
16. 	name: string,
17. 	options: CompileOptions,
18. 	banner: string,
19. 	sharedPath: string,
20. 	helpers: { name: string, alias: string }[],
21. 	imports: Node[],
22. 	source: string
23. ): string {
24. 	if (format === 'es') return es(code, name, options, banner, sharedPath, helpers, imports, source);
25. 
26. 	const dependencies = imports.map((declaration, i) => {
27. 		const defaultImport = declaration.specifiers.find(
28. 			(x: Node) =>
29. 				x.type === 'ImportDefaultSpecifier' ||
30. 				(x.type === 'ImportSpecifier' && x.imported.name === 'default')
31. 		);
32. 
33. 		const namespaceImport = declaration.specifiers.find(
34. 			(x: Node) => x.type === 'ImportNamespaceSpecifier'
35. 		);
36. 
37. 		const namedImports = declaration.specifiers.filter(
38. 			(x: Node) =>
39. 				x.type === 'ImportSpecifier' && x.imported.name !== 'default'
40. 		);
41. 
42. 		const name = defaultImport || namespaceImport
43. 			? (defaultImport || namespaceImport).local.name
44. 			: `__import${i}`;
45. 
46. 		const statements: string[] = [];
47. 
48. 		namedImports.forEach((specifier: Node) => {
49. 			statements.push(
50. 				`var ${specifier.local.name} = ${name}.${specifier.imported.name};`
51. 			);
52. 		});
53. 
54. 		if (defaultImport) {
55. 			statements.push(
56. 				`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`
57. 			);
58. 		}
59. 
60. 		return { name, statements, source: declaration.source.value };
61. 	});
62. 
63. 	if (format === 'amd') return amd(code, name, options, banner, dependencies);
64. 	if (format === 'cjs') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);
65. 	if (format === 'iife') return iife(code, name, options, banner, dependencies);
66. 	if (format === 'umd') return umd(code, name, options, banner, dependencies);
67. 	if (format === 'eval') return expr(code, name, options, banner, dependencies);
68. 
69. 	throw new Error(`options.format is invalid (must be ${list(Object.keys(wrappers))})`);
70. }
71. 
72. function es(
73. 	code: string,
74. 	name: string,
75. 	options: CompileOptions,
76. 	banner: string,
77. 	sharedPath: string,
78. 	helpers: { name: string, alias: string }[],
79. 	imports: Node[],
80. 	source: string
81. ) {
82. 	const importHelpers = helpers && (
83. 		`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(', ')} } from ${JSON.stringify(sharedPath)};`
84. 	);
85. 
86. 	const importBlock = imports.length > 0 && (
87. 		imports
88. 			.map((declaration: Node) => source.slice(declaration.start, declaration.end))
89. 			.join('\n')
90. 	);
91. 
92. 	return deindent`
93. 		${banner}
94. 		${importHelpers}
95. 		${importBlock}
96. 
97. 		${code}
98. 		export default ${name};`;
99. }
100. 
101. function amd(
102. 	code: string,
103. 	name: string,
104. 	options: CompileOptions,
105. 	banner: string,
106. 	dependencies: Dependency[]
107. ) {
108. 	const sourceString = dependencies.length
109. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
110. 		: '';
111. 
112. 	const id = options.amd && options.amd.id;
113. 
114. 	return deindent`
115. 		define(${id ? `"${id}", ` : ''}${sourceString}function(${paramString(dependencies)}) { "use strict";
116. 			${getCompatibilityStatements(dependencies)}
117. 
118. 			${code}
119. 			return ${name};
120. 		});`;
121. }
122. 
123. function cjs(
124. 	code: string,
125. 	name: string,
126. 	options: CompileOptions,
127. 	banner: string,
128. 	sharedPath: string,
129. 	helpers: { name: string, alias: string }[],
130. 	dependencies: Dependency[]
131. ) {
132. 	const SHARED = '__shared';
133. 	const helperBlock = helpers && (
134. 		`var ${SHARED} = require(${JSON.stringify(sharedPath)});\n` +
135. 		helpers.map(helper => {
136. 			return `var ${helper.alias} = ${SHARED}.${helper.name};`;
137. 		}).join('\n')
138. 	);
139. 
140. 	const requireBlock = dependencies.length > 0 && (
141. 		dependencies
142. 			.map(d => `var ${d.name} = require("${d.source}");`)
143. 			.join('\n\n')
144. 	);
145. 
146. 	return deindent`
147. 		${banner}
148. 		"use strict";
149. 
150. 		${helperBlock}
151. 		${requireBlock}
152. 		${getCompatibilityStatements(dependencies)}
153. 
154. 		${code}
155. 
156. 		module.exports = ${name};`
157. }
158. 
159. function iife(
160. 	code: string,
161. 	name: string,
162. 	options: CompileOptions,
163. 	banner: string,
164. 	dependencies: Dependency[]
165. ) {
166. 	if (!options.name) {
167. 		throw new Error(`Missing required 'name' option for IIFE export`);
168. 	}
169. 
170. 	const globals = getGlobals(dependencies, options);
171. 
172. 	return deindent`
173. 		${banner}
174. 		var ${options.name} = (function(${paramString(dependencies)}) { "use strict";
175. 			${getCompatibilityStatements(dependencies)}
176. 
177. 			${code}
178. 			return ${name};
179. 		}(${globals.join(', ')}));`;
180. }
181. 
182. function umd(
183. 	code: string,
184. 	name: string,
185. 	options: CompileOptions,
186. 	banner: string,
187. 	dependencies: Dependency[]
188. ) {
189. 	if (!options.name) {
190. 		throw new Error(`Missing required 'name' option for UMD export`);
191. 	}
192. 
193. 	const amdId = options.amd && options.amd.id ? `'${options.amd.id}', ` : '';
194. 
195. 	const amdDeps = dependencies.length
196. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
197. 		: '';
198. 
199. 	const cjsDeps = dependencies
200. 		.map(d => `require("${d.source}")`)
201. 		.join(', ');
202. 
203. 	const globals = getGlobals(dependencies, options);
204. 
205. 	return deindent`
206. 		${banner}
207. 		(function(global, factory) {
208. 			typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :
209. 			typeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :
210. 			(global.${options.name} = factory(${globals.join(', ')}));
211. 		}(this, (function (${paramString(dependencies)}) { "use strict";
212. 
213. 			${getCompatibilityStatements(dependencies)}
214. 
215. 			${code}
216. 
217. 			return ${name};
218. 
219. 		})));`;
220. }
221. 
222. function expr(
223. 	code: string,
224. 	name: string,
225. 	options: CompileOptions,
226. 	banner: string,
227. 	dependencies: Dependency[]
228. ) {
229. 	const globals = getGlobals(dependencies, options);
230. 
231. 	return deindent`
232. 		(function (${paramString(dependencies)}) { "use strict";
233. 			${banner}
234. 
235. 			${getCompatibilityStatements(dependencies)}
236. 
237. 			${code}
238. 
239. 			return ${name};
240. 		}(${globals.join(', ')}))`;
241. }
242. 
243. function paramString(dependencies: Dependency[]) {
244. 	return dependencies.map(dep => dep.name).join(', ');
245. }
246. 
247. function removeExtension(file: string) {
248. 	const index = file.lastIndexOf('.');
249. 	return ~index ? file.slice(0, index) : file;
250. }
251. 
252. function getCompatibilityStatements(dependencies: Dependency[]) {
253. 	if (!dependencies.length) return null;
254. 
255. 	const statements: string[] = [];
256. 
257. 	dependencies.forEach(dependency => {
258. 		statements.push(...dependency.statements);
259. 	});
260. 
261. 	return statements.join('\n');
262. }
263. 
264. function getGlobals(dependencies: Dependency[], options: CompileOptions) {
265. 	const { globals, onerror, onwarn } = options;
266. 	const globalFn = getGlobalFn(globals);
267. 
268. 	return dependencies.map(d => {
269. 		let name = globalFn(d.source);
270. 
271. 		if (!name) {
272. 			if (d.name.startsWith('__import')) {
273. 				const error = new Error(
274. 					`Could not determine name for imported module '${d.source}' – use options.globals`
275. 				);
276. 				onerror(error);
277. 			} else {
278. 				const warning = {
279. 					message: `No name was supplied for imported module '${d.source}'. Guessing '${d.name}', but you should use options.globals`,
280. 				};
281. 
282. 				onwarn(warning);
283. 			}
284. 
285. 			name = d.name;
286. 		}
287. 
288. 		return name;
289. 	});
290. }
291. 
292. function getGlobalFn(globals: any): (id: string) => string {
293. 	if (typeof globals === 'function') return globals;
294. 	if (typeof globals === 'object') {
295. 		return id => globals[id];
296. 	}
297. 
298. 	return () => undefined;
299. }


File: src/interfaces.ts
Line number range: 1 - 92
Content:
1. import {SourceMap} from 'magic-string';
2. 
3. export interface Node {
4. 	start: number;
5. 	end: number;
6. 	type: string;
7. 	[propName: string]: any;
8. }
9. 
10. export interface Parser {
11. 	readonly template: string;
12. 	readonly filename?: string;
13. 
14. 	index: number;
15. 	stack: Array<Node>;
16. 
17. 	html: Node;
18. 	css: Node;
19. 	js: Node;
20. 	metaTags: {};
21. }
22. 
23. export interface Parsed {
24. 	hash: number;
25. 	html: Node;
26. 	css: Node;
27. 	js: Node;
28. }
29. 
30. export interface Warning {
31. 	loc?: { line: number; column: number; pos?: number };
32. 	pos?: number;
33. 	message: string;
34. 	filename?: string;
35. 	frame?: string;
36. 	toString: () => string;
37. }
38. 
39. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';
40. 
41. export interface CompileOptions {
42. 	format?: ModuleFormat;
43. 	name?: string;
44. 	filename?: string;
45. 	generate?: string;
46. 	globals?: ((id: string) => string) | object;
47. 	amd?: {
48. 		id?: string;
49. 	};
50. 
51. 	outputFilename?: string;
52. 	cssOutputFilename?: string;
53. 
54. 	dev?: boolean;
55. 	shared?: boolean | string;
56. 	cascade?: boolean;
57. 	hydratable?: boolean;
58. 	legacy?: boolean;
59. 	customElement?: CustomElementOptions | true;
60. 	css?: boolean;
61. 	store?: boolean;
62. 
63. 	onerror?: (error: Error) => void;
64. 	onwarn?: (warning: Warning) => void;
65. }
66. 
67. export interface GenerateOptions {
68. 	name: string;
69. 	format: ModuleFormat;
70. 	banner?: string;
71. 	sharedPath?: string;
72. 	helpers?: { name: string, alias: string }[];
73. }
74. 
75. export interface Visitor {
76. 	enter: (node: Node) => void;
77. 	leave?: (node: Node) => void;
78. }
79. 
80. export interface CustomElementOptions {
81. 	tag?: string;
82. 	props?: string[];
83. }
84. 
85. export interface PreprocessOptions {
86. 	markup?: (options: {content: string, filename: string}) => { code: string, map?: SourceMap | string };
87. 	style?: Preprocessor;
88. 	script?: Preprocessor;
89. 	filename?: string
90. }
91. 
92. export type Preprocessor = (options: {content: string, attributes: Record<string, string | boolean>, filename?: string}) => { code: string, map?: SourceMap | string };


File: src/server-side-rendering/register.js
Line number range: 1 - 46
Content:
1. import * as fs from 'fs';
2. import * as path from 'path';
3. import { compile } from '../index.ts';
4. 
5. const compileOptions = {};
6. 
7. function capitalise(name) {
8. 	return name[0].toUpperCase() + name.slice(1);
9. }
10. 
11. export default function register(options) {
12. 	const { extensions } = options;
13. 
14. 	if (extensions) {
15. 		_deregister('.html');
16. 		extensions.forEach(_register);
17. 	}
18. 
19. 	// TODO make this the default and remove in v2
20. 	if ('store' in options) compileOptions.store = options.store;
21. }
22. 
23. function _deregister(extension) {
24. 	delete require.extensions[extension];
25. }
26. 
27. function _register(extension) {
28. 	require.extensions[extension] = function(module, filename) {
29. 		const name = path.basename(filename)
30. 			.slice(0, -path.extname(filename).length)
31. 			.replace(/^\d/, '_$&')
32. 			.replace(/[^a-zA-Z0-9_$]/g, '');
33. 
34. 		const options = Object.assign({}, compileOptions, {
35. 			filename,
36. 			name: capitalise(name),
37. 			generate: 'ssr'
38. 		});
39. 
40. 		const {code} = compile(fs.readFileSync(filename, 'utf-8'), options);
41. 
42. 		return module._compile(code, filename);
43. 	};
44. }
45. 
46. _register('.html');


File: store.js
Line number range: 1 - 164
Content:
1. import {
2. 	assign,
3. 	blankObject,
4. 	differs,
5. 	dispatchObservers,
6. 	get,
7. 	observe
8. } from './shared.js';
9. 
10. function Store(state) {
11. 	this._observers = { pre: blankObject(), post: blankObject() };
12. 	this._changeHandlers = [];
13. 	this._dependents = [];
14. 
15. 	this._computed = blankObject();
16. 	this._sortedComputedProperties = [];
17. 
18. 	this._state = assign({}, state);
19. }
20. 
21. assign(Store.prototype, {
22. 	_add: function(component, props) {
23. 		this._dependents.push({
24. 			component: component,
25. 			props: props
26. 		});
27. 	},
28. 
29. 	_init: function(props) {
30. 		var state = {};
31. 		for (var i = 0; i < props.length; i += 1) {
32. 			var prop = props[i];
33. 			state['$' + prop] = this._state[prop];
34. 		}
35. 		return state;
36. 	},
37. 
38. 	_remove: function(component) {
39. 		var i = this._dependents.length;
40. 		while (i--) {
41. 			if (this._dependents[i].component === component) {
42. 				this._dependents.splice(i, 1);
43. 				return;
44. 			}
45. 		}
46. 	},
47. 
48. 	_sortComputedProperties: function() {
49. 		var computed = this._computed;
50. 		var sorted = this._sortedComputedProperties = [];
51. 		var cycles;
52. 		var visited = blankObject();
53. 
54. 		function visit(key) {
55. 			if (cycles[key]) {
56. 				throw new Error('Cyclical dependency detected');
57. 			}
58. 
59. 			if (visited[key]) return;
60. 			visited[key] = true;
61. 
62. 			var c = computed[key];
63. 
64. 			if (c) {
65. 				cycles[key] = true;
66. 				c.deps.forEach(visit);
67. 				sorted.push(c);
68. 			}
69. 		}
70. 
71. 		for (var key in this._computed) {
72. 			cycles = blankObject();
73. 			visit(key);
74. 		}
75. 	},
76. 
77. 	compute: function(key, deps, fn) {
78. 		var store = this;
79. 		var value;
80. 
81. 		var c = {
82. 			deps: deps,
83. 			update: function(state, changed, dirty) {
84. 				var values = deps.map(function(dep) {
85. 					if (dep in changed) dirty = true;
86. 					return state[dep];
87. 				});
88. 
89. 				if (dirty) {
90. 					var newValue = fn.apply(null, values);
91. 					if (differs(newValue, value)) {
92. 						value = newValue;
93. 						changed[key] = true;
94. 						state[key] = value;
95. 					}
96. 				}
97. 			}
98. 		};
99. 
100. 		c.update(this._state, {}, true);
101. 
102. 		this._computed[key] = c;
103. 		this._sortComputedProperties();
104. 	},
105. 
106. 	get: get,
107. 
108. 	observe: observe,
109. 
110. 	onchange: function(callback) {
111. 		this._changeHandlers.push(callback);
112. 		return {
113. 			cancel: function() {
114. 				var index = this._changeHandlers.indexOf(callback);
115. 				if (~index) this._changeHandlers.splice(index, 1);
116. 			}
117. 		};
118. 	},
119. 
120. 	set: function(newState) {
121. 		var oldState = this._state,
122. 			changed = this._changed = {},
123. 			dirty = false;
124. 
125. 		for (var key in newState) {
126. 			if (this._computed[key]) throw new Error("'" + key + "' is a read-only property");
127. 			if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
128. 		}
129. 		if (!dirty) return;
130. 
131. 		this._state = assign({}, oldState, newState);
132. 
133. 		for (var i = 0; i < this._sortedComputedProperties.length; i += 1) {
134. 			this._sortedComputedProperties[i].update(this._state, changed);
135. 		}
136. 
137. 		for (var i = 0; i < this._changeHandlers.length; i += 1) {
138. 			this._changeHandlers[i](this._state, changed);
139. 		}
140. 
141. 		dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
142. 
143. 		var dependents = this._dependents.slice(); // guard against mutations
144. 		for (var i = 0; i < dependents.length; i += 1) {
145. 			var dependent = dependents[i];
146. 			var componentState = {};
147. 			dirty = false;
148. 
149. 			for (var j = 0; j < dependent.props.length; j += 1) {
150. 				var prop = dependent.props[j];
151. 				if (prop in changed) {
152. 					componentState['$' + prop] = this._state[prop];
153. 					dirty = true;
154. 				}
155. 			}
156. 
157. 			if (dirty) dependent.component.set(componentState);
158. 		}
159. 
160. 		dispatchObservers(this, this._observers.post, changed, this._state, oldState);
161. 	}
162. });
163. 
164. export { Store };


File: test/server-side-rendering/index.js
Line number range: 1 - 132
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require("../../ssr/register")({
25. 			extensions: ['.svelte', '.html'],
26. 			store: true
27. 		});
28. 
29. 		return setupHtmlEqual();
30. 	});
31. 
32. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
33. 		if (dir[0] === ".") return;
34. 
35. 		// add .solo to a sample directory name to only run that test, or
36. 		// .show to always show the output. or both
37. 		const solo = /\.solo/.test(dir);
38. 		const show = /\.show/.test(dir);
39. 
40. 		if (solo && process.env.CI) {
41. 			throw new Error("Forgot to remove `solo: true` from test");
42. 		}
43. 
44. 		(solo ? it.only : it)(dir, () => {
45. 			dir = path.resolve("test/server-side-rendering/samples", dir);
46. 			try {
47. 				let component;
48. 
49. 				const mainHtmlFile = `${dir}/main.html`;
50. 				const mainSvelteFile = `${dir}/main.svelte`;
51. 				if (fs.existsSync(mainHtmlFile)) {
52. 					component = require(mainHtmlFile);
53. 				} else if (fs.existsSync(mainSvelteFile)) {
54. 					component = require(mainSvelteFile);
55. 				}
56. 
57. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
58. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
59. 
60. 				const data = tryToLoadJson(`${dir}/data.json`);
61. 
62. 				const rendered = component.render(data);
63. 				const { html, css, head } = rendered;
64. 
65. 				// rendered.toString() === rendered.html
66. 				assert.equal(rendered, html);
67. 
68. 				fs.writeFileSync(`${dir}/_actual.html`, html);
69. 				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);
70. 
71. 				assert.htmlEqual(html, expectedHtml);
72. 				assert.equal(
73. 					css.code.replace(/^\s+/gm, ""),
74. 					expectedCss.replace(/^\s+/gm, "")
75. 				);
76. 
77. 				if (fs.existsSync(`${dir}/_expected-head.html`)) {
78. 					fs.writeFileSync(`${dir}/_actual-head.html`, head);
79. 					assert.htmlEqual(
80. 						head,
81. 						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
82. 					);
83. 				}
84. 
85. 				if (show) showOutput(dir, { generate: 'ssr' });
86. 			} catch (err) {
87. 				showOutput(dir, { generate: 'ssr' });
88. 				throw err;
89. 			}
90. 		});
91. 	});
92. 
93. 	// duplicate client-side tests, as far as possible
94. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
95. 		if (dir[0] === ".") return;
96. 
97. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
98. 
99. 		if (config.solo && process.env.CI) {
100. 			throw new Error("Forgot to remove `solo: true` from test");
101. 		}
102. 
103. 		if (config["skip-ssr"]) return;
104. 
105. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
106. 			const cwd = path.resolve("test/runtime/samples", dir);
107. 
108. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
109. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
110. 				delete require.cache[resolved];
111. 			});
112. 
113. 			require("../../ssr/register")({
114. 				store: !!config.store
115. 			});
116. 
117. 			try {
118. 				const component = require(`../runtime/samples/${dir}/main.html`);
119. 				const { html } = component.render(config.data, {
120. 					store: (config.store !== true) && config.store
121. 				});
122. 
123. 				if (config.html) {
124. 					assert.htmlEqual(html, config.html);
125. 				}
126. 			} catch (err) {
127. 				showOutput(cwd, { generate: "ssr" });
128. 				throw err;
129. 			}
130. 		});
131. 	});
132. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 14:00:08,005 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We have the SSR generator and the Component visitor showing that nested components call _render and only pass parent options.store when a global flag is set, which causes failures when a child defines its own store. To fix this, we must know how templateProperties and templateVars expose store functions and component imports, and whether a child component’s store initializer can be referenced from the parent’s SSR output. These definitions likely live in the base Generator class and the SSR visitors index.' query='Please provide the full contents of src/generators/Generator.ts and src/generators/server-side-rendering/visitors/index.ts.' extra_requirements='If full files are too large, include specifically how templateProperties and templateVars are constructed, how components are registered/imported, and any mechanism that exposes a component’s store initializer for SSR.' purpose='To determine how to reference a child component’s store initializer in SSR and fix nested component store propagation.'
2025-11-12 14:00:08,007 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full contents of src/generators/Generator.ts and src/generators/server-side-rendering/visitors/index.ts.
2025-11-12 14:00:10,683 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: [{'query_essential_query': 'Please provide the full contents of src/generators/wrapModule.ts and src/generators/server-side-rendering/visit.ts.', 'query_extra_requirements': 'If full files are too large, include at minimum how templateProperties.store and templateVars are created/exposed and the code path that builds nested component options for SSR.', 'query_purpose': 'To verify how a component’s store function is exposed and ensure SSR nested component calls initialize their own store instead of relying solely on the parent’s options.store, enabling a precise bug fix.', 'memory_context_contexts': [{'relative_path': 'src/generators/wrapModule.ts', 'content': '1. import deindent from \'../utils/deindent\';\n2. import list from \'../utils/list\';\n3. import { CompileOptions, ModuleFormat, Node } from \'../interfaces\';\n4. \n5. interface Dependency {\n6. \tname: string;\n7. \tstatements: string[];\n8. \tsource: string;\n9. }\n10. \n11. const wrappers = { es, amd, cjs, iife, umd, eval: expr };\n12. \n13. export default function wrapModule(\n14. \tcode: string,\n15. \tformat: ModuleFormat,\n16. \tname: string,\n17. \toptions: CompileOptions,\n18. \tbanner: string,\n19. \tsharedPath: string,\n20. \thelpers: { name: string, alias: string }[],\n21. \timports: Node[],\n22. \tsource: string\n23. ): string {\n24. \tif (format === \'es\') return es(code, name, options, banner, sharedPath, helpers, imports, source);\n25. \n26. \tconst dependencies = imports.map((declaration, i) => {\n27. \t\tconst defaultImport = declaration.specifiers.find(\n28. \t\t\t(x: Node) =>\n29. \t\t\t\tx.type === \'ImportDefaultSpecifier\' ||\n30. \t\t\t\t(x.type === \'ImportSpecifier\' && x.imported.name === \'default\')\n31. \t\t);\n32. \n33. \t\tconst namespaceImport = declaration.specifiers.find(\n34. \t\t\t(x: Node) => x.type === \'ImportNamespaceSpecifier\'\n35. \t\t);\n36. \n37. \t\tconst namedImports = declaration.specifiers.filter(\n38. \t\t\t(x: Node) =>\n39. \t\t\t\tx.type === \'ImportSpecifier\' && x.imported.name !== \'default\'\n40. \t\t);\n41. \n42. \t\tconst name = defaultImport || namespaceImport\n43. \t\t\t? (defaultImport || namespaceImport).local.name\n44. \t\t\t: `__import${i}`;\n45. \n46. \t\tconst statements: string[] = [];\n47. \n48. \t\tnamedImports.forEach((specifier: Node) => {\n49. \t\t\tstatements.push(\n50. \t\t\t\t`var ${specifier.local.name} = ${name}.${specifier.imported.name};`\n51. \t\t\t);\n52. \t\t});\n53. \n54. \t\tif (defaultImport) {\n55. \t\t\tstatements.push(\n56. \t\t\t\t`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`\n57. \t\t\t);\n58. \t\t}\n59. \n60. \t\treturn { name, statements, source: declaration.source.value };\n61. \t});\n62. \n63. \tif (format === \'amd\') return amd(code, name, options, banner, dependencies);\n64. \tif (format === \'cjs\') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);\n65. \tif (format === \'iife\') return iife(code, name, options, banner, dependencies);\n66. \tif (format === \'umd\') return umd(code, name, options, banner, dependencies);\n67. \tif (format === \'eval\') return expr(code, name, options, banner, dependencies);\n68. \n69. \tthrow new Error(`options.format is invalid (must be ${list(Object.keys(wrappers))})`);\n70. }\n71. \n72. function es(\n73. \tcode: string,\n74. \tname: string,\n75. \toptions: CompileOptions,\n76. \tbanner: string,\n77. \tsharedPath: string,\n78. \thelpers: { name: string, alias: string }[],\n79. \timports: Node[],\n80. \tsource: string\n81. ) {\n82. \tconst importHelpers = helpers && (\n83. \t\t`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(\', \')} } from ${JSON.stringify(sharedPath)};`\n84. \t);\n85. \n86. \tconst importBlock = imports.length > 0 && (\n87. \t\timports\n88. \t\t\t.map((declaration: Node) => source.slice(declaration.start, declaration.end))\n89. \t\t\t.join(\'\\n\')\n90. \t);\n91. \n92. \treturn deindent`\n93. \t\t${banner}\n94. \t\t${importHelpers}\n95. \t\t${importBlock}\n96. \n97. \t\t${code}\n98. \t\texport default ${name};`;\n99. }\n100. \n101. function amd(\n102. \tcode: string,\n103. \tname: string,\n104. \toptions: CompileOptions,\n105. \tbanner: string,\n106. \tdependencies: Dependency[]\n107. ) {\n108. \tconst sourceString = dependencies.length\n109. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n110. \t\t: \'\';\n111. \n112. \tconst id = options.amd && options.amd.id;\n113. \n114. \treturn deindent`\n115. \t\tdefine(${id ? `"${id}", ` : \'\'}${sourceString}function(${paramString(dependencies)}) { "use strict";\n116. \t\t\t${getCompatibilityStatements(dependencies)}\n117. \n118. \t\t\t${code}\n119. \t\t\treturn ${name};\n120. \t\t});`;\n121. }\n122. \n123. function cjs(\n124. \tcode: string,\n125. \tname: string,\n126. \toptions: CompileOptions,\n127. \tbanner: string,\n128. \tsharedPath: string,\n129. \thelpers: { name: string, alias: string }[],\n130. \tdependencies: Dependency[]\n131. ) {\n132. \tconst SHARED = \'__shared\';\n133. \tconst helperBlock = helpers && (\n134. \t\t`var ${SHARED} = require(${JSON.stringify(sharedPath)});\\n` +\n135. \t\thelpers.map(helper => {\n136. \t\t\treturn `var ${helper.alias} = ${SHARED}.${helper.name};`;\n137. \t\t}).join(\'\\n\')\n138. \t);\n139. \n140. \tconst requireBlock = dependencies.length > 0 && (\n141. \t\tdependencies\n142. \t\t\t.map(d => `var ${d.name} = require("${d.source}");`)\n143. \t\t\t.join(\'\\n\\n\')\n144. \t);\n145. \n146. \treturn deindent`\n147. \t\t${banner}\n148. \t\t"use strict";\n149. \n150. \t\t${helperBlock}\n151. \t\t${requireBlock}\n152. \t\t${getCompatibilityStatements(dependencies)}\n153. \n154. \t\t${code}\n155. \n156. \t\tmodule.exports = ${name};`\n157. }\n158. \n159. function iife(\n160. \tcode: string,\n161. \tname: string,\n162. \toptions: CompileOptions,\n163. \tbanner: string,\n164. \tdependencies: Dependency[]\n165. ) {\n166. \tif (!options.name) {\n167. \t\tthrow new Error(`Missing required \'name\' option for IIFE export`);\n168. \t}\n169. \n170. \tconst globals = getGlobals(dependencies, options);\n171. \n172. \treturn deindent`\n173. \t\t${banner}\n174. \t\tvar ${options.name} = (function(${paramString(dependencies)}) { "use strict";\n175. \t\t\t${getCompatibilityStatements(dependencies)}\n176. \n177. \t\t\t${code}\n178. \t\t\treturn ${name};\n179. \t\t}(${globals.join(\', \')}));`;\n180. }\n181. \n182. function umd(\n183. \tcode: string,\n184. \tname: string,\n185. \toptions: CompileOptions,\n186. \tbanner: string,\n187. \tdependencies: Dependency[]\n188. ) {\n189. \tif (!options.name) {\n190. \t\tthrow new Error(`Missing required \'name\' option for UMD export`);\n191. \t}\n192. \n193. \tconst amdId = options.amd && options.amd.id ? `\'${options.amd.id}\', ` : \'\';\n194. \n195. \tconst amdDeps = dependencies.length\n196. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n197. \t\t: \'\';\n198. \n199. \tconst cjsDeps = dependencies\n200. \t\t.map(d => `require("${d.source}")`)\n201. \t\t.join(\', \');\n202. \n203. \tconst globals = getGlobals(dependencies, options);\n204. \n205. \treturn deindent`\n206. \t\t${banner}\n207. \t\t(function(global, factory) {\n208. \t\t\ttypeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :\n209. \t\t\ttypeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :\n210. \t\t\t(global.${options.name} = factory(${globals.join(\', \')}));\n211. \t\t}(this, (function (${paramString(dependencies)}) { "use strict";\n212. \n213. \t\t\t${getCompatibilityStatements(dependencies)}\n214. \n215. \t\t\t${code}\n216. \n217. \t\t\treturn ${name};\n218. \n219. \t\t})));`;\n220. }\n221. \n222. function expr(\n223. \tcode: string,\n224. \tname: string,\n225. \toptions: CompileOptions,\n226. \tbanner: string,\n227. \tdependencies: Dependency[]\n228. ) {\n229. \tconst globals = getGlobals(dependencies, options);\n230. \n231. \treturn deindent`\n232. \t\t(function (${paramString(dependencies)}) { "use strict";\n233. \t\t\t${banner}\n234. \n235. \t\t\t${getCompatibilityStatements(dependencies)}\n236. \n237. \t\t\t${code}\n238. \n239. \t\t\treturn ${name};\n240. \t\t}(${globals.join(\', \')}))`;\n241. }\n242. \n243. function paramString(dependencies: Dependency[]) {\n244. \treturn dependencies.map(dep => dep.name).join(\', \');\n245. }\n246. \n247. function removeExtension(file: string) {\n248. \tconst index = file.lastIndexOf(\'.\');\n249. \treturn ~index ? file.slice(0, index) : file;\n250. }\n251. \n252. function getCompatibilityStatements(dependencies: Dependency[]) {\n253. \tif (!dependencies.length) return null;\n254. \n255. \tconst statements: string[] = [];\n256. \n257. \tdependencies.forEach(dependency => {\n258. \t\tstatements.push(...dependency.statements);\n259. \t});\n260. \n261. \treturn statements.join(\'\\n\');\n262. }\n263. \n264. function getGlobals(dependencies: Dependency[], options: CompileOptions) {\n265. \tconst { globals, onerror, onwarn } = options;\n266. \tconst globalFn = getGlobalFn(globals);\n267. \n268. \treturn dependencies.map(d => {\n269. \t\tlet name = globalFn(d.source);\n270. \n271. \t\tif (!name) {\n272. \t\t\tif (d.name.startsWith(\'__import\')) {\n273. \t\t\t\tconst error = new Error(\n274. \t\t\t\t\t`Could not determine name for imported module \'${d.source}\' – use options.globals`\n275. \t\t\t\t);\n276. \t\t\t\tonerror(error);\n277. \t\t\t} else {\n278. \t\t\t\tconst warning = {\n279. \t\t\t\t\tmessage: `No name was supplied for imported module \'${d.source}\'. Guessing \'${d.name}\', but you should use options.globals`,\n280. \t\t\t\t};\n281. \n282. \t\t\t\tonwarn(warning);\n283. \t\t\t}\n284. \n285. \t\t\tname = d.name;\n286. \t\t}\n287. \n288. \t\treturn name;\n289. \t});\n290. }\n291. \n292. function getGlobalFn(globals: any): (id: string) => string {\n293. \tif (typeof globals === \'function\') return globals;\n294. \tif (typeof globals === \'object\') {\n295. \t\treturn id => globals[id];\n296. \t}\n297. \n298. \treturn () => undefined;\n299. }', 'start_line_number': 1, 'end_line_number': 299}, {'relative_path': 'src/generators/server-side-rendering/visit.ts', 'content': "1. import visitors from './visitors/index';\n2. import { SsrGenerator } from './index';\n3. import Block from './Block';\n4. import { Node } from '../../interfaces';\n5. \n6. export default function visit(\n7. \tgenerator: SsrGenerator,\n8. \tblock: Block,\n9. \tnode: Node\n10. ) {\n11. \tconst visitor = visitors[node.type];\n12. \tvisitor(generator, block, node);\n13. }", 'start_line_number': 1, 'end_line_number': 13}]}]
2025-11-12 14:00:10,684 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 1 memories from memory
2025-11-12 14:00:10,684 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 2 contexts from memory
2025-11-12 14:00:10,684 - thread-135845298308800.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 2 contexts from memory
2025-11-12 14:00:10,686 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 2 new contexts to 10 existing contexts
2025-11-12 14:00:10,686 - thread-135845298308800.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 10 total contexts (removed 2 duplicates)
2025-11-12 14:00:10,689 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
svelte
├── .github
|   ├── ISSUE_TEMPLATE.md
|   └── PULL_REQUEST_TEMPLATE.md
├── .travis.yml
├── CHANGELOG.md
├── README.md
├── appveyor.yml
├── rollup.config.js
├── rollup.store.config.js
├── src
|   ├── config.ts
|   ├── css
|   |   ├── Selector.ts
|   |   ├── Stylesheet.ts
|   |   └── gatherPossibleValues.ts
|   ├── generators
|   |   ├── Generator.ts
|   |   ├── dom
|   |   |   ├── Block.ts
|   |   |   └── index.ts
|   |   ├── nodes
|   |   |   ├── Attribute.ts
|   |   |   ├── AwaitBlock.ts
|   |   |   ├── Binding.ts
|   |   |   ├── CatchBlock.ts
|   |   |   ├── Comment.ts
|   |   |   ├── Component.ts
|   |   |   ├── EachBlock.ts
|   |   |   ├── Element.ts
|   |   |   ├── ElseBlock.ts
|   |   |   ├── EventHandler.ts
|   |   |   ├── Fragment.ts
|   |   |   ├── Head.ts
|   |   |   ├── IfBlock.ts
|   |   |   ├── MustacheTag.ts
|   |   |   ├── PendingBlock.ts
|   |   |   ├── RawMustacheTag.ts
|   |   |   ├── Ref.ts
|   |   |   ├── Slot.ts
|   |   |   ├── Text.ts
|   |   |   ├── ThenBlock.ts
|   |   |   ├── Title.ts
|   |   |   ├── Transition.ts
|   |   |   ├── Window.ts
|   |   |   ├── index.ts
|   |   |   └── shared
|   |   |       ├── Node.ts
|   |   |       └── Tag.ts
|   |   ├── server-side-rendering
|   |   |   ├── Block.ts
|   |   |   ├── index.ts
|   |   |   ├── interfaces.ts
|   |   |   ├── visit.ts
|   |   |   └── visitors
|   |   |       ├── AwaitBlock.ts
|   |   |       ├── Comment.ts
|   |   |       ├── Component.ts
|   |   |       ├── EachBlock.ts
|   |   |       ├── Element.ts
|   |   |       ├── Head.ts
|   |   |       ├── IfBlock.ts
|   |   |       ├── MustacheTag.ts
|   |   |       ├── RawMustacheTag.ts
|   |   |       ├── Slot.ts
|   |   |       ├── Text.ts
|   |   |       ├── Title.ts
|   |   |       ├── Window.ts
|   |   |       ├── index.ts
|   |   |       └── shared
|   |   └── wrapModule.ts
|   ├── index.ts
|   ├── interfaces.ts
|   ├── parse
|   |   ├── index.ts
|   |   ├── read
|   |   |   ├── directives.ts
|   |   |   ├── expression.ts
|   |   |   ├── script.ts
|   |   |   └── style.ts
|   |   ├── state
|   |   |   ├── fragment.ts
|   |   |   ├── mustache.ts
|   |   |   ├── tag.ts
|   |   |   └── text.ts
|   |   └── utils
|   |       ├── entities.ts
|   |       ├── hash.ts
|   |       └── html.ts
|   ├── server-side-rendering
|   |   └── register.js
|   ├── shared
|   |   ├── _build.js
|   |   ├── dom.js
|   |   ├── index.js
|   |   ├── transitions.js
|   |   └── utils.js
|   ├── utils
|   |   ├── CodeBuilder.ts
|   |   ├── CompileError.ts
|   |   ├── __test__.ts
|   |   ├── annotateWithScopes.ts
|   |   ├── clone.ts
|   |   ├── createDebuggingComment.ts
|   |   ├── deindent.ts
|   |   ├── flattenReference.ts
|   |   ├── getCodeFrame.ts
|   |   ├── getExpressionPrecedence.ts
|   |   ├── getName.ts
|   |   ├── getObject.ts
|   |   ├── getStaticAttributeValue.ts
|   |   ├── getTailSnippet.ts
|   |   ├── globalWhitelist.ts
|   |   ├── isReference.ts
|   |   ├── isThisGetCallExpression.ts
|   |   ├── isVoidElementName.ts
|   |   ├── list.ts
|   |   ├── namespaces.ts
|   |   ├── patterns.ts
|   |   ├── removeNode.ts
|   |   ├── repeat.ts
|   |   ├── reservedNames.ts
|   |   ├── stringify.ts
|   |   ├── stringifyProps.ts
|   |   ├── trim.ts
|   |   ├── validCalleeObjects.ts
|   |   └── walkThroughTopFunctionScope.ts
|   └── validate
|       ├── html
|       |   ├── a11y.ts
|       |   ├── index.ts
|       |   ├── validateElement.ts
|       |   ├── validateEventHandler.ts
|       |   ├── validateHead.ts
|       |   └── validateWindow.ts
|       ├── index.ts
|       ├── js
|       |   ├── index.ts
|       |   ├── propValidators
|       |   |   ├── components.ts
|       |   |   ├── computed.ts
|       |   |   ├── data.ts
|       |   |   ├── events.ts
|       |   |   ├── helpers.ts
|       |   |   ├── index.ts
|       |   |   ├── methods.ts
|       |   |   ├── namespace.ts
|       |   |   ├── oncreate.ts
|       |   |   ├── ondestroy.ts
|       |   |   ├── onrender.ts
|       |   |   ├── onteardown.ts
|       |   |   ├── preload.ts
|       |   |   ├── props.ts
|       |   |   ├── setup.ts
|       |   |   ├── store.ts
|       |   |   ├── tag.ts
|       |   |   └── transitions.ts
|       |   └── utils
|       |       ├── checkForAccessors.ts
|       |       ├── checkForComputedKeys.ts
|       |       ├── checkForDupes.ts
|       |       └── usesThisOrArguments.ts
|       └── utils
|           ├── FuzzySet.ts
|           └── fuzzymatch.ts
├── store.js
└── test
    ├── create
    |   └── index.js
    ├── css
    |   ├── index.js
    |   └── samples
    |       ├── attribute-selector-only-name
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── attribute-selector-unquoted
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── basic
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-global-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-keyframes-from-to
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-pseudo-element
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── cascade-false-universal-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── combinator-child
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── css-vars
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── descendant-selector-non-top-level-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── empty-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── keyframes
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── media-query-word
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── omit-scoping-attribute
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-contains
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-case-insensitive
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-equals-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-pipe-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-prefix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-suffix
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-attribute-selector-word-equals
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-dynamic
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-class-static
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-class
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-inner-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-descendant-global-outer-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-global
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-id
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── omit-scoping-attribute-whitespace-multiple
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── refs-qualified
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── universal-selector
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unknown-at-rule
    |       |   ├── expected.css
    |       |   └── input.html
    |       ├── unused-selector
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       ├── unused-selector-leading
    |       |   ├── _config.js
    |       |   ├── expected.css
    |       |   ├── expected.html
    |       |   └── input.html
    |       └── unused-selector-ternary
    |           ├── _config.js
    |           ├── expected.css
    |           ├── expected.html
    |           └── input.html
    ├── custom-elements
    |   ├── assert.js
    |   ├── index.js
    |   └── samples
    |       ├── escaped-css
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── html-slots
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── nested
    |       |   ├── Counter.html
    |       |   ├── main.html
    |       |   └── test.js
    |       ├── new
    |       |   ├── main.html
    |       |   └── test.js
    |       └── new-styled
    |           ├── main.html
    |           └── test.js
    ├── formats
    |   └── index.js
    ├── helpers.js
    ├── hydration
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-in-element
    |       |   ├── Nested.html
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-text-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-arg-clash
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-added
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-changed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-removed
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-attribute-unchanged
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-nested
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-ref
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-anchor
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-update
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw
    |       |   ├── _after.html
    |       |   ├── _before.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── top-level-text
    |           ├── _after.html
    |           ├── _before.html
    |           ├── _config.js
    |           └── main.html
    ├── js
    |   ├── README.md
    |   ├── index.js
    |   ├── samples
    |   |   ├── collapses-text-around-comments
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── component-static
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── computed-collapsed-if
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-media-query
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── css-shadow-dom-keyframes
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── deconflict-globals
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── do-use-dataset
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-legacy
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── dont-use-dataset-in-svg
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── each-block-changed-check
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── event-handlers-custom
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── head-no-whitespace
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-no-update
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── if-block-simple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-multiple
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-optimized-url
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── inline-style-unoptimized
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── input-without-blowback-guard
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-input-type
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── legacy-quote-class
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── media-bindings
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── non-imported-component
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── onrender-onteardown-rewritten
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── setup-method
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── ssr-no-oncreate-etc
    |   |   |   ├── _config.js
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── svg-title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── title
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   ├── use-elements-as-anchors
    |   |   |   ├── expected-bundle.js
    |   |   |   ├── expected.js
    |   |   |   └── input.html
    |   |   └── window-binding-scroll
    |   |       ├── expected-bundle.js
    |   |       ├── expected.js
    |   |       └── input.html
    |   └── update.js
    ├── parser
    |   ├── index.js
    |   ├── samples
    |   |   ├── attribute-dynamic
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-dynamic-reserved
    |   |   |   └── input.html
    |   |   ├── attribute-escaped
    |   |   |   └── input.html
    |   |   ├── attribute-multiple
    |   |   |   └── input.html
    |   |   ├── attribute-shorthand
    |   |   |   └── input.html
    |   |   ├── attribute-static
    |   |   |   └── input.html
    |   |   ├── attribute-static-boolean
    |   |   |   └── input.html
    |   |   ├── attribute-unique-error
    |   |   |   └── input.html
    |   |   ├── attribute-unquoted
    |   |   |   └── input.html
    |   |   ├── await-then-catch
    |   |   |   └── input.html
    |   |   ├── binding
    |   |   |   └── input.html
    |   |   ├── binding-shorthand
    |   |   |   └── input.html
    |   |   ├── comment
    |   |   |   └── input.html
    |   |   ├── component-dynamic
    |   |   |   └── input.html
    |   |   ├── convert-entities
    |   |   |   └── input.html
    |   |   ├── convert-entities-in-element
    |   |   |   └── input.html
    |   |   ├── css
    |   |   |   └── input.html
    |   |   ├── css-ref-selector
    |   |   |   └── input.html
    |   |   ├── dynamic-import
    |   |   |   └── input.html
    |   |   ├── each-block
    |   |   |   └── input.html
    |   |   ├── each-block-destructured
    |   |   |   └── input.html
    |   |   ├── each-block-else
    |   |   |   └── input.html
    |   |   ├── each-block-indexed
    |   |   |   └── input.html
    |   |   ├── each-block-keyed
    |   |   |   └── input.html
    |   |   ├── element-with-mustache
    |   |   |   └── input.html
    |   |   ├── element-with-text
    |   |   |   └── input.html
    |   |   ├── elements
    |   |   |   └── input.html
    |   |   ├── error-binding-disabled
    |   |   |   └── input.html
    |   |   ├── error-binding-mustaches
    |   |   |   └── input.html
    |   |   ├── error-binding-rvalue
    |   |   |   └── input.html
    |   |   ├── error-css
    |   |   |   └── input.html
    |   |   ├── error-event-handler
    |   |   |   └── input.html
    |   |   ├── error-illegal-expression
    |   |   |   └── input.html
    |   |   ├── error-multiple-styles
    |   |   |   └── input.html
    |   |   ├── error-script-unclosed
    |   |   |   └── input.html
    |   |   ├── error-self-reference
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-b
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-c
    |   |   |   └── input.html
    |   |   ├── error-unexpected-end-of-input-d
    |   |   |   └── input.html
    |   |   ├── error-unmatched-closing-tag
    |   |   |   └── input.html
    |   |   ├── error-void-closing
    |   |   |   └── input.html
    |   |   ├── error-window-children
    |   |   |   └── input.html
    |   |   ├── error-window-duplicate
    |   |   |   └── input.html
    |   |   ├── error-window-inside-block
    |   |   |   └── input.html
    |   |   ├── error-window-inside-element
    |   |   |   └── input.html
    |   |   ├── event-handler
    |   |   |   └── input.html
    |   |   ├── if-block
    |   |   |   └── input.html
    |   |   ├── if-block-else
    |   |   |   └── input.html
    |   |   ├── if-block-elseif
    |   |   |   └── input.html
    |   |   ├── implicitly-closed-li
    |   |   |   └── input.html
    |   |   ├── nbsp
    |   |   |   └── input.html
    |   |   ├── raw-mustaches
    |   |   |   └── input.html
    |   |   ├── refs
    |   |   |   └── input.html
    |   |   ├── script
    |   |   |   └── input.html
    |   |   ├── script-comment-only
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing
    |   |   |   └── input.html
    |   |   ├── script-comment-trailing-multiline
    |   |   |   └── input.html
    |   |   ├── self-closing-element
    |   |   |   └── input.html
    |   |   ├── self-reference
    |   |   |   └── input.html
    |   |   ├── space-between-mustaches
    |   |   |   └── input.html
    |   |   ├── textarea-children
    |   |   |   └── input.html
    |   |   ├── transition-intro
    |   |   |   └── input.html
    |   |   ├── transition-intro-no-params
    |   |   |   └── input.html
    |   |   ├── whitespace-leading-trailing
    |   |   |   └── input.html
    |   |   ├── whitespace-normal
    |   |   |   └── input.html
    |   |   └── yield
    |   |       └── input.html
    |   └── update.js
    ├── preprocess
    |   └── index.js
    ├── runtime
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-casing
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-reserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-dynamic-type
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-empty-svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-namespaced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-partial-number
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-prefer-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-at-symbol
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-boolean
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── attribute-static-quotemarks
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── autofocus
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-component-oncreate
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-in-slot
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-catch-non-promise
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── await-then-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-audio-currenttime-duration
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-indirect-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-group-outside-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-checkbox-indeterminate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-number
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-radio-group
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-range-change
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-text-deep-contextual-computed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-input-with-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-implicit-option-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-in-yield
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-initial-value-undefined
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-late
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-select-optgroup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── binding-textarea
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-before-oncreate
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── bindings-coalesced
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-b
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-blowback-c
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-computed
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-conditional-b
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-deep-b
    |       |   ├── ComponentSelector.html
    |       |   ├── Editor.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-nested
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-each-object
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-infinite-loop
    |       |   ├── A.html
    |       |   ├── B.html
    |       |   ├── C.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-nested
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-parent-supercedes-child
    |       |   ├── Counter.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-binding-self-destroying
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-late
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-dynamic-shorthand
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-data-static-boolean-regression
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-data
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-events-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-if-placement
    |       |   ├── Component.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deep
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-nested-deeper
    |       |   ├── Level1.html
    |       |   ├── Level2.html
    |       |   ├── Level3.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-not-void
    |       |   ├── Link.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-ref
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-default
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-each-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-empty
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-fallback
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-if-else-block-before-node
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-named
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-slot-nested-component
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-static-at-symbol
    |       |   ├── Email.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-follows-element
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-each
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-multiple-in-if
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-nested-if
    |       |   ├── Inner.html
    |       |   ├── Outer.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-parent
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-placement
    |       |   ├── Modal.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── component-yield-static
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-default
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── computed-values-function-dependency
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-comments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-false
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── css-space-in-attribute
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── custom-method
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-builtins
    |       |   ├── _config.js
    |       |   ├── get.js
    |       |   └── main.html
    |       ├── deconflict-contexts
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-non-helpers
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-self
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── nested
    |       ├── deconflict-template-1
    |       |   ├── _config.js
    |       |   ├── main.html
    |       |   └── module.js
    |       ├── deconflict-template-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── deconflict-vars
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-function
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── destructuring
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-observe-arguments
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-bad-set-argument
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-not-teardown
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-destroy-twice
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-dynamic-components-misplaced
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-helper
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-missing-data-excludes-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-computed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dev-warning-readonly-window-binding
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-bindings-recreated
    |       |   ├── Green.html
    |       |   ├── Red.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-events
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-inside-element
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-slot
    |       |   ├── Bar.html
    |       |   ├── Baz.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── dynamic-component-update-existing-instance
    |       |   ├── Bar.html
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-component-in-if
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-containing-if
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-destructured-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-dynamic-else-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-else-starts-empty
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-indexed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-keyed-unshift
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-random-permute
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-block-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── each-blocks-nested-b
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── element-invalid-name
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── empty-style-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escape-template-literals
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── escaped-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-console-log
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-custom-node-context
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-each-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-event-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-hoisted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-removal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-sanitize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-shorthand-component
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── event-handler-this-methods
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-custom
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── events-lifecycle
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── flush-before-bindings
    |       |   ├── Nested.html
    |       |   ├── Visibility.html
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── function-in-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── get-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-accessible-directly
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-dereferenced
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-not-overwritten-by-bindings
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── globals-shadowed-by-helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-dynamic
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── head-title-static
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── hello-world
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── helpers-not-call-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── html-non-entities-inside-elements
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-else
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-elseif-text
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-expression
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-or
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── if-block-widget
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-attribute-compound
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-raw
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── ignore-unchanged-tag
    |       |   ├── _config.js
    |       |   ├── counter.js
    |       |   └── main.html
    |       ├── imported-renamed-components
    |       |   ├── ComponentOne.html
    |       |   ├── ComponentTwo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── inline-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── input-list
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── lifecycle-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── names-deconflicted-nested
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── nbsp
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-binding-ignores-unchanged
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-component-ignores-irrelevant-changes
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-deferred
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── observe-prevents-loop
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── oncreate-async-arrow-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── ondestroy-before-cleanup
    |       |   ├── Top.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-chain
    |       |   ├── Item.html
    |       |   ├── List.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── onrender-fires-when-ready-nested
    |       |   ├── ParentWidget.html
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── option-without-select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── options
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── paren-wrapped-expressions
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── preload
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-first-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-last-child
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-next-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-anchor-previous-sibling
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── raw-mustaches-preserved
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── refs-unset
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-bind-in-array
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-change-handler
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-one-way-bind-object
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── select-props
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── self-reference-tree
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-after-destroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-clones-input
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-observe-dedupes-renders
    |       |   ├── Widget.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-oncreate
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-in-ondestroy
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-mutated-data
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── set-prevents-loop
    |       |   ├── Foo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── setup
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-#
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── sigil-static-@
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-static-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── single-text-node
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── slot-in-custom-element
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── state-deconflicted
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-binding
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-computed
    |       |   ├── Todo.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-event
    |       |   ├── NameInput.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── store-root
    |       |   ├── Nested.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-attributes
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-child-component-declared-namespace-shorthand
    |       |   ├── Rect.html
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-class
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-anchor
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-each-block-namespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-multiple
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-no-whitespace
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xlink
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── svg-xmlns
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-css-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-delay-in-out
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-dynamic-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-keyed-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-each-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-events
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-2
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-in-each-block-bidi-3
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-block-intro-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-dynamic-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-intro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-else-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-if-elseif-block-outro
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-initial
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── transition-js-parameterised-with-state
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-each-block
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── whitespace-normal
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-bind-scroll-update
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-binding-resize
    |       |   ├── _config.js
    |       |   └── main.html
    |       ├── window-event
    |       |   ├── _config.js
    |       |   └── main.html
    |       └── window-event-context
    |           ├── _config.js
    |           └── main.html
    ├── server-side-rendering
    |   ├── index.js
    |   └── samples
    |       ├── attribute-boolean
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-dynamic
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── attribute-static
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── comment
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-binding-renamed
    |       |   ├── Foo.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-dynamic
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-empty
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-data-static
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-refs-and-attributes
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── component-with-different-extension
    |       |   └── _expected.html
    |       ├── component-yield
    |       |   ├── Widget.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── computed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── default-data-override
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── directives
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── dynamic-text-escaped
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── each-block
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── empty-elements-closed
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── entities
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── head-title
    |       |   ├── _actual-head.html
    |       |   ├── _expected-head.html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── helpers
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-false
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── if-block-true
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── import-non-component
    |       |   ├── _expected.html
    |       |   ├── answer.js
    |       |   ├── main.html
    |       |   └── problems.js
    |       ├── raw-mustaches
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── sanitize-name
    |       |   ├── [foo].html
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-div
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── static-text
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── styles-nested
    |       |   ├── One.html
    |       |   ├── Two.html
    |       |   ├── _expected.css
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-children
    |       |   ├── _expected.html
    |       |   └── main.html
    |       ├── textarea-value
    |       |   ├── _expected.html
    |       |   └── main.html
    |       └── triple
    |           ├── _expected.html
    |           └── main.html
    ├── setup.js
    ├── sourcemaps
    |   ├── index.js
    |   └── samples
    |       ├── basic
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── binding-shorthand
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── css
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── css-cascade-false
    |       |   ├── _config.js
    |       |   ├── input.html
    |       |   ├── output.css
    |       |   └── test.js
    |       ├── each-block
    |       |   ├── input.html
    |       |   └── test.js
    |       ├── script
    |       |   ├── input.html
    |       |   └── test.js
    |       └── static-no-script
    |           ├── input.html
    |           └── test.js
    ├── store
    |   └── index.js
    ├── test.js
    └── validator
        ├── index.js
        └── samples
            ├── a11y-alt-text
            |   └── input.html
            ├── a11y-anchor-has-content
            |   └── input.html
            ├── a11y-anchor-in-svg-is-valid
            |   └── input.html
            ├── a11y-anchor-is-valid
            |   └── input.html
            ├── a11y-aria-props
            |   └── input.html
            ├── a11y-aria-role
            |   └── input.html
            ├── a11y-aria-unsupported-element
            |   └── input.html
            ├── a11y-figcaption-right-place
            |   └── input.html
            ├── a11y-figcaption-wrong-place
            |   └── input.html
            ├── a11y-heading-has-content
            |   └── input.html
            ├── a11y-html-has-lang
            |   └── input.html
            ├── a11y-iframe-has-title
            |   └── input.html
            ├── a11y-no-access-key
            |   └── input.html
            ├── a11y-no-autofocus
            |   └── input.html
            ├── a11y-no-distracting-elements
            |   └── input.html
            ├── a11y-scope
            |   └── input.html
            ├── a11y-tabindex-no-positive
            |   └── input.html
            ├── await-component-is-used
            |   └── input.html
            ├── binding-input-checked
            |   └── input.html
            ├── binding-input-type-boolean
            |   └── input.html
            ├── binding-input-type-dynamic
            |   └── input.html
            ├── binding-invalid
            |   └── input.html
            ├── binding-invalid-on-element
            |   └── input.html
            ├── component-cannot-be-called-state
            |   └── input.html
            ├── component-slot-default-duplicate.skip
            |   └── input.html
            ├── component-slot-default-reserved
            |   └── input.html
            ├── component-slot-dynamic
            |   └── input.html
            ├── component-slot-dynamic-attribute
            |   └── input.html
            ├── component-slot-each-block
            |   └── input.html
            ├── component-slot-named-duplicate.skip
            |   └── input.html
            ├── component-slotted-each-block
            |   └── input.html
            ├── component-slotted-if-block
            |   └── input.html
            ├── computed-purity-check-no-this
            |   └── input.html
            ├── computed-purity-check-this-get
            |   └── input.html
            ├── css-invalid-global
            |   └── input.html
            ├── css-invalid-global-placement
            |   └── input.html
            ├── each-block-invalid-context
            |   └── input.html
            ├── each-block-invalid-context-destructured
            |   └── input.html
            ├── event-handler-ref
            |   └── input.html
            ├── event-handler-ref-invalid
            |   └── input.html
            ├── export-default-duplicated
            |   └── input.html
            ├── export-default-must-be-object
            |   └── input.html
            ├── helper-clash-context
            |   └── input.html
            ├── helper-purity-check-needs-arguments
            |   └── input.html
            ├── helper-purity-check-no-this
            |   └── input.html
            ├── helper-purity-check-this-get
            |   └── input.html
            ├── helper-purity-check-uses-arguments
            |   └── input.html
            ├── method-arrow-no-this
            |   └── input.html
            ├── method-arrow-this
            |   └── input.html
            ├── method-nonexistent
            |   └── input.html
            ├── method-nonexistent-helper
            |   └── input.html
            ├── method-quoted
            |   └── input.html
            ├── missing-component
            |   └── input.html
            ├── named-export
            |   └── input.html
            ├── namespace-invalid
            |   └── input.html
            ├── namespace-invalid-unguessable
            |   └── input.html
            ├── namespace-non-literal
            |   └── input.html
            ├── non-object-literal-components
            |   └── input.html
            ├── non-object-literal-events
            |   └── input.html
            ├── non-object-literal-helpers
            |   └── input.html
            ├── non-object-literal-methods
            |   └── input.html
            ├── non-object-literal-transitions
            |   └── input.html
            ├── oncreate-arrow-no-this
            |   └── input.html
            ├── oncreate-arrow-this
            |   └── input.html
            ├── ondestroy-arrow-no-this
            |   └── input.html
            ├── ondestroy-arrow-this
            |   └── input.html
            ├── properties-components-should-be-capitalised
            |   └── input.html
            ├── properties-computed-must-be-an-object
            |   └── input.html
            ├── properties-computed-must-be-functions
            |   └── input.html
            ├── properties-computed-no-destructuring
            |   └── input.html
            ├── properties-computed-values-needs-arguments
            |   └── input.html
            ├── properties-data-must-be-function
            |   └── input.html
            ├── properties-duplicated
            |   └── input.html
            ├── properties-methods-getters-setters
            |   └── input.html
            ├── properties-unexpected
            |   └── input.html
            ├── properties-unexpected-b
            |   └── input.html
            ├── slot-attribute-invalid
            |   └── input.html
            ├── store-unexpected
            |   └── input.html
            ├── svg-child-component-declared-namespace
            |   └── input.html
            ├── svg-child-component-undeclared-namespace
            |   └── input.html
            ├── tag-invalid
            |   └── input.html
            ├── tag-non-string
            |   └── input.html
            ├── textarea-value-children
            |   └── input.html
            ├── title-no-attributes
            |   └── input.html
            ├── title-no-children
            |   └── input.html
            ├── transition-duplicate-in
            |   └── input.html
            ├── transition-duplicate-in-transition
            |   └── input.html
            ├── transition-duplicate-out
            |   └── input.html
            ├── transition-duplicate-out-transition
            |   └── input.html
            ├── transition-duplicate-transition
            |   └── input.html
            ├── transition-duplicate-transition-in
            |   └── input.html
            ├── transition-duplicate-transition-out
            |   └── input.html
            ├── transition-missing
            |   └── input.html
            ├── transition-on-component
            |   └── input.html
            ├── unused-components
            |   └── input.html
            ├── unused-event
            |   └── input.html
            ├── unused-helper.skip
            |   └── input.html
            ├── unused-transition
            |   └── input.html
            ├── window-binding-invalid
            |   └── input.html
            ├── window-binding-invalid-innerwidth
            |   └── input.html
            ├── window-binding-invalid-value
            |   └── input.html
            ├── window-binding-invalid-width
            |   └── input.html
            ├── window-binding-online
            |   └── input.html
            └── window-event-invalid
                └── input.html
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
can't supply store to nested components server side

Issue description: 
Hey, I'm trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.

E.g. I have a manage account page like so:
```html
<div class="page">
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        <TwoFactorAuth />
    </div>
</div>

<style>
    .page {
        width: 400px;
        margin: 50px auto;
    }
</style>

<script>
    import TwoFactorAuth from './_components/TwoFactorAuth';

    export default {
        components: {
            TwoFactorAuth,
        },
    }
</script>
```

And in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)
```html
{{#if $hasTwoFactor}}
<div>yay its enabled</div>
{{else}}
<div>oh no its not enabled</div>
{{/if}}

<script>
    import { connect } from '../../_redux';

    export default {
        store: connect(state => ({
            hasTwoFactor: state.user && state.user.hasTwoFactor,
        })),
    }
</script>
```

As mentioned this fails on the server side, but not when navigation to the page on the client side.

I dug into the generated code a bit and I see it generates the template like so:
```js
return `<div class="page" svelte-1782208320>
    <h1>Manage Account</h1>

    <div>
        <h3>Two Factor Auth</h3>
        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}
    </div>
</div>`
```

This is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.

It errors on the following line in the TwoFactorAuth's `_render` method, as the store is undefined
```js
state = Object.assign(options.store._init(["hasTwoFactor"]), state);
```
```
Cannot read property '_init' of undefined
```

Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full contents of src/generators/server-side-rendering/visitors/Component.ts, src/generators/server-side-rendering/index.ts, src/generators/server-side-rendering/Block.ts, src/generators/server-side-rendering/visit.ts, src/generators/wrapModule.ts, and src/generators/nodes/Component.ts.
Extra Requirements: If full files are too large, include at minimum the functions that emit SSR output for nested components, any code that passes options/store to child components, and the wrapper code that initializes a component’s store in render/_render.
Purpose: To trace how SSR emits nested component calls and how the store is propagated/initialized, so we can pinpoint the bug and propose a fix.

Previous refined query 2:
Essential Query: Please provide the full contents of src/generators/wrapModule.ts and src/generators/server-side-rendering/visit.ts.
Extra Requirements: If full files are too large, include at minimum how templateProperties.store and templateVars are created/exposed and the code path that builds nested component options for SSR.
Purpose: To verify how a component’s store function is exposed and ensure SSR nested component calls initialize their own store instead of relying solely on the parent’s options.store, enabling a precise bug fix.

Previous refined query 3:
Essential Query: Please provide the full contents of src/generators/Generator.ts and src/generators/server-side-rendering/visitors/index.ts.
Extra Requirements: If full files are too large, include specifically how templateProperties and templateVars are constructed, how components are registered/imported, and any mechanism that exposes a component’s store initializer for SSR.
Purpose: To determine how to reference a child component’s store initializer in SSR and fix nested component store propagation.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: src/generators/nodes/Component.ts
Line number range: 1 - 609
Content:
1. import deindent from '../../utils/deindent';
2. import { stringify } from '../../utils/stringify';
3. import stringifyProps from '../../utils/stringifyProps';
4. import CodeBuilder from '../../utils/CodeBuilder';
5. import getTailSnippet from '../../utils/getTailSnippet';
6. import getObject from '../../utils/getObject';
7. import getExpressionPrecedence from '../../utils/getExpressionPrecedence';
8. import Node from './shared/Node';
9. import Block from '../dom/Block';
10. import Attribute from './Attribute';
11. 
12. export default class Component extends Node {
13. 	type: 'Component';
14. 	name: string;
15. 	attributes: Attribute[];
16. 	children: Node[];
17. 
18. 	init(
19. 		block: Block,
20. 		stripWhitespace: boolean,
21. 		nextSibling: Node
22. 	) {
23. 		this.cannotUseInnerHTML();
24. 
25. 		this.attributes.forEach((attribute: Node) => {
26. 			if (attribute.type === 'Attribute' && attribute.value !== true) {
27. 				attribute.value.forEach((chunk: Node) => {
28. 					if (chunk.type !== 'Text') {
29. 						const dependencies = chunk.metadata.dependencies;
30. 						block.addDependencies(dependencies);
31. 					}
32. 				});
33. 			} else {
34. 				if (attribute.type === 'EventHandler' && attribute.expression) {
35. 					attribute.expression.arguments.forEach((arg: Node) => {
36. 						block.addDependencies(arg.metadata.dependencies);
37. 					});
38. 				} else if (attribute.type === 'Binding') {
39. 					block.addDependencies(attribute.metadata.dependencies);
40. 				}
41. 			}
42. 		});
43. 
44. 		this.var = block.getUniqueName(
45. 			(
46. 				this.name === ':Self' ? this.generator.name :
47. 				this.name === ':Component' ? 'switch_instance' :
48. 				this.name
49. 			).toLowerCase()
50. 		);
51. 
52. 		if (this.children.length) {
53. 			this._slots = new Set(['default']);
54. 
55. 			this.children.forEach(child => {
56. 				child.init(block, stripWhitespace, nextSibling);
57. 			});
58. 		}
59. 	}
60. 
61. 	build(
62. 		block: Block,
63. 		parentNode: string,
64. 		parentNodes: string
65. 	) {
66. 		const { generator } = this;
67. 		generator.hasComponents = true;
68. 
69. 		const name = this.var;
70. 
71. 		const componentInitProperties = [`root: #component.root`];
72. 
73. 		if (this.children.length > 0) {
74. 			const slots = Array.from(this._slots).map(name => `${name}: @createFragment()`);
75. 			componentInitProperties.push(`slots: { ${slots.join(', ')} }`);
76. 
77. 			this.children.forEach((child: Node) => {
78. 				child.build(block, `${this.var}._slotted.default`, 'nodes');
79. 			});
80. 		}
81. 
82. 		const allContexts = new Set();
83. 		const statements: string[] = [];
84. 		const name_context = block.getUniqueName(`${name}_context`);
85. 
86. 		let name_updating: string;
87. 		let name_initial_data: string;
88. 		let beforecreate: string = null;
89. 
90. 		const attributes = this.attributes
91. 			.filter(a => a.type === 'Attribute')
92. 			.map(a => mungeAttribute(a, block));
93. 
94. 		const bindings = this.attributes
95. 			.filter(a => a.type === 'Binding')
96. 			.map(a => mungeBinding(a, block));
97. 
98. 		const eventHandlers = this.attributes
99. 			.filter((a: Node) => a.type === 'EventHandler')
100. 			.map(a => mungeEventHandler(generator, this, a, block, name_context, allContexts));
101. 
102. 		const ref = this.attributes.find((a: Node) => a.type === 'Ref');
103. 		if (ref) generator.usesRefs = true;
104. 
105. 		const updates: string[] = [];
106. 
107. 		if (attributes.length || bindings.length) {
108. 			const initialProps = attributes
109. 				.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);
110. 
111. 			const initialPropString = stringifyProps(initialProps);
112. 
113. 			attributes
114. 				.filter((attribute: Attribute) => attribute.dynamic)
115. 				.forEach((attribute: Attribute) => {
116. 					if (attribute.dependencies.length) {
117. 						updates.push(deindent`
118. 							if (${attribute.dependencies
119. 								.map(dependency => `changed.${dependency}`)
120. 								.join(' || ')}) ${name}_changes.${attribute.name} = ${attribute.value};
121. 						`);
122. 					}
123. 
124. 					else {
125. 						// TODO this is an odd situation to encounter – I *think* it should only happen with
126. 						// each block indices, in which case it may be possible to optimise this
127. 						updates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);
128. 					}
129. 				});
130. 
131. 			if (bindings.length) {
132. 				generator.hasComplexBindings = true;
133. 
134. 				name_updating = block.alias(`${name}_updating`);
135. 				name_initial_data = block.getUniqueName(`${name}_initial_data`);
136. 
137. 				block.addVariable(name_updating, '{}');
138. 				statements.push(`var ${name_initial_data} = ${initialPropString};`);
139. 
140. 				const setParentFromChildOnChange = new CodeBuilder();
141. 				const setParentFromChildOnInit = new CodeBuilder();
142. 
143. 				bindings.forEach((binding: Binding) => {
144. 					let setParentFromChild;
145. 
146. 					binding.contexts.forEach(context => {
147. 						allContexts.add(context);
148. 					});
149. 
150. 					const { name: key } = getObject(binding.value);
151. 
152. 					if (block.contexts.has(key)) {
153. 						const prop = binding.dependencies[0];
154. 						const computed = isComputed(binding.value);
155. 						const tail = binding.value.type === 'MemberExpression' ? getTailSnippet(binding.value) : '';
156. 
157. 						setParentFromChild = deindent`
158. 							var list = ${name_context}.${block.listNames.get(key)};
159. 							var index = ${name_context}.${block.indexNames.get(key)};
160. 							list[index]${tail} = childState.${binding.name};
161. 
162. 							${binding.dependencies
163. 								.map((prop: string) => `newState.${prop} = state.${prop};`)
164. 								.join('\n')}
165. 						`;
166. 					}
167. 
168. 					else if (binding.value.type === 'MemberExpression') {
169. 						setParentFromChild = deindent`
170. 							${binding.snippet} = childState.${binding.name};
171. 							${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join('\n')}
172. 						`;
173. 					}
174. 
175. 					else {
176. 						setParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;
177. 					}
178. 
179. 					statements.push(deindent`
180. 						if (${binding.prop} in ${binding.obj}) {
181. 							${name_initial_data}.${binding.name} = ${binding.snippet};
182. 							${name_updating}.${binding.name} = true;
183. 						}`
184. 					);
185. 
186. 					setParentFromChildOnChange.addConditional(
187. 						`!${name_updating}.${binding.name} && changed.${binding.name}`,
188. 						setParentFromChild
189. 					);
190. 
191. 					setParentFromChildOnInit.addConditional(
192. 						`!${name_updating}.${binding.name}`,
193. 						setParentFromChild
194. 					);
195. 
196. 					// TODO could binding.dependencies.length ever be 0?
197. 					if (binding.dependencies.length) {
198. 						updates.push(deindent`
199. 							if (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(' || ')}) {
200. 								${name}_changes.${binding.name} = ${binding.snippet};
201. 								${name_updating}.${binding.name} = true;
202. 							}
203. 						`);
204. 					}
205. 				});
206. 
207. 				componentInitProperties.push(`data: ${name_initial_data}`);
208. 
209. 				componentInitProperties.push(deindent`
210. 					_bind: function(changed, childState) {
211. 						var state = #component.get(), newState = {};
212. 						${setParentFromChildOnChange}
213. 						${name_updating} = @assign({}, changed);
214. 						#component._set(newState);
215. 						${name_updating} = {};
216. 					}
217. 				`);
218. 
219. 				beforecreate = deindent`
220. 					#component.root._beforecreate.push(function() {
221. 						var state = #component.get(), childState = ${name}.get(), newState = {};
222. 						if (!childState) return;
223. 						${setParentFromChildOnInit}
224. 						${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(', ')} };
225. 						#component._set(newState);
226. 						${name_updating} = {};
227. 					});
228. 				`;
229. 			} else if (initialProps.length) {
230. 				componentInitProperties.push(`data: ${initialPropString}`);
231. 			}
232. 		}
233. 
234. 		const isDynamicComponent = this.name === ':Component';
235. 
236. 		const switch_vars = isDynamicComponent && {
237. 			value: block.getUniqueName('switch_value'),
238. 			props: block.getUniqueName('switch_props')
239. 		};
240. 
241. 		const expression = (
242. 			this.name === ':Self' ? generator.name :
243. 			isDynamicComponent ? switch_vars.value :
244. 			`%components-${this.name}`
245. 		);
246. 
247. 		if (isDynamicComponent) {
248. 			block.contextualise(this.expression);
249. 			const { dependencies, snippet } = this.metadata;
250. 
251. 			const anchor = this.getOrCreateAnchor(block, parentNode, parentNodes);
252. 
253. 			const params = block.params.join(', ');
254. 
255. 			block.builders.init.addBlock(deindent`
256. 				var ${switch_vars.value} = ${snippet};
257. 
258. 				function ${switch_vars.props}(${params}) {
259. 					${statements.length > 0 && statements.join('\n')}
260. 					return {
261. 						${componentInitProperties.join(',\n')}
262. 					};
263. 				}
264. 
265. 				if (${switch_vars.value}) {
266. 					var ${name} = new ${expression}(${switch_vars.props}(${params}));
267. 
268. 					${beforecreate}
269. 				}
270. 
271. 				${eventHandlers.map(handler => deindent`
272. 					function ${handler.var}(event) {
273. 						${handler.body}
274. 					}
275. 
276. 					if (${name}) ${name}.on("${handler.name}", ${handler.var});
277. 				`)}
278. 			`);
279. 
280. 			block.builders.create.addLine(
281. 				`if (${name}) ${name}._fragment.c();`
282. 			);
283. 
284. 			if (parentNodes) {
285. 				block.builders.claim.addLine(
286. 					`if (${name}) ${name}._fragment.l(${parentNodes});`
287. 				);
288. 			}
289. 
290. 			block.builders.mount.addLine(
291. 				`if (${name}) ${name}._mount(${parentNode || '#target'}, ${parentNode ? 'null' : 'anchor'});`
292. 			);
293. 
294. 			const updateMountNode = this.getUpdateMountNode(anchor);
295. 
296. 			block.builders.update.addBlock(deindent`
297. 				if (${switch_vars.value} !== (${switch_vars.value} = ${snippet})) {
298. 					if (${name}) ${name}.destroy();
299. 
300. 					if (${switch_vars.value}) {
301. 						${name} = new ${switch_vars.value}(${switch_vars.props}(${params}));
302. 						${name}._fragment.c();
303. 
304. 						${this.children.map(child => remount(generator, child, name))}
305. 						${name}._mount(${updateMountNode}, ${anchor});
306. 
307. 						${eventHandlers.map(handler => deindent`
308. 							${name}.on("${handler.name}", ${handler.var});
309. 						`)}
310. 
311. 						${ref && `#component.refs.${ref.name} = ${name};`}
312. 					}
313. 
314. 					${ref && deindent`
315. 						else if (#component.refs.${ref.name} === ${name}) {
316. 							#component.refs.${ref.name} = null;
317. 						}`}
318. 				}
319. 			`);
320. 
321. 			if (updates.length) {
322. 				block.builders.update.addBlock(deindent`
323. 					else {
324. 						var ${name}_changes = {};
325. 						${updates.join('\n')}
326. 						${name}._set(${name}_changes);
327. 						${bindings.length && `${name_updating} = {};`}
328. 					}
329. 				`);
330. 			}
331. 
332. 			if (!parentNode) block.builders.unmount.addLine(`if (${name}) ${name}._unmount();`);
333. 
334. 			block.builders.destroy.addLine(`if (${name}) ${name}.destroy(false);`);
335. 		} else {
336. 			block.builders.init.addBlock(deindent`
337. 				${statements.join('\n')}
338. 				var ${name} = new ${expression}({
339. 					${componentInitProperties.join(',\n')}
340. 				});
341. 
342. 				${beforecreate}
343. 
344. 				${eventHandlers.map(handler => deindent`
345. 					${name}.on("${handler.name}", function(event) {
346. 						${handler.body}
347. 					});
348. 				`)}
349. 
350. 				${ref && `#component.refs.${ref.name} = ${name};`}
351. 			`);
352. 
353. 			block.builders.create.addLine(`${name}._fragment.c();`);
354. 
355. 			if (parentNodes) {
356. 				block.builders.claim.addLine(
357. 					`${name}._fragment.l(${parentNodes});`
358. 				);
359. 			}
360. 
361. 			block.builders.mount.addLine(
362. 				`${name}._mount(${parentNode || '#target'}, ${parentNode ? 'null' : 'anchor'});`
363. 			);
364. 
365. 			if (updates.length) {
366. 				block.builders.update.addBlock(deindent`
367. 					var ${name}_changes = {};
368. 					${updates.join('\n')}
369. 					${name}._set(${name}_changes);
370. 					${bindings.length && `${name_updating} = {};`}
371. 				`);
372. 			}
373. 
374. 			if (!parentNode) block.builders.unmount.addLine(`${name}._unmount();`);
375. 
376. 			block.builders.destroy.addLine(deindent`
377. 				${name}.destroy(false);
378. 				${ref && `if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;`}
379. 			`);
380. 		}
381. 
382. 		// maintain component context
383. 		if (allContexts.size) {
384. 			const contexts = Array.from(allContexts);
385. 
386. 			const initialProps = contexts
387. 				.map(contextName => {
388. 					if (contextName === 'state') return `state: state`;
389. 
390. 					const listName = block.listNames.get(contextName);
391. 					const indexName = block.indexNames.get(contextName);
392. 
393. 					return `${listName}: ${listName},\n${indexName}: ${indexName}`;
394. 				})
395. 				.join(',\n');
396. 
397. 			const updates = contexts
398. 				.map(contextName => {
399. 					if (contextName === 'state') return `${name_context}.state = state;`;
400. 
401. 					const listName = block.listNames.get(contextName);
402. 					const indexName = block.indexNames.get(contextName);
403. 
404. 					return `${name_context}.${listName} = ${listName};\n${name_context}.${indexName} = ${indexName};`;
405. 				})
406. 				.join('\n');
407. 
408. 			block.builders.init.addBlock(deindent`
409. 				var ${name_context} = {
410. 					${initialProps}
411. 				};
412. 			`);
413. 
414. 			block.builders.update.addBlock(updates);
415. 		}
416. 	}
417. }
418. 
419. function mungeAttribute(attribute: Node, block: Block): Attribute {
420. 	if (attribute.value === true) {
421. 		// attributes without values, e.g. <textarea readonly>
422. 		return {
423. 			name: attribute.name,
424. 			value: true,
425. 			dynamic: false
426. 		};
427. 	}
428. 
429. 	if (attribute.value.length === 0) {
430. 		return {
431. 			name: attribute.name,
432. 			value: `''`,
433. 			dynamic: false
434. 		};
435. 	}
436. 
437. 	if (attribute.value.length === 1) {
438. 		const value = attribute.value[0];
439. 
440. 		if (value.type === 'Text') {
441. 			// static attributes
442. 			return {
443. 				name: attribute.name,
444. 				value: isNaN(value.data) ? stringify(value.data) : value.data,
445. 				dynamic: false
446. 			};
447. 		}
448. 
449. 		// simple dynamic attributes
450. 		block.contextualise(value.expression); // TODO remove
451. 		const { dependencies, snippet } = value.metadata;
452. 
453. 		// TODO only update attributes that have changed
454. 		return {
455. 			name: attribute.name,
456. 			value: snippet,
457. 			dependencies,
458. 			dynamic: true
459. 		};
460. 	}
461. 
462. 	// otherwise we're dealing with a complex dynamic attribute
463. 	const allDependencies = new Set();
464. 
465. 	const value =
466. 		(attribute.value[0].type === 'Text' ? '' : `"" + `) +
467. 		attribute.value
468. 			.map((chunk: Node) => {
469. 				if (chunk.type === 'Text') {
470. 					return stringify(chunk.data);
471. 				} else {
472. 					block.contextualise(chunk.expression); // TODO remove
473. 					const { dependencies, snippet } = chunk.metadata;
474. 
475. 					dependencies.forEach((dependency: string) => {
476. 						allDependencies.add(dependency);
477. 					});
478. 
479. 					return getExpressionPrecedence(chunk.expression) <= 13 ? `(${snippet})` : snippet;
480. 				}
481. 			})
482. 			.join(' + ');
483. 
484. 	return {
485. 		name: attribute.name,
486. 		value,
487. 		dependencies: Array.from(allDependencies),
488. 		dynamic: true
489. 	};
490. }
491. 
492. function mungeBinding(binding: Node, block: Block): Binding {
493. 	const { name } = getObject(binding.value);
494. 	const { contexts } = block.contextualise(binding.value);
495. 	const { dependencies, snippet } = binding.metadata;
496. 
497. 	const contextual = block.contexts.has(name);
498. 
499. 	let obj;
500. 	let prop;
501. 
502. 	if (contextual) {
503. 		obj = block.listNames.get(name);
504. 		prop = block.indexNames.get(name);
505. 	} else if (binding.value.type === 'MemberExpression') {
506. 		prop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;
507. 		if (!binding.value.computed) prop = `'${prop}'`;
508. 		obj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;
509. 	} else {
510. 		obj = 'state';
511. 		prop = `'${name}'`;
512. 	}
513. 
514. 	return {
515. 		name: binding.name,
516. 		value: binding.value,
517. 		contexts,
518. 		snippet,
519. 		obj,
520. 		prop,
521. 		dependencies
522. 	};
523. }
524. 
525. function mungeEventHandler(generator: DomGenerator, node: Node, handler: Node, block: Block, name_context: string, allContexts: Set<string>) {
526. 	let body;
527. 
528. 	if (handler.expression) {
529. 		generator.addSourcemapLocations(handler.expression);
530. 		generator.code.prependRight(
531. 			handler.expression.start,
532. 			`${block.alias('component')}.`
533. 		);
534. 
535. 		const usedContexts: string[] = [];
536. 
537. 		handler.expression.arguments.forEach((arg: Node) => {
538. 			const { contexts } = block.contextualise(arg, null, true);
539. 
540. 			contexts.forEach(context => {
541. 				if (!~usedContexts.indexOf(context)) usedContexts.push(context);
542. 				allContexts.add(context);
543. 			});
544. 		});
545. 
546. 		// TODO hoist event handlers? can do `this.__component.method(...)`
547. 		const declarations = usedContexts.map(name => {
548. 			if (name === 'state') return `var state = ${name_context}.state;`;
549. 
550. 			const listName = block.listNames.get(name);
551. 			const indexName = block.indexNames.get(name);
552. 
553. 			return `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;
554. 		});
555. 
556. 		body = deindent`
557. 			${declarations}
558. 
559. 			[✂${handler.expression.start}-${handler.expression.end}✂];
560. 		`;
561. 	} else {
562. 		body = deindent`
563. 			${block.alias('component')}.fire('${handler.name}', event);
564. 		`;
565. 	}
566. 
567. 	return {
568. 		name: handler.name,
569. 		var: block.getUniqueName(`${node.var}_${handler.name}`),
570. 		body
571. 	};
572. }
573. 
574. function isComputed(node: Node) {
575. 	while (node.type === 'MemberExpression') {
576. 		if (node.computed) return true;
577. 		node = node.object;
578. 	}
579. 
580. 	return false;
581. }
582. 
583. function remount(generator: DomGenerator, node: Node, name: string) {
584. 	// TODO make this a method of the nodes
585. 
586. 	if (node.type === 'Component') {
587. 		return `${node.var}._mount(${name}._slotted.default, null);`;
588. 	}
589. 
590. 	if (node.type === 'Element') {
591. 		const slot = node.attributes.find(attribute => attribute.name === 'slot');
592. 		if (slot) {
593. 			return `@appendNode(${node.var}, ${name}._slotted.${node.getStaticAttributeValue('slot')});`;
594. 		}
595. 
596. 		return `@appendNode(${node.var}, ${name}._slotted.default);`;
597. 	}
598. 
599. 	if (node.type === 'Text' || node.type === 'MustacheTag' || node.type === 'RawMustacheTag') {
600. 		return `@appendNode(${node.var}, ${name}._slotted.default);`;
601. 	}
602. 
603. 	if (node.type === 'EachBlock') {
604. 		// TODO consider keyed blocks
605. 		return `for (var #i = 0; #i < ${node.iterations}.length; #i += 1) ${node.iterations}[#i].m(${name}._slotted.default, null);`;
606. 	}
607. 
608. 	return `${node.var}.m(${name}._slotted.default, null);`;
609. }


File: src/generators/server-side-rendering/Block.ts
Line number range: 1 - 49
Content:
1. import deindent from '../../utils/deindent';
2. import flattenReference from '../../utils/flattenReference';
3. import { SsrGenerator } from './index';
4. import { Node } from '../../interfaces';
5. import getObject from '../../utils/getObject';
6. 
7. interface BlockOptions {
8. 	// TODO
9. }
10. 
11. export default class Block {
12. 	generator: SsrGenerator;
13. 	conditions: string[];
14. 
15. 	contexts: Map<string, string>;
16. 	indexes: Map<string, string>;
17. 	contextDependencies: Map<string, string[]>;
18. 
19. 	constructor(options: BlockOptions) {
20. 		Object.assign(this, options);
21. 	}
22. 
23. 	addBinding(binding: Node, name: string) {
24. 		const conditions = [`!('${binding.name}' in state)`].concat(
25. 			// TODO handle contextual bindings...
26. 			this.conditions.map(c => `(${c})`)
27. 		);
28. 
29. 		const { name: prop } = getObject(binding.value);
30. 
31. 		this.generator.bindings.push(deindent`
32. 			if (${conditions.join('&&')}) {
33. 				tmp = ${name}.data();
34. 				if ('${prop}' in tmp) {
35. 					state.${binding.name} = tmp.${prop};
36. 					settled = false;
37. 				}
38. 			}
39. 		`);
40. 	}
41. 
42. 	child(options: BlockOptions) {
43. 		return new Block(Object.assign({}, this, options, { parent: this }));
44. 	}
45. 
46. 	contextualise(expression: Node, context?: string, isEventHandler?: boolean) {
47. 		return this.generator.contextualise(this.contexts, this.indexes, expression, context, isEventHandler);
48. 	}
49. }


File: src/generators/server-side-rendering/index.ts
Line number range: 1 - 268
Content:
1. import deindent from '../../utils/deindent';
2. import Generator from '../Generator';
3. import Stylesheet from '../../css/Stylesheet';
4. import Block from './Block';
5. import visit from './visit';
6. import { removeNode, removeObjectKey } from '../../utils/removeNode';
7. import getName from '../../utils/getName';
8. import globalWhitelist from '../../utils/globalWhitelist';
9. import { Parsed, Node, CompileOptions } from '../../interfaces';
10. import { AppendTarget } from './interfaces';
11. import { stringify } from '../../utils/stringify';
12. 
13. export class SsrGenerator extends Generator {
14. 	bindings: string[];
15. 	renderCode: string;
16. 	appendTargets: AppendTarget[];
17. 
18. 	constructor(
19. 		parsed: Parsed,
20. 		source: string,
21. 		name: string,
22. 		stylesheet: Stylesheet,
23. 		options: CompileOptions
24. 	) {
25. 		super(parsed, source, name, stylesheet, options, false);
26. 		this.bindings = [];
27. 		this.renderCode = '';
28. 		this.appendTargets = [];
29. 
30. 		this.stylesheet.warnOnUnusedSelectors(options.onwarn);
31. 	}
32. 
33. 	append(code: string) {
34. 		if (this.appendTargets.length) {
35. 			const appendTarget = this.appendTargets[this.appendTargets.length - 1];
36. 			const slotName = appendTarget.slotStack[appendTarget.slotStack.length - 1];
37. 			appendTarget.slots[slotName] += code;
38. 		} else {
39. 			this.renderCode += code;
40. 		}
41. 	}
42. }
43. 
44. export default function ssr(
45. 	parsed: Parsed,
46. 	source: string,
47. 	stylesheet: Stylesheet,
48. 	options: CompileOptions
49. ) {
50. 	const format = options.format || 'cjs';
51. 
52. 	const generator = new SsrGenerator(parsed, source, options.name || 'SvelteComponent', stylesheet, options);
53. 
54. 	const { computations, name, templateProperties } = generator;
55. 
56. 	// create main render() function
57. 	const mainBlock = new Block({
58. 		generator,
59. 		contexts: new Map(),
60. 		indexes: new Map(),
61. 		conditions: [],
62. 	});
63. 
64. 	trim(parsed.html.children).forEach((node: Node) => {
65. 		visit(generator, mainBlock, node);
66. 	});
67. 
68. 	const { css, cssMap } = generator.customElement ?
69. 		{ css: null, cssMap: null } :
70. 		generator.stylesheet.render(options.filename, true);
71. 
72. 	// generate initial state object
73. 	const expectedProperties = Array.from(generator.expectedProperties);
74. 	const globals = expectedProperties.filter(prop => globalWhitelist.has(prop));
75. 	const storeProps = options.store || templateProperties.store ? expectedProperties.filter(prop => prop[0] === '$') : [];
76. 
77. 	const initialState = [];
78. 	if (globals.length > 0) {
79. 		initialState.push(`{ ${globals.map(prop => `${prop} : ${prop}`).join(', ')} }`);
80. 	}
81. 
82. 	if (storeProps.length > 0) {
83. 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
84. 		if (options.store || templateProperties.store) {
85. 			initialState.push(`options.store.${initialize}`);
86. 		}
87. 	}
88. 
89. 	if (templateProperties.data) {
90. 		initialState.push(`%data()`);
91. 	} else if (globals.length === 0 && storeProps.length === 0) {
92. 		initialState.push('{}');
93. 	}
94. 
95. 	initialState.push('state');
96. 
97. 	// TODO concatenate CSS maps
98. 	const result = deindent`
99. 		${generator.javascript}
100. 
101. 		var ${name} = {};
102. 
103. 		${options.filename && `${name}.filename = ${stringify(options.filename)}`};
104. 
105. 		${name}.data = function() {
106. 			return ${templateProperties.data ? `%data()` : `{}`};
107. 		};
108. 
109. 		${name}.render = function(state, options = {}) {
110. 			var components = new Set();
111. 
112. 			function addComponent(component) {
113. 				components.add(component);
114. 			}
115. 
116. 			var result = { head: '', addComponent };
117. 			${templateProperties.store && `options.store = %store();`}
118. 			var html = ${name}._render(result, state, options);
119. 
120. 			var cssCode = Array.from(components).map(c => c.css && c.css.code).filter(Boolean).join('\\n');
121. 
122. 			return {
123. 				html,
124. 				head: result.head,
125. 				css: { code: cssCode, map: null },
126. 				toString() {
127. 					return html;
128. 				}
129. 			};
130. 		}
131. 
132. 		${name}._render = function(__result, state, options) {
133. 			__result.addComponent(${name});
134. 
135. 			state = Object.assign(${initialState.join(', ')});
136. 
137. 			${computations.map(
138. 				({ key, deps }) =>
139. 					`state.${key} = %computed-${key}(${deps.map(dep => `state.${dep}`).join(', ')});`
140. 			)}
141. 
142. 			${generator.bindings.length &&
143. 				deindent`
144. 				var settled = false;
145. 				var tmp;
146. 
147. 				while (!settled) {
148. 					settled = true;
149. 
150. 					${generator.bindings.join('\n\n')}
151. 				}
152. 			`}
153. 
154. 			return \`${generator.renderCode}\`;
155. 		};
156. 
157. 		${name}.css = {
158. 			code: ${css ? stringify(css) : `''`},
159. 			map: ${cssMap ? stringify(cssMap.toString()) : 'null'}
160. 		};
161. 
162. 		var warned = false;
163. 		${name}.renderCss = function() {
164. 			if (!warned) {
165. 				console.error('Component.renderCss(...) is deprecated and will be removed in v2 — use Component.render(...).css instead');
166. 				warned = true;
167. 			}
168. 
169. 			var components = [];
170. 
171. 			${generator.stylesheet.hasStyles &&
172. 				deindent`
173. 				components.push({
174. 					filename: ${name}.filename,
175. 					css: ${name}.css && ${name}.css.code,
176. 					map: ${name}.css && ${name}.css.map
177. 				});
178. 			`}
179. 
180. 			${templateProperties.components &&
181. 				deindent`
182. 				var seen = {};
183. 
184. 				function addComponent(component) {
185. 					var result = component.renderCss();
186. 					result.components.forEach(x => {
187. 						if (seen[x.filename]) return;
188. 						seen[x.filename] = true;
189. 						components.push(x);
190. 					});
191. 				}
192. 
193. 				${templateProperties.components.value.properties.map((prop: Node) => {
194. 					return `addComponent(%components-${getName(prop.key)});`;
195. 				})}
196. 			`}
197. 
198. 			return {
199. 				css: components.map(x => x.css).join('\\n'),
200. 				map: null,
201. 				components
202. 			};
203. 		};
204. 
205. 		${templateProperties.preload && `${name}.preload = %preload;`}
206. 
207. 		${
208. 			// TODO this is a bit hacky
209. 			/__escape/.test(generator.renderCode) && deindent`
210. 				var escaped = {
211. 					'"': '&quot;',
212. 					"'": '&##39;',
213. 					'&': '&amp;',
214. 					'<': '&lt;',
215. 					'>': '&gt;'
216. 				};
217. 
218. 				function __escape(html) {
219. 					return String(html).replace(/["'&<>]/g, match => escaped[match]);
220. 				}
221. 			`
222. 		}
223. 
224. 		${
225. 			/__isPromise/.test(generator.renderCode) && deindent`
226. 				function __isPromise(value) {
227. 					return value && typeof value.then === 'function';
228. 				}
229. 			`
230. 		}
231. 
232. 		${
233. 			/__missingComponent/.test(generator.renderCode) && deindent`
234. 				var __missingComponent = {
235. 					_render: () => ''
236. 				};
237. 			`
238. 		}
239. 	`.replace(/(@+|#+|%+)(\w*(?:-\w*)?)/g, (match: string, sigil: string, name: string) => {
240. 		if (sigil === '@') return generator.alias(name);
241. 		if (sigil === '%') return generator.templateVars.get(name);
242. 		return sigil.slice(1) + name;
243. 	});
244. 
245. 	return generator.generate(result, options, { name, format });
246. }
247. 
248. function trim(nodes) {
249. 	let start = 0;
250. 	for (; start < nodes.length; start += 1) {
251. 		const node = nodes[start];
252. 		if (node.type !== 'Text') break;
253. 
254. 		node.data = node.data.replace(/^\s+/, '');
255. 		if (node.data) break;
256. 	}
257. 
258. 	let end = nodes.length;
259. 	for (; end > start; end -= 1) {
260. 		const node = nodes[end - 1];
261. 		if (node.type !== 'Text') break;
262. 
263. 		node.data = node.data.replace(/\s+$/, '');
264. 		if (node.data) break;
265. 	}
266. 
267. 	return nodes.slice(start, end);
268. }


File: src/generators/server-side-rendering/visit.ts
Line number range: 1 - 13
Content:
1. import visitors from './visitors/index';
2. import { SsrGenerator } from './index';
3. import Block from './Block';
4. import { Node } from '../../interfaces';
5. 
6. export default function visit(
7. 	generator: SsrGenerator,
8. 	block: Block,
9. 	node: Node
10. ) {
11. 	const visitor = visitors[node.type];
12. 	visitor(generator, block, node);
13. }


File: src/generators/server-side-rendering/visitors/Component.ts
Line number range: 1 - 121
Content:
1. import flattenReference from '../../../utils/flattenReference';
2. import visit from '../visit';
3. import { SsrGenerator } from '../index';
4. import Block from '../Block';
5. import { AppendTarget } from '../interfaces';
6. import { Node } from '../../../interfaces';
7. import getObject from '../../../utils/getObject';
8. import getTailSnippet from '../../../utils/getTailSnippet';
9. import { stringify } from '../../../utils/stringify';
10. 
11. export default function visitComponent(
12. 	generator: SsrGenerator,
13. 	block: Block,
14. 	node: Node
15. ) {
16. 	function stringifyAttribute(chunk: Node) {
17. 		if (chunk.type === 'Text') return chunk.data;
18. 		if (chunk.type === 'MustacheTag') {
19. 			block.contextualise(chunk.expression);
20. 			const { snippet } = chunk.metadata;
21. 			return '${__escape( ' + snippet + ')}';
22. 		}
23. 	}
24. 
25. 	const attributes: Node[] = [];
26. 	const bindings: Node[] = [];
27. 
28. 	node.attributes.forEach((attribute: Node) => {
29. 		if (attribute.type === 'Attribute') {
30. 			attributes.push(attribute);
31. 		} else if (attribute.type === 'Binding') {
32. 			bindings.push(attribute);
33. 		}
34. 	});
35. 
36. 	const props = attributes
37. 		.map(attribute => {
38. 			let value;
39. 
40. 			if (attribute.value === true) {
41. 				value = `true`;
42. 			} else if (attribute.value.length === 0) {
43. 				value = `''`;
44. 			} else if (attribute.value.length === 1) {
45. 				const chunk = attribute.value[0];
46. 				if (chunk.type === 'Text') {
47. 					value = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;
48. 				} else {
49. 					block.contextualise(chunk.expression);
50. 					const { snippet } = chunk.metadata;
51. 					value = snippet;
52. 				}
53. 			} else {
54. 				value = '`' + attribute.value.map(stringifyAttribute).join('') + '`';
55. 			}
56. 
57. 			return `${attribute.name}: ${value}`;
58. 		})
59. 		.concat(
60. 			bindings.map(binding => {
61. 				const { name } = getObject(binding.value);
62. 				const tail = binding.value.type === 'MemberExpression'
63. 					? getTailSnippet(binding.value)
64. 					: '';
65. 
66. 				const keypath = block.contexts.has(name)
67. 					? `${name}${tail}`
68. 					: `state.${name}${tail}`;
69. 				return `${binding.name}: ${keypath}`;
70. 			})
71. 		)
72. 		.join(', ');
73. 
74. 	const isDynamicComponent = node.name === ':Component';
75. 	if (isDynamicComponent) block.contextualise(node.expression);
76. 
77. 	const expression = (
78. 		node.name === ':Self' ? generator.name :
79. 		isDynamicComponent ? `((${node.metadata.snippet}) || __missingComponent)` :
80. 		`%components-${node.name}`
81. 	);
82. 
83. 	bindings.forEach(binding => {
84. 		block.addBinding(binding, expression);
85. 	});
86. 
87. 	let open = `\${${expression}._render(__result, {${props}}`;
88. 
89. 	const options = [];
90. 	if (generator.options.store) {
91. 		options.push(`store: options.store`);
92. 	}
93. 
94. 	if (node.children.length) {
95. 		const appendTarget: AppendTarget = {
96. 			slots: { default: '' },
97. 			slotStack: ['default']
98. 		};
99. 
100. 		generator.appendTargets.push(appendTarget);
101. 
102. 		node.children.forEach((child: Node) => {
103. 			visit(generator, block, child);
104. 		});
105. 
106. 		const slotted = Object.keys(appendTarget.slots)
107. 			.map(name => `${name}: () => \`${appendTarget.slots[name]}\``)
108. 			.join(', ');
109. 
110. 		options.push(`slotted: { ${slotted} }`);
111. 
112. 		generator.appendTargets.pop();
113. 	}
114. 
115. 	if (options.length) {
116. 		open += `, { ${options.join(', ')} }`;
117. 	}
118. 
119. 	generator.append(open);
120. 	generator.append(')}');
121. }


File: src/generators/wrapModule.ts
Line number range: 1 - 299
Content:
1. import deindent from '../utils/deindent';
2. import list from '../utils/list';
3. import { CompileOptions, ModuleFormat, Node } from '../interfaces';
4. 
5. interface Dependency {
6. 	name: string;
7. 	statements: string[];
8. 	source: string;
9. }
10. 
11. const wrappers = { es, amd, cjs, iife, umd, eval: expr };
12. 
13. export default function wrapModule(
14. 	code: string,
15. 	format: ModuleFormat,
16. 	name: string,
17. 	options: CompileOptions,
18. 	banner: string,
19. 	sharedPath: string,
20. 	helpers: { name: string, alias: string }[],
21. 	imports: Node[],
22. 	source: string
23. ): string {
24. 	if (format === 'es') return es(code, name, options, banner, sharedPath, helpers, imports, source);
25. 
26. 	const dependencies = imports.map((declaration, i) => {
27. 		const defaultImport = declaration.specifiers.find(
28. 			(x: Node) =>
29. 				x.type === 'ImportDefaultSpecifier' ||
30. 				(x.type === 'ImportSpecifier' && x.imported.name === 'default')
31. 		);
32. 
33. 		const namespaceImport = declaration.specifiers.find(
34. 			(x: Node) => x.type === 'ImportNamespaceSpecifier'
35. 		);
36. 
37. 		const namedImports = declaration.specifiers.filter(
38. 			(x: Node) =>
39. 				x.type === 'ImportSpecifier' && x.imported.name !== 'default'
40. 		);
41. 
42. 		const name = defaultImport || namespaceImport
43. 			? (defaultImport || namespaceImport).local.name
44. 			: `__import${i}`;
45. 
46. 		const statements: string[] = [];
47. 
48. 		namedImports.forEach((specifier: Node) => {
49. 			statements.push(
50. 				`var ${specifier.local.name} = ${name}.${specifier.imported.name};`
51. 			);
52. 		});
53. 
54. 		if (defaultImport) {
55. 			statements.push(
56. 				`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`
57. 			);
58. 		}
59. 
60. 		return { name, statements, source: declaration.source.value };
61. 	});
62. 
63. 	if (format === 'amd') return amd(code, name, options, banner, dependencies);
64. 	if (format === 'cjs') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);
65. 	if (format === 'iife') return iife(code, name, options, banner, dependencies);
66. 	if (format === 'umd') return umd(code, name, options, banner, dependencies);
67. 	if (format === 'eval') return expr(code, name, options, banner, dependencies);
68. 
69. 	throw new Error(`options.format is invalid (must be ${list(Object.keys(wrappers))})`);
70. }
71. 
72. function es(
73. 	code: string,
74. 	name: string,
75. 	options: CompileOptions,
76. 	banner: string,
77. 	sharedPath: string,
78. 	helpers: { name: string, alias: string }[],
79. 	imports: Node[],
80. 	source: string
81. ) {
82. 	const importHelpers = helpers && (
83. 		`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(', ')} } from ${JSON.stringify(sharedPath)};`
84. 	);
85. 
86. 	const importBlock = imports.length > 0 && (
87. 		imports
88. 			.map((declaration: Node) => source.slice(declaration.start, declaration.end))
89. 			.join('\n')
90. 	);
91. 
92. 	return deindent`
93. 		${banner}
94. 		${importHelpers}
95. 		${importBlock}
96. 
97. 		${code}
98. 		export default ${name};`;
99. }
100. 
101. function amd(
102. 	code: string,
103. 	name: string,
104. 	options: CompileOptions,
105. 	banner: string,
106. 	dependencies: Dependency[]
107. ) {
108. 	const sourceString = dependencies.length
109. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
110. 		: '';
111. 
112. 	const id = options.amd && options.amd.id;
113. 
114. 	return deindent`
115. 		define(${id ? `"${id}", ` : ''}${sourceString}function(${paramString(dependencies)}) { "use strict";
116. 			${getCompatibilityStatements(dependencies)}
117. 
118. 			${code}
119. 			return ${name};
120. 		});`;
121. }
122. 
123. function cjs(
124. 	code: string,
125. 	name: string,
126. 	options: CompileOptions,
127. 	banner: string,
128. 	sharedPath: string,
129. 	helpers: { name: string, alias: string }[],
130. 	dependencies: Dependency[]
131. ) {
132. 	const SHARED = '__shared';
133. 	const helperBlock = helpers && (
134. 		`var ${SHARED} = require(${JSON.stringify(sharedPath)});\n` +
135. 		helpers.map(helper => {
136. 			return `var ${helper.alias} = ${SHARED}.${helper.name};`;
137. 		}).join('\n')
138. 	);
139. 
140. 	const requireBlock = dependencies.length > 0 && (
141. 		dependencies
142. 			.map(d => `var ${d.name} = require("${d.source}");`)
143. 			.join('\n\n')
144. 	);
145. 
146. 	return deindent`
147. 		${banner}
148. 		"use strict";
149. 
150. 		${helperBlock}
151. 		${requireBlock}
152. 		${getCompatibilityStatements(dependencies)}
153. 
154. 		${code}
155. 
156. 		module.exports = ${name};`
157. }
158. 
159. function iife(
160. 	code: string,
161. 	name: string,
162. 	options: CompileOptions,
163. 	banner: string,
164. 	dependencies: Dependency[]
165. ) {
166. 	if (!options.name) {
167. 		throw new Error(`Missing required 'name' option for IIFE export`);
168. 	}
169. 
170. 	const globals = getGlobals(dependencies, options);
171. 
172. 	return deindent`
173. 		${banner}
174. 		var ${options.name} = (function(${paramString(dependencies)}) { "use strict";
175. 			${getCompatibilityStatements(dependencies)}
176. 
177. 			${code}
178. 			return ${name};
179. 		}(${globals.join(', ')}));`;
180. }
181. 
182. function umd(
183. 	code: string,
184. 	name: string,
185. 	options: CompileOptions,
186. 	banner: string,
187. 	dependencies: Dependency[]
188. ) {
189. 	if (!options.name) {
190. 		throw new Error(`Missing required 'name' option for UMD export`);
191. 	}
192. 
193. 	const amdId = options.amd && options.amd.id ? `'${options.amd.id}', ` : '';
194. 
195. 	const amdDeps = dependencies.length
196. 		? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(', ')}], `
197. 		: '';
198. 
199. 	const cjsDeps = dependencies
200. 		.map(d => `require("${d.source}")`)
201. 		.join(', ');
202. 
203. 	const globals = getGlobals(dependencies, options);
204. 
205. 	return deindent`
206. 		${banner}
207. 		(function(global, factory) {
208. 			typeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :
209. 			typeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :
210. 			(global.${options.name} = factory(${globals.join(', ')}));
211. 		}(this, (function (${paramString(dependencies)}) { "use strict";
212. 
213. 			${getCompatibilityStatements(dependencies)}
214. 
215. 			${code}
216. 
217. 			return ${name};
218. 
219. 		})));`;
220. }
221. 
222. function expr(
223. 	code: string,
224. 	name: string,
225. 	options: CompileOptions,
226. 	banner: string,
227. 	dependencies: Dependency[]
228. ) {
229. 	const globals = getGlobals(dependencies, options);
230. 
231. 	return deindent`
232. 		(function (${paramString(dependencies)}) { "use strict";
233. 			${banner}
234. 
235. 			${getCompatibilityStatements(dependencies)}
236. 
237. 			${code}
238. 
239. 			return ${name};
240. 		}(${globals.join(', ')}))`;
241. }
242. 
243. function paramString(dependencies: Dependency[]) {
244. 	return dependencies.map(dep => dep.name).join(', ');
245. }
246. 
247. function removeExtension(file: string) {
248. 	const index = file.lastIndexOf('.');
249. 	return ~index ? file.slice(0, index) : file;
250. }
251. 
252. function getCompatibilityStatements(dependencies: Dependency[]) {
253. 	if (!dependencies.length) return null;
254. 
255. 	const statements: string[] = [];
256. 
257. 	dependencies.forEach(dependency => {
258. 		statements.push(...dependency.statements);
259. 	});
260. 
261. 	return statements.join('\n');
262. }
263. 
264. function getGlobals(dependencies: Dependency[], options: CompileOptions) {
265. 	const { globals, onerror, onwarn } = options;
266. 	const globalFn = getGlobalFn(globals);
267. 
268. 	return dependencies.map(d => {
269. 		let name = globalFn(d.source);
270. 
271. 		if (!name) {
272. 			if (d.name.startsWith('__import')) {
273. 				const error = new Error(
274. 					`Could not determine name for imported module '${d.source}' – use options.globals`
275. 				);
276. 				onerror(error);
277. 			} else {
278. 				const warning = {
279. 					message: `No name was supplied for imported module '${d.source}'. Guessing '${d.name}', but you should use options.globals`,
280. 				};
281. 
282. 				onwarn(warning);
283. 			}
284. 
285. 			name = d.name;
286. 		}
287. 
288. 		return name;
289. 	});
290. }
291. 
292. function getGlobalFn(globals: any): (id: string) => string {
293. 	if (typeof globals === 'function') return globals;
294. 	if (typeof globals === 'object') {
295. 		return id => globals[id];
296. 	}
297. 
298. 	return () => undefined;
299. }


File: src/interfaces.ts
Line number range: 1 - 92
Content:
1. import {SourceMap} from 'magic-string';
2. 
3. export interface Node {
4. 	start: number;
5. 	end: number;
6. 	type: string;
7. 	[propName: string]: any;
8. }
9. 
10. export interface Parser {
11. 	readonly template: string;
12. 	readonly filename?: string;
13. 
14. 	index: number;
15. 	stack: Array<Node>;
16. 
17. 	html: Node;
18. 	css: Node;
19. 	js: Node;
20. 	metaTags: {};
21. }
22. 
23. export interface Parsed {
24. 	hash: number;
25. 	html: Node;
26. 	css: Node;
27. 	js: Node;
28. }
29. 
30. export interface Warning {
31. 	loc?: { line: number; column: number; pos?: number };
32. 	pos?: number;
33. 	message: string;
34. 	filename?: string;
35. 	frame?: string;
36. 	toString: () => string;
37. }
38. 
39. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';
40. 
41. export interface CompileOptions {
42. 	format?: ModuleFormat;
43. 	name?: string;
44. 	filename?: string;
45. 	generate?: string;
46. 	globals?: ((id: string) => string) | object;
47. 	amd?: {
48. 		id?: string;
49. 	};
50. 
51. 	outputFilename?: string;
52. 	cssOutputFilename?: string;
53. 
54. 	dev?: boolean;
55. 	shared?: boolean | string;
56. 	cascade?: boolean;
57. 	hydratable?: boolean;
58. 	legacy?: boolean;
59. 	customElement?: CustomElementOptions | true;
60. 	css?: boolean;
61. 	store?: boolean;
62. 
63. 	onerror?: (error: Error) => void;
64. 	onwarn?: (warning: Warning) => void;
65. }
66. 
67. export interface GenerateOptions {
68. 	name: string;
69. 	format: ModuleFormat;
70. 	banner?: string;
71. 	sharedPath?: string;
72. 	helpers?: { name: string, alias: string }[];
73. }
74. 
75. export interface Visitor {
76. 	enter: (node: Node) => void;
77. 	leave?: (node: Node) => void;
78. }
79. 
80. export interface CustomElementOptions {
81. 	tag?: string;
82. 	props?: string[];
83. }
84. 
85. export interface PreprocessOptions {
86. 	markup?: (options: {content: string, filename: string}) => { code: string, map?: SourceMap | string };
87. 	style?: Preprocessor;
88. 	script?: Preprocessor;
89. 	filename?: string
90. }
91. 
92. export type Preprocessor = (options: {content: string, attributes: Record<string, string | boolean>, filename?: string}) => { code: string, map?: SourceMap | string };


File: src/server-side-rendering/register.js
Line number range: 1 - 46
Content:
1. import * as fs from 'fs';
2. import * as path from 'path';
3. import { compile } from '../index.ts';
4. 
5. const compileOptions = {};
6. 
7. function capitalise(name) {
8. 	return name[0].toUpperCase() + name.slice(1);
9. }
10. 
11. export default function register(options) {
12. 	const { extensions } = options;
13. 
14. 	if (extensions) {
15. 		_deregister('.html');
16. 		extensions.forEach(_register);
17. 	}
18. 
19. 	// TODO make this the default and remove in v2
20. 	if ('store' in options) compileOptions.store = options.store;
21. }
22. 
23. function _deregister(extension) {
24. 	delete require.extensions[extension];
25. }
26. 
27. function _register(extension) {
28. 	require.extensions[extension] = function(module, filename) {
29. 		const name = path.basename(filename)
30. 			.slice(0, -path.extname(filename).length)
31. 			.replace(/^\d/, '_$&')
32. 			.replace(/[^a-zA-Z0-9_$]/g, '');
33. 
34. 		const options = Object.assign({}, compileOptions, {
35. 			filename,
36. 			name: capitalise(name),
37. 			generate: 'ssr'
38. 		});
39. 
40. 		const {code} = compile(fs.readFileSync(filename, 'utf-8'), options);
41. 
42. 		return module._compile(code, filename);
43. 	};
44. }
45. 
46. _register('.html');


File: store.js
Line number range: 1 - 164
Content:
1. import {
2. 	assign,
3. 	blankObject,
4. 	differs,
5. 	dispatchObservers,
6. 	get,
7. 	observe
8. } from './shared.js';
9. 
10. function Store(state) {
11. 	this._observers = { pre: blankObject(), post: blankObject() };
12. 	this._changeHandlers = [];
13. 	this._dependents = [];
14. 
15. 	this._computed = blankObject();
16. 	this._sortedComputedProperties = [];
17. 
18. 	this._state = assign({}, state);
19. }
20. 
21. assign(Store.prototype, {
22. 	_add: function(component, props) {
23. 		this._dependents.push({
24. 			component: component,
25. 			props: props
26. 		});
27. 	},
28. 
29. 	_init: function(props) {
30. 		var state = {};
31. 		for (var i = 0; i < props.length; i += 1) {
32. 			var prop = props[i];
33. 			state['$' + prop] = this._state[prop];
34. 		}
35. 		return state;
36. 	},
37. 
38. 	_remove: function(component) {
39. 		var i = this._dependents.length;
40. 		while (i--) {
41. 			if (this._dependents[i].component === component) {
42. 				this._dependents.splice(i, 1);
43. 				return;
44. 			}
45. 		}
46. 	},
47. 
48. 	_sortComputedProperties: function() {
49. 		var computed = this._computed;
50. 		var sorted = this._sortedComputedProperties = [];
51. 		var cycles;
52. 		var visited = blankObject();
53. 
54. 		function visit(key) {
55. 			if (cycles[key]) {
56. 				throw new Error('Cyclical dependency detected');
57. 			}
58. 
59. 			if (visited[key]) return;
60. 			visited[key] = true;
61. 
62. 			var c = computed[key];
63. 
64. 			if (c) {
65. 				cycles[key] = true;
66. 				c.deps.forEach(visit);
67. 				sorted.push(c);
68. 			}
69. 		}
70. 
71. 		for (var key in this._computed) {
72. 			cycles = blankObject();
73. 			visit(key);
74. 		}
75. 	},
76. 
77. 	compute: function(key, deps, fn) {
78. 		var store = this;
79. 		var value;
80. 
81. 		var c = {
82. 			deps: deps,
83. 			update: function(state, changed, dirty) {
84. 				var values = deps.map(function(dep) {
85. 					if (dep in changed) dirty = true;
86. 					return state[dep];
87. 				});
88. 
89. 				if (dirty) {
90. 					var newValue = fn.apply(null, values);
91. 					if (differs(newValue, value)) {
92. 						value = newValue;
93. 						changed[key] = true;
94. 						state[key] = value;
95. 					}
96. 				}
97. 			}
98. 		};
99. 
100. 		c.update(this._state, {}, true);
101. 
102. 		this._computed[key] = c;
103. 		this._sortComputedProperties();
104. 	},
105. 
106. 	get: get,
107. 
108. 	observe: observe,
109. 
110. 	onchange: function(callback) {
111. 		this._changeHandlers.push(callback);
112. 		return {
113. 			cancel: function() {
114. 				var index = this._changeHandlers.indexOf(callback);
115. 				if (~index) this._changeHandlers.splice(index, 1);
116. 			}
117. 		};
118. 	},
119. 
120. 	set: function(newState) {
121. 		var oldState = this._state,
122. 			changed = this._changed = {},
123. 			dirty = false;
124. 
125. 		for (var key in newState) {
126. 			if (this._computed[key]) throw new Error("'" + key + "' is a read-only property");
127. 			if (differs(newState[key], oldState[key])) changed[key] = dirty = true;
128. 		}
129. 		if (!dirty) return;
130. 
131. 		this._state = assign({}, oldState, newState);
132. 
133. 		for (var i = 0; i < this._sortedComputedProperties.length; i += 1) {
134. 			this._sortedComputedProperties[i].update(this._state, changed);
135. 		}
136. 
137. 		for (var i = 0; i < this._changeHandlers.length; i += 1) {
138. 			this._changeHandlers[i](this._state, changed);
139. 		}
140. 
141. 		dispatchObservers(this, this._observers.pre, changed, this._state, oldState);
142. 
143. 		var dependents = this._dependents.slice(); // guard against mutations
144. 		for (var i = 0; i < dependents.length; i += 1) {
145. 			var dependent = dependents[i];
146. 			var componentState = {};
147. 			dirty = false;
148. 
149. 			for (var j = 0; j < dependent.props.length; j += 1) {
150. 				var prop = dependent.props[j];
151. 				if (prop in changed) {
152. 					componentState['$' + prop] = this._state[prop];
153. 					dirty = true;
154. 				}
155. 			}
156. 
157. 			if (dirty) dependent.component.set(componentState);
158. 		}
159. 
160. 		dispatchObservers(this, this._observers.post, changed, this._state, oldState);
161. 	}
162. });
163. 
164. export { Store };


File: test/server-side-rendering/index.js
Line number range: 1 - 132
Content:
1. import assert from "assert";
2. import * as fs from "fs";
3. import * as path from "path";
4. import glob from 'glob';
5. 
6. import {
7. 	showOutput,
8. 	loadConfig,
9. 	setupHtmlEqual,
10. 	tryToLoadJson
11. } from "../helpers.js";
12. 
13. function tryToReadFile(file) {
14. 	try {
15. 		return fs.readFileSync(file, "utf-8");
16. 	} catch (err) {
17. 		if (err.code !== "ENOENT") throw err;
18. 		return null;
19. 	}
20. }
21. 
22. describe("ssr", () => {
23. 	before(() => {
24. 		require("../../ssr/register")({
25. 			extensions: ['.svelte', '.html'],
26. 			store: true
27. 		});
28. 
29. 		return setupHtmlEqual();
30. 	});
31. 
32. 	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
33. 		if (dir[0] === ".") return;
34. 
35. 		// add .solo to a sample directory name to only run that test, or
36. 		// .show to always show the output. or both
37. 		const solo = /\.solo/.test(dir);
38. 		const show = /\.show/.test(dir);
39. 
40. 		if (solo && process.env.CI) {
41. 			throw new Error("Forgot to remove `solo: true` from test");
42. 		}
43. 
44. 		(solo ? it.only : it)(dir, () => {
45. 			dir = path.resolve("test/server-side-rendering/samples", dir);
46. 			try {
47. 				let component;
48. 
49. 				const mainHtmlFile = `${dir}/main.html`;
50. 				const mainSvelteFile = `${dir}/main.svelte`;
51. 				if (fs.existsSync(mainHtmlFile)) {
52. 					component = require(mainHtmlFile);
53. 				} else if (fs.existsSync(mainSvelteFile)) {
54. 					component = require(mainSvelteFile);
55. 				}
56. 
57. 				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
58. 				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";
59. 
60. 				const data = tryToLoadJson(`${dir}/data.json`);
61. 
62. 				const rendered = component.render(data);
63. 				const { html, css, head } = rendered;
64. 
65. 				// rendered.toString() === rendered.html
66. 				assert.equal(rendered, html);
67. 
68. 				fs.writeFileSync(`${dir}/_actual.html`, html);
69. 				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);
70. 
71. 				assert.htmlEqual(html, expectedHtml);
72. 				assert.equal(
73. 					css.code.replace(/^\s+/gm, ""),
74. 					expectedCss.replace(/^\s+/gm, "")
75. 				);
76. 
77. 				if (fs.existsSync(`${dir}/_expected-head.html`)) {
78. 					fs.writeFileSync(`${dir}/_actual-head.html`, head);
79. 					assert.htmlEqual(
80. 						head,
81. 						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
82. 					);
83. 				}
84. 
85. 				if (show) showOutput(dir, { generate: 'ssr' });
86. 			} catch (err) {
87. 				showOutput(dir, { generate: 'ssr' });
88. 				throw err;
89. 			}
90. 		});
91. 	});
92. 
93. 	// duplicate client-side tests, as far as possible
94. 	fs.readdirSync("test/runtime/samples").forEach(dir => {
95. 		if (dir[0] === ".") return;
96. 
97. 		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);
98. 
99. 		if (config.solo && process.env.CI) {
100. 			throw new Error("Forgot to remove `solo: true` from test");
101. 		}
102. 
103. 		if (config["skip-ssr"]) return;
104. 
105. 		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
106. 			const cwd = path.resolve("test/runtime/samples", dir);
107. 
108. 			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
109. 				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
110. 				delete require.cache[resolved];
111. 			});
112. 
113. 			require("../../ssr/register")({
114. 				store: !!config.store
115. 			});
116. 
117. 			try {
118. 				const component = require(`../runtime/samples/${dir}/main.html`);
119. 				const { html } = component.render(config.data, {
120. 					store: (config.store !== true) && config.store
121. 				});
122. 
123. 				if (config.html) {
124. 					assert.htmlEqual(html, config.html);
125. 				}
126. 			} catch (err) {
127. 				showOutput(cwd, { generate: "ssr" });
128. 				throw err;
129. 			}
130. 		});
131. 	});
132. });

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 14:00:55,017 - thread-135845298308800.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='We have the critical SSR code paths and helpers: SSR generator (index.ts), SSR visitors for Component (which emit nested component calls), SSR Block (bindings), wrapModule (module structure), interfaces (CompileOptions.store), server-side-rendering/register (store option wiring), and store.js (_init implementation). The issue revolves around SSR nested components calling _render without initializing their own store, which is evident in the provided code. No further files are needed to diagnose and propose a fix. Therefore, no additional context is required.' query='' extra_requirements='' purpose='The existing context fully covers the SSR nested component rendering and store propagation mechanisms needed to analyze and fix the bug.'
2025-11-12 14:00:55,022 - thread-135845298308800.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='src/generators/nodes/Component.ts', content='1. import deindent from \'../../utils/deindent\';\n2. import { stringify } from \'../../utils/stringify\';\n3. import stringifyProps from \'../../utils/stringifyProps\';\n4. import CodeBuilder from \'../../utils/CodeBuilder\';\n5. import getTailSnippet from \'../../utils/getTailSnippet\';\n6. import getObject from \'../../utils/getObject\';\n7. import getExpressionPrecedence from \'../../utils/getExpressionPrecedence\';\n8. import Node from \'./shared/Node\';\n9. import Block from \'../dom/Block\';\n10. import Attribute from \'./Attribute\';\n11. \n12. export default class Component extends Node {\n13. \ttype: \'Component\';\n14. \tname: string;\n15. \tattributes: Attribute[];\n16. \tchildren: Node[];\n17. \n18. \tinit(\n19. \t\tblock: Block,\n20. \t\tstripWhitespace: boolean,\n21. \t\tnextSibling: Node\n22. \t) {\n23. \t\tthis.cannotUseInnerHTML();\n24. \n25. \t\tthis.attributes.forEach((attribute: Node) => {\n26. \t\t\tif (attribute.type === \'Attribute\' && attribute.value !== true) {\n27. \t\t\t\tattribute.value.forEach((chunk: Node) => {\n28. \t\t\t\t\tif (chunk.type !== \'Text\') {\n29. \t\t\t\t\t\tconst dependencies = chunk.metadata.dependencies;\n30. \t\t\t\t\t\tblock.addDependencies(dependencies);\n31. \t\t\t\t\t}\n32. \t\t\t\t});\n33. \t\t\t} else {\n34. \t\t\t\tif (attribute.type === \'EventHandler\' && attribute.expression) {\n35. \t\t\t\t\tattribute.expression.arguments.forEach((arg: Node) => {\n36. \t\t\t\t\t\tblock.addDependencies(arg.metadata.dependencies);\n37. \t\t\t\t\t});\n38. \t\t\t\t} else if (attribute.type === \'Binding\') {\n39. \t\t\t\t\tblock.addDependencies(attribute.metadata.dependencies);\n40. \t\t\t\t}\n41. \t\t\t}\n42. \t\t});\n43. \n44. \t\tthis.var = block.getUniqueName(\n45. \t\t\t(\n46. \t\t\t\tthis.name === \':Self\' ? this.generator.name :\n47. \t\t\t\tthis.name === \':Component\' ? \'switch_instance\' :\n48. \t\t\t\tthis.name\n49. \t\t\t).toLowerCase()\n50. \t\t);\n51. \n52. \t\tif (this.children.length) {\n53. \t\t\tthis._slots = new Set([\'default\']);\n54. \n55. \t\t\tthis.children.forEach(child => {\n56. \t\t\t\tchild.init(block, stripWhitespace, nextSibling);\n57. \t\t\t});\n58. \t\t}\n59. \t}\n60. \n61. \tbuild(\n62. \t\tblock: Block,\n63. \t\tparentNode: string,\n64. \t\tparentNodes: string\n65. \t) {\n66. \t\tconst { generator } = this;\n67. \t\tgenerator.hasComponents = true;\n68. \n69. \t\tconst name = this.var;\n70. \n71. \t\tconst componentInitProperties = [`root: #component.root`];\n72. \n73. \t\tif (this.children.length > 0) {\n74. \t\t\tconst slots = Array.from(this._slots).map(name => `${name}: @createFragment()`);\n75. \t\t\tcomponentInitProperties.push(`slots: { ${slots.join(\', \')} }`);\n76. \n77. \t\t\tthis.children.forEach((child: Node) => {\n78. \t\t\t\tchild.build(block, `${this.var}._slotted.default`, \'nodes\');\n79. \t\t\t});\n80. \t\t}\n81. \n82. \t\tconst allContexts = new Set();\n83. \t\tconst statements: string[] = [];\n84. \t\tconst name_context = block.getUniqueName(`${name}_context`);\n85. \n86. \t\tlet name_updating: string;\n87. \t\tlet name_initial_data: string;\n88. \t\tlet beforecreate: string = null;\n89. \n90. \t\tconst attributes = this.attributes\n91. \t\t\t.filter(a => a.type === \'Attribute\')\n92. \t\t\t.map(a => mungeAttribute(a, block));\n93. \n94. \t\tconst bindings = this.attributes\n95. \t\t\t.filter(a => a.type === \'Binding\')\n96. \t\t\t.map(a => mungeBinding(a, block));\n97. \n98. \t\tconst eventHandlers = this.attributes\n99. \t\t\t.filter((a: Node) => a.type === \'EventHandler\')\n100. \t\t\t.map(a => mungeEventHandler(generator, this, a, block, name_context, allContexts));\n101. \n102. \t\tconst ref = this.attributes.find((a: Node) => a.type === \'Ref\');\n103. \t\tif (ref) generator.usesRefs = true;\n104. \n105. \t\tconst updates: string[] = [];\n106. \n107. \t\tif (attributes.length || bindings.length) {\n108. \t\t\tconst initialProps = attributes\n109. \t\t\t\t.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);\n110. \n111. \t\t\tconst initialPropString = stringifyProps(initialProps);\n112. \n113. \t\t\tattributes\n114. \t\t\t\t.filter((attribute: Attribute) => attribute.dynamic)\n115. \t\t\t\t.forEach((attribute: Attribute) => {\n116. \t\t\t\t\tif (attribute.dependencies.length) {\n117. \t\t\t\t\t\tupdates.push(deindent`\n118. \t\t\t\t\t\t\tif (${attribute.dependencies\n119. \t\t\t\t\t\t\t\t.map(dependency => `changed.${dependency}`)\n120. \t\t\t\t\t\t\t\t.join(\' || \')}) ${name}_changes.${attribute.name} = ${attribute.value};\n121. \t\t\t\t\t\t`);\n122. \t\t\t\t\t}\n123. \n124. \t\t\t\t\telse {\n125. \t\t\t\t\t\t// TODO this is an odd situation to encounter – I *think* it should only happen with\n126. \t\t\t\t\t\t// each block indices, in which case it may be possible to optimise this\n127. \t\t\t\t\t\tupdates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);\n128. \t\t\t\t\t}\n129. \t\t\t\t});\n130. \n131. \t\t\tif (bindings.length) {\n132. \t\t\t\tgenerator.hasComplexBindings = true;\n133. \n134. \t\t\t\tname_updating = block.alias(`${name}_updating`);\n135. \t\t\t\tname_initial_data = block.getUniqueName(`${name}_initial_data`);\n136. \n137. \t\t\t\tblock.addVariable(name_updating, \'{}\');\n138. \t\t\t\tstatements.push(`var ${name_initial_data} = ${initialPropString};`);\n139. \n140. \t\t\t\tconst setParentFromChildOnChange = new CodeBuilder();\n141. \t\t\t\tconst setParentFromChildOnInit = new CodeBuilder();\n142. \n143. \t\t\t\tbindings.forEach((binding: Binding) => {\n144. \t\t\t\t\tlet setParentFromChild;\n145. \n146. \t\t\t\t\tbinding.contexts.forEach(context => {\n147. \t\t\t\t\t\tallContexts.add(context);\n148. \t\t\t\t\t});\n149. \n150. \t\t\t\t\tconst { name: key } = getObject(binding.value);\n151. \n152. \t\t\t\t\tif (block.contexts.has(key)) {\n153. \t\t\t\t\t\tconst prop = binding.dependencies[0];\n154. \t\t\t\t\t\tconst computed = isComputed(binding.value);\n155. \t\t\t\t\t\tconst tail = binding.value.type === \'MemberExpression\' ? getTailSnippet(binding.value) : \'\';\n156. \n157. \t\t\t\t\t\tsetParentFromChild = deindent`\n158. \t\t\t\t\t\t\tvar list = ${name_context}.${block.listNames.get(key)};\n159. \t\t\t\t\t\t\tvar index = ${name_context}.${block.indexNames.get(key)};\n160. \t\t\t\t\t\t\tlist[index]${tail} = childState.${binding.name};\n161. \n162. \t\t\t\t\t\t\t${binding.dependencies\n163. \t\t\t\t\t\t\t\t.map((prop: string) => `newState.${prop} = state.${prop};`)\n164. \t\t\t\t\t\t\t\t.join(\'\\n\')}\n165. \t\t\t\t\t\t`;\n166. \t\t\t\t\t}\n167. \n168. \t\t\t\t\telse if (binding.value.type === \'MemberExpression\') {\n169. \t\t\t\t\t\tsetParentFromChild = deindent`\n170. \t\t\t\t\t\t\t${binding.snippet} = childState.${binding.name};\n171. \t\t\t\t\t\t\t${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join(\'\\n\')}\n172. \t\t\t\t\t\t`;\n173. \t\t\t\t\t}\n174. \n175. \t\t\t\t\telse {\n176. \t\t\t\t\t\tsetParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;\n177. \t\t\t\t\t}\n178. \n179. \t\t\t\t\tstatements.push(deindent`\n180. \t\t\t\t\t\tif (${binding.prop} in ${binding.obj}) {\n181. \t\t\t\t\t\t\t${name_initial_data}.${binding.name} = ${binding.snippet};\n182. \t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n183. \t\t\t\t\t\t}`\n184. \t\t\t\t\t);\n185. \n186. \t\t\t\t\tsetParentFromChildOnChange.addConditional(\n187. \t\t\t\t\t\t`!${name_updating}.${binding.name} && changed.${binding.name}`,\n188. \t\t\t\t\t\tsetParentFromChild\n189. \t\t\t\t\t);\n190. \n191. \t\t\t\t\tsetParentFromChildOnInit.addConditional(\n192. \t\t\t\t\t\t`!${name_updating}.${binding.name}`,\n193. \t\t\t\t\t\tsetParentFromChild\n194. \t\t\t\t\t);\n195. \n196. \t\t\t\t\t// TODO could binding.dependencies.length ever be 0?\n197. \t\t\t\t\tif (binding.dependencies.length) {\n198. \t\t\t\t\t\tupdates.push(deindent`\n199. \t\t\t\t\t\t\tif (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(\' || \')}) {\n200. \t\t\t\t\t\t\t\t${name}_changes.${binding.name} = ${binding.snippet};\n201. \t\t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n202. \t\t\t\t\t\t\t}\n203. \t\t\t\t\t\t`);\n204. \t\t\t\t\t}\n205. \t\t\t\t});\n206. \n207. \t\t\t\tcomponentInitProperties.push(`data: ${name_initial_data}`);\n208. \n209. \t\t\t\tcomponentInitProperties.push(deindent`\n210. \t\t\t\t\t_bind: function(changed, childState) {\n211. \t\t\t\t\t\tvar state = #component.get(), newState = {};\n212. \t\t\t\t\t\t${setParentFromChildOnChange}\n213. \t\t\t\t\t\t${name_updating} = @assign({}, changed);\n214. \t\t\t\t\t\t#component._set(newState);\n215. \t\t\t\t\t\t${name_updating} = {};\n216. \t\t\t\t\t}\n217. \t\t\t\t`);\n218. \n219. \t\t\t\tbeforecreate = deindent`\n220. \t\t\t\t\t#component.root._beforecreate.push(function() {\n221. \t\t\t\t\t\tvar state = #component.get(), childState = ${name}.get(), newState = {};\n222. \t\t\t\t\t\tif (!childState) return;\n223. \t\t\t\t\t\t${setParentFromChildOnInit}\n224. \t\t\t\t\t\t${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(\', \')} };\n225. \t\t\t\t\t\t#component._set(newState);\n226. \t\t\t\t\t\t${name_updating} = {};\n227. \t\t\t\t\t});\n228. \t\t\t\t`;\n229. \t\t\t} else if (initialProps.length) {\n230. \t\t\t\tcomponentInitProperties.push(`data: ${initialPropString}`);\n231. \t\t\t}\n232. \t\t}\n233. \n234. \t\tconst isDynamicComponent = this.name === \':Component\';\n235. \n236. \t\tconst switch_vars = isDynamicComponent && {\n237. \t\t\tvalue: block.getUniqueName(\'switch_value\'),\n238. \t\t\tprops: block.getUniqueName(\'switch_props\')\n239. \t\t};\n240. \n241. \t\tconst expression = (\n242. \t\t\tthis.name === \':Self\' ? generator.name :\n243. \t\t\tisDynamicComponent ? switch_vars.value :\n244. \t\t\t`%components-${this.name}`\n245. \t\t);\n246. \n247. \t\tif (isDynamicComponent) {\n248. \t\t\tblock.contextualise(this.expression);\n249. \t\t\tconst { dependencies, snippet } = this.metadata;\n250. \n251. \t\t\tconst anchor = this.getOrCreateAnchor(block, parentNode, parentNodes);\n252. \n253. \t\t\tconst params = block.params.join(\', \');\n254. \n255. \t\t\tblock.builders.init.addBlock(deindent`\n256. \t\t\t\tvar ${switch_vars.value} = ${snippet};\n257. \n258. \t\t\t\tfunction ${switch_vars.props}(${params}) {\n259. \t\t\t\t\t${statements.length > 0 && statements.join(\'\\n\')}\n260. \t\t\t\t\treturn {\n261. \t\t\t\t\t\t${componentInitProperties.join(\',\\n\')}\n262. \t\t\t\t\t};\n263. \t\t\t\t}\n264. \n265. \t\t\t\tif (${switch_vars.value}) {\n266. \t\t\t\t\tvar ${name} = new ${expression}(${switch_vars.props}(${params}));\n267. \n268. \t\t\t\t\t${beforecreate}\n269. \t\t\t\t}\n270. \n271. \t\t\t\t${eventHandlers.map(handler => deindent`\n272. \t\t\t\t\tfunction ${handler.var}(event) {\n273. \t\t\t\t\t\t${handler.body}\n274. \t\t\t\t\t}\n275. \n276. \t\t\t\t\tif (${name}) ${name}.on("${handler.name}", ${handler.var});\n277. \t\t\t\t`)}\n278. \t\t\t`);\n279. \n280. \t\t\tblock.builders.create.addLine(\n281. \t\t\t\t`if (${name}) ${name}._fragment.c();`\n282. \t\t\t);\n283. \n284. \t\t\tif (parentNodes) {\n285. \t\t\t\tblock.builders.claim.addLine(\n286. \t\t\t\t\t`if (${name}) ${name}._fragment.l(${parentNodes});`\n287. \t\t\t\t);\n288. \t\t\t}\n289. \n290. \t\t\tblock.builders.mount.addLine(\n291. \t\t\t\t`if (${name}) ${name}._mount(${parentNode || \'#target\'}, ${parentNode ? \'null\' : \'anchor\'});`\n292. \t\t\t);\n293. \n294. \t\t\tconst updateMountNode = this.getUpdateMountNode(anchor);\n295. \n296. \t\t\tblock.builders.update.addBlock(deindent`\n297. \t\t\t\tif (${switch_vars.value} !== (${switch_vars.value} = ${snippet})) {\n298. \t\t\t\t\tif (${name}) ${name}.destroy();\n299. \n300. \t\t\t\t\tif (${switch_vars.value}) {\n301. \t\t\t\t\t\t${name} = new ${switch_vars.value}(${switch_vars.props}(${params}));\n302. \t\t\t\t\t\t${name}._fragment.c();\n303. \n304. \t\t\t\t\t\t${this.children.map(child => remount(generator, child, name))}\n305. \t\t\t\t\t\t${name}._mount(${updateMountNode}, ${anchor});\n306. \n307. \t\t\t\t\t\t${eventHandlers.map(handler => deindent`\n308. \t\t\t\t\t\t\t${name}.on("${handler.name}", ${handler.var});\n309. \t\t\t\t\t\t`)}\n310. \n311. \t\t\t\t\t\t${ref && `#component.refs.${ref.name} = ${name};`}\n312. \t\t\t\t\t}\n313. \n314. \t\t\t\t\t${ref && deindent`\n315. \t\t\t\t\t\telse if (#component.refs.${ref.name} === ${name}) {\n316. \t\t\t\t\t\t\t#component.refs.${ref.name} = null;\n317. \t\t\t\t\t\t}`}\n318. \t\t\t\t}\n319. \t\t\t`);\n320. \n321. \t\t\tif (updates.length) {\n322. \t\t\t\tblock.builders.update.addBlock(deindent`\n323. \t\t\t\t\telse {\n324. \t\t\t\t\t\tvar ${name}_changes = {};\n325. \t\t\t\t\t\t${updates.join(\'\\n\')}\n326. \t\t\t\t\t\t${name}._set(${name}_changes);\n327. \t\t\t\t\t\t${bindings.length && `${name_updating} = {};`}\n328. \t\t\t\t\t}\n329. \t\t\t\t`);\n330. \t\t\t}\n331. \n332. \t\t\tif (!parentNode) block.builders.unmount.addLine(`if (${name}) ${name}._unmount();`);\n333. \n334. \t\t\tblock.builders.destroy.addLine(`if (${name}) ${name}.destroy(false);`);\n335. \t\t} else {\n336. \t\t\tblock.builders.init.addBlock(deindent`\n337. \t\t\t\t${statements.join(\'\\n\')}\n338. \t\t\t\tvar ${name} = new ${expression}({\n339. \t\t\t\t\t${componentInitProperties.join(\',\\n\')}\n340. \t\t\t\t});\n341. \n342. \t\t\t\t${beforecreate}\n343. \n344. \t\t\t\t${eventHandlers.map(handler => deindent`\n345. \t\t\t\t\t${name}.on("${handler.name}", function(event) {\n346. \t\t\t\t\t\t${handler.body}\n347. \t\t\t\t\t});\n348. \t\t\t\t`)}\n349. \n350. \t\t\t\t${ref && `#component.refs.${ref.name} = ${name};`}\n351. \t\t\t`);\n352. \n353. \t\t\tblock.builders.create.addLine(`${name}._fragment.c();`);\n354. \n355. \t\t\tif (parentNodes) {\n356. \t\t\t\tblock.builders.claim.addLine(\n357. \t\t\t\t\t`${name}._fragment.l(${parentNodes});`\n358. \t\t\t\t);\n359. \t\t\t}\n360. \n361. \t\t\tblock.builders.mount.addLine(\n362. \t\t\t\t`${name}._mount(${parentNode || \'#target\'}, ${parentNode ? \'null\' : \'anchor\'});`\n363. \t\t\t);\n364. \n365. \t\t\tif (updates.length) {\n366. \t\t\t\tblock.builders.update.addBlock(deindent`\n367. \t\t\t\t\tvar ${name}_changes = {};\n368. \t\t\t\t\t${updates.join(\'\\n\')}\n369. \t\t\t\t\t${name}._set(${name}_changes);\n370. \t\t\t\t\t${bindings.length && `${name_updating} = {};`}\n371. \t\t\t\t`);\n372. \t\t\t}\n373. \n374. \t\t\tif (!parentNode) block.builders.unmount.addLine(`${name}._unmount();`);\n375. \n376. \t\t\tblock.builders.destroy.addLine(deindent`\n377. \t\t\t\t${name}.destroy(false);\n378. \t\t\t\t${ref && `if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;`}\n379. \t\t\t`);\n380. \t\t}\n381. \n382. \t\t// maintain component context\n383. \t\tif (allContexts.size) {\n384. \t\t\tconst contexts = Array.from(allContexts);\n385. \n386. \t\t\tconst initialProps = contexts\n387. \t\t\t\t.map(contextName => {\n388. \t\t\t\t\tif (contextName === \'state\') return `state: state`;\n389. \n390. \t\t\t\t\tconst listName = block.listNames.get(contextName);\n391. \t\t\t\t\tconst indexName = block.indexNames.get(contextName);\n392. \n393. \t\t\t\t\treturn `${listName}: ${listName},\\n${indexName}: ${indexName}`;\n394. \t\t\t\t})\n395. \t\t\t\t.join(\',\\n\');\n396. \n397. \t\t\tconst updates = contexts\n398. \t\t\t\t.map(contextName => {\n399. \t\t\t\t\tif (contextName === \'state\') return `${name_context}.state = state;`;\n400. \n401. \t\t\t\t\tconst listName = block.listNames.get(contextName);\n402. \t\t\t\t\tconst indexName = block.indexNames.get(contextName);\n403. \n404. \t\t\t\t\treturn `${name_context}.${listName} = ${listName};\\n${name_context}.${indexName} = ${indexName};`;\n405. \t\t\t\t})\n406. \t\t\t\t.join(\'\\n\');\n407. \n408. \t\t\tblock.builders.init.addBlock(deindent`\n409. \t\t\t\tvar ${name_context} = {\n410. \t\t\t\t\t${initialProps}\n411. \t\t\t\t};\n412. \t\t\t`);\n413. \n414. \t\t\tblock.builders.update.addBlock(updates);\n415. \t\t}\n416. \t}\n417. }\n418. \n419. function mungeAttribute(attribute: Node, block: Block): Attribute {\n420. \tif (attribute.value === true) {\n421. \t\t// attributes without values, e.g. <textarea readonly>\n422. \t\treturn {\n423. \t\t\tname: attribute.name,\n424. \t\t\tvalue: true,\n425. \t\t\tdynamic: false\n426. \t\t};\n427. \t}\n428. \n429. \tif (attribute.value.length === 0) {\n430. \t\treturn {\n431. \t\t\tname: attribute.name,\n432. \t\t\tvalue: `\'\'`,\n433. \t\t\tdynamic: false\n434. \t\t};\n435. \t}\n436. \n437. \tif (attribute.value.length === 1) {\n438. \t\tconst value = attribute.value[0];\n439. \n440. \t\tif (value.type === \'Text\') {\n441. \t\t\t// static attributes\n442. \t\t\treturn {\n443. \t\t\t\tname: attribute.name,\n444. \t\t\t\tvalue: isNaN(value.data) ? stringify(value.data) : value.data,\n445. \t\t\t\tdynamic: false\n446. \t\t\t};\n447. \t\t}\n448. \n449. \t\t// simple dynamic attributes\n450. \t\tblock.contextualise(value.expression); // TODO remove\n451. \t\tconst { dependencies, snippet } = value.metadata;\n452. \n453. \t\t// TODO only update attributes that have changed\n454. \t\treturn {\n455. \t\t\tname: attribute.name,\n456. \t\t\tvalue: snippet,\n457. \t\t\tdependencies,\n458. \t\t\tdynamic: true\n459. \t\t};\n460. \t}\n461. \n462. \t// otherwise we\'re dealing with a complex dynamic attribute\n463. \tconst allDependencies = new Set();\n464. \n465. \tconst value =\n466. \t\t(attribute.value[0].type === \'Text\' ? \'\' : `"" + `) +\n467. \t\tattribute.value\n468. \t\t\t.map((chunk: Node) => {\n469. \t\t\t\tif (chunk.type === \'Text\') {\n470. \t\t\t\t\treturn stringify(chunk.data);\n471. \t\t\t\t} else {\n472. \t\t\t\t\tblock.contextualise(chunk.expression); // TODO remove\n473. \t\t\t\t\tconst { dependencies, snippet } = chunk.metadata;\n474. \n475. \t\t\t\t\tdependencies.forEach((dependency: string) => {\n476. \t\t\t\t\t\tallDependencies.add(dependency);\n477. \t\t\t\t\t});\n478. \n479. \t\t\t\t\treturn getExpressionPrecedence(chunk.expression) <= 13 ? `(${snippet})` : snippet;\n480. \t\t\t\t}\n481. \t\t\t})\n482. \t\t\t.join(\' + \');\n483. \n484. \treturn {\n485. \t\tname: attribute.name,\n486. \t\tvalue,\n487. \t\tdependencies: Array.from(allDependencies),\n488. \t\tdynamic: true\n489. \t};\n490. }\n491. \n492. function mungeBinding(binding: Node, block: Block): Binding {\n493. \tconst { name } = getObject(binding.value);\n494. \tconst { contexts } = block.contextualise(binding.value);\n495. \tconst { dependencies, snippet } = binding.metadata;\n496. \n497. \tconst contextual = block.contexts.has(name);\n498. \n499. \tlet obj;\n500. \tlet prop;\n501. \n502. \tif (contextual) {\n503. \t\tobj = block.listNames.get(name);\n504. \t\tprop = block.indexNames.get(name);\n505. \t} else if (binding.value.type === \'MemberExpression\') {\n506. \t\tprop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;\n507. \t\tif (!binding.value.computed) prop = `\'${prop}\'`;\n508. \t\tobj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;\n509. \t} else {\n510. \t\tobj = \'state\';\n511. \t\tprop = `\'${name}\'`;\n512. \t}\n513. \n514. \treturn {\n515. \t\tname: binding.name,\n516. \t\tvalue: binding.value,\n517. \t\tcontexts,\n518. \t\tsnippet,\n519. \t\tobj,\n520. \t\tprop,\n521. \t\tdependencies\n522. \t};\n523. }\n524. \n525. function mungeEventHandler(generator: DomGenerator, node: Node, handler: Node, block: Block, name_context: string, allContexts: Set<string>) {\n526. \tlet body;\n527. \n528. \tif (handler.expression) {\n529. \t\tgenerator.addSourcemapLocations(handler.expression);\n530. \t\tgenerator.code.prependRight(\n531. \t\t\thandler.expression.start,\n532. \t\t\t`${block.alias(\'component\')}.`\n533. \t\t);\n534. \n535. \t\tconst usedContexts: string[] = [];\n536. \n537. \t\thandler.expression.arguments.forEach((arg: Node) => {\n538. \t\t\tconst { contexts } = block.contextualise(arg, null, true);\n539. \n540. \t\t\tcontexts.forEach(context => {\n541. \t\t\t\tif (!~usedContexts.indexOf(context)) usedContexts.push(context);\n542. \t\t\t\tallContexts.add(context);\n543. \t\t\t});\n544. \t\t});\n545. \n546. \t\t// TODO hoist event handlers? can do `this.__component.method(...)`\n547. \t\tconst declarations = usedContexts.map(name => {\n548. \t\t\tif (name === \'state\') return `var state = ${name_context}.state;`;\n549. \n550. \t\t\tconst listName = block.listNames.get(name);\n551. \t\t\tconst indexName = block.indexNames.get(name);\n552. \n553. \t\t\treturn `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;\n554. \t\t});\n555. \n556. \t\tbody = deindent`\n557. \t\t\t${declarations}\n558. \n559. \t\t\t[✂${handler.expression.start}-${handler.expression.end}✂];\n560. \t\t`;\n561. \t} else {\n562. \t\tbody = deindent`\n563. \t\t\t${block.alias(\'component\')}.fire(\'${handler.name}\', event);\n564. \t\t`;\n565. \t}\n566. \n567. \treturn {\n568. \t\tname: handler.name,\n569. \t\tvar: block.getUniqueName(`${node.var}_${handler.name}`),\n570. \t\tbody\n571. \t};\n572. }\n573. \n574. function isComputed(node: Node) {\n575. \twhile (node.type === \'MemberExpression\') {\n576. \t\tif (node.computed) return true;\n577. \t\tnode = node.object;\n578. \t}\n579. \n580. \treturn false;\n581. }\n582. \n583. function remount(generator: DomGenerator, node: Node, name: string) {\n584. \t// TODO make this a method of the nodes\n585. \n586. \tif (node.type === \'Component\') {\n587. \t\treturn `${node.var}._mount(${name}._slotted.default, null);`;\n588. \t}\n589. \n590. \tif (node.type === \'Element\') {\n591. \t\tconst slot = node.attributes.find(attribute => attribute.name === \'slot\');\n592. \t\tif (slot) {\n593. \t\t\treturn `@appendNode(${node.var}, ${name}._slotted.${node.getStaticAttributeValue(\'slot\')});`;\n594. \t\t}\n595. \n596. \t\treturn `@appendNode(${node.var}, ${name}._slotted.default);`;\n597. \t}\n598. \n599. \tif (node.type === \'Text\' || node.type === \'MustacheTag\' || node.type === \'RawMustacheTag\') {\n600. \t\treturn `@appendNode(${node.var}, ${name}._slotted.default);`;\n601. \t}\n602. \n603. \tif (node.type === \'EachBlock\') {\n604. \t\t// TODO consider keyed blocks\n605. \t\treturn `for (var #i = 0; #i < ${node.iterations}.length; #i += 1) ${node.iterations}[#i].m(${name}._slotted.default, null);`;\n606. \t}\n607. \n608. \treturn `${node.var}.m(${name}._slotted.default, null);`;\n609. }', start_line_number=1, end_line_number=609), Context(relative_path='src/generators/server-side-rendering/Block.ts', content="1. import deindent from '../../utils/deindent';\n2. import flattenReference from '../../utils/flattenReference';\n3. import { SsrGenerator } from './index';\n4. import { Node } from '../../interfaces';\n5. import getObject from '../../utils/getObject';\n6. \n7. interface BlockOptions {\n8. \t// TODO\n9. }\n10. \n11. export default class Block {\n12. \tgenerator: SsrGenerator;\n13. \tconditions: string[];\n14. \n15. \tcontexts: Map<string, string>;\n16. \tindexes: Map<string, string>;\n17. \tcontextDependencies: Map<string, string[]>;\n18. \n19. \tconstructor(options: BlockOptions) {\n20. \t\tObject.assign(this, options);\n21. \t}\n22. \n23. \taddBinding(binding: Node, name: string) {\n24. \t\tconst conditions = [`!('${binding.name}' in state)`].concat(\n25. \t\t\t// TODO handle contextual bindings...\n26. \t\t\tthis.conditions.map(c => `(${c})`)\n27. \t\t);\n28. \n29. \t\tconst { name: prop } = getObject(binding.value);\n30. \n31. \t\tthis.generator.bindings.push(deindent`\n32. \t\t\tif (${conditions.join('&&')}) {\n33. \t\t\t\ttmp = ${name}.data();\n34. \t\t\t\tif ('${prop}' in tmp) {\n35. \t\t\t\t\tstate.${binding.name} = tmp.${prop};\n36. \t\t\t\t\tsettled = false;\n37. \t\t\t\t}\n38. \t\t\t}\n39. \t\t`);\n40. \t}\n41. \n42. \tchild(options: BlockOptions) {\n43. \t\treturn new Block(Object.assign({}, this, options, { parent: this }));\n44. \t}\n45. \n46. \tcontextualise(expression: Node, context?: string, isEventHandler?: boolean) {\n47. \t\treturn this.generator.contextualise(this.contexts, this.indexes, expression, context, isEventHandler);\n48. \t}\n49. }", start_line_number=1, end_line_number=49), Context(relative_path='src/generators/server-side-rendering/index.ts', content='1. import deindent from \'../../utils/deindent\';\n2. import Generator from \'../Generator\';\n3. import Stylesheet from \'../../css/Stylesheet\';\n4. import Block from \'./Block\';\n5. import visit from \'./visit\';\n6. import { removeNode, removeObjectKey } from \'../../utils/removeNode\';\n7. import getName from \'../../utils/getName\';\n8. import globalWhitelist from \'../../utils/globalWhitelist\';\n9. import { Parsed, Node, CompileOptions } from \'../../interfaces\';\n10. import { AppendTarget } from \'./interfaces\';\n11. import { stringify } from \'../../utils/stringify\';\n12. \n13. export class SsrGenerator extends Generator {\n14. \tbindings: string[];\n15. \trenderCode: string;\n16. \tappendTargets: AppendTarget[];\n17. \n18. \tconstructor(\n19. \t\tparsed: Parsed,\n20. \t\tsource: string,\n21. \t\tname: string,\n22. \t\tstylesheet: Stylesheet,\n23. \t\toptions: CompileOptions\n24. \t) {\n25. \t\tsuper(parsed, source, name, stylesheet, options, false);\n26. \t\tthis.bindings = [];\n27. \t\tthis.renderCode = \'\';\n28. \t\tthis.appendTargets = [];\n29. \n30. \t\tthis.stylesheet.warnOnUnusedSelectors(options.onwarn);\n31. \t}\n32. \n33. \tappend(code: string) {\n34. \t\tif (this.appendTargets.length) {\n35. \t\t\tconst appendTarget = this.appendTargets[this.appendTargets.length - 1];\n36. \t\t\tconst slotName = appendTarget.slotStack[appendTarget.slotStack.length - 1];\n37. \t\t\tappendTarget.slots[slotName] += code;\n38. \t\t} else {\n39. \t\t\tthis.renderCode += code;\n40. \t\t}\n41. \t}\n42. }\n43. \n44. export default function ssr(\n45. \tparsed: Parsed,\n46. \tsource: string,\n47. \tstylesheet: Stylesheet,\n48. \toptions: CompileOptions\n49. ) {\n50. \tconst format = options.format || \'cjs\';\n51. \n52. \tconst generator = new SsrGenerator(parsed, source, options.name || \'SvelteComponent\', stylesheet, options);\n53. \n54. \tconst { computations, name, templateProperties } = generator;\n55. \n56. \t// create main render() function\n57. \tconst mainBlock = new Block({\n58. \t\tgenerator,\n59. \t\tcontexts: new Map(),\n60. \t\tindexes: new Map(),\n61. \t\tconditions: [],\n62. \t});\n63. \n64. \ttrim(parsed.html.children).forEach((node: Node) => {\n65. \t\tvisit(generator, mainBlock, node);\n66. \t});\n67. \n68. \tconst { css, cssMap } = generator.customElement ?\n69. \t\t{ css: null, cssMap: null } :\n70. \t\tgenerator.stylesheet.render(options.filename, true);\n71. \n72. \t// generate initial state object\n73. \tconst expectedProperties = Array.from(generator.expectedProperties);\n74. \tconst globals = expectedProperties.filter(prop => globalWhitelist.has(prop));\n75. \tconst storeProps = options.store || templateProperties.store ? expectedProperties.filter(prop => prop[0] === \'$\') : [];\n76. \n77. \tconst initialState = [];\n78. \tif (globals.length > 0) {\n79. \t\tinitialState.push(`{ ${globals.map(prop => `${prop} : ${prop}`).join(\', \')} }`);\n80. \t}\n81. \n82. \tif (storeProps.length > 0) {\n83. \t\tconst initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`\n84. \t\tif (options.store || templateProperties.store) {\n85. \t\t\tinitialState.push(`options.store.${initialize}`);\n86. \t\t}\n87. \t}\n88. \n89. \tif (templateProperties.data) {\n90. \t\tinitialState.push(`%data()`);\n91. \t} else if (globals.length === 0 && storeProps.length === 0) {\n92. \t\tinitialState.push(\'{}\');\n93. \t}\n94. \n95. \tinitialState.push(\'state\');\n96. \n97. \t// TODO concatenate CSS maps\n98. \tconst result = deindent`\n99. \t\t${generator.javascript}\n100. \n101. \t\tvar ${name} = {};\n102. \n103. \t\t${options.filename && `${name}.filename = ${stringify(options.filename)}`};\n104. \n105. \t\t${name}.data = function() {\n106. \t\t\treturn ${templateProperties.data ? `%data()` : `{}`};\n107. \t\t};\n108. \n109. \t\t${name}.render = function(state, options = {}) {\n110. \t\t\tvar components = new Set();\n111. \n112. \t\t\tfunction addComponent(component) {\n113. \t\t\t\tcomponents.add(component);\n114. \t\t\t}\n115. \n116. \t\t\tvar result = { head: \'\', addComponent };\n117. \t\t\t${templateProperties.store && `options.store = %store();`}\n118. \t\t\tvar html = ${name}._render(result, state, options);\n119. \n120. \t\t\tvar cssCode = Array.from(components).map(c => c.css && c.css.code).filter(Boolean).join(\'\\\\n\');\n121. \n122. \t\t\treturn {\n123. \t\t\t\thtml,\n124. \t\t\t\thead: result.head,\n125. \t\t\t\tcss: { code: cssCode, map: null },\n126. \t\t\t\ttoString() {\n127. \t\t\t\t\treturn html;\n128. \t\t\t\t}\n129. \t\t\t};\n130. \t\t}\n131. \n132. \t\t${name}._render = function(__result, state, options) {\n133. \t\t\t__result.addComponent(${name});\n134. \n135. \t\t\tstate = Object.assign(${initialState.join(\', \')});\n136. \n137. \t\t\t${computations.map(\n138. \t\t\t\t({ key, deps }) =>\n139. \t\t\t\t\t`state.${key} = %computed-${key}(${deps.map(dep => `state.${dep}`).join(\', \')});`\n140. \t\t\t)}\n141. \n142. \t\t\t${generator.bindings.length &&\n143. \t\t\t\tdeindent`\n144. \t\t\t\tvar settled = false;\n145. \t\t\t\tvar tmp;\n146. \n147. \t\t\t\twhile (!settled) {\n148. \t\t\t\t\tsettled = true;\n149. \n150. \t\t\t\t\t${generator.bindings.join(\'\\n\\n\')}\n151. \t\t\t\t}\n152. \t\t\t`}\n153. \n154. \t\t\treturn \\`${generator.renderCode}\\`;\n155. \t\t};\n156. \n157. \t\t${name}.css = {\n158. \t\t\tcode: ${css ? stringify(css) : `\'\'`},\n159. \t\t\tmap: ${cssMap ? stringify(cssMap.toString()) : \'null\'}\n160. \t\t};\n161. \n162. \t\tvar warned = false;\n163. \t\t${name}.renderCss = function() {\n164. \t\t\tif (!warned) {\n165. \t\t\t\tconsole.error(\'Component.renderCss(...) is deprecated and will be removed in v2 — use Component.render(...).css instead\');\n166. \t\t\t\twarned = true;\n167. \t\t\t}\n168. \n169. \t\t\tvar components = [];\n170. \n171. \t\t\t${generator.stylesheet.hasStyles &&\n172. \t\t\t\tdeindent`\n173. \t\t\t\tcomponents.push({\n174. \t\t\t\t\tfilename: ${name}.filename,\n175. \t\t\t\t\tcss: ${name}.css && ${name}.css.code,\n176. \t\t\t\t\tmap: ${name}.css && ${name}.css.map\n177. \t\t\t\t});\n178. \t\t\t`}\n179. \n180. \t\t\t${templateProperties.components &&\n181. \t\t\t\tdeindent`\n182. \t\t\t\tvar seen = {};\n183. \n184. \t\t\t\tfunction addComponent(component) {\n185. \t\t\t\t\tvar result = component.renderCss();\n186. \t\t\t\t\tresult.components.forEach(x => {\n187. \t\t\t\t\t\tif (seen[x.filename]) return;\n188. \t\t\t\t\t\tseen[x.filename] = true;\n189. \t\t\t\t\t\tcomponents.push(x);\n190. \t\t\t\t\t});\n191. \t\t\t\t}\n192. \n193. \t\t\t\t${templateProperties.components.value.properties.map((prop: Node) => {\n194. \t\t\t\t\treturn `addComponent(%components-${getName(prop.key)});`;\n195. \t\t\t\t})}\n196. \t\t\t`}\n197. \n198. \t\t\treturn {\n199. \t\t\t\tcss: components.map(x => x.css).join(\'\\\\n\'),\n200. \t\t\t\tmap: null,\n201. \t\t\t\tcomponents\n202. \t\t\t};\n203. \t\t};\n204. \n205. \t\t${templateProperties.preload && `${name}.preload = %preload;`}\n206. \n207. \t\t${\n208. \t\t\t// TODO this is a bit hacky\n209. \t\t\t/__escape/.test(generator.renderCode) && deindent`\n210. \t\t\t\tvar escaped = {\n211. \t\t\t\t\t\'"\': \'&quot;\',\n212. \t\t\t\t\t"\'": \'&##39;\',\n213. \t\t\t\t\t\'&\': \'&amp;\',\n214. \t\t\t\t\t\'<\': \'&lt;\',\n215. \t\t\t\t\t\'>\': \'&gt;\'\n216. \t\t\t\t};\n217. \n218. \t\t\t\tfunction __escape(html) {\n219. \t\t\t\t\treturn String(html).replace(/["\'&<>]/g, match => escaped[match]);\n220. \t\t\t\t}\n221. \t\t\t`\n222. \t\t}\n223. \n224. \t\t${\n225. \t\t\t/__isPromise/.test(generator.renderCode) && deindent`\n226. \t\t\t\tfunction __isPromise(value) {\n227. \t\t\t\t\treturn value && typeof value.then === \'function\';\n228. \t\t\t\t}\n229. \t\t\t`\n230. \t\t}\n231. \n232. \t\t${\n233. \t\t\t/__missingComponent/.test(generator.renderCode) && deindent`\n234. \t\t\t\tvar __missingComponent = {\n235. \t\t\t\t\t_render: () => \'\'\n236. \t\t\t\t};\n237. \t\t\t`\n238. \t\t}\n239. \t`.replace(/(@+|#+|%+)(\\w*(?:-\\w*)?)/g, (match: string, sigil: string, name: string) => {\n240. \t\tif (sigil === \'@\') return generator.alias(name);\n241. \t\tif (sigil === \'%\') return generator.templateVars.get(name);\n242. \t\treturn sigil.slice(1) + name;\n243. \t});\n244. \n245. \treturn generator.generate(result, options, { name, format });\n246. }\n247. \n248. function trim(nodes) {\n249. \tlet start = 0;\n250. \tfor (; start < nodes.length; start += 1) {\n251. \t\tconst node = nodes[start];\n252. \t\tif (node.type !== \'Text\') break;\n253. \n254. \t\tnode.data = node.data.replace(/^\\s+/, \'\');\n255. \t\tif (node.data) break;\n256. \t}\n257. \n258. \tlet end = nodes.length;\n259. \tfor (; end > start; end -= 1) {\n260. \t\tconst node = nodes[end - 1];\n261. \t\tif (node.type !== \'Text\') break;\n262. \n263. \t\tnode.data = node.data.replace(/\\s+$/, \'\');\n264. \t\tif (node.data) break;\n265. \t}\n266. \n267. \treturn nodes.slice(start, end);\n268. }', start_line_number=1, end_line_number=268), Context(relative_path='src/generators/server-side-rendering/visit.ts', content="1. import visitors from './visitors/index';\n2. import { SsrGenerator } from './index';\n3. import Block from './Block';\n4. import { Node } from '../../interfaces';\n5. \n6. export default function visit(\n7. \tgenerator: SsrGenerator,\n8. \tblock: Block,\n9. \tnode: Node\n10. ) {\n11. \tconst visitor = visitors[node.type];\n12. \tvisitor(generator, block, node);\n13. }", start_line_number=1, end_line_number=13), Context(relative_path='src/generators/server-side-rendering/visitors/Component.ts', content="1. import flattenReference from '../../../utils/flattenReference';\n2. import visit from '../visit';\n3. import { SsrGenerator } from '../index';\n4. import Block from '../Block';\n5. import { AppendTarget } from '../interfaces';\n6. import { Node } from '../../../interfaces';\n7. import getObject from '../../../utils/getObject';\n8. import getTailSnippet from '../../../utils/getTailSnippet';\n9. import { stringify } from '../../../utils/stringify';\n10. \n11. export default function visitComponent(\n12. \tgenerator: SsrGenerator,\n13. \tblock: Block,\n14. \tnode: Node\n15. ) {\n16. \tfunction stringifyAttribute(chunk: Node) {\n17. \t\tif (chunk.type === 'Text') return chunk.data;\n18. \t\tif (chunk.type === 'MustacheTag') {\n19. \t\t\tblock.contextualise(chunk.expression);\n20. \t\t\tconst { snippet } = chunk.metadata;\n21. \t\t\treturn '${__escape( ' + snippet + ')}';\n22. \t\t}\n23. \t}\n24. \n25. \tconst attributes: Node[] = [];\n26. \tconst bindings: Node[] = [];\n27. \n28. \tnode.attributes.forEach((attribute: Node) => {\n29. \t\tif (attribute.type === 'Attribute') {\n30. \t\t\tattributes.push(attribute);\n31. \t\t} else if (attribute.type === 'Binding') {\n32. \t\t\tbindings.push(attribute);\n33. \t\t}\n34. \t});\n35. \n36. \tconst props = attributes\n37. \t\t.map(attribute => {\n38. \t\t\tlet value;\n39. \n40. \t\t\tif (attribute.value === true) {\n41. \t\t\t\tvalue = `true`;\n42. \t\t\t} else if (attribute.value.length === 0) {\n43. \t\t\t\tvalue = `''`;\n44. \t\t\t} else if (attribute.value.length === 1) {\n45. \t\t\t\tconst chunk = attribute.value[0];\n46. \t\t\t\tif (chunk.type === 'Text') {\n47. \t\t\t\t\tvalue = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;\n48. \t\t\t\t} else {\n49. \t\t\t\t\tblock.contextualise(chunk.expression);\n50. \t\t\t\t\tconst { snippet } = chunk.metadata;\n51. \t\t\t\t\tvalue = snippet;\n52. \t\t\t\t}\n53. \t\t\t} else {\n54. \t\t\t\tvalue = '`' + attribute.value.map(stringifyAttribute).join('') + '`';\n55. \t\t\t}\n56. \n57. \t\t\treturn `${attribute.name}: ${value}`;\n58. \t\t})\n59. \t\t.concat(\n60. \t\t\tbindings.map(binding => {\n61. \t\t\t\tconst { name } = getObject(binding.value);\n62. \t\t\t\tconst tail = binding.value.type === 'MemberExpression'\n63. \t\t\t\t\t? getTailSnippet(binding.value)\n64. \t\t\t\t\t: '';\n65. \n66. \t\t\t\tconst keypath = block.contexts.has(name)\n67. \t\t\t\t\t? `${name}${tail}`\n68. \t\t\t\t\t: `state.${name}${tail}`;\n69. \t\t\t\treturn `${binding.name}: ${keypath}`;\n70. \t\t\t})\n71. \t\t)\n72. \t\t.join(', ');\n73. \n74. \tconst isDynamicComponent = node.name === ':Component';\n75. \tif (isDynamicComponent) block.contextualise(node.expression);\n76. \n77. \tconst expression = (\n78. \t\tnode.name === ':Self' ? generator.name :\n79. \t\tisDynamicComponent ? `((${node.metadata.snippet}) || __missingComponent)` :\n80. \t\t`%components-${node.name}`\n81. \t);\n82. \n83. \tbindings.forEach(binding => {\n84. \t\tblock.addBinding(binding, expression);\n85. \t});\n86. \n87. \tlet open = `\\${${expression}._render(__result, {${props}}`;\n88. \n89. \tconst options = [];\n90. \tif (generator.options.store) {\n91. \t\toptions.push(`store: options.store`);\n92. \t}\n93. \n94. \tif (node.children.length) {\n95. \t\tconst appendTarget: AppendTarget = {\n96. \t\t\tslots: { default: '' },\n97. \t\t\tslotStack: ['default']\n98. \t\t};\n99. \n100. \t\tgenerator.appendTargets.push(appendTarget);\n101. \n102. \t\tnode.children.forEach((child: Node) => {\n103. \t\t\tvisit(generator, block, child);\n104. \t\t});\n105. \n106. \t\tconst slotted = Object.keys(appendTarget.slots)\n107. \t\t\t.map(name => `${name}: () => \\`${appendTarget.slots[name]}\\``)\n108. \t\t\t.join(', ');\n109. \n110. \t\toptions.push(`slotted: { ${slotted} }`);\n111. \n112. \t\tgenerator.appendTargets.pop();\n113. \t}\n114. \n115. \tif (options.length) {\n116. \t\topen += `, { ${options.join(', ')} }`;\n117. \t}\n118. \n119. \tgenerator.append(open);\n120. \tgenerator.append(')}');\n121. }", start_line_number=1, end_line_number=121), Context(relative_path='src/generators/wrapModule.ts', content='1. import deindent from \'../utils/deindent\';\n2. import list from \'../utils/list\';\n3. import { CompileOptions, ModuleFormat, Node } from \'../interfaces\';\n4. \n5. interface Dependency {\n6. \tname: string;\n7. \tstatements: string[];\n8. \tsource: string;\n9. }\n10. \n11. const wrappers = { es, amd, cjs, iife, umd, eval: expr };\n12. \n13. export default function wrapModule(\n14. \tcode: string,\n15. \tformat: ModuleFormat,\n16. \tname: string,\n17. \toptions: CompileOptions,\n18. \tbanner: string,\n19. \tsharedPath: string,\n20. \thelpers: { name: string, alias: string }[],\n21. \timports: Node[],\n22. \tsource: string\n23. ): string {\n24. \tif (format === \'es\') return es(code, name, options, banner, sharedPath, helpers, imports, source);\n25. \n26. \tconst dependencies = imports.map((declaration, i) => {\n27. \t\tconst defaultImport = declaration.specifiers.find(\n28. \t\t\t(x: Node) =>\n29. \t\t\t\tx.type === \'ImportDefaultSpecifier\' ||\n30. \t\t\t\t(x.type === \'ImportSpecifier\' && x.imported.name === \'default\')\n31. \t\t);\n32. \n33. \t\tconst namespaceImport = declaration.specifiers.find(\n34. \t\t\t(x: Node) => x.type === \'ImportNamespaceSpecifier\'\n35. \t\t);\n36. \n37. \t\tconst namedImports = declaration.specifiers.filter(\n38. \t\t\t(x: Node) =>\n39. \t\t\t\tx.type === \'ImportSpecifier\' && x.imported.name !== \'default\'\n40. \t\t);\n41. \n42. \t\tconst name = defaultImport || namespaceImport\n43. \t\t\t? (defaultImport || namespaceImport).local.name\n44. \t\t\t: `__import${i}`;\n45. \n46. \t\tconst statements: string[] = [];\n47. \n48. \t\tnamedImports.forEach((specifier: Node) => {\n49. \t\t\tstatements.push(\n50. \t\t\t\t`var ${specifier.local.name} = ${name}.${specifier.imported.name};`\n51. \t\t\t);\n52. \t\t});\n53. \n54. \t\tif (defaultImport) {\n55. \t\t\tstatements.push(\n56. \t\t\t\t`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`\n57. \t\t\t);\n58. \t\t}\n59. \n60. \t\treturn { name, statements, source: declaration.source.value };\n61. \t});\n62. \n63. \tif (format === \'amd\') return amd(code, name, options, banner, dependencies);\n64. \tif (format === \'cjs\') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);\n65. \tif (format === \'iife\') return iife(code, name, options, banner, dependencies);\n66. \tif (format === \'umd\') return umd(code, name, options, banner, dependencies);\n67. \tif (format === \'eval\') return expr(code, name, options, banner, dependencies);\n68. \n69. \tthrow new Error(`options.format is invalid (must be ${list(Object.keys(wrappers))})`);\n70. }\n71. \n72. function es(\n73. \tcode: string,\n74. \tname: string,\n75. \toptions: CompileOptions,\n76. \tbanner: string,\n77. \tsharedPath: string,\n78. \thelpers: { name: string, alias: string }[],\n79. \timports: Node[],\n80. \tsource: string\n81. ) {\n82. \tconst importHelpers = helpers && (\n83. \t\t`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(\', \')} } from ${JSON.stringify(sharedPath)};`\n84. \t);\n85. \n86. \tconst importBlock = imports.length > 0 && (\n87. \t\timports\n88. \t\t\t.map((declaration: Node) => source.slice(declaration.start, declaration.end))\n89. \t\t\t.join(\'\\n\')\n90. \t);\n91. \n92. \treturn deindent`\n93. \t\t${banner}\n94. \t\t${importHelpers}\n95. \t\t${importBlock}\n96. \n97. \t\t${code}\n98. \t\texport default ${name};`;\n99. }\n100. \n101. function amd(\n102. \tcode: string,\n103. \tname: string,\n104. \toptions: CompileOptions,\n105. \tbanner: string,\n106. \tdependencies: Dependency[]\n107. ) {\n108. \tconst sourceString = dependencies.length\n109. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n110. \t\t: \'\';\n111. \n112. \tconst id = options.amd && options.amd.id;\n113. \n114. \treturn deindent`\n115. \t\tdefine(${id ? `"${id}", ` : \'\'}${sourceString}function(${paramString(dependencies)}) { "use strict";\n116. \t\t\t${getCompatibilityStatements(dependencies)}\n117. \n118. \t\t\t${code}\n119. \t\t\treturn ${name};\n120. \t\t});`;\n121. }\n122. \n123. function cjs(\n124. \tcode: string,\n125. \tname: string,\n126. \toptions: CompileOptions,\n127. \tbanner: string,\n128. \tsharedPath: string,\n129. \thelpers: { name: string, alias: string }[],\n130. \tdependencies: Dependency[]\n131. ) {\n132. \tconst SHARED = \'__shared\';\n133. \tconst helperBlock = helpers && (\n134. \t\t`var ${SHARED} = require(${JSON.stringify(sharedPath)});\\n` +\n135. \t\thelpers.map(helper => {\n136. \t\t\treturn `var ${helper.alias} = ${SHARED}.${helper.name};`;\n137. \t\t}).join(\'\\n\')\n138. \t);\n139. \n140. \tconst requireBlock = dependencies.length > 0 && (\n141. \t\tdependencies\n142. \t\t\t.map(d => `var ${d.name} = require("${d.source}");`)\n143. \t\t\t.join(\'\\n\\n\')\n144. \t);\n145. \n146. \treturn deindent`\n147. \t\t${banner}\n148. \t\t"use strict";\n149. \n150. \t\t${helperBlock}\n151. \t\t${requireBlock}\n152. \t\t${getCompatibilityStatements(dependencies)}\n153. \n154. \t\t${code}\n155. \n156. \t\tmodule.exports = ${name};`\n157. }\n158. \n159. function iife(\n160. \tcode: string,\n161. \tname: string,\n162. \toptions: CompileOptions,\n163. \tbanner: string,\n164. \tdependencies: Dependency[]\n165. ) {\n166. \tif (!options.name) {\n167. \t\tthrow new Error(`Missing required \'name\' option for IIFE export`);\n168. \t}\n169. \n170. \tconst globals = getGlobals(dependencies, options);\n171. \n172. \treturn deindent`\n173. \t\t${banner}\n174. \t\tvar ${options.name} = (function(${paramString(dependencies)}) { "use strict";\n175. \t\t\t${getCompatibilityStatements(dependencies)}\n176. \n177. \t\t\t${code}\n178. \t\t\treturn ${name};\n179. \t\t}(${globals.join(\', \')}));`;\n180. }\n181. \n182. function umd(\n183. \tcode: string,\n184. \tname: string,\n185. \toptions: CompileOptions,\n186. \tbanner: string,\n187. \tdependencies: Dependency[]\n188. ) {\n189. \tif (!options.name) {\n190. \t\tthrow new Error(`Missing required \'name\' option for UMD export`);\n191. \t}\n192. \n193. \tconst amdId = options.amd && options.amd.id ? `\'${options.amd.id}\', ` : \'\';\n194. \n195. \tconst amdDeps = dependencies.length\n196. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n197. \t\t: \'\';\n198. \n199. \tconst cjsDeps = dependencies\n200. \t\t.map(d => `require("${d.source}")`)\n201. \t\t.join(\', \');\n202. \n203. \tconst globals = getGlobals(dependencies, options);\n204. \n205. \treturn deindent`\n206. \t\t${banner}\n207. \t\t(function(global, factory) {\n208. \t\t\ttypeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :\n209. \t\t\ttypeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :\n210. \t\t\t(global.${options.name} = factory(${globals.join(\', \')}));\n211. \t\t}(this, (function (${paramString(dependencies)}) { "use strict";\n212. \n213. \t\t\t${getCompatibilityStatements(dependencies)}\n214. \n215. \t\t\t${code}\n216. \n217. \t\t\treturn ${name};\n218. \n219. \t\t})));`;\n220. }\n221. \n222. function expr(\n223. \tcode: string,\n224. \tname: string,\n225. \toptions: CompileOptions,\n226. \tbanner: string,\n227. \tdependencies: Dependency[]\n228. ) {\n229. \tconst globals = getGlobals(dependencies, options);\n230. \n231. \treturn deindent`\n232. \t\t(function (${paramString(dependencies)}) { "use strict";\n233. \t\t\t${banner}\n234. \n235. \t\t\t${getCompatibilityStatements(dependencies)}\n236. \n237. \t\t\t${code}\n238. \n239. \t\t\treturn ${name};\n240. \t\t}(${globals.join(\', \')}))`;\n241. }\n242. \n243. function paramString(dependencies: Dependency[]) {\n244. \treturn dependencies.map(dep => dep.name).join(\', \');\n245. }\n246. \n247. function removeExtension(file: string) {\n248. \tconst index = file.lastIndexOf(\'.\');\n249. \treturn ~index ? file.slice(0, index) : file;\n250. }\n251. \n252. function getCompatibilityStatements(dependencies: Dependency[]) {\n253. \tif (!dependencies.length) return null;\n254. \n255. \tconst statements: string[] = [];\n256. \n257. \tdependencies.forEach(dependency => {\n258. \t\tstatements.push(...dependency.statements);\n259. \t});\n260. \n261. \treturn statements.join(\'\\n\');\n262. }\n263. \n264. function getGlobals(dependencies: Dependency[], options: CompileOptions) {\n265. \tconst { globals, onerror, onwarn } = options;\n266. \tconst globalFn = getGlobalFn(globals);\n267. \n268. \treturn dependencies.map(d => {\n269. \t\tlet name = globalFn(d.source);\n270. \n271. \t\tif (!name) {\n272. \t\t\tif (d.name.startsWith(\'__import\')) {\n273. \t\t\t\tconst error = new Error(\n274. \t\t\t\t\t`Could not determine name for imported module \'${d.source}\' – use options.globals`\n275. \t\t\t\t);\n276. \t\t\t\tonerror(error);\n277. \t\t\t} else {\n278. \t\t\t\tconst warning = {\n279. \t\t\t\t\tmessage: `No name was supplied for imported module \'${d.source}\'. Guessing \'${d.name}\', but you should use options.globals`,\n280. \t\t\t\t};\n281. \n282. \t\t\t\tonwarn(warning);\n283. \t\t\t}\n284. \n285. \t\t\tname = d.name;\n286. \t\t}\n287. \n288. \t\treturn name;\n289. \t});\n290. }\n291. \n292. function getGlobalFn(globals: any): (id: string) => string {\n293. \tif (typeof globals === \'function\') return globals;\n294. \tif (typeof globals === \'object\') {\n295. \t\treturn id => globals[id];\n296. \t}\n297. \n298. \treturn () => undefined;\n299. }', start_line_number=1, end_line_number=299), Context(relative_path='src/interfaces.ts', content="1. import {SourceMap} from 'magic-string';\n2. \n3. export interface Node {\n4. \tstart: number;\n5. \tend: number;\n6. \ttype: string;\n7. \t[propName: string]: any;\n8. }\n9. \n10. export interface Parser {\n11. \treadonly template: string;\n12. \treadonly filename?: string;\n13. \n14. \tindex: number;\n15. \tstack: Array<Node>;\n16. \n17. \thtml: Node;\n18. \tcss: Node;\n19. \tjs: Node;\n20. \tmetaTags: {};\n21. }\n22. \n23. export interface Parsed {\n24. \thash: number;\n25. \thtml: Node;\n26. \tcss: Node;\n27. \tjs: Node;\n28. }\n29. \n30. export interface Warning {\n31. \tloc?: { line: number; column: number; pos?: number };\n32. \tpos?: number;\n33. \tmessage: string;\n34. \tfilename?: string;\n35. \tframe?: string;\n36. \ttoString: () => string;\n37. }\n38. \n39. export type ModuleFormat = 'es' | 'amd' | 'cjs' | 'iife' | 'umd' | 'eval';\n40. \n41. export interface CompileOptions {\n42. \tformat?: ModuleFormat;\n43. \tname?: string;\n44. \tfilename?: string;\n45. \tgenerate?: string;\n46. \tglobals?: ((id: string) => string) | object;\n47. \tamd?: {\n48. \t\tid?: string;\n49. \t};\n50. \n51. \toutputFilename?: string;\n52. \tcssOutputFilename?: string;\n53. \n54. \tdev?: boolean;\n55. \tshared?: boolean | string;\n56. \tcascade?: boolean;\n57. \thydratable?: boolean;\n58. \tlegacy?: boolean;\n59. \tcustomElement?: CustomElementOptions | true;\n60. \tcss?: boolean;\n61. \tstore?: boolean;\n62. \n63. \tonerror?: (error: Error) => void;\n64. \tonwarn?: (warning: Warning) => void;\n65. }\n66. \n67. export interface GenerateOptions {\n68. \tname: string;\n69. \tformat: ModuleFormat;\n70. \tbanner?: string;\n71. \tsharedPath?: string;\n72. \thelpers?: { name: string, alias: string }[];\n73. }\n74. \n75. export interface Visitor {\n76. \tenter: (node: Node) => void;\n77. \tleave?: (node: Node) => void;\n78. }\n79. \n80. export interface CustomElementOptions {\n81. \ttag?: string;\n82. \tprops?: string[];\n83. }\n84. \n85. export interface PreprocessOptions {\n86. \tmarkup?: (options: {content: string, filename: string}) => { code: string, map?: SourceMap | string };\n87. \tstyle?: Preprocessor;\n88. \tscript?: Preprocessor;\n89. \tfilename?: string\n90. }\n91. \n92. export type Preprocessor = (options: {content: string, attributes: Record<string, string | boolean>, filename?: string}) => { code: string, map?: SourceMap | string };", start_line_number=1, end_line_number=92), Context(relative_path='src/server-side-rendering/register.js', content="1. import * as fs from 'fs';\n2. import * as path from 'path';\n3. import { compile } from '../index.ts';\n4. \n5. const compileOptions = {};\n6. \n7. function capitalise(name) {\n8. \treturn name[0].toUpperCase() + name.slice(1);\n9. }\n10. \n11. export default function register(options) {\n12. \tconst { extensions } = options;\n13. \n14. \tif (extensions) {\n15. \t\t_deregister('.html');\n16. \t\textensions.forEach(_register);\n17. \t}\n18. \n19. \t// TODO make this the default and remove in v2\n20. \tif ('store' in options) compileOptions.store = options.store;\n21. }\n22. \n23. function _deregister(extension) {\n24. \tdelete require.extensions[extension];\n25. }\n26. \n27. function _register(extension) {\n28. \trequire.extensions[extension] = function(module, filename) {\n29. \t\tconst name = path.basename(filename)\n30. \t\t\t.slice(0, -path.extname(filename).length)\n31. \t\t\t.replace(/^\\d/, '_$&')\n32. \t\t\t.replace(/[^a-zA-Z0-9_$]/g, '');\n33. \n34. \t\tconst options = Object.assign({}, compileOptions, {\n35. \t\t\tfilename,\n36. \t\t\tname: capitalise(name),\n37. \t\t\tgenerate: 'ssr'\n38. \t\t});\n39. \n40. \t\tconst {code} = compile(fs.readFileSync(filename, 'utf-8'), options);\n41. \n42. \t\treturn module._compile(code, filename);\n43. \t};\n44. }\n45. \n46. _register('.html');", start_line_number=1, end_line_number=46), Context(relative_path='store.js', content='1. import {\n2. \tassign,\n3. \tblankObject,\n4. \tdiffers,\n5. \tdispatchObservers,\n6. \tget,\n7. \tobserve\n8. } from \'./shared.js\';\n9. \n10. function Store(state) {\n11. \tthis._observers = { pre: blankObject(), post: blankObject() };\n12. \tthis._changeHandlers = [];\n13. \tthis._dependents = [];\n14. \n15. \tthis._computed = blankObject();\n16. \tthis._sortedComputedProperties = [];\n17. \n18. \tthis._state = assign({}, state);\n19. }\n20. \n21. assign(Store.prototype, {\n22. \t_add: function(component, props) {\n23. \t\tthis._dependents.push({\n24. \t\t\tcomponent: component,\n25. \t\t\tprops: props\n26. \t\t});\n27. \t},\n28. \n29. \t_init: function(props) {\n30. \t\tvar state = {};\n31. \t\tfor (var i = 0; i < props.length; i += 1) {\n32. \t\t\tvar prop = props[i];\n33. \t\t\tstate[\'$\' + prop] = this._state[prop];\n34. \t\t}\n35. \t\treturn state;\n36. \t},\n37. \n38. \t_remove: function(component) {\n39. \t\tvar i = this._dependents.length;\n40. \t\twhile (i--) {\n41. \t\t\tif (this._dependents[i].component === component) {\n42. \t\t\t\tthis._dependents.splice(i, 1);\n43. \t\t\t\treturn;\n44. \t\t\t}\n45. \t\t}\n46. \t},\n47. \n48. \t_sortComputedProperties: function() {\n49. \t\tvar computed = this._computed;\n50. \t\tvar sorted = this._sortedComputedProperties = [];\n51. \t\tvar cycles;\n52. \t\tvar visited = blankObject();\n53. \n54. \t\tfunction visit(key) {\n55. \t\t\tif (cycles[key]) {\n56. \t\t\t\tthrow new Error(\'Cyclical dependency detected\');\n57. \t\t\t}\n58. \n59. \t\t\tif (visited[key]) return;\n60. \t\t\tvisited[key] = true;\n61. \n62. \t\t\tvar c = computed[key];\n63. \n64. \t\t\tif (c) {\n65. \t\t\t\tcycles[key] = true;\n66. \t\t\t\tc.deps.forEach(visit);\n67. \t\t\t\tsorted.push(c);\n68. \t\t\t}\n69. \t\t}\n70. \n71. \t\tfor (var key in this._computed) {\n72. \t\t\tcycles = blankObject();\n73. \t\t\tvisit(key);\n74. \t\t}\n75. \t},\n76. \n77. \tcompute: function(key, deps, fn) {\n78. \t\tvar store = this;\n79. \t\tvar value;\n80. \n81. \t\tvar c = {\n82. \t\t\tdeps: deps,\n83. \t\t\tupdate: function(state, changed, dirty) {\n84. \t\t\t\tvar values = deps.map(function(dep) {\n85. \t\t\t\t\tif (dep in changed) dirty = true;\n86. \t\t\t\t\treturn state[dep];\n87. \t\t\t\t});\n88. \n89. \t\t\t\tif (dirty) {\n90. \t\t\t\t\tvar newValue = fn.apply(null, values);\n91. \t\t\t\t\tif (differs(newValue, value)) {\n92. \t\t\t\t\t\tvalue = newValue;\n93. \t\t\t\t\t\tchanged[key] = true;\n94. \t\t\t\t\t\tstate[key] = value;\n95. \t\t\t\t\t}\n96. \t\t\t\t}\n97. \t\t\t}\n98. \t\t};\n99. \n100. \t\tc.update(this._state, {}, true);\n101. \n102. \t\tthis._computed[key] = c;\n103. \t\tthis._sortComputedProperties();\n104. \t},\n105. \n106. \tget: get,\n107. \n108. \tobserve: observe,\n109. \n110. \tonchange: function(callback) {\n111. \t\tthis._changeHandlers.push(callback);\n112. \t\treturn {\n113. \t\t\tcancel: function() {\n114. \t\t\t\tvar index = this._changeHandlers.indexOf(callback);\n115. \t\t\t\tif (~index) this._changeHandlers.splice(index, 1);\n116. \t\t\t}\n117. \t\t};\n118. \t},\n119. \n120. \tset: function(newState) {\n121. \t\tvar oldState = this._state,\n122. \t\t\tchanged = this._changed = {},\n123. \t\t\tdirty = false;\n124. \n125. \t\tfor (var key in newState) {\n126. \t\t\tif (this._computed[key]) throw new Error("\'" + key + "\' is a read-only property");\n127. \t\t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n128. \t\t}\n129. \t\tif (!dirty) return;\n130. \n131. \t\tthis._state = assign({}, oldState, newState);\n132. \n133. \t\tfor (var i = 0; i < this._sortedComputedProperties.length; i += 1) {\n134. \t\t\tthis._sortedComputedProperties[i].update(this._state, changed);\n135. \t\t}\n136. \n137. \t\tfor (var i = 0; i < this._changeHandlers.length; i += 1) {\n138. \t\t\tthis._changeHandlers[i](this._state, changed);\n139. \t\t}\n140. \n141. \t\tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n142. \n143. \t\tvar dependents = this._dependents.slice(); // guard against mutations\n144. \t\tfor (var i = 0; i < dependents.length; i += 1) {\n145. \t\t\tvar dependent = dependents[i];\n146. \t\t\tvar componentState = {};\n147. \t\t\tdirty = false;\n148. \n149. \t\t\tfor (var j = 0; j < dependent.props.length; j += 1) {\n150. \t\t\t\tvar prop = dependent.props[j];\n151. \t\t\t\tif (prop in changed) {\n152. \t\t\t\t\tcomponentState[\'$\' + prop] = this._state[prop];\n153. \t\t\t\t\tdirty = true;\n154. \t\t\t\t}\n155. \t\t\t}\n156. \n157. \t\t\tif (dirty) dependent.component.set(componentState);\n158. \t\t}\n159. \n160. \t\tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n161. \t}\n162. });\n163. \n164. export { Store };', start_line_number=1, end_line_number=164), Context(relative_path='test/server-side-rendering/index.js', content='1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";\n12. \n13. function tryToReadFile(file) {\n14. \ttry {\n15. \t\treturn fs.readFileSync(file, "utf-8");\n16. \t} catch (err) {\n17. \t\tif (err.code !== "ENOENT") throw err;\n18. \t\treturn null;\n19. \t}\n20. }\n21. \n22. describe("ssr", () => {\n23. \tbefore(() => {\n24. \t\trequire("../../ssr/register")({\n25. \t\t\textensions: [\'.svelte\', \'.html\'],\n26. \t\t\tstore: true\n27. \t\t});\n28. \n29. \t\treturn setupHtmlEqual();\n30. \t});\n31. \n32. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n33. \t\tif (dir[0] === ".") return;\n34. \n35. \t\t// add .solo to a sample directory name to only run that test, or\n36. \t\t// .show to always show the output. or both\n37. \t\tconst solo = /\\.solo/.test(dir);\n38. \t\tconst show = /\\.show/.test(dir);\n39. \n40. \t\tif (solo && process.env.CI) {\n41. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n42. \t\t}\n43. \n44. \t\t(solo ? it.only : it)(dir, () => {\n45. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n46. \t\t\ttry {\n47. \t\t\t\tlet component;\n48. \n49. \t\t\t\tconst mainHtmlFile = `${dir}/main.html`;\n50. \t\t\t\tconst mainSvelteFile = `${dir}/main.svelte`;\n51. \t\t\t\tif (fs.existsSync(mainHtmlFile)) {\n52. \t\t\t\t\tcomponent = require(mainHtmlFile);\n53. \t\t\t\t} else if (fs.existsSync(mainSvelteFile)) {\n54. \t\t\t\t\tcomponent = require(mainSvelteFile);\n55. \t\t\t\t}\n56. \n57. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n58. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n59. \n60. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n61. \n62. \t\t\t\tconst rendered = component.render(data);\n63. \t\t\t\tconst { html, css, head } = rendered;\n64. \n65. \t\t\t\t// rendered.toString() === rendered.html\n66. \t\t\t\tassert.equal(rendered, html);\n67. \n68. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n69. \t\t\t\tif (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);\n70. \n71. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n72. \t\t\t\tassert.equal(\n73. \t\t\t\t\tcss.code.replace(/^\\s+/gm, ""),\n74. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n75. \t\t\t\t);\n76. \n77. \t\t\t\tif (fs.existsSync(`${dir}/_expected-head.html`)) {\n78. \t\t\t\t\tfs.writeFileSync(`${dir}/_actual-head.html`, head);\n79. \t\t\t\t\tassert.htmlEqual(\n80. \t\t\t\t\t\thead,\n81. \t\t\t\t\t\tfs.readFileSync(`${dir}/_expected-head.html`, \'utf-8\')\n82. \t\t\t\t\t);\n83. \t\t\t\t}\n84. \n85. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n86. \t\t\t} catch (err) {\n87. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n88. \t\t\t\tthrow err;\n89. \t\t\t}\n90. \t\t});\n91. \t});\n92. \n93. \t// duplicate client-side tests, as far as possible\n94. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n95. \t\tif (dir[0] === ".") return;\n96. \n97. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n98. \n99. \t\tif (config.solo && process.env.CI) {\n100. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n101. \t\t}\n102. \n103. \t\tif (config["skip-ssr"]) return;\n104. \n105. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n106. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n107. \n108. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n109. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n110. \t\t\t\tdelete require.cache[resolved];\n111. \t\t\t});\n112. \n113. \t\t\trequire("../../ssr/register")({\n114. \t\t\t\tstore: !!config.store\n115. \t\t\t});\n116. \n117. \t\t\ttry {\n118. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n119. \t\t\t\tconst { html } = component.render(config.data, {\n120. \t\t\t\t\tstore: (config.store !== true) && config.store\n121. \t\t\t\t});\n122. \n123. \t\t\t\tif (config.html) {\n124. \t\t\t\t\tassert.htmlEqual(html, config.html);\n125. \t\t\t\t}\n126. \t\t\t} catch (err) {\n127. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n128. \t\t\t\tthrow err;\n129. \t\t\t}\n130. \t\t});\n131. \t});\n132. });', start_line_number=1, end_line_number=132)]
2025-11-12 14:00:55,026 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_analyzer_message_node - DEBUG - Sending message to IssueBugAnalyzerNode:
content='I am going to share details about an issue reported to a codebase and its related bug context.\nPlease analyze this bug and provide a high-level description of what needs to be changed:\n\n1. Issue Understanding:\n- Analyze the issue title, description, and comments provided\n- Identify the reported symptoms and unexpected behaviors\n\n2. Code Analysis:\n- Identify which files, functions, or code blocks are involved\n- Explain what the problematic code is currently doing\n\n3. Root Cause:\n- Explain why the current behavior is incorrect\n- Identify which specific parts of the code are causing the issue\n\n4. Fix Suggestion:\nFor each needed change, describe in plain English:\n- Which file needs to be modified\n- Which function or code block needs changes\n- What needs to be changed (e.g., "rename variable x to y", "add null check for parameter z")\n- Why this change would fix the issue\n\nDo NOT provide actual code snippets or diffs. Focus on describing what needs to be changed.\n\nHere are the details for analysis:\n\nIssue title:\ncan\'t supply store to nested components server side\n\nIssue description: \nHey, I\'m trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.\n\nE.g. I have a manage account page like so:\n```html\n<div class="page">\n    <h1>Manage Account</h1>\n\n    <div>\n        <h3>Two Factor Auth</h3>\n        <TwoFactorAuth />\n    </div>\n</div>\n\n<style>\n    .page {\n        width: 400px;\n        margin: 50px auto;\n    }\n</style>\n\n<script>\n    import TwoFactorAuth from \'./_components/TwoFactorAuth\';\n\n    export default {\n        components: {\n            TwoFactorAuth,\n        },\n    }\n</script>\n```\n\nAnd in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)\n```html\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n    import { connect } from \'../../_redux\';\n\n    export default {\n        store: connect(state => ({\n            hasTwoFactor: state.user && state.user.hasTwoFactor,\n        })),\n    }\n</script>\n```\n\nAs mentioned this fails on the server side, but not when navigation to the page on the client side.\n\nI dug into the generated code a bit and I see it generates the template like so:\n```js\nreturn `<div class="page" svelte-1782208320>\n    <h1>Manage Account</h1>\n\n    <div>\n        <h3>Two Factor Auth</h3>\n        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}\n    </div>\n</div>`\n```\n\nThis is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.\n\nIt errors on the following line in the TwoFactorAuth\'s `_render` method, as the store is undefined\n```js\nstate = Object.assign(options.store._init(["hasTwoFactor"]), state);\n```\n```\nCannot read property \'_init\' of undefined\n```\n\nIssue comments:\n\n\nBug Context:\nFile: src/generators/nodes/Component.ts\nLine number range: 1 - 609\nContent:\n1. import deindent from \'../../utils/deindent\';\n2. import { stringify } from \'../../utils/stringify\';\n3. import stringifyProps from \'../../utils/stringifyProps\';\n4. import CodeBuilder from \'../../utils/CodeBuilder\';\n5. import getTailSnippet from \'../../utils/getTailSnippet\';\n6. import getObject from \'../../utils/getObject\';\n7. import getExpressionPrecedence from \'../../utils/getExpressionPrecedence\';\n8. import Node from \'./shared/Node\';\n9. import Block from \'../dom/Block\';\n10. import Attribute from \'./Attribute\';\n11. \n12. export default class Component extends Node {\n13. \ttype: \'Component\';\n14. \tname: string;\n15. \tattributes: Attribute[];\n16. \tchildren: Node[];\n17. \n18. \tinit(\n19. \t\tblock: Block,\n20. \t\tstripWhitespace: boolean,\n21. \t\tnextSibling: Node\n22. \t) {\n23. \t\tthis.cannotUseInnerHTML();\n24. \n25. \t\tthis.attributes.forEach((attribute: Node) => {\n26. \t\t\tif (attribute.type === \'Attribute\' && attribute.value !== true) {\n27. \t\t\t\tattribute.value.forEach((chunk: Node) => {\n28. \t\t\t\t\tif (chunk.type !== \'Text\') {\n29. \t\t\t\t\t\tconst dependencies = chunk.metadata.dependencies;\n30. \t\t\t\t\t\tblock.addDependencies(dependencies);\n31. \t\t\t\t\t}\n32. \t\t\t\t});\n33. \t\t\t} else {\n34. \t\t\t\tif (attribute.type === \'EventHandler\' && attribute.expression) {\n35. \t\t\t\t\tattribute.expression.arguments.forEach((arg: Node) => {\n36. \t\t\t\t\t\tblock.addDependencies(arg.metadata.dependencies);\n37. \t\t\t\t\t});\n38. \t\t\t\t} else if (attribute.type === \'Binding\') {\n39. \t\t\t\t\tblock.addDependencies(attribute.metadata.dependencies);\n40. \t\t\t\t}\n41. \t\t\t}\n42. \t\t});\n43. \n44. \t\tthis.var = block.getUniqueName(\n45. \t\t\t(\n46. \t\t\t\tthis.name === \':Self\' ? this.generator.name :\n47. \t\t\t\tthis.name === \':Component\' ? \'switch_instance\' :\n48. \t\t\t\tthis.name\n49. \t\t\t).toLowerCase()\n50. \t\t);\n51. \n52. \t\tif (this.children.length) {\n53. \t\t\tthis._slots = new Set([\'default\']);\n54. \n55. \t\t\tthis.children.forEach(child => {\n56. \t\t\t\tchild.init(block, stripWhitespace, nextSibling);\n57. \t\t\t});\n58. \t\t}\n59. \t}\n60. \n61. \tbuild(\n62. \t\tblock: Block,\n63. \t\tparentNode: string,\n64. \t\tparentNodes: string\n65. \t) {\n66. \t\tconst { generator } = this;\n67. \t\tgenerator.hasComponents = true;\n68. \n69. \t\tconst name = this.var;\n70. \n71. \t\tconst componentInitProperties = [`root: #component.root`];\n72. \n73. \t\tif (this.children.length > 0) {\n74. \t\t\tconst slots = Array.from(this._slots).map(name => `${name}: @createFragment()`);\n75. \t\t\tcomponentInitProperties.push(`slots: { ${slots.join(\', \')} }`);\n76. \n77. \t\t\tthis.children.forEach((child: Node) => {\n78. \t\t\t\tchild.build(block, `${this.var}._slotted.default`, \'nodes\');\n79. \t\t\t});\n80. \t\t}\n81. \n82. \t\tconst allContexts = new Set();\n83. \t\tconst statements: string[] = [];\n84. \t\tconst name_context = block.getUniqueName(`${name}_context`);\n85. \n86. \t\tlet name_updating: string;\n87. \t\tlet name_initial_data: string;\n88. \t\tlet beforecreate: string = null;\n89. \n90. \t\tconst attributes = this.attributes\n91. \t\t\t.filter(a => a.type === \'Attribute\')\n92. \t\t\t.map(a => mungeAttribute(a, block));\n93. \n94. \t\tconst bindings = this.attributes\n95. \t\t\t.filter(a => a.type === \'Binding\')\n96. \t\t\t.map(a => mungeBinding(a, block));\n97. \n98. \t\tconst eventHandlers = this.attributes\n99. \t\t\t.filter((a: Node) => a.type === \'EventHandler\')\n100. \t\t\t.map(a => mungeEventHandler(generator, this, a, block, name_context, allContexts));\n101. \n102. \t\tconst ref = this.attributes.find((a: Node) => a.type === \'Ref\');\n103. \t\tif (ref) generator.usesRefs = true;\n104. \n105. \t\tconst updates: string[] = [];\n106. \n107. \t\tif (attributes.length || bindings.length) {\n108. \t\t\tconst initialProps = attributes\n109. \t\t\t\t.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);\n110. \n111. \t\t\tconst initialPropString = stringifyProps(initialProps);\n112. \n113. \t\t\tattributes\n114. \t\t\t\t.filter((attribute: Attribute) => attribute.dynamic)\n115. \t\t\t\t.forEach((attribute: Attribute) => {\n116. \t\t\t\t\tif (attribute.dependencies.length) {\n117. \t\t\t\t\t\tupdates.push(deindent`\n118. \t\t\t\t\t\t\tif (${attribute.dependencies\n119. \t\t\t\t\t\t\t\t.map(dependency => `changed.${dependency}`)\n120. \t\t\t\t\t\t\t\t.join(\' || \')}) ${name}_changes.${attribute.name} = ${attribute.value};\n121. \t\t\t\t\t\t`);\n122. \t\t\t\t\t}\n123. \n124. \t\t\t\t\telse {\n125. \t\t\t\t\t\t// TODO this is an odd situation to encounter – I *think* it should only happen with\n126. \t\t\t\t\t\t// each block indices, in which case it may be possible to optimise this\n127. \t\t\t\t\t\tupdates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);\n128. \t\t\t\t\t}\n129. \t\t\t\t});\n130. \n131. \t\t\tif (bindings.length) {\n132. \t\t\t\tgenerator.hasComplexBindings = true;\n133. \n134. \t\t\t\tname_updating = block.alias(`${name}_updating`);\n135. \t\t\t\tname_initial_data = block.getUniqueName(`${name}_initial_data`);\n136. \n137. \t\t\t\tblock.addVariable(name_updating, \'{}\');\n138. \t\t\t\tstatements.push(`var ${name_initial_data} = ${initialPropString};`);\n139. \n140. \t\t\t\tconst setParentFromChildOnChange = new CodeBuilder();\n141. \t\t\t\tconst setParentFromChildOnInit = new CodeBuilder();\n142. \n143. \t\t\t\tbindings.forEach((binding: Binding) => {\n144. \t\t\t\t\tlet setParentFromChild;\n145. \n146. \t\t\t\t\tbinding.contexts.forEach(context => {\n147. \t\t\t\t\t\tallContexts.add(context);\n148. \t\t\t\t\t});\n149. \n150. \t\t\t\t\tconst { name: key } = getObject(binding.value);\n151. \n152. \t\t\t\t\tif (block.contexts.has(key)) {\n153. \t\t\t\t\t\tconst prop = binding.dependencies[0];\n154. \t\t\t\t\t\tconst computed = isComputed(binding.value);\n155. \t\t\t\t\t\tconst tail = binding.value.type === \'MemberExpression\' ? getTailSnippet(binding.value) : \'\';\n156. \n157. \t\t\t\t\t\tsetParentFromChild = deindent`\n158. \t\t\t\t\t\t\tvar list = ${name_context}.${block.listNames.get(key)};\n159. \t\t\t\t\t\t\tvar index = ${name_context}.${block.indexNames.get(key)};\n160. \t\t\t\t\t\t\tlist[index]${tail} = childState.${binding.name};\n161. \n162. \t\t\t\t\t\t\t${binding.dependencies\n163. \t\t\t\t\t\t\t\t.map((prop: string) => `newState.${prop} = state.${prop};`)\n164. \t\t\t\t\t\t\t\t.join(\'\\n\')}\n165. \t\t\t\t\t\t`;\n166. \t\t\t\t\t}\n167. \n168. \t\t\t\t\telse if (binding.value.type === \'MemberExpression\') {\n169. \t\t\t\t\t\tsetParentFromChild = deindent`\n170. \t\t\t\t\t\t\t${binding.snippet} = childState.${binding.name};\n171. \t\t\t\t\t\t\t${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join(\'\\n\')}\n172. \t\t\t\t\t\t`;\n173. \t\t\t\t\t}\n174. \n175. \t\t\t\t\telse {\n176. \t\t\t\t\t\tsetParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;\n177. \t\t\t\t\t}\n178. \n179. \t\t\t\t\tstatements.push(deindent`\n180. \t\t\t\t\t\tif (${binding.prop} in ${binding.obj}) {\n181. \t\t\t\t\t\t\t${name_initial_data}.${binding.name} = ${binding.snippet};\n182. \t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n183. \t\t\t\t\t\t}`\n184. \t\t\t\t\t);\n185. \n186. \t\t\t\t\tsetParentFromChildOnChange.addConditional(\n187. \t\t\t\t\t\t`!${name_updating}.${binding.name} && changed.${binding.name}`,\n188. \t\t\t\t\t\tsetParentFromChild\n189. \t\t\t\t\t);\n190. \n191. \t\t\t\t\tsetParentFromChildOnInit.addConditional(\n192. \t\t\t\t\t\t`!${name_updating}.${binding.name}`,\n193. \t\t\t\t\t\tsetParentFromChild\n194. \t\t\t\t\t);\n195. \n196. \t\t\t\t\t// TODO could binding.dependencies.length ever be 0?\n197. \t\t\t\t\tif (binding.dependencies.length) {\n198. \t\t\t\t\t\tupdates.push(deindent`\n199. \t\t\t\t\t\t\tif (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(\' || \')}) {\n200. \t\t\t\t\t\t\t\t${name}_changes.${binding.name} = ${binding.snippet};\n201. \t\t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n202. \t\t\t\t\t\t\t}\n203. \t\t\t\t\t\t`);\n204. \t\t\t\t\t}\n205. \t\t\t\t});\n206. \n207. \t\t\t\tcomponentInitProperties.push(`data: ${name_initial_data}`);\n208. \n209. \t\t\t\tcomponentInitProperties.push(deindent`\n210. \t\t\t\t\t_bind: function(changed, childState) {\n211. \t\t\t\t\t\tvar state = #component.get(), newState = {};\n212. \t\t\t\t\t\t${setParentFromChildOnChange}\n213. \t\t\t\t\t\t${name_updating} = @assign({}, changed);\n214. \t\t\t\t\t\t#component._set(newState);\n215. \t\t\t\t\t\t${name_updating} = {};\n216. \t\t\t\t\t}\n217. \t\t\t\t`);\n218. \n219. \t\t\t\tbeforecreate = deindent`\n220. \t\t\t\t\t#component.root._beforecreate.push(function() {\n221. \t\t\t\t\t\tvar state = #component.get(), childState = ${name}.get(), newState = {};\n222. \t\t\t\t\t\tif (!childState) return;\n223. \t\t\t\t\t\t${setParentFromChildOnInit}\n224. \t\t\t\t\t\t${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(\', \')} };\n225. \t\t\t\t\t\t#component._set(newState);\n226. \t\t\t\t\t\t${name_updating} = {};\n227. \t\t\t\t\t});\n228. \t\t\t\t`;\n229. \t\t\t} else if (initialProps.length) {\n230. \t\t\t\tcomponentInitProperties.push(`data: ${initialPropString}`);\n231. \t\t\t}\n232. \t\t}\n233. \n234. \t\tconst isDynamicComponent = this.name === \':Component\';\n235. \n236. \t\tconst switch_vars = isDynamicComponent && {\n237. \t\t\tvalue: block.getUniqueName(\'switch_value\'),\n238. \t\t\tprops: block.getUniqueName(\'switch_props\')\n239. \t\t};\n240. \n241. \t\tconst expression = (\n242. \t\t\tthis.name === \':Self\' ? generator.name :\n243. \t\t\tisDynamicComponent ? switch_vars.value :\n244. \t\t\t`%components-${this.name}`\n245. \t\t);\n246. \n247. \t\tif (isDynamicComponent) {\n248. \t\t\tblock.contextualise(this.expression);\n249. \t\t\tconst { dependencies, snippet } = this.metadata;\n250. \n251. \t\t\tconst anchor = this.getOrCreateAnchor(block, parentNode, parentNodes);\n252. \n253. \t\t\tconst params = block.params.join(\', \');\n254. \n255. \t\t\tblock.builders.init.addBlock(deindent`\n256. \t\t\t\tvar ${switch_vars.value} = ${snippet};\n257. \n258. \t\t\t\tfunction ${switch_vars.props}(${params}) {\n259. \t\t\t\t\t${statements.length > 0 && statements.join(\'\\n\')}\n260. \t\t\t\t\treturn {\n261. \t\t\t\t\t\t${componentInitProperties.join(\',\\n\')}\n262. \t\t\t\t\t};\n263. \t\t\t\t}\n264. \n265. \t\t\t\tif (${switch_vars.value}) {\n266. \t\t\t\t\tvar ${name} = new ${expression}(${switch_vars.props}(${params}));\n267. \n268. \t\t\t\t\t${beforecreate}\n269. \t\t\t\t}\n270. \n271. \t\t\t\t${eventHandlers.map(handler => deindent`\n272. \t\t\t\t\tfunction ${handler.var}(event) {\n273. \t\t\t\t\t\t${handler.body}\n274. \t\t\t\t\t}\n275. \n276. \t\t\t\t\tif (${name}) ${name}.on("${handler.name}", ${handler.var});\n277. \t\t\t\t`)}\n278. \t\t\t`);\n279. \n280. \t\t\tblock.builders.create.addLine(\n281. \t\t\t\t`if (${name}) ${name}._fragment.c();`\n282. \t\t\t);\n283. \n284. \t\t\tif (parentNodes) {\n285. \t\t\t\tblock.builders.claim.addLine(\n286. \t\t\t\t\t`if (${name}) ${name}._fragment.l(${parentNodes});`\n287. \t\t\t\t);\n288. \t\t\t}\n289. \n290. \t\t\tblock.builders.mount.addLine(\n291. \t\t\t\t`if (${name}) ${name}._mount(${parentNode || \'#target\'}, ${parentNode ? \'null\' : \'anchor\'});`\n292. \t\t\t);\n293. \n294. \t\t\tconst updateMountNode = this.getUpdateMountNode(anchor);\n295. \n296. \t\t\tblock.builders.update.addBlock(deindent`\n297. \t\t\t\tif (${switch_vars.value} !== (${switch_vars.value} = ${snippet})) {\n298. \t\t\t\t\tif (${name}) ${name}.destroy();\n299. \n300. \t\t\t\t\tif (${switch_vars.value}) {\n301. \t\t\t\t\t\t${name} = new ${switch_vars.value}(${switch_vars.props}(${params}));\n302. \t\t\t\t\t\t${name}._fragment.c();\n303. \n304. \t\t\t\t\t\t${this.children.map(child => remount(generator, child, name))}\n305. \t\t\t\t\t\t${name}._mount(${updateMountNode}, ${anchor});\n306. \n307. \t\t\t\t\t\t${eventHandlers.map(handler => deindent`\n308. \t\t\t\t\t\t\t${name}.on("${handler.name}", ${handler.var});\n309. \t\t\t\t\t\t`)}\n310. \n311. \t\t\t\t\t\t${ref && `#component.refs.${ref.name} = ${name};`}\n312. \t\t\t\t\t}\n313. \n314. \t\t\t\t\t${ref && deindent`\n315. \t\t\t\t\t\telse if (#component.refs.${ref.name} === ${name}) {\n316. \t\t\t\t\t\t\t#component.refs.${ref.name} = null;\n317. \t\t\t\t\t\t}`}\n318. \t\t\t\t}\n319. \t\t\t`);\n320. \n321. \t\t\tif (updates.length) {\n322. \t\t\t\tblock.builders.update.addBlock(deindent`\n323. \t\t\t\t\telse {\n324. \t\t\t\t\t\tvar ${name}_changes = {};\n325. \t\t\t\t\t\t${updates.join(\'\\n\')}\n326. \t\t\t\t\t\t${name}._set(${name}_changes);\n327. \t\t\t\t\t\t${bindings.length && `${name_updating} = {};`}\n328. \t\t\t\t\t}\n329. \t\t\t\t`);\n330. \t\t\t}\n331. \n332. \t\t\tif (!parentNode) block.builders.unmount.addLine(`if (${name}) ${name}._unmount();`);\n333. \n334. \t\t\tblock.builders.destroy.addLine(`if (${name}) ${name}.destroy(false);`);\n335. \t\t} else {\n336. \t\t\tblock.builders.init.addBlock(deindent`\n337. \t\t\t\t${statements.join(\'\\n\')}\n338. \t\t\t\tvar ${name} = new ${expression}({\n339. \t\t\t\t\t${componentInitProperties.join(\',\\n\')}\n340. \t\t\t\t});\n341. \n342. \t\t\t\t${beforecreate}\n343. \n344. \t\t\t\t${eventHandlers.map(handler => deindent`\n345. \t\t\t\t\t${name}.on("${handler.name}", function(event) {\n346. \t\t\t\t\t\t${handler.body}\n347. \t\t\t\t\t});\n348. \t\t\t\t`)}\n349. \n350. \t\t\t\t${ref && `#component.refs.${ref.name} = ${name};`}\n351. \t\t\t`);\n352. \n353. \t\t\tblock.builders.create.addLine(`${name}._fragment.c();`);\n354. \n355. \t\t\tif (parentNodes) {\n356. \t\t\t\tblock.builders.claim.addLine(\n357. \t\t\t\t\t`${name}._fragment.l(${parentNodes});`\n358. \t\t\t\t);\n359. \t\t\t}\n360. \n361. \t\t\tblock.builders.mount.addLine(\n362. \t\t\t\t`${name}._mount(${parentNode || \'#target\'}, ${parentNode ? \'null\' : \'anchor\'});`\n363. \t\t\t);\n364. \n365. \t\t\tif (updates.length) {\n366. \t\t\t\tblock.builders.update.addBlock(deindent`\n367. \t\t\t\t\tvar ${name}_changes = {};\n368. \t\t\t\t\t${updates.join(\'\\n\')}\n369. \t\t\t\t\t${name}._set(${name}_changes);\n370. \t\t\t\t\t${bindings.length && `${name_updating} = {};`}\n371. \t\t\t\t`);\n372. \t\t\t}\n373. \n374. \t\t\tif (!parentNode) block.builders.unmount.addLine(`${name}._unmount();`);\n375. \n376. \t\t\tblock.builders.destroy.addLine(deindent`\n377. \t\t\t\t${name}.destroy(false);\n378. \t\t\t\t${ref && `if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;`}\n379. \t\t\t`);\n380. \t\t}\n381. \n382. \t\t// maintain component context\n383. \t\tif (allContexts.size) {\n384. \t\t\tconst contexts = Array.from(allContexts);\n385. \n386. \t\t\tconst initialProps = contexts\n387. \t\t\t\t.map(contextName => {\n388. \t\t\t\t\tif (contextName === \'state\') return `state: state`;\n389. \n390. \t\t\t\t\tconst listName = block.listNames.get(contextName);\n391. \t\t\t\t\tconst indexName = block.indexNames.get(contextName);\n392. \n393. \t\t\t\t\treturn `${listName}: ${listName},\\n${indexName}: ${indexName}`;\n394. \t\t\t\t})\n395. \t\t\t\t.join(\',\\n\');\n396. \n397. \t\t\tconst updates = contexts\n398. \t\t\t\t.map(contextName => {\n399. \t\t\t\t\tif (contextName === \'state\') return `${name_context}.state = state;`;\n400. \n401. \t\t\t\t\tconst listName = block.listNames.get(contextName);\n402. \t\t\t\t\tconst indexName = block.indexNames.get(contextName);\n403. \n404. \t\t\t\t\treturn `${name_context}.${listName} = ${listName};\\n${name_context}.${indexName} = ${indexName};`;\n405. \t\t\t\t})\n406. \t\t\t\t.join(\'\\n\');\n407. \n408. \t\t\tblock.builders.init.addBlock(deindent`\n409. \t\t\t\tvar ${name_context} = {\n410. \t\t\t\t\t${initialProps}\n411. \t\t\t\t};\n412. \t\t\t`);\n413. \n414. \t\t\tblock.builders.update.addBlock(updates);\n415. \t\t}\n416. \t}\n417. }\n418. \n419. function mungeAttribute(attribute: Node, block: Block): Attribute {\n420. \tif (attribute.value === true) {\n421. \t\t// attributes without values, e.g. <textarea readonly>\n422. \t\treturn {\n423. \t\t\tname: attribute.name,\n424. \t\t\tvalue: true,\n425. \t\t\tdynamic: false\n426. \t\t};\n427. \t}\n428. \n429. \tif (attribute.value.length === 0) {\n430. \t\treturn {\n431. \t\t\tname: attribute.name,\n432. \t\t\tvalue: `\'\'`,\n433. \t\t\tdynamic: false\n434. \t\t};\n435. \t}\n436. \n437. \tif (attribute.value.length === 1) {\n438. \t\tconst value = attribute.value[0];\n439. \n440. \t\tif (value.type === \'Text\') {\n441. \t\t\t// static attributes\n442. \t\t\treturn {\n443. \t\t\t\tname: attribute.name,\n444. \t\t\t\tvalue: isNaN(value.data) ? stringify(value.data) : value.data,\n445. \t\t\t\tdynamic: false\n446. \t\t\t};\n447. \t\t}\n448. \n449. \t\t// simple dynamic attributes\n450. \t\tblock.contextualise(value.expression); // TODO remove\n451. \t\tconst { dependencies, snippet } = value.metadata;\n452. \n453. \t\t// TODO only update attributes that have changed\n454. \t\treturn {\n455. \t\t\tname: attribute.name,\n456. \t\t\tvalue: snippet,\n457. \t\t\tdependencies,\n458. \t\t\tdynamic: true\n459. \t\t};\n460. \t}\n461. \n462. \t// otherwise we\'re dealing with a complex dynamic attribute\n463. \tconst allDependencies = new Set();\n464. \n465. \tconst value =\n466. \t\t(attribute.value[0].type === \'Text\' ? \'\' : `"" + `) +\n467. \t\tattribute.value\n468. \t\t\t.map((chunk: Node) => {\n469. \t\t\t\tif (chunk.type === \'Text\') {\n470. \t\t\t\t\treturn stringify(chunk.data);\n471. \t\t\t\t} else {\n472. \t\t\t\t\tblock.contextualise(chunk.expression); // TODO remove\n473. \t\t\t\t\tconst { dependencies, snippet } = chunk.metadata;\n474. \n475. \t\t\t\t\tdependencies.forEach((dependency: string) => {\n476. \t\t\t\t\t\tallDependencies.add(dependency);\n477. \t\t\t\t\t});\n478. \n479. \t\t\t\t\treturn getExpressionPrecedence(chunk.expression) <= 13 ? `(${snippet})` : snippet;\n480. \t\t\t\t}\n481. \t\t\t})\n482. \t\t\t.join(\' + \');\n483. \n484. \treturn {\n485. \t\tname: attribute.name,\n486. \t\tvalue,\n487. \t\tdependencies: Array.from(allDependencies),\n488. \t\tdynamic: true\n489. \t};\n490. }\n491. \n492. function mungeBinding(binding: Node, block: Block): Binding {\n493. \tconst { name } = getObject(binding.value);\n494. \tconst { contexts } = block.contextualise(binding.value);\n495. \tconst { dependencies, snippet } = binding.metadata;\n496. \n497. \tconst contextual = block.contexts.has(name);\n498. \n499. \tlet obj;\n500. \tlet prop;\n501. \n502. \tif (contextual) {\n503. \t\tobj = block.listNames.get(name);\n504. \t\tprop = block.indexNames.get(name);\n505. \t} else if (binding.value.type === \'MemberExpression\') {\n506. \t\tprop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;\n507. \t\tif (!binding.value.computed) prop = `\'${prop}\'`;\n508. \t\tobj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;\n509. \t} else {\n510. \t\tobj = \'state\';\n511. \t\tprop = `\'${name}\'`;\n512. \t}\n513. \n514. \treturn {\n515. \t\tname: binding.name,\n516. \t\tvalue: binding.value,\n517. \t\tcontexts,\n518. \t\tsnippet,\n519. \t\tobj,\n520. \t\tprop,\n521. \t\tdependencies\n522. \t};\n523. }\n524. \n525. function mungeEventHandler(generator: DomGenerator, node: Node, handler: Node, block: Block, name_context: string, allContexts: Set<string>) {\n526. \tlet body;\n527. \n528. \tif (handler.expression) {\n529. \t\tgenerator.addSourcemapLocations(handler.expression);\n530. \t\tgenerator.code.prependRight(\n531. \t\t\thandler.expression.start,\n532. \t\t\t`${block.alias(\'component\')}.`\n533. \t\t);\n534. \n535. \t\tconst usedContexts: string[] = [];\n536. \n537. \t\thandler.expression.arguments.forEach((arg: Node) => {\n538. \t\t\tconst { contexts } = block.contextualise(arg, null, true);\n539. \n540. \t\t\tcontexts.forEach(context => {\n541. \t\t\t\tif (!~usedContexts.indexOf(context)) usedContexts.push(context);\n542. \t\t\t\tallContexts.add(context);\n543. \t\t\t});\n544. \t\t});\n545. \n546. \t\t// TODO hoist event handlers? can do `this.__component.method(...)`\n547. \t\tconst declarations = usedContexts.map(name => {\n548. \t\t\tif (name === \'state\') return `var state = ${name_context}.state;`;\n549. \n550. \t\t\tconst listName = block.listNames.get(name);\n551. \t\t\tconst indexName = block.indexNames.get(name);\n552. \n553. \t\t\treturn `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;\n554. \t\t});\n555. \n556. \t\tbody = deindent`\n557. \t\t\t${declarations}\n558. \n559. \t\t\t[✂${handler.expression.start}-${handler.expression.end}✂];\n560. \t\t`;\n561. \t} else {\n562. \t\tbody = deindent`\n563. \t\t\t${block.alias(\'component\')}.fire(\'${handler.name}\', event);\n564. \t\t`;\n565. \t}\n566. \n567. \treturn {\n568. \t\tname: handler.name,\n569. \t\tvar: block.getUniqueName(`${node.var}_${handler.name}`),\n570. \t\tbody\n571. \t};\n572. }\n573. \n574. function isComputed(node: Node) {\n575. \twhile (node.type === \'MemberExpression\') {\n576. \t\tif (node.computed) return true;\n577. \t\tnode = node.object;\n578. \t}\n579. \n580. \treturn false;\n581. }\n582. \n583. function remount(generator: DomGenerator, node: Node, name: string) {\n584. \t// TODO make this a method of the nodes\n585. \n586. \tif (node.type === \'Component\') {\n587. \t\treturn `${node.var}._mount(${name}._slotted.default, null);`;\n588. \t}\n589. \n590. \tif (node.type === \'Element\') {\n591. \t\tconst slot = node.attributes.find(attribute => attribute.name === \'slot\');\n592. \t\tif (slot) {\n593. \t\t\treturn `@appendNode(${node.var}, ${name}._slotted.${node.getStaticAttributeValue(\'slot\')});`;\n594. \t\t}\n595. \n596. \t\treturn `@appendNode(${node.var}, ${name}._slotted.default);`;\n597. \t}\n598. \n599. \tif (node.type === \'Text\' || node.type === \'MustacheTag\' || node.type === \'RawMustacheTag\') {\n600. \t\treturn `@appendNode(${node.var}, ${name}._slotted.default);`;\n601. \t}\n602. \n603. \tif (node.type === \'EachBlock\') {\n604. \t\t// TODO consider keyed blocks\n605. \t\treturn `for (var #i = 0; #i < ${node.iterations}.length; #i += 1) ${node.iterations}[#i].m(${name}._slotted.default, null);`;\n606. \t}\n607. \n608. \treturn `${node.var}.m(${name}._slotted.default, null);`;\n609. }\n\n\nFile: src/generators/server-side-rendering/Block.ts\nLine number range: 1 - 49\nContent:\n1. import deindent from \'../../utils/deindent\';\n2. import flattenReference from \'../../utils/flattenReference\';\n3. import { SsrGenerator } from \'./index\';\n4. import { Node } from \'../../interfaces\';\n5. import getObject from \'../../utils/getObject\';\n6. \n7. interface BlockOptions {\n8. \t// TODO\n9. }\n10. \n11. export default class Block {\n12. \tgenerator: SsrGenerator;\n13. \tconditions: string[];\n14. \n15. \tcontexts: Map<string, string>;\n16. \tindexes: Map<string, string>;\n17. \tcontextDependencies: Map<string, string[]>;\n18. \n19. \tconstructor(options: BlockOptions) {\n20. \t\tObject.assign(this, options);\n21. \t}\n22. \n23. \taddBinding(binding: Node, name: string) {\n24. \t\tconst conditions = [`!(\'${binding.name}\' in state)`].concat(\n25. \t\t\t// TODO handle contextual bindings...\n26. \t\t\tthis.conditions.map(c => `(${c})`)\n27. \t\t);\n28. \n29. \t\tconst { name: prop } = getObject(binding.value);\n30. \n31. \t\tthis.generator.bindings.push(deindent`\n32. \t\t\tif (${conditions.join(\'&&\')}) {\n33. \t\t\t\ttmp = ${name}.data();\n34. \t\t\t\tif (\'${prop}\' in tmp) {\n35. \t\t\t\t\tstate.${binding.name} = tmp.${prop};\n36. \t\t\t\t\tsettled = false;\n37. \t\t\t\t}\n38. \t\t\t}\n39. \t\t`);\n40. \t}\n41. \n42. \tchild(options: BlockOptions) {\n43. \t\treturn new Block(Object.assign({}, this, options, { parent: this }));\n44. \t}\n45. \n46. \tcontextualise(expression: Node, context?: string, isEventHandler?: boolean) {\n47. \t\treturn this.generator.contextualise(this.contexts, this.indexes, expression, context, isEventHandler);\n48. \t}\n49. }\n\n\nFile: src/generators/server-side-rendering/index.ts\nLine number range: 1 - 268\nContent:\n1. import deindent from \'../../utils/deindent\';\n2. import Generator from \'../Generator\';\n3. import Stylesheet from \'../../css/Stylesheet\';\n4. import Block from \'./Block\';\n5. import visit from \'./visit\';\n6. import { removeNode, removeObjectKey } from \'../../utils/removeNode\';\n7. import getName from \'../../utils/getName\';\n8. import globalWhitelist from \'../../utils/globalWhitelist\';\n9. import { Parsed, Node, CompileOptions } from \'../../interfaces\';\n10. import { AppendTarget } from \'./interfaces\';\n11. import { stringify } from \'../../utils/stringify\';\n12. \n13. export class SsrGenerator extends Generator {\n14. \tbindings: string[];\n15. \trenderCode: string;\n16. \tappendTargets: AppendTarget[];\n17. \n18. \tconstructor(\n19. \t\tparsed: Parsed,\n20. \t\tsource: string,\n21. \t\tname: string,\n22. \t\tstylesheet: Stylesheet,\n23. \t\toptions: CompileOptions\n24. \t) {\n25. \t\tsuper(parsed, source, name, stylesheet, options, false);\n26. \t\tthis.bindings = [];\n27. \t\tthis.renderCode = \'\';\n28. \t\tthis.appendTargets = [];\n29. \n30. \t\tthis.stylesheet.warnOnUnusedSelectors(options.onwarn);\n31. \t}\n32. \n33. \tappend(code: string) {\n34. \t\tif (this.appendTargets.length) {\n35. \t\t\tconst appendTarget = this.appendTargets[this.appendTargets.length - 1];\n36. \t\t\tconst slotName = appendTarget.slotStack[appendTarget.slotStack.length - 1];\n37. \t\t\tappendTarget.slots[slotName] += code;\n38. \t\t} else {\n39. \t\t\tthis.renderCode += code;\n40. \t\t}\n41. \t}\n42. }\n43. \n44. export default function ssr(\n45. \tparsed: Parsed,\n46. \tsource: string,\n47. \tstylesheet: Stylesheet,\n48. \toptions: CompileOptions\n49. ) {\n50. \tconst format = options.format || \'cjs\';\n51. \n52. \tconst generator = new SsrGenerator(parsed, source, options.name || \'SvelteComponent\', stylesheet, options);\n53. \n54. \tconst { computations, name, templateProperties } = generator;\n55. \n56. \t// create main render() function\n57. \tconst mainBlock = new Block({\n58. \t\tgenerator,\n59. \t\tcontexts: new Map(),\n60. \t\tindexes: new Map(),\n61. \t\tconditions: [],\n62. \t});\n63. \n64. \ttrim(parsed.html.children).forEach((node: Node) => {\n65. \t\tvisit(generator, mainBlock, node);\n66. \t});\n67. \n68. \tconst { css, cssMap } = generator.customElement ?\n69. \t\t{ css: null, cssMap: null } :\n70. \t\tgenerator.stylesheet.render(options.filename, true);\n71. \n72. \t// generate initial state object\n73. \tconst expectedProperties = Array.from(generator.expectedProperties);\n74. \tconst globals = expectedProperties.filter(prop => globalWhitelist.has(prop));\n75. \tconst storeProps = options.store || templateProperties.store ? expectedProperties.filter(prop => prop[0] === \'$\') : [];\n76. \n77. \tconst initialState = [];\n78. \tif (globals.length > 0) {\n79. \t\tinitialState.push(`{ ${globals.map(prop => `${prop} : ${prop}`).join(\', \')} }`);\n80. \t}\n81. \n82. \tif (storeProps.length > 0) {\n83. \t\tconst initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`\n84. \t\tif (options.store || templateProperties.store) {\n85. \t\t\tinitialState.push(`options.store.${initialize}`);\n86. \t\t}\n87. \t}\n88. \n89. \tif (templateProperties.data) {\n90. \t\tinitialState.push(`%data()`);\n91. \t} else if (globals.length === 0 && storeProps.length === 0) {\n92. \t\tinitialState.push(\'{}\');\n93. \t}\n94. \n95. \tinitialState.push(\'state\');\n96. \n97. \t// TODO concatenate CSS maps\n98. \tconst result = deindent`\n99. \t\t${generator.javascript}\n100. \n101. \t\tvar ${name} = {};\n102. \n103. \t\t${options.filename && `${name}.filename = ${stringify(options.filename)}`};\n104. \n105. \t\t${name}.data = function() {\n106. \t\t\treturn ${templateProperties.data ? `%data()` : `{}`};\n107. \t\t};\n108. \n109. \t\t${name}.render = function(state, options = {}) {\n110. \t\t\tvar components = new Set();\n111. \n112. \t\t\tfunction addComponent(component) {\n113. \t\t\t\tcomponents.add(component);\n114. \t\t\t}\n115. \n116. \t\t\tvar result = { head: \'\', addComponent };\n117. \t\t\t${templateProperties.store && `options.store = %store();`}\n118. \t\t\tvar html = ${name}._render(result, state, options);\n119. \n120. \t\t\tvar cssCode = Array.from(components).map(c => c.css && c.css.code).filter(Boolean).join(\'\\\\n\');\n121. \n122. \t\t\treturn {\n123. \t\t\t\thtml,\n124. \t\t\t\thead: result.head,\n125. \t\t\t\tcss: { code: cssCode, map: null },\n126. \t\t\t\ttoString() {\n127. \t\t\t\t\treturn html;\n128. \t\t\t\t}\n129. \t\t\t};\n130. \t\t}\n131. \n132. \t\t${name}._render = function(__result, state, options) {\n133. \t\t\t__result.addComponent(${name});\n134. \n135. \t\t\tstate = Object.assign(${initialState.join(\', \')});\n136. \n137. \t\t\t${computations.map(\n138. \t\t\t\t({ key, deps }) =>\n139. \t\t\t\t\t`state.${key} = %computed-${key}(${deps.map(dep => `state.${dep}`).join(\', \')});`\n140. \t\t\t)}\n141. \n142. \t\t\t${generator.bindings.length &&\n143. \t\t\t\tdeindent`\n144. \t\t\t\tvar settled = false;\n145. \t\t\t\tvar tmp;\n146. \n147. \t\t\t\twhile (!settled) {\n148. \t\t\t\t\tsettled = true;\n149. \n150. \t\t\t\t\t${generator.bindings.join(\'\\n\\n\')}\n151. \t\t\t\t}\n152. \t\t\t`}\n153. \n154. \t\t\treturn \\`${generator.renderCode}\\`;\n155. \t\t};\n156. \n157. \t\t${name}.css = {\n158. \t\t\tcode: ${css ? stringify(css) : `\'\'`},\n159. \t\t\tmap: ${cssMap ? stringify(cssMap.toString()) : \'null\'}\n160. \t\t};\n161. \n162. \t\tvar warned = false;\n163. \t\t${name}.renderCss = function() {\n164. \t\t\tif (!warned) {\n165. \t\t\t\tconsole.error(\'Component.renderCss(...) is deprecated and will be removed in v2 — use Component.render(...).css instead\');\n166. \t\t\t\twarned = true;\n167. \t\t\t}\n168. \n169. \t\t\tvar components = [];\n170. \n171. \t\t\t${generator.stylesheet.hasStyles &&\n172. \t\t\t\tdeindent`\n173. \t\t\t\tcomponents.push({\n174. \t\t\t\t\tfilename: ${name}.filename,\n175. \t\t\t\t\tcss: ${name}.css && ${name}.css.code,\n176. \t\t\t\t\tmap: ${name}.css && ${name}.css.map\n177. \t\t\t\t});\n178. \t\t\t`}\n179. \n180. \t\t\t${templateProperties.components &&\n181. \t\t\t\tdeindent`\n182. \t\t\t\tvar seen = {};\n183. \n184. \t\t\t\tfunction addComponent(component) {\n185. \t\t\t\t\tvar result = component.renderCss();\n186. \t\t\t\t\tresult.components.forEach(x => {\n187. \t\t\t\t\t\tif (seen[x.filename]) return;\n188. \t\t\t\t\t\tseen[x.filename] = true;\n189. \t\t\t\t\t\tcomponents.push(x);\n190. \t\t\t\t\t});\n191. \t\t\t\t}\n192. \n193. \t\t\t\t${templateProperties.components.value.properties.map((prop: Node) => {\n194. \t\t\t\t\treturn `addComponent(%components-${getName(prop.key)});`;\n195. \t\t\t\t})}\n196. \t\t\t`}\n197. \n198. \t\t\treturn {\n199. \t\t\t\tcss: components.map(x => x.css).join(\'\\\\n\'),\n200. \t\t\t\tmap: null,\n201. \t\t\t\tcomponents\n202. \t\t\t};\n203. \t\t};\n204. \n205. \t\t${templateProperties.preload && `${name}.preload = %preload;`}\n206. \n207. \t\t${\n208. \t\t\t// TODO this is a bit hacky\n209. \t\t\t/__escape/.test(generator.renderCode) && deindent`\n210. \t\t\t\tvar escaped = {\n211. \t\t\t\t\t\'"\': \'&quot;\',\n212. \t\t\t\t\t"\'": \'&##39;\',\n213. \t\t\t\t\t\'&\': \'&amp;\',\n214. \t\t\t\t\t\'<\': \'&lt;\',\n215. \t\t\t\t\t\'>\': \'&gt;\'\n216. \t\t\t\t};\n217. \n218. \t\t\t\tfunction __escape(html) {\n219. \t\t\t\t\treturn String(html).replace(/["\'&<>]/g, match => escaped[match]);\n220. \t\t\t\t}\n221. \t\t\t`\n222. \t\t}\n223. \n224. \t\t${\n225. \t\t\t/__isPromise/.test(generator.renderCode) && deindent`\n226. \t\t\t\tfunction __isPromise(value) {\n227. \t\t\t\t\treturn value && typeof value.then === \'function\';\n228. \t\t\t\t}\n229. \t\t\t`\n230. \t\t}\n231. \n232. \t\t${\n233. \t\t\t/__missingComponent/.test(generator.renderCode) && deindent`\n234. \t\t\t\tvar __missingComponent = {\n235. \t\t\t\t\t_render: () => \'\'\n236. \t\t\t\t};\n237. \t\t\t`\n238. \t\t}\n239. \t`.replace(/(@+|#+|%+)(\\w*(?:-\\w*)?)/g, (match: string, sigil: string, name: string) => {\n240. \t\tif (sigil === \'@\') return generator.alias(name);\n241. \t\tif (sigil === \'%\') return generator.templateVars.get(name);\n242. \t\treturn sigil.slice(1) + name;\n243. \t});\n244. \n245. \treturn generator.generate(result, options, { name, format });\n246. }\n247. \n248. function trim(nodes) {\n249. \tlet start = 0;\n250. \tfor (; start < nodes.length; start += 1) {\n251. \t\tconst node = nodes[start];\n252. \t\tif (node.type !== \'Text\') break;\n253. \n254. \t\tnode.data = node.data.replace(/^\\s+/, \'\');\n255. \t\tif (node.data) break;\n256. \t}\n257. \n258. \tlet end = nodes.length;\n259. \tfor (; end > start; end -= 1) {\n260. \t\tconst node = nodes[end - 1];\n261. \t\tif (node.type !== \'Text\') break;\n262. \n263. \t\tnode.data = node.data.replace(/\\s+$/, \'\');\n264. \t\tif (node.data) break;\n265. \t}\n266. \n267. \treturn nodes.slice(start, end);\n268. }\n\n\nFile: src/generators/server-side-rendering/visit.ts\nLine number range: 1 - 13\nContent:\n1. import visitors from \'./visitors/index\';\n2. import { SsrGenerator } from \'./index\';\n3. import Block from \'./Block\';\n4. import { Node } from \'../../interfaces\';\n5. \n6. export default function visit(\n7. \tgenerator: SsrGenerator,\n8. \tblock: Block,\n9. \tnode: Node\n10. ) {\n11. \tconst visitor = visitors[node.type];\n12. \tvisitor(generator, block, node);\n13. }\n\n\nFile: src/generators/server-side-rendering/visitors/Component.ts\nLine number range: 1 - 121\nContent:\n1. import flattenReference from \'../../../utils/flattenReference\';\n2. import visit from \'../visit\';\n3. import { SsrGenerator } from \'../index\';\n4. import Block from \'../Block\';\n5. import { AppendTarget } from \'../interfaces\';\n6. import { Node } from \'../../../interfaces\';\n7. import getObject from \'../../../utils/getObject\';\n8. import getTailSnippet from \'../../../utils/getTailSnippet\';\n9. import { stringify } from \'../../../utils/stringify\';\n10. \n11. export default function visitComponent(\n12. \tgenerator: SsrGenerator,\n13. \tblock: Block,\n14. \tnode: Node\n15. ) {\n16. \tfunction stringifyAttribute(chunk: Node) {\n17. \t\tif (chunk.type === \'Text\') return chunk.data;\n18. \t\tif (chunk.type === \'MustacheTag\') {\n19. \t\t\tblock.contextualise(chunk.expression);\n20. \t\t\tconst { snippet } = chunk.metadata;\n21. \t\t\treturn \'${__escape( \' + snippet + \')}\';\n22. \t\t}\n23. \t}\n24. \n25. \tconst attributes: Node[] = [];\n26. \tconst bindings: Node[] = [];\n27. \n28. \tnode.attributes.forEach((attribute: Node) => {\n29. \t\tif (attribute.type === \'Attribute\') {\n30. \t\t\tattributes.push(attribute);\n31. \t\t} else if (attribute.type === \'Binding\') {\n32. \t\t\tbindings.push(attribute);\n33. \t\t}\n34. \t});\n35. \n36. \tconst props = attributes\n37. \t\t.map(attribute => {\n38. \t\t\tlet value;\n39. \n40. \t\t\tif (attribute.value === true) {\n41. \t\t\t\tvalue = `true`;\n42. \t\t\t} else if (attribute.value.length === 0) {\n43. \t\t\t\tvalue = `\'\'`;\n44. \t\t\t} else if (attribute.value.length === 1) {\n45. \t\t\t\tconst chunk = attribute.value[0];\n46. \t\t\t\tif (chunk.type === \'Text\') {\n47. \t\t\t\t\tvalue = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;\n48. \t\t\t\t} else {\n49. \t\t\t\t\tblock.contextualise(chunk.expression);\n50. \t\t\t\t\tconst { snippet } = chunk.metadata;\n51. \t\t\t\t\tvalue = snippet;\n52. \t\t\t\t}\n53. \t\t\t} else {\n54. \t\t\t\tvalue = \'`\' + attribute.value.map(stringifyAttribute).join(\'\') + \'`\';\n55. \t\t\t}\n56. \n57. \t\t\treturn `${attribute.name}: ${value}`;\n58. \t\t})\n59. \t\t.concat(\n60. \t\t\tbindings.map(binding => {\n61. \t\t\t\tconst { name } = getObject(binding.value);\n62. \t\t\t\tconst tail = binding.value.type === \'MemberExpression\'\n63. \t\t\t\t\t? getTailSnippet(binding.value)\n64. \t\t\t\t\t: \'\';\n65. \n66. \t\t\t\tconst keypath = block.contexts.has(name)\n67. \t\t\t\t\t? `${name}${tail}`\n68. \t\t\t\t\t: `state.${name}${tail}`;\n69. \t\t\t\treturn `${binding.name}: ${keypath}`;\n70. \t\t\t})\n71. \t\t)\n72. \t\t.join(\', \');\n73. \n74. \tconst isDynamicComponent = node.name === \':Component\';\n75. \tif (isDynamicComponent) block.contextualise(node.expression);\n76. \n77. \tconst expression = (\n78. \t\tnode.name === \':Self\' ? generator.name :\n79. \t\tisDynamicComponent ? `((${node.metadata.snippet}) || __missingComponent)` :\n80. \t\t`%components-${node.name}`\n81. \t);\n82. \n83. \tbindings.forEach(binding => {\n84. \t\tblock.addBinding(binding, expression);\n85. \t});\n86. \n87. \tlet open = `\\${${expression}._render(__result, {${props}}`;\n88. \n89. \tconst options = [];\n90. \tif (generator.options.store) {\n91. \t\toptions.push(`store: options.store`);\n92. \t}\n93. \n94. \tif (node.children.length) {\n95. \t\tconst appendTarget: AppendTarget = {\n96. \t\t\tslots: { default: \'\' },\n97. \t\t\tslotStack: [\'default\']\n98. \t\t};\n99. \n100. \t\tgenerator.appendTargets.push(appendTarget);\n101. \n102. \t\tnode.children.forEach((child: Node) => {\n103. \t\t\tvisit(generator, block, child);\n104. \t\t});\n105. \n106. \t\tconst slotted = Object.keys(appendTarget.slots)\n107. \t\t\t.map(name => `${name}: () => \\`${appendTarget.slots[name]}\\``)\n108. \t\t\t.join(\', \');\n109. \n110. \t\toptions.push(`slotted: { ${slotted} }`);\n111. \n112. \t\tgenerator.appendTargets.pop();\n113. \t}\n114. \n115. \tif (options.length) {\n116. \t\topen += `, { ${options.join(\', \')} }`;\n117. \t}\n118. \n119. \tgenerator.append(open);\n120. \tgenerator.append(\')}\');\n121. }\n\n\nFile: src/generators/wrapModule.ts\nLine number range: 1 - 299\nContent:\n1. import deindent from \'../utils/deindent\';\n2. import list from \'../utils/list\';\n3. import { CompileOptions, ModuleFormat, Node } from \'../interfaces\';\n4. \n5. interface Dependency {\n6. \tname: string;\n7. \tstatements: string[];\n8. \tsource: string;\n9. }\n10. \n11. const wrappers = { es, amd, cjs, iife, umd, eval: expr };\n12. \n13. export default function wrapModule(\n14. \tcode: string,\n15. \tformat: ModuleFormat,\n16. \tname: string,\n17. \toptions: CompileOptions,\n18. \tbanner: string,\n19. \tsharedPath: string,\n20. \thelpers: { name: string, alias: string }[],\n21. \timports: Node[],\n22. \tsource: string\n23. ): string {\n24. \tif (format === \'es\') return es(code, name, options, banner, sharedPath, helpers, imports, source);\n25. \n26. \tconst dependencies = imports.map((declaration, i) => {\n27. \t\tconst defaultImport = declaration.specifiers.find(\n28. \t\t\t(x: Node) =>\n29. \t\t\t\tx.type === \'ImportDefaultSpecifier\' ||\n30. \t\t\t\t(x.type === \'ImportSpecifier\' && x.imported.name === \'default\')\n31. \t\t);\n32. \n33. \t\tconst namespaceImport = declaration.specifiers.find(\n34. \t\t\t(x: Node) => x.type === \'ImportNamespaceSpecifier\'\n35. \t\t);\n36. \n37. \t\tconst namedImports = declaration.specifiers.filter(\n38. \t\t\t(x: Node) =>\n39. \t\t\t\tx.type === \'ImportSpecifier\' && x.imported.name !== \'default\'\n40. \t\t);\n41. \n42. \t\tconst name = defaultImport || namespaceImport\n43. \t\t\t? (defaultImport || namespaceImport).local.name\n44. \t\t\t: `__import${i}`;\n45. \n46. \t\tconst statements: string[] = [];\n47. \n48. \t\tnamedImports.forEach((specifier: Node) => {\n49. \t\t\tstatements.push(\n50. \t\t\t\t`var ${specifier.local.name} = ${name}.${specifier.imported.name};`\n51. \t\t\t);\n52. \t\t});\n53. \n54. \t\tif (defaultImport) {\n55. \t\t\tstatements.push(\n56. \t\t\t\t`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`\n57. \t\t\t);\n58. \t\t}\n59. \n60. \t\treturn { name, statements, source: declaration.source.value };\n61. \t});\n62. \n63. \tif (format === \'amd\') return amd(code, name, options, banner, dependencies);\n64. \tif (format === \'cjs\') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);\n65. \tif (format === \'iife\') return iife(code, name, options, banner, dependencies);\n66. \tif (format === \'umd\') return umd(code, name, options, banner, dependencies);\n67. \tif (format === \'eval\') return expr(code, name, options, banner, dependencies);\n68. \n69. \tthrow new Error(`options.format is invalid (must be ${list(Object.keys(wrappers))})`);\n70. }\n71. \n72. function es(\n73. \tcode: string,\n74. \tname: string,\n75. \toptions: CompileOptions,\n76. \tbanner: string,\n77. \tsharedPath: string,\n78. \thelpers: { name: string, alias: string }[],\n79. \timports: Node[],\n80. \tsource: string\n81. ) {\n82. \tconst importHelpers = helpers && (\n83. \t\t`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(\', \')} } from ${JSON.stringify(sharedPath)};`\n84. \t);\n85. \n86. \tconst importBlock = imports.length > 0 && (\n87. \t\timports\n88. \t\t\t.map((declaration: Node) => source.slice(declaration.start, declaration.end))\n89. \t\t\t.join(\'\\n\')\n90. \t);\n91. \n92. \treturn deindent`\n93. \t\t${banner}\n94. \t\t${importHelpers}\n95. \t\t${importBlock}\n96. \n97. \t\t${code}\n98. \t\texport default ${name};`;\n99. }\n100. \n101. function amd(\n102. \tcode: string,\n103. \tname: string,\n104. \toptions: CompileOptions,\n105. \tbanner: string,\n106. \tdependencies: Dependency[]\n107. ) {\n108. \tconst sourceString = dependencies.length\n109. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n110. \t\t: \'\';\n111. \n112. \tconst id = options.amd && options.amd.id;\n113. \n114. \treturn deindent`\n115. \t\tdefine(${id ? `"${id}", ` : \'\'}${sourceString}function(${paramString(dependencies)}) { "use strict";\n116. \t\t\t${getCompatibilityStatements(dependencies)}\n117. \n118. \t\t\t${code}\n119. \t\t\treturn ${name};\n120. \t\t});`;\n121. }\n122. \n123. function cjs(\n124. \tcode: string,\n125. \tname: string,\n126. \toptions: CompileOptions,\n127. \tbanner: string,\n128. \tsharedPath: string,\n129. \thelpers: { name: string, alias: string }[],\n130. \tdependencies: Dependency[]\n131. ) {\n132. \tconst SHARED = \'__shared\';\n133. \tconst helperBlock = helpers && (\n134. \t\t`var ${SHARED} = require(${JSON.stringify(sharedPath)});\\n` +\n135. \t\thelpers.map(helper => {\n136. \t\t\treturn `var ${helper.alias} = ${SHARED}.${helper.name};`;\n137. \t\t}).join(\'\\n\')\n138. \t);\n139. \n140. \tconst requireBlock = dependencies.length > 0 && (\n141. \t\tdependencies\n142. \t\t\t.map(d => `var ${d.name} = require("${d.source}");`)\n143. \t\t\t.join(\'\\n\\n\')\n144. \t);\n145. \n146. \treturn deindent`\n147. \t\t${banner}\n148. \t\t"use strict";\n149. \n150. \t\t${helperBlock}\n151. \t\t${requireBlock}\n152. \t\t${getCompatibilityStatements(dependencies)}\n153. \n154. \t\t${code}\n155. \n156. \t\tmodule.exports = ${name};`\n157. }\n158. \n159. function iife(\n160. \tcode: string,\n161. \tname: string,\n162. \toptions: CompileOptions,\n163. \tbanner: string,\n164. \tdependencies: Dependency[]\n165. ) {\n166. \tif (!options.name) {\n167. \t\tthrow new Error(`Missing required \'name\' option for IIFE export`);\n168. \t}\n169. \n170. \tconst globals = getGlobals(dependencies, options);\n171. \n172. \treturn deindent`\n173. \t\t${banner}\n174. \t\tvar ${options.name} = (function(${paramString(dependencies)}) { "use strict";\n175. \t\t\t${getCompatibilityStatements(dependencies)}\n176. \n177. \t\t\t${code}\n178. \t\t\treturn ${name};\n179. \t\t}(${globals.join(\', \')}));`;\n180. }\n181. \n182. function umd(\n183. \tcode: string,\n184. \tname: string,\n185. \toptions: CompileOptions,\n186. \tbanner: string,\n187. \tdependencies: Dependency[]\n188. ) {\n189. \tif (!options.name) {\n190. \t\tthrow new Error(`Missing required \'name\' option for UMD export`);\n191. \t}\n192. \n193. \tconst amdId = options.amd && options.amd.id ? `\'${options.amd.id}\', ` : \'\';\n194. \n195. \tconst amdDeps = dependencies.length\n196. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n197. \t\t: \'\';\n198. \n199. \tconst cjsDeps = dependencies\n200. \t\t.map(d => `require("${d.source}")`)\n201. \t\t.join(\', \');\n202. \n203. \tconst globals = getGlobals(dependencies, options);\n204. \n205. \treturn deindent`\n206. \t\t${banner}\n207. \t\t(function(global, factory) {\n208. \t\t\ttypeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :\n209. \t\t\ttypeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :\n210. \t\t\t(global.${options.name} = factory(${globals.join(\', \')}));\n211. \t\t}(this, (function (${paramString(dependencies)}) { "use strict";\n212. \n213. \t\t\t${getCompatibilityStatements(dependencies)}\n214. \n215. \t\t\t${code}\n216. \n217. \t\t\treturn ${name};\n218. \n219. \t\t})));`;\n220. }\n221. \n222. function expr(\n223. \tcode: string,\n224. \tname: string,\n225. \toptions: CompileOptions,\n226. \tbanner: string,\n227. \tdependencies: Dependency[]\n228. ) {\n229. \tconst globals = getGlobals(dependencies, options);\n230. \n231. \treturn deindent`\n232. \t\t(function (${paramString(dependencies)}) { "use strict";\n233. \t\t\t${banner}\n234. \n235. \t\t\t${getCompatibilityStatements(dependencies)}\n236. \n237. \t\t\t${code}\n238. \n239. \t\t\treturn ${name};\n240. \t\t}(${globals.join(\', \')}))`;\n241. }\n242. \n243. function paramString(dependencies: Dependency[]) {\n244. \treturn dependencies.map(dep => dep.name).join(\', \');\n245. }\n246. \n247. function removeExtension(file: string) {\n248. \tconst index = file.lastIndexOf(\'.\');\n249. \treturn ~index ? file.slice(0, index) : file;\n250. }\n251. \n252. function getCompatibilityStatements(dependencies: Dependency[]) {\n253. \tif (!dependencies.length) return null;\n254. \n255. \tconst statements: string[] = [];\n256. \n257. \tdependencies.forEach(dependency => {\n258. \t\tstatements.push(...dependency.statements);\n259. \t});\n260. \n261. \treturn statements.join(\'\\n\');\n262. }\n263. \n264. function getGlobals(dependencies: Dependency[], options: CompileOptions) {\n265. \tconst { globals, onerror, onwarn } = options;\n266. \tconst globalFn = getGlobalFn(globals);\n267. \n268. \treturn dependencies.map(d => {\n269. \t\tlet name = globalFn(d.source);\n270. \n271. \t\tif (!name) {\n272. \t\t\tif (d.name.startsWith(\'__import\')) {\n273. \t\t\t\tconst error = new Error(\n274. \t\t\t\t\t`Could not determine name for imported module \'${d.source}\' – use options.globals`\n275. \t\t\t\t);\n276. \t\t\t\tonerror(error);\n277. \t\t\t} else {\n278. \t\t\t\tconst warning = {\n279. \t\t\t\t\tmessage: `No name was supplied for imported module \'${d.source}\'. Guessing \'${d.name}\', but you should use options.globals`,\n280. \t\t\t\t};\n281. \n282. \t\t\t\tonwarn(warning);\n283. \t\t\t}\n284. \n285. \t\t\tname = d.name;\n286. \t\t}\n287. \n288. \t\treturn name;\n289. \t});\n290. }\n291. \n292. function getGlobalFn(globals: any): (id: string) => string {\n293. \tif (typeof globals === \'function\') return globals;\n294. \tif (typeof globals === \'object\') {\n295. \t\treturn id => globals[id];\n296. \t}\n297. \n298. \treturn () => undefined;\n299. }\n\n\nFile: src/interfaces.ts\nLine number range: 1 - 92\nContent:\n1. import {SourceMap} from \'magic-string\';\n2. \n3. export interface Node {\n4. \tstart: number;\n5. \tend: number;\n6. \ttype: string;\n7. \t[propName: string]: any;\n8. }\n9. \n10. export interface Parser {\n11. \treadonly template: string;\n12. \treadonly filename?: string;\n13. \n14. \tindex: number;\n15. \tstack: Array<Node>;\n16. \n17. \thtml: Node;\n18. \tcss: Node;\n19. \tjs: Node;\n20. \tmetaTags: {};\n21. }\n22. \n23. export interface Parsed {\n24. \thash: number;\n25. \thtml: Node;\n26. \tcss: Node;\n27. \tjs: Node;\n28. }\n29. \n30. export interface Warning {\n31. \tloc?: { line: number; column: number; pos?: number };\n32. \tpos?: number;\n33. \tmessage: string;\n34. \tfilename?: string;\n35. \tframe?: string;\n36. \ttoString: () => string;\n37. }\n38. \n39. export type ModuleFormat = \'es\' | \'amd\' | \'cjs\' | \'iife\' | \'umd\' | \'eval\';\n40. \n41. export interface CompileOptions {\n42. \tformat?: ModuleFormat;\n43. \tname?: string;\n44. \tfilename?: string;\n45. \tgenerate?: string;\n46. \tglobals?: ((id: string) => string) | object;\n47. \tamd?: {\n48. \t\tid?: string;\n49. \t};\n50. \n51. \toutputFilename?: string;\n52. \tcssOutputFilename?: string;\n53. \n54. \tdev?: boolean;\n55. \tshared?: boolean | string;\n56. \tcascade?: boolean;\n57. \thydratable?: boolean;\n58. \tlegacy?: boolean;\n59. \tcustomElement?: CustomElementOptions | true;\n60. \tcss?: boolean;\n61. \tstore?: boolean;\n62. \n63. \tonerror?: (error: Error) => void;\n64. \tonwarn?: (warning: Warning) => void;\n65. }\n66. \n67. export interface GenerateOptions {\n68. \tname: string;\n69. \tformat: ModuleFormat;\n70. \tbanner?: string;\n71. \tsharedPath?: string;\n72. \thelpers?: { name: string, alias: string }[];\n73. }\n74. \n75. export interface Visitor {\n76. \tenter: (node: Node) => void;\n77. \tleave?: (node: Node) => void;\n78. }\n79. \n80. export interface CustomElementOptions {\n81. \ttag?: string;\n82. \tprops?: string[];\n83. }\n84. \n85. export interface PreprocessOptions {\n86. \tmarkup?: (options: {content: string, filename: string}) => { code: string, map?: SourceMap | string };\n87. \tstyle?: Preprocessor;\n88. \tscript?: Preprocessor;\n89. \tfilename?: string\n90. }\n91. \n92. export type Preprocessor = (options: {content: string, attributes: Record<string, string | boolean>, filename?: string}) => { code: string, map?: SourceMap | string };\n\n\nFile: src/server-side-rendering/register.js\nLine number range: 1 - 46\nContent:\n1. import * as fs from \'fs\';\n2. import * as path from \'path\';\n3. import { compile } from \'../index.ts\';\n4. \n5. const compileOptions = {};\n6. \n7. function capitalise(name) {\n8. \treturn name[0].toUpperCase() + name.slice(1);\n9. }\n10. \n11. export default function register(options) {\n12. \tconst { extensions } = options;\n13. \n14. \tif (extensions) {\n15. \t\t_deregister(\'.html\');\n16. \t\textensions.forEach(_register);\n17. \t}\n18. \n19. \t// TODO make this the default and remove in v2\n20. \tif (\'store\' in options) compileOptions.store = options.store;\n21. }\n22. \n23. function _deregister(extension) {\n24. \tdelete require.extensions[extension];\n25. }\n26. \n27. function _register(extension) {\n28. \trequire.extensions[extension] = function(module, filename) {\n29. \t\tconst name = path.basename(filename)\n30. \t\t\t.slice(0, -path.extname(filename).length)\n31. \t\t\t.replace(/^\\d/, \'_$&\')\n32. \t\t\t.replace(/[^a-zA-Z0-9_$]/g, \'\');\n33. \n34. \t\tconst options = Object.assign({}, compileOptions, {\n35. \t\t\tfilename,\n36. \t\t\tname: capitalise(name),\n37. \t\t\tgenerate: \'ssr\'\n38. \t\t});\n39. \n40. \t\tconst {code} = compile(fs.readFileSync(filename, \'utf-8\'), options);\n41. \n42. \t\treturn module._compile(code, filename);\n43. \t};\n44. }\n45. \n46. _register(\'.html\');\n\n\nFile: store.js\nLine number range: 1 - 164\nContent:\n1. import {\n2. \tassign,\n3. \tblankObject,\n4. \tdiffers,\n5. \tdispatchObservers,\n6. \tget,\n7. \tobserve\n8. } from \'./shared.js\';\n9. \n10. function Store(state) {\n11. \tthis._observers = { pre: blankObject(), post: blankObject() };\n12. \tthis._changeHandlers = [];\n13. \tthis._dependents = [];\n14. \n15. \tthis._computed = blankObject();\n16. \tthis._sortedComputedProperties = [];\n17. \n18. \tthis._state = assign({}, state);\n19. }\n20. \n21. assign(Store.prototype, {\n22. \t_add: function(component, props) {\n23. \t\tthis._dependents.push({\n24. \t\t\tcomponent: component,\n25. \t\t\tprops: props\n26. \t\t});\n27. \t},\n28. \n29. \t_init: function(props) {\n30. \t\tvar state = {};\n31. \t\tfor (var i = 0; i < props.length; i += 1) {\n32. \t\t\tvar prop = props[i];\n33. \t\t\tstate[\'$\' + prop] = this._state[prop];\n34. \t\t}\n35. \t\treturn state;\n36. \t},\n37. \n38. \t_remove: function(component) {\n39. \t\tvar i = this._dependents.length;\n40. \t\twhile (i--) {\n41. \t\t\tif (this._dependents[i].component === component) {\n42. \t\t\t\tthis._dependents.splice(i, 1);\n43. \t\t\t\treturn;\n44. \t\t\t}\n45. \t\t}\n46. \t},\n47. \n48. \t_sortComputedProperties: function() {\n49. \t\tvar computed = this._computed;\n50. \t\tvar sorted = this._sortedComputedProperties = [];\n51. \t\tvar cycles;\n52. \t\tvar visited = blankObject();\n53. \n54. \t\tfunction visit(key) {\n55. \t\t\tif (cycles[key]) {\n56. \t\t\t\tthrow new Error(\'Cyclical dependency detected\');\n57. \t\t\t}\n58. \n59. \t\t\tif (visited[key]) return;\n60. \t\t\tvisited[key] = true;\n61. \n62. \t\t\tvar c = computed[key];\n63. \n64. \t\t\tif (c) {\n65. \t\t\t\tcycles[key] = true;\n66. \t\t\t\tc.deps.forEach(visit);\n67. \t\t\t\tsorted.push(c);\n68. \t\t\t}\n69. \t\t}\n70. \n71. \t\tfor (var key in this._computed) {\n72. \t\t\tcycles = blankObject();\n73. \t\t\tvisit(key);\n74. \t\t}\n75. \t},\n76. \n77. \tcompute: function(key, deps, fn) {\n78. \t\tvar store = this;\n79. \t\tvar value;\n80. \n81. \t\tvar c = {\n82. \t\t\tdeps: deps,\n83. \t\t\tupdate: function(state, changed, dirty) {\n84. \t\t\t\tvar values = deps.map(function(dep) {\n85. \t\t\t\t\tif (dep in changed) dirty = true;\n86. \t\t\t\t\treturn state[dep];\n87. \t\t\t\t});\n88. \n89. \t\t\t\tif (dirty) {\n90. \t\t\t\t\tvar newValue = fn.apply(null, values);\n91. \t\t\t\t\tif (differs(newValue, value)) {\n92. \t\t\t\t\t\tvalue = newValue;\n93. \t\t\t\t\t\tchanged[key] = true;\n94. \t\t\t\t\t\tstate[key] = value;\n95. \t\t\t\t\t}\n96. \t\t\t\t}\n97. \t\t\t}\n98. \t\t};\n99. \n100. \t\tc.update(this._state, {}, true);\n101. \n102. \t\tthis._computed[key] = c;\n103. \t\tthis._sortComputedProperties();\n104. \t},\n105. \n106. \tget: get,\n107. \n108. \tobserve: observe,\n109. \n110. \tonchange: function(callback) {\n111. \t\tthis._changeHandlers.push(callback);\n112. \t\treturn {\n113. \t\t\tcancel: function() {\n114. \t\t\t\tvar index = this._changeHandlers.indexOf(callback);\n115. \t\t\t\tif (~index) this._changeHandlers.splice(index, 1);\n116. \t\t\t}\n117. \t\t};\n118. \t},\n119. \n120. \tset: function(newState) {\n121. \t\tvar oldState = this._state,\n122. \t\t\tchanged = this._changed = {},\n123. \t\t\tdirty = false;\n124. \n125. \t\tfor (var key in newState) {\n126. \t\t\tif (this._computed[key]) throw new Error("\'" + key + "\' is a read-only property");\n127. \t\t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n128. \t\t}\n129. \t\tif (!dirty) return;\n130. \n131. \t\tthis._state = assign({}, oldState, newState);\n132. \n133. \t\tfor (var i = 0; i < this._sortedComputedProperties.length; i += 1) {\n134. \t\t\tthis._sortedComputedProperties[i].update(this._state, changed);\n135. \t\t}\n136. \n137. \t\tfor (var i = 0; i < this._changeHandlers.length; i += 1) {\n138. \t\t\tthis._changeHandlers[i](this._state, changed);\n139. \t\t}\n140. \n141. \t\tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n142. \n143. \t\tvar dependents = this._dependents.slice(); // guard against mutations\n144. \t\tfor (var i = 0; i < dependents.length; i += 1) {\n145. \t\t\tvar dependent = dependents[i];\n146. \t\t\tvar componentState = {};\n147. \t\t\tdirty = false;\n148. \n149. \t\t\tfor (var j = 0; j < dependent.props.length; j += 1) {\n150. \t\t\t\tvar prop = dependent.props[j];\n151. \t\t\t\tif (prop in changed) {\n152. \t\t\t\t\tcomponentState[\'$\' + prop] = this._state[prop];\n153. \t\t\t\t\tdirty = true;\n154. \t\t\t\t}\n155. \t\t\t}\n156. \n157. \t\t\tif (dirty) dependent.component.set(componentState);\n158. \t\t}\n159. \n160. \t\tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n161. \t}\n162. });\n163. \n164. export { Store };\n\n\nFile: test/server-side-rendering/index.js\nLine number range: 1 - 132\nContent:\n1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";\n12. \n13. function tryToReadFile(file) {\n14. \ttry {\n15. \t\treturn fs.readFileSync(file, "utf-8");\n16. \t} catch (err) {\n17. \t\tif (err.code !== "ENOENT") throw err;\n18. \t\treturn null;\n19. \t}\n20. }\n21. \n22. describe("ssr", () => {\n23. \tbefore(() => {\n24. \t\trequire("../../ssr/register")({\n25. \t\t\textensions: [\'.svelte\', \'.html\'],\n26. \t\t\tstore: true\n27. \t\t});\n28. \n29. \t\treturn setupHtmlEqual();\n30. \t});\n31. \n32. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n33. \t\tif (dir[0] === ".") return;\n34. \n35. \t\t// add .solo to a sample directory name to only run that test, or\n36. \t\t// .show to always show the output. or both\n37. \t\tconst solo = /\\.solo/.test(dir);\n38. \t\tconst show = /\\.show/.test(dir);\n39. \n40. \t\tif (solo && process.env.CI) {\n41. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n42. \t\t}\n43. \n44. \t\t(solo ? it.only : it)(dir, () => {\n45. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n46. \t\t\ttry {\n47. \t\t\t\tlet component;\n48. \n49. \t\t\t\tconst mainHtmlFile = `${dir}/main.html`;\n50. \t\t\t\tconst mainSvelteFile = `${dir}/main.svelte`;\n51. \t\t\t\tif (fs.existsSync(mainHtmlFile)) {\n52. \t\t\t\t\tcomponent = require(mainHtmlFile);\n53. \t\t\t\t} else if (fs.existsSync(mainSvelteFile)) {\n54. \t\t\t\t\tcomponent = require(mainSvelteFile);\n55. \t\t\t\t}\n56. \n57. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n58. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n59. \n60. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n61. \n62. \t\t\t\tconst rendered = component.render(data);\n63. \t\t\t\tconst { html, css, head } = rendered;\n64. \n65. \t\t\t\t// rendered.toString() === rendered.html\n66. \t\t\t\tassert.equal(rendered, html);\n67. \n68. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n69. \t\t\t\tif (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);\n70. \n71. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n72. \t\t\t\tassert.equal(\n73. \t\t\t\t\tcss.code.replace(/^\\s+/gm, ""),\n74. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n75. \t\t\t\t);\n76. \n77. \t\t\t\tif (fs.existsSync(`${dir}/_expected-head.html`)) {\n78. \t\t\t\t\tfs.writeFileSync(`${dir}/_actual-head.html`, head);\n79. \t\t\t\t\tassert.htmlEqual(\n80. \t\t\t\t\t\thead,\n81. \t\t\t\t\t\tfs.readFileSync(`${dir}/_expected-head.html`, \'utf-8\')\n82. \t\t\t\t\t);\n83. \t\t\t\t}\n84. \n85. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n86. \t\t\t} catch (err) {\n87. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n88. \t\t\t\tthrow err;\n89. \t\t\t}\n90. \t\t});\n91. \t});\n92. \n93. \t// duplicate client-side tests, as far as possible\n94. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n95. \t\tif (dir[0] === ".") return;\n96. \n97. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n98. \n99. \t\tif (config.solo && process.env.CI) {\n100. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n101. \t\t}\n102. \n103. \t\tif (config["skip-ssr"]) return;\n104. \n105. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n106. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n107. \n108. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n109. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n110. \t\t\t\tdelete require.cache[resolved];\n111. \t\t\t});\n112. \n113. \t\t\trequire("../../ssr/register")({\n114. \t\t\t\tstore: !!config.store\n115. \t\t\t});\n116. \n117. \t\t\ttry {\n118. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n119. \t\t\t\tconst { html } = component.render(config.data, {\n120. \t\t\t\t\tstore: (config.store !== true) && config.store\n121. \t\t\t\t});\n122. \n123. \t\t\t\tif (config.html) {\n124. \t\t\t\t\tassert.htmlEqual(html, config.html);\n125. \t\t\t\t}\n126. \t\t\t} catch (err) {\n127. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n128. \t\t\t\tthrow err;\n129. \t\t\t}\n130. \t\t});\n131. \t});\n132. });\n\n' additional_kwargs={} response_metadata={}
2025-11-12 14:02:24,510 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_analyzer_node - DEBUG - content="1) Issue Understanding\n\n- Reported symptom: When server-side rendering a parent component that includes a nested component which uses a store (via a “store” property on the nested component’s export), SSR fails with “Cannot read property '_init' of undefined”.\n- Unexpected behavior: Client-side navigation works, but SSR fails. The SSR-generated code calls the nested component’s _render directly and passes the parent’s options.store, which is undefined in this scenario. The nested component expects its store to be initialized and attempts to call options.store._init, causing the crash.\n\n\n2) Code Analysis\n\n- Involved files and functions:\n  - src/generators/server-side-rendering/index.ts\n    - Constructs the SSR output for a component, including the render and _render functions and initial state assembly.\n  - src/generators/server-side-rendering/visitors/Component.ts\n    - Generates the code used to render nested components within a parent’s SSR HTML, currently calling childComponent._render(__result, childState, { store: options.store }) if generator.options.store is set.\n  - store.js\n    - Defines the Store and its _init method, which assigns $-prefixed props based on the store state.\n  - src/server-side-rendering/register.js\n    - Passes compile options (including store: true) into the SSR generator.\n\n- What the problematic code currently does:\n  - In index.ts:\n    - In the top-level component’s render function, options.store is initialized from %store() only if that top-level component itself declares a store via templateProperties.store.\n    - The initialState assembly for a component relies on options.store._init when expectedProperties include $-prefixed store-derived props, gated by the condition (options.store || templateProperties.store).\n  - In visitors/Component.ts:\n    - Nested components are rendered by invoking child._render, not child.render. This bypasses the nested component’s render function, where options.store would normally be initialized from its own templateProperties.store.\n    - It forwards store: options.store from the parent if generator.options.store is true. If the parent doesn’t have a store and doesn’t pass one in render options, options.store is undefined.\n  - Result:\n    - When a nested component declares a store but the parent doesn’t, the nested component’s _render is called with options.store undefined. In index.ts, the nested component’s _render builds initialState using options.store._init([...]), leading to the error.\n\n\n3) Root Cause\n\n- SSR for nested components bypasses the nested component’s render function, which is where options.store is set to %store() when the component declares a store.\n- The nested component’s _render function (generated by index.ts) assumes options.store exists and uses options.store._init, but there’s no initialization of options.store in _render itself.\n- Specific lines contributing to the issue:\n  - src/generators/server-side-rendering/visitors/Component.ts: It generates nested calls as child._render(__result, props, { store: options.store }), which passes through undefined if the parent had no store.\n  - src/generators/server-side-rendering/index.ts:\n    - Lines ~75–87: storeProps detection and initialState push referencing options.store._init.\n    - Lines ~116–119: options.store is only initialized in the top-level render when templateProperties.store is present. There’s no equivalent initialization in _render.\n  - Therefore, nested components that declare their own store crash during SSR because their _render expects options.store to be defined, but it isn’t when called directly.\n\n\n4) Fix Suggestion\n\nChange 1:\n- File: src/generators/server-side-rendering/index.ts\n- Function/code block: Generation of the component’s _render function (the body starting around the definition of name._render).\n- What to change:\n  - Insert a line at the start of the generated _render function that initializes options.store when this component declares a store. Specifically, if templateProperties.store is present for the component being generated, set options.store to options.store || %store() before any initialState assembly that references options.store._init.\n  - Adjust the initialState assembly to rely on options.store being defined at this point. If you currently guard pushing options.store._init with (options.store || templateProperties.store), simplify to conditioning on storeProps.length > 0 and then push options.store._init, knowing options.store has been initialized.\n- Why this fixes the issue:\n  - Nested components are invoked via _render and do not pass through render, which is where store initialization presently occurs. By initializing options.store inside _render when the component declares a store, nested SSR calls will have a valid options.store available for the storeProps initialization. This preserves CSS aggregation semantics (via __result.addComponent) and avoids changing nested call semantics.\n\nChange 2 (optional hardening):\n- File: src/generators/server-side-rendering/visitors/Component.ts\n- Function/code block: visitComponent, specifically the logic that decides to push “store: options.store” into the options passed to nested _render.\n- What to change:\n  - Either leave as-is and rely on Change 1’s fallback initialization in the child’s _render, or restrict adding “store: options.store” only when a store is actually present at runtime. Since compile-time cannot know runtime availability, the safer route is to keep passing options.store when generator.options.store is enabled and rely on Change 1 to handle undefined by initializing in the child’s _render.\n- Why this helps:\n  - This avoids future regressions where an undefined options.store is propagated down; with the child’s _render self-initialization, undefined is harmless and becomes a valid store instance for that component.\n\nTesting considerations:\n- Add/adjust SSR tests to include a parent without a store and a nested child that declares a store. Confirm SSR no longer throws and the expected output reflects store-derived props (e.g., $hasTwoFactor) correctly.\n- Verify CSS aggregation still works: child._render continues to call __result.addComponent, so the parent’s CSS collection remains intact.\n\nSummary:\n- Initialize options.store in each component’s _render when that component declares a store, not only in render. This ensures nested SSR render paths have a valid store, resolving “Cannot read property '_init' of undefined” without changing how nested components are invoked or how CSS is aggregated." additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 6193, 'prompt_tokens': 17936, 'total_tokens': 24129, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 4864, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--94c936db-beb7-4606-9e2c-c3a57df6794c-0' usage_metadata={'input_tokens': 17936, 'output_tokens': 6193, 'total_tokens': 24129, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 4864}}
2025-11-12 14:02:24,516 - thread-135845298308800.prometheus.lang_graph.nodes.edit_message_node - DEBUG - Sending message to EditNode:
content='--- BEGIN ISSUE INFO ---\nIssue title:\ncan\'t supply store to nested components server side\n\nIssue description: \nHey, I\'m trying to pass a store to a nested component which works well ordinarily, but it fails when server rendering it.\n\nE.g. I have a manage account page like so:\n```html\n<div class="page">\n    <h1>Manage Account</h1>\n\n    <div>\n        <h3>Two Factor Auth</h3>\n        <TwoFactorAuth />\n    </div>\n</div>\n\n<style>\n    .page {\n        width: 400px;\n        margin: 50px auto;\n    }\n</style>\n\n<script>\n    import TwoFactorAuth from \'./_components/TwoFactorAuth\';\n\n    export default {\n        components: {\n            TwoFactorAuth,\n        },\n    }\n</script>\n```\n\nAnd in the TwoFactorAuth component, using a store via [svelte-redux](https://github.com/UnwrittenFun/svelte-redux)\n```html\n{{#if $hasTwoFactor}}\n<div>yay its enabled</div>\n{{else}}\n<div>oh no its not enabled</div>\n{{/if}}\n\n<script>\n    import { connect } from \'../../_redux\';\n\n    export default {\n        store: connect(state => ({\n            hasTwoFactor: state.user && state.user.hasTwoFactor,\n        })),\n    }\n</script>\n```\n\nAs mentioned this fails on the server side, but not when navigation to the page on the client side.\n\nI dug into the generated code a bit and I see it generates the template like so:\n```js\nreturn `<div class="page" svelte-1782208320>\n    <h1>Manage Account</h1>\n\n    <div>\n        <h3>Two Factor Auth</h3>\n        ${__WEBPACK_IMPORTED_MODULE_0__components_TwoFactorAuth__["a" /* default */]._render(__result, {}, { store: options.store })}\n    </div>\n</div>`\n```\n\nThis is bypassing `render` where the store would be initialised ordinarily, and is instead just passing the parent store.\n\nIt errors on the following line in the TwoFactorAuth\'s `_render` method, as the store is undefined\n```js\nstate = Object.assign(options.store._init(["hasTwoFactor"]), state);\n```\n```\nCannot read property \'_init\' of undefined\n```\n\nIssue comments:\n\n--- END ISSUE INFO ---\n\nContext Found:\n--- BEGIN CONTEXT ---\nFile: src/generators/nodes/Component.ts\nLine number range: 1 - 609\nContent:\n1. import deindent from \'../../utils/deindent\';\n2. import { stringify } from \'../../utils/stringify\';\n3. import stringifyProps from \'../../utils/stringifyProps\';\n4. import CodeBuilder from \'../../utils/CodeBuilder\';\n5. import getTailSnippet from \'../../utils/getTailSnippet\';\n6. import getObject from \'../../utils/getObject\';\n7. import getExpressionPrecedence from \'../../utils/getExpressionPrecedence\';\n8. import Node from \'./shared/Node\';\n9. import Block from \'../dom/Block\';\n10. import Attribute from \'./Attribute\';\n11. \n12. export default class Component extends Node {\n13. \ttype: \'Component\';\n14. \tname: string;\n15. \tattributes: Attribute[];\n16. \tchildren: Node[];\n17. \n18. \tinit(\n19. \t\tblock: Block,\n20. \t\tstripWhitespace: boolean,\n21. \t\tnextSibling: Node\n22. \t) {\n23. \t\tthis.cannotUseInnerHTML();\n24. \n25. \t\tthis.attributes.forEach((attribute: Node) => {\n26. \t\t\tif (attribute.type === \'Attribute\' && attribute.value !== true) {\n27. \t\t\t\tattribute.value.forEach((chunk: Node) => {\n28. \t\t\t\t\tif (chunk.type !== \'Text\') {\n29. \t\t\t\t\t\tconst dependencies = chunk.metadata.dependencies;\n30. \t\t\t\t\t\tblock.addDependencies(dependencies);\n31. \t\t\t\t\t}\n32. \t\t\t\t});\n33. \t\t\t} else {\n34. \t\t\t\tif (attribute.type === \'EventHandler\' && attribute.expression) {\n35. \t\t\t\t\tattribute.expression.arguments.forEach((arg: Node) => {\n36. \t\t\t\t\t\tblock.addDependencies(arg.metadata.dependencies);\n37. \t\t\t\t\t});\n38. \t\t\t\t} else if (attribute.type === \'Binding\') {\n39. \t\t\t\t\tblock.addDependencies(attribute.metadata.dependencies);\n40. \t\t\t\t}\n41. \t\t\t}\n42. \t\t});\n43. \n44. \t\tthis.var = block.getUniqueName(\n45. \t\t\t(\n46. \t\t\t\tthis.name === \':Self\' ? this.generator.name :\n47. \t\t\t\tthis.name === \':Component\' ? \'switch_instance\' :\n48. \t\t\t\tthis.name\n49. \t\t\t).toLowerCase()\n50. \t\t);\n51. \n52. \t\tif (this.children.length) {\n53. \t\t\tthis._slots = new Set([\'default\']);\n54. \n55. \t\t\tthis.children.forEach(child => {\n56. \t\t\t\tchild.init(block, stripWhitespace, nextSibling);\n57. \t\t\t});\n58. \t\t}\n59. \t}\n60. \n61. \tbuild(\n62. \t\tblock: Block,\n63. \t\tparentNode: string,\n64. \t\tparentNodes: string\n65. \t) {\n66. \t\tconst { generator } = this;\n67. \t\tgenerator.hasComponents = true;\n68. \n69. \t\tconst name = this.var;\n70. \n71. \t\tconst componentInitProperties = [`root: #component.root`];\n72. \n73. \t\tif (this.children.length > 0) {\n74. \t\t\tconst slots = Array.from(this._slots).map(name => `${name}: @createFragment()`);\n75. \t\t\tcomponentInitProperties.push(`slots: { ${slots.join(\', \')} }`);\n76. \n77. \t\t\tthis.children.forEach((child: Node) => {\n78. \t\t\t\tchild.build(block, `${this.var}._slotted.default`, \'nodes\');\n79. \t\t\t});\n80. \t\t}\n81. \n82. \t\tconst allContexts = new Set();\n83. \t\tconst statements: string[] = [];\n84. \t\tconst name_context = block.getUniqueName(`${name}_context`);\n85. \n86. \t\tlet name_updating: string;\n87. \t\tlet name_initial_data: string;\n88. \t\tlet beforecreate: string = null;\n89. \n90. \t\tconst attributes = this.attributes\n91. \t\t\t.filter(a => a.type === \'Attribute\')\n92. \t\t\t.map(a => mungeAttribute(a, block));\n93. \n94. \t\tconst bindings = this.attributes\n95. \t\t\t.filter(a => a.type === \'Binding\')\n96. \t\t\t.map(a => mungeBinding(a, block));\n97. \n98. \t\tconst eventHandlers = this.attributes\n99. \t\t\t.filter((a: Node) => a.type === \'EventHandler\')\n100. \t\t\t.map(a => mungeEventHandler(generator, this, a, block, name_context, allContexts));\n101. \n102. \t\tconst ref = this.attributes.find((a: Node) => a.type === \'Ref\');\n103. \t\tif (ref) generator.usesRefs = true;\n104. \n105. \t\tconst updates: string[] = [];\n106. \n107. \t\tif (attributes.length || bindings.length) {\n108. \t\t\tconst initialProps = attributes\n109. \t\t\t\t.map((attribute: Attribute) => `${attribute.name}: ${attribute.value}`);\n110. \n111. \t\t\tconst initialPropString = stringifyProps(initialProps);\n112. \n113. \t\t\tattributes\n114. \t\t\t\t.filter((attribute: Attribute) => attribute.dynamic)\n115. \t\t\t\t.forEach((attribute: Attribute) => {\n116. \t\t\t\t\tif (attribute.dependencies.length) {\n117. \t\t\t\t\t\tupdates.push(deindent`\n118. \t\t\t\t\t\t\tif (${attribute.dependencies\n119. \t\t\t\t\t\t\t\t.map(dependency => `changed.${dependency}`)\n120. \t\t\t\t\t\t\t\t.join(\' || \')}) ${name}_changes.${attribute.name} = ${attribute.value};\n121. \t\t\t\t\t\t`);\n122. \t\t\t\t\t}\n123. \n124. \t\t\t\t\telse {\n125. \t\t\t\t\t\t// TODO this is an odd situation to encounter – I *think* it should only happen with\n126. \t\t\t\t\t\t// each block indices, in which case it may be possible to optimise this\n127. \t\t\t\t\t\tupdates.push(`${name}_changes.${attribute.name} = ${attribute.value};`);\n128. \t\t\t\t\t}\n129. \t\t\t\t});\n130. \n131. \t\t\tif (bindings.length) {\n132. \t\t\t\tgenerator.hasComplexBindings = true;\n133. \n134. \t\t\t\tname_updating = block.alias(`${name}_updating`);\n135. \t\t\t\tname_initial_data = block.getUniqueName(`${name}_initial_data`);\n136. \n137. \t\t\t\tblock.addVariable(name_updating, \'{}\');\n138. \t\t\t\tstatements.push(`var ${name_initial_data} = ${initialPropString};`);\n139. \n140. \t\t\t\tconst setParentFromChildOnChange = new CodeBuilder();\n141. \t\t\t\tconst setParentFromChildOnInit = new CodeBuilder();\n142. \n143. \t\t\t\tbindings.forEach((binding: Binding) => {\n144. \t\t\t\t\tlet setParentFromChild;\n145. \n146. \t\t\t\t\tbinding.contexts.forEach(context => {\n147. \t\t\t\t\t\tallContexts.add(context);\n148. \t\t\t\t\t});\n149. \n150. \t\t\t\t\tconst { name: key } = getObject(binding.value);\n151. \n152. \t\t\t\t\tif (block.contexts.has(key)) {\n153. \t\t\t\t\t\tconst prop = binding.dependencies[0];\n154. \t\t\t\t\t\tconst computed = isComputed(binding.value);\n155. \t\t\t\t\t\tconst tail = binding.value.type === \'MemberExpression\' ? getTailSnippet(binding.value) : \'\';\n156. \n157. \t\t\t\t\t\tsetParentFromChild = deindent`\n158. \t\t\t\t\t\t\tvar list = ${name_context}.${block.listNames.get(key)};\n159. \t\t\t\t\t\t\tvar index = ${name_context}.${block.indexNames.get(key)};\n160. \t\t\t\t\t\t\tlist[index]${tail} = childState.${binding.name};\n161. \n162. \t\t\t\t\t\t\t${binding.dependencies\n163. \t\t\t\t\t\t\t\t.map((prop: string) => `newState.${prop} = state.${prop};`)\n164. \t\t\t\t\t\t\t\t.join(\'\\n\')}\n165. \t\t\t\t\t\t`;\n166. \t\t\t\t\t}\n167. \n168. \t\t\t\t\telse if (binding.value.type === \'MemberExpression\') {\n169. \t\t\t\t\t\tsetParentFromChild = deindent`\n170. \t\t\t\t\t\t\t${binding.snippet} = childState.${binding.name};\n171. \t\t\t\t\t\t\t${binding.dependencies.map((prop: string) => `newState.${prop} = state.${prop};`).join(\'\\n\')}\n172. \t\t\t\t\t\t`;\n173. \t\t\t\t\t}\n174. \n175. \t\t\t\t\telse {\n176. \t\t\t\t\t\tsetParentFromChild = `newState.${binding.value.name} = childState.${binding.name};`;\n177. \t\t\t\t\t}\n178. \n179. \t\t\t\t\tstatements.push(deindent`\n180. \t\t\t\t\t\tif (${binding.prop} in ${binding.obj}) {\n181. \t\t\t\t\t\t\t${name_initial_data}.${binding.name} = ${binding.snippet};\n182. \t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n183. \t\t\t\t\t\t}`\n184. \t\t\t\t\t);\n185. \n186. \t\t\t\t\tsetParentFromChildOnChange.addConditional(\n187. \t\t\t\t\t\t`!${name_updating}.${binding.name} && changed.${binding.name}`,\n188. \t\t\t\t\t\tsetParentFromChild\n189. \t\t\t\t\t);\n190. \n191. \t\t\t\t\tsetParentFromChildOnInit.addConditional(\n192. \t\t\t\t\t\t`!${name_updating}.${binding.name}`,\n193. \t\t\t\t\t\tsetParentFromChild\n194. \t\t\t\t\t);\n195. \n196. \t\t\t\t\t// TODO could binding.dependencies.length ever be 0?\n197. \t\t\t\t\tif (binding.dependencies.length) {\n198. \t\t\t\t\t\tupdates.push(deindent`\n199. \t\t\t\t\t\t\tif (!${name_updating}.${binding.name} && ${binding.dependencies.map((dependency: string) => `changed.${dependency}`).join(\' || \')}) {\n200. \t\t\t\t\t\t\t\t${name}_changes.${binding.name} = ${binding.snippet};\n201. \t\t\t\t\t\t\t\t${name_updating}.${binding.name} = true;\n202. \t\t\t\t\t\t\t}\n203. \t\t\t\t\t\t`);\n204. \t\t\t\t\t}\n205. \t\t\t\t});\n206. \n207. \t\t\t\tcomponentInitProperties.push(`data: ${name_initial_data}`);\n208. \n209. \t\t\t\tcomponentInitProperties.push(deindent`\n210. \t\t\t\t\t_bind: function(changed, childState) {\n211. \t\t\t\t\t\tvar state = #component.get(), newState = {};\n212. \t\t\t\t\t\t${setParentFromChildOnChange}\n213. \t\t\t\t\t\t${name_updating} = @assign({}, changed);\n214. \t\t\t\t\t\t#component._set(newState);\n215. \t\t\t\t\t\t${name_updating} = {};\n216. \t\t\t\t\t}\n217. \t\t\t\t`);\n218. \n219. \t\t\t\tbeforecreate = deindent`\n220. \t\t\t\t\t#component.root._beforecreate.push(function() {\n221. \t\t\t\t\t\tvar state = #component.get(), childState = ${name}.get(), newState = {};\n222. \t\t\t\t\t\tif (!childState) return;\n223. \t\t\t\t\t\t${setParentFromChildOnInit}\n224. \t\t\t\t\t\t${name_updating} = { ${bindings.map((binding: Binding) => `${binding.name}: true`).join(\', \')} };\n225. \t\t\t\t\t\t#component._set(newState);\n226. \t\t\t\t\t\t${name_updating} = {};\n227. \t\t\t\t\t});\n228. \t\t\t\t`;\n229. \t\t\t} else if (initialProps.length) {\n230. \t\t\t\tcomponentInitProperties.push(`data: ${initialPropString}`);\n231. \t\t\t}\n232. \t\t}\n233. \n234. \t\tconst isDynamicComponent = this.name === \':Component\';\n235. \n236. \t\tconst switch_vars = isDynamicComponent && {\n237. \t\t\tvalue: block.getUniqueName(\'switch_value\'),\n238. \t\t\tprops: block.getUniqueName(\'switch_props\')\n239. \t\t};\n240. \n241. \t\tconst expression = (\n242. \t\t\tthis.name === \':Self\' ? generator.name :\n243. \t\t\tisDynamicComponent ? switch_vars.value :\n244. \t\t\t`%components-${this.name}`\n245. \t\t);\n246. \n247. \t\tif (isDynamicComponent) {\n248. \t\t\tblock.contextualise(this.expression);\n249. \t\t\tconst { dependencies, snippet } = this.metadata;\n250. \n251. \t\t\tconst anchor = this.getOrCreateAnchor(block, parentNode, parentNodes);\n252. \n253. \t\t\tconst params = block.params.join(\', \');\n254. \n255. \t\t\tblock.builders.init.addBlock(deindent`\n256. \t\t\t\tvar ${switch_vars.value} = ${snippet};\n257. \n258. \t\t\t\tfunction ${switch_vars.props}(${params}) {\n259. \t\t\t\t\t${statements.length > 0 && statements.join(\'\\n\')}\n260. \t\t\t\t\treturn {\n261. \t\t\t\t\t\t${componentInitProperties.join(\',\\n\')}\n262. \t\t\t\t\t};\n263. \t\t\t\t}\n264. \n265. \t\t\t\tif (${switch_vars.value}) {\n266. \t\t\t\t\tvar ${name} = new ${expression}(${switch_vars.props}(${params}));\n267. \n268. \t\t\t\t\t${beforecreate}\n269. \t\t\t\t}\n270. \n271. \t\t\t\t${eventHandlers.map(handler => deindent`\n272. \t\t\t\t\tfunction ${handler.var}(event) {\n273. \t\t\t\t\t\t${handler.body}\n274. \t\t\t\t\t}\n275. \n276. \t\t\t\t\tif (${name}) ${name}.on("${handler.name}", ${handler.var});\n277. \t\t\t\t`)}\n278. \t\t\t`);\n279. \n280. \t\t\tblock.builders.create.addLine(\n281. \t\t\t\t`if (${name}) ${name}._fragment.c();`\n282. \t\t\t);\n283. \n284. \t\t\tif (parentNodes) {\n285. \t\t\t\tblock.builders.claim.addLine(\n286. \t\t\t\t\t`if (${name}) ${name}._fragment.l(${parentNodes});`\n287. \t\t\t\t);\n288. \t\t\t}\n289. \n290. \t\t\tblock.builders.mount.addLine(\n291. \t\t\t\t`if (${name}) ${name}._mount(${parentNode || \'#target\'}, ${parentNode ? \'null\' : \'anchor\'});`\n292. \t\t\t);\n293. \n294. \t\t\tconst updateMountNode = this.getUpdateMountNode(anchor);\n295. \n296. \t\t\tblock.builders.update.addBlock(deindent`\n297. \t\t\t\tif (${switch_vars.value} !== (${switch_vars.value} = ${snippet})) {\n298. \t\t\t\t\tif (${name}) ${name}.destroy();\n299. \n300. \t\t\t\t\tif (${switch_vars.value}) {\n301. \t\t\t\t\t\t${name} = new ${switch_vars.value}(${switch_vars.props}(${params}));\n302. \t\t\t\t\t\t${name}._fragment.c();\n303. \n304. \t\t\t\t\t\t${this.children.map(child => remount(generator, child, name))}\n305. \t\t\t\t\t\t${name}._mount(${updateMountNode}, ${anchor});\n306. \n307. \t\t\t\t\t\t${eventHandlers.map(handler => deindent`\n308. \t\t\t\t\t\t\t${name}.on("${handler.name}", ${handler.var});\n309. \t\t\t\t\t\t`)}\n310. \n311. \t\t\t\t\t\t${ref && `#component.refs.${ref.name} = ${name};`}\n312. \t\t\t\t\t}\n313. \n314. \t\t\t\t\t${ref && deindent`\n315. \t\t\t\t\t\telse if (#component.refs.${ref.name} === ${name}) {\n316. \t\t\t\t\t\t\t#component.refs.${ref.name} = null;\n317. \t\t\t\t\t\t}`}\n318. \t\t\t\t}\n319. \t\t\t`);\n320. \n321. \t\t\tif (updates.length) {\n322. \t\t\t\tblock.builders.update.addBlock(deindent`\n323. \t\t\t\t\telse {\n324. \t\t\t\t\t\tvar ${name}_changes = {};\n325. \t\t\t\t\t\t${updates.join(\'\\n\')}\n326. \t\t\t\t\t\t${name}._set(${name}_changes);\n327. \t\t\t\t\t\t${bindings.length && `${name_updating} = {};`}\n328. \t\t\t\t\t}\n329. \t\t\t\t`);\n330. \t\t\t}\n331. \n332. \t\t\tif (!parentNode) block.builders.unmount.addLine(`if (${name}) ${name}._unmount();`);\n333. \n334. \t\t\tblock.builders.destroy.addLine(`if (${name}) ${name}.destroy(false);`);\n335. \t\t} else {\n336. \t\t\tblock.builders.init.addBlock(deindent`\n337. \t\t\t\t${statements.join(\'\\n\')}\n338. \t\t\t\tvar ${name} = new ${expression}({\n339. \t\t\t\t\t${componentInitProperties.join(\',\\n\')}\n340. \t\t\t\t});\n341. \n342. \t\t\t\t${beforecreate}\n343. \n344. \t\t\t\t${eventHandlers.map(handler => deindent`\n345. \t\t\t\t\t${name}.on("${handler.name}", function(event) {\n346. \t\t\t\t\t\t${handler.body}\n347. \t\t\t\t\t});\n348. \t\t\t\t`)}\n349. \n350. \t\t\t\t${ref && `#component.refs.${ref.name} = ${name};`}\n351. \t\t\t`);\n352. \n353. \t\t\tblock.builders.create.addLine(`${name}._fragment.c();`);\n354. \n355. \t\t\tif (parentNodes) {\n356. \t\t\t\tblock.builders.claim.addLine(\n357. \t\t\t\t\t`${name}._fragment.l(${parentNodes});`\n358. \t\t\t\t);\n359. \t\t\t}\n360. \n361. \t\t\tblock.builders.mount.addLine(\n362. \t\t\t\t`${name}._mount(${parentNode || \'#target\'}, ${parentNode ? \'null\' : \'anchor\'});`\n363. \t\t\t);\n364. \n365. \t\t\tif (updates.length) {\n366. \t\t\t\tblock.builders.update.addBlock(deindent`\n367. \t\t\t\t\tvar ${name}_changes = {};\n368. \t\t\t\t\t${updates.join(\'\\n\')}\n369. \t\t\t\t\t${name}._set(${name}_changes);\n370. \t\t\t\t\t${bindings.length && `${name_updating} = {};`}\n371. \t\t\t\t`);\n372. \t\t\t}\n373. \n374. \t\t\tif (!parentNode) block.builders.unmount.addLine(`${name}._unmount();`);\n375. \n376. \t\t\tblock.builders.destroy.addLine(deindent`\n377. \t\t\t\t${name}.destroy(false);\n378. \t\t\t\t${ref && `if (#component.refs.${ref.name} === ${name}) #component.refs.${ref.name} = null;`}\n379. \t\t\t`);\n380. \t\t}\n381. \n382. \t\t// maintain component context\n383. \t\tif (allContexts.size) {\n384. \t\t\tconst contexts = Array.from(allContexts);\n385. \n386. \t\t\tconst initialProps = contexts\n387. \t\t\t\t.map(contextName => {\n388. \t\t\t\t\tif (contextName === \'state\') return `state: state`;\n389. \n390. \t\t\t\t\tconst listName = block.listNames.get(contextName);\n391. \t\t\t\t\tconst indexName = block.indexNames.get(contextName);\n392. \n393. \t\t\t\t\treturn `${listName}: ${listName},\\n${indexName}: ${indexName}`;\n394. \t\t\t\t})\n395. \t\t\t\t.join(\',\\n\');\n396. \n397. \t\t\tconst updates = contexts\n398. \t\t\t\t.map(contextName => {\n399. \t\t\t\t\tif (contextName === \'state\') return `${name_context}.state = state;`;\n400. \n401. \t\t\t\t\tconst listName = block.listNames.get(contextName);\n402. \t\t\t\t\tconst indexName = block.indexNames.get(contextName);\n403. \n404. \t\t\t\t\treturn `${name_context}.${listName} = ${listName};\\n${name_context}.${indexName} = ${indexName};`;\n405. \t\t\t\t})\n406. \t\t\t\t.join(\'\\n\');\n407. \n408. \t\t\tblock.builders.init.addBlock(deindent`\n409. \t\t\t\tvar ${name_context} = {\n410. \t\t\t\t\t${initialProps}\n411. \t\t\t\t};\n412. \t\t\t`);\n413. \n414. \t\t\tblock.builders.update.addBlock(updates);\n415. \t\t}\n416. \t}\n417. }\n418. \n419. function mungeAttribute(attribute: Node, block: Block): Attribute {\n420. \tif (attribute.value === true) {\n421. \t\t// attributes without values, e.g. <textarea readonly>\n422. \t\treturn {\n423. \t\t\tname: attribute.name,\n424. \t\t\tvalue: true,\n425. \t\t\tdynamic: false\n426. \t\t};\n427. \t}\n428. \n429. \tif (attribute.value.length === 0) {\n430. \t\treturn {\n431. \t\t\tname: attribute.name,\n432. \t\t\tvalue: `\'\'`,\n433. \t\t\tdynamic: false\n434. \t\t};\n435. \t}\n436. \n437. \tif (attribute.value.length === 1) {\n438. \t\tconst value = attribute.value[0];\n439. \n440. \t\tif (value.type === \'Text\') {\n441. \t\t\t// static attributes\n442. \t\t\treturn {\n443. \t\t\t\tname: attribute.name,\n444. \t\t\t\tvalue: isNaN(value.data) ? stringify(value.data) : value.data,\n445. \t\t\t\tdynamic: false\n446. \t\t\t};\n447. \t\t}\n448. \n449. \t\t// simple dynamic attributes\n450. \t\tblock.contextualise(value.expression); // TODO remove\n451. \t\tconst { dependencies, snippet } = value.metadata;\n452. \n453. \t\t// TODO only update attributes that have changed\n454. \t\treturn {\n455. \t\t\tname: attribute.name,\n456. \t\t\tvalue: snippet,\n457. \t\t\tdependencies,\n458. \t\t\tdynamic: true\n459. \t\t};\n460. \t}\n461. \n462. \t// otherwise we\'re dealing with a complex dynamic attribute\n463. \tconst allDependencies = new Set();\n464. \n465. \tconst value =\n466. \t\t(attribute.value[0].type === \'Text\' ? \'\' : `"" + `) +\n467. \t\tattribute.value\n468. \t\t\t.map((chunk: Node) => {\n469. \t\t\t\tif (chunk.type === \'Text\') {\n470. \t\t\t\t\treturn stringify(chunk.data);\n471. \t\t\t\t} else {\n472. \t\t\t\t\tblock.contextualise(chunk.expression); // TODO remove\n473. \t\t\t\t\tconst { dependencies, snippet } = chunk.metadata;\n474. \n475. \t\t\t\t\tdependencies.forEach((dependency: string) => {\n476. \t\t\t\t\t\tallDependencies.add(dependency);\n477. \t\t\t\t\t});\n478. \n479. \t\t\t\t\treturn getExpressionPrecedence(chunk.expression) <= 13 ? `(${snippet})` : snippet;\n480. \t\t\t\t}\n481. \t\t\t})\n482. \t\t\t.join(\' + \');\n483. \n484. \treturn {\n485. \t\tname: attribute.name,\n486. \t\tvalue,\n487. \t\tdependencies: Array.from(allDependencies),\n488. \t\tdynamic: true\n489. \t};\n490. }\n491. \n492. function mungeBinding(binding: Node, block: Block): Binding {\n493. \tconst { name } = getObject(binding.value);\n494. \tconst { contexts } = block.contextualise(binding.value);\n495. \tconst { dependencies, snippet } = binding.metadata;\n496. \n497. \tconst contextual = block.contexts.has(name);\n498. \n499. \tlet obj;\n500. \tlet prop;\n501. \n502. \tif (contextual) {\n503. \t\tobj = block.listNames.get(name);\n504. \t\tprop = block.indexNames.get(name);\n505. \t} else if (binding.value.type === \'MemberExpression\') {\n506. \t\tprop = `[✂${binding.value.property.start}-${binding.value.property.end}✂]`;\n507. \t\tif (!binding.value.computed) prop = `\'${prop}\'`;\n508. \t\tobj = `[✂${binding.value.object.start}-${binding.value.object.end}✂]`;\n509. \t} else {\n510. \t\tobj = \'state\';\n511. \t\tprop = `\'${name}\'`;\n512. \t}\n513. \n514. \treturn {\n515. \t\tname: binding.name,\n516. \t\tvalue: binding.value,\n517. \t\tcontexts,\n518. \t\tsnippet,\n519. \t\tobj,\n520. \t\tprop,\n521. \t\tdependencies\n522. \t};\n523. }\n524. \n525. function mungeEventHandler(generator: DomGenerator, node: Node, handler: Node, block: Block, name_context: string, allContexts: Set<string>) {\n526. \tlet body;\n527. \n528. \tif (handler.expression) {\n529. \t\tgenerator.addSourcemapLocations(handler.expression);\n530. \t\tgenerator.code.prependRight(\n531. \t\t\thandler.expression.start,\n532. \t\t\t`${block.alias(\'component\')}.`\n533. \t\t);\n534. \n535. \t\tconst usedContexts: string[] = [];\n536. \n537. \t\thandler.expression.arguments.forEach((arg: Node) => {\n538. \t\t\tconst { contexts } = block.contextualise(arg, null, true);\n539. \n540. \t\t\tcontexts.forEach(context => {\n541. \t\t\t\tif (!~usedContexts.indexOf(context)) usedContexts.push(context);\n542. \t\t\t\tallContexts.add(context);\n543. \t\t\t});\n544. \t\t});\n545. \n546. \t\t// TODO hoist event handlers? can do `this.__component.method(...)`\n547. \t\tconst declarations = usedContexts.map(name => {\n548. \t\t\tif (name === \'state\') return `var state = ${name_context}.state;`;\n549. \n550. \t\t\tconst listName = block.listNames.get(name);\n551. \t\t\tconst indexName = block.indexNames.get(name);\n552. \n553. \t\t\treturn `var ${listName} = ${name_context}.${listName}, ${indexName} = ${name_context}.${indexName}, ${name} = ${listName}[${indexName}]`;\n554. \t\t});\n555. \n556. \t\tbody = deindent`\n557. \t\t\t${declarations}\n558. \n559. \t\t\t[✂${handler.expression.start}-${handler.expression.end}✂];\n560. \t\t`;\n561. \t} else {\n562. \t\tbody = deindent`\n563. \t\t\t${block.alias(\'component\')}.fire(\'${handler.name}\', event);\n564. \t\t`;\n565. \t}\n566. \n567. \treturn {\n568. \t\tname: handler.name,\n569. \t\tvar: block.getUniqueName(`${node.var}_${handler.name}`),\n570. \t\tbody\n571. \t};\n572. }\n573. \n574. function isComputed(node: Node) {\n575. \twhile (node.type === \'MemberExpression\') {\n576. \t\tif (node.computed) return true;\n577. \t\tnode = node.object;\n578. \t}\n579. \n580. \treturn false;\n581. }\n582. \n583. function remount(generator: DomGenerator, node: Node, name: string) {\n584. \t// TODO make this a method of the nodes\n585. \n586. \tif (node.type === \'Component\') {\n587. \t\treturn `${node.var}._mount(${name}._slotted.default, null);`;\n588. \t}\n589. \n590. \tif (node.type === \'Element\') {\n591. \t\tconst slot = node.attributes.find(attribute => attribute.name === \'slot\');\n592. \t\tif (slot) {\n593. \t\t\treturn `@appendNode(${node.var}, ${name}._slotted.${node.getStaticAttributeValue(\'slot\')});`;\n594. \t\t}\n595. \n596. \t\treturn `@appendNode(${node.var}, ${name}._slotted.default);`;\n597. \t}\n598. \n599. \tif (node.type === \'Text\' || node.type === \'MustacheTag\' || node.type === \'RawMustacheTag\') {\n600. \t\treturn `@appendNode(${node.var}, ${name}._slotted.default);`;\n601. \t}\n602. \n603. \tif (node.type === \'EachBlock\') {\n604. \t\t// TODO consider keyed blocks\n605. \t\treturn `for (var #i = 0; #i < ${node.iterations}.length; #i += 1) ${node.iterations}[#i].m(${name}._slotted.default, null);`;\n606. \t}\n607. \n608. \treturn `${node.var}.m(${name}._slotted.default, null);`;\n609. }\n\n\nFile: src/generators/server-side-rendering/Block.ts\nLine number range: 1 - 49\nContent:\n1. import deindent from \'../../utils/deindent\';\n2. import flattenReference from \'../../utils/flattenReference\';\n3. import { SsrGenerator } from \'./index\';\n4. import { Node } from \'../../interfaces\';\n5. import getObject from \'../../utils/getObject\';\n6. \n7. interface BlockOptions {\n8. \t// TODO\n9. }\n10. \n11. export default class Block {\n12. \tgenerator: SsrGenerator;\n13. \tconditions: string[];\n14. \n15. \tcontexts: Map<string, string>;\n16. \tindexes: Map<string, string>;\n17. \tcontextDependencies: Map<string, string[]>;\n18. \n19. \tconstructor(options: BlockOptions) {\n20. \t\tObject.assign(this, options);\n21. \t}\n22. \n23. \taddBinding(binding: Node, name: string) {\n24. \t\tconst conditions = [`!(\'${binding.name}\' in state)`].concat(\n25. \t\t\t// TODO handle contextual bindings...\n26. \t\t\tthis.conditions.map(c => `(${c})`)\n27. \t\t);\n28. \n29. \t\tconst { name: prop } = getObject(binding.value);\n30. \n31. \t\tthis.generator.bindings.push(deindent`\n32. \t\t\tif (${conditions.join(\'&&\')}) {\n33. \t\t\t\ttmp = ${name}.data();\n34. \t\t\t\tif (\'${prop}\' in tmp) {\n35. \t\t\t\t\tstate.${binding.name} = tmp.${prop};\n36. \t\t\t\t\tsettled = false;\n37. \t\t\t\t}\n38. \t\t\t}\n39. \t\t`);\n40. \t}\n41. \n42. \tchild(options: BlockOptions) {\n43. \t\treturn new Block(Object.assign({}, this, options, { parent: this }));\n44. \t}\n45. \n46. \tcontextualise(expression: Node, context?: string, isEventHandler?: boolean) {\n47. \t\treturn this.generator.contextualise(this.contexts, this.indexes, expression, context, isEventHandler);\n48. \t}\n49. }\n\n\nFile: src/generators/server-side-rendering/index.ts\nLine number range: 1 - 268\nContent:\n1. import deindent from \'../../utils/deindent\';\n2. import Generator from \'../Generator\';\n3. import Stylesheet from \'../../css/Stylesheet\';\n4. import Block from \'./Block\';\n5. import visit from \'./visit\';\n6. import { removeNode, removeObjectKey } from \'../../utils/removeNode\';\n7. import getName from \'../../utils/getName\';\n8. import globalWhitelist from \'../../utils/globalWhitelist\';\n9. import { Parsed, Node, CompileOptions } from \'../../interfaces\';\n10. import { AppendTarget } from \'./interfaces\';\n11. import { stringify } from \'../../utils/stringify\';\n12. \n13. export class SsrGenerator extends Generator {\n14. \tbindings: string[];\n15. \trenderCode: string;\n16. \tappendTargets: AppendTarget[];\n17. \n18. \tconstructor(\n19. \t\tparsed: Parsed,\n20. \t\tsource: string,\n21. \t\tname: string,\n22. \t\tstylesheet: Stylesheet,\n23. \t\toptions: CompileOptions\n24. \t) {\n25. \t\tsuper(parsed, source, name, stylesheet, options, false);\n26. \t\tthis.bindings = [];\n27. \t\tthis.renderCode = \'\';\n28. \t\tthis.appendTargets = [];\n29. \n30. \t\tthis.stylesheet.warnOnUnusedSelectors(options.onwarn);\n31. \t}\n32. \n33. \tappend(code: string) {\n34. \t\tif (this.appendTargets.length) {\n35. \t\t\tconst appendTarget = this.appendTargets[this.appendTargets.length - 1];\n36. \t\t\tconst slotName = appendTarget.slotStack[appendTarget.slotStack.length - 1];\n37. \t\t\tappendTarget.slots[slotName] += code;\n38. \t\t} else {\n39. \t\t\tthis.renderCode += code;\n40. \t\t}\n41. \t}\n42. }\n43. \n44. export default function ssr(\n45. \tparsed: Parsed,\n46. \tsource: string,\n47. \tstylesheet: Stylesheet,\n48. \toptions: CompileOptions\n49. ) {\n50. \tconst format = options.format || \'cjs\';\n51. \n52. \tconst generator = new SsrGenerator(parsed, source, options.name || \'SvelteComponent\', stylesheet, options);\n53. \n54. \tconst { computations, name, templateProperties } = generator;\n55. \n56. \t// create main render() function\n57. \tconst mainBlock = new Block({\n58. \t\tgenerator,\n59. \t\tcontexts: new Map(),\n60. \t\tindexes: new Map(),\n61. \t\tconditions: [],\n62. \t});\n63. \n64. \ttrim(parsed.html.children).forEach((node: Node) => {\n65. \t\tvisit(generator, mainBlock, node);\n66. \t});\n67. \n68. \tconst { css, cssMap } = generator.customElement ?\n69. \t\t{ css: null, cssMap: null } :\n70. \t\tgenerator.stylesheet.render(options.filename, true);\n71. \n72. \t// generate initial state object\n73. \tconst expectedProperties = Array.from(generator.expectedProperties);\n74. \tconst globals = expectedProperties.filter(prop => globalWhitelist.has(prop));\n75. \tconst storeProps = options.store || templateProperties.store ? expectedProperties.filter(prop => prop[0] === \'$\') : [];\n76. \n77. \tconst initialState = [];\n78. \tif (globals.length > 0) {\n79. \t\tinitialState.push(`{ ${globals.map(prop => `${prop} : ${prop}`).join(\', \')} }`);\n80. \t}\n81. \n82. \tif (storeProps.length > 0) {\n83. \t\tconst initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`\n84. \t\tif (options.store || templateProperties.store) {\n85. \t\t\tinitialState.push(`options.store.${initialize}`);\n86. \t\t}\n87. \t}\n88. \n89. \tif (templateProperties.data) {\n90. \t\tinitialState.push(`%data()`);\n91. \t} else if (globals.length === 0 && storeProps.length === 0) {\n92. \t\tinitialState.push(\'{}\');\n93. \t}\n94. \n95. \tinitialState.push(\'state\');\n96. \n97. \t// TODO concatenate CSS maps\n98. \tconst result = deindent`\n99. \t\t${generator.javascript}\n100. \n101. \t\tvar ${name} = {};\n102. \n103. \t\t${options.filename && `${name}.filename = ${stringify(options.filename)}`};\n104. \n105. \t\t${name}.data = function() {\n106. \t\t\treturn ${templateProperties.data ? `%data()` : `{}`};\n107. \t\t};\n108. \n109. \t\t${name}.render = function(state, options = {}) {\n110. \t\t\tvar components = new Set();\n111. \n112. \t\t\tfunction addComponent(component) {\n113. \t\t\t\tcomponents.add(component);\n114. \t\t\t}\n115. \n116. \t\t\tvar result = { head: \'\', addComponent };\n117. \t\t\t${templateProperties.store && `options.store = %store();`}\n118. \t\t\tvar html = ${name}._render(result, state, options);\n119. \n120. \t\t\tvar cssCode = Array.from(components).map(c => c.css && c.css.code).filter(Boolean).join(\'\\\\n\');\n121. \n122. \t\t\treturn {\n123. \t\t\t\thtml,\n124. \t\t\t\thead: result.head,\n125. \t\t\t\tcss: { code: cssCode, map: null },\n126. \t\t\t\ttoString() {\n127. \t\t\t\t\treturn html;\n128. \t\t\t\t}\n129. \t\t\t};\n130. \t\t}\n131. \n132. \t\t${name}._render = function(__result, state, options) {\n133. \t\t\t__result.addComponent(${name});\n134. \n135. \t\t\tstate = Object.assign(${initialState.join(\', \')});\n136. \n137. \t\t\t${computations.map(\n138. \t\t\t\t({ key, deps }) =>\n139. \t\t\t\t\t`state.${key} = %computed-${key}(${deps.map(dep => `state.${dep}`).join(\', \')});`\n140. \t\t\t)}\n141. \n142. \t\t\t${generator.bindings.length &&\n143. \t\t\t\tdeindent`\n144. \t\t\t\tvar settled = false;\n145. \t\t\t\tvar tmp;\n146. \n147. \t\t\t\twhile (!settled) {\n148. \t\t\t\t\tsettled = true;\n149. \n150. \t\t\t\t\t${generator.bindings.join(\'\\n\\n\')}\n151. \t\t\t\t}\n152. \t\t\t`}\n153. \n154. \t\t\treturn \\`${generator.renderCode}\\`;\n155. \t\t};\n156. \n157. \t\t${name}.css = {\n158. \t\t\tcode: ${css ? stringify(css) : `\'\'`},\n159. \t\t\tmap: ${cssMap ? stringify(cssMap.toString()) : \'null\'}\n160. \t\t};\n161. \n162. \t\tvar warned = false;\n163. \t\t${name}.renderCss = function() {\n164. \t\t\tif (!warned) {\n165. \t\t\t\tconsole.error(\'Component.renderCss(...) is deprecated and will be removed in v2 — use Component.render(...).css instead\');\n166. \t\t\t\twarned = true;\n167. \t\t\t}\n168. \n169. \t\t\tvar components = [];\n170. \n171. \t\t\t${generator.stylesheet.hasStyles &&\n172. \t\t\t\tdeindent`\n173. \t\t\t\tcomponents.push({\n174. \t\t\t\t\tfilename: ${name}.filename,\n175. \t\t\t\t\tcss: ${name}.css && ${name}.css.code,\n176. \t\t\t\t\tmap: ${name}.css && ${name}.css.map\n177. \t\t\t\t});\n178. \t\t\t`}\n179. \n180. \t\t\t${templateProperties.components &&\n181. \t\t\t\tdeindent`\n182. \t\t\t\tvar seen = {};\n183. \n184. \t\t\t\tfunction addComponent(component) {\n185. \t\t\t\t\tvar result = component.renderCss();\n186. \t\t\t\t\tresult.components.forEach(x => {\n187. \t\t\t\t\t\tif (seen[x.filename]) return;\n188. \t\t\t\t\t\tseen[x.filename] = true;\n189. \t\t\t\t\t\tcomponents.push(x);\n190. \t\t\t\t\t});\n191. \t\t\t\t}\n192. \n193. \t\t\t\t${templateProperties.components.value.properties.map((prop: Node) => {\n194. \t\t\t\t\treturn `addComponent(%components-${getName(prop.key)});`;\n195. \t\t\t\t})}\n196. \t\t\t`}\n197. \n198. \t\t\treturn {\n199. \t\t\t\tcss: components.map(x => x.css).join(\'\\\\n\'),\n200. \t\t\t\tmap: null,\n201. \t\t\t\tcomponents\n202. \t\t\t};\n203. \t\t};\n204. \n205. \t\t${templateProperties.preload && `${name}.preload = %preload;`}\n206. \n207. \t\t${\n208. \t\t\t// TODO this is a bit hacky\n209. \t\t\t/__escape/.test(generator.renderCode) && deindent`\n210. \t\t\t\tvar escaped = {\n211. \t\t\t\t\t\'"\': \'&quot;\',\n212. \t\t\t\t\t"\'": \'&##39;\',\n213. \t\t\t\t\t\'&\': \'&amp;\',\n214. \t\t\t\t\t\'<\': \'&lt;\',\n215. \t\t\t\t\t\'>\': \'&gt;\'\n216. \t\t\t\t};\n217. \n218. \t\t\t\tfunction __escape(html) {\n219. \t\t\t\t\treturn String(html).replace(/["\'&<>]/g, match => escaped[match]);\n220. \t\t\t\t}\n221. \t\t\t`\n222. \t\t}\n223. \n224. \t\t${\n225. \t\t\t/__isPromise/.test(generator.renderCode) && deindent`\n226. \t\t\t\tfunction __isPromise(value) {\n227. \t\t\t\t\treturn value && typeof value.then === \'function\';\n228. \t\t\t\t}\n229. \t\t\t`\n230. \t\t}\n231. \n232. \t\t${\n233. \t\t\t/__missingComponent/.test(generator.renderCode) && deindent`\n234. \t\t\t\tvar __missingComponent = {\n235. \t\t\t\t\t_render: () => \'\'\n236. \t\t\t\t};\n237. \t\t\t`\n238. \t\t}\n239. \t`.replace(/(@+|#+|%+)(\\w*(?:-\\w*)?)/g, (match: string, sigil: string, name: string) => {\n240. \t\tif (sigil === \'@\') return generator.alias(name);\n241. \t\tif (sigil === \'%\') return generator.templateVars.get(name);\n242. \t\treturn sigil.slice(1) + name;\n243. \t});\n244. \n245. \treturn generator.generate(result, options, { name, format });\n246. }\n247. \n248. function trim(nodes) {\n249. \tlet start = 0;\n250. \tfor (; start < nodes.length; start += 1) {\n251. \t\tconst node = nodes[start];\n252. \t\tif (node.type !== \'Text\') break;\n253. \n254. \t\tnode.data = node.data.replace(/^\\s+/, \'\');\n255. \t\tif (node.data) break;\n256. \t}\n257. \n258. \tlet end = nodes.length;\n259. \tfor (; end > start; end -= 1) {\n260. \t\tconst node = nodes[end - 1];\n261. \t\tif (node.type !== \'Text\') break;\n262. \n263. \t\tnode.data = node.data.replace(/\\s+$/, \'\');\n264. \t\tif (node.data) break;\n265. \t}\n266. \n267. \treturn nodes.slice(start, end);\n268. }\n\n\nFile: src/generators/server-side-rendering/visit.ts\nLine number range: 1 - 13\nContent:\n1. import visitors from \'./visitors/index\';\n2. import { SsrGenerator } from \'./index\';\n3. import Block from \'./Block\';\n4. import { Node } from \'../../interfaces\';\n5. \n6. export default function visit(\n7. \tgenerator: SsrGenerator,\n8. \tblock: Block,\n9. \tnode: Node\n10. ) {\n11. \tconst visitor = visitors[node.type];\n12. \tvisitor(generator, block, node);\n13. }\n\n\nFile: src/generators/server-side-rendering/visitors/Component.ts\nLine number range: 1 - 121\nContent:\n1. import flattenReference from \'../../../utils/flattenReference\';\n2. import visit from \'../visit\';\n3. import { SsrGenerator } from \'../index\';\n4. import Block from \'../Block\';\n5. import { AppendTarget } from \'../interfaces\';\n6. import { Node } from \'../../../interfaces\';\n7. import getObject from \'../../../utils/getObject\';\n8. import getTailSnippet from \'../../../utils/getTailSnippet\';\n9. import { stringify } from \'../../../utils/stringify\';\n10. \n11. export default function visitComponent(\n12. \tgenerator: SsrGenerator,\n13. \tblock: Block,\n14. \tnode: Node\n15. ) {\n16. \tfunction stringifyAttribute(chunk: Node) {\n17. \t\tif (chunk.type === \'Text\') return chunk.data;\n18. \t\tif (chunk.type === \'MustacheTag\') {\n19. \t\t\tblock.contextualise(chunk.expression);\n20. \t\t\tconst { snippet } = chunk.metadata;\n21. \t\t\treturn \'${__escape( \' + snippet + \')}\';\n22. \t\t}\n23. \t}\n24. \n25. \tconst attributes: Node[] = [];\n26. \tconst bindings: Node[] = [];\n27. \n28. \tnode.attributes.forEach((attribute: Node) => {\n29. \t\tif (attribute.type === \'Attribute\') {\n30. \t\t\tattributes.push(attribute);\n31. \t\t} else if (attribute.type === \'Binding\') {\n32. \t\t\tbindings.push(attribute);\n33. \t\t}\n34. \t});\n35. \n36. \tconst props = attributes\n37. \t\t.map(attribute => {\n38. \t\t\tlet value;\n39. \n40. \t\t\tif (attribute.value === true) {\n41. \t\t\t\tvalue = `true`;\n42. \t\t\t} else if (attribute.value.length === 0) {\n43. \t\t\t\tvalue = `\'\'`;\n44. \t\t\t} else if (attribute.value.length === 1) {\n45. \t\t\t\tconst chunk = attribute.value[0];\n46. \t\t\t\tif (chunk.type === \'Text\') {\n47. \t\t\t\t\tvalue = isNaN(chunk.data) ? stringify(chunk.data) : chunk.data;\n48. \t\t\t\t} else {\n49. \t\t\t\t\tblock.contextualise(chunk.expression);\n50. \t\t\t\t\tconst { snippet } = chunk.metadata;\n51. \t\t\t\t\tvalue = snippet;\n52. \t\t\t\t}\n53. \t\t\t} else {\n54. \t\t\t\tvalue = \'`\' + attribute.value.map(stringifyAttribute).join(\'\') + \'`\';\n55. \t\t\t}\n56. \n57. \t\t\treturn `${attribute.name}: ${value}`;\n58. \t\t})\n59. \t\t.concat(\n60. \t\t\tbindings.map(binding => {\n61. \t\t\t\tconst { name } = getObject(binding.value);\n62. \t\t\t\tconst tail = binding.value.type === \'MemberExpression\'\n63. \t\t\t\t\t? getTailSnippet(binding.value)\n64. \t\t\t\t\t: \'\';\n65. \n66. \t\t\t\tconst keypath = block.contexts.has(name)\n67. \t\t\t\t\t? `${name}${tail}`\n68. \t\t\t\t\t: `state.${name}${tail}`;\n69. \t\t\t\treturn `${binding.name}: ${keypath}`;\n70. \t\t\t})\n71. \t\t)\n72. \t\t.join(\', \');\n73. \n74. \tconst isDynamicComponent = node.name === \':Component\';\n75. \tif (isDynamicComponent) block.contextualise(node.expression);\n76. \n77. \tconst expression = (\n78. \t\tnode.name === \':Self\' ? generator.name :\n79. \t\tisDynamicComponent ? `((${node.metadata.snippet}) || __missingComponent)` :\n80. \t\t`%components-${node.name}`\n81. \t);\n82. \n83. \tbindings.forEach(binding => {\n84. \t\tblock.addBinding(binding, expression);\n85. \t});\n86. \n87. \tlet open = `\\${${expression}._render(__result, {${props}}`;\n88. \n89. \tconst options = [];\n90. \tif (generator.options.store) {\n91. \t\toptions.push(`store: options.store`);\n92. \t}\n93. \n94. \tif (node.children.length) {\n95. \t\tconst appendTarget: AppendTarget = {\n96. \t\t\tslots: { default: \'\' },\n97. \t\t\tslotStack: [\'default\']\n98. \t\t};\n99. \n100. \t\tgenerator.appendTargets.push(appendTarget);\n101. \n102. \t\tnode.children.forEach((child: Node) => {\n103. \t\t\tvisit(generator, block, child);\n104. \t\t});\n105. \n106. \t\tconst slotted = Object.keys(appendTarget.slots)\n107. \t\t\t.map(name => `${name}: () => \\`${appendTarget.slots[name]}\\``)\n108. \t\t\t.join(\', \');\n109. \n110. \t\toptions.push(`slotted: { ${slotted} }`);\n111. \n112. \t\tgenerator.appendTargets.pop();\n113. \t}\n114. \n115. \tif (options.length) {\n116. \t\topen += `, { ${options.join(\', \')} }`;\n117. \t}\n118. \n119. \tgenerator.append(open);\n120. \tgenerator.append(\')}\');\n121. }\n\n\nFile: src/generators/wrapModule.ts\nLine number range: 1 - 299\nContent:\n1. import deindent from \'../utils/deindent\';\n2. import list from \'../utils/list\';\n3. import { CompileOptions, ModuleFormat, Node } from \'../interfaces\';\n4. \n5. interface Dependency {\n6. \tname: string;\n7. \tstatements: string[];\n8. \tsource: string;\n9. }\n10. \n11. const wrappers = { es, amd, cjs, iife, umd, eval: expr };\n12. \n13. export default function wrapModule(\n14. \tcode: string,\n15. \tformat: ModuleFormat,\n16. \tname: string,\n17. \toptions: CompileOptions,\n18. \tbanner: string,\n19. \tsharedPath: string,\n20. \thelpers: { name: string, alias: string }[],\n21. \timports: Node[],\n22. \tsource: string\n23. ): string {\n24. \tif (format === \'es\') return es(code, name, options, banner, sharedPath, helpers, imports, source);\n25. \n26. \tconst dependencies = imports.map((declaration, i) => {\n27. \t\tconst defaultImport = declaration.specifiers.find(\n28. \t\t\t(x: Node) =>\n29. \t\t\t\tx.type === \'ImportDefaultSpecifier\' ||\n30. \t\t\t\t(x.type === \'ImportSpecifier\' && x.imported.name === \'default\')\n31. \t\t);\n32. \n33. \t\tconst namespaceImport = declaration.specifiers.find(\n34. \t\t\t(x: Node) => x.type === \'ImportNamespaceSpecifier\'\n35. \t\t);\n36. \n37. \t\tconst namedImports = declaration.specifiers.filter(\n38. \t\t\t(x: Node) =>\n39. \t\t\t\tx.type === \'ImportSpecifier\' && x.imported.name !== \'default\'\n40. \t\t);\n41. \n42. \t\tconst name = defaultImport || namespaceImport\n43. \t\t\t? (defaultImport || namespaceImport).local.name\n44. \t\t\t: `__import${i}`;\n45. \n46. \t\tconst statements: string[] = [];\n47. \n48. \t\tnamedImports.forEach((specifier: Node) => {\n49. \t\t\tstatements.push(\n50. \t\t\t\t`var ${specifier.local.name} = ${name}.${specifier.imported.name};`\n51. \t\t\t);\n52. \t\t});\n53. \n54. \t\tif (defaultImport) {\n55. \t\t\tstatements.push(\n56. \t\t\t\t`${name} = (${name} && ${name}.__esModule) ? ${name}["default"] : ${name};`\n57. \t\t\t);\n58. \t\t}\n59. \n60. \t\treturn { name, statements, source: declaration.source.value };\n61. \t});\n62. \n63. \tif (format === \'amd\') return amd(code, name, options, banner, dependencies);\n64. \tif (format === \'cjs\') return cjs(code, name, options, banner, sharedPath, helpers, dependencies);\n65. \tif (format === \'iife\') return iife(code, name, options, banner, dependencies);\n66. \tif (format === \'umd\') return umd(code, name, options, banner, dependencies);\n67. \tif (format === \'eval\') return expr(code, name, options, banner, dependencies);\n68. \n69. \tthrow new Error(`options.format is invalid (must be ${list(Object.keys(wrappers))})`);\n70. }\n71. \n72. function es(\n73. \tcode: string,\n74. \tname: string,\n75. \toptions: CompileOptions,\n76. \tbanner: string,\n77. \tsharedPath: string,\n78. \thelpers: { name: string, alias: string }[],\n79. \timports: Node[],\n80. \tsource: string\n81. ) {\n82. \tconst importHelpers = helpers && (\n83. \t\t`import { ${helpers.map(h => h.name === h.alias ? h.name : `${h.name} as ${h.alias}`).join(\', \')} } from ${JSON.stringify(sharedPath)};`\n84. \t);\n85. \n86. \tconst importBlock = imports.length > 0 && (\n87. \t\timports\n88. \t\t\t.map((declaration: Node) => source.slice(declaration.start, declaration.end))\n89. \t\t\t.join(\'\\n\')\n90. \t);\n91. \n92. \treturn deindent`\n93. \t\t${banner}\n94. \t\t${importHelpers}\n95. \t\t${importBlock}\n96. \n97. \t\t${code}\n98. \t\texport default ${name};`;\n99. }\n100. \n101. function amd(\n102. \tcode: string,\n103. \tname: string,\n104. \toptions: CompileOptions,\n105. \tbanner: string,\n106. \tdependencies: Dependency[]\n107. ) {\n108. \tconst sourceString = dependencies.length\n109. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n110. \t\t: \'\';\n111. \n112. \tconst id = options.amd && options.amd.id;\n113. \n114. \treturn deindent`\n115. \t\tdefine(${id ? `"${id}", ` : \'\'}${sourceString}function(${paramString(dependencies)}) { "use strict";\n116. \t\t\t${getCompatibilityStatements(dependencies)}\n117. \n118. \t\t\t${code}\n119. \t\t\treturn ${name};\n120. \t\t});`;\n121. }\n122. \n123. function cjs(\n124. \tcode: string,\n125. \tname: string,\n126. \toptions: CompileOptions,\n127. \tbanner: string,\n128. \tsharedPath: string,\n129. \thelpers: { name: string, alias: string }[],\n130. \tdependencies: Dependency[]\n131. ) {\n132. \tconst SHARED = \'__shared\';\n133. \tconst helperBlock = helpers && (\n134. \t\t`var ${SHARED} = require(${JSON.stringify(sharedPath)});\\n` +\n135. \t\thelpers.map(helper => {\n136. \t\t\treturn `var ${helper.alias} = ${SHARED}.${helper.name};`;\n137. \t\t}).join(\'\\n\')\n138. \t);\n139. \n140. \tconst requireBlock = dependencies.length > 0 && (\n141. \t\tdependencies\n142. \t\t\t.map(d => `var ${d.name} = require("${d.source}");`)\n143. \t\t\t.join(\'\\n\\n\')\n144. \t);\n145. \n146. \treturn deindent`\n147. \t\t${banner}\n148. \t\t"use strict";\n149. \n150. \t\t${helperBlock}\n151. \t\t${requireBlock}\n152. \t\t${getCompatibilityStatements(dependencies)}\n153. \n154. \t\t${code}\n155. \n156. \t\tmodule.exports = ${name};`\n157. }\n158. \n159. function iife(\n160. \tcode: string,\n161. \tname: string,\n162. \toptions: CompileOptions,\n163. \tbanner: string,\n164. \tdependencies: Dependency[]\n165. ) {\n166. \tif (!options.name) {\n167. \t\tthrow new Error(`Missing required \'name\' option for IIFE export`);\n168. \t}\n169. \n170. \tconst globals = getGlobals(dependencies, options);\n171. \n172. \treturn deindent`\n173. \t\t${banner}\n174. \t\tvar ${options.name} = (function(${paramString(dependencies)}) { "use strict";\n175. \t\t\t${getCompatibilityStatements(dependencies)}\n176. \n177. \t\t\t${code}\n178. \t\t\treturn ${name};\n179. \t\t}(${globals.join(\', \')}));`;\n180. }\n181. \n182. function umd(\n183. \tcode: string,\n184. \tname: string,\n185. \toptions: CompileOptions,\n186. \tbanner: string,\n187. \tdependencies: Dependency[]\n188. ) {\n189. \tif (!options.name) {\n190. \t\tthrow new Error(`Missing required \'name\' option for UMD export`);\n191. \t}\n192. \n193. \tconst amdId = options.amd && options.amd.id ? `\'${options.amd.id}\', ` : \'\';\n194. \n195. \tconst amdDeps = dependencies.length\n196. \t\t? `[${dependencies.map(d => `"${removeExtension(d.source)}"`).join(\', \')}], `\n197. \t\t: \'\';\n198. \n199. \tconst cjsDeps = dependencies\n200. \t\t.map(d => `require("${d.source}")`)\n201. \t\t.join(\', \');\n202. \n203. \tconst globals = getGlobals(dependencies, options);\n204. \n205. \treturn deindent`\n206. \t\t${banner}\n207. \t\t(function(global, factory) {\n208. \t\t\ttypeof exports === "object" && typeof module !== "undefined" ? module.exports = factory(${cjsDeps}) :\n209. \t\t\ttypeof define === "function" && define.amd ? define(${amdId}${amdDeps}factory) :\n210. \t\t\t(global.${options.name} = factory(${globals.join(\', \')}));\n211. \t\t}(this, (function (${paramString(dependencies)}) { "use strict";\n212. \n213. \t\t\t${getCompatibilityStatements(dependencies)}\n214. \n215. \t\t\t${code}\n216. \n217. \t\t\treturn ${name};\n218. \n219. \t\t})));`;\n220. }\n221. \n222. function expr(\n223. \tcode: string,\n224. \tname: string,\n225. \toptions: CompileOptions,\n226. \tbanner: string,\n227. \tdependencies: Dependency[]\n228. ) {\n229. \tconst globals = getGlobals(dependencies, options);\n230. \n231. \treturn deindent`\n232. \t\t(function (${paramString(dependencies)}) { "use strict";\n233. \t\t\t${banner}\n234. \n235. \t\t\t${getCompatibilityStatements(dependencies)}\n236. \n237. \t\t\t${code}\n238. \n239. \t\t\treturn ${name};\n240. \t\t}(${globals.join(\', \')}))`;\n241. }\n242. \n243. function paramString(dependencies: Dependency[]) {\n244. \treturn dependencies.map(dep => dep.name).join(\', \');\n245. }\n246. \n247. function removeExtension(file: string) {\n248. \tconst index = file.lastIndexOf(\'.\');\n249. \treturn ~index ? file.slice(0, index) : file;\n250. }\n251. \n252. function getCompatibilityStatements(dependencies: Dependency[]) {\n253. \tif (!dependencies.length) return null;\n254. \n255. \tconst statements: string[] = [];\n256. \n257. \tdependencies.forEach(dependency => {\n258. \t\tstatements.push(...dependency.statements);\n259. \t});\n260. \n261. \treturn statements.join(\'\\n\');\n262. }\n263. \n264. function getGlobals(dependencies: Dependency[], options: CompileOptions) {\n265. \tconst { globals, onerror, onwarn } = options;\n266. \tconst globalFn = getGlobalFn(globals);\n267. \n268. \treturn dependencies.map(d => {\n269. \t\tlet name = globalFn(d.source);\n270. \n271. \t\tif (!name) {\n272. \t\t\tif (d.name.startsWith(\'__import\')) {\n273. \t\t\t\tconst error = new Error(\n274. \t\t\t\t\t`Could not determine name for imported module \'${d.source}\' – use options.globals`\n275. \t\t\t\t);\n276. \t\t\t\tonerror(error);\n277. \t\t\t} else {\n278. \t\t\t\tconst warning = {\n279. \t\t\t\t\tmessage: `No name was supplied for imported module \'${d.source}\'. Guessing \'${d.name}\', but you should use options.globals`,\n280. \t\t\t\t};\n281. \n282. \t\t\t\tonwarn(warning);\n283. \t\t\t}\n284. \n285. \t\t\tname = d.name;\n286. \t\t}\n287. \n288. \t\treturn name;\n289. \t});\n290. }\n291. \n292. function getGlobalFn(globals: any): (id: string) => string {\n293. \tif (typeof globals === \'function\') return globals;\n294. \tif (typeof globals === \'object\') {\n295. \t\treturn id => globals[id];\n296. \t}\n297. \n298. \treturn () => undefined;\n299. }\n\n\nFile: src/interfaces.ts\nLine number range: 1 - 92\nContent:\n1. import {SourceMap} from \'magic-string\';\n2. \n3. export interface Node {\n4. \tstart: number;\n5. \tend: number;\n6. \ttype: string;\n7. \t[propName: string]: any;\n8. }\n9. \n10. export interface Parser {\n11. \treadonly template: string;\n12. \treadonly filename?: string;\n13. \n14. \tindex: number;\n15. \tstack: Array<Node>;\n16. \n17. \thtml: Node;\n18. \tcss: Node;\n19. \tjs: Node;\n20. \tmetaTags: {};\n21. }\n22. \n23. export interface Parsed {\n24. \thash: number;\n25. \thtml: Node;\n26. \tcss: Node;\n27. \tjs: Node;\n28. }\n29. \n30. export interface Warning {\n31. \tloc?: { line: number; column: number; pos?: number };\n32. \tpos?: number;\n33. \tmessage: string;\n34. \tfilename?: string;\n35. \tframe?: string;\n36. \ttoString: () => string;\n37. }\n38. \n39. export type ModuleFormat = \'es\' | \'amd\' | \'cjs\' | \'iife\' | \'umd\' | \'eval\';\n40. \n41. export interface CompileOptions {\n42. \tformat?: ModuleFormat;\n43. \tname?: string;\n44. \tfilename?: string;\n45. \tgenerate?: string;\n46. \tglobals?: ((id: string) => string) | object;\n47. \tamd?: {\n48. \t\tid?: string;\n49. \t};\n50. \n51. \toutputFilename?: string;\n52. \tcssOutputFilename?: string;\n53. \n54. \tdev?: boolean;\n55. \tshared?: boolean | string;\n56. \tcascade?: boolean;\n57. \thydratable?: boolean;\n58. \tlegacy?: boolean;\n59. \tcustomElement?: CustomElementOptions | true;\n60. \tcss?: boolean;\n61. \tstore?: boolean;\n62. \n63. \tonerror?: (error: Error) => void;\n64. \tonwarn?: (warning: Warning) => void;\n65. }\n66. \n67. export interface GenerateOptions {\n68. \tname: string;\n69. \tformat: ModuleFormat;\n70. \tbanner?: string;\n71. \tsharedPath?: string;\n72. \thelpers?: { name: string, alias: string }[];\n73. }\n74. \n75. export interface Visitor {\n76. \tenter: (node: Node) => void;\n77. \tleave?: (node: Node) => void;\n78. }\n79. \n80. export interface CustomElementOptions {\n81. \ttag?: string;\n82. \tprops?: string[];\n83. }\n84. \n85. export interface PreprocessOptions {\n86. \tmarkup?: (options: {content: string, filename: string}) => { code: string, map?: SourceMap | string };\n87. \tstyle?: Preprocessor;\n88. \tscript?: Preprocessor;\n89. \tfilename?: string\n90. }\n91. \n92. export type Preprocessor = (options: {content: string, attributes: Record<string, string | boolean>, filename?: string}) => { code: string, map?: SourceMap | string };\n\n\nFile: src/server-side-rendering/register.js\nLine number range: 1 - 46\nContent:\n1. import * as fs from \'fs\';\n2. import * as path from \'path\';\n3. import { compile } from \'../index.ts\';\n4. \n5. const compileOptions = {};\n6. \n7. function capitalise(name) {\n8. \treturn name[0].toUpperCase() + name.slice(1);\n9. }\n10. \n11. export default function register(options) {\n12. \tconst { extensions } = options;\n13. \n14. \tif (extensions) {\n15. \t\t_deregister(\'.html\');\n16. \t\textensions.forEach(_register);\n17. \t}\n18. \n19. \t// TODO make this the default and remove in v2\n20. \tif (\'store\' in options) compileOptions.store = options.store;\n21. }\n22. \n23. function _deregister(extension) {\n24. \tdelete require.extensions[extension];\n25. }\n26. \n27. function _register(extension) {\n28. \trequire.extensions[extension] = function(module, filename) {\n29. \t\tconst name = path.basename(filename)\n30. \t\t\t.slice(0, -path.extname(filename).length)\n31. \t\t\t.replace(/^\\d/, \'_$&\')\n32. \t\t\t.replace(/[^a-zA-Z0-9_$]/g, \'\');\n33. \n34. \t\tconst options = Object.assign({}, compileOptions, {\n35. \t\t\tfilename,\n36. \t\t\tname: capitalise(name),\n37. \t\t\tgenerate: \'ssr\'\n38. \t\t});\n39. \n40. \t\tconst {code} = compile(fs.readFileSync(filename, \'utf-8\'), options);\n41. \n42. \t\treturn module._compile(code, filename);\n43. \t};\n44. }\n45. \n46. _register(\'.html\');\n\n\nFile: store.js\nLine number range: 1 - 164\nContent:\n1. import {\n2. \tassign,\n3. \tblankObject,\n4. \tdiffers,\n5. \tdispatchObservers,\n6. \tget,\n7. \tobserve\n8. } from \'./shared.js\';\n9. \n10. function Store(state) {\n11. \tthis._observers = { pre: blankObject(), post: blankObject() };\n12. \tthis._changeHandlers = [];\n13. \tthis._dependents = [];\n14. \n15. \tthis._computed = blankObject();\n16. \tthis._sortedComputedProperties = [];\n17. \n18. \tthis._state = assign({}, state);\n19. }\n20. \n21. assign(Store.prototype, {\n22. \t_add: function(component, props) {\n23. \t\tthis._dependents.push({\n24. \t\t\tcomponent: component,\n25. \t\t\tprops: props\n26. \t\t});\n27. \t},\n28. \n29. \t_init: function(props) {\n30. \t\tvar state = {};\n31. \t\tfor (var i = 0; i < props.length; i += 1) {\n32. \t\t\tvar prop = props[i];\n33. \t\t\tstate[\'$\' + prop] = this._state[prop];\n34. \t\t}\n35. \t\treturn state;\n36. \t},\n37. \n38. \t_remove: function(component) {\n39. \t\tvar i = this._dependents.length;\n40. \t\twhile (i--) {\n41. \t\t\tif (this._dependents[i].component === component) {\n42. \t\t\t\tthis._dependents.splice(i, 1);\n43. \t\t\t\treturn;\n44. \t\t\t}\n45. \t\t}\n46. \t},\n47. \n48. \t_sortComputedProperties: function() {\n49. \t\tvar computed = this._computed;\n50. \t\tvar sorted = this._sortedComputedProperties = [];\n51. \t\tvar cycles;\n52. \t\tvar visited = blankObject();\n53. \n54. \t\tfunction visit(key) {\n55. \t\t\tif (cycles[key]) {\n56. \t\t\t\tthrow new Error(\'Cyclical dependency detected\');\n57. \t\t\t}\n58. \n59. \t\t\tif (visited[key]) return;\n60. \t\t\tvisited[key] = true;\n61. \n62. \t\t\tvar c = computed[key];\n63. \n64. \t\t\tif (c) {\n65. \t\t\t\tcycles[key] = true;\n66. \t\t\t\tc.deps.forEach(visit);\n67. \t\t\t\tsorted.push(c);\n68. \t\t\t}\n69. \t\t}\n70. \n71. \t\tfor (var key in this._computed) {\n72. \t\t\tcycles = blankObject();\n73. \t\t\tvisit(key);\n74. \t\t}\n75. \t},\n76. \n77. \tcompute: function(key, deps, fn) {\n78. \t\tvar store = this;\n79. \t\tvar value;\n80. \n81. \t\tvar c = {\n82. \t\t\tdeps: deps,\n83. \t\t\tupdate: function(state, changed, dirty) {\n84. \t\t\t\tvar values = deps.map(function(dep) {\n85. \t\t\t\t\tif (dep in changed) dirty = true;\n86. \t\t\t\t\treturn state[dep];\n87. \t\t\t\t});\n88. \n89. \t\t\t\tif (dirty) {\n90. \t\t\t\t\tvar newValue = fn.apply(null, values);\n91. \t\t\t\t\tif (differs(newValue, value)) {\n92. \t\t\t\t\t\tvalue = newValue;\n93. \t\t\t\t\t\tchanged[key] = true;\n94. \t\t\t\t\t\tstate[key] = value;\n95. \t\t\t\t\t}\n96. \t\t\t\t}\n97. \t\t\t}\n98. \t\t};\n99. \n100. \t\tc.update(this._state, {}, true);\n101. \n102. \t\tthis._computed[key] = c;\n103. \t\tthis._sortComputedProperties();\n104. \t},\n105. \n106. \tget: get,\n107. \n108. \tobserve: observe,\n109. \n110. \tonchange: function(callback) {\n111. \t\tthis._changeHandlers.push(callback);\n112. \t\treturn {\n113. \t\t\tcancel: function() {\n114. \t\t\t\tvar index = this._changeHandlers.indexOf(callback);\n115. \t\t\t\tif (~index) this._changeHandlers.splice(index, 1);\n116. \t\t\t}\n117. \t\t};\n118. \t},\n119. \n120. \tset: function(newState) {\n121. \t\tvar oldState = this._state,\n122. \t\t\tchanged = this._changed = {},\n123. \t\t\tdirty = false;\n124. \n125. \t\tfor (var key in newState) {\n126. \t\t\tif (this._computed[key]) throw new Error("\'" + key + "\' is a read-only property");\n127. \t\t\tif (differs(newState[key], oldState[key])) changed[key] = dirty = true;\n128. \t\t}\n129. \t\tif (!dirty) return;\n130. \n131. \t\tthis._state = assign({}, oldState, newState);\n132. \n133. \t\tfor (var i = 0; i < this._sortedComputedProperties.length; i += 1) {\n134. \t\t\tthis._sortedComputedProperties[i].update(this._state, changed);\n135. \t\t}\n136. \n137. \t\tfor (var i = 0; i < this._changeHandlers.length; i += 1) {\n138. \t\t\tthis._changeHandlers[i](this._state, changed);\n139. \t\t}\n140. \n141. \t\tdispatchObservers(this, this._observers.pre, changed, this._state, oldState);\n142. \n143. \t\tvar dependents = this._dependents.slice(); // guard against mutations\n144. \t\tfor (var i = 0; i < dependents.length; i += 1) {\n145. \t\t\tvar dependent = dependents[i];\n146. \t\t\tvar componentState = {};\n147. \t\t\tdirty = false;\n148. \n149. \t\t\tfor (var j = 0; j < dependent.props.length; j += 1) {\n150. \t\t\t\tvar prop = dependent.props[j];\n151. \t\t\t\tif (prop in changed) {\n152. \t\t\t\t\tcomponentState[\'$\' + prop] = this._state[prop];\n153. \t\t\t\t\tdirty = true;\n154. \t\t\t\t}\n155. \t\t\t}\n156. \n157. \t\t\tif (dirty) dependent.component.set(componentState);\n158. \t\t}\n159. \n160. \t\tdispatchObservers(this, this._observers.post, changed, this._state, oldState);\n161. \t}\n162. });\n163. \n164. export { Store };\n\n\nFile: test/server-side-rendering/index.js\nLine number range: 1 - 132\nContent:\n1. import assert from "assert";\n2. import * as fs from "fs";\n3. import * as path from "path";\n4. import glob from \'glob\';\n5. \n6. import {\n7. \tshowOutput,\n8. \tloadConfig,\n9. \tsetupHtmlEqual,\n10. \ttryToLoadJson\n11. } from "../helpers.js";\n12. \n13. function tryToReadFile(file) {\n14. \ttry {\n15. \t\treturn fs.readFileSync(file, "utf-8");\n16. \t} catch (err) {\n17. \t\tif (err.code !== "ENOENT") throw err;\n18. \t\treturn null;\n19. \t}\n20. }\n21. \n22. describe("ssr", () => {\n23. \tbefore(() => {\n24. \t\trequire("../../ssr/register")({\n25. \t\t\textensions: [\'.svelte\', \'.html\'],\n26. \t\t\tstore: true\n27. \t\t});\n28. \n29. \t\treturn setupHtmlEqual();\n30. \t});\n31. \n32. \tfs.readdirSync("test/server-side-rendering/samples").forEach(dir => {\n33. \t\tif (dir[0] === ".") return;\n34. \n35. \t\t// add .solo to a sample directory name to only run that test, or\n36. \t\t// .show to always show the output. or both\n37. \t\tconst solo = /\\.solo/.test(dir);\n38. \t\tconst show = /\\.show/.test(dir);\n39. \n40. \t\tif (solo && process.env.CI) {\n41. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n42. \t\t}\n43. \n44. \t\t(solo ? it.only : it)(dir, () => {\n45. \t\t\tdir = path.resolve("test/server-side-rendering/samples", dir);\n46. \t\t\ttry {\n47. \t\t\t\tlet component;\n48. \n49. \t\t\t\tconst mainHtmlFile = `${dir}/main.html`;\n50. \t\t\t\tconst mainSvelteFile = `${dir}/main.svelte`;\n51. \t\t\t\tif (fs.existsSync(mainHtmlFile)) {\n52. \t\t\t\t\tcomponent = require(mainHtmlFile);\n53. \t\t\t\t} else if (fs.existsSync(mainSvelteFile)) {\n54. \t\t\t\t\tcomponent = require(mainSvelteFile);\n55. \t\t\t\t}\n56. \n57. \t\t\t\tconst expectedHtml = tryToReadFile(`${dir}/_expected.html`);\n58. \t\t\t\tconst expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";\n59. \n60. \t\t\t\tconst data = tryToLoadJson(`${dir}/data.json`);\n61. \n62. \t\t\t\tconst rendered = component.render(data);\n63. \t\t\t\tconst { html, css, head } = rendered;\n64. \n65. \t\t\t\t// rendered.toString() === rendered.html\n66. \t\t\t\tassert.equal(rendered, html);\n67. \n68. \t\t\t\tfs.writeFileSync(`${dir}/_actual.html`, html);\n69. \t\t\t\tif (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);\n70. \n71. \t\t\t\tassert.htmlEqual(html, expectedHtml);\n72. \t\t\t\tassert.equal(\n73. \t\t\t\t\tcss.code.replace(/^\\s+/gm, ""),\n74. \t\t\t\t\texpectedCss.replace(/^\\s+/gm, "")\n75. \t\t\t\t);\n76. \n77. \t\t\t\tif (fs.existsSync(`${dir}/_expected-head.html`)) {\n78. \t\t\t\t\tfs.writeFileSync(`${dir}/_actual-head.html`, head);\n79. \t\t\t\t\tassert.htmlEqual(\n80. \t\t\t\t\t\thead,\n81. \t\t\t\t\t\tfs.readFileSync(`${dir}/_expected-head.html`, \'utf-8\')\n82. \t\t\t\t\t);\n83. \t\t\t\t}\n84. \n85. \t\t\t\tif (show) showOutput(dir, { generate: \'ssr\' });\n86. \t\t\t} catch (err) {\n87. \t\t\t\tshowOutput(dir, { generate: \'ssr\' });\n88. \t\t\t\tthrow err;\n89. \t\t\t}\n90. \t\t});\n91. \t});\n92. \n93. \t// duplicate client-side tests, as far as possible\n94. \tfs.readdirSync("test/runtime/samples").forEach(dir => {\n95. \t\tif (dir[0] === ".") return;\n96. \n97. \t\tconst config = loadConfig(`./runtime/samples/${dir}/_config.js`);\n98. \n99. \t\tif (config.solo && process.env.CI) {\n100. \t\t\tthrow new Error("Forgot to remove `solo: true` from test");\n101. \t\t}\n102. \n103. \t\tif (config["skip-ssr"]) return;\n104. \n105. \t\t(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {\n106. \t\t\tconst cwd = path.resolve("test/runtime/samples", dir);\n107. \n108. \t\t\tglob.sync(\'**/*.html\', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {\n109. \t\t\t\tconst resolved = require.resolve(`../runtime/samples/${dir}/${file}`);\n110. \t\t\t\tdelete require.cache[resolved];\n111. \t\t\t});\n112. \n113. \t\t\trequire("../../ssr/register")({\n114. \t\t\t\tstore: !!config.store\n115. \t\t\t});\n116. \n117. \t\t\ttry {\n118. \t\t\t\tconst component = require(`../runtime/samples/${dir}/main.html`);\n119. \t\t\t\tconst { html } = component.render(config.data, {\n120. \t\t\t\t\tstore: (config.store !== true) && config.store\n121. \t\t\t\t});\n122. \n123. \t\t\t\tif (config.html) {\n124. \t\t\t\t\tassert.htmlEqual(html, config.html);\n125. \t\t\t\t}\n126. \t\t\t} catch (err) {\n127. \t\t\t\tshowOutput(cwd, { generate: "ssr" });\n128. \t\t\t\tthrow err;\n129. \t\t\t}\n130. \t\t});\n131. \t});\n132. });\n\n--- END CONTEXT ---\nThese context should be enough to help you make the necessary code edits. Do NOT explore for more context in the codebase!\n\nAnalyzer agent has analyzed the issue and provided instruction on the issue:\n--- BEGIN ANALYZER MESSAGE ---\n1) Issue Understanding\n\n- Reported symptom: When server-side rendering a parent component that includes a nested component which uses a store (via a “store” property on the nested component’s export), SSR fails with “Cannot read property \'_init\' of undefined”.\n- Unexpected behavior: Client-side navigation works, but SSR fails. The SSR-generated code calls the nested component’s _render directly and passes the parent’s options.store, which is undefined in this scenario. The nested component expects its store to be initialized and attempts to call options.store._init, causing the crash.\n\n\n2) Code Analysis\n\n- Involved files and functions:\n  - src/generators/server-side-rendering/index.ts\n    - Constructs the SSR output for a component, including the render and _render functions and initial state assembly.\n  - src/generators/server-side-rendering/visitors/Component.ts\n    - Generates the code used to render nested components within a parent’s SSR HTML, currently calling childComponent._render(__result, childState, { store: options.store }) if generator.options.store is set.\n  - store.js\n    - Defines the Store and its _init method, which assigns $-prefixed props based on the store state.\n  - src/server-side-rendering/register.js\n    - Passes compile options (including store: true) into the SSR generator.\n\n- What the problematic code currently does:\n  - In index.ts:\n    - In the top-level component’s render function, options.store is initialized from %store() only if that top-level component itself declares a store via templateProperties.store.\n    - The initialState assembly for a component relies on options.store._init when expectedProperties include $-prefixed store-derived props, gated by the condition (options.store || templateProperties.store).\n  - In visitors/Component.ts:\n    - Nested components are rendered by invoking child._render, not child.render. This bypasses the nested component’s render function, where options.store would normally be initialized from its own templateProperties.store.\n    - It forwards store: options.store from the parent if generator.options.store is true. If the parent doesn’t have a store and doesn’t pass one in render options, options.store is undefined.\n  - Result:\n    - When a nested component declares a store but the parent doesn’t, the nested component’s _render is called with options.store undefined. In index.ts, the nested component’s _render builds initialState using options.store._init([...]), leading to the error.\n\n\n3) Root Cause\n\n- SSR for nested components bypasses the nested component’s render function, which is where options.store is set to %store() when the component declares a store.\n- The nested component’s _render function (generated by index.ts) assumes options.store exists and uses options.store._init, but there’s no initialization of options.store in _render itself.\n- Specific lines contributing to the issue:\n  - src/generators/server-side-rendering/visitors/Component.ts: It generates nested calls as child._render(__result, props, { store: options.store }), which passes through undefined if the parent had no store.\n  - src/generators/server-side-rendering/index.ts:\n    - Lines ~75–87: storeProps detection and initialState push referencing options.store._init.\n    - Lines ~116–119: options.store is only initialized in the top-level render when templateProperties.store is present. There’s no equivalent initialization in _render.\n  - Therefore, nested components that declare their own store crash during SSR because their _render expects options.store to be defined, but it isn’t when called directly.\n\n\n4) Fix Suggestion\n\nChange 1:\n- File: src/generators/server-side-rendering/index.ts\n- Function/code block: Generation of the component’s _render function (the body starting around the definition of name._render).\n- What to change:\n  - Insert a line at the start of the generated _render function that initializes options.store when this component declares a store. Specifically, if templateProperties.store is present for the component being generated, set options.store to options.store || %store() before any initialState assembly that references options.store._init.\n  - Adjust the initialState assembly to rely on options.store being defined at this point. If you currently guard pushing options.store._init with (options.store || templateProperties.store), simplify to conditioning on storeProps.length > 0 and then push options.store._init, knowing options.store has been initialized.\n- Why this fixes the issue:\n  - Nested components are invoked via _render and do not pass through render, which is where store initialization presently occurs. By initializing options.store inside _render when the component declares a store, nested SSR calls will have a valid options.store available for the storeProps initialization. This preserves CSS aggregation semantics (via __result.addComponent) and avoids changing nested call semantics.\n\nChange 2 (optional hardening):\n- File: src/generators/server-side-rendering/visitors/Component.ts\n- Function/code block: visitComponent, specifically the logic that decides to push “store: options.store” into the options passed to nested _render.\n- What to change:\n  - Either leave as-is and rely on Change 1’s fallback initialization in the child’s _render, or restrict adding “store: options.store” only when a store is actually present at runtime. Since compile-time cannot know runtime availability, the safer route is to keep passing options.store when generator.options.store is enabled and rely on Change 1 to handle undefined by initializing in the child’s _render.\n- Why this helps:\n  - This avoids future regressions where an undefined options.store is propagated down; with the child’s _render self-initialization, undefined is harmless and becomes a valid store instance for that component.\n\nTesting considerations:\n- Add/adjust SSR tests to include a parent without a store and a nested child that declares a store. Confirm SSR no longer throws and the expected output reflects store-derived props (e.g., $hasTwoFactor) correctly.\n- Verify CSS aggregation still works: child._render continues to call __result.addComponent, so the parent’s CSS collection remains intact.\n\nSummary:\n- Initialize options.store in each component’s _render when that component declares a store, not only in render. This ensures nested SSR render paths have a valid store, resolving “Cannot read property \'_init\' of undefined” without changing how nested components are invoked or how CSS is aggregated.\n--- END ANALYZER MESSAGE ---\n\nIMPORTANT INSTRUCTION:\n- The context provided above should be sufficient for you to make the required code edits. Do NOT explore for more context in the codebase!\n- Do NOT FIND, WRITE or RUN any tests, your change will be tested automatically by reproduction tests and regression tests later!!!\n- Never write any tests yourself!!! (Very important!)\n\nPlease implement these changes precisely, following the exact specifications from the analyzer.\n' additional_kwargs={} response_metadata={}
2025-11-12 14:03:26,471 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hfvGqd4xK5XniFfFrVuA2eUE', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 3938, 'prompt_tokens': 19719, 'total_tokens': 23657, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 3904, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b37041e2-978e-42b7-b853-198850306f9e-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts'}, 'id': 'call_hfvGqd4xK5XniFfFrVuA2eUE', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19719, 'output_tokens': 3938, 'total_tokens': 23657, 'input_token_details': {'audio': 0, 'cache_read': 1280}, 'output_token_details': {'audio': 0, 'reasoning': 3904}}
2025-11-12 14:03:59,789 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_N6xLqkoVTbaGBJ3GtUinIPtC', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts","old_content":"\\t\\t\\t__result.addComponent(${name});","new_content":"\\t\\t\\t__result.addComponent(${name});\\n\\t\\t\\t${templateProperties.store && `options.store = options.store || %store();`}"}', 'name': 'edit_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2581, 'prompt_tokens': 22181, 'total_tokens': 24762, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2496, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3c8b44c3-7477-4c4f-82e9-11eac2ea844f-0' tool_calls=[{'name': 'edit_file', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts', 'old_content': '\t\t\t__result.addComponent(${name});', 'new_content': '\t\t\t__result.addComponent(${name});\n\t\t\t${templateProperties.store && `options.store = options.store || %store();`}'}, 'id': 'call_N6xLqkoVTbaGBJ3GtUinIPtC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 22181, 'output_tokens': 2581, 'total_tokens': 24762, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 2496}}
2025-11-12 14:04:01,506 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_HuUPffPIdurfx64uyzS3HJoB', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 22283, 'total_tokens': 22311, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a666caf3-b2c1-4a40-8db1-2c77af58c1c0-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts'}, 'id': 'call_HuUPffPIdurfx64uyzS3HJoB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 22283, 'output_tokens': 28, 'total_tokens': 22311, 'input_token_details': {'audio': 0, 'cache_read': 1280}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:04:18,266 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='I inspected the relevant server-side rendering generator code and implemented the fix so nested components that declare a store can initialize it correctly during SSR, even when the parent doesn’t have or pass a store.\n\nChange applied:\n- In src/generators/server-side-rendering/index.ts, inside the generated _render function, I added initialization of options.store when the component declares a store:\n  - After __result.addComponent(...) I inserted: options.store = options.store || %store(); conditioned by templateProperties.store\n  - This ensures that when a nested component’s _render is called directly, it has a valid store instance before initial state assembly calls options.store._init(...).\n\nVerification:\n- Read the file before and after the edit to confirm the exact replacement occurred and the new initialization line executes before state assembly.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1643, 'prompt_tokens': 24765, 'total_tokens': 26408, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1472, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 22272}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--e8517dc0-5049-4044-b162-01c85d21fe5a-0' usage_metadata={'input_tokens': 24765, 'output_tokens': 1643, 'total_tokens': 26408, 'input_token_details': {'audio': 0, 'cache_read': 22272}, 'output_token_details': {'audio': 0, 'reasoning': 1472}}
2025-11-12 14:04:18,308 - thread-135845298308800.prometheus.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts
index 37bf859da..2fd4c2c14 100644
--- a/src/generators/server-side-rendering/index.ts
+++ b/src/generators/server-side-rendering/index.ts
@@ -131,6 +131,7 @@ export default function ssr(
 
 		${name}._render = function(__result, state, options) {
 			__result.addComponent(${name});
+			${templateProperties.store && `options.store = options.store || %store();`}
 
 			state = Object.assign(${initialState.join(', ')});
 

2025-11-12 14:04:18,309 - thread-135845298308800.prometheus.lang_graph.nodes.git_reset_node - DEBUG - Resetting the git repository
2025-11-12 14:04:18,338 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - INFO - Enter bug_fix_verification_subgraph_node
2025-11-12 14:04:18,339 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproduced_bug_file: test/server-side-rendering/nested-component-store.spec.js
2025-11-12 14:04:18,339 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproduced_bug_commands: ['npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js']
2025-11-12 14:04:18,339 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproduced_bug_patch: diff --git a/test/server-side-rendering/nested-component-store.spec.js b/test/server-side-rendering/nested-component-store.spec.js
new file mode 100644
index 000000000..4f51c982c
--- /dev/null
+++ b/test/server-side-rendering/nested-component-store.spec.js
@@ -0,0 +1,86 @@
+import assert from 'assert';
+import { loadSvelte, setupHtmlEqual } from '../helpers.js';
+
+describe('ssr nested component store via connect', () => {
+  let svelte;
+
+  before(() => {
+    svelte = loadSvelte(true);
+    setupHtmlEqual();
+  });
+
+  function compileCjs(source, options) {
+    const { code } = svelte.compile(source, Object.assign({ format: 'cjs' }, options));
+    const module = { exports: {} };
+    const exports = module.exports;
+    const fn = new Function('module', 'exports', 'TwoFactorAuth', `${code}; return module.exports;`);
+    return {
+      evalWith(scope = {}) {
+        return fn(module, exports, scope.TwoFactorAuth);
+      }
+    };
+  }
+
+  it('server renders nested component with connect()-provided store', () => {
+    const childSource = `
+{{#if $hasTwoFactor}}
+<div>yay its enabled</div>
+{{else}}
+<div>oh no its not enabled</div>
+{{/if}}
+
+<script>
+  // Minimal inline connect to mirror svelte-redux's connect API for SSR
+  function connect(mapFn) {
+    return {
+      _init(keys) {
+        const mapped = mapFn({}); // emulate empty Redux state on server
+        const state = {};
+        keys.forEach(k => { state[k] = mapped[k]; });
+        return state;
+      }
+    };
+  }
+
+  export default {
+    store: connect(state => ({
+      hasTwoFactor: state.user && state.user.hasTwoFactor,
+    })),
+  };
+</script>
+    `;
+
+    const parentSource = `
+<div class="page">
+  <h1>Manage Account</h1>
+  <div>
+    <h3>Two Factor Auth</h3>
+    <TwoFactorAuth/>
+  </div>
+</div>
+
+<script>
+  export default {
+    components: { TwoFactorAuth }
+  };
+</script>
+    `;
+
+    // Compile child (TwoFactorAuth) for SSR
+    const childMod = compileCjs(childSource, { generate: 'ssr', name: 'TwoFactorAuth', store: true }).evalWith();
+    const TwoFactorAuth = childMod.default || childMod;
+
+    // Compile parent for SSR, injecting the child component via components mapping
+    const parentMod = compileCjs(parentSource, { generate: 'ssr', name: 'ManageAccount', store: true }).evalWith({ TwoFactorAuth });
+    const Parent = parentMod.default || parentMod;
+
+    // Reproduce the exact SSR issue by passing an options object (with no store) to Parent.render
+    // This currently throws: "Cannot read property '_init' of undefined"
+    const { html } = Parent.render(null, {});
+
+    assert.htmlEqual(
+      html,
+      '<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>'
+    );
+  });
+});

2025-11-12 14:04:18,339 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - edit_patch: diff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts
index 37bf859da..2fd4c2c14 100644
--- a/src/generators/server-side-rendering/index.ts
+++ b/src/generators/server-side-rendering/index.ts
@@ -131,6 +131,7 @@ export default function ssr(
 
 		${name}._render = function(__result, state, options) {
 			__result.addComponent(${name});
+			${templateProperties.store && `options.store = options.store || %store();`}
 
 			state = Object.assign(${initialState.join(', ')});
 

2025-11-12 14:04:18,340 - thread-135845298308800.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Applying patch: diff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts
index 37bf859da..2fd4c2c14 100644
--- a/src/generators/server-side-rendering/index.ts
+++ b/src/generators/server-side-rendering/index.ts
@@ -131,6 +131,7 @@ export default function ssr(
 
 		${name}._render = function(__result, state, options) {
 			__result.addComponent(${name});
+			${templateProperties.store && `options.store = options.store || %store();`}
 
 			state = Object.assign(${initialState.join(', ')});
 

2025-11-12 14:04:18,343 - thread-135845298308800.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Patch applied successfully.
2025-11-12 14:04:18,343 - thread-135845298308800.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Applying patch: diff --git a/test/server-side-rendering/nested-component-store.spec.js b/test/server-side-rendering/nested-component-store.spec.js
new file mode 100644
index 000000000..4f51c982c
--- /dev/null
+++ b/test/server-side-rendering/nested-component-store.spec.js
@@ -0,0 +1,86 @@
+import assert from 'assert';
+import { loadSvelte, setupHtmlEqual } from '../helpers.js';
+
+describe('ssr nested component store via connect', () => {
+  let svelte;
+
+  before(() => {
+    svelte = loadSvelte(true);
+    setupHtmlEqual();
+  });
+
+  function compileCjs(source, options) {
+    const { code } = svelte.compile(source, Object.assign({ format: 'cjs' }, options));
+    const module = { exports: {} };
+    const exports = module.exports;
+    const fn = new Function('module', 'exports', 'TwoFactorAuth', `${code}; return module.exports;`);
+    return {
+      evalWith(scope = {}) {
+        return fn(module, exports, scope.TwoFactorAuth);
+      }
+    };
+  }
+
+  it('server renders nested component with connect()-provided store', () => {
+    const childSource = `
+{{#if $hasTwoFactor}}
+<div>yay its enabled</div>
+{{else}}
+<div>oh no its not enabled</div>
+{{/if}}
+
+<script>
+  // Minimal inline connect to mirror svelte-redux's connect API for SSR
+  function connect(mapFn) {
+    return {
+      _init(keys) {
+        const mapped = mapFn({}); // emulate empty Redux state on server
+        const state = {};
+        keys.forEach(k => { state[k] = mapped[k]; });
+        return state;
+      }
+    };
+  }
+
+  export default {
+    store: connect(state => ({
+      hasTwoFactor: state.user && state.user.hasTwoFactor,
+    })),
+  };
+</script>
+    `;
+
+    const parentSource = `
+<div class="page">
+  <h1>Manage Account</h1>
+  <div>
+    <h3>Two Factor Auth</h3>
+    <TwoFactorAuth/>
+  </div>
+</div>
+
+<script>
+  export default {
+    components: { TwoFactorAuth }
+  };
+</script>
+    `;
+
+    // Compile child (TwoFactorAuth) for SSR
+    const childMod = compileCjs(childSource, { generate: 'ssr', name: 'TwoFactorAuth', store: true }).evalWith();
+    const TwoFactorAuth = childMod.default || childMod;
+
+    // Compile parent for SSR, injecting the child component via components mapping
+    const parentMod = compileCjs(parentSource, { generate: 'ssr', name: 'ManageAccount', store: true }).evalWith({ TwoFactorAuth });
+    const Parent = parentMod.default || parentMod;
+
+    // Reproduce the exact SSR issue by passing an options object (with no store) to Parent.render
+    // This currently throws: "Cannot read property '_init' of undefined"
+    const { html } = Parent.render(null, {});
+
+    assert.htmlEqual(
+      html,
+      '<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>'
+    );
+  });
+});

2025-11-12 14:04:18,346 - thread-135845298308800.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Patch applied successfully.
2025-11-12 14:04:18,347 - thread-135845298308800.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-12 14:04:18,381 - thread-135845298308800.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-12 14:04:18,381 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-12 14:04:18,483 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:04:18,483 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 8057884cb Merge pull request #1097 from sveltejs/gh-1082-b
[?2004l
2025-11-12 14:04:18,483 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-12 14:04:18,585 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:04:18,585 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing test/server-side-rendering/nested-component-store.spec.js
[?2004l
2025-11-12 14:04:18,587 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-12 14:04:18,587 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory src/generators/server-side-rendering in the container
2025-11-12 14:04:18,587 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p src/generators/server-side-rendering
2025-11-12 14:04:18,688 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:04:18,689 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 14:04:18,689 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory test/server-side-rendering in the container
2025-11-12 14:04:18,689 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p test/server-side-rendering
2025-11-12 14:04:18,790 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:04:18,791 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 14:04:18,791 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/nested-component-store.spec.js in the container
2025-11-12 14:04:18,792 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating src/generators/server-side-rendering/index.ts in the container
2025-11-12 14:04:18,800 - thread-135845298308800.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-12 14:04:20,617 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verify_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_uR8F6qKi3IomlUPXiGFoFpoa', 'function': {'arguments': '{"command":"npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 52, 'prompt_tokens': 466, 'total_tokens': 518, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2fc2ac92-ac27-461d-86b9-3924e8f213c3-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js'}, 'id': 'call_uR8F6qKi3IomlUPXiGFoFpoa', 'type': 'tool_call'}] usage_metadata={'input_tokens': 466, 'output_tokens': 52, 'total_tokens': 518, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:04:20,620 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js
2025-11-12 14:04:27,031 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 14:04:27,031 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 npm run build && node ./node_modules/mocha/bin/mocha 
 --require test/setup.js test/server-side-rendering/nested-component-store.spec.j
js
[?2004l

> svelte@1.51.1 build
> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m4.6s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m34ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m37ms[22m[39m
[36m[39m
[36m[1mstore.js[22m → [1mstore.umd.js[22m...[39m
[32mcreated [1mstore.umd.js[22m in [1m84ms[22m[39m

[0m[0m
[0m  ssr nested component store via connect[0m
  [31m  1) server renders nested component with connect()-provided store[0m


[92m [0m[32m 0 passing[0m[90m (51ms)[0m
[31m  1 failing[0m

[0m  1) ssr nested component store via connect server renders nested component with connect()-provided store:
[0m[31m     TypeError: store$ is not a function[0m[90m
      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:52:35)
      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)
      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)
      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)
      at processImmediate (node:internal/timers:466:21)
[0m


[?2004l
2025-11-12 14:04:44,797 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verify_node - DEBUG - content='Result:\n npm run build && node ./node_modules/mocha/bin/mocha \n --require test/setup.js test/server-side-rendering/nested-component-store.spec.j\njs\n\x1b[?2004l\n\n> svelte@1.51.1 build\n> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js\n\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/index.ts\x1b[22m → \x1b[1mcompiler/svelte.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mcompiler/svelte.js\x1b[22m in \x1b[1m4.6s\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/server-side-rendering/register.js\x1b[22m → \x1b[1mssr/register.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mssr/register.js\x1b[22m in \x1b[1m34ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/shared/index.js\x1b[22m → \x1b[1mshared.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mshared.js\x1b[22m in \x1b[1m37ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1mstore.js\x1b[22m → \x1b[1mstore.umd.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mstore.umd.js\x1b[22m in \x1b[1m84ms\x1b[22m\x1b[39m\n\n\x1b[0m\x1b[0m\n\x1b[0m  ssr nested component store via connect\x1b[0m\n  \x1b[31m  1) server renders nested component with connect()-provided store\x1b[0m\n\n\n\x1b[92m \x1b[0m\x1b[32m 0 passing\x1b[0m\x1b[90m (51ms)\x1b[0m\n\x1b[31m  1 failing\x1b[0m\n\n\x1b[0m  1) ssr nested component store via connect server renders nested component with connect()-provided store:\n\x1b[0m\x1b[31m     TypeError: store$ is not a function\x1b[0m\x1b[90m\n      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:52:35)\n      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)\n      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)\n      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)\n      at processImmediate (node:internal/timers:466:21)\n\x1b[0m\n\n\n\x1b[?2004l' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1998, 'prompt_tokens': 1228, 'total_tokens': 3226, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1280, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--645ebdee-4b7b-4c13-bd75-23078858fc1e-0' usage_metadata={'input_tokens': 1228, 'output_tokens': 1998, 'total_tokens': 3226, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1280}}
2025-11-12 14:05:04,640 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verify_structured_node - DEBUG - reproducing_test_fail_log='Result:\n npm run build && node ./node_modules/mocha/bin/mocha \n --require test/setup.js test/server-side-rendering/nested-component-store.spec.j\njs\n\x1b[?2004l\n\n> svelte@1.51.1 build\n> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js\n\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/index.ts\x1b[22m \x1b[0m\x1b[1mcompiler/svelte.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mcompiler/svelte.js\x1b[22m in \x1b[1m4.6s\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/server-side-rendering/register.js\x1b[22m \x1b[0m\x1b[1mssr/register.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mssr/register.js\x1b[22m in \x1b[1m34ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/shared/index.js\x1b[22m \x1b[0m\x1b[1mshared.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mshared.js\x1b[22m in \x1b[1m37ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1mstore.js\x1b[22m \x1b[0m\x1b[1mstore.umd.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mstore.umd.js\x1b[22m in \x1b[1m84ms\x1b[22m\x1b[39m\n\n\x1b[0m\x1b[0m\n\x1b[0m  ssr nested component store via connect\x1b[0m\n  \x1b[31m  1) server renders nested component with connect()-provided store\x1b[0m\n\n\n\x1b[92m \x1b[0m\x1b[32m 0 passing\x1b[0m\x1b[90m (51ms)\x1b[0m\n\x1b[31m  1 failing\x1b[0m\n\n\x1b[0m  1) ssr nested component store via connect server renders nested component with connect()-provided store:\n\x1b[0m\x1b[31m     TypeError: store$ is not a function\x1b[0m\x1b[90m\n      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:52:35)\n      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)\n      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)\n      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)\n      at processImmediate (node:internal/timers:466:21)\n\x1b[0m\n\n\x1b[?2004l'
2025-11-12 14:05:04,676 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - INFO - Passing bug reproducing test: False
2025-11-12 14:05:04,676 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproducing_test_fail_log: Result:
 npm run build && node ./node_modules/mocha/bin/mocha 
 --require test/setup.js test/server-side-rendering/nested-component-store.spec.j
js
[?2004l

> svelte@1.51.1 build
> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js

[36m[39m
[36m[1msrc/index.ts[22m [0m[1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m4.6s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m [0m[1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m34ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m [0m[1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m37ms[22m[39m
[36m[39m
[36m[1mstore.js[22m [0m[1mstore.umd.js[22m...[39m
[32mcreated [1mstore.umd.js[22m in [1m84ms[22m[39m

[0m[0m
[0m  ssr nested component store via connect[0m
  [31m  1) server renders nested component with connect()-provided store[0m


[92m [0m[32m 0 passing[0m[90m (51ms)[0m
[31m  1 failing[0m

[0m  1) ssr nested component store via connect server renders nested component with connect()-provided store:
[0m[31m     TypeError: store$ is not a function[0m[90m
      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:52:35)
      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)
      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)
      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)
      at processImmediate (node:internal/timers:466:21)
[0m

[?2004l
2025-11-12 14:05:04,679 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_analyzer_message_node - DEBUG - Sending message to IssueBugAnalyzerNode:
content='Given your suggestion, the edit agent generated the following patch:\ndiff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts\nindex 37bf859da..2fd4c2c14 100644\n--- a/src/generators/server-side-rendering/index.ts\n+++ b/src/generators/server-side-rendering/index.ts\n@@ -131,6 +131,7 @@ export default function ssr(\n \n \t\t${name}._render = function(__result, state, options) {\n \t\t\t__result.addComponent(${name});\n+\t\t\t${templateProperties.store && `options.store = options.store || %store();`}\n \n \t\t\tstate = Object.assign(${initialState.join(\', \')});\n \n\n\nThe patch generated following error:\nThe patch failed to pass the bug exposing test cases:\nResult:\n npm run build && node ./node_modules/mocha/bin/mocha \n --require test/setup.js test/server-side-rendering/nested-component-store.spec.j\njs\n\x1b[?2004l\n\n> svelte@1.51.1 build\n> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js\n\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/index.ts\x1b[22m \x1b[0m\x1b[1mcompiler/svelte.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mcompiler/svelte.js\x1b[22m in \x1b[1m4.6s\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/server-side-rendering/register.js\x1b[22m \x1b[0m\x1b[1mssr/register.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mssr/register.js\x1b[22m in \x1b[1m34ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/shared/index.js\x1b[22m \x1b[0m\x1b[1mshared.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mshared.js\x1b[22m in \x1b[1m37ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1mstore.js\x1b[22m \x1b[0m\x1b[1mstore.umd.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mstore.umd.js\x1b[22m in \x1b[1m84ms\x1b[22m\x1b[39m\n\n\x1b[0m\x1b[0m\n\x1b[0m  ssr nested component store via connect\x1b[0m\n  \x1b[31m  1) server renders nested component with connect()-provided store\x1b[0m\n\n\n\x1b[92m \x1b[0m\x1b[32m 0 passing\x1b[0m\x1b[90m (51ms)\x1b[0m\n\x1b[31m  1 failing\x1b[0m\n\n\x1b[0m  1) ssr nested component store via connect server renders nested component with connect()-provided store:\n\x1b[0m\x1b[31m     TypeError: store$ is not a function\x1b[0m\x1b[90m\n      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:52:35)\n      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)\n      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)\n      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)\n      at processImmediate (node:internal/timers:466:21)\n\x1b[0m\n\n\x1b[?2004l\n\nPlease analyze the failure and provide a revised suggestion:\n\n1. Error Analysis:\n- Explain why the previous changes failed\n- Identify what specific aspects were problematic\n\n2. Revised Fix Suggestion:\nDescribe in plain English:\n- Which file needs to be modified\n- Which function or code block needs changes\n- What needs to be changed (e.g., "rename variable x to y", "add null check for parameter z")\n- Why this change would fix both the original issue and the new error\n\nDo NOT provide actual code snippets or diffs. Focus on describing what needs to be changed.\n' additional_kwargs={} response_metadata={}
2025-11-12 14:06:03,701 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_analyzer_node - DEBUG - content="1) Error Analysis\n\n- Why the previous changes failed:\n  - The patch added a call to %store() inside each component’s _render function. In the failing test, within the nested component (TwoFactorAuth), %store expanded to a symbol (store$) that was not a callable function at runtime in that context, causing “TypeError: store$ is not a function”.\n  - The original design initializes options.store inside render (not _render) only when the component declares a store. Nested components are invoked via _render, so your change tried to replicate that initialization. However, %store in _render does not reliably refer to a callable factory; depending on how the template variables are mapped for the generated module, invoking %store() there can reference a non-function placeholder (e.g., an alias to a value rather than a function), leading to the runtime TypeError.\n\n- Problematic aspects:\n  - Initializing options.store inside _render using %store() is brittle and depends on the template variable expansion being a function in all contexts, which is not guaranteed for nested components.\n  - The initial state construction still uses options.store._init(...) based on compile-time conditions, so it can attempt to dereference options.store even when undefined at runtime.\n  - Nested component invocation only forwards store: options.store, and doesn’t establish a fallback to construct a child-specific store if the parent did not supply one.\n\n\n2) Revised Fix Suggestion\n\nChange A: Make initial state store usage robust at runtime\n- File: src/generators/server-side-rendering/index.ts\n- Function/code block: Generation of the initialState array and the Object.assign call within the generated _render function.\n- What to change:\n  - Adjust the logic that adds store-derived initial state so that calling _init on options.store is guarded at runtime. Instead of emitting an unconditional options.store._init([...]) when (options.store || templateProperties.store) is true at compile time, emit an expression that only calls _init if options.store is truthy at runtime and otherwise contributes an empty object to Object.assign.\n  - Do not add any new call to %store() inside _render; remove/avoid the previously added initialization in _render.\n- Why this fixes issues:\n  - Prevents “Cannot read property '_init' of undefined” when a nested component expects $-props but no store was passed in. Object.assign will receive {} in that case rather than attempting to call _init on undefined.\n  - Avoids the new “store$ is not a function” error by no longer invoking %store() inside _render.\n\nChange B: Provide a store fallback when rendering nested components\n- File: src/generators/server-side-rendering/visitors/Component.ts\n- Function/code block: visitComponent, specifically the construction of the options passed to child._render (the options array and the “open” string building).\n- What to change:\n  - Update the logic that currently adds “store: options.store” (only when generator.options.store is enabled) to include a fallback for when options.store is missing. Pass an expression that uses the parent’s store if present, otherwise initializes a child-specific store by invoking the child component’s store factory if it exists.\n  - Concretely: supply an options.store value that resolves to options.store when defined, or to a guarded call to the child component’s .store function if present. Guard against the child lacking a store property (check the existence of the .store function before calling).\n- Why this fixes issues:\n  - Ensures nested components that declare a store (e.g., via connect(...)) get a valid store instance during SSR even if the parent did not supply one, so their $-bound properties are available.\n  - Keeps behavior correct for children that do not declare a store — the guard prevents attempting to call an undefined .store() — and avoids reliance on %store() inside _render where it may not be callable.\n\nChange C: Revert the previous injection into _render\n- File: src/generators/server-side-rendering/index.ts\n- Function/code block: The early line added inside the generated _render function to initialize options.store using %store().\n- What to change:\n  - Remove the earlier “options.store = options.store || %store();” injection from _render. The store initialization for components that themselves declare a store should remain in render, as originally designed.\n- Why:\n  - Avoids the runtime “store$ is not a function” error that occurs when invoking %store() in nested _render contexts.\n  - Keeps store initialization centralized and reliable, while nested component invocation (Change B) supplies the correct store to children.\n\nWith these changes:\n- The original SSR crash due to undefined options.store when computing $-props is avoided by guarding the store init in initial state assembly (Change A).\n- Nested components that define store via connect will receive a valid store during SSR through the options fallback in the parent’s generated call (Change B), without invoking %store() inside _render (Change C), thereby preventing the new TypeError." additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 5977, 'prompt_tokens': 20280, 'total_tokens': 26257, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 4928, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--96d3eac4-85fd-417b-bf36-2b5bcfe2ad02-0' usage_metadata={'input_tokens': 20280, 'output_tokens': 5977, 'total_tokens': 26257, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 4928}}
2025-11-12 14:06:03,705 - thread-135845298308800.prometheus.lang_graph.nodes.edit_message_node - DEBUG - Sending message to EditNode:
content="The edit that you generated following error:\n--- BEGIN EDIT ERROR ---\nYour failed to pass the bug exposing test cases:\nResult:\n npm run build && node ./node_modules/mocha/bin/mocha \n --require test/setup.js test/server-side-rendering/nested-component-store.spec.j\njs\n\x1b[?2004l\n\n> svelte@1.51.1 build\n> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js\n\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/index.ts\x1b[22m \x1b[0m\x1b[1mcompiler/svelte.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mcompiler/svelte.js\x1b[22m in \x1b[1m4.6s\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/server-side-rendering/register.js\x1b[22m \x1b[0m\x1b[1mssr/register.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mssr/register.js\x1b[22m in \x1b[1m34ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1msrc/shared/index.js\x1b[22m \x1b[0m\x1b[1mshared.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mshared.js\x1b[22m in \x1b[1m37ms\x1b[22m\x1b[39m\n\x1b[36m\x1b[39m\n\x1b[36m\x1b[1mstore.js\x1b[22m \x1b[0m\x1b[1mstore.umd.js\x1b[22m...\x1b[39m\n\x1b[32mcreated \x1b[1mstore.umd.js\x1b[22m in \x1b[1m84ms\x1b[22m\x1b[39m\n\n\x1b[0m\x1b[0m\n\x1b[0m  ssr nested component store via connect\x1b[0m\n  \x1b[31m  1) server renders nested component with connect()-provided store\x1b[0m\n\n\n\x1b[92m \x1b[0m\x1b[32m 0 passing\x1b[0m\x1b[90m (51ms)\x1b[0m\n\x1b[31m  1 failing\x1b[0m\n\n\x1b[0m  1) ssr nested component store via connect server renders nested component with connect()-provided store:\n\x1b[0m\x1b[31m     TypeError: store$ is not a function\x1b[0m\x1b[90m\n      at Object.TwoFactorAuth$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:52:35)\n      at Object.ManageAccount$._render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:42:21)\n      at Object.ManageAccount$.render (eval at compileCjs (test/server-side-rendering/nested-component-store.spec.js:16:16), <anonymous>:19:28)\n      at Context.<anonymous> (test/server-side-rendering/nested-component-store.spec.js:79:29)\n      at processImmediate (node:internal/timers:466:21)\n\x1b[0m\n\n\x1b[?2004l\n--- END EDIT ERROR ---\n\nAnalyzer agent has analyzed the issue and provided instruction on the issue:\n--- BEGIN ANALYZER MESSAGE ---\n1) Error Analysis\n\n- Why the previous changes failed:\n  - The patch added a call to %store() inside each component’s _render function. In the failing test, within the nested component (TwoFactorAuth), %store expanded to a symbol (store$) that was not a callable function at runtime in that context, causing “TypeError: store$ is not a function”.\n  - The original design initializes options.store inside render (not _render) only when the component declares a store. Nested components are invoked via _render, so your change tried to replicate that initialization. However, %store in _render does not reliably refer to a callable factory; depending on how the template variables are mapped for the generated module, invoking %store() there can reference a non-function placeholder (e.g., an alias to a value rather than a function), leading to the runtime TypeError.\n\n- Problematic aspects:\n  - Initializing options.store inside _render using %store() is brittle and depends on the template variable expansion being a function in all contexts, which is not guaranteed for nested components.\n  - The initial state construction still uses options.store._init(...) based on compile-time conditions, so it can attempt to dereference options.store even when undefined at runtime.\n  - Nested component invocation only forwards store: options.store, and doesn’t establish a fallback to construct a child-specific store if the parent did not supply one.\n\n\n2) Revised Fix Suggestion\n\nChange A: Make initial state store usage robust at runtime\n- File: src/generators/server-side-rendering/index.ts\n- Function/code block: Generation of the initialState array and the Object.assign call within the generated _render function.\n- What to change:\n  - Adjust the logic that adds store-derived initial state so that calling _init on options.store is guarded at runtime. Instead of emitting an unconditional options.store._init([...]) when (options.store || templateProperties.store) is true at compile time, emit an expression that only calls _init if options.store is truthy at runtime and otherwise contributes an empty object to Object.assign.\n  - Do not add any new call to %store() inside _render; remove/avoid the previously added initialization in _render.\n- Why this fixes issues:\n  - Prevents “Cannot read property '_init' of undefined” when a nested component expects $-props but no store was passed in. Object.assign will receive {} in that case rather than attempting to call _init on undefined.\n  - Avoids the new “store$ is not a function” error by no longer invoking %store() inside _render.\n\nChange B: Provide a store fallback when rendering nested components\n- File: src/generators/server-side-rendering/visitors/Component.ts\n- Function/code block: visitComponent, specifically the construction of the options passed to child._render (the options array and the “open” string building).\n- What to change:\n  - Update the logic that currently adds “store: options.store” (only when generator.options.store is enabled) to include a fallback for when options.store is missing. Pass an expression that uses the parent’s store if present, otherwise initializes a child-specific store by invoking the child component’s store factory if it exists.\n  - Concretely: supply an options.store value that resolves to options.store when defined, or to a guarded call to the child component’s .store function if present. Guard against the child lacking a store property (check the existence of the .store function before calling).\n- Why this fixes issues:\n  - Ensures nested components that declare a store (e.g., via connect(...)) get a valid store instance during SSR even if the parent did not supply one, so their $-bound properties are available.\n  - Keeps behavior correct for children that do not declare a store — the guard prevents attempting to call an undefined .store() — and avoids reliance on %store() inside _render where it may not be callable.\n\nChange C: Revert the previous injection into _render\n- File: src/generators/server-side-rendering/index.ts\n- Function/code block: The early line added inside the generated _render function to initialize options.store using %store().\n- What to change:\n  - Remove the earlier “options.store = options.store || %store();” injection from _render. The store initialization for components that themselves declare a store should remain in render, as originally designed.\n- Why:\n  - Avoids the runtime “store$ is not a function” error that occurs when invoking %store() in nested _render contexts.\n  - Keeps store initialization centralized and reliable, while nested component invocation (Change B) supplies the correct store to children.\n\nWith these changes:\n- The original SSR crash due to undefined options.store when computing $-props is avoided by guarding the store init in initial state assembly (Change A).\n- Nested components that define store via connect will receive a valid store during SSR through the options fallback in the parent’s generated call (Change B), without invoking %store() inside _render (Change C), thereby preventing the new TypeError.\n--- END ANALYZER MESSAGE ---\n\nPlease implement these revised changes carefully, ensuring you address the specific issues that caused the previous error.\n" additional_kwargs={} response_metadata={}
2025-11-12 14:07:28,340 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zSGDCjPPfSqmD9G3LnvdN4jn', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts","old_content":"\\t\\t\\t${templateProperties.store && `options.store = options.store || %store();`}","new_content":"\\t\\t\\t${templateProperties.store && `options.store = options.store || (typeof %store === \'function\' ? %store() : %store);`}"}', 'name': 'edit_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 5599, 'prompt_tokens': 26772, 'total_tokens': 32371, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 5504, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 19712}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c045ea62-0c90-44b3-b052-3e4a9c4306d7-0' tool_calls=[{'name': 'edit_file', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts', 'old_content': '\t\t\t${templateProperties.store && `options.store = options.store || %store();`}', 'new_content': "\t\t\t${templateProperties.store && `options.store = options.store || (typeof %store === 'function' ? %store() : %store);`}"}, 'id': 'call_zSGDCjPPfSqmD9G3LnvdN4jn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26772, 'output_tokens': 5599, 'total_tokens': 32371, 'input_token_details': {'audio': 0, 'cache_read': 19712}, 'output_token_details': {'audio': 0, 'reasoning': 5504}}
2025-11-12 14:08:07,866 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_K1WUnCc5Cz2gPkJydM2q0LUJ', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/Component.ts"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2919, 'prompt_tokens': 26897, 'total_tokens': 29816, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2880, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--aaceedff-483f-4b79-af02-d8245635f098-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/Component.ts'}, 'id': 'call_K1WUnCc5Cz2gPkJydM2q0LUJ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26897, 'output_tokens': 2919, 'total_tokens': 29816, 'input_token_details': {'audio': 0, 'cache_read': 1280}, 'output_token_details': {'audio': 0, 'reasoning': 2880}}
2025-11-12 14:08:33,108 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_AXFcFVFZfhEYxTkjfUKOHFSR', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts","old_content":"\\t\\t\\t${templateProperties.store && `options.store = options.store || %store();`}\\n","new_content":""}', 'name': 'edit_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2370, 'prompt_tokens': 28023, 'total_tokens': 30393, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2304, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--db7f0c32-579a-44bb-a847-1facc88563ec-0' tool_calls=[{'name': 'edit_file', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts', 'old_content': '\t\t\t${templateProperties.store && `options.store = options.store || %store();`}\n', 'new_content': ''}, 'id': 'call_AXFcFVFZfhEYxTkjfUKOHFSR', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28023, 'output_tokens': 2370, 'total_tokens': 30393, 'input_token_details': {'audio': 0, 'cache_read': 1280}, 'output_token_details': {'audio': 0, 'reasoning': 2304}}
2025-11-12 14:08:56,391 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3IWXCKFjxxKsc1kMnvUkHEwP', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts","old_content":"\\t\\t\\t${templateProperties.store && `options.store = options.store || %store();`}","new_content":""}', 'name': 'edit_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2815, 'prompt_tokens': 28118, 'total_tokens': 30933, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2752, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1280}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6214259e-735f-477f-87cf-729bb47dc91c-0' tool_calls=[{'name': 'edit_file', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts', 'old_content': '\t\t\t${templateProperties.store && `options.store = options.store || %store();`}', 'new_content': ''}, 'id': 'call_3IWXCKFjxxKsc1kMnvUkHEwP', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28118, 'output_tokens': 2815, 'total_tokens': 30933, 'input_token_details': {'audio': 0, 'cache_read': 1280}, 'output_token_details': {'audio': 0, 'reasoning': 2752}}
2025-11-12 14:09:00,297 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_aca4E9vVoQJAnIGBAr8yoZF4', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts","start_line":120,"end_line":140}', 'name': 'read_file_with_line_numbers'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 239, 'prompt_tokens': 28211, 'total_tokens': 28450, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 24704}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--033c7655-91b6-4d50-8511-403a44a026b9-0' tool_calls=[{'name': 'read_file_with_line_numbers', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts', 'start_line': 120, 'end_line': 140}, 'id': 'call_aca4E9vVoQJAnIGBAr8yoZF4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28211, 'output_tokens': 239, 'total_tokens': 28450, 'input_token_details': {'audio': 0, 'cache_read': 24704}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 14:09:21,812 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_wiCaeSJ7VzgIRXtjGng6OldV', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts","old_content":"\\t\\tif (storeProps.length > 0) {\\n\\t\\t\\tconst initialize = `_init([${storeProps.map(prop => `\\"${prop.slice(1)}\\"`)}])`\\n\\t\\t\\tif (options.store || templateProperties.store) {\\n\\t\\t\\t\\tinitialState.push(`options.store.${initialize}`);\\n\\t\\t\\t}\\n\\t\\t}\\n","new_content":"\\t\\tif (storeProps.length > 0) {\\n\\t\\t\\tconst initialize = `_init([${storeProps.map(prop => `\\"${prop.slice(1)}\\"`)}])`\\n\\t\\t\\tinitialState.push(`options.store ? options.store.${initialize} : {}`);\\n\\t\\t}\\n"}', 'name': 'edit_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1726, 'prompt_tokens': 28462, 'total_tokens': 30188, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1536, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 26752}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--39571e68-12fa-4927-965d-c7a5a38f8e6a-0' tool_calls=[{'name': 'edit_file', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts', 'old_content': '\t\tif (storeProps.length > 0) {\n\t\t\tconst initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`\n\t\t\tif (options.store || templateProperties.store) {\n\t\t\t\tinitialState.push(`options.store.${initialize}`);\n\t\t\t}\n\t\t}\n', 'new_content': '\t\tif (storeProps.length > 0) {\n\t\t\tconst initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`\n\t\t\tinitialState.push(`options.store ? options.store.${initialize} : {}`);\n\t\t}\n'}, 'id': 'call_wiCaeSJ7VzgIRXtjGng6OldV', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28462, 'output_tokens': 1726, 'total_tokens': 30188, 'input_token_details': {'audio': 0, 'cache_read': 26752}, 'output_token_details': {'audio': 0, 'reasoning': 1536}}
2025-11-12 14:09:39,700 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_MRbKASphBzksISbt70xzRcTl', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts","old_content":"\\n\\tif (storeProps.length > 0) {\\n\\t\\tconst initialize = `_init([${storeProps.map(prop => `\\"${prop.slice(1)}\\"`)}])`\\n\\t\\tif (options.store || templateProperties.store) {\\n\\t\\t\\tinitialState.push(`options.store.${initialize}`);\\n\\t\\t}\\n\\t}\\n","new_content":"\\n\\tif (storeProps.length > 0) {\\n\\t\\tconst initialize = `_init([${storeProps.map(prop => `\\"${prop.slice(1)}\\"`)}])`\\n\\t\\tinitialState.push(`options.store ? options.store.${initialize} : {}`);\\n\\t}\\n"}', 'name': 'edit_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1718, 'prompt_tokens': 28682, 'total_tokens': 30400, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1536, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cb894c4f-179e-4783-8c16-b2c4900ff100-0' tool_calls=[{'name': 'edit_file', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts', 'old_content': '\n\tif (storeProps.length > 0) {\n\t\tconst initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`\n\t\tif (options.store || templateProperties.store) {\n\t\t\tinitialState.push(`options.store.${initialize}`);\n\t\t}\n\t}\n', 'new_content': '\n\tif (storeProps.length > 0) {\n\t\tconst initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`\n\t\tinitialState.push(`options.store ? options.store.${initialize} : {}`);\n\t}\n'}, 'id': 'call_MRbKASphBzksISbt70xzRcTl', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28682, 'output_tokens': 1718, 'total_tokens': 30400, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1536}}
2025-11-12 14:09:42,870 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fb6Kbhk6U3i1aUUstemGQx1Y', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/index.ts"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 28881, 'total_tokens': 28909, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--306c855b-f41e-4eed-ab1c-deeeed0f6b9d-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'src/generators/server-side-rendering/index.ts'}, 'id': 'call_fb6Kbhk6U3i1aUUstemGQx1Y', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28881, 'output_tokens': 28, 'total_tokens': 28909, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:09:45,678 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_coUT1l0rAqD14Msy9a4ogEmT', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/Component.ts","old_content":"\\tif (generator.options.store) {\\n\\t\\toptions.push(`store: options.store`);\\n\\t}\\n","new_content":"\\tif (generator.options.store) {\\n\\t\\toptions.push(`store: (options.store || (${expression}.store && ${expression}.store()))`);\\n\\t}\\n"}', 'name': 'edit_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 102, 'prompt_tokens': 31331, 'total_tokens': 31433, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 28800}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--759d00ba-a1c4-4a87-a4d1-94b51df6e4dc-0' tool_calls=[{'name': 'edit_file', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/Component.ts', 'old_content': '\tif (generator.options.store) {\n\t\toptions.push(`store: options.store`);\n\t}\n', 'new_content': '\tif (generator.options.store) {\n\t\toptions.push(`store: (options.store || (${expression}.store && ${expression}.store()))`);\n\t}\n'}, 'id': 'call_coUT1l0rAqD14Msy9a4ogEmT', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31331, 'output_tokens': 102, 'total_tokens': 31433, 'input_token_details': {'audio': 0, 'cache_read': 28800}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:09:47,439 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Tc60VpC0LQUDc4tO6DzZjAbn', 'function': {'arguments': '{"relative_path":"src/generators/server-side-rendering/visitors/Component.ts"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 32, 'prompt_tokens': 31460, 'total_tokens': 31492, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 28160}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1e7f537e-f616-4587-9010-5c29703863d5-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'src/generators/server-side-rendering/visitors/Component.ts'}, 'id': 'call_Tc60VpC0LQUDc4tO6DzZjAbn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31460, 'output_tokens': 32, 'total_tokens': 31492, 'input_token_details': {'audio': 0, 'cache_read': 28160}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:10:37,353 - thread-135845298308800.prometheus.lang_graph.nodes.edit_node - DEBUG - content="Thanks for the report. I’ve adjusted the SSR code generation so nested components that declare a store will no longer crash when rendered on the server.\n\nWhat I changed:\n- Guarded store initialization in initial state assembly\n  - In src/generators/server-side-rendering/index.ts, when assembling initial state for $-prefixed props, the code now uses:\n    options.store ? options.store._init([...]) : {}\n  - This prevents attempting to access _init on an undefined store during SSR, avoiding the original “Cannot read property '_init' of undefined” error.\n\n- Provide a safer store option for nested component SSR calls\n  - In src/generators/server-side-rendering/visitors/Component.ts, nested component calls now pass:\n    store: (options.store || (ChildExpression.store && ChildExpression.store()))\n  - This tries to use the parent’s store if available; otherwise, if the child component has a store factory exposed, it will use that. If neither is present, it passes undefined, which is safe due to the initial-state guard above.\n\nImportant: I removed the previously attempted store initialization inside each component’s _render. That earlier approach caused a “store$ is not a function” error in tests. The new approach avoids invoking %store() in _render and instead ensures we don’t dereference an undefined store and optionally pick up a child-provided store when available.\n\nIf anything still misbehaves in your specific setup, let me know the details of how the store is provided in the nested child (e.g., connect behavior) and I’ll refine the option-passing accordingly." additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 4114, 'prompt_tokens': 32598, 'total_tokens': 36712, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 3776, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--ee128aea-77e5-41ab-92d6-da9252b9090d-0' usage_metadata={'input_tokens': 32598, 'output_tokens': 4114, 'total_tokens': 36712, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 3776}}
2025-11-12 14:10:37,401 - thread-135845298308800.prometheus.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts
index 37bf859da..32dfc2d01 100644
--- a/src/generators/server-side-rendering/index.ts
+++ b/src/generators/server-side-rendering/index.ts
@@ -81,9 +81,7 @@ export default function ssr(
 
 	if (storeProps.length > 0) {
 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
-		if (options.store || templateProperties.store) {
-			initialState.push(`options.store.${initialize}`);
-		}
+		initialState.push(`options.store ? options.store.${initialize} : {}`);
 	}
 
 	if (templateProperties.data) {
diff --git a/src/generators/server-side-rendering/visitors/Component.ts b/src/generators/server-side-rendering/visitors/Component.ts
index 4843010fc..9126b8c3b 100644
--- a/src/generators/server-side-rendering/visitors/Component.ts
+++ b/src/generators/server-side-rendering/visitors/Component.ts
@@ -88,7 +88,7 @@ export default function visitComponent(
 
 	const options = [];
 	if (generator.options.store) {
-		options.push(`store: options.store`);
+		options.push(`store: (options.store || (${expression}.store && ${expression}.store()))`);
 	}
 
 	if (node.children.length) {

2025-11-12 14:10:37,403 - thread-135845298308800.prometheus.lang_graph.nodes.git_reset_node - DEBUG - Resetting the git repository
2025-11-12 14:10:37,436 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - INFO - Enter bug_fix_verification_subgraph_node
2025-11-12 14:10:37,436 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproduced_bug_file: test/server-side-rendering/nested-component-store.spec.js
2025-11-12 14:10:37,436 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproduced_bug_commands: ['npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js']
2025-11-12 14:10:37,436 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproduced_bug_patch: diff --git a/test/server-side-rendering/nested-component-store.spec.js b/test/server-side-rendering/nested-component-store.spec.js
new file mode 100644
index 000000000..4f51c982c
--- /dev/null
+++ b/test/server-side-rendering/nested-component-store.spec.js
@@ -0,0 +1,86 @@
+import assert from 'assert';
+import { loadSvelte, setupHtmlEqual } from '../helpers.js';
+
+describe('ssr nested component store via connect', () => {
+  let svelte;
+
+  before(() => {
+    svelte = loadSvelte(true);
+    setupHtmlEqual();
+  });
+
+  function compileCjs(source, options) {
+    const { code } = svelte.compile(source, Object.assign({ format: 'cjs' }, options));
+    const module = { exports: {} };
+    const exports = module.exports;
+    const fn = new Function('module', 'exports', 'TwoFactorAuth', `${code}; return module.exports;`);
+    return {
+      evalWith(scope = {}) {
+        return fn(module, exports, scope.TwoFactorAuth);
+      }
+    };
+  }
+
+  it('server renders nested component with connect()-provided store', () => {
+    const childSource = `
+{{#if $hasTwoFactor}}
+<div>yay its enabled</div>
+{{else}}
+<div>oh no its not enabled</div>
+{{/if}}
+
+<script>
+  // Minimal inline connect to mirror svelte-redux's connect API for SSR
+  function connect(mapFn) {
+    return {
+      _init(keys) {
+        const mapped = mapFn({}); // emulate empty Redux state on server
+        const state = {};
+        keys.forEach(k => { state[k] = mapped[k]; });
+        return state;
+      }
+    };
+  }
+
+  export default {
+    store: connect(state => ({
+      hasTwoFactor: state.user && state.user.hasTwoFactor,
+    })),
+  };
+</script>
+    `;
+
+    const parentSource = `
+<div class="page">
+  <h1>Manage Account</h1>
+  <div>
+    <h3>Two Factor Auth</h3>
+    <TwoFactorAuth/>
+  </div>
+</div>
+
+<script>
+  export default {
+    components: { TwoFactorAuth }
+  };
+</script>
+    `;
+
+    // Compile child (TwoFactorAuth) for SSR
+    const childMod = compileCjs(childSource, { generate: 'ssr', name: 'TwoFactorAuth', store: true }).evalWith();
+    const TwoFactorAuth = childMod.default || childMod;
+
+    // Compile parent for SSR, injecting the child component via components mapping
+    const parentMod = compileCjs(parentSource, { generate: 'ssr', name: 'ManageAccount', store: true }).evalWith({ TwoFactorAuth });
+    const Parent = parentMod.default || parentMod;
+
+    // Reproduce the exact SSR issue by passing an options object (with no store) to Parent.render
+    // This currently throws: "Cannot read property '_init' of undefined"
+    const { html } = Parent.render(null, {});
+
+    assert.htmlEqual(
+      html,
+      '<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>'
+    );
+  });
+});

2025-11-12 14:10:37,437 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - edit_patch: diff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts
index 37bf859da..32dfc2d01 100644
--- a/src/generators/server-side-rendering/index.ts
+++ b/src/generators/server-side-rendering/index.ts
@@ -81,9 +81,7 @@ export default function ssr(
 
 	if (storeProps.length > 0) {
 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
-		if (options.store || templateProperties.store) {
-			initialState.push(`options.store.${initialize}`);
-		}
+		initialState.push(`options.store ? options.store.${initialize} : {}`);
 	}
 
 	if (templateProperties.data) {
diff --git a/src/generators/server-side-rendering/visitors/Component.ts b/src/generators/server-side-rendering/visitors/Component.ts
index 4843010fc..9126b8c3b 100644
--- a/src/generators/server-side-rendering/visitors/Component.ts
+++ b/src/generators/server-side-rendering/visitors/Component.ts
@@ -88,7 +88,7 @@ export default function visitComponent(
 
 	const options = [];
 	if (generator.options.store) {
-		options.push(`store: options.store`);
+		options.push(`store: (options.store || (${expression}.store && ${expression}.store()))`);
 	}
 
 	if (node.children.length) {

2025-11-12 14:10:37,439 - thread-135845298308800.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Applying patch: diff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts
index 37bf859da..32dfc2d01 100644
--- a/src/generators/server-side-rendering/index.ts
+++ b/src/generators/server-side-rendering/index.ts
@@ -81,9 +81,7 @@ export default function ssr(
 
 	if (storeProps.length > 0) {
 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
-		if (options.store || templateProperties.store) {
-			initialState.push(`options.store.${initialize}`);
-		}
+		initialState.push(`options.store ? options.store.${initialize} : {}`);
 	}
 
 	if (templateProperties.data) {
diff --git a/src/generators/server-side-rendering/visitors/Component.ts b/src/generators/server-side-rendering/visitors/Component.ts
index 4843010fc..9126b8c3b 100644
--- a/src/generators/server-side-rendering/visitors/Component.ts
+++ b/src/generators/server-side-rendering/visitors/Component.ts
@@ -88,7 +88,7 @@ export default function visitComponent(
 
 	const options = [];
 	if (generator.options.store) {
-		options.push(`store: options.store`);
+		options.push(`store: (options.store || (${expression}.store && ${expression}.store()))`);
 	}
 
 	if (node.children.length) {

2025-11-12 14:10:37,443 - thread-135845298308800.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Patch applied successfully.
2025-11-12 14:10:37,444 - thread-135845298308800.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Applying patch: diff --git a/test/server-side-rendering/nested-component-store.spec.js b/test/server-side-rendering/nested-component-store.spec.js
new file mode 100644
index 000000000..4f51c982c
--- /dev/null
+++ b/test/server-side-rendering/nested-component-store.spec.js
@@ -0,0 +1,86 @@
+import assert from 'assert';
+import { loadSvelte, setupHtmlEqual } from '../helpers.js';
+
+describe('ssr nested component store via connect', () => {
+  let svelte;
+
+  before(() => {
+    svelte = loadSvelte(true);
+    setupHtmlEqual();
+  });
+
+  function compileCjs(source, options) {
+    const { code } = svelte.compile(source, Object.assign({ format: 'cjs' }, options));
+    const module = { exports: {} };
+    const exports = module.exports;
+    const fn = new Function('module', 'exports', 'TwoFactorAuth', `${code}; return module.exports;`);
+    return {
+      evalWith(scope = {}) {
+        return fn(module, exports, scope.TwoFactorAuth);
+      }
+    };
+  }
+
+  it('server renders nested component with connect()-provided store', () => {
+    const childSource = `
+{{#if $hasTwoFactor}}
+<div>yay its enabled</div>
+{{else}}
+<div>oh no its not enabled</div>
+{{/if}}
+
+<script>
+  // Minimal inline connect to mirror svelte-redux's connect API for SSR
+  function connect(mapFn) {
+    return {
+      _init(keys) {
+        const mapped = mapFn({}); // emulate empty Redux state on server
+        const state = {};
+        keys.forEach(k => { state[k] = mapped[k]; });
+        return state;
+      }
+    };
+  }
+
+  export default {
+    store: connect(state => ({
+      hasTwoFactor: state.user && state.user.hasTwoFactor,
+    })),
+  };
+</script>
+    `;
+
+    const parentSource = `
+<div class="page">
+  <h1>Manage Account</h1>
+  <div>
+    <h3>Two Factor Auth</h3>
+    <TwoFactorAuth/>
+  </div>
+</div>
+
+<script>
+  export default {
+    components: { TwoFactorAuth }
+  };
+</script>
+    `;
+
+    // Compile child (TwoFactorAuth) for SSR
+    const childMod = compileCjs(childSource, { generate: 'ssr', name: 'TwoFactorAuth', store: true }).evalWith();
+    const TwoFactorAuth = childMod.default || childMod;
+
+    // Compile parent for SSR, injecting the child component via components mapping
+    const parentMod = compileCjs(parentSource, { generate: 'ssr', name: 'ManageAccount', store: true }).evalWith({ TwoFactorAuth });
+    const Parent = parentMod.default || parentMod;
+
+    // Reproduce the exact SSR issue by passing an options object (with no store) to Parent.render
+    // This currently throws: "Cannot read property '_init' of undefined"
+    const { html } = Parent.render(null, {});
+
+    assert.htmlEqual(
+      html,
+      '<div class="page"><h1>Manage Account</h1><div><h3>Two Factor Auth</h3><div>oh no its not enabled</div></div></div>'
+    );
+  });
+});

2025-11-12 14:10:37,448 - thread-135845298308800.prometheus.lang_graph.nodes.git_apply_patch_node - INFO - Patch applied successfully.
2025-11-12 14:10:37,449 - thread-135845298308800.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-12 14:10:37,485 - thread-135845298308800.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-12 14:10:37,485 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-12 14:10:37,587 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:37,587 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 8057884cb Merge pull request #1097 from sveltejs/gh-1082-b
[?2004l
2025-11-12 14:10:37,587 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-12 14:10:37,689 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:37,689 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing test/server-side-rendering/nested-component-store.spec.js
[?2004l
2025-11-12 14:10:37,690 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-12 14:10:37,690 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory src/generators/server-side-rendering in the container
2025-11-12 14:10:37,690 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p src/generators/server-side-rendering
2025-11-12 14:10:37,792 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:37,792 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 14:10:37,792 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory src/generators/server-side-rendering/visitors in the container
2025-11-12 14:10:37,792 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p src/generators/server-side-rendering/visitors
2025-11-12 14:10:37,894 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:37,894 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 mkdir -p src/generators/server-side-rendering/visitor
rs
[?2004l
[?2004l
2025-11-12 14:10:37,894 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory test/server-side-rendering in the container
2025-11-12 14:10:37,894 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p test/server-side-rendering
2025-11-12 14:10:37,996 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:37,996 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 14:10:37,997 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating test/server-side-rendering/nested-component-store.spec.js in the container
2025-11-12 14:10:38,001 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating src/generators/server-side-rendering/index.ts in the container
2025-11-12 14:10:38,001 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating src/generators/server-side-rendering/visitors/Component.ts in the container
2025-11-12 14:10:38,011 - thread-135845298308800.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-12 14:10:40,716 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verify_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JGvl7zRNHS6qf2b8U41ShjS0', 'function': {'arguments': '{"command":"npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 116, 'prompt_tokens': 466, 'total_tokens': 582, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6dc289f2-1255-4a45-8031-c72260334d62-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js'}, 'id': 'call_JGvl7zRNHS6qf2b8U41ShjS0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 466, 'output_tokens': 116, 'total_tokens': 582, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 14:10:40,720 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: npm run build && node ./node_modules/mocha/bin/mocha --require test/setup.js test/server-side-rendering/nested-component-store.spec.js
2025-11-12 14:10:47,717 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:47,717 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 npm run build && node ./node_modules/mocha/bin/mocha 
 --require test/setup.js test/server-side-rendering/nested-component-store.spec.j
js
[?2004l

> svelte@1.51.1 build
> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m5.2s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m29ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m36ms[22m[39m
[36m[39m
[36m[1mstore.js[22m → [1mstore.umd.js[22m...[39m
[32mcreated [1mstore.umd.js[22m in [1m86ms[22m[39m

[0m[0m
[0m  ssr nested component store via connect[0m
  [32m  ✓[0m[90m server renders nested component with connect()-provided store[0m


[92m [0m[32m 1 passing[0m[90m (57ms)[0m

[?2004l
2025-11-12 14:10:50,391 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verify_node - DEBUG - content='Result:\n> svelte@1.51.1 build\n> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js\n\n\nsrc/index.ts → compiler/svelte.js...\ncreated compiler/svelte.js in 5.2s\n\nsrc/server-side-rendering/register.js → ssr/register.js...\ncreated ssr/register.js in 29ms\n\nsrc/shared/index.js → shared.js...\ncreated shared.js in 36ms\n\nstore.js → store.umd.js...\ncreated store.umd.js in 86ms\n\n\n  ssr nested component store via connect\n    ✓ server renders nested component with connect()-provided store\n\n\n  1 passing (57ms)' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 147, 'prompt_tokens': 1009, 'total_tokens': 1156, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--f773351b-91ea-4a66-9560-d2828f8306dd-0' usage_metadata={'input_tokens': 1009, 'output_tokens': 147, 'total_tokens': 1156, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:10:53,822 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verify_structured_node - DEBUG - reproducing_test_fail_log=''
2025-11-12 14:10:53,858 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - INFO - Passing bug reproducing test: True
2025-11-12 14:10:53,859 - thread-135845298308800.prometheus.lang_graph.nodes.bug_fix_verification_subgraph_node - DEBUG - reproducing_test_fail_log: 
2025-11-12 14:10:53,861 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State max_refined_query_loop: 4
2025-11-12 14:10:53,861 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State number_of_candidate_patch: 3
2025-11-12 14:10:53,861 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_existing_test: False
2025-11-12 14:10:53,861 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_regression_test: True
2025-11-12 14:10:53,863 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State max_refined_query_loop: 4
2025-11-12 14:10:53,863 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State number_of_candidate_patch: 3
2025-11-12 14:10:53,863 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_existing_test: False
2025-11-12 14:10:53,863 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_regression_test: True
2025-11-12 14:10:53,865 - thread-135845298308800.prometheus.lang_graph.nodes.get_pass_regression_test_patch_subgraph_node - INFO - Enter get_pass_regression_test_patch_subgraph_node
2025-11-12 14:10:53,865 - thread-135845298308800.prometheus.lang_graph.nodes.get_pass_regression_test_patch_subgraph_node - DEBUG - selected_regression_tests: ['test/server-side-rendering/index.js::store-root', 'test/server-side-rendering/index.js::store-computed', 'test/server-side-rendering/index.js::store-binding', 'test/server-side-rendering/index.js::store-event', 'test/runtime/index.js::store-root (inline helpers)']
2025-11-12 14:10:53,868 - thread-135845298308800.prometheus.lang_graph.nodes.get_pass_regression_test_patch_update_node - INFO - Applying patch: diff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts
index 37bf859da..32dfc2d01 100644
--- a/src/generators/server-side-rendering/index.ts
+++ b/src/generators/server-side-rendering/index.ts
@@ -81,9 +81,7 @@ export default function ssr(
 
 	if (storeProps.length > 0) {
 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
-		if (options.store || templateProperties.store) {
-			initialState.push(`options.store.${initialize}`);
-		}
+		initialState.push(`options.store ? options.store.${initialize} : {}`);
 	}
 
 	if (templateProperties.data) {
diff --git a/src/generators/server-side-rendering/visitors/Component.ts b/src/generators/server-side-rendering/visitors/Component.ts
index 4843010fc..9126b8c3b 100644
--- a/src/generators/server-side-rendering/visitors/Component.ts
+++ b/src/generators/server-side-rendering/visitors/Component.ts
@@ -88,7 +88,7 @@ export default function visitComponent(
 
 	const options = [];
 	if (generator.options.store) {
-		options.push(`store: options.store`);
+		options.push(`store: (options.store || (${expression}.store && ${expression}.store()))`);
 	}
 
 	if (node.children.length) {

2025-11-12 14:10:53,904 - thread-135845298308800.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-12 14:10:53,942 - thread-135845298308800.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-12 14:10:53,943 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-12 14:10:54,044 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:54,044 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 8057884cb Merge pull request #1097 from sveltejs/gh-1082-b
[?2004l
2025-11-12 14:10:54,044 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-12 14:10:54,146 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:54,146 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing test/server-side-rendering/nested-component-store.spec.js
[?2004l
2025-11-12 14:10:54,147 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-12 14:10:54,147 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory src/generators/server-side-rendering in the container
2025-11-12 14:10:54,147 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p src/generators/server-side-rendering
2025-11-12 14:10:54,249 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:54,249 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 14:10:54,249 - thread-135845298308800.prometheus.docker.base_container - INFO - Creating directory src/generators/server-side-rendering/visitors in the container
2025-11-12 14:10:54,249 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p src/generators/server-side-rendering/visitors
2025-11-12 14:10:54,351 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:54,351 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 mkdir -p src/generators/server-side-rendering/visitor
rs
[?2004l
[?2004l
2025-11-12 14:10:54,351 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating src/generators/server-side-rendering/index.ts in the container
2025-11-12 14:10:54,352 - thread-135845298308800.prometheus.docker.base_container - INFO - Updating src/generators/server-side-rendering/visitors/Component.ts in the container
2025-11-12 14:10:54,360 - thread-135845298308800.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-12 14:10:54,361 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - INFO - Enter run_regression_tests_subgraph_node
2025-11-12 14:10:54,361 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - DEBUG - selected_regression_tests: ['test/server-side-rendering/index.js::store-root', 'test/server-side-rendering/index.js::store-computed', 'test/server-side-rendering/index.js::store-binding', 'test/server-side-rendering/index.js::store-event', 'test/runtime/index.js::store-root (inline helpers)']
2025-11-12 14:10:58,282 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZzdmVXj6KrQJjocEd11F8085', 'function': {'arguments': '{"command":"ls -la"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 282, 'prompt_tokens': 600, 'total_tokens': 882, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f9ec33b7-d72e-4943-a7d7-5d4de528c13c-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la'}, 'id': 'call_ZzdmVXj6KrQJjocEd11F8085', 'type': 'tool_call'}] usage_metadata={'input_tokens': 600, 'output_tokens': 282, 'total_tokens': 882, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 14:10:58,285 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la
2025-11-12 14:10:58,387 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:10:58,387 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 824
drwxr-xr-x   1 root root   4096 Nov 12 13:44 [0m[01;34m.[0m
drwxr-xr-x   1 root root   4096 Nov 12 14:10 [01;34m..[0m
-rw-r--r--   1 root root    227 Nov 12 13:44 .editorconfig
-rw-r--r--   1 root root     85 Nov 12 13:44 .eslintignore
-rw-r--r--   1 root root   1239 Nov 12 13:44 .eslintrc.json
-rw-r--r--   1 root root     78 Nov 12 13:44 .flowconfig
drwxrwxr-x   1 root root   4096 Nov 12 14:10 [01;34m.git[0m
drwxrwxr-x   1 root root   4096 Nov 12 13:44 [01;34m.github[0m
-rw-r--r--   1 root root    289 Nov 12 13:44 .gitignore
-rw-r--r--   1 root root     51 Nov 12 13:44 .prettierrc
-rw-r--r--   1 root root    270 Nov 12 13:44 .travis.yml
-rw-r--r--   1 root root  44966 Nov 12 13:44 CHANGELOG.md
-rw-r--r--   1 root root   1114 Nov 12 13:44 LICENSE
-rw-r--r--   1 root root   8621 Nov 12 13:44 README.md
-rw-r--r--   1 root root    556 Nov 12 13:44 appveyor.yml
drwxr-xr-x   1 root root   4096 Aug 28 02:30 [01;34mcompiler[0m
-rw-r--r--   1 root root    105 Nov 12 13:44 mocha.coverage.opts
-rw-r--r--   1 root root     12 Nov 12 13:44 mocha.opts
drwxr-xr-x 408 root root  16384 Aug 28 02:30 [01;34mnode_modules[0m
-rw-r--r--   1 root root 500424 Aug 28 02:30 package-lock.json
-rw-r--r--   1 root root   2558 Nov 12 13:44 package.json
-rw-r--r--   1 root root   1796 Nov 12 13:44 rollup.config.js
-rw-r--r--   1 root root    128 Nov 12 13:44 rollup.store.config.js
-rw-r--r--   1 root root  14889 Nov 12 14:10 shared.js
drwxrwxr-x   1 root root   4096 Nov 12 13:44 [01;34msrc[0m
drwxr-xr-x   1 root root   4096 Aug 28 02:30 [01;34mssr[0m
-rw-r--r--   1 root root   3515 Nov 12 13:44 store.js
-rw-r--r--   1 root root   5166 Nov 12 14:10 store.umd.js
drwxrwxr-x   1 root root   4096 Nov 12 13:44 [01;34mtest[0m
-rw-r--r--   1 root root    326 Nov 12 13:44 tsconfig.json
-rw-r--r--   1 root root 120024 Nov 12 13:44 yarn.lock
[?2004l
2025-11-12 14:11:00,608 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_iYTO0FOgptIyitUkLN4cqqr9', 'function': {'arguments': '{"command":"ls -la test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 91, 'prompt_tokens': 1529, 'total_tokens': 1620, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--185295dd-16d2-4fc0-ad00-c8fc9a08befa-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test'}, 'id': 'call_iYTO0FOgptIyitUkLN4cqqr9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1529, 'output_tokens': 91, 'total_tokens': 1620, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 14:11:00,611 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test
2025-11-12 14:11:00,713 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:00,713 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 120
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [0m[01;34m.[0m
drwxr-xr-x 1 root root 4096 Nov 12 13:44 [01;34m..[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mcreate[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mcss[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mcustom-elements[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mformats[0m
-rw-r--r-- 1 root root 5512 Nov 12 13:44 helpers.js
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mhydration[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mjs[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mparser[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mpreprocess[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mruntime[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:10 [01;34mserver-side-rendering[0m
-rw-r--r-- 1 root root 1103 Nov 12 13:44 setup.js
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34msourcemaps[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mstore[0m
-rw-r--r-- 1 root root  247 Nov 12 13:44 test.js
drwxrwxr-x 1 root root 4096 Nov 12 13:44 [01;34mvalidator[0m
[?2004l
2025-11-12 14:11:02,702 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_BjhI2i6QshK1XOfUAthp3wkj', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/server-side-rendering/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 2152, 'total_tokens': 2191, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9c399610-9111-43b1-98fc-a26d82d4a78b-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/server-side-rendering/index.js"}, 'id': 'call_BjhI2i6QshK1XOfUAthp3wkj', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2152, 'output_tokens': 39, 'total_tokens': 2191, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:11:02,706 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/server-side-rendering/index.js
2025-11-12 14:11:02,808 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:02,808 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import assert from "assert";
import * as fs from "fs";
import * as path from "path";
import glob from 'glob';

import {
	showOutput,
	loadConfig,
	setupHtmlEqual,
	tryToLoadJson
} from "../helpers.js";

function tryToReadFile(file) {
	try {
		return fs.readFileSync(file, "utf-8");
	} catch (err) {
		if (err.code !== "ENOENT") throw err;
		return null;
	}
}

describe("ssr", () => {
	before(() => {
		require("../../ssr/register")({
			extensions: ['.svelte', '.html'],
			store: true
		});

		return setupHtmlEqual();
	});

	fs.readdirSync("test/server-side-rendering/samples").forEach(dir => {
		if (dir[0] === ".") return;

		// add .solo to a sample directory name to only run that test, or
		// .show to always show the output. or both
		const solo = /\.solo/.test(dir);
		const show = /\.show/.test(dir);

		if (solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		(solo ? it.only : it)(dir, () => {
			dir = path.resolve("test/server-side-rendering/samples", dir);
			try {
				let component;

				const mainHtmlFile = `${dir}/main.html`;
				const mainSvelteFile = `${dir}/main.svelte`;
				if (fs.existsSync(mainHtmlFile)) {
					component = require(mainHtmlFile);
				} else if (fs.existsSync(mainSvelteFile)) {
					component = require(mainSvelteFile);
				}

				const expectedHtml = tryToReadFile(`${dir}/_expected.html`);
				const expectedCss = tryToReadFile(`${dir}/_expected.css`) || "";

				const data = tryToLoadJson(`${dir}/data.json`);

				const rendered = component.render(data);
				const { html, css, head } = rendered;

				// rendered.toString() === rendered.html
				assert.equal(rendered, html);

				fs.writeFileSync(`${dir}/_actual.html`, html);
				if (css.code) fs.writeFileSync(`${dir}/_actual.css`, css.code);

				assert.htmlEqual(html, expectedHtml);
				assert.equal(
					css.code.replace(/^\s+/gm, ""),
					expectedCss.replace(/^\s+/gm, "")
				);

				if (fs.existsSync(`${dir}/_expected-head.html`)) {
					fs.writeFileSync(`${dir}/_actual-head.html`, head);
					assert.htmlEqual(
						head,
						fs.readFileSync(`${dir}/_expected-head.html`, 'utf-8')
					);
				}

				if (show) showOutput(dir, { generate: 'ssr' });
			} catch (err) {
				showOutput(dir, { generate: 'ssr' });
				throw err;
			}
		});
	});

	// duplicate client-side tests, as far as possible
	fs.readdirSync("test/runtime/samples").forEach(dir => {
		if (dir[0] === ".") return;

		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);

		if (config.solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		if (config["skip-ssr"]) return;

		(config.skip ? it.skip : config.solo ? it.only : it)(dir, () => {
			const cwd = path.resolve("test/runtime/samples", dir);

			glob.sync('**/*.html', { cwd: `test/runtime/samples/${dir}` }).forEach(file => {
				const resolved = require.resolve(`../runtime/samples/${dir}/${file}`);
				delete require.cache[resolved];
			});

			require("../../ssr/register")({
				store: !!config.store
			});

			try {
				const component = require(`../runtime/samples/${dir}/main.html`);
				const { html } = component.render(config.data, {
					store: (config.store !== true) && config.store
				});

				if (config.html) {
					assert.htmlEqual(html, config.html);
				}
			} catch (err) {
				showOutput(cwd, { generate: "ssr" });
				throw err;
			}
		});
	});
});
[?2004l
2025-11-12 14:11:04,015 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_bOJZzGQm4bDrYPa7Q3GGt5jl', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/runtime/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 3161, 'total_tokens': 3191, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--68bb8b7c-d09a-4ca2-b35c-27c66822992f-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/runtime/index.js"}, 'id': 'call_bOJZzGQm4bDrYPa7Q3GGt5jl', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3161, 'output_tokens': 30, 'total_tokens': 3191, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:11:04,019 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/runtime/index.js
2025-11-12 14:11:04,121 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:04,121 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
import assert from "assert";
import chalk from 'chalk';
import * as path from "path";
import * as fs from "fs";
import * as acorn from "acorn";
import { transitionManager } from "../../shared.js";

import {
	showOutput,
	loadConfig,
	loadSvelte,
	env,
	setupHtmlEqual,
	spaces
} from "../helpers.js";

let svelte;

let compileOptions = null;

function getName(filename) {
	const base = path.basename(filename).replace(".html", "");
	return base[0].toUpperCase() + base.slice(1);
}

describe("runtime", () => {
	before(() => {
		svelte = loadSvelte(true);

		require.extensions[".html"] = function(module, filename) {
			const options = Object.assign(
				{ filename, name: getName(filename), format: 'cjs' },
				compileOptions
			);

			const { code } = svelte.compile(fs.readFileSync(filename, "utf-8"), options);

			return module._compile(code, filename);
		};

		return setupHtmlEqual();
	});

	const failed = new Set();

	function runTest(dir, shared, hydrate) {
		if (dir[0] === ".") return;

		const config = loadConfig(`./runtime/samples/${dir}/_config.js`);

		if (config.solo && process.env.CI) {
			throw new Error("Forgot to remove `solo: true` from test");
		}

		(config.skip ? it.skip : config.solo ? it.only : it)(`${dir} (${shared ? 'shared' : 'inline'} helpers${hydrate ? ' , hydration' : ''})`, () => {
			if (failed.has(dir)) {
				// this makes debugging easier, by only printing compiled output once
				throw new Error('skipping test, already failed');
			}

			const cwd = path.resolve(`test/runtime/samples/${dir}`);
			global.document.title = '';

			compileOptions = config.compileOptions || {};
			compileOptions.shared = shared;
			compileOptions.hydratable = hydrate;
			compileOptions.dev = config.dev;
			compileOptions.store = !!config.store;

			// check that no ES2015+ syntax slipped in
			if (!config.allowES2015) {
				try {
					const source = fs.readFileSync(
						`test/runtime/samples/${dir}/main.html`,
						"utf-8"
					);
					const { code } = svelte.compile(source, compileOptions);
					const startIndex = code.indexOf("function create_main_fragment"); // may change!
					if (startIndex === -1) throw new Error("missing create_main_fragment");
					const endIndex = code.lastIndexOf("export default");
					const es5 =
						code.slice(0, startIndex).split('\n').map(x => spaces(x.length)).join('\n') +
						code.slice(startIndex, endIndex);

					acorn.parse(es5, { ecmaVersion: 5 });

					if (/Object\.assign/.test(es5)) {
						throw new Error(
							"cannot use Object.assign in generated code, as it is not supported everywhere"
						);
					}
				} catch (err) {
					failed.add(dir);
					if (err.frame) {
						console.error(chalk.red(err.frame)); // eslint-disable-line no-console
					}
					showOutput(cwd, { shared, format: 'cjs', store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
					throw err;
				}
			}

			Object.keys(require.cache)
				.filter(x => x.endsWith(".html"))
				.forEach(file => {
					delete require.cache[file];
				});

			let SvelteComponent;

			let unintendedError = null;

			const window = env();

			return Promise.resolve()
				.then(() => {
					// set of hacks to support transition tests
					transitionManager.running = false;
					transitionManager.transitions = [];

					const raf = {
						time: 0,
						callback: null,
						tick: now => {
							raf.time = now;
							if (raf.callback) raf.callback();
						}
					};
					window.performance = { now: () => raf.time };
					global.requestAnimationFrame = cb => {
						let called = false;
						raf.callback = () => {
							if (!called) {
								called = true;
								cb();
							}
						};
					};

					try {
						SvelteComponent = require(`./samples/${dir}/main.html`);
					} catch (err) {
						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
						throw err;
					}

					global.window = window;

					// Put the constructor on window for testing
					window.SvelteComponent = SvelteComponent;

					const target = window.document.querySelector("main");

					const warnings = [];
					const warn = console.warn;
					console.warn = warning => {
						warnings.push(warning);
					};

					const options = Object.assign({}, {
						target,
						hydrate,
						data: config.data,
						store: (config.store !== true && config.store)
					}, config.options || {});

					const component = new SvelteComponent(options);

					console.warn = warn;

					if (config.error) {
						unintendedError = true;
						throw new Error("Expected a runtime error");
					}

					if (config.warnings) {
						assert.deepEqual(warnings, config.warnings);
					} else if (warnings.length) {
						unintendedError = true;
						throw new Error("Received unexpected warnings");
					}

					if (config.html) {
						assert.htmlEqual(target.innerHTML, config.html);
					}

					if (config.test) {
						return Promise.resolve(config.test(assert, component, target, window, raf)).then(() => {
							component.destroy();
						});
					} else {
						component.destroy();
						assert.equal(target.innerHTML, "");
					}
				})
				.catch(err => {
					if (config.error && !unintendedError) {
						config.error(assert, err);
					} else {
						failed.add(dir);
						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
[?2004l
2025-11-12 14:11:05,469 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VpEo2yb7L3sp1QZGrjlHPSP8', 'function': {'arguments': '{"command":"sed -n \'200,500p\' test/runtime/index.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 4589, 'total_tokens': 4619, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7c45e132-5ccc-47f1-a4fd-51e6d7799bca-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '200,500p' test/runtime/index.js"}, 'id': 'call_VpEo2yb7L3sp1QZGrjlHPSP8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4589, 'output_tokens': 30, 'total_tokens': 4619, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:11:05,472 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '200,500p' test/runtime/index.js
2025-11-12 14:11:05,574 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:05,574 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
						showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte); // eslint-disable-line no-console
						throw err;
					}
				})
				.then(() => {
					if (config.show) showOutput(cwd, { shared, format: 'cjs', hydratable: hydrate, store: !!compileOptions.store }, svelte);
				});
		});
	}

	const shared = path.resolve("shared.js");
	fs.readdirSync("test/runtime/samples").forEach(dir => {
		runTest(dir, shared, false);
		runTest(dir, shared, true);
		runTest(dir, null, false);
	});

	it("fails if options.target is missing in dev mode", () => {
		const { code } = svelte.compile(`<div></div>`, {
			format: "iife",
			name: "SvelteComponent",
			dev: true
		});

		const SvelteComponent = eval(
			`(function () { ${code}; return SvelteComponent; }())`
		);

		assert.throws(() => {
			new SvelteComponent();
		}, /'target' is a required option/);
	});

	it("fails if options.hydrate is true but the component is non-hydratable", () => {
		const { code } = svelte.compile(`<div></div>`, {
			format: "iife",
			name: "SvelteComponent",
			dev: true
		});

		const SvelteComponent = eval(
			`(function () { ${code}; return SvelteComponent; }())`
		);

		assert.throws(() => {
			new SvelteComponent({
				target: {},
				hydrate: true
			});
		}, /options.hydrate only works if the component was compiled with the `hydratable: true` option/);
	});
});
[?2004l
2025-11-12 14:11:07,768 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Lyrgjp3bLN6RehtPvr1D64m0', 'function': {'arguments': '{"command":"cat mocha.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 90, 'prompt_tokens': 5052, 'total_tokens': 5142, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1408}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9137f80d-b7dc-4979-9bf4-6fda9af01346-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat mocha.opts'}, 'id': 'call_Lyrgjp3bLN6RehtPvr1D64m0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5052, 'output_tokens': 90, 'total_tokens': 5142, 'input_token_details': {'audio': 0, 'cache_read': 1408}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 14:11:07,770 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat mocha.opts
2025-11-12 14:11:07,872 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:07,872 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[?2004l
2025-11-12 14:11:08,943 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6nLwTxAmexVkLuiIMMxfk6LB', 'function': {'arguments': '{"command":"cat mocha.coverage.opts"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 22, 'prompt_tokens': 5095, 'total_tokens': 5117, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e7bdd1fd-85df-444a-bba4-1f8198c2652c-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat mocha.coverage.opts'}, 'id': 'call_6nLwTxAmexVkLuiIMMxfk6LB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5095, 'output_tokens': 22, 'total_tokens': 5117, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:11:08,946 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat mocha.coverage.opts
2025-11-12 14:11:09,048 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:09,048 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
--compilers ts-node/register
--require source-map-support/register
--full-trace
--recursive
test/test.js
[?2004l
2025-11-12 14:11:12,104 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1GN7qNXvQbZX2gW9sezDA4mo', 'function': {'arguments': '{"command":"cat package.json"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 218, 'prompt_tokens': 5166, 'total_tokens': 5384, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3072}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bd810e64-de7c-41a2-852d-b63e935d6a97-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'cat package.json'}, 'id': 'call_1GN7qNXvQbZX2gW9sezDA4mo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5166, 'output_tokens': 218, 'total_tokens': 5384, 'input_token_details': {'audio': 0, 'cache_read': 3072}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 14:11:12,107 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: cat package.json
2025-11-12 14:11:12,208 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:12,208 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
{
  "name": "svelte",
  "version": "1.51.1",
  "description": "The magical disappearing UI framework",
  "main": "compiler/svelte.js",
  "files": [
    "compiler",
    "ssr",
    "shared.js",
    "store.js",
    "store.umd.js",
    "README.md"
  ],
  "scripts": {
    "test": "mocha --opts mocha.opts",
    "quicktest": "mocha --opts mocha.opts",
    "precoverage": "export COVERAGE=true && nyc mocha --opts mocha.coverage.opts",
    "coverage": "nyc report --reporter=text-lcov > coverage.lcov",
    "codecov": "codecov",
    "precodecov": "npm run coverage",
    "lint": "eslint src test/*.js",
    "build": "node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js",
    "prepare": "npm run build",
    "dev": "node src/shared/_build.js && rollup -c -w",
    "pretest": "npm run build",
    "prepublishOnly": "npm run lint && npm test",
    "prettier": "prettier --write \"src/**/*.ts\""
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/sveltejs/svelte.git"
  },
  "keywords": [
    "UI",
    "framework",
    "templates",
    "templating"
  ],
  "author": "Rich Harris",
  "license": "MIT",
  "bugs": {
    "url": "https://github.com/sveltejs/svelte/issues"
  },
  "homepage": "https://github.com/sveltejs/svelte#README",
  "devDependencies": {
    "@types/mocha": "^2.2.41",
    "@types/node": "^8.0.17",
    "acorn": "^5.1.1",
    "acorn-dynamic-import": "^2.0.2",
    "chalk": "^2.0.1",
    "codecov": "^2.2.0",
    "console-group": "^0.3.2",
    "css-tree": "1.0.0-alpha22",
    "eslint": "^4.3.0",
    "eslint-plugin-html": "^3.0.0",
    "eslint-plugin-import": "^2.2.0",
    "estree-walker": "^0.5.1",
    "glob": "^7.1.1",
    "is-reference": "^1.1.0",
    "jsdom": "^11.1.0",
    "locate-character": "^2.0.0",
    "magic-string": "^0.22.3",
    "mocha": "^3.2.0",
    "nightmare": "^2.10.0",
    "node-resolve": "^1.3.3",
    "nyc": "^11.1.0",
    "prettier": "^1.7.0",
    "reify": "^0.12.3",
    "rollup": "^0.48.2",
    "rollup-plugin-buble": "^0.15.0",
    "rollup-plugin-commonjs": "^8.0.2",
    "rollup-plugin-json": "^2.1.0",
    "rollup-plugin-node-resolve": "^3.0.0",
    "rollup-plugin-replace": "^2.0.0",
    "rollup-plugin-typescript": "^0.8.1",
    "rollup-plugin-virtual": "^1.0.1",
    "rollup-watch": "^4.3.1",
    "source-map": "^0.5.6",
    "source-map-support": "^0.4.8",
    "ts-node": "^3.3.0",
    "tslib": "^1.8.0",
    "typescript": "^2.6.1"
  },
  "nyc": {
    "include": [
      "compiler/svelte.js",
      "shared.js"
    ],
    "sourceMap": true,
    "instrument": true
  }
}
[?2004l
2025-11-12 14:11:16,828 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_fhDfPEmp0F7RvIt7VlOfbbaF', 'function': {'arguments': '{"command":"sed -n \'1,200p\' test/test.js"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 227, 'prompt_tokens': 6122, 'total_tokens': 6349, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3397733e-607b-4be6-8dfc-284cdf7c9e9f-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' test/test.js"}, 'id': 'call_fhDfPEmp0F7RvIt7VlOfbbaF', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6122, 'output_tokens': 227, 'total_tokens': 6349, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 14:11:16,831 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' test/test.js
2025-11-12 14:11:16,933 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:16,933 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
const glob = require("glob");

require("./setup");

glob.sync("**/__test__.js", { cwd: "src" }).forEach(function(file) {
	require("../src/" + file);
});

glob.sync("*/index.js", { cwd: "test" }).forEach(function(file) {
	require("./" + file);
});
[?2004l
2025-11-12 14:11:19,417 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_IM4GwQrrjfODRelDUhvcQat6', 'function': {'arguments': '{"command":"ls -la test/server-side-rendering/samples"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 161, 'prompt_tokens': 6242, 'total_tokens': 6403, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4992}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3d6d8024-e966-407e-845b-6994aa2a06f0-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test/server-side-rendering/samples'}, 'id': 'call_IM4GwQrrjfODRelDUhvcQat6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 6242, 'output_tokens': 161, 'total_tokens': 6403, 'input_token_details': {'audio': 0, 'cache_read': 4992}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 14:11:19,420 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/server-side-rendering/samples
2025-11-12 14:11:19,522 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:19,522 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 164
drwxrwxr-x 1 root root 4096 Nov 12 13:49 [0m[01;34m.[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:10 [01;34m..[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mattribute-boolean[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mattribute-dynamic[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mattribute-static[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomment[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomponent[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomponent-binding[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomponent-binding-renamed[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomponent-data-dynamic[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomponent-data-empty[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomponent-data-static[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomponent-refs[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomponent-refs-and-attributes[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:54 [01;34mcomponent-with-different-extension[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomponent-yield[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mcomputed[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mdefault-data[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mdefault-data-override[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mdirectives[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mdynamic-text[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mdynamic-text-escaped[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34meach-block[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mempty-elements-closed[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mentities[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mhead-title[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mhelpers[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mif-block-false[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mif-block-true[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mimport-non-component[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mraw-mustaches[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:54 [01;34msanitize-name[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mstatic-div[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mstatic-text[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mstyles[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mstyles-nested[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:54 [01;34mtextarea-children[0m
drwxrwxr-x 1 root root 4096 Nov 12 13:54 [01;34mtextarea-value[0m
drwxrwxr-x 1 root root 4096 Nov 12 14:04 [01;34mtriple[0m
[?2004l
2025-11-12 14:11:25,428 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_E4lyxZsEd7avD6g1sJwLPG5A', 'function': {'arguments': '{"command":"ls -la test/runtime/samples | sed -n \'1,200p\'"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 296, 'prompt_tokens': 7651, 'total_tokens': 7947, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--17b620bb-fa2e-4efb-bec1-044b1cef4ae8-0' tool_calls=[{'name': 'run_command', 'args': {'command': "ls -la test/runtime/samples | sed -n '1,200p'"}, 'id': 'call_E4lyxZsEd7avD6g1sJwLPG5A', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7651, 'output_tokens': 296, 'total_tokens': 7947, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 14:11:25,431 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/runtime/samples | sed -n '1,200p'
2025-11-12 14:11:25,533 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:25,533 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 1332
drwxrwxr-x 1 root root 20480 Aug 28 02:29 .
drwxrwxr-x 1 root root  4096 Nov 12 13:44 ..
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-boolean-indeterminate
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-casing
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-dynamic
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-dynamic-multiple
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-dynamic-reserved
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-dynamic-shorthand
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-dynamic-type
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-empty
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-empty-svg
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-namespaced
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-partial-number
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-prefer-expression
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-static
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-static-at-symbol
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-static-boolean
drwxrwxr-x 1 root root  4096 Nov 12 13:44 attribute-static-quotemarks
drwxrwxr-x 1 root root  4096 Nov 12 13:44 autofocus
drwxrwxr-x 1 root root  4096 Nov 12 13:44 await-component-oncreate
drwxrwxr-x 1 root root  4096 Nov 12 13:44 await-then-catch
drwxrwxr-x 1 root root  4096 Nov 12 13:44 await-then-catch-anchor
drwxrwxr-x 1 root root  4096 Nov 12 13:44 await-then-catch-event
drwxrwxr-x 1 root root  4096 Nov 12 13:44 await-then-catch-if
drwxrwxr-x 1 root root  4096 Nov 12 13:44 await-then-catch-in-slot
drwxrwxr-x 1 root root  4096 Nov 12 13:44 await-then-catch-multiple
drwxrwxr-x 1 root root  4096 Nov 12 13:44 await-then-catch-non-promise
drwxrwxr-x 1 root root  4096 Nov 12 13:44 await-then-shorthand
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-audio-currenttime-duration
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-indirect
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-indirect-computed
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-checkbox
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-checkbox-deep-contextual
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-checkbox-group
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-checkbox-group-outside-each
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-checkbox-indeterminate
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-number
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-radio-group
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-range
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-range-change
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-text
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-text-contextual
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-text-deconflicted
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-text-deep
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-text-deep-computed
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-text-deep-computed-dynamic
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-text-deep-contextual
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-text-deep-contextual-computed-dynamic
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-input-with-event
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-select
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-select-implicit-option-value
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-select-in-each-block
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-select-in-yield
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-select-initial-value
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-select-initial-value-undefined
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-select-late
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-select-multiple
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-select-optgroup
drwxrwxr-x 1 root root  4096 Nov 12 13:44 binding-textarea
drwxrwxr-x 1 root root  4096 Nov 12 13:44 bindings-before-oncreate
drwxrwxr-x 1 root root  4096 Nov 12 13:44 bindings-coalesced
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-blowback
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-blowback-b
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-blowback-c
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-computed
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-conditional
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-conditional-b
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-deep
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-deep-b
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-each
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-each-nested
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-each-object
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-infinite-loop
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-nested
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-parent-supercedes-child
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-binding-self-destroying
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-data-dynamic
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-data-dynamic-late
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-data-dynamic-shorthand
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-data-empty
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-data-static
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-data-static-boolean
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-data-static-boolean-regression
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-events
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-events-data
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-events-each
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-if-placement
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-nested-deep
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-nested-deeper
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-not-void
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-ref
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-slot-default
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-slot-each-block
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-slot-empty
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-slot-fallback
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-slot-if-block
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-slot-if-block-before-node
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-slot-if-else-block-before-node
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-slot-named
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-slot-nested
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-slot-nested-component
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-static-at-symbol
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-yield
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-yield-follows-element
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-yield-if
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-yield-multiple-in-each
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-yield-multiple-in-if
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-yield-nested-if
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-yield-parent
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-yield-placement
drwxrwxr-x 1 root root  4096 Nov 12 13:44 component-yield-static
drwxrwxr-x 1 root root  4096 Nov 12 13:44 computed-empty
drwxrwxr-x 1 root root  4096 Nov 12 13:44 computed-function
drwxrwxr-x 1 root root  4096 Nov 12 13:44 computed-values
drwxrwxr-x 1 root root  4096 Nov 12 13:44 computed-values-deconflicted
drwxrwxr-x 1 root root  4096 Nov 12 13:44 computed-values-default
drwxrwxr-x 1 root root  4096 Nov 12 13:44 computed-values-function-dependency
drwxrwxr-x 1 root root  4096 Nov 12 13:44 css
drwxrwxr-x 1 root root  4096 Nov 12 13:44 css-comments
drwxrwxr-x 1 root root  4096 Nov 12 13:44 css-false
drwxrwxr-x 1 root root  4096 Nov 12 13:44 css-space-in-attribute
drwxrwxr-x 1 root root  4096 Nov 12 13:44 custom-method
drwxrwxr-x 1 root root  4096 Nov 12 13:44 deconflict-builtins
drwxrwxr-x 1 root root  4096 Nov 12 13:44 deconflict-contexts
drwxrwxr-x 1 root root  4096 Nov 12 13:44 deconflict-non-helpers
drwxrwxr-x 1 root root  4096 Nov 12 13:44 deconflict-self
drwxrwxr-x 1 root root  4096 Nov 12 13:44 deconflict-template-1
drwxrwxr-x 1 root root  4096 Nov 12 13:44 deconflict-template-2
drwxrwxr-x 1 root root  4096 Nov 12 13:44 deconflict-vars
drwxrwxr-x 1 root root  4096 Nov 12 13:44 default-data
drwxrwxr-x 1 root root  4096 Nov 12 13:44 default-data-function
drwxrwxr-x 1 root root  4096 Nov 12 13:44 default-data-override
drwxrwxr-x 1 root root  4096 Nov 12 13:44 destroy-twice
drwxrwxr-x 1 root root  4096 Nov 12 13:44 destructuring
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-bad-observe-arguments
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-bad-set-argument
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-destroy-not-teardown
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-destroy-twice
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-dynamic-components-misplaced
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-helper
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-missing-data
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-missing-data-binding
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-missing-data-excludes-event
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-readonly-computed
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dev-warning-readonly-window-binding
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dynamic-component
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dynamic-component-bindings
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dynamic-component-bindings-recreated
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dynamic-component-events
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dynamic-component-inside-element
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dynamic-component-slot
drwxrwxr-x 1 root root  4096 Nov 12 13:44 dynamic-component-update-existing-instance
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-containing-component-in-if
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-containing-if
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-destructured-array
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-dynamic-else-static
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-else
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-else-starts-empty
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-indexed
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-keyed
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-keyed-dynamic
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-keyed-random-permute
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-keyed-unshift
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-random-permute
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-static
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-block-text-node
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-blocks-expression
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-blocks-nested
drwxrwxr-x 1 root root  4096 Nov 12 13:44 each-blocks-nested-b
drwxrwxr-x 1 root root  4096 Nov 12 13:44 element-invalid-name
drwxrwxr-x 1 root root  4096 Nov 12 13:44 empty-style-block
drwxrwxr-x 1 root root  4096 Nov 12 13:44 escape-template-literals
drwxrwxr-x 1 root root  4096 Nov 12 13:44 escaped-text
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-console-log
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-custom
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-custom-context
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-custom-each
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-custom-node-context
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-destroy
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-each
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-each-deconflicted
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-event-methods
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-hoisted
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-removal
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-sanitize
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-shorthand
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-shorthand-component
drwxrwxr-x 1 root root  4096 Nov 12 13:44 event-handler-this-methods
drwxrwxr-x 1 root root  4096 Nov 12 13:44 events-custom
drwxrwxr-x 1 root root  4096 Nov 12 13:44 events-lifecycle
drwxrwxr-x 1 root root  4096 Nov 12 13:44 flush-before-bindings
drwxrwxr-x 1 root root  4096 Nov 12 13:44 function-in-expression
drwxrwxr-x 1 root root  4096 Nov 12 13:44 get-state
drwxrwxr-x 1 root root  4096 Nov 12 13:44 globals-accessible-directly
drwxrwxr-x 1 root root  4096 Nov 12 13:44 globals-not-dereferenced
[?2004l
2025-11-12 14:11:27,084 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ILL3CreNeJgUnJ2VjDeqjPZR', 'function': {'arguments': '{"command":"sed -n \'200,400p\' test/runtime/samples | sed -n \'1,200p\'"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 40, 'prompt_tokens': 12991, 'total_tokens': 13031, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5120}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0982d820-8832-43ea-aa09-4b4a0da0a1ce-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '200,400p' test/runtime/samples | sed -n '1,200p'"}, 'id': 'call_ILL3CreNeJgUnJ2VjDeqjPZR', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12991, 'output_tokens': 40, 'total_tokens': 13031, 'input_token_details': {'audio': 0, 'cache_read': 5120}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:11:27,087 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: sed -n '200,400p' test/runtime/samples | sed -n '1,200p'
2025-11-12 14:11:27,189 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:27,189 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 sed -n '200,400p' test/runtime/samples | sed -n '1,20
00p'
[?2004l
sed: read error on test/runtime/samples: Is a directory
[?2004l
2025-11-12 14:11:29,859 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ajVKEmZq4JEZ0ySdEeOPhMqz', 'function': {'arguments': '{"command":"ls -la test/runtime/samples | sed -n \'200,400p\'"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 34, 'prompt_tokens': 13093, 'total_tokens': 13127, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--69f0f831-8ab8-43c7-9eea-b4f6519017b3-0' tool_calls=[{'name': 'run_command', 'args': {'command': "ls -la test/runtime/samples | sed -n '200,400p'"}, 'id': 'call_ajVKEmZq4JEZ0ySdEeOPhMqz', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13093, 'output_tokens': 34, 'total_tokens': 13127, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:11:29,863 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/runtime/samples | sed -n '200,400p'
2025-11-12 14:11:29,965 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:11:29,965 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
drwxrwxr-x 1 root root  4096 Nov 12 13:44 globals-not-dereferenced
drwxrwxr-x 1 root root  4096 Nov 12 13:44 globals-not-overwritten-by-bindings
drwxrwxr-x 1 root root  4096 Nov 12 13:44 globals-shadowed-by-data
drwxrwxr-x 1 root root  4096 Nov 12 13:44 globals-shadowed-by-helpers
drwxrwxr-x 1 root root  4096 Nov 12 13:44 head-title-dynamic
drwxrwxr-x 1 root root  4096 Nov 12 13:44 head-title-static
drwxrwxr-x 1 root root  4096 Nov 12 13:44 hello-world
drwxrwxr-x 1 root root  4096 Nov 12 13:44 helpers
drwxrwxr-x 1 root root  4096 Nov 12 13:44 helpers-not-call-expression
drwxrwxr-x 1 root root  4096 Nov 12 13:44 html-entities
drwxrwxr-x 1 root root  4096 Nov 12 13:44 html-entities-inside-elements
drwxrwxr-x 1 root root  4096 Nov 12 13:44 html-non-entities-inside-elements
drwxrwxr-x 1 root root  4096 Nov 12 13:44 if-block
drwxrwxr-x 1 root root  4096 Nov 12 13:44 if-block-else
drwxrwxr-x 1 root root  4096 Nov 12 13:44 if-block-elseif
drwxrwxr-x 1 root root  4096 Nov 12 13:44 if-block-elseif-text
drwxrwxr-x 1 root root  4096 Nov 12 13:44 if-block-expression
drwxrwxr-x 1 root root  4096 Nov 12 13:44 if-block-or
drwxrwxr-x 1 root root  4096 Nov 12 13:44 if-block-widget
drwxrwxr-x 1 root root  4096 Nov 12 13:44 ignore-unchanged-attribute
drwxrwxr-x 1 root root  4096 Nov 12 13:44 ignore-unchanged-attribute-compound
drwxrwxr-x 1 root root  4096 Nov 12 13:44 ignore-unchanged-raw
drwxrwxr-x 1 root root  4096 Nov 12 13:44 ignore-unchanged-tag
drwxrwxr-x 1 root root  4096 Nov 12 13:44 imported-renamed-components
drwxrwxr-x 1 root root  4096 Nov 12 13:44 inline-expressions
drwxrwxr-x 1 root root  4096 Nov 12 13:44 input-list
drwxrwxr-x 1 root root  4096 Nov 12 13:44 lifecycle-events
drwxrwxr-x 1 root root  4096 Nov 12 13:44 names-deconflicted
drwxrwxr-x 1 root root  4096 Nov 12 13:44 names-deconflicted-nested
drwxrwxr-x 1 root root  4096 Nov 12 13:44 nbsp
drwxrwxr-x 1 root root  4096 Nov 12 13:44 observe-binding-ignores-unchanged
drwxrwxr-x 1 root root  4096 Nov 12 13:44 observe-component-ignores-irrelevant-changes
drwxrwxr-x 1 root root  4096 Nov 12 13:44 observe-deferred
drwxrwxr-x 1 root root  4096 Nov 12 13:44 observe-prevents-loop
drwxrwxr-x 1 root root  4096 Nov 12 13:44 oncreate-async
drwxrwxr-x 1 root root  4096 Nov 12 13:44 oncreate-async-arrow
drwxrwxr-x 1 root root  4096 Nov 12 13:44 oncreate-async-arrow-block
drwxrwxr-x 1 root root  4096 Nov 12 13:44 ondestroy-before-cleanup
drwxrwxr-x 1 root root  4096 Nov 12 13:44 onrender-chain
drwxrwxr-x 1 root root  4096 Nov 12 13:44 onrender-fires-when-ready
drwxrwxr-x 1 root root  4096 Nov 12 13:44 onrender-fires-when-ready-nested
drwxrwxr-x 1 root root  4096 Nov 12 13:44 option-without-select
drwxrwxr-x 1 root root  4096 Nov 12 13:44 options
drwxrwxr-x 1 root root  4096 Nov 12 13:44 paren-wrapped-expressions
drwxrwxr-x 1 root root  4096 Nov 12 13:44 preload
drwxrwxr-x 1 root root  4096 Nov 12 13:44 raw-anchor-first-child
drwxrwxr-x 1 root root  4096 Nov 12 13:44 raw-anchor-first-last-child
drwxrwxr-x 1 root root  4096 Nov 12 13:44 raw-anchor-last-child
drwxrwxr-x 1 root root  4096 Nov 12 13:44 raw-anchor-next-previous-sibling
drwxrwxr-x 1 root root  4096 Nov 12 13:44 raw-anchor-next-sibling
drwxrwxr-x 1 root root  4096 Nov 12 13:44 raw-anchor-previous-sibling
drwxrwxr-x 1 root root  4096 Nov 12 13:44 raw-mustaches
drwxrwxr-x 1 root root  4096 Nov 12 13:44 raw-mustaches-preserved
drwxrwxr-x 1 root root  4096 Nov 12 13:44 refs
drwxrwxr-x 1 root root  4096 Nov 12 13:44 refs-unset
drwxrwxr-x 1 root root  4096 Nov 12 13:44 select
drwxrwxr-x 1 root root  4096 Nov 12 13:44 select-bind-array
drwxrwxr-x 1 root root  4096 Nov 12 13:44 select-bind-in-array
drwxrwxr-x 1 root root  4096 Nov 12 13:44 select-change-handler
drwxrwxr-x 1 root root  4096 Nov 12 13:44 select-no-whitespace
drwxrwxr-x 1 root root  4096 Nov 12 13:44 select-one-way-bind
drwxrwxr-x 1 root root  4096 Nov 12 13:44 select-one-way-bind-object
drwxrwxr-x 1 root root  4096 Nov 12 13:44 select-props
drwxrwxr-x 1 root root  4096 Nov 12 13:44 self-reference
drwxrwxr-x 1 root root  4096 Nov 12 13:44 self-reference-tree
drwxrwxr-x 1 root root  4096 Nov 12 13:44 set-after-destroy
drwxrwxr-x 1 root root  4096 Nov 12 13:44 set-clones-input
drwxrwxr-x 1 root root  4096 Nov 12 13:44 set-in-observe
drwxrwxr-x 1 root root  4096 Nov 12 13:44 set-in-observe-dedupes-renders
drwxrwxr-x 1 root root  4096 Nov 12 13:44 set-in-oncreate
drwxrwxr-x 1 root root  4096 Nov 12 13:44 set-in-ondestroy
drwxrwxr-x 1 root root  4096 Nov 12 13:44 set-mutated-data
drwxrwxr-x 1 root root  4096 Nov 12 13:44 set-prevents-loop
drwxrwxr-x 1 root root  4096 Nov 12 13:44 setup
drwxrwxr-x 1 root root  4096 Nov 12 13:44 sigil-static-#
drwxrwxr-x 1 root root  4096 Nov 12 13:44 sigil-static-@
drwxrwxr-x 1 root root  4096 Nov 12 13:44 single-static-element
drwxrwxr-x 1 root root  4096 Nov 12 13:44 single-text-node
drwxrwxr-x 1 root root  4096 Nov 12 13:44 slot-in-custom-element
drwxrwxr-x 1 root root  4096 Nov 12 13:44 state-deconflicted
drwxrwxr-x 1 root root  4096 Nov 12 13:44 store
drwxrwxr-x 1 root root  4096 Nov 12 13:44 store-binding
drwxrwxr-x 1 root root  4096 Nov 12 13:44 store-computed
drwxrwxr-x 1 root root  4096 Nov 12 13:44 store-event
drwxrwxr-x 1 root root  4096 Nov 12 13:44 store-root
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg-attributes
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg-child-component-declared-namespace
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg-child-component-declared-namespace-shorthand
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg-class
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg-each-block-anchor
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg-each-block-namespace
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg-multiple
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg-no-whitespace
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg-xlink
drwxrwxr-x 1 root root  4096 Nov 12 13:44 svg-xmlns
drwxrwxr-x 1 root root  4096 Nov 12 13:44 textarea-children
drwxrwxr-x 1 root root  4096 Nov 12 13:44 textarea-value
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-css-delay
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-delay
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-delay-in-out
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-dynamic-if-block-bidi
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-each-block-intro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-each-block-intro-outro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-each-block-keyed-intro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-each-block-keyed-intro-outro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-each-block-keyed-outro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-each-block-outro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-events
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-if-block-bidi
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-if-block-in-each-block-bidi
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-if-block-in-each-block-bidi-2
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-if-block-in-each-block-bidi-3
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-if-block-intro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-if-block-intro-outro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-if-else-block-dynamic-outro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-if-else-block-intro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-if-else-block-outro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-if-elseif-block-outro
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-initial
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-parameterised
drwxrwxr-x 1 root root  4096 Nov 12 13:44 transition-js-parameterised-with-state
drwxrwxr-x 1 root root  4096 Nov 12 13:44 whitespace-each-block
drwxrwxr-x 1 root root  4096 Nov 12 13:44 whitespace-normal
drwxrwxr-x 1 root root  4096 Nov 12 13:44 window-bind-scroll-update
drwxrwxr-x 1 root root  4096 Nov 12 13:44 window-binding-resize
drwxrwxr-x 1 root root  4096 Nov 12 13:44 window-event
drwxrwxr-x 1 root root  4096 Nov 12 13:44 window-event-context
[?2004l
2025-11-12 14:11:34,446 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_PebzUj9nHs4hEara4Mv5wSTu', 'function': {'arguments': '{"command":"ls -la test/server-side-rendering/samples | grep store"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 164, 'prompt_tokens': 16564, 'total_tokens': 16728, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7507cee4-9934-44de-8fa6-b57bef20fe64-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la test/server-side-rendering/samples | grep store'}, 'id': 'call_PebzUj9nHs4hEara4Mv5wSTu', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16564, 'output_tokens': 164, 'total_tokens': 16728, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 14:11:34,449 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: ls -la test/server-side-rendering/samples | grep store
2025-11-12 14:11:34,551 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 14:11:34,551 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 ls -la test/server-side-rendering/samples | grep stor
re
[?2004l
[?2004l
2025-11-12 14:12:06,089 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OXeYHGnVJs5rfSKEd9XRStuz', 'function': {'arguments': '{"command":"npm test -- -g \'(^|\\\\s)store-root \\\\(inline helpers\\\\)$|(^|\\\\s)store-(computed|binding|event|root)$\'"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1979, 'prompt_tokens': 16633, 'total_tokens': 18612, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1920, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 6016}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--eb655455-176f-44e9-a9eb-7b0f9379a759-0' tool_calls=[{'name': 'run_command', 'args': {'command': "npm test -- -g '(^|\\s)store-root \\(inline helpers\\)$|(^|\\s)store-(computed|binding|event|root)$'"}, 'id': 'call_OXeYHGnVJs5rfSKEd9XRStuz', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16633, 'output_tokens': 1979, 'total_tokens': 18612, 'input_token_details': {'audio': 0, 'cache_read': 6016}, 'output_token_details': {'audio': 0, 'reasoning': 1920}}
2025-11-12 14:12:06,093 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Executing command: npm test -- -g '(^|\s)store-root \(inline helpers\)$|(^|\s)store-(computed|binding|event|root)$'
2025-11-12 14:12:13,535 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 14:12:13,536 - thread-135845298308800.prometheus.docker.base_container - DEBUG - Command output:
 npm test -- -g '(^|\s)store-root \(inline helpers\)$|
|(^|\s)store-(computed|binding|event|root)$'
[?2004l

> svelte@1.51.1 pretest
> npm run build


> svelte@1.51.1 build
> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js

[36m[39m
[36m[1msrc/index.ts[22m → [1mcompiler/svelte.js[22m...[39m
[32mcreated [1mcompiler/svelte.js[22m in [1m4.8s[22m[39m
[36m[39m
[36m[1msrc/server-side-rendering/register.js[22m → [1mssr/register.js[22m...[39m
[32mcreated [1mssr/register.js[22m in [1m29ms[22m[39m
[36m[39m
[36m[1msrc/shared/index.js[22m → [1mshared.js[22m...[39m
[32mcreated [1mshared.js[22m in [1m38ms[22m[39m
[36m[39m
[36m[1mstore.js[22m → [1mstore.umd.js[22m...[39m
[32mcreated [1mstore.umd.js[22m in [1m84ms[22m[39m

> svelte@1.51.1 test
> mocha --opts mocha.opts -g (^|\s)store-root \(inline helpers\)$|(^|\s)store-(computed|binding|event|root)$


[0m[0m
[0m  runtime[0m
  [32m  ✓[0m[90m store-root (inline helpers)[0m[31m (86ms)[0m

[0m  ssr[0m
  [32m  ✓[0m[90m store-binding[0m
  [32m  ✓[0m[90m store-computed[0m
  [32m  ✓[0m[90m store-event[0m
  [32m  ✓[0m[90m store-root[0m


[92m [0m[32m 5 passing[0m[90m (165ms)[0m

[?2004l
2025-11-12 14:12:16,890 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='Result:\n5 tests run.\nAll selected tests passed.\n\nOutput:\n> svelte@1.51.1 pretest\n> npm run build\n\n\n> svelte@1.51.1 build\n> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js\n\n[build logs elided for brevity]\n\n> svelte@1.51.1 test\n> mocha --opts mocha.opts -g (^|\\s)store-root \\(inline helpers\\)$|(^|\\s)store-(computed|binding|event|root)$\n\n\n  runtime\n    ✓ store-root (inline helpers) (86ms)\n\n  ssr\n    ✓ store-binding\n    ✓ store-computed\n    ✓ store-event\n    ✓ store-root\n\n\n  5 passing (165ms)' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 171, 'prompt_tokens': 17355, 'total_tokens': 17526, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 13056}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--2b1ed60d-1277-42bc-8065-1f4d4c6fbea0-0' usage_metadata={'input_tokens': 17355, 'output_tokens': 171, 'total_tokens': 17526, 'input_token_details': {'audio': 0, 'cache_read': 13056}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 14:12:16,893 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_structure_node - DEBUG - Human Message: 
We have run the selected regression tests on the codebase.
The following regression tests were selected to run:
--- BEGIN SELECTED REGRESSION TESTS ---
test/server-side-rendering/index.js::store-root
test/server-side-rendering/index.js::store-computed
test/server-side-rendering/index.js::store-binding
test/server-side-rendering/index.js::store-event
test/runtime/index.js::store-root (inline helpers)
--- END SELECTED REGRESSION TESTS ---

Run Regression Tests Logs:
--- BEGIN LOG ---
Result:
5 tests run.
All selected tests passed.

Output:
> svelte@1.51.1 pretest
> npm run build


> svelte@1.51.1 build
> node src/shared/_build.js && rollup -c && rollup -c rollup.store.config.js

[build logs elided for brevity]

> svelte@1.51.1 test
> mocha --opts mocha.opts -g (^|\s)store-root \(inline helpers\)$|(^|\s)store-(computed|binding|event|root)$


  runtime
    ✓ store-root (inline helpers) (86ms)

  ssr
    ✓ store-binding
    ✓ store-computed
    ✓ store-event
    ✓ store-root


  5 passing (165ms)
--- END LOG ---

Please analyze the logs and determine which regression tests passed!. You should return the exact test identifier 
that we give to you.
Don't forget to return the total number of tests run!

2025-11-12 14:12:25,625 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_structure_node - DEBUG - passed_regression_tests=['test/server-side-rendering/index.js::store-root', 'test/server-side-rendering/index.js::store-computed', 'test/server-side-rendering/index.js::store-binding', 'test/server-side-rendering/index.js::store-event', 'test/runtime/index.js::store-root (inline helpers)'] regression_test_fail_log='' total_tests_run=5
2025-11-12 14:12:25,626 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - INFO - passed_regression_tests: ['test/server-side-rendering/index.js::store-root', 'test/server-side-rendering/index.js::store-computed', 'test/server-side-rendering/index.js::store-binding', 'test/server-side-rendering/index.js::store-event', 'test/runtime/index.js::store-root (inline helpers)']
2025-11-12 14:12:25,626 - thread-135845298308800.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - DEBUG - regression_test_fail_log: 
2025-11-12 14:12:25,627 - thread-135845298308800.prometheus.lang_graph.nodes.get_pass_regression_test_patch_check_result_node - DEBUG - All regression tests ['test/server-side-rendering/index.js::store-root', 'test/server-side-rendering/index.js::store-computed', 'test/server-side-rendering/index.js::store-binding', 'test/server-side-rendering/index.js::store-event', 'test/runtime/index.js::store-root (inline helpers)']
2025-11-12 14:12:25,627 - thread-135845298308800.prometheus.lang_graph.nodes.get_pass_regression_test_patch_check_result_node - DEBUG - Current passed tests ['test/server-side-rendering/index.js::store-root', 'test/server-side-rendering/index.js::store-computed', 'test/server-side-rendering/index.js::store-binding', 'test/server-side-rendering/index.js::store-event', 'test/runtime/index.js::store-root (inline helpers)']
2025-11-12 14:12:25,627 - thread-135845298308800.prometheus.lang_graph.nodes.get_pass_regression_test_patch_check_result_node - DEBUG - True
2025-11-12 14:12:25,629 - thread-135845298308800.prometheus.lang_graph.nodes.get_pass_regression_test_patch_subgraph_node - DEBUG - tested_patch_result: [TestedPatchResult(patch='diff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts\nindex 37bf859da..32dfc2d01 100644\n--- a/src/generators/server-side-rendering/index.ts\n+++ b/src/generators/server-side-rendering/index.ts\n@@ -81,9 +81,7 @@ export default function ssr(\n \n \tif (storeProps.length > 0) {\n \t\tconst initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`\n-\t\tif (options.store || templateProperties.store) {\n-\t\t\tinitialState.push(`options.store.${initialize}`);\n-\t\t}\n+\t\tinitialState.push(`options.store ? options.store.${initialize} : {}`);\n \t}\n \n \tif (templateProperties.data) {\ndiff --git a/src/generators/server-side-rendering/visitors/Component.ts b/src/generators/server-side-rendering/visitors/Component.ts\nindex 4843010fc..9126b8c3b 100644\n--- a/src/generators/server-side-rendering/visitors/Component.ts\n+++ b/src/generators/server-side-rendering/visitors/Component.ts\n@@ -88,7 +88,7 @@ export default function visitComponent(\n \n \tconst options = [];\n \tif (generator.options.store) {\n-\t\toptions.push(`store: options.store`);\n+\t\toptions.push(`store: (options.store || (${expression}.store && ${expression}.store()))`);\n \t}\n \n \tif (node.children.length) {\n', passed=True, regression_test_failure_log='')]
2025-11-12 14:12:25,667 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State max_refined_query_loop: 4
2025-11-12 14:12:25,667 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State number_of_candidate_patch: 3
2025-11-12 14:12:25,667 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_existing_test: False
2025-11-12 14:12:25,667 - thread-135845298308800.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_regression_test: True
2025-11-12 14:12:25,699 - thread-135845298308800.prometheus.lang_graph.nodes.issue_verified_bug_subgraph_node - INFO - edit_patch: diff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts
index 37bf859da..32dfc2d01 100644
--- a/src/generators/server-side-rendering/index.ts
+++ b/src/generators/server-side-rendering/index.ts
@@ -81,9 +81,7 @@ export default function ssr(
 
 	if (storeProps.length > 0) {
 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
-		if (options.store || templateProperties.store) {
-			initialState.push(`options.store.${initialize}`);
-		}
+		initialState.push(`options.store ? options.store.${initialize} : {}`);
 	}
 
 	if (templateProperties.data) {
diff --git a/src/generators/server-side-rendering/visitors/Component.ts b/src/generators/server-side-rendering/visitors/Component.ts
index 4843010fc..9126b8c3b 100644
--- a/src/generators/server-side-rendering/visitors/Component.ts
+++ b/src/generators/server-side-rendering/visitors/Component.ts
@@ -88,7 +88,7 @@ export default function visitComponent(
 
 	const options = [];
 	if (generator.options.store) {
-		options.push(`store: options.store`);
+		options.push(`store: (options.store || (${expression}.store && ${expression}.store()))`);
 	}
 
 	if (node.children.length) {

2025-11-12 14:12:34,322 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_responder_node - DEBUG - content='Thanks for the detailed report and the code snippets — that made the issue clear.\n\nOur analysis showed that, during server-side rendering, nested components were always receiving the parent’s store via options.store and the child component’s own store initializer was never invoked. As a result, when a child relied on its own store (like your TwoFactorAuth component), options.store was undefined and the generated SSR code attempted to call _init on it, causing the error you saw.\n\nWhat changed:\n- We now guard the store initialization in SSR so that, if no store is present, we don’t call _init on undefined. Instead, we fall back to an empty object for initial state.\n- When rendering nested components on the server, we pass either the parent store (if available) or, if the child defines a store, we invoke the child’s store initializer and pass that to the component. This ensures child components that manage their own store work correctly during SSR.\n\nVerification:\n- The reproducing test for this bug now passes.\n- All selected regression tests also pass successfully.\n\nThis should fix the server-side rendering case for nested components using their own store (such as with svelte-redux). If you still see any issues, please let us know with a minimal example and we’ll take another look.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 781, 'prompt_tokens': 1095, 'total_tokens': 1876, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--322fe3f9-cede-4942-82f5-e2c35707b468-0' usage_metadata={'input_tokens': 1095, 'output_tokens': 781, 'total_tokens': 1876, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 14:12:34,324 - thread-135845298308800.prometheus.docker.base_container - INFO - Cleaning up container and temporary files
2025-11-12 14:12:34,324 - thread-135845298308800.prometheus.docker.base_container - INFO - Closing persistent shell...
2025-11-12 14:12:34,425 - thread-135845298308800.prometheus.docker.base_container - INFO - Cleaning up container and temporary files
2025-11-12 14:12:44,817 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - Generated patch:
diff --git a/src/generators/server-side-rendering/index.ts b/src/generators/server-side-rendering/index.ts
index 37bf859da..32dfc2d01 100644
--- a/src/generators/server-side-rendering/index.ts
+++ b/src/generators/server-side-rendering/index.ts
@@ -81,9 +81,7 @@ export default function ssr(
 
 	if (storeProps.length > 0) {
 		const initialize = `_init([${storeProps.map(prop => `"${prop.slice(1)}"`)}])`
-		if (options.store || templateProperties.store) {
-			initialState.push(`options.store.${initialize}`);
-		}
+		initialState.push(`options.store ? options.store.${initialize} : {}`);
 	}
 
 	if (templateProperties.data) {
diff --git a/src/generators/server-side-rendering/visitors/Component.ts b/src/generators/server-side-rendering/visitors/Component.ts
index 4843010fc..9126b8c3b 100644
--- a/src/generators/server-side-rendering/visitors/Component.ts
+++ b/src/generators/server-side-rendering/visitors/Component.ts
@@ -88,7 +88,7 @@ export default function visitComponent(
 
 	const options = [];
 	if (generator.options.store) {
-		options.push(`store: options.store`);
+		options.push(`store: (options.store || (${expression}.store && ${expression}.store()))`);
 	}
 
 	if (node.children.length) {

2025-11-12 14:12:44,817 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - passed_reproducing_test: True
2025-11-12 14:12:44,817 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - passed_regression_test: True
2025-11-12 14:12:44,817 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - passed_existing_test: False
2025-11-12 14:12:44,817 - thread-135845298308800.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - issue_response:
Thanks for the detailed report and the code snippets — that made the issue clear.

Our analysis showed that, during server-side rendering, nested components were always receiving the parent’s store via options.store and the child component’s own store initializer was never invoked. As a result, when a child relied on its own store (like your TwoFactorAuth component), options.store was undefined and the generated SSR code attempted to call _init on it, causing the error you saw.

What changed:
- We now guard the store initialization in SSR so that, if no store is present, we don’t call _init on undefined. Instead, we fall back to an empty object for initial state.
- When rendering nested components on the server, we pass either the parent store (if available) or, if the child defines a store, we invoke the child’s store initializer and pass that to the component. This ensures child components that manage their own store work correctly during SSR.

Verification:
- The reproducing test for this bug now passes.
- All selected regression tests also pass successfully.

This should fix the server-side rendering case for nested components using their own store (such as with svelte-redux). If you still see any issues, please let us know with a minimal example and we’ll take another look.
