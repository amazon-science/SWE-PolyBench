2025-11-12 11:15:33,971 - thread-135845287823040.prometheus.docker.base_container - INFO - Created temporary project directory: /tmp/tmpy3kq2z0v/apollo
2025-11-12 11:15:33,971 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Using workdir: /testbed
2025-11-12 11:15:34,926 - thread-135845287823040.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_build: False
2025-11-12 11:15:34,927 - thread-135845287823040.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_existing_test: False
2025-11-12 11:15:34,927 - thread-135845287823040.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_regression_test: True
2025-11-12 11:15:34,927 - thread-135845287823040.prometheus.lang_graph.nodes.noop_node - DEBUG - State run_reproduce_test: True
2025-11-12 11:15:34,927 - thread-135845287823040.prometheus.lang_graph.nodes.noop_node - DEBUG - State number_of_candidate_patch: 5
2025-11-12 11:15:34,928 - thread-135845287823040.prometheus.lang_graph.nodes.issue_classification_subgraph_node - INFO - Enter IssueClassificationSubgraphNode
2025-11-12 11:15:34,930 - thread-135845287823040.prometheus.lang_graph.nodes.issue_classification_context_message_node - DEBUG - Sending query to context provider:
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

2025-11-12 11:15:34,931 - thread-135845287823040.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-12 11:15:34,933 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:15:50,680 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The current context only provides the repository file tree and no source code or documentation content. To accurately classify whether creating a namespace named '.' causing a 500 error is a bug versus intended behavior, we must inspect the server-side namespace creation/query logic (controllers/services/validators/entities) and the official documentation specifying valid namespace naming rules. Without these implementations and docs, we cannot determine expected behavior or existing validation and error handling." query='Please provide the full source (with line numbers) of the namespace creation and query handlers in apollo-portal and apollo-biz, including NamespaceController, NamespaceService, related validators/entities/repositories, and the docs/en/design/apollo-core-concept-namespace.md.' extra_requirements="If exact file names are unclear, please share all classes under apollo-portal/src/main/java and apollo-biz/src/main/java whose names contain 'Namespace' and any REST endpoints for namespace operations, plus any tests referencing namespace naming." purpose='This will allow verifying expected naming rules and whether a single dot should be rejected or supported, identifying the cause of the 500 and correctly classifying the issue.'
2025-11-12 11:15:50,682 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full source (with line numbers) of the namespace creation and query handlers in apollo-portal and apollo-biz, including NamespaceController, NamespaceService, related validators/entities/repositories, and the docs/en/design/apollo-core-concept-namespace.md.
2025-11-12 11:15:53,372 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 11:15:53,372 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 11:15:53,372 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 11:15:53,372 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 11:15:53,374 - thread-135845287823040.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 11:15:53,375 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 11:15:53,375 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full source (with line numbers) of the namespace creation and query handlers in apollo-portal and apollo-biz, including NamespaceController, NamespaceService, related validators/entities/repositories, and the docs/en/design/apollo-core-concept-namespace.md.
Extra requirements: If exact file names are unclear, please share all classes under apollo-portal/src/main/java and apollo-biz/src/main/java whose names contain 'Namespace' and any REST endpoints for namespace operations, plus any tests referencing namespace naming.
Purpose: This will allow verifying expected naming rules and whether a single dot should be rejected or supported, identifying the cause of the 500 and correctly classifying the issue.
2025-11-12 11:16:09,162 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_N6Y4rsENkpT2vXodLKCUvXL2', 'function': {'arguments': '{"relative_path":"docs/en/design/apollo-core-concept-namespace.md"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1128, 'prompt_tokens': 2300, 'total_tokens': 3428, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1088, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--17ed9d42-6638-4435-8910-8a315db52959-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'docs/en/design/apollo-core-concept-namespace.md'}, 'id': 'call_N6Y4rsENkpT2vXodLKCUvXL2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2300, 'output_tokens': 1128, 'total_tokens': 3428, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1088}}
2025-11-12 11:16:18,413 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_HvWVrGPZdeAFuCppm0tWjA2X', 'function': {'arguments': '{"basename":"NamespaceController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 670, 'prompt_tokens': 5213, 'total_tokens': 5883, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--43f7fb79-e88a-4401-9bec-c38e0925aa44-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceController.java'}, 'id': 'call_HvWVrGPZdeAFuCppm0tWjA2X', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5213, 'output_tokens': 670, 'total_tokens': 5883, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-12 11:16:19,910 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_soJcFN9RUbSytwfJWKOIRe5a', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 5402, 'total_tokens': 5445, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--456be0dd-61a6-4e81-a845-c8eb8baeeaf0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java'}, 'id': 'call_soJcFN9RUbSytwfJWKOIRe5a', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5402, 'output_tokens': 43, 'total_tokens': 5445, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:16:26,597 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Kvdki4NncA3sYJD5dTi8ROpn', 'function': {'arguments': '{"basename":"NamespaceService.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 478, 'prompt_tokens': 9652, 'total_tokens': 10130, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d3c47e13-c461-4b3c-bee6-19c512bb1530-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceService.java'}, 'id': 'call_Kvdki4NncA3sYJD5dTi8ROpn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9652, 'output_tokens': 478, 'total_tokens': 10130, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-12 11:16:28,635 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1PkqLW0LfJ2zueJnmzOsnOLa', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 9789, 'total_tokens': 9832, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bba9f0d9-9de5-4492-bee4-1cbc36412927-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java'}, 'id': 'call_1PkqLW0LfJ2zueJnmzOsnOLa', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9789, 'output_tokens': 43, 'total_tokens': 9832, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:16:30,068 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VZGPlh1MpFgHYurv1vEcfwur', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 15076, 'total_tokens': 15119, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5736a920-a871-44f1-b8e3-f1dfafab27fb-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java'}, 'id': 'call_VZGPlh1MpFgHYurv1vEcfwur', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15076, 'output_tokens': 43, 'total_tokens': 15119, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:16:40,364 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_K7CClfKYqJvML11xoHNeGCTP', 'function': {'arguments': '{"basename":"InputValidator.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 734, 'prompt_tokens': 20111, 'total_tokens': 20845, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1ee2ac5b-c38f-46b8-9835-ab60356ee56d-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'InputValidator.java'}, 'id': 'call_K7CClfKYqJvML11xoHNeGCTP', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20111, 'output_tokens': 734, 'total_tokens': 20845, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-12 11:16:42,455 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VP2rRhwNP8WlM40m1RiKQCjN', 'function': {'arguments': '{"relative_path":"apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 40, 'prompt_tokens': 20195, 'total_tokens': 20235, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5376}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0fd57d36-7623-4d62-bc18-a0eb976c9708-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java'}, 'id': 'call_VP2rRhwNP8WlM40m1RiKQCjN', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20195, 'output_tokens': 40, 'total_tokens': 20235, 'input_token_details': {'audio': 0, 'cache_read': 5376}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:17:01,889 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_YkBhIgYj2A6fQkg3eSCqEwxe', 'function': {'arguments': '{"basename":"Namespace.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1821, 'prompt_tokens': 20900, 'total_tokens': 22721, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1792, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 9600}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2cc3db8a-9677-418f-a379-aa09279c1744-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Namespace.java'}, 'id': 'call_YkBhIgYj2A6fQkg3eSCqEwxe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20900, 'output_tokens': 1821, 'total_tokens': 22721, 'input_token_details': {'audio': 0, 'cache_read': 9600}, 'output_token_details': {'audio': 0, 'reasoning': 1792}}
2025-11-12 11:17:04,393 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_XvjPurWpKCP518BgrbG3oukY', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 42, 'prompt_tokens': 20984, 'total_tokens': 21026, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9dde2908-dd4d-4f6c-b0d3-c98bd2b6b3d9-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java'}, 'id': 'call_XvjPurWpKCP518BgrbG3oukY', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20984, 'output_tokens': 42, 'total_tokens': 21026, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:17:07,205 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_k3PVJiYQvhWgMoqWbYXjB6Pt', 'function': {'arguments': '{"basename":"NamespaceRepository.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 158, 'prompt_tokens': 21894, 'total_tokens': 22052, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 15104}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--73146877-e7b6-4209-8747-9b7f3758cc14-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceRepository.java'}, 'id': 'call_k3PVJiYQvhWgMoqWbYXjB6Pt', 'type': 'tool_call'}] usage_metadata={'input_tokens': 21894, 'output_tokens': 158, 'total_tokens': 22052, 'input_token_details': {'audio': 0, 'cache_read': 15104}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 11:17:09,261 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_GIQP3sz27t4AwkPHhyuMvp9Q', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 21982, 'total_tokens': 22026, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--744cf477-22c0-47c7-aaa9-a5ebc5e8e920-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java'}, 'id': 'call_GIQP3sz27t4AwkPHhyuMvp9Q', 'type': 'tool_call'}] usage_metadata={'input_tokens': 21982, 'output_tokens': 44, 'total_tokens': 22026, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:17:23,152 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_iHkVcIX0JdwY2MZpHmUlGNvN', 'function': {'arguments': '{"basename":"AppNamespaceService.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1055, 'prompt_tokens': 22690, 'total_tokens': 23745, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1024, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 20992}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--df0ecd36-f4b5-45f6-9c4f-13cfb0491635-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceService.java'}, 'id': 'call_iHkVcIX0JdwY2MZpHmUlGNvN', 'type': 'tool_call'}] usage_metadata={'input_tokens': 22690, 'output_tokens': 1055, 'total_tokens': 23745, 'input_token_details': {'audio': 0, 'cache_read': 20992}, 'output_token_details': {'audio': 0, 'reasoning': 1024}}
2025-11-12 11:17:26,005 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_M20DQjHwb5R0WJqjtMSu0YF2', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 22830, 'total_tokens': 22873, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c73ee3e4-f066-4be9-8bcb-32bd9bb7e6e3-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java'}, 'id': 'call_M20DQjHwb5R0WJqjtMSu0YF2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 22830, 'output_tokens': 43, 'total_tokens': 22873, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:17:27,790 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_7IPtk7lYBa3NqtTILEX1t50U', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 25996, 'total_tokens': 26039, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 22016}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ad304653-5368-4b24-ba73-fa9737d5d00c-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java'}, 'id': 'call_7IPtk7lYBa3NqtTILEX1t50U', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25996, 'output_tokens': 43, 'total_tokens': 26039, 'input_token_details': {'audio': 0, 'cache_read': 22016}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:17:37,450 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zD2kFtNVCa4i0QgYeekwUMQv', 'function': {'arguments': '{"basename":"AppNamespaceRepository.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 991, 'prompt_tokens': 28407, 'total_tokens': 29398, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9f004c78-0c31-4e2b-8c0c-5993b757d740-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceRepository.java'}, 'id': 'call_zD2kFtNVCa4i0QgYeekwUMQv', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28407, 'output_tokens': 991, 'total_tokens': 29398, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 11:17:40,001 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_m3X18cDIo2gUWXrdMTEv4CKc', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 28549, 'total_tokens': 28593, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 9728}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2b5e939c-e425-4d59-aaf8-4804dcf4a306-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java'}, 'id': 'call_m3X18cDIo2gUWXrdMTEv4CKc', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28549, 'output_tokens': 44, 'total_tokens': 28593, 'input_token_details': {'audio': 0, 'cache_read': 9728}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:17:41,867 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_99AVjO4lH2OuepKNfhojNmlt', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 29254, 'total_tokens': 29298, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 25984}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0521c5e8-da8c-4115-9b77-d82be2b7379a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java'}, 'id': 'call_99AVjO4lH2OuepKNfhojNmlt', 'type': 'tool_call'}] usage_metadata={'input_tokens': 29254, 'output_tokens': 44, 'total_tokens': 29298, 'input_token_details': {'audio': 0, 'cache_read': 25984}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:17:54,909 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_HND3vZb7N5Ah3VlOI2TdFG8I', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 883, 'prompt_tokens': 30051, 'total_tokens': 30934, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 20224}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--347d8989-f8ef-4bde-8703-5168e1d49db6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java'}, 'id': 'call_HND3vZb7N5Ah3VlOI2TdFG8I', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30051, 'output_tokens': 883, 'total_tokens': 30934, 'input_token_details': {'audio': 0, 'cache_read': 20224}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 11:18:03,967 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_EKeePY5lBMix3Gd2JEvSHaxL', 'function': {'arguments': '{"basename":"AppNamespace.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 478, 'prompt_tokens': 31561, 'total_tokens': 32039, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 22656}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--918ee547-a0c5-44d2-8e1f-5e720100f913-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespace.java'}, 'id': 'call_EKeePY5lBMix3Gd2JEvSHaxL', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31561, 'output_tokens': 478, 'total_tokens': 32039, 'input_token_details': {'audio': 0, 'cache_read': 22656}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-12 11:18:05,672 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_akakWiu9IjLPhEJSNHYfC8S4', 'function': {'arguments': '{"relative_path":"apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 40, 'prompt_tokens': 31645, 'total_tokens': 31685, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 21888}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3472affa-79eb-423e-999d-3a46bd8d2157-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java'}, 'id': 'call_akakWiu9IjLPhEJSNHYfC8S4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 31645, 'output_tokens': 40, 'total_tokens': 31685, 'input_token_details': {'audio': 0, 'cache_read': 21888}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:18:18,555 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_TSxkZNelIqgqqxaCDiSs9JTy', 'function': {'arguments': '{"basename":"NamespaceBO.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 798, 'prompt_tokens': 32811, 'total_tokens': 33609, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c72bef5b-92e6-40d4-982f-9eed7adef58e-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceBO.java'}, 'id': 'call_TSxkZNelIqgqqxaCDiSs9JTy', 'type': 'tool_call'}] usage_metadata={'input_tokens': 32811, 'output_tokens': 798, 'total_tokens': 33609, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 11:18:20,233 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_PfhQcWklptziNVyqwSADNZ0L', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/NamespaceBO.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 45, 'prompt_tokens': 32900, 'total_tokens': 32945, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 31488}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ae767364-c762-4881-95d3-91a009bb80b7-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/NamespaceBO.java'}, 'id': 'call_PfhQcWklptziNVyqwSADNZ0L', 'type': 'tool_call'}] usage_metadata={'input_tokens': 32900, 'output_tokens': 45, 'total_tokens': 32945, 'input_token_details': {'audio': 0, 'cache_read': 31488}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:18:28,326 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_n2pOGgwuFN0w8D8xV4dnxyxK', 'function': {'arguments': '{"basename":"NamespaceCreationModel.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 607, 'prompt_tokens': 33920, 'total_tokens': 34527, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b2a7bce8-5925-480e-9791-f78fcb247212-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceCreationModel.java'}, 'id': 'call_n2pOGgwuFN0w8D8xV4dnxyxK', 'type': 'tool_call'}] usage_metadata={'input_tokens': 33920, 'output_tokens': 607, 'total_tokens': 34527, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 11:18:29,967 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_NgTHM2AdAEuyYhVfx66t9qlG', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/model/NamespaceCreationModel.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 45, 'prompt_tokens': 34011, 'total_tokens': 34056, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 33792}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--697fe269-2fd7-4e8d-9499-2cf226d651b3-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/model/NamespaceCreationModel.java'}, 'id': 'call_NgTHM2AdAEuyYhVfx66t9qlG', 'type': 'tool_call'}] usage_metadata={'input_tokens': 34011, 'output_tokens': 45, 'total_tokens': 34056, 'input_token_details': {'audio': 0, 'cache_read': 33792}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:18:39,041 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_J7GBEIjTzJ17kSWQtH18PdKb', 'function': {'arguments': '{"basename":"InputValidatorTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 927, 'prompt_tokens': 34534, 'total_tokens': 35461, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 896, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 29184}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--07c19064-bda8-4d08-82ab-448e03993df4-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'InputValidatorTest.java'}, 'id': 'call_J7GBEIjTzJ17kSWQtH18PdKb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 34534, 'output_tokens': 927, 'total_tokens': 35461, 'input_token_details': {'audio': 0, 'cache_read': 29184}, 'output_token_details': {'audio': 0, 'reasoning': 896}}
2025-11-12 11:18:40,889 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6A4rvu2LQz1u5JtxkoguOApS', 'function': {'arguments': '{"relative_path":"apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 34621, 'total_tokens': 34662, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 29952}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c161cebb-6e17-424f-948f-b3a160239fa2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java'}, 'id': 'call_6A4rvu2LQz1u5JtxkoguOApS', 'type': 'tool_call'}] usage_metadata={'input_tokens': 34621, 'output_tokens': 41, 'total_tokens': 34662, 'input_token_details': {'audio': 0, 'cache_read': 29952}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:18:50,116 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Kbc3KUyg8oIFyquXftx5XVlH', 'function': {'arguments': '{"basename":"NamespaceBranchService.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 607, 'prompt_tokens': 35344, 'total_tokens': 35951, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 32896}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2e52cb46-2ea3-4a49-89da-bac3bb2401da-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceBranchService.java'}, 'id': 'call_Kbc3KUyg8oIFyquXftx5XVlH', 'type': 'tool_call'}] usage_metadata={'input_tokens': 35344, 'output_tokens': 607, 'total_tokens': 35951, 'input_token_details': {'audio': 0, 'cache_read': 32896}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 11:18:52,680 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_wy5hcYGRbAhnktlaNY1qHrLq', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceBranchService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 35486, 'total_tokens': 35530, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 22784}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--85aad058-82b2-4c52-aeef-29f698ca9b74-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceBranchService.java'}, 'id': 'call_wy5hcYGRbAhnktlaNY1qHrLq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 35486, 'output_tokens': 44, 'total_tokens': 35530, 'input_token_details': {'audio': 0, 'cache_read': 22784}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:18:54,337 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xUzHDN09FQqPuHxIHRodp9nX', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 37893, 'total_tokens': 37921, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 35328}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1b67a7ce-8f38-47ab-ba9c-1b5747001475-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'apollo-portal/src/main/java'}, 'id': 'call_xUzHDN09FQqPuHxIHRodp9nX', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37893, 'output_tokens': 28, 'total_tokens': 37921, 'input_token_details': {'audio': 0, 'cache_read': 35328}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:18:56,417 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_rdGi7hloAoT2bsXzqxB8lkgq', 'function': {'arguments': '{"text":"class .*Namespace", "relative_path":"apollo-portal/src/main/java"}', 'name': 'find_ast_node_with_text_in_file_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 37968, 'total_tokens': 38007, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 34560}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e42047cc-2553-4c50-a445-9986b2a22993-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'class .*Namespace', 'relative_path': 'apollo-portal/src/main/java'}, 'id': 'call_rdGi7hloAoT2bsXzqxB8lkgq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37968, 'output_tokens': 39, 'total_tokens': 38007, 'input_token_details': {'audio': 0, 'cache_read': 34560}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:19:18,924 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located and retrieved the full docs/en/design/apollo-core-concept-namespace.md and the namespace-related controllers and services: apollo-portal’s NamespaceController (UI) and OpenAPI NamespaceController, plus apollo-portal NamespaceService and NamespaceBranchService. I also pulled the corresponding apollo-biz NamespaceService, entities (apollo-biz Namespace, apollo-common AppNamespace), repositories (NamespaceRepository in biz; AppNamespaceRepository in both portal and biz), and the validator and its test (InputValidator and InputValidatorTest) that enforce naming rules. The retrieved controllers expose the namespace creation, query, and deletion endpoints, and the services show how creation and queries are handled; the validator regex clarifies naming constraints (e.g., forbidding file-format suffixes). This should allow you to verify whether a single dot is permitted and investigate the 500 error source.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1722, 'prompt_tokens': 38037, 'total_tokens': 39759, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1536, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 37888}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--1880376e-40d6-40aa-bc8d-69c30ad9b38a-0' usage_metadata={'input_tokens': 38037, 'output_tokens': 1722, 'total_tokens': 39759, 'input_token_details': {'audio': 0, 'cache_read': 37888}, 'output_token_details': {'audio': 0, 'reasoning': 1536}}
2025-11-12 11:19:18,931 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full source (with line numbers) of the namespace creation and query handlers in apollo-portal and apollo-biz, including NamespaceController, NamespaceService, related validators/entities/repositories, and the docs/en/design/apollo-core-concept-namespace.md.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If exact file names are unclear, please share all classes under apollo-portal/src/main/java and apollo-biz/src/main/java whose names contain 'Namespace' and any REST endpoints for namespace operations, plus any tests referencing namespace naming.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
This will allow verifying expected naming rules and whether a single dot should be rejected or supported, identifying the cause of the 500 and correctly classifying the issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java
Line number range: 1 - 81
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.entity;
18. 
19. import com.ctrip.framework.apollo.common.entity.BaseEntity;
20. 
21. import org.hibernate.annotations.SQLDelete;
22. import org.hibernate.annotations.Where;
23. 
24. import javax.persistence.Column;
25. import javax.persistence.Entity;
26. import javax.persistence.Table;
27. 
28. @Entity
29. @Table(name = "Namespace")
30. @SQLDelete(sql = "Update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")
31. @Where(clause = "isDeleted = 0")
32. public class Namespace extends BaseEntity {
33. 
34.   @Column(name = "appId", nullable = false)
35.   private String appId;
36. 
37.   @Column(name = "ClusterName", nullable = false)
38.   private String clusterName;
39. 
40.   @Column(name = "NamespaceName", nullable = false)
41.   private String namespaceName;
42. 
43.   public Namespace(){
44. 
45.   }
46. 
47.   public Namespace(String appId, String clusterName, String namespaceName) {
48.     this.appId = appId;
49.     this.clusterName = clusterName;
50.     this.namespaceName = namespaceName;
51.   }
52. 
53.   public String getAppId() {
54.     return appId;
55.   }
56. 
57.   public String getClusterName() {
58.     return clusterName;
59.   }
60. 
61.   public String getNamespaceName() {
62.     return namespaceName;
63.   }
64. 
65.   public void setAppId(String appId) {
66.     this.appId = appId;
67.   }
68. 
69.   public void setClusterName(String clusterName) {
70.     this.clusterName = clusterName;
71.   }
72. 
73.   public void setNamespaceName(String namespaceName) {
74.     this.namespaceName = namespaceName;
75.   }
76. 
77.   public String toString() {
78.     return toStringHelper().add("appId", appId).add("clusterName", clusterName)
79.         .add("namespaceName", namespaceName).toString();
80.   }
81. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java
Line number range: 1 - 52
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.repository;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. 
21. import org.springframework.data.jpa.repository.Modifying;
22. import org.springframework.data.jpa.repository.Query;
23. import org.springframework.data.repository.PagingAndSortingRepository;
24. 
25. import java.util.List;
26. import java.util.Set;
27. 
28. 
29. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long>{
30. 
31.   AppNamespace findByAppIdAndName(String appId, String namespaceName);
32. 
33.   List<AppNamespace> findByAppIdAndNameIn(String appId, Set<String> namespaceNames);
34. 
35.   AppNamespace findByNameAndIsPublicTrue(String namespaceName);
36. 
37.   List<AppNamespace> findByNameInAndIsPublicTrue(Set<String> namespaceNames);
38. 
39.   List<AppNamespace> findByAppIdAndIsPublic(String appId, boolean isPublic);
40. 
41.   List<AppNamespace> findByAppIdOrderByIdAsc(String appId);
42. 
43.   List<AppNamespace> findFirst500ByIdGreaterThanOrderByIdAsc(long id);
44. 
45.   @Modifying
46.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?2 WHERE AppId=?1 and IsDeleted = 0")
47.   int batchDeleteByAppId(String appId, String operator);
48. 
49.   @Modifying
50.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")
51.   int delete(String appId, String namespaceName, String operator);
52. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java
Line number range: 1 - 47
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.repository;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Namespace;
20. 
21. import org.springframework.data.domain.Pageable;
22. import org.springframework.data.jpa.repository.Modifying;
23. import org.springframework.data.jpa.repository.Query;
24. import org.springframework.data.repository.PagingAndSortingRepository;
25. 
26. import java.util.List;
27. import java.util.Set;
28. 
29. public interface NamespaceRepository extends PagingAndSortingRepository<Namespace, Long> {
30. 
31.   List<Namespace> findByAppIdAndClusterNameOrderByIdAsc(String appId, String clusterName);
32. 
33.   Namespace findByAppIdAndClusterNameAndNamespaceName(String appId, String clusterName, String namespaceName);
34. 
35.   @Modifying
36.   @Query("update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 where appId=?1 and clusterName=?2 and IsDeleted = 0")
37.   int batchDelete(String appId, String clusterName, String operator);
38. 
39.   List<Namespace> findByAppIdAndNamespaceNameOrderByIdAsc(String appId, String namespaceName);
40. 
41.   List<Namespace> findByNamespaceName(String namespaceName, Pageable page);
42. 
43.   List<Namespace> findByIdIn(Set<Long> namespaceIds);
44. 
45.   int countByNamespaceNameAndAppIdNot(String namespaceName, String appId);
46. 
47. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 1 - 196
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Audit;
20. import com.ctrip.framework.apollo.biz.entity.Cluster;
21. import com.ctrip.framework.apollo.biz.entity.Namespace;
22. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.common.exception.ServiceException;
25. import com.ctrip.framework.apollo.common.utils.BeanUtils;
26. import com.ctrip.framework.apollo.core.ConfigConsts;
27. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
28. import com.ctrip.framework.apollo.core.utils.StringUtils;
29. import com.google.common.base.Preconditions;
30. import com.google.common.base.Strings;
31. import org.slf4j.Logger;
32. import org.slf4j.LoggerFactory;
33. import org.springframework.context.annotation.Lazy;
34. import org.springframework.stereotype.Service;
35. import org.springframework.transaction.annotation.Transactional;
36. 
37. import java.util.Collections;
38. import java.util.List;
39. import java.util.Objects;
40. import java.util.Set;
41. 
42. @Service
43. public class AppNamespaceService {
44. 
45.   private static final Logger logger = LoggerFactory.getLogger(AppNamespaceService.class);
46. 
47.   private final AppNamespaceRepository appNamespaceRepository;
48.   private final NamespaceService namespaceService;
49.   private final ClusterService clusterService;
50.   private final AuditService auditService;
51. 
52.   public AppNamespaceService(
53.       final AppNamespaceRepository appNamespaceRepository,
54.       final @Lazy NamespaceService namespaceService,
55.       final @Lazy ClusterService clusterService,
56.       final AuditService auditService) {
57.     this.appNamespaceRepository = appNamespaceRepository;
58.     this.namespaceService = namespaceService;
59.     this.clusterService = clusterService;
60.     this.auditService = auditService;
61.   }
62. 
63.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {
64.     Objects.requireNonNull(appId, "AppId must not be null");
65.     Objects.requireNonNull(namespaceName, "Namespace must not be null");
66.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));
67.   }
68. 
69.   public AppNamespace findPublicNamespaceByName(String namespaceName) {
70.     Preconditions.checkArgument(namespaceName != null, "Namespace must not be null");
71.     return appNamespaceRepository.findByNameAndIsPublicTrue(namespaceName);
72.   }
73. 
74.   public List<AppNamespace> findByAppId(String appId) {
75.     return appNamespaceRepository.findByAppIdOrderByIdAsc(appId);
76.   }
77. 
78.   public List<AppNamespace> findPublicNamespacesByNames(Set<String> namespaceNames) {
79.     if (namespaceNames == null || namespaceNames.isEmpty()) {
80.       return Collections.emptyList();
81.     }
82. 
83.     return appNamespaceRepository.findByNameInAndIsPublicTrue(namespaceNames);
84.   }
85. 
86.   public List<AppNamespace> findPrivateAppNamespace(String appId) {
87.     return appNamespaceRepository.findByAppIdAndIsPublic(appId, false);
88.   }
89. 
90.   public AppNamespace findOne(String appId, String namespaceName) {
91.     Preconditions
92.         .checkArgument(!StringUtils.isContainEmpty(appId, namespaceName), "appId or Namespace must not be null");
93.     return appNamespaceRepository.findByAppIdAndName(appId, namespaceName);
94.   }
95. 
96.   public List<AppNamespace> findByAppIdAndNamespaces(String appId, Set<String> namespaceNames) {
97.     Preconditions.checkArgument(!Strings.isNullOrEmpty(appId), "appId must not be null");
98.     if (namespaceNames == null || namespaceNames.isEmpty()) {
99.       return Collections.emptyList();
100.     }
101.     return appNamespaceRepository.findByAppIdAndNameIn(appId, namespaceNames);
102.   }
103. 
104.   @Transactional
105.   public void createDefaultAppNamespace(String appId, String createBy) {
106.     if (!isAppNamespaceNameUnique(appId, ConfigConsts.NAMESPACE_APPLICATION)) {
107.       throw new ServiceException("appnamespace not unique");
108.     }
109.     AppNamespace appNs = new AppNamespace();
110.     appNs.setAppId(appId);
111.     appNs.setName(ConfigConsts.NAMESPACE_APPLICATION);
112.     appNs.setComment("default app namespace");
113.     appNs.setFormat(ConfigFileFormat.Properties.getValue());
114.     appNs.setDataChangeCreatedBy(createBy);
115.     appNs.setDataChangeLastModifiedBy(createBy);
116.     appNamespaceRepository.save(appNs);
117. 
118.     auditService.audit(AppNamespace.class.getSimpleName(), appNs.getId(), Audit.OP.INSERT,
119.                        createBy);
120.   }
121. 
122.   @Transactional
123.   public AppNamespace createAppNamespace(AppNamespace appNamespace) {
124.     String createBy = appNamespace.getDataChangeCreatedBy();
125.     if (!isAppNamespaceNameUnique(appNamespace.getAppId(), appNamespace.getName())) {
126.       throw new ServiceException("appnamespace not unique");
127.     }
128.     appNamespace.setId(0);//protection
129.     appNamespace.setDataChangeCreatedBy(createBy);
130.     appNamespace.setDataChangeLastModifiedBy(createBy);
131. 
132.     appNamespace = appNamespaceRepository.save(appNamespace);
133. 
134.     createNamespaceForAppNamespaceInAllCluster(appNamespace.getAppId(), appNamespace.getName(), createBy);
135. 
136.     auditService.audit(AppNamespace.class.getSimpleName(), appNamespace.getId(), Audit.OP.INSERT, createBy);
137.     return appNamespace;
138.   }
139. 
140.   public AppNamespace update(AppNamespace appNamespace) {
141.     AppNamespace managedNs = appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName());
142.     BeanUtils.copyEntityProperties(appNamespace, managedNs);
143.     managedNs = appNamespaceRepository.save(managedNs);
144. 
145.     auditService.audit(AppNamespace.class.getSimpleName(), managedNs.getId(), Audit.OP.UPDATE,
146.                        managedNs.getDataChangeLastModifiedBy());
147. 
148.     return managedNs;
149.   }
150. 
151.   public void createNamespaceForAppNamespaceInAllCluster(String appId, String namespaceName, String createBy) {
152.     List<Cluster> clusters = clusterService.findParentClusters(appId);
153. 
154.     for (Cluster cluster : clusters) {
155. 
156.       // in case there is some dirty data, e.g. public namespace deleted in other app and now created in this app
157.       if (!namespaceService.isNamespaceUnique(appId, cluster.getName(), namespaceName)) {
158.         continue;
159.       }
160. 
161.       Namespace namespace = new Namespace();
162.       namespace.setClusterName(cluster.getName());
163.       namespace.setAppId(appId);
164.       namespace.setNamespaceName(namespaceName);
165.       namespace.setDataChangeCreatedBy(createBy);
166.       namespace.setDataChangeLastModifiedBy(createBy);
167. 
168.       namespaceService.save(namespace);
169.     }
170.   }
171. 
172.   @Transactional
173.   public void batchDelete(String appId, String operator) {
174.     appNamespaceRepository.batchDeleteByAppId(appId, operator);
175.   }
176. 
177.   @Transactional
178.   public void deleteAppNamespace(AppNamespace appNamespace, String operator) {
179.     String appId = appNamespace.getAppId();
180.     String namespaceName = appNamespace.getName();
181. 
182.     logger.info("{} is deleting AppNamespace, appId: {}, namespace: {}", operator, appId, namespaceName);
183. 
184.     // 1. delete namespaces
185.     List<Namespace> namespaces = namespaceService.findByAppIdAndNamespaceName(appId, namespaceName);
186. 
187.     if (namespaces != null) {
188.       for (Namespace namespace : namespaces) {
189.         namespaceService.deleteNamespace(namespace, operator);
190.       }
191.     }
192. 
193.     // 2. delete app namespace
194.     appNamespaceRepository.delete(appId, namespaceName, operator);
195.   }
196. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 1 - 447
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Audit;
20. import com.ctrip.framework.apollo.biz.entity.Cluster;
21. import com.ctrip.framework.apollo.biz.entity.Item;
22. import com.ctrip.framework.apollo.biz.entity.Namespace;
23. import com.ctrip.framework.apollo.biz.entity.Release;
24. import com.ctrip.framework.apollo.biz.message.MessageSender;
25. import com.ctrip.framework.apollo.biz.message.Topics;
26. import com.ctrip.framework.apollo.biz.repository.NamespaceRepository;
27. import com.ctrip.framework.apollo.biz.utils.ReleaseMessageKeyGenerator;
28. import com.ctrip.framework.apollo.common.constants.GsonType;
29. import com.ctrip.framework.apollo.common.constants.NamespaceBranchStatus;
30. import com.ctrip.framework.apollo.common.entity.AppNamespace;
31. import com.ctrip.framework.apollo.common.exception.BadRequestException;
32. import com.ctrip.framework.apollo.common.exception.ServiceException;
33. import com.ctrip.framework.apollo.common.utils.BeanUtils;
34. import com.ctrip.framework.apollo.core.ConfigConsts;
35. import com.google.common.collect.Maps;
36. import com.google.gson.Gson;
37. import org.springframework.context.annotation.Lazy;
38. import org.springframework.data.domain.Page;
39. import org.springframework.data.domain.PageImpl;
40. import org.springframework.data.domain.Pageable;
41. import org.springframework.stereotype.Service;
42. import org.springframework.transaction.annotation.Transactional;
43. import org.springframework.util.CollectionUtils;
44. 
45. import java.util.Collections;
46. import java.util.Date;
47. import java.util.LinkedList;
48. import java.util.List;
49. import java.util.Map;
50. import java.util.Objects;
51. import java.util.Set;
52. import java.util.stream.Collectors;
53. 
54. @Service
55. public class NamespaceService {
56. 
57.   private static final Gson GSON = new Gson();
58. 
59.   private final NamespaceRepository namespaceRepository;
60.   private final AuditService auditService;
61.   private final AppNamespaceService appNamespaceService;
62.   private final ItemService itemService;
63.   private final CommitService commitService;
64.   private final ReleaseService releaseService;
65.   private final ClusterService clusterService;
66.   private final NamespaceBranchService namespaceBranchService;
67.   private final ReleaseHistoryService releaseHistoryService;
68.   private final NamespaceLockService namespaceLockService;
69.   private final InstanceService instanceService;
70.   private final MessageSender messageSender;
71. 
72.   public NamespaceService(
73.       final ReleaseHistoryService releaseHistoryService,
74.       final NamespaceRepository namespaceRepository,
75.       final AuditService auditService,
76.       final @Lazy AppNamespaceService appNamespaceService,
77.       final MessageSender messageSender,
78.       final @Lazy ItemService itemService,
79.       final CommitService commitService,
80.       final @Lazy ReleaseService releaseService,
81.       final @Lazy ClusterService clusterService,
82.       final @Lazy NamespaceBranchService namespaceBranchService,
83.       final NamespaceLockService namespaceLockService,
84.       final InstanceService instanceService) {
85.     this.releaseHistoryService = releaseHistoryService;
86.     this.namespaceRepository = namespaceRepository;
87.     this.auditService = auditService;
88.     this.appNamespaceService = appNamespaceService;
89.     this.messageSender = messageSender;
90.     this.itemService = itemService;
91.     this.commitService = commitService;
92.     this.releaseService = releaseService;
93.     this.clusterService = clusterService;
94.     this.namespaceBranchService = namespaceBranchService;
95.     this.namespaceLockService = namespaceLockService;
96.     this.instanceService = instanceService;
97.   }
98. 
99. 
100.   public Namespace findOne(Long namespaceId) {
101.     return namespaceRepository.findById(namespaceId).orElse(null);
102.   }
103. 
104.   public Namespace findOne(String appId, String clusterName, String namespaceName) {
105.     return namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, clusterName,
106.                                                                          namespaceName);
107.   }
108. 
109.   /**
110.    * the returned content's size is not fixed. so please carefully used.
111.    */
112.   public Page<Namespace> findByItem(String itemKey, Pageable pageable) {
113.     Page<Item> items = itemService.findItemsByKey(itemKey, pageable);
114. 
115.     if (!items.hasContent()) {
116.       return Page.empty();
117.     }
118. 
119.     Set<Long> namespaceIds = BeanUtils.toPropertySet("namespaceId", items.getContent());
120. 
121.     return new PageImpl<>(namespaceRepository.findByIdIn(namespaceIds));
122.   }
123. 
124.   public Namespace findPublicNamespaceForAssociatedNamespace(String clusterName, String namespaceName) {
125.     AppNamespace appNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);
126.     if (appNamespace == null) {
127.       throw new BadRequestException("namespace not exist");
128.     }
129. 
130.     String appId = appNamespace.getAppId();
131. 
132.     Namespace namespace = findOne(appId, clusterName, namespaceName);
133. 
134.     //default cluster's namespace
135.     if (Objects.equals(clusterName, ConfigConsts.CLUSTER_NAME_DEFAULT)) {
136.       return namespace;
137.     }
138. 
139.     //custom cluster's namespace not exist.
140.     //return default cluster's namespace
141.     if (namespace == null) {
142.       return findOne(appId, ConfigConsts.CLUSTER_NAME_DEFAULT, namespaceName);
143.     }
144. 
145.     //custom cluster's namespace exist and has published.
146.     //return custom cluster's namespace
147.     Release latestActiveRelease = releaseService.findLatestActiveRelease(namespace);
148.     if (latestActiveRelease != null) {
149.       return namespace;
150.     }
151. 
152.     Namespace defaultNamespace = findOne(appId, ConfigConsts.CLUSTER_NAME_DEFAULT, namespaceName);
153. 
154.     //custom cluster's namespace exist but never published.
155.     //and default cluster's namespace not exist.
156.     //return custom cluster's namespace
157.     if (defaultNamespace == null) {
158.       return namespace;
159.     }
160. 
161.     //custom cluster's namespace exist but never published.
162.     //and default cluster's namespace exist and has published.
163.     //return default cluster's namespace
164.     Release defaultNamespaceLatestActiveRelease = releaseService.findLatestActiveRelease(defaultNamespace);
165.     if (defaultNamespaceLatestActiveRelease != null) {
166.       return defaultNamespace;
167.     }
168. 
169.     //custom cluster's namespace exist but never published.
170.     //and default cluster's namespace exist but never published.
171.     //return custom cluster's namespace
172.     return namespace;
173.   }
174. 
175.   public List<Namespace> findPublicAppNamespaceAllNamespaces(String namespaceName, Pageable page) {
176.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);
177. 
178.     if (publicAppNamespace == null) {
179.       throw new BadRequestException(
180.           String.format("Public appNamespace not exists. NamespaceName = %s", namespaceName));
181.     }
182. 
183.     List<Namespace> namespaces = namespaceRepository.findByNamespaceName(namespaceName, page);
184. 
185.     return filterChildNamespace(namespaces);
186.   }
187. 
188.   private List<Namespace> filterChildNamespace(List<Namespace> namespaces) {
189.     List<Namespace> result = new LinkedList<>();
190. 
191.     if (CollectionUtils.isEmpty(namespaces)) {
192.       return result;
193.     }
194. 
195.     for (Namespace namespace : namespaces) {
196.       if (!isChildNamespace(namespace)) {
197.         result.add(namespace);
198.       }
199.     }
200. 
201.     return result;
202.   }
203. 
204.   public int countPublicAppNamespaceAssociatedNamespaces(String publicNamespaceName) {
205.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(publicNamespaceName);
206. 
207.     if (publicAppNamespace == null) {
208.       throw new BadRequestException(
209.           String.format("Public appNamespace not exists. NamespaceName = %s", publicNamespaceName));
210.     }
211. 
212.     return namespaceRepository.countByNamespaceNameAndAppIdNot(publicNamespaceName, publicAppNamespace.getAppId());
213.   }
214. 
215.   public List<Namespace> findNamespaces(String appId, String clusterName) {
216.     List<Namespace> namespaces = namespaceRepository.findByAppIdAndClusterNameOrderByIdAsc(appId, clusterName);
217.     if (namespaces == null) {
218.       return Collections.emptyList();
219.     }
220.     return namespaces;
221.   }
222. 
223.   public List<Namespace> findByAppIdAndNamespaceName(String appId, String namespaceName) {
224.     return namespaceRepository.findByAppIdAndNamespaceNameOrderByIdAsc(appId, namespaceName);
225.   }
226. 
227.   public Namespace findChildNamespace(String appId, String parentClusterName, String namespaceName) {
228.     List<Namespace> namespaces = findByAppIdAndNamespaceName(appId, namespaceName);
229.     if (CollectionUtils.isEmpty(namespaces) || namespaces.size() == 1) {
230.       return null;
231.     }
232. 
233.     List<Cluster> childClusters = clusterService.findChildClusters(appId, parentClusterName);
234.     if (CollectionUtils.isEmpty(childClusters)) {
235.       return null;
236.     }
237. 
238.     Set<String> childClusterNames = childClusters.stream().map(Cluster::getName).collect(Collectors.toSet());
239.     //the child namespace is the intersection of the child clusters and child namespaces
240.     for (Namespace namespace : namespaces) {
241.       if (childClusterNames.contains(namespace.getClusterName())) {
242.         return namespace;
243.       }
244.     }
245. 
246.     return null;
247.   }
248. 
249.   public Namespace findChildNamespace(Namespace parentNamespace) {
250.     String appId = parentNamespace.getAppId();
251.     String parentClusterName = parentNamespace.getClusterName();
252.     String namespaceName = parentNamespace.getNamespaceName();
253. 
254.     return findChildNamespace(appId, parentClusterName, namespaceName);
255. 
256.   }
257. 
258.   public Namespace findParentNamespace(String appId, String clusterName, String namespaceName) {
259.     return findParentNamespace(new Namespace(appId, clusterName, namespaceName));
260.   }
261. 
262.   public Namespace findParentNamespace(Namespace namespace) {
263.     String appId = namespace.getAppId();
264.     String namespaceName = namespace.getNamespaceName();
265. 
266.     Cluster cluster = clusterService.findOne(appId, namespace.getClusterName());
267.     if (cluster != null && cluster.getParentClusterId() > 0) {
268.       Cluster parentCluster = clusterService.findOne(cluster.getParentClusterId());
269.       return findOne(appId, parentCluster.getName(), namespaceName);
270.     }
271. 
272.     return null;
273.   }
274. 
275.   public boolean isChildNamespace(String appId, String clusterName, String namespaceName) {
276.     return isChildNamespace(new Namespace(appId, clusterName, namespaceName));
277.   }
278. 
279.   public boolean isChildNamespace(Namespace namespace) {
280.     return findParentNamespace(namespace) != null;
281.   }
282. 
283.   public boolean isNamespaceUnique(String appId, String cluster, String namespace) {
284.     Objects.requireNonNull(appId, "AppId must not be null");
285.     Objects.requireNonNull(cluster, "Cluster must not be null");
286.     Objects.requireNonNull(namespace, "Namespace must not be null");
287.     return Objects.isNull(
288.         namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, cluster, namespace));
289.   }
290. 
291.   @Transactional
292.   public void deleteByAppIdAndClusterName(String appId, String clusterName, String operator) {
293. 
294.     List<Namespace> toDeleteNamespaces = findNamespaces(appId, clusterName);
295. 
296.     for (Namespace namespace : toDeleteNamespaces) {
297. 
298.       deleteNamespace(namespace, operator);
299. 
300.     }
301.   }
302. 
303.   @Transactional
304.   public Namespace deleteNamespace(Namespace namespace, String operator) {
305.     String appId = namespace.getAppId();
306.     String clusterName = namespace.getClusterName();
307.     String namespaceName = namespace.getNamespaceName();
308. 
309.     itemService.batchDelete(namespace.getId(), operator);
310.     commitService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);
311. 
312.     // Child namespace releases should retain as long as the parent namespace exists, because parent namespaces' release
313.     // histories need them
314.     if (!isChildNamespace(namespace)) {
315.       releaseService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);
316.     }
317. 
318.     //delete child namespace
319.     Namespace childNamespace = findChildNamespace(namespace);
320.     if (childNamespace != null) {
321.       namespaceBranchService.deleteBranch(appId, clusterName, namespaceName,
322.                                           childNamespace.getClusterName(), NamespaceBranchStatus.DELETED, operator);
323.       //delete child namespace's releases. Notice: delete child namespace will not delete child namespace's releases
324.       releaseService.batchDelete(appId, childNamespace.getClusterName(), namespaceName, operator);
325.     }
326. 
327.     releaseHistoryService.batchDelete(appId, clusterName, namespaceName, operator);
328. 
329.     instanceService.batchDeleteInstanceConfig(appId, clusterName, namespaceName);
330. 
331.     namespaceLockService.unlock(namespace.getId());
332. 
333.     namespace.setDeleted(true);
334.     namespace.setDataChangeLastModifiedBy(operator);
335. 
336.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.DELETE, operator);
337. 
338.     Namespace deleted = namespaceRepository.save(namespace);
339. 
340.     //Publish release message to do some clean up in config service, such as updating the cache
341.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),
342.         Topics.APOLLO_RELEASE_TOPIC);
343. 
344.     return deleted;
345.   }
346. 
347.   @Transactional
348.   public Namespace save(Namespace entity) {
349.     if (!isNamespaceUnique(entity.getAppId(), entity.getClusterName(), entity.getNamespaceName())) {
350.       throw new ServiceException("namespace not unique");
351.     }
352.     entity.setId(0);//protection
353.     Namespace namespace = namespaceRepository.save(entity);
354. 
355.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.INSERT,
356.                        namespace.getDataChangeCreatedBy());
357. 
358.     return namespace;
359.   }
360. 
361.   @Transactional
362.   public Namespace update(Namespace namespace) {
363.     Namespace managedNamespace = namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(
364.         namespace.getAppId(), namespace.getClusterName(), namespace.getNamespaceName());
365.     BeanUtils.copyEntityProperties(namespace, managedNamespace);
366.     managedNamespace = namespaceRepository.save(managedNamespace);
367. 
368.     auditService.audit(Namespace.class.getSimpleName(), managedNamespace.getId(), Audit.OP.UPDATE,
369.                        managedNamespace.getDataChangeLastModifiedBy());
370. 
371.     return managedNamespace;
372.   }
373. 
374.   @Transactional
375.   public void instanceOfAppNamespaces(String appId, String clusterName, String createBy) {
376. 
377.     List<AppNamespace> appNamespaces = appNamespaceService.findByAppId(appId);
378. 
379.     for (AppNamespace appNamespace : appNamespaces) {
380.       Namespace ns = new Namespace();
381.       ns.setAppId(appId);
382.       ns.setClusterName(clusterName);
383.       ns.setNamespaceName(appNamespace.getName());
384.       ns.setDataChangeCreatedBy(createBy);
385.       ns.setDataChangeLastModifiedBy(createBy);
386.       namespaceRepository.save(ns);
387.       auditService.audit(Namespace.class.getSimpleName(), ns.getId(), Audit.OP.INSERT, createBy);
388.     }
389. 
390.   }
391. 
392.   public Map<String, Boolean> namespacePublishInfo(String appId) {
393.     List<Cluster> clusters = clusterService.findParentClusters(appId);
394.     if (CollectionUtils.isEmpty(clusters)) {
395.       throw new BadRequestException("app not exist");
396.     }
397. 
398.     Map<String, Boolean> clusterHasNotPublishedItems = Maps.newHashMap();
399. 
400.     for (Cluster cluster : clusters) {
401.       String clusterName = cluster.getName();
402.       List<Namespace> namespaces = findNamespaces(appId, clusterName);
403. 
404.       for (Namespace namespace : namespaces) {
405.         boolean isNamespaceNotPublished = isNamespaceNotPublished(namespace);
406. 
407.         if (isNamespaceNotPublished) {
408.           clusterHasNotPublishedItems.put(clusterName, true);
409.           break;
410.         }
411.       }
412. 
413.       clusterHasNotPublishedItems.putIfAbsent(clusterName, false);
414.     }
415. 
416.     return clusterHasNotPublishedItems;
417.   }
418. 
419.   private boolean isNamespaceNotPublished(Namespace namespace) {
420. 
421.     Release latestRelease = releaseService.findLatestActiveRelease(namespace);
422.     long namespaceId = namespace.getId();
423. 
424.     if (latestRelease == null) {
425.       Item lastItem = itemService.findLastOne(namespaceId);
426.       return lastItem != null;
427.     }
428. 
429.     Date lastPublishTime = latestRelease.getDataChangeLastModifiedTime();
430.     List<Item> itemsModifiedAfterLastPublish = itemService.findItemsModifiedAfterDate(namespaceId, lastPublishTime);
431. 
432.     if (CollectionUtils.isEmpty(itemsModifiedAfterLastPublish)) {
433.       return false;
434.     }
435. 
436.     Map<String, String> publishedConfiguration = GSON.fromJson(latestRelease.getConfigurations(), GsonType.CONFIG);
437.     for (Item item : itemsModifiedAfterLastPublish) {
438.       if (!Objects.equals(item.getValue(), publishedConfiguration.get(item.getKey()))) {
439.         return true;
440.       }
441.     }
442. 
443.     return false;
444.   }
445. 
446. 
447. }


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java
Line number range: 1 - 107
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.common.entity;
18. 
19. 
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
22. 
23. import javax.validation.constraints.NotBlank;
24. import javax.validation.constraints.Pattern;
25. import org.hibernate.annotations.SQLDelete;
26. import org.hibernate.annotations.Where;
27. 
28. import javax.persistence.Column;
29. import javax.persistence.Entity;
30. import javax.persistence.Table;
31. 
32. @Entity
33. @Table(name = "AppNamespace")
34. @SQLDelete(sql = "Update AppNamespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")
35. @Where(clause = "isDeleted = 0")
36. public class AppNamespace extends BaseEntity {
37. 
38.   @NotBlank(message = "AppNamespace Name cannot be blank")
39.   @Pattern(
40.       regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR,
41.       message = "Invalid Namespace format: " + InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE
42.   )
43.   @Column(name = "Name", nullable = false)
44.   private String name;
45. 
46.   @NotBlank(message = "AppId cannot be blank")
47.   @Column(name = "AppId", nullable = false)
48.   private String appId;
49. 
50.   @Column(name = "Format", nullable = false)
51.   private String format;
52. 
53.   @Column(name = "IsPublic", columnDefinition = "Bit default '0'")
54.   private boolean isPublic = false;
55. 
56.   @Column(name = "Comment")
57.   private String comment;
58. 
59.   public String getAppId() {
60.     return appId;
61.   }
62. 
63.   public String getComment() {
64.     return comment;
65.   }
66. 
67.   public String getName() {
68.     return name;
69.   }
70. 
71.   public void setAppId(String appId) {
72.     this.appId = appId;
73.   }
74. 
75.   public void setComment(String comment) {
76.     this.comment = comment;
77.   }
78. 
79.   public void setName(String name) {
80.     this.name = name;
81.   }
82. 
83.   public boolean isPublic() {
84.     return isPublic;
85.   }
86. 
87.   public void setPublic(boolean aPublic) {
88.     isPublic = aPublic;
89.   }
90. 
91.   public ConfigFileFormat formatAsEnum() {
92.     return ConfigFileFormat.fromString(this.format);
93.   }
94. 
95.   public String getFormat() {
96.     return format;
97.   }
98. 
99.   public void setFormat(String format) {
100.     this.format = format;
101.   }
102. 
103.   public String toString() {
104.     return toStringHelper().add("name", name).add("appId", appId).add("comment", comment)
105.         .add("format", format).add("isPublic", isPublic).toString();
106.   }
107. }


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
Line number range: 1 - 47
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.common.utils;
18. 
19. import com.ctrip.framework.apollo.core.utils.StringUtils;
20. 
21. import java.util.regex.Pattern;
22. 
23. /**
24.  * @author Jason Song(song_s@ctrip.com)
25.  */
26. public class InputValidator {
27.   public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbol - _ . are allowed";
28.   public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE = "not allowed to end with .json, .yml, .yaml, .xml, .properties";
29.   public static final String CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+";
30.   private static final String APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$";
31.   private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);
32.   private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);
33. 
34.   public static boolean isValidClusterNamespace(String name) {
35.     if (StringUtils.isEmpty(name)){
36.       return false;
37.     }
38.     return CLUSTER_NAMESPACE_PATTERN.matcher(name).matches();
39.   }
40. 
41.   public static boolean isValidAppNamespace(String name){
42.     if (StringUtils.isEmpty(name)){
43.       return false;
44.     }
45.     return APP_NAMESPACE_PATTERN.matcher(name).matches();
46.   }
47. }


File: apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java
Line number range: 1 - 54
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.common.utils;
18. 
19. import static org.junit.Assert.*;
20. 
21. import org.junit.Test;
22. 
23. public class InputValidatorTest {
24. 
25.   @Test
26.   public void testValidClusterName() throws Exception {
27.     checkClusterName("some.cluster-_name.123", true);
28.     checkClusterName("some.cluster-_name.123.yml", true);
29.     checkClusterName("some.&.name", false);
30.     checkClusterName("", false);
31.     checkClusterName(null, false);
32.   }
33. 
34.   @Test
35.   public void testValidAppNamespaceName() throws Exception {
36.     checkAppNamespaceName("some.cluster-_name.123", true);
37.     checkAppNamespaceName("some.&.name", false);
38.     checkAppNamespaceName("", false);
39.     checkAppNamespaceName(null, false);
40.     checkAppNamespaceName("some.name.json", false);
41.     checkAppNamespaceName("some.name.yml", false);
42.     checkAppNamespaceName("some.name.yaml", false);
43.     checkAppNamespaceName("some.name.xml", false);
44.     checkAppNamespaceName("some.name.properties", false);
45.   }
46. 
47.   private void checkClusterName(String name, boolean valid) {
48.     assertEquals(valid, InputValidator.isValidClusterNamespace(name));
49.   }
50. 
51.   private void checkAppNamespaceName(String name, boolean valid) {
52.     assertEquals(valid, InputValidator.isValidAppNamespace(name));
53.   }
54. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java
Line number range: 1 - 103
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.openapi.v1.controller;
18. 
19. import com.ctrip.framework.apollo.common.exception.BadRequestException;
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import com.ctrip.framework.apollo.common.utils.RequestPrecondition;
22. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
23. import com.ctrip.framework.apollo.openapi.api.NamespaceOpenApiService;
24. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;
25. import com.ctrip.framework.apollo.openapi.dto.OpenNamespaceDTO;
26. import com.ctrip.framework.apollo.openapi.dto.OpenNamespaceLockDTO;
27. import com.ctrip.framework.apollo.portal.spi.UserService;
28. import org.springframework.security.access.prepost.PreAuthorize;
29. import org.springframework.web.bind.annotation.GetMapping;
30. import org.springframework.web.bind.annotation.PathVariable;
31. import org.springframework.web.bind.annotation.PostMapping;
32. import org.springframework.web.bind.annotation.RequestBody;
33. import org.springframework.web.bind.annotation.RestController;
34. 
35. import javax.servlet.http.HttpServletRequest;
36. import java.util.List;
37. import java.util.Objects;
38. 
39. @RestController("openapiNamespaceController")
40. public class NamespaceController {
41. 
42.   private final UserService userService;
43.   private final NamespaceOpenApiService namespaceOpenApiService;
44. 
45.   public NamespaceController(
46.       final UserService userService,
47.       NamespaceOpenApiService namespaceOpenApiService) {
48.     this.userService = userService;
49.     this.namespaceOpenApiService = namespaceOpenApiService;
50.   }
51. 
52.   @PreAuthorize(value = "@consumerPermissionValidator.hasCreateNamespacePermission(#request, #appId)")
53.   @PostMapping(value = "/openapi/v1/apps/{appId}/appnamespaces")
54.   public OpenAppNamespaceDTO createNamespace(@PathVariable String appId,
55.                                              @RequestBody OpenAppNamespaceDTO appNamespaceDTO,
56.                                              HttpServletRequest request) {
57. 
58.     if (!Objects.equals(appId, appNamespaceDTO.getAppId())) {
59.       throw new BadRequestException(String.format("AppId not equal. AppId in path = %s, AppId in payload = %s", appId,
60.                                                   appNamespaceDTO.getAppId()));
61.     }
62.     RequestPrecondition.checkArgumentsNotEmpty(appNamespaceDTO.getAppId(), appNamespaceDTO.getName(),
63.                                                appNamespaceDTO.getFormat(), appNamespaceDTO.getDataChangeCreatedBy());
64. 
65.     if (!InputValidator.isValidAppNamespace(appNamespaceDTO.getName())) {
66.       throw new BadRequestException(String.format("Invalid Namespace format: %s",
67.                                                   InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & "
68.                                                   + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
69.     }
70. 
71.     if (!ConfigFileFormat.isValidFormat(appNamespaceDTO.getFormat())) {
72.       throw new BadRequestException(String.format("Invalid namespace format. format = %s", appNamespaceDTO.getFormat()));
73.     }
74. 
75.     String operator = appNamespaceDTO.getDataChangeCreatedBy();
76.     if (userService.findByUserId(operator) == null) {
77.       throw new BadRequestException(String.format("Illegal user. user = %s", operator));
78.     }
79. 
80.     return this.namespaceOpenApiService.createAppNamespace(appNamespaceDTO);
81.   }
82. 
83.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces")
84.   public List<OpenNamespaceDTO> findNamespaces(@PathVariable String appId, @PathVariable String env,
85.                                                @PathVariable String clusterName) {
86.     return this.namespaceOpenApiService.getNamespaces(appId, env, clusterName);
87.   }
88. 
89.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
90.   public OpenNamespaceDTO loadNamespace(@PathVariable String appId, @PathVariable String env,
91.                                         @PathVariable String clusterName, @PathVariable String
92.                                             namespaceName) {
93.     return this.namespaceOpenApiService.getNamespace(appId, env, clusterName, namespaceName);
94.   }
95. 
96.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/lock")
97.   public OpenNamespaceLockDTO getNamespaceLock(@PathVariable String appId, @PathVariable String env,
98.                                                @PathVariable String clusterName, @PathVariable
99.                                                    String namespaceName) {
100.     return this.namespaceOpenApiService.getNamespaceLock(appId, env, clusterName, namespaceName);
101.   }
102. 
103. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 1 - 314
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.controller;
18. 
19. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
20. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
21. import com.ctrip.framework.apollo.common.entity.AppNamespace;
22. import com.ctrip.framework.apollo.common.exception.BadRequestException;
23. import com.ctrip.framework.apollo.common.http.MultiResponseEntity;
24. import com.ctrip.framework.apollo.common.http.RichResponseEntity;
25. import com.ctrip.framework.apollo.common.utils.BeanUtils;
26. import com.ctrip.framework.apollo.common.utils.InputValidator;
27. import com.ctrip.framework.apollo.common.utils.RequestPrecondition;
28. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
29. import com.ctrip.framework.apollo.portal.environment.Env;
30. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
31. import com.ctrip.framework.apollo.portal.component.PermissionValidator;
32. import com.ctrip.framework.apollo.portal.component.config.PortalConfig;
33. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
34. import com.ctrip.framework.apollo.portal.entity.model.NamespaceCreationModel;
35. import com.ctrip.framework.apollo.portal.listener.AppNamespaceCreationEvent;
36. import com.ctrip.framework.apollo.portal.listener.AppNamespaceDeletionEvent;
37. import com.ctrip.framework.apollo.portal.service.AppNamespaceService;
38. import com.ctrip.framework.apollo.portal.service.NamespaceService;
39. import com.ctrip.framework.apollo.portal.service.RoleInitializationService;
40. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
41. import com.ctrip.framework.apollo.tracer.Tracer;
42. import com.google.common.collect.Lists;
43. import com.google.common.collect.Sets;
44. import org.slf4j.Logger;
45. import org.slf4j.LoggerFactory;
46. import org.springframework.context.ApplicationEventPublisher;
47. import org.springframework.http.ResponseEntity;
48. import org.springframework.security.access.prepost.PreAuthorize;
49. import org.springframework.util.CollectionUtils;
50. import org.springframework.web.bind.annotation.DeleteMapping;
51. import org.springframework.web.bind.annotation.GetMapping;
52. import org.springframework.web.bind.annotation.PathVariable;
53. import org.springframework.web.bind.annotation.PostMapping;
54. import org.springframework.web.bind.annotation.RequestBody;
55. import org.springframework.web.bind.annotation.RequestParam;
56. import org.springframework.web.bind.annotation.RestController;
57. 
58. import javax.validation.Valid;
59. import java.util.List;
60. import java.util.Map;
61. import java.util.Set;
62. import java.util.stream.Collectors;
63. 
64. import static com.ctrip.framework.apollo.common.utils.RequestPrecondition.checkModel;
65. 
66. @RestController
67. public class NamespaceController {
68. 
69.   private static final Logger logger = LoggerFactory.getLogger(NamespaceController.class);
70. 
71.   private final ApplicationEventPublisher publisher;
72.   private final UserInfoHolder userInfoHolder;
73.   private final NamespaceService namespaceService;
74.   private final AppNamespaceService appNamespaceService;
75.   private final RoleInitializationService roleInitializationService;
76.   private final PortalConfig portalConfig;
77.   private final PermissionValidator permissionValidator;
78.   private final AdminServiceAPI.NamespaceAPI namespaceAPI;
79. 
80.   public NamespaceController(
81.       final ApplicationEventPublisher publisher,
82.       final UserInfoHolder userInfoHolder,
83.       final NamespaceService namespaceService,
84.       final AppNamespaceService appNamespaceService,
85.       final RoleInitializationService roleInitializationService,
86.       final PortalConfig portalConfig,
87.       final PermissionValidator permissionValidator,
88.       final AdminServiceAPI.NamespaceAPI namespaceAPI) {
89.     this.publisher = publisher;
90.     this.userInfoHolder = userInfoHolder;
91.     this.namespaceService = namespaceService;
92.     this.appNamespaceService = appNamespaceService;
93.     this.roleInitializationService = roleInitializationService;
94.     this.portalConfig = portalConfig;
95.     this.permissionValidator = permissionValidator;
96.     this.namespaceAPI = namespaceAPI;
97.   }
98. 
99. 
100.   @GetMapping("/appnamespaces/public")
101.   public List<AppNamespace> findPublicAppNamespaces() {
102.     return appNamespaceService.findPublicAppNamespaces();
103.   }
104. 
105.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces")
106.   public List<NamespaceBO> findNamespaces(@PathVariable String appId, @PathVariable String env,
107.                                           @PathVariable String clusterName) {
108. 
109.     List<NamespaceBO> namespaceBOs = namespaceService.findNamespaceBOs(appId, Env.valueOf(env), clusterName);
110. 
111.     for (NamespaceBO namespaceBO : namespaceBOs) {
112.       if (permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceBO.getBaseInfo().getNamespaceName())) {
113.         namespaceBO.hideItems();
114.       }
115.     }
116. 
117.     return namespaceBOs;
118.   }
119. 
120.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
121.   public NamespaceBO findNamespace(@PathVariable String appId, @PathVariable String env,
122.                                    @PathVariable String clusterName, @PathVariable String namespaceName) {
123. 
124.     NamespaceBO namespaceBO = namespaceService.loadNamespaceBO(appId, Env.valueOf(env), clusterName, namespaceName);
125. 
126.     if (namespaceBO != null && permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceName)) {
127.       namespaceBO.hideItems();
128.     }
129. 
130.     return namespaceBO;
131.   }
132. 
133.   @GetMapping("/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/associated-public-namespace")
134.   public NamespaceBO findPublicNamespaceForAssociatedNamespace(@PathVariable String env,
135.                                                                @PathVariable String appId,
136.                                                                @PathVariable String namespaceName,
137.                                                                @PathVariable String clusterName) {
138. 
139.     return namespaceService.findPublicNamespaceForAssociatedNamespace(Env.valueOf(env), appId, clusterName, namespaceName);
140.   }
141. 
142.   @PreAuthorize(value = "@permissionValidator.hasCreateNamespacePermission(#appId)")
143.   @PostMapping("/apps/{appId}/namespaces")
144.   public ResponseEntity<Void> createNamespace(@PathVariable String appId,
145.                                               @RequestBody List<NamespaceCreationModel> models) {
146. 
147.     checkModel(!CollectionUtils.isEmpty(models));
148.     String operator = userInfoHolder.getUser().getUserId();
149. 
150.     for (NamespaceCreationModel model : models) {
151.       String namespaceName = model.getNamespace().getNamespaceName();
152.       roleInitializationService.initNamespaceRoles(appId, namespaceName, operator);
153.       roleInitializationService.initNamespaceEnvRoles(appId, namespaceName, operator);
154.       NamespaceDTO namespace = model.getNamespace();
155.       RequestPrecondition.checkArgumentsNotEmpty(model.getEnv(), namespace.getAppId(),
156.                                                  namespace.getClusterName(), namespace.getNamespaceName());
157. 
158.       try {
159.         namespaceService.createNamespace(Env.valueOf(model.getEnv()), namespace);
160.       } catch (Exception e) {
161.         logger.error("create namespace fail.", e);
162.         Tracer.logError(
163.                 String.format("create namespace fail. (env=%s namespace=%s)", model.getEnv(),
164.                         namespace.getNamespaceName()), e);
165.       }
166.       namespaceService.assignNamespaceRoleToOperator(appId, namespaceName,userInfoHolder.getUser().getUserId());
167.     }
168. 
169.     return ResponseEntity.ok().build();
170.   }
171. 
172.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
173.   @DeleteMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName:.+}")
174.   public ResponseEntity<Void> deleteLinkedNamespace(@PathVariable String appId, @PathVariable String env,
175.       @PathVariable String clusterName, @PathVariable String namespaceName) {
176. 
177.     namespaceService.deleteNamespace(appId, Env.valueOf(env), clusterName, namespaceName);
178. 
179.     return ResponseEntity.ok().build();
180.   }
181. 
182.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName}/usage")
183.   public List<NamespaceUsage> findLinkedNamespaceUsage(@PathVariable String appId, @PathVariable String env,
184.       @PathVariable String clusterName, @PathVariable String namespaceName) {
185.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(appId, namespaceName, Env.valueOf(env), clusterName);
186.     return Lists.newArrayList(usage);
187.   }
188. 
189.   @GetMapping("/apps/{appId}/namespaces/{namespaceName}/usage")
190.   public List<NamespaceUsage> findNamespaceUsage(@PathVariable String appId, @PathVariable String namespaceName) {
191.     return namespaceService.getNamespaceUsageByAppId(appId, namespaceName);
192.   }
193. 
194.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
195.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
196.   public ResponseEntity<Void> deleteAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
197. 
198.     AppNamespace appNamespace = appNamespaceService.deleteAppNamespace(appId, namespaceName);
199. 
200.     publisher.publishEvent(new AppNamespaceDeletionEvent(appNamespace));
201. 
202.     return ResponseEntity.ok().build();
203.   }
204. 
205.   @GetMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
206.   public AppNamespaceDTO findAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
207.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);
208. 
209.     if (appNamespace == null) {
210.       throw new BadRequestException(
211.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));
212.     }
213. 
214.     return BeanUtils.transform(AppNamespaceDTO.class, appNamespace);
215.   }
216. 
217.   @PreAuthorize(value = "@permissionValidator.hasCreateAppNamespacePermission(#appId, #appNamespace)")
218.   @PostMapping("/apps/{appId}/appnamespaces")
219.   public AppNamespace createAppNamespace(@PathVariable String appId,
220.       @RequestParam(defaultValue = "true") boolean appendNamespacePrefix,
221.       @Valid @RequestBody AppNamespace appNamespace) {
222.     if (!InputValidator.isValidAppNamespace(appNamespace.getName())) {
223.       throw new BadRequestException(String.format("Invalid Namespace format: %s",
224.           InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
225.     }
226. 
227.     AppNamespace createdAppNamespace = appNamespaceService.createAppNamespaceInLocal(appNamespace, appendNamespacePrefix);
228. 
229.     if (portalConfig.canAppAdminCreatePrivateNamespace() || createdAppNamespace.isPublic()) {
230.       namespaceService.assignNamespaceRoleToOperator(appId, appNamespace.getName(),
231.           userInfoHolder.getUser().getUserId());
232.     }
233. 
234.     publisher.publishEvent(new AppNamespaceCreationEvent(createdAppNamespace));
235. 
236.     return createdAppNamespace;
237.   }
238. 
239.   /**
240.    * env -> cluster -> cluster has not published namespace?
241.    * Example:
242.    * dev ->
243.    *  default -> true   (default cluster has not published namespace)
244.    *  customCluster -> false (customCluster cluster's all namespaces had published)
245.    */
246.   @GetMapping("/apps/{appId}/namespaces/publish_info")
247.   public Map<String, Map<String, Boolean>> getNamespacesPublishInfo(@PathVariable String appId) {
248.     return namespaceService.getNamespacesPublishInfo(appId);
249.   }
250. 
251.   @GetMapping("/envs/{env}/appnamespaces/{publicNamespaceName}/namespaces")
252.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(@PathVariable String env,
253.                                                                @PathVariable String publicNamespaceName,
254.                                                                @RequestParam(name = "page", defaultValue = "0") int page,
255.                                                                @RequestParam(name = "size", defaultValue = "10") int size) {
256. 
257.     return namespaceService.getPublicAppNamespaceAllNamespaces(Env.valueOf(env), publicNamespaceName, page, size);
258. 
259.   }
260. 
261.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/missing-namespaces")
262.   public MultiResponseEntity<String> findMissingNamespaces(@PathVariable String appId, @PathVariable String env, @PathVariable String clusterName) {
263. 
264.     MultiResponseEntity<String> response = MultiResponseEntity.ok();
265. 
266.     Set<String> missingNamespaces = findMissingNamespaceNames(appId, env, clusterName);
267. 
268.     for (String missingNamespace : missingNamespaces) {
269.       response.addResponseEntity(RichResponseEntity.ok(missingNamespace));
270.     }
271. 
272.     return response;
273.   }
274. 
275.   @PostMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/missing-namespaces")
276.   public ResponseEntity<Void> createMissingNamespaces(@PathVariable String appId, @PathVariable String env, @PathVariable String clusterName) {
277. 
278.     Set<String> missingNamespaces = findMissingNamespaceNames(appId, env, clusterName);
279. 
280.     for (String missingNamespace : missingNamespaces) {
281.       namespaceAPI.createMissingAppNamespace(Env.valueOf(env), findAppNamespace(appId, missingNamespace));
282.     }
283. 
284.     return ResponseEntity.ok().build();
285.   }
286. 
287.   private Set<String> findMissingNamespaceNames(String appId, String env, String clusterName) {
288.     List<AppNamespaceDTO> configDbAppNamespaces = namespaceAPI.getAppNamespaces(appId, Env.valueOf(env));
289.     List<NamespaceDTO> configDbNamespaces = namespaceService.findNamespaces(appId, Env.valueOf(env), clusterName);
290.     List<AppNamespace> portalDbAppNamespaces = appNamespaceService.findByAppId(appId);
291. 
292.     Set<String> configDbAppNamespaceNames = configDbAppNamespaces.stream().map(AppNamespaceDTO::getName)
293.             .collect(Collectors.toSet());
294.     Set<String> configDbNamespaceNames = configDbNamespaces.stream().map(NamespaceDTO::getNamespaceName)
295.         .collect(Collectors.toSet());
296. 
297.     Set<String> portalDbAllAppNamespaceNames = Sets.newHashSet();
298.     Set<String> portalDbPrivateAppNamespaceNames = Sets.newHashSet();
299. 
300.     for (AppNamespace appNamespace : portalDbAppNamespaces) {
301.       portalDbAllAppNamespaceNames.add(appNamespace.getName());
302.       if (!appNamespace.isPublic()) {
303.         portalDbPrivateAppNamespaceNames.add(appNamespace.getName());
304.       }
305.     }
306. 
307.     // AppNamespaces should be the same
308.     Set<String> missingAppNamespaceNames = Sets.difference(portalDbAllAppNamespaceNames, configDbAppNamespaceNames);
309.     // Private namespaces should all exist
310.     Set<String> missingNamespaceNames = Sets.difference(portalDbPrivateAppNamespaceNames, configDbNamespaceNames);
311. 
312.     return Sets.union(missingAppNamespaceNames, missingNamespaceNames);
313.   }
314. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/NamespaceBO.java
Line number range: 1 - 103
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.entity.bo;
18. 
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. 
21. import java.util.List;
22. 
23. public class NamespaceBO {
24.   private NamespaceDTO baseInfo;
25.   private int itemModifiedCnt;
26.   private List<ItemBO> items;
27.   private String format;
28.   private boolean isPublic;
29.   private String parentAppId;
30.   private String comment;
31.   // is the configs hidden to current user?
32.   private boolean isConfigHidden;
33. 
34.   public NamespaceDTO getBaseInfo() {
35.     return baseInfo;
36.   }
37. 
38.   public void setBaseInfo(NamespaceDTO baseInfo) {
39.     this.baseInfo = baseInfo;
40.   }
41. 
42.   public int getItemModifiedCnt() {
43.     return itemModifiedCnt;
44.   }
45. 
46.   public void setItemModifiedCnt(int itemModifiedCnt) {
47.     this.itemModifiedCnt = itemModifiedCnt;
48.   }
49. 
50.   public List<ItemBO> getItems() {
51.     return items;
52.   }
53. 
54.   public void setItems(List<ItemBO> items) {
55.     this.items = items;
56.   }
57. 
58.   public String getFormat() {
59.     return format;
60.   }
61. 
62.   public void setFormat(String format) {
63.     this.format = format;
64.   }
65. 
66.   public boolean isPublic() {
67.     return isPublic;
68.   }
69. 
70.   public void setPublic(boolean aPublic) {
71.     isPublic = aPublic;
72.   }
73. 
74.   public String getParentAppId() {
75.     return parentAppId;
76.   }
77. 
78.   public void setParentAppId(String parentAppId) {
79.     this.parentAppId = parentAppId;
80.   }
81. 
82.   public String getComment() {
83.     return comment;
84.   }
85. 
86.   public void setComment(String comment) {
87.     this.comment = comment;
88.   }
89. 
90.   public boolean isConfigHidden() {
91.     return isConfigHidden;
92.   }
93. 
94.   public void setConfigHidden(boolean hidden) {
95.     isConfigHidden = hidden;
96.   }
97. 
98.   public void hideItems() {
99.     setConfigHidden(true);
100.     items.clear();
101.     setItemModifiedCnt(0);
102.   }
103. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/model/NamespaceCreationModel.java
Line number range: 1 - 43
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.entity.model;
18. 
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. 
21. 
22. public class NamespaceCreationModel {
23. 
24.   private String env;
25. 
26.   private NamespaceDTO namespace;
27. 
28.   public String getEnv() {
29.     return env;
30.   }
31. 
32.   public void setEnv(String env) {
33.     this.env = env;
34.   }
35. 
36.   public NamespaceDTO getNamespace() {
37.     return namespace;
38.   }
39. 
40.   public void setNamespace(NamespaceDTO namespace) {
41.     this.namespace = namespace;
42.   }
43. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java
Line number range: 1 - 44
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.repository;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import java.util.List;
21. import org.springframework.data.jpa.repository.Modifying;
22. import org.springframework.data.jpa.repository.Query;
23. import org.springframework.data.repository.PagingAndSortingRepository;
24. 
25. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long> {
26. 
27.   AppNamespace findByAppIdAndName(String appId, String namespaceName);
28. 
29.   AppNamespace findByName(String namespaceName);
30. 
31.   List<AppNamespace> findByNameAndIsPublic(String namespaceName, boolean isPublic);
32. 
33.   List<AppNamespace> findByIsPublicTrue();
34. 
35.   List<AppNamespace> findByAppId(String appId);
36. 
37.   @Modifying
38.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy=?2 WHERE AppId=?1 and IsDeleted = 0")
39.   int batchDeleteByAppId(String appId, String operator);
40. 
41.   @Modifying
42.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")
43.   int delete(String appId, String namespaceName, String operator);
44. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 1 - 258
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.entity.App;
20. import com.ctrip.framework.apollo.common.entity.AppNamespace;
21. import com.ctrip.framework.apollo.common.exception.BadRequestException;
22. import com.ctrip.framework.apollo.core.ConfigConsts;
23. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
24. import com.ctrip.framework.apollo.core.utils.StringUtils;
25. import com.ctrip.framework.apollo.portal.repository.AppNamespaceRepository;
26. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
27. import com.google.common.base.Joiner;
28. import com.google.common.collect.Lists;
29. import com.google.common.collect.Sets;
30. import java.util.List;
31. import java.util.Objects;
32. import java.util.Set;
33. import org.springframework.context.annotation.Lazy;
34. import org.springframework.stereotype.Service;
35. import org.springframework.transaction.annotation.Transactional;
36. import org.springframework.util.CollectionUtils;
37. 
38. @Service
39. public class AppNamespaceService {
40. 
41.   private static final int PRIVATE_APP_NAMESPACE_NOTIFICATION_COUNT = 5;
42.   private static final Joiner APP_NAMESPACE_JOINER = Joiner.on(",").skipNulls();
43. 
44.   private final UserInfoHolder userInfoHolder;
45.   private final AppNamespaceRepository appNamespaceRepository;
46.   private final RoleInitializationService roleInitializationService;
47.   private final AppService appService;
48.   private final RolePermissionService rolePermissionService;
49. 
50.   public AppNamespaceService(
51.       final UserInfoHolder userInfoHolder,
52.       final AppNamespaceRepository appNamespaceRepository,
53.       final RoleInitializationService roleInitializationService,
54.       final @Lazy AppService appService,
55.       final RolePermissionService rolePermissionService) {
56.     this.userInfoHolder = userInfoHolder;
57.     this.appNamespaceRepository = appNamespaceRepository;
58.     this.roleInitializationService = roleInitializationService;
59.     this.appService = appService;
60.     this.rolePermissionService = rolePermissionService;
61.   }
62. 
63.   /**
64.    * 公共的app ns,能被其它项目关联到的app ns
65.    */
66.   public List<AppNamespace> findPublicAppNamespaces() {
67.     return appNamespaceRepository.findByIsPublicTrue();
68.   }
69. 
70.   public AppNamespace findPublicAppNamespace(String namespaceName) {
71.     List<AppNamespace> appNamespaces = appNamespaceRepository.findByNameAndIsPublic(namespaceName, true);
72. 
73.     if (CollectionUtils.isEmpty(appNamespaces)) {
74.       return null;
75.     }
76. 
77.     return appNamespaces.get(0);
78.   }
79. 
80.   private List<AppNamespace> findAllPrivateAppNamespaces(String namespaceName) {
81.     return appNamespaceRepository.findByNameAndIsPublic(namespaceName, false);
82.   }
83. 
84.   public AppNamespace findByAppIdAndName(String appId, String namespaceName) {
85.     return appNamespaceRepository.findByAppIdAndName(appId, namespaceName);
86.   }
87. 
88.   public List<AppNamespace> findByAppId(String appId) {
89.     return appNamespaceRepository.findByAppId(appId);
90.   }
91. 
92.   public List<AppNamespace> findAll() {
93.     Iterable<AppNamespace> appNamespaces = appNamespaceRepository.findAll();
94.     return Lists.newArrayList(appNamespaces);
95.   }
96. 
97.   @Transactional
98.   public void createDefaultAppNamespace(String appId) {
99.     if (!isAppNamespaceNameUnique(appId, ConfigConsts.NAMESPACE_APPLICATION)) {
100.       throw new BadRequestException(String.format("App already has application namespace. AppId = %s", appId));
101.     }
102. 
103.     AppNamespace appNs = new AppNamespace();
104.     appNs.setAppId(appId);
105.     appNs.setName(ConfigConsts.NAMESPACE_APPLICATION);
106.     appNs.setComment("default app namespace");
107.     appNs.setFormat(ConfigFileFormat.Properties.getValue());
108.     String userId = userInfoHolder.getUser().getUserId();
109.     appNs.setDataChangeCreatedBy(userId);
110.     appNs.setDataChangeLastModifiedBy(userId);
111. 
112.     appNamespaceRepository.save(appNs);
113.   }
114. 
115.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {
116.     Objects.requireNonNull(appId, "AppId must not be null");
117.     Objects.requireNonNull(namespaceName, "Namespace must not be null");
118.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));
119.   }
120. 
121.   @Transactional
122.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace) {
123.     return createAppNamespaceInLocal(appNamespace, true);
124.   }
125. 
126.   @Transactional
127.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace, boolean appendNamespacePrefix) {
128.     String appId = appNamespace.getAppId();
129. 
130.     //add app org id as prefix
131.     App app = appService.load(appId);
132.     if (app == null) {
133.       throw new BadRequestException("App not exist. AppId = " + appId);
134.     }
135. 
136.     StringBuilder appNamespaceName = new StringBuilder();
137.     //add prefix postfix
138.     appNamespaceName
139.         .append(appNamespace.isPublic() && appendNamespacePrefix ? app.getOrgId() + "." : "")
140.         .append(appNamespace.getName())
141.         .append(appNamespace.formatAsEnum() == ConfigFileFormat.Properties ? "" : "." + appNamespace.getFormat());
142.     appNamespace.setName(appNamespaceName.toString());
143. 
144.     if (appNamespace.getComment() == null) {
145.       appNamespace.setComment("");
146.     }
147. 
148.     if (!ConfigFileFormat.isValidFormat(appNamespace.getFormat())) {
149.      throw new BadRequestException("Invalid namespace format. format must be properties、json、yaml、yml、xml");
150.     }
151. 
152.     String operator = appNamespace.getDataChangeCreatedBy();
153.     if (StringUtils.isEmpty(operator)) {
154.       operator = userInfoHolder.getUser().getUserId();
155.       appNamespace.setDataChangeCreatedBy(operator);
156.     }
157. 
158.     appNamespace.setDataChangeLastModifiedBy(operator);
159. 
160.     // globally uniqueness check for public app namespace
161.     if (appNamespace.isPublic()) {
162.       checkAppNamespaceGlobalUniqueness(appNamespace);
163.     } else {
164.       // check private app namespace
165.       if (appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName()) != null) {
166.         throw new BadRequestException("Private AppNamespace " + appNamespace.getName() + " already exists!");
167.       }
168.       // should not have the same with public app namespace
169.       checkPublicAppNamespaceGlobalUniqueness(appNamespace);
170.     }
171. 
172.     AppNamespace createdAppNamespace = appNamespaceRepository.save(appNamespace);
173. 
174.     roleInitializationService.initNamespaceRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
175.     roleInitializationService.initNamespaceEnvRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
176. 
177.     return createdAppNamespace;
178.   }
179. 
180.   @Transactional
181.   public AppNamespace importAppNamespaceInLocal(AppNamespace appNamespace) {
182.     // globally uniqueness check for public app namespace
183.     if (appNamespace.isPublic()) {
184.       checkAppNamespaceGlobalUniqueness(appNamespace);
185.     } else {
186.       // check private app namespace
187.       if (appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName()) != null) {
188.         throw new BadRequestException("Private AppNamespace " + appNamespace.getName() + " already exists!");
189.       }
190.       // should not have the same with public app namespace
191.       checkPublicAppNamespaceGlobalUniqueness(appNamespace);
192.     }
193. 
194.     AppNamespace createdAppNamespace = appNamespaceRepository.save(appNamespace);
195. 
196.     String operator = appNamespace.getDataChangeCreatedBy();
197. 
198.     roleInitializationService.initNamespaceRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
199.     roleInitializationService.initNamespaceEnvRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
200. 
201.     return createdAppNamespace;
202.   }
203. 
204.   private void checkAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {
205.     checkPublicAppNamespaceGlobalUniqueness(appNamespace);
206. 
207.     List<AppNamespace> privateAppNamespaces = findAllPrivateAppNamespaces(appNamespace.getName());
208. 
209.     if (!CollectionUtils.isEmpty(privateAppNamespaces)) {
210.       Set<String> appIds = Sets.newHashSet();
211.       for (AppNamespace ans : privateAppNamespaces) {
212.         appIds.add(ans.getAppId());
213.         if (appIds.size() == PRIVATE_APP_NAMESPACE_NOTIFICATION_COUNT) {
214.           break;
215.         }
216.       }
217. 
218.       throw new BadRequestException(
219.           "Public AppNamespace " + appNamespace.getName() + " already exists as private AppNamespace in appId: "
220.               + APP_NAMESPACE_JOINER.join(appIds) + ", etc. Please select another name!");
221.     }
222.   }
223. 
224.   private void checkPublicAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {
225.     AppNamespace publicAppNamespace = findPublicAppNamespace(appNamespace.getName());
226.     if (publicAppNamespace != null) {
227.       throw new BadRequestException("AppNamespace " + appNamespace.getName() + " already exists as public namespace in appId: " + publicAppNamespace.getAppId() + "!");
228.     }
229.   }
230. 
231. 
232.   @Transactional
233.   public AppNamespace deleteAppNamespace(String appId, String namespaceName) {
234.     AppNamespace appNamespace = appNamespaceRepository.findByAppIdAndName(appId, namespaceName);
235.     if (appNamespace == null) {
236.       throw new BadRequestException(
237.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));
238.     }
239. 
240.     String operator = userInfoHolder.getUser().getUserId();
241. 
242.     // this operator is passed to com.ctrip.framework.apollo.portal.listener.DeletionListener.onAppNamespaceDeletionEvent
243.     appNamespace.setDataChangeLastModifiedBy(operator);
244. 
245.     // delete app namespace in portal db
246.     appNamespaceRepository.delete(appId, namespaceName, operator);
247. 
248.     // delete Permission and Role related data
249.     rolePermissionService.deleteRolePermissionsByAppIdAndNamespace(appId, namespaceName, operator);
250. 
251.     return appNamespace;
252.   }
253. 
254.   public void batchDeleteByAppId(String appId, String operator) {
255.     appNamespaceRepository.batchDeleteByAppId(appId, operator);
256.   }
257. 
258. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceBranchService.java
Line number range: 1 - 179
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.dto.GrayReleaseRuleDTO;
20. import com.ctrip.framework.apollo.common.dto.ItemChangeSets;
21. import com.ctrip.framework.apollo.common.dto.ItemDTO;
22. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
23. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
24. import com.ctrip.framework.apollo.common.exception.BadRequestException;
25. import com.ctrip.framework.apollo.portal.environment.Env;
26. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
27. import com.ctrip.framework.apollo.portal.component.ItemsComparator;
28. import com.ctrip.framework.apollo.portal.constant.TracerEventType;
29. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
30. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
31. import com.ctrip.framework.apollo.tracer.Tracer;
32. import org.springframework.stereotype.Service;
33. import org.springframework.transaction.annotation.Transactional;
34. 
35. import java.util.Collections;
36. import java.util.List;
37. 
38. @Service
39. public class NamespaceBranchService {
40. 
41.   private final ItemsComparator itemsComparator;
42.   private final UserInfoHolder userInfoHolder;
43.   private final NamespaceService namespaceService;
44.   private final ItemService itemService;
45.   private final AdminServiceAPI.NamespaceBranchAPI namespaceBranchAPI;
46.   private final ReleaseService releaseService;
47. 
48.   public NamespaceBranchService(
49.       final ItemsComparator itemsComparator,
50.       final UserInfoHolder userInfoHolder,
51.       final NamespaceService namespaceService,
52.       final ItemService itemService,
53.       final AdminServiceAPI.NamespaceBranchAPI namespaceBranchAPI,
54.       final ReleaseService releaseService) {
55.     this.itemsComparator = itemsComparator;
56.     this.userInfoHolder = userInfoHolder;
57.     this.namespaceService = namespaceService;
58.     this.itemService = itemService;
59.     this.namespaceBranchAPI = namespaceBranchAPI;
60.     this.releaseService = releaseService;
61.   }
62. 
63. 
64.   @Transactional
65.   public NamespaceDTO createBranch(String appId, Env env, String parentClusterName, String namespaceName) {
66.     String operator = userInfoHolder.getUser().getUserId();
67.     return createBranch(appId, env, parentClusterName, namespaceName, operator);
68.   }
69. 
70.   @Transactional
71.   public NamespaceDTO createBranch(String appId, Env env, String parentClusterName, String namespaceName, String operator) {
72.     NamespaceDTO createdBranch = namespaceBranchAPI.createBranch(appId, env, parentClusterName, namespaceName,
73.             operator);
74. 
75.     Tracer.logEvent(TracerEventType.CREATE_GRAY_RELEASE, String.format("%s+%s+%s+%s", appId, env, parentClusterName,
76.             namespaceName));
77.     return createdBranch;
78. 
79.   }
80. 
81.   public GrayReleaseRuleDTO findBranchGrayRules(String appId, Env env, String clusterName,
82.                                                 String namespaceName, String branchName) {
83.     return namespaceBranchAPI.findBranchGrayRules(appId, env, clusterName, namespaceName, branchName);
84. 
85.   }
86. 
87.   public void updateBranchGrayRules(String appId, Env env, String clusterName, String namespaceName,
88.                                     String branchName, GrayReleaseRuleDTO rules) {
89. 
90.     String operator = userInfoHolder.getUser().getUserId();
91.     updateBranchGrayRules(appId, env, clusterName, namespaceName, branchName, rules, operator);
92.   }
93. 
94.   public void updateBranchGrayRules(String appId, Env env, String clusterName, String namespaceName,
95.                                     String branchName, GrayReleaseRuleDTO rules, String operator) {
96.     rules.setDataChangeCreatedBy(operator);
97.     rules.setDataChangeLastModifiedBy(operator);
98. 
99.     namespaceBranchAPI.updateBranchGrayRules(appId, env, clusterName, namespaceName, branchName, rules);
100. 
101.     Tracer.logEvent(TracerEventType.UPDATE_GRAY_RELEASE_RULE,
102.             String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
103.   }
104. 
105.   public void deleteBranch(String appId, Env env, String clusterName, String namespaceName,
106.                            String branchName) {
107. 
108.     String operator = userInfoHolder.getUser().getUserId();
109.     deleteBranch(appId, env, clusterName, namespaceName, branchName, operator);
110.   }
111. 
112.   public void deleteBranch(String appId, Env env, String clusterName, String namespaceName,
113.                            String branchName, String operator) {
114.     namespaceBranchAPI.deleteBranch(appId, env, clusterName, namespaceName, branchName, operator);
115. 
116.     Tracer.logEvent(TracerEventType.DELETE_GRAY_RELEASE,
117.             String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
118.   }
119. 
120. 
121.   public ReleaseDTO merge(String appId, Env env, String clusterName, String namespaceName,
122.                           String branchName, String title, String comment,
123.                           boolean isEmergencyPublish, boolean deleteBranch) {
124.     String operator = userInfoHolder.getUser().getUserId();
125.     return merge(appId, env, clusterName, namespaceName, branchName, title, comment, isEmergencyPublish, deleteBranch, operator);
126.   }
127. 
128.   public ReleaseDTO merge(String appId, Env env, String clusterName, String namespaceName,
129.                           String branchName, String title, String comment,
130.                           boolean isEmergencyPublish, boolean deleteBranch, String operator) {
131. 
132.     ItemChangeSets changeSets = calculateBranchChangeSet(appId, env, clusterName, namespaceName, branchName, operator);
133. 
134.     ReleaseDTO mergedResult =
135.             releaseService.updateAndPublish(appId, env, clusterName, namespaceName, title, comment,
136.                     branchName, isEmergencyPublish, deleteBranch, changeSets);
137. 
138.     Tracer.logEvent(TracerEventType.MERGE_GRAY_RELEASE,
139.             String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
140. 
141.     return mergedResult;
142.   }
143. 
144.   private ItemChangeSets calculateBranchChangeSet(String appId, Env env, String clusterName, String namespaceName,
145.                                                   String branchName, String operator) {
146.     NamespaceBO parentNamespace = namespaceService.loadNamespaceBO(appId, env, clusterName, namespaceName);
147. 
148.     if (parentNamespace == null) {
149.       throw new BadRequestException("base namespace not existed");
150.     }
151. 
152.     if (parentNamespace.getItemModifiedCnt() > 0) {
153.       throw new BadRequestException("Merge operation failed. Because master has modified items");
154.     }
155. 
156.     List<ItemDTO> masterItems = itemService.findItems(appId, env, clusterName, namespaceName);
157. 
158.     List<ItemDTO> branchItems = itemService.findItems(appId, env, branchName, namespaceName);
159. 
160.     ItemChangeSets changeSets = itemsComparator.compareIgnoreBlankAndCommentItem(parentNamespace.getBaseInfo().getId(),
161.                                                                                  masterItems, branchItems);
162.     changeSets.setDeleteItems(Collections.emptyList());
163.     changeSets.setDataChangeLastModifiedBy(operator);
164.     return changeSets;
165.   }
166. 
167.   public NamespaceDTO findBranchBaseInfo(String appId, Env env, String clusterName, String namespaceName) {
168.     return namespaceBranchAPI.findBranch(appId, env, clusterName, namespaceName);
169.   }
170. 
171.   public NamespaceBO findBranch(String appId, Env env, String clusterName, String namespaceName) {
172.     NamespaceDTO namespaceDTO = findBranchBaseInfo(appId, env, clusterName, namespaceName);
173.     if (namespaceDTO == null) {
174.       return null;
175.     }
176.     return namespaceService.loadNamespaceBO(appId, env, namespaceDTO.getClusterName(), namespaceName);
177.   }
178. 
179. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 1 - 423
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.constants.GsonType;
20. import com.ctrip.framework.apollo.common.dto.ClusterDTO;
21. import com.ctrip.framework.apollo.common.dto.ItemDTO;
22. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
23. import com.ctrip.framework.apollo.common.dto.PageDTO;
24. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
25. import com.ctrip.framework.apollo.common.entity.AppNamespace;
26. import com.ctrip.framework.apollo.common.exception.BadRequestException;
27. import com.ctrip.framework.apollo.common.utils.BeanUtils;
28. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
29. import com.ctrip.framework.apollo.core.utils.ApolloThreadFactory;
30. import com.ctrip.framework.apollo.core.utils.StringUtils;
31. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
32. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI.NamespaceAPI;
33. import com.ctrip.framework.apollo.portal.component.PortalSettings;
34. import com.ctrip.framework.apollo.portal.component.config.PortalConfig;
35. import com.ctrip.framework.apollo.portal.constant.RoleType;
36. import com.ctrip.framework.apollo.portal.constant.TracerEventType;
37. import com.ctrip.framework.apollo.portal.enricher.adapter.BaseDtoUserInfoEnrichedAdapter;
38. import com.ctrip.framework.apollo.portal.entity.bo.ItemBO;
39. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
40. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
41. import com.ctrip.framework.apollo.portal.environment.Env;
42. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
43. import com.ctrip.framework.apollo.portal.util.RoleUtils;
44. import com.ctrip.framework.apollo.tracer.Tracer;
45. import com.google.common.collect.Maps;
46. import com.google.common.collect.Sets;
47. import com.google.gson.Gson;
48. import java.util.ArrayList;
49. import java.util.Collections;
50. import java.util.Comparator;
51. import java.util.HashMap;
52. import java.util.LinkedList;
53. import java.util.List;
54. import java.util.Map;
55. import java.util.Set;
56. import java.util.concurrent.CountDownLatch;
57. import java.util.concurrent.ExecutorService;
58. import java.util.concurrent.Executors;
59. import java.util.stream.Collectors;
60. import org.slf4j.Logger;
61. import org.slf4j.LoggerFactory;
62. import org.springframework.context.annotation.Lazy;
63. import org.springframework.data.domain.Pageable;
64. import org.springframework.stereotype.Service;
65. import org.springframework.transaction.annotation.Transactional;
66. 
67. @Service
68. public class NamespaceService {
69. 
70.   private static final Logger LOGGER = LoggerFactory.getLogger(NamespaceService.class);
71.   private static final Gson GSON = new Gson();
72.   private static final ExecutorService executorService = Executors.newFixedThreadPool(
73.       Runtime.getRuntime().availableProcessors() * 2
74.       , ApolloThreadFactory.create("NamespaceService", true));
75. 
76.   private final PortalConfig portalConfig;
77.   private final PortalSettings portalSettings;
78.   private final UserInfoHolder userInfoHolder;
79.   private final AdminServiceAPI.NamespaceAPI namespaceAPI;
80.   private final ItemService itemService;
81.   private final ReleaseService releaseService;
82.   private final AppNamespaceService appNamespaceService;
83.   private final InstanceService instanceService;
84.   private final NamespaceBranchService branchService;
85.   private final RolePermissionService rolePermissionService;
86.   private final AdditionalUserInfoEnrichService additionalUserInfoEnrichService;
87.   private final ClusterService clusterService;
88. 
89.   public NamespaceService(
90.       final PortalConfig portalConfig,
91.       final PortalSettings portalSettings,
92.       final UserInfoHolder userInfoHolder,
93.       final NamespaceAPI namespaceAPI,
94.       final ItemService itemService,
95.       final ReleaseService releaseService,
96.       final AppNamespaceService appNamespaceService,
97.       final InstanceService instanceService,
98.       final @Lazy NamespaceBranchService branchService,
99.       final RolePermissionService rolePermissionService,
100.       final AdditionalUserInfoEnrichService additionalUserInfoEnrichService,
101.       ClusterService clusterService) {
102.     this.portalConfig = portalConfig;
103.     this.portalSettings = portalSettings;
104.     this.userInfoHolder = userInfoHolder;
105.     this.namespaceAPI = namespaceAPI;
106.     this.itemService = itemService;
107.     this.releaseService = releaseService;
108.     this.appNamespaceService = appNamespaceService;
109.     this.instanceService = instanceService;
110.     this.branchService = branchService;
111.     this.rolePermissionService = rolePermissionService;
112.     this.additionalUserInfoEnrichService = additionalUserInfoEnrichService;
113.     this.clusterService = clusterService;
114.   }
115. 
116. 
117.   public NamespaceDTO createNamespace(Env env, NamespaceDTO namespace) {
118.     if (StringUtils.isEmpty(namespace.getDataChangeCreatedBy())) {
119.       namespace.setDataChangeCreatedBy(userInfoHolder.getUser().getUserId());
120.     }
121. 
122.     if (StringUtils.isEmpty(namespace.getDataChangeLastModifiedBy())) {
123.       namespace.setDataChangeLastModifiedBy(userInfoHolder.getUser().getUserId());
124.     }
125.     NamespaceDTO createdNamespace = namespaceAPI.createNamespace(env, namespace);
126. 
127.     Tracer.logEvent(TracerEventType.CREATE_NAMESPACE,
128.         String.format("%s+%s+%s+%s", namespace.getAppId(), env, namespace.getClusterName(),
129.             namespace.getNamespaceName()));
130.     return createdNamespace;
131.   }
132. 
133. 
134.   public List<NamespaceUsage> getNamespaceUsageByAppId(String appId, String namespaceName) {
135.     List<Env> envs = portalSettings.getActiveEnvs();
136.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);
137.     List<NamespaceUsage> usages = new ArrayList<>();
138.     for (Env env : envs) {
139.       List<ClusterDTO> clusters = clusterService.findClusters(env, appId);
140.       for (ClusterDTO cluster : clusters) {
141.         String clusterName = cluster.getName();
142.         NamespaceUsage usage = this.getNamespaceUsageByEnv(appId, namespaceName, env, clusterName);
143.         if (appNamespace != null && appNamespace.isPublic()) {
144.           int associatedNamespace = this.getPublicAppNamespaceHasAssociatedNamespace(namespaceName, env);
145.           usage.setLinkedNamespaceCount(associatedNamespace);
146.         }
147. 
148.         if(usage.getLinkedNamespaceCount() > 0 || usage.getBranchInstanceCount() > 0 || usage.getInstanceCount() > 0) {
149.           usages.add(usage);
150.         }
151.       }
152.     }
153.     return usages;
154.   }
155. 
156.   public NamespaceUsage getNamespaceUsageByEnv(String appId, String namespaceName, Env env, String clusterName) {
157.     NamespaceUsage namespaceUsage = new NamespaceUsage(namespaceName, appId, clusterName, env.getName());
158.     int instanceCount = instanceService.getInstanceCountByNamespace(appId, env, clusterName, namespaceName);
159.     namespaceUsage.setInstanceCount(instanceCount);
160. 
161.     NamespaceDTO branchNamespace = branchService.findBranchBaseInfo(appId, env, clusterName, namespaceName);
162.     if(branchNamespace != null){
163.       String branchClusterName = branchNamespace.getClusterName();
164.       int branchInstanceCount = instanceService.getInstanceCountByNamespace(appId, env, branchClusterName, namespaceName);
165.       namespaceUsage.setBranchInstanceCount(branchInstanceCount);
166.     }
167.     return namespaceUsage;
168.   }
169. 
170.   @Transactional
171.   public void deleteNamespace(String appId, Env env, String clusterName, String namespaceName) {
172. 
173.     String operator = userInfoHolder.getUser().getUserId();
174.     namespaceAPI.deleteNamespace(env, appId, clusterName, namespaceName, operator);
175.   }
176. 
177.   public NamespaceDTO loadNamespaceBaseInfo(String appId, Env env, String clusterName,
178.       String namespaceName) {
179.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
180.     if (namespace == null) {
181.       throw new BadRequestException(String.format("Namespace: %s not exist.", namespaceName));
182.     }
183.     return namespace;
184.   }
185. 
186.   /**
187.    * load cluster all namespace info with items
188.    */
189.   public List<NamespaceBO> findNamespaceBOs(String appId, Env env, String clusterName) {
190. 
191.     List<NamespaceDTO> namespaces = namespaceAPI.findNamespaceByCluster(appId, env, clusterName);
192.     if (namespaces == null || namespaces.size() == 0) {
193.       throw new BadRequestException("namespaces not exist");
194.     }
195. 
196.     List<NamespaceBO> namespaceBOs = Collections.synchronizedList(new LinkedList<>());
197.     List<String> exceptionNamespaces = Collections.synchronizedList(new LinkedList<>());
198.     CountDownLatch latch = new CountDownLatch(namespaces.size());
199.     for (NamespaceDTO namespace : namespaces) {
200.       executorService.submit(() -> {
201.         NamespaceBO namespaceBO;
202.         try {
203.           namespaceBO = transformNamespace2BO(env, namespace);
204.           namespaceBOs.add(namespaceBO);
205.         } catch (Exception e) {
206.           LOGGER.error("parse namespace error. app id:{}, env:{}, clusterName:{}, namespace:{}",
207.               appId, env, clusterName, namespace.getNamespaceName(), e);
208.           exceptionNamespaces.add(namespace.getNamespaceName());
209.         } finally {
210.           latch.countDown();
211.         }
212.       });
213. 
214.     }
215.     try {
216.       latch.await();
217.     } catch (InterruptedException e) {
218.       //ignore
219.     }
220. 
221.     if(namespaceBOs.size() != namespaces.size()){
222.        throw new RuntimeException(String
223.            .format("Parse namespaces error, expected: %s, but actual: %s, cannot get those namespaces: %s", namespaces.size(), namespaceBOs.size(), exceptionNamespaces));
224.     }
225. 
226.     return namespaceBOs.stream()
227.         .sorted(Comparator.comparing(o -> o.getBaseInfo().getId()))
228.         .collect(Collectors.toList());
229.   }
230. 
231.   public List<NamespaceDTO> findNamespaces(String appId, Env env, String clusterName) {
232.     return namespaceAPI.findNamespaceByCluster(appId, env, clusterName);
233.   }
234. 
235.   /**
236.    * the returned content's size is not fixed. so please carefully used.
237.    */
238.   public PageDTO<NamespaceDTO> findNamespacesByItem(Env env, String itemKey, Pageable pageable) {
239.     return namespaceAPI.findByItem(env, itemKey, pageable.getPageNumber(), pageable.getPageSize());
240.   }
241. 
242.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(Env env, String publicNamespaceName,
243.       int page,
244.       int size) {
245.     return namespaceAPI.getPublicAppNamespaceAllNamespaces(env, publicNamespaceName, page, size);
246.   }
247. 
248.   public NamespaceBO loadNamespaceBO(String appId, Env env, String clusterName,
249.       String namespaceName) {
250.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
251.     if (namespace == null) {
252.       throw new BadRequestException("namespaces not exist");
253.     }
254.     return transformNamespace2BO(env, namespace);
255.   }
256. 
257.   public boolean publicAppNamespaceHasAssociatedNamespace(String publicNamespaceName, Env env) {
258.     return getPublicAppNamespaceHasAssociatedNamespace(publicNamespaceName, env) > 0;
259.   }
260. 
261.   public int getPublicAppNamespaceHasAssociatedNamespace(String publicNamespaceName, Env env) {
262.     return namespaceAPI.countPublicAppNamespaceAssociatedNamespaces(env, publicNamespaceName);
263.   }
264. 
265.   public NamespaceBO findPublicNamespaceForAssociatedNamespace(Env env, String appId,
266.       String clusterName, String namespaceName) {
267.     NamespaceDTO namespace =
268.         namespaceAPI
269.             .findPublicNamespaceForAssociatedNamespace(env, appId, clusterName, namespaceName);
270. 
271.     return transformNamespace2BO(env, namespace);
272.   }
273. 
274.   public Map<String, Map<String, Boolean>> getNamespacesPublishInfo(String appId) {
275.     Map<String, Map<String, Boolean>> result = Maps.newHashMap();
276. 
277.     Set<Env> envs = portalConfig.publishTipsSupportedEnvs();
278.     for (Env env : envs) {
279.       if (portalSettings.isEnvActive(env)) {
280.         result.put(env.toString(), namespaceAPI.getNamespacePublishInfo(env, appId));
281.       }
282.     }
283. 
284.     return result;
285.   }
286. 
287.   private NamespaceBO transformNamespace2BO(Env env, NamespaceDTO namespace) {
288.     NamespaceBO namespaceBO = new NamespaceBO();
289.     namespaceBO.setBaseInfo(namespace);
290. 
291.     String appId = namespace.getAppId();
292.     String clusterName = namespace.getClusterName();
293.     String namespaceName = namespace.getNamespaceName();
294. 
295.     fillAppNamespaceProperties(namespaceBO);
296. 
297.     List<ItemBO> itemBOs = new LinkedList<>();
298.     namespaceBO.setItems(itemBOs);
299. 
300.     //latest Release
301.     ReleaseDTO latestRelease;
302.     Map<String, String> releaseItems = new HashMap<>();
303.     Map<String, ItemDTO> deletedItemDTOs = new HashMap<>();
304.     latestRelease = releaseService.loadLatestRelease(appId, env, clusterName, namespaceName);
305.     if (latestRelease != null) {
306.       releaseItems = GSON.fromJson(latestRelease.getConfigurations(), GsonType.CONFIG);
307.     }
308. 
309.     //not Release config items
310.     List<ItemDTO> items = itemService.findItems(appId, env, clusterName, namespaceName);
311.     additionalUserInfoEnrichService
312.         .enrichAdditionalUserInfo(items, BaseDtoUserInfoEnrichedAdapter::new);
313.     int modifiedItemCnt = 0;
314.     for (ItemDTO itemDTO : items) {
315. 
316.       ItemBO itemBO = transformItem2BO(itemDTO, releaseItems);
317. 
318.       if (itemBO.isModified()) {
319.         modifiedItemCnt++;
320.       }
321. 
322.       itemBOs.add(itemBO);
323.     }
324. 
325.     //deleted items
326.     itemService.findDeletedItems(appId, env, clusterName, namespaceName).forEach(item -> {
327.       deletedItemDTOs.put(item.getKey(),item);
328.     });
329. 
330.     List<ItemBO> deletedItems = parseDeletedItems(items, releaseItems, deletedItemDTOs);
331.     itemBOs.addAll(deletedItems);
332.     modifiedItemCnt += deletedItems.size();
333. 
334.     namespaceBO.setItemModifiedCnt(modifiedItemCnt);
335. 
336.     return namespaceBO;
337.   }
338. 
339.   private void fillAppNamespaceProperties(NamespaceBO namespace) {
340. 
341.     final NamespaceDTO namespaceDTO = namespace.getBaseInfo();
342.     final String appId = namespaceDTO.getAppId();
343.     final String clusterName = namespaceDTO.getClusterName();
344.     final String namespaceName = namespaceDTO.getNamespaceName();
345.     //先从当前appId下面找,包含私有的和公共的
346.     AppNamespace appNamespace =
347.         appNamespaceService
348.             .findByAppIdAndName(appId, namespaceName);
349.     //再从公共的app namespace里面找
350.     if (appNamespace == null) {
351.       appNamespace = appNamespaceService.findPublicAppNamespace(namespaceName);
352.     }
353. 
354.     final String format;
355.     final boolean isPublic;
356.     if (appNamespace == null) {
357.       //dirty data
358.       LOGGER.warn("Dirty data, cannot find appNamespace by namespaceName [{}], appId = {}, cluster = {}, set it format to {}, make public", namespaceName, appId, clusterName, ConfigFileFormat.Properties.getValue());
359.       format = ConfigFileFormat.Properties.getValue();
360.       isPublic = true; // set to true, because public namespace allowed to delete by user
361.     } else {
362.       format = appNamespace.getFormat();
363.       isPublic = appNamespace.isPublic();
364.       namespace.setParentAppId(appNamespace.getAppId());
365.       namespace.setComment(appNamespace.getComment());
366.     }
367.     namespace.setFormat(format);
368.     namespace.setPublic(isPublic);
369.   }
370. 
371.   private List<ItemBO> parseDeletedItems(List<ItemDTO> newItems, Map<String, String> releaseItems, Map<String, ItemDTO> deletedItemDTOs) {
372.     Map<String, ItemDTO> newItemMap = BeanUtils.mapByKey("key", newItems);
373. 
374.     List<ItemBO> deletedItems = new LinkedList<>();
375.     for (Map.Entry<String, String> entry : releaseItems.entrySet()) {
376.       String key = entry.getKey();
377.       if (newItemMap.get(key) == null) {
378.         ItemBO deletedItem = new ItemBO();
379. 
380.         deletedItem.setDeleted(true);
381.         ItemDTO deletedItemDto = deletedItemDTOs.computeIfAbsent(key, k -> new ItemDTO());
382.         deletedItemDto.setKey(key);
383.         String oldValue = entry.getValue();
384.         deletedItem.setItem(deletedItemDto);
385. 
386.         deletedItemDto.setValue(oldValue);
387.         deletedItem.setModified(true);
388.         deletedItem.setOldValue(oldValue);
389.         deletedItem.setNewValue("");
390.         deletedItems.add(deletedItem);
391.       }
392.     }
393.     return deletedItems;
394.   }
395. 
396.   private ItemBO transformItem2BO(ItemDTO itemDTO, Map<String, String> releaseItems) {
397.     String key = itemDTO.getKey();
398.     ItemBO itemBO = new ItemBO();
399.     itemBO.setItem(itemDTO);
400.     String newValue = itemDTO.getValue();
401.     String oldValue = releaseItems.get(key);
402.     //new item or modified
403.     if (!StringUtils.isEmpty(key) && (!newValue.equals(oldValue))) {
404.       itemBO.setModified(true);
405.       itemBO.setOldValue(oldValue == null ? "" : oldValue);
406.       itemBO.setNewValue(newValue);
407.     }
408.     return itemBO;
409.   }
410. 
411.   public void assignNamespaceRoleToOperator(String appId, String namespaceName, String operator) {
412.     //default assign modify、release namespace role to namespace creator
413. 
414.     rolePermissionService
415.         .assignRoleToUsers(
416.             RoleUtils.buildNamespaceRoleName(appId, namespaceName, RoleType.MODIFY_NAMESPACE),
417.             Sets.newHashSet(operator), operator);
418.     rolePermissionService
419.         .assignRoleToUsers(
420.             RoleUtils.buildNamespaceRoleName(appId, namespaceName, RoleType.RELEASE_NAMESPACE),
421.             Sets.newHashSet(operator), operator);
422.   }
423. }


File: docs/en/design/apollo-core-concept-namespace.md
Line number range: 1 - 205
Content:
1. ### 1. What is Namespace?
2. 
3. Namespace is a collection of configuration items, similar to the concept of a configuration file.
4. 
5. ### 2. What is an `application` Namespace?
6. 
7. When Apollo creates a project, it creates an `application` namespace by default. Spring Boot students know that Spring Boot projects have a default configuration file application.yml. here application.yml is equivalent to the `application` Namespace. For 90% of applications, the `application` namespace is sufficient for everyday configuration scenarios.
8. 
9. ####  The code for client to get the `application` Namespace is as follows.
10. 
11. ``` java
12.   Config config = ConfigService.getAppConfig();
13. ```
14. 
15. #### The code for the client to get a `non-application` Namespace is as follows.
16. 
17. ``` java
18.   Config config = ConfigService.getConfig(namespaceName);
19. ```
20. 
21. ### 3. What are the formats of Namespace?
22. 
23. Configuration files come in various formats such as properties, xml, yml, yaml, json, etc. Similarly Namespace also has these formats. In the Portal UI, you can see that the Namespace for `application` has a `properties` tag, indicating that `application` is in properties format.
24. 
25. >Note1: For the namespace in non-properties format, you need to call `ConfigService.getConfigFile(String namespace, ConfigFileFormat configFileFormat)` to get it when you use the client, if you use the [Http interface direct call](en/usage/other-language-client-user-guide), the corresponding namespace parameter needs to be passed in the namespace name plus the suffix name, such as datasources.json.
26. 
27. >Note 2: apollo-client version 1.3.0 has better support for yaml/yml, which is consistent with the properties format: `Config config = ConfigService.getConfig("application.yml");`, Spring's The Spring injection is also consistent with properties.
28. 
29. ### 4. Classification of Namespace access rights
30. 
31. There are two types of access permissions for Namespace.
32. 
33.   * private (private)
34.   * public (public)
35. 
36. The access rights here are relative to the Apollo client.
37. 
38. #### 4.1 Private Permissions
39. 
40. Namespace with private access can only be accessed by the application it belongs to. If an application tries to get the private namespace of another application, Apollo will report a `404 ` exception.
41. 
42. #### 4.2 Public Permissions
43. 
44. Namespace with public privileges can be fetched by any application.
45. 
46. ### 5. Types of Namespace
47. 
48. There are three types of Namespace.
49. 
50.   * private type
51.   * public type  
52.   * Associated types (inherited types)
53. 
54. #### 5.1 Private Types
55. 
56. Namespace of private type has private permission. For example, the  `application` Namespace mentioned above is a private type.
57. 
58. 
59. #### 5.2 Public Types
60. 
61. ##### 5.2.1 Meaning
62. 
63. Namespace of a public type has public privileges. A public type Namespace is equivalent to a configuration that is outside the application and identifies the public Namespace by its name, so the name of the public Namespace must be globally unique.
64. 
65. ##### 5.2.2 Usage Scenarios
66. 
67.   * Department-level shared configurations
68.   * Configurations shared at the group level
69.   * Configurations shared between several projects
70.   * Configuration for middleware clients
71. 
72. 
73. #### 5.3 Association Types
74. 
75. ##### 5.3.1 Meaning
76. 
77. An association type may also be called an inherited type, and the association type has private privileges. The Namespace of an association type inherits from the Namespace of a public type and is used to override certain configurations of the public Namespace. For example, the public Namespace has two configuration items 
78. 
79. ```
80. k1 = v1
81. k2 = v2
82. ```
83. 
84. Then application A has an associated type of Namespace associated with this public Namespace and overrides the configuration item k1 with a new value of v3. Then when application A actually runs, the configuration of the public Namespace is obtained as
85. 
86. ```
87. k1 = v3
88. k2 = v2
89. ```
90. 
91. ##### 5.3.2 Usage Scenarios
92. 
93. Give a real-world usage scenario. Assume that the configuration of the RPC framework (e.g., timeout) has the following requirements.
94. 
95.   * Provide a company-wide default configuration that can be dynamically adjusted
96.   * RPC client projects can customize certain configuration items and can be dynamically adjusted
97. 
98. 1. If you remove  `dynamically adjustable` from the above two requirements, the approach is simple. There is a configuration file in the rpc-client.jar package, and each time you modify the configuration file, you can resend a new version of the jar package. Similarly, the same is true for client-side projects.
99. 2. If only the client project is supported, the configuration can be dynamically adjusted. The client project can configure some configuration items on Apollo  `application` Namespace. When initializing the service, just read the configuration from Apollo. The disadvantage of this is that each project has to customize some keys, which is not uniform. 3.
100. 3. so how to support the above requirements perfectly? The answer is to use a combination of Apollo's public type Namespace and the associated type Namespace. The code in rpc-client.jar reads the configuration of the `rpc-client` Namespace. If you need to adjust the default configuration, just change the configuration of the public type `rpc-client` Namespace. If a client project wants to customize or dynamically modify some configuration items, simply associate `rpc-client` with Apollo's own project to create a Namespace of the associated type  `rpc-client`. Then you can modify the configuration items under the Namespace of the associated type `rpc-client`. One thing we need to point out here is that rpc-client.jar is running in the application container, so the configuration of the `rpc-client` Namespace that rpc-client gets is the namespace of the associated type of the application plus the namespace of the public type Namespace.
101. 
102. #### 5.4 Example
103. 
104. As shown in the following figure, there are three applications: Application A, Application B, and Application C.
105. 
106.  * Application A has two Namespace of private type: application and NS-Private, and one Namespace of associated type: NS-Public.
107.  * Application B has one Namespace of private type: application, and one Namespace of public type: NS-Public.
108.  * Application C has only one Namespace of type private: application
109. 
110. ![Namespace Example](https://cdn.jsdelivr.net/gh/apolloconfig/apollo@master/doc/images/namespace-model-example.png)
111. 
112. ##### 5.4.1 Application A gets the Apollo configuration
113. 
114. ```java
115.   //application 
116.   Config appConfig = ConfigService.getAppConfig();
117.   appConfig.getProperty("k1", null); // k1 = v11
118.   appConfig.getProperty("k2", null); // k2 = v21
119.   
120.   // NS-Private
121.   Config privateConfig = ConfigService.getConfig("NS-Private");
122.   privateConfig.getProperty("k1", null); // k1 = v3
123.   privateConfig.getProperty("k3", null); // k3 = v4
124.   
125.   // NS-Public, overrides the case of public type configuration, k4 is overridden
126.   Config publicConfig = ConfigService.getConfig("NS-Public");
127.   publicConfig.getProperty("k4", null); // k4 = v6 cover
128.   publicConfig.getProperty("k6", null); // k6 = v6
129.   publicConfig.getProperty("k7", null); // k7 = v7
130. ```
131. 
132. ##### 5.4.2 Application B to get Apollo configuration
133. 
134. ``` java
135.   //application
136.   Config appConfig = ConfigService.getAppConfig();
137.   appConfig.getProperty("k1", null); // k1 = v12
138.   appConfig.getProperty("k2", null); // k2 = null
139.   appConfig.getProperty("k3", null); // k3 = v32
140.   
141.   // NS-Private, since there is no NS-Private Namespace so we get the default value
142.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");
143.   privateConfig.getProperty("k1", "default value"); 
144.   
145.   //NS-Public
146.   Config publicConfig = ConfigService.getConfig("NS-Public");
147.   publicConfig.getProperty("k4", null); // k4 = v5
148.   publicConfig.getProperty("k6", null); // k6 = v6
149.   publicConfig.getProperty("k7", null); // k7 = v7
150. ```
151. 
152. ##### 5.4.3 Applying C to get Apollo configuration
153. 
154. ``` java
155.   //application
156.   Config appConfig = ConfigService.getAppConfig();
157.   appConfig.getProperty("k1", null); // k1 = v12
158.   appConfig.getProperty("k2", null); // k2 = null
159.   appConfig.getProperty("k3", null); // k3 = v33
160.   
161.   // NS-Private, since there is no NS-Private Namespace so we get the default value
162.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");
163.   privateConfig.getProperty("k1", "default value"); 
164.   
165.   //NS-Public, the public type Namespace, which any project can get
166.   Config publicConfig = ConfigServi
167. 
168. ```
169. 
170. ##### 5.4.4 ChangeListener
171. 
172. As you can see in the above code example, the Client Namespace is mapped to a Config object. Listeners for namespace configuration changes are registered on the Config object.
173. 
174. So the Namespace code that monitors the application in application A is as follows:
175. 
176. ````java
177. Config appConfig = ConfigService.getAppConfig();
178. appConfig.addChangeListener(new ConfigChangeListener() {
179.   public void onChange(ConfigChangeEvent changeEvent) {
180.     //do something
181.   }
182. })
183. ````
184. 
185. The Namespace code for monitoring NS-Private in application A is as follows:
186. 
187. ````java
188. Config privateConfig = ConfigService.getConfig("NS-Private");
189. privateConfig.addChangeListener(new ConfigChangeListener() {
190.   public void onChange(ConfigChangeEvent changeEvent) {
191.     //do something
192.   }
193. })
194. ````
195. 
196. The Namespace code for monitoring NS-Public in application A, application B, and application C is as follows:
197. 
198. ````java
199. Config publicConfig = ConfigService.getConfig("NS-Public");
200. publicConfig.addChangeListener(new ConfigChangeListener() {
201.   public void onChange(ConfigChangeEvent changeEvent) {
202.     //do something
203.   }
204. })
205. ````

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 11:20:29,636 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='Entity definition for namespaces in apollo-biz. Provides the fields appId, clusterName, namespaceName used throughout creation and querying, essential for understanding repository and service methods.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java', start_line=28, end_line=75), ContextOutput(reasoning='Repository methods for querying and deleting Namespace entities in apollo-biz. Directly used by NamespaceService for find, count, and save logic relevant to namespace creation and query handlers.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java', start_line=29, end_line=46), ContextOutput(reasoning='Repository for AppNamespace in apollo-biz, includes find and delete operations. Used by AppNamespaceService for creation/uniqueness checks and by services during namespace propagation.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java', start_line=29, end_line=51), ContextOutput(reasoning='AppNamespaceService: uniqueness check and public namespace lookup used during namespace creation and association. Critical for naming rules and preventing duplicates.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', start_line=63, end_line=72), ContextOutput(reasoning='AppNamespaceService creation of default app namespace, including format and default naming. Part of namespace creation handlers.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', start_line=104, end_line=120), ContextOutput(reasoning='AppNamespaceService creation of app namespace with subsequent creation of Namespace records across clusters. Shows core creation flow.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', start_line=122, end_line=138), ContextOutput(reasoning='AppNamespaceService helper to create Namespace entities in all clusters for a new app namespace. Implements the propagation logic.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', start_line=151, end_line=170), ContextOutput(reasoning='NamespaceService in apollo-biz: findOne by composite key (appId, clusterName, namespaceName). Core query method.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=104, end_line=107), ContextOutput(reasoning='NamespaceService in apollo-biz: find by item key, used for querying namespaces via items.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=112, end_line=122), ContextOutput(reasoning='NamespaceService in apollo-biz: list namespaces for public app namespace with pagination. Query handler for associated namespaces.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=175, end_line=186), ContextOutput(reasoning='NamespaceService in apollo-biz: find all namespaces of a cluster and find by appId/namespaceName. Query handlers.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=215, end_line=225), ContextOutput(reasoning='NamespaceService in apollo-biz: child/parent helpers omitted; show uniqueness check for namespace names and save method which enforces uniqueness (creation handler).', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=283, end_line=359), ContextOutput(reasoning='NamespaceService in apollo-biz: instanceOfAppNamespaces creates namespaces for a cluster based on app namespaces (creation flow).', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=374, end_line=389), ContextOutput(reasoning='AppNamespace entity-level validation using InputValidator pattern. Enforces naming rules at entity validation level, crucial for understanding allowed patterns and suffix bans.', relative_path='apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java', start_line=38, end_line=45), ContextOutput(reasoning='InputValidator defines the namespace name regex and error messages, including not allowed to end with .json, .yml, .yaml, .xml, .properties, and allowed characters. Central to naming rule verification.', relative_path='apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java', start_line=27, end_line=46), ContextOutput(reasoning='Unit tests validating InputValidator rules for namespace names, including disallowing .json/.yml/.yaml/.xml/.properties suffixes and invalid characters. Supports naming expectations.', relative_path='apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java', start_line=35, end_line=45), ContextOutput(reasoning='OpenAPI NamespaceController: POST creation of app namespaces validates naming with InputValidator and format with ConfigFileFormat, then delegates to service. Direct REST creation handler.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java', start_line=52, end_line=81), ContextOutput(reasoning='OpenAPI NamespaceController: GET endpoints to find namespaces by cluster and to load a single namespace. Direct REST query handlers.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java', start_line=83, end_line=94), ContextOutput(reasoning='Portal NamespaceController: GET list namespaces by cluster with permission-based hiding. Query handler for namespaces.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=105, end_line=118), ContextOutput(reasoning='Portal NamespaceController: GET single namespace by name with permission-based hiding. Query handler.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=120, end_line=131), ContextOutput(reasoning='Portal NamespaceController: POST create namespace instances in env/cluster. Creation handler for namespaces.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=142, end_line=170), ContextOutput(reasoning='Portal NamespaceController: DELETE linked namespace endpoint. REST operation for namespaces.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=172, end_line=180), ContextOutput(reasoning='Portal NamespaceController: GET linked namespace usage counts. Query of namespace usage.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=182, end_line=187), ContextOutput(reasoning='Portal NamespaceController: DELETE app namespace endpoint. REST operation for app namespace removal.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=194, end_line=203), ContextOutput(reasoning='Portal NamespaceController: GET app namespace details with BadRequestException if not exists. Query handler for app namespace.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=205, end_line=215), ContextOutput(reasoning='Portal NamespaceController: POST create AppNamespace with validation via InputValidator and format. Key creation handler and naming enforcement.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=217, end_line=237), ContextOutput(reasoning='Portal NamespaceController: GET all namespaces under a public AppNamespace with pagination. Query handler related to associated public namespaces.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=251, end_line=259), ContextOutput(reasoning='Portal AppNamespaceRepository: methods to find, list, and delete app namespaces used by portal services and controllers. Essential repository for creation/query flows.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java', start_line=25, end_line=44), ContextOutput(reasoning='Portal AppNamespaceService: uniqueness check and main createAppNamespaceInLocal logic, including prefix/suffix building, format validation, and global/private uniqueness checks. Central to naming rules (e.g., dot handling, suffix restrictions).', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', start_line=115, end_line=171), ContextOutput(reasoning='Portal AppNamespaceService: persisting the app namespace and initializing roles. Completes creation workflow.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', start_line=172, end_line=178), ContextOutput(reasoning='Portal AppNamespaceService: global uniqueness checks for public app namespaces against existing private ones, error messaging. Naming conflict rules.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', start_line=204, end_line=222), ContextOutput(reasoning='Portal AppNamespaceService: uniqueness check against existing public app namespace. Naming conflict rule enforcement.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', start_line=224, end_line=229), ContextOutput(reasoning='Portal NamespaceService: createNamespace delegates to AdminService, sets operator, and logs event. Creation handler for actual Namespace instances.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', start_line=117, end_line=131), ContextOutput(reasoning='Portal NamespaceService: delete and load base info handlers interacting with Admin Service; essential for namespace operations.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', start_line=170, end_line=184), ContextOutput(reasoning='Portal NamespaceService: find namespaces by cluster and list/get public app namespace all namespaces. Query handlers.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', start_line=231, end_line=246), ContextOutput(reasoning='Documentation explaining Apollo core concept of Namespace. Provides background and expected behavior for namespace types, formats, and usage, necessary for understanding context.', relative_path='docs/en/design/apollo-core-concept-namespace.md', start_line=1, end_line=205)]
2025-11-12 11:20:29,649 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 36 contexts to memory for query: Please provide the full source (with line numbers) of the namespace creation and query handlers in apollo-portal and apollo-biz, including NamespaceController, NamespaceService, related validators/entities/repositories, and the docs/en/design/apollo-core-concept-namespace.md.
2025-11-12 11:20:30,614 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 11:20:30,616 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 36 new contexts to 0 existing contexts
2025-11-12 11:20:30,618 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 36 total contexts (removed 0 duplicates)
2025-11-12 11:20:30,619 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full source (with line numbers) of the namespace creation and query handlers in apollo-portal and apollo-biz, including NamespaceController, NamespaceService, related validators/entities/repositories, and the docs/en/design/apollo-core-concept-namespace.md.
Extra Requirements: If exact file names are unclear, please share all classes under apollo-portal/src/main/java and apollo-biz/src/main/java whose names contain 'Namespace' and any REST endpoints for namespace operations, plus any tests referencing namespace naming.
Purpose: This will allow verifying expected naming rules and whether a single dot should be rejected or supported, identifying the cause of the 500 and correctly classifying the issue.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java
Line number range: 28 - 75
Content:
28. @Entity
29. @Table(name = "Namespace")
30. @SQLDelete(sql = "Update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")
31. @Where(clause = "isDeleted = 0")
32. public class Namespace extends BaseEntity {
33. 
34.   @Column(name = "appId", nullable = false)
35.   private String appId;
36. 
37.   @Column(name = "ClusterName", nullable = false)
38.   private String clusterName;
39. 
40.   @Column(name = "NamespaceName", nullable = false)
41.   private String namespaceName;
42. 
43.   public Namespace(){
44. 
45.   }
46. 
47.   public Namespace(String appId, String clusterName, String namespaceName) {
48.     this.appId = appId;
49.     this.clusterName = clusterName;
50.     this.namespaceName = namespaceName;
51.   }
52. 
53.   public String getAppId() {
54.     return appId;
55.   }
56. 
57.   public String getClusterName() {
58.     return clusterName;
59.   }
60. 
61.   public String getNamespaceName() {
62.     return namespaceName;
63.   }
64. 
65.   public void setAppId(String appId) {
66.     this.appId = appId;
67.   }
68. 
69.   public void setClusterName(String clusterName) {
70.     this.clusterName = clusterName;
71.   }
72. 
73.   public void setNamespaceName(String namespaceName) {
74.     this.namespaceName = namespaceName;
75.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java
Line number range: 29 - 51
Content:
29. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long>{
30. 
31.   AppNamespace findByAppIdAndName(String appId, String namespaceName);
32. 
33.   List<AppNamespace> findByAppIdAndNameIn(String appId, Set<String> namespaceNames);
34. 
35.   AppNamespace findByNameAndIsPublicTrue(String namespaceName);
36. 
37.   List<AppNamespace> findByNameInAndIsPublicTrue(Set<String> namespaceNames);
38. 
39.   List<AppNamespace> findByAppIdAndIsPublic(String appId, boolean isPublic);
40. 
41.   List<AppNamespace> findByAppIdOrderByIdAsc(String appId);
42. 
43.   List<AppNamespace> findFirst500ByIdGreaterThanOrderByIdAsc(long id);
44. 
45.   @Modifying
46.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?2 WHERE AppId=?1 and IsDeleted = 0")
47.   int batchDeleteByAppId(String appId, String operator);
48. 
49.   @Modifying
50.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")
51.   int delete(String appId, String namespaceName, String operator);


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java
Line number range: 29 - 46
Content:
29. public interface NamespaceRepository extends PagingAndSortingRepository<Namespace, Long> {
30. 
31.   List<Namespace> findByAppIdAndClusterNameOrderByIdAsc(String appId, String clusterName);
32. 
33.   Namespace findByAppIdAndClusterNameAndNamespaceName(String appId, String clusterName, String namespaceName);
34. 
35.   @Modifying
36.   @Query("update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 where appId=?1 and clusterName=?2 and IsDeleted = 0")
37.   int batchDelete(String appId, String clusterName, String operator);
38. 
39.   List<Namespace> findByAppIdAndNamespaceNameOrderByIdAsc(String appId, String namespaceName);
40. 
41.   List<Namespace> findByNamespaceName(String namespaceName, Pageable page);
42. 
43.   List<Namespace> findByIdIn(Set<Long> namespaceIds);
44. 
45.   int countByNamespaceNameAndAppIdNot(String namespaceName, String appId);
46. 


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 63 - 72
Content:
63.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {
64.     Objects.requireNonNull(appId, "AppId must not be null");
65.     Objects.requireNonNull(namespaceName, "Namespace must not be null");
66.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));
67.   }
68. 
69.   public AppNamespace findPublicNamespaceByName(String namespaceName) {
70.     Preconditions.checkArgument(namespaceName != null, "Namespace must not be null");
71.     return appNamespaceRepository.findByNameAndIsPublicTrue(namespaceName);
72.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 104 - 120
Content:
104.   @Transactional
105.   public void createDefaultAppNamespace(String appId, String createBy) {
106.     if (!isAppNamespaceNameUnique(appId, ConfigConsts.NAMESPACE_APPLICATION)) {
107.       throw new ServiceException("appnamespace not unique");
108.     }
109.     AppNamespace appNs = new AppNamespace();
110.     appNs.setAppId(appId);
111.     appNs.setName(ConfigConsts.NAMESPACE_APPLICATION);
112.     appNs.setComment("default app namespace");
113.     appNs.setFormat(ConfigFileFormat.Properties.getValue());
114.     appNs.setDataChangeCreatedBy(createBy);
115.     appNs.setDataChangeLastModifiedBy(createBy);
116.     appNamespaceRepository.save(appNs);
117. 
118.     auditService.audit(AppNamespace.class.getSimpleName(), appNs.getId(), Audit.OP.INSERT,
119.                        createBy);
120.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 122 - 138
Content:
122.   @Transactional
123.   public AppNamespace createAppNamespace(AppNamespace appNamespace) {
124.     String createBy = appNamespace.getDataChangeCreatedBy();
125.     if (!isAppNamespaceNameUnique(appNamespace.getAppId(), appNamespace.getName())) {
126.       throw new ServiceException("appnamespace not unique");
127.     }
128.     appNamespace.setId(0);//protection
129.     appNamespace.setDataChangeCreatedBy(createBy);
130.     appNamespace.setDataChangeLastModifiedBy(createBy);
131. 
132.     appNamespace = appNamespaceRepository.save(appNamespace);
133. 
134.     createNamespaceForAppNamespaceInAllCluster(appNamespace.getAppId(), appNamespace.getName(), createBy);
135. 
136.     auditService.audit(AppNamespace.class.getSimpleName(), appNamespace.getId(), Audit.OP.INSERT, createBy);
137.     return appNamespace;
138.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 151 - 170
Content:
151.   public void createNamespaceForAppNamespaceInAllCluster(String appId, String namespaceName, String createBy) {
152.     List<Cluster> clusters = clusterService.findParentClusters(appId);
153. 
154.     for (Cluster cluster : clusters) {
155. 
156.       // in case there is some dirty data, e.g. public namespace deleted in other app and now created in this app
157.       if (!namespaceService.isNamespaceUnique(appId, cluster.getName(), namespaceName)) {
158.         continue;
159.       }
160. 
161.       Namespace namespace = new Namespace();
162.       namespace.setClusterName(cluster.getName());
163.       namespace.setAppId(appId);
164.       namespace.setNamespaceName(namespaceName);
165.       namespace.setDataChangeCreatedBy(createBy);
166.       namespace.setDataChangeLastModifiedBy(createBy);
167. 
168.       namespaceService.save(namespace);
169.     }
170.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 104 - 107
Content:
104.   public Namespace findOne(String appId, String clusterName, String namespaceName) {
105.     return namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, clusterName,
106.                                                                          namespaceName);
107.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 112 - 122
Content:
112.   public Page<Namespace> findByItem(String itemKey, Pageable pageable) {
113.     Page<Item> items = itemService.findItemsByKey(itemKey, pageable);
114. 
115.     if (!items.hasContent()) {
116.       return Page.empty();
117.     }
118. 
119.     Set<Long> namespaceIds = BeanUtils.toPropertySet("namespaceId", items.getContent());
120. 
121.     return new PageImpl<>(namespaceRepository.findByIdIn(namespaceIds));
122.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 175 - 186
Content:
175.   public List<Namespace> findPublicAppNamespaceAllNamespaces(String namespaceName, Pageable page) {
176.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);
177. 
178.     if (publicAppNamespace == null) {
179.       throw new BadRequestException(
180.           String.format("Public appNamespace not exists. NamespaceName = %s", namespaceName));
181.     }
182. 
183.     List<Namespace> namespaces = namespaceRepository.findByNamespaceName(namespaceName, page);
184. 
185.     return filterChildNamespace(namespaces);
186.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 215 - 225
Content:
215.   public List<Namespace> findNamespaces(String appId, String clusterName) {
216.     List<Namespace> namespaces = namespaceRepository.findByAppIdAndClusterNameOrderByIdAsc(appId, clusterName);
217.     if (namespaces == null) {
218.       return Collections.emptyList();
219.     }
220.     return namespaces;
221.   }
222. 
223.   public List<Namespace> findByAppIdAndNamespaceName(String appId, String namespaceName) {
224.     return namespaceRepository.findByAppIdAndNamespaceNameOrderByIdAsc(appId, namespaceName);
225.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 283 - 359
Content:
283.   public boolean isNamespaceUnique(String appId, String cluster, String namespace) {
284.     Objects.requireNonNull(appId, "AppId must not be null");
285.     Objects.requireNonNull(cluster, "Cluster must not be null");
286.     Objects.requireNonNull(namespace, "Namespace must not be null");
287.     return Objects.isNull(
288.         namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, cluster, namespace));
289.   }
290. 
291.   @Transactional
292.   public void deleteByAppIdAndClusterName(String appId, String clusterName, String operator) {
293. 
294.     List<Namespace> toDeleteNamespaces = findNamespaces(appId, clusterName);
295. 
296.     for (Namespace namespace : toDeleteNamespaces) {
297. 
298.       deleteNamespace(namespace, operator);
299. 
300.     }
301.   }
302. 
303.   @Transactional
304.   public Namespace deleteNamespace(Namespace namespace, String operator) {
305.     String appId = namespace.getAppId();
306.     String clusterName = namespace.getClusterName();
307.     String namespaceName = namespace.getNamespaceName();
308. 
309.     itemService.batchDelete(namespace.getId(), operator);
310.     commitService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);
311. 
312.     // Child namespace releases should retain as long as the parent namespace exists, because parent namespaces' release
313.     // histories need them
314.     if (!isChildNamespace(namespace)) {
315.       releaseService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);
316.     }
317. 
318.     //delete child namespace
319.     Namespace childNamespace = findChildNamespace(namespace);
320.     if (childNamespace != null) {
321.       namespaceBranchService.deleteBranch(appId, clusterName, namespaceName,
322.                                           childNamespace.getClusterName(), NamespaceBranchStatus.DELETED, operator);
323.       //delete child namespace's releases. Notice: delete child namespace will not delete child namespace's releases
324.       releaseService.batchDelete(appId, childNamespace.getClusterName(), namespaceName, operator);
325.     }
326. 
327.     releaseHistoryService.batchDelete(appId, clusterName, namespaceName, operator);
328. 
329.     instanceService.batchDeleteInstanceConfig(appId, clusterName, namespaceName);
330. 
331.     namespaceLockService.unlock(namespace.getId());
332. 
333.     namespace.setDeleted(true);
334.     namespace.setDataChangeLastModifiedBy(operator);
335. 
336.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.DELETE, operator);
337. 
338.     Namespace deleted = namespaceRepository.save(namespace);
339. 
340.     //Publish release message to do some clean up in config service, such as updating the cache
341.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),
342.         Topics.APOLLO_RELEASE_TOPIC);
343. 
344.     return deleted;
345.   }
346. 
347.   @Transactional
348.   public Namespace save(Namespace entity) {
349.     if (!isNamespaceUnique(entity.getAppId(), entity.getClusterName(), entity.getNamespaceName())) {
350.       throw new ServiceException("namespace not unique");
351.     }
352.     entity.setId(0);//protection
353.     Namespace namespace = namespaceRepository.save(entity);
354. 
355.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.INSERT,
356.                        namespace.getDataChangeCreatedBy());
357. 
358.     return namespace;
359.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 374 - 389
Content:
374.   @Transactional
375.   public void instanceOfAppNamespaces(String appId, String clusterName, String createBy) {
376. 
377.     List<AppNamespace> appNamespaces = appNamespaceService.findByAppId(appId);
378. 
379.     for (AppNamespace appNamespace : appNamespaces) {
380.       Namespace ns = new Namespace();
381.       ns.setAppId(appId);
382.       ns.setClusterName(clusterName);
383.       ns.setNamespaceName(appNamespace.getName());
384.       ns.setDataChangeCreatedBy(createBy);
385.       ns.setDataChangeLastModifiedBy(createBy);
386.       namespaceRepository.save(ns);
387.       auditService.audit(Namespace.class.getSimpleName(), ns.getId(), Audit.OP.INSERT, createBy);
388.     }
389. 


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java
Line number range: 38 - 45
Content:
38.   @NotBlank(message = "AppNamespace Name cannot be blank")
39.   @Pattern(
40.       regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR,
41.       message = "Invalid Namespace format: " + InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE
42.   )
43.   @Column(name = "Name", nullable = false)
44.   private String name;
45. 


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
Line number range: 27 - 46
Content:
27.   public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbol - _ . are allowed";
28.   public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE = "not allowed to end with .json, .yml, .yaml, .xml, .properties";
29.   public static final String CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+";
30.   private static final String APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$";
31.   private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);
32.   private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);
33. 
34.   public static boolean isValidClusterNamespace(String name) {
35.     if (StringUtils.isEmpty(name)){
36.       return false;
37.     }
38.     return CLUSTER_NAMESPACE_PATTERN.matcher(name).matches();
39.   }
40. 
41.   public static boolean isValidAppNamespace(String name){
42.     if (StringUtils.isEmpty(name)){
43.       return false;
44.     }
45.     return APP_NAMESPACE_PATTERN.matcher(name).matches();
46.   }


File: apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java
Line number range: 35 - 45
Content:
35.   public void testValidAppNamespaceName() throws Exception {
36.     checkAppNamespaceName("some.cluster-_name.123", true);
37.     checkAppNamespaceName("some.&.name", false);
38.     checkAppNamespaceName("", false);
39.     checkAppNamespaceName(null, false);
40.     checkAppNamespaceName("some.name.json", false);
41.     checkAppNamespaceName("some.name.yml", false);
42.     checkAppNamespaceName("some.name.yaml", false);
43.     checkAppNamespaceName("some.name.xml", false);
44.     checkAppNamespaceName("some.name.properties", false);
45.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java
Line number range: 52 - 81
Content:
52.   @PreAuthorize(value = "@consumerPermissionValidator.hasCreateNamespacePermission(#request, #appId)")
53.   @PostMapping(value = "/openapi/v1/apps/{appId}/appnamespaces")
54.   public OpenAppNamespaceDTO createNamespace(@PathVariable String appId,
55.                                              @RequestBody OpenAppNamespaceDTO appNamespaceDTO,
56.                                              HttpServletRequest request) {
57. 
58.     if (!Objects.equals(appId, appNamespaceDTO.getAppId())) {
59.       throw new BadRequestException(String.format("AppId not equal. AppId in path = %s, AppId in payload = %s", appId,
60.                                                   appNamespaceDTO.getAppId()));
61.     }
62.     RequestPrecondition.checkArgumentsNotEmpty(appNamespaceDTO.getAppId(), appNamespaceDTO.getName(),
63.                                                appNamespaceDTO.getFormat(), appNamespaceDTO.getDataChangeCreatedBy());
64. 
65.     if (!InputValidator.isValidAppNamespace(appNamespaceDTO.getName())) {
66.       throw new BadRequestException(String.format("Invalid Namespace format: %s",
67.                                                   InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & "
68.                                                   + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
69.     }
70. 
71.     if (!ConfigFileFormat.isValidFormat(appNamespaceDTO.getFormat())) {
72.       throw new BadRequestException(String.format("Invalid namespace format. format = %s", appNamespaceDTO.getFormat()));
73.     }
74. 
75.     String operator = appNamespaceDTO.getDataChangeCreatedBy();
76.     if (userService.findByUserId(operator) == null) {
77.       throw new BadRequestException(String.format("Illegal user. user = %s", operator));
78.     }
79. 
80.     return this.namespaceOpenApiService.createAppNamespace(appNamespaceDTO);
81.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java
Line number range: 83 - 94
Content:
83.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces")
84.   public List<OpenNamespaceDTO> findNamespaces(@PathVariable String appId, @PathVariable String env,
85.                                                @PathVariable String clusterName) {
86.     return this.namespaceOpenApiService.getNamespaces(appId, env, clusterName);
87.   }
88. 
89.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
90.   public OpenNamespaceDTO loadNamespace(@PathVariable String appId, @PathVariable String env,
91.                                         @PathVariable String clusterName, @PathVariable String
92.                                             namespaceName) {
93.     return this.namespaceOpenApiService.getNamespace(appId, env, clusterName, namespaceName);
94.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 105 - 118
Content:
105.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces")
106.   public List<NamespaceBO> findNamespaces(@PathVariable String appId, @PathVariable String env,
107.                                           @PathVariable String clusterName) {
108. 
109.     List<NamespaceBO> namespaceBOs = namespaceService.findNamespaceBOs(appId, Env.valueOf(env), clusterName);
110. 
111.     for (NamespaceBO namespaceBO : namespaceBOs) {
112.       if (permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceBO.getBaseInfo().getNamespaceName())) {
113.         namespaceBO.hideItems();
114.       }
115.     }
116. 
117.     return namespaceBOs;
118.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 120 - 131
Content:
120.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
121.   public NamespaceBO findNamespace(@PathVariable String appId, @PathVariable String env,
122.                                    @PathVariable String clusterName, @PathVariable String namespaceName) {
123. 
124.     NamespaceBO namespaceBO = namespaceService.loadNamespaceBO(appId, Env.valueOf(env), clusterName, namespaceName);
125. 
126.     if (namespaceBO != null && permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceName)) {
127.       namespaceBO.hideItems();
128.     }
129. 
130.     return namespaceBO;
131.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 142 - 170
Content:
142.   @PreAuthorize(value = "@permissionValidator.hasCreateNamespacePermission(#appId)")
143.   @PostMapping("/apps/{appId}/namespaces")
144.   public ResponseEntity<Void> createNamespace(@PathVariable String appId,
145.                                               @RequestBody List<NamespaceCreationModel> models) {
146. 
147.     checkModel(!CollectionUtils.isEmpty(models));
148.     String operator = userInfoHolder.getUser().getUserId();
149. 
150.     for (NamespaceCreationModel model : models) {
151.       String namespaceName = model.getNamespace().getNamespaceName();
152.       roleInitializationService.initNamespaceRoles(appId, namespaceName, operator);
153.       roleInitializationService.initNamespaceEnvRoles(appId, namespaceName, operator);
154.       NamespaceDTO namespace = model.getNamespace();
155.       RequestPrecondition.checkArgumentsNotEmpty(model.getEnv(), namespace.getAppId(),
156.                                                  namespace.getClusterName(), namespace.getNamespaceName());
157. 
158.       try {
159.         namespaceService.createNamespace(Env.valueOf(model.getEnv()), namespace);
160.       } catch (Exception e) {
161.         logger.error("create namespace fail.", e);
162.         Tracer.logError(
163.                 String.format("create namespace fail. (env=%s namespace=%s)", model.getEnv(),
164.                         namespace.getNamespaceName()), e);
165.       }
166.       namespaceService.assignNamespaceRoleToOperator(appId, namespaceName,userInfoHolder.getUser().getUserId());
167.     }
168. 
169.     return ResponseEntity.ok().build();
170.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 172 - 180
Content:
172.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
173.   @DeleteMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName:.+}")
174.   public ResponseEntity<Void> deleteLinkedNamespace(@PathVariable String appId, @PathVariable String env,
175.       @PathVariable String clusterName, @PathVariable String namespaceName) {
176. 
177.     namespaceService.deleteNamespace(appId, Env.valueOf(env), clusterName, namespaceName);
178. 
179.     return ResponseEntity.ok().build();
180.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 182 - 187
Content:
182.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName}/usage")
183.   public List<NamespaceUsage> findLinkedNamespaceUsage(@PathVariable String appId, @PathVariable String env,
184.       @PathVariable String clusterName, @PathVariable String namespaceName) {
185.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(appId, namespaceName, Env.valueOf(env), clusterName);
186.     return Lists.newArrayList(usage);
187.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 194 - 203
Content:
194.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
195.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
196.   public ResponseEntity<Void> deleteAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
197. 
198.     AppNamespace appNamespace = appNamespaceService.deleteAppNamespace(appId, namespaceName);
199. 
200.     publisher.publishEvent(new AppNamespaceDeletionEvent(appNamespace));
201. 
202.     return ResponseEntity.ok().build();
203.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 205 - 215
Content:
205.   @GetMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
206.   public AppNamespaceDTO findAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
207.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);
208. 
209.     if (appNamespace == null) {
210.       throw new BadRequestException(
211.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));
212.     }
213. 
214.     return BeanUtils.transform(AppNamespaceDTO.class, appNamespace);
215.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 217 - 237
Content:
217.   @PreAuthorize(value = "@permissionValidator.hasCreateAppNamespacePermission(#appId, #appNamespace)")
218.   @PostMapping("/apps/{appId}/appnamespaces")
219.   public AppNamespace createAppNamespace(@PathVariable String appId,
220.       @RequestParam(defaultValue = "true") boolean appendNamespacePrefix,
221.       @Valid @RequestBody AppNamespace appNamespace) {
222.     if (!InputValidator.isValidAppNamespace(appNamespace.getName())) {
223.       throw new BadRequestException(String.format("Invalid Namespace format: %s",
224.           InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
225.     }
226. 
227.     AppNamespace createdAppNamespace = appNamespaceService.createAppNamespaceInLocal(appNamespace, appendNamespacePrefix);
228. 
229.     if (portalConfig.canAppAdminCreatePrivateNamespace() || createdAppNamespace.isPublic()) {
230.       namespaceService.assignNamespaceRoleToOperator(appId, appNamespace.getName(),
231.           userInfoHolder.getUser().getUserId());
232.     }
233. 
234.     publisher.publishEvent(new AppNamespaceCreationEvent(createdAppNamespace));
235. 
236.     return createdAppNamespace;
237.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 251 - 259
Content:
251.   @GetMapping("/envs/{env}/appnamespaces/{publicNamespaceName}/namespaces")
252.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(@PathVariable String env,
253.                                                                @PathVariable String publicNamespaceName,
254.                                                                @RequestParam(name = "page", defaultValue = "0") int page,
255.                                                                @RequestParam(name = "size", defaultValue = "10") int size) {
256. 
257.     return namespaceService.getPublicAppNamespaceAllNamespaces(Env.valueOf(env), publicNamespaceName, page, size);
258. 
259.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java
Line number range: 25 - 44
Content:
25. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long> {
26. 
27.   AppNamespace findByAppIdAndName(String appId, String namespaceName);
28. 
29.   AppNamespace findByName(String namespaceName);
30. 
31.   List<AppNamespace> findByNameAndIsPublic(String namespaceName, boolean isPublic);
32. 
33.   List<AppNamespace> findByIsPublicTrue();
34. 
35.   List<AppNamespace> findByAppId(String appId);
36. 
37.   @Modifying
38.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy=?2 WHERE AppId=?1 and IsDeleted = 0")
39.   int batchDeleteByAppId(String appId, String operator);
40. 
41.   @Modifying
42.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")
43.   int delete(String appId, String namespaceName, String operator);
44. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 115 - 171
Content:
115.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {
116.     Objects.requireNonNull(appId, "AppId must not be null");
117.     Objects.requireNonNull(namespaceName, "Namespace must not be null");
118.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));
119.   }
120. 
121.   @Transactional
122.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace) {
123.     return createAppNamespaceInLocal(appNamespace, true);
124.   }
125. 
126.   @Transactional
127.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace, boolean appendNamespacePrefix) {
128.     String appId = appNamespace.getAppId();
129. 
130.     //add app org id as prefix
131.     App app = appService.load(appId);
132.     if (app == null) {
133.       throw new BadRequestException("App not exist. AppId = " + appId);
134.     }
135. 
136.     StringBuilder appNamespaceName = new StringBuilder();
137.     //add prefix postfix
138.     appNamespaceName
139.         .append(appNamespace.isPublic() && appendNamespacePrefix ? app.getOrgId() + "." : "")
140.         .append(appNamespace.getName())
141.         .append(appNamespace.formatAsEnum() == ConfigFileFormat.Properties ? "" : "." + appNamespace.getFormat());
142.     appNamespace.setName(appNamespaceName.toString());
143. 
144.     if (appNamespace.getComment() == null) {
145.       appNamespace.setComment("");
146.     }
147. 
148.     if (!ConfigFileFormat.isValidFormat(appNamespace.getFormat())) {
149.      throw new BadRequestException("Invalid namespace format. format must be properties、json、yaml、yml、xml");
150.     }
151. 
152.     String operator = appNamespace.getDataChangeCreatedBy();
153.     if (StringUtils.isEmpty(operator)) {
154.       operator = userInfoHolder.getUser().getUserId();
155.       appNamespace.setDataChangeCreatedBy(operator);
156.     }
157. 
158.     appNamespace.setDataChangeLastModifiedBy(operator);
159. 
160.     // globally uniqueness check for public app namespace
161.     if (appNamespace.isPublic()) {
162.       checkAppNamespaceGlobalUniqueness(appNamespace);
163.     } else {
164.       // check private app namespace
165.       if (appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName()) != null) {
166.         throw new BadRequestException("Private AppNamespace " + appNamespace.getName() + " already exists!");
167.       }
168.       // should not have the same with public app namespace
169.       checkPublicAppNamespaceGlobalUniqueness(appNamespace);
170.     }
171. 


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 172 - 178
Content:
172.     AppNamespace createdAppNamespace = appNamespaceRepository.save(appNamespace);
173. 
174.     roleInitializationService.initNamespaceRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
175.     roleInitializationService.initNamespaceEnvRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
176. 
177.     return createdAppNamespace;
178.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 204 - 222
Content:
204.   private void checkAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {
205.     checkPublicAppNamespaceGlobalUniqueness(appNamespace);
206. 
207.     List<AppNamespace> privateAppNamespaces = findAllPrivateAppNamespaces(appNamespace.getName());
208. 
209.     if (!CollectionUtils.isEmpty(privateAppNamespaces)) {
210.       Set<String> appIds = Sets.newHashSet();
211.       for (AppNamespace ans : privateAppNamespaces) {
212.         appIds.add(ans.getAppId());
213.         if (appIds.size() == PRIVATE_APP_NAMESPACE_NOTIFICATION_COUNT) {
214.           break;
215.         }
216.       }
217. 
218.       throw new BadRequestException(
219.           "Public AppNamespace " + appNamespace.getName() + " already exists as private AppNamespace in appId: "
220.               + APP_NAMESPACE_JOINER.join(appIds) + ", etc. Please select another name!");
221.     }
222.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 224 - 229
Content:
224.   private void checkPublicAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {
225.     AppNamespace publicAppNamespace = findPublicAppNamespace(appNamespace.getName());
226.     if (publicAppNamespace != null) {
227.       throw new BadRequestException("AppNamespace " + appNamespace.getName() + " already exists as public namespace in appId: " + publicAppNamespace.getAppId() + "!");
228.     }
229.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 117 - 131
Content:
117.   public NamespaceDTO createNamespace(Env env, NamespaceDTO namespace) {
118.     if (StringUtils.isEmpty(namespace.getDataChangeCreatedBy())) {
119.       namespace.setDataChangeCreatedBy(userInfoHolder.getUser().getUserId());
120.     }
121. 
122.     if (StringUtils.isEmpty(namespace.getDataChangeLastModifiedBy())) {
123.       namespace.setDataChangeLastModifiedBy(userInfoHolder.getUser().getUserId());
124.     }
125.     NamespaceDTO createdNamespace = namespaceAPI.createNamespace(env, namespace);
126. 
127.     Tracer.logEvent(TracerEventType.CREATE_NAMESPACE,
128.         String.format("%s+%s+%s+%s", namespace.getAppId(), env, namespace.getClusterName(),
129.             namespace.getNamespaceName()));
130.     return createdNamespace;
131.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 170 - 184
Content:
170.   @Transactional
171.   public void deleteNamespace(String appId, Env env, String clusterName, String namespaceName) {
172. 
173.     String operator = userInfoHolder.getUser().getUserId();
174.     namespaceAPI.deleteNamespace(env, appId, clusterName, namespaceName, operator);
175.   }
176. 
177.   public NamespaceDTO loadNamespaceBaseInfo(String appId, Env env, String clusterName,
178.       String namespaceName) {
179.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
180.     if (namespace == null) {
181.       throw new BadRequestException(String.format("Namespace: %s not exist.", namespaceName));
182.     }
183.     return namespace;
184.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 231 - 246
Content:
231.   public List<NamespaceDTO> findNamespaces(String appId, Env env, String clusterName) {
232.     return namespaceAPI.findNamespaceByCluster(appId, env, clusterName);
233.   }
234. 
235.   /**
236.    * the returned content's size is not fixed. so please carefully used.
237.    */
238.   public PageDTO<NamespaceDTO> findNamespacesByItem(Env env, String itemKey, Pageable pageable) {
239.     return namespaceAPI.findByItem(env, itemKey, pageable.getPageNumber(), pageable.getPageSize());
240.   }
241. 
242.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(Env env, String publicNamespaceName,
243.       int page,
244.       int size) {
245.     return namespaceAPI.getPublicAppNamespaceAllNamespaces(env, publicNamespaceName, page, size);
246.   }


File: docs/en/design/apollo-core-concept-namespace.md
Line number range: 1 - 205
Content:
1. ### 1. What is Namespace?
2. 
3. Namespace is a collection of configuration items, similar to the concept of a configuration file.
4. 
5. ### 2. What is an `application` Namespace?
6. 
7. When Apollo creates a project, it creates an `application` namespace by default. Spring Boot students know that Spring Boot projects have a default configuration file application.yml. here application.yml is equivalent to the `application` Namespace. For 90% of applications, the `application` namespace is sufficient for everyday configuration scenarios.
8. 
9. ####  The code for client to get the `application` Namespace is as follows.
10. 
11. ``` java
12.   Config config = ConfigService.getAppConfig();
13. ```
14. 
15. #### The code for the client to get a `non-application` Namespace is as follows.
16. 
17. ``` java
18.   Config config = ConfigService.getConfig(namespaceName);
19. ```
20. 
21. ### 3. What are the formats of Namespace?
22. 
23. Configuration files come in various formats such as properties, xml, yml, yaml, json, etc. Similarly Namespace also has these formats. In the Portal UI, you can see that the Namespace for `application` has a `properties` tag, indicating that `application` is in properties format.
24. 
25. >Note1: For the namespace in non-properties format, you need to call `ConfigService.getConfigFile(String namespace, ConfigFileFormat configFileFormat)` to get it when you use the client, if you use the [Http interface direct call](en/usage/other-language-client-user-guide), the corresponding namespace parameter needs to be passed in the namespace name plus the suffix name, such as datasources.json.
26. 
27. >Note 2: apollo-client version 1.3.0 has better support for yaml/yml, which is consistent with the properties format: `Config config = ConfigService.getConfig("application.yml");`, Spring's The Spring injection is also consistent with properties.
28. 
29. ### 4. Classification of Namespace access rights
30. 
31. There are two types of access permissions for Namespace.
32. 
33.   * private (private)
34.   * public (public)
35. 
36. The access rights here are relative to the Apollo client.
37. 
38. #### 4.1 Private Permissions
39. 
40. Namespace with private access can only be accessed by the application it belongs to. If an application tries to get the private namespace of another application, Apollo will report a `404 ` exception.
41. 
42. #### 4.2 Public Permissions
43. 
44. Namespace with public privileges can be fetched by any application.
45. 
46. ### 5. Types of Namespace
47. 
48. There are three types of Namespace.
49. 
50.   * private type
51.   * public type  
52.   * Associated types (inherited types)
53. 
54. #### 5.1 Private Types
55. 
56. Namespace of private type has private permission. For example, the  `application` Namespace mentioned above is a private type.
57. 
58. 
59. #### 5.2 Public Types
60. 
61. ##### 5.2.1 Meaning
62. 
63. Namespace of a public type has public privileges. A public type Namespace is equivalent to a configuration that is outside the application and identifies the public Namespace by its name, so the name of the public Namespace must be globally unique.
64. 
65. ##### 5.2.2 Usage Scenarios
66. 
67.   * Department-level shared configurations
68.   * Configurations shared at the group level
69.   * Configurations shared between several projects
70.   * Configuration for middleware clients
71. 
72. 
73. #### 5.3 Association Types
74. 
75. ##### 5.3.1 Meaning
76. 
77. An association type may also be called an inherited type, and the association type has private privileges. The Namespace of an association type inherits from the Namespace of a public type and is used to override certain configurations of the public Namespace. For example, the public Namespace has two configuration items 
78. 
79. ```
80. k1 = v1
81. k2 = v2
82. ```
83. 
84. Then application A has an associated type of Namespace associated with this public Namespace and overrides the configuration item k1 with a new value of v3. Then when application A actually runs, the configuration of the public Namespace is obtained as
85. 
86. ```
87. k1 = v3
88. k2 = v2
89. ```
90. 
91. ##### 5.3.2 Usage Scenarios
92. 
93. Give a real-world usage scenario. Assume that the configuration of the RPC framework (e.g., timeout) has the following requirements.
94. 
95.   * Provide a company-wide default configuration that can be dynamically adjusted
96.   * RPC client projects can customize certain configuration items and can be dynamically adjusted
97. 
98. 1. If you remove  `dynamically adjustable` from the above two requirements, the approach is simple. There is a configuration file in the rpc-client.jar package, and each time you modify the configuration file, you can resend a new version of the jar package. Similarly, the same is true for client-side projects.
99. 2. If only the client project is supported, the configuration can be dynamically adjusted. The client project can configure some configuration items on Apollo  `application` Namespace. When initializing the service, just read the configuration from Apollo. The disadvantage of this is that each project has to customize some keys, which is not uniform. 3.
100. 3. so how to support the above requirements perfectly? The answer is to use a combination of Apollo's public type Namespace and the associated type Namespace. The code in rpc-client.jar reads the configuration of the `rpc-client` Namespace. If you need to adjust the default configuration, just change the configuration of the public type `rpc-client` Namespace. If a client project wants to customize or dynamically modify some configuration items, simply associate `rpc-client` with Apollo's own project to create a Namespace of the associated type  `rpc-client`. Then you can modify the configuration items under the Namespace of the associated type `rpc-client`. One thing we need to point out here is that rpc-client.jar is running in the application container, so the configuration of the `rpc-client` Namespace that rpc-client gets is the namespace of the associated type of the application plus the namespace of the public type Namespace.
101. 
102. #### 5.4 Example
103. 
104. As shown in the following figure, there are three applications: Application A, Application B, and Application C.
105. 
106.  * Application A has two Namespace of private type: application and NS-Private, and one Namespace of associated type: NS-Public.
107.  * Application B has one Namespace of private type: application, and one Namespace of public type: NS-Public.
108.  * Application C has only one Namespace of type private: application
109. 
110. ![Namespace Example](https://cdn.jsdelivr.net/gh/apolloconfig/apollo@master/doc/images/namespace-model-example.png)
111. 
112. ##### 5.4.1 Application A gets the Apollo configuration
113. 
114. ```java
115.   //application 
116.   Config appConfig = ConfigService.getAppConfig();
117.   appConfig.getProperty("k1", null); // k1 = v11
118.   appConfig.getProperty("k2", null); // k2 = v21
119.   
120.   // NS-Private
121.   Config privateConfig = ConfigService.getConfig("NS-Private");
122.   privateConfig.getProperty("k1", null); // k1 = v3
123.   privateConfig.getProperty("k3", null); // k3 = v4
124.   
125.   // NS-Public, overrides the case of public type configuration, k4 is overridden
126.   Config publicConfig = ConfigService.getConfig("NS-Public");
127.   publicConfig.getProperty("k4", null); // k4 = v6 cover
128.   publicConfig.getProperty("k6", null); // k6 = v6
129.   publicConfig.getProperty("k7", null); // k7 = v7
130. ```
131. 
132. ##### 5.4.2 Application B to get Apollo configuration
133. 
134. ``` java
135.   //application
136.   Config appConfig = ConfigService.getAppConfig();
137.   appConfig.getProperty("k1", null); // k1 = v12
138.   appConfig.getProperty("k2", null); // k2 = null
139.   appConfig.getProperty("k3", null); // k3 = v32
140.   
141.   // NS-Private, since there is no NS-Private Namespace so we get the default value
142.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");
143.   privateConfig.getProperty("k1", "default value"); 
144.   
145.   //NS-Public
146.   Config publicConfig = ConfigService.getConfig("NS-Public");
147.   publicConfig.getProperty("k4", null); // k4 = v5
148.   publicConfig.getProperty("k6", null); // k6 = v6
149.   publicConfig.getProperty("k7", null); // k7 = v7
150. ```
151. 
152. ##### 5.4.3 Applying C to get Apollo configuration
153. 
154. ``` java
155.   //application
156.   Config appConfig = ConfigService.getAppConfig();
157.   appConfig.getProperty("k1", null); // k1 = v12
158.   appConfig.getProperty("k2", null); // k2 = null
159.   appConfig.getProperty("k3", null); // k3 = v33
160.   
161.   // NS-Private, since there is no NS-Private Namespace so we get the default value
162.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");
163.   privateConfig.getProperty("k1", "default value"); 
164.   
165.   //NS-Public, the public type Namespace, which any project can get
166.   Config publicConfig = ConfigServi
167. 
168. ```
169. 
170. ##### 5.4.4 ChangeListener
171. 
172. As you can see in the above code example, the Client Namespace is mapped to a Config object. Listeners for namespace configuration changes are registered on the Config object.
173. 
174. So the Namespace code that monitors the application in application A is as follows:
175. 
176. ````java
177. Config appConfig = ConfigService.getAppConfig();
178. appConfig.addChangeListener(new ConfigChangeListener() {
179.   public void onChange(ConfigChangeEvent changeEvent) {
180.     //do something
181.   }
182. })
183. ````
184. 
185. The Namespace code for monitoring NS-Private in application A is as follows:
186. 
187. ````java
188. Config privateConfig = ConfigService.getConfig("NS-Private");
189. privateConfig.addChangeListener(new ConfigChangeListener() {
190.   public void onChange(ConfigChangeEvent changeEvent) {
191.     //do something
192.   }
193. })
194. ````
195. 
196. The Namespace code for monitoring NS-Public in application A, application B, and application C is as follows:
197. 
198. ````java
199. Config publicConfig = ConfigService.getConfig("NS-Public");
200. publicConfig.addChangeListener(new ConfigChangeListener() {
201.   public void onChange(ConfigChangeEvent changeEvent) {
202.     //do something
203.   }
204. })
205. ````

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:21:10,635 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The issue reports a 500 error when creating and then querying a namespace named ".". Current context shows portal and biz layer validations and controllers accept dots in path variables, and InputValidator allows single dots. However, the actual admin backend endpoints invoked by portal (namespaceAPI) and the apollo-adminservice controllers handling namespace creation/query are missing. These are critical to confirm the routing/validation behavior and pinpoint whether the 500 originates from path variable handling or backend validation, which is necessary to accurately classify and justify the issue as a bug.' query='Please provide the full source (with line numbers) of namespace-related controllers and endpoints in apollo-adminservice and the Portal NamespaceAPI client implementations that call them, focusing on mappings and validations for namespace operations.' extra_requirements="If sending all files is too large, include at least classes whose names contain 'Namespace' under apollo-adminservice/src/main/java and apollo-portal/src/main/java that implement the namespaceAPI client, showing all @GetMapping/@PostMapping routes with path variables for namespaceName." purpose='This will verify whether backend path variable mappings support single-dot names and identify the source of the 500 to classify the issue accurately.'
2025-11-12 11:21:10,636 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full source (with line numbers) of namespace-related controllers and endpoints in apollo-adminservice and the Portal NamespaceAPI client implementations that call them, focusing on mappings and validations for namespace operations.
2025-11-12 11:21:14,951 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: [{'query_essential_query': 'Please provide the full source (with line numbers) of the namespace creation and query handlers in apollo-portal and apollo-biz, including NamespaceController, NamespaceService, related validators/entities/repositories, and the docs/en/design/apollo-core-concept-namespace.md.', 'query_extra_requirements': "If exact file names are unclear, please share all classes under apollo-portal/src/main/java and apollo-biz/src/main/java whose names contain 'Namespace' and any REST endpoints for namespace operations, plus any tests referencing namespace naming.", 'query_purpose': 'This will allow verifying expected naming rules and whether a single dot should be rejected or supported, identifying the cause of the 500 and correctly classifying the issue.', 'memory_context_contexts': [{'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java', 'content': '28. @Entity\n29. @Table(name = "Namespace")\n30. @SQLDelete(sql = "Update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")\n31. @Where(clause = "isDeleted = 0")\n32. public class Namespace extends BaseEntity {\n33. \n34.   @Column(name = "appId", nullable = false)\n35.   private String appId;\n36. \n37.   @Column(name = "ClusterName", nullable = false)\n38.   private String clusterName;\n39. \n40.   @Column(name = "NamespaceName", nullable = false)\n41.   private String namespaceName;\n42. \n43.   public Namespace(){\n44. \n45.   }\n46. \n47.   public Namespace(String appId, String clusterName, String namespaceName) {\n48.     this.appId = appId;\n49.     this.clusterName = clusterName;\n50.     this.namespaceName = namespaceName;\n51.   }\n52. \n53.   public String getAppId() {\n54.     return appId;\n55.   }\n56. \n57.   public String getClusterName() {\n58.     return clusterName;\n59.   }\n60. \n61.   public String getNamespaceName() {\n62.     return namespaceName;\n63.   }\n64. \n65.   public void setAppId(String appId) {\n66.     this.appId = appId;\n67.   }\n68. \n69.   public void setClusterName(String clusterName) {\n70.     this.clusterName = clusterName;\n71.   }\n72. \n73.   public void setNamespaceName(String namespaceName) {\n74.     this.namespaceName = namespaceName;\n75.   }', 'start_line_number': 28, 'end_line_number': 75}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java', 'content': '29. public interface NamespaceRepository extends PagingAndSortingRepository<Namespace, Long> {\n30. \n31.   List<Namespace> findByAppIdAndClusterNameOrderByIdAsc(String appId, String clusterName);\n32. \n33.   Namespace findByAppIdAndClusterNameAndNamespaceName(String appId, String clusterName, String namespaceName);\n34. \n35.   @Modifying\n36.   @Query("update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 where appId=?1 and clusterName=?2 and IsDeleted = 0")\n37.   int batchDelete(String appId, String clusterName, String operator);\n38. \n39.   List<Namespace> findByAppIdAndNamespaceNameOrderByIdAsc(String appId, String namespaceName);\n40. \n41.   List<Namespace> findByNamespaceName(String namespaceName, Pageable page);\n42. \n43.   List<Namespace> findByIdIn(Set<Long> namespaceIds);\n44. \n45.   int countByNamespaceNameAndAppIdNot(String namespaceName, String appId);\n46. ', 'start_line_number': 29, 'end_line_number': 46}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java', 'content': '29. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long>{\n30. \n31.   AppNamespace findByAppIdAndName(String appId, String namespaceName);\n32. \n33.   List<AppNamespace> findByAppIdAndNameIn(String appId, Set<String> namespaceNames);\n34. \n35.   AppNamespace findByNameAndIsPublicTrue(String namespaceName);\n36. \n37.   List<AppNamespace> findByNameInAndIsPublicTrue(Set<String> namespaceNames);\n38. \n39.   List<AppNamespace> findByAppIdAndIsPublic(String appId, boolean isPublic);\n40. \n41.   List<AppNamespace> findByAppIdOrderByIdAsc(String appId);\n42. \n43.   List<AppNamespace> findFirst500ByIdGreaterThanOrderByIdAsc(long id);\n44. \n45.   @Modifying\n46.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?2 WHERE AppId=?1 and IsDeleted = 0")\n47.   int batchDeleteByAppId(String appId, String operator);\n48. \n49.   @Modifying\n50.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")\n51.   int delete(String appId, String namespaceName, String operator);', 'start_line_number': 29, 'end_line_number': 51}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', 'content': '63.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {\n64.     Objects.requireNonNull(appId, "AppId must not be null");\n65.     Objects.requireNonNull(namespaceName, "Namespace must not be null");\n66.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));\n67.   }\n68. \n69.   public AppNamespace findPublicNamespaceByName(String namespaceName) {\n70.     Preconditions.checkArgument(namespaceName != null, "Namespace must not be null");\n71.     return appNamespaceRepository.findByNameAndIsPublicTrue(namespaceName);\n72.   }', 'start_line_number': 63, 'end_line_number': 72}, {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java', 'content': '38.   @NotBlank(message = "AppNamespace Name cannot be blank")\n39.   @Pattern(\n40.       regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR,\n41.       message = "Invalid Namespace format: " + InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE\n42.   )\n43.   @Column(name = "Name", nullable = false)\n44.   private String name;\n45. ', 'start_line_number': 38, 'end_line_number': 45}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', 'content': '104.   @Transactional\n105.   public void createDefaultAppNamespace(String appId, String createBy) {\n106.     if (!isAppNamespaceNameUnique(appId, ConfigConsts.NAMESPACE_APPLICATION)) {\n107.       throw new ServiceException("appnamespace not unique");\n108.     }\n109.     AppNamespace appNs = new AppNamespace();\n110.     appNs.setAppId(appId);\n111.     appNs.setName(ConfigConsts.NAMESPACE_APPLICATION);\n112.     appNs.setComment("default app namespace");\n113.     appNs.setFormat(ConfigFileFormat.Properties.getValue());\n114.     appNs.setDataChangeCreatedBy(createBy);\n115.     appNs.setDataChangeLastModifiedBy(createBy);\n116.     appNamespaceRepository.save(appNs);\n117. \n118.     auditService.audit(AppNamespace.class.getSimpleName(), appNs.getId(), Audit.OP.INSERT,\n119.                        createBy);\n120.   }', 'start_line_number': 104, 'end_line_number': 120}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', 'content': '122.   @Transactional\n123.   public AppNamespace createAppNamespace(AppNamespace appNamespace) {\n124.     String createBy = appNamespace.getDataChangeCreatedBy();\n125.     if (!isAppNamespaceNameUnique(appNamespace.getAppId(), appNamespace.getName())) {\n126.       throw new ServiceException("appnamespace not unique");\n127.     }\n128.     appNamespace.setId(0);//protection\n129.     appNamespace.setDataChangeCreatedBy(createBy);\n130.     appNamespace.setDataChangeLastModifiedBy(createBy);\n131. \n132.     appNamespace = appNamespaceRepository.save(appNamespace);\n133. \n134.     createNamespaceForAppNamespaceInAllCluster(appNamespace.getAppId(), appNamespace.getName(), createBy);\n135. \n136.     auditService.audit(AppNamespace.class.getSimpleName(), appNamespace.getId(), Audit.OP.INSERT, createBy);\n137.     return appNamespace;\n138.   }', 'start_line_number': 122, 'end_line_number': 138}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', 'content': '151.   public void createNamespaceForAppNamespaceInAllCluster(String appId, String namespaceName, String createBy) {\n152.     List<Cluster> clusters = clusterService.findParentClusters(appId);\n153. \n154.     for (Cluster cluster : clusters) {\n155. \n156.       // in case there is some dirty data, e.g. public namespace deleted in other app and now created in this app\n157.       if (!namespaceService.isNamespaceUnique(appId, cluster.getName(), namespaceName)) {\n158.         continue;\n159.       }\n160. \n161.       Namespace namespace = new Namespace();\n162.       namespace.setClusterName(cluster.getName());\n163.       namespace.setAppId(appId);\n164.       namespace.setNamespaceName(namespaceName);\n165.       namespace.setDataChangeCreatedBy(createBy);\n166.       namespace.setDataChangeLastModifiedBy(createBy);\n167. \n168.       namespaceService.save(namespace);\n169.     }\n170.   }', 'start_line_number': 151, 'end_line_number': 170}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '104.   public Namespace findOne(String appId, String clusterName, String namespaceName) {\n105.     return namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, clusterName,\n106.                                                                          namespaceName);\n107.   }', 'start_line_number': 104, 'end_line_number': 107}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '112.   public Page<Namespace> findByItem(String itemKey, Pageable pageable) {\n113.     Page<Item> items = itemService.findItemsByKey(itemKey, pageable);\n114. \n115.     if (!items.hasContent()) {\n116.       return Page.empty();\n117.     }\n118. \n119.     Set<Long> namespaceIds = BeanUtils.toPropertySet("namespaceId", items.getContent());\n120. \n121.     return new PageImpl<>(namespaceRepository.findByIdIn(namespaceIds));\n122.   }', 'start_line_number': 112, 'end_line_number': 122}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '175.   public List<Namespace> findPublicAppNamespaceAllNamespaces(String namespaceName, Pageable page) {\n176.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);\n177. \n178.     if (publicAppNamespace == null) {\n179.       throw new BadRequestException(\n180.           String.format("Public appNamespace not exists. NamespaceName = %s", namespaceName));\n181.     }\n182. \n183.     List<Namespace> namespaces = namespaceRepository.findByNamespaceName(namespaceName, page);\n184. \n185.     return filterChildNamespace(namespaces);\n186.   }', 'start_line_number': 175, 'end_line_number': 186}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '215.   public List<Namespace> findNamespaces(String appId, String clusterName) {\n216.     List<Namespace> namespaces = namespaceRepository.findByAppIdAndClusterNameOrderByIdAsc(appId, clusterName);\n217.     if (namespaces == null) {\n218.       return Collections.emptyList();\n219.     }\n220.     return namespaces;\n221.   }\n222. \n223.   public List<Namespace> findByAppIdAndNamespaceName(String appId, String namespaceName) {\n224.     return namespaceRepository.findByAppIdAndNamespaceNameOrderByIdAsc(appId, namespaceName);\n225.   }', 'start_line_number': 215, 'end_line_number': 225}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '283.   public boolean isNamespaceUnique(String appId, String cluster, String namespace) {\n284.     Objects.requireNonNull(appId, "AppId must not be null");\n285.     Objects.requireNonNull(cluster, "Cluster must not be null");\n286.     Objects.requireNonNull(namespace, "Namespace must not be null");\n287.     return Objects.isNull(\n288.         namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, cluster, namespace));\n289.   }\n290. \n291.   @Transactional\n292.   public void deleteByAppIdAndClusterName(String appId, String clusterName, String operator) {\n293. \n294.     List<Namespace> toDeleteNamespaces = findNamespaces(appId, clusterName);\n295. \n296.     for (Namespace namespace : toDeleteNamespaces) {\n297. \n298.       deleteNamespace(namespace, operator);\n299. \n300.     }\n301.   }\n302. \n303.   @Transactional\n304.   public Namespace deleteNamespace(Namespace namespace, String operator) {\n305.     String appId = namespace.getAppId();\n306.     String clusterName = namespace.getClusterName();\n307.     String namespaceName = namespace.getNamespaceName();\n308. \n309.     itemService.batchDelete(namespace.getId(), operator);\n310.     commitService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);\n311. \n312.     // Child namespace releases should retain as long as the parent namespace exists, because parent namespaces\' release\n313.     // histories need them\n314.     if (!isChildNamespace(namespace)) {\n315.       releaseService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);\n316.     }\n317. \n318.     //delete child namespace\n319.     Namespace childNamespace = findChildNamespace(namespace);\n320.     if (childNamespace != null) {\n321.       namespaceBranchService.deleteBranch(appId, clusterName, namespaceName,\n322.                                           childNamespace.getClusterName(), NamespaceBranchStatus.DELETED, operator);\n323.       //delete child namespace\'s releases. Notice: delete child namespace will not delete child namespace\'s releases\n324.       releaseService.batchDelete(appId, childNamespace.getClusterName(), namespaceName, operator);\n325.     }\n326. \n327.     releaseHistoryService.batchDelete(appId, clusterName, namespaceName, operator);\n328. \n329.     instanceService.batchDeleteInstanceConfig(appId, clusterName, namespaceName);\n330. \n331.     namespaceLockService.unlock(namespace.getId());\n332. \n333.     namespace.setDeleted(true);\n334.     namespace.setDataChangeLastModifiedBy(operator);\n335. \n336.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.DELETE, operator);\n337. \n338.     Namespace deleted = namespaceRepository.save(namespace);\n339. \n340.     //Publish release message to do some clean up in config service, such as updating the cache\n341.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),\n342.         Topics.APOLLO_RELEASE_TOPIC);\n343. \n344.     return deleted;\n345.   }\n346. \n347.   @Transactional\n348.   public Namespace save(Namespace entity) {\n349.     if (!isNamespaceUnique(entity.getAppId(), entity.getClusterName(), entity.getNamespaceName())) {\n350.       throw new ServiceException("namespace not unique");\n351.     }\n352.     entity.setId(0);//protection\n353.     Namespace namespace = namespaceRepository.save(entity);\n354. \n355.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.INSERT,\n356.                        namespace.getDataChangeCreatedBy());\n357. \n358.     return namespace;\n359.   }', 'start_line_number': 283, 'end_line_number': 359}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '374.   @Transactional\n375.   public void instanceOfAppNamespaces(String appId, String clusterName, String createBy) {\n376. \n377.     List<AppNamespace> appNamespaces = appNamespaceService.findByAppId(appId);\n378. \n379.     for (AppNamespace appNamespace : appNamespaces) {\n380.       Namespace ns = new Namespace();\n381.       ns.setAppId(appId);\n382.       ns.setClusterName(clusterName);\n383.       ns.setNamespaceName(appNamespace.getName());\n384.       ns.setDataChangeCreatedBy(createBy);\n385.       ns.setDataChangeLastModifiedBy(createBy);\n386.       namespaceRepository.save(ns);\n387.       auditService.audit(Namespace.class.getSimpleName(), ns.getId(), Audit.OP.INSERT, createBy);\n388.     }\n389. ', 'start_line_number': 374, 'end_line_number': 389}, {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java', 'content': '27.   public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbol - _ . are allowed";\n28.   public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE = "not allowed to end with .json, .yml, .yaml, .xml, .properties";\n29.   public static final String CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+";\n30.   private static final String APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\\\.(json|yml|yaml|xml|properties))$";\n31.   private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);\n32.   private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);\n33. \n34.   public static boolean isValidClusterNamespace(String name) {\n35.     if (StringUtils.isEmpty(name)){\n36.       return false;\n37.     }\n38.     return CLUSTER_NAMESPACE_PATTERN.matcher(name).matches();\n39.   }\n40. \n41.   public static boolean isValidAppNamespace(String name){\n42.     if (StringUtils.isEmpty(name)){\n43.       return false;\n44.     }\n45.     return APP_NAMESPACE_PATTERN.matcher(name).matches();\n46.   }', 'start_line_number': 27, 'end_line_number': 46}, {'relative_path': 'apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java', 'content': '35.   public void testValidAppNamespaceName() throws Exception {\n36.     checkAppNamespaceName("some.cluster-_name.123", true);\n37.     checkAppNamespaceName("some.&.name", false);\n38.     checkAppNamespaceName("", false);\n39.     checkAppNamespaceName(null, false);\n40.     checkAppNamespaceName("some.name.json", false);\n41.     checkAppNamespaceName("some.name.yml", false);\n42.     checkAppNamespaceName("some.name.yaml", false);\n43.     checkAppNamespaceName("some.name.xml", false);\n44.     checkAppNamespaceName("some.name.properties", false);\n45.   }', 'start_line_number': 35, 'end_line_number': 45}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java', 'content': '52.   @PreAuthorize(value = "@consumerPermissionValidator.hasCreateNamespacePermission(#request, #appId)")\n53.   @PostMapping(value = "/openapi/v1/apps/{appId}/appnamespaces")\n54.   public OpenAppNamespaceDTO createNamespace(@PathVariable String appId,\n55.                                              @RequestBody OpenAppNamespaceDTO appNamespaceDTO,\n56.                                              HttpServletRequest request) {\n57. \n58.     if (!Objects.equals(appId, appNamespaceDTO.getAppId())) {\n59.       throw new BadRequestException(String.format("AppId not equal. AppId in path = %s, AppId in payload = %s", appId,\n60.                                                   appNamespaceDTO.getAppId()));\n61.     }\n62.     RequestPrecondition.checkArgumentsNotEmpty(appNamespaceDTO.getAppId(), appNamespaceDTO.getName(),\n63.                                                appNamespaceDTO.getFormat(), appNamespaceDTO.getDataChangeCreatedBy());\n64. \n65.     if (!InputValidator.isValidAppNamespace(appNamespaceDTO.getName())) {\n66.       throw new BadRequestException(String.format("Invalid Namespace format: %s",\n67.                                                   InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & "\n68.                                                   + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));\n69.     }\n70. \n71.     if (!ConfigFileFormat.isValidFormat(appNamespaceDTO.getFormat())) {\n72.       throw new BadRequestException(String.format("Invalid namespace format. format = %s", appNamespaceDTO.getFormat()));\n73.     }\n74. \n75.     String operator = appNamespaceDTO.getDataChangeCreatedBy();\n76.     if (userService.findByUserId(operator) == null) {\n77.       throw new BadRequestException(String.format("Illegal user. user = %s", operator));\n78.     }\n79. \n80.     return this.namespaceOpenApiService.createAppNamespace(appNamespaceDTO);\n81.   }', 'start_line_number': 52, 'end_line_number': 81}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java', 'content': '83.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces")\n84.   public List<OpenNamespaceDTO> findNamespaces(@PathVariable String appId, @PathVariable String env,\n85.                                                @PathVariable String clusterName) {\n86.     return this.namespaceOpenApiService.getNamespaces(appId, env, clusterName);\n87.   }\n88. \n89.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")\n90.   public OpenNamespaceDTO loadNamespace(@PathVariable String appId, @PathVariable String env,\n91.                                         @PathVariable String clusterName, @PathVariable String\n92.                                             namespaceName) {\n93.     return this.namespaceOpenApiService.getNamespace(appId, env, clusterName, namespaceName);\n94.   }', 'start_line_number': 83, 'end_line_number': 94}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '105.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces")\n106.   public List<NamespaceBO> findNamespaces(@PathVariable String appId, @PathVariable String env,\n107.                                           @PathVariable String clusterName) {\n108. \n109.     List<NamespaceBO> namespaceBOs = namespaceService.findNamespaceBOs(appId, Env.valueOf(env), clusterName);\n110. \n111.     for (NamespaceBO namespaceBO : namespaceBOs) {\n112.       if (permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceBO.getBaseInfo().getNamespaceName())) {\n113.         namespaceBO.hideItems();\n114.       }\n115.     }\n116. \n117.     return namespaceBOs;\n118.   }', 'start_line_number': 105, 'end_line_number': 118}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '120.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces/{namespaceName:.+}")\n121.   public NamespaceBO findNamespace(@PathVariable String appId, @PathVariable String env,\n122.                                    @PathVariable String clusterName, @PathVariable String namespaceName) {\n123. \n124.     NamespaceBO namespaceBO = namespaceService.loadNamespaceBO(appId, Env.valueOf(env), clusterName, namespaceName);\n125. \n126.     if (namespaceBO != null && permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceName)) {\n127.       namespaceBO.hideItems();\n128.     }\n129. \n130.     return namespaceBO;\n131.   }', 'start_line_number': 120, 'end_line_number': 131}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '142.   @PreAuthorize(value = "@permissionValidator.hasCreateNamespacePermission(#appId)")\n143.   @PostMapping("/apps/{appId}/namespaces")\n144.   public ResponseEntity<Void> createNamespace(@PathVariable String appId,\n145.                                               @RequestBody List<NamespaceCreationModel> models) {\n146. \n147.     checkModel(!CollectionUtils.isEmpty(models));\n148.     String operator = userInfoHolder.getUser().getUserId();\n149. \n150.     for (NamespaceCreationModel model : models) {\n151.       String namespaceName = model.getNamespace().getNamespaceName();\n152.       roleInitializationService.initNamespaceRoles(appId, namespaceName, operator);\n153.       roleInitializationService.initNamespaceEnvRoles(appId, namespaceName, operator);\n154.       NamespaceDTO namespace = model.getNamespace();\n155.       RequestPrecondition.checkArgumentsNotEmpty(model.getEnv(), namespace.getAppId(),\n156.                                                  namespace.getClusterName(), namespace.getNamespaceName());\n157. \n158.       try {\n159.         namespaceService.createNamespace(Env.valueOf(model.getEnv()), namespace);\n160.       } catch (Exception e) {\n161.         logger.error("create namespace fail.", e);\n162.         Tracer.logError(\n163.                 String.format("create namespace fail. (env=%s namespace=%s)", model.getEnv(),\n164.                         namespace.getNamespaceName()), e);\n165.       }\n166.       namespaceService.assignNamespaceRoleToOperator(appId, namespaceName,userInfoHolder.getUser().getUserId());\n167.     }\n168. \n169.     return ResponseEntity.ok().build();\n170.   }', 'start_line_number': 142, 'end_line_number': 170}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '172.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")\n173.   @DeleteMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName:.+}")\n174.   public ResponseEntity<Void> deleteLinkedNamespace(@PathVariable String appId, @PathVariable String env,\n175.       @PathVariable String clusterName, @PathVariable String namespaceName) {\n176. \n177.     namespaceService.deleteNamespace(appId, Env.valueOf(env), clusterName, namespaceName);\n178. \n179.     return ResponseEntity.ok().build();\n180.   }', 'start_line_number': 172, 'end_line_number': 180}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '182.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName}/usage")\n183.   public List<NamespaceUsage> findLinkedNamespaceUsage(@PathVariable String appId, @PathVariable String env,\n184.       @PathVariable String clusterName, @PathVariable String namespaceName) {\n185.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(appId, namespaceName, Env.valueOf(env), clusterName);\n186.     return Lists.newArrayList(usage);\n187.   }', 'start_line_number': 182, 'end_line_number': 187}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '194.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")\n195.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")\n196.   public ResponseEntity<Void> deleteAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {\n197. \n198.     AppNamespace appNamespace = appNamespaceService.deleteAppNamespace(appId, namespaceName);\n199. \n200.     publisher.publishEvent(new AppNamespaceDeletionEvent(appNamespace));\n201. \n202.     return ResponseEntity.ok().build();\n203.   }', 'start_line_number': 194, 'end_line_number': 203}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '205.   @GetMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")\n206.   public AppNamespaceDTO findAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {\n207.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);\n208. \n209.     if (appNamespace == null) {\n210.       throw new BadRequestException(\n211.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));\n212.     }\n213. \n214.     return BeanUtils.transform(AppNamespaceDTO.class, appNamespace);\n215.   }', 'start_line_number': 205, 'end_line_number': 215}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '217.   @PreAuthorize(value = "@permissionValidator.hasCreateAppNamespacePermission(#appId, #appNamespace)")\n218.   @PostMapping("/apps/{appId}/appnamespaces")\n219.   public AppNamespace createAppNamespace(@PathVariable String appId,\n220.       @RequestParam(defaultValue = "true") boolean appendNamespacePrefix,\n221.       @Valid @RequestBody AppNamespace appNamespace) {\n222.     if (!InputValidator.isValidAppNamespace(appNamespace.getName())) {\n223.       throw new BadRequestException(String.format("Invalid Namespace format: %s",\n224.           InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));\n225.     }\n226. \n227.     AppNamespace createdAppNamespace = appNamespaceService.createAppNamespaceInLocal(appNamespace, appendNamespacePrefix);\n228. \n229.     if (portalConfig.canAppAdminCreatePrivateNamespace() || createdAppNamespace.isPublic()) {\n230.       namespaceService.assignNamespaceRoleToOperator(appId, appNamespace.getName(),\n231.           userInfoHolder.getUser().getUserId());\n232.     }\n233. \n234.     publisher.publishEvent(new AppNamespaceCreationEvent(createdAppNamespace));\n235. \n236.     return createdAppNamespace;\n237.   }', 'start_line_number': 217, 'end_line_number': 237}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '251.   @GetMapping("/envs/{env}/appnamespaces/{publicNamespaceName}/namespaces")\n252.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(@PathVariable String env,\n253.                                                                @PathVariable String publicNamespaceName,\n254.                                                                @RequestParam(name = "page", defaultValue = "0") int page,\n255.                                                                @RequestParam(name = "size", defaultValue = "10") int size) {\n256. \n257.     return namespaceService.getPublicAppNamespaceAllNamespaces(Env.valueOf(env), publicNamespaceName, page, size);\n258. \n259.   }', 'start_line_number': 251, 'end_line_number': 259}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java', 'content': '25. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long> {\n26. \n27.   AppNamespace findByAppIdAndName(String appId, String namespaceName);\n28. \n29.   AppNamespace findByName(String namespaceName);\n30. \n31.   List<AppNamespace> findByNameAndIsPublic(String namespaceName, boolean isPublic);\n32. \n33.   List<AppNamespace> findByIsPublicTrue();\n34. \n35.   List<AppNamespace> findByAppId(String appId);\n36. \n37.   @Modifying\n38.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy=?2 WHERE AppId=?1 and IsDeleted = 0")\n39.   int batchDeleteByAppId(String appId, String operator);\n40. \n41.   @Modifying\n42.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")\n43.   int delete(String appId, String namespaceName, String operator);\n44. }', 'start_line_number': 25, 'end_line_number': 44}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', 'content': '115.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {\n116.     Objects.requireNonNull(appId, "AppId must not be null");\n117.     Objects.requireNonNull(namespaceName, "Namespace must not be null");\n118.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));\n119.   }\n120. \n121.   @Transactional\n122.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace) {\n123.     return createAppNamespaceInLocal(appNamespace, true);\n124.   }\n125. \n126.   @Transactional\n127.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace, boolean appendNamespacePrefix) {\n128.     String appId = appNamespace.getAppId();\n129. \n130.     //add app org id as prefix\n131.     App app = appService.load(appId);\n132.     if (app == null) {\n133.       throw new BadRequestException("App not exist. AppId = " + appId);\n134.     }\n135. \n136.     StringBuilder appNamespaceName = new StringBuilder();\n137.     //add prefix postfix\n138.     appNamespaceName\n139.         .append(appNamespace.isPublic() && appendNamespacePrefix ? app.getOrgId() + "." : "")\n140.         .append(appNamespace.getName())\n141.         .append(appNamespace.formatAsEnum() == ConfigFileFormat.Properties ? "" : "." + appNamespace.getFormat());\n142.     appNamespace.setName(appNamespaceName.toString());\n143. \n144.     if (appNamespace.getComment() == null) {\n145.       appNamespace.setComment("");\n146.     }\n147. \n148.     if (!ConfigFileFormat.isValidFormat(appNamespace.getFormat())) {\n149.      throw new BadRequestException("Invalid namespace format. format must be properties、json、yaml、yml、xml");\n150.     }\n151. \n152.     String operator = appNamespace.getDataChangeCreatedBy();\n153.     if (StringUtils.isEmpty(operator)) {\n154.       operator = userInfoHolder.getUser().getUserId();\n155.       appNamespace.setDataChangeCreatedBy(operator);\n156.     }\n157. \n158.     appNamespace.setDataChangeLastModifiedBy(operator);\n159. \n160.     // globally uniqueness check for public app namespace\n161.     if (appNamespace.isPublic()) {\n162.       checkAppNamespaceGlobalUniqueness(appNamespace);\n163.     } else {\n164.       // check private app namespace\n165.       if (appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName()) != null) {\n166.         throw new BadRequestException("Private AppNamespace " + appNamespace.getName() + " already exists!");\n167.       }\n168.       // should not have the same with public app namespace\n169.       checkPublicAppNamespaceGlobalUniqueness(appNamespace);\n170.     }\n171. ', 'start_line_number': 115, 'end_line_number': 171}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', 'content': '172.     AppNamespace createdAppNamespace = appNamespaceRepository.save(appNamespace);\n173. \n174.     roleInitializationService.initNamespaceRoles(appNamespace.getAppId(), appNamespace.getName(), operator);\n175.     roleInitializationService.initNamespaceEnvRoles(appNamespace.getAppId(), appNamespace.getName(), operator);\n176. \n177.     return createdAppNamespace;\n178.   }', 'start_line_number': 172, 'end_line_number': 178}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', 'content': '204.   private void checkAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {\n205.     checkPublicAppNamespaceGlobalUniqueness(appNamespace);\n206. \n207.     List<AppNamespace> privateAppNamespaces = findAllPrivateAppNamespaces(appNamespace.getName());\n208. \n209.     if (!CollectionUtils.isEmpty(privateAppNamespaces)) {\n210.       Set<String> appIds = Sets.newHashSet();\n211.       for (AppNamespace ans : privateAppNamespaces) {\n212.         appIds.add(ans.getAppId());\n213.         if (appIds.size() == PRIVATE_APP_NAMESPACE_NOTIFICATION_COUNT) {\n214.           break;\n215.         }\n216.       }\n217. \n218.       throw new BadRequestException(\n219.           "Public AppNamespace " + appNamespace.getName() + " already exists as private AppNamespace in appId: "\n220.               + APP_NAMESPACE_JOINER.join(appIds) + ", etc. Please select another name!");\n221.     }\n222.   }', 'start_line_number': 204, 'end_line_number': 222}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', 'content': '224.   private void checkPublicAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {\n225.     AppNamespace publicAppNamespace = findPublicAppNamespace(appNamespace.getName());\n226.     if (publicAppNamespace != null) {\n227.       throw new BadRequestException("AppNamespace " + appNamespace.getName() + " already exists as public namespace in appId: " + publicAppNamespace.getAppId() + "!");\n228.     }\n229.   }', 'start_line_number': 224, 'end_line_number': 229}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', 'content': '117.   public NamespaceDTO createNamespace(Env env, NamespaceDTO namespace) {\n118.     if (StringUtils.isEmpty(namespace.getDataChangeCreatedBy())) {\n119.       namespace.setDataChangeCreatedBy(userInfoHolder.getUser().getUserId());\n120.     }\n121. \n122.     if (StringUtils.isEmpty(namespace.getDataChangeLastModifiedBy())) {\n123.       namespace.setDataChangeLastModifiedBy(userInfoHolder.getUser().getUserId());\n124.     }\n125.     NamespaceDTO createdNamespace = namespaceAPI.createNamespace(env, namespace);\n126. \n127.     Tracer.logEvent(TracerEventType.CREATE_NAMESPACE,\n128.         String.format("%s+%s+%s+%s", namespace.getAppId(), env, namespace.getClusterName(),\n129.             namespace.getNamespaceName()));\n130.     return createdNamespace;\n131.   }', 'start_line_number': 117, 'end_line_number': 131}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', 'content': '170.   @Transactional\n171.   public void deleteNamespace(String appId, Env env, String clusterName, String namespaceName) {\n172. \n173.     String operator = userInfoHolder.getUser().getUserId();\n174.     namespaceAPI.deleteNamespace(env, appId, clusterName, namespaceName, operator);\n175.   }\n176. \n177.   public NamespaceDTO loadNamespaceBaseInfo(String appId, Env env, String clusterName,\n178.       String namespaceName) {\n179.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);\n180.     if (namespace == null) {\n181.       throw new BadRequestException(String.format("Namespace: %s not exist.", namespaceName));\n182.     }\n183.     return namespace;\n184.   }', 'start_line_number': 170, 'end_line_number': 184}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', 'content': "231.   public List<NamespaceDTO> findNamespaces(String appId, Env env, String clusterName) {\n232.     return namespaceAPI.findNamespaceByCluster(appId, env, clusterName);\n233.   }\n234. \n235.   /**\n236.    * the returned content's size is not fixed. so please carefully used.\n237.    */\n238.   public PageDTO<NamespaceDTO> findNamespacesByItem(Env env, String itemKey, Pageable pageable) {\n239.     return namespaceAPI.findByItem(env, itemKey, pageable.getPageNumber(), pageable.getPageSize());\n240.   }\n241. \n242.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(Env env, String publicNamespaceName,\n243.       int page,\n244.       int size) {\n245.     return namespaceAPI.getPublicAppNamespaceAllNamespaces(env, publicNamespaceName, page, size);\n246.   }", 'start_line_number': 231, 'end_line_number': 246}, {'relative_path': 'docs/en/design/apollo-core-concept-namespace.md', 'content': '1. ### 1. What is Namespace?\n2. \n3. Namespace is a collection of configuration items, similar to the concept of a configuration file.\n4. \n5. ### 2. What is an `application` Namespace?\n6. \n7. When Apollo creates a project, it creates an `application` namespace by default. Spring Boot students know that Spring Boot projects have a default configuration file application.yml. here application.yml is equivalent to the `application` Namespace. For 90% of applications, the `application` namespace is sufficient for everyday configuration scenarios.\n8. \n9. ####  The code for client to get the `application` Namespace is as follows.\n10. \n11. ``` java\n12.   Config config = ConfigService.getAppConfig();\n13. ```\n14. \n15. #### The code for the client to get a `non-application` Namespace is as follows.\n16. \n17. ``` java\n18.   Config config = ConfigService.getConfig(namespaceName);\n19. ```\n20. \n21. ### 3. What are the formats of Namespace?\n22. \n23. Configuration files come in various formats such as properties, xml, yml, yaml, json, etc. Similarly Namespace also has these formats. In the Portal UI, you can see that the Namespace for `application` has a `properties` tag, indicating that `application` is in properties format.\n24. \n25. >Note1: For the namespace in non-properties format, you need to call `ConfigService.getConfigFile(String namespace, ConfigFileFormat configFileFormat)` to get it when you use the client, if you use the [Http interface direct call](en/usage/other-language-client-user-guide), the corresponding namespace parameter needs to be passed in the namespace name plus the suffix name, such as datasources.json.\n26. \n27. >Note 2: apollo-client version 1.3.0 has better support for yaml/yml, which is consistent with the properties format: `Config config = ConfigService.getConfig("application.yml");`, Spring\'s The Spring injection is also consistent with properties.\n28. \n29. ### 4. Classification of Namespace access rights\n30. \n31. There are two types of access permissions for Namespace.\n32. \n33.   * private (private)\n34.   * public (public)\n35. \n36. The access rights here are relative to the Apollo client.\n37. \n38. #### 4.1 Private Permissions\n39. \n40. Namespace with private access can only be accessed by the application it belongs to. If an application tries to get the private namespace of another application, Apollo will report a `404 ` exception.\n41. \n42. #### 4.2 Public Permissions\n43. \n44. Namespace with public privileges can be fetched by any application.\n45. \n46. ### 5. Types of Namespace\n47. \n48. There are three types of Namespace.\n49. \n50.   * private type\n51.   * public type  \n52.   * Associated types (inherited types)\n53. \n54. #### 5.1 Private Types\n55. \n56. Namespace of private type has private permission. For example, the  `application` Namespace mentioned above is a private type.\n57. \n58. \n59. #### 5.2 Public Types\n60. \n61. ##### 5.2.1 Meaning\n62. \n63. Namespace of a public type has public privileges. A public type Namespace is equivalent to a configuration that is outside the application and identifies the public Namespace by its name, so the name of the public Namespace must be globally unique.\n64. \n65. ##### 5.2.2 Usage Scenarios\n66. \n67.   * Department-level shared configurations\n68.   * Configurations shared at the group level\n69.   * Configurations shared between several projects\n70.   * Configuration for middleware clients\n71. \n72. \n73. #### 5.3 Association Types\n74. \n75. ##### 5.3.1 Meaning\n76. \n77. An association type may also be called an inherited type, and the association type has private privileges. The Namespace of an association type inherits from the Namespace of a public type and is used to override certain configurations of the public Namespace. For example, the public Namespace has two configuration items \n78. \n79. ```\n80. k1 = v1\n81. k2 = v2\n82. ```\n83. \n84. Then application A has an associated type of Namespace associated with this public Namespace and overrides the configuration item k1 with a new value of v3. Then when application A actually runs, the configuration of the public Namespace is obtained as\n85. \n86. ```\n87. k1 = v3\n88. k2 = v2\n89. ```\n90. \n91. ##### 5.3.2 Usage Scenarios\n92. \n93. Give a real-world usage scenario. Assume that the configuration of the RPC framework (e.g., timeout) has the following requirements.\n94. \n95.   * Provide a company-wide default configuration that can be dynamically adjusted\n96.   * RPC client projects can customize certain configuration items and can be dynamically adjusted\n97. \n98. 1. If you remove  `dynamically adjustable` from the above two requirements, the approach is simple. There is a configuration file in the rpc-client.jar package, and each time you modify the configuration file, you can resend a new version of the jar package. Similarly, the same is true for client-side projects.\n99. 2. If only the client project is supported, the configuration can be dynamically adjusted. The client project can configure some configuration items on Apollo  `application` Namespace. When initializing the service, just read the configuration from Apollo. The disadvantage of this is that each project has to customize some keys, which is not uniform. 3.\n100. 3. so how to support the above requirements perfectly? The answer is to use a combination of Apollo\'s public type Namespace and the associated type Namespace. The code in rpc-client.jar reads the configuration of the `rpc-client` Namespace. If you need to adjust the default configuration, just change the configuration of the public type `rpc-client` Namespace. If a client project wants to customize or dynamically modify some configuration items, simply associate `rpc-client` with Apollo\'s own project to create a Namespace of the associated type  `rpc-client`. Then you can modify the configuration items under the Namespace of the associated type `rpc-client`. One thing we need to point out here is that rpc-client.jar is running in the application container, so the configuration of the `rpc-client` Namespace that rpc-client gets is the namespace of the associated type of the application plus the namespace of the public type Namespace.\n101. \n102. #### 5.4 Example\n103. \n104. As shown in the following figure, there are three applications: Application A, Application B, and Application C.\n105. \n106.  * Application A has two Namespace of private type: application and NS-Private, and one Namespace of associated type: NS-Public.\n107.  * Application B has one Namespace of private type: application, and one Namespace of public type: NS-Public.\n108.  * Application C has only one Namespace of type private: application\n109. \n110. ![Namespace Example](https://cdn.jsdelivr.net/gh/apolloconfig/apollo@master/doc/images/namespace-model-example.png)\n111. \n112. ##### 5.4.1 Application A gets the Apollo configuration\n113. \n114. ```java\n115.   //application \n116.   Config appConfig = ConfigService.getAppConfig();\n117.   appConfig.getProperty("k1", null); // k1 = v11\n118.   appConfig.getProperty("k2", null); // k2 = v21\n119.   \n120.   // NS-Private\n121.   Config privateConfig = ConfigService.getConfig("NS-Private");\n122.   privateConfig.getProperty("k1", null); // k1 = v3\n123.   privateConfig.getProperty("k3", null); // k3 = v4\n124.   \n125.   // NS-Public, overrides the case of public type configuration, k4 is overridden\n126.   Config publicConfig = ConfigService.getConfig("NS-Public");\n127.   publicConfig.getProperty("k4", null); // k4 = v6 cover\n128.   publicConfig.getProperty("k6", null); // k6 = v6\n129.   publicConfig.getProperty("k7", null); // k7 = v7\n130. ```\n131. \n132. ##### 5.4.2 Application B to get Apollo configuration\n133. \n134. ``` java\n135.   //application\n136.   Config appConfig = ConfigService.getAppConfig();\n137.   appConfig.getProperty("k1", null); // k1 = v12\n138.   appConfig.getProperty("k2", null); // k2 = null\n139.   appConfig.getProperty("k3", null); // k3 = v32\n140.   \n141.   // NS-Private, since there is no NS-Private Namespace so we get the default value\n142.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");\n143.   privateConfig.getProperty("k1", "default value"); \n144.   \n145.   //NS-Public\n146.   Config publicConfig = ConfigService.getConfig("NS-Public");\n147.   publicConfig.getProperty("k4", null); // k4 = v5\n148.   publicConfig.getProperty("k6", null); // k6 = v6\n149.   publicConfig.getProperty("k7", null); // k7 = v7\n150. ```\n151. \n152. ##### 5.4.3 Applying C to get Apollo configuration\n153. \n154. ``` java\n155.   //application\n156.   Config appConfig = ConfigService.getAppConfig();\n157.   appConfig.getProperty("k1", null); // k1 = v12\n158.   appConfig.getProperty("k2", null); // k2 = null\n159.   appConfig.getProperty("k3", null); // k3 = v33\n160.   \n161.   // NS-Private, since there is no NS-Private Namespace so we get the default value\n162.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");\n163.   privateConfig.getProperty("k1", "default value"); \n164.   \n165.   //NS-Public, the public type Namespace, which any project can get\n166.   Config publicConfig = ConfigServi\n167. \n168. ```\n169. \n170. ##### 5.4.4 ChangeListener\n171. \n172. As you can see in the above code example, the Client Namespace is mapped to a Config object. Listeners for namespace configuration changes are registered on the Config object.\n173. \n174. So the Namespace code that monitors the application in application A is as follows:\n175. \n176. ````java\n177. Config appConfig = ConfigService.getAppConfig();\n178. appConfig.addChangeListener(new ConfigChangeListener() {\n179.   public void onChange(ConfigChangeEvent changeEvent) {\n180.     //do something\n181.   }\n182. })\n183. ````\n184. \n185. The Namespace code for monitoring NS-Private in application A is as follows:\n186. \n187. ````java\n188. Config privateConfig = ConfigService.getConfig("NS-Private");\n189. privateConfig.addChangeListener(new ConfigChangeListener() {\n190.   public void onChange(ConfigChangeEvent changeEvent) {\n191.     //do something\n192.   }\n193. })\n194. ````\n195. \n196. The Namespace code for monitoring NS-Public in application A, application B, and application C is as follows:\n197. \n198. ````java\n199. Config publicConfig = ConfigService.getConfig("NS-Public");\n200. publicConfig.addChangeListener(new ConfigChangeListener() {\n201.   public void onChange(ConfigChangeEvent changeEvent) {\n202.     //do something\n203.   }\n204. })\n205. ````', 'start_line_number': 1, 'end_line_number': 205}]}]
2025-11-12 11:21:14,952 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 1 memories from memory
2025-11-12 11:21:14,952 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 36 contexts from memory
2025-11-12 11:21:14,953 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 36 contexts from memory
2025-11-12 11:21:14,955 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 36 new contexts to 36 existing contexts
2025-11-12 11:21:14,958 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 36 total contexts (removed 36 duplicates)
2025-11-12 11:21:14,960 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


OBJECTIVE: Find ALL self-contained context needed to accurately classify this issue as a bug, feature request, documentation update, or question.

<reasoning>
1. Analyze issue characteristics:
   - Error patterns suggesting bugs
   - New functionality requests
   - Documentation gaps
   - Knowledge-seeking patterns

2. Search strategy:
   - Implementation files matching descriptions
   - Similar existing features
   - Documentation coverage
   - Related Q&A patterns

3. Required context categories:
   - Core implementations
   - Feature interfaces
   - Documentation files
   - Test coverage
   - Configuration settings
   - Issue history
</reasoning>

REQUIREMENTS:
- Context MUST be fully self-contained
- MUST include complete file paths
- MUST include full function/class implementations
- MUST preserve all code structure and formatting
- MUST include line numbers

<examples>
<example id="error-classification">
<issue>
Database queries timing out randomly
Error: Connection pool exhausted
</issue>

<search_targets>
1. Connection pool implementation
2. Database configuration
3. Error handling code
4. Related timeout settings
</search_targets>

<expected_context>
- Complete connection pool class
- Full database configuration
- Error handling implementations
- Timeout management code
</expected_context>
</example>
</examples>

Search priority:
1. Implementation patterns matching issue
2. Feature definitions and interfaces
3. Documentation coverage
4. Configuration schemas
5. Test implementations
6. Integration patterns

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full source (with line numbers) of the namespace creation and query handlers in apollo-portal and apollo-biz, including NamespaceController, NamespaceService, related validators/entities/repositories, and the docs/en/design/apollo-core-concept-namespace.md.
Extra Requirements: If exact file names are unclear, please share all classes under apollo-portal/src/main/java and apollo-biz/src/main/java whose names contain 'Namespace' and any REST endpoints for namespace operations, plus any tests referencing namespace naming.
Purpose: This will allow verifying expected naming rules and whether a single dot should be rejected or supported, identifying the cause of the 500 and correctly classifying the issue.

Previous refined query 2:
Essential Query: Please provide the full source (with line numbers) of namespace-related controllers and endpoints in apollo-adminservice and the Portal NamespaceAPI client implementations that call them, focusing on mappings and validations for namespace operations.
Extra Requirements: If sending all files is too large, include at least classes whose names contain 'Namespace' under apollo-adminservice/src/main/java and apollo-portal/src/main/java that implement the namespaceAPI client, showing all @GetMapping/@PostMapping routes with path variables for namespaceName.
Purpose: This will verify whether backend path variable mappings support single-dot names and identify the source of the 500 to classify the issue accurately.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java
Line number range: 28 - 75
Content:
28. @Entity
29. @Table(name = "Namespace")
30. @SQLDelete(sql = "Update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")
31. @Where(clause = "isDeleted = 0")
32. public class Namespace extends BaseEntity {
33. 
34.   @Column(name = "appId", nullable = false)
35.   private String appId;
36. 
37.   @Column(name = "ClusterName", nullable = false)
38.   private String clusterName;
39. 
40.   @Column(name = "NamespaceName", nullable = false)
41.   private String namespaceName;
42. 
43.   public Namespace(){
44. 
45.   }
46. 
47.   public Namespace(String appId, String clusterName, String namespaceName) {
48.     this.appId = appId;
49.     this.clusterName = clusterName;
50.     this.namespaceName = namespaceName;
51.   }
52. 
53.   public String getAppId() {
54.     return appId;
55.   }
56. 
57.   public String getClusterName() {
58.     return clusterName;
59.   }
60. 
61.   public String getNamespaceName() {
62.     return namespaceName;
63.   }
64. 
65.   public void setAppId(String appId) {
66.     this.appId = appId;
67.   }
68. 
69.   public void setClusterName(String clusterName) {
70.     this.clusterName = clusterName;
71.   }
72. 
73.   public void setNamespaceName(String namespaceName) {
74.     this.namespaceName = namespaceName;
75.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java
Line number range: 29 - 51
Content:
29. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long>{
30. 
31.   AppNamespace findByAppIdAndName(String appId, String namespaceName);
32. 
33.   List<AppNamespace> findByAppIdAndNameIn(String appId, Set<String> namespaceNames);
34. 
35.   AppNamespace findByNameAndIsPublicTrue(String namespaceName);
36. 
37.   List<AppNamespace> findByNameInAndIsPublicTrue(Set<String> namespaceNames);
38. 
39.   List<AppNamespace> findByAppIdAndIsPublic(String appId, boolean isPublic);
40. 
41.   List<AppNamespace> findByAppIdOrderByIdAsc(String appId);
42. 
43.   List<AppNamespace> findFirst500ByIdGreaterThanOrderByIdAsc(long id);
44. 
45.   @Modifying
46.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?2 WHERE AppId=?1 and IsDeleted = 0")
47.   int batchDeleteByAppId(String appId, String operator);
48. 
49.   @Modifying
50.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")
51.   int delete(String appId, String namespaceName, String operator);


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java
Line number range: 29 - 46
Content:
29. public interface NamespaceRepository extends PagingAndSortingRepository<Namespace, Long> {
30. 
31.   List<Namespace> findByAppIdAndClusterNameOrderByIdAsc(String appId, String clusterName);
32. 
33.   Namespace findByAppIdAndClusterNameAndNamespaceName(String appId, String clusterName, String namespaceName);
34. 
35.   @Modifying
36.   @Query("update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 where appId=?1 and clusterName=?2 and IsDeleted = 0")
37.   int batchDelete(String appId, String clusterName, String operator);
38. 
39.   List<Namespace> findByAppIdAndNamespaceNameOrderByIdAsc(String appId, String namespaceName);
40. 
41.   List<Namespace> findByNamespaceName(String namespaceName, Pageable page);
42. 
43.   List<Namespace> findByIdIn(Set<Long> namespaceIds);
44. 
45.   int countByNamespaceNameAndAppIdNot(String namespaceName, String appId);
46. 


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 63 - 72
Content:
63.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {
64.     Objects.requireNonNull(appId, "AppId must not be null");
65.     Objects.requireNonNull(namespaceName, "Namespace must not be null");
66.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));
67.   }
68. 
69.   public AppNamespace findPublicNamespaceByName(String namespaceName) {
70.     Preconditions.checkArgument(namespaceName != null, "Namespace must not be null");
71.     return appNamespaceRepository.findByNameAndIsPublicTrue(namespaceName);
72.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 104 - 120
Content:
104.   @Transactional
105.   public void createDefaultAppNamespace(String appId, String createBy) {
106.     if (!isAppNamespaceNameUnique(appId, ConfigConsts.NAMESPACE_APPLICATION)) {
107.       throw new ServiceException("appnamespace not unique");
108.     }
109.     AppNamespace appNs = new AppNamespace();
110.     appNs.setAppId(appId);
111.     appNs.setName(ConfigConsts.NAMESPACE_APPLICATION);
112.     appNs.setComment("default app namespace");
113.     appNs.setFormat(ConfigFileFormat.Properties.getValue());
114.     appNs.setDataChangeCreatedBy(createBy);
115.     appNs.setDataChangeLastModifiedBy(createBy);
116.     appNamespaceRepository.save(appNs);
117. 
118.     auditService.audit(AppNamespace.class.getSimpleName(), appNs.getId(), Audit.OP.INSERT,
119.                        createBy);
120.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 122 - 138
Content:
122.   @Transactional
123.   public AppNamespace createAppNamespace(AppNamespace appNamespace) {
124.     String createBy = appNamespace.getDataChangeCreatedBy();
125.     if (!isAppNamespaceNameUnique(appNamespace.getAppId(), appNamespace.getName())) {
126.       throw new ServiceException("appnamespace not unique");
127.     }
128.     appNamespace.setId(0);//protection
129.     appNamespace.setDataChangeCreatedBy(createBy);
130.     appNamespace.setDataChangeLastModifiedBy(createBy);
131. 
132.     appNamespace = appNamespaceRepository.save(appNamespace);
133. 
134.     createNamespaceForAppNamespaceInAllCluster(appNamespace.getAppId(), appNamespace.getName(), createBy);
135. 
136.     auditService.audit(AppNamespace.class.getSimpleName(), appNamespace.getId(), Audit.OP.INSERT, createBy);
137.     return appNamespace;
138.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 151 - 170
Content:
151.   public void createNamespaceForAppNamespaceInAllCluster(String appId, String namespaceName, String createBy) {
152.     List<Cluster> clusters = clusterService.findParentClusters(appId);
153. 
154.     for (Cluster cluster : clusters) {
155. 
156.       // in case there is some dirty data, e.g. public namespace deleted in other app and now created in this app
157.       if (!namespaceService.isNamespaceUnique(appId, cluster.getName(), namespaceName)) {
158.         continue;
159.       }
160. 
161.       Namespace namespace = new Namespace();
162.       namespace.setClusterName(cluster.getName());
163.       namespace.setAppId(appId);
164.       namespace.setNamespaceName(namespaceName);
165.       namespace.setDataChangeCreatedBy(createBy);
166.       namespace.setDataChangeLastModifiedBy(createBy);
167. 
168.       namespaceService.save(namespace);
169.     }
170.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 104 - 107
Content:
104.   public Namespace findOne(String appId, String clusterName, String namespaceName) {
105.     return namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, clusterName,
106.                                                                          namespaceName);
107.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 112 - 122
Content:
112.   public Page<Namespace> findByItem(String itemKey, Pageable pageable) {
113.     Page<Item> items = itemService.findItemsByKey(itemKey, pageable);
114. 
115.     if (!items.hasContent()) {
116.       return Page.empty();
117.     }
118. 
119.     Set<Long> namespaceIds = BeanUtils.toPropertySet("namespaceId", items.getContent());
120. 
121.     return new PageImpl<>(namespaceRepository.findByIdIn(namespaceIds));
122.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 175 - 186
Content:
175.   public List<Namespace> findPublicAppNamespaceAllNamespaces(String namespaceName, Pageable page) {
176.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);
177. 
178.     if (publicAppNamespace == null) {
179.       throw new BadRequestException(
180.           String.format("Public appNamespace not exists. NamespaceName = %s", namespaceName));
181.     }
182. 
183.     List<Namespace> namespaces = namespaceRepository.findByNamespaceName(namespaceName, page);
184. 
185.     return filterChildNamespace(namespaces);
186.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 215 - 225
Content:
215.   public List<Namespace> findNamespaces(String appId, String clusterName) {
216.     List<Namespace> namespaces = namespaceRepository.findByAppIdAndClusterNameOrderByIdAsc(appId, clusterName);
217.     if (namespaces == null) {
218.       return Collections.emptyList();
219.     }
220.     return namespaces;
221.   }
222. 
223.   public List<Namespace> findByAppIdAndNamespaceName(String appId, String namespaceName) {
224.     return namespaceRepository.findByAppIdAndNamespaceNameOrderByIdAsc(appId, namespaceName);
225.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 283 - 359
Content:
283.   public boolean isNamespaceUnique(String appId, String cluster, String namespace) {
284.     Objects.requireNonNull(appId, "AppId must not be null");
285.     Objects.requireNonNull(cluster, "Cluster must not be null");
286.     Objects.requireNonNull(namespace, "Namespace must not be null");
287.     return Objects.isNull(
288.         namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, cluster, namespace));
289.   }
290. 
291.   @Transactional
292.   public void deleteByAppIdAndClusterName(String appId, String clusterName, String operator) {
293. 
294.     List<Namespace> toDeleteNamespaces = findNamespaces(appId, clusterName);
295. 
296.     for (Namespace namespace : toDeleteNamespaces) {
297. 
298.       deleteNamespace(namespace, operator);
299. 
300.     }
301.   }
302. 
303.   @Transactional
304.   public Namespace deleteNamespace(Namespace namespace, String operator) {
305.     String appId = namespace.getAppId();
306.     String clusterName = namespace.getClusterName();
307.     String namespaceName = namespace.getNamespaceName();
308. 
309.     itemService.batchDelete(namespace.getId(), operator);
310.     commitService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);
311. 
312.     // Child namespace releases should retain as long as the parent namespace exists, because parent namespaces' release
313.     // histories need them
314.     if (!isChildNamespace(namespace)) {
315.       releaseService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);
316.     }
317. 
318.     //delete child namespace
319.     Namespace childNamespace = findChildNamespace(namespace);
320.     if (childNamespace != null) {
321.       namespaceBranchService.deleteBranch(appId, clusterName, namespaceName,
322.                                           childNamespace.getClusterName(), NamespaceBranchStatus.DELETED, operator);
323.       //delete child namespace's releases. Notice: delete child namespace will not delete child namespace's releases
324.       releaseService.batchDelete(appId, childNamespace.getClusterName(), namespaceName, operator);
325.     }
326. 
327.     releaseHistoryService.batchDelete(appId, clusterName, namespaceName, operator);
328. 
329.     instanceService.batchDeleteInstanceConfig(appId, clusterName, namespaceName);
330. 
331.     namespaceLockService.unlock(namespace.getId());
332. 
333.     namespace.setDeleted(true);
334.     namespace.setDataChangeLastModifiedBy(operator);
335. 
336.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.DELETE, operator);
337. 
338.     Namespace deleted = namespaceRepository.save(namespace);
339. 
340.     //Publish release message to do some clean up in config service, such as updating the cache
341.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),
342.         Topics.APOLLO_RELEASE_TOPIC);
343. 
344.     return deleted;
345.   }
346. 
347.   @Transactional
348.   public Namespace save(Namespace entity) {
349.     if (!isNamespaceUnique(entity.getAppId(), entity.getClusterName(), entity.getNamespaceName())) {
350.       throw new ServiceException("namespace not unique");
351.     }
352.     entity.setId(0);//protection
353.     Namespace namespace = namespaceRepository.save(entity);
354. 
355.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.INSERT,
356.                        namespace.getDataChangeCreatedBy());
357. 
358.     return namespace;
359.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 374 - 389
Content:
374.   @Transactional
375.   public void instanceOfAppNamespaces(String appId, String clusterName, String createBy) {
376. 
377.     List<AppNamespace> appNamespaces = appNamespaceService.findByAppId(appId);
378. 
379.     for (AppNamespace appNamespace : appNamespaces) {
380.       Namespace ns = new Namespace();
381.       ns.setAppId(appId);
382.       ns.setClusterName(clusterName);
383.       ns.setNamespaceName(appNamespace.getName());
384.       ns.setDataChangeCreatedBy(createBy);
385.       ns.setDataChangeLastModifiedBy(createBy);
386.       namespaceRepository.save(ns);
387.       auditService.audit(Namespace.class.getSimpleName(), ns.getId(), Audit.OP.INSERT, createBy);
388.     }
389. 


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java
Line number range: 38 - 45
Content:
38.   @NotBlank(message = "AppNamespace Name cannot be blank")
39.   @Pattern(
40.       regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR,
41.       message = "Invalid Namespace format: " + InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE
42.   )
43.   @Column(name = "Name", nullable = false)
44.   private String name;
45. 


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
Line number range: 27 - 46
Content:
27.   public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbol - _ . are allowed";
28.   public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE = "not allowed to end with .json, .yml, .yaml, .xml, .properties";
29.   public static final String CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+";
30.   private static final String APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$";
31.   private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);
32.   private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);
33. 
34.   public static boolean isValidClusterNamespace(String name) {
35.     if (StringUtils.isEmpty(name)){
36.       return false;
37.     }
38.     return CLUSTER_NAMESPACE_PATTERN.matcher(name).matches();
39.   }
40. 
41.   public static boolean isValidAppNamespace(String name){
42.     if (StringUtils.isEmpty(name)){
43.       return false;
44.     }
45.     return APP_NAMESPACE_PATTERN.matcher(name).matches();
46.   }


File: apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java
Line number range: 35 - 45
Content:
35.   public void testValidAppNamespaceName() throws Exception {
36.     checkAppNamespaceName("some.cluster-_name.123", true);
37.     checkAppNamespaceName("some.&.name", false);
38.     checkAppNamespaceName("", false);
39.     checkAppNamespaceName(null, false);
40.     checkAppNamespaceName("some.name.json", false);
41.     checkAppNamespaceName("some.name.yml", false);
42.     checkAppNamespaceName("some.name.yaml", false);
43.     checkAppNamespaceName("some.name.xml", false);
44.     checkAppNamespaceName("some.name.properties", false);
45.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java
Line number range: 52 - 81
Content:
52.   @PreAuthorize(value = "@consumerPermissionValidator.hasCreateNamespacePermission(#request, #appId)")
53.   @PostMapping(value = "/openapi/v1/apps/{appId}/appnamespaces")
54.   public OpenAppNamespaceDTO createNamespace(@PathVariable String appId,
55.                                              @RequestBody OpenAppNamespaceDTO appNamespaceDTO,
56.                                              HttpServletRequest request) {
57. 
58.     if (!Objects.equals(appId, appNamespaceDTO.getAppId())) {
59.       throw new BadRequestException(String.format("AppId not equal. AppId in path = %s, AppId in payload = %s", appId,
60.                                                   appNamespaceDTO.getAppId()));
61.     }
62.     RequestPrecondition.checkArgumentsNotEmpty(appNamespaceDTO.getAppId(), appNamespaceDTO.getName(),
63.                                                appNamespaceDTO.getFormat(), appNamespaceDTO.getDataChangeCreatedBy());
64. 
65.     if (!InputValidator.isValidAppNamespace(appNamespaceDTO.getName())) {
66.       throw new BadRequestException(String.format("Invalid Namespace format: %s",
67.                                                   InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & "
68.                                                   + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
69.     }
70. 
71.     if (!ConfigFileFormat.isValidFormat(appNamespaceDTO.getFormat())) {
72.       throw new BadRequestException(String.format("Invalid namespace format. format = %s", appNamespaceDTO.getFormat()));
73.     }
74. 
75.     String operator = appNamespaceDTO.getDataChangeCreatedBy();
76.     if (userService.findByUserId(operator) == null) {
77.       throw new BadRequestException(String.format("Illegal user. user = %s", operator));
78.     }
79. 
80.     return this.namespaceOpenApiService.createAppNamespace(appNamespaceDTO);
81.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java
Line number range: 83 - 94
Content:
83.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces")
84.   public List<OpenNamespaceDTO> findNamespaces(@PathVariable String appId, @PathVariable String env,
85.                                                @PathVariable String clusterName) {
86.     return this.namespaceOpenApiService.getNamespaces(appId, env, clusterName);
87.   }
88. 
89.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
90.   public OpenNamespaceDTO loadNamespace(@PathVariable String appId, @PathVariable String env,
91.                                         @PathVariable String clusterName, @PathVariable String
92.                                             namespaceName) {
93.     return this.namespaceOpenApiService.getNamespace(appId, env, clusterName, namespaceName);
94.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 105 - 118
Content:
105.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces")
106.   public List<NamespaceBO> findNamespaces(@PathVariable String appId, @PathVariable String env,
107.                                           @PathVariable String clusterName) {
108. 
109.     List<NamespaceBO> namespaceBOs = namespaceService.findNamespaceBOs(appId, Env.valueOf(env), clusterName);
110. 
111.     for (NamespaceBO namespaceBO : namespaceBOs) {
112.       if (permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceBO.getBaseInfo().getNamespaceName())) {
113.         namespaceBO.hideItems();
114.       }
115.     }
116. 
117.     return namespaceBOs;
118.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 120 - 131
Content:
120.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
121.   public NamespaceBO findNamespace(@PathVariable String appId, @PathVariable String env,
122.                                    @PathVariable String clusterName, @PathVariable String namespaceName) {
123. 
124.     NamespaceBO namespaceBO = namespaceService.loadNamespaceBO(appId, Env.valueOf(env), clusterName, namespaceName);
125. 
126.     if (namespaceBO != null && permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceName)) {
127.       namespaceBO.hideItems();
128.     }
129. 
130.     return namespaceBO;
131.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 142 - 170
Content:
142.   @PreAuthorize(value = "@permissionValidator.hasCreateNamespacePermission(#appId)")
143.   @PostMapping("/apps/{appId}/namespaces")
144.   public ResponseEntity<Void> createNamespace(@PathVariable String appId,
145.                                               @RequestBody List<NamespaceCreationModel> models) {
146. 
147.     checkModel(!CollectionUtils.isEmpty(models));
148.     String operator = userInfoHolder.getUser().getUserId();
149. 
150.     for (NamespaceCreationModel model : models) {
151.       String namespaceName = model.getNamespace().getNamespaceName();
152.       roleInitializationService.initNamespaceRoles(appId, namespaceName, operator);
153.       roleInitializationService.initNamespaceEnvRoles(appId, namespaceName, operator);
154.       NamespaceDTO namespace = model.getNamespace();
155.       RequestPrecondition.checkArgumentsNotEmpty(model.getEnv(), namespace.getAppId(),
156.                                                  namespace.getClusterName(), namespace.getNamespaceName());
157. 
158.       try {
159.         namespaceService.createNamespace(Env.valueOf(model.getEnv()), namespace);
160.       } catch (Exception e) {
161.         logger.error("create namespace fail.", e);
162.         Tracer.logError(
163.                 String.format("create namespace fail. (env=%s namespace=%s)", model.getEnv(),
164.                         namespace.getNamespaceName()), e);
165.       }
166.       namespaceService.assignNamespaceRoleToOperator(appId, namespaceName,userInfoHolder.getUser().getUserId());
167.     }
168. 
169.     return ResponseEntity.ok().build();
170.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 172 - 180
Content:
172.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
173.   @DeleteMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName:.+}")
174.   public ResponseEntity<Void> deleteLinkedNamespace(@PathVariable String appId, @PathVariable String env,
175.       @PathVariable String clusterName, @PathVariable String namespaceName) {
176. 
177.     namespaceService.deleteNamespace(appId, Env.valueOf(env), clusterName, namespaceName);
178. 
179.     return ResponseEntity.ok().build();
180.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 182 - 187
Content:
182.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName}/usage")
183.   public List<NamespaceUsage> findLinkedNamespaceUsage(@PathVariable String appId, @PathVariable String env,
184.       @PathVariable String clusterName, @PathVariable String namespaceName) {
185.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(appId, namespaceName, Env.valueOf(env), clusterName);
186.     return Lists.newArrayList(usage);
187.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 194 - 203
Content:
194.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
195.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
196.   public ResponseEntity<Void> deleteAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
197. 
198.     AppNamespace appNamespace = appNamespaceService.deleteAppNamespace(appId, namespaceName);
199. 
200.     publisher.publishEvent(new AppNamespaceDeletionEvent(appNamespace));
201. 
202.     return ResponseEntity.ok().build();
203.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 205 - 215
Content:
205.   @GetMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
206.   public AppNamespaceDTO findAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
207.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);
208. 
209.     if (appNamespace == null) {
210.       throw new BadRequestException(
211.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));
212.     }
213. 
214.     return BeanUtils.transform(AppNamespaceDTO.class, appNamespace);
215.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 217 - 237
Content:
217.   @PreAuthorize(value = "@permissionValidator.hasCreateAppNamespacePermission(#appId, #appNamespace)")
218.   @PostMapping("/apps/{appId}/appnamespaces")
219.   public AppNamespace createAppNamespace(@PathVariable String appId,
220.       @RequestParam(defaultValue = "true") boolean appendNamespacePrefix,
221.       @Valid @RequestBody AppNamespace appNamespace) {
222.     if (!InputValidator.isValidAppNamespace(appNamespace.getName())) {
223.       throw new BadRequestException(String.format("Invalid Namespace format: %s",
224.           InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
225.     }
226. 
227.     AppNamespace createdAppNamespace = appNamespaceService.createAppNamespaceInLocal(appNamespace, appendNamespacePrefix);
228. 
229.     if (portalConfig.canAppAdminCreatePrivateNamespace() || createdAppNamespace.isPublic()) {
230.       namespaceService.assignNamespaceRoleToOperator(appId, appNamespace.getName(),
231.           userInfoHolder.getUser().getUserId());
232.     }
233. 
234.     publisher.publishEvent(new AppNamespaceCreationEvent(createdAppNamespace));
235. 
236.     return createdAppNamespace;
237.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 251 - 259
Content:
251.   @GetMapping("/envs/{env}/appnamespaces/{publicNamespaceName}/namespaces")
252.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(@PathVariable String env,
253.                                                                @PathVariable String publicNamespaceName,
254.                                                                @RequestParam(name = "page", defaultValue = "0") int page,
255.                                                                @RequestParam(name = "size", defaultValue = "10") int size) {
256. 
257.     return namespaceService.getPublicAppNamespaceAllNamespaces(Env.valueOf(env), publicNamespaceName, page, size);
258. 
259.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java
Line number range: 25 - 44
Content:
25. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long> {
26. 
27.   AppNamespace findByAppIdAndName(String appId, String namespaceName);
28. 
29.   AppNamespace findByName(String namespaceName);
30. 
31.   List<AppNamespace> findByNameAndIsPublic(String namespaceName, boolean isPublic);
32. 
33.   List<AppNamespace> findByIsPublicTrue();
34. 
35.   List<AppNamespace> findByAppId(String appId);
36. 
37.   @Modifying
38.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy=?2 WHERE AppId=?1 and IsDeleted = 0")
39.   int batchDeleteByAppId(String appId, String operator);
40. 
41.   @Modifying
42.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")
43.   int delete(String appId, String namespaceName, String operator);
44. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 115 - 171
Content:
115.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {
116.     Objects.requireNonNull(appId, "AppId must not be null");
117.     Objects.requireNonNull(namespaceName, "Namespace must not be null");
118.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));
119.   }
120. 
121.   @Transactional
122.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace) {
123.     return createAppNamespaceInLocal(appNamespace, true);
124.   }
125. 
126.   @Transactional
127.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace, boolean appendNamespacePrefix) {
128.     String appId = appNamespace.getAppId();
129. 
130.     //add app org id as prefix
131.     App app = appService.load(appId);
132.     if (app == null) {
133.       throw new BadRequestException("App not exist. AppId = " + appId);
134.     }
135. 
136.     StringBuilder appNamespaceName = new StringBuilder();
137.     //add prefix postfix
138.     appNamespaceName
139.         .append(appNamespace.isPublic() && appendNamespacePrefix ? app.getOrgId() + "." : "")
140.         .append(appNamespace.getName())
141.         .append(appNamespace.formatAsEnum() == ConfigFileFormat.Properties ? "" : "." + appNamespace.getFormat());
142.     appNamespace.setName(appNamespaceName.toString());
143. 
144.     if (appNamespace.getComment() == null) {
145.       appNamespace.setComment("");
146.     }
147. 
148.     if (!ConfigFileFormat.isValidFormat(appNamespace.getFormat())) {
149.      throw new BadRequestException("Invalid namespace format. format must be properties、json、yaml、yml、xml");
150.     }
151. 
152.     String operator = appNamespace.getDataChangeCreatedBy();
153.     if (StringUtils.isEmpty(operator)) {
154.       operator = userInfoHolder.getUser().getUserId();
155.       appNamespace.setDataChangeCreatedBy(operator);
156.     }
157. 
158.     appNamespace.setDataChangeLastModifiedBy(operator);
159. 
160.     // globally uniqueness check for public app namespace
161.     if (appNamespace.isPublic()) {
162.       checkAppNamespaceGlobalUniqueness(appNamespace);
163.     } else {
164.       // check private app namespace
165.       if (appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName()) != null) {
166.         throw new BadRequestException("Private AppNamespace " + appNamespace.getName() + " already exists!");
167.       }
168.       // should not have the same with public app namespace
169.       checkPublicAppNamespaceGlobalUniqueness(appNamespace);
170.     }
171. 


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 172 - 178
Content:
172.     AppNamespace createdAppNamespace = appNamespaceRepository.save(appNamespace);
173. 
174.     roleInitializationService.initNamespaceRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
175.     roleInitializationService.initNamespaceEnvRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
176. 
177.     return createdAppNamespace;
178.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 204 - 222
Content:
204.   private void checkAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {
205.     checkPublicAppNamespaceGlobalUniqueness(appNamespace);
206. 
207.     List<AppNamespace> privateAppNamespaces = findAllPrivateAppNamespaces(appNamespace.getName());
208. 
209.     if (!CollectionUtils.isEmpty(privateAppNamespaces)) {
210.       Set<String> appIds = Sets.newHashSet();
211.       for (AppNamespace ans : privateAppNamespaces) {
212.         appIds.add(ans.getAppId());
213.         if (appIds.size() == PRIVATE_APP_NAMESPACE_NOTIFICATION_COUNT) {
214.           break;
215.         }
216.       }
217. 
218.       throw new BadRequestException(
219.           "Public AppNamespace " + appNamespace.getName() + " already exists as private AppNamespace in appId: "
220.               + APP_NAMESPACE_JOINER.join(appIds) + ", etc. Please select another name!");
221.     }
222.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 224 - 229
Content:
224.   private void checkPublicAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {
225.     AppNamespace publicAppNamespace = findPublicAppNamespace(appNamespace.getName());
226.     if (publicAppNamespace != null) {
227.       throw new BadRequestException("AppNamespace " + appNamespace.getName() + " already exists as public namespace in appId: " + publicAppNamespace.getAppId() + "!");
228.     }
229.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 117 - 131
Content:
117.   public NamespaceDTO createNamespace(Env env, NamespaceDTO namespace) {
118.     if (StringUtils.isEmpty(namespace.getDataChangeCreatedBy())) {
119.       namespace.setDataChangeCreatedBy(userInfoHolder.getUser().getUserId());
120.     }
121. 
122.     if (StringUtils.isEmpty(namespace.getDataChangeLastModifiedBy())) {
123.       namespace.setDataChangeLastModifiedBy(userInfoHolder.getUser().getUserId());
124.     }
125.     NamespaceDTO createdNamespace = namespaceAPI.createNamespace(env, namespace);
126. 
127.     Tracer.logEvent(TracerEventType.CREATE_NAMESPACE,
128.         String.format("%s+%s+%s+%s", namespace.getAppId(), env, namespace.getClusterName(),
129.             namespace.getNamespaceName()));
130.     return createdNamespace;
131.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 170 - 184
Content:
170.   @Transactional
171.   public void deleteNamespace(String appId, Env env, String clusterName, String namespaceName) {
172. 
173.     String operator = userInfoHolder.getUser().getUserId();
174.     namespaceAPI.deleteNamespace(env, appId, clusterName, namespaceName, operator);
175.   }
176. 
177.   public NamespaceDTO loadNamespaceBaseInfo(String appId, Env env, String clusterName,
178.       String namespaceName) {
179.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
180.     if (namespace == null) {
181.       throw new BadRequestException(String.format("Namespace: %s not exist.", namespaceName));
182.     }
183.     return namespace;
184.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 231 - 246
Content:
231.   public List<NamespaceDTO> findNamespaces(String appId, Env env, String clusterName) {
232.     return namespaceAPI.findNamespaceByCluster(appId, env, clusterName);
233.   }
234. 
235.   /**
236.    * the returned content's size is not fixed. so please carefully used.
237.    */
238.   public PageDTO<NamespaceDTO> findNamespacesByItem(Env env, String itemKey, Pageable pageable) {
239.     return namespaceAPI.findByItem(env, itemKey, pageable.getPageNumber(), pageable.getPageSize());
240.   }
241. 
242.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(Env env, String publicNamespaceName,
243.       int page,
244.       int size) {
245.     return namespaceAPI.getPublicAppNamespaceAllNamespaces(env, publicNamespaceName, page, size);
246.   }


File: docs/en/design/apollo-core-concept-namespace.md
Line number range: 1 - 205
Content:
1. ### 1. What is Namespace?
2. 
3. Namespace is a collection of configuration items, similar to the concept of a configuration file.
4. 
5. ### 2. What is an `application` Namespace?
6. 
7. When Apollo creates a project, it creates an `application` namespace by default. Spring Boot students know that Spring Boot projects have a default configuration file application.yml. here application.yml is equivalent to the `application` Namespace. For 90% of applications, the `application` namespace is sufficient for everyday configuration scenarios.
8. 
9. ####  The code for client to get the `application` Namespace is as follows.
10. 
11. ``` java
12.   Config config = ConfigService.getAppConfig();
13. ```
14. 
15. #### The code for the client to get a `non-application` Namespace is as follows.
16. 
17. ``` java
18.   Config config = ConfigService.getConfig(namespaceName);
19. ```
20. 
21. ### 3. What are the formats of Namespace?
22. 
23. Configuration files come in various formats such as properties, xml, yml, yaml, json, etc. Similarly Namespace also has these formats. In the Portal UI, you can see that the Namespace for `application` has a `properties` tag, indicating that `application` is in properties format.
24. 
25. >Note1: For the namespace in non-properties format, you need to call `ConfigService.getConfigFile(String namespace, ConfigFileFormat configFileFormat)` to get it when you use the client, if you use the [Http interface direct call](en/usage/other-language-client-user-guide), the corresponding namespace parameter needs to be passed in the namespace name plus the suffix name, such as datasources.json.
26. 
27. >Note 2: apollo-client version 1.3.0 has better support for yaml/yml, which is consistent with the properties format: `Config config = ConfigService.getConfig("application.yml");`, Spring's The Spring injection is also consistent with properties.
28. 
29. ### 4. Classification of Namespace access rights
30. 
31. There are two types of access permissions for Namespace.
32. 
33.   * private (private)
34.   * public (public)
35. 
36. The access rights here are relative to the Apollo client.
37. 
38. #### 4.1 Private Permissions
39. 
40. Namespace with private access can only be accessed by the application it belongs to. If an application tries to get the private namespace of another application, Apollo will report a `404 ` exception.
41. 
42. #### 4.2 Public Permissions
43. 
44. Namespace with public privileges can be fetched by any application.
45. 
46. ### 5. Types of Namespace
47. 
48. There are three types of Namespace.
49. 
50.   * private type
51.   * public type  
52.   * Associated types (inherited types)
53. 
54. #### 5.1 Private Types
55. 
56. Namespace of private type has private permission. For example, the  `application` Namespace mentioned above is a private type.
57. 
58. 
59. #### 5.2 Public Types
60. 
61. ##### 5.2.1 Meaning
62. 
63. Namespace of a public type has public privileges. A public type Namespace is equivalent to a configuration that is outside the application and identifies the public Namespace by its name, so the name of the public Namespace must be globally unique.
64. 
65. ##### 5.2.2 Usage Scenarios
66. 
67.   * Department-level shared configurations
68.   * Configurations shared at the group level
69.   * Configurations shared between several projects
70.   * Configuration for middleware clients
71. 
72. 
73. #### 5.3 Association Types
74. 
75. ##### 5.3.1 Meaning
76. 
77. An association type may also be called an inherited type, and the association type has private privileges. The Namespace of an association type inherits from the Namespace of a public type and is used to override certain configurations of the public Namespace. For example, the public Namespace has two configuration items 
78. 
79. ```
80. k1 = v1
81. k2 = v2
82. ```
83. 
84. Then application A has an associated type of Namespace associated with this public Namespace and overrides the configuration item k1 with a new value of v3. Then when application A actually runs, the configuration of the public Namespace is obtained as
85. 
86. ```
87. k1 = v3
88. k2 = v2
89. ```
90. 
91. ##### 5.3.2 Usage Scenarios
92. 
93. Give a real-world usage scenario. Assume that the configuration of the RPC framework (e.g., timeout) has the following requirements.
94. 
95.   * Provide a company-wide default configuration that can be dynamically adjusted
96.   * RPC client projects can customize certain configuration items and can be dynamically adjusted
97. 
98. 1. If you remove  `dynamically adjustable` from the above two requirements, the approach is simple. There is a configuration file in the rpc-client.jar package, and each time you modify the configuration file, you can resend a new version of the jar package. Similarly, the same is true for client-side projects.
99. 2. If only the client project is supported, the configuration can be dynamically adjusted. The client project can configure some configuration items on Apollo  `application` Namespace. When initializing the service, just read the configuration from Apollo. The disadvantage of this is that each project has to customize some keys, which is not uniform. 3.
100. 3. so how to support the above requirements perfectly? The answer is to use a combination of Apollo's public type Namespace and the associated type Namespace. The code in rpc-client.jar reads the configuration of the `rpc-client` Namespace. If you need to adjust the default configuration, just change the configuration of the public type `rpc-client` Namespace. If a client project wants to customize or dynamically modify some configuration items, simply associate `rpc-client` with Apollo's own project to create a Namespace of the associated type  `rpc-client`. Then you can modify the configuration items under the Namespace of the associated type `rpc-client`. One thing we need to point out here is that rpc-client.jar is running in the application container, so the configuration of the `rpc-client` Namespace that rpc-client gets is the namespace of the associated type of the application plus the namespace of the public type Namespace.
101. 
102. #### 5.4 Example
103. 
104. As shown in the following figure, there are three applications: Application A, Application B, and Application C.
105. 
106.  * Application A has two Namespace of private type: application and NS-Private, and one Namespace of associated type: NS-Public.
107.  * Application B has one Namespace of private type: application, and one Namespace of public type: NS-Public.
108.  * Application C has only one Namespace of type private: application
109. 
110. ![Namespace Example](https://cdn.jsdelivr.net/gh/apolloconfig/apollo@master/doc/images/namespace-model-example.png)
111. 
112. ##### 5.4.1 Application A gets the Apollo configuration
113. 
114. ```java
115.   //application 
116.   Config appConfig = ConfigService.getAppConfig();
117.   appConfig.getProperty("k1", null); // k1 = v11
118.   appConfig.getProperty("k2", null); // k2 = v21
119.   
120.   // NS-Private
121.   Config privateConfig = ConfigService.getConfig("NS-Private");
122.   privateConfig.getProperty("k1", null); // k1 = v3
123.   privateConfig.getProperty("k3", null); // k3 = v4
124.   
125.   // NS-Public, overrides the case of public type configuration, k4 is overridden
126.   Config publicConfig = ConfigService.getConfig("NS-Public");
127.   publicConfig.getProperty("k4", null); // k4 = v6 cover
128.   publicConfig.getProperty("k6", null); // k6 = v6
129.   publicConfig.getProperty("k7", null); // k7 = v7
130. ```
131. 
132. ##### 5.4.2 Application B to get Apollo configuration
133. 
134. ``` java
135.   //application
136.   Config appConfig = ConfigService.getAppConfig();
137.   appConfig.getProperty("k1", null); // k1 = v12
138.   appConfig.getProperty("k2", null); // k2 = null
139.   appConfig.getProperty("k3", null); // k3 = v32
140.   
141.   // NS-Private, since there is no NS-Private Namespace so we get the default value
142.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");
143.   privateConfig.getProperty("k1", "default value"); 
144.   
145.   //NS-Public
146.   Config publicConfig = ConfigService.getConfig("NS-Public");
147.   publicConfig.getProperty("k4", null); // k4 = v5
148.   publicConfig.getProperty("k6", null); // k6 = v6
149.   publicConfig.getProperty("k7", null); // k7 = v7
150. ```
151. 
152. ##### 5.4.3 Applying C to get Apollo configuration
153. 
154. ``` java
155.   //application
156.   Config appConfig = ConfigService.getAppConfig();
157.   appConfig.getProperty("k1", null); // k1 = v12
158.   appConfig.getProperty("k2", null); // k2 = null
159.   appConfig.getProperty("k3", null); // k3 = v33
160.   
161.   // NS-Private, since there is no NS-Private Namespace so we get the default value
162.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");
163.   privateConfig.getProperty("k1", "default value"); 
164.   
165.   //NS-Public, the public type Namespace, which any project can get
166.   Config publicConfig = ConfigServi
167. 
168. ```
169. 
170. ##### 5.4.4 ChangeListener
171. 
172. As you can see in the above code example, the Client Namespace is mapped to a Config object. Listeners for namespace configuration changes are registered on the Config object.
173. 
174. So the Namespace code that monitors the application in application A is as follows:
175. 
176. ````java
177. Config appConfig = ConfigService.getAppConfig();
178. appConfig.addChangeListener(new ConfigChangeListener() {
179.   public void onChange(ConfigChangeEvent changeEvent) {
180.     //do something
181.   }
182. })
183. ````
184. 
185. The Namespace code for monitoring NS-Private in application A is as follows:
186. 
187. ````java
188. Config privateConfig = ConfigService.getConfig("NS-Private");
189. privateConfig.addChangeListener(new ConfigChangeListener() {
190.   public void onChange(ConfigChangeEvent changeEvent) {
191.     //do something
192.   }
193. })
194. ````
195. 
196. The Namespace code for monitoring NS-Public in application A, application B, and application C is as follows:
197. 
198. ````java
199. Config publicConfig = ConfigService.getConfig("NS-Public");
200. publicConfig.addChangeListener(new ConfigChangeListener() {
201.   public void onChange(ConfigChangeEvent changeEvent) {
202.     //do something
203.   }
204. })
205. ````

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:21:34,152 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The context shows name validation allows a single dot and portal controllers use {namespaceName:.+}, but we lack adminservice controller mappings and the portal NamespaceAPI client that invokes them. The 500 on querying a dot namespace is likely due to backend path variable handling. To classify the issue with self-contained evidence, we need the adminservice namespace endpoints and the portal client code that calls them.' query='Please provide the full source (with line numbers) of namespace-related controllers in apollo-adminservice and the NamespaceAPI interface and its implementation in apollo-portal that call them, highlighting all @GetMapping/@PostMapping/@DeleteMapping routes handling namespace operations and their path variable patterns.' extra_requirements='If sending all files is too large, include at minimum methods for loading, listing, creating, and deleting namespaces, plus any Spring MVC configuration affecting suffix/path matching in apollo-adminservice.' purpose='This will confirm whether backend endpoints support single-dot namespace names and pinpoint the cause of the 500 to classify the issue accurately.'
2025-11-12 11:21:34,154 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full source (with line numbers) of namespace-related controllers in apollo-adminservice and the NamespaceAPI interface and its implementation in apollo-portal that call them, highlighting all @GetMapping/@PostMapping/@DeleteMapping routes handling namespace operations and their path variable patterns.
2025-11-12 11:21:36,209 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: [{'query_essential_query': 'Please provide the full source (with line numbers) of the namespace creation and query handlers in apollo-portal and apollo-biz, including NamespaceController, NamespaceService, related validators/entities/repositories, and the docs/en/design/apollo-core-concept-namespace.md.', 'query_extra_requirements': "If exact file names are unclear, please share all classes under apollo-portal/src/main/java and apollo-biz/src/main/java whose names contain 'Namespace' and any REST endpoints for namespace operations, plus any tests referencing namespace naming.", 'query_purpose': 'This will allow verifying expected naming rules and whether a single dot should be rejected or supported, identifying the cause of the 500 and correctly classifying the issue.', 'memory_context_contexts': [{'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java', 'content': '28. @Entity\n29. @Table(name = "Namespace")\n30. @SQLDelete(sql = "Update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")\n31. @Where(clause = "isDeleted = 0")\n32. public class Namespace extends BaseEntity {\n33. \n34.   @Column(name = "appId", nullable = false)\n35.   private String appId;\n36. \n37.   @Column(name = "ClusterName", nullable = false)\n38.   private String clusterName;\n39. \n40.   @Column(name = "NamespaceName", nullable = false)\n41.   private String namespaceName;\n42. \n43.   public Namespace(){\n44. \n45.   }\n46. \n47.   public Namespace(String appId, String clusterName, String namespaceName) {\n48.     this.appId = appId;\n49.     this.clusterName = clusterName;\n50.     this.namespaceName = namespaceName;\n51.   }\n52. \n53.   public String getAppId() {\n54.     return appId;\n55.   }\n56. \n57.   public String getClusterName() {\n58.     return clusterName;\n59.   }\n60. \n61.   public String getNamespaceName() {\n62.     return namespaceName;\n63.   }\n64. \n65.   public void setAppId(String appId) {\n66.     this.appId = appId;\n67.   }\n68. \n69.   public void setClusterName(String clusterName) {\n70.     this.clusterName = clusterName;\n71.   }\n72. \n73.   public void setNamespaceName(String namespaceName) {\n74.     this.namespaceName = namespaceName;\n75.   }', 'start_line_number': 28, 'end_line_number': 75}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java', 'content': '29. public interface NamespaceRepository extends PagingAndSortingRepository<Namespace, Long> {\n30. \n31.   List<Namespace> findByAppIdAndClusterNameOrderByIdAsc(String appId, String clusterName);\n32. \n33.   Namespace findByAppIdAndClusterNameAndNamespaceName(String appId, String clusterName, String namespaceName);\n34. \n35.   @Modifying\n36.   @Query("update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 where appId=?1 and clusterName=?2 and IsDeleted = 0")\n37.   int batchDelete(String appId, String clusterName, String operator);\n38. \n39.   List<Namespace> findByAppIdAndNamespaceNameOrderByIdAsc(String appId, String namespaceName);\n40. \n41.   List<Namespace> findByNamespaceName(String namespaceName, Pageable page);\n42. \n43.   List<Namespace> findByIdIn(Set<Long> namespaceIds);\n44. \n45.   int countByNamespaceNameAndAppIdNot(String namespaceName, String appId);\n46. ', 'start_line_number': 29, 'end_line_number': 46}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java', 'content': '29. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long>{\n30. \n31.   AppNamespace findByAppIdAndName(String appId, String namespaceName);\n32. \n33.   List<AppNamespace> findByAppIdAndNameIn(String appId, Set<String> namespaceNames);\n34. \n35.   AppNamespace findByNameAndIsPublicTrue(String namespaceName);\n36. \n37.   List<AppNamespace> findByNameInAndIsPublicTrue(Set<String> namespaceNames);\n38. \n39.   List<AppNamespace> findByAppIdAndIsPublic(String appId, boolean isPublic);\n40. \n41.   List<AppNamespace> findByAppIdOrderByIdAsc(String appId);\n42. \n43.   List<AppNamespace> findFirst500ByIdGreaterThanOrderByIdAsc(long id);\n44. \n45.   @Modifying\n46.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?2 WHERE AppId=?1 and IsDeleted = 0")\n47.   int batchDeleteByAppId(String appId, String operator);\n48. \n49.   @Modifying\n50.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")\n51.   int delete(String appId, String namespaceName, String operator);', 'start_line_number': 29, 'end_line_number': 51}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', 'content': '63.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {\n64.     Objects.requireNonNull(appId, "AppId must not be null");\n65.     Objects.requireNonNull(namespaceName, "Namespace must not be null");\n66.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));\n67.   }\n68. \n69.   public AppNamespace findPublicNamespaceByName(String namespaceName) {\n70.     Preconditions.checkArgument(namespaceName != null, "Namespace must not be null");\n71.     return appNamespaceRepository.findByNameAndIsPublicTrue(namespaceName);\n72.   }', 'start_line_number': 63, 'end_line_number': 72}, {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java', 'content': '38.   @NotBlank(message = "AppNamespace Name cannot be blank")\n39.   @Pattern(\n40.       regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR,\n41.       message = "Invalid Namespace format: " + InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE\n42.   )\n43.   @Column(name = "Name", nullable = false)\n44.   private String name;\n45. ', 'start_line_number': 38, 'end_line_number': 45}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', 'content': '104.   @Transactional\n105.   public void createDefaultAppNamespace(String appId, String createBy) {\n106.     if (!isAppNamespaceNameUnique(appId, ConfigConsts.NAMESPACE_APPLICATION)) {\n107.       throw new ServiceException("appnamespace not unique");\n108.     }\n109.     AppNamespace appNs = new AppNamespace();\n110.     appNs.setAppId(appId);\n111.     appNs.setName(ConfigConsts.NAMESPACE_APPLICATION);\n112.     appNs.setComment("default app namespace");\n113.     appNs.setFormat(ConfigFileFormat.Properties.getValue());\n114.     appNs.setDataChangeCreatedBy(createBy);\n115.     appNs.setDataChangeLastModifiedBy(createBy);\n116.     appNamespaceRepository.save(appNs);\n117. \n118.     auditService.audit(AppNamespace.class.getSimpleName(), appNs.getId(), Audit.OP.INSERT,\n119.                        createBy);\n120.   }', 'start_line_number': 104, 'end_line_number': 120}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', 'content': '122.   @Transactional\n123.   public AppNamespace createAppNamespace(AppNamespace appNamespace) {\n124.     String createBy = appNamespace.getDataChangeCreatedBy();\n125.     if (!isAppNamespaceNameUnique(appNamespace.getAppId(), appNamespace.getName())) {\n126.       throw new ServiceException("appnamespace not unique");\n127.     }\n128.     appNamespace.setId(0);//protection\n129.     appNamespace.setDataChangeCreatedBy(createBy);\n130.     appNamespace.setDataChangeLastModifiedBy(createBy);\n131. \n132.     appNamespace = appNamespaceRepository.save(appNamespace);\n133. \n134.     createNamespaceForAppNamespaceInAllCluster(appNamespace.getAppId(), appNamespace.getName(), createBy);\n135. \n136.     auditService.audit(AppNamespace.class.getSimpleName(), appNamespace.getId(), Audit.OP.INSERT, createBy);\n137.     return appNamespace;\n138.   }', 'start_line_number': 122, 'end_line_number': 138}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', 'content': '151.   public void createNamespaceForAppNamespaceInAllCluster(String appId, String namespaceName, String createBy) {\n152.     List<Cluster> clusters = clusterService.findParentClusters(appId);\n153. \n154.     for (Cluster cluster : clusters) {\n155. \n156.       // in case there is some dirty data, e.g. public namespace deleted in other app and now created in this app\n157.       if (!namespaceService.isNamespaceUnique(appId, cluster.getName(), namespaceName)) {\n158.         continue;\n159.       }\n160. \n161.       Namespace namespace = new Namespace();\n162.       namespace.setClusterName(cluster.getName());\n163.       namespace.setAppId(appId);\n164.       namespace.setNamespaceName(namespaceName);\n165.       namespace.setDataChangeCreatedBy(createBy);\n166.       namespace.setDataChangeLastModifiedBy(createBy);\n167. \n168.       namespaceService.save(namespace);\n169.     }\n170.   }', 'start_line_number': 151, 'end_line_number': 170}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '104.   public Namespace findOne(String appId, String clusterName, String namespaceName) {\n105.     return namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, clusterName,\n106.                                                                          namespaceName);\n107.   }', 'start_line_number': 104, 'end_line_number': 107}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '112.   public Page<Namespace> findByItem(String itemKey, Pageable pageable) {\n113.     Page<Item> items = itemService.findItemsByKey(itemKey, pageable);\n114. \n115.     if (!items.hasContent()) {\n116.       return Page.empty();\n117.     }\n118. \n119.     Set<Long> namespaceIds = BeanUtils.toPropertySet("namespaceId", items.getContent());\n120. \n121.     return new PageImpl<>(namespaceRepository.findByIdIn(namespaceIds));\n122.   }', 'start_line_number': 112, 'end_line_number': 122}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '175.   public List<Namespace> findPublicAppNamespaceAllNamespaces(String namespaceName, Pageable page) {\n176.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);\n177. \n178.     if (publicAppNamespace == null) {\n179.       throw new BadRequestException(\n180.           String.format("Public appNamespace not exists. NamespaceName = %s", namespaceName));\n181.     }\n182. \n183.     List<Namespace> namespaces = namespaceRepository.findByNamespaceName(namespaceName, page);\n184. \n185.     return filterChildNamespace(namespaces);\n186.   }', 'start_line_number': 175, 'end_line_number': 186}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '215.   public List<Namespace> findNamespaces(String appId, String clusterName) {\n216.     List<Namespace> namespaces = namespaceRepository.findByAppIdAndClusterNameOrderByIdAsc(appId, clusterName);\n217.     if (namespaces == null) {\n218.       return Collections.emptyList();\n219.     }\n220.     return namespaces;\n221.   }\n222. \n223.   public List<Namespace> findByAppIdAndNamespaceName(String appId, String namespaceName) {\n224.     return namespaceRepository.findByAppIdAndNamespaceNameOrderByIdAsc(appId, namespaceName);\n225.   }', 'start_line_number': 215, 'end_line_number': 225}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '283.   public boolean isNamespaceUnique(String appId, String cluster, String namespace) {\n284.     Objects.requireNonNull(appId, "AppId must not be null");\n285.     Objects.requireNonNull(cluster, "Cluster must not be null");\n286.     Objects.requireNonNull(namespace, "Namespace must not be null");\n287.     return Objects.isNull(\n288.         namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, cluster, namespace));\n289.   }\n290. \n291.   @Transactional\n292.   public void deleteByAppIdAndClusterName(String appId, String clusterName, String operator) {\n293. \n294.     List<Namespace> toDeleteNamespaces = findNamespaces(appId, clusterName);\n295. \n296.     for (Namespace namespace : toDeleteNamespaces) {\n297. \n298.       deleteNamespace(namespace, operator);\n299. \n300.     }\n301.   }\n302. \n303.   @Transactional\n304.   public Namespace deleteNamespace(Namespace namespace, String operator) {\n305.     String appId = namespace.getAppId();\n306.     String clusterName = namespace.getClusterName();\n307.     String namespaceName = namespace.getNamespaceName();\n308. \n309.     itemService.batchDelete(namespace.getId(), operator);\n310.     commitService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);\n311. \n312.     // Child namespace releases should retain as long as the parent namespace exists, because parent namespaces\' release\n313.     // histories need them\n314.     if (!isChildNamespace(namespace)) {\n315.       releaseService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);\n316.     }\n317. \n318.     //delete child namespace\n319.     Namespace childNamespace = findChildNamespace(namespace);\n320.     if (childNamespace != null) {\n321.       namespaceBranchService.deleteBranch(appId, clusterName, namespaceName,\n322.                                           childNamespace.getClusterName(), NamespaceBranchStatus.DELETED, operator);\n323.       //delete child namespace\'s releases. Notice: delete child namespace will not delete child namespace\'s releases\n324.       releaseService.batchDelete(appId, childNamespace.getClusterName(), namespaceName, operator);\n325.     }\n326. \n327.     releaseHistoryService.batchDelete(appId, clusterName, namespaceName, operator);\n328. \n329.     instanceService.batchDeleteInstanceConfig(appId, clusterName, namespaceName);\n330. \n331.     namespaceLockService.unlock(namespace.getId());\n332. \n333.     namespace.setDeleted(true);\n334.     namespace.setDataChangeLastModifiedBy(operator);\n335. \n336.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.DELETE, operator);\n337. \n338.     Namespace deleted = namespaceRepository.save(namespace);\n339. \n340.     //Publish release message to do some clean up in config service, such as updating the cache\n341.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),\n342.         Topics.APOLLO_RELEASE_TOPIC);\n343. \n344.     return deleted;\n345.   }\n346. \n347.   @Transactional\n348.   public Namespace save(Namespace entity) {\n349.     if (!isNamespaceUnique(entity.getAppId(), entity.getClusterName(), entity.getNamespaceName())) {\n350.       throw new ServiceException("namespace not unique");\n351.     }\n352.     entity.setId(0);//protection\n353.     Namespace namespace = namespaceRepository.save(entity);\n354. \n355.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.INSERT,\n356.                        namespace.getDataChangeCreatedBy());\n357. \n358.     return namespace;\n359.   }', 'start_line_number': 283, 'end_line_number': 359}, {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', 'content': '374.   @Transactional\n375.   public void instanceOfAppNamespaces(String appId, String clusterName, String createBy) {\n376. \n377.     List<AppNamespace> appNamespaces = appNamespaceService.findByAppId(appId);\n378. \n379.     for (AppNamespace appNamespace : appNamespaces) {\n380.       Namespace ns = new Namespace();\n381.       ns.setAppId(appId);\n382.       ns.setClusterName(clusterName);\n383.       ns.setNamespaceName(appNamespace.getName());\n384.       ns.setDataChangeCreatedBy(createBy);\n385.       ns.setDataChangeLastModifiedBy(createBy);\n386.       namespaceRepository.save(ns);\n387.       auditService.audit(Namespace.class.getSimpleName(), ns.getId(), Audit.OP.INSERT, createBy);\n388.     }\n389. ', 'start_line_number': 374, 'end_line_number': 389}, {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java', 'content': '27.   public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbol - _ . are allowed";\n28.   public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE = "not allowed to end with .json, .yml, .yaml, .xml, .properties";\n29.   public static final String CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+";\n30.   private static final String APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\\\.(json|yml|yaml|xml|properties))$";\n31.   private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);\n32.   private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);\n33. \n34.   public static boolean isValidClusterNamespace(String name) {\n35.     if (StringUtils.isEmpty(name)){\n36.       return false;\n37.     }\n38.     return CLUSTER_NAMESPACE_PATTERN.matcher(name).matches();\n39.   }\n40. \n41.   public static boolean isValidAppNamespace(String name){\n42.     if (StringUtils.isEmpty(name)){\n43.       return false;\n44.     }\n45.     return APP_NAMESPACE_PATTERN.matcher(name).matches();\n46.   }', 'start_line_number': 27, 'end_line_number': 46}, {'relative_path': 'apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java', 'content': '35.   public void testValidAppNamespaceName() throws Exception {\n36.     checkAppNamespaceName("some.cluster-_name.123", true);\n37.     checkAppNamespaceName("some.&.name", false);\n38.     checkAppNamespaceName("", false);\n39.     checkAppNamespaceName(null, false);\n40.     checkAppNamespaceName("some.name.json", false);\n41.     checkAppNamespaceName("some.name.yml", false);\n42.     checkAppNamespaceName("some.name.yaml", false);\n43.     checkAppNamespaceName("some.name.xml", false);\n44.     checkAppNamespaceName("some.name.properties", false);\n45.   }', 'start_line_number': 35, 'end_line_number': 45}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java', 'content': '52.   @PreAuthorize(value = "@consumerPermissionValidator.hasCreateNamespacePermission(#request, #appId)")\n53.   @PostMapping(value = "/openapi/v1/apps/{appId}/appnamespaces")\n54.   public OpenAppNamespaceDTO createNamespace(@PathVariable String appId,\n55.                                              @RequestBody OpenAppNamespaceDTO appNamespaceDTO,\n56.                                              HttpServletRequest request) {\n57. \n58.     if (!Objects.equals(appId, appNamespaceDTO.getAppId())) {\n59.       throw new BadRequestException(String.format("AppId not equal. AppId in path = %s, AppId in payload = %s", appId,\n60.                                                   appNamespaceDTO.getAppId()));\n61.     }\n62.     RequestPrecondition.checkArgumentsNotEmpty(appNamespaceDTO.getAppId(), appNamespaceDTO.getName(),\n63.                                                appNamespaceDTO.getFormat(), appNamespaceDTO.getDataChangeCreatedBy());\n64. \n65.     if (!InputValidator.isValidAppNamespace(appNamespaceDTO.getName())) {\n66.       throw new BadRequestException(String.format("Invalid Namespace format: %s",\n67.                                                   InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & "\n68.                                                   + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));\n69.     }\n70. \n71.     if (!ConfigFileFormat.isValidFormat(appNamespaceDTO.getFormat())) {\n72.       throw new BadRequestException(String.format("Invalid namespace format. format = %s", appNamespaceDTO.getFormat()));\n73.     }\n74. \n75.     String operator = appNamespaceDTO.getDataChangeCreatedBy();\n76.     if (userService.findByUserId(operator) == null) {\n77.       throw new BadRequestException(String.format("Illegal user. user = %s", operator));\n78.     }\n79. \n80.     return this.namespaceOpenApiService.createAppNamespace(appNamespaceDTO);\n81.   }', 'start_line_number': 52, 'end_line_number': 81}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java', 'content': '83.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces")\n84.   public List<OpenNamespaceDTO> findNamespaces(@PathVariable String appId, @PathVariable String env,\n85.                                                @PathVariable String clusterName) {\n86.     return this.namespaceOpenApiService.getNamespaces(appId, env, clusterName);\n87.   }\n88. \n89.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")\n90.   public OpenNamespaceDTO loadNamespace(@PathVariable String appId, @PathVariable String env,\n91.                                         @PathVariable String clusterName, @PathVariable String\n92.                                             namespaceName) {\n93.     return this.namespaceOpenApiService.getNamespace(appId, env, clusterName, namespaceName);\n94.   }', 'start_line_number': 83, 'end_line_number': 94}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '105.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces")\n106.   public List<NamespaceBO> findNamespaces(@PathVariable String appId, @PathVariable String env,\n107.                                           @PathVariable String clusterName) {\n108. \n109.     List<NamespaceBO> namespaceBOs = namespaceService.findNamespaceBOs(appId, Env.valueOf(env), clusterName);\n110. \n111.     for (NamespaceBO namespaceBO : namespaceBOs) {\n112.       if (permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceBO.getBaseInfo().getNamespaceName())) {\n113.         namespaceBO.hideItems();\n114.       }\n115.     }\n116. \n117.     return namespaceBOs;\n118.   }', 'start_line_number': 105, 'end_line_number': 118}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '120.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces/{namespaceName:.+}")\n121.   public NamespaceBO findNamespace(@PathVariable String appId, @PathVariable String env,\n122.                                    @PathVariable String clusterName, @PathVariable String namespaceName) {\n123. \n124.     NamespaceBO namespaceBO = namespaceService.loadNamespaceBO(appId, Env.valueOf(env), clusterName, namespaceName);\n125. \n126.     if (namespaceBO != null && permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceName)) {\n127.       namespaceBO.hideItems();\n128.     }\n129. \n130.     return namespaceBO;\n131.   }', 'start_line_number': 120, 'end_line_number': 131}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '142.   @PreAuthorize(value = "@permissionValidator.hasCreateNamespacePermission(#appId)")\n143.   @PostMapping("/apps/{appId}/namespaces")\n144.   public ResponseEntity<Void> createNamespace(@PathVariable String appId,\n145.                                               @RequestBody List<NamespaceCreationModel> models) {\n146. \n147.     checkModel(!CollectionUtils.isEmpty(models));\n148.     String operator = userInfoHolder.getUser().getUserId();\n149. \n150.     for (NamespaceCreationModel model : models) {\n151.       String namespaceName = model.getNamespace().getNamespaceName();\n152.       roleInitializationService.initNamespaceRoles(appId, namespaceName, operator);\n153.       roleInitializationService.initNamespaceEnvRoles(appId, namespaceName, operator);\n154.       NamespaceDTO namespace = model.getNamespace();\n155.       RequestPrecondition.checkArgumentsNotEmpty(model.getEnv(), namespace.getAppId(),\n156.                                                  namespace.getClusterName(), namespace.getNamespaceName());\n157. \n158.       try {\n159.         namespaceService.createNamespace(Env.valueOf(model.getEnv()), namespace);\n160.       } catch (Exception e) {\n161.         logger.error("create namespace fail.", e);\n162.         Tracer.logError(\n163.                 String.format("create namespace fail. (env=%s namespace=%s)", model.getEnv(),\n164.                         namespace.getNamespaceName()), e);\n165.       }\n166.       namespaceService.assignNamespaceRoleToOperator(appId, namespaceName,userInfoHolder.getUser().getUserId());\n167.     }\n168. \n169.     return ResponseEntity.ok().build();\n170.   }', 'start_line_number': 142, 'end_line_number': 170}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '172.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")\n173.   @DeleteMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName:.+}")\n174.   public ResponseEntity<Void> deleteLinkedNamespace(@PathVariable String appId, @PathVariable String env,\n175.       @PathVariable String clusterName, @PathVariable String namespaceName) {\n176. \n177.     namespaceService.deleteNamespace(appId, Env.valueOf(env), clusterName, namespaceName);\n178. \n179.     return ResponseEntity.ok().build();\n180.   }', 'start_line_number': 172, 'end_line_number': 180}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '182.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName}/usage")\n183.   public List<NamespaceUsage> findLinkedNamespaceUsage(@PathVariable String appId, @PathVariable String env,\n184.       @PathVariable String clusterName, @PathVariable String namespaceName) {\n185.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(appId, namespaceName, Env.valueOf(env), clusterName);\n186.     return Lists.newArrayList(usage);\n187.   }', 'start_line_number': 182, 'end_line_number': 187}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '194.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")\n195.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")\n196.   public ResponseEntity<Void> deleteAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {\n197. \n198.     AppNamespace appNamespace = appNamespaceService.deleteAppNamespace(appId, namespaceName);\n199. \n200.     publisher.publishEvent(new AppNamespaceDeletionEvent(appNamespace));\n201. \n202.     return ResponseEntity.ok().build();\n203.   }', 'start_line_number': 194, 'end_line_number': 203}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '205.   @GetMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")\n206.   public AppNamespaceDTO findAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {\n207.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);\n208. \n209.     if (appNamespace == null) {\n210.       throw new BadRequestException(\n211.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));\n212.     }\n213. \n214.     return BeanUtils.transform(AppNamespaceDTO.class, appNamespace);\n215.   }', 'start_line_number': 205, 'end_line_number': 215}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '217.   @PreAuthorize(value = "@permissionValidator.hasCreateAppNamespacePermission(#appId, #appNamespace)")\n218.   @PostMapping("/apps/{appId}/appnamespaces")\n219.   public AppNamespace createAppNamespace(@PathVariable String appId,\n220.       @RequestParam(defaultValue = "true") boolean appendNamespacePrefix,\n221.       @Valid @RequestBody AppNamespace appNamespace) {\n222.     if (!InputValidator.isValidAppNamespace(appNamespace.getName())) {\n223.       throw new BadRequestException(String.format("Invalid Namespace format: %s",\n224.           InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));\n225.     }\n226. \n227.     AppNamespace createdAppNamespace = appNamespaceService.createAppNamespaceInLocal(appNamespace, appendNamespacePrefix);\n228. \n229.     if (portalConfig.canAppAdminCreatePrivateNamespace() || createdAppNamespace.isPublic()) {\n230.       namespaceService.assignNamespaceRoleToOperator(appId, appNamespace.getName(),\n231.           userInfoHolder.getUser().getUserId());\n232.     }\n233. \n234.     publisher.publishEvent(new AppNamespaceCreationEvent(createdAppNamespace));\n235. \n236.     return createdAppNamespace;\n237.   }', 'start_line_number': 217, 'end_line_number': 237}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', 'content': '251.   @GetMapping("/envs/{env}/appnamespaces/{publicNamespaceName}/namespaces")\n252.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(@PathVariable String env,\n253.                                                                @PathVariable String publicNamespaceName,\n254.                                                                @RequestParam(name = "page", defaultValue = "0") int page,\n255.                                                                @RequestParam(name = "size", defaultValue = "10") int size) {\n256. \n257.     return namespaceService.getPublicAppNamespaceAllNamespaces(Env.valueOf(env), publicNamespaceName, page, size);\n258. \n259.   }', 'start_line_number': 251, 'end_line_number': 259}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java', 'content': '25. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long> {\n26. \n27.   AppNamespace findByAppIdAndName(String appId, String namespaceName);\n28. \n29.   AppNamespace findByName(String namespaceName);\n30. \n31.   List<AppNamespace> findByNameAndIsPublic(String namespaceName, boolean isPublic);\n32. \n33.   List<AppNamespace> findByIsPublicTrue();\n34. \n35.   List<AppNamespace> findByAppId(String appId);\n36. \n37.   @Modifying\n38.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy=?2 WHERE AppId=?1 and IsDeleted = 0")\n39.   int batchDeleteByAppId(String appId, String operator);\n40. \n41.   @Modifying\n42.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")\n43.   int delete(String appId, String namespaceName, String operator);\n44. }', 'start_line_number': 25, 'end_line_number': 44}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', 'content': '115.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {\n116.     Objects.requireNonNull(appId, "AppId must not be null");\n117.     Objects.requireNonNull(namespaceName, "Namespace must not be null");\n118.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));\n119.   }\n120. \n121.   @Transactional\n122.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace) {\n123.     return createAppNamespaceInLocal(appNamespace, true);\n124.   }\n125. \n126.   @Transactional\n127.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace, boolean appendNamespacePrefix) {\n128.     String appId = appNamespace.getAppId();\n129. \n130.     //add app org id as prefix\n131.     App app = appService.load(appId);\n132.     if (app == null) {\n133.       throw new BadRequestException("App not exist. AppId = " + appId);\n134.     }\n135. \n136.     StringBuilder appNamespaceName = new StringBuilder();\n137.     //add prefix postfix\n138.     appNamespaceName\n139.         .append(appNamespace.isPublic() && appendNamespacePrefix ? app.getOrgId() + "." : "")\n140.         .append(appNamespace.getName())\n141.         .append(appNamespace.formatAsEnum() == ConfigFileFormat.Properties ? "" : "." + appNamespace.getFormat());\n142.     appNamespace.setName(appNamespaceName.toString());\n143. \n144.     if (appNamespace.getComment() == null) {\n145.       appNamespace.setComment("");\n146.     }\n147. \n148.     if (!ConfigFileFormat.isValidFormat(appNamespace.getFormat())) {\n149.      throw new BadRequestException("Invalid namespace format. format must be properties、json、yaml、yml、xml");\n150.     }\n151. \n152.     String operator = appNamespace.getDataChangeCreatedBy();\n153.     if (StringUtils.isEmpty(operator)) {\n154.       operator = userInfoHolder.getUser().getUserId();\n155.       appNamespace.setDataChangeCreatedBy(operator);\n156.     }\n157. \n158.     appNamespace.setDataChangeLastModifiedBy(operator);\n159. \n160.     // globally uniqueness check for public app namespace\n161.     if (appNamespace.isPublic()) {\n162.       checkAppNamespaceGlobalUniqueness(appNamespace);\n163.     } else {\n164.       // check private app namespace\n165.       if (appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName()) != null) {\n166.         throw new BadRequestException("Private AppNamespace " + appNamespace.getName() + " already exists!");\n167.       }\n168.       // should not have the same with public app namespace\n169.       checkPublicAppNamespaceGlobalUniqueness(appNamespace);\n170.     }\n171. ', 'start_line_number': 115, 'end_line_number': 171}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', 'content': '172.     AppNamespace createdAppNamespace = appNamespaceRepository.save(appNamespace);\n173. \n174.     roleInitializationService.initNamespaceRoles(appNamespace.getAppId(), appNamespace.getName(), operator);\n175.     roleInitializationService.initNamespaceEnvRoles(appNamespace.getAppId(), appNamespace.getName(), operator);\n176. \n177.     return createdAppNamespace;\n178.   }', 'start_line_number': 172, 'end_line_number': 178}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', 'content': '204.   private void checkAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {\n205.     checkPublicAppNamespaceGlobalUniqueness(appNamespace);\n206. \n207.     List<AppNamespace> privateAppNamespaces = findAllPrivateAppNamespaces(appNamespace.getName());\n208. \n209.     if (!CollectionUtils.isEmpty(privateAppNamespaces)) {\n210.       Set<String> appIds = Sets.newHashSet();\n211.       for (AppNamespace ans : privateAppNamespaces) {\n212.         appIds.add(ans.getAppId());\n213.         if (appIds.size() == PRIVATE_APP_NAMESPACE_NOTIFICATION_COUNT) {\n214.           break;\n215.         }\n216.       }\n217. \n218.       throw new BadRequestException(\n219.           "Public AppNamespace " + appNamespace.getName() + " already exists as private AppNamespace in appId: "\n220.               + APP_NAMESPACE_JOINER.join(appIds) + ", etc. Please select another name!");\n221.     }\n222.   }', 'start_line_number': 204, 'end_line_number': 222}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', 'content': '224.   private void checkPublicAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {\n225.     AppNamespace publicAppNamespace = findPublicAppNamespace(appNamespace.getName());\n226.     if (publicAppNamespace != null) {\n227.       throw new BadRequestException("AppNamespace " + appNamespace.getName() + " already exists as public namespace in appId: " + publicAppNamespace.getAppId() + "!");\n228.     }\n229.   }', 'start_line_number': 224, 'end_line_number': 229}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', 'content': '117.   public NamespaceDTO createNamespace(Env env, NamespaceDTO namespace) {\n118.     if (StringUtils.isEmpty(namespace.getDataChangeCreatedBy())) {\n119.       namespace.setDataChangeCreatedBy(userInfoHolder.getUser().getUserId());\n120.     }\n121. \n122.     if (StringUtils.isEmpty(namespace.getDataChangeLastModifiedBy())) {\n123.       namespace.setDataChangeLastModifiedBy(userInfoHolder.getUser().getUserId());\n124.     }\n125.     NamespaceDTO createdNamespace = namespaceAPI.createNamespace(env, namespace);\n126. \n127.     Tracer.logEvent(TracerEventType.CREATE_NAMESPACE,\n128.         String.format("%s+%s+%s+%s", namespace.getAppId(), env, namespace.getClusterName(),\n129.             namespace.getNamespaceName()));\n130.     return createdNamespace;\n131.   }', 'start_line_number': 117, 'end_line_number': 131}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', 'content': '170.   @Transactional\n171.   public void deleteNamespace(String appId, Env env, String clusterName, String namespaceName) {\n172. \n173.     String operator = userInfoHolder.getUser().getUserId();\n174.     namespaceAPI.deleteNamespace(env, appId, clusterName, namespaceName, operator);\n175.   }\n176. \n177.   public NamespaceDTO loadNamespaceBaseInfo(String appId, Env env, String clusterName,\n178.       String namespaceName) {\n179.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);\n180.     if (namespace == null) {\n181.       throw new BadRequestException(String.format("Namespace: %s not exist.", namespaceName));\n182.     }\n183.     return namespace;\n184.   }', 'start_line_number': 170, 'end_line_number': 184}, {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', 'content': "231.   public List<NamespaceDTO> findNamespaces(String appId, Env env, String clusterName) {\n232.     return namespaceAPI.findNamespaceByCluster(appId, env, clusterName);\n233.   }\n234. \n235.   /**\n236.    * the returned content's size is not fixed. so please carefully used.\n237.    */\n238.   public PageDTO<NamespaceDTO> findNamespacesByItem(Env env, String itemKey, Pageable pageable) {\n239.     return namespaceAPI.findByItem(env, itemKey, pageable.getPageNumber(), pageable.getPageSize());\n240.   }\n241. \n242.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(Env env, String publicNamespaceName,\n243.       int page,\n244.       int size) {\n245.     return namespaceAPI.getPublicAppNamespaceAllNamespaces(env, publicNamespaceName, page, size);\n246.   }", 'start_line_number': 231, 'end_line_number': 246}, {'relative_path': 'docs/en/design/apollo-core-concept-namespace.md', 'content': '1. ### 1. What is Namespace?\n2. \n3. Namespace is a collection of configuration items, similar to the concept of a configuration file.\n4. \n5. ### 2. What is an `application` Namespace?\n6. \n7. When Apollo creates a project, it creates an `application` namespace by default. Spring Boot students know that Spring Boot projects have a default configuration file application.yml. here application.yml is equivalent to the `application` Namespace. For 90% of applications, the `application` namespace is sufficient for everyday configuration scenarios.\n8. \n9. ####  The code for client to get the `application` Namespace is as follows.\n10. \n11. ``` java\n12.   Config config = ConfigService.getAppConfig();\n13. ```\n14. \n15. #### The code for the client to get a `non-application` Namespace is as follows.\n16. \n17. ``` java\n18.   Config config = ConfigService.getConfig(namespaceName);\n19. ```\n20. \n21. ### 3. What are the formats of Namespace?\n22. \n23. Configuration files come in various formats such as properties, xml, yml, yaml, json, etc. Similarly Namespace also has these formats. In the Portal UI, you can see that the Namespace for `application` has a `properties` tag, indicating that `application` is in properties format.\n24. \n25. >Note1: For the namespace in non-properties format, you need to call `ConfigService.getConfigFile(String namespace, ConfigFileFormat configFileFormat)` to get it when you use the client, if you use the [Http interface direct call](en/usage/other-language-client-user-guide), the corresponding namespace parameter needs to be passed in the namespace name plus the suffix name, such as datasources.json.\n26. \n27. >Note 2: apollo-client version 1.3.0 has better support for yaml/yml, which is consistent with the properties format: `Config config = ConfigService.getConfig("application.yml");`, Spring\'s The Spring injection is also consistent with properties.\n28. \n29. ### 4. Classification of Namespace access rights\n30. \n31. There are two types of access permissions for Namespace.\n32. \n33.   * private (private)\n34.   * public (public)\n35. \n36. The access rights here are relative to the Apollo client.\n37. \n38. #### 4.1 Private Permissions\n39. \n40. Namespace with private access can only be accessed by the application it belongs to. If an application tries to get the private namespace of another application, Apollo will report a `404 ` exception.\n41. \n42. #### 4.2 Public Permissions\n43. \n44. Namespace with public privileges can be fetched by any application.\n45. \n46. ### 5. Types of Namespace\n47. \n48. There are three types of Namespace.\n49. \n50.   * private type\n51.   * public type  \n52.   * Associated types (inherited types)\n53. \n54. #### 5.1 Private Types\n55. \n56. Namespace of private type has private permission. For example, the  `application` Namespace mentioned above is a private type.\n57. \n58. \n59. #### 5.2 Public Types\n60. \n61. ##### 5.2.1 Meaning\n62. \n63. Namespace of a public type has public privileges. A public type Namespace is equivalent to a configuration that is outside the application and identifies the public Namespace by its name, so the name of the public Namespace must be globally unique.\n64. \n65. ##### 5.2.2 Usage Scenarios\n66. \n67.   * Department-level shared configurations\n68.   * Configurations shared at the group level\n69.   * Configurations shared between several projects\n70.   * Configuration for middleware clients\n71. \n72. \n73. #### 5.3 Association Types\n74. \n75. ##### 5.3.1 Meaning\n76. \n77. An association type may also be called an inherited type, and the association type has private privileges. The Namespace of an association type inherits from the Namespace of a public type and is used to override certain configurations of the public Namespace. For example, the public Namespace has two configuration items \n78. \n79. ```\n80. k1 = v1\n81. k2 = v2\n82. ```\n83. \n84. Then application A has an associated type of Namespace associated with this public Namespace and overrides the configuration item k1 with a new value of v3. Then when application A actually runs, the configuration of the public Namespace is obtained as\n85. \n86. ```\n87. k1 = v3\n88. k2 = v2\n89. ```\n90. \n91. ##### 5.3.2 Usage Scenarios\n92. \n93. Give a real-world usage scenario. Assume that the configuration of the RPC framework (e.g., timeout) has the following requirements.\n94. \n95.   * Provide a company-wide default configuration that can be dynamically adjusted\n96.   * RPC client projects can customize certain configuration items and can be dynamically adjusted\n97. \n98. 1. If you remove  `dynamically adjustable` from the above two requirements, the approach is simple. There is a configuration file in the rpc-client.jar package, and each time you modify the configuration file, you can resend a new version of the jar package. Similarly, the same is true for client-side projects.\n99. 2. If only the client project is supported, the configuration can be dynamically adjusted. The client project can configure some configuration items on Apollo  `application` Namespace. When initializing the service, just read the configuration from Apollo. The disadvantage of this is that each project has to customize some keys, which is not uniform. 3.\n100. 3. so how to support the above requirements perfectly? The answer is to use a combination of Apollo\'s public type Namespace and the associated type Namespace. The code in rpc-client.jar reads the configuration of the `rpc-client` Namespace. If you need to adjust the default configuration, just change the configuration of the public type `rpc-client` Namespace. If a client project wants to customize or dynamically modify some configuration items, simply associate `rpc-client` with Apollo\'s own project to create a Namespace of the associated type  `rpc-client`. Then you can modify the configuration items under the Namespace of the associated type `rpc-client`. One thing we need to point out here is that rpc-client.jar is running in the application container, so the configuration of the `rpc-client` Namespace that rpc-client gets is the namespace of the associated type of the application plus the namespace of the public type Namespace.\n101. \n102. #### 5.4 Example\n103. \n104. As shown in the following figure, there are three applications: Application A, Application B, and Application C.\n105. \n106.  * Application A has two Namespace of private type: application and NS-Private, and one Namespace of associated type: NS-Public.\n107.  * Application B has one Namespace of private type: application, and one Namespace of public type: NS-Public.\n108.  * Application C has only one Namespace of type private: application\n109. \n110. ![Namespace Example](https://cdn.jsdelivr.net/gh/apolloconfig/apollo@master/doc/images/namespace-model-example.png)\n111. \n112. ##### 5.4.1 Application A gets the Apollo configuration\n113. \n114. ```java\n115.   //application \n116.   Config appConfig = ConfigService.getAppConfig();\n117.   appConfig.getProperty("k1", null); // k1 = v11\n118.   appConfig.getProperty("k2", null); // k2 = v21\n119.   \n120.   // NS-Private\n121.   Config privateConfig = ConfigService.getConfig("NS-Private");\n122.   privateConfig.getProperty("k1", null); // k1 = v3\n123.   privateConfig.getProperty("k3", null); // k3 = v4\n124.   \n125.   // NS-Public, overrides the case of public type configuration, k4 is overridden\n126.   Config publicConfig = ConfigService.getConfig("NS-Public");\n127.   publicConfig.getProperty("k4", null); // k4 = v6 cover\n128.   publicConfig.getProperty("k6", null); // k6 = v6\n129.   publicConfig.getProperty("k7", null); // k7 = v7\n130. ```\n131. \n132. ##### 5.4.2 Application B to get Apollo configuration\n133. \n134. ``` java\n135.   //application\n136.   Config appConfig = ConfigService.getAppConfig();\n137.   appConfig.getProperty("k1", null); // k1 = v12\n138.   appConfig.getProperty("k2", null); // k2 = null\n139.   appConfig.getProperty("k3", null); // k3 = v32\n140.   \n141.   // NS-Private, since there is no NS-Private Namespace so we get the default value\n142.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");\n143.   privateConfig.getProperty("k1", "default value"); \n144.   \n145.   //NS-Public\n146.   Config publicConfig = ConfigService.getConfig("NS-Public");\n147.   publicConfig.getProperty("k4", null); // k4 = v5\n148.   publicConfig.getProperty("k6", null); // k6 = v6\n149.   publicConfig.getProperty("k7", null); // k7 = v7\n150. ```\n151. \n152. ##### 5.4.3 Applying C to get Apollo configuration\n153. \n154. ``` java\n155.   //application\n156.   Config appConfig = ConfigService.getAppConfig();\n157.   appConfig.getProperty("k1", null); // k1 = v12\n158.   appConfig.getProperty("k2", null); // k2 = null\n159.   appConfig.getProperty("k3", null); // k3 = v33\n160.   \n161.   // NS-Private, since there is no NS-Private Namespace so we get the default value\n162.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");\n163.   privateConfig.getProperty("k1", "default value"); \n164.   \n165.   //NS-Public, the public type Namespace, which any project can get\n166.   Config publicConfig = ConfigServi\n167. \n168. ```\n169. \n170. ##### 5.4.4 ChangeListener\n171. \n172. As you can see in the above code example, the Client Namespace is mapped to a Config object. Listeners for namespace configuration changes are registered on the Config object.\n173. \n174. So the Namespace code that monitors the application in application A is as follows:\n175. \n176. ````java\n177. Config appConfig = ConfigService.getAppConfig();\n178. appConfig.addChangeListener(new ConfigChangeListener() {\n179.   public void onChange(ConfigChangeEvent changeEvent) {\n180.     //do something\n181.   }\n182. })\n183. ````\n184. \n185. The Namespace code for monitoring NS-Private in application A is as follows:\n186. \n187. ````java\n188. Config privateConfig = ConfigService.getConfig("NS-Private");\n189. privateConfig.addChangeListener(new ConfigChangeListener() {\n190.   public void onChange(ConfigChangeEvent changeEvent) {\n191.     //do something\n192.   }\n193. })\n194. ````\n195. \n196. The Namespace code for monitoring NS-Public in application A, application B, and application C is as follows:\n197. \n198. ````java\n199. Config publicConfig = ConfigService.getConfig("NS-Public");\n200. publicConfig.addChangeListener(new ConfigChangeListener() {\n201.   public void onChange(ConfigChangeEvent changeEvent) {\n202.     //do something\n203.   }\n204. })\n205. ````', 'start_line_number': 1, 'end_line_number': 205}]}]
2025-11-12 11:21:36,210 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 1 memories from memory
2025-11-12 11:21:36,210 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 36 contexts from memory
2025-11-12 11:21:36,211 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 36 contexts from memory
2025-11-12 11:21:36,213 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 36 new contexts to 36 existing contexts
2025-11-12 11:21:36,216 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 36 total contexts (removed 36 duplicates)
2025-11-12 11:21:36,217 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-11-12 11:21:36,220 - thread-135845287823040.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java', content='28. @Entity\n29. @Table(name = "Namespace")\n30. @SQLDelete(sql = "Update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")\n31. @Where(clause = "isDeleted = 0")\n32. public class Namespace extends BaseEntity {\n33. \n34.   @Column(name = "appId", nullable = false)\n35.   private String appId;\n36. \n37.   @Column(name = "ClusterName", nullable = false)\n38.   private String clusterName;\n39. \n40.   @Column(name = "NamespaceName", nullable = false)\n41.   private String namespaceName;\n42. \n43.   public Namespace(){\n44. \n45.   }\n46. \n47.   public Namespace(String appId, String clusterName, String namespaceName) {\n48.     this.appId = appId;\n49.     this.clusterName = clusterName;\n50.     this.namespaceName = namespaceName;\n51.   }\n52. \n53.   public String getAppId() {\n54.     return appId;\n55.   }\n56. \n57.   public String getClusterName() {\n58.     return clusterName;\n59.   }\n60. \n61.   public String getNamespaceName() {\n62.     return namespaceName;\n63.   }\n64. \n65.   public void setAppId(String appId) {\n66.     this.appId = appId;\n67.   }\n68. \n69.   public void setClusterName(String clusterName) {\n70.     this.clusterName = clusterName;\n71.   }\n72. \n73.   public void setNamespaceName(String namespaceName) {\n74.     this.namespaceName = namespaceName;\n75.   }', start_line_number=28, end_line_number=75), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java', content='29. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long>{\n30. \n31.   AppNamespace findByAppIdAndName(String appId, String namespaceName);\n32. \n33.   List<AppNamespace> findByAppIdAndNameIn(String appId, Set<String> namespaceNames);\n34. \n35.   AppNamespace findByNameAndIsPublicTrue(String namespaceName);\n36. \n37.   List<AppNamespace> findByNameInAndIsPublicTrue(Set<String> namespaceNames);\n38. \n39.   List<AppNamespace> findByAppIdAndIsPublic(String appId, boolean isPublic);\n40. \n41.   List<AppNamespace> findByAppIdOrderByIdAsc(String appId);\n42. \n43.   List<AppNamespace> findFirst500ByIdGreaterThanOrderByIdAsc(long id);\n44. \n45.   @Modifying\n46.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?2 WHERE AppId=?1 and IsDeleted = 0")\n47.   int batchDeleteByAppId(String appId, String operator);\n48. \n49.   @Modifying\n50.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")\n51.   int delete(String appId, String namespaceName, String operator);', start_line_number=29, end_line_number=51), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java', content='29. public interface NamespaceRepository extends PagingAndSortingRepository<Namespace, Long> {\n30. \n31.   List<Namespace> findByAppIdAndClusterNameOrderByIdAsc(String appId, String clusterName);\n32. \n33.   Namespace findByAppIdAndClusterNameAndNamespaceName(String appId, String clusterName, String namespaceName);\n34. \n35.   @Modifying\n36.   @Query("update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 where appId=?1 and clusterName=?2 and IsDeleted = 0")\n37.   int batchDelete(String appId, String clusterName, String operator);\n38. \n39.   List<Namespace> findByAppIdAndNamespaceNameOrderByIdAsc(String appId, String namespaceName);\n40. \n41.   List<Namespace> findByNamespaceName(String namespaceName, Pageable page);\n42. \n43.   List<Namespace> findByIdIn(Set<Long> namespaceIds);\n44. \n45.   int countByNamespaceNameAndAppIdNot(String namespaceName, String appId);\n46. ', start_line_number=29, end_line_number=46), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', content='63.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {\n64.     Objects.requireNonNull(appId, "AppId must not be null");\n65.     Objects.requireNonNull(namespaceName, "Namespace must not be null");\n66.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));\n67.   }\n68. \n69.   public AppNamespace findPublicNamespaceByName(String namespaceName) {\n70.     Preconditions.checkArgument(namespaceName != null, "Namespace must not be null");\n71.     return appNamespaceRepository.findByNameAndIsPublicTrue(namespaceName);\n72.   }', start_line_number=63, end_line_number=72), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', content='104.   @Transactional\n105.   public void createDefaultAppNamespace(String appId, String createBy) {\n106.     if (!isAppNamespaceNameUnique(appId, ConfigConsts.NAMESPACE_APPLICATION)) {\n107.       throw new ServiceException("appnamespace not unique");\n108.     }\n109.     AppNamespace appNs = new AppNamespace();\n110.     appNs.setAppId(appId);\n111.     appNs.setName(ConfigConsts.NAMESPACE_APPLICATION);\n112.     appNs.setComment("default app namespace");\n113.     appNs.setFormat(ConfigFileFormat.Properties.getValue());\n114.     appNs.setDataChangeCreatedBy(createBy);\n115.     appNs.setDataChangeLastModifiedBy(createBy);\n116.     appNamespaceRepository.save(appNs);\n117. \n118.     auditService.audit(AppNamespace.class.getSimpleName(), appNs.getId(), Audit.OP.INSERT,\n119.                        createBy);\n120.   }', start_line_number=104, end_line_number=120), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', content='122.   @Transactional\n123.   public AppNamespace createAppNamespace(AppNamespace appNamespace) {\n124.     String createBy = appNamespace.getDataChangeCreatedBy();\n125.     if (!isAppNamespaceNameUnique(appNamespace.getAppId(), appNamespace.getName())) {\n126.       throw new ServiceException("appnamespace not unique");\n127.     }\n128.     appNamespace.setId(0);//protection\n129.     appNamespace.setDataChangeCreatedBy(createBy);\n130.     appNamespace.setDataChangeLastModifiedBy(createBy);\n131. \n132.     appNamespace = appNamespaceRepository.save(appNamespace);\n133. \n134.     createNamespaceForAppNamespaceInAllCluster(appNamespace.getAppId(), appNamespace.getName(), createBy);\n135. \n136.     auditService.audit(AppNamespace.class.getSimpleName(), appNamespace.getId(), Audit.OP.INSERT, createBy);\n137.     return appNamespace;\n138.   }', start_line_number=122, end_line_number=138), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', content='151.   public void createNamespaceForAppNamespaceInAllCluster(String appId, String namespaceName, String createBy) {\n152.     List<Cluster> clusters = clusterService.findParentClusters(appId);\n153. \n154.     for (Cluster cluster : clusters) {\n155. \n156.       // in case there is some dirty data, e.g. public namespace deleted in other app and now created in this app\n157.       if (!namespaceService.isNamespaceUnique(appId, cluster.getName(), namespaceName)) {\n158.         continue;\n159.       }\n160. \n161.       Namespace namespace = new Namespace();\n162.       namespace.setClusterName(cluster.getName());\n163.       namespace.setAppId(appId);\n164.       namespace.setNamespaceName(namespaceName);\n165.       namespace.setDataChangeCreatedBy(createBy);\n166.       namespace.setDataChangeLastModifiedBy(createBy);\n167. \n168.       namespaceService.save(namespace);\n169.     }\n170.   }', start_line_number=151, end_line_number=170), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', content='104.   public Namespace findOne(String appId, String clusterName, String namespaceName) {\n105.     return namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, clusterName,\n106.                                                                          namespaceName);\n107.   }', start_line_number=104, end_line_number=107), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', content='112.   public Page<Namespace> findByItem(String itemKey, Pageable pageable) {\n113.     Page<Item> items = itemService.findItemsByKey(itemKey, pageable);\n114. \n115.     if (!items.hasContent()) {\n116.       return Page.empty();\n117.     }\n118. \n119.     Set<Long> namespaceIds = BeanUtils.toPropertySet("namespaceId", items.getContent());\n120. \n121.     return new PageImpl<>(namespaceRepository.findByIdIn(namespaceIds));\n122.   }', start_line_number=112, end_line_number=122), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', content='175.   public List<Namespace> findPublicAppNamespaceAllNamespaces(String namespaceName, Pageable page) {\n176.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);\n177. \n178.     if (publicAppNamespace == null) {\n179.       throw new BadRequestException(\n180.           String.format("Public appNamespace not exists. NamespaceName = %s", namespaceName));\n181.     }\n182. \n183.     List<Namespace> namespaces = namespaceRepository.findByNamespaceName(namespaceName, page);\n184. \n185.     return filterChildNamespace(namespaces);\n186.   }', start_line_number=175, end_line_number=186), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', content='215.   public List<Namespace> findNamespaces(String appId, String clusterName) {\n216.     List<Namespace> namespaces = namespaceRepository.findByAppIdAndClusterNameOrderByIdAsc(appId, clusterName);\n217.     if (namespaces == null) {\n218.       return Collections.emptyList();\n219.     }\n220.     return namespaces;\n221.   }\n222. \n223.   public List<Namespace> findByAppIdAndNamespaceName(String appId, String namespaceName) {\n224.     return namespaceRepository.findByAppIdAndNamespaceNameOrderByIdAsc(appId, namespaceName);\n225.   }', start_line_number=215, end_line_number=225), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', content='283.   public boolean isNamespaceUnique(String appId, String cluster, String namespace) {\n284.     Objects.requireNonNull(appId, "AppId must not be null");\n285.     Objects.requireNonNull(cluster, "Cluster must not be null");\n286.     Objects.requireNonNull(namespace, "Namespace must not be null");\n287.     return Objects.isNull(\n288.         namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, cluster, namespace));\n289.   }\n290. \n291.   @Transactional\n292.   public void deleteByAppIdAndClusterName(String appId, String clusterName, String operator) {\n293. \n294.     List<Namespace> toDeleteNamespaces = findNamespaces(appId, clusterName);\n295. \n296.     for (Namespace namespace : toDeleteNamespaces) {\n297. \n298.       deleteNamespace(namespace, operator);\n299. \n300.     }\n301.   }\n302. \n303.   @Transactional\n304.   public Namespace deleteNamespace(Namespace namespace, String operator) {\n305.     String appId = namespace.getAppId();\n306.     String clusterName = namespace.getClusterName();\n307.     String namespaceName = namespace.getNamespaceName();\n308. \n309.     itemService.batchDelete(namespace.getId(), operator);\n310.     commitService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);\n311. \n312.     // Child namespace releases should retain as long as the parent namespace exists, because parent namespaces\' release\n313.     // histories need them\n314.     if (!isChildNamespace(namespace)) {\n315.       releaseService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);\n316.     }\n317. \n318.     //delete child namespace\n319.     Namespace childNamespace = findChildNamespace(namespace);\n320.     if (childNamespace != null) {\n321.       namespaceBranchService.deleteBranch(appId, clusterName, namespaceName,\n322.                                           childNamespace.getClusterName(), NamespaceBranchStatus.DELETED, operator);\n323.       //delete child namespace\'s releases. Notice: delete child namespace will not delete child namespace\'s releases\n324.       releaseService.batchDelete(appId, childNamespace.getClusterName(), namespaceName, operator);\n325.     }\n326. \n327.     releaseHistoryService.batchDelete(appId, clusterName, namespaceName, operator);\n328. \n329.     instanceService.batchDeleteInstanceConfig(appId, clusterName, namespaceName);\n330. \n331.     namespaceLockService.unlock(namespace.getId());\n332. \n333.     namespace.setDeleted(true);\n334.     namespace.setDataChangeLastModifiedBy(operator);\n335. \n336.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.DELETE, operator);\n337. \n338.     Namespace deleted = namespaceRepository.save(namespace);\n339. \n340.     //Publish release message to do some clean up in config service, such as updating the cache\n341.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),\n342.         Topics.APOLLO_RELEASE_TOPIC);\n343. \n344.     return deleted;\n345.   }\n346. \n347.   @Transactional\n348.   public Namespace save(Namespace entity) {\n349.     if (!isNamespaceUnique(entity.getAppId(), entity.getClusterName(), entity.getNamespaceName())) {\n350.       throw new ServiceException("namespace not unique");\n351.     }\n352.     entity.setId(0);//protection\n353.     Namespace namespace = namespaceRepository.save(entity);\n354. \n355.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.INSERT,\n356.                        namespace.getDataChangeCreatedBy());\n357. \n358.     return namespace;\n359.   }', start_line_number=283, end_line_number=359), Context(relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', content='374.   @Transactional\n375.   public void instanceOfAppNamespaces(String appId, String clusterName, String createBy) {\n376. \n377.     List<AppNamespace> appNamespaces = appNamespaceService.findByAppId(appId);\n378. \n379.     for (AppNamespace appNamespace : appNamespaces) {\n380.       Namespace ns = new Namespace();\n381.       ns.setAppId(appId);\n382.       ns.setClusterName(clusterName);\n383.       ns.setNamespaceName(appNamespace.getName());\n384.       ns.setDataChangeCreatedBy(createBy);\n385.       ns.setDataChangeLastModifiedBy(createBy);\n386.       namespaceRepository.save(ns);\n387.       auditService.audit(Namespace.class.getSimpleName(), ns.getId(), Audit.OP.INSERT, createBy);\n388.     }\n389. ', start_line_number=374, end_line_number=389), Context(relative_path='apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java', content='38.   @NotBlank(message = "AppNamespace Name cannot be blank")\n39.   @Pattern(\n40.       regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR,\n41.       message = "Invalid Namespace format: " + InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE\n42.   )\n43.   @Column(name = "Name", nullable = false)\n44.   private String name;\n45. ', start_line_number=38, end_line_number=45), Context(relative_path='apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java', content='27.   public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbol - _ . are allowed";\n28.   public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE = "not allowed to end with .json, .yml, .yaml, .xml, .properties";\n29.   public static final String CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+";\n30.   private static final String APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\\\.(json|yml|yaml|xml|properties))$";\n31.   private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);\n32.   private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);\n33. \n34.   public static boolean isValidClusterNamespace(String name) {\n35.     if (StringUtils.isEmpty(name)){\n36.       return false;\n37.     }\n38.     return CLUSTER_NAMESPACE_PATTERN.matcher(name).matches();\n39.   }\n40. \n41.   public static boolean isValidAppNamespace(String name){\n42.     if (StringUtils.isEmpty(name)){\n43.       return false;\n44.     }\n45.     return APP_NAMESPACE_PATTERN.matcher(name).matches();\n46.   }', start_line_number=27, end_line_number=46), Context(relative_path='apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java', content='35.   public void testValidAppNamespaceName() throws Exception {\n36.     checkAppNamespaceName("some.cluster-_name.123", true);\n37.     checkAppNamespaceName("some.&.name", false);\n38.     checkAppNamespaceName("", false);\n39.     checkAppNamespaceName(null, false);\n40.     checkAppNamespaceName("some.name.json", false);\n41.     checkAppNamespaceName("some.name.yml", false);\n42.     checkAppNamespaceName("some.name.yaml", false);\n43.     checkAppNamespaceName("some.name.xml", false);\n44.     checkAppNamespaceName("some.name.properties", false);\n45.   }', start_line_number=35, end_line_number=45), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java', content='52.   @PreAuthorize(value = "@consumerPermissionValidator.hasCreateNamespacePermission(#request, #appId)")\n53.   @PostMapping(value = "/openapi/v1/apps/{appId}/appnamespaces")\n54.   public OpenAppNamespaceDTO createNamespace(@PathVariable String appId,\n55.                                              @RequestBody OpenAppNamespaceDTO appNamespaceDTO,\n56.                                              HttpServletRequest request) {\n57. \n58.     if (!Objects.equals(appId, appNamespaceDTO.getAppId())) {\n59.       throw new BadRequestException(String.format("AppId not equal. AppId in path = %s, AppId in payload = %s", appId,\n60.                                                   appNamespaceDTO.getAppId()));\n61.     }\n62.     RequestPrecondition.checkArgumentsNotEmpty(appNamespaceDTO.getAppId(), appNamespaceDTO.getName(),\n63.                                                appNamespaceDTO.getFormat(), appNamespaceDTO.getDataChangeCreatedBy());\n64. \n65.     if (!InputValidator.isValidAppNamespace(appNamespaceDTO.getName())) {\n66.       throw new BadRequestException(String.format("Invalid Namespace format: %s",\n67.                                                   InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & "\n68.                                                   + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));\n69.     }\n70. \n71.     if (!ConfigFileFormat.isValidFormat(appNamespaceDTO.getFormat())) {\n72.       throw new BadRequestException(String.format("Invalid namespace format. format = %s", appNamespaceDTO.getFormat()));\n73.     }\n74. \n75.     String operator = appNamespaceDTO.getDataChangeCreatedBy();\n76.     if (userService.findByUserId(operator) == null) {\n77.       throw new BadRequestException(String.format("Illegal user. user = %s", operator));\n78.     }\n79. \n80.     return this.namespaceOpenApiService.createAppNamespace(appNamespaceDTO);\n81.   }', start_line_number=52, end_line_number=81), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java', content='83.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces")\n84.   public List<OpenNamespaceDTO> findNamespaces(@PathVariable String appId, @PathVariable String env,\n85.                                                @PathVariable String clusterName) {\n86.     return this.namespaceOpenApiService.getNamespaces(appId, env, clusterName);\n87.   }\n88. \n89.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")\n90.   public OpenNamespaceDTO loadNamespace(@PathVariable String appId, @PathVariable String env,\n91.                                         @PathVariable String clusterName, @PathVariable String\n92.                                             namespaceName) {\n93.     return this.namespaceOpenApiService.getNamespace(appId, env, clusterName, namespaceName);\n94.   }', start_line_number=83, end_line_number=94), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', content='105.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces")\n106.   public List<NamespaceBO> findNamespaces(@PathVariable String appId, @PathVariable String env,\n107.                                           @PathVariable String clusterName) {\n108. \n109.     List<NamespaceBO> namespaceBOs = namespaceService.findNamespaceBOs(appId, Env.valueOf(env), clusterName);\n110. \n111.     for (NamespaceBO namespaceBO : namespaceBOs) {\n112.       if (permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceBO.getBaseInfo().getNamespaceName())) {\n113.         namespaceBO.hideItems();\n114.       }\n115.     }\n116. \n117.     return namespaceBOs;\n118.   }', start_line_number=105, end_line_number=118), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', content='120.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces/{namespaceName:.+}")\n121.   public NamespaceBO findNamespace(@PathVariable String appId, @PathVariable String env,\n122.                                    @PathVariable String clusterName, @PathVariable String namespaceName) {\n123. \n124.     NamespaceBO namespaceBO = namespaceService.loadNamespaceBO(appId, Env.valueOf(env), clusterName, namespaceName);\n125. \n126.     if (namespaceBO != null && permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceName)) {\n127.       namespaceBO.hideItems();\n128.     }\n129. \n130.     return namespaceBO;\n131.   }', start_line_number=120, end_line_number=131), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', content='142.   @PreAuthorize(value = "@permissionValidator.hasCreateNamespacePermission(#appId)")\n143.   @PostMapping("/apps/{appId}/namespaces")\n144.   public ResponseEntity<Void> createNamespace(@PathVariable String appId,\n145.                                               @RequestBody List<NamespaceCreationModel> models) {\n146. \n147.     checkModel(!CollectionUtils.isEmpty(models));\n148.     String operator = userInfoHolder.getUser().getUserId();\n149. \n150.     for (NamespaceCreationModel model : models) {\n151.       String namespaceName = model.getNamespace().getNamespaceName();\n152.       roleInitializationService.initNamespaceRoles(appId, namespaceName, operator);\n153.       roleInitializationService.initNamespaceEnvRoles(appId, namespaceName, operator);\n154.       NamespaceDTO namespace = model.getNamespace();\n155.       RequestPrecondition.checkArgumentsNotEmpty(model.getEnv(), namespace.getAppId(),\n156.                                                  namespace.getClusterName(), namespace.getNamespaceName());\n157. \n158.       try {\n159.         namespaceService.createNamespace(Env.valueOf(model.getEnv()), namespace);\n160.       } catch (Exception e) {\n161.         logger.error("create namespace fail.", e);\n162.         Tracer.logError(\n163.                 String.format("create namespace fail. (env=%s namespace=%s)", model.getEnv(),\n164.                         namespace.getNamespaceName()), e);\n165.       }\n166.       namespaceService.assignNamespaceRoleToOperator(appId, namespaceName,userInfoHolder.getUser().getUserId());\n167.     }\n168. \n169.     return ResponseEntity.ok().build();\n170.   }', start_line_number=142, end_line_number=170), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', content='172.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")\n173.   @DeleteMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName:.+}")\n174.   public ResponseEntity<Void> deleteLinkedNamespace(@PathVariable String appId, @PathVariable String env,\n175.       @PathVariable String clusterName, @PathVariable String namespaceName) {\n176. \n177.     namespaceService.deleteNamespace(appId, Env.valueOf(env), clusterName, namespaceName);\n178. \n179.     return ResponseEntity.ok().build();\n180.   }', start_line_number=172, end_line_number=180), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', content='182.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName}/usage")\n183.   public List<NamespaceUsage> findLinkedNamespaceUsage(@PathVariable String appId, @PathVariable String env,\n184.       @PathVariable String clusterName, @PathVariable String namespaceName) {\n185.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(appId, namespaceName, Env.valueOf(env), clusterName);\n186.     return Lists.newArrayList(usage);\n187.   }', start_line_number=182, end_line_number=187), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', content='194.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")\n195.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")\n196.   public ResponseEntity<Void> deleteAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {\n197. \n198.     AppNamespace appNamespace = appNamespaceService.deleteAppNamespace(appId, namespaceName);\n199. \n200.     publisher.publishEvent(new AppNamespaceDeletionEvent(appNamespace));\n201. \n202.     return ResponseEntity.ok().build();\n203.   }', start_line_number=194, end_line_number=203), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', content='205.   @GetMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")\n206.   public AppNamespaceDTO findAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {\n207.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);\n208. \n209.     if (appNamespace == null) {\n210.       throw new BadRequestException(\n211.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));\n212.     }\n213. \n214.     return BeanUtils.transform(AppNamespaceDTO.class, appNamespace);\n215.   }', start_line_number=205, end_line_number=215), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', content='217.   @PreAuthorize(value = "@permissionValidator.hasCreateAppNamespacePermission(#appId, #appNamespace)")\n218.   @PostMapping("/apps/{appId}/appnamespaces")\n219.   public AppNamespace createAppNamespace(@PathVariable String appId,\n220.       @RequestParam(defaultValue = "true") boolean appendNamespacePrefix,\n221.       @Valid @RequestBody AppNamespace appNamespace) {\n222.     if (!InputValidator.isValidAppNamespace(appNamespace.getName())) {\n223.       throw new BadRequestException(String.format("Invalid Namespace format: %s",\n224.           InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));\n225.     }\n226. \n227.     AppNamespace createdAppNamespace = appNamespaceService.createAppNamespaceInLocal(appNamespace, appendNamespacePrefix);\n228. \n229.     if (portalConfig.canAppAdminCreatePrivateNamespace() || createdAppNamespace.isPublic()) {\n230.       namespaceService.assignNamespaceRoleToOperator(appId, appNamespace.getName(),\n231.           userInfoHolder.getUser().getUserId());\n232.     }\n233. \n234.     publisher.publishEvent(new AppNamespaceCreationEvent(createdAppNamespace));\n235. \n236.     return createdAppNamespace;\n237.   }', start_line_number=217, end_line_number=237), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', content='251.   @GetMapping("/envs/{env}/appnamespaces/{publicNamespaceName}/namespaces")\n252.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(@PathVariable String env,\n253.                                                                @PathVariable String publicNamespaceName,\n254.                                                                @RequestParam(name = "page", defaultValue = "0") int page,\n255.                                                                @RequestParam(name = "size", defaultValue = "10") int size) {\n256. \n257.     return namespaceService.getPublicAppNamespaceAllNamespaces(Env.valueOf(env), publicNamespaceName, page, size);\n258. \n259.   }', start_line_number=251, end_line_number=259), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java', content='25. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long> {\n26. \n27.   AppNamespace findByAppIdAndName(String appId, String namespaceName);\n28. \n29.   AppNamespace findByName(String namespaceName);\n30. \n31.   List<AppNamespace> findByNameAndIsPublic(String namespaceName, boolean isPublic);\n32. \n33.   List<AppNamespace> findByIsPublicTrue();\n34. \n35.   List<AppNamespace> findByAppId(String appId);\n36. \n37.   @Modifying\n38.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy=?2 WHERE AppId=?1 and IsDeleted = 0")\n39.   int batchDeleteByAppId(String appId, String operator);\n40. \n41.   @Modifying\n42.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")\n43.   int delete(String appId, String namespaceName, String operator);\n44. }', start_line_number=25, end_line_number=44), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', content='115.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {\n116.     Objects.requireNonNull(appId, "AppId must not be null");\n117.     Objects.requireNonNull(namespaceName, "Namespace must not be null");\n118.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));\n119.   }\n120. \n121.   @Transactional\n122.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace) {\n123.     return createAppNamespaceInLocal(appNamespace, true);\n124.   }\n125. \n126.   @Transactional\n127.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace, boolean appendNamespacePrefix) {\n128.     String appId = appNamespace.getAppId();\n129. \n130.     //add app org id as prefix\n131.     App app = appService.load(appId);\n132.     if (app == null) {\n133.       throw new BadRequestException("App not exist. AppId = " + appId);\n134.     }\n135. \n136.     StringBuilder appNamespaceName = new StringBuilder();\n137.     //add prefix postfix\n138.     appNamespaceName\n139.         .append(appNamespace.isPublic() && appendNamespacePrefix ? app.getOrgId() + "." : "")\n140.         .append(appNamespace.getName())\n141.         .append(appNamespace.formatAsEnum() == ConfigFileFormat.Properties ? "" : "." + appNamespace.getFormat());\n142.     appNamespace.setName(appNamespaceName.toString());\n143. \n144.     if (appNamespace.getComment() == null) {\n145.       appNamespace.setComment("");\n146.     }\n147. \n148.     if (!ConfigFileFormat.isValidFormat(appNamespace.getFormat())) {\n149.      throw new BadRequestException("Invalid namespace format. format must be properties、json、yaml、yml、xml");\n150.     }\n151. \n152.     String operator = appNamespace.getDataChangeCreatedBy();\n153.     if (StringUtils.isEmpty(operator)) {\n154.       operator = userInfoHolder.getUser().getUserId();\n155.       appNamespace.setDataChangeCreatedBy(operator);\n156.     }\n157. \n158.     appNamespace.setDataChangeLastModifiedBy(operator);\n159. \n160.     // globally uniqueness check for public app namespace\n161.     if (appNamespace.isPublic()) {\n162.       checkAppNamespaceGlobalUniqueness(appNamespace);\n163.     } else {\n164.       // check private app namespace\n165.       if (appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName()) != null) {\n166.         throw new BadRequestException("Private AppNamespace " + appNamespace.getName() + " already exists!");\n167.       }\n168.       // should not have the same with public app namespace\n169.       checkPublicAppNamespaceGlobalUniqueness(appNamespace);\n170.     }\n171. ', start_line_number=115, end_line_number=171), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', content='172.     AppNamespace createdAppNamespace = appNamespaceRepository.save(appNamespace);\n173. \n174.     roleInitializationService.initNamespaceRoles(appNamespace.getAppId(), appNamespace.getName(), operator);\n175.     roleInitializationService.initNamespaceEnvRoles(appNamespace.getAppId(), appNamespace.getName(), operator);\n176. \n177.     return createdAppNamespace;\n178.   }', start_line_number=172, end_line_number=178), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', content='204.   private void checkAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {\n205.     checkPublicAppNamespaceGlobalUniqueness(appNamespace);\n206. \n207.     List<AppNamespace> privateAppNamespaces = findAllPrivateAppNamespaces(appNamespace.getName());\n208. \n209.     if (!CollectionUtils.isEmpty(privateAppNamespaces)) {\n210.       Set<String> appIds = Sets.newHashSet();\n211.       for (AppNamespace ans : privateAppNamespaces) {\n212.         appIds.add(ans.getAppId());\n213.         if (appIds.size() == PRIVATE_APP_NAMESPACE_NOTIFICATION_COUNT) {\n214.           break;\n215.         }\n216.       }\n217. \n218.       throw new BadRequestException(\n219.           "Public AppNamespace " + appNamespace.getName() + " already exists as private AppNamespace in appId: "\n220.               + APP_NAMESPACE_JOINER.join(appIds) + ", etc. Please select another name!");\n221.     }\n222.   }', start_line_number=204, end_line_number=222), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', content='224.   private void checkPublicAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {\n225.     AppNamespace publicAppNamespace = findPublicAppNamespace(appNamespace.getName());\n226.     if (publicAppNamespace != null) {\n227.       throw new BadRequestException("AppNamespace " + appNamespace.getName() + " already exists as public namespace in appId: " + publicAppNamespace.getAppId() + "!");\n228.     }\n229.   }', start_line_number=224, end_line_number=229), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', content='117.   public NamespaceDTO createNamespace(Env env, NamespaceDTO namespace) {\n118.     if (StringUtils.isEmpty(namespace.getDataChangeCreatedBy())) {\n119.       namespace.setDataChangeCreatedBy(userInfoHolder.getUser().getUserId());\n120.     }\n121. \n122.     if (StringUtils.isEmpty(namespace.getDataChangeLastModifiedBy())) {\n123.       namespace.setDataChangeLastModifiedBy(userInfoHolder.getUser().getUserId());\n124.     }\n125.     NamespaceDTO createdNamespace = namespaceAPI.createNamespace(env, namespace);\n126. \n127.     Tracer.logEvent(TracerEventType.CREATE_NAMESPACE,\n128.         String.format("%s+%s+%s+%s", namespace.getAppId(), env, namespace.getClusterName(),\n129.             namespace.getNamespaceName()));\n130.     return createdNamespace;\n131.   }', start_line_number=117, end_line_number=131), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', content='170.   @Transactional\n171.   public void deleteNamespace(String appId, Env env, String clusterName, String namespaceName) {\n172. \n173.     String operator = userInfoHolder.getUser().getUserId();\n174.     namespaceAPI.deleteNamespace(env, appId, clusterName, namespaceName, operator);\n175.   }\n176. \n177.   public NamespaceDTO loadNamespaceBaseInfo(String appId, Env env, String clusterName,\n178.       String namespaceName) {\n179.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);\n180.     if (namespace == null) {\n181.       throw new BadRequestException(String.format("Namespace: %s not exist.", namespaceName));\n182.     }\n183.     return namespace;\n184.   }', start_line_number=170, end_line_number=184), Context(relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', content="231.   public List<NamespaceDTO> findNamespaces(String appId, Env env, String clusterName) {\n232.     return namespaceAPI.findNamespaceByCluster(appId, env, clusterName);\n233.   }\n234. \n235.   /**\n236.    * the returned content's size is not fixed. so please carefully used.\n237.    */\n238.   public PageDTO<NamespaceDTO> findNamespacesByItem(Env env, String itemKey, Pageable pageable) {\n239.     return namespaceAPI.findByItem(env, itemKey, pageable.getPageNumber(), pageable.getPageSize());\n240.   }\n241. \n242.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(Env env, String publicNamespaceName,\n243.       int page,\n244.       int size) {\n245.     return namespaceAPI.getPublicAppNamespaceAllNamespaces(env, publicNamespaceName, page, size);\n246.   }", start_line_number=231, end_line_number=246), Context(relative_path='docs/en/design/apollo-core-concept-namespace.md', content='1. ### 1. What is Namespace?\n2. \n3. Namespace is a collection of configuration items, similar to the concept of a configuration file.\n4. \n5. ### 2. What is an `application` Namespace?\n6. \n7. When Apollo creates a project, it creates an `application` namespace by default. Spring Boot students know that Spring Boot projects have a default configuration file application.yml. here application.yml is equivalent to the `application` Namespace. For 90% of applications, the `application` namespace is sufficient for everyday configuration scenarios.\n8. \n9. ####  The code for client to get the `application` Namespace is as follows.\n10. \n11. ``` java\n12.   Config config = ConfigService.getAppConfig();\n13. ```\n14. \n15. #### The code for the client to get a `non-application` Namespace is as follows.\n16. \n17. ``` java\n18.   Config config = ConfigService.getConfig(namespaceName);\n19. ```\n20. \n21. ### 3. What are the formats of Namespace?\n22. \n23. Configuration files come in various formats such as properties, xml, yml, yaml, json, etc. Similarly Namespace also has these formats. In the Portal UI, you can see that the Namespace for `application` has a `properties` tag, indicating that `application` is in properties format.\n24. \n25. >Note1: For the namespace in non-properties format, you need to call `ConfigService.getConfigFile(String namespace, ConfigFileFormat configFileFormat)` to get it when you use the client, if you use the [Http interface direct call](en/usage/other-language-client-user-guide), the corresponding namespace parameter needs to be passed in the namespace name plus the suffix name, such as datasources.json.\n26. \n27. >Note 2: apollo-client version 1.3.0 has better support for yaml/yml, which is consistent with the properties format: `Config config = ConfigService.getConfig("application.yml");`, Spring\'s The Spring injection is also consistent with properties.\n28. \n29. ### 4. Classification of Namespace access rights\n30. \n31. There are two types of access permissions for Namespace.\n32. \n33.   * private (private)\n34.   * public (public)\n35. \n36. The access rights here are relative to the Apollo client.\n37. \n38. #### 4.1 Private Permissions\n39. \n40. Namespace with private access can only be accessed by the application it belongs to. If an application tries to get the private namespace of another application, Apollo will report a `404 ` exception.\n41. \n42. #### 4.2 Public Permissions\n43. \n44. Namespace with public privileges can be fetched by any application.\n45. \n46. ### 5. Types of Namespace\n47. \n48. There are three types of Namespace.\n49. \n50.   * private type\n51.   * public type  \n52.   * Associated types (inherited types)\n53. \n54. #### 5.1 Private Types\n55. \n56. Namespace of private type has private permission. For example, the  `application` Namespace mentioned above is a private type.\n57. \n58. \n59. #### 5.2 Public Types\n60. \n61. ##### 5.2.1 Meaning\n62. \n63. Namespace of a public type has public privileges. A public type Namespace is equivalent to a configuration that is outside the application and identifies the public Namespace by its name, so the name of the public Namespace must be globally unique.\n64. \n65. ##### 5.2.2 Usage Scenarios\n66. \n67.   * Department-level shared configurations\n68.   * Configurations shared at the group level\n69.   * Configurations shared between several projects\n70.   * Configuration for middleware clients\n71. \n72. \n73. #### 5.3 Association Types\n74. \n75. ##### 5.3.1 Meaning\n76. \n77. An association type may also be called an inherited type, and the association type has private privileges. The Namespace of an association type inherits from the Namespace of a public type and is used to override certain configurations of the public Namespace. For example, the public Namespace has two configuration items \n78. \n79. ```\n80. k1 = v1\n81. k2 = v2\n82. ```\n83. \n84. Then application A has an associated type of Namespace associated with this public Namespace and overrides the configuration item k1 with a new value of v3. Then when application A actually runs, the configuration of the public Namespace is obtained as\n85. \n86. ```\n87. k1 = v3\n88. k2 = v2\n89. ```\n90. \n91. ##### 5.3.2 Usage Scenarios\n92. \n93. Give a real-world usage scenario. Assume that the configuration of the RPC framework (e.g., timeout) has the following requirements.\n94. \n95.   * Provide a company-wide default configuration that can be dynamically adjusted\n96.   * RPC client projects can customize certain configuration items and can be dynamically adjusted\n97. \n98. 1. If you remove  `dynamically adjustable` from the above two requirements, the approach is simple. There is a configuration file in the rpc-client.jar package, and each time you modify the configuration file, you can resend a new version of the jar package. Similarly, the same is true for client-side projects.\n99. 2. If only the client project is supported, the configuration can be dynamically adjusted. The client project can configure some configuration items on Apollo  `application` Namespace. When initializing the service, just read the configuration from Apollo. The disadvantage of this is that each project has to customize some keys, which is not uniform. 3.\n100. 3. so how to support the above requirements perfectly? The answer is to use a combination of Apollo\'s public type Namespace and the associated type Namespace. The code in rpc-client.jar reads the configuration of the `rpc-client` Namespace. If you need to adjust the default configuration, just change the configuration of the public type `rpc-client` Namespace. If a client project wants to customize or dynamically modify some configuration items, simply associate `rpc-client` with Apollo\'s own project to create a Namespace of the associated type  `rpc-client`. Then you can modify the configuration items under the Namespace of the associated type `rpc-client`. One thing we need to point out here is that rpc-client.jar is running in the application container, so the configuration of the `rpc-client` Namespace that rpc-client gets is the namespace of the associated type of the application plus the namespace of the public type Namespace.\n101. \n102. #### 5.4 Example\n103. \n104. As shown in the following figure, there are three applications: Application A, Application B, and Application C.\n105. \n106.  * Application A has two Namespace of private type: application and NS-Private, and one Namespace of associated type: NS-Public.\n107.  * Application B has one Namespace of private type: application, and one Namespace of public type: NS-Public.\n108.  * Application C has only one Namespace of type private: application\n109. \n110. ![Namespace Example](https://cdn.jsdelivr.net/gh/apolloconfig/apollo@master/doc/images/namespace-model-example.png)\n111. \n112. ##### 5.4.1 Application A gets the Apollo configuration\n113. \n114. ```java\n115.   //application \n116.   Config appConfig = ConfigService.getAppConfig();\n117.   appConfig.getProperty("k1", null); // k1 = v11\n118.   appConfig.getProperty("k2", null); // k2 = v21\n119.   \n120.   // NS-Private\n121.   Config privateConfig = ConfigService.getConfig("NS-Private");\n122.   privateConfig.getProperty("k1", null); // k1 = v3\n123.   privateConfig.getProperty("k3", null); // k3 = v4\n124.   \n125.   // NS-Public, overrides the case of public type configuration, k4 is overridden\n126.   Config publicConfig = ConfigService.getConfig("NS-Public");\n127.   publicConfig.getProperty("k4", null); // k4 = v6 cover\n128.   publicConfig.getProperty("k6", null); // k6 = v6\n129.   publicConfig.getProperty("k7", null); // k7 = v7\n130. ```\n131. \n132. ##### 5.4.2 Application B to get Apollo configuration\n133. \n134. ``` java\n135.   //application\n136.   Config appConfig = ConfigService.getAppConfig();\n137.   appConfig.getProperty("k1", null); // k1 = v12\n138.   appConfig.getProperty("k2", null); // k2 = null\n139.   appConfig.getProperty("k3", null); // k3 = v32\n140.   \n141.   // NS-Private, since there is no NS-Private Namespace so we get the default value\n142.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");\n143.   privateConfig.getProperty("k1", "default value"); \n144.   \n145.   //NS-Public\n146.   Config publicConfig = ConfigService.getConfig("NS-Public");\n147.   publicConfig.getProperty("k4", null); // k4 = v5\n148.   publicConfig.getProperty("k6", null); // k6 = v6\n149.   publicConfig.getProperty("k7", null); // k7 = v7\n150. ```\n151. \n152. ##### 5.4.3 Applying C to get Apollo configuration\n153. \n154. ``` java\n155.   //application\n156.   Config appConfig = ConfigService.getAppConfig();\n157.   appConfig.getProperty("k1", null); // k1 = v12\n158.   appConfig.getProperty("k2", null); // k2 = null\n159.   appConfig.getProperty("k3", null); // k3 = v33\n160.   \n161.   // NS-Private, since there is no NS-Private Namespace so we get the default value\n162.   Config privateConfig = ConfigService.getConfig("NS-Private"). privateConfig.getProperty("NS-Private");\n163.   privateConfig.getProperty("k1", "default value"); \n164.   \n165.   //NS-Public, the public type Namespace, which any project can get\n166.   Config publicConfig = ConfigServi\n167. \n168. ```\n169. \n170. ##### 5.4.4 ChangeListener\n171. \n172. As you can see in the above code example, the Client Namespace is mapped to a Config object. Listeners for namespace configuration changes are registered on the Config object.\n173. \n174. So the Namespace code that monitors the application in application A is as follows:\n175. \n176. ````java\n177. Config appConfig = ConfigService.getAppConfig();\n178. appConfig.addChangeListener(new ConfigChangeListener() {\n179.   public void onChange(ConfigChangeEvent changeEvent) {\n180.     //do something\n181.   }\n182. })\n183. ````\n184. \n185. The Namespace code for monitoring NS-Private in application A is as follows:\n186. \n187. ````java\n188. Config privateConfig = ConfigService.getConfig("NS-Private");\n189. privateConfig.addChangeListener(new ConfigChangeListener() {\n190.   public void onChange(ConfigChangeEvent changeEvent) {\n191.     //do something\n192.   }\n193. })\n194. ````\n195. \n196. The Namespace code for monitoring NS-Public in application A, application B, and application C is as follows:\n197. \n198. ````java\n199. Config publicConfig = ConfigService.getConfig("NS-Public");\n200. publicConfig.addChangeListener(new ConfigChangeListener() {\n201.   public void onChange(ConfigChangeEvent changeEvent) {\n202.     //do something\n203.   }\n204. })\n205. ````', start_line_number=1, end_line_number=205)]
2025-11-12 11:21:45,767 - thread-135845287823040.prometheus.lang_graph.nodes.issue_classifier_node - INFO - IssueClassifierNode classified the issue as: bug
2025-11-12 11:21:45,768 - thread-135845287823040.prometheus.lang_graph.nodes.issue_classification_subgraph_node - INFO - issue_type: bug
2025-11-12 11:21:45,770 - thread-135845287823040.prometheus.docker.base_container - INFO - Pulling docker image: ghcr.io/timesler/swe-polybench.eval.x86_64.apolloconfig__apollo-4568:latest
2025-11-12 11:21:46,264 - thread-135845287823040.prometheus.docker.base_container - INFO - Tagging pulled image as: prometheus_user_defined_container_a6586107ab
2025-11-12 11:21:46,273 - thread-135845287823040.prometheus.docker.base_container - INFO - Starting container from image prometheus_user_defined_container_a6586107ab
2025-11-12 11:21:46,441 - thread-135845287823040.prometheus.docker.base_container - INFO - Starting persistent shell for interactive mode...
2025-11-12 11:21:46,543 - thread-135845287823040.prometheus.docker.base_container - INFO - Persistent shell is ready
2025-11-12 11:21:46,543 - thread-135845287823040.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - Enter IssueBugSubgraphNode
2025-11-12 11:21:46,549 - thread-135845287823040.prometheus.lang_graph.nodes.bug_get_regression_tests_subgraph_node - INFO - Enter bug_get_regression_tests_subgraph_node
2025-11-12 11:21:46,552 - thread-135845287823040.prometheus.lang_graph.nodes.bug_get_regression_context_message_node - DEBUG - Sending query to context provider subgraph:
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

2025-11-12 11:21:46,553 - thread-135845287823040.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-12 11:21:46,556 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:22:04,695 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The repository tree is available, but no source/test file contents are provided. The task requires returning 8 complete, self-contained existing test cases with exact file paths and line numbers, which is impossible without seeing the actual test files. Specifically, we need test cases related to namespace creation/query operations (likely in apollo-portal, apollo-adminservice, apollo-biz, and possibly apollo-configservice). Therefore, additional context with the contents of relevant test files or at least indexed matches is essential.' query='Please provide the full content (with line numbers) of all test files under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-biz/src/test/java, and apollo-configservice/src/test/java that reference “Namespace” or “namespace” (e.g., NamespaceController, NamespaceService).' extra_requirements='If sending full files is too large, please share a grep/result listing of all occurrences of “namespace” within those src/test/java directories, including file paths, line numbers, and the surrounding import blocks and test method bodies.' purpose='I need these test contents to identify 8 relevant existing test cases and include their exact imports, setup, assertions, file paths, and line numbers.'
2025-11-12 11:22:04,697 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content (with line numbers) of all test files under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-biz/src/test/java, and apollo-configservice/src/test/java that reference “Namespace” or “namespace” (e.g., NamespaceController, NamespaceService).
2025-11-12 11:22:06,785 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 11:22:06,785 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 11:22:06,785 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 11:22:06,785 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 11:22:06,787 - thread-135845287823040.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 11:22:06,788 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 11:22:06,788 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content (with line numbers) of all test files under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-biz/src/test/java, and apollo-configservice/src/test/java that reference “Namespace” or “namespace” (e.g., NamespaceController, NamespaceService).
Extra requirements: If sending full files is too large, please share a grep/result listing of all occurrences of “namespace” within those src/test/java directories, including file paths, line numbers, and the surrounding import blocks and test method bodies.
Purpose: I need these test contents to identify 8 relevant existing test cases and include their exact imports, setup, assertions, file paths, and line numbers.
2025-11-12 11:22:15,443 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3vU4DSAomzr1MwM3K7lBv00F', 'function': {'arguments': '{"basename":"NamespaceControllerTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 991, 'prompt_tokens': 2306, 'total_tokens': 3297, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--570c591e-3661-45f1-a8f1-64e289d18364-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceControllerTest.java'}, 'id': 'call_3vU4DSAomzr1MwM3K7lBv00F', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2306, 'output_tokens': 991, 'total_tokens': 3297, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 11:22:25,741 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_IRNKhS40Gkh3dsci1rlMja3Z', 'function': {'arguments': '{"text":"Namespace","basename":"Test.java"}', 'name': 'find_ast_node_with_text_in_file_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 741, 'prompt_tokens': 2450, 'total_tokens': 3191, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--121c4c1d-7684-4ae6-b638-152a28ef3078-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'text': 'Namespace', 'basename': 'Test.java'}, 'id': 'call_IRNKhS40Gkh3dsci1rlMja3Z', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2450, 'output_tokens': 741, 'total_tokens': 3191, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-12 11:22:35,248 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Q1m0RDr8SqkfepI94pNyKHgY', 'function': {'arguments': '{"basename":"NamespaceServiceTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 799, 'prompt_tokens': 2511, 'total_tokens': 3310, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--128eae58-cdc8-48a8-a789-ae672715a8ba-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceServiceTest.java'}, 'id': 'call_Q1m0RDr8SqkfepI94pNyKHgY', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2511, 'output_tokens': 799, 'total_tokens': 3310, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 11:22:44,928 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_8BWRO70x8LkOc9SarA8k7R1M', 'function': {'arguments': '{"text":"Namespace","relative_path":"apollo-portal/src/test/java"}', 'name': 'find_ast_node_with_text_in_file_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 938, 'prompt_tokens': 2653, 'total_tokens': 3591, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 896, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e8cd2f6d-0301-4bf0-b560-bd80e2cbfa63-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_relative_path', 'args': {'text': 'Namespace', 'relative_path': 'apollo-portal/src/test/java'}, 'id': 'call_8BWRO70x8LkOc9SarA8k7R1M', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2653, 'output_tokens': 938, 'total_tokens': 3591, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 896}}
2025-11-12 11:22:55,152 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_bqVOFqw90MTNPqv60z137cQr', 'function': {'arguments': '{"basename":"AppNamespaceControllerTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 928, 'prompt_tokens': 2720, 'total_tokens': 3648, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 896, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2432}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b41330e0-707b-493c-92a8-b6019a9156af-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceControllerTest.java'}, 'id': 'call_bqVOFqw90MTNPqv60z137cQr', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2720, 'output_tokens': 928, 'total_tokens': 3648, 'input_token_details': {'audio': 0, 'cache_read': 2432}, 'output_token_details': {'audio': 0, 'reasoning': 896}}
2025-11-12 11:23:08,809 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6xIUuEgoH3oxAK3a58N7otBJ', 'function': {'arguments': '{"basename":"AppNamespaceServiceTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1120, 'prompt_tokens': 2812, 'total_tokens': 3932, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1088, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--85cde07a-985f-4141-a635-a2f15e55f286-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceServiceTest.java'}, 'id': 'call_6xIUuEgoH3oxAK3a58N7otBJ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2812, 'output_tokens': 1120, 'total_tokens': 3932, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1088}}
2025-11-12 11:23:26,253 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_E6Ks8QqoljKpJFlYMxQ177DJ', 'function': {'arguments': '{"basename":"NamespaceBranchServiceTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1376, 'prompt_tokens': 2904, 'total_tokens': 4280, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2688}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--99530e4e-8f0c-4fdd-9c24-2a4599f633dc-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceBranchServiceTest.java'}, 'id': 'call_E6Ks8QqoljKpJFlYMxQ177DJ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2904, 'output_tokens': 1376, 'total_tokens': 4280, 'input_token_details': {'audio': 0, 'cache_read': 2688}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-12 11:23:39,041 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_th7tGXmL7gVWHj1EMBRPJgl2', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1460, 'prompt_tokens': 2997, 'total_tokens': 4457, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1408, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--00a9c49d-974c-4bdd-a6fe-31d58bb3428f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java'}, 'id': 'call_th7tGXmL7gVWHj1EMBRPJgl2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2997, 'output_tokens': 1460, 'total_tokens': 4457, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 1408}}
2025-11-12 11:23:40,558 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Eg5Pfg7jdRAOUk1O85EBRNfT', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 3853, 'total_tokens': 3897, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d6db1604-0bac-4d92-b922-b27f398793bc-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java'}, 'id': 'call_Eg5Pfg7jdRAOUk1O85EBRNfT', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3853, 'output_tokens': 44, 'total_tokens': 3897, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:23:41,905 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_sUvoF7tK1qZDYoHMb3A6vdbI', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 4540, 'total_tokens': 4584, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a04f6aa0-2193-4dcd-8000-4a10207395bb-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java'}, 'id': 'call_sUvoF7tK1qZDYoHMb3A6vdbI', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4540, 'output_tokens': 44, 'total_tokens': 4584, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:23:43,424 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_z1wgo3Ck6qnaMEHiIuqXToJT', 'function': {'arguments': '{"relative_path":"apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 8038, 'total_tokens': 8082, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--68c36427-3482-460b-9fde-8554df798681-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java'}, 'id': 'call_z1wgo3Ck6qnaMEHiIuqXToJT', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8038, 'output_tokens': 44, 'total_tokens': 8082, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:23:45,877 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_18oNOm9m4jCGOpVcBWhqkaz0', 'function': {'arguments': '{"relative_path":"apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 45, 'prompt_tokens': 9129, 'total_tokens': 9174, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2688}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1a9a4691-8eba-4cad-9b8c-7b91e804a001-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java'}, 'id': 'call_18oNOm9m4jCGOpVcBWhqkaz0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9129, 'output_tokens': 45, 'total_tokens': 9174, 'input_token_details': {'audio': 0, 'cache_read': 2688}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:23:47,519 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_q3AlxXU9dH4p5EI8FpUY0Hfe', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 12039, 'total_tokens': 12083, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3fcd36c1-c030-4c34-9e89-94aafcd9a58a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java'}, 'id': 'call_q3AlxXU9dH4p5EI8FpUY0Hfe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12039, 'output_tokens': 44, 'total_tokens': 12083, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:23:49,600 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OG5GagYtsjGIHvDf5Kpbunua', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 12885, 'total_tokens': 12929, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5f8e54d7-2def-4f58-9e79-07054f922347-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java'}, 'id': 'call_OG5GagYtsjGIHvDf5Kpbunua', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12885, 'output_tokens': 44, 'total_tokens': 12929, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:24:00,050 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hofiWqrYCv35aCuhpQbOj6TM', 'function': {'arguments': '{"basename":"NamespaceTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 926, 'prompt_tokens': 16072, 'total_tokens': 16998, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 896, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2560}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a5cbd379-4ba3-4363-ac40-8a8a9b30794b-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceTest.java'}, 'id': 'call_hofiWqrYCv35aCuhpQbOj6TM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16072, 'output_tokens': 926, 'total_tokens': 16998, 'input_token_details': {'audio': 0, 'cache_read': 2560}, 'output_token_details': {'audio': 0, 'reasoning': 896}}
2025-11-12 11:24:21,136 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_prp3u8Ked6aEXXN9AgobdKFD', 'function': {'arguments': '{"text":"Namespace","basename":"java"}', 'name': 'find_ast_node_with_text_in_file_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1316, 'prompt_tokens': 16122, 'total_tokens': 17438, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1280, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12800}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ad30180d-4320-4f00-8e16-381b36b8b930-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'text': 'Namespace', 'basename': 'java'}, 'id': 'call_prp3u8Ked6aEXXN9AgobdKFD', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16122, 'output_tokens': 1316, 'total_tokens': 17438, 'input_token_details': {'audio': 0, 'cache_read': 12800}, 'output_token_details': {'audio': 0, 'reasoning': 1280}}
2025-11-12 11:24:49,843 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hDWNCErtkE0FsG2aNOCnWujF', 'function': {'arguments': '{"basename":"ConfigControllerTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2335, 'prompt_tokens': 16183, 'total_tokens': 18518, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2304, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12032}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--94d80006-7402-428d-bef0-b2a8196912f3-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ConfigControllerTest.java'}, 'id': 'call_hDWNCErtkE0FsG2aNOCnWujF', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16183, 'output_tokens': 2335, 'total_tokens': 18518, 'input_token_details': {'audio': 0, 'cache_read': 12032}, 'output_token_details': {'audio': 0, 'reasoning': 2304}}
2025-11-12 11:24:51,433 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_eb1qqaBzI2NpLBo8khnm9drf', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 16273, 'total_tokens': 16317, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b4a56195-7ea1-41d6-879a-d1465560f187-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java'}, 'id': 'call_eb1qqaBzI2NpLBo8khnm9drf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16273, 'output_tokens': 44, 'total_tokens': 16317, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:24:57,421 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_KigWojCFgvvBSeA59k4i6X2Y', 'function': {'arguments': '{"basename":"NamespaceUtilTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 351, 'prompt_tokens': 23409, 'total_tokens': 23760, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5b72f721-3c0b-4a81-8bb9-ea6d6974903f-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceUtilTest.java'}, 'id': 'call_KigWojCFgvvBSeA59k4i6X2Y', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23409, 'output_tokens': 351, 'total_tokens': 23760, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 11:25:09,006 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_llojJEItMst5g2ngdRLT2zix', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 23499, 'total_tokens': 23543, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3840}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3a7cc838-08d2-4cee-8e97-0fa45ac74e54-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java'}, 'id': 'call_llojJEItMst5g2ngdRLT2zix', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23499, 'output_tokens': 44, 'total_tokens': 23543, 'input_token_details': {'audio': 0, 'cache_read': 3840}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:25:19,253 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_FHPzctC2jWgMI1QNnf3IGu60', 'function': {'arguments': '{"basename":"AppNamespaceServiceTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 928, 'prompt_tokens': 25139, 'total_tokens': 26067, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 896, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2a470550-84eb-4e73-8606-e779144415e7-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceServiceTest.java'}, 'id': 'call_FHPzctC2jWgMI1QNnf3IGu60', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25139, 'output_tokens': 928, 'total_tokens': 26067, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 896}}
2025-11-12 11:25:36,201 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I identified all relevant test files under the specified modules that reference “Namespace”/“namespace” and retrieved their full contents with line numbers. These include NamespaceControllerTest (portal and adminservice), NamespaceServiceTest (portal and biz), NamespaceBranchServiceTest (biz), AppNamespaceControllerTest (adminservice), AppNamespaceServiceTest (portal), ConfigControllerTest (configservice), and NamespaceUtilTest (configservice). The outputs include full imports, setup, assertions, file paths, and line numbers. If you need additional occurrences beyond these files, I can run a grep-style listing across the test directories.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2052, 'prompt_tokens': 25231, 'total_tokens': 27283, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1920, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 16256}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--db88cc9c-4787-4c3b-9c66-1cd5c514a2a3-0' usage_metadata={'input_tokens': 25231, 'output_tokens': 2052, 'total_tokens': 27283, 'input_token_details': {'audio': 0, 'cache_read': 16256}, 'output_token_details': {'audio': 0, 'reasoning': 1920}}
2025-11-12 11:25:36,205 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content (with line numbers) of all test files under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-biz/src/test/java, and apollo-configservice/src/test/java that reference “Namespace” or “namespace” (e.g., NamespaceController, NamespaceService).
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending full files is too large, please share a grep/result listing of all occurrences of “namespace” within those src/test/java directories, including file paths, line numbers, and the surrounding import blocks and test method bodies.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
I need these test contents to identify 8 relevant existing test cases and include their exact imports, setup, assertions, file paths, and line numbers.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java
Line number range: 1 - 62
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;
20. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
21. import com.ctrip.framework.apollo.common.entity.AppNamespace;
22. 
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.jdbc.Sql;
27. 
28. public class AppNamespaceControllerTest extends AbstractControllerTest{
29. 
30.   @Autowired
31.   private AppNamespaceRepository namespaceRepository;
32. 
33.   @Test
34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
35.   public void testCreate(){
36.     String appId = "6666";
37.     String name = "testnamespace";
38.     String comment = "comment";
39.     AppNamespaceDTO dto = new AppNamespaceDTO();
40.     dto.setAppId(appId);
41.     dto.setName(name);
42.     dto.setComment(comment);
43.     dto.setDataChangeCreatedBy("apollo");
44. 
45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(
46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();
47. 
48.     Assert.assertEquals(appId, resultDto.getAppId());
49.     Assert.assertTrue(resultDto.getId() > 0);
50. 
51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);
52.     Assert.assertNotNull(savedAppNs);
53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());
54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());
55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());
56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());
57. 
58. 
59. 
60. 
61.   }
62. }


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java
Line number range: 1 - 47
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import org.junit.Assert;
22. import org.junit.Test;
23. import org.springframework.web.client.HttpClientErrorException;
24. import static org.hamcrest.Matchers.containsString;
25. 
26. /**
27.  * Created by kezhenxu at 2019/1/8 16:27.
28.  *
29.  * @author kezhenxu (kezhenxu94@163.com)
30.  */
31. public class NamespaceControllerTest extends AbstractControllerTest {
32.   @Test
33.   public void create() {
34.     try {
35.       NamespaceDTO namespaceDTO = new NamespaceDTO();
36.       namespaceDTO.setClusterName("cluster");
37.       namespaceDTO.setNamespaceName("invalid name");
38.       namespaceDTO.setAppId("whatever");
39.       restTemplate.postForEntity(
40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),
41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());
42.       Assert.fail("Should throw");
43.     } catch (HttpClientErrorException e) {
44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
45.     }
46.   }
47. }


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java
Line number range: 1 - 208
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. import com.ctrip.framework.apollo.biz.AbstractIntegrationTest;
20. import com.ctrip.framework.apollo.biz.entity.GrayReleaseRule;
21. import com.ctrip.framework.apollo.biz.entity.Namespace;
22. import com.ctrip.framework.apollo.biz.entity.ReleaseHistory;
23. import com.ctrip.framework.apollo.common.constants.NamespaceBranchStatus;
24. import com.ctrip.framework.apollo.common.constants.ReleaseOperation;
25. 
26. import org.junit.Assert;
27. import org.junit.Test;
28. import org.springframework.beans.factory.annotation.Autowired;
29. import org.springframework.data.domain.Page;
30. import org.springframework.data.domain.PageRequest;
31. import org.springframework.data.domain.Pageable;
32. import org.springframework.test.context.jdbc.Sql;
33. 
34. public class NamespaceBranchServiceTest extends AbstractIntegrationTest {
35. 
36.   @Autowired
37.   private NamespaceBranchService namespaceBranchService;
38. 
39.   @Autowired
40.   private ReleaseHistoryService releaseHistoryService;
41. 
42.   private String testApp = "test";
43.   private String testCluster = "default";
44.   private String testNamespace = "application";
45.   private String testBranchName = "child-cluster";
46.   private String operator = "apollo";
47.   private Pageable pageable = PageRequest.of(0, 10);
48. 
49.   @Test
50.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
51.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
52.   public void testFindBranch() {
53.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);
54. 
55.     Assert.assertNotNull(branch);
56.     Assert.assertEquals(testBranchName, branch.getClusterName());
57.   }
58. 
59.   @Test
60.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
61.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
62.   public void testUpdateBranchGrayRulesWithUpdateOnce() {
63.     GrayReleaseRule rule = instanceGrayReleaseRule();
64. 
65.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, rule);
66. 
67.     GrayReleaseRule
68.         activeRule =
69.         namespaceBranchService.findBranchGrayRules(testApp, testCluster, testNamespace, testBranchName);
70. 
71.     Assert.assertNotNull(activeRule);
72.     Assert.assertEquals(rule.getAppId(), activeRule.getAppId());
73.     Assert.assertEquals(rule.getRules(), activeRule.getRules());
74.     Assert.assertEquals(Long.valueOf(0), activeRule.getReleaseId());
75. 
76.     Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace
77.         (testApp, testCluster, testNamespace, pageable);
78. 
79.     ReleaseHistory releaseHistory = releaseHistories.getContent().get(0);
80. 
81.     Assert.assertEquals(1, releaseHistories.getTotalElements());
82.     Assert.assertEquals(ReleaseOperation.APPLY_GRAY_RULES, releaseHistory.getOperation());
83.     Assert.assertEquals(0, releaseHistory.getReleaseId());
84.     Assert.assertEquals(0, releaseHistory.getPreviousReleaseId());
85.     Assert.assertTrue(releaseHistory.getOperationContext().contains(rule.getRules()));
86.   }
87. 
88.   @Test
89.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
90.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
91.   public void testUpdateBranchGrayRulesWithUpdateTwice() {
92. 
93.     GrayReleaseRule firstRule = instanceGrayReleaseRule();
94.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, firstRule);
95. 
96.     GrayReleaseRule secondRule = instanceGrayReleaseRule();
97.     secondRule.setRules("[{\"clientAppId\":\"branch-test\",\"clientIpList\":[\"10.38.57.112\"],\"clientLabelList\":[\"branch-test\"]}]");
98.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, secondRule);
99. 
100.     GrayReleaseRule
101.         activeRule =
102.         namespaceBranchService.findBranchGrayRules(testApp, testCluster, testNamespace, testBranchName);
103. 
104.     Assert.assertNotNull(secondRule);
105.     Assert.assertEquals(secondRule.getAppId(), activeRule.getAppId());
106.     Assert.assertEquals(secondRule.getRules(), activeRule.getRules());
107.     Assert.assertEquals(Long.valueOf(0), activeRule.getReleaseId());
108. 
109.     Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace
110.         (testApp, testCluster, testNamespace, pageable);
111. 
112.     ReleaseHistory firstReleaseHistory = releaseHistories.getContent().get(1);
113.     ReleaseHistory secondReleaseHistory = releaseHistories.getContent().get(0);
114. 
115.     Assert.assertEquals(2, releaseHistories.getTotalElements());
116.     Assert.assertEquals(ReleaseOperation.APPLY_GRAY_RULES, firstReleaseHistory.getOperation());
117.     Assert.assertEquals(ReleaseOperation.APPLY_GRAY_RULES, secondReleaseHistory.getOperation());
118.     Assert.assertTrue(firstReleaseHistory.getOperationContext().contains(firstRule.getRules()));
119.     Assert.assertFalse(firstReleaseHistory.getOperationContext().contains(secondRule.getRules()));
120.     Assert.assertTrue(secondReleaseHistory.getOperationContext().contains(firstRule.getRules()));
121.     Assert.assertTrue(secondReleaseHistory.getOperationContext().contains(secondRule.getRules()));
122.   }
123. 
124.   @Test
125.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
126.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
127.   public void testUpdateRulesReleaseIdWithOldRuleNotExist() {
128.     long latestReleaseId = 100;
129. 
130.     namespaceBranchService
131.         .updateRulesReleaseId(testApp, testCluster, testNamespace, testBranchName, latestReleaseId, operator);
132. 
133.     GrayReleaseRule
134.         activeRule =
135.         namespaceBranchService.findBranchGrayRules(testApp, testCluster, testNamespace, testBranchName);
136. 
137.     Assert.assertNull(activeRule);
138.   }
139. 
140.   @Test
141.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
142.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
143.   public void testUpdateRulesReleaseIdWithOldRuleExist() {
144. 
145.     GrayReleaseRule rule = instanceGrayReleaseRule();
146.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, rule);
147. 
148.     long latestReleaseId = 100;
149. 
150.     namespaceBranchService
151.         .updateRulesReleaseId(testApp, testCluster, testNamespace, testBranchName, latestReleaseId, operator);
152. 
153.     GrayReleaseRule
154.         activeRule =
155.         namespaceBranchService.findBranchGrayRules(testApp, testCluster, testNamespace, testBranchName);
156. 
157.     Assert.assertNotNull(activeRule);
158.     Assert.assertEquals(Long.valueOf(latestReleaseId), activeRule.getReleaseId());
159.     Assert.assertEquals(rule.getRules(), activeRule.getRules());
160.     Assert.assertEquals(NamespaceBranchStatus.ACTIVE, activeRule.getBranchStatus());
161.   }
162. 
163. 
164.   @Test
165.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
166.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
167.   public void testDeleteBranch() {
168. 
169.     GrayReleaseRule rule = instanceGrayReleaseRule();
170.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, rule);
171. 
172.     namespaceBranchService.deleteBranch(testApp, testCluster, testNamespace, testBranchName, NamespaceBranchStatus.DELETED, operator);
173. 
174.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);
175.     Assert.assertNull(branch);
176. 
177.     GrayReleaseRule latestRule = namespaceBranchService.findBranchGrayRules(testApp, testCluster, testNamespace, testBranchName);
178. 
179.     Assert.assertNotNull(latestRule);
180.     Assert.assertEquals(NamespaceBranchStatus.DELETED, latestRule.getBranchStatus());
181.     Assert.assertEquals("[]", latestRule.getRules());
182. 
183.     Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace
184.         (testApp, testCluster, testNamespace, pageable);
185. 
186.     ReleaseHistory firstReleaseHistory = releaseHistories.getContent().get(1);
187.     ReleaseHistory secondReleaseHistory = releaseHistories.getContent().get(0);
188. 
189.     Assert.assertEquals(2, releaseHistories.getTotalElements());
190.     Assert.assertEquals(ReleaseOperation.APPLY_GRAY_RULES, firstReleaseHistory.getOperation());
191.     Assert.assertEquals(ReleaseOperation.ABANDON_GRAY_RELEASE, secondReleaseHistory.getOperation());
192. 
193.   }
194. 
195. 
196.   private GrayReleaseRule instanceGrayReleaseRule() {
197.     GrayReleaseRule rule = new GrayReleaseRule();
198.     rule.setAppId(testApp);
199.     rule.setClusterName(testCluster);
200.     rule.setNamespaceName(testNamespace);
201.     rule.setBranchName(testBranchName);
202.     rule.setBranchStatus(NamespaceBranchStatus.ACTIVE);
203.     rule.setRules("[{\"clientAppId\":\"test\",\"clientIpList\":[\"1.0.0.4\"],\"clientLabelList\":[]}]");
204.     return rule;
205.   }
206. 
207. 
208. }


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java
Line number range: 1 - 88
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. import com.ctrip.framework.apollo.biz.AbstractUnitTest;
20. import com.ctrip.framework.apollo.biz.MockBeanFactory;
21. import com.ctrip.framework.apollo.biz.entity.Namespace;
22. import com.ctrip.framework.apollo.biz.repository.NamespaceRepository;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.common.exception.BadRequestException;
25. import com.ctrip.framework.apollo.core.ConfigConsts;
26. 
27. import org.junit.Test;
28. import org.mockito.InjectMocks;
29. import org.mockito.Mock;
30. import org.mockito.Spy;
31. import org.springframework.data.domain.PageRequest;
32. import org.springframework.data.domain.Pageable;
33. 
34. import java.util.Arrays;
35. import java.util.List;
36. 
37. import static org.junit.Assert.assertEquals;
38. import static org.mockito.Mockito.doReturn;
39. import static org.mockito.Mockito.when;
40. 
41. public class NamespaceServiceTest extends AbstractUnitTest {
42. 
43.   @Mock
44.   private AppNamespaceService appNamespaceService;
45.   @Mock
46.   private NamespaceRepository namespaceRepository;
47. 
48.   @Spy
49.   @InjectMocks
50.   private NamespaceService namespaceService;
51. 
52.   private String testPublicAppNamespace = "publicAppNamespace";
53. 
54. 
55.   @Test(expected = BadRequestException.class)
56.   public void testFindPublicAppNamespaceWithWrongNamespace() {
57.     Pageable page = PageRequest.of(0, 10);
58. 
59.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(null);
60. 
61.     namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);
62.   }
63. 
64.   @Test
65.   public void testFindPublicAppNamespace() {
66. 
67.     AppNamespace publicAppNamespace = MockBeanFactory.mockAppNamespace(null, testPublicAppNamespace, true);
68.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(publicAppNamespace);
69. 
70.     Namespace firstParentNamespace =
71.         MockBeanFactory.mockNamespace("app", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);
72.     Namespace secondParentNamespace =
73.         MockBeanFactory.mockNamespace("app1", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);
74. 
75.     Pageable page = PageRequest.of(0, 10);
76. 
77.     when(namespaceRepository.findByNamespaceName(testPublicAppNamespace, page))
78.         .thenReturn(Arrays.asList(firstParentNamespace, secondParentNamespace));
79. 
80.     doReturn(false).when(namespaceService).isChildNamespace(firstParentNamespace);
81.     doReturn(false).when(namespaceService).isChildNamespace(secondParentNamespace);
82. 
83.     List<Namespace> namespaces = namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);
84. 
85.     assertEquals(2, namespaces.size());
86.   }
87. 
88. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 1 - 481
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Release;
20. import com.ctrip.framework.apollo.common.entity.AppNamespace;
21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;
23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;
24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;
25. import com.ctrip.framework.apollo.core.ConfigConsts;
26. import com.ctrip.framework.apollo.core.dto.ApolloConfig;
27. import com.ctrip.framework.apollo.core.dto.ApolloNotificationMessages;
28. import com.google.common.base.Joiner;
29. import com.google.common.collect.ImmutableMap;
30. import com.google.common.collect.Lists;
31. import com.google.gson.Gson;
32. import com.google.gson.JsonSyntaxException;
33. import org.junit.Before;
34. import org.junit.Test;
35. import org.junit.runner.RunWith;
36. import org.mockito.Mock;
37. import org.mockito.junit.MockitoJUnitRunner;
38. 
39. import javax.servlet.http.HttpServletRequest;
40. import javax.servlet.http.HttpServletResponse;
41. import java.util.Map;
42. 
43. import static org.junit.Assert.assertEquals;
44. import static org.junit.Assert.assertNull;
45. import static org.mockito.Mockito.*;
46. 
47. /**
48.  * @author Jason Song(song_s@ctrip.com)
49.  */
50. @RunWith(MockitoJUnitRunner.class)
51. public class ConfigControllerTest {
52.   private ConfigController configController;
53.   @Mock
54.   private ConfigService configService;
55.   @Mock
56.   private AppNamespaceServiceWithCache appNamespaceService;
57.   private String someAppId;
58.   private String someClusterName;
59.   private String defaultClusterName;
60.   private String defaultNamespaceName;
61.   private String somePublicNamespaceName;
62.   private String someDataCenter;
63.   private String someClientIp;
64.   private String someClientLabel;
65.   private String someMessagesAsString;
66.   @Mock
67.   private ApolloNotificationMessages someNotificationMessages;
68.   @Mock
69.   private Release someRelease;
70.   @Mock
71.   private Release somePublicRelease;
72.   @Mock
73.   private NamespaceUtil namespaceUtil;
74.   @Mock
75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;
76.   @Mock
77.   private HttpServletRequest someRequest;
78.   private Gson gson = new Gson();
79. 
80.   @Before
81.   public void setUp() throws Exception {
82.     configController = spy(new ConfigController(
83.         configService, appNamespaceService, namespaceUtil, instanceConfigAuditUtil, gson
84.     ));
85. 
86.     someAppId = "1";
87.     someClusterName = "someClusterName";
88.     defaultClusterName = ConfigConsts.CLUSTER_NAME_DEFAULT;
89.     defaultNamespaceName = ConfigConsts.NAMESPACE_APPLICATION;
90.     somePublicNamespaceName = "somePublicNamespace";
91.     someDataCenter = "someDC";
92.     someClientIp = "someClientIp";
93.     someClientLabel = "someClientLabel";
94.     String someValidConfiguration = "{\"apollo.bar\": \"foo\"}";
95.     String somePublicConfiguration = "{\"apollo.public.bar\": \"foo\"}";
96. 
97.     when(someRelease.getAppId()).thenReturn(someAppId);
98.     when(someRelease.getClusterName()).thenReturn(someClusterName);
99.     when(someRelease.getConfigurations()).thenReturn(someValidConfiguration);
100.     when(somePublicRelease.getConfigurations()).thenReturn(somePublicConfiguration);
101.     when(namespaceUtil.filterNamespaceName(defaultNamespaceName)).thenReturn(defaultNamespaceName);
102.     when(namespaceUtil.filterNamespaceName(somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
103.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
104.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
105. 
106.     someMessagesAsString = "someValidJson";
107.     when(configController.transformMessages(someMessagesAsString)).thenReturn(someNotificationMessages);
108.   }
109. 
110.   @Test
111.   public void testQueryConfig() throws Exception {
112.     String someClientSideReleaseKey = "1";
113.     String someServerSideNewReleaseKey = "2";
114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
115. 
116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);
120. 
121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
124. 
125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
126.         defaultNamespaceName, someDataCenter, someNotificationMessages);
127.     assertEquals(someAppId, result.getAppId());
128.     assertEquals(someClusterName, result.getCluster());
129.     assertEquals(defaultNamespaceName, result.getNamespaceName());
130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);
133.   }
134. 
135.   @Test
136.   public void testQueryConfigFile() throws Exception {
137.     String someClientSideReleaseKey = "1";
138.     String someServerSideNewReleaseKey = "2";
139.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
140.     String someNamespaceName = String.format("%s.%s", defaultClusterName, "properties");
141. 
142.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
143.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
144.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
145.     when(namespaceUtil.filterNamespaceName(someNamespaceName)).thenReturn(defaultNamespaceName);
146.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
147. 
148.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
149.         someNamespaceName, someDataCenter, someClientSideReleaseKey,
150.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
151. 
152.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
153.         defaultNamespaceName, someDataCenter, someNotificationMessages);
154.     assertEquals(someAppId, result.getAppId());
155.     assertEquals(someClusterName, result.getCluster());
156.     assertEquals(someNamespaceName, result.getNamespaceName());
157.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
158.   }
159. 
160.   @Test
161.   public void testQueryConfigFileWithPrivateNamespace() throws Exception {
162.     String someClientSideReleaseKey = "1";
163.     String someServerSideNewReleaseKey = "2";
164.     String somePrivateNamespace = "datasource";
165.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
166.     String somePrivateNamespaceName = String.format("%s.%s", somePrivateNamespace, "xml");
167.     AppNamespace appNamespace = mock(AppNamespace.class);
168. 
169.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePrivateNamespace,
170.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
171.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
172.     when(namespaceUtil.filterNamespaceName(somePrivateNamespaceName)).thenReturn(somePrivateNamespace);
173.     when(namespaceUtil.normalizeNamespace(someAppId, somePrivateNamespace)).thenReturn(somePrivateNamespace);
174.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePrivateNamespace))
175.         .thenReturn(appNamespace);
176. 
177.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
178.         somePrivateNamespaceName, someDataCenter, someClientSideReleaseKey,
179.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
180. 
181.     assertEquals(someAppId, result.getAppId());
182.     assertEquals(someClusterName, result.getCluster());
183.     assertEquals(somePrivateNamespaceName, result.getNamespaceName());
184.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
185.   }
186. 
187.   @Test
188.   public void testQueryConfigWithReleaseNotFound() throws Exception {
189.     String someClientSideReleaseKey = "1";
190.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
191. 
192.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
193.         someDataCenter, someNotificationMessages)).thenReturn(null);
194. 
195.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
196.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
197.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
198. 
199.     assertNull(result);
200.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());
201.   }
202. 
203.   @Test
204.   public void testQueryConfigWithApolloConfigNotModified() throws Exception {
205.     String someClientSideReleaseKey = "1";
206.     String someServerSideReleaseKey = someClientSideReleaseKey;
207.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
208. 
209.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
210.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
211.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
212. 
213.     ApolloConfig result =
214.         configController.queryConfig(someAppId, someClusterName, defaultNamespaceName, someDataCenter,
215.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
216. 
217.     assertNull(result);
218.     verify(someResponse, times(1)).setStatus(HttpServletResponse.SC_NOT_MODIFIED);
219.   }
220. 
221.   @Test
222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {
223.     String someClientSideReleaseKey = "1";
224.     String someServerSideReleaseKey = "2";
225.     String someAppOwnNamespaceName = "someAppOwn";
226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
227.     AppNamespace someAppOwnNamespace =
228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);
229. 
230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,
231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))
233.         .thenReturn(someAppOwnNamespace);
234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
237. 
238.     ApolloConfig result =
239.         configController
240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,
241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
242. 
243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
244.     assertEquals(someAppId, result.getAppId());
245.     assertEquals(someClusterName, result.getCluster());
246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());
247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));
248.   }
249. 
250.   @Test
251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {
252.     String someClientSideReleaseKey = "1";
253.     String someServerSideReleaseKey = "2";
254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
255.     String somePublicAppId = "somePublicAppId";
256.     String somePublicClusterName = "somePublicClusterName";
257.     AppNamespace somePublicAppNamespace =
258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
259. 
260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
261.         someDataCenter, someNotificationMessages)).thenReturn(null);
262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
263.         .thenReturn(somePublicAppNamespace);
264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);
269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
270. 
271.     ApolloConfig result = configController
272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
274. 
275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
276.     assertEquals(someAppId, result.getAppId());
277.     assertEquals(someClusterName, result.getCluster());
278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);
282.   }
283. 
284.   @Test
285.   public void testQueryConfigFileWithPublicNamespaceAndNoAppOverride() throws Exception {
286.     String someClientSideReleaseKey = "1";
287.     String someServerSideReleaseKey = "2";
288.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
289.     String somePublicAppId = "somePublicAppId";
290.     String someNamespace = String.format("%s.%s", somePublicNamespaceName, "properties");
291.     AppNamespace somePublicAppNamespace =
292.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
293. 
294.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
295.         someDataCenter, someNotificationMessages)).thenReturn(null);
296.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
297.         .thenReturn(somePublicAppNamespace);
298.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
299.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
300.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
301.     when(namespaceUtil.filterNamespaceName(someNamespace)).thenReturn(somePublicNamespaceName);
302.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
303.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePublicNamespaceName)).thenReturn(null);
304. 
305.     ApolloConfig result = configController
306.         .queryConfig(someAppId, someClusterName, someNamespace, someDataCenter,
307.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
308. 
309.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
310.     assertEquals(someAppId, result.getAppId());
311.     assertEquals(someClusterName, result.getCluster());
312.     assertEquals(someNamespace, result.getNamespaceName());
313.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
314.   }
315. 
316.   @Test
317.   public void testQueryConfigWithPublicNamespaceAndAppOverride() throws Exception {
318.     String someAppSideReleaseKey = "1";
319.     String somePublicAppSideReleaseKey = "2";
320. 
321.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
322.     String somePublicAppId = "somePublicAppId";
323.     AppNamespace somePublicAppNamespace =
324.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
325. 
326.     when(someRelease.getConfigurations()).thenReturn("{\"apollo.public.foo\": \"foo-override\"}");
327.     when(somePublicRelease.getConfigurations())
328.         .thenReturn("{\"apollo.public.foo\": \"foo\", \"apollo.public.bar\": \"bar\"}");
329. 
330.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
331.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
332.     when(someRelease.getReleaseKey()).thenReturn(someAppSideReleaseKey);
333.     when(someRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
334.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
335.         .thenReturn(somePublicAppNamespace);
336.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
337.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
338.     when(somePublicRelease.getReleaseKey()).thenReturn(somePublicAppSideReleaseKey);
339.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
340.     when(somePublicRelease.getClusterName()).thenReturn(someDataCenter);
341.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
342. 
343.     ApolloConfig result =
344.         configController
345.             .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
346.                 someAppSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
347. 
348.     assertEquals(Joiner.on(ConfigConsts.CLUSTER_NAMESPACE_SEPARATOR)
349.             .join(someAppSideReleaseKey, somePublicAppSideReleaseKey),
350.         result.getReleaseKey());
351.     assertEquals(someAppId, result.getAppId());
352.     assertEquals(someClusterName, result.getCluster());
353.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
354.     assertEquals("foo-override", result.getConfigurations().get("apollo.public.foo"));
355.     assertEquals("bar", result.getConfigurations().get("apollo.public.bar"));
356.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
357.         someClientIp, someAppId, someClusterName, somePublicNamespaceName, someAppSideReleaseKey);
358.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
359.         someClientIp, somePublicAppId, someDataCenter, somePublicNamespaceName, somePublicAppSideReleaseKey);
360.   }
361. 
362.   @Test
363.   public void testMergeConfigurations() throws Exception {
364.     Gson gson = new Gson();
365.     String key1 = "key1";
366.     String value1 = "value1";
367.     String anotherValue1 = "anotherValue1";
368. 
369.     String key2 = "key2";
370.     String value2 = "value2";
371. 
372.     Map<String, String> config = ImmutableMap.of(key1, anotherValue1);
373.     Map<String, String> anotherConfig = ImmutableMap.of(key1, value1, key2, value2);
374. 
375.     Release releaseWithHighPriority = new Release();
376.     releaseWithHighPriority.setConfigurations(gson.toJson(config));
377. 
378.     Release releaseWithLowPriority = new Release();
379.     releaseWithLowPriority.setConfigurations(gson.toJson(anotherConfig));
380. 
381.     Map<String, String> result =
382.         configController.mergeReleaseConfigurations(
383.             Lists.newArrayList(releaseWithHighPriority, releaseWithLowPriority));
384. 
385.     assertEquals(2, result.keySet().size());
386.     assertEquals(anotherValue1, result.get(key1));
387.     assertEquals(value2, result.get(key2));
388.   }
389. 
390.   @Test(expected = JsonSyntaxException.class)
391.   public void testTransformConfigurationToMapFailed() throws Exception {
392.     String someInvalidConfiguration = "xxx";
393.     Release someRelease = new Release();
394.     someRelease.setConfigurations(someInvalidConfiguration);
395. 
396.     configController.mergeReleaseConfigurations(Lists.newArrayList(someRelease));
397.   }
398. 
399.   @Test
400.   public void testQueryConfigForNoAppIdPlaceHolder() throws Exception {
401.     String someClientSideReleaseKey = "1";
402.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
403.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
404. 
405.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
406.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
407.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
408. 
409.     verify(configService, never()).loadConfig(appId, someClientIp, someAppId, someClientLabel, someClusterName, defaultNamespaceName,
410.         someDataCenter, someNotificationMessages);
411.     verify(appNamespaceService, never()).findPublicNamespaceByName(defaultNamespaceName);
412.     assertNull(result);
413.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());
414.   }
415. 
416.   @Test
417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {
418.     String someClientSideReleaseKey = "1";
419.     String someServerSideReleaseKey = "2";
420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
421.     String somePublicAppId = "somePublicAppId";
422.     AppNamespace somePublicAppNamespace =
423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
425. 
426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
427.         .thenReturn(somePublicAppNamespace);
428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
432. 
433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,
435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
436. 
437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,
438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);
439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
440.     assertEquals(appId, result.getAppId());
441.     assertEquals(someClusterName, result.getCluster());
442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
444.   }
445. 
446.   @Test
447.   public void testTransformMessages() throws Exception {
448.     String someKey = "someKey";
449.     long someNotificationId = 1;
450.     String anotherKey = "anotherKey";
451.     long anotherNotificationId = 2;
452.     ApolloNotificationMessages notificationMessages = new ApolloNotificationMessages();
453.     notificationMessages.put(someKey, someNotificationId);
454.     notificationMessages.put(anotherKey, anotherNotificationId);
455. 
456.     String someMessagesAsString = gson.toJson(notificationMessages);
457. 
458.     ApolloNotificationMessages result = configController.transformMessages(someMessagesAsString);
459. 
460.     assertEquals(notificationMessages.getDetails(), result.getDetails());
461.   }
462. 
463.   @Test
464.   public void testTransformInvalidMessages() throws Exception {
465.     String someInvalidMessages = "someInvalidMessages";
466. 
467.     assertNull(configController.transformMessages(someInvalidMessages));
468.   }
469. 
470.   private AppNamespace assemblePublicAppNamespace(String appId, String namespace) {
471.     return assembleAppNamespace(appId, namespace, true);
472.   }
473. 
474.   private AppNamespace assembleAppNamespace(String appId, String namespace, boolean isPublic) {
475.     AppNamespace appNamespace = new AppNamespace();
476.     appNamespace.setAppId(appId);
477.     appNamespace.setName(namespace);
478.     appNamespace.setPublic(isPublic);
479.     return appNamespace;
480.   }
481. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 1 - 127
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.util;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
21. import org.junit.Before;
22. import org.junit.Test;
23. import org.junit.runner.RunWith;
24. import org.mockito.Mock;
25. import org.mockito.junit.MockitoJUnitRunner;
26. 
27. import static org.junit.Assert.assertEquals;
28. import static org.mockito.Mockito.*;
29. 
30. /**
31.  * @author Jason Song(song_s@ctrip.com)
32.  */
33. @RunWith(MockitoJUnitRunner.class)
34. public class NamespaceUtilTest {
35.   private NamespaceUtil namespaceUtil;
36. 
37.   @Mock
38.   private AppNamespaceServiceWithCache appNamespaceServiceWithCache;
39. 
40.   @Before
41.   public void setUp() throws Exception {
42.     namespaceUtil = new NamespaceUtil(appNamespaceServiceWithCache);
43.   }
44. 
45.   @Test
46.   public void testFilterNamespaceName() throws Exception {
47.     String someName = "a.properties";
48. 
49.     assertEquals("a", namespaceUtil.filterNamespaceName(someName));
50.   }
51. 
52.   @Test
53.   public void testFilterNamespaceNameUnchanged() throws Exception {
54.     String someName = "a.xml";
55. 
56.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
57.   }
58. 
59.   @Test
60.   public void testFilterNamespaceNameWithMultiplePropertiesSuffix() throws Exception {
61.     String someName = "a.properties.properties";
62. 
63.     assertEquals("a.properties", namespaceUtil.filterNamespaceName(someName));
64.   }
65. 
66.   @Test
67.   public void testFilterNamespaceNameWithRandomCase() throws Exception {
68.     String someName = "AbC.ProPErties";
69. 
70.     assertEquals("AbC", namespaceUtil.filterNamespaceName(someName));
71.   }
72. 
73.   @Test
74.   public void testFilterNamespaceNameWithRandomCaseUnchanged() throws Exception {
75.     String someName = "AbCD.xMl";
76. 
77.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
78.   }
79. 
80.   @Test
81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {
82.     String someAppId = "someAppId";
83.     String someNamespaceName = "someNamespaceName";
84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
85.     AppNamespace someAppNamespace = mock(AppNamespace.class);
86. 
87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn
89.         (someAppNamespace);
90. 
91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
92. 
93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);
95.   }
96. 
97.   @Test
98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {
99.     String someAppId = "someAppId";
100.     String someNamespaceName = "someNamespaceName";
101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
102.     AppNamespace someAppNamespace = mock(AppNamespace.class);
103. 
104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);
107. 
108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
109. 
110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
112.   }
113. 
114.   @Test
115.   public void testNormalizeNamespaceFailed() throws Exception {
116.     String someAppId = "someAppId";
117.     String someNamespaceName = "someNamespaceName";
118. 
119.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
120.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(null);
121. 
122.     assertEquals(someNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
123. 
124.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
125.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
126.   }
127. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 1 - 61
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.openapi.v1.controller;
18. 
19. import com.ctrip.framework.apollo.common.utils.InputValidator;
20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;
22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.ActiveProfiles;
27. import org.springframework.web.client.HttpClientErrorException;
28. import static org.hamcrest.Matchers.containsString;
29. 
30. /**
31.  * Created by kezhenxu at 2019/1/8 18:17.
32.  *
33.  * @author kezhenxu (kezhenxu94@163.com)
34.  */
35. @ActiveProfiles("skipAuthorization")
36. public class NamespaceControllerTest extends AbstractControllerTest {
37.   @Autowired
38.   private ConsumerPermissionValidator consumerPermissionValidator;
39. 
40.   @Test
41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {
42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));
43. 
44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();
45.     dto.setAppId("appId");
46.     dto.setName("invalid name");
47.     dto.setFormat(ConfigFileFormat.Properties.getValue());
48.     dto.setDataChangeCreatedBy("apollo");
49.     try {
50.       restTemplate.postForEntity(
51.           url("/openapi/v1/apps/{appId}/appnamespaces"),
52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()
53.       );
54.       Assert.fail("should throw");
55.     } catch (HttpClientErrorException e) {
56.       String result = e.getResponseBodyAsString();
57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
59.     }
60.   }
61. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java
Line number range: 1 - 235
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.common.exception.BadRequestException;
21. import com.ctrip.framework.apollo.core.ConfigConsts;
22. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
23. import com.ctrip.framework.apollo.portal.AbstractIntegrationTest;
24. 
25. import org.junit.Assert;
26. import org.junit.Test;
27. import org.springframework.beans.factory.annotation.Autowired;
28. import org.springframework.test.context.jdbc.Sql;
29. 
30. import java.util.List;
31. 
32. public class AppNamespaceServiceTest extends AbstractIntegrationTest {
33. 
34.   @Autowired
35.   private AppNamespaceService appNamespaceService;
36. 
37.   private final String APP = "app-test";
38. 
39.   @Test
40.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
41.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
42.   public void testFindPublicAppNamespace() {
43. 
44.     List<AppNamespace> appNamespaceList = appNamespaceService.findPublicAppNamespaces();
45. 
46.     Assert.assertNotNull(appNamespaceList);
47.     Assert.assertEquals(5, appNamespaceList.size());
48. 
49.   }
50. 
51.   @Test
52.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
53.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
54.   public void testFindPublicAppNamespaceByName() {
55. 
56.     Assert.assertNotNull(appNamespaceService.findPublicAppNamespace("datasourcexml"));
57. 
58.     Assert.assertNull(appNamespaceService.findPublicAppNamespace("TFF.song0711-02"));
59.   }
60. 
61.   @Test
62.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
63.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
64.   public void testFindPublicAppNamespaceByAppAndName() {
65. 
66.     Assert.assertNotNull(appNamespaceService.findByAppIdAndName("100003173", "datasourcexml"));
67. 
68.     Assert.assertNull(appNamespaceService.findByAppIdAndName("100003173", "TFF.song0711-02"));
69.   }
70. 
71. 
72.   @Test
73.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
74.   public void testCreateDefaultAppNamespace() {
75.     appNamespaceService.createDefaultAppNamespace(APP);
76. 
77.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(APP, ConfigConsts.NAMESPACE_APPLICATION);
78. 
79.     Assert.assertNotNull(appNamespace);
80.     Assert.assertEquals(ConfigFileFormat.Properties.getValue(), appNamespace.getFormat());
81. 
82.   }
83. 
84.   @Test(expected = BadRequestException.class)
85.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
86.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
87.   public void testCreatePublicAppNamespaceExisted() {
88.     AppNamespace appNamespace = assembleBaseAppNamespace();
89.     appNamespace.setPublic(true);
90.     appNamespace.setName("old");
91.     appNamespace.setFormat(ConfigFileFormat.Properties.getValue());
92. 
93.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
94.   }
95. 
96.   @Test(expected = BadRequestException.class)
97.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
98.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
99.   public void testCreatePublicAppNamespaceExistedAsPrivateAppNamespace() {
100.     AppNamespace appNamespace = assembleBaseAppNamespace();
101.     appNamespace.setPublic(true);
102.     appNamespace.setName("private-01");
103.     appNamespace.setFormat(ConfigFileFormat.Properties.getValue());
104. 
105.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
106.   }
107. 
108.   @Test
109.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
110.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
111.   public void testCreatePublicAppNamespaceNotExistedWithNoAppendnamespacePrefix() {
112.     AppNamespace appNamespace = assembleBaseAppNamespace();
113.     appNamespace.setPublic(true);
114.     appNamespace.setName("old");
115.     appNamespace.setFormat(ConfigFileFormat.Properties.getValue());
116. 
117.     AppNamespace createdAppNamespace = appNamespaceService.createAppNamespaceInLocal(appNamespace, false);
118. 
119.     Assert.assertNotNull(createdAppNamespace);
120.     Assert.assertEquals(appNamespace.getName(), createdAppNamespace.getName());
121.   }
122. 
123.   @Test(expected = BadRequestException.class)
124.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
125.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
126.   public void testCreatePublicAppNamespaceExistedWithNoAppendnamespacePrefix() {
127.     AppNamespace appNamespace = assembleBaseAppNamespace();
128.     appNamespace.setPublic(true);
129.     appNamespace.setName("datasource");
130.     appNamespace.setFormat(ConfigFileFormat.Properties.getValue());
131. 
132.     appNamespaceService.createAppNamespaceInLocal(appNamespace, false);
133.   }
134. 
135.   @Test
136.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
137.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
138.   public void testCreatePublicAppNamespaceNotExisted() {
139.     AppNamespace appNamespace = assembleBaseAppNamespace();
140.     appNamespace.setPublic(true);
141. 
142.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
143. 
144.     AppNamespace createdAppNamespace = appNamespaceService.findPublicAppNamespace(appNamespace.getName());
145. 
146.     Assert.assertNotNull(createdAppNamespace);
147.     Assert.assertEquals(appNamespace.getName(), createdAppNamespace.getName());
148.   }
149. 
150.   @Test
151.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
152.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
153.   public void testCreatePublicAppNamespaceWithWrongFormatNotExisted() {
154.     AppNamespace appNamespace = assembleBaseAppNamespace();
155.     appNamespace.setPublic(true);
156.     appNamespace.setFormat(ConfigFileFormat.YAML.getValue());
157. 
158.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
159. 
160.     AppNamespace createdAppNamespace = appNamespaceService.findPublicAppNamespace(appNamespace.getName());
161. 
162.     Assert.assertNotNull(createdAppNamespace);
163.     Assert.assertEquals(appNamespace.getName(), createdAppNamespace.getName());
164.     Assert.assertEquals(ConfigFileFormat.YAML.getValue(), createdAppNamespace.getFormat());
165.   }
166. 
167. 
168.   @Test(expected = BadRequestException.class)
169.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
170.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
171.   public void testCreatePrivateAppNamespaceExisted() {
172.     AppNamespace appNamespace = assembleBaseAppNamespace();
173.     appNamespace.setPublic(false);
174.     appNamespace.setName("datasource");
175.     appNamespace.setAppId("100003173");
176. 
177.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
178.   }
179. 
180.   @Test
181.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
182.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
183.   public void testCreatePrivateAppNamespaceExistedInAnotherAppId() {
184.     AppNamespace appNamespace = assembleBaseAppNamespace();
185.     appNamespace.setPublic(false);
186.     appNamespace.setName("datasource");
187.     appNamespace.setAppId("song0711-01");
188. 
189.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
190. 
191.     AppNamespace createdAppNamespace =
192.         appNamespaceService.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName());
193. 
194.     Assert.assertNotNull(createdAppNamespace);
195.     Assert.assertEquals(appNamespace.getName(), createdAppNamespace.getName());
196.   }
197. 
198.   @Test(expected = BadRequestException.class)
199.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
200.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
201.   public void testCreatePrivateAppNamespaceExistedInAnotherAppIdAsPublic() {
202.     AppNamespace appNamespace = assembleBaseAppNamespace();
203.     appNamespace.setPublic(false);
204.     appNamespace.setName("SCC.song0711-03");
205.     appNamespace.setAppId("100003173");
206.     appNamespace.setFormat(ConfigFileFormat.Properties.getValue());
207. 
208.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
209.   }
210. 
211.   @Test
212.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
213.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
214.   public void testCreatePrivateAppNamespaceNotExisted() {
215.     AppNamespace appNamespace = assembleBaseAppNamespace();
216.     appNamespace.setPublic(false);
217. 
218.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
219. 
220.     AppNamespace createdAppNamespace =
221.         appNamespaceService.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName());
222. 
223.     Assert.assertNotNull(createdAppNamespace);
224.     Assert.assertEquals(appNamespace.getName(), createdAppNamespace.getName());
225.   }
226. 
227.   private AppNamespace assembleBaseAppNamespace() {
228.     AppNamespace appNamespace = new AppNamespace();
229.     appNamespace.setName("appNamespace");
230.     appNamespace.setAppId("1000");
231.     appNamespace.setFormat(ConfigFileFormat.XML.getValue());
232.     return appNamespace;
233.   }
234. 
235. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 1 - 254
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.dto.ClusterDTO;
20. import com.ctrip.framework.apollo.common.dto.ItemDTO;
21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
22. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
25. import com.ctrip.framework.apollo.portal.component.PortalSettings;
26. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
27. import com.ctrip.framework.apollo.portal.environment.Env;
28. import com.ctrip.framework.apollo.portal.AbstractUnitTest;
29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
30. import com.ctrip.framework.apollo.portal.component.txtresolver.PropertyResolver;
31. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
32. import com.ctrip.framework.apollo.portal.entity.bo.UserInfo;
33. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
34. 
35. import org.assertj.core.util.Lists;
36. import org.junit.Before;
37. import org.junit.Test;
38. import org.mockito.InjectMocks;
39. import org.mockito.Mock;
40. 
41. import java.util.Arrays;
42. import java.util.Collections;
43. import java.util.List;
44. 
45. import static org.assertj.core.api.AssertionsForClassTypes.assertThat;
46. import static org.assertj.core.api.AssertionsForClassTypes.assertThatExceptionOfType;
47. import static org.junit.Assert.assertEquals;
48. import static org.mockito.Mockito.mock;
49. import static org.mockito.Mockito.times;
50. import static org.mockito.Mockito.verify;
51. import static org.mockito.Mockito.when;
52. 
53. public class NamespaceServiceTest extends AbstractUnitTest {
54. 
55.   @Mock
56.   private AdminServiceAPI.NamespaceAPI namespaceAPI;
57.   @Mock
58.   private ReleaseService releaseService;
59.   @Mock
60.   private ItemService itemService;
61.   @Mock
62.   private PropertyResolver resolver;
63.   @Mock
64.   private AppNamespaceService appNamespaceService;
65.   @Mock
66.   private InstanceService instanceService;
67.   @Mock
68.   private NamespaceBranchService branchService;
69.   @Mock
70.   private UserInfoHolder userInfoHolder;
71.   @Mock
72.   private AdditionalUserInfoEnrichService additionalUserInfoEnrichService;
73.   @Mock
74.   private PortalSettings portalSettings;
75.   @Mock
76.   private ClusterService clusterService;
77. 
78.   @InjectMocks
79.   private NamespaceService namespaceService;
80. 
81.   private String testAppId = "6666";
82.   private String testClusterName = "default";
83.   private String testNamespaceName = "application";
84.   private Env testEnv = Env.DEV;
85. 
86.   @Before
87.   public void setup() {
88.   }
89. 
90.   @Test
91.   public void testFindNamespace() {
92. 
93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);
94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);
95. 
96.     NamespaceDTO application = new NamespaceDTO();
97.     application.setId(1);
98.     application.setClusterName(testClusterName);
99.     application.setAppId(testAppId);
100.     application.setNamespaceName(testNamespaceName);
101. 
102.     NamespaceDTO hermes = new NamespaceDTO();
103.     hermes.setId(2);
104.     hermes.setClusterName("default");
105.     hermes.setAppId(testAppId);
106.     hermes.setNamespaceName("hermes");
107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);
108. 
109.     ReleaseDTO someRelease = new ReleaseDTO();
110.     someRelease.setConfigurations("{\"a\":\"123\",\"b\":\"123\"}");
111. 
112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);
113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);
114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);
115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);
116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);
117. 
118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());
119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());
120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))
121.         .thenReturn(applicationAppNamespace);
122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);
123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);
124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,
125.                                           testNamespaceName)).thenReturn(someRelease);
126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);
127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);
128. 
129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
130.     assertEquals(2, namespaceVOs.size());
131. 
132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));
133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
134.     assertEquals(1, namespaceVOs.size());
135.     NamespaceBO namespaceVO = namespaceVOs.get(0);
136.     assertEquals(4, namespaceVO.getItems().size());
137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());
138.     assertEquals(2, namespaceVO.getItemModifiedCnt());
139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());
140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());
141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());
142. 
143.     ReleaseDTO errorRelease = new ReleaseDTO();
144.     errorRelease.setConfigurations("\"a\":\"123\",\"b\":\"123\"");
145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);
146.     assertThatExceptionOfType(RuntimeException.class)
147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))
148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");
149. 
150.   }
151. 
152.   @Test
153.   public void testDeletePrivateNamespace() {
154.     String operator = "user";
155.     AppNamespace privateNamespace = createAppNamespace(testAppId, testNamespaceName, false);
156. 
157.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(privateNamespace);
158. 
159.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));
160. 
161.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);
162. 
163.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);
164.   }
165. 
166.   @Test
167.   public void testGetNamespaceUsage() {
168.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);
169.     String branchName = "branch";
170. 
171.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);
172. 
173.     when(portalSettings.getActiveEnvs()).thenReturn(Lists.newArrayList(testEnv));
174.     ClusterDTO cluster = new ClusterDTO();
175.     cluster.setName(testClusterName);
176.     cluster.setAppId(testAppId);
177.     when(clusterService.findClusters(testEnv, testAppId)).thenReturn(Lists.newArrayList(cluster));
178.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);
179.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))
180.         .thenReturn(8);
181.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);
182.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(9);
183.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);
184. 
185.     when(namespaceAPI.countPublicAppNamespaceAssociatedNamespaces(testEnv, testNamespaceName)).thenReturn(10);
186. 
187.     List<NamespaceUsage> usages = namespaceService.getNamespaceUsageByAppId(testAppId, testNamespaceName);
188.     assertThat(usages).asList().hasSize(1);
189.     assertThat(usages.get(0).getInstanceCount()).isEqualTo(8);
190.     assertThat(usages.get(0).getBranchInstanceCount()).isEqualTo(9);
191.     assertThat(usages.get(0).getLinkedNamespaceCount()).isEqualTo(10);
192. 
193.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(testAppId, testNamespaceName, testEnv, testClusterName);
194.     assertThat(usage).isNotNull();
195.     assertThat(usage.getInstanceCount()).isEqualTo(8);
196.     assertThat(usage.getBranchInstanceCount()).isEqualTo(9);
197.     assertThat(usage.getLinkedNamespaceCount()).isEqualTo(0);
198.   }
199. 
200.   @Test
201.   public void testDeleteEmptyNamespace() {
202.     String branchName = "branch";
203.     String operator = "user";
204. 
205.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);
206.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);
207. 
208.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);
209.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))
210.         .thenReturn(0);
211.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);
212.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(0);
213.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);
214. 
215.     NamespaceDTO namespace = createNamespace(testAppId, testClusterName, testNamespaceName);
216.     when(namespaceAPI.getPublicAppNamespaceAllNamespaces(testEnv, testNamespaceName, 0, 10)).thenReturn(
217.         Collections.singletonList(namespace));
218.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));
219. 
220.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);
221. 
222.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);
223. 
224.   }
225. 
226. 
227.   private AppNamespace createAppNamespace(String appId, String name, boolean isPublic) {
228.     AppNamespace instance = new AppNamespace();
229. 
230.     instance.setAppId(appId);
231.     instance.setName(name);
232.     instance.setPublic(isPublic);
233. 
234.     return instance;
235.   }
236. 
237.   private NamespaceDTO createNamespace(String appId, String clusterName, String namespaceName) {
238.     NamespaceDTO instance = new NamespaceDTO();
239. 
240.     instance.setAppId(appId);
241.     instance.setClusterName(clusterName);
242.     instance.setNamespaceName(namespaceName);
243. 
244.     return instance;
245.   }
246. 
247.   private UserInfo createUser(String userId) {
248.     UserInfo instance = new UserInfo();
249. 
250.     instance.setUserId(userId);
251. 
252.     return instance;
253.   }
254. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 11:26:31,403 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="Query Match: This import block shows AppNamespace-related classes used in a test under apollo-adminservice, directly referencing 'AppNamespace' (namespace). Extended relevance: Includes the DTO and repository types needed to understand namespace creation in the test.", relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java', start_line=19, end_line=27), ContextOutput(reasoning="Query Match: Test class and method body creating an AppNamespace via controller, with assertions and repository checks referencing 'namespace'. Extended relevance: Contains setup, API path, assertions, and repository usage needed to understand Namespace test behavior.", relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java', start_line=30, end_line=57), ContextOutput(reasoning='Query Match: Import block includes NamespaceDTO used in NamespaceController tests under apollo-adminservice. Extended relevance: Provides necessary types and validation utilities referenced by the test.', relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', start_line=19, end_line=25), ContextOutput(reasoning="Query Match: Test method for NamespaceController create() validating invalid namespace name, directly references 'NamespaceDTO' and validator messages. Extended relevance: Contains test setup, API call, and assertion for namespace validation.", relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', start_line=31, end_line=46), ContextOutput(reasoning="Query Match: Import block includes biz 'Namespace' entity and constants used in NamespaceBranchService tests. Extended relevance: These types are essential to understand the service behavior tested.", relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', start_line=19, end_line=26), ContextOutput(reasoning="Query Match: Class fields include NamespaceBranchService and variables with 'testNamespace', indicating namespace-related tests. Extended relevance: Provides setup context for subsequent namespace branch tests.", relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', start_line=34, end_line=47), ContextOutput(reasoning="Query Match: Test method 'testFindBranch' asserts Namespace branch retrieval, directly references 'Namespace'. Extended relevance: Shows service call and assertions relevant to namespace branch.", relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', start_line=49, end_line=57), ContextOutput(reasoning="Query Match: Test method 'testDeleteBranch' includes namespace branch deletion and subsequent null check, directly referencing 'Namespace'. Extended relevance: Demonstrates delete behavior and related assertions.", relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', start_line=167, end_line=176), ContextOutput(reasoning='Query Match: Import block includes Namespace repository/service and AppNamespace used in NamespaceService tests. Extended relevance: Essential types for public namespace lookup and validation.', relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java', start_line=19, end_line=33), ContextOutput(reasoning="Query Match: Test method 'testFindPublicAppNamespaceWithWrongNamespace' calls findPublicAppNamespaceAllNamespaces and expects BadRequestException. Extended relevance: Shows validation behavior and pageable setup.", relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java', start_line=55, end_line=63), ContextOutput(reasoning="Query Match: Test method 'testFindPublicAppNamespace' constructs Namespace instances and asserts results, directly involving NamespaceService. Extended relevance: Provides setup, mocks, and assertions for namespace enumeration.", relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java', start_line=65, end_line=87), ContextOutput(reasoning='Query Match: Import block includes AppNamespace and NamespaceUtil used by ConfigController tests; relevant to namespace handling. Extended relevance: Shows the utilities and DTOs involved in namespace logic.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=19, end_line=25), ContextOutput(reasoning='Query Match: Mock declaration for NamespaceUtil used in controller setup. Extended relevance: Essential for understanding how namespace normalization/filtering is tested.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=73, end_line=76), ContextOutput(reasoning="Query Match: Test 'testQueryConfig' verifies namespace-related parameters and audit, referencing defaultNamespaceName. Extended relevance: Includes service call, asserts, and audit verification.", relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=110, end_line=133), ContextOutput(reasoning="Query Match: Test 'testQueryConfigWithAppOwnNamespace' uses public AppNamespace and normalizes/filters namespace names. Extended relevance: Shows interaction with AppNamespaceService and asserts on namespace name.", relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=221, end_line=248), ContextOutput(reasoning="Query Match: Test 'testQueryConfigWithPubicNamespaceAndNoAppOverride' references findPublicNamespaceByName and namespace audit. Extended relevance: Demonstrates handling of public namespace without app override.", relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=250, end_line=282), ContextOutput(reasoning="Query Match: Test 'testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace' references findPublicNamespaceByName and normalizes namespace for NO_APPID placeholder. Extended relevance: Shows namespace behavior for special app id.", relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=416, end_line=444), ContextOutput(reasoning='Query Match: Import block includes AppNamespace and NamespaceUtilTest dependencies. Extended relevance: Provides types for namespace normalization and filtering tests.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', start_line=19, end_line=29), ContextOutput(reasoning="Query Match: Test 'testNormalizeNamespaceWithPrivateNamespace' directly references normalizeNamespace and private AppNamespace. Extended relevance: Shows mock setup and verification calls.", relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', start_line=80, end_line=95), ContextOutput(reasoning="Query Match: Test 'testNormalizeNamespaceWithPublicNamespace' directly references normalizeNamespace and public AppNamespace. Extended relevance: Shows mock setup and verification calls.", relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', start_line=97, end_line=112), ContextOutput(reasoning='Query Match: Import block includes OpenAppNamespaceDTO and validator used by portal NamespaceController tests. Extended relevance: Provides types for namespace validation.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', start_line=19, end_line=28), ContextOutput(reasoning='Query Match: Test method asserts invalid app namespace name, references InputValidator messages. Extended relevance: Includes setup, API call, and assertions.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', start_line=41, end_line=61), ContextOutput(reasoning='Query Match: Import block includes AppNamespace and Config classes used in AppNamespaceService tests. Extended relevance: Provides types used when creating and finding namespaces.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java', start_line=19, end_line=29), ContextOutput(reasoning="Query Match: Test 'testCreateDefaultAppNamespace' creates and verifies default application namespace. Extended relevance: Shows service call, retrieval, and assertions.", relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java', start_line=71, end_line=82), ContextOutput(reasoning='Query Match: Import block includes NamespaceDTO and AppNamespace used in NamespaceService tests. Extended relevance: Provides types for finding/deleting namespaces and computing usage.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', start_line=19, end_line=52), ContextOutput(reasoning="Query Match: Test 'testFindNamespace' builds NamespaceDTOs and asserts BO results; includes namespace name and app namespace formats. Extended relevance: Shows setup, service interactions, and detailed assertions.", relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', start_line=90, end_line=150), ContextOutput(reasoning="Query Match: Test 'testDeleteEmptyNamespace' exercises deletion path for an empty namespace, with assertions via verify. Extended relevance: Includes setup for public namespace and linked namespaces.", relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', start_line=200, end_line=224)]
2025-11-12 11:26:31,413 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 27 contexts to memory for query: Please provide the full content (with line numbers) of all test files under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-biz/src/test/java, and apollo-configservice/src/test/java that reference “Namespace” or “namespace” (e.g., NamespaceController, NamespaceService).
2025-11-12 11:26:32,625 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 11:26:32,626 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 27 new contexts to 0 existing contexts
2025-11-12 11:26:32,627 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 27 total contexts (removed 0 duplicates)
2025-11-12 11:26:32,628 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content (with line numbers) of all test files under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-biz/src/test/java, and apollo-configservice/src/test/java that reference “Namespace” or “namespace” (e.g., NamespaceController, NamespaceService).
Extra Requirements: If sending full files is too large, please share a grep/result listing of all occurrences of “namespace” within those src/test/java directories, including file paths, line numbers, and the surrounding import blocks and test method bodies.
Purpose: I need these test contents to identify 8 relevant existing test cases and include their exact imports, setup, assertions, file paths, and line numbers.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java
Line number range: 19 - 27
Content:
19. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;
20. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
21. import com.ctrip.framework.apollo.common.entity.AppNamespace;
22. 
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.jdbc.Sql;
27. 


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java
Line number range: 30 - 57
Content:
30.   @Autowired
31.   private AppNamespaceRepository namespaceRepository;
32. 
33.   @Test
34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
35.   public void testCreate(){
36.     String appId = "6666";
37.     String name = "testnamespace";
38.     String comment = "comment";
39.     AppNamespaceDTO dto = new AppNamespaceDTO();
40.     dto.setAppId(appId);
41.     dto.setName(name);
42.     dto.setComment(comment);
43.     dto.setDataChangeCreatedBy("apollo");
44. 
45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(
46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();
47. 
48.     Assert.assertEquals(appId, resultDto.getAppId());
49.     Assert.assertTrue(resultDto.getId() > 0);
50. 
51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);
52.     Assert.assertNotNull(savedAppNs);
53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());
54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());
55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());
56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());
57. 


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java
Line number range: 19 - 25
Content:
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import org.junit.Assert;
22. import org.junit.Test;
23. import org.springframework.web.client.HttpClientErrorException;
24. import static org.hamcrest.Matchers.containsString;
25. 


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java
Line number range: 31 - 46
Content:
31. public class NamespaceControllerTest extends AbstractControllerTest {
32.   @Test
33.   public void create() {
34.     try {
35.       NamespaceDTO namespaceDTO = new NamespaceDTO();
36.       namespaceDTO.setClusterName("cluster");
37.       namespaceDTO.setNamespaceName("invalid name");
38.       namespaceDTO.setAppId("whatever");
39.       restTemplate.postForEntity(
40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),
41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());
42.       Assert.fail("Should throw");
43.     } catch (HttpClientErrorException e) {
44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
45.     }
46.   }


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java
Line number range: 19 - 26
Content:
19. import com.ctrip.framework.apollo.biz.AbstractIntegrationTest;
20. import com.ctrip.framework.apollo.biz.entity.GrayReleaseRule;
21. import com.ctrip.framework.apollo.biz.entity.Namespace;
22. import com.ctrip.framework.apollo.biz.entity.ReleaseHistory;
23. import com.ctrip.framework.apollo.common.constants.NamespaceBranchStatus;
24. import com.ctrip.framework.apollo.common.constants.ReleaseOperation;
25. 
26. import org.junit.Assert;


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java
Line number range: 34 - 47
Content:
34. public class NamespaceBranchServiceTest extends AbstractIntegrationTest {
35. 
36.   @Autowired
37.   private NamespaceBranchService namespaceBranchService;
38. 
39.   @Autowired
40.   private ReleaseHistoryService releaseHistoryService;
41. 
42.   private String testApp = "test";
43.   private String testCluster = "default";
44.   private String testNamespace = "application";
45.   private String testBranchName = "child-cluster";
46.   private String operator = "apollo";
47.   private Pageable pageable = PageRequest.of(0, 10);


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java
Line number range: 49 - 57
Content:
49.   @Test
50.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
51.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
52.   public void testFindBranch() {
53.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);
54. 
55.     Assert.assertNotNull(branch);
56.     Assert.assertEquals(testBranchName, branch.getClusterName());
57.   }


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java
Line number range: 167 - 176
Content:
167.   public void testDeleteBranch() {
168. 
169.     GrayReleaseRule rule = instanceGrayReleaseRule();
170.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, rule);
171. 
172.     namespaceBranchService.deleteBranch(testApp, testCluster, testNamespace, testBranchName, NamespaceBranchStatus.DELETED, operator);
173. 
174.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);
175.     Assert.assertNull(branch);
176. 


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java
Line number range: 19 - 33
Content:
19. import com.ctrip.framework.apollo.biz.AbstractUnitTest;
20. import com.ctrip.framework.apollo.biz.MockBeanFactory;
21. import com.ctrip.framework.apollo.biz.entity.Namespace;
22. import com.ctrip.framework.apollo.biz.repository.NamespaceRepository;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.common.exception.BadRequestException;
25. import com.ctrip.framework.apollo.core.ConfigConsts;
26. 
27. import org.junit.Test;
28. import org.mockito.InjectMocks;
29. import org.mockito.Mock;
30. import org.mockito.Spy;
31. import org.springframework.data.domain.PageRequest;
32. import org.springframework.data.domain.Pageable;
33. 


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java
Line number range: 55 - 63
Content:
55.   @Test(expected = BadRequestException.class)
56.   public void testFindPublicAppNamespaceWithWrongNamespace() {
57.     Pageable page = PageRequest.of(0, 10);
58. 
59.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(null);
60. 
61.     namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);
62.   }
63. 


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java
Line number range: 65 - 87
Content:
65.   public void testFindPublicAppNamespace() {
66. 
67.     AppNamespace publicAppNamespace = MockBeanFactory.mockAppNamespace(null, testPublicAppNamespace, true);
68.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(publicAppNamespace);
69. 
70.     Namespace firstParentNamespace =
71.         MockBeanFactory.mockNamespace("app", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);
72.     Namespace secondParentNamespace =
73.         MockBeanFactory.mockNamespace("app1", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);
74. 
75.     Pageable page = PageRequest.of(0, 10);
76. 
77.     when(namespaceRepository.findByNamespaceName(testPublicAppNamespace, page))
78.         .thenReturn(Arrays.asList(firstParentNamespace, secondParentNamespace));
79. 
80.     doReturn(false).when(namespaceService).isChildNamespace(firstParentNamespace);
81.     doReturn(false).when(namespaceService).isChildNamespace(secondParentNamespace);
82. 
83.     List<Namespace> namespaces = namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);
84. 
85.     assertEquals(2, namespaces.size());
86.   }
87. 


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 19 - 25
Content:
19. import com.ctrip.framework.apollo.biz.entity.Release;
20. import com.ctrip.framework.apollo.common.entity.AppNamespace;
21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;
23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;
24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;
25. import com.ctrip.framework.apollo.core.ConfigConsts;


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 73 - 76
Content:
73.   private NamespaceUtil namespaceUtil;
74.   @Mock
75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;
76.   @Mock


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 110 - 133
Content:
110.   @Test
111.   public void testQueryConfig() throws Exception {
112.     String someClientSideReleaseKey = "1";
113.     String someServerSideNewReleaseKey = "2";
114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
115. 
116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);
120. 
121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
124. 
125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
126.         defaultNamespaceName, someDataCenter, someNotificationMessages);
127.     assertEquals(someAppId, result.getAppId());
128.     assertEquals(someClusterName, result.getCluster());
129.     assertEquals(defaultNamespaceName, result.getNamespaceName());
130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);
133.   }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 221 - 248
Content:
221.   @Test
222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {
223.     String someClientSideReleaseKey = "1";
224.     String someServerSideReleaseKey = "2";
225.     String someAppOwnNamespaceName = "someAppOwn";
226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
227.     AppNamespace someAppOwnNamespace =
228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);
229. 
230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,
231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))
233.         .thenReturn(someAppOwnNamespace);
234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
237. 
238.     ApolloConfig result =
239.         configController
240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,
241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
242. 
243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
244.     assertEquals(someAppId, result.getAppId());
245.     assertEquals(someClusterName, result.getCluster());
246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());
247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));
248.   }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 250 - 282
Content:
250.   @Test
251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {
252.     String someClientSideReleaseKey = "1";
253.     String someServerSideReleaseKey = "2";
254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
255.     String somePublicAppId = "somePublicAppId";
256.     String somePublicClusterName = "somePublicClusterName";
257.     AppNamespace somePublicAppNamespace =
258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
259. 
260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
261.         someDataCenter, someNotificationMessages)).thenReturn(null);
262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
263.         .thenReturn(somePublicAppNamespace);
264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);
269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
270. 
271.     ApolloConfig result = configController
272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
274. 
275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
276.     assertEquals(someAppId, result.getAppId());
277.     assertEquals(someClusterName, result.getCluster());
278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);
282.   }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 416 - 444
Content:
416.   @Test
417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {
418.     String someClientSideReleaseKey = "1";
419.     String someServerSideReleaseKey = "2";
420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
421.     String somePublicAppId = "somePublicAppId";
422.     AppNamespace somePublicAppNamespace =
423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
425. 
426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
427.         .thenReturn(somePublicAppNamespace);
428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
432. 
433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,
435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
436. 
437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,
438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);
439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
440.     assertEquals(appId, result.getAppId());
441.     assertEquals(someClusterName, result.getCluster());
442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
444.   }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 19 - 29
Content:
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
21. import org.junit.Before;
22. import org.junit.Test;
23. import org.junit.runner.RunWith;
24. import org.mockito.Mock;
25. import org.mockito.junit.MockitoJUnitRunner;
26. 
27. import static org.junit.Assert.assertEquals;
28. import static org.mockito.Mockito.*;
29. 


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 80 - 95
Content:
80.   @Test
81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {
82.     String someAppId = "someAppId";
83.     String someNamespaceName = "someNamespaceName";
84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
85.     AppNamespace someAppNamespace = mock(AppNamespace.class);
86. 
87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn
89.         (someAppNamespace);
90. 
91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
92. 
93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);
95.   }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 97 - 112
Content:
97.   @Test
98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {
99.     String someAppId = "someAppId";
100.     String someNamespaceName = "someNamespaceName";
101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
102.     AppNamespace someAppNamespace = mock(AppNamespace.class);
103. 
104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);
107. 
108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
109. 
110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
112.   }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 19 - 28
Content:
19. import com.ctrip.framework.apollo.common.utils.InputValidator;
20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;
22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.ActiveProfiles;
27. import org.springframework.web.client.HttpClientErrorException;
28. import static org.hamcrest.Matchers.containsString;


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 41 - 61
Content:
41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {
42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));
43. 
44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();
45.     dto.setAppId("appId");
46.     dto.setName("invalid name");
47.     dto.setFormat(ConfigFileFormat.Properties.getValue());
48.     dto.setDataChangeCreatedBy("apollo");
49.     try {
50.       restTemplate.postForEntity(
51.           url("/openapi/v1/apps/{appId}/appnamespaces"),
52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()
53.       );
54.       Assert.fail("should throw");
55.     } catch (HttpClientErrorException e) {
56.       String result = e.getResponseBodyAsString();
57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
59.     }
60.   }
61. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java
Line number range: 19 - 29
Content:
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.common.exception.BadRequestException;
21. import com.ctrip.framework.apollo.core.ConfigConsts;
22. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
23. import com.ctrip.framework.apollo.portal.AbstractIntegrationTest;
24. 
25. import org.junit.Assert;
26. import org.junit.Test;
27. import org.springframework.beans.factory.annotation.Autowired;
28. import org.springframework.test.context.jdbc.Sql;
29. 


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java
Line number range: 71 - 82
Content:
71. 
72.   @Test
73.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
74.   public void testCreateDefaultAppNamespace() {
75.     appNamespaceService.createDefaultAppNamespace(APP);
76. 
77.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(APP, ConfigConsts.NAMESPACE_APPLICATION);
78. 
79.     Assert.assertNotNull(appNamespace);
80.     Assert.assertEquals(ConfigFileFormat.Properties.getValue(), appNamespace.getFormat());
81. 
82.   }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 19 - 52
Content:
19. import com.ctrip.framework.apollo.common.dto.ClusterDTO;
20. import com.ctrip.framework.apollo.common.dto.ItemDTO;
21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
22. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
25. import com.ctrip.framework.apollo.portal.component.PortalSettings;
26. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
27. import com.ctrip.framework.apollo.portal.environment.Env;
28. import com.ctrip.framework.apollo.portal.AbstractUnitTest;
29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
30. import com.ctrip.framework.apollo.portal.component.txtresolver.PropertyResolver;
31. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
32. import com.ctrip.framework.apollo.portal.entity.bo.UserInfo;
33. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
34. 
35. import org.assertj.core.util.Lists;
36. import org.junit.Before;
37. import org.junit.Test;
38. import org.mockito.InjectMocks;
39. import org.mockito.Mock;
40. 
41. import java.util.Arrays;
42. import java.util.Collections;
43. import java.util.List;
44. 
45. import static org.assertj.core.api.AssertionsForClassTypes.assertThat;
46. import static org.assertj.core.api.AssertionsForClassTypes.assertThatExceptionOfType;
47. import static org.junit.Assert.assertEquals;
48. import static org.mockito.Mockito.mock;
49. import static org.mockito.Mockito.times;
50. import static org.mockito.Mockito.verify;
51. import static org.mockito.Mockito.when;
52. 


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 90 - 150
Content:
90.   @Test
91.   public void testFindNamespace() {
92. 
93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);
94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);
95. 
96.     NamespaceDTO application = new NamespaceDTO();
97.     application.setId(1);
98.     application.setClusterName(testClusterName);
99.     application.setAppId(testAppId);
100.     application.setNamespaceName(testNamespaceName);
101. 
102.     NamespaceDTO hermes = new NamespaceDTO();
103.     hermes.setId(2);
104.     hermes.setClusterName("default");
105.     hermes.setAppId(testAppId);
106.     hermes.setNamespaceName("hermes");
107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);
108. 
109.     ReleaseDTO someRelease = new ReleaseDTO();
110.     someRelease.setConfigurations("{\"a\":\"123\",\"b\":\"123\"}");
111. 
112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);
113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);
114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);
115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);
116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);
117. 
118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());
119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());
120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))
121.         .thenReturn(applicationAppNamespace);
122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);
123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);
124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,
125.                                           testNamespaceName)).thenReturn(someRelease);
126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);
127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);
128. 
129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
130.     assertEquals(2, namespaceVOs.size());
131. 
132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));
133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
134.     assertEquals(1, namespaceVOs.size());
135.     NamespaceBO namespaceVO = namespaceVOs.get(0);
136.     assertEquals(4, namespaceVO.getItems().size());
137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());
138.     assertEquals(2, namespaceVO.getItemModifiedCnt());
139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());
140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());
141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());
142. 
143.     ReleaseDTO errorRelease = new ReleaseDTO();
144.     errorRelease.setConfigurations("\"a\":\"123\",\"b\":\"123\"");
145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);
146.     assertThatExceptionOfType(RuntimeException.class)
147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))
148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");
149. 
150.   }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 200 - 224
Content:
200.   @Test
201.   public void testDeleteEmptyNamespace() {
202.     String branchName = "branch";
203.     String operator = "user";
204. 
205.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);
206.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);
207. 
208.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);
209.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))
210.         .thenReturn(0);
211.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);
212.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(0);
213.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);
214. 
215.     NamespaceDTO namespace = createNamespace(testAppId, testClusterName, testNamespaceName);
216.     when(namespaceAPI.getPublicAppNamespaceAllNamespaces(testEnv, testNamespaceName, 0, 10)).thenReturn(
217.         Collections.singletonList(namespace));
218.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));
219. 
220.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);
221. 
222.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);
223. 
224.   }

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:26:56,890 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The objective requires 8 complete, self-contained test cases with exact imports and line numbers. The aggregated context only provides partial snippets of several relevant tests (missing full import sections, class definitions, setup methods, and sometimes incomplete test bodies). To accurately extract 8 complete tests and preserve exact line numbering, I need the full contents of the most relevant test files around namespace creation/validation and querying, which are partially shown but not complete in the current context.' query='Please provide the full content with line numbers of the following test files: 1) apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, 2) apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java, 3) apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, 4) apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, 5) apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java, 6) apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java, 7) apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java, 8) apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java.' extra_requirements='If sending full files is too large, include at minimum each file’s import block, class header, @Before setup (if any), and the complete bodies of test methods named in snippets (e.g., create, shouldFailWhenAppNamespaceNameIsInvalid, testNormalizeNamespace*, testQueryConfig*, testFindNamespace, testDeleteEmptyNamespace, testFindPublicAppNamespace*, testFindBranch, testDeleteBranch), with exact line numbers.' purpose='I will extract 8 relevant regression tests with exact file paths, imports, setup, assertions, and line numbers to address the namespace-with-single-dot issue.'
2025-11-12 11:26:56,891 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content with line numbers of the following test files: 1) apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, 2) apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java, 3) apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, 4) apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, 5) apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java, 6) apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java, 7) apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java, 8) apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java.
2025-11-12 11:27:00,873 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: [{'query_essential_query': 'Please provide the full content (with line numbers) of all test files under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-biz/src/test/java, and apollo-configservice/src/test/java that reference “Namespace” or “namespace” (e.g., NamespaceController, NamespaceService).', 'query_extra_requirements': 'If sending full files is too large, please share a grep/result listing of all occurrences of “namespace” within those src/test/java directories, including file paths, line numbers, and the surrounding import blocks and test method bodies.', 'query_purpose': 'I need these test contents to identify 8 relevant existing test cases and include their exact imports, setup, assertions, file paths, and line numbers.', 'memory_context_contexts': [{'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java', 'content': '19. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;\n20. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;\n21. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n22. \n23. import org.junit.Assert;\n24. import org.junit.Test;\n25. import org.springframework.beans.factory.annotation.Autowired;\n26. import org.springframework.test.context.jdbc.Sql;\n27. ', 'start_line_number': 19, 'end_line_number': 27}, {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java', 'content': '30.   @Autowired\n31.   private AppNamespaceRepository namespaceRepository;\n32. \n33.   @Test\n34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)\n35.   public void testCreate(){\n36.     String appId = "6666";\n37.     String name = "testnamespace";\n38.     String comment = "comment";\n39.     AppNamespaceDTO dto = new AppNamespaceDTO();\n40.     dto.setAppId(appId);\n41.     dto.setName(name);\n42.     dto.setComment(comment);\n43.     dto.setDataChangeCreatedBy("apollo");\n44. \n45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(\n46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();\n47. \n48.     Assert.assertEquals(appId, resultDto.getAppId());\n49.     Assert.assertTrue(resultDto.getId() > 0);\n50. \n51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);\n52.     Assert.assertNotNull(savedAppNs);\n53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());\n54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());\n55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());\n56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());\n57. ', 'start_line_number': 30, 'end_line_number': 57}, {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', 'content': '19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;\n20. import com.ctrip.framework.apollo.common.utils.InputValidator;\n21. import org.junit.Assert;\n22. import org.junit.Test;\n23. import org.springframework.web.client.HttpClientErrorException;\n24. import static org.hamcrest.Matchers.containsString;\n25. ', 'start_line_number': 19, 'end_line_number': 25}, {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', 'content': '31. public class NamespaceControllerTest extends AbstractControllerTest {\n32.   @Test\n33.   public void create() {\n34.     try {\n35.       NamespaceDTO namespaceDTO = new NamespaceDTO();\n36.       namespaceDTO.setClusterName("cluster");\n37.       namespaceDTO.setNamespaceName("invalid name");\n38.       namespaceDTO.setAppId("whatever");\n39.       restTemplate.postForEntity(\n40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),\n41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());\n42.       Assert.fail("Should throw");\n43.     } catch (HttpClientErrorException e) {\n44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));\n45.     }\n46.   }', 'start_line_number': 31, 'end_line_number': 46}, {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', 'content': '19. import com.ctrip.framework.apollo.biz.AbstractIntegrationTest;\n20. import com.ctrip.framework.apollo.biz.entity.GrayReleaseRule;\n21. import com.ctrip.framework.apollo.biz.entity.Namespace;\n22. import com.ctrip.framework.apollo.biz.entity.ReleaseHistory;\n23. import com.ctrip.framework.apollo.common.constants.NamespaceBranchStatus;\n24. import com.ctrip.framework.apollo.common.constants.ReleaseOperation;\n25. \n26. import org.junit.Assert;', 'start_line_number': 19, 'end_line_number': 26}, {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', 'content': '34. public class NamespaceBranchServiceTest extends AbstractIntegrationTest {\n35. \n36.   @Autowired\n37.   private NamespaceBranchService namespaceBranchService;\n38. \n39.   @Autowired\n40.   private ReleaseHistoryService releaseHistoryService;\n41. \n42.   private String testApp = "test";\n43.   private String testCluster = "default";\n44.   private String testNamespace = "application";\n45.   private String testBranchName = "child-cluster";\n46.   private String operator = "apollo";\n47.   private Pageable pageable = PageRequest.of(0, 10);', 'start_line_number': 34, 'end_line_number': 47}, {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', 'content': '49.   @Test\n50.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)\n51.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)\n52.   public void testFindBranch() {\n53.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);\n54. \n55.     Assert.assertNotNull(branch);\n56.     Assert.assertEquals(testBranchName, branch.getClusterName());\n57.   }', 'start_line_number': 49, 'end_line_number': 57}, {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', 'content': '167.   public void testDeleteBranch() {\n168. \n169.     GrayReleaseRule rule = instanceGrayReleaseRule();\n170.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, rule);\n171. \n172.     namespaceBranchService.deleteBranch(testApp, testCluster, testNamespace, testBranchName, NamespaceBranchStatus.DELETED, operator);\n173. \n174.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);\n175.     Assert.assertNull(branch);\n176. ', 'start_line_number': 167, 'end_line_number': 176}, {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java', 'content': '19. import com.ctrip.framework.apollo.biz.AbstractUnitTest;\n20. import com.ctrip.framework.apollo.biz.MockBeanFactory;\n21. import com.ctrip.framework.apollo.biz.entity.Namespace;\n22. import com.ctrip.framework.apollo.biz.repository.NamespaceRepository;\n23. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n24. import com.ctrip.framework.apollo.common.exception.BadRequestException;\n25. import com.ctrip.framework.apollo.core.ConfigConsts;\n26. \n27. import org.junit.Test;\n28. import org.mockito.InjectMocks;\n29. import org.mockito.Mock;\n30. import org.mockito.Spy;\n31. import org.springframework.data.domain.PageRequest;\n32. import org.springframework.data.domain.Pageable;\n33. ', 'start_line_number': 19, 'end_line_number': 33}, {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java', 'content': '55.   @Test(expected = BadRequestException.class)\n56.   public void testFindPublicAppNamespaceWithWrongNamespace() {\n57.     Pageable page = PageRequest.of(0, 10);\n58. \n59.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(null);\n60. \n61.     namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);\n62.   }\n63. ', 'start_line_number': 55, 'end_line_number': 63}, {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java', 'content': '65.   public void testFindPublicAppNamespace() {\n66. \n67.     AppNamespace publicAppNamespace = MockBeanFactory.mockAppNamespace(null, testPublicAppNamespace, true);\n68.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(publicAppNamespace);\n69. \n70.     Namespace firstParentNamespace =\n71.         MockBeanFactory.mockNamespace("app", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);\n72.     Namespace secondParentNamespace =\n73.         MockBeanFactory.mockNamespace("app1", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);\n74. \n75.     Pageable page = PageRequest.of(0, 10);\n76. \n77.     when(namespaceRepository.findByNamespaceName(testPublicAppNamespace, page))\n78.         .thenReturn(Arrays.asList(firstParentNamespace, secondParentNamespace));\n79. \n80.     doReturn(false).when(namespaceService).isChildNamespace(firstParentNamespace);\n81.     doReturn(false).when(namespaceService).isChildNamespace(secondParentNamespace);\n82. \n83.     List<Namespace> namespaces = namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);\n84. \n85.     assertEquals(2, namespaces.size());\n86.   }\n87. ', 'start_line_number': 65, 'end_line_number': 87}, {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', 'content': '19. import com.ctrip.framework.apollo.biz.entity.Release;\n20. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\n22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;\n23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;\n24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;\n25. import com.ctrip.framework.apollo.core.ConfigConsts;', 'start_line_number': 19, 'end_line_number': 25}, {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', 'content': '73.   private NamespaceUtil namespaceUtil;\n74.   @Mock\n75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;\n76.   @Mock', 'start_line_number': 73, 'end_line_number': 76}, {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', 'content': '110.   @Test\n111.   public void testQueryConfig() throws Exception {\n112.     String someClientSideReleaseKey = "1";\n113.     String someServerSideNewReleaseKey = "2";\n114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n115. \n116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,\n117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);\n119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);\n120. \n121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,\n122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,\n123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n124. \n125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,\n126.         defaultNamespaceName, someDataCenter, someNotificationMessages);\n127.     assertEquals(someAppId, result.getAppId());\n128.     assertEquals(someClusterName, result.getCluster());\n129.     assertEquals(defaultNamespaceName, result.getNamespaceName());\n130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());\n131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);\n133.   }', 'start_line_number': 110, 'end_line_number': 133}, {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', 'content': '221.   @Test\n222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {\n223.     String someClientSideReleaseKey = "1";\n224.     String someServerSideReleaseKey = "2";\n225.     String someAppOwnNamespaceName = "someAppOwn";\n226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n227.     AppNamespace someAppOwnNamespace =\n228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);\n229. \n230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,\n231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))\n233.         .thenReturn(someAppOwnNamespace);\n234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);\n236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);\n237. \n238.     ApolloConfig result =\n239.         configController\n240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,\n241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n242. \n243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n244.     assertEquals(someAppId, result.getAppId());\n245.     assertEquals(someClusterName, result.getCluster());\n246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());\n247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));\n248.   }', 'start_line_number': 221, 'end_line_number': 248}, {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', 'content': '250.   @Test\n251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {\n252.     String someClientSideReleaseKey = "1";\n253.     String someServerSideReleaseKey = "2";\n254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n255.     String somePublicAppId = "somePublicAppId";\n256.     String somePublicClusterName = "somePublicClusterName";\n257.     AppNamespace somePublicAppNamespace =\n258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n259. \n260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,\n261.         someDataCenter, someNotificationMessages)).thenReturn(null);\n262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n263.         .thenReturn(somePublicAppNamespace);\n264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);\n268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);\n269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);\n270. \n271.     ApolloConfig result = configController\n272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,\n273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n274. \n275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n276.     assertEquals(someAppId, result.getAppId());\n277.     assertEquals(someClusterName, result.getCluster());\n278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());\n279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));\n280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);\n282.   }', 'start_line_number': 250, 'end_line_number': 282}, {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', 'content': '416.   @Test\n417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {\n418.     String someClientSideReleaseKey = "1";\n419.     String someServerSideReleaseKey = "2";\n420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n421.     String somePublicAppId = "somePublicAppId";\n422.     AppNamespace somePublicAppNamespace =\n423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;\n425. \n426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n427.         .thenReturn(somePublicAppNamespace);\n428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n432. \n433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,\n434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,\n435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n436. \n437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,\n438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);\n439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n440.     assertEquals(appId, result.getAppId());\n441.     assertEquals(someClusterName, result.getCluster());\n442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());\n443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));\n444.   }', 'start_line_number': 416, 'end_line_number': 444}, {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', 'content': '19. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\n21. import org.junit.Before;\n22. import org.junit.Test;\n23. import org.junit.runner.RunWith;\n24. import org.mockito.Mock;\n25. import org.mockito.junit.MockitoJUnitRunner;\n26. \n27. import static org.junit.Assert.assertEquals;\n28. import static org.mockito.Mockito.*;\n29. ', 'start_line_number': 19, 'end_line_number': 29}, {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', 'content': '80.   @Test\n81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {\n82.     String someAppId = "someAppId";\n83.     String someNamespaceName = "someNamespaceName";\n84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";\n85.     AppNamespace someAppNamespace = mock(AppNamespace.class);\n86. \n87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);\n88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn\n89.         (someAppNamespace);\n90. \n91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));\n92. \n93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);\n94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);\n95.   }', 'start_line_number': 80, 'end_line_number': 95}, {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', 'content': '97.   @Test\n98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {\n99.     String someAppId = "someAppId";\n100.     String someNamespaceName = "someNamespaceName";\n101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";\n102.     AppNamespace someAppNamespace = mock(AppNamespace.class);\n103. \n104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);\n105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);\n106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);\n107. \n108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));\n109. \n110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);\n111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);\n112.   }', 'start_line_number': 97, 'end_line_number': 112}, {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', 'content': '19. import com.ctrip.framework.apollo.common.utils.InputValidator;\n20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;\n21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;\n22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;\n23. import org.junit.Assert;\n24. import org.junit.Test;\n25. import org.springframework.beans.factory.annotation.Autowired;\n26. import org.springframework.test.context.ActiveProfiles;\n27. import org.springframework.web.client.HttpClientErrorException;\n28. import static org.hamcrest.Matchers.containsString;', 'start_line_number': 19, 'end_line_number': 28}, {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', 'content': '41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {\n42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));\n43. \n44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();\n45.     dto.setAppId("appId");\n46.     dto.setName("invalid name");\n47.     dto.setFormat(ConfigFileFormat.Properties.getValue());\n48.     dto.setDataChangeCreatedBy("apollo");\n49.     try {\n50.       restTemplate.postForEntity(\n51.           url("/openapi/v1/apps/{appId}/appnamespaces"),\n52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()\n53.       );\n54.       Assert.fail("should throw");\n55.     } catch (HttpClientErrorException e) {\n56.       String result = e.getResponseBodyAsString();\n57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));\n58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));\n59.     }\n60.   }\n61. }', 'start_line_number': 41, 'end_line_number': 61}, {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java', 'content': '19. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n20. import com.ctrip.framework.apollo.common.exception.BadRequestException;\n21. import com.ctrip.framework.apollo.core.ConfigConsts;\n22. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;\n23. import com.ctrip.framework.apollo.portal.AbstractIntegrationTest;\n24. \n25. import org.junit.Assert;\n26. import org.junit.Test;\n27. import org.springframework.beans.factory.annotation.Autowired;\n28. import org.springframework.test.context.jdbc.Sql;\n29. ', 'start_line_number': 19, 'end_line_number': 29}, {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java', 'content': '71. \n72.   @Test\n73.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)\n74.   public void testCreateDefaultAppNamespace() {\n75.     appNamespaceService.createDefaultAppNamespace(APP);\n76. \n77.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(APP, ConfigConsts.NAMESPACE_APPLICATION);\n78. \n79.     Assert.assertNotNull(appNamespace);\n80.     Assert.assertEquals(ConfigFileFormat.Properties.getValue(), appNamespace.getFormat());\n81. \n82.   }', 'start_line_number': 71, 'end_line_number': 82}, {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', 'content': '19. import com.ctrip.framework.apollo.common.dto.ClusterDTO;\n20. import com.ctrip.framework.apollo.common.dto.ItemDTO;\n21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;\n22. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;\n23. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;\n25. import com.ctrip.framework.apollo.portal.component.PortalSettings;\n26. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;\n27. import com.ctrip.framework.apollo.portal.environment.Env;\n28. import com.ctrip.framework.apollo.portal.AbstractUnitTest;\n29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;\n30. import com.ctrip.framework.apollo.portal.component.txtresolver.PropertyResolver;\n31. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;\n32. import com.ctrip.framework.apollo.portal.entity.bo.UserInfo;\n33. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;\n34. \n35. import org.assertj.core.util.Lists;\n36. import org.junit.Before;\n37. import org.junit.Test;\n38. import org.mockito.InjectMocks;\n39. import org.mockito.Mock;\n40. \n41. import java.util.Arrays;\n42. import java.util.Collections;\n43. import java.util.List;\n44. \n45. import static org.assertj.core.api.AssertionsForClassTypes.assertThat;\n46. import static org.assertj.core.api.AssertionsForClassTypes.assertThatExceptionOfType;\n47. import static org.junit.Assert.assertEquals;\n48. import static org.mockito.Mockito.mock;\n49. import static org.mockito.Mockito.times;\n50. import static org.mockito.Mockito.verify;\n51. import static org.mockito.Mockito.when;\n52. ', 'start_line_number': 19, 'end_line_number': 52}, {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', 'content': '90.   @Test\n91.   public void testFindNamespace() {\n92. \n93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);\n94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);\n95. \n96.     NamespaceDTO application = new NamespaceDTO();\n97.     application.setId(1);\n98.     application.setClusterName(testClusterName);\n99.     application.setAppId(testAppId);\n100.     application.setNamespaceName(testNamespaceName);\n101. \n102.     NamespaceDTO hermes = new NamespaceDTO();\n103.     hermes.setId(2);\n104.     hermes.setClusterName("default");\n105.     hermes.setAppId(testAppId);\n106.     hermes.setNamespaceName("hermes");\n107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);\n108. \n109.     ReleaseDTO someRelease = new ReleaseDTO();\n110.     someRelease.setConfigurations("{\\"a\\":\\"123\\",\\"b\\":\\"123\\"}");\n111. \n112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);\n113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);\n114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);\n115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);\n116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);\n117. \n118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());\n119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());\n120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))\n121.         .thenReturn(applicationAppNamespace);\n122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);\n123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);\n124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,\n125.                                           testNamespaceName)).thenReturn(someRelease);\n126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);\n127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);\n128. \n129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);\n130.     assertEquals(2, namespaceVOs.size());\n131. \n132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));\n133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);\n134.     assertEquals(1, namespaceVOs.size());\n135.     NamespaceBO namespaceVO = namespaceVOs.get(0);\n136.     assertEquals(4, namespaceVO.getItems().size());\n137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());\n138.     assertEquals(2, namespaceVO.getItemModifiedCnt());\n139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());\n140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());\n141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());\n142. \n143.     ReleaseDTO errorRelease = new ReleaseDTO();\n144.     errorRelease.setConfigurations("\\"a\\":\\"123\\",\\"b\\":\\"123\\"");\n145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);\n146.     assertThatExceptionOfType(RuntimeException.class)\n147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))\n148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");\n149. \n150.   }', 'start_line_number': 90, 'end_line_number': 150}, {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', 'content': '200.   @Test\n201.   public void testDeleteEmptyNamespace() {\n202.     String branchName = "branch";\n203.     String operator = "user";\n204. \n205.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);\n206.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);\n207. \n208.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);\n209.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))\n210.         .thenReturn(0);\n211.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);\n212.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(0);\n213.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);\n214. \n215.     NamespaceDTO namespace = createNamespace(testAppId, testClusterName, testNamespaceName);\n216.     when(namespaceAPI.getPublicAppNamespaceAllNamespaces(testEnv, testNamespaceName, 0, 10)).thenReturn(\n217.         Collections.singletonList(namespace));\n218.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));\n219. \n220.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);\n221. \n222.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);\n223. \n224.   }', 'start_line_number': 200, 'end_line_number': 224}]}]
2025-11-12 11:27:00,874 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 1 memories from memory
2025-11-12 11:27:00,874 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 27 contexts from memory
2025-11-12 11:27:00,875 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 27 contexts from memory
2025-11-12 11:27:00,876 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 27 new contexts to 27 existing contexts
2025-11-12 11:27:00,878 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 27 total contexts (removed 27 duplicates)
2025-11-12 11:27:00,880 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
We are currently solving the following issue within our repository. Here is the issue text:

--- BEGIN ISSUE ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:

--- END ISSUE ---

And we need to find relevant existing tests that can be used as regression tests for this issue.

OBJECTIVE: Find 8 relevant existing test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 8 complete, self-contained test cases that most likely to break existing functionality if this issue is fixed or new changes apply.
- Must include the identification of the test case (e.g., class name and method name)
- Must preserve exact file paths and line numbers

<examples>
--- BEGIN ISSUE ---
Title: parse_iso8601 drops timezone information for 'Z' suffix
Body: The helper `parse_iso8601` in `utils/datetime.py` incorrectly returns a naive datetime when the input ends with 'Z' (UTC). For example, "2024-10-12T09:15:00Z" becomes a naive dt instead of timezone-aware UTC. This breaks downstream scheduling.
Expected: Return timezone-aware datetime in UTC for 'Z' inputs and preserve offsets like "+09:00".
--- END ISSUE ---
--- BEGIN TEST CASES ---
File: tests/test_datetime.py
Line Number: 118-156
Content:
import datetime
import pytest

from utils.datetime import parse_iso8601  # target under test

def test_z_suffix_returns_utc_aware(self):
    # Input ending with 'Z' should be interpreted as UTC and be timezone-aware
    s = "2024-10-12T09:15:00Z"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    # Use UTC comparison that works across pytz/zoneinfo
    assert dt.utcoffset() == datetime.timedelta(0)

def test_offset_preserved(self):
    # Offset like +09:00 should be preserved (e.g., Asia/Tokyo offset)
    s = "2024-10-12T18:00:00+09:00"
    dt = parse_iso8601(s)

    assert isinstance(dt, datetime.datetime)
    assert dt.tzinfo is not None
    assert dt.utcoffset() == datetime.timedelta(hours=9)
--- END TEST CASES ---
</example>

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content (with line numbers) of all test files under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-biz/src/test/java, and apollo-configservice/src/test/java that reference “Namespace” or “namespace” (e.g., NamespaceController, NamespaceService).
Extra Requirements: If sending full files is too large, please share a grep/result listing of all occurrences of “namespace” within those src/test/java directories, including file paths, line numbers, and the surrounding import blocks and test method bodies.
Purpose: I need these test contents to identify 8 relevant existing test cases and include their exact imports, setup, assertions, file paths, and line numbers.

Previous refined query 2:
Essential Query: Please provide the full content with line numbers of the following test files: 1) apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, 2) apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java, 3) apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, 4) apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, 5) apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java, 6) apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java, 7) apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java, 8) apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java.
Extra Requirements: If sending full files is too large, include at minimum each file’s import block, class header, @Before setup (if any), and the complete bodies of test methods named in snippets (e.g., create, shouldFailWhenAppNamespaceNameIsInvalid, testNormalizeNamespace*, testQueryConfig*, testFindNamespace, testDeleteEmptyNamespace, testFindPublicAppNamespace*, testFindBranch, testDeleteBranch), with exact line numbers.
Purpose: I will extract 8 relevant regression tests with exact file paths, imports, setup, assertions, and line numbers to address the namespace-with-single-dot issue.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java
Line number range: 19 - 27
Content:
19. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;
20. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
21. import com.ctrip.framework.apollo.common.entity.AppNamespace;
22. 
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.jdbc.Sql;
27. 


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java
Line number range: 30 - 57
Content:
30.   @Autowired
31.   private AppNamespaceRepository namespaceRepository;
32. 
33.   @Test
34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
35.   public void testCreate(){
36.     String appId = "6666";
37.     String name = "testnamespace";
38.     String comment = "comment";
39.     AppNamespaceDTO dto = new AppNamespaceDTO();
40.     dto.setAppId(appId);
41.     dto.setName(name);
42.     dto.setComment(comment);
43.     dto.setDataChangeCreatedBy("apollo");
44. 
45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(
46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();
47. 
48.     Assert.assertEquals(appId, resultDto.getAppId());
49.     Assert.assertTrue(resultDto.getId() > 0);
50. 
51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);
52.     Assert.assertNotNull(savedAppNs);
53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());
54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());
55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());
56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());
57. 


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java
Line number range: 19 - 25
Content:
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import org.junit.Assert;
22. import org.junit.Test;
23. import org.springframework.web.client.HttpClientErrorException;
24. import static org.hamcrest.Matchers.containsString;
25. 


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java
Line number range: 31 - 46
Content:
31. public class NamespaceControllerTest extends AbstractControllerTest {
32.   @Test
33.   public void create() {
34.     try {
35.       NamespaceDTO namespaceDTO = new NamespaceDTO();
36.       namespaceDTO.setClusterName("cluster");
37.       namespaceDTO.setNamespaceName("invalid name");
38.       namespaceDTO.setAppId("whatever");
39.       restTemplate.postForEntity(
40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),
41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());
42.       Assert.fail("Should throw");
43.     } catch (HttpClientErrorException e) {
44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
45.     }
46.   }


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java
Line number range: 19 - 26
Content:
19. import com.ctrip.framework.apollo.biz.AbstractIntegrationTest;
20. import com.ctrip.framework.apollo.biz.entity.GrayReleaseRule;
21. import com.ctrip.framework.apollo.biz.entity.Namespace;
22. import com.ctrip.framework.apollo.biz.entity.ReleaseHistory;
23. import com.ctrip.framework.apollo.common.constants.NamespaceBranchStatus;
24. import com.ctrip.framework.apollo.common.constants.ReleaseOperation;
25. 
26. import org.junit.Assert;


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java
Line number range: 34 - 47
Content:
34. public class NamespaceBranchServiceTest extends AbstractIntegrationTest {
35. 
36.   @Autowired
37.   private NamespaceBranchService namespaceBranchService;
38. 
39.   @Autowired
40.   private ReleaseHistoryService releaseHistoryService;
41. 
42.   private String testApp = "test";
43.   private String testCluster = "default";
44.   private String testNamespace = "application";
45.   private String testBranchName = "child-cluster";
46.   private String operator = "apollo";
47.   private Pageable pageable = PageRequest.of(0, 10);


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java
Line number range: 49 - 57
Content:
49.   @Test
50.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
51.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
52.   public void testFindBranch() {
53.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);
54. 
55.     Assert.assertNotNull(branch);
56.     Assert.assertEquals(testBranchName, branch.getClusterName());
57.   }


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java
Line number range: 167 - 176
Content:
167.   public void testDeleteBranch() {
168. 
169.     GrayReleaseRule rule = instanceGrayReleaseRule();
170.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, rule);
171. 
172.     namespaceBranchService.deleteBranch(testApp, testCluster, testNamespace, testBranchName, NamespaceBranchStatus.DELETED, operator);
173. 
174.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);
175.     Assert.assertNull(branch);
176. 


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java
Line number range: 19 - 33
Content:
19. import com.ctrip.framework.apollo.biz.AbstractUnitTest;
20. import com.ctrip.framework.apollo.biz.MockBeanFactory;
21. import com.ctrip.framework.apollo.biz.entity.Namespace;
22. import com.ctrip.framework.apollo.biz.repository.NamespaceRepository;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.common.exception.BadRequestException;
25. import com.ctrip.framework.apollo.core.ConfigConsts;
26. 
27. import org.junit.Test;
28. import org.mockito.InjectMocks;
29. import org.mockito.Mock;
30. import org.mockito.Spy;
31. import org.springframework.data.domain.PageRequest;
32. import org.springframework.data.domain.Pageable;
33. 


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java
Line number range: 55 - 63
Content:
55.   @Test(expected = BadRequestException.class)
56.   public void testFindPublicAppNamespaceWithWrongNamespace() {
57.     Pageable page = PageRequest.of(0, 10);
58. 
59.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(null);
60. 
61.     namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);
62.   }
63. 


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java
Line number range: 65 - 87
Content:
65.   public void testFindPublicAppNamespace() {
66. 
67.     AppNamespace publicAppNamespace = MockBeanFactory.mockAppNamespace(null, testPublicAppNamespace, true);
68.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(publicAppNamespace);
69. 
70.     Namespace firstParentNamespace =
71.         MockBeanFactory.mockNamespace("app", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);
72.     Namespace secondParentNamespace =
73.         MockBeanFactory.mockNamespace("app1", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);
74. 
75.     Pageable page = PageRequest.of(0, 10);
76. 
77.     when(namespaceRepository.findByNamespaceName(testPublicAppNamespace, page))
78.         .thenReturn(Arrays.asList(firstParentNamespace, secondParentNamespace));
79. 
80.     doReturn(false).when(namespaceService).isChildNamespace(firstParentNamespace);
81.     doReturn(false).when(namespaceService).isChildNamespace(secondParentNamespace);
82. 
83.     List<Namespace> namespaces = namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);
84. 
85.     assertEquals(2, namespaces.size());
86.   }
87. 


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 19 - 25
Content:
19. import com.ctrip.framework.apollo.biz.entity.Release;
20. import com.ctrip.framework.apollo.common.entity.AppNamespace;
21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;
23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;
24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;
25. import com.ctrip.framework.apollo.core.ConfigConsts;


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 73 - 76
Content:
73.   private NamespaceUtil namespaceUtil;
74.   @Mock
75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;
76.   @Mock


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 110 - 133
Content:
110.   @Test
111.   public void testQueryConfig() throws Exception {
112.     String someClientSideReleaseKey = "1";
113.     String someServerSideNewReleaseKey = "2";
114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
115. 
116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);
120. 
121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
124. 
125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
126.         defaultNamespaceName, someDataCenter, someNotificationMessages);
127.     assertEquals(someAppId, result.getAppId());
128.     assertEquals(someClusterName, result.getCluster());
129.     assertEquals(defaultNamespaceName, result.getNamespaceName());
130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);
133.   }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 221 - 248
Content:
221.   @Test
222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {
223.     String someClientSideReleaseKey = "1";
224.     String someServerSideReleaseKey = "2";
225.     String someAppOwnNamespaceName = "someAppOwn";
226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
227.     AppNamespace someAppOwnNamespace =
228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);
229. 
230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,
231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))
233.         .thenReturn(someAppOwnNamespace);
234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
237. 
238.     ApolloConfig result =
239.         configController
240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,
241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
242. 
243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
244.     assertEquals(someAppId, result.getAppId());
245.     assertEquals(someClusterName, result.getCluster());
246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());
247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));
248.   }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 250 - 282
Content:
250.   @Test
251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {
252.     String someClientSideReleaseKey = "1";
253.     String someServerSideReleaseKey = "2";
254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
255.     String somePublicAppId = "somePublicAppId";
256.     String somePublicClusterName = "somePublicClusterName";
257.     AppNamespace somePublicAppNamespace =
258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
259. 
260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
261.         someDataCenter, someNotificationMessages)).thenReturn(null);
262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
263.         .thenReturn(somePublicAppNamespace);
264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);
269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
270. 
271.     ApolloConfig result = configController
272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
274. 
275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
276.     assertEquals(someAppId, result.getAppId());
277.     assertEquals(someClusterName, result.getCluster());
278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);
282.   }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 416 - 444
Content:
416.   @Test
417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {
418.     String someClientSideReleaseKey = "1";
419.     String someServerSideReleaseKey = "2";
420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
421.     String somePublicAppId = "somePublicAppId";
422.     AppNamespace somePublicAppNamespace =
423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
425. 
426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
427.         .thenReturn(somePublicAppNamespace);
428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
432. 
433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,
435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
436. 
437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,
438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);
439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
440.     assertEquals(appId, result.getAppId());
441.     assertEquals(someClusterName, result.getCluster());
442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
444.   }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 19 - 29
Content:
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
21. import org.junit.Before;
22. import org.junit.Test;
23. import org.junit.runner.RunWith;
24. import org.mockito.Mock;
25. import org.mockito.junit.MockitoJUnitRunner;
26. 
27. import static org.junit.Assert.assertEquals;
28. import static org.mockito.Mockito.*;
29. 


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 80 - 95
Content:
80.   @Test
81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {
82.     String someAppId = "someAppId";
83.     String someNamespaceName = "someNamespaceName";
84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
85.     AppNamespace someAppNamespace = mock(AppNamespace.class);
86. 
87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn
89.         (someAppNamespace);
90. 
91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
92. 
93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);
95.   }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 97 - 112
Content:
97.   @Test
98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {
99.     String someAppId = "someAppId";
100.     String someNamespaceName = "someNamespaceName";
101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
102.     AppNamespace someAppNamespace = mock(AppNamespace.class);
103. 
104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);
107. 
108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
109. 
110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
112.   }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 19 - 28
Content:
19. import com.ctrip.framework.apollo.common.utils.InputValidator;
20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;
22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.ActiveProfiles;
27. import org.springframework.web.client.HttpClientErrorException;
28. import static org.hamcrest.Matchers.containsString;


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 41 - 61
Content:
41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {
42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));
43. 
44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();
45.     dto.setAppId("appId");
46.     dto.setName("invalid name");
47.     dto.setFormat(ConfigFileFormat.Properties.getValue());
48.     dto.setDataChangeCreatedBy("apollo");
49.     try {
50.       restTemplate.postForEntity(
51.           url("/openapi/v1/apps/{appId}/appnamespaces"),
52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()
53.       );
54.       Assert.fail("should throw");
55.     } catch (HttpClientErrorException e) {
56.       String result = e.getResponseBodyAsString();
57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
59.     }
60.   }
61. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java
Line number range: 19 - 29
Content:
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.common.exception.BadRequestException;
21. import com.ctrip.framework.apollo.core.ConfigConsts;
22. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
23. import com.ctrip.framework.apollo.portal.AbstractIntegrationTest;
24. 
25. import org.junit.Assert;
26. import org.junit.Test;
27. import org.springframework.beans.factory.annotation.Autowired;
28. import org.springframework.test.context.jdbc.Sql;
29. 


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java
Line number range: 71 - 82
Content:
71. 
72.   @Test
73.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
74.   public void testCreateDefaultAppNamespace() {
75.     appNamespaceService.createDefaultAppNamespace(APP);
76. 
77.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(APP, ConfigConsts.NAMESPACE_APPLICATION);
78. 
79.     Assert.assertNotNull(appNamespace);
80.     Assert.assertEquals(ConfigFileFormat.Properties.getValue(), appNamespace.getFormat());
81. 
82.   }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 19 - 52
Content:
19. import com.ctrip.framework.apollo.common.dto.ClusterDTO;
20. import com.ctrip.framework.apollo.common.dto.ItemDTO;
21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
22. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
25. import com.ctrip.framework.apollo.portal.component.PortalSettings;
26. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
27. import com.ctrip.framework.apollo.portal.environment.Env;
28. import com.ctrip.framework.apollo.portal.AbstractUnitTest;
29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
30. import com.ctrip.framework.apollo.portal.component.txtresolver.PropertyResolver;
31. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
32. import com.ctrip.framework.apollo.portal.entity.bo.UserInfo;
33. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
34. 
35. import org.assertj.core.util.Lists;
36. import org.junit.Before;
37. import org.junit.Test;
38. import org.mockito.InjectMocks;
39. import org.mockito.Mock;
40. 
41. import java.util.Arrays;
42. import java.util.Collections;
43. import java.util.List;
44. 
45. import static org.assertj.core.api.AssertionsForClassTypes.assertThat;
46. import static org.assertj.core.api.AssertionsForClassTypes.assertThatExceptionOfType;
47. import static org.junit.Assert.assertEquals;
48. import static org.mockito.Mockito.mock;
49. import static org.mockito.Mockito.times;
50. import static org.mockito.Mockito.verify;
51. import static org.mockito.Mockito.when;
52. 


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 90 - 150
Content:
90.   @Test
91.   public void testFindNamespace() {
92. 
93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);
94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);
95. 
96.     NamespaceDTO application = new NamespaceDTO();
97.     application.setId(1);
98.     application.setClusterName(testClusterName);
99.     application.setAppId(testAppId);
100.     application.setNamespaceName(testNamespaceName);
101. 
102.     NamespaceDTO hermes = new NamespaceDTO();
103.     hermes.setId(2);
104.     hermes.setClusterName("default");
105.     hermes.setAppId(testAppId);
106.     hermes.setNamespaceName("hermes");
107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);
108. 
109.     ReleaseDTO someRelease = new ReleaseDTO();
110.     someRelease.setConfigurations("{\"a\":\"123\",\"b\":\"123\"}");
111. 
112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);
113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);
114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);
115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);
116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);
117. 
118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());
119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());
120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))
121.         .thenReturn(applicationAppNamespace);
122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);
123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);
124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,
125.                                           testNamespaceName)).thenReturn(someRelease);
126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);
127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);
128. 
129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
130.     assertEquals(2, namespaceVOs.size());
131. 
132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));
133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
134.     assertEquals(1, namespaceVOs.size());
135.     NamespaceBO namespaceVO = namespaceVOs.get(0);
136.     assertEquals(4, namespaceVO.getItems().size());
137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());
138.     assertEquals(2, namespaceVO.getItemModifiedCnt());
139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());
140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());
141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());
142. 
143.     ReleaseDTO errorRelease = new ReleaseDTO();
144.     errorRelease.setConfigurations("\"a\":\"123\",\"b\":\"123\"");
145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);
146.     assertThatExceptionOfType(RuntimeException.class)
147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))
148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");
149. 
150.   }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 200 - 224
Content:
200.   @Test
201.   public void testDeleteEmptyNamespace() {
202.     String branchName = "branch";
203.     String operator = "user";
204. 
205.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);
206.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);
207. 
208.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);
209.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))
210.         .thenReturn(0);
211.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);
212.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(0);
213.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);
214. 
215.     NamespaceDTO namespace = createNamespace(testAppId, testClusterName, testNamespaceName);
216.     when(namespaceAPI.getPublicAppNamespaceAllNamespaces(testEnv, testNamespaceName, 0, 10)).thenReturn(
217.         Collections.singletonList(namespace));
218.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));
219. 
220.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);
221. 
222.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);
223. 
224.   }

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:27:23,844 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The aggregated context only contains partial snippets from the relevant test files. To deliver 8 complete, self-contained test cases with precise file paths and line numbers, I need the full file contents (imports, class headers/annotations, setup, field declarations/mocks, and complete test method bodies). Key dependencies like restTemplate/url helpers and Mockito/JUnit setup are not fully visible, so additional context is essential.' query='Please provide the full content with line numbers of apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java.' extra_requirements='If full files are too large, include at minimum each file’s import block, class header/annotations, setup/@Before methods, field declarations/mocks, and the complete bodies with line numbers of these test methods: create, shouldFailWhenAppNamespaceNameIsInvalid, testNormalizeNamespaceWithPrivateNamespace, testNormalizeNamespaceWithPublicNamespace, testQueryConfig, testQueryConfigWithAppOwnNamespace, testQueryConfigWithPubicNamespaceAndNoAppOverride, testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace.' purpose='These complete tests with exact line numbers, imports, and setup are needed to extract 8 self-contained regression test cases targeting namespace parsing/normalization and query flows implicated by the single-dot namespace issue.'
2025-11-12 11:27:23,846 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content with line numbers of apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java.
2025-11-12 11:27:26,970 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 11:27:26,970 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 11:27:26,970 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 11:27:26,970 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 11:27:26,972 - thread-135845287823040.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 11:27:26,973 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 11:27:26,973 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content with line numbers of apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java.
Extra requirements: If full files are too large, include at minimum each file’s import block, class header/annotations, setup/@Before methods, field declarations/mocks, and the complete bodies with line numbers of these test methods: create, shouldFailWhenAppNamespaceNameIsInvalid, testNormalizeNamespaceWithPrivateNamespace, testNormalizeNamespaceWithPublicNamespace, testQueryConfig, testQueryConfigWithAppOwnNamespace, testQueryConfigWithPubicNamespaceAndNoAppOverride, testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace.
Purpose: These complete tests with exact line numbers, imports, and setup are needed to extract 8 self-contained regression test cases targeting namespace parsing/normalization and query flows implicated by the single-dot namespace issue.
2025-11-12 11:27:39,469 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_5t2i32cx7fonIGiDy1OyRS4e', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1010, 'prompt_tokens': 2414, 'total_tokens': 3424, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--621906d6-297f-44ca-a549-48f54d48f132-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java'}, 'id': 'call_5t2i32cx7fonIGiDy1OyRS4e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2414, 'output_tokens': 1010, 'total_tokens': 3424, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 11:27:41,335 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6sfnz6VTY2XPY1kWQUHMe0Mh', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 9550, 'total_tokens': 9594, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7adecaf5-8cd9-4d20-80da-69a2aaa69503-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java'}, 'id': 'call_6sfnz6VTY2XPY1kWQUHMe0Mh', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9550, 'output_tokens': 44, 'total_tokens': 9594, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:27:42,774 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_gl35WU85DNLXCDlG52lV9nrb', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 11190, 'total_tokens': 11234, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b06137fe-d7c0-4bb8-bdb9-3191aa79a386-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java'}, 'id': 'call_gl35WU85DNLXCDlG52lV9nrb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11190, 'output_tokens': 44, 'total_tokens': 11234, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:27:44,312 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lEK9vBpxLg9ynCuSEyIb9mnv', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 46, 'prompt_tokens': 11877, 'total_tokens': 11923, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1948588d-fff3-4f0b-87af-56822745a5d1-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java'}, 'id': 'call_lEK9vBpxLg9ynCuSEyIb9mnv', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11877, 'output_tokens': 46, 'total_tokens': 11923, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:27:55,448 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I retrieved the full contents with line numbers for the four requested test files via their relative paths. All files are within the size limit and include imports, class headers/annotations, setup/@Before methods (where applicable), field declarations/mocks, and the specified test methods. The requested tests (create, shouldFailWhenAppNamespaceNameIsInvalid, testNormalizeNamespaceWithPrivateNamespace, testNormalizeNamespaceWithPublicNamespace, testQueryConfig, testQueryConfigWithAppOwnNamespace, testQueryConfigWithPubicNamespaceAndNoAppOverride, and testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace) are present with their complete bodies and exact line numbers. These provide self-contained regression test cases for namespace parsing/normalization and query flows related to the single-dot namespace issue.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1254, 'prompt_tokens': 12733, 'total_tokens': 13987, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1088, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--5f0f676b-7e1a-496b-97bd-87737cb9e697-0' usage_metadata={'input_tokens': 12733, 'output_tokens': 1254, 'total_tokens': 13987, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1088}}
2025-11-12 11:27:55,451 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content with line numbers of apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If full files are too large, include at minimum each file’s import block, class header/annotations, setup/@Before methods, field declarations/mocks, and the complete bodies with line numbers of these test methods: create, shouldFailWhenAppNamespaceNameIsInvalid, testNormalizeNamespaceWithPrivateNamespace, testNormalizeNamespaceWithPublicNamespace, testQueryConfig, testQueryConfigWithAppOwnNamespace, testQueryConfigWithPubicNamespaceAndNoAppOverride, testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
These complete tests with exact line numbers, imports, and setup are needed to extract 8 self-contained regression test cases targeting namespace parsing/normalization and query flows implicated by the single-dot namespace issue.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java
Line number range: 1 - 47
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import org.junit.Assert;
22. import org.junit.Test;
23. import org.springframework.web.client.HttpClientErrorException;
24. import static org.hamcrest.Matchers.containsString;
25. 
26. /**
27.  * Created by kezhenxu at 2019/1/8 16:27.
28.  *
29.  * @author kezhenxu (kezhenxu94@163.com)
30.  */
31. public class NamespaceControllerTest extends AbstractControllerTest {
32.   @Test
33.   public void create() {
34.     try {
35.       NamespaceDTO namespaceDTO = new NamespaceDTO();
36.       namespaceDTO.setClusterName("cluster");
37.       namespaceDTO.setNamespaceName("invalid name");
38.       namespaceDTO.setAppId("whatever");
39.       restTemplate.postForEntity(
40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),
41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());
42.       Assert.fail("Should throw");
43.     } catch (HttpClientErrorException e) {
44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
45.     }
46.   }
47. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 1 - 481
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Release;
20. import com.ctrip.framework.apollo.common.entity.AppNamespace;
21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;
23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;
24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;
25. import com.ctrip.framework.apollo.core.ConfigConsts;
26. import com.ctrip.framework.apollo.core.dto.ApolloConfig;
27. import com.ctrip.framework.apollo.core.dto.ApolloNotificationMessages;
28. import com.google.common.base.Joiner;
29. import com.google.common.collect.ImmutableMap;
30. import com.google.common.collect.Lists;
31. import com.google.gson.Gson;
32. import com.google.gson.JsonSyntaxException;
33. import org.junit.Before;
34. import org.junit.Test;
35. import org.junit.runner.RunWith;
36. import org.mockito.Mock;
37. import org.mockito.junit.MockitoJUnitRunner;
38. 
39. import javax.servlet.http.HttpServletRequest;
40. import javax.servlet.http.HttpServletResponse;
41. import java.util.Map;
42. 
43. import static org.junit.Assert.assertEquals;
44. import static org.junit.Assert.assertNull;
45. import static org.mockito.Mockito.*;
46. 
47. /**
48.  * @author Jason Song(song_s@ctrip.com)
49.  */
50. @RunWith(MockitoJUnitRunner.class)
51. public class ConfigControllerTest {
52.   private ConfigController configController;
53.   @Mock
54.   private ConfigService configService;
55.   @Mock
56.   private AppNamespaceServiceWithCache appNamespaceService;
57.   private String someAppId;
58.   private String someClusterName;
59.   private String defaultClusterName;
60.   private String defaultNamespaceName;
61.   private String somePublicNamespaceName;
62.   private String someDataCenter;
63.   private String someClientIp;
64.   private String someClientLabel;
65.   private String someMessagesAsString;
66.   @Mock
67.   private ApolloNotificationMessages someNotificationMessages;
68.   @Mock
69.   private Release someRelease;
70.   @Mock
71.   private Release somePublicRelease;
72.   @Mock
73.   private NamespaceUtil namespaceUtil;
74.   @Mock
75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;
76.   @Mock
77.   private HttpServletRequest someRequest;
78.   private Gson gson = new Gson();
79. 
80.   @Before
81.   public void setUp() throws Exception {
82.     configController = spy(new ConfigController(
83.         configService, appNamespaceService, namespaceUtil, instanceConfigAuditUtil, gson
84.     ));
85. 
86.     someAppId = "1";
87.     someClusterName = "someClusterName";
88.     defaultClusterName = ConfigConsts.CLUSTER_NAME_DEFAULT;
89.     defaultNamespaceName = ConfigConsts.NAMESPACE_APPLICATION;
90.     somePublicNamespaceName = "somePublicNamespace";
91.     someDataCenter = "someDC";
92.     someClientIp = "someClientIp";
93.     someClientLabel = "someClientLabel";
94.     String someValidConfiguration = "{\"apollo.bar\": \"foo\"}";
95.     String somePublicConfiguration = "{\"apollo.public.bar\": \"foo\"}";
96. 
97.     when(someRelease.getAppId()).thenReturn(someAppId);
98.     when(someRelease.getClusterName()).thenReturn(someClusterName);
99.     when(someRelease.getConfigurations()).thenReturn(someValidConfiguration);
100.     when(somePublicRelease.getConfigurations()).thenReturn(somePublicConfiguration);
101.     when(namespaceUtil.filterNamespaceName(defaultNamespaceName)).thenReturn(defaultNamespaceName);
102.     when(namespaceUtil.filterNamespaceName(somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
103.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
104.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
105. 
106.     someMessagesAsString = "someValidJson";
107.     when(configController.transformMessages(someMessagesAsString)).thenReturn(someNotificationMessages);
108.   }
109. 
110.   @Test
111.   public void testQueryConfig() throws Exception {
112.     String someClientSideReleaseKey = "1";
113.     String someServerSideNewReleaseKey = "2";
114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
115. 
116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);
120. 
121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
124. 
125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
126.         defaultNamespaceName, someDataCenter, someNotificationMessages);
127.     assertEquals(someAppId, result.getAppId());
128.     assertEquals(someClusterName, result.getCluster());
129.     assertEquals(defaultNamespaceName, result.getNamespaceName());
130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);
133.   }
134. 
135.   @Test
136.   public void testQueryConfigFile() throws Exception {
137.     String someClientSideReleaseKey = "1";
138.     String someServerSideNewReleaseKey = "2";
139.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
140.     String someNamespaceName = String.format("%s.%s", defaultClusterName, "properties");
141. 
142.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
143.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
144.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
145.     when(namespaceUtil.filterNamespaceName(someNamespaceName)).thenReturn(defaultNamespaceName);
146.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
147. 
148.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
149.         someNamespaceName, someDataCenter, someClientSideReleaseKey,
150.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
151. 
152.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
153.         defaultNamespaceName, someDataCenter, someNotificationMessages);
154.     assertEquals(someAppId, result.getAppId());
155.     assertEquals(someClusterName, result.getCluster());
156.     assertEquals(someNamespaceName, result.getNamespaceName());
157.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
158.   }
159. 
160.   @Test
161.   public void testQueryConfigFileWithPrivateNamespace() throws Exception {
162.     String someClientSideReleaseKey = "1";
163.     String someServerSideNewReleaseKey = "2";
164.     String somePrivateNamespace = "datasource";
165.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
166.     String somePrivateNamespaceName = String.format("%s.%s", somePrivateNamespace, "xml");
167.     AppNamespace appNamespace = mock(AppNamespace.class);
168. 
169.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePrivateNamespace,
170.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
171.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
172.     when(namespaceUtil.filterNamespaceName(somePrivateNamespaceName)).thenReturn(somePrivateNamespace);
173.     when(namespaceUtil.normalizeNamespace(someAppId, somePrivateNamespace)).thenReturn(somePrivateNamespace);
174.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePrivateNamespace))
175.         .thenReturn(appNamespace);
176. 
177.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
178.         somePrivateNamespaceName, someDataCenter, someClientSideReleaseKey,
179.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
180. 
181.     assertEquals(someAppId, result.getAppId());
182.     assertEquals(someClusterName, result.getCluster());
183.     assertEquals(somePrivateNamespaceName, result.getNamespaceName());
184.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
185.   }
186. 
187.   @Test
188.   public void testQueryConfigWithReleaseNotFound() throws Exception {
189.     String someClientSideReleaseKey = "1";
190.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
191. 
192.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
193.         someDataCenter, someNotificationMessages)).thenReturn(null);
194. 
195.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
196.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
197.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
198. 
199.     assertNull(result);
200.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());
201.   }
202. 
203.   @Test
204.   public void testQueryConfigWithApolloConfigNotModified() throws Exception {
205.     String someClientSideReleaseKey = "1";
206.     String someServerSideReleaseKey = someClientSideReleaseKey;
207.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
208. 
209.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
210.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
211.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
212. 
213.     ApolloConfig result =
214.         configController.queryConfig(someAppId, someClusterName, defaultNamespaceName, someDataCenter,
215.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
216. 
217.     assertNull(result);
218.     verify(someResponse, times(1)).setStatus(HttpServletResponse.SC_NOT_MODIFIED);
219.   }
220. 
221.   @Test
222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {
223.     String someClientSideReleaseKey = "1";
224.     String someServerSideReleaseKey = "2";
225.     String someAppOwnNamespaceName = "someAppOwn";
226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
227.     AppNamespace someAppOwnNamespace =
228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);
229. 
230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,
231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))
233.         .thenReturn(someAppOwnNamespace);
234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
237. 
238.     ApolloConfig result =
239.         configController
240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,
241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
242. 
243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
244.     assertEquals(someAppId, result.getAppId());
245.     assertEquals(someClusterName, result.getCluster());
246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());
247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));
248.   }
249. 
250.   @Test
251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {
252.     String someClientSideReleaseKey = "1";
253.     String someServerSideReleaseKey = "2";
254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
255.     String somePublicAppId = "somePublicAppId";
256.     String somePublicClusterName = "somePublicClusterName";
257.     AppNamespace somePublicAppNamespace =
258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
259. 
260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
261.         someDataCenter, someNotificationMessages)).thenReturn(null);
262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
263.         .thenReturn(somePublicAppNamespace);
264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);
269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
270. 
271.     ApolloConfig result = configController
272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
274. 
275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
276.     assertEquals(someAppId, result.getAppId());
277.     assertEquals(someClusterName, result.getCluster());
278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);
282.   }
283. 
284.   @Test
285.   public void testQueryConfigFileWithPublicNamespaceAndNoAppOverride() throws Exception {
286.     String someClientSideReleaseKey = "1";
287.     String someServerSideReleaseKey = "2";
288.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
289.     String somePublicAppId = "somePublicAppId";
290.     String someNamespace = String.format("%s.%s", somePublicNamespaceName, "properties");
291.     AppNamespace somePublicAppNamespace =
292.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
293. 
294.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
295.         someDataCenter, someNotificationMessages)).thenReturn(null);
296.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
297.         .thenReturn(somePublicAppNamespace);
298.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
299.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
300.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
301.     when(namespaceUtil.filterNamespaceName(someNamespace)).thenReturn(somePublicNamespaceName);
302.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
303.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePublicNamespaceName)).thenReturn(null);
304. 
305.     ApolloConfig result = configController
306.         .queryConfig(someAppId, someClusterName, someNamespace, someDataCenter,
307.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
308. 
309.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
310.     assertEquals(someAppId, result.getAppId());
311.     assertEquals(someClusterName, result.getCluster());
312.     assertEquals(someNamespace, result.getNamespaceName());
313.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
314.   }
315. 
316.   @Test
317.   public void testQueryConfigWithPublicNamespaceAndAppOverride() throws Exception {
318.     String someAppSideReleaseKey = "1";
319.     String somePublicAppSideReleaseKey = "2";
320. 
321.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
322.     String somePublicAppId = "somePublicAppId";
323.     AppNamespace somePublicAppNamespace =
324.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
325. 
326.     when(someRelease.getConfigurations()).thenReturn("{\"apollo.public.foo\": \"foo-override\"}");
327.     when(somePublicRelease.getConfigurations())
328.         .thenReturn("{\"apollo.public.foo\": \"foo\", \"apollo.public.bar\": \"bar\"}");
329. 
330.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
331.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
332.     when(someRelease.getReleaseKey()).thenReturn(someAppSideReleaseKey);
333.     when(someRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
334.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
335.         .thenReturn(somePublicAppNamespace);
336.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
337.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
338.     when(somePublicRelease.getReleaseKey()).thenReturn(somePublicAppSideReleaseKey);
339.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
340.     when(somePublicRelease.getClusterName()).thenReturn(someDataCenter);
341.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
342. 
343.     ApolloConfig result =
344.         configController
345.             .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
346.                 someAppSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
347. 
348.     assertEquals(Joiner.on(ConfigConsts.CLUSTER_NAMESPACE_SEPARATOR)
349.             .join(someAppSideReleaseKey, somePublicAppSideReleaseKey),
350.         result.getReleaseKey());
351.     assertEquals(someAppId, result.getAppId());
352.     assertEquals(someClusterName, result.getCluster());
353.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
354.     assertEquals("foo-override", result.getConfigurations().get("apollo.public.foo"));
355.     assertEquals("bar", result.getConfigurations().get("apollo.public.bar"));
356.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
357.         someClientIp, someAppId, someClusterName, somePublicNamespaceName, someAppSideReleaseKey);
358.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
359.         someClientIp, somePublicAppId, someDataCenter, somePublicNamespaceName, somePublicAppSideReleaseKey);
360.   }
361. 
362.   @Test
363.   public void testMergeConfigurations() throws Exception {
364.     Gson gson = new Gson();
365.     String key1 = "key1";
366.     String value1 = "value1";
367.     String anotherValue1 = "anotherValue1";
368. 
369.     String key2 = "key2";
370.     String value2 = "value2";
371. 
372.     Map<String, String> config = ImmutableMap.of(key1, anotherValue1);
373.     Map<String, String> anotherConfig = ImmutableMap.of(key1, value1, key2, value2);
374. 
375.     Release releaseWithHighPriority = new Release();
376.     releaseWithHighPriority.setConfigurations(gson.toJson(config));
377. 
378.     Release releaseWithLowPriority = new Release();
379.     releaseWithLowPriority.setConfigurations(gson.toJson(anotherConfig));
380. 
381.     Map<String, String> result =
382.         configController.mergeReleaseConfigurations(
383.             Lists.newArrayList(releaseWithHighPriority, releaseWithLowPriority));
384. 
385.     assertEquals(2, result.keySet().size());
386.     assertEquals(anotherValue1, result.get(key1));
387.     assertEquals(value2, result.get(key2));
388.   }
389. 
390.   @Test(expected = JsonSyntaxException.class)
391.   public void testTransformConfigurationToMapFailed() throws Exception {
392.     String someInvalidConfiguration = "xxx";
393.     Release someRelease = new Release();
394.     someRelease.setConfigurations(someInvalidConfiguration);
395. 
396.     configController.mergeReleaseConfigurations(Lists.newArrayList(someRelease));
397.   }
398. 
399.   @Test
400.   public void testQueryConfigForNoAppIdPlaceHolder() throws Exception {
401.     String someClientSideReleaseKey = "1";
402.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
403.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
404. 
405.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
406.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
407.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
408. 
409.     verify(configService, never()).loadConfig(appId, someClientIp, someAppId, someClientLabel, someClusterName, defaultNamespaceName,
410.         someDataCenter, someNotificationMessages);
411.     verify(appNamespaceService, never()).findPublicNamespaceByName(defaultNamespaceName);
412.     assertNull(result);
413.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());
414.   }
415. 
416.   @Test
417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {
418.     String someClientSideReleaseKey = "1";
419.     String someServerSideReleaseKey = "2";
420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
421.     String somePublicAppId = "somePublicAppId";
422.     AppNamespace somePublicAppNamespace =
423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
425. 
426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
427.         .thenReturn(somePublicAppNamespace);
428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
432. 
433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,
435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
436. 
437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,
438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);
439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
440.     assertEquals(appId, result.getAppId());
441.     assertEquals(someClusterName, result.getCluster());
442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
444.   }
445. 
446.   @Test
447.   public void testTransformMessages() throws Exception {
448.     String someKey = "someKey";
449.     long someNotificationId = 1;
450.     String anotherKey = "anotherKey";
451.     long anotherNotificationId = 2;
452.     ApolloNotificationMessages notificationMessages = new ApolloNotificationMessages();
453.     notificationMessages.put(someKey, someNotificationId);
454.     notificationMessages.put(anotherKey, anotherNotificationId);
455. 
456.     String someMessagesAsString = gson.toJson(notificationMessages);
457. 
458.     ApolloNotificationMessages result = configController.transformMessages(someMessagesAsString);
459. 
460.     assertEquals(notificationMessages.getDetails(), result.getDetails());
461.   }
462. 
463.   @Test
464.   public void testTransformInvalidMessages() throws Exception {
465.     String someInvalidMessages = "someInvalidMessages";
466. 
467.     assertNull(configController.transformMessages(someInvalidMessages));
468.   }
469. 
470.   private AppNamespace assemblePublicAppNamespace(String appId, String namespace) {
471.     return assembleAppNamespace(appId, namespace, true);
472.   }
473. 
474.   private AppNamespace assembleAppNamespace(String appId, String namespace, boolean isPublic) {
475.     AppNamespace appNamespace = new AppNamespace();
476.     appNamespace.setAppId(appId);
477.     appNamespace.setName(namespace);
478.     appNamespace.setPublic(isPublic);
479.     return appNamespace;
480.   }
481. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 1 - 127
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.util;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
21. import org.junit.Before;
22. import org.junit.Test;
23. import org.junit.runner.RunWith;
24. import org.mockito.Mock;
25. import org.mockito.junit.MockitoJUnitRunner;
26. 
27. import static org.junit.Assert.assertEquals;
28. import static org.mockito.Mockito.*;
29. 
30. /**
31.  * @author Jason Song(song_s@ctrip.com)
32.  */
33. @RunWith(MockitoJUnitRunner.class)
34. public class NamespaceUtilTest {
35.   private NamespaceUtil namespaceUtil;
36. 
37.   @Mock
38.   private AppNamespaceServiceWithCache appNamespaceServiceWithCache;
39. 
40.   @Before
41.   public void setUp() throws Exception {
42.     namespaceUtil = new NamespaceUtil(appNamespaceServiceWithCache);
43.   }
44. 
45.   @Test
46.   public void testFilterNamespaceName() throws Exception {
47.     String someName = "a.properties";
48. 
49.     assertEquals("a", namespaceUtil.filterNamespaceName(someName));
50.   }
51. 
52.   @Test
53.   public void testFilterNamespaceNameUnchanged() throws Exception {
54.     String someName = "a.xml";
55. 
56.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
57.   }
58. 
59.   @Test
60.   public void testFilterNamespaceNameWithMultiplePropertiesSuffix() throws Exception {
61.     String someName = "a.properties.properties";
62. 
63.     assertEquals("a.properties", namespaceUtil.filterNamespaceName(someName));
64.   }
65. 
66.   @Test
67.   public void testFilterNamespaceNameWithRandomCase() throws Exception {
68.     String someName = "AbC.ProPErties";
69. 
70.     assertEquals("AbC", namespaceUtil.filterNamespaceName(someName));
71.   }
72. 
73.   @Test
74.   public void testFilterNamespaceNameWithRandomCaseUnchanged() throws Exception {
75.     String someName = "AbCD.xMl";
76. 
77.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
78.   }
79. 
80.   @Test
81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {
82.     String someAppId = "someAppId";
83.     String someNamespaceName = "someNamespaceName";
84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
85.     AppNamespace someAppNamespace = mock(AppNamespace.class);
86. 
87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn
89.         (someAppNamespace);
90. 
91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
92. 
93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);
95.   }
96. 
97.   @Test
98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {
99.     String someAppId = "someAppId";
100.     String someNamespaceName = "someNamespaceName";
101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
102.     AppNamespace someAppNamespace = mock(AppNamespace.class);
103. 
104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);
107. 
108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
109. 
110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
112.   }
113. 
114.   @Test
115.   public void testNormalizeNamespaceFailed() throws Exception {
116.     String someAppId = "someAppId";
117.     String someNamespaceName = "someNamespaceName";
118. 
119.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
120.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(null);
121. 
122.     assertEquals(someNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
123. 
124.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
125.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
126.   }
127. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 1 - 61
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.openapi.v1.controller;
18. 
19. import com.ctrip.framework.apollo.common.utils.InputValidator;
20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;
22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.ActiveProfiles;
27. import org.springframework.web.client.HttpClientErrorException;
28. import static org.hamcrest.Matchers.containsString;
29. 
30. /**
31.  * Created by kezhenxu at 2019/1/8 18:17.
32.  *
33.  * @author kezhenxu (kezhenxu94@163.com)
34.  */
35. @ActiveProfiles("skipAuthorization")
36. public class NamespaceControllerTest extends AbstractControllerTest {
37.   @Autowired
38.   private ConsumerPermissionValidator consumerPermissionValidator;
39. 
40.   @Test
41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {
42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));
43. 
44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();
45.     dto.setAppId("appId");
46.     dto.setName("invalid name");
47.     dto.setFormat(ConfigFileFormat.Properties.getValue());
48.     dto.setDataChangeCreatedBy("apollo");
49.     try {
50.       restTemplate.postForEntity(
51.           url("/openapi/v1/apps/{appId}/appnamespaces"),
52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()
53.       );
54.       Assert.fail("should throw");
55.     } catch (HttpClientErrorException e) {
56.       String result = e.getResponseBodyAsString();
57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
59.     }
60.   }
61. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 11:28:31,707 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='Includes imports necessary for the test and constants used. Provides essential setup for understanding class dependencies and annotations for ConfigControllerTest.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=19, end_line=46), ContextOutput(reasoning='Contains class header, annotations, and all field declarations/mocks required by the specified test methods.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=50, end_line=79), ContextOutput(reasoning='Setup method initializes the controller under test and configures common mocks; essential for all subsequent test methods.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=80, end_line=108), ContextOutput(reasoning='Complete body of testQueryConfig, one of the requested test cases validating basic query flow and auditing.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=110, end_line=133), ContextOutput(reasoning='Complete body of testQueryConfigWithAppOwnNamespace, requested test validating behavior with app-owned public namespace.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=221, end_line=248), ContextOutput(reasoning='Complete body of testQueryConfigWithPubicNamespaceAndNoAppOverride, requested test validating behavior with public namespace and no app override.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=250, end_line=282), ContextOutput(reasoning='Complete body of testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace, requested test validating behavior with NO_APPID placeholder and public namespace.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=416, end_line=444), ContextOutput(reasoning='Helper methods used by multiple requested tests to assemble AppNamespace; essential for understanding test setup and behavior.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=470, end_line=480), ContextOutput(reasoning='Imports required for NamespaceUtilTest, including mocked services.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', start_line=19, end_line=29), ContextOutput(reasoning='Class header and field declarations/mocks for NamespaceUtilTest.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', start_line=33, end_line=39), ContextOutput(reasoning='Setup method for NamespaceUtilTest initializing NamespaceUtil with mocked cache service.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', start_line=40, end_line=43), ContextOutput(reasoning='Complete body of testNormalizeNamespaceWithPrivateNamespace as requested, verifying normalization via private namespace.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', start_line=80, end_line=96), ContextOutput(reasoning='Complete body of testNormalizeNamespaceWithPublicNamespace as requested, verifying normalization via public namespace.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', start_line=97, end_line=112), ContextOutput(reasoning='Imports necessary for adminservice NamespaceControllerTest.', relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', start_line=19, end_line=25), ContextOutput(reasoning='Class header and the complete body of create test method as requested, validating invalid namespace name handling.', relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', start_line=31, end_line=46), ContextOutput(reasoning='Imports for portal openapi NamespaceControllerTest including validators and DTOs.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', start_line=19, end_line=29), ContextOutput(reasoning='Class annotations/header and field declarations for portal NamespaceControllerTest.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', start_line=35, end_line=39), ContextOutput(reasoning='Complete body of shouldFailWhenAppNamespaceNameIsInvalid as requested, verifying input validation error responses.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', start_line=40, end_line=61)]
2025-11-12 11:28:31,715 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 18 contexts to memory for query: Please provide the full content with line numbers of apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java.
2025-11-12 11:28:32,280 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 11:28:32,281 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 18 new contexts to 27 existing contexts
2025-11-12 11:28:32,283 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 32 total contexts (removed 13 duplicates)
2025-11-12 11:28:32,284 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - INFO - Reached max_refined_query_loop, not asking for more context
2025-11-12 11:28:32,286 - thread-135845287823040.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java', content='19. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;\n20. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;\n21. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n22. \n23. import org.junit.Assert;\n24. import org.junit.Test;\n25. import org.springframework.beans.factory.annotation.Autowired;\n26. import org.springframework.test.context.jdbc.Sql;\n27. ', start_line_number=19, end_line_number=27), Context(relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java', content='30.   @Autowired\n31.   private AppNamespaceRepository namespaceRepository;\n32. \n33.   @Test\n34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)\n35.   public void testCreate(){\n36.     String appId = "6666";\n37.     String name = "testnamespace";\n38.     String comment = "comment";\n39.     AppNamespaceDTO dto = new AppNamespaceDTO();\n40.     dto.setAppId(appId);\n41.     dto.setName(name);\n42.     dto.setComment(comment);\n43.     dto.setDataChangeCreatedBy("apollo");\n44. \n45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(\n46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();\n47. \n48.     Assert.assertEquals(appId, resultDto.getAppId());\n49.     Assert.assertTrue(resultDto.getId() > 0);\n50. \n51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);\n52.     Assert.assertNotNull(savedAppNs);\n53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());\n54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());\n55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());\n56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());\n57. ', start_line_number=30, end_line_number=57), Context(relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', content='19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;\n20. import com.ctrip.framework.apollo.common.utils.InputValidator;\n21. import org.junit.Assert;\n22. import org.junit.Test;\n23. import org.springframework.web.client.HttpClientErrorException;\n24. import static org.hamcrest.Matchers.containsString;\n25. ', start_line_number=19, end_line_number=25), Context(relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', content='31. public class NamespaceControllerTest extends AbstractControllerTest {\n32.   @Test\n33.   public void create() {\n34.     try {\n35.       NamespaceDTO namespaceDTO = new NamespaceDTO();\n36.       namespaceDTO.setClusterName("cluster");\n37.       namespaceDTO.setNamespaceName("invalid name");\n38.       namespaceDTO.setAppId("whatever");\n39.       restTemplate.postForEntity(\n40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),\n41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());\n42.       Assert.fail("Should throw");\n43.     } catch (HttpClientErrorException e) {\n44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));\n45.     }\n46.   }', start_line_number=31, end_line_number=46), Context(relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', content='19. import com.ctrip.framework.apollo.biz.AbstractIntegrationTest;\n20. import com.ctrip.framework.apollo.biz.entity.GrayReleaseRule;\n21. import com.ctrip.framework.apollo.biz.entity.Namespace;\n22. import com.ctrip.framework.apollo.biz.entity.ReleaseHistory;\n23. import com.ctrip.framework.apollo.common.constants.NamespaceBranchStatus;\n24. import com.ctrip.framework.apollo.common.constants.ReleaseOperation;\n25. \n26. import org.junit.Assert;', start_line_number=19, end_line_number=26), Context(relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', content='34. public class NamespaceBranchServiceTest extends AbstractIntegrationTest {\n35. \n36.   @Autowired\n37.   private NamespaceBranchService namespaceBranchService;\n38. \n39.   @Autowired\n40.   private ReleaseHistoryService releaseHistoryService;\n41. \n42.   private String testApp = "test";\n43.   private String testCluster = "default";\n44.   private String testNamespace = "application";\n45.   private String testBranchName = "child-cluster";\n46.   private String operator = "apollo";\n47.   private Pageable pageable = PageRequest.of(0, 10);', start_line_number=34, end_line_number=47), Context(relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', content='49.   @Test\n50.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)\n51.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)\n52.   public void testFindBranch() {\n53.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);\n54. \n55.     Assert.assertNotNull(branch);\n56.     Assert.assertEquals(testBranchName, branch.getClusterName());\n57.   }', start_line_number=49, end_line_number=57), Context(relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java', content='167.   public void testDeleteBranch() {\n168. \n169.     GrayReleaseRule rule = instanceGrayReleaseRule();\n170.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, rule);\n171. \n172.     namespaceBranchService.deleteBranch(testApp, testCluster, testNamespace, testBranchName, NamespaceBranchStatus.DELETED, operator);\n173. \n174.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);\n175.     Assert.assertNull(branch);\n176. ', start_line_number=167, end_line_number=176), Context(relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java', content='19. import com.ctrip.framework.apollo.biz.AbstractUnitTest;\n20. import com.ctrip.framework.apollo.biz.MockBeanFactory;\n21. import com.ctrip.framework.apollo.biz.entity.Namespace;\n22. import com.ctrip.framework.apollo.biz.repository.NamespaceRepository;\n23. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n24. import com.ctrip.framework.apollo.common.exception.BadRequestException;\n25. import com.ctrip.framework.apollo.core.ConfigConsts;\n26. \n27. import org.junit.Test;\n28. import org.mockito.InjectMocks;\n29. import org.mockito.Mock;\n30. import org.mockito.Spy;\n31. import org.springframework.data.domain.PageRequest;\n32. import org.springframework.data.domain.Pageable;\n33. ', start_line_number=19, end_line_number=33), Context(relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java', content='55.   @Test(expected = BadRequestException.class)\n56.   public void testFindPublicAppNamespaceWithWrongNamespace() {\n57.     Pageable page = PageRequest.of(0, 10);\n58. \n59.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(null);\n60. \n61.     namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);\n62.   }\n63. ', start_line_number=55, end_line_number=63), Context(relative_path='apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java', content='65.   public void testFindPublicAppNamespace() {\n66. \n67.     AppNamespace publicAppNamespace = MockBeanFactory.mockAppNamespace(null, testPublicAppNamespace, true);\n68.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(publicAppNamespace);\n69. \n70.     Namespace firstParentNamespace =\n71.         MockBeanFactory.mockNamespace("app", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);\n72.     Namespace secondParentNamespace =\n73.         MockBeanFactory.mockNamespace("app1", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);\n74. \n75.     Pageable page = PageRequest.of(0, 10);\n76. \n77.     when(namespaceRepository.findByNamespaceName(testPublicAppNamespace, page))\n78.         .thenReturn(Arrays.asList(firstParentNamespace, secondParentNamespace));\n79. \n80.     doReturn(false).when(namespaceService).isChildNamespace(firstParentNamespace);\n81.     doReturn(false).when(namespaceService).isChildNamespace(secondParentNamespace);\n82. \n83.     List<Namespace> namespaces = namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);\n84. \n85.     assertEquals(2, namespaces.size());\n86.   }\n87. ', start_line_number=65, end_line_number=87), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', content='19. import com.ctrip.framework.apollo.biz.entity.Release;\n20. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\n22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;\n23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;\n24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;\n25. import com.ctrip.framework.apollo.core.ConfigConsts;\n26. import com.ctrip.framework.apollo.core.dto.ApolloConfig;\n27. import com.ctrip.framework.apollo.core.dto.ApolloNotificationMessages;\n28. import com.google.common.base.Joiner;\n29. import com.google.common.collect.ImmutableMap;\n30. import com.google.common.collect.Lists;\n31. import com.google.gson.Gson;\n32. import com.google.gson.JsonSyntaxException;\n33. import org.junit.Before;\n34. import org.junit.Test;\n35. import org.junit.runner.RunWith;\n36. import org.mockito.Mock;\n37. import org.mockito.junit.MockitoJUnitRunner;\n38. \n39. import javax.servlet.http.HttpServletRequest;\n40. import javax.servlet.http.HttpServletResponse;\n41. import java.util.Map;\n42. \n43. import static org.junit.Assert.assertEquals;\n44. import static org.junit.Assert.assertNull;\n45. import static org.mockito.Mockito.*;\n46. ', start_line_number=19, end_line_number=46), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', content='50. @RunWith(MockitoJUnitRunner.class)\n51. public class ConfigControllerTest {\n52.   private ConfigController configController;\n53.   @Mock\n54.   private ConfigService configService;\n55.   @Mock\n56.   private AppNamespaceServiceWithCache appNamespaceService;\n57.   private String someAppId;\n58.   private String someClusterName;\n59.   private String defaultClusterName;\n60.   private String defaultNamespaceName;\n61.   private String somePublicNamespaceName;\n62.   private String someDataCenter;\n63.   private String someClientIp;\n64.   private String someClientLabel;\n65.   private String someMessagesAsString;\n66.   @Mock\n67.   private ApolloNotificationMessages someNotificationMessages;\n68.   @Mock\n69.   private Release someRelease;\n70.   @Mock\n71.   private Release somePublicRelease;\n72.   @Mock\n73.   private NamespaceUtil namespaceUtil;\n74.   @Mock\n75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;\n76.   @Mock\n77.   private HttpServletRequest someRequest;\n78.   private Gson gson = new Gson();\n79. ', start_line_number=50, end_line_number=79), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', content='80.   @Before\n81.   public void setUp() throws Exception {\n82.     configController = spy(new ConfigController(\n83.         configService, appNamespaceService, namespaceUtil, instanceConfigAuditUtil, gson\n84.     ));\n85. \n86.     someAppId = "1";\n87.     someClusterName = "someClusterName";\n88.     defaultClusterName = ConfigConsts.CLUSTER_NAME_DEFAULT;\n89.     defaultNamespaceName = ConfigConsts.NAMESPACE_APPLICATION;\n90.     somePublicNamespaceName = "somePublicNamespace";\n91.     someDataCenter = "someDC";\n92.     someClientIp = "someClientIp";\n93.     someClientLabel = "someClientLabel";\n94.     String someValidConfiguration = "{\\"apollo.bar\\": \\"foo\\"}";\n95.     String somePublicConfiguration = "{\\"apollo.public.bar\\": \\"foo\\"}";\n96. \n97.     when(someRelease.getAppId()).thenReturn(someAppId);\n98.     when(someRelease.getClusterName()).thenReturn(someClusterName);\n99.     when(someRelease.getConfigurations()).thenReturn(someValidConfiguration);\n100.     when(somePublicRelease.getConfigurations()).thenReturn(somePublicConfiguration);\n101.     when(namespaceUtil.filterNamespaceName(defaultNamespaceName)).thenReturn(defaultNamespaceName);\n102.     when(namespaceUtil.filterNamespaceName(somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n103.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);\n104.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n105. \n106.     someMessagesAsString = "someValidJson";\n107.     when(configController.transformMessages(someMessagesAsString)).thenReturn(someNotificationMessages);\n108.   }', start_line_number=80, end_line_number=108), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', content='110.   @Test\n111.   public void testQueryConfig() throws Exception {\n112.     String someClientSideReleaseKey = "1";\n113.     String someServerSideNewReleaseKey = "2";\n114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n115. \n116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,\n117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);\n119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);\n120. \n121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,\n122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,\n123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n124. \n125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,\n126.         defaultNamespaceName, someDataCenter, someNotificationMessages);\n127.     assertEquals(someAppId, result.getAppId());\n128.     assertEquals(someClusterName, result.getCluster());\n129.     assertEquals(defaultNamespaceName, result.getNamespaceName());\n130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());\n131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);\n133.   }', start_line_number=110, end_line_number=133), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', content='221.   @Test\n222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {\n223.     String someClientSideReleaseKey = "1";\n224.     String someServerSideReleaseKey = "2";\n225.     String someAppOwnNamespaceName = "someAppOwn";\n226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n227.     AppNamespace someAppOwnNamespace =\n228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);\n229. \n230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,\n231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))\n233.         .thenReturn(someAppOwnNamespace);\n234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);\n236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);\n237. \n238.     ApolloConfig result =\n239.         configController\n240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,\n241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n242. \n243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n244.     assertEquals(someAppId, result.getAppId());\n245.     assertEquals(someClusterName, result.getCluster());\n246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());\n247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));\n248.   }', start_line_number=221, end_line_number=248), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', content='250.   @Test\n251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {\n252.     String someClientSideReleaseKey = "1";\n253.     String someServerSideReleaseKey = "2";\n254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n255.     String somePublicAppId = "somePublicAppId";\n256.     String somePublicClusterName = "somePublicClusterName";\n257.     AppNamespace somePublicAppNamespace =\n258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n259. \n260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,\n261.         someDataCenter, someNotificationMessages)).thenReturn(null);\n262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n263.         .thenReturn(somePublicAppNamespace);\n264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);\n268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);\n269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);\n270. \n271.     ApolloConfig result = configController\n272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,\n273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n274. \n275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n276.     assertEquals(someAppId, result.getAppId());\n277.     assertEquals(someClusterName, result.getCluster());\n278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());\n279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));\n280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);\n282.   }', start_line_number=250, end_line_number=282), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', content='416.   @Test\n417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {\n418.     String someClientSideReleaseKey = "1";\n419.     String someServerSideReleaseKey = "2";\n420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n421.     String somePublicAppId = "somePublicAppId";\n422.     AppNamespace somePublicAppNamespace =\n423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;\n425. \n426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n427.         .thenReturn(somePublicAppNamespace);\n428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n432. \n433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,\n434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,\n435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n436. \n437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,\n438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);\n439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n440.     assertEquals(appId, result.getAppId());\n441.     assertEquals(someClusterName, result.getCluster());\n442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());\n443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));\n444.   }', start_line_number=416, end_line_number=444), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', content='470.   private AppNamespace assemblePublicAppNamespace(String appId, String namespace) {\n471.     return assembleAppNamespace(appId, namespace, true);\n472.   }\n473. \n474.   private AppNamespace assembleAppNamespace(String appId, String namespace, boolean isPublic) {\n475.     AppNamespace appNamespace = new AppNamespace();\n476.     appNamespace.setAppId(appId);\n477.     appNamespace.setName(namespace);\n478.     appNamespace.setPublic(isPublic);\n479.     return appNamespace;\n480.   }', start_line_number=470, end_line_number=480), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', content='19. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\n21. import org.junit.Before;\n22. import org.junit.Test;\n23. import org.junit.runner.RunWith;\n24. import org.mockito.Mock;\n25. import org.mockito.junit.MockitoJUnitRunner;\n26. \n27. import static org.junit.Assert.assertEquals;\n28. import static org.mockito.Mockito.*;\n29. ', start_line_number=19, end_line_number=29), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', content='33. @RunWith(MockitoJUnitRunner.class)\n34. public class NamespaceUtilTest {\n35.   private NamespaceUtil namespaceUtil;\n36. \n37.   @Mock\n38.   private AppNamespaceServiceWithCache appNamespaceServiceWithCache;\n39. ', start_line_number=33, end_line_number=39), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', content='40.   @Before\n41.   public void setUp() throws Exception {\n42.     namespaceUtil = new NamespaceUtil(appNamespaceServiceWithCache);\n43.   }', start_line_number=40, end_line_number=43), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', content='80.   @Test\n81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {\n82.     String someAppId = "someAppId";\n83.     String someNamespaceName = "someNamespaceName";\n84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";\n85.     AppNamespace someAppNamespace = mock(AppNamespace.class);\n86. \n87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);\n88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn\n89.         (someAppNamespace);\n90. \n91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));\n92. \n93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);\n94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);\n95.   }\n96. ', start_line_number=80, end_line_number=96), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', content='97.   @Test\n98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {\n99.     String someAppId = "someAppId";\n100.     String someNamespaceName = "someNamespaceName";\n101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";\n102.     AppNamespace someAppNamespace = mock(AppNamespace.class);\n103. \n104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);\n105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);\n106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);\n107. \n108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));\n109. \n110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);\n111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);\n112.   }', start_line_number=97, end_line_number=112), Context(relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', content='19. import com.ctrip.framework.apollo.common.utils.InputValidator;\n20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;\n21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;\n22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;\n23. import org.junit.Assert;\n24. import org.junit.Test;\n25. import org.springframework.beans.factory.annotation.Autowired;\n26. import org.springframework.test.context.ActiveProfiles;\n27. import org.springframework.web.client.HttpClientErrorException;\n28. import static org.hamcrest.Matchers.containsString;\n29. ', start_line_number=19, end_line_number=29), Context(relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', content='35. @ActiveProfiles("skipAuthorization")\n36. public class NamespaceControllerTest extends AbstractControllerTest {\n37.   @Autowired\n38.   private ConsumerPermissionValidator consumerPermissionValidator;\n39. ', start_line_number=35, end_line_number=39), Context(relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', content='40.   @Test\n41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {\n42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));\n43. \n44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();\n45.     dto.setAppId("appId");\n46.     dto.setName("invalid name");\n47.     dto.setFormat(ConfigFileFormat.Properties.getValue());\n48.     dto.setDataChangeCreatedBy("apollo");\n49.     try {\n50.       restTemplate.postForEntity(\n51.           url("/openapi/v1/apps/{appId}/appnamespaces"),\n52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()\n53.       );\n54.       Assert.fail("should throw");\n55.     } catch (HttpClientErrorException e) {\n56.       String result = e.getResponseBodyAsString();\n57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));\n58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));\n59.     }\n60.   }\n61. }', start_line_number=40, end_line_number=61), Context(relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java', content='19. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n20. import com.ctrip.framework.apollo.common.exception.BadRequestException;\n21. import com.ctrip.framework.apollo.core.ConfigConsts;\n22. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;\n23. import com.ctrip.framework.apollo.portal.AbstractIntegrationTest;\n24. \n25. import org.junit.Assert;\n26. import org.junit.Test;\n27. import org.springframework.beans.factory.annotation.Autowired;\n28. import org.springframework.test.context.jdbc.Sql;\n29. ', start_line_number=19, end_line_number=29), Context(relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java', content='71. \n72.   @Test\n73.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)\n74.   public void testCreateDefaultAppNamespace() {\n75.     appNamespaceService.createDefaultAppNamespace(APP);\n76. \n77.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(APP, ConfigConsts.NAMESPACE_APPLICATION);\n78. \n79.     Assert.assertNotNull(appNamespace);\n80.     Assert.assertEquals(ConfigFileFormat.Properties.getValue(), appNamespace.getFormat());\n81. \n82.   }', start_line_number=71, end_line_number=82), Context(relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', content='19. import com.ctrip.framework.apollo.common.dto.ClusterDTO;\n20. import com.ctrip.framework.apollo.common.dto.ItemDTO;\n21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;\n22. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;\n23. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;\n25. import com.ctrip.framework.apollo.portal.component.PortalSettings;\n26. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;\n27. import com.ctrip.framework.apollo.portal.environment.Env;\n28. import com.ctrip.framework.apollo.portal.AbstractUnitTest;\n29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;\n30. import com.ctrip.framework.apollo.portal.component.txtresolver.PropertyResolver;\n31. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;\n32. import com.ctrip.framework.apollo.portal.entity.bo.UserInfo;\n33. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;\n34. \n35. import org.assertj.core.util.Lists;\n36. import org.junit.Before;\n37. import org.junit.Test;\n38. import org.mockito.InjectMocks;\n39. import org.mockito.Mock;\n40. \n41. import java.util.Arrays;\n42. import java.util.Collections;\n43. import java.util.List;\n44. \n45. import static org.assertj.core.api.AssertionsForClassTypes.assertThat;\n46. import static org.assertj.core.api.AssertionsForClassTypes.assertThatExceptionOfType;\n47. import static org.junit.Assert.assertEquals;\n48. import static org.mockito.Mockito.mock;\n49. import static org.mockito.Mockito.times;\n50. import static org.mockito.Mockito.verify;\n51. import static org.mockito.Mockito.when;\n52. ', start_line_number=19, end_line_number=52), Context(relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', content='90.   @Test\n91.   public void testFindNamespace() {\n92. \n93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);\n94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);\n95. \n96.     NamespaceDTO application = new NamespaceDTO();\n97.     application.setId(1);\n98.     application.setClusterName(testClusterName);\n99.     application.setAppId(testAppId);\n100.     application.setNamespaceName(testNamespaceName);\n101. \n102.     NamespaceDTO hermes = new NamespaceDTO();\n103.     hermes.setId(2);\n104.     hermes.setClusterName("default");\n105.     hermes.setAppId(testAppId);\n106.     hermes.setNamespaceName("hermes");\n107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);\n108. \n109.     ReleaseDTO someRelease = new ReleaseDTO();\n110.     someRelease.setConfigurations("{\\"a\\":\\"123\\",\\"b\\":\\"123\\"}");\n111. \n112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);\n113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);\n114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);\n115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);\n116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);\n117. \n118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());\n119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());\n120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))\n121.         .thenReturn(applicationAppNamespace);\n122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);\n123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);\n124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,\n125.                                           testNamespaceName)).thenReturn(someRelease);\n126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);\n127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);\n128. \n129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);\n130.     assertEquals(2, namespaceVOs.size());\n131. \n132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));\n133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);\n134.     assertEquals(1, namespaceVOs.size());\n135.     NamespaceBO namespaceVO = namespaceVOs.get(0);\n136.     assertEquals(4, namespaceVO.getItems().size());\n137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());\n138.     assertEquals(2, namespaceVO.getItemModifiedCnt());\n139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());\n140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());\n141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());\n142. \n143.     ReleaseDTO errorRelease = new ReleaseDTO();\n144.     errorRelease.setConfigurations("\\"a\\":\\"123\\",\\"b\\":\\"123\\"");\n145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);\n146.     assertThatExceptionOfType(RuntimeException.class)\n147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))\n148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");\n149. \n150.   }', start_line_number=90, end_line_number=150), Context(relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', content='200.   @Test\n201.   public void testDeleteEmptyNamespace() {\n202.     String branchName = "branch";\n203.     String operator = "user";\n204. \n205.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);\n206.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);\n207. \n208.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);\n209.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))\n210.         .thenReturn(0);\n211.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);\n212.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(0);\n213.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);\n214. \n215.     NamespaceDTO namespace = createNamespace(testAppId, testClusterName, testNamespaceName);\n216.     when(namespaceAPI.getPublicAppNamespaceAllNamespaces(testEnv, testNamespaceName, 0, 10)).thenReturn(\n217.         Collections.singletonList(namespace));\n218.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));\n219. \n220.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);\n221. \n222.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);\n223. \n224.   }', start_line_number=200, end_line_number=224)]
2025-11-12 11:28:58,318 - thread-135845287823040.prometheus.lang_graph.nodes.bug_get_regression_tests_selection_node - DEBUG - Model response: selected_tests=[RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: The crash occurs when querying a namespace with a single dot; this path goes through ConfigController.queryConfig which filters and normalizes the namespace name before loading configs. This test directly exercises the core queryConfig flow and verifies interactions with NamespaceUtil and ConfigService.\n2. Impact likelihood: Any fix to handle a single-dot namespace (e.g., filter/normalize behavior) could change parameters passed to loadConfig and the resulting ApolloConfig fields, making this test likely to catch regressions.\n3. Not skipped: This is a standard Mockito-based unit test and runs in normal test runs.', test_identifier='com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfig'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: Single-dot namespaces may be app-owned (private) namespaces. This test covers the queryConfig path for an app-owned namespace, using NamespaceUtil.filterNamespaceName/normalizeNamespace.\n2. Impact likelihood: Adjusting normalization/filtering logic to support "." could alter how app-owned namespaces are resolved and audited, making this test sensitive to such changes.\n3. Not skipped: Regular unit test without skip annotations.', test_identifier='com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithAppOwnNamespace'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: The bug surfaces during querying. This test covers the public-namespace fallback path when there is no app override, which also depends on namespace name normalization. Handling a single dot must not break this logic.\n2. Impact likelihood: Changes to handling of namespaces with dots could affect whether the controller falls back correctly to the public app’s release and audits appropriately.\n3. Not skipped: Runs as part of normal unit tests.', test_identifier='com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithPubicNamespaceAndNoAppOverride'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: The crash is likely related to how the namespace name "." is normalized. This test verifies normalizeNamespace behavior when a private namespace exists.\n2. Impact likelihood: Any code change to support or specially-handle a single-dot namespace will directly affect normalization behavior; this test ensures private-namespace normalization remains correct.\n3. Not skipped: Standard unit test using Mockito, executed in normal runs.', test_identifier='com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPrivateNamespace'), RegressionTestStructuredOutPut(reasoning='1. Relevance to issue: Also targets namespace normalization, but for the public namespace case when no private namespace is found, which is integral to query routing in ConfigController.\n2. Impact likelihood: Supporting a single-dot namespace may change how public namespaces are looked up and normalized; this test will catch regressions in that logic.\n3. Not skipped: Regular unit test with no skip markers.', test_identifier='com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPublicNamespace')]
2025-11-12 11:28:58,318 - thread-135845287823040.prometheus.lang_graph.nodes.bug_get_regression_tests_selection_node - DEBUG - 5 tests selected as regression tests
2025-11-12 11:28:58,319 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - INFO - Enter run_regression_tests_subgraph_node
2025-11-12 11:28:58,319 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - DEBUG - selected_regression_tests: ['com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfig', 'com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithAppOwnNamespace', 'com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithPubicNamespaceAndNoAppOverride', 'com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPrivateNamespace', 'com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPublicNamespace']
2025-11-12 11:29:02,277 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Yeu3QSfrKbyrtYNJVR0AuwTn', 'function': {'arguments': '{"command":"ls -la"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 410, 'prompt_tokens': 652, 'total_tokens': 1062, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--de37612d-1607-4d48-b809-4fee1b44924c-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la'}, 'id': 'call_Yeu3QSfrKbyrtYNJVR0AuwTn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 652, 'output_tokens': 410, 'total_tokens': 1062, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 11:29:02,280 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la
2025-11-12 11:29:02,384 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:29:02,384 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 260
drwxr-xr-x 1 root root  4096 Aug 24 21:16 .
drwxr-xr-x 1 root root  4096 Nov 12 11:21 ..
-rw-r--r-- 1 root root 24089 Aug 24 21:16 .flattened-pom.xml
drwxrwxr-x 7 root root  4096 Aug 24 21:16 .git
-rw-rw-r-- 1 root root    27 Aug 24 21:16 .gitattributes
drwxrwxr-x 4 root root  4096 Aug 24 21:16 .github
-rw-rw-r-- 1 root root   317 Aug 24 21:16 .gitignore
-rw-rw-r-- 1 root root  1490 Aug 24 21:16 .licenserc.yaml
drwxrwxr-x 1 root root  4096 Aug 24 21:16 .mvn
-rw-rw-r-- 1 root root  3126 Aug 24 21:16 CHANGES.md
-rw-rw-r-- 1 root root  3227 Aug 24 21:16 CODE_OF_CONDUCT.md
-rw-rw-r-- 1 root root  2332 Aug 24 21:16 CONTRIBUTING.md
-rw-rw-r-- 1 root root   576 Aug 24 21:16 Dockerfile
-rw-rw-r-- 1 root root  6024 Aug 24 21:16 GOVERNANCE.md
-rw-rw-r-- 1 root root 11357 Aug 24 21:16 LICENSE
-rw-rw-r-- 1 root root 49958 Aug 24 21:16 README.md
-rw-rw-r-- 1 root root   598 Aug 24 21:16 SECURITY.md
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-adminservice
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-assembly
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-biz
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-buildtools
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-client
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-client-config-data
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-common
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-configservice
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-core
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-mockserver
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-openapi
drwxrwxr-x 1 root root  4096 Aug 24 21:16 apollo-portal
drwxrwxr-x 2 root root  4096 Aug 24 21:16 changes
drwxrwxr-x 3 root root  4096 Aug 24 21:16 doc
drwxrwxr-x 7 root root  4096 Aug 24 21:16 docs
-rwxrwxr-x 1 root root  9113 Aug 24 21:16 mvnw
-rwxrwxr-x 1 root root  5810 Aug 24 21:16 mvnw.cmd
-rw-rw-r-- 1 root root 22960 Aug 24 21:16 pom.xml
drwxrwxr-x 4 root root  4096 Aug 24 21:16 scripts
drwxr-xr-x 3 root root  4096 Aug 24 21:16 target
[?2004l
2025-11-12 11:29:11,894 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_tldHjI0tX9wouEnXAyCJB9Gj', 'function': {'arguments': '{"command":"./mvnw -v"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 605, 'prompt_tokens': 1610, 'total_tokens': 2215, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--07ddd14f-50ca-4d64-bcf0-8a46adbdffec-0' tool_calls=[{'name': 'run_command', 'args': {'command': './mvnw -v'}, 'id': 'call_tldHjI0tX9wouEnXAyCJB9Gj', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1610, 'output_tokens': 605, 'total_tokens': 2215, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 11:29:11,897 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ./mvnw -v
2025-11-12 11:29:11,999 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 11:29:11,999 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
./mvnw: line 121: which: command not found
./mvnw: line 149: which: command not found
Error: JAVA_HOME is not defined correctly.
  We cannot execute 
[?2004l
2025-11-12 11:29:16,753 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_O2VU2hyYAMPRLK4XL7a9pc03', 'function': {'arguments': '{"command":"grep -R \\"maven.compiler.source\\" -n pom.xml apollo-configservice/pom.xml | cat"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 173, 'prompt_tokens': 1700, 'total_tokens': 1873, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6a85cef6-9815-4daa-8665-b91e87cb7fec-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'grep -R "maven.compiler.source" -n pom.xml apollo-configservice/pom.xml | cat'}, 'id': 'call_O2VU2hyYAMPRLK4XL7a9pc03', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1700, 'output_tokens': 173, 'total_tokens': 1873, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 11:29:16,757 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: grep -R "maven.compiler.source" -n pom.xml apollo-configservice/pom.xml | cat
2025-11-12 11:29:16,858 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:29:16,858 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 grep -R "maven.compiler.source" -n pom.xml apollo-configservice/pom.xml
l | cat
[?2004l
[?2004l
2025-11-12 11:29:19,818 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4D65PQvcN7KatBe4dYqcoboO', 'function': {'arguments': '{"command":"apt-get update"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 154, 'prompt_tokens': 1787, 'total_tokens': 1941, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--984d1720-37c4-4d19-8037-e51b9d172b60-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'apt-get update'}, 'id': 'call_4D65PQvcN7KatBe4dYqcoboO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1787, 'output_tokens': 154, 'total_tokens': 1941, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 11:29:19,822 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: apt-get update
2025-11-12 11:29:19,924 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 127
2025-11-12 11:29:19,924 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
bash: apt-get: command not found
[?2004l
2025-11-12 11:29:22,574 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_QjIQw5500NSBEhXVAfmVdo9v', 'function': {'arguments': '{"command":"java -version"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 90, 'prompt_tokens': 1839, 'total_tokens': 1929, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e14b7b1a-efe6-49b3-ae57-c744dc2118c5-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'java -version'}, 'id': 'call_QjIQw5500NSBEhXVAfmVdo9v', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1839, 'output_tokens': 90, 'total_tokens': 1929, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 11:29:22,577 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: java -version
2025-11-12 11:29:22,698 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:29:22,698 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
openjdk version "1.8.0_462"
OpenJDK Runtime Environment Corretto-8.462.08.1 (build 1.8.0_462-b08)
OpenJDK 64-Bit Server VM Corretto-8.462.08.1 (build 25.462-b08, mixed mode)
[?2004l
2025-11-12 11:29:25,399 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zsOSeDY1Q0rVkiOntNGdZIM9', 'function': {'arguments': '{"command":"mvn -v"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 155, 'prompt_tokens': 1953, 'total_tokens': 2108, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d4ab15d6-5108-481b-8801-12b3a7018426-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'mvn -v'}, 'id': 'call_zsOSeDY1Q0rVkiOntNGdZIM9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1953, 'output_tokens': 155, 'total_tokens': 2108, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 11:29:25,402 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: mvn -v
2025-11-12 11:29:25,736 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:29:25,736 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
[1mApache Maven 3.9.11 (3e54c93a704957b63ee3494413a2b544fd3d825b)[m
Maven home: /usr/local/apache-maven-3.9.11
Java version: 1.8.0_462, vendor: Amazon.com Inc., runtime: /usr/lib/jvm/java-1.8.0-amazon-corretto.x86_64/jre
Default locale: en_US, platform encoding: ANSI_X3.4-1968
OS name: "linux", version: "6.8.0-36-generic", arch: "amd64", family: "unix"
[?2004l
2025-11-12 11:29:31,090 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_dNBzAQeU8NBo8vqb4BkkbMFQ', 'function': {'arguments': '{"command":"mvn -pl apollo-configservice -am -Dtest=com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#testQueryConfig,com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#testQueryConfigWithAppOwnNamespace,com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#testQueryConfigWithPubicNamespaceAndNoAppOverride,com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest#testNormalizeNamespaceWithPrivateNamespace,com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest#testNormalizeNamespaceWithPublicNamespace test -DfailIfNoTests=false"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 471, 'prompt_tokens': 2146, 'total_tokens': 2617, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--99be428c-1907-45c8-945a-8e0472245948-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'mvn -pl apollo-configservice -am -Dtest=com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#testQueryConfig,com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#testQueryConfigWithAppOwnNamespace,com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#testQueryConfigWithPubicNamespaceAndNoAppOverride,com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest#testNormalizeNamespaceWithPrivateNamespace,com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest#testNormalizeNamespaceWithPublicNamespace test -DfailIfNoTests=false'}, 'id': 'call_dNBzAQeU8NBo8vqb4BkkbMFQ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2146, 'output_tokens': 471, 'total_tokens': 2617, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 11:29:31,094 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: mvn -pl apollo-configservice -am -Dtest=com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#testQueryConfig,com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#testQueryConfigWithAppOwnNamespace,com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#testQueryConfigWithPubicNamespaceAndNoAppOverride,com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest#testNormalizeNamespaceWithPrivateNamespace,com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest#testNormalizeNamespaceWithPublicNamespace test -DfailIfNoTests=false
2025-11-12 11:29:40,928 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:29:40,928 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 mvn -pl apollo-configservice -am -Dtest=com.ctrip.framework.apollo.conf
figservice.controller.ConfigControllerTest#testQueryConfig,com.ctrip.framework.ap
pollo.configservice.controller.ConfigControllerTest#testQueryConfigWithAppOwnName
espace,com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#t
testQueryConfigWithPubicNamespaceAndNoAppOverride,com.ctrip.framework.apollo.conf
figservice.util.NamespaceUtilTest#testNormalizeNamespaceWithPrivateNamespace,com.
.ctrip.framework.apollo.configservice.util.NamespaceUtilTest#testNormalizeNamespa
aceWithPublicNamespace test -DfailIfNoTests=false
[?2004l
[[1;34mINFO[m] Scanning for projects...
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] [1mReactor Build Order:[m
[[1;34mINFO[m] 
[[1;34mINFO[m] Apollo                                                             [pom]
[[1;34mINFO[m] Apollo Core                                                        [jar]
[[1;34mINFO[m] Apollo Common                                                      [jar]
[[1;34mINFO[m] Apollo Biz                                                         [jar]
[[1;34mINFO[m] Apollo ConfigService                                               [jar]
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m-----------------< [0;36mcom.ctrip.framework.apollo:apollo[0;1m >------------------[m
[[1;34mINFO[m] [1mBuilding Apollo 2.1.0-SNAPSHOT                                     [1/5][m
[[1;34mINFO[m]   from pom.xml
[[1;34mINFO[m] [1m--------------------------------[ pom ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mgit-commit-id:2.2.6:revision[m [1m(default)[m @ [36mapollo[0;1m ---[m
[[1;34mINFO[m] isPomProject is true and skipPoms is true, return
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mflatten:1.1.0:flatten[m [1m(flatten)[m @ [36mapollo[0;1m ---[m
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo:pom:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m---------------< [0;36mcom.ctrip.framework.apollo:apollo-core[0;1m >---------------[m
[[1;34mINFO[m] [1mBuilding Apollo Core 2.1.0-SNAPSHOT                                [2/5][m
[[1;34mINFO[m]   from apollo-core/pom.xml
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.pom
Progress (1): 765 B
Progress (1): 1.8 kB
Progress (1): 3.8 kB
Progress (1): 6.9 kB
Progress (1): 8.2 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.pom[90m (8.2 kB at 33 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-plugins/39/maven-plugins-39.pom
Progress (1): 770 B
Progress (1): 2.3 kB
Progress (1): 4.0 kB
Progress (1): 6.5 kB
Progress (1): 8.1 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-plugins/39/maven-plugins-39.pom[90m (8.1 kB at 270 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/maven-parent/39/maven-parent-39.pom
Progress (1): 720 B
Progress (1): 1.9 kB
Progress (1): 3.9 kB
Progress (1): 8.5 kB
Progress (1): 13 kB 
Progress (1): 16 kB
Progress (1): 21 kB
Progress (1): 25 kB
Progress (1): 27 kB
Progress (1): 28 kB
Progress (1): 31 kB
Progress (1): 33 kB
Progress (1): 36 kB
Progress (1): 40 kB
Progress (1): 41 kB
Progress (1): 46 kB
Progress (1): 48 kB
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/maven-parent/39/maven-parent-39.pom[90m (48 kB at 1.3 MB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/apache/29/apache-29.pom
Progress (1): 744 B
Progress (1): 2.1 kB
Progress (1): 3.3 kB
Progress (1): 5.2 kB
Progress (1): 10 kB 
Progress (1): 14 kB
Progress (1): 17 kB
Progress (1): 20 kB
Progress (1): 21 kB
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/apache/29/apache-29.pom[90m (21 kB at 740 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.jar
Progress (1): 0.9/31 kB
Progress (1): 2.3/31 kB
Progress (1): 3.6/31 kB
Progress (1): 5.0/31 kB
Progress (1): 6.4/31 kB
Progress (1): 7.7/31 kB
Progress (1): 9.1/31 kB
Progress (1): 10/31 kB 
Progress (1): 12/31 kB
Progress (1): 13/31 kB
Progress (1): 15/31 kB
Progress (1): 16/31 kB
Progress (1): 17/31 kB
Progress (1): 19/31 kB
Progress (1): 20/31 kB
Progress (1): 21/31 kB
Progress (1): 23/31 kB
Progress (1): 24/31 kB
Progress (1): 25/31 kB
Progress (1): 26/31 kB
Progress (1): 27/31 kB
Progress (1): 31 kB   
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.jar[90m (31 kB at 737 kB/s)[0m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mgit-commit-id:2.2.6:revision[m [1m(default)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] dotGitDirectory /testbed/.git
[[1;34mINFO[m] git.build.user.name 
[[1;34mINFO[m] git.build.user.email 
[[1;34mINFO[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] --always = true
[[1;34mINFO[m] --dirty = -dirty
[[1;34mINFO[m] --abbrev = 7
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] git.commit.id.describe 526a935
[[1;34mINFO[m] git.commit.id 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] git.commit.id.abbrev 526a935
[[1;34mINFO[m] git.dirty false
[[1;34mINFO[m] git.commit.user.name kl
[[1;34mINFO[m] git.commit.user.email chenkailing@xd.com
[[1;34mINFO[m] git.commit.message.full Fix Apollo checks the yaml format interface Response Code = 500  (#4567)

* fix(apollo-portal): Fix Apollo checks the yaml format interface Response Code = 500 #4566



* fix(apollo-portal): Fix yamlSyntaxCheck test cases



Co-authored-by: Jason Song <nobodyiam@gmail.com>
[[1;34mINFO[m] git.commit.message.short Fix Apollo checks the yaml format interface Response Code = 500  (#4567)
[[1;34mINFO[m] git.commit.time 2022-09-16T00:17:54+0000
[[1;34mINFO[m] git.remote.origin.url https://github.com/apolloconfig/apollo.git
[[1;34mINFO[m] git.tags tag-oidc-debug-log,tag-oidc-debug-log-2,v2.1.0,v2.2.0,v2.3.0,v2.4.0
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.name 
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.commit.count 
[[1;34mINFO[m] git.total.commit.count 2746
[[1;34mINFO[m] git.build.time 2025-11-12T11:29:35+0000
[[1;34mINFO[m] git.build.version 2.1.0-SNAPSHOT
[[1;34mINFO[m] git.build.host ucl-research
[[1;34mINFO[m] git.commit.id.describe-short 526a935
[[1;34mINFO[m] found property git.build.user.email
[[1;34mINFO[m] found property git.build.host
[[1;34mINFO[m] found property git.dirty
[[1;34mINFO[m] found property git.remote.origin.url
[[1;34mINFO[m] found property git.closest.tag.name
[[1;34mINFO[m] found property git.total.commit.count
[[1;34mINFO[m] found property git.commit.id.describe-short
[[1;34mINFO[m] found property git.commit.user.email
[[1;34mINFO[m] found property git.commit.time
[[1;34mINFO[m] found property git.commit.message.full
[[1;34mINFO[m] found property git.build.version
[[1;34mINFO[m] found property git.commit.message.short
[[1;34mINFO[m] found property git.commit.id.abbrev
[[1;34mINFO[m] found property git.branch
[[1;34mINFO[m] found property git.build.user.name
[[1;34mINFO[m] found property git.closest.tag.commit.count
[[1;34mINFO[m] found property git.commit.id.describe
[[1;34mINFO[m] found property git.commit.id
[[1;34mINFO[m] found property git.tags
[[1;34mINFO[m] found property git.build.time
[[1;34mINFO[m] found property git.commit.user.name
[[1;34mINFO[m] Reading existing properties file [/testbed/apollo-core/target/classes/apollo-git.properties] (for module Apollo Core)...
[[1;34mINFO[m] Writing properties file to [/testbed/apollo-core/target/classes/apollo-git.properties] (for module Apollo Core)...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:resources[m [1m(default-resources)[m @ [36mapollo-core[0;1m ---[m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.pom
Progress (1): 714 B
Progress (1): 2.4 kB
Progress (1): 4.4 kB
Progress (1): 8.6 kB
Progress (1): 8.8 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.pom[90m (8.8 kB at 365 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus/10/plexus-10.pom
Progress (1): 695 B
Progress (1): 2.7 kB
Progress (1): 6.4 kB
Progress (1): 9.2 kB
Progress (1): 11 kB 
Progress (1): 16 kB
Progress (1): 20 kB
Progress (1): 24 kB
Progress (1): 25 kB
Progress (1): 25 kB
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus/10/plexus-10.pom[90m (25 kB at 1.1 MB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.pom
Progress (1): 778 B
Progress (1): 2.2 kB
Progress (1): 5.6 kB
Progress (1): 6.0 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.pom[90m (6.0 kB at 274 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-shared-components/39/maven-shared-components-39.pom
Progress (1): 801 B
Progress (1): 2.2 kB
Progress (1): 3.2 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-shared-components/39/maven-shared-components-39.pom[90m (3.2 kB at 146 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.pom
Progress (1): 1.0 kB
Progress (1): 2.7 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.pom[90m (2.7 kB at 69 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.pom
Progress (1): 895 B
Progress (1): 3.2 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.pom[90m (3.2 kB at 134 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/spice/spice-parent/15/spice-parent-15.pom
Progress (1): 1.2 kB
Progress (1): 3.7 kB
Progress (1): 7.3 kB
Progress (1): 8.4 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/spice/spice-parent/15/spice-parent-15.pom[90m (8.4 kB at 334 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.0/plexus-utils-3.5.0.pom
Progress (1): 714 B
Progress (1): 2.3 kB
Progress (1): 4.5 kB
Progress (1): 8.0 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.0/plexus-utils-3.5.0.pom[90m (8.0 kB at 154 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.pom
Progress (1): 770 B
Progress (1): 2.1 kB
Progress (1): 5.2 kB
Progress (1): 7.8 kB
Progress (1): 10 kB 
Progress (1): 12 kB
Progress (1): 15 kB
Progress (1): 18 kB
Progress (1): 19 kB
Progress (1): 20 kB
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.pom[90m (20 kB at 759 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/junit/junit-bom/5.7.2/junit-bom-5.7.2.pom
Progress (1): 912 B
Progress (1): 4.3 kB
Progress (1): 5.1 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/junit/junit-bom/5.7.2/junit-bom-5.7.2.pom[90m (5.1 kB at 204 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.jar
Progress (1): 3.8/269 kB
Progress (1): 8.0/269 kB
Progress (1): 8.2/269 kB
Progress (1): 12/269 kB 
Progress (1): 17/269 kB
Progress (1): 21/269 kB
Progress (1): 25/269 kB
Progress (1): 29/269 kB
Progress (1): 34/269 kB
Progress (1): 38/269 kB
Progress (1): 42/269 kB
Progress (1): 58/269 kB
Progress (1): 75/269 kB
Progress (1): 91/269 kB
Progress (1): 108/269 kB
Progress (1): 124/269 kB
Progress (1): 139/269 kB
Progress (1): 147/269 kB
Progress (1): 164/269 kB
Progress (1): 180/269 kB
Progress (1): 197/269 kB
Progress (1): 213/269 kB
Progress (1): 221/269 kB
Progress (1): 237/269 kB
Progress (1): 253/269 kB
Progress (1): 269 kB    
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.jar[90m (269 kB at 4.2 MB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.jar
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.jar
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.jar
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.jar
Progress (1): 7.7/55 kB
Progress (1): 8.2/55 kB
Progress (1): 25/55 kB 
Progress (1): 41/55 kB
Progress (1): 55 kB   
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.jar[90m (55 kB at 1.8 MB/s)[0m
Progress (1): 0.9/8.5 kB
Progress (1): 2.3/8.5 kB
Progress (1): 3.6/8.5 kB
Progress (1): 5.0/8.5 kB
Progress (1): 6.4/8.5 kB
Progress (1): 7.7/8.5 kB
Progress (1): 8.2/8.5 kB
Progress (1): 8.5 kB    
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.jar[90m (8.5 kB at 154 kB/s)[0m
Progress (1): 0.9/41 kB
Progress (1): 2.3/41 kB
Progress (1): 3.6/41 kB
Progress (1): 5.0/41 kB
Progress (1): 6.4/41 kB
Progress (1): 7.7/41 kB
Progress (1): 9.1/41 kB
Progress (1): 10/41 kB 
Progress (1): 12/41 kB
Progress (1): 13/41 kB
Progress (1): 15/41 kB
Progress (1): 16/41 kB
Progress (1): 17/41 kB
Progress (1): 19/41 kB
Progress (1): 20/41 kB
Progress (1): 21/41 kB
Progress (1): 23/41 kB
Progress (1): 24/41 kB
Progress (1): 25/41 kB
Progress (1): 26/41 kB
Progress (1): 27/41 kB
Progress (1): 29/41 kB
Progress (1): 30/41 kB
Progress (1): 31/41 kB
Progress (1): 33/41 kB
Progress (1): 34/41 kB
Progress (1): 36/41 kB
Progress (1): 37/41 kB
Progress (1): 38/41 kB
Progress (1): 40/41 kB
Progress (1): 41/41 kB
Progress (1): 41 kB   
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.jar[90m (41 kB at 556 kB/s)[0m
Progress (1): 0.9/327 kB
Progress (1): 2.3/327 kB
Progress (1): 3.6/327 kB
Progress (1): 5.0/327 kB
Progress (1): 6.4/327 kB
Progress (1): 7.7/327 kB
Progress (1): 9.1/327 kB
Progress (1): 10/327 kB 
Progress (1): 12/327 kB
Progress (1): 13/327 kB
Progress (1): 15/327 kB
Progress (1): 16/327 kB
Progress (1): 17/327 kB
Progress (1): 19/327 kB
Progress (1): 20/327 kB
Progress (1): 21/327 kB
Progress (1): 23/327 kB
Progress (1): 24/327 kB
Progress (1): 26/327 kB
Progress (1): 27/327 kB
Progress (1): 28/327 kB
Progress (1): 30/327 kB
Progress (1): 31/327 kB
Progress (1): 32/327 kB
Progress (1): 34/327 kB
Progress (1): 35/327 kB
Progress (1): 36/327 kB
Progress (1): 38/327 kB
Progress (1): 39/327 kB
Progress (1): 41/327 kB
Progress (1): 42/327 kB
Progress (1): 43/327 kB
Progress (1): 45/327 kB
Progress (1): 46/327 kB
Progress (1): 47/327 kB
Progress (1): 49/327 kB
Progress (1): 50/327 kB
Progress (1): 52/327 kB
Progress (1): 53/327 kB
Progress (1): 54/327 kB
Progress (1): 56/327 kB
Progress (1): 57/327 kB
Progress (1): 62/327 kB
Progress (1): 66/327 kB
Progress (1): 70/327 kB
Progress (1): 74/327 kB
Progress (1): 78/327 kB
Progress (1): 83/327 kB
Progress (1): 87/327 kB
Progress (1): 91/327 kB
Progress (1): 95/327 kB
Progress (1): 100/327 kB
Progress (1): 104/327 kB
Progress (1): 108/327 kB
Progress (1): 112/327 kB
Progress (1): 117/327 kB
Progress (1): 121/327 kB
Progress (1): 125/327 kB
Progress (1): 129/327 kB
Progress (1): 133/327 kB
Progress (1): 138/327 kB
Progress (1): 142/327 kB
Progress (1): 146/327 kB
Progress (1): 150/327 kB
Progress (1): 155/327 kB
Progress (1): 159/327 kB
Progress (1): 163/327 kB
Progress (1): 167/327 kB
Progress (1): 172/327 kB
Progress (1): 176/327 kB
Progress (1): 180/327 kB
Progress (1): 184/327 kB
Progress (1): 188/327 kB
Progress (1): 193/327 kB
Progress (1): 197/327 kB
Progress (1): 201/327 kB
Progress (1): 205/327 kB
Progress (1): 210/327 kB
Progress (1): 214/327 kB
Progress (1): 218/327 kB
Progress (1): 222/327 kB
Progress (1): 239/327 kB
Progress (1): 255/327 kB
Progress (1): 271/327 kB
Progress (1): 288/327 kB
Progress (1): 304/327 kB
Progress (1): 319/327 kB
Progress (1): 327 kB    
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.jar[90m (327 kB at 2.8 MB/s)[0m
[[1;34mINFO[m] Copying 0 resource from src/main/resources to target/classes
[[1;34mINFO[m] Copying 3 resources from src/main/resources to target/classes
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-core/src/main/config
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-core/src/main/config
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mflatten:1.1.0:flatten[m [1m(flatten)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-core:jar:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:compile[m [1m(default-compile)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:testResources[m [1m(default-testResources)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] Copying 15 resources from src/test/resources to target/test-classes
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:testCompile[m [1m(default-testCompile)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32msurefire:2.22.2:test[m [1m(default-test)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--------------< [0;36mcom.ctrip.framework.apollo:apollo-common[0;1m >--------------[m
[[1;34mINFO[m] [1mBuilding Apollo Common 2.1.0-SNAPSHOT                              [3/5][m
[[1;34mINFO[m]   from apollo-common/pom.xml
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mgit-commit-id:2.2.6:revision[m [1m(default)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] dotGitDirectory /testbed/.git
[[1;34mINFO[m] git.build.user.name 
[[1;34mINFO[m] git.build.user.email 
[[1;34mINFO[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] --always = true
[[1;34mINFO[m] --dirty = -dirty
[[1;34mINFO[m] --abbrev = 7
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] git.commit.id.describe 526a935
[[1;34mINFO[m] git.commit.id 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] git.commit.id.abbrev 526a935
[[1;34mINFO[m] git.dirty false
[[1;34mINFO[m] git.commit.user.name kl
[[1;34mINFO[m] git.commit.user.email chenkailing@xd.com
[[1;34mINFO[m] git.commit.message.full Fix Apollo checks the yaml format interface Response Code = 500  (#4567)

* fix(apollo-portal): Fix Apollo checks the yaml format interface Response Code = 500 #4566



* fix(apollo-portal): Fix yamlSyntaxCheck test cases



Co-authored-by: Jason Song <nobodyiam@gmail.com>
[[1;34mINFO[m] git.commit.message.short Fix Apollo checks the yaml format interface Response Code = 500  (#4567)
[[1;34mINFO[m] git.commit.time 2022-09-16T00:17:54+0000
[[1;34mINFO[m] git.remote.origin.url https://github.com/apolloconfig/apollo.git
[[1;34mINFO[m] git.tags tag-oidc-debug-log,tag-oidc-debug-log-2,v2.1.0,v2.2.0,v2.3.0,v2.4.0
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.name 
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.commit.count 
[[1;34mINFO[m] git.total.commit.count 2746
[[1;34mINFO[m] git.build.time 2025-11-12T11:29:36+0000
[[1;34mINFO[m] git.build.version 2.1.0-SNAPSHOT
[[1;34mINFO[m] git.build.host ucl-research
[[1;34mINFO[m] git.commit.id.describe-short 526a935
[[1;34mINFO[m] found property git.build.user.email
[[1;34mINFO[m] found property git.build.host
[[1;34mINFO[m] found property git.dirty
[[1;34mINFO[m] found property git.remote.origin.url
[[1;34mINFO[m] found property git.closest.tag.name
[[1;34mINFO[m] found property git.total.commit.count
[[1;34mINFO[m] found property git.commit.id.describe-short
[[1;34mINFO[m] found property git.commit.user.email
[[1;34mINFO[m] found property git.commit.time
[[1;34mINFO[m] found property git.commit.message.full
[[1;34mINFO[m] found property git.build.version
[[1;34mINFO[m] found property git.commit.message.short
[[1;34mINFO[m] found property git.commit.id.abbrev
[[1;34mINFO[m] found property git.branch
[[1;34mINFO[m] found property git.build.user.name
[[1;34mINFO[m] found property git.closest.tag.commit.count
[[1;34mINFO[m] found property git.commit.id.describe
[[1;34mINFO[m] found property git.commit.id
[[1;34mINFO[m] found property git.tags
[[1;34mINFO[m] found property git.build.time
[[1;34mINFO[m] found property git.commit.user.name
[[1;34mINFO[m] Reading existing properties file [/testbed/apollo-common/target/classes/apollo-git.properties] (for module Apollo Common)...
[[1;34mINFO[m] Writing properties file to [/testbed/apollo-common/target/classes/apollo-git.properties] (for module Apollo Common)...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:resources[m [1m(default-resources)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] Copying 4 resources from src/main/resources to target/classes
[[1;34mINFO[m] Copying 1 resource from src/main/resources to target/classes
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-common/src/main/config
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-common/src/main/config
[[1;34mINFO[m] The encoding used to copy filtered properties files have not been set. This means that the same encoding will be used to copy filtered properties files as when copying other filtered resources. This might not be what you want! Run your build with --debug to see which files might be affected. Read more at https://maven.apache.org/plugins/maven-resources-plugin/examples/filtering-properties-files.html
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mflatten:1.1.0:flatten[m [1m(flatten)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-common:jar:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:compile[m [1m(default-compile)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:testResources[m [1m(default-testResources)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-common/src/test/resources
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:testCompile[m [1m(default-testCompile)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32msurefire:2.22.2:test[m [1m(default-test)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m---------------< [0;36mcom.ctrip.framework.apollo:apollo-biz[0;1m >----------------[m
[[1;34mINFO[m] [1mBuilding Apollo Biz 2.1.0-SNAPSHOT                                 [4/5][m
[[1;34mINFO[m]   from apollo-biz/pom.xml
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mgit-commit-id:2.2.6:revision[m [1m(default)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] dotGitDirectory /testbed/.git
[[1;34mINFO[m] git.build.user.name 
[[1;34mINFO[m] git.build.user.email 
[[1;34mINFO[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] --always = true
[[1;34mINFO[m] --dirty = -dirty
[[1;34mINFO[m] --abbrev = 7
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] git.commit.id.describe 526a935
[[1;34mINFO[m] git.commit.id 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] git.commit.id.abbrev 526a935
[[1;34mINFO[m] git.dirty false
[[1;34mINFO[m] git.commit.user.name kl
[[1;34mINFO[m] git.commit.user.email chenkailing@xd.com
[[1;34mINFO[m] git.commit.message.full Fix Apollo checks the yaml format interface Response Code = 500  (#4567)

* fix(apollo-portal): Fix Apollo checks the yaml format interface Response Code = 500 #4566



* fix(apollo-portal): Fix yamlSyntaxCheck test cases



Co-authored-by: Jason Song <nobodyiam@gmail.com>
[[1;34mINFO[m] git.commit.message.short Fix Apollo checks the yaml format interface Response Code = 500  (#4567)
[[1;34mINFO[m] git.commit.time 2022-09-16T00:17:54+0000
[[1;34mINFO[m] git.remote.origin.url https://github.com/apolloconfig/apollo.git
[[1;34mINFO[m] git.tags tag-oidc-debug-log,tag-oidc-debug-log-2,v2.1.0,v2.2.0,v2.3.0,v2.4.0
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.name 
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.commit.count 
[[1;34mINFO[m] git.total.commit.count 2746
[[1;34mINFO[m] git.build.time 2025-11-12T11:29:37+0000
[[1;34mINFO[m] git.build.version 2.1.0-SNAPSHOT
[[1;34mINFO[m] git.build.host ucl-research
[[1;34mINFO[m] git.commit.id.describe-short 526a935
[[1;34mINFO[m] found property git.build.user.email
[[1;34mINFO[m] found property git.build.host
[[1;34mINFO[m] found property git.dirty
[[1;34mINFO[m] found property git.remote.origin.url
[[1;34mINFO[m] found property git.closest.tag.name
[[1;34mINFO[m] found property git.total.commit.count
[[1;34mINFO[m] found property git.commit.id.describe-short
[[1;34mINFO[m] found property git.commit.user.email
[[1;34mINFO[m] found property git.commit.time
[[1;34mINFO[m] found property git.commit.message.full
[[1;34mINFO[m] found property git.build.version
[[1;34mINFO[m] found property git.commit.message.short
[[1;34mINFO[m] found property git.commit.id.abbrev
[[1;34mINFO[m] found property git.branch
[[1;34mINFO[m] found property git.build.user.name
[[1;34mINFO[m] found property git.closest.tag.commit.count
[[1;34mINFO[m] found property git.commit.id.describe
[[1;34mINFO[m] found property git.commit.id
[[1;34mINFO[m] found property git.tags
[[1;34mINFO[m] found property git.build.time
[[1;34mINFO[m] found property git.commit.user.name
[[1;34mINFO[m] Reading existing properties file [/testbed/apollo-biz/target/classes/apollo-git.properties] (for module Apollo Biz)...
[[1;34mINFO[m] Writing properties file to [/testbed/apollo-biz/target/classes/apollo-git.properties] (for module Apollo Biz)...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:resources[m [1m(default-resources)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/resources
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/resources
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/config
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/config
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mflatten:1.1.0:flatten[m [1m(flatten)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-biz:jar:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:compile[m [1m(default-compile)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:testResources[m [1m(default-testResources)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] Copying 9 resources from src/test/resources to target/test-classes
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:testCompile[m [1m(default-testCompile)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32msurefire:2.22.2:test[m [1m(default-test)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m----------< [0;36mcom.ctrip.framework.apollo:apollo-configservice[0;1m >-----------[m
[[1;34mINFO[m] [1mBuilding Apollo ConfigService 2.1.0-SNAPSHOT                       [5/5][m
[[1;34mINFO[m]   from apollo-configservice/pom.xml
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mgit-commit-id:2.2.6:revision[m [1m(default)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] dotGitDirectory /testbed/.git
[[1;34mINFO[m] git.build.user.name 
[[1;34mINFO[m] git.build.user.email 
[[1;34mINFO[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] --always = true
[[1;34mINFO[m] --dirty = -dirty
[[1;34mINFO[m] --abbrev = 7
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] git.commit.id.describe 526a935
[[1;34mINFO[m] git.commit.id 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] git.commit.id.abbrev 526a935
[[1;34mINFO[m] git.dirty false
[[1;34mINFO[m] git.commit.user.name kl
[[1;34mINFO[m] git.commit.user.email chenkailing@xd.com
[[1;34mINFO[m] git.commit.message.full Fix Apollo checks the yaml format interface Response Code = 500  (#4567)

* fix(apollo-portal): Fix Apollo checks the yaml format interface Response Code = 500 #4566



* fix(apollo-portal): Fix yamlSyntaxCheck test cases



Co-authored-by: Jason Song <nobodyiam@gmail.com>
[[1;34mINFO[m] git.commit.message.short Fix Apollo checks the yaml format interface Response Code = 500  (#4567)
[[1;34mINFO[m] git.commit.time 2022-09-16T00:17:54+0000
[[1;34mINFO[m] git.remote.origin.url https://github.com/apolloconfig/apollo.git
[[1;34mINFO[m] git.tags tag-oidc-debug-log,tag-oidc-debug-log-2,v2.1.0,v2.2.0,v2.3.0,v2.4.0
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.name 
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37fba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.commit.count 
[[1;34mINFO[m] git.total.commit.count 2746
[[1;34mINFO[m] git.build.time 2025-11-12T11:29:38+0000
[[1;34mINFO[m] git.build.version 2.1.0-SNAPSHOT
[[1;34mINFO[m] git.build.host ucl-research
[[1;34mINFO[m] git.commit.id.describe-short 526a935
[[1;34mINFO[m] found property git.build.user.email
[[1;34mINFO[m] found property git.build.host
[[1;34mINFO[m] found property git.dirty
[[1;34mINFO[m] found property git.remote.origin.url
[[1;34mINFO[m] found property git.closest.tag.name
[[1;34mINFO[m] found property git.total.commit.count
[[1;34mINFO[m] found property git.commit.id.describe-short
[[1;34mINFO[m] found property git.commit.user.email
[[1;34mINFO[m] found property git.commit.time
[[1;34mINFO[m] found property git.commit.message.full
[[1;34mINFO[m] found property git.build.version
[[1;34mINFO[m] found property git.commit.message.short
[[1;34mINFO[m] found property git.commit.id.abbrev
[[1;34mINFO[m] found property git.branch
[[1;34mINFO[m] found property git.build.user.name
[[1;34mINFO[m] found property git.closest.tag.commit.count
[[1;34mINFO[m] found property git.commit.id.describe
[[1;34mINFO[m] found property git.commit.id
[[1;34mINFO[m] found property git.tags
[[1;34mINFO[m] found property git.build.time
[[1;34mINFO[m] found property git.commit.user.name
[[1;34mINFO[m] Reading existing properties file [/testbed/apollo-configservice/target/classes/apollo-git.properties] (for module Apollo ConfigService)...
[[1;34mINFO[m] Writing properties file to [/testbed/apollo-configservice/target/classes/apollo-git.properties] (for module Apollo ConfigService)...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:resources[m [1m(default-resources)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] Copying 9 resources from src/main/resources to target/classes
[[1;34mINFO[m] Copying 0 resource from src/main/resources to target/classes
[[1;34mINFO[m] Copying 1 resource from src/main/config to target/classes
[[1;34mINFO[m] Copying 2 resources from src/main/config to target/classes
[[1;34mINFO[m] The encoding used to copy filtered properties files have not been set. This means that the same encoding will be used to copy filtered properties files as when copying other filtered resources. This might not be what you want! Run your build with --debug to see which files might be affected. Read more at https://maven.apache.org/plugins/maven-resources-plugin/examples/filtering-properties-files.html
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mflatten:1.1.0:flatten[m [1m(flatten)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-configservice:jar:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:compile[m [1m(default-compile)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:testResources[m [1m(default-testResources)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] Copying 11 resources from src/test/resources to target/test-classes
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:testCompile[m [1m(default-testCompile)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32msurefire:2.22.2:test[m [1m(default-test)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] 
[[1;34mINFO[m] -------------------------------------------------------
[[1;34mINFO[m]  T E S T S
[[1;34mINFO[m] -------------------------------------------------------
[[1;34mINFO[m] Running com.ctrip.framework.apollo.configservice.controller.[1mConfigControllerTest[m
[[1;34mINFO[m] [1;32mTests run: [0;1;32m3[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.901 s - in com.ctrip.framework.apollo.configservice.controller.[1mConfigControllerTest[m
[[1;34mINFO[m] Running com.ctrip.framework.apollo.configservice.util.[1mNamespaceUtilTest[m
[[1;34mINFO[m] [1;32mTests run: [0;1;32m2[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 s - in com.ctrip.framework.apollo.configservice.util.[1mNamespaceUtilTest[m
[[1;34mINFO[m] 
[[1;34mINFO[m] Results:
[[1;34mINFO[m] 
[[1;34mINFO[m] [1;32mTests run: 5, Failures: 0, Errors: 0, Skipped: 0[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] [1mReactor Summary for Apollo 2.1.0-SNAPSHOT:[m
[[1;34mINFO[m] 
[[1;34mINFO[m] Apollo ............................................. [1;32mSUCCESS[m [  0.802 s]
[[1;34mINFO[m] Apollo Core ........................................ [1;32mSUCCESS[m [  2.867 s]
[[1;34mINFO[m] Apollo Common ...................................... [1;32mSUCCESS[m [  0.807 s]
[[1;34mINFO[m] Apollo Biz ......................................... [1;32mSUCCESS[m [  0.765 s]
[[1;34mINFO[m] Apollo ConfigService ............................... [1;32mSUCCESS[m [  2.911 s]
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] [1;32mBUILD SUCCESS[m
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] Total time:  8.473 s
[[1;34mINFO[m] Finished at: 2025-11-12T11:29:40Z
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[?2004l
2025-11-12 11:32:41,882 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_node - DEBUG - content='Result:\n mvn -pl apollo-configservice -am -Dtest=com.ctrip.framework.apollo.conf\nfigservice.controller.ConfigControllerTest#testQueryConfig,com.ctrip.framework.ap\npollo.configservice.controller.ConfigControllerTest#testQueryConfigWithAppOwnName\nespace,com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#t\ntestQueryConfigWithPubicNamespaceAndNoAppOverride,com.ctrip.framework.apollo.conf\nfigservice.util.NamespaceUtilTest#testNormalizeNamespaceWithPrivateNamespace,com.\n.ctrip.framework.apollo.configservice.util.NamespaceUtilTest#testNormalizeNamespa\naceWithPublicNamespace test -DfailIfNoTests=false\n[\x1b[1;34mINFO\x1b[m] Scanning for projects...\n[\x1b[1;34mINFO\x1b[m] \x1b[1m------------------------------------------------------------------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1mReactor Build Order:\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] Apollo                                                             [pom]\n[\x1b[1;34mINFO\x1b[m] Apollo Core                                                        [jar]\n[\x1b[1;34mINFO\x1b[m] Apollo Common                                                      [jar]\n[\x1b[1;34mINFO\x1b[m] Apollo Biz                                                         [jar]\n[\x1b[1;34mINFO\x1b[m] Apollo ConfigService                                               [jar]\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m-----------------< \x1b[0;36mcom.ctrip.framework.apollo:apollo\x1b[0;1m >------------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1mBuilding Apollo 2.1.0-SNAPSHOT                                     [1/5]\x1b[m\n[\x1b[1;34mINFO\x1b[m]   from pom.xml\n[\x1b[1;34mINFO\x1b[m] \x1b[1m--------------------------------[ pom ]---------------------------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mgit-commit-id:2.2.6:revision\x1b[m \x1b[1m(default)\x1b[m @ \x1b[36mapollo\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] isPomProject is true and skipPoms is true, return\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mflatten:1.1.0:flatten\x1b[m \x1b[1m(flatten)\x1b[m @ \x1b[36mapollo\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo:pom:2.1.0-SNAPSHOT...\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m---------------< \x1b[0;36mcom.ctrip.framework.apollo:apollo-core\x1b[0;1m >---------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1mBuilding Apollo Core 2.1.0-SNAPSHOT                                [2/5]\x1b[m\n[\x1b[1;34mINFO\x1b[m]   from apollo-core/pom.xml\n[\x1b[1;34mINFO\x1b[m] \x1b[1m--------------------------------[ jar ]---------------------------------\x1b[m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.pom\nProgress (1): 765 B\nProgress (1): 1.8 kB\nProgress (1): 3.8 kB\nProgress (1): 6.9 kB\nProgress (1): 8.2 kB\n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.pom\x1b[90m (8.2 kB at 33 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/plugins/maven-plugins/39/maven-plugins-39.pom\nProgress (1): 770 B\nProgress (1): 2.3 kB\nProgress (1): 4.0 kB\nProgress (1): 6.5 kB\nProgress (1): 8.1 kB\n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/plugins/maven-plugins/39/maven-plugins-39.pom\x1b[90m (8.1 kB at 270 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/maven-parent/39/maven-parent-39.pom\nProgress (1): 720 B\nProgress (1): 1.9 kB\nProgress (1): 3.9 kB\nProgress (1): 8.5 kB\nProgress (1): 13 kB \nProgress (1): 16 kB\nProgress (1): 21 kB\nProgress (1): 25 kB\nProgress (1): 27 kB\nProgress (1): 28 kB\nProgress (1): 31 kB\nProgress (1): 33 kB\nProgress (1): 36 kB\nProgress (1): 40 kB\nProgress (1): 41 kB\nProgress (1): 46 kB\nProgress (1): 48 kB\n                   \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/maven-parent/39/maven-parent-39.pom\x1b[90m (48 kB at 1.3 MB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/apache/29/apache-29.pom\nProgress (1): 744 B\nProgress (1): 2.1 kB\nProgress (1): 3.3 kB\nProgress (1): 5.2 kB\nProgress (1): 10 kB \nProgress (1): 14 kB\nProgress (1): 17 kB\nProgress (1): 20 kB\nProgress (1): 21 kB\n                   \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/apache/29/apache-29.pom\x1b[90m (21 kB at 740 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.jar\nProgress (1): 0.9/31 kB\nProgress (1): 2.3/31 kB\nProgress (1): 3.6/31 kB\nProgress (1): 5.0/31 kB\nProgress (1): 6.4/31 kB\nProgress (1): 7.7/31 kB\nProgress (1): 9.1/31 kB\nProgress (1): 10/31 kB \nProgress (1): 12/31 kB\nProgress (1): 13/31 kB\nProgress (1): 15/31 kB\nProgress (1): 16/31 kB\nProgress (1): 17/31 kB\nProgress (1): 19/31 kB\nProgress (1): 20/31 kB\nProgress (1): 21/31 kB\nProgress (1): 23/31 kB\nProgress (1): 24/31 kB\nProgress (1): 25/31 kB\nProgress (1): 26/31 kB\nProgress (1): 27/31 kB\nProgress (1): 31 kB   \n                   \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.jar\x1b[90m (31 kB at 737 kB/s)\x1b[0m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mgit-commit-id:2.2.6:revision\x1b[m \x1b[1m(default)\x1b[m @ \x1b[36mapollo-core\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] dotGitDirectory /testbed/.git\n[\x1b[1;34mINFO\x1b[m] git.build.user.name \n[\x1b[1;34mINFO\x1b[m] git.build.user.email \n[\x1b[1;34mINFO\x1b[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f\n[\x1b[1;34mINFO\x1b[m] --always = true\n[\x1b[1;34mINFO\x1b[m] --dirty = -dirty\n[\x1b[1;34mINFO\x1b[m] --abbrev = 7\n[\x1b[1;34mINFO\x1b[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]\n[\x1b[1;34mINFO\x1b[m] Created map: [{}]\n[\x1b[1;34mINFO\x1b[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]\n[\x1b[1;34mINFO\x1b[m] git.commit.id.describe 526a935\n[\x1b[1;34mINFO\x1b[m] git.commit.id 526a93506ee380a009dc20a9ab870a37367f983f\n[\x1b[1;34mINFO\x1b[m] git.commit.id.abbrev 526a935\n[\x1b[1;34mINFO\x1b[m] git.dirty false\n[\x1b[1;34mINFO\x1b[m] git.commit.user.name kl\n[\x1b[1;34mINFO\x1b[m] git.commit.user.email chenkailing@xd.com\n[\x1b[1;34mINFO\x1b[m] git.commit.message.full Fix Apollo checks the yaml format interface Response Code = 500  (#4567)\n\n* fix(apollo-portal): Fix Apollo checks the yaml format interface Response Code = 500 #4566\n\n\n\n* fix(apollo-portal): Fix yamlSyntaxCheck test cases\n\n\n\nCo-authored-by: Jason Song <nobodyiam@gmail.com>\n[\x1b[1;34mINFO\x1b[m] git.commit.message.short Fix Apollo checks the yaml format interface Response Code = 500  (#4567)\n[\x1b[1;34mINFO\x1b[m] git.commit.time 2022-09-16T00:17:54+0000\n[\x1b[1;34mINFO\x1b[m] git.remote.origin.url https://github.com/apolloconfig/apollo.git\n[\x1b[1;34mINFO\x1b[m] git.tags tag-oidc-debug-log,tag-oidc-debug-log-2,v2.1.0,v2.2.0,v2.3.0,v2.4.0\n[\x1b[1;34mINFO\x1b[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]\n[\x1b[1;34mINFO\x1b[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]\n[\x1b[1;34mINFO\x1b[m] Created map: [{}]\n[\x1b[1;34mINFO\x1b[m] git.closest.tag.name \n[\x1b[1;34mINFO\x1b[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]\n[\x1b[1;34mINFO\x1b[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]\n[\x1b[1;34mINFO\x1b[m] Created map: [{}]\n[\x1b[1;34mINFO\x1b[m] git.closest.tag.commit.count \n[\x1b[1;34mINFO\x1b[m] git.total.commit.count 2746\n[\x1b[1;34mINFO\x1b[m] git.build.time 2025-11-12T11:29:35+0000\n[\x1b[1;34mINFO\x1b[m] git.build.version 2.1.0-SNAPSHOT\n[\x1b[1;34mINFO\x1b[m] git.build.host ucl-research\n[\x1b[1;34mINFO\x1b[m] git.commit.id.describe-short 526a935\n[\x1b[1;34mINFO\x1b[m] found property git.build.user.email\n[\x1b[1;34mINFO\x1b[m] found property git.build.host\n[\x1b[1;34mINFO\x1b[m] found property git.dirty\n[\x1b[1;34mINFO\x1b[m] found property git.remote.origin.url\n[\x1b[1;34mINFO\x1b[m] found property git.closest.tag.name\n[\x1b[1;34mINFO\x1b[m] found property git.total.commit.count\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.describe-short\n[\x1b[1;34mINFO\x1b[m] found property git.commit.user.email\n[\x1b[1;34mINFO\x1b[m] found property git.commit.time\n[\x1b[1;34mINFO\x1b[m] found property git.commit.message.full\n[\x1b[1;34mINFO\x1b[m] found property git.build.version\n[\x1b[1;34mINFO\x1b[m] found property git.commit.message.short\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.abbrev\n[\x1b[1;34mINFO\x1b[m] found property git.branch\n[\x1b[1;34mINFO\x1b[m] found property git.build.user.name\n[\x1b[1;34mINFO\x1b[m] found property git.closest.tag.commit.count\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.describe\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id\n[\x1b[1;34mINFO\x1b[m] found property git.tags\n[\x1b[1;34mINFO\x1b[m] found property git.build.time\n[\x1b[1;34mINFO\x1b[m] found property git.commit.user.name\n[\x1b[1;34mINFO\x1b[m] Reading existing properties file [/testbed/apollo-core/target/classes/apollo-git.properties] (for module Apollo Core)...\n[\x1b[1;34mINFO\x1b[m] Writing properties file to [/testbed/apollo-core/target/classes/apollo-git.properties] (for module Apollo Core)...\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mresources:3.3.1:resources\x1b[m \x1b[1m(default-resources)\x1b[m @ \x1b[36mapollo-core\x1b[0;1m ---\x1b[m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.pom\nProgress (1): 714 B\nProgress (1): 2.4 kB\nProgress (1): 4.4 kB\nProgress (1): 8.6 kB\nProgress (1): 8.8 kB\n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.pom\x1b[90m (8.8 kB at 365 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/codehaus/plexus/plexus/10/plexus-10.pom\nProgress (1): 695 B\nProgress (1): 2.7 kB\nProgress (1): 6.4 kB\nProgress (1): 9.2 kB\nProgress (1): 11 kB \nProgress (1): 16 kB\nProgress (1): 20 kB\nProgress (1): 24 kB\nProgress (1): 25 kB\nProgress (1): 25 kB\n                   \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/codehaus/plexus/plexus/10/plexus-10.pom\x1b[90m (25 kB at 1.1 MB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.pom\nProgress (1): 778 B\nProgress (1): 2.2 kB\nProgress (1): 5.6 kB\nProgress (1): 6.0 kB\n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.pom\x1b[90m (6.0 kB at 274 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/shared/maven-shared-components/39/maven-shared-components-39.pom\nProgress (1): 801 B\nProgress (1): 2.2 kB\nProgress (1): 3.2 kB\n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/shared/maven-shared-components/39/maven-shared-components-39.pom\x1b[90m (3.2 kB at 146 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.pom\nProgress (1): 1.0 kB\nProgress (1): 2.7 kB\n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.pom\x1b[90m (2.7 kB at 69 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.pom\nProgress (1): 895 B\nProgress (1): 3.2 kB\n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.pom\x1b[90m (3.2 kB at 134 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/sonatype/spice/spice-parent/15/spice-parent-15.pom\nProgress (1): 1.2 kB\nProgress (1): 3.7 kB\nProgress (1): 7.3 kB\nProgress (1): 8.4 kB\n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/sonatype/spice/spice-parent/15/spice-parent-15.pom\x1b[90m (8.4 kB at 334 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/codehaus/plexus/plexus-utils/3.5.0/plexus-utils-3.5.0.pom\nProgress (1): 714 B\nProgress (1): 2.3 kB\nProgress (1): 4.5 kB\nProgress (1): 8.0 kB\n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/codehaus/plexus/plexus-utils/3.5.0/plexus-utils-3.5.0.pom\x1b[90m (8.0 kB at 154 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.pom\nProgress (1): 770 B\nProgress (1): 2.1 kB\nProgress (1): 5.2 kB\nProgress (1): 7.8 kB\nProgress (1): 10 kB \nProgress (1): 12 kB\nProgress (1): 15 kB\nProgress (1): 18 kB\nProgress (1): 19 kB\nProgress (1): 20 kB\n                   \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.pom\x1b[90m (20 kB at 759 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/junit/junit-bom/5.7.2/junit-bom-5.7.2.pom\nProgress (1): 912 B\nProgress (1): 4.3 kB\nProgress (1): 5.1 kB\n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/junit/junit-bom/5.7.2/junit-bom-5.7.2.pom\x1b[90m (5.1 kB at 204 kB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.jar\nProgress (1): 3.8/269 kB\nProgress (1): 8.0/269 kB\nProgress (1): 8.2/269 kB\nProgress (1): 12/269 kB \nProgress (1): 17/269 kB\nProgress (1): 21/269 kB\nProgress (1): 25/269 kB\nProgress (1): 29/269 kB\nProgress (1): 34/269 kB\nProgress (1): 38/269 kB\nProgress (1): 42/269 kB\nProgress (1): 58/269 kB\nProgress (1): 75/269 kB\nProgress (1): 91/269 kB\nProgress (1): 108/269 kB\nProgress (1): 124/269 kB\nProgress (1): 139/269 kB\nProgress (1): 147/269 kB\nProgress (1): 164/269 kB\nProgress (1): 180/269 kB\nProgress (1): 197/269 kB\nProgress (1): 213/269 kB\nProgress (1): 221/269 kB\nProgress (1): 237/269 kB\nProgress (1): 253/269 kB\nProgress (1): 269 kB    \n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.jar\x1b[90m (269 kB at 4.2 MB/s)\x1b[0m\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.jar\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.jar\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.jar\n\x1b[90mDownloading from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.jar\nProgress (1): 7.7/55 kB\nProgress (1): 8.2/55 kB\nProgress (1): 25/55 kB \nProgress (1): 41/55 kB\nProgress (1): 55 kB   \n                   \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.jar\x1b[90m (55 kB at 1.8 MB/s)\x1b[0m\nProgress (1): 0.9/8.5 kB\nProgress (1): 2.3/8.5 kB\nProgress (1): 3.6/8.5 kB\nProgress (1): 5.0/8.5 kB\nProgress (1): 6.4/8.5 kB\nProgress (1): 7.7/8.5 kB\nProgress (1): 8.2/8.5 kB\nProgress (1): 8.5 kB    \n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.jar\x1b[90m (8.5 kB at 154 kB/s)\x1b[0m\nProgress (1): 0.9/41 kB\nProgress (1): 2.3/41 kB\nProgress (1): 3.6/41 kB\nProgress (1): 5.0/41 kB\nProgress (1): 6.4/41 kB\nProgress (1): 7.7/41 kB\nProgress (1): 9.1/41 kB\nProgress (1): 10/41 kB \nProgress (1): 12/41 kB\nProgress (1): 13/41 kB\nProgress (1): 15/41 kB\nProgress (1): 16/41 kB\nProgress (1): 17/41 kB\nProgress (1): 19/41 kB\nProgress (1): 20/41 kB\nProgress (1): 21/41 kB\nProgress (1): 23/41 kB\nProgress (1): 24/41 kB\nProgress (1): 25/41 kB\nProgress (1): 26/41 kB\nProgress (1): 27/41 kB\nProgress (1): 29/41 kB\nProgress (1): 30/41 kB\nProgress (1): 31/41 kB\nProgress (1): 33/41 kB\nProgress (1): 34/41 kB\nProgress (1): 36/41 kB\nProgress (1): 37/41 kB\nProgress (1): 38/41 kB\nProgress (1): 40/41 kB\nProgress (1): 41/41 kB\nProgress (1): 41 kB   \n                   \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.jar\x1b[90m (41 kB at 556 kB/s)\x1b[0m\nProgress (1): 0.9/327 kB\nProgress (1): 2.3/327 kB\nProgress (1): 3.6/327 kB\nProgress (1): 5.0/327 kB\nProgress (1): 6.4/327 kB\nProgress (1): 7.7/327 kB\nProgress (1): 9.1/327 kB\nProgress (1): 10/327 kB \nProgress (1): 12/327 kB\nProgress (1): 13/327 kB\nProgress (1): 15/327 kB\nProgress (1): 16/327 kB\nProgress (1): 17/327 kB\nProgress (1): 19/327 kB\nProgress (1): 20/327 kB\nProgress (1): 21/327 kB\nProgress (1): 23/327 kB\nProgress (1): 24/327 kB\nProgress (1): 26/327 kB\nProgress (1): 27/327 kB\nProgress (1): 28/327 kB\nProgress (1): 30/327 kB\nProgress (1): 31/327 kB\nProgress (1): 32/327 kB\nProgress (1): 34/327 kB\nProgress (1): 35/327 kB\nProgress (1): 36/327 kB\nProgress (1): 38/327 kB\nProgress (1): 39/327 kB\nProgress (1): 41/327 kB\nProgress (1): 42/327 kB\nProgress (1): 43/327 kB\nProgress (1): 45/327 kB\nProgress (1): 46/327 kB\nProgress (1): 47/327 kB\nProgress (1): 49/327 kB\nProgress (1): 50/327 kB\nProgress (1): 52/327 kB\nProgress (1): 53/327 kB\nProgress (1): 54/327 kB\nProgress (1): 56/327 kB\nProgress (1): 57/327 kB\nProgress (1): 62/327 kB\nProgress (1): 66/327 kB\nProgress (1): 70/327 kB\nProgress (1): 74/327 kB\nProgress (1): 78/327 kB\nProgress (1): 83/327 kB\nProgress (1): 87/327 kB\nProgress (1): 91/327 kB\nProgress (1): 95/327 kB\nProgress (1): 100/327 kB\nProgress (1): 104/327 kB\nProgress (1): 108/327 kB\nProgress (1): 112/327 kB\nProgress (1): 117/327 kB\nProgress (1): 121/327 kB\nProgress (1): 125/327 kB\nProgress (1): 129/327 kB\nProgress (1): 133/327 kB\nProgress (1): 138/327 kB\nProgress (1): 142/327 kB\nProgress (1): 146/327 kB\nProgress (1): 150/327 kB\nProgress (1): 155/327 kB\nProgress (1): 159/327 kB\nProgress (1): 163/327 kB\nProgress (1): 167/327 kB\nProgress (1): 172/327 kB\nProgress (1): 176/327 kB\nProgress (1): 180/327 kB\nProgress (1): 184/327 kB\nProgress (1): 188/327 kB\nProgress (1): 193/327 kB\nProgress (1): 197/327 kB\nProgress (1): 201/327 kB\nProgress (1): 205/327 kB\nProgress (1): 210/327 kB\nProgress (1): 214/327 kB\nProgress (1): 218/327 kB\nProgress (1): 222/327 kB\nProgress (1): 239/327 kB\nProgress (1): 255/327 kB\nProgress (1): 271/327 kB\nProgress (1): 288/327 kB\nProgress (1): 304/327 kB\nProgress (1): 319/327 kB\nProgress (1): 327 kB    \n                    \nDownloaded\x1b[90m from \x1b[0mcentral\x1b[90m: https://repo.maven.apache.org/maven2/\x1b[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.jar\x1b[90m (327 kB at 2.8 MB/s)\x1b[0m\n[\x1b[1;34mINFO\x1b[m] Copying 0 resource from src/main/resources to target/classes\n[\x1b[1;34mINFO\x1b[m] Copying 3 resources from src/main/resources to target/classes\n[\x1b[1;34mINFO\x1b[m] skip non existing resourceDirectory /testbed/apollo-core/src/main/config\n[\x1b[1;34mINFO\x1b[m] skip non existing resourceDirectory /testbed/apollo-core/src/main/config\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mflatten:1.1.0:flatten\x1b[m \x1b[1m(flatten)\x1b[m @ \x1b[36mapollo-core\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-core:jar:2.1.0-SNAPSHOT...\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mcompiler:3.10.1:compile\x1b[m \x1b[1m(default-compile)\x1b[m @ \x1b[36mapollo-core\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Nothing to compile - all classes are up to date\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mresources:3.3.1:testResources\x1b[m \x1b[1m(default-testResources)\x1b[m @ \x1b[36mapollo-core\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Copying 15 resources from src/test/resources to target/test-classes\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mcompiler:3.10.1:testCompile\x1b[m \x1b[1m(default-testCompile)\x1b[m @ \x1b[36mapollo-core\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Nothing to compile - all classes are up to date\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32msurefire:2.22.2:test\x1b[m \x1b[1m(default-test)\x1b[m @ \x1b[36mapollo-core\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--------------< \x1b[0;36mcom.ctrip.framework.apollo:apollo-common\x1b[0;1m >--------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1mBuilding Apollo Common 2.1.0-SNAPSHOT                              [3/5]\x1b[m\n[\x1b[1;34mINFO\x1b[m]   from apollo-common/pom.xml\n[\x1b[1;34mINFO\x1b[m] \x1b[1m--------------------------------[ jar ]---------------------------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mgit-commit-id:2.2.6:revision\x1b[m \x1b[1m(default)\x1b[m @ \x1b[36mapollo-common\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] dotGitDirectory /testbed/.git\n[\x1b[1;34mINFO\x1b[m] git.build.user.name \n[\x1b[1;34mINFO\x1b[m] git.build.user.email \n[\x1b[1;34mINFO\x1b[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f\n[\x1b[1;34mINFO\x1b[m] --always = true\n[\x1b[1;34mINFO\x1b[m] --dirty = -dirty\n[\x1b[1;34mINFO\x1b[m] --abbrev = 7\n[\x1b[1;34mINFO\x1b[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]\n[\x1b[1;34mINFO\x1b[m] Created map: [{}]\n[\x1b[1;34mINFO\x1b[m] git.closest.tag.name \n[\x1b[1;34mINFO\x1b[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]\n[\x1b[1;34mINFO\x1b[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]\n[\x1b[1;34mINFO\x1b[m] Created map: [{}]\n[\x1b[1;34mINFO\x1b[m] git.closest.tag.commit.count \n[\x1b[1;34mINFO\x1b[m] git.total.commit.count 2746\n[\x1b[1;34mINFO\x1b[m] git.build.time 2025-11-12T11:29:36+0000\n[\x1b[1;34mINFO\x1b[m] git.build.version 2.1.0-SNAPSHOT\n[\x1b[1;34mINFO\x1b[m] git.build.host ucl-research\n[\x1b[1;34mINFO\x1b[m] git.commit.id.describe-short 526a935\n[\x1b[1;34mINFO\x1b[m] found property git.build.user.email\n[\x1b[1;34mINFO\x1b[m] found property git.build.host\n[\x1b[1;34mINFO\x1b[m] found property git.dirty\n[\x1b[1;34mINFO\x1b[m] found property git.remote.origin.url\n[\x1b[1;34mINFO\x1b[m] found property git.closest.tag.name\n[\x1b[1;34mINFO\x1b[m] found property git.total.commit.count\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.describe-short\n[\x1b[1;34mINFO\x1b[m] found property git.commit.user.email\n[\x1b[1;34mINFO\x1b[m] found property git.commit.time\n[\x1b[1;34mINFO\x1b[m] found property git.commit.message.full\n[\x1b[1;34mINFO\x1b[m] found property git.build.version\n[\x1b[1;34mINFO\x1b[m] found property git.commit.message.short\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.abbrev\n[\x1b[1;34mINFO\x1b[m] found property git.branch\n[\x1b[1;34mINFO\x1b[m] found property git.build.user.name\n[\x1b[1;34mINFO\x1b[m] found property git.closest.tag.commit.count\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.describe\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id\n[\x1b[1;34mINFO\x1b[m] found property git.tags\n[\x1b[1;34mINFO\x1b[m] found property git.build.time\n[\x1b[1;34mINFO\x1b[m] found property git.commit.user.name\n[\x1b[1;34mINFO\x1b[m] Reading existing properties file [/testbed/apollo-common/target/classes/apollo-git.properties] (for module Apollo Common)...\n[\x1b[1;34mINFO\x1b[m] Writing properties file to [/testbed/apollo-common/target/classes/apollo-git.properties] (for module Apollo Common)...\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mresources:3.3.1:resources\x1b[m \x1b[1m(default-resources)\x1b[m @ \x1b[36mapollo-common\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Copying 4 resources from src/main/resources to target/classes\n[\x1b[1;34mINFO\x1b[m] Copying 1 resource from src/main/resources to target/classes\n[\x1b[1;34mINFO\x1b[m] skip non existing resourceDirectory /testbed/apollo-common/src/main/config\n[\x1b[1;34mINFO\x1b[m] skip non existing resourceDirectory /testbed/apollo-common/src/main/config\n[\x1b[1;34mINFO\x1b[m] The encoding used to copy filtered properties files have not been set. This means that the same encoding will be used to copy filtered properties files as when copying other filtered resources. This might not be what you want! Run your build with --debug to see which files might be affected. Read more at https://maven.apache.org/plugins/maven-resources-plugin/examples/filtering-properties-files.html\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mflatten:1.1.0:flatten\x1b[m \x1b[1m(flatten)\x1b[m @ \x1b[36mapollo-common\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-common:jar:2.1.0-SNAPSHOT...\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mcompiler:3.10.1:compile\x1b[m \x1b[1m(default-compile)\x1b[m @ \x1b[36mapollo-common\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Nothing to compile - all classes are up to date\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mresources:3.3.1:testResources\x1b[m \x1b[1m(default-testResources)\x1b[m @ \x1b[36mapollo-common\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] skip non existing resourceDirectory /testbed/apollo-common/src/test/resources\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mcompiler:3.10.1:testCompile\x1b[m \x1b[1m(default-testCompile)\x1b[m @ \x1b[36mapollo-common\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Nothing to compile - all classes are up to date\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32msurefire:2.22.2:test\x1b[m \x1b[1m(default-test)\x1b[m @ \x1b[36mapollo-common\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m---------------< \x1b[0;36mcom.ctrip.framework.apollo:apollo-biz\x1b[0;1m >----------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1mBuilding Apollo Biz 2.1.0-SNAPSHOT                                 [4/5]\x1b[m\n[\x1b[1;34mINFO\x1b[m]   from apollo-biz/pom.xml\n[\x1b[1;34mINFO\x1b[m] \x1b[1m--------------------------------[ jar ]---------------------------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mgit-commit-id:2.2.6:revision\x1b[m \x1b[1m(default)\x1b[m @ \x1b[36mapollo-biz\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] dotGitDirectory /testbed/.git\n[\x1b[1;34mINFO\x1b[m] git.build.user.name \n[\x1b[1;34mINFO\x1b[m] git.build.user.email \n[\x1b[1;34mINFO\x1b[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f\n[\x1b[1;34mINFO\x1b[m] --always = true\n[\x1b[1;34mINFO\x1b[m] --dirty = -dirty\n[\x1b[1;34mINFO\x1b[m] --abbrev = 7\n[\x1b[1;34mINFO\x1b[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]\n[\x1b[1;34mINFO\x1b[m] Created map: [{}]\n[\x1b[1;34mINFO\x1b[m] git.closest.tag.name \n[\x1b[1;34mINFO\x1b[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]\n[\x1b[1;34mINFO\x1b[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]\n[\x1b[1;34mINFO\x1b[m] Created map: [{}]\n[\x1b[1;34mINFO\x1b[m] git.closest.tag.commit.count \n[\x1b[1;34mINFO\x1b[m] git.total.commit.count 2746\n[\x1b[1;34mINFO\x1b[m] git.build.time 2025-11-12T11:29:37+0000\n[\x1b[1;34mINFO\x1b[m] git.build.version 2.1.0-SNAPSHOT\n[\x1b[1;34mINFO\x1b[m] git.build.host ucl-research\n[\x1b[1;34mINFO\x1b[m] git.commit.id.describe-short 526a935\n[\x1b[1;34mINFO\x1b[m] found property git.build.user.email\n[\x1b[1;34mINFO\x1b[m] found property git.build.host\n[\x1b[1;34mINFO\x1b[m] found property git.dirty\n[\x1b[1;34mINFO\x1b[m] found property git.remote.origin.url\n[\x1b[1;34mINFO\x1b[m] found property git.closest.tag.name\n[\x1b[1;34mINFO\x1b[m] found property git.total.commit.count\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.describe-short\n[\x1b[1;34mINFO\x1b[m] found property git.commit.user.email\n[\x1b[1;34mINFO\x1b[m] found property git.commit.time\n[\x1b[1;34mINFO\x1b[m] found property git.commit.message.full\n[\x1b[1;34mINFO\x1b[m] found property git.build.version\n[\x1b[1;34mINFO\x1b[m] found property git.commit.message.short\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.abbrev\n[\x1b[1;34mINFO\x1b[m] found property git.branch\n[\x1b[1;34mINFO\x1b[m] found property git.build.user.name\n[\x1b[1;34mINFO\x1b[m] found property git.closest.tag.commit.count\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.describe\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id\n[\x1b[1;34mINFO\x1b[m] found property git.tags\n[\x1b[1;34mINFO\x1b[m] found property git.build.time\n[\x1b[1;34mINFO\x1b[m] found property git.commit.user.name\n[\x1b[1;34mINFO\x1b[m] Reading existing properties file [/testbed/apollo-biz/target/classes/apollo-git.properties] (for module Apollo Biz)...\n[\x1b[1;34mINFO\x1b[m] Writing properties file to [/testbed/apollo-biz/target/classes/apollo-git.properties] (for module Apollo Biz)...\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mresources:3.3.1:resources\x1b[m \x1b[1m(default-resources)\x1b[m @ \x1b[36mapollo-biz\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/resources\n[\x1b[1;34mINFO\x1b[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/resources\n[\x1b[1;34mINFO\x1b[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/config\n[\x1b[1;34mINFO\x1b[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/config\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mflatten:1.1.0:flatten\x1b[m \x1b[1m(flatten)\x1b[m @ \x1b[36mapollo-biz\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-biz:jar:2.1.0-SNAPSHOT...\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mcompiler:3.10.1:compile\x1b[m \x1b[1m(default-compile)\x1b[m @ \x1b[36mapollo-biz\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Nothing to compile - all classes are up to date\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mresources:3.3.1:testResources\x1b[m \x1b[1m(default-testResources)\x1b[m @ \x1b[36mapollo-biz\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Copying 9 resources from src/test/resources to target/test-classes\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mcompiler:3.10.1:testCompile\x1b[m \x1b[1m(default-testCompile)\x1b[m @ \x1b[36mapollo-biz\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Nothing to compile - all classes are up to date\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32msurefire:2.22.2:test\x1b[m \x1b[1m(default-test)\x1b[m @ \x1b[36mapollo-biz\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m----------< \x1b[0;36mcom.ctrip.framework.apollo:apollo-configservice\x1b[0;1m >-----------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1mBuilding Apollo ConfigService 2.1.0-SNAPSHOT                       [5/5]\x1b[m\n[\x1b[1;34mINFO\x1b[m]   from apollo-configservice/pom.xml\n[\x1b[1;34mINFO\x1b[m] \x1b[1m--------------------------------[ jar ]---------------------------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mgit-commit-id:2.2.6:revision\x1b[m \x1b[1m(default)\x1b[m @ \x1b[36mapollo-configservice\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] dotGitDirectory /testbed/.git\n[\x1b[1;34mINFO\x1b[m] git.build.user.name \n[\x1b[1;34mINFO\x1b[m] git.build.user.email \n[\x1b[1;34mINFO\x1b[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f\n[\x1b[1;34mINFO\x1b[m] --always = true\n[\x1b[1;34mINFO\x1b[m] --dirty = -dirty\n[\x1b[1;34mINFO\x1b[m] --abbrev = 7\n[\x1b[1;34mINFO\x1b[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]\n[\x1b[1;34mINFO\x1b[m] Created map: [{}]\n[\x1b[1;34mINFO\x1b[m] git.closest.tag.name \n[\x1b[1;34mINFO\x1b[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]\n[\x1b[1;34mINFO\x1b[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]\n[\x1b[1;34mINFO\x1b[m] Created map: [{}]\n[\x1b[1;34mINFO\x1b[m] git.closest.tag.commit.count \n[\x1b[1;34mINFO\x1b[m] git.total.commit.count 2746\n[\x1b[1;34mINFO\x1b[m] git.build.time 2025-11-12T11:29:38+0000\n[\x1b[1;34mINFO\x1b[m] git.build.version 2.1.0-SNAPSHOT\n[\x1b[1;34mINFO\x1b[m] git.build.host ucl-research\n[\x1b[1;34mINFO\x1b[m] git.commit.id.describe-short 526a935\n[\x1b[1;34mINFO\x1b[m] found property git.build.user.email\n[\x1b[1;34mINFO\x1b[m] found property git.build.host\n[\x1b[1;34mINFO\x1b[m] found property git.dirty\n[\x1b[1;34mINFO\x1b[m] found property git.remote.origin.url\n[\x1b[1;34mINFO\x1b[m] found property git.closest.tag.name\n[\x1b[1;34mINFO\x1b[m] found property git.total.commit.count\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.describe-short\n[\x1b[1;34mINFO\x1b[m] found property git.commit.user.email\n[\x1b[1;34mINFO\x1b[m] found property git.commit.time\n[\x1b[1;34mINFO\x1b[m] found property git.commit.message.full\n[\x1b[1;34mINFO\x1b[m] found property git.build.version\n[\x1b[1;34mINFO\x1b[m] found property git.commit.message.short\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.abbrev\n[\x1b[1;34mINFO\x1b[m] found property git.branch\n[\x1b[1;34mINFO\x1b[m] found property git.build.user.name\n[\x1b[1;34mINFO\x1b[m] found property git.closest.tag.commit.count\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id.describe\n[\x1b[1;34mINFO\x1b[m] found property git.commit.id\n[\x1b[1;34mINFO\x1b[m] found property git.tags\n[\x1b[1;34mINFO\x1b[m] found property git.build.time\n[\x1b[1;34mINFO\x1b[m] found property git.commit.user.name\n[\x1b[1;34mINFO\x1b[m] Reading existing properties file [/testbed/apollo-configservice/target/classes/apollo-git.properties] (for module Apollo ConfigService)...\n[\x1b[1;34mINFO\x1b[m] Writing properties file to [/testbed/apollo-configservice/target/classes/apollo-git.properties] (for module Apollo ConfigService)...\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mresources:3.3.1:resources\x1b[m \x1b[1m(default-resources)\x1b[m @ \x1b[36mapollo-configservice\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Copying 9 resources from src/main/resources to target/classes\n[\x1b[1;34mINFO\x1b[m] Copying 0 resource from src/main/resources to target/classes\n[\x1b[1;34mINFO\x1b[m] Copying 1 resource from src/main/config to target/classes\n[\x1b[1;34mINFO\x1b[m] Copying 2 resources from src/main/config to target/classes\n[\x1b[1;34mINFO\x1b[m] The encoding used to copy filtered properties files have not been set. This means that the same encoding will be used to copy filtered properties files as when copying other filtered resources. This might not be what you want! Run your build with --debug to see which files might be affected. Read more at https://maven.apache.org/plugins/maven-resources-plugin/examples/filtering-properties-files.html\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mflatten:1.1.0:flatten\x1b[m \x1b[1m(flatten)\x1b[m @ \x1b[36mapollo-configservice\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-configservice:jar:2.1.0-SNAPSHOT...\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mcompiler:3.10.1:compile\x1b[m \x1b[1m(default-compile)\x1b[m @ \x1b[36mapollo-configservice\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Nothing to compile - all classes are up to date\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mresources:3.3.1:testResources\x1b[m \x1b[1m(default-testResources)\x1b[m @ \x1b[36mapollo-configservice\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Copying 11 resources from src/test/resources to target/test-classes\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32mcompiler:3.10.1:testCompile\x1b[m \x1b[1m(default-testCompile)\x1b[m @ \x1b[36mapollo-configservice\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] Nothing to compile - all classes are up to date\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m--- \x1b[0;32msurefire:2.22.2:test\x1b[m \x1b[1m(default-test)\x1b[m @ \x1b[36mapollo-configservice\x1b[0;1m ---\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] -------------------------------------------------------\n[\x1b[1;34mINFO\x1b[m]  T E S T S\n[\x1b[1;34mINFO\x1b[m] -------------------------------------------------------\n[\x1b[1;34mINFO\x1b[m] Running com.ctrip.framework.apollo.configservice.controller.\x1b[1mConfigControllerTest\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1;32mTests run: \x1b[0;1;32m3\x1b[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.901 s - in com.ctrip.framework.apollo.configservice.controller.\x1b[1mConfigControllerTest\x1b[m\n[\x1b[1;34mINFO\x1b[m] Running com.ctrip.framework.apollo.configservice.util.\x1b[1mNamespaceUtilTest\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1;32mTests run: \x1b[0;1;32m2\x1b[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 s - in com.ctrip.framework.apollo.configservice.util.\x1b[1mNamespaceUtilTest\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] Results:\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1;32mTests run: 5, Failures: 0, Errors: 0, Skipped: 0\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] \x1b[1m------------------------------------------------------------------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1mReactor Summary for Apollo 2.1.0-SNAPSHOT:\x1b[m\n[\x1b[1;34mINFO\x1b[m] \n[\x1b[1;34mINFO\x1b[m] Apollo ............................................. \x1b[1;32mSUCCESS\x1b[m [  0.802 s]\n[\x1b[1;34mINFO\x1b[m] Apollo Core ........................................ \x1b[1;32mSUCCESS\x1b[m [  2.867 s]\n[\x1b[1;34mINFO\x1b[m] Apollo Common ...................................... \x1b[1;32mSUCCESS\x1b[m [  0.807 s]\n[\x1b[1;34mINFO\x1b[m] Apollo Biz ......................................... \x1b[1;32mSUCCESS\x1b[m [  0.765 s]\n[\x1b[1;34mINFO\x1b[m] Apollo ConfigService ............................... \x1b[1;32mSUCCESS\x1b[m [  2.911 s]\n[\x1b[1;34mINFO\x1b[m] \x1b[1m------------------------------------------------------------------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1;32mBUILD SUCCESS\x1b[m\n[\x1b[1;34mINFO\x1b[m] \x1b[1m------------------------------------------------------------------------\x1b[m\n[\x1b[1;34mINFO\x1b[m] Total time:  8.473 s\n[\x1b[1;34mINFO\x1b[m] Finished at: 2025-11-12T11:29:40Z\n[\x1b[1;34mINFO\x1b[m] \x1b[1m------------------------------------------------------------------------\x1b[m' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29712, 'prompt_tokens': 37097, 'total_tokens': 66809, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--19145203-5de0-4b59-bdc4-eac911e7f118-0' usage_metadata={'input_tokens': 37097, 'output_tokens': 29712, 'total_tokens': 66809, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 11:32:41,885 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_structure_node - DEBUG - Human Message: 
We have run the selected regression tests on the codebase.
The following regression tests were selected to run:
--- BEGIN SELECTED REGRESSION TESTS ---
com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfig
com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithAppOwnNamespace
com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithPubicNamespaceAndNoAppOverride
com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPrivateNamespace
com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPublicNamespace
--- END SELECTED REGRESSION TESTS ---

Run Regression Tests Logs:
--- BEGIN LOG ---
Result:
 mvn -pl apollo-configservice -am -Dtest=com.ctrip.framework.apollo.conf
figservice.controller.ConfigControllerTest#testQueryConfig,com.ctrip.framework.ap
pollo.configservice.controller.ConfigControllerTest#testQueryConfigWithAppOwnName
espace,com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest#t
testQueryConfigWithPubicNamespaceAndNoAppOverride,com.ctrip.framework.apollo.conf
figservice.util.NamespaceUtilTest#testNormalizeNamespaceWithPrivateNamespace,com.
.ctrip.framework.apollo.configservice.util.NamespaceUtilTest#testNormalizeNamespa
aceWithPublicNamespace test -DfailIfNoTests=false
[[1;34mINFO[m] Scanning for projects...
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] [1mReactor Build Order:[m
[[1;34mINFO[m] 
[[1;34mINFO[m] Apollo                                                             [pom]
[[1;34mINFO[m] Apollo Core                                                        [jar]
[[1;34mINFO[m] Apollo Common                                                      [jar]
[[1;34mINFO[m] Apollo Biz                                                         [jar]
[[1;34mINFO[m] Apollo ConfigService                                               [jar]
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m-----------------< [0;36mcom.ctrip.framework.apollo:apollo[0;1m >------------------[m
[[1;34mINFO[m] [1mBuilding Apollo 2.1.0-SNAPSHOT                                     [1/5][m
[[1;34mINFO[m]   from pom.xml
[[1;34mINFO[m] [1m--------------------------------[ pom ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mgit-commit-id:2.2.6:revision[m [1m(default)[m @ [36mapollo[0;1m ---[m
[[1;34mINFO[m] isPomProject is true and skipPoms is true, return
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mflatten:1.1.0:flatten[m [1m(flatten)[m @ [36mapollo[0;1m ---[m
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo:pom:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m---------------< [0;36mcom.ctrip.framework.apollo:apollo-core[0;1m >---------------[m
[[1;34mINFO[m] [1mBuilding Apollo Core 2.1.0-SNAPSHOT                                [2/5][m
[[1;34mINFO[m]   from apollo-core/pom.xml
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.pom
Progress (1): 765 B
Progress (1): 1.8 kB
Progress (1): 3.8 kB
Progress (1): 6.9 kB
Progress (1): 8.2 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.pom[90m (8.2 kB at 33 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-plugins/39/maven-plugins-39.pom
Progress (1): 770 B
Progress (1): 2.3 kB
Progress (1): 4.0 kB
Progress (1): 6.5 kB
Progress (1): 8.1 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-plugins/39/maven-plugins-39.pom[90m (8.1 kB at 270 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/maven-parent/39/maven-parent-39.pom
Progress (1): 720 B
Progress (1): 1.9 kB
Progress (1): 3.9 kB
Progress (1): 8.5 kB
Progress (1): 13 kB 
Progress (1): 16 kB
Progress (1): 21 kB
Progress (1): 25 kB
Progress (1): 27 kB
Progress (1): 28 kB
Progress (1): 31 kB
Progress (1): 33 kB
Progress (1): 36 kB
Progress (1): 40 kB
Progress (1): 41 kB
Progress (1): 46 kB
Progress (1): 48 kB
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/maven-parent/39/maven-parent-39.pom[90m (48 kB at 1.3 MB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/apache/29/apache-29.pom
Progress (1): 744 B
Progress (1): 2.1 kB
Progress (1): 3.3 kB
Progress (1): 5.2 kB
Progress (1): 10 kB 
Progress (1): 14 kB
Progress (1): 17 kB
Progress (1): 20 kB
Progress (1): 21 kB
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/apache/29/apache-29.pom[90m (21 kB at 740 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.jar
Progress (1): 0.9/31 kB
Progress (1): 2.3/31 kB
Progress (1): 3.6/31 kB
Progress (1): 5.0/31 kB
Progress (1): 6.4/31 kB
Progress (1): 7.7/31 kB
Progress (1): 9.1/31 kB
Progress (1): 10/31 kB 
Progress (1): 12/31 kB
Progress (1): 13/31 kB
Progress (1): 15/31 kB
Progress (1): 16/31 kB
Progress (1): 17/31 kB
Progress (1): 19/31 kB
Progress (1): 20/31 kB
Progress (1): 21/31 kB
Progress (1): 23/31 kB
Progress (1): 24/31 kB
Progress (1): 25/31 kB
Progress (1): 26/31 kB
Progress (1): 27/31 kB
Progress (1): 31 kB   
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/plugins/maven-resources-plugin/3.3.1/maven-resources-plugin-3.3.1.jar[90m (31 kB at 737 kB/s)[0m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mgit-commit-id:2.2.6:revision[m [1m(default)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] dotGitDirectory /testbed/.git
[[1;34mINFO[m] git.build.user.name 
[[1;34mINFO[m] git.build.user.email 
[[1;34mINFO[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] --always = true
[[1;34mINFO[m] --dirty = -dirty
[[1;34mINFO[m] --abbrev = 7
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] git.commit.id.describe 526a935
[[1;34mINFO[m] git.commit.id 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] git.commit.id.abbrev 526a935
[[1;34mINFO[m] git.dirty false
[[1;34mINFO[m] git.commit.user.name kl
[[1;34mINFO[m] git.commit.user.email chenkailing@xd.com
[[1;34mINFO[m] git.commit.message.full Fix Apollo checks the yaml format interface Response Code = 500  (#4567)

* fix(apollo-portal): Fix Apollo checks the yaml format interface Response Code = 500 #4566



* fix(apollo-portal): Fix yamlSyntaxCheck test cases



Co-authored-by: Jason Song <nobodyiam@gmail.com>
[[1;34mINFO[m] git.commit.message.short Fix Apollo checks the yaml format interface Response Code = 500  (#4567)
[[1;34mINFO[m] git.commit.time 2022-09-16T00:17:54+0000
[[1;34mINFO[m] git.remote.origin.url https://github.com/apolloconfig/apollo.git
[[1;34mINFO[m] git.tags tag-oidc-debug-log,tag-oidc-debug-log-2,v2.1.0,v2.2.0,v2.3.0,v2.4.0
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.name 
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.commit.count 
[[1;34mINFO[m] git.total.commit.count 2746
[[1;34mINFO[m] git.build.time 2025-11-12T11:29:35+0000
[[1;34mINFO[m] git.build.version 2.1.0-SNAPSHOT
[[1;34mINFO[m] git.build.host ucl-research
[[1;34mINFO[m] git.commit.id.describe-short 526a935
[[1;34mINFO[m] found property git.build.user.email
[[1;34mINFO[m] found property git.build.host
[[1;34mINFO[m] found property git.dirty
[[1;34mINFO[m] found property git.remote.origin.url
[[1;34mINFO[m] found property git.closest.tag.name
[[1;34mINFO[m] found property git.total.commit.count
[[1;34mINFO[m] found property git.commit.id.describe-short
[[1;34mINFO[m] found property git.commit.user.email
[[1;34mINFO[m] found property git.commit.time
[[1;34mINFO[m] found property git.commit.message.full
[[1;34mINFO[m] found property git.build.version
[[1;34mINFO[m] found property git.commit.message.short
[[1;34mINFO[m] found property git.commit.id.abbrev
[[1;34mINFO[m] found property git.branch
[[1;34mINFO[m] found property git.build.user.name
[[1;34mINFO[m] found property git.closest.tag.commit.count
[[1;34mINFO[m] found property git.commit.id.describe
[[1;34mINFO[m] found property git.commit.id
[[1;34mINFO[m] found property git.tags
[[1;34mINFO[m] found property git.build.time
[[1;34mINFO[m] found property git.commit.user.name
[[1;34mINFO[m] Reading existing properties file [/testbed/apollo-core/target/classes/apollo-git.properties] (for module Apollo Core)...
[[1;34mINFO[m] Writing properties file to [/testbed/apollo-core/target/classes/apollo-git.properties] (for module Apollo Core)...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:resources[m [1m(default-resources)[m @ [36mapollo-core[0;1m ---[m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.pom
Progress (1): 714 B
Progress (1): 2.4 kB
Progress (1): 4.4 kB
Progress (1): 8.6 kB
Progress (1): 8.8 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.pom[90m (8.8 kB at 365 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus/10/plexus-10.pom
Progress (1): 695 B
Progress (1): 2.7 kB
Progress (1): 6.4 kB
Progress (1): 9.2 kB
Progress (1): 11 kB 
Progress (1): 16 kB
Progress (1): 20 kB
Progress (1): 24 kB
Progress (1): 25 kB
Progress (1): 25 kB
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus/10/plexus-10.pom[90m (25 kB at 1.1 MB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.pom
Progress (1): 778 B
Progress (1): 2.2 kB
Progress (1): 5.6 kB
Progress (1): 6.0 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.pom[90m (6.0 kB at 274 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-shared-components/39/maven-shared-components-39.pom
Progress (1): 801 B
Progress (1): 2.2 kB
Progress (1): 3.2 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-shared-components/39/maven-shared-components-39.pom[90m (3.2 kB at 146 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.pom
Progress (1): 1.0 kB
Progress (1): 2.7 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.pom[90m (2.7 kB at 69 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.pom
Progress (1): 895 B
Progress (1): 3.2 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.pom[90m (3.2 kB at 134 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/spice/spice-parent/15/spice-parent-15.pom
Progress (1): 1.2 kB
Progress (1): 3.7 kB
Progress (1): 7.3 kB
Progress (1): 8.4 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/spice/spice-parent/15/spice-parent-15.pom[90m (8.4 kB at 334 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.0/plexus-utils-3.5.0.pom
Progress (1): 714 B
Progress (1): 2.3 kB
Progress (1): 4.5 kB
Progress (1): 8.0 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.0/plexus-utils-3.5.0.pom[90m (8.0 kB at 154 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.pom
Progress (1): 770 B
Progress (1): 2.1 kB
Progress (1): 5.2 kB
Progress (1): 7.8 kB
Progress (1): 10 kB 
Progress (1): 12 kB
Progress (1): 15 kB
Progress (1): 18 kB
Progress (1): 19 kB
Progress (1): 20 kB
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.pom[90m (20 kB at 759 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/junit/junit-bom/5.7.2/junit-bom-5.7.2.pom
Progress (1): 912 B
Progress (1): 4.3 kB
Progress (1): 5.1 kB
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/junit/junit-bom/5.7.2/junit-bom-5.7.2.pom[90m (5.1 kB at 204 kB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.jar
Progress (1): 3.8/269 kB
Progress (1): 8.0/269 kB
Progress (1): 8.2/269 kB
Progress (1): 12/269 kB 
Progress (1): 17/269 kB
Progress (1): 21/269 kB
Progress (1): 25/269 kB
Progress (1): 29/269 kB
Progress (1): 34/269 kB
Progress (1): 38/269 kB
Progress (1): 42/269 kB
Progress (1): 58/269 kB
Progress (1): 75/269 kB
Progress (1): 91/269 kB
Progress (1): 108/269 kB
Progress (1): 124/269 kB
Progress (1): 139/269 kB
Progress (1): 147/269 kB
Progress (1): 164/269 kB
Progress (1): 180/269 kB
Progress (1): 197/269 kB
Progress (1): 213/269 kB
Progress (1): 221/269 kB
Progress (1): 237/269 kB
Progress (1): 253/269 kB
Progress (1): 269 kB    
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/codehaus/plexus/plexus-utils/3.5.1/plexus-utils-3.5.1.jar[90m (269 kB at 4.2 MB/s)[0m
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.jar
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.jar
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.jar
[90mDownloading from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.jar
Progress (1): 7.7/55 kB
Progress (1): 8.2/55 kB
Progress (1): 25/55 kB 
Progress (1): 41/55 kB
Progress (1): 55 kB   
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/apache/maven/shared/maven-filtering/3.3.1/maven-filtering-3.3.1.jar[90m (55 kB at 1.8 MB/s)[0m
Progress (1): 0.9/8.5 kB
Progress (1): 2.3/8.5 kB
Progress (1): 3.6/8.5 kB
Progress (1): 5.0/8.5 kB
Progress (1): 6.4/8.5 kB
Progress (1): 7.7/8.5 kB
Progress (1): 8.2/8.5 kB
Progress (1): 8.5 kB    
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/sonatype/plexus/plexus-build-api/0.0.7/plexus-build-api-0.0.7.jar[90m (8.5 kB at 154 kB/s)[0m
Progress (1): 0.9/41 kB
Progress (1): 2.3/41 kB
Progress (1): 3.6/41 kB
Progress (1): 5.0/41 kB
Progress (1): 6.4/41 kB
Progress (1): 7.7/41 kB
Progress (1): 9.1/41 kB
Progress (1): 10/41 kB 
Progress (1): 12/41 kB
Progress (1): 13/41 kB
Progress (1): 15/41 kB
Progress (1): 16/41 kB
Progress (1): 17/41 kB
Progress (1): 19/41 kB
Progress (1): 20/41 kB
Progress (1): 21/41 kB
Progress (1): 23/41 kB
Progress (1): 24/41 kB
Progress (1): 25/41 kB
Progress (1): 26/41 kB
Progress (1): 27/41 kB
Progress (1): 29/41 kB
Progress (1): 30/41 kB
Progress (1): 31/41 kB
Progress (1): 33/41 kB
Progress (1): 34/41 kB
Progress (1): 36/41 kB
Progress (1): 37/41 kB
Progress (1): 38/41 kB
Progress (1): 40/41 kB
Progress (1): 41/41 kB
Progress (1): 41 kB   
                   
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0morg/slf4j/slf4j-api/1.7.36/slf4j-api-1.7.36.jar[90m (41 kB at 556 kB/s)[0m
Progress (1): 0.9/327 kB
Progress (1): 2.3/327 kB
Progress (1): 3.6/327 kB
Progress (1): 5.0/327 kB
Progress (1): 6.4/327 kB
Progress (1): 7.7/327 kB
Progress (1): 9.1/327 kB
Progress (1): 10/327 kB 
Progress (1): 12/327 kB
Progress (1): 13/327 kB
Progress (1): 15/327 kB
Progress (1): 16/327 kB
Progress (1): 17/327 kB
Progress (1): 19/327 kB
Progress (1): 20/327 kB
Progress (1): 21/327 kB
Progress (1): 23/327 kB
Progress (1): 24/327 kB
Progress (1): 26/327 kB
Progress (1): 27/327 kB
Progress (1): 28/327 kB
Progress (1): 30/327 kB
Progress (1): 31/327 kB
Progress (1): 32/327 kB
Progress (1): 34/327 kB
Progress (1): 35/327 kB
Progress (1): 36/327 kB
Progress (1): 38/327 kB
Progress (1): 39/327 kB
Progress (1): 41/327 kB
Progress (1): 42/327 kB
Progress (1): 43/327 kB
Progress (1): 45/327 kB
Progress (1): 46/327 kB
Progress (1): 47/327 kB
Progress (1): 49/327 kB
Progress (1): 50/327 kB
Progress (1): 52/327 kB
Progress (1): 53/327 kB
Progress (1): 54/327 kB
Progress (1): 56/327 kB
Progress (1): 57/327 kB
Progress (1): 62/327 kB
Progress (1): 66/327 kB
Progress (1): 70/327 kB
Progress (1): 74/327 kB
Progress (1): 78/327 kB
Progress (1): 83/327 kB
Progress (1): 87/327 kB
Progress (1): 91/327 kB
Progress (1): 95/327 kB
Progress (1): 100/327 kB
Progress (1): 104/327 kB
Progress (1): 108/327 kB
Progress (1): 112/327 kB
Progress (1): 117/327 kB
Progress (1): 121/327 kB
Progress (1): 125/327 kB
Progress (1): 129/327 kB
Progress (1): 133/327 kB
Progress (1): 138/327 kB
Progress (1): 142/327 kB
Progress (1): 146/327 kB
Progress (1): 150/327 kB
Progress (1): 155/327 kB
Progress (1): 159/327 kB
Progress (1): 163/327 kB
Progress (1): 167/327 kB
Progress (1): 172/327 kB
Progress (1): 176/327 kB
Progress (1): 180/327 kB
Progress (1): 184/327 kB
Progress (1): 188/327 kB
Progress (1): 193/327 kB
Progress (1): 197/327 kB
Progress (1): 201/327 kB
Progress (1): 205/327 kB
Progress (1): 210/327 kB
Progress (1): 214/327 kB
Progress (1): 218/327 kB
Progress (1): 222/327 kB
Progress (1): 239/327 kB
Progress (1): 255/327 kB
Progress (1): 271/327 kB
Progress (1): 288/327 kB
Progress (1): 304/327 kB
Progress (1): 319/327 kB
Progress (1): 327 kB    
                    
Downloaded[90m from [0mcentral[90m: https://repo.maven.apache.org/maven2/[0mcommons-io/commons-io/2.11.0/commons-io-2.11.0.jar[90m (327 kB at 2.8 MB/s)[0m
[[1;34mINFO[m] Copying 0 resource from src/main/resources to target/classes
[[1;34mINFO[m] Copying 3 resources from src/main/resources to target/classes
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-core/src/main/config
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-core/src/main/config
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mflatten:1.1.0:flatten[m [1m(flatten)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-core:jar:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:compile[m [1m(default-compile)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:testResources[m [1m(default-testResources)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] Copying 15 resources from src/test/resources to target/test-classes
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:testCompile[m [1m(default-testCompile)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32msurefire:2.22.2:test[m [1m(default-test)[m @ [36mapollo-core[0;1m ---[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--------------< [0;36mcom.ctrip.framework.apollo:apollo-common[0;1m >--------------[m
[[1;34mINFO[m] [1mBuilding Apollo Common 2.1.0-SNAPSHOT                              [3/5][m
[[1;34mINFO[m]   from apollo-common/pom.xml
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mgit-commit-id:2.2.6:revision[m [1m(default)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] dotGitDirectory /testbed/.git
[[1;34mINFO[m] git.build.user.name 
[[1;34mINFO[m] git.build.user.email 
[[1;34mINFO[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] --always = true
[[1;34mINFO[m] --dirty = -dirty
[[1;34mINFO[m] --abbrev = 7
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.name 
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.commit.count 
[[1;34mINFO[m] git.total.commit.count 2746
[[1;34mINFO[m] git.build.time 2025-11-12T11:29:36+0000
[[1;34mINFO[m] git.build.version 2.1.0-SNAPSHOT
[[1;34mINFO[m] git.build.host ucl-research
[[1;34mINFO[m] git.commit.id.describe-short 526a935
[[1;34mINFO[m] found property git.build.user.email
[[1;34mINFO[m] found property git.build.host
[[1;34mINFO[m] found property git.dirty
[[1;34mINFO[m] found property git.remote.origin.url
[[1;34mINFO[m] found property git.closest.tag.name
[[1;34mINFO[m] found property git.total.commit.count
[[1;34mINFO[m] found property git.commit.id.describe-short
[[1;34mINFO[m] found property git.commit.user.email
[[1;34mINFO[m] found property git.commit.time
[[1;34mINFO[m] found property git.commit.message.full
[[1;34mINFO[m] found property git.build.version
[[1;34mINFO[m] found property git.commit.message.short
[[1;34mINFO[m] found property git.commit.id.abbrev
[[1;34mINFO[m] found property git.branch
[[1;34mINFO[m] found property git.build.user.name
[[1;34mINFO[m] found property git.closest.tag.commit.count
[[1;34mINFO[m] found property git.commit.id.describe
[[1;34mINFO[m] found property git.commit.id
[[1;34mINFO[m] found property git.tags
[[1;34mINFO[m] found property git.build.time
[[1;34mINFO[m] found property git.commit.user.name
[[1;34mINFO[m] Reading existing properties file [/testbed/apollo-common/target/classes/apollo-git.properties] (for module Apollo Common)...
[[1;34mINFO[m] Writing properties file to [/testbed/apollo-common/target/classes/apollo-git.properties] (for module Apollo Common)...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:resources[m [1m(default-resources)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] Copying 4 resources from src/main/resources to target/classes
[[1;34mINFO[m] Copying 1 resource from src/main/resources to target/classes
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-common/src/main/config
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-common/src/main/config
[[1;34mINFO[m] The encoding used to copy filtered properties files have not been set. This means that the same encoding will be used to copy filtered properties files as when copying other filtered resources. This might not be what you want! Run your build with --debug to see which files might be affected. Read more at https://maven.apache.org/plugins/maven-resources-plugin/examples/filtering-properties-files.html
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mflatten:1.1.0:flatten[m [1m(flatten)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-common:jar:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:compile[m [1m(default-compile)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:testResources[m [1m(default-testResources)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-common/src/test/resources
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:testCompile[m [1m(default-testCompile)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32msurefire:2.22.2:test[m [1m(default-test)[m @ [36mapollo-common[0;1m ---[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m---------------< [0;36mcom.ctrip.framework.apollo:apollo-biz[0;1m >----------------[m
[[1;34mINFO[m] [1mBuilding Apollo Biz 2.1.0-SNAPSHOT                                 [4/5][m
[[1;34mINFO[m]   from apollo-biz/pom.xml
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mgit-commit-id:2.2.6:revision[m [1m(default)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] dotGitDirectory /testbed/.git
[[1;34mINFO[m] git.build.user.name 
[[1;34mINFO[m] git.build.user.email 
[[1;34mINFO[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] --always = true
[[1;34mINFO[m] --dirty = -dirty
[[1;34mINFO[m] --abbrev = 7
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.name 
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.commit.count 
[[1;34mINFO[m] git.total.commit.count 2746
[[1;34mINFO[m] git.build.time 2025-11-12T11:29:37+0000
[[1;34mINFO[m] git.build.version 2.1.0-SNAPSHOT
[[1;34mINFO[m] git.build.host ucl-research
[[1;34mINFO[m] git.commit.id.describe-short 526a935
[[1;34mINFO[m] found property git.build.user.email
[[1;34mINFO[m] found property git.build.host
[[1;34mINFO[m] found property git.dirty
[[1;34mINFO[m] found property git.remote.origin.url
[[1;34mINFO[m] found property git.closest.tag.name
[[1;34mINFO[m] found property git.total.commit.count
[[1;34mINFO[m] found property git.commit.id.describe-short
[[1;34mINFO[m] found property git.commit.user.email
[[1;34mINFO[m] found property git.commit.time
[[1;34mINFO[m] found property git.commit.message.full
[[1;34mINFO[m] found property git.build.version
[[1;34mINFO[m] found property git.commit.message.short
[[1;34mINFO[m] found property git.commit.id.abbrev
[[1;34mINFO[m] found property git.branch
[[1;34mINFO[m] found property git.build.user.name
[[1;34mINFO[m] found property git.closest.tag.commit.count
[[1;34mINFO[m] found property git.commit.id.describe
[[1;34mINFO[m] found property git.commit.id
[[1;34mINFO[m] found property git.tags
[[1;34mINFO[m] found property git.build.time
[[1;34mINFO[m] found property git.commit.user.name
[[1;34mINFO[m] Reading existing properties file [/testbed/apollo-biz/target/classes/apollo-git.properties] (for module Apollo Biz)...
[[1;34mINFO[m] Writing properties file to [/testbed/apollo-biz/target/classes/apollo-git.properties] (for module Apollo Biz)...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:resources[m [1m(default-resources)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/resources
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/resources
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/config
[[1;34mINFO[m] skip non existing resourceDirectory /testbed/apollo-biz/src/main/config
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mflatten:1.1.0:flatten[m [1m(flatten)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-biz:jar:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:compile[m [1m(default-compile)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:testResources[m [1m(default-testResources)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] Copying 9 resources from src/test/resources to target/test-classes
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:testCompile[m [1m(default-testCompile)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32msurefire:2.22.2:test[m [1m(default-test)[m @ [36mapollo-biz[0;1m ---[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m----------< [0;36mcom.ctrip.framework.apollo:apollo-configservice[0;1m >-----------[m
[[1;34mINFO[m] [1mBuilding Apollo ConfigService 2.1.0-SNAPSHOT                       [5/5][m
[[1;34mINFO[m]   from apollo-configservice/pom.xml
[[1;34mINFO[m] [1m--------------------------------[ jar ]---------------------------------[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mgit-commit-id:2.2.6:revision[m [1m(default)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] dotGitDirectory /testbed/.git
[[1;34mINFO[m] git.build.user.name 
[[1;34mINFO[m] git.build.user.email 
[[1;34mINFO[m] git.branch 526a93506ee380a009dc20a9ab870a37367f983f
[[1;34mINFO[m] --always = true
[[1;34mINFO[m] --dirty = -dirty
[[1;34mINFO[m] --abbrev = 7
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.name 
[[1;34mINFO[m] evalCommit is [526a93506ee380a009dc20a9ab870a37367f983f]
[[1;34mINFO[m] Tag refs [[Ref[refs/tags/0.6.2=d327f0703f690457220fb355e969562b75e6aee0], Ref[refs/tags/tag-oidc-debug-log=16f4e06379e78e1f03b9b89b5e491bf92fd71d45], Ref[refs/tags/tag-oidc-debug-log-2=af85fa7cde33706fcae6b5c07ce4fd11cdbb3ce6], Ref[refs/tags/v0.10.0=37b6485c7605ccc4b8620d27d1414736369af291], Ref[refs/tags/v0.10.1=6b2467df6aa3c286102219e1c5b50efeeb68f747], Ref[refs/tags/v0.10.2=03825fa89b799a19be7f3bf0570f4e0c09b92cef], Ref[refs/tags/v0.11.0=be40a4bc28db310eb2a7d670e55337b5c2eedc1a], Ref[refs/tags/v0.4.0=2219b0a23544b06a138fdfbc34a4320b2d9e00b5], Ref[refs/tags/v0.5.0=f5373b19100766c136aa4980edcf17e41975ee76], Ref[refs/tags/v0.6.0=d0fdd72846a0b2530ca9bc1743b3f52e864ab6ed], Ref[refs/tags/v0.6.3=8372040f85896a93b60ccb14610c2bee2dcc9683], Ref[refs/tags/v0.7.0=aeb9230b228b641db443d0d0a9b64bca1ceed9fc], Ref[refs/tags/v0.8.0=5bcb4095bbfdbdfbe4e176e00d3ce9bdc1a099d7], Ref[refs/tags/v0.9.0=2f3204d4181f5d35d7ee2ac5dc3b2c632be7f05a], Ref[refs/tags/v0.9.1=ac10768ee2e11c488523ca0e845984f6f71499ac], Ref[refs/tags/v1.0.0=a3cf5b2b6d8462e37dc90f327e064964323d2a80], Ref[refs/tags/v1.1.0=7b8ccbe13c2902ebdd3dcffd5d6dd43dd824ce80], Ref[refs/tags/v1.1.1=c22ac5637432c3c557bd857314401a3983e704d2], Ref[refs/tags/v1.1.2=3a8e92c9c2d0abefa89a8e693c0bfa58ccf2d675], Ref[refs/tags/v1.2.0=dcc49834f2e3b12738c83078d19acebd2e336dc1], Ref[refs/tags/v1.3.0=d1ae147711af31ea522f988acb36a5c1bf3a4456], Ref[refs/tags/v1.4.0=6b0a06a4682e8171cc17f5f61ccc8d87f6871b6d], Ref[refs/tags/v1.5.0=0d824bb9085c66d3e1bcb8e09f53cf16a978715c], Ref[refs/tags/v1.5.1=c9eae5410524957ebca97d85eb00eb38fa266125], Ref[refs/tags/v1.6.0=a2ae4ad8a8442c7f7842803b50b7783997d2b984], Ref[refs/tags/v1.6.1=f34231b223bdabb4ffcb232c3703129f71cbaad8], Ref[refs/tags/v1.6.2=a4ee45b3db9fd3176f67508648684a617b2254bf], Ref[refs/tags/v1.7.0=27aa832c8dba550aa12184fc106790bbe10791e8], Ref[refs/tags/v1.7.1=f28d0d5a300070795fba5b61f0bee624ab6f814d], Ref[refs/tags/v1.7.2=b2cb90e93dbb2eea3b94783a1a922afbd1fb6063], Ref[refs/tags/v1.8.0=891010618214b8e826b3c124f5572988135ade58], Ref[refs/tags/v1.8.1=08754ff73c849763f703a3dfb416393c3ccd147e], Ref[refs/tags/v1.8.2=7c486fa11e146d4bad65c69611614211bf56c42a], Ref[refs/tags/v1.9.0=772d2fa862b6622bbeb31b50437680887a35e749], Ref[refs/tags/v1.9.1=501e4b95db4f37bba411266ff24e7d7f460649b8], Ref[refs/tags/v1.9.2=e4516e38226b28d321135311f5fe23723ea63bc6], Ref[refs/tags/v2.0.0=cb308cb7a9b08178046f747c1f02c8385eeca28c], Ref[refs/tags/v2.0.0-RC1=a882f3e8a0fec0e36d2cfcbc1ca44f0818d7b1cd], Ref[refs/tags/v2.0.1=e04028dfe9ca3e5792be89b96a6fbd2ee80355b7], Ref[refs/tags/v2.1.0=60bd514df37a8cb2268a5e945a862dc86bd81445], Ref[refs/tags/v2.2.0=ee1517be717283ae5bbb990fd2c5a809bd841b4b], Ref[refs/tags/v2.3.0=c28eb49ac0f2bf5cb0f68fd3deccd192709f996f], Ref[refs/tags/v2.4.0=a070aa11b81b84bc500a575bc41937c3522fea1e]]]
[[1;34mINFO[m] Created map: [{}]
[[1;34mINFO[m] git.closest.tag.commit.count 
[[1;34mINFO[m] git.total.commit.count 2746
[[1;34mINFO[m] git.build.time 2025-11-12T11:29:38+0000
[[1;34mINFO[m] git.build.version 2.1.0-SNAPSHOT
[[1;34mINFO[m] git.build.host ucl-research
[[1;34mINFO[m] git.commit.id.describe-short 526a935
[[1;34mINFO[m] found property git.build.user.email
[[1;34mINFO[m] found property git.build.host
[[1;34mINFO[m] found property git.dirty
[[1;34mINFO[m] found property git.remote.origin.url
[[1;34mINFO[m] found property git.closest.tag.name
[[1;34mINFO[m] found property git.total.commit.count
[[1;34mINFO[m] found property git.commit.id.describe-short
[[1;34mINFO[m] found property git.commit.user.email
[[1;34mINFO[m] found property git.commit.time
[[1;34mINFO[m] found property git.commit.message.full
[[1;34mINFO[m] found property git.build.version
[[1;34mINFO[m] found property git.commit.message.short
[[1;34mINFO[m] found property git.commit.id.abbrev
[[1;34mINFO[m] found property git.branch
[[1;34mINFO[m] found property git.build.user.name
[[1;34mINFO[m] found property git.closest.tag.commit.count
[[1;34mINFO[m] found property git.commit.id.describe
[[1;34mINFO[m] found property git.commit.id
[[1;34mINFO[m] found property git.tags
[[1;34mINFO[m] found property git.build.time
[[1;34mINFO[m] found property git.commit.user.name
[[1;34mINFO[m] Reading existing properties file [/testbed/apollo-configservice/target/classes/apollo-git.properties] (for module Apollo ConfigService)...
[[1;34mINFO[m] Writing properties file to [/testbed/apollo-configservice/target/classes/apollo-git.properties] (for module Apollo ConfigService)...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:resources[m [1m(default-resources)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] Copying 9 resources from src/main/resources to target/classes
[[1;34mINFO[m] Copying 0 resource from src/main/resources to target/classes
[[1;34mINFO[m] Copying 1 resource from src/main/config to target/classes
[[1;34mINFO[m] Copying 2 resources from src/main/config to target/classes
[[1;34mINFO[m] The encoding used to copy filtered properties files have not been set. This means that the same encoding will be used to copy filtered properties files as when copying other filtered resources. This might not be what you want! Run your build with --debug to see which files might be affected. Read more at https://maven.apache.org/plugins/maven-resources-plugin/examples/filtering-properties-files.html
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mflatten:1.1.0:flatten[m [1m(flatten)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] Generating flattened POM of project com.ctrip.framework.apollo:apollo-configservice:jar:2.1.0-SNAPSHOT...
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:compile[m [1m(default-compile)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mresources:3.3.1:testResources[m [1m(default-testResources)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] Copying 11 resources from src/test/resources to target/test-classes
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32mcompiler:3.10.1:testCompile[m [1m(default-testCompile)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] Nothing to compile - all classes are up to date
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m--- [0;32msurefire:2.22.2:test[m [1m(default-test)[m @ [36mapollo-configservice[0;1m ---[m
[[1;34mINFO[m] 
[[1;34mINFO[m] -------------------------------------------------------
[[1;34mINFO[m]  T E S T S
[[1;34mINFO[m] -------------------------------------------------------
[[1;34mINFO[m] Running com.ctrip.framework.apollo.configservice.controller.[1mConfigControllerTest[m
[[1;34mINFO[m] [1;32mTests run: [0;1;32m3[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.901 s - in com.ctrip.framework.apollo.configservice.controller.[1mConfigControllerTest[m
[[1;34mINFO[m] Running com.ctrip.framework.apollo.configservice.util.[1mNamespaceUtilTest[m
[[1;34mINFO[m] [1;32mTests run: [0;1;32m2[m, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.001 s - in com.ctrip.framework.apollo.configservice.util.[1mNamespaceUtilTest[m
[[1;34mINFO[m] 
[[1;34mINFO[m] Results:
[[1;34mINFO[m] 
[[1;34mINFO[m] [1;32mTests run: 5, Failures: 0, Errors: 0, Skipped: 0[m
[[1;34mINFO[m] 
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] [1mReactor Summary for Apollo 2.1.0-SNAPSHOT:[m
[[1;34mINFO[m] 
[[1;34mINFO[m] Apollo ............................................. [1;32mSUCCESS[m [  0.802 s]
[[1;34mINFO[m] Apollo Core ........................................ [1;32mSUCCESS[m [  2.867 s]
[[1;34mINFO[m] Apollo Common ...................................... [1;32mSUCCESS[m [  0.807 s]
[[1;34mINFO[m] Apollo Biz ......................................... [1;32mSUCCESS[m [  0.765 s]
[[1;34mINFO[m] Apollo ConfigService ............................... [1;32mSUCCESS[m [  2.911 s]
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] [1;32mBUILD SUCCESS[m
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
[[1;34mINFO[m] Total time:  8.473 s
[[1;34mINFO[m] Finished at: 2025-11-12T11:29:40Z
[[1;34mINFO[m] [1m------------------------------------------------------------------------[m
--- END LOG ---

Please analyze the logs and determine which regression tests passed!. You should return the exact test identifier 
that we give to you.
Don't forget to return the total number of tests run!

2025-11-12 11:32:50,581 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_structure_node - DEBUG - passed_regression_tests=['com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfig', 'com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithAppOwnNamespace', 'com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithPubicNamespaceAndNoAppOverride', 'com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPrivateNamespace', 'com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPublicNamespace'] regression_test_fail_log='' total_tests_run=5
2025-11-12 11:32:50,583 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - INFO - passed_regression_tests: ['com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfig', 'com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithAppOwnNamespace', 'com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithPubicNamespaceAndNoAppOverride', 'com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPrivateNamespace', 'com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPublicNamespace']
2025-11-12 11:32:50,583 - thread-135845287823040.prometheus.lang_graph.nodes.run_regression_tests_subgraph_node - DEBUG - regression_test_fail_log: 
2025-11-12 11:32:50,584 - thread-135845287823040.prometheus.lang_graph.nodes.bug_get_regression_tests_subgraph_node - DEBUG - Selected 5 regression tests: ['com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfig', 'com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithAppOwnNamespace', 'com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest::testQueryConfigWithPubicNamespaceAndNoAppOverride', 'com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPrivateNamespace', 'com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest::testNormalizeNamespaceWithPublicNamespace']
2025-11-12 11:32:50,586 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - Enter bug_reproduction_subgraph
2025-11-12 11:32:50,589 - thread-135845287823040.prometheus.lang_graph.nodes.issue_bug_reproduction_context_message_node - DEBUG - Sending query to context provider subgraph:
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

2025-11-12 11:32:50,590 - thread-135845287823040.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-12 11:32:50,592 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:33:07,252 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The file tree shows multiple test directories but no test file contents. The task requires returning 5 complete, self-contained test cases with all imports, setup, mocks, assertions, helper functions, and exact file paths and line numbers. Without the actual test code, we cannot identify or extract relevant cases, particularly those dealing with namespace creation/querying and special-character (single dot) names that may trigger 500 errors. Therefore, we need the specific test files covering namespace creation and querying in the relevant modules.' query='Please provide the full content (with line numbers) of all test files related to namespace creation and querying under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-configservice/src/test/java, and apollo-biz/src/test/java (especially files/classes containing “Namespace”).' extra_requirements='If the full directories are too large, include at minimum the imports, test setup/mocks, helper functions, and all test methods that validate namespace names (including single dot “.” cases), with exact file paths and line numbers.' purpose='I need these tests to extract 5 self-contained cases demonstrating behavior when creating and querying namespaces, especially with dot-named namespaces causing 500 errors.'
2025-11-12 11:33:07,253 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content (with line numbers) of all test files related to namespace creation and querying under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-configservice/src/test/java, and apollo-biz/src/test/java (especially files/classes containing “Namespace”).
2025-11-12 11:33:07,601 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 11:33:07,602 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 11:33:07,602 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 11:33:07,602 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 11:33:07,603 - thread-135845287823040.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 11:33:07,604 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 11:33:07,604 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content (with line numbers) of all test files related to namespace creation and querying under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-configservice/src/test/java, and apollo-biz/src/test/java (especially files/classes containing “Namespace”).
Extra requirements: If the full directories are too large, include at minimum the imports, test setup/mocks, helper functions, and all test methods that validate namespace names (including single dot “.” cases), with exact file paths and line numbers.
Purpose: I need these tests to extract 5 self-contained cases demonstrating behavior when creating and querying namespaces, especially with dot-named namespaces causing 500 errors.
2025-11-12 11:33:18,885 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JU4IAlbbghYzedMv0t2fnJqe', 'function': {'arguments': '{"basename":"NamespaceControllerTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 863, 'prompt_tokens': 2303, 'total_tokens': 3166, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8a2e99b4-0a4f-4948-a000-298748cf4319-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceControllerTest.java'}, 'id': 'call_JU4IAlbbghYzedMv0t2fnJqe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2303, 'output_tokens': 863, 'total_tokens': 3166, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 11:33:24,592 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_5QcifCJIqTGo537Kvo1lgnjj', 'function': {'arguments': '{"basename":"NamespaceServiceTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 415, 'prompt_tokens': 2447, 'total_tokens': 2862, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2176}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ff4236d3-84dc-4a46-bfd8-0589832afcc8-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceServiceTest.java'}, 'id': 'call_5QcifCJIqTGo537Kvo1lgnjj', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2447, 'output_tokens': 415, 'total_tokens': 2862, 'input_token_details': {'audio': 0, 'cache_read': 2176}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 11:33:37,406 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Ilj2WfnXZH9eOuHHibZ2siTb', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 884, 'prompt_tokens': 2589, 'total_tokens': 3473, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6db91dcd-016f-45fd-9daf-1707293884cb-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java'}, 'id': 'call_Ilj2WfnXZH9eOuHHibZ2siTb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2589, 'output_tokens': 884, 'total_tokens': 3473, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 11:33:48,788 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Vurz8vflJ6miDFcpEUstMejr', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1138, 'prompt_tokens': 3445, 'total_tokens': 4583, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1088, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--092c5e9b-eaed-422d-9570-a327600af11f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java'}, 'id': 'call_Vurz8vflJ6miDFcpEUstMejr', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3445, 'output_tokens': 1138, 'total_tokens': 4583, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1088}}
2025-11-12 11:33:54,048 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_N3ld8P7u3cQz1RoifV6iqo9G', 'function': {'arguments': '{"basename":"AppNamespaceControllerTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 544, 'prompt_tokens': 4132, 'total_tokens': 4676, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3328}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0036c694-05ee-4842-b24e-1356d6f37023-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceControllerTest.java'}, 'id': 'call_N3ld8P7u3cQz1RoifV6iqo9G', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4132, 'output_tokens': 544, 'total_tokens': 4676, 'input_token_details': {'audio': 0, 'cache_read': 3328}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 11:33:55,021 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ifn3hC559Zko38Swb7iVLmHs', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 4224, 'total_tokens': 4268, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4096}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c0098e6e-9fc5-49b6-b1d5-7c747b6639fd-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java'}, 'id': 'call_ifn3hC559Zko38Swb7iVLmHs', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4224, 'output_tokens': 44, 'total_tokens': 4268, 'input_token_details': {'audio': 0, 'cache_read': 4096}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:34:04,164 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZETJyKNKYWl591mzJgoGQama', 'function': {'arguments': '{"basename":"NamespaceTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 606, 'prompt_tokens': 5070, 'total_tokens': 5676, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--eff69d1e-0b90-45cc-9a89-aec10ae581d0-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceTest.java'}, 'id': 'call_ZETJyKNKYWl591mzJgoGQama', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5070, 'output_tokens': 606, 'total_tokens': 5676, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 11:34:18,485 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_NvTVsPDgUHSxjfujDAjAq8k5', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1330, 'prompt_tokens': 5120, 'total_tokens': 6450, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1280, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--006b3d9f-cc74-4b2c-aee4-0aff1bdd8ffc-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java'}, 'id': 'call_NvTVsPDgUHSxjfujDAjAq8k5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5120, 'output_tokens': 1330, 'total_tokens': 6450, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1280}}
2025-11-12 11:34:20,037 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_aiq0FwEviLbgBmjBp0IXQGiX', 'function': {'arguments': '{"relative_path":"apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 8618, 'total_tokens': 8662, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4992}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9c1bf777-e035-4733-8a4b-8013fe8d9e0b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java'}, 'id': 'call_aiq0FwEviLbgBmjBp0IXQGiX', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8618, 'output_tokens': 44, 'total_tokens': 8662, 'input_token_details': {'audio': 0, 'cache_read': 4992}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:34:28,685 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Js2UqiizI0TbgDfCNuFxI62p', 'function': {'arguments': '{"basename":"AppNamespaceServiceTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 736, 'prompt_tokens': 9709, 'total_tokens': 10445, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--83d87cc9-91b2-4a70-8b79-d2014c7323f9-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceServiceTest.java'}, 'id': 'call_Js2UqiizI0TbgDfCNuFxI62p', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9709, 'output_tokens': 736, 'total_tokens': 10445, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-12 11:34:30,101 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_SIoTQYMHRvmqtX24ZHobbM4W', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 9801, 'total_tokens': 9845, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4992}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--122683dc-a2e2-4c3d-94e8-f9a6370f345d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java'}, 'id': 'call_SIoTQYMHRvmqtX24ZHobbM4W', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9801, 'output_tokens': 44, 'total_tokens': 9845, 'input_token_details': {'audio': 0, 'cache_read': 4992}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:34:52,271 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_iBn9BcuJudK9iqfi0GrKYNx9', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/NamespaceControllerTest.java"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1457, 'prompt_tokens': 12988, 'total_tokens': 14445, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1408, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--18ddeb34-dcbe-4001-be99-76eb10497190-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/NamespaceControllerTest.java'}, 'id': 'call_iBn9BcuJudK9iqfi0GrKYNx9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12988, 'output_tokens': 1457, 'total_tokens': 14445, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1408}}
2025-11-12 11:35:04,036 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_IIQh9xIUgSZpCcx7FZoYYbpk', 'function': {'arguments': '{"basename":"NamespaceBranchServiceTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 864, 'prompt_tokens': 13057, 'total_tokens': 13921, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d5aec53e-d6de-4555-88fe-77d0c8a81c35-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceBranchServiceTest.java'}, 'id': 'call_IIQh9xIUgSZpCcx7FZoYYbpk', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13057, 'output_tokens': 864, 'total_tokens': 13921, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 11:35:05,808 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_U4TpxJpzQv7S3FXiieHLdme3', 'function': {'arguments': '{"relative_path":"apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 45, 'prompt_tokens': 13150, 'total_tokens': 13195, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a02fed1b-e9e2-4bc1-aa31-925d4b785908-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java'}, 'id': 'call_U4TpxJpzQv7S3FXiieHLdme3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13150, 'output_tokens': 45, 'total_tokens': 13195, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:35:11,316 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Pzl7mteWAUtCPkkcFpiFOPrO', 'function': {'arguments': '{"basename":"ConfigControllerTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 479, 'prompt_tokens': 16060, 'total_tokens': 16539, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4224}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--671923aa-d04a-464c-8132-17e846d82781-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ConfigControllerTest.java'}, 'id': 'call_Pzl7mteWAUtCPkkcFpiFOPrO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16060, 'output_tokens': 479, 'total_tokens': 16539, 'input_token_details': {'audio': 0, 'cache_read': 4224}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-12 11:35:13,099 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_FXhU8pqr5HjUWNG5V0NoUwpg', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 16150, 'total_tokens': 16194, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 8576}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--277b2ff9-bf1a-42e3-890d-cbfa92d6b1b0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java'}, 'id': 'call_FXhU8pqr5HjUWNG5V0NoUwpg', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16150, 'output_tokens': 44, 'total_tokens': 16194, 'input_token_details': {'audio': 0, 'cache_read': 8576}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:35:19,130 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_bwgs32Gg0TvdgeKh1qBhCQdm', 'function': {'arguments': '{"basename":"NamespaceUtilTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 607, 'prompt_tokens': 23286, 'total_tokens': 23893, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 16000}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--377cfd6c-9e03-42f7-a2a0-ed067a069150-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceUtilTest.java'}, 'id': 'call_bwgs32Gg0TvdgeKh1qBhCQdm', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23286, 'output_tokens': 607, 'total_tokens': 23893, 'input_token_details': {'audio': 0, 'cache_read': 16000}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 11:35:21,024 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VNnZ6wz4ls4hsaAlRK3SBcDQ', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 23376, 'total_tokens': 23420, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f2816ba8-1654-4810-aee7-24367050075b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java'}, 'id': 'call_VNnZ6wz4ls4hsaAlRK3SBcDQ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 23376, 'output_tokens': 44, 'total_tokens': 23420, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:35:27,349 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_8n9Rgy2QSsMCa6I1zeH4NanE', 'function': {'arguments': '{"basename":"NamespaceControllerIntegrationTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 544, 'prompt_tokens': 25016, 'total_tokens': 25560, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 23168}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--54c01b02-ba0e-4131-92d0-d285398edb96-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceControllerIntegrationTest.java'}, 'id': 'call_8n9Rgy2QSsMCa6I1zeH4NanE', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25016, 'output_tokens': 544, 'total_tokens': 25560, 'input_token_details': {'audio': 0, 'cache_read': 23168}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 11:35:41,534 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0eqGjsBoT3xJOblifjK1JAG8', 'function': {'arguments': '{"basename":"InputValidatorTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1183, 'prompt_tokens': 25068, 'total_tokens': 26251, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1152, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--aa6ae84b-6a18-4e5c-9aab-d80c8d1047bd-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'InputValidatorTest.java'}, 'id': 'call_0eqGjsBoT3xJOblifjK1JAG8', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25068, 'output_tokens': 1183, 'total_tokens': 26251, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1152}}
2025-11-12 11:35:51,266 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_dXr89Cvg4Eeb4GrVdcAYB4Bn', 'function': {'arguments': '{"basename":"AppNamespaceServiceWithCacheTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 802, 'prompt_tokens': 25155, 'total_tokens': 25957, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 24960}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0c9521eb-7e59-4e2b-a766-9ee42e8ee7f3-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceServiceWithCacheTest.java'}, 'id': 'call_dXr89Cvg4Eeb4GrVdcAYB4Bn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25155, 'output_tokens': 802, 'total_tokens': 25957, 'input_token_details': {'audio': 0, 'cache_read': 24960}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 11:35:52,856 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_yUFC3FSz4QiC5JfdFZ8wzs6w', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCacheTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 46, 'prompt_tokens': 25253, 'total_tokens': 25299, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 23296}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ecdcf04b-35ca-4230-9fbc-5c47b51fcc42-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCacheTest.java'}, 'id': 'call_yUFC3FSz4QiC5JfdFZ8wzs6w', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25253, 'output_tokens': 46, 'total_tokens': 25299, 'input_token_details': {'audio': 0, 'cache_read': 23296}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:36:23,962 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located and read the full contents (with line numbers) of the key namespace-related test files across apollo-portal, apollo-adminservice, apollo-configservice, and apollo-biz. These include NamespaceController tests (portal/adminservice), NamespaceService tests (portal/biz), AppNamespaceControllerTest, NamespaceBranchServiceTest, ConfigControllerTest, NamespaceUtilTest, and AppNamespaceServiceWithCacheTest. The outputs include imports, setup/mocks, helper functions, and test methods validating namespace names and handling dot-suffix cases; controller tests also surface invalid-name errors via InputValidator messages. This should give you at least five self-contained cases for creating/querying namespaces, including scenarios relevant to dot-named namespaces triggering errors.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2527, 'prompt_tokens': 29855, 'total_tokens': 32382, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2368, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2560}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--54ca5afb-7c10-4985-9705-36e9c5ce4806-0' usage_metadata={'input_tokens': 29855, 'output_tokens': 2527, 'total_tokens': 32382, 'input_token_details': {'audio': 0, 'cache_read': 2560}, 'output_token_details': {'audio': 0, 'reasoning': 2368}}
2025-11-12 11:36:23,966 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content (with line numbers) of all test files related to namespace creation and querying under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-configservice/src/test/java, and apollo-biz/src/test/java (especially files/classes containing “Namespace”).
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If the full directories are too large, include at minimum the imports, test setup/mocks, helper functions, and all test methods that validate namespace names (including single dot “.” cases), with exact file paths and line numbers.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
I need these tests to extract 5 self-contained cases demonstrating behavior when creating and querying namespaces, especially with dot-named namespaces causing 500 errors.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java
Line number range: 1 - 62
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;
20. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
21. import com.ctrip.framework.apollo.common.entity.AppNamespace;
22. 
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.jdbc.Sql;
27. 
28. public class AppNamespaceControllerTest extends AbstractControllerTest{
29. 
30.   @Autowired
31.   private AppNamespaceRepository namespaceRepository;
32. 
33.   @Test
34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
35.   public void testCreate(){
36.     String appId = "6666";
37.     String name = "testnamespace";
38.     String comment = "comment";
39.     AppNamespaceDTO dto = new AppNamespaceDTO();
40.     dto.setAppId(appId);
41.     dto.setName(name);
42.     dto.setComment(comment);
43.     dto.setDataChangeCreatedBy("apollo");
44. 
45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(
46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();
47. 
48.     Assert.assertEquals(appId, resultDto.getAppId());
49.     Assert.assertTrue(resultDto.getId() > 0);
50. 
51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);
52.     Assert.assertNotNull(savedAppNs);
53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());
54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());
55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());
56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());
57. 
58. 
59. 
60. 
61.   }
62. }


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java
Line number range: 1 - 47
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import org.junit.Assert;
22. import org.junit.Test;
23. import org.springframework.web.client.HttpClientErrorException;
24. import static org.hamcrest.Matchers.containsString;
25. 
26. /**
27.  * Created by kezhenxu at 2019/1/8 16:27.
28.  *
29.  * @author kezhenxu (kezhenxu94@163.com)
30.  */
31. public class NamespaceControllerTest extends AbstractControllerTest {
32.   @Test
33.   public void create() {
34.     try {
35.       NamespaceDTO namespaceDTO = new NamespaceDTO();
36.       namespaceDTO.setClusterName("cluster");
37.       namespaceDTO.setNamespaceName("invalid name");
38.       namespaceDTO.setAppId("whatever");
39.       restTemplate.postForEntity(
40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),
41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());
42.       Assert.fail("Should throw");
43.     } catch (HttpClientErrorException e) {
44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
45.     }
46.   }
47. }


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceBranchServiceTest.java
Line number range: 1 - 208
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. import com.ctrip.framework.apollo.biz.AbstractIntegrationTest;
20. import com.ctrip.framework.apollo.biz.entity.GrayReleaseRule;
21. import com.ctrip.framework.apollo.biz.entity.Namespace;
22. import com.ctrip.framework.apollo.biz.entity.ReleaseHistory;
23. import com.ctrip.framework.apollo.common.constants.NamespaceBranchStatus;
24. import com.ctrip.framework.apollo.common.constants.ReleaseOperation;
25. 
26. import org.junit.Assert;
27. import org.junit.Test;
28. import org.springframework.beans.factory.annotation.Autowired;
29. import org.springframework.data.domain.Page;
30. import org.springframework.data.domain.PageRequest;
31. import org.springframework.data.domain.Pageable;
32. import org.springframework.test.context.jdbc.Sql;
33. 
34. public class NamespaceBranchServiceTest extends AbstractIntegrationTest {
35. 
36.   @Autowired
37.   private NamespaceBranchService namespaceBranchService;
38. 
39.   @Autowired
40.   private ReleaseHistoryService releaseHistoryService;
41. 
42.   private String testApp = "test";
43.   private String testCluster = "default";
44.   private String testNamespace = "application";
45.   private String testBranchName = "child-cluster";
46.   private String operator = "apollo";
47.   private Pageable pageable = PageRequest.of(0, 10);
48. 
49.   @Test
50.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
51.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
52.   public void testFindBranch() {
53.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);
54. 
55.     Assert.assertNotNull(branch);
56.     Assert.assertEquals(testBranchName, branch.getClusterName());
57.   }
58. 
59.   @Test
60.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
61.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
62.   public void testUpdateBranchGrayRulesWithUpdateOnce() {
63.     GrayReleaseRule rule = instanceGrayReleaseRule();
64. 
65.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, rule);
66. 
67.     GrayReleaseRule
68.         activeRule =
69.         namespaceBranchService.findBranchGrayRules(testApp, testCluster, testNamespace, testBranchName);
70. 
71.     Assert.assertNotNull(activeRule);
72.     Assert.assertEquals(rule.getAppId(), activeRule.getAppId());
73.     Assert.assertEquals(rule.getRules(), activeRule.getRules());
74.     Assert.assertEquals(Long.valueOf(0), activeRule.getReleaseId());
75. 
76.     Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace
77.         (testApp, testCluster, testNamespace, pageable);
78. 
79.     ReleaseHistory releaseHistory = releaseHistories.getContent().get(0);
80. 
81.     Assert.assertEquals(1, releaseHistories.getTotalElements());
82.     Assert.assertEquals(ReleaseOperation.APPLY_GRAY_RULES, releaseHistory.getOperation());
83.     Assert.assertEquals(0, releaseHistory.getReleaseId());
84.     Assert.assertEquals(0, releaseHistory.getPreviousReleaseId());
85.     Assert.assertTrue(releaseHistory.getOperationContext().contains(rule.getRules()));
86.   }
87. 
88.   @Test
89.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
90.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
91.   public void testUpdateBranchGrayRulesWithUpdateTwice() {
92. 
93.     GrayReleaseRule firstRule = instanceGrayReleaseRule();
94.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, firstRule);
95. 
96.     GrayReleaseRule secondRule = instanceGrayReleaseRule();
97.     secondRule.setRules("[{\"clientAppId\":\"branch-test\",\"clientIpList\":[\"10.38.57.112\"],\"clientLabelList\":[\"branch-test\"]}]");
98.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, secondRule);
99. 
100.     GrayReleaseRule
101.         activeRule =
102.         namespaceBranchService.findBranchGrayRules(testApp, testCluster, testNamespace, testBranchName);
103. 
104.     Assert.assertNotNull(secondRule);
105.     Assert.assertEquals(secondRule.getAppId(), activeRule.getAppId());
106.     Assert.assertEquals(secondRule.getRules(), activeRule.getRules());
107.     Assert.assertEquals(Long.valueOf(0), activeRule.getReleaseId());
108. 
109.     Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace
110.         (testApp, testCluster, testNamespace, pageable);
111. 
112.     ReleaseHistory firstReleaseHistory = releaseHistories.getContent().get(1);
113.     ReleaseHistory secondReleaseHistory = releaseHistories.getContent().get(0);
114. 
115.     Assert.assertEquals(2, releaseHistories.getTotalElements());
116.     Assert.assertEquals(ReleaseOperation.APPLY_GRAY_RULES, firstReleaseHistory.getOperation());
117.     Assert.assertEquals(ReleaseOperation.APPLY_GRAY_RULES, secondReleaseHistory.getOperation());
118.     Assert.assertTrue(firstReleaseHistory.getOperationContext().contains(firstRule.getRules()));
119.     Assert.assertFalse(firstReleaseHistory.getOperationContext().contains(secondRule.getRules()));
120.     Assert.assertTrue(secondReleaseHistory.getOperationContext().contains(firstRule.getRules()));
121.     Assert.assertTrue(secondReleaseHistory.getOperationContext().contains(secondRule.getRules()));
122.   }
123. 
124.   @Test
125.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
126.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
127.   public void testUpdateRulesReleaseIdWithOldRuleNotExist() {
128.     long latestReleaseId = 100;
129. 
130.     namespaceBranchService
131.         .updateRulesReleaseId(testApp, testCluster, testNamespace, testBranchName, latestReleaseId, operator);
132. 
133.     GrayReleaseRule
134.         activeRule =
135.         namespaceBranchService.findBranchGrayRules(testApp, testCluster, testNamespace, testBranchName);
136. 
137.     Assert.assertNull(activeRule);
138.   }
139. 
140.   @Test
141.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
142.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
143.   public void testUpdateRulesReleaseIdWithOldRuleExist() {
144. 
145.     GrayReleaseRule rule = instanceGrayReleaseRule();
146.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, rule);
147. 
148.     long latestReleaseId = 100;
149. 
150.     namespaceBranchService
151.         .updateRulesReleaseId(testApp, testCluster, testNamespace, testBranchName, latestReleaseId, operator);
152. 
153.     GrayReleaseRule
154.         activeRule =
155.         namespaceBranchService.findBranchGrayRules(testApp, testCluster, testNamespace, testBranchName);
156. 
157.     Assert.assertNotNull(activeRule);
158.     Assert.assertEquals(Long.valueOf(latestReleaseId), activeRule.getReleaseId());
159.     Assert.assertEquals(rule.getRules(), activeRule.getRules());
160.     Assert.assertEquals(NamespaceBranchStatus.ACTIVE, activeRule.getBranchStatus());
161.   }
162. 
163. 
164.   @Test
165.   @Sql(scripts = "/sql/namespace-branch-test.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
166.   @Sql(scripts = "/sql/clean.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
167.   public void testDeleteBranch() {
168. 
169.     GrayReleaseRule rule = instanceGrayReleaseRule();
170.     namespaceBranchService.updateBranchGrayRules(testApp, testCluster, testNamespace, testBranchName, rule);
171. 
172.     namespaceBranchService.deleteBranch(testApp, testCluster, testNamespace, testBranchName, NamespaceBranchStatus.DELETED, operator);
173. 
174.     Namespace branch = namespaceBranchService.findBranch(testApp, testCluster, testNamespace);
175.     Assert.assertNull(branch);
176. 
177.     GrayReleaseRule latestRule = namespaceBranchService.findBranchGrayRules(testApp, testCluster, testNamespace, testBranchName);
178. 
179.     Assert.assertNotNull(latestRule);
180.     Assert.assertEquals(NamespaceBranchStatus.DELETED, latestRule.getBranchStatus());
181.     Assert.assertEquals("[]", latestRule.getRules());
182. 
183.     Page<ReleaseHistory> releaseHistories = releaseHistoryService.findReleaseHistoriesByNamespace
184.         (testApp, testCluster, testNamespace, pageable);
185. 
186.     ReleaseHistory firstReleaseHistory = releaseHistories.getContent().get(1);
187.     ReleaseHistory secondReleaseHistory = releaseHistories.getContent().get(0);
188. 
189.     Assert.assertEquals(2, releaseHistories.getTotalElements());
190.     Assert.assertEquals(ReleaseOperation.APPLY_GRAY_RULES, firstReleaseHistory.getOperation());
191.     Assert.assertEquals(ReleaseOperation.ABANDON_GRAY_RELEASE, secondReleaseHistory.getOperation());
192. 
193.   }
194. 
195. 
196.   private GrayReleaseRule instanceGrayReleaseRule() {
197.     GrayReleaseRule rule = new GrayReleaseRule();
198.     rule.setAppId(testApp);
199.     rule.setClusterName(testCluster);
200.     rule.setNamespaceName(testNamespace);
201.     rule.setBranchName(testBranchName);
202.     rule.setBranchStatus(NamespaceBranchStatus.ACTIVE);
203.     rule.setRules("[{\"clientAppId\":\"test\",\"clientIpList\":[\"1.0.0.4\"],\"clientLabelList\":[]}]");
204.     return rule;
205.   }
206. 
207. 
208. }


File: apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java
Line number range: 1 - 88
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. import com.ctrip.framework.apollo.biz.AbstractUnitTest;
20. import com.ctrip.framework.apollo.biz.MockBeanFactory;
21. import com.ctrip.framework.apollo.biz.entity.Namespace;
22. import com.ctrip.framework.apollo.biz.repository.NamespaceRepository;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.common.exception.BadRequestException;
25. import com.ctrip.framework.apollo.core.ConfigConsts;
26. 
27. import org.junit.Test;
28. import org.mockito.InjectMocks;
29. import org.mockito.Mock;
30. import org.mockito.Spy;
31. import org.springframework.data.domain.PageRequest;
32. import org.springframework.data.domain.Pageable;
33. 
34. import java.util.Arrays;
35. import java.util.List;
36. 
37. import static org.junit.Assert.assertEquals;
38. import static org.mockito.Mockito.doReturn;
39. import static org.mockito.Mockito.when;
40. 
41. public class NamespaceServiceTest extends AbstractUnitTest {
42. 
43.   @Mock
44.   private AppNamespaceService appNamespaceService;
45.   @Mock
46.   private NamespaceRepository namespaceRepository;
47. 
48.   @Spy
49.   @InjectMocks
50.   private NamespaceService namespaceService;
51. 
52.   private String testPublicAppNamespace = "publicAppNamespace";
53. 
54. 
55.   @Test(expected = BadRequestException.class)
56.   public void testFindPublicAppNamespaceWithWrongNamespace() {
57.     Pageable page = PageRequest.of(0, 10);
58. 
59.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(null);
60. 
61.     namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);
62.   }
63. 
64.   @Test
65.   public void testFindPublicAppNamespace() {
66. 
67.     AppNamespace publicAppNamespace = MockBeanFactory.mockAppNamespace(null, testPublicAppNamespace, true);
68.     when(appNamespaceService.findPublicNamespaceByName(testPublicAppNamespace)).thenReturn(publicAppNamespace);
69. 
70.     Namespace firstParentNamespace =
71.         MockBeanFactory.mockNamespace("app", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);
72.     Namespace secondParentNamespace =
73.         MockBeanFactory.mockNamespace("app1", ConfigConsts.CLUSTER_NAME_DEFAULT, testPublicAppNamespace);
74. 
75.     Pageable page = PageRequest.of(0, 10);
76. 
77.     when(namespaceRepository.findByNamespaceName(testPublicAppNamespace, page))
78.         .thenReturn(Arrays.asList(firstParentNamespace, secondParentNamespace));
79. 
80.     doReturn(false).when(namespaceService).isChildNamespace(firstParentNamespace);
81.     doReturn(false).when(namespaceService).isChildNamespace(secondParentNamespace);
82. 
83.     List<Namespace> namespaces = namespaceService.findPublicAppNamespaceAllNamespaces(testPublicAppNamespace, page);
84. 
85.     assertEquals(2, namespaces.size());
86.   }
87. 
88. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 1 - 481
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Release;
20. import com.ctrip.framework.apollo.common.entity.AppNamespace;
21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;
23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;
24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;
25. import com.ctrip.framework.apollo.core.ConfigConsts;
26. import com.ctrip.framework.apollo.core.dto.ApolloConfig;
27. import com.ctrip.framework.apollo.core.dto.ApolloNotificationMessages;
28. import com.google.common.base.Joiner;
29. import com.google.common.collect.ImmutableMap;
30. import com.google.common.collect.Lists;
31. import com.google.gson.Gson;
32. import com.google.gson.JsonSyntaxException;
33. import org.junit.Before;
34. import org.junit.Test;
35. import org.junit.runner.RunWith;
36. import org.mockito.Mock;
37. import org.mockito.junit.MockitoJUnitRunner;
38. 
39. import javax.servlet.http.HttpServletRequest;
40. import javax.servlet.http.HttpServletResponse;
41. import java.util.Map;
42. 
43. import static org.junit.Assert.assertEquals;
44. import static org.junit.Assert.assertNull;
45. import static org.mockito.Mockito.*;
46. 
47. /**
48.  * @author Jason Song(song_s@ctrip.com)
49.  */
50. @RunWith(MockitoJUnitRunner.class)
51. public class ConfigControllerTest {
52.   private ConfigController configController;
53.   @Mock
54.   private ConfigService configService;
55.   @Mock
56.   private AppNamespaceServiceWithCache appNamespaceService;
57.   private String someAppId;
58.   private String someClusterName;
59.   private String defaultClusterName;
60.   private String defaultNamespaceName;
61.   private String somePublicNamespaceName;
62.   private String someDataCenter;
63.   private String someClientIp;
64.   private String someClientLabel;
65.   private String someMessagesAsString;
66.   @Mock
67.   private ApolloNotificationMessages someNotificationMessages;
68.   @Mock
69.   private Release someRelease;
70.   @Mock
71.   private Release somePublicRelease;
72.   @Mock
73.   private NamespaceUtil namespaceUtil;
74.   @Mock
75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;
76.   @Mock
77.   private HttpServletRequest someRequest;
78.   private Gson gson = new Gson();
79. 
80.   @Before
81.   public void setUp() throws Exception {
82.     configController = spy(new ConfigController(
83.         configService, appNamespaceService, namespaceUtil, instanceConfigAuditUtil, gson
84.     ));
85. 
86.     someAppId = "1";
87.     someClusterName = "someClusterName";
88.     defaultClusterName = ConfigConsts.CLUSTER_NAME_DEFAULT;
89.     defaultNamespaceName = ConfigConsts.NAMESPACE_APPLICATION;
90.     somePublicNamespaceName = "somePublicNamespace";
91.     someDataCenter = "someDC";
92.     someClientIp = "someClientIp";
93.     someClientLabel = "someClientLabel";
94.     String someValidConfiguration = "{\"apollo.bar\": \"foo\"}";
95.     String somePublicConfiguration = "{\"apollo.public.bar\": \"foo\"}";
96. 
97.     when(someRelease.getAppId()).thenReturn(someAppId);
98.     when(someRelease.getClusterName()).thenReturn(someClusterName);
99.     when(someRelease.getConfigurations()).thenReturn(someValidConfiguration);
100.     when(somePublicRelease.getConfigurations()).thenReturn(somePublicConfiguration);
101.     when(namespaceUtil.filterNamespaceName(defaultNamespaceName)).thenReturn(defaultNamespaceName);
102.     when(namespaceUtil.filterNamespaceName(somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
103.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
104.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
105. 
106.     someMessagesAsString = "someValidJson";
107.     when(configController.transformMessages(someMessagesAsString)).thenReturn(someNotificationMessages);
108.   }
109. 
110.   @Test
111.   public void testQueryConfig() throws Exception {
112.     String someClientSideReleaseKey = "1";
113.     String someServerSideNewReleaseKey = "2";
114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
115. 
116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);
120. 
121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
124. 
125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
126.         defaultNamespaceName, someDataCenter, someNotificationMessages);
127.     assertEquals(someAppId, result.getAppId());
128.     assertEquals(someClusterName, result.getCluster());
129.     assertEquals(defaultNamespaceName, result.getNamespaceName());
130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);
133.   }
134. 
135.   @Test
136.   public void testQueryConfigFile() throws Exception {
137.     String someClientSideReleaseKey = "1";
138.     String someServerSideNewReleaseKey = "2";
139.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
140.     String someNamespaceName = String.format("%s.%s", defaultClusterName, "properties");
141. 
142.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
143.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
144.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
145.     when(namespaceUtil.filterNamespaceName(someNamespaceName)).thenReturn(defaultNamespaceName);
146.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
147. 
148.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
149.         someNamespaceName, someDataCenter, someClientSideReleaseKey,
150.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
151. 
152.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
153.         defaultNamespaceName, someDataCenter, someNotificationMessages);
154.     assertEquals(someAppId, result.getAppId());
155.     assertEquals(someClusterName, result.getCluster());
156.     assertEquals(someNamespaceName, result.getNamespaceName());
157.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
158.   }
159. 
160.   @Test
161.   public void testQueryConfigFileWithPrivateNamespace() throws Exception {
162.     String someClientSideReleaseKey = "1";
163.     String someServerSideNewReleaseKey = "2";
164.     String somePrivateNamespace = "datasource";
165.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
166.     String somePrivateNamespaceName = String.format("%s.%s", somePrivateNamespace, "xml");
167.     AppNamespace appNamespace = mock(AppNamespace.class);
168. 
169.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePrivateNamespace,
170.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
171.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
172.     when(namespaceUtil.filterNamespaceName(somePrivateNamespaceName)).thenReturn(somePrivateNamespace);
173.     when(namespaceUtil.normalizeNamespace(someAppId, somePrivateNamespace)).thenReturn(somePrivateNamespace);
174.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePrivateNamespace))
175.         .thenReturn(appNamespace);
176. 
177.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
178.         somePrivateNamespaceName, someDataCenter, someClientSideReleaseKey,
179.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
180. 
181.     assertEquals(someAppId, result.getAppId());
182.     assertEquals(someClusterName, result.getCluster());
183.     assertEquals(somePrivateNamespaceName, result.getNamespaceName());
184.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
185.   }
186. 
187.   @Test
188.   public void testQueryConfigWithReleaseNotFound() throws Exception {
189.     String someClientSideReleaseKey = "1";
190.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
191. 
192.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
193.         someDataCenter, someNotificationMessages)).thenReturn(null);
194. 
195.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
196.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
197.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
198. 
199.     assertNull(result);
200.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());
201.   }
202. 
203.   @Test
204.   public void testQueryConfigWithApolloConfigNotModified() throws Exception {
205.     String someClientSideReleaseKey = "1";
206.     String someServerSideReleaseKey = someClientSideReleaseKey;
207.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
208. 
209.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
210.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
211.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
212. 
213.     ApolloConfig result =
214.         configController.queryConfig(someAppId, someClusterName, defaultNamespaceName, someDataCenter,
215.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
216. 
217.     assertNull(result);
218.     verify(someResponse, times(1)).setStatus(HttpServletResponse.SC_NOT_MODIFIED);
219.   }
220. 
221.   @Test
222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {
223.     String someClientSideReleaseKey = "1";
224.     String someServerSideReleaseKey = "2";
225.     String someAppOwnNamespaceName = "someAppOwn";
226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
227.     AppNamespace someAppOwnNamespace =
228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);
229. 
230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,
231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))
233.         .thenReturn(someAppOwnNamespace);
234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
237. 
238.     ApolloConfig result =
239.         configController
240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,
241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
242. 
243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
244.     assertEquals(someAppId, result.getAppId());
245.     assertEquals(someClusterName, result.getCluster());
246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());
247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));
248.   }
249. 
250.   @Test
251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {
252.     String someClientSideReleaseKey = "1";
253.     String someServerSideReleaseKey = "2";
254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
255.     String somePublicAppId = "somePublicAppId";
256.     String somePublicClusterName = "somePublicClusterName";
257.     AppNamespace somePublicAppNamespace =
258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
259. 
260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
261.         someDataCenter, someNotificationMessages)).thenReturn(null);
262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
263.         .thenReturn(somePublicAppNamespace);
264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);
269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
270. 
271.     ApolloConfig result = configController
272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
274. 
275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
276.     assertEquals(someAppId, result.getAppId());
277.     assertEquals(someClusterName, result.getCluster());
278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);
282.   }
283. 
284.   @Test
285.   public void testQueryConfigFileWithPublicNamespaceAndNoAppOverride() throws Exception {
286.     String someClientSideReleaseKey = "1";
287.     String someServerSideReleaseKey = "2";
288.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
289.     String somePublicAppId = "somePublicAppId";
290.     String someNamespace = String.format("%s.%s", somePublicNamespaceName, "properties");
291.     AppNamespace somePublicAppNamespace =
292.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
293. 
294.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
295.         someDataCenter, someNotificationMessages)).thenReturn(null);
296.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
297.         .thenReturn(somePublicAppNamespace);
298.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
299.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
300.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
301.     when(namespaceUtil.filterNamespaceName(someNamespace)).thenReturn(somePublicNamespaceName);
302.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
303.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePublicNamespaceName)).thenReturn(null);
304. 
305.     ApolloConfig result = configController
306.         .queryConfig(someAppId, someClusterName, someNamespace, someDataCenter,
307.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
308. 
309.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
310.     assertEquals(someAppId, result.getAppId());
311.     assertEquals(someClusterName, result.getCluster());
312.     assertEquals(someNamespace, result.getNamespaceName());
313.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
314.   }
315. 
316.   @Test
317.   public void testQueryConfigWithPublicNamespaceAndAppOverride() throws Exception {
318.     String someAppSideReleaseKey = "1";
319.     String somePublicAppSideReleaseKey = "2";
320. 
321.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
322.     String somePublicAppId = "somePublicAppId";
323.     AppNamespace somePublicAppNamespace =
324.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
325. 
326.     when(someRelease.getConfigurations()).thenReturn("{\"apollo.public.foo\": \"foo-override\"}");
327.     when(somePublicRelease.getConfigurations())
328.         .thenReturn("{\"apollo.public.foo\": \"foo\", \"apollo.public.bar\": \"bar\"}");
329. 
330.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
331.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
332.     when(someRelease.getReleaseKey()).thenReturn(someAppSideReleaseKey);
333.     when(someRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
334.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
335.         .thenReturn(somePublicAppNamespace);
336.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
337.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
338.     when(somePublicRelease.getReleaseKey()).thenReturn(somePublicAppSideReleaseKey);
339.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
340.     when(somePublicRelease.getClusterName()).thenReturn(someDataCenter);
341.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
342. 
343.     ApolloConfig result =
344.         configController
345.             .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
346.                 someAppSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
347. 
348.     assertEquals(Joiner.on(ConfigConsts.CLUSTER_NAMESPACE_SEPARATOR)
349.             .join(someAppSideReleaseKey, somePublicAppSideReleaseKey),
350.         result.getReleaseKey());
351.     assertEquals(someAppId, result.getAppId());
352.     assertEquals(someClusterName, result.getCluster());
353.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
354.     assertEquals("foo-override", result.getConfigurations().get("apollo.public.foo"));
355.     assertEquals("bar", result.getConfigurations().get("apollo.public.bar"));
356.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
357.         someClientIp, someAppId, someClusterName, somePublicNamespaceName, someAppSideReleaseKey);
358.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
359.         someClientIp, somePublicAppId, someDataCenter, somePublicNamespaceName, somePublicAppSideReleaseKey);
360.   }
361. 
362.   @Test
363.   public void testMergeConfigurations() throws Exception {
364.     Gson gson = new Gson();
365.     String key1 = "key1";
366.     String value1 = "value1";
367.     String anotherValue1 = "anotherValue1";
368. 
369.     String key2 = "key2";
370.     String value2 = "value2";
371. 
372.     Map<String, String> config = ImmutableMap.of(key1, anotherValue1);
373.     Map<String, String> anotherConfig = ImmutableMap.of(key1, value1, key2, value2);
374. 
375.     Release releaseWithHighPriority = new Release();
376.     releaseWithHighPriority.setConfigurations(gson.toJson(config));
377. 
378.     Release releaseWithLowPriority = new Release();
379.     releaseWithLowPriority.setConfigurations(gson.toJson(anotherConfig));
380. 
381.     Map<String, String> result =
382.         configController.mergeReleaseConfigurations(
383.             Lists.newArrayList(releaseWithHighPriority, releaseWithLowPriority));
384. 
385.     assertEquals(2, result.keySet().size());
386.     assertEquals(anotherValue1, result.get(key1));
387.     assertEquals(value2, result.get(key2));
388.   }
389. 
390.   @Test(expected = JsonSyntaxException.class)
391.   public void testTransformConfigurationToMapFailed() throws Exception {
392.     String someInvalidConfiguration = "xxx";
393.     Release someRelease = new Release();
394.     someRelease.setConfigurations(someInvalidConfiguration);
395. 
396.     configController.mergeReleaseConfigurations(Lists.newArrayList(someRelease));
397.   }
398. 
399.   @Test
400.   public void testQueryConfigForNoAppIdPlaceHolder() throws Exception {
401.     String someClientSideReleaseKey = "1";
402.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
403.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
404. 
405.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
406.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
407.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
408. 
409.     verify(configService, never()).loadConfig(appId, someClientIp, someAppId, someClientLabel, someClusterName, defaultNamespaceName,
410.         someDataCenter, someNotificationMessages);
411.     verify(appNamespaceService, never()).findPublicNamespaceByName(defaultNamespaceName);
412.     assertNull(result);
413.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());
414.   }
415. 
416.   @Test
417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {
418.     String someClientSideReleaseKey = "1";
419.     String someServerSideReleaseKey = "2";
420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
421.     String somePublicAppId = "somePublicAppId";
422.     AppNamespace somePublicAppNamespace =
423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
425. 
426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
427.         .thenReturn(somePublicAppNamespace);
428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
432. 
433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,
435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
436. 
437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,
438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);
439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
440.     assertEquals(appId, result.getAppId());
441.     assertEquals(someClusterName, result.getCluster());
442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
444.   }
445. 
446.   @Test
447.   public void testTransformMessages() throws Exception {
448.     String someKey = "someKey";
449.     long someNotificationId = 1;
450.     String anotherKey = "anotherKey";
451.     long anotherNotificationId = 2;
452.     ApolloNotificationMessages notificationMessages = new ApolloNotificationMessages();
453.     notificationMessages.put(someKey, someNotificationId);
454.     notificationMessages.put(anotherKey, anotherNotificationId);
455. 
456.     String someMessagesAsString = gson.toJson(notificationMessages);
457. 
458.     ApolloNotificationMessages result = configController.transformMessages(someMessagesAsString);
459. 
460.     assertEquals(notificationMessages.getDetails(), result.getDetails());
461.   }
462. 
463.   @Test
464.   public void testTransformInvalidMessages() throws Exception {
465.     String someInvalidMessages = "someInvalidMessages";
466. 
467.     assertNull(configController.transformMessages(someInvalidMessages));
468.   }
469. 
470.   private AppNamespace assemblePublicAppNamespace(String appId, String namespace) {
471.     return assembleAppNamespace(appId, namespace, true);
472.   }
473. 
474.   private AppNamespace assembleAppNamespace(String appId, String namespace, boolean isPublic) {
475.     AppNamespace appNamespace = new AppNamespace();
476.     appNamespace.setAppId(appId);
477.     appNamespace.setName(namespace);
478.     appNamespace.setPublic(isPublic);
479.     return appNamespace;
480.   }
481. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCacheTest.java
Line number range: 1 - 307
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.service;
18. 
19. import com.ctrip.framework.apollo.biz.config.BizConfig;
20. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;
21. import com.ctrip.framework.apollo.common.entity.AppNamespace;
22. import com.google.common.collect.Lists;
23. import com.google.common.collect.Sets;
24. import org.awaitility.Awaitility;
25. import org.junit.Before;
26. import org.junit.Test;
27. import org.junit.runner.RunWith;
28. import org.mockito.Mock;
29. import org.mockito.junit.MockitoJUnitRunner;
30. 
31. import java.util.Calendar;
32. import java.util.Collections;
33. import java.util.Comparator;
34. import java.util.Date;
35. import java.util.List;
36. import java.util.Set;
37. import java.util.concurrent.TimeUnit;
38. 
39. import static org.awaitility.Awaitility.await;
40. import static org.junit.Assert.*;
41. import static org.mockito.Mockito.when;
42. 
43. /**
44.  * @author Jason Song(song_s@ctrip.com)
45.  */
46. @RunWith(MockitoJUnitRunner.Silent.class)
47. public class AppNamespaceServiceWithCacheTest {
48.   private AppNamespaceServiceWithCache appNamespaceServiceWithCache;
49.   @Mock
50.   private AppNamespaceRepository appNamespaceRepository;
51. 
52.   @Mock
53.   private BizConfig bizConfig;
54. 
55.   private int scanInterval;
56.   private TimeUnit scanIntervalTimeUnit;
57.   private Comparator<AppNamespace> appNamespaceComparator = (o1, o2) -> (int) (o1.getId() -
58.       o2.getId());
59. 
60.   @Before
61.   public void setUp() throws Exception {
62.     appNamespaceServiceWithCache = new AppNamespaceServiceWithCache(appNamespaceRepository, bizConfig);
63. 
64.     scanInterval = 50;
65.     scanIntervalTimeUnit = TimeUnit.MILLISECONDS;
66.     when(bizConfig.appNamespaceCacheRebuildInterval()).thenReturn(scanInterval);
67.     when(bizConfig.appNamespaceCacheRebuildIntervalTimeUnit()).thenReturn(scanIntervalTimeUnit);
68.     when(bizConfig.appNamespaceCacheScanInterval()).thenReturn(scanInterval);
69.     when(bizConfig.appNamespaceCacheScanIntervalTimeUnit()).thenReturn(scanIntervalTimeUnit);
70. 
71.     Awaitility.reset();
72.     Awaitility.setDefaultTimeout(scanInterval * 100, scanIntervalTimeUnit);
73.     Awaitility.setDefaultPollInterval(scanInterval, scanIntervalTimeUnit);
74. 
75.   }
76. 
77.   @Test
78.   public void testAppNamespace() throws Exception {
79.     String someAppId = "someAppId";
80.     String somePrivateNamespace = "somePrivateNamespace";
81.     String somePrivateNamespaceWithIncorrectCase = somePrivateNamespace.toUpperCase();
82.     long somePrivateNamespaceId = 1;
83.     String yetAnotherPrivateNamespace = "anotherPrivateNamespace";
84.     long yetAnotherPrivateNamespaceId = 4;
85.     String anotherPublicNamespace = "anotherPublicNamespace";
86.     long anotherPublicNamespaceId = 5;
87. 
88.     String somePublicAppId = "somePublicAppId";
89.     String somePublicNamespace = "somePublicNamespace";
90.     String somePublicNamespaceWithIncorrectCase = somePublicNamespace.toUpperCase();
91.     long somePublicNamespaceId = 2;
92.     String anotherPrivateNamespace = "anotherPrivateNamespace";
93.     long anotherPrivateNamespaceId = 3;
94. 
95.     AppNamespace somePrivateAppNamespace = assembleAppNamespace(somePrivateNamespaceId,
96.         someAppId, somePrivateNamespace, false);
97.     AppNamespace somePublicAppNamespace = assembleAppNamespace(somePublicNamespaceId,
98.         somePublicAppId, somePublicNamespace, true);
99.     AppNamespace anotherPrivateAppNamespace = assembleAppNamespace(anotherPrivateNamespaceId,
100.         somePublicAppId, anotherPrivateNamespace, false);
101.     AppNamespace yetAnotherPrivateAppNamespace = assembleAppNamespace
102.         (yetAnotherPrivateNamespaceId, someAppId, yetAnotherPrivateNamespace, false);
103.     AppNamespace anotherPublicAppNamespace = assembleAppNamespace(anotherPublicNamespaceId,
104.         someAppId, anotherPublicNamespace, true);
105. 
106.     Set<String> someAppIdNamespaces = Sets.newHashSet
107.         (somePrivateNamespace, yetAnotherPrivateNamespace, anotherPublicNamespace);
108.     Set<String> someAppIdNamespacesWithIncorrectCase = Sets.newHashSet
109.         (somePrivateNamespaceWithIncorrectCase, yetAnotherPrivateNamespace, anotherPublicNamespace);
110.     Set<String> somePublicAppIdNamespaces = Sets.newHashSet(somePublicNamespace,
111.         anotherPrivateNamespace);
112.     Set<String> publicNamespaces = Sets.newHashSet(somePublicNamespace, anotherPublicNamespace);
113.     Set<String> publicNamespacesWithIncorrectCase = Sets.newHashSet(somePublicNamespaceWithIncorrectCase,
114.         anotherPublicNamespace);
115. 
116.     List<Long> appNamespaceIds = Lists.newArrayList(somePrivateNamespaceId,
117.         somePublicNamespaceId, anotherPrivateNamespaceId, yetAnotherPrivateNamespaceId,
118.         anotherPublicNamespaceId);
119.     List<AppNamespace> allAppNamespaces = Lists.newArrayList(somePrivateAppNamespace,
120.         somePublicAppNamespace, anotherPrivateAppNamespace, yetAnotherPrivateAppNamespace,
121.         anotherPublicAppNamespace);
122. 
123.     // Test init
124.     appNamespaceServiceWithCache.afterPropertiesSet();
125. 
126.     // Should have no record now
127.     assertNull(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, somePrivateNamespace));
128.     assertNull(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, somePrivateNamespaceWithIncorrectCase));
129.     assertNull(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, yetAnotherPrivateNamespace));
130.     assertNull(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, anotherPublicNamespace));
131.     assertTrue(appNamespaceServiceWithCache.findByAppIdAndNamespaces(someAppId, someAppIdNamespaces).isEmpty());
132.     assertTrue(appNamespaceServiceWithCache.findByAppIdAndNamespaces(someAppId, someAppIdNamespacesWithIncorrectCase)
133.         .isEmpty());
134.     assertNull(appNamespaceServiceWithCache.findByAppIdAndNamespace(somePublicAppId, somePublicNamespace));
135.     assertNull(appNamespaceServiceWithCache.findByAppIdAndNamespace(somePublicAppId,
136.         somePublicNamespaceWithIncorrectCase));
137.     assertNull(appNamespaceServiceWithCache.findByAppIdAndNamespace(somePublicAppId, anotherPrivateNamespace));
138.     assertTrue(appNamespaceServiceWithCache.findByAppIdAndNamespaces(somePublicAppId,
139.         somePublicAppIdNamespaces).isEmpty());
140.     assertNull(appNamespaceServiceWithCache.findPublicNamespaceByName(somePublicNamespace));
141.     assertNull(appNamespaceServiceWithCache.findPublicNamespaceByName(somePublicNamespaceWithIncorrectCase));
142.     assertNull(appNamespaceServiceWithCache.findPublicNamespaceByName(anotherPublicNamespace));
143.     assertTrue(appNamespaceServiceWithCache.findPublicNamespacesByNames(publicNamespaces).isEmpty());
144.     assertTrue(appNamespaceServiceWithCache.findPublicNamespacesByNames(publicNamespacesWithIncorrectCase).isEmpty());
145. 
146.     // Add 1 private namespace and 1 public namespace
147.     when(appNamespaceRepository.findFirst500ByIdGreaterThanOrderByIdAsc(0)).thenReturn(Lists
148.         .newArrayList(somePrivateAppNamespace, somePublicAppNamespace));
149.     when(appNamespaceRepository.findAllById(Lists.newArrayList(somePrivateNamespaceId,
150.         somePublicNamespaceId))).thenReturn(Lists.newArrayList(somePrivateAppNamespace,
151.         somePublicAppNamespace));
152. 
153.     await().untilAsserted(() -> {
154.       assertEquals(somePrivateAppNamespace,
155.           appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, somePrivateNamespace));
156.       assertEquals(somePrivateAppNamespace,
157.           appNamespaceServiceWithCache
158.               .findByAppIdAndNamespace(someAppId, somePrivateNamespaceWithIncorrectCase));
159.       check(Lists.newArrayList(somePrivateAppNamespace), appNamespaceServiceWithCache
160.           .findByAppIdAndNamespaces(someAppId, someAppIdNamespaces));
161.       check(Lists.newArrayList(somePrivateAppNamespace), appNamespaceServiceWithCache
162.           .findByAppIdAndNamespaces(someAppId, someAppIdNamespacesWithIncorrectCase));
163.       assertEquals(somePublicAppNamespace,
164.           appNamespaceServiceWithCache.findByAppIdAndNamespace(somePublicAppId,
165.               somePublicNamespace));
166.       assertEquals(somePublicAppNamespace,
167.           appNamespaceServiceWithCache.findByAppIdAndNamespace(somePublicAppId,
168.               somePublicNamespaceWithIncorrectCase));
169.       check(Lists.newArrayList(somePublicAppNamespace), appNamespaceServiceWithCache
170.           .findByAppIdAndNamespaces(somePublicAppId, somePublicAppIdNamespaces));
171.       assertEquals(somePublicAppNamespace,
172.           appNamespaceServiceWithCache.findPublicNamespaceByName(somePublicNamespace));
173.       assertEquals(somePublicAppNamespace, appNamespaceServiceWithCache.findPublicNamespaceByName
174.           (somePublicNamespaceWithIncorrectCase));
175.       check(Lists.newArrayList(somePublicAppNamespace),
176.           appNamespaceServiceWithCache.findPublicNamespacesByNames
177.               (publicNamespaces));
178.       check(Lists.newArrayList(somePublicAppNamespace),
179.           appNamespaceServiceWithCache.findPublicNamespacesByNames
180.               (publicNamespacesWithIncorrectCase));
181.     });
182. 
183.     // Add 2 private namespaces and 1 public namespace
184.     when(appNamespaceRepository.findFirst500ByIdGreaterThanOrderByIdAsc(somePublicNamespaceId))
185.         .thenReturn(Lists.newArrayList(anotherPrivateAppNamespace, yetAnotherPrivateAppNamespace,
186.             anotherPublicAppNamespace));
187.     when(appNamespaceRepository.findAllById(appNamespaceIds)).thenReturn(allAppNamespaces);
188. 
189.     await().untilAsserted(() -> {
190.       check(Lists.newArrayList(somePrivateAppNamespace, yetAnotherPrivateAppNamespace,
191.           anotherPublicAppNamespace), Lists
192.           .newArrayList(
193.               appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, somePrivateNamespace),
194.               appNamespaceServiceWithCache
195.                   .findByAppIdAndNamespace(someAppId, yetAnotherPrivateNamespace),
196.               appNamespaceServiceWithCache
197.                   .findByAppIdAndNamespace(someAppId, anotherPublicNamespace)));
198.       check(Lists.newArrayList(somePrivateAppNamespace, yetAnotherPrivateAppNamespace,
199.           anotherPublicAppNamespace), appNamespaceServiceWithCache.findByAppIdAndNamespaces
200.           (someAppId, someAppIdNamespaces));
201.       check(Lists.newArrayList(somePublicAppNamespace, anotherPrivateAppNamespace),
202.           Lists.newArrayList(appNamespaceServiceWithCache
203.                   .findByAppIdAndNamespace(somePublicAppId, somePublicNamespace),
204.               appNamespaceServiceWithCache
205.                   .findByAppIdAndNamespace(somePublicAppId, anotherPrivateNamespace)));
206.       check(Lists.newArrayList(somePublicAppNamespace, anotherPrivateAppNamespace),
207.           appNamespaceServiceWithCache.findByAppIdAndNamespaces(somePublicAppId,
208.               somePublicAppIdNamespaces));
209.       check(Lists.newArrayList(somePublicAppNamespace, anotherPublicAppNamespace),
210.           Lists.newArrayList(
211.               appNamespaceServiceWithCache.findPublicNamespaceByName(somePublicNamespace),
212.               appNamespaceServiceWithCache.findPublicNamespaceByName(anotherPublicNamespace)));
213.       check(Lists.newArrayList(somePublicAppNamespace, anotherPublicAppNamespace),
214.           appNamespaceServiceWithCache.findPublicNamespacesByNames(publicNamespaces));
215.     });
216. 
217.     // Update name
218.     String somePrivateNamespaceNew = "somePrivateNamespaceNew";
219.     AppNamespace somePrivateAppNamespaceNew = assembleAppNamespace(somePrivateAppNamespace.getId
220.         (), somePrivateAppNamespace.getAppId(), somePrivateNamespaceNew, somePrivateAppNamespace
221.         .isPublic());
222.     somePrivateAppNamespaceNew.setDataChangeLastModifiedTime(newDateWithDelta
223.         (somePrivateAppNamespace.getDataChangeLastModifiedTime(), 1));
224. 
225.     // Update appId
226.     String someAppIdNew = "someAppIdNew";
227.     AppNamespace yetAnotherPrivateAppNamespaceNew = assembleAppNamespace
228.         (yetAnotherPrivateAppNamespace.getId(), someAppIdNew, yetAnotherPrivateAppNamespace
229.             .getName(), false);
230.     yetAnotherPrivateAppNamespaceNew.setDataChangeLastModifiedTime(newDateWithDelta
231.         (yetAnotherPrivateAppNamespace.getDataChangeLastModifiedTime(), 1));
232. 
233.     // Update isPublic
234.     AppNamespace somePublicAppNamespaceNew = assembleAppNamespace(somePublicAppNamespace
235.             .getId(), somePublicAppNamespace.getAppId(), somePublicAppNamespace.getName(),
236.         !somePublicAppNamespace.isPublic());
237.     somePublicAppNamespaceNew.setDataChangeLastModifiedTime(newDateWithDelta
238.         (somePublicAppNamespace.getDataChangeLastModifiedTime(), 1));
239. 
240.     // Delete 1 private and 1 public
241. 
242.     // should prepare for the case after deleted first, or in 2 rebuild intervals, all will be deleted
243.     List<Long> appNamespaceIdsAfterDelete = Lists
244.         .newArrayList(somePrivateNamespaceId, somePublicNamespaceId, yetAnotherPrivateNamespaceId);
245.     when(appNamespaceRepository.findAllById(appNamespaceIdsAfterDelete)).thenReturn(Lists.newArrayList
246.         (somePrivateAppNamespaceNew, yetAnotherPrivateAppNamespaceNew, somePublicAppNamespaceNew));
247. 
248.     // do delete
249.     when(appNamespaceRepository.findAllById(appNamespaceIds)).thenReturn(Lists.newArrayList
250.         (somePrivateAppNamespaceNew, yetAnotherPrivateAppNamespaceNew, somePublicAppNamespaceNew));
251. 
252.     await().untilAsserted(() -> {
253.       assertNull(
254.           appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, somePrivateNamespace));
255.       assertNull(appNamespaceServiceWithCache
256.           .findByAppIdAndNamespace(someAppId, yetAnotherPrivateNamespace));
257.       assertNull(
258.           appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, anotherPublicNamespace));
259.       check(Collections.emptyList(), appNamespaceServiceWithCache
260.           .findByAppIdAndNamespaces(someAppId, someAppIdNamespaces));
261.       assertEquals(somePublicAppNamespaceNew,
262.           appNamespaceServiceWithCache
263.               .findByAppIdAndNamespace(somePublicAppId, somePublicNamespace));
264.       check(Lists.newArrayList(somePublicAppNamespaceNew),
265.           appNamespaceServiceWithCache.findByAppIdAndNamespaces(somePublicAppId,
266.               somePublicAppIdNamespaces));
267.       assertNull(appNamespaceServiceWithCache.findPublicNamespaceByName(somePublicNamespace));
268.       assertNull(appNamespaceServiceWithCache.findPublicNamespaceByName(anotherPublicNamespace));
269.       check(Collections.emptyList(),
270.           appNamespaceServiceWithCache.findPublicNamespacesByNames(publicNamespaces));
271. 
272.       assertEquals(somePrivateAppNamespaceNew,
273.           appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, somePrivateNamespaceNew));
274.       check(Lists.newArrayList(somePrivateAppNamespaceNew), appNamespaceServiceWithCache
275.           .findByAppIdAndNamespaces(someAppId, Sets.newHashSet(somePrivateNamespaceNew)));
276.       assertEquals(yetAnotherPrivateAppNamespaceNew,
277.           appNamespaceServiceWithCache
278.               .findByAppIdAndNamespace(someAppIdNew, yetAnotherPrivateNamespace));
279.       check(Lists.newArrayList(yetAnotherPrivateAppNamespaceNew), appNamespaceServiceWithCache
280.           .findByAppIdAndNamespaces(someAppIdNew, Sets.newHashSet(yetAnotherPrivateNamespace)));
281.     });
282.   }
283. 
284.   private void check(List<AppNamespace> someList, List<AppNamespace> anotherList) {
285.     someList.sort(appNamespaceComparator);
286.     anotherList.sort(appNamespaceComparator);
287.     assertEquals(someList, anotherList);
288.   }
289. 
290.   private Date newDateWithDelta(Date date, int deltaInSeconds) {
291.     Calendar calendar = Calendar.getInstance();
292.     calendar.setTime(date);
293.     calendar.add(Calendar.SECOND, deltaInSeconds);
294. 
295.     return calendar.getTime();
296.   }
297. 
298.   private AppNamespace assembleAppNamespace(long id, String appId, String name, boolean isPublic) {
299.     AppNamespace appNamespace = new AppNamespace();
300.     appNamespace.setId(id);
301.     appNamespace.setAppId(appId);
302.     appNamespace.setName(name);
303.     appNamespace.setPublic(isPublic);
304.     appNamespace.setDataChangeLastModifiedTime(new Date());
305.     return appNamespace;
306.   }
307. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 1 - 127
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.util;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
21. import org.junit.Before;
22. import org.junit.Test;
23. import org.junit.runner.RunWith;
24. import org.mockito.Mock;
25. import org.mockito.junit.MockitoJUnitRunner;
26. 
27. import static org.junit.Assert.assertEquals;
28. import static org.mockito.Mockito.*;
29. 
30. /**
31.  * @author Jason Song(song_s@ctrip.com)
32.  */
33. @RunWith(MockitoJUnitRunner.class)
34. public class NamespaceUtilTest {
35.   private NamespaceUtil namespaceUtil;
36. 
37.   @Mock
38.   private AppNamespaceServiceWithCache appNamespaceServiceWithCache;
39. 
40.   @Before
41.   public void setUp() throws Exception {
42.     namespaceUtil = new NamespaceUtil(appNamespaceServiceWithCache);
43.   }
44. 
45.   @Test
46.   public void testFilterNamespaceName() throws Exception {
47.     String someName = "a.properties";
48. 
49.     assertEquals("a", namespaceUtil.filterNamespaceName(someName));
50.   }
51. 
52.   @Test
53.   public void testFilterNamespaceNameUnchanged() throws Exception {
54.     String someName = "a.xml";
55. 
56.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
57.   }
58. 
59.   @Test
60.   public void testFilterNamespaceNameWithMultiplePropertiesSuffix() throws Exception {
61.     String someName = "a.properties.properties";
62. 
63.     assertEquals("a.properties", namespaceUtil.filterNamespaceName(someName));
64.   }
65. 
66.   @Test
67.   public void testFilterNamespaceNameWithRandomCase() throws Exception {
68.     String someName = "AbC.ProPErties";
69. 
70.     assertEquals("AbC", namespaceUtil.filterNamespaceName(someName));
71.   }
72. 
73.   @Test
74.   public void testFilterNamespaceNameWithRandomCaseUnchanged() throws Exception {
75.     String someName = "AbCD.xMl";
76. 
77.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
78.   }
79. 
80.   @Test
81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {
82.     String someAppId = "someAppId";
83.     String someNamespaceName = "someNamespaceName";
84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
85.     AppNamespace someAppNamespace = mock(AppNamespace.class);
86. 
87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn
89.         (someAppNamespace);
90. 
91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
92. 
93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);
95.   }
96. 
97.   @Test
98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {
99.     String someAppId = "someAppId";
100.     String someNamespaceName = "someNamespaceName";
101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
102.     AppNamespace someAppNamespace = mock(AppNamespace.class);
103. 
104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);
107. 
108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
109. 
110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
112.   }
113. 
114.   @Test
115.   public void testNormalizeNamespaceFailed() throws Exception {
116.     String someAppId = "someAppId";
117.     String someNamespaceName = "someNamespaceName";
118. 
119.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
120.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(null);
121. 
122.     assertEquals(someNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
123. 
124.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
125.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
126.   }
127. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 1 - 61
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.openapi.v1.controller;
18. 
19. import com.ctrip.framework.apollo.common.utils.InputValidator;
20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;
22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.ActiveProfiles;
27. import org.springframework.web.client.HttpClientErrorException;
28. import static org.hamcrest.Matchers.containsString;
29. 
30. /**
31.  * Created by kezhenxu at 2019/1/8 18:17.
32.  *
33.  * @author kezhenxu (kezhenxu94@163.com)
34.  */
35. @ActiveProfiles("skipAuthorization")
36. public class NamespaceControllerTest extends AbstractControllerTest {
37.   @Autowired
38.   private ConsumerPermissionValidator consumerPermissionValidator;
39. 
40.   @Test
41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {
42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));
43. 
44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();
45.     dto.setAppId("appId");
46.     dto.setName("invalid name");
47.     dto.setFormat(ConfigFileFormat.Properties.getValue());
48.     dto.setDataChangeCreatedBy("apollo");
49.     try {
50.       restTemplate.postForEntity(
51.           url("/openapi/v1/apps/{appId}/appnamespaces"),
52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()
53.       );
54.       Assert.fail("should throw");
55.     } catch (HttpClientErrorException e) {
56.       String result = e.getResponseBodyAsString();
57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
59.     }
60.   }
61. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/AppNamespaceServiceTest.java
Line number range: 1 - 235
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.common.exception.BadRequestException;
21. import com.ctrip.framework.apollo.core.ConfigConsts;
22. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
23. import com.ctrip.framework.apollo.portal.AbstractIntegrationTest;
24. 
25. import org.junit.Assert;
26. import org.junit.Test;
27. import org.springframework.beans.factory.annotation.Autowired;
28. import org.springframework.test.context.jdbc.Sql;
29. 
30. import java.util.List;
31. 
32. public class AppNamespaceServiceTest extends AbstractIntegrationTest {
33. 
34.   @Autowired
35.   private AppNamespaceService appNamespaceService;
36. 
37.   private final String APP = "app-test";
38. 
39.   @Test
40.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
41.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
42.   public void testFindPublicAppNamespace() {
43. 
44.     List<AppNamespace> appNamespaceList = appNamespaceService.findPublicAppNamespaces();
45. 
46.     Assert.assertNotNull(appNamespaceList);
47.     Assert.assertEquals(5, appNamespaceList.size());
48. 
49.   }
50. 
51.   @Test
52.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
53.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
54.   public void testFindPublicAppNamespaceByName() {
55. 
56.     Assert.assertNotNull(appNamespaceService.findPublicAppNamespace("datasourcexml"));
57. 
58.     Assert.assertNull(appNamespaceService.findPublicAppNamespace("TFF.song0711-02"));
59.   }
60. 
61.   @Test
62.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
63.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
64.   public void testFindPublicAppNamespaceByAppAndName() {
65. 
66.     Assert.assertNotNull(appNamespaceService.findByAppIdAndName("100003173", "datasourcexml"));
67. 
68.     Assert.assertNull(appNamespaceService.findByAppIdAndName("100003173", "TFF.song0711-02"));
69.   }
70. 
71. 
72.   @Test
73.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
74.   public void testCreateDefaultAppNamespace() {
75.     appNamespaceService.createDefaultAppNamespace(APP);
76. 
77.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(APP, ConfigConsts.NAMESPACE_APPLICATION);
78. 
79.     Assert.assertNotNull(appNamespace);
80.     Assert.assertEquals(ConfigFileFormat.Properties.getValue(), appNamespace.getFormat());
81. 
82.   }
83. 
84.   @Test(expected = BadRequestException.class)
85.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
86.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
87.   public void testCreatePublicAppNamespaceExisted() {
88.     AppNamespace appNamespace = assembleBaseAppNamespace();
89.     appNamespace.setPublic(true);
90.     appNamespace.setName("old");
91.     appNamespace.setFormat(ConfigFileFormat.Properties.getValue());
92. 
93.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
94.   }
95. 
96.   @Test(expected = BadRequestException.class)
97.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
98.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
99.   public void testCreatePublicAppNamespaceExistedAsPrivateAppNamespace() {
100.     AppNamespace appNamespace = assembleBaseAppNamespace();
101.     appNamespace.setPublic(true);
102.     appNamespace.setName("private-01");
103.     appNamespace.setFormat(ConfigFileFormat.Properties.getValue());
104. 
105.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
106.   }
107. 
108.   @Test
109.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
110.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
111.   public void testCreatePublicAppNamespaceNotExistedWithNoAppendnamespacePrefix() {
112.     AppNamespace appNamespace = assembleBaseAppNamespace();
113.     appNamespace.setPublic(true);
114.     appNamespace.setName("old");
115.     appNamespace.setFormat(ConfigFileFormat.Properties.getValue());
116. 
117.     AppNamespace createdAppNamespace = appNamespaceService.createAppNamespaceInLocal(appNamespace, false);
118. 
119.     Assert.assertNotNull(createdAppNamespace);
120.     Assert.assertEquals(appNamespace.getName(), createdAppNamespace.getName());
121.   }
122. 
123.   @Test(expected = BadRequestException.class)
124.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
125.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
126.   public void testCreatePublicAppNamespaceExistedWithNoAppendnamespacePrefix() {
127.     AppNamespace appNamespace = assembleBaseAppNamespace();
128.     appNamespace.setPublic(true);
129.     appNamespace.setName("datasource");
130.     appNamespace.setFormat(ConfigFileFormat.Properties.getValue());
131. 
132.     appNamespaceService.createAppNamespaceInLocal(appNamespace, false);
133.   }
134. 
135.   @Test
136.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
137.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
138.   public void testCreatePublicAppNamespaceNotExisted() {
139.     AppNamespace appNamespace = assembleBaseAppNamespace();
140.     appNamespace.setPublic(true);
141. 
142.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
143. 
144.     AppNamespace createdAppNamespace = appNamespaceService.findPublicAppNamespace(appNamespace.getName());
145. 
146.     Assert.assertNotNull(createdAppNamespace);
147.     Assert.assertEquals(appNamespace.getName(), createdAppNamespace.getName());
148.   }
149. 
150.   @Test
151.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
152.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
153.   public void testCreatePublicAppNamespaceWithWrongFormatNotExisted() {
154.     AppNamespace appNamespace = assembleBaseAppNamespace();
155.     appNamespace.setPublic(true);
156.     appNamespace.setFormat(ConfigFileFormat.YAML.getValue());
157. 
158.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
159. 
160.     AppNamespace createdAppNamespace = appNamespaceService.findPublicAppNamespace(appNamespace.getName());
161. 
162.     Assert.assertNotNull(createdAppNamespace);
163.     Assert.assertEquals(appNamespace.getName(), createdAppNamespace.getName());
164.     Assert.assertEquals(ConfigFileFormat.YAML.getValue(), createdAppNamespace.getFormat());
165.   }
166. 
167. 
168.   @Test(expected = BadRequestException.class)
169.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
170.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
171.   public void testCreatePrivateAppNamespaceExisted() {
172.     AppNamespace appNamespace = assembleBaseAppNamespace();
173.     appNamespace.setPublic(false);
174.     appNamespace.setName("datasource");
175.     appNamespace.setAppId("100003173");
176. 
177.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
178.   }
179. 
180.   @Test
181.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
182.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
183.   public void testCreatePrivateAppNamespaceExistedInAnotherAppId() {
184.     AppNamespace appNamespace = assembleBaseAppNamespace();
185.     appNamespace.setPublic(false);
186.     appNamespace.setName("datasource");
187.     appNamespace.setAppId("song0711-01");
188. 
189.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
190. 
191.     AppNamespace createdAppNamespace =
192.         appNamespaceService.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName());
193. 
194.     Assert.assertNotNull(createdAppNamespace);
195.     Assert.assertEquals(appNamespace.getName(), createdAppNamespace.getName());
196.   }
197. 
198.   @Test(expected = BadRequestException.class)
199.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
200.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
201.   public void testCreatePrivateAppNamespaceExistedInAnotherAppIdAsPublic() {
202.     AppNamespace appNamespace = assembleBaseAppNamespace();
203.     appNamespace.setPublic(false);
204.     appNamespace.setName("SCC.song0711-03");
205.     appNamespace.setAppId("100003173");
206.     appNamespace.setFormat(ConfigFileFormat.Properties.getValue());
207. 
208.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
209.   }
210. 
211.   @Test
212.   @Sql(scripts = "/sql/appnamespaceservice/init-appnamespace.sql", executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD)
213.   @Sql(scripts = "/sql/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
214.   public void testCreatePrivateAppNamespaceNotExisted() {
215.     AppNamespace appNamespace = assembleBaseAppNamespace();
216.     appNamespace.setPublic(false);
217. 
218.     appNamespaceService.createAppNamespaceInLocal(appNamespace);
219. 
220.     AppNamespace createdAppNamespace =
221.         appNamespaceService.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName());
222. 
223.     Assert.assertNotNull(createdAppNamespace);
224.     Assert.assertEquals(appNamespace.getName(), createdAppNamespace.getName());
225.   }
226. 
227.   private AppNamespace assembleBaseAppNamespace() {
228.     AppNamespace appNamespace = new AppNamespace();
229.     appNamespace.setName("appNamespace");
230.     appNamespace.setAppId("1000");
231.     appNamespace.setFormat(ConfigFileFormat.XML.getValue());
232.     return appNamespace;
233.   }
234. 
235. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 1 - 254
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.dto.ClusterDTO;
20. import com.ctrip.framework.apollo.common.dto.ItemDTO;
21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
22. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
25. import com.ctrip.framework.apollo.portal.component.PortalSettings;
26. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
27. import com.ctrip.framework.apollo.portal.environment.Env;
28. import com.ctrip.framework.apollo.portal.AbstractUnitTest;
29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
30. import com.ctrip.framework.apollo.portal.component.txtresolver.PropertyResolver;
31. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
32. import com.ctrip.framework.apollo.portal.entity.bo.UserInfo;
33. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
34. 
35. import org.assertj.core.util.Lists;
36. import org.junit.Before;
37. import org.junit.Test;
38. import org.mockito.InjectMocks;
39. import org.mockito.Mock;
40. 
41. import java.util.Arrays;
42. import java.util.Collections;
43. import java.util.List;
44. 
45. import static org.assertj.core.api.AssertionsForClassTypes.assertThat;
46. import static org.assertj.core.api.AssertionsForClassTypes.assertThatExceptionOfType;
47. import static org.junit.Assert.assertEquals;
48. import static org.mockito.Mockito.mock;
49. import static org.mockito.Mockito.times;
50. import static org.mockito.Mockito.verify;
51. import static org.mockito.Mockito.when;
52. 
53. public class NamespaceServiceTest extends AbstractUnitTest {
54. 
55.   @Mock
56.   private AdminServiceAPI.NamespaceAPI namespaceAPI;
57.   @Mock
58.   private ReleaseService releaseService;
59.   @Mock
60.   private ItemService itemService;
61.   @Mock
62.   private PropertyResolver resolver;
63.   @Mock
64.   private AppNamespaceService appNamespaceService;
65.   @Mock
66.   private InstanceService instanceService;
67.   @Mock
68.   private NamespaceBranchService branchService;
69.   @Mock
70.   private UserInfoHolder userInfoHolder;
71.   @Mock
72.   private AdditionalUserInfoEnrichService additionalUserInfoEnrichService;
73.   @Mock
74.   private PortalSettings portalSettings;
75.   @Mock
76.   private ClusterService clusterService;
77. 
78.   @InjectMocks
79.   private NamespaceService namespaceService;
80. 
81.   private String testAppId = "6666";
82.   private String testClusterName = "default";
83.   private String testNamespaceName = "application";
84.   private Env testEnv = Env.DEV;
85. 
86.   @Before
87.   public void setup() {
88.   }
89. 
90.   @Test
91.   public void testFindNamespace() {
92. 
93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);
94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);
95. 
96.     NamespaceDTO application = new NamespaceDTO();
97.     application.setId(1);
98.     application.setClusterName(testClusterName);
99.     application.setAppId(testAppId);
100.     application.setNamespaceName(testNamespaceName);
101. 
102.     NamespaceDTO hermes = new NamespaceDTO();
103.     hermes.setId(2);
104.     hermes.setClusterName("default");
105.     hermes.setAppId(testAppId);
106.     hermes.setNamespaceName("hermes");
107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);
108. 
109.     ReleaseDTO someRelease = new ReleaseDTO();
110.     someRelease.setConfigurations("{\"a\":\"123\",\"b\":\"123\"}");
111. 
112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);
113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);
114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);
115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);
116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);
117. 
118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());
119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());
120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))
121.         .thenReturn(applicationAppNamespace);
122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);
123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);
124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,
125.                                           testNamespaceName)).thenReturn(someRelease);
126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);
127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);
128. 
129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
130.     assertEquals(2, namespaceVOs.size());
131. 
132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));
133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
134.     assertEquals(1, namespaceVOs.size());
135.     NamespaceBO namespaceVO = namespaceVOs.get(0);
136.     assertEquals(4, namespaceVO.getItems().size());
137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());
138.     assertEquals(2, namespaceVO.getItemModifiedCnt());
139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());
140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());
141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());
142. 
143.     ReleaseDTO errorRelease = new ReleaseDTO();
144.     errorRelease.setConfigurations("\"a\":\"123\",\"b\":\"123\"");
145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);
146.     assertThatExceptionOfType(RuntimeException.class)
147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))
148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");
149. 
150.   }
151. 
152.   @Test
153.   public void testDeletePrivateNamespace() {
154.     String operator = "user";
155.     AppNamespace privateNamespace = createAppNamespace(testAppId, testNamespaceName, false);
156. 
157.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(privateNamespace);
158. 
159.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));
160. 
161.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);
162. 
163.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);
164.   }
165. 
166.   @Test
167.   public void testGetNamespaceUsage() {
168.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);
169.     String branchName = "branch";
170. 
171.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);
172. 
173.     when(portalSettings.getActiveEnvs()).thenReturn(Lists.newArrayList(testEnv));
174.     ClusterDTO cluster = new ClusterDTO();
175.     cluster.setName(testClusterName);
176.     cluster.setAppId(testAppId);
177.     when(clusterService.findClusters(testEnv, testAppId)).thenReturn(Lists.newArrayList(cluster));
178.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);
179.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))
180.         .thenReturn(8);
181.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);
182.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(9);
183.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);
184. 
185.     when(namespaceAPI.countPublicAppNamespaceAssociatedNamespaces(testEnv, testNamespaceName)).thenReturn(10);
186. 
187.     List<NamespaceUsage> usages = namespaceService.getNamespaceUsageByAppId(testAppId, testNamespaceName);
188.     assertThat(usages).asList().hasSize(1);
189.     assertThat(usages.get(0).getInstanceCount()).isEqualTo(8);
190.     assertThat(usages.get(0).getBranchInstanceCount()).isEqualTo(9);
191.     assertThat(usages.get(0).getLinkedNamespaceCount()).isEqualTo(10);
192. 
193.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(testAppId, testNamespaceName, testEnv, testClusterName);
194.     assertThat(usage).isNotNull();
195.     assertThat(usage.getInstanceCount()).isEqualTo(8);
196.     assertThat(usage.getBranchInstanceCount()).isEqualTo(9);
197.     assertThat(usage.getLinkedNamespaceCount()).isEqualTo(0);
198.   }
199. 
200.   @Test
201.   public void testDeleteEmptyNamespace() {
202.     String branchName = "branch";
203.     String operator = "user";
204. 
205.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);
206.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);
207. 
208.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);
209.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))
210.         .thenReturn(0);
211.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);
212.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(0);
213.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);
214. 
215.     NamespaceDTO namespace = createNamespace(testAppId, testClusterName, testNamespaceName);
216.     when(namespaceAPI.getPublicAppNamespaceAllNamespaces(testEnv, testNamespaceName, 0, 10)).thenReturn(
217.         Collections.singletonList(namespace));
218.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));
219. 
220.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);
221. 
222.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);
223. 
224.   }
225. 
226. 
227.   private AppNamespace createAppNamespace(String appId, String name, boolean isPublic) {
228.     AppNamespace instance = new AppNamespace();
229. 
230.     instance.setAppId(appId);
231.     instance.setName(name);
232.     instance.setPublic(isPublic);
233. 
234.     return instance;
235.   }
236. 
237.   private NamespaceDTO createNamespace(String appId, String clusterName, String namespaceName) {
238.     NamespaceDTO instance = new NamespaceDTO();
239. 
240.     instance.setAppId(appId);
241.     instance.setClusterName(clusterName);
242.     instance.setNamespaceName(namespaceName);
243. 
244.     return instance;
245.   }
246. 
247.   private UserInfo createUser(String userId) {
248.     UserInfo instance = new UserInfo();
249. 
250.     instance.setUserId(userId);
251. 
252.     return instance;
253.   }
254. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 11:36:58,056 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n   - The query asks for tests validating namespace names and namespace creation/querying.\n   - This test method tries to create a Namespace with an invalid name and asserts the specific InputValidator message.\n2. Extended relevance:\n   - Includes necessary imports and the test method demonstrating validation behavior on namespace creation in adminservice.', relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', start_line=19, end_line=47), ContextOutput(reasoning='1. Query requirement analysis:\n   - The query asks for tests validating namespace names in portal openapi.\n   - These imports include InputValidator and exceptions needed to assert invalid namespace name behavior.\n2. Extended relevance:\n   - Provides essential imports used by the test method which validates namespace names.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', start_line=19, end_line=29), ContextOutput(reasoning='1. Query requirement analysis:\n   - The query asks for tests validating namespace names.\n   - This test method constructs OpenAppNamespaceDTO with an invalid name and asserts both cluster and namespace invalid messages.\n2. Extended relevance:\n   - Shows behavior of namespace creation failing due to invalid name in portal openapi.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', start_line=40, end_line=61), ContextOutput(reasoning='1. Query requirement analysis:\n   - The query seeks understanding of namespace querying behavior.\n   - These test methods validate how namespace names are filtered (e.g., removing .properties suffix) which is essential for querying file-based namespaces.\n2. Extended relevance:\n   - Provides key implementation details of namespace name handling used by configservice during queries.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', start_line=45, end_line=78), ContextOutput(reasoning='1. Query requirement analysis:\n   - Demonstrates configservice querying behavior when a file-based namespace name is passed and filtered/normalized.\n2. Extended relevance:\n   - Shows dependencies on NamespaceUtil.filterNamespaceName/normalizeNamespace and configService.loadConfig, essential for understanding namespace query flow.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=135, end_line=159), ContextOutput(reasoning='1. Query requirement analysis:\n   - Demonstrates portal service querying namespaces, building NamespaceBOs, and handling configurations and items.\n2. Extended relevance:\n   - Essential for understanding namespace querying in portal layer, including interactions with AdminService API and AppNamespaceService.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', start_line=90, end_line=150), ContextOutput(reasoning='1. Query requirement analysis:\n   - The query asks for tests related to namespace creation.\n   - This test verifies creating an AppNamespace via adminservice controller and persistence checks.\n2. Extended relevance:\n   - Includes setup of AppNamespaceDTO and repository assertions necessary to understand namespace creation flow.', relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java', start_line=33, end_line=61)]
2025-11-12 11:36:58,060 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 7 contexts to memory for query: Please provide the full content (with line numbers) of all test files related to namespace creation and querying under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-configservice/src/test/java, and apollo-biz/src/test/java (especially files/classes containing “Namespace”).
2025-11-12 11:36:58,428 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 11:36:58,430 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 7 new contexts to 0 existing contexts
2025-11-12 11:36:58,430 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 7 total contexts (removed 0 duplicates)
2025-11-12 11:36:58,431 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content (with line numbers) of all test files related to namespace creation and querying under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-configservice/src/test/java, and apollo-biz/src/test/java (especially files/classes containing “Namespace”).
Extra Requirements: If the full directories are too large, include at minimum the imports, test setup/mocks, helper functions, and all test methods that validate namespace names (including single dot “.” cases), with exact file paths and line numbers.
Purpose: I need these tests to extract 5 self-contained cases demonstrating behavior when creating and querying namespaces, especially with dot-named namespaces causing 500 errors.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java
Line number range: 33 - 61
Content:
33.   @Test
34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
35.   public void testCreate(){
36.     String appId = "6666";
37.     String name = "testnamespace";
38.     String comment = "comment";
39.     AppNamespaceDTO dto = new AppNamespaceDTO();
40.     dto.setAppId(appId);
41.     dto.setName(name);
42.     dto.setComment(comment);
43.     dto.setDataChangeCreatedBy("apollo");
44. 
45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(
46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();
47. 
48.     Assert.assertEquals(appId, resultDto.getAppId());
49.     Assert.assertTrue(resultDto.getId() > 0);
50. 
51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);
52.     Assert.assertNotNull(savedAppNs);
53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());
54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());
55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());
56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());
57. 
58. 
59. 
60. 
61.   }


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java
Line number range: 19 - 47
Content:
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import org.junit.Assert;
22. import org.junit.Test;
23. import org.springframework.web.client.HttpClientErrorException;
24. import static org.hamcrest.Matchers.containsString;
25. 
26. /**
27.  * Created by kezhenxu at 2019/1/8 16:27.
28.  *
29.  * @author kezhenxu (kezhenxu94@163.com)
30.  */
31. public class NamespaceControllerTest extends AbstractControllerTest {
32.   @Test
33.   public void create() {
34.     try {
35.       NamespaceDTO namespaceDTO = new NamespaceDTO();
36.       namespaceDTO.setClusterName("cluster");
37.       namespaceDTO.setNamespaceName("invalid name");
38.       namespaceDTO.setAppId("whatever");
39.       restTemplate.postForEntity(
40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),
41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());
42.       Assert.fail("Should throw");
43.     } catch (HttpClientErrorException e) {
44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
45.     }
46.   }
47. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 135 - 159
Content:
135.   @Test
136.   public void testQueryConfigFile() throws Exception {
137.     String someClientSideReleaseKey = "1";
138.     String someServerSideNewReleaseKey = "2";
139.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
140.     String someNamespaceName = String.format("%s.%s", defaultClusterName, "properties");
141. 
142.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
143.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
144.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
145.     when(namespaceUtil.filterNamespaceName(someNamespaceName)).thenReturn(defaultNamespaceName);
146.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
147. 
148.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
149.         someNamespaceName, someDataCenter, someClientSideReleaseKey,
150.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
151. 
152.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
153.         defaultNamespaceName, someDataCenter, someNotificationMessages);
154.     assertEquals(someAppId, result.getAppId());
155.     assertEquals(someClusterName, result.getCluster());
156.     assertEquals(someNamespaceName, result.getNamespaceName());
157.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
158.   }
159. 


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 45 - 78
Content:
45.   @Test
46.   public void testFilterNamespaceName() throws Exception {
47.     String someName = "a.properties";
48. 
49.     assertEquals("a", namespaceUtil.filterNamespaceName(someName));
50.   }
51. 
52.   @Test
53.   public void testFilterNamespaceNameUnchanged() throws Exception {
54.     String someName = "a.xml";
55. 
56.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
57.   }
58. 
59.   @Test
60.   public void testFilterNamespaceNameWithMultiplePropertiesSuffix() throws Exception {
61.     String someName = "a.properties.properties";
62. 
63.     assertEquals("a.properties", namespaceUtil.filterNamespaceName(someName));
64.   }
65. 
66.   @Test
67.   public void testFilterNamespaceNameWithRandomCase() throws Exception {
68.     String someName = "AbC.ProPErties";
69. 
70.     assertEquals("AbC", namespaceUtil.filterNamespaceName(someName));
71.   }
72. 
73.   @Test
74.   public void testFilterNamespaceNameWithRandomCaseUnchanged() throws Exception {
75.     String someName = "AbCD.xMl";
76. 
77.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
78.   }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 19 - 29
Content:
19. import com.ctrip.framework.apollo.common.utils.InputValidator;
20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;
22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.ActiveProfiles;
27. import org.springframework.web.client.HttpClientErrorException;
28. import static org.hamcrest.Matchers.containsString;
29. 


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 40 - 61
Content:
40.   @Test
41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {
42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));
43. 
44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();
45.     dto.setAppId("appId");
46.     dto.setName("invalid name");
47.     dto.setFormat(ConfigFileFormat.Properties.getValue());
48.     dto.setDataChangeCreatedBy("apollo");
49.     try {
50.       restTemplate.postForEntity(
51.           url("/openapi/v1/apps/{appId}/appnamespaces"),
52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()
53.       );
54.       Assert.fail("should throw");
55.     } catch (HttpClientErrorException e) {
56.       String result = e.getResponseBodyAsString();
57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
59.     }
60.   }
61. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 90 - 150
Content:
90.   @Test
91.   public void testFindNamespace() {
92. 
93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);
94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);
95. 
96.     NamespaceDTO application = new NamespaceDTO();
97.     application.setId(1);
98.     application.setClusterName(testClusterName);
99.     application.setAppId(testAppId);
100.     application.setNamespaceName(testNamespaceName);
101. 
102.     NamespaceDTO hermes = new NamespaceDTO();
103.     hermes.setId(2);
104.     hermes.setClusterName("default");
105.     hermes.setAppId(testAppId);
106.     hermes.setNamespaceName("hermes");
107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);
108. 
109.     ReleaseDTO someRelease = new ReleaseDTO();
110.     someRelease.setConfigurations("{\"a\":\"123\",\"b\":\"123\"}");
111. 
112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);
113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);
114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);
115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);
116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);
117. 
118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());
119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());
120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))
121.         .thenReturn(applicationAppNamespace);
122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);
123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);
124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,
125.                                           testNamespaceName)).thenReturn(someRelease);
126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);
127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);
128. 
129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
130.     assertEquals(2, namespaceVOs.size());
131. 
132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));
133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
134.     assertEquals(1, namespaceVOs.size());
135.     NamespaceBO namespaceVO = namespaceVOs.get(0);
136.     assertEquals(4, namespaceVO.getItems().size());
137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());
138.     assertEquals(2, namespaceVO.getItemModifiedCnt());
139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());
140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());
141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());
142. 
143.     ReleaseDTO errorRelease = new ReleaseDTO();
144.     errorRelease.setConfigurations("\"a\":\"123\",\"b\":\"123\"");
145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);
146.     assertThatExceptionOfType(RuntimeException.class)
147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))
148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");
149. 
150.   }

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:37:26,959 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The aggregated context only includes partial snippets of several relevant tests, missing full imports, class definitions, helpers, and exact line numbers from the start of each file. The task requires 5 complete, self-contained test cases with all imports and exact file paths and line numbers, which cannot be satisfied with partial excerpts. We should request the full content (with line numbers) of the specific test files already identified as relevant and also include InputValidator-related tests that likely cover namespace name validation (including dot cases). This avoids repeating the previous broad directory request and targets precise files needed to assemble the 5 test cases.' query='Please provide the full content (with line numbers) of the following test files: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java; additionally, include any InputValidator test file (e.g., apollo-common/src/test/java/.../InputValidatorTest.java) if present.' extra_requirements='If sending full files is too large, include at minimum the package declaration, all import statements, class definitions, helper/fixture setup, and complete test methods that validate namespace name rules (including a single dot "." case), with exact file paths and line numbers.' purpose='I need these complete files to extract 5 self-contained test cases with all imports and precise line references that best match the dot-named namespace bug scenario.'
2025-11-12 11:37:26,961 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full content (with line numbers) of the following test files: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java; additionally, include any InputValidator test file (e.g., apollo-common/src/test/java/.../InputValidatorTest.java) if present.
2025-11-12 11:37:28,028 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 11:37:28,029 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 11:37:28,031 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 11:37:28,032 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 11:37:28,034 - thread-135845287823040.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 11:37:28,036 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 11:37:28,036 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full content (with line numbers) of the following test files: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java; additionally, include any InputValidator test file (e.g., apollo-common/src/test/java/.../InputValidatorTest.java) if present.
Extra requirements: If sending full files is too large, include at minimum the package declaration, all import statements, class definitions, helper/fixture setup, and complete test methods that validate namespace name rules (including a single dot "." case), with exact file paths and line numbers.
Purpose: I need these complete files to extract 5 self-contained test cases with all imports and precise line references that best match the dot-named namespace bug scenario.
2025-11-12 11:37:35,789 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_vYJGepj8LJanSklttGaYJwnp', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 562, 'prompt_tokens': 2433, 'total_tokens': 2995, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6b3d5421-6308-47e4-8614-0edc730b7e36-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java'}, 'id': 'call_vYJGepj8LJanSklttGaYJwnp', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2433, 'output_tokens': 562, 'total_tokens': 2995, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 11:37:37,042 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ddr9iW9HQmbt2WNTQSQPGng6', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 3120, 'total_tokens': 3164, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f33a34f3-0ae0-486c-9e21-1d15daa6b493-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java'}, 'id': 'call_ddr9iW9HQmbt2WNTQSQPGng6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3120, 'output_tokens': 44, 'total_tokens': 3164, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:37:38,522 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_R6gFaqkzOiQQK1aFmDXO1iqe', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 3966, 'total_tokens': 4010, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--5683c9bb-bda9-4a3f-91cf-f746e6f307fe-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java'}, 'id': 'call_R6gFaqkzOiQQK1aFmDXO1iqe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3966, 'output_tokens': 44, 'total_tokens': 4010, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:37:40,071 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_RahpkB2m7XKCnEGMH6E8LWvh', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 11102, 'total_tokens': 11146, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f4bdbc73-5ff2-43fb-abc4-7151d6b18d2e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java'}, 'id': 'call_RahpkB2m7XKCnEGMH6E8LWvh', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11102, 'output_tokens': 44, 'total_tokens': 11146, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:37:43,215 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_XB2iZwEnOxs8MScxatqvbfIh', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 46, 'prompt_tokens': 12742, 'total_tokens': 12788, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--98a00bbc-0ee7-4b6b-ba24-55918c445111-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java'}, 'id': 'call_XB2iZwEnOxs8MScxatqvbfIh', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12742, 'output_tokens': 46, 'total_tokens': 12788, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:37:44,990 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1cYB5b5AmaUnrUW3HRGengDR', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 13598, 'total_tokens': 13642, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--055d1c38-1916-4cd5-8937-936aa57e91c1-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java'}, 'id': 'call_1cYB5b5AmaUnrUW3HRGengDR', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13598, 'output_tokens': 44, 'total_tokens': 13642, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:37:48,464 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_sjmLUWL9rUEN09GzqJAXFOZx', 'function': {'arguments': '{"basename":"InputValidatorTest.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 223, 'prompt_tokens': 17096, 'total_tokens': 17319, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--467b326f-b1ca-4684-9371-0bd2564ecba4-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'InputValidatorTest.java'}, 'id': 'call_sjmLUWL9rUEN09GzqJAXFOZx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 17096, 'output_tokens': 223, 'total_tokens': 17319, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 11:37:50,036 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VOKpLj7SXpAk90aGiUMSb7Ch', 'function': {'arguments': '{"relative_path":"apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 17183, 'total_tokens': 17224, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f82e37bb-265f-4a98-83dd-d8b943013f38-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java'}, 'id': 'call_VOKpLj7SXpAk90aGiUMSb7Ch', 'type': 'tool_call'}] usage_metadata={'input_tokens': 17183, 'output_tokens': 41, 'total_tokens': 17224, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:38:02,961 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_MdTrd2by5FuOoQlKc7efZT5M', 'function': {'arguments': '{"text":"\\".\\"", "basename":"InputValidatorTest.java"}', 'name': 'find_ast_node_with_text_in_file_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 745, 'prompt_tokens': 17906, 'total_tokens': 18651, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4ca67707-5018-4185-91dd-78b35ccbc5d6-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'text': '"."', 'basename': 'InputValidatorTest.java'}, 'id': 'call_MdTrd2by5FuOoQlKc7efZT5M', 'type': 'tool_call'}] usage_metadata={'input_tokens': 17906, 'output_tokens': 745, 'total_tokens': 18651, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-12 11:38:17,124 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located and read the full contents (with line numbers) of all six requested test files and the InputValidatorTest in apollo-common. The outputs include package declarations, imports, class definitions, helper/fixture setup, and complete test methods. These tests cover namespace validation and filtering logic across adminservice, configservice, and portal modules. Note that InputValidatorTest checks various namespace formats but does not include a single dot "." case explicitly.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1058, 'prompt_tokens': 17970, 'total_tokens': 19028, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3072}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--926c71bf-87f7-4781-8a27-5617820e562e-0' usage_metadata={'input_tokens': 17970, 'output_tokens': 1058, 'total_tokens': 19028, 'input_token_details': {'audio': 0, 'cache_read': 3072}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 11:38:17,128 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full content (with line numbers) of the following test files: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java; additionally, include any InputValidator test file (e.g., apollo-common/src/test/java/.../InputValidatorTest.java) if present.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If sending full files is too large, include at minimum the package declaration, all import statements, class definitions, helper/fixture setup, and complete test methods that validate namespace name rules (including a single dot "." case), with exact file paths and line numbers.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
I need these complete files to extract 5 self-contained test cases with all imports and precise line references that best match the dot-named namespace bug scenario.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java
Line number range: 1 - 62
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;
20. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
21. import com.ctrip.framework.apollo.common.entity.AppNamespace;
22. 
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.jdbc.Sql;
27. 
28. public class AppNamespaceControllerTest extends AbstractControllerTest{
29. 
30.   @Autowired
31.   private AppNamespaceRepository namespaceRepository;
32. 
33.   @Test
34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
35.   public void testCreate(){
36.     String appId = "6666";
37.     String name = "testnamespace";
38.     String comment = "comment";
39.     AppNamespaceDTO dto = new AppNamespaceDTO();
40.     dto.setAppId(appId);
41.     dto.setName(name);
42.     dto.setComment(comment);
43.     dto.setDataChangeCreatedBy("apollo");
44. 
45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(
46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();
47. 
48.     Assert.assertEquals(appId, resultDto.getAppId());
49.     Assert.assertTrue(resultDto.getId() > 0);
50. 
51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);
52.     Assert.assertNotNull(savedAppNs);
53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());
54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());
55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());
56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());
57. 
58. 
59. 
60. 
61.   }
62. }


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java
Line number range: 1 - 47
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import org.junit.Assert;
22. import org.junit.Test;
23. import org.springframework.web.client.HttpClientErrorException;
24. import static org.hamcrest.Matchers.containsString;
25. 
26. /**
27.  * Created by kezhenxu at 2019/1/8 16:27.
28.  *
29.  * @author kezhenxu (kezhenxu94@163.com)
30.  */
31. public class NamespaceControllerTest extends AbstractControllerTest {
32.   @Test
33.   public void create() {
34.     try {
35.       NamespaceDTO namespaceDTO = new NamespaceDTO();
36.       namespaceDTO.setClusterName("cluster");
37.       namespaceDTO.setNamespaceName("invalid name");
38.       namespaceDTO.setAppId("whatever");
39.       restTemplate.postForEntity(
40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),
41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());
42.       Assert.fail("Should throw");
43.     } catch (HttpClientErrorException e) {
44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
45.     }
46.   }
47. }


File: apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java
Line number range: 1 - 54
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.common.utils;
18. 
19. import static org.junit.Assert.*;
20. 
21. import org.junit.Test;
22. 
23. public class InputValidatorTest {
24. 
25.   @Test
26.   public void testValidClusterName() throws Exception {
27.     checkClusterName("some.cluster-_name.123", true);
28.     checkClusterName("some.cluster-_name.123.yml", true);
29.     checkClusterName("some.&.name", false);
30.     checkClusterName("", false);
31.     checkClusterName(null, false);
32.   }
33. 
34.   @Test
35.   public void testValidAppNamespaceName() throws Exception {
36.     checkAppNamespaceName("some.cluster-_name.123", true);
37.     checkAppNamespaceName("some.&.name", false);
38.     checkAppNamespaceName("", false);
39.     checkAppNamespaceName(null, false);
40.     checkAppNamespaceName("some.name.json", false);
41.     checkAppNamespaceName("some.name.yml", false);
42.     checkAppNamespaceName("some.name.yaml", false);
43.     checkAppNamespaceName("some.name.xml", false);
44.     checkAppNamespaceName("some.name.properties", false);
45.   }
46. 
47.   private void checkClusterName(String name, boolean valid) {
48.     assertEquals(valid, InputValidator.isValidClusterNamespace(name));
49.   }
50. 
51.   private void checkAppNamespaceName(String name, boolean valid) {
52.     assertEquals(valid, InputValidator.isValidAppNamespace(name));
53.   }
54. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 1 - 481
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Release;
20. import com.ctrip.framework.apollo.common.entity.AppNamespace;
21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;
23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;
24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;
25. import com.ctrip.framework.apollo.core.ConfigConsts;
26. import com.ctrip.framework.apollo.core.dto.ApolloConfig;
27. import com.ctrip.framework.apollo.core.dto.ApolloNotificationMessages;
28. import com.google.common.base.Joiner;
29. import com.google.common.collect.ImmutableMap;
30. import com.google.common.collect.Lists;
31. import com.google.gson.Gson;
32. import com.google.gson.JsonSyntaxException;
33. import org.junit.Before;
34. import org.junit.Test;
35. import org.junit.runner.RunWith;
36. import org.mockito.Mock;
37. import org.mockito.junit.MockitoJUnitRunner;
38. 
39. import javax.servlet.http.HttpServletRequest;
40. import javax.servlet.http.HttpServletResponse;
41. import java.util.Map;
42. 
43. import static org.junit.Assert.assertEquals;
44. import static org.junit.Assert.assertNull;
45. import static org.mockito.Mockito.*;
46. 
47. /**
48.  * @author Jason Song(song_s@ctrip.com)
49.  */
50. @RunWith(MockitoJUnitRunner.class)
51. public class ConfigControllerTest {
52.   private ConfigController configController;
53.   @Mock
54.   private ConfigService configService;
55.   @Mock
56.   private AppNamespaceServiceWithCache appNamespaceService;
57.   private String someAppId;
58.   private String someClusterName;
59.   private String defaultClusterName;
60.   private String defaultNamespaceName;
61.   private String somePublicNamespaceName;
62.   private String someDataCenter;
63.   private String someClientIp;
64.   private String someClientLabel;
65.   private String someMessagesAsString;
66.   @Mock
67.   private ApolloNotificationMessages someNotificationMessages;
68.   @Mock
69.   private Release someRelease;
70.   @Mock
71.   private Release somePublicRelease;
72.   @Mock
73.   private NamespaceUtil namespaceUtil;
74.   @Mock
75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;
76.   @Mock
77.   private HttpServletRequest someRequest;
78.   private Gson gson = new Gson();
79. 
80.   @Before
81.   public void setUp() throws Exception {
82.     configController = spy(new ConfigController(
83.         configService, appNamespaceService, namespaceUtil, instanceConfigAuditUtil, gson
84.     ));
85. 
86.     someAppId = "1";
87.     someClusterName = "someClusterName";
88.     defaultClusterName = ConfigConsts.CLUSTER_NAME_DEFAULT;
89.     defaultNamespaceName = ConfigConsts.NAMESPACE_APPLICATION;
90.     somePublicNamespaceName = "somePublicNamespace";
91.     someDataCenter = "someDC";
92.     someClientIp = "someClientIp";
93.     someClientLabel = "someClientLabel";
94.     String someValidConfiguration = "{\"apollo.bar\": \"foo\"}";
95.     String somePublicConfiguration = "{\"apollo.public.bar\": \"foo\"}";
96. 
97.     when(someRelease.getAppId()).thenReturn(someAppId);
98.     when(someRelease.getClusterName()).thenReturn(someClusterName);
99.     when(someRelease.getConfigurations()).thenReturn(someValidConfiguration);
100.     when(somePublicRelease.getConfigurations()).thenReturn(somePublicConfiguration);
101.     when(namespaceUtil.filterNamespaceName(defaultNamespaceName)).thenReturn(defaultNamespaceName);
102.     when(namespaceUtil.filterNamespaceName(somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
103.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
104.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
105. 
106.     someMessagesAsString = "someValidJson";
107.     when(configController.transformMessages(someMessagesAsString)).thenReturn(someNotificationMessages);
108.   }
109. 
110.   @Test
111.   public void testQueryConfig() throws Exception {
112.     String someClientSideReleaseKey = "1";
113.     String someServerSideNewReleaseKey = "2";
114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
115. 
116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);
120. 
121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
124. 
125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
126.         defaultNamespaceName, someDataCenter, someNotificationMessages);
127.     assertEquals(someAppId, result.getAppId());
128.     assertEquals(someClusterName, result.getCluster());
129.     assertEquals(defaultNamespaceName, result.getNamespaceName());
130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);
133.   }
134. 
135.   @Test
136.   public void testQueryConfigFile() throws Exception {
137.     String someClientSideReleaseKey = "1";
138.     String someServerSideNewReleaseKey = "2";
139.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
140.     String someNamespaceName = String.format("%s.%s", defaultClusterName, "properties");
141. 
142.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
143.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
144.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
145.     when(namespaceUtil.filterNamespaceName(someNamespaceName)).thenReturn(defaultNamespaceName);
146.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
147. 
148.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
149.         someNamespaceName, someDataCenter, someClientSideReleaseKey,
150.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
151. 
152.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
153.         defaultNamespaceName, someDataCenter, someNotificationMessages);
154.     assertEquals(someAppId, result.getAppId());
155.     assertEquals(someClusterName, result.getCluster());
156.     assertEquals(someNamespaceName, result.getNamespaceName());
157.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
158.   }
159. 
160.   @Test
161.   public void testQueryConfigFileWithPrivateNamespace() throws Exception {
162.     String someClientSideReleaseKey = "1";
163.     String someServerSideNewReleaseKey = "2";
164.     String somePrivateNamespace = "datasource";
165.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
166.     String somePrivateNamespaceName = String.format("%s.%s", somePrivateNamespace, "xml");
167.     AppNamespace appNamespace = mock(AppNamespace.class);
168. 
169.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePrivateNamespace,
170.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
171.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
172.     when(namespaceUtil.filterNamespaceName(somePrivateNamespaceName)).thenReturn(somePrivateNamespace);
173.     when(namespaceUtil.normalizeNamespace(someAppId, somePrivateNamespace)).thenReturn(somePrivateNamespace);
174.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePrivateNamespace))
175.         .thenReturn(appNamespace);
176. 
177.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
178.         somePrivateNamespaceName, someDataCenter, someClientSideReleaseKey,
179.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
180. 
181.     assertEquals(someAppId, result.getAppId());
182.     assertEquals(someClusterName, result.getCluster());
183.     assertEquals(somePrivateNamespaceName, result.getNamespaceName());
184.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
185.   }
186. 
187.   @Test
188.   public void testQueryConfigWithReleaseNotFound() throws Exception {
189.     String someClientSideReleaseKey = "1";
190.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
191. 
192.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
193.         someDataCenter, someNotificationMessages)).thenReturn(null);
194. 
195.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
196.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
197.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
198. 
199.     assertNull(result);
200.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());
201.   }
202. 
203.   @Test
204.   public void testQueryConfigWithApolloConfigNotModified() throws Exception {
205.     String someClientSideReleaseKey = "1";
206.     String someServerSideReleaseKey = someClientSideReleaseKey;
207.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
208. 
209.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
210.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
211.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
212. 
213.     ApolloConfig result =
214.         configController.queryConfig(someAppId, someClusterName, defaultNamespaceName, someDataCenter,
215.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
216. 
217.     assertNull(result);
218.     verify(someResponse, times(1)).setStatus(HttpServletResponse.SC_NOT_MODIFIED);
219.   }
220. 
221.   @Test
222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {
223.     String someClientSideReleaseKey = "1";
224.     String someServerSideReleaseKey = "2";
225.     String someAppOwnNamespaceName = "someAppOwn";
226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
227.     AppNamespace someAppOwnNamespace =
228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);
229. 
230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,
231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))
233.         .thenReturn(someAppOwnNamespace);
234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
237. 
238.     ApolloConfig result =
239.         configController
240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,
241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
242. 
243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
244.     assertEquals(someAppId, result.getAppId());
245.     assertEquals(someClusterName, result.getCluster());
246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());
247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));
248.   }
249. 
250.   @Test
251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {
252.     String someClientSideReleaseKey = "1";
253.     String someServerSideReleaseKey = "2";
254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
255.     String somePublicAppId = "somePublicAppId";
256.     String somePublicClusterName = "somePublicClusterName";
257.     AppNamespace somePublicAppNamespace =
258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
259. 
260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
261.         someDataCenter, someNotificationMessages)).thenReturn(null);
262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
263.         .thenReturn(somePublicAppNamespace);
264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);
269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
270. 
271.     ApolloConfig result = configController
272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
274. 
275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
276.     assertEquals(someAppId, result.getAppId());
277.     assertEquals(someClusterName, result.getCluster());
278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);
282.   }
283. 
284.   @Test
285.   public void testQueryConfigFileWithPublicNamespaceAndNoAppOverride() throws Exception {
286.     String someClientSideReleaseKey = "1";
287.     String someServerSideReleaseKey = "2";
288.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
289.     String somePublicAppId = "somePublicAppId";
290.     String someNamespace = String.format("%s.%s", somePublicNamespaceName, "properties");
291.     AppNamespace somePublicAppNamespace =
292.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
293. 
294.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
295.         someDataCenter, someNotificationMessages)).thenReturn(null);
296.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
297.         .thenReturn(somePublicAppNamespace);
298.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
299.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
300.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
301.     when(namespaceUtil.filterNamespaceName(someNamespace)).thenReturn(somePublicNamespaceName);
302.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
303.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePublicNamespaceName)).thenReturn(null);
304. 
305.     ApolloConfig result = configController
306.         .queryConfig(someAppId, someClusterName, someNamespace, someDataCenter,
307.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
308. 
309.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
310.     assertEquals(someAppId, result.getAppId());
311.     assertEquals(someClusterName, result.getCluster());
312.     assertEquals(someNamespace, result.getNamespaceName());
313.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
314.   }
315. 
316.   @Test
317.   public void testQueryConfigWithPublicNamespaceAndAppOverride() throws Exception {
318.     String someAppSideReleaseKey = "1";
319.     String somePublicAppSideReleaseKey = "2";
320. 
321.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
322.     String somePublicAppId = "somePublicAppId";
323.     AppNamespace somePublicAppNamespace =
324.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
325. 
326.     when(someRelease.getConfigurations()).thenReturn("{\"apollo.public.foo\": \"foo-override\"}");
327.     when(somePublicRelease.getConfigurations())
328.         .thenReturn("{\"apollo.public.foo\": \"foo\", \"apollo.public.bar\": \"bar\"}");
329. 
330.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
331.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
332.     when(someRelease.getReleaseKey()).thenReturn(someAppSideReleaseKey);
333.     when(someRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
334.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
335.         .thenReturn(somePublicAppNamespace);
336.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
337.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
338.     when(somePublicRelease.getReleaseKey()).thenReturn(somePublicAppSideReleaseKey);
339.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
340.     when(somePublicRelease.getClusterName()).thenReturn(someDataCenter);
341.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
342. 
343.     ApolloConfig result =
344.         configController
345.             .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
346.                 someAppSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
347. 
348.     assertEquals(Joiner.on(ConfigConsts.CLUSTER_NAMESPACE_SEPARATOR)
349.             .join(someAppSideReleaseKey, somePublicAppSideReleaseKey),
350.         result.getReleaseKey());
351.     assertEquals(someAppId, result.getAppId());
352.     assertEquals(someClusterName, result.getCluster());
353.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
354.     assertEquals("foo-override", result.getConfigurations().get("apollo.public.foo"));
355.     assertEquals("bar", result.getConfigurations().get("apollo.public.bar"));
356.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
357.         someClientIp, someAppId, someClusterName, somePublicNamespaceName, someAppSideReleaseKey);
358.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
359.         someClientIp, somePublicAppId, someDataCenter, somePublicNamespaceName, somePublicAppSideReleaseKey);
360.   }
361. 
362.   @Test
363.   public void testMergeConfigurations() throws Exception {
364.     Gson gson = new Gson();
365.     String key1 = "key1";
366.     String value1 = "value1";
367.     String anotherValue1 = "anotherValue1";
368. 
369.     String key2 = "key2";
370.     String value2 = "value2";
371. 
372.     Map<String, String> config = ImmutableMap.of(key1, anotherValue1);
373.     Map<String, String> anotherConfig = ImmutableMap.of(key1, value1, key2, value2);
374. 
375.     Release releaseWithHighPriority = new Release();
376.     releaseWithHighPriority.setConfigurations(gson.toJson(config));
377. 
378.     Release releaseWithLowPriority = new Release();
379.     releaseWithLowPriority.setConfigurations(gson.toJson(anotherConfig));
380. 
381.     Map<String, String> result =
382.         configController.mergeReleaseConfigurations(
383.             Lists.newArrayList(releaseWithHighPriority, releaseWithLowPriority));
384. 
385.     assertEquals(2, result.keySet().size());
386.     assertEquals(anotherValue1, result.get(key1));
387.     assertEquals(value2, result.get(key2));
388.   }
389. 
390.   @Test(expected = JsonSyntaxException.class)
391.   public void testTransformConfigurationToMapFailed() throws Exception {
392.     String someInvalidConfiguration = "xxx";
393.     Release someRelease = new Release();
394.     someRelease.setConfigurations(someInvalidConfiguration);
395. 
396.     configController.mergeReleaseConfigurations(Lists.newArrayList(someRelease));
397.   }
398. 
399.   @Test
400.   public void testQueryConfigForNoAppIdPlaceHolder() throws Exception {
401.     String someClientSideReleaseKey = "1";
402.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
403.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
404. 
405.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
406.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
407.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
408. 
409.     verify(configService, never()).loadConfig(appId, someClientIp, someAppId, someClientLabel, someClusterName, defaultNamespaceName,
410.         someDataCenter, someNotificationMessages);
411.     verify(appNamespaceService, never()).findPublicNamespaceByName(defaultNamespaceName);
412.     assertNull(result);
413.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());
414.   }
415. 
416.   @Test
417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {
418.     String someClientSideReleaseKey = "1";
419.     String someServerSideReleaseKey = "2";
420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
421.     String somePublicAppId = "somePublicAppId";
422.     AppNamespace somePublicAppNamespace =
423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
425. 
426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
427.         .thenReturn(somePublicAppNamespace);
428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
432. 
433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,
435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
436. 
437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,
438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);
439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
440.     assertEquals(appId, result.getAppId());
441.     assertEquals(someClusterName, result.getCluster());
442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
444.   }
445. 
446.   @Test
447.   public void testTransformMessages() throws Exception {
448.     String someKey = "someKey";
449.     long someNotificationId = 1;
450.     String anotherKey = "anotherKey";
451.     long anotherNotificationId = 2;
452.     ApolloNotificationMessages notificationMessages = new ApolloNotificationMessages();
453.     notificationMessages.put(someKey, someNotificationId);
454.     notificationMessages.put(anotherKey, anotherNotificationId);
455. 
456.     String someMessagesAsString = gson.toJson(notificationMessages);
457. 
458.     ApolloNotificationMessages result = configController.transformMessages(someMessagesAsString);
459. 
460.     assertEquals(notificationMessages.getDetails(), result.getDetails());
461.   }
462. 
463.   @Test
464.   public void testTransformInvalidMessages() throws Exception {
465.     String someInvalidMessages = "someInvalidMessages";
466. 
467.     assertNull(configController.transformMessages(someInvalidMessages));
468.   }
469. 
470.   private AppNamespace assemblePublicAppNamespace(String appId, String namespace) {
471.     return assembleAppNamespace(appId, namespace, true);
472.   }
473. 
474.   private AppNamespace assembleAppNamespace(String appId, String namespace, boolean isPublic) {
475.     AppNamespace appNamespace = new AppNamespace();
476.     appNamespace.setAppId(appId);
477.     appNamespace.setName(namespace);
478.     appNamespace.setPublic(isPublic);
479.     return appNamespace;
480.   }
481. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 1 - 127
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.util;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
21. import org.junit.Before;
22. import org.junit.Test;
23. import org.junit.runner.RunWith;
24. import org.mockito.Mock;
25. import org.mockito.junit.MockitoJUnitRunner;
26. 
27. import static org.junit.Assert.assertEquals;
28. import static org.mockito.Mockito.*;
29. 
30. /**
31.  * @author Jason Song(song_s@ctrip.com)
32.  */
33. @RunWith(MockitoJUnitRunner.class)
34. public class NamespaceUtilTest {
35.   private NamespaceUtil namespaceUtil;
36. 
37.   @Mock
38.   private AppNamespaceServiceWithCache appNamespaceServiceWithCache;
39. 
40.   @Before
41.   public void setUp() throws Exception {
42.     namespaceUtil = new NamespaceUtil(appNamespaceServiceWithCache);
43.   }
44. 
45.   @Test
46.   public void testFilterNamespaceName() throws Exception {
47.     String someName = "a.properties";
48. 
49.     assertEquals("a", namespaceUtil.filterNamespaceName(someName));
50.   }
51. 
52.   @Test
53.   public void testFilterNamespaceNameUnchanged() throws Exception {
54.     String someName = "a.xml";
55. 
56.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
57.   }
58. 
59.   @Test
60.   public void testFilterNamespaceNameWithMultiplePropertiesSuffix() throws Exception {
61.     String someName = "a.properties.properties";
62. 
63.     assertEquals("a.properties", namespaceUtil.filterNamespaceName(someName));
64.   }
65. 
66.   @Test
67.   public void testFilterNamespaceNameWithRandomCase() throws Exception {
68.     String someName = "AbC.ProPErties";
69. 
70.     assertEquals("AbC", namespaceUtil.filterNamespaceName(someName));
71.   }
72. 
73.   @Test
74.   public void testFilterNamespaceNameWithRandomCaseUnchanged() throws Exception {
75.     String someName = "AbCD.xMl";
76. 
77.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
78.   }
79. 
80.   @Test
81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {
82.     String someAppId = "someAppId";
83.     String someNamespaceName = "someNamespaceName";
84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
85.     AppNamespace someAppNamespace = mock(AppNamespace.class);
86. 
87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn
89.         (someAppNamespace);
90. 
91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
92. 
93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);
95.   }
96. 
97.   @Test
98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {
99.     String someAppId = "someAppId";
100.     String someNamespaceName = "someNamespaceName";
101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
102.     AppNamespace someAppNamespace = mock(AppNamespace.class);
103. 
104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);
107. 
108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
109. 
110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
112.   }
113. 
114.   @Test
115.   public void testNormalizeNamespaceFailed() throws Exception {
116.     String someAppId = "someAppId";
117.     String someNamespaceName = "someNamespaceName";
118. 
119.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
120.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(null);
121. 
122.     assertEquals(someNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
123. 
124.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
125.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
126.   }
127. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 1 - 61
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.openapi.v1.controller;
18. 
19. import com.ctrip.framework.apollo.common.utils.InputValidator;
20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;
22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.ActiveProfiles;
27. import org.springframework.web.client.HttpClientErrorException;
28. import static org.hamcrest.Matchers.containsString;
29. 
30. /**
31.  * Created by kezhenxu at 2019/1/8 18:17.
32.  *
33.  * @author kezhenxu (kezhenxu94@163.com)
34.  */
35. @ActiveProfiles("skipAuthorization")
36. public class NamespaceControllerTest extends AbstractControllerTest {
37.   @Autowired
38.   private ConsumerPermissionValidator consumerPermissionValidator;
39. 
40.   @Test
41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {
42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));
43. 
44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();
45.     dto.setAppId("appId");
46.     dto.setName("invalid name");
47.     dto.setFormat(ConfigFileFormat.Properties.getValue());
48.     dto.setDataChangeCreatedBy("apollo");
49.     try {
50.       restTemplate.postForEntity(
51.           url("/openapi/v1/apps/{appId}/appnamespaces"),
52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()
53.       );
54.       Assert.fail("should throw");
55.     } catch (HttpClientErrorException e) {
56.       String result = e.getResponseBodyAsString();
57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
59.     }
60.   }
61. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 1 - 254
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.dto.ClusterDTO;
20. import com.ctrip.framework.apollo.common.dto.ItemDTO;
21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
22. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
25. import com.ctrip.framework.apollo.portal.component.PortalSettings;
26. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
27. import com.ctrip.framework.apollo.portal.environment.Env;
28. import com.ctrip.framework.apollo.portal.AbstractUnitTest;
29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
30. import com.ctrip.framework.apollo.portal.component.txtresolver.PropertyResolver;
31. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
32. import com.ctrip.framework.apollo.portal.entity.bo.UserInfo;
33. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
34. 
35. import org.assertj.core.util.Lists;
36. import org.junit.Before;
37. import org.junit.Test;
38. import org.mockito.InjectMocks;
39. import org.mockito.Mock;
40. 
41. import java.util.Arrays;
42. import java.util.Collections;
43. import java.util.List;
44. 
45. import static org.assertj.core.api.AssertionsForClassTypes.assertThat;
46. import static org.assertj.core.api.AssertionsForClassTypes.assertThatExceptionOfType;
47. import static org.junit.Assert.assertEquals;
48. import static org.mockito.Mockito.mock;
49. import static org.mockito.Mockito.times;
50. import static org.mockito.Mockito.verify;
51. import static org.mockito.Mockito.when;
52. 
53. public class NamespaceServiceTest extends AbstractUnitTest {
54. 
55.   @Mock
56.   private AdminServiceAPI.NamespaceAPI namespaceAPI;
57.   @Mock
58.   private ReleaseService releaseService;
59.   @Mock
60.   private ItemService itemService;
61.   @Mock
62.   private PropertyResolver resolver;
63.   @Mock
64.   private AppNamespaceService appNamespaceService;
65.   @Mock
66.   private InstanceService instanceService;
67.   @Mock
68.   private NamespaceBranchService branchService;
69.   @Mock
70.   private UserInfoHolder userInfoHolder;
71.   @Mock
72.   private AdditionalUserInfoEnrichService additionalUserInfoEnrichService;
73.   @Mock
74.   private PortalSettings portalSettings;
75.   @Mock
76.   private ClusterService clusterService;
77. 
78.   @InjectMocks
79.   private NamespaceService namespaceService;
80. 
81.   private String testAppId = "6666";
82.   private String testClusterName = "default";
83.   private String testNamespaceName = "application";
84.   private Env testEnv = Env.DEV;
85. 
86.   @Before
87.   public void setup() {
88.   }
89. 
90.   @Test
91.   public void testFindNamespace() {
92. 
93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);
94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);
95. 
96.     NamespaceDTO application = new NamespaceDTO();
97.     application.setId(1);
98.     application.setClusterName(testClusterName);
99.     application.setAppId(testAppId);
100.     application.setNamespaceName(testNamespaceName);
101. 
102.     NamespaceDTO hermes = new NamespaceDTO();
103.     hermes.setId(2);
104.     hermes.setClusterName("default");
105.     hermes.setAppId(testAppId);
106.     hermes.setNamespaceName("hermes");
107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);
108. 
109.     ReleaseDTO someRelease = new ReleaseDTO();
110.     someRelease.setConfigurations("{\"a\":\"123\",\"b\":\"123\"}");
111. 
112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);
113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);
114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);
115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);
116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);
117. 
118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());
119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());
120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))
121.         .thenReturn(applicationAppNamespace);
122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);
123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);
124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,
125.                                           testNamespaceName)).thenReturn(someRelease);
126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);
127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);
128. 
129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
130.     assertEquals(2, namespaceVOs.size());
131. 
132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));
133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
134.     assertEquals(1, namespaceVOs.size());
135.     NamespaceBO namespaceVO = namespaceVOs.get(0);
136.     assertEquals(4, namespaceVO.getItems().size());
137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());
138.     assertEquals(2, namespaceVO.getItemModifiedCnt());
139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());
140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());
141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());
142. 
143.     ReleaseDTO errorRelease = new ReleaseDTO();
144.     errorRelease.setConfigurations("\"a\":\"123\",\"b\":\"123\"");
145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);
146.     assertThatExceptionOfType(RuntimeException.class)
147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))
148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");
149. 
150.   }
151. 
152.   @Test
153.   public void testDeletePrivateNamespace() {
154.     String operator = "user";
155.     AppNamespace privateNamespace = createAppNamespace(testAppId, testNamespaceName, false);
156. 
157.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(privateNamespace);
158. 
159.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));
160. 
161.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);
162. 
163.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);
164.   }
165. 
166.   @Test
167.   public void testGetNamespaceUsage() {
168.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);
169.     String branchName = "branch";
170. 
171.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);
172. 
173.     when(portalSettings.getActiveEnvs()).thenReturn(Lists.newArrayList(testEnv));
174.     ClusterDTO cluster = new ClusterDTO();
175.     cluster.setName(testClusterName);
176.     cluster.setAppId(testAppId);
177.     when(clusterService.findClusters(testEnv, testAppId)).thenReturn(Lists.newArrayList(cluster));
178.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);
179.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))
180.         .thenReturn(8);
181.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);
182.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(9);
183.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);
184. 
185.     when(namespaceAPI.countPublicAppNamespaceAssociatedNamespaces(testEnv, testNamespaceName)).thenReturn(10);
186. 
187.     List<NamespaceUsage> usages = namespaceService.getNamespaceUsageByAppId(testAppId, testNamespaceName);
188.     assertThat(usages).asList().hasSize(1);
189.     assertThat(usages.get(0).getInstanceCount()).isEqualTo(8);
190.     assertThat(usages.get(0).getBranchInstanceCount()).isEqualTo(9);
191.     assertThat(usages.get(0).getLinkedNamespaceCount()).isEqualTo(10);
192. 
193.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(testAppId, testNamespaceName, testEnv, testClusterName);
194.     assertThat(usage).isNotNull();
195.     assertThat(usage.getInstanceCount()).isEqualTo(8);
196.     assertThat(usage.getBranchInstanceCount()).isEqualTo(9);
197.     assertThat(usage.getLinkedNamespaceCount()).isEqualTo(0);
198.   }
199. 
200.   @Test
201.   public void testDeleteEmptyNamespace() {
202.     String branchName = "branch";
203.     String operator = "user";
204. 
205.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);
206.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);
207. 
208.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);
209.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))
210.         .thenReturn(0);
211.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);
212.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(0);
213.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);
214. 
215.     NamespaceDTO namespace = createNamespace(testAppId, testClusterName, testNamespaceName);
216.     when(namespaceAPI.getPublicAppNamespaceAllNamespaces(testEnv, testNamespaceName, 0, 10)).thenReturn(
217.         Collections.singletonList(namespace));
218.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));
219. 
220.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);
221. 
222.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);
223. 
224.   }
225. 
226. 
227.   private AppNamespace createAppNamespace(String appId, String name, boolean isPublic) {
228.     AppNamespace instance = new AppNamespace();
229. 
230.     instance.setAppId(appId);
231.     instance.setName(name);
232.     instance.setPublic(isPublic);
233. 
234.     return instance;
235.   }
236. 
237.   private NamespaceDTO createNamespace(String appId, String clusterName, String namespaceName) {
238.     NamespaceDTO instance = new NamespaceDTO();
239. 
240.     instance.setAppId(appId);
241.     instance.setClusterName(clusterName);
242.     instance.setNamespaceName(namespaceName);
243. 
244.     return instance;
245.   }
246. 
247.   private UserInfo createUser(String userId) {
248.     UserInfo instance = new UserInfo();
249. 
250.     instance.setUserId(userId);
251. 
252.     return instance;
253.   }
254. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 11:38:54,067 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='The user explicitly requests the full content of this exact test file, including package, imports, class definition, and tests. It includes a validation test for invalid namespace names via InputValidator message, relevant to namespace name rules.', relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', start_line=1, end_line=47), ContextOutput(reasoning='The user explicitly requests the full content of this test file. It covers creating an AppNamespace and includes full imports and class, which are part of the requested artifacts though it does not specifically validate name rules.', relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java', start_line=1, end_line=62), ContextOutput(reasoning='The user asks for this whole file. It contains extensive tests around namespace handling and normalization within the ConfigController, providing essential context for namespace processing, though not directly about name validation rules.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', start_line=1, end_line=481), ContextOutput(reasoning='The user asks for this file. It directly tests NamespaceUtil behavior related to namespace name filtering (e.g., removing .properties suffix), which is important for understanding dot/extension handling.', relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', start_line=1, end_line=127), ContextOutput(reasoning='The user asks for this file. It validates that creating an open app namespace with an invalid name is rejected and asserts InputValidator messages, directly relevant to namespace name rules.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', start_line=1, end_line=61), ContextOutput(reasoning='The user asks for this file in full. It covers portal NamespaceService logic; while not directly testing name validation, it is part of the requested set and includes complete setup and usage of namespace-related classes.', relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', start_line=1, end_line=254), ContextOutput(reasoning='The user additionally requested any InputValidator test file if present. This file provides direct tests for cluster and app namespace name validity, essential for understanding validation rules (though it does not include the single dot case).', relative_path='apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java', start_line=1, end_line=54)]
2025-11-12 11:38:54,072 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 7 contexts to memory for query: Please provide the full content (with line numbers) of the following test files: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java; additionally, include any InputValidator test file (e.g., apollo-common/src/test/java/.../InputValidatorTest.java) if present.
2025-11-12 11:38:56,465 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 11:38:56,467 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 7 new contexts to 7 existing contexts
2025-11-12 11:38:56,468 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 7 total contexts (removed 7 duplicates)
2025-11-12 11:38:56,470 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


OBJECTIVE: Find 5 relevant existing test cases that demonstrates similar functionality to the reported bug,
including ALL necessary imports, test setup, mocking, assertions, and any test method used in the test case.

<reasoning>
1. Analyze bug characteristics:
   - Core functionality being tested
   - Input parameters and configurations
   - Expected error conditions
   - Environmental dependencies

2. Search requirements:
   - Required imports and dependencies
   - Test files exercising similar functionality
   - Mock/fixture setup patterns
   - Assertion styles
   - Error handling tests

3. Focus areas:
   - All necessary imports (standard library, testing frameworks, mocking utilities)
   - Dependencies and third-party packages
   - Test setup and teardown
   - Mock object configuration
   - Network/external service simulation
   - Error condition verification
</reasoning>

REQUIREMENTS:
- Return 5 complete, self-contained test cases most similar to bug scenario
- Must include ALL necessary imports at the start of each test file
- Must include full test method implementation
- Must include ALL mock/fixture setup
- Must include helper functions used by test
- Must preserve exact file paths and line numbers

<examples>
<example id="database-timeout">
<bug>
db.execute("SELECT * FROM users").fetchall() 
raises ConnectionTimeout when load is high
</bug>

<ideal_test_match>
# File: tests/test_database.py
import pytest
from unittest.mock import Mock, patch
from database.exceptions import ConnectionTimeout
from database.models import QueryResult
from database.client import DatabaseClient

class TestDatabaseTimeout:
    @pytest.fixture
    def mock_db_connection(self):
        conn = Mock()
        conn.execute.side_effect = [
            ConnectionTimeout("Connection timed out"),
            QueryResult(["user1", "user2"])  # Second try succeeds
        ]
        return conn
        
    def test_handle_timeout_during_query(self, mock_db_connection):
        # Complete test showing timeout scenario
        # Including retry logic verification
        # With all necessary assertions
</ideal_test_match>
</example>

<example id="file-permission">
<bug>
FileProcessor('/root/data.txt').process() 
fails with PermissionError
</bug>

<ideal_test_match>
# File: tests/test_file_processor.py
import os
import pytest
from unittest.mock import patch, mock_open
from file_processor import FileProcessor
from file_processor.exceptions import ProcessingError

class TestFilePermissions:
    @patch('os.access')
    @patch('builtins.open')
    def test_file_permission_denied(self, mock_open, mock_access):
        # Full test setup with mocked file system
        # Permission denial simulation
        # Error handling verification
</ideal_test_match>
</example>

Search priority:
1. Tests of exact same functionality (including import patterns)
2. Tests with similar error conditions
3. Tests with comparable mocking patterns
4. Tests demonstrating similar assertions

Find the 5 most relevant test cases with complete context, ensuring ALL necessary imports are included at the start of each test file.

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full content (with line numbers) of all test files related to namespace creation and querying under apollo-portal/src/test/java, apollo-adminservice/src/test/java, apollo-configservice/src/test/java, and apollo-biz/src/test/java (especially files/classes containing “Namespace”).
Extra Requirements: If the full directories are too large, include at minimum the imports, test setup/mocks, helper functions, and all test methods that validate namespace names (including single dot “.” cases), with exact file paths and line numbers.
Purpose: I need these tests to extract 5 self-contained cases demonstrating behavior when creating and querying namespaces, especially with dot-named namespaces causing 500 errors.

Previous refined query 2:
Essential Query: Please provide the full content (with line numbers) of the following test files: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java, apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java, apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java, apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java, and apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java; additionally, include any InputValidator test file (e.g., apollo-common/src/test/java/.../InputValidatorTest.java) if present.
Extra Requirements: If sending full files is too large, include at minimum the package declaration, all import statements, class definitions, helper/fixture setup, and complete test methods that validate namespace name rules (including a single dot "." case), with exact file paths and line numbers.
Purpose: I need these complete files to extract 5 self-contained test cases with all imports and precise line references that best match the dot-named namespace bug scenario.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java
Line number range: 1 - 62
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;
20. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
21. import com.ctrip.framework.apollo.common.entity.AppNamespace;
22. 
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.jdbc.Sql;
27. 
28. public class AppNamespaceControllerTest extends AbstractControllerTest{
29. 
30.   @Autowired
31.   private AppNamespaceRepository namespaceRepository;
32. 
33.   @Test
34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)
35.   public void testCreate(){
36.     String appId = "6666";
37.     String name = "testnamespace";
38.     String comment = "comment";
39.     AppNamespaceDTO dto = new AppNamespaceDTO();
40.     dto.setAppId(appId);
41.     dto.setName(name);
42.     dto.setComment(comment);
43.     dto.setDataChangeCreatedBy("apollo");
44. 
45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(
46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();
47. 
48.     Assert.assertEquals(appId, resultDto.getAppId());
49.     Assert.assertTrue(resultDto.getId() > 0);
50. 
51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);
52.     Assert.assertNotNull(savedAppNs);
53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());
54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());
55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());
56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());
57. 
58. 
59. 
60. 
61.   }
62. }


File: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java
Line number range: 1 - 47
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import org.junit.Assert;
22. import org.junit.Test;
23. import org.springframework.web.client.HttpClientErrorException;
24. import static org.hamcrest.Matchers.containsString;
25. 
26. /**
27.  * Created by kezhenxu at 2019/1/8 16:27.
28.  *
29.  * @author kezhenxu (kezhenxu94@163.com)
30.  */
31. public class NamespaceControllerTest extends AbstractControllerTest {
32.   @Test
33.   public void create() {
34.     try {
35.       NamespaceDTO namespaceDTO = new NamespaceDTO();
36.       namespaceDTO.setClusterName("cluster");
37.       namespaceDTO.setNamespaceName("invalid name");
38.       namespaceDTO.setAppId("whatever");
39.       restTemplate.postForEntity(
40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),
41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());
42.       Assert.fail("Should throw");
43.     } catch (HttpClientErrorException e) {
44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
45.     }
46.   }
47. }


File: apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java
Line number range: 1 - 54
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.common.utils;
18. 
19. import static org.junit.Assert.*;
20. 
21. import org.junit.Test;
22. 
23. public class InputValidatorTest {
24. 
25.   @Test
26.   public void testValidClusterName() throws Exception {
27.     checkClusterName("some.cluster-_name.123", true);
28.     checkClusterName("some.cluster-_name.123.yml", true);
29.     checkClusterName("some.&.name", false);
30.     checkClusterName("", false);
31.     checkClusterName(null, false);
32.   }
33. 
34.   @Test
35.   public void testValidAppNamespaceName() throws Exception {
36.     checkAppNamespaceName("some.cluster-_name.123", true);
37.     checkAppNamespaceName("some.&.name", false);
38.     checkAppNamespaceName("", false);
39.     checkAppNamespaceName(null, false);
40.     checkAppNamespaceName("some.name.json", false);
41.     checkAppNamespaceName("some.name.yml", false);
42.     checkAppNamespaceName("some.name.yaml", false);
43.     checkAppNamespaceName("some.name.xml", false);
44.     checkAppNamespaceName("some.name.properties", false);
45.   }
46. 
47.   private void checkClusterName(String name, boolean valid) {
48.     assertEquals(valid, InputValidator.isValidClusterNamespace(name));
49.   }
50. 
51.   private void checkAppNamespaceName(String name, boolean valid) {
52.     assertEquals(valid, InputValidator.isValidAppNamespace(name));
53.   }
54. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java
Line number range: 1 - 481
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Release;
20. import com.ctrip.framework.apollo.common.entity.AppNamespace;
21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;
23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;
24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;
25. import com.ctrip.framework.apollo.core.ConfigConsts;
26. import com.ctrip.framework.apollo.core.dto.ApolloConfig;
27. import com.ctrip.framework.apollo.core.dto.ApolloNotificationMessages;
28. import com.google.common.base.Joiner;
29. import com.google.common.collect.ImmutableMap;
30. import com.google.common.collect.Lists;
31. import com.google.gson.Gson;
32. import com.google.gson.JsonSyntaxException;
33. import org.junit.Before;
34. import org.junit.Test;
35. import org.junit.runner.RunWith;
36. import org.mockito.Mock;
37. import org.mockito.junit.MockitoJUnitRunner;
38. 
39. import javax.servlet.http.HttpServletRequest;
40. import javax.servlet.http.HttpServletResponse;
41. import java.util.Map;
42. 
43. import static org.junit.Assert.assertEquals;
44. import static org.junit.Assert.assertNull;
45. import static org.mockito.Mockito.*;
46. 
47. /**
48.  * @author Jason Song(song_s@ctrip.com)
49.  */
50. @RunWith(MockitoJUnitRunner.class)
51. public class ConfigControllerTest {
52.   private ConfigController configController;
53.   @Mock
54.   private ConfigService configService;
55.   @Mock
56.   private AppNamespaceServiceWithCache appNamespaceService;
57.   private String someAppId;
58.   private String someClusterName;
59.   private String defaultClusterName;
60.   private String defaultNamespaceName;
61.   private String somePublicNamespaceName;
62.   private String someDataCenter;
63.   private String someClientIp;
64.   private String someClientLabel;
65.   private String someMessagesAsString;
66.   @Mock
67.   private ApolloNotificationMessages someNotificationMessages;
68.   @Mock
69.   private Release someRelease;
70.   @Mock
71.   private Release somePublicRelease;
72.   @Mock
73.   private NamespaceUtil namespaceUtil;
74.   @Mock
75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;
76.   @Mock
77.   private HttpServletRequest someRequest;
78.   private Gson gson = new Gson();
79. 
80.   @Before
81.   public void setUp() throws Exception {
82.     configController = spy(new ConfigController(
83.         configService, appNamespaceService, namespaceUtil, instanceConfigAuditUtil, gson
84.     ));
85. 
86.     someAppId = "1";
87.     someClusterName = "someClusterName";
88.     defaultClusterName = ConfigConsts.CLUSTER_NAME_DEFAULT;
89.     defaultNamespaceName = ConfigConsts.NAMESPACE_APPLICATION;
90.     somePublicNamespaceName = "somePublicNamespace";
91.     someDataCenter = "someDC";
92.     someClientIp = "someClientIp";
93.     someClientLabel = "someClientLabel";
94.     String someValidConfiguration = "{\"apollo.bar\": \"foo\"}";
95.     String somePublicConfiguration = "{\"apollo.public.bar\": \"foo\"}";
96. 
97.     when(someRelease.getAppId()).thenReturn(someAppId);
98.     when(someRelease.getClusterName()).thenReturn(someClusterName);
99.     when(someRelease.getConfigurations()).thenReturn(someValidConfiguration);
100.     when(somePublicRelease.getConfigurations()).thenReturn(somePublicConfiguration);
101.     when(namespaceUtil.filterNamespaceName(defaultNamespaceName)).thenReturn(defaultNamespaceName);
102.     when(namespaceUtil.filterNamespaceName(somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
103.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
104.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
105. 
106.     someMessagesAsString = "someValidJson";
107.     when(configController.transformMessages(someMessagesAsString)).thenReturn(someNotificationMessages);
108.   }
109. 
110.   @Test
111.   public void testQueryConfig() throws Exception {
112.     String someClientSideReleaseKey = "1";
113.     String someServerSideNewReleaseKey = "2";
114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
115. 
116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);
120. 
121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
124. 
125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
126.         defaultNamespaceName, someDataCenter, someNotificationMessages);
127.     assertEquals(someAppId, result.getAppId());
128.     assertEquals(someClusterName, result.getCluster());
129.     assertEquals(defaultNamespaceName, result.getNamespaceName());
130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);
133.   }
134. 
135.   @Test
136.   public void testQueryConfigFile() throws Exception {
137.     String someClientSideReleaseKey = "1";
138.     String someServerSideNewReleaseKey = "2";
139.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
140.     String someNamespaceName = String.format("%s.%s", defaultClusterName, "properties");
141. 
142.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
143.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
144.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
145.     when(namespaceUtil.filterNamespaceName(someNamespaceName)).thenReturn(defaultNamespaceName);
146.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);
147. 
148.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
149.         someNamespaceName, someDataCenter, someClientSideReleaseKey,
150.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
151. 
152.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,
153.         defaultNamespaceName, someDataCenter, someNotificationMessages);
154.     assertEquals(someAppId, result.getAppId());
155.     assertEquals(someClusterName, result.getCluster());
156.     assertEquals(someNamespaceName, result.getNamespaceName());
157.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
158.   }
159. 
160.   @Test
161.   public void testQueryConfigFileWithPrivateNamespace() throws Exception {
162.     String someClientSideReleaseKey = "1";
163.     String someServerSideNewReleaseKey = "2";
164.     String somePrivateNamespace = "datasource";
165.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
166.     String somePrivateNamespaceName = String.format("%s.%s", somePrivateNamespace, "xml");
167.     AppNamespace appNamespace = mock(AppNamespace.class);
168. 
169.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePrivateNamespace,
170.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
171.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);
172.     when(namespaceUtil.filterNamespaceName(somePrivateNamespaceName)).thenReturn(somePrivateNamespace);
173.     when(namespaceUtil.normalizeNamespace(someAppId, somePrivateNamespace)).thenReturn(somePrivateNamespace);
174.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePrivateNamespace))
175.         .thenReturn(appNamespace);
176. 
177.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
178.         somePrivateNamespaceName, someDataCenter, someClientSideReleaseKey,
179.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
180. 
181.     assertEquals(someAppId, result.getAppId());
182.     assertEquals(someClusterName, result.getCluster());
183.     assertEquals(somePrivateNamespaceName, result.getNamespaceName());
184.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());
185.   }
186. 
187.   @Test
188.   public void testQueryConfigWithReleaseNotFound() throws Exception {
189.     String someClientSideReleaseKey = "1";
190.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
191. 
192.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
193.         someDataCenter, someNotificationMessages)).thenReturn(null);
194. 
195.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,
196.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
197.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
198. 
199.     assertNull(result);
200.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());
201.   }
202. 
203.   @Test
204.   public void testQueryConfigWithApolloConfigNotModified() throws Exception {
205.     String someClientSideReleaseKey = "1";
206.     String someServerSideReleaseKey = someClientSideReleaseKey;
207.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
208. 
209.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,
210.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
211.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
212. 
213.     ApolloConfig result =
214.         configController.queryConfig(someAppId, someClusterName, defaultNamespaceName, someDataCenter,
215.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
216. 
217.     assertNull(result);
218.     verify(someResponse, times(1)).setStatus(HttpServletResponse.SC_NOT_MODIFIED);
219.   }
220. 
221.   @Test
222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {
223.     String someClientSideReleaseKey = "1";
224.     String someServerSideReleaseKey = "2";
225.     String someAppOwnNamespaceName = "someAppOwn";
226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
227.     AppNamespace someAppOwnNamespace =
228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);
229. 
230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,
231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))
233.         .thenReturn(someAppOwnNamespace);
234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);
237. 
238.     ApolloConfig result =
239.         configController
240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,
241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
242. 
243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
244.     assertEquals(someAppId, result.getAppId());
245.     assertEquals(someClusterName, result.getCluster());
246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());
247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));
248.   }
249. 
250.   @Test
251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {
252.     String someClientSideReleaseKey = "1";
253.     String someServerSideReleaseKey = "2";
254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
255.     String somePublicAppId = "somePublicAppId";
256.     String somePublicClusterName = "somePublicClusterName";
257.     AppNamespace somePublicAppNamespace =
258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
259. 
260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
261.         someDataCenter, someNotificationMessages)).thenReturn(null);
262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
263.         .thenReturn(somePublicAppNamespace);
264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);
269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
270. 
271.     ApolloConfig result = configController
272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
274. 
275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
276.     assertEquals(someAppId, result.getAppId());
277.     assertEquals(someClusterName, result.getCluster());
278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);
282.   }
283. 
284.   @Test
285.   public void testQueryConfigFileWithPublicNamespaceAndNoAppOverride() throws Exception {
286.     String someClientSideReleaseKey = "1";
287.     String someServerSideReleaseKey = "2";
288.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
289.     String somePublicAppId = "somePublicAppId";
290.     String someNamespace = String.format("%s.%s", somePublicNamespaceName, "properties");
291.     AppNamespace somePublicAppNamespace =
292.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
293. 
294.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
295.         someDataCenter, someNotificationMessages)).thenReturn(null);
296.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
297.         .thenReturn(somePublicAppNamespace);
298.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
299.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
300.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
301.     when(namespaceUtil.filterNamespaceName(someNamespace)).thenReturn(somePublicNamespaceName);
302.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
303.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePublicNamespaceName)).thenReturn(null);
304. 
305.     ApolloConfig result = configController
306.         .queryConfig(someAppId, someClusterName, someNamespace, someDataCenter,
307.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
308. 
309.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
310.     assertEquals(someAppId, result.getAppId());
311.     assertEquals(someClusterName, result.getCluster());
312.     assertEquals(someNamespace, result.getNamespaceName());
313.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
314.   }
315. 
316.   @Test
317.   public void testQueryConfigWithPublicNamespaceAndAppOverride() throws Exception {
318.     String someAppSideReleaseKey = "1";
319.     String somePublicAppSideReleaseKey = "2";
320. 
321.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
322.     String somePublicAppId = "somePublicAppId";
323.     AppNamespace somePublicAppNamespace =
324.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
325. 
326.     when(someRelease.getConfigurations()).thenReturn("{\"apollo.public.foo\": \"foo-override\"}");
327.     when(somePublicRelease.getConfigurations())
328.         .thenReturn("{\"apollo.public.foo\": \"foo\", \"apollo.public.bar\": \"bar\"}");
329. 
330.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,
331.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);
332.     when(someRelease.getReleaseKey()).thenReturn(someAppSideReleaseKey);
333.     when(someRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
334.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
335.         .thenReturn(somePublicAppNamespace);
336.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
337.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
338.     when(somePublicRelease.getReleaseKey()).thenReturn(somePublicAppSideReleaseKey);
339.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);
340.     when(somePublicRelease.getClusterName()).thenReturn(someDataCenter);
341.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);
342. 
343.     ApolloConfig result =
344.         configController
345.             .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,
346.                 someAppSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
347. 
348.     assertEquals(Joiner.on(ConfigConsts.CLUSTER_NAMESPACE_SEPARATOR)
349.             .join(someAppSideReleaseKey, somePublicAppSideReleaseKey),
350.         result.getReleaseKey());
351.     assertEquals(someAppId, result.getAppId());
352.     assertEquals(someClusterName, result.getCluster());
353.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
354.     assertEquals("foo-override", result.getConfigurations().get("apollo.public.foo"));
355.     assertEquals("bar", result.getConfigurations().get("apollo.public.bar"));
356.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
357.         someClientIp, someAppId, someClusterName, somePublicNamespaceName, someAppSideReleaseKey);
358.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,
359.         someClientIp, somePublicAppId, someDataCenter, somePublicNamespaceName, somePublicAppSideReleaseKey);
360.   }
361. 
362.   @Test
363.   public void testMergeConfigurations() throws Exception {
364.     Gson gson = new Gson();
365.     String key1 = "key1";
366.     String value1 = "value1";
367.     String anotherValue1 = "anotherValue1";
368. 
369.     String key2 = "key2";
370.     String value2 = "value2";
371. 
372.     Map<String, String> config = ImmutableMap.of(key1, anotherValue1);
373.     Map<String, String> anotherConfig = ImmutableMap.of(key1, value1, key2, value2);
374. 
375.     Release releaseWithHighPriority = new Release();
376.     releaseWithHighPriority.setConfigurations(gson.toJson(config));
377. 
378.     Release releaseWithLowPriority = new Release();
379.     releaseWithLowPriority.setConfigurations(gson.toJson(anotherConfig));
380. 
381.     Map<String, String> result =
382.         configController.mergeReleaseConfigurations(
383.             Lists.newArrayList(releaseWithHighPriority, releaseWithLowPriority));
384. 
385.     assertEquals(2, result.keySet().size());
386.     assertEquals(anotherValue1, result.get(key1));
387.     assertEquals(value2, result.get(key2));
388.   }
389. 
390.   @Test(expected = JsonSyntaxException.class)
391.   public void testTransformConfigurationToMapFailed() throws Exception {
392.     String someInvalidConfiguration = "xxx";
393.     Release someRelease = new Release();
394.     someRelease.setConfigurations(someInvalidConfiguration);
395. 
396.     configController.mergeReleaseConfigurations(Lists.newArrayList(someRelease));
397.   }
398. 
399.   @Test
400.   public void testQueryConfigForNoAppIdPlaceHolder() throws Exception {
401.     String someClientSideReleaseKey = "1";
402.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
403.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
404. 
405.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
406.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,
407.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
408. 
409.     verify(configService, never()).loadConfig(appId, someClientIp, someAppId, someClientLabel, someClusterName, defaultNamespaceName,
410.         someDataCenter, someNotificationMessages);
411.     verify(appNamespaceService, never()).findPublicNamespaceByName(defaultNamespaceName);
412.     assertNull(result);
413.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());
414.   }
415. 
416.   @Test
417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {
418.     String someClientSideReleaseKey = "1";
419.     String someServerSideReleaseKey = "2";
420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);
421.     String somePublicAppId = "somePublicAppId";
422.     AppNamespace somePublicAppNamespace =
423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);
424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;
425. 
426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))
427.         .thenReturn(somePublicAppNamespace);
428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,
429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);
430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);
431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);
432. 
433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,
434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,
435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);
436. 
437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,
438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);
439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());
440.     assertEquals(appId, result.getAppId());
441.     assertEquals(someClusterName, result.getCluster());
442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());
443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));
444.   }
445. 
446.   @Test
447.   public void testTransformMessages() throws Exception {
448.     String someKey = "someKey";
449.     long someNotificationId = 1;
450.     String anotherKey = "anotherKey";
451.     long anotherNotificationId = 2;
452.     ApolloNotificationMessages notificationMessages = new ApolloNotificationMessages();
453.     notificationMessages.put(someKey, someNotificationId);
454.     notificationMessages.put(anotherKey, anotherNotificationId);
455. 
456.     String someMessagesAsString = gson.toJson(notificationMessages);
457. 
458.     ApolloNotificationMessages result = configController.transformMessages(someMessagesAsString);
459. 
460.     assertEquals(notificationMessages.getDetails(), result.getDetails());
461.   }
462. 
463.   @Test
464.   public void testTransformInvalidMessages() throws Exception {
465.     String someInvalidMessages = "someInvalidMessages";
466. 
467.     assertNull(configController.transformMessages(someInvalidMessages));
468.   }
469. 
470.   private AppNamespace assemblePublicAppNamespace(String appId, String namespace) {
471.     return assembleAppNamespace(appId, namespace, true);
472.   }
473. 
474.   private AppNamespace assembleAppNamespace(String appId, String namespace, boolean isPublic) {
475.     AppNamespace appNamespace = new AppNamespace();
476.     appNamespace.setAppId(appId);
477.     appNamespace.setName(namespace);
478.     appNamespace.setPublic(isPublic);
479.     return appNamespace;
480.   }
481. }


File: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java
Line number range: 1 - 127
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.util;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
21. import org.junit.Before;
22. import org.junit.Test;
23. import org.junit.runner.RunWith;
24. import org.mockito.Mock;
25. import org.mockito.junit.MockitoJUnitRunner;
26. 
27. import static org.junit.Assert.assertEquals;
28. import static org.mockito.Mockito.*;
29. 
30. /**
31.  * @author Jason Song(song_s@ctrip.com)
32.  */
33. @RunWith(MockitoJUnitRunner.class)
34. public class NamespaceUtilTest {
35.   private NamespaceUtil namespaceUtil;
36. 
37.   @Mock
38.   private AppNamespaceServiceWithCache appNamespaceServiceWithCache;
39. 
40.   @Before
41.   public void setUp() throws Exception {
42.     namespaceUtil = new NamespaceUtil(appNamespaceServiceWithCache);
43.   }
44. 
45.   @Test
46.   public void testFilterNamespaceName() throws Exception {
47.     String someName = "a.properties";
48. 
49.     assertEquals("a", namespaceUtil.filterNamespaceName(someName));
50.   }
51. 
52.   @Test
53.   public void testFilterNamespaceNameUnchanged() throws Exception {
54.     String someName = "a.xml";
55. 
56.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
57.   }
58. 
59.   @Test
60.   public void testFilterNamespaceNameWithMultiplePropertiesSuffix() throws Exception {
61.     String someName = "a.properties.properties";
62. 
63.     assertEquals("a.properties", namespaceUtil.filterNamespaceName(someName));
64.   }
65. 
66.   @Test
67.   public void testFilterNamespaceNameWithRandomCase() throws Exception {
68.     String someName = "AbC.ProPErties";
69. 
70.     assertEquals("AbC", namespaceUtil.filterNamespaceName(someName));
71.   }
72. 
73.   @Test
74.   public void testFilterNamespaceNameWithRandomCaseUnchanged() throws Exception {
75.     String someName = "AbCD.xMl";
76. 
77.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));
78.   }
79. 
80.   @Test
81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {
82.     String someAppId = "someAppId";
83.     String someNamespaceName = "someNamespaceName";
84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
85.     AppNamespace someAppNamespace = mock(AppNamespace.class);
86. 
87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn
89.         (someAppNamespace);
90. 
91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
92. 
93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);
95.   }
96. 
97.   @Test
98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {
99.     String someAppId = "someAppId";
100.     String someNamespaceName = "someNamespaceName";
101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";
102.     AppNamespace someAppNamespace = mock(AppNamespace.class);
103. 
104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);
105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);
107. 
108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
109. 
110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
112.   }
113. 
114.   @Test
115.   public void testNormalizeNamespaceFailed() throws Exception {
116.     String someAppId = "someAppId";
117.     String someNamespaceName = "someNamespaceName";
118. 
119.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);
120.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(null);
121. 
122.     assertEquals(someNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));
123. 
124.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);
125.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);
126.   }
127. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java
Line number range: 1 - 61
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.openapi.v1.controller;
18. 
19. import com.ctrip.framework.apollo.common.utils.InputValidator;
20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;
22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;
23. import org.junit.Assert;
24. import org.junit.Test;
25. import org.springframework.beans.factory.annotation.Autowired;
26. import org.springframework.test.context.ActiveProfiles;
27. import org.springframework.web.client.HttpClientErrorException;
28. import static org.hamcrest.Matchers.containsString;
29. 
30. /**
31.  * Created by kezhenxu at 2019/1/8 18:17.
32.  *
33.  * @author kezhenxu (kezhenxu94@163.com)
34.  */
35. @ActiveProfiles("skipAuthorization")
36. public class NamespaceControllerTest extends AbstractControllerTest {
37.   @Autowired
38.   private ConsumerPermissionValidator consumerPermissionValidator;
39. 
40.   @Test
41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {
42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));
43. 
44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();
45.     dto.setAppId("appId");
46.     dto.setName("invalid name");
47.     dto.setFormat(ConfigFileFormat.Properties.getValue());
48.     dto.setDataChangeCreatedBy("apollo");
49.     try {
50.       restTemplate.postForEntity(
51.           url("/openapi/v1/apps/{appId}/appnamespaces"),
52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()
53.       );
54.       Assert.fail("should throw");
55.     } catch (HttpClientErrorException e) {
56.       String result = e.getResponseBodyAsString();
57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));
58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
59.     }
60.   }
61. }


File: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java
Line number range: 1 - 254
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.dto.ClusterDTO;
20. import com.ctrip.framework.apollo.common.dto.ItemDTO;
21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
22. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
25. import com.ctrip.framework.apollo.portal.component.PortalSettings;
26. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
27. import com.ctrip.framework.apollo.portal.environment.Env;
28. import com.ctrip.framework.apollo.portal.AbstractUnitTest;
29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
30. import com.ctrip.framework.apollo.portal.component.txtresolver.PropertyResolver;
31. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
32. import com.ctrip.framework.apollo.portal.entity.bo.UserInfo;
33. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
34. 
35. import org.assertj.core.util.Lists;
36. import org.junit.Before;
37. import org.junit.Test;
38. import org.mockito.InjectMocks;
39. import org.mockito.Mock;
40. 
41. import java.util.Arrays;
42. import java.util.Collections;
43. import java.util.List;
44. 
45. import static org.assertj.core.api.AssertionsForClassTypes.assertThat;
46. import static org.assertj.core.api.AssertionsForClassTypes.assertThatExceptionOfType;
47. import static org.junit.Assert.assertEquals;
48. import static org.mockito.Mockito.mock;
49. import static org.mockito.Mockito.times;
50. import static org.mockito.Mockito.verify;
51. import static org.mockito.Mockito.when;
52. 
53. public class NamespaceServiceTest extends AbstractUnitTest {
54. 
55.   @Mock
56.   private AdminServiceAPI.NamespaceAPI namespaceAPI;
57.   @Mock
58.   private ReleaseService releaseService;
59.   @Mock
60.   private ItemService itemService;
61.   @Mock
62.   private PropertyResolver resolver;
63.   @Mock
64.   private AppNamespaceService appNamespaceService;
65.   @Mock
66.   private InstanceService instanceService;
67.   @Mock
68.   private NamespaceBranchService branchService;
69.   @Mock
70.   private UserInfoHolder userInfoHolder;
71.   @Mock
72.   private AdditionalUserInfoEnrichService additionalUserInfoEnrichService;
73.   @Mock
74.   private PortalSettings portalSettings;
75.   @Mock
76.   private ClusterService clusterService;
77. 
78.   @InjectMocks
79.   private NamespaceService namespaceService;
80. 
81.   private String testAppId = "6666";
82.   private String testClusterName = "default";
83.   private String testNamespaceName = "application";
84.   private Env testEnv = Env.DEV;
85. 
86.   @Before
87.   public void setup() {
88.   }
89. 
90.   @Test
91.   public void testFindNamespace() {
92. 
93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);
94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);
95. 
96.     NamespaceDTO application = new NamespaceDTO();
97.     application.setId(1);
98.     application.setClusterName(testClusterName);
99.     application.setAppId(testAppId);
100.     application.setNamespaceName(testNamespaceName);
101. 
102.     NamespaceDTO hermes = new NamespaceDTO();
103.     hermes.setId(2);
104.     hermes.setClusterName("default");
105.     hermes.setAppId(testAppId);
106.     hermes.setNamespaceName("hermes");
107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);
108. 
109.     ReleaseDTO someRelease = new ReleaseDTO();
110.     someRelease.setConfigurations("{\"a\":\"123\",\"b\":\"123\"}");
111. 
112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);
113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);
114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);
115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);
116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);
117. 
118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());
119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());
120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))
121.         .thenReturn(applicationAppNamespace);
122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);
123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);
124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,
125.                                           testNamespaceName)).thenReturn(someRelease);
126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);
127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);
128. 
129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
130.     assertEquals(2, namespaceVOs.size());
131. 
132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));
133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);
134.     assertEquals(1, namespaceVOs.size());
135.     NamespaceBO namespaceVO = namespaceVOs.get(0);
136.     assertEquals(4, namespaceVO.getItems().size());
137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());
138.     assertEquals(2, namespaceVO.getItemModifiedCnt());
139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());
140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());
141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());
142. 
143.     ReleaseDTO errorRelease = new ReleaseDTO();
144.     errorRelease.setConfigurations("\"a\":\"123\",\"b\":\"123\"");
145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);
146.     assertThatExceptionOfType(RuntimeException.class)
147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))
148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");
149. 
150.   }
151. 
152.   @Test
153.   public void testDeletePrivateNamespace() {
154.     String operator = "user";
155.     AppNamespace privateNamespace = createAppNamespace(testAppId, testNamespaceName, false);
156. 
157.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(privateNamespace);
158. 
159.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));
160. 
161.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);
162. 
163.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);
164.   }
165. 
166.   @Test
167.   public void testGetNamespaceUsage() {
168.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);
169.     String branchName = "branch";
170. 
171.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);
172. 
173.     when(portalSettings.getActiveEnvs()).thenReturn(Lists.newArrayList(testEnv));
174.     ClusterDTO cluster = new ClusterDTO();
175.     cluster.setName(testClusterName);
176.     cluster.setAppId(testAppId);
177.     when(clusterService.findClusters(testEnv, testAppId)).thenReturn(Lists.newArrayList(cluster));
178.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);
179.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))
180.         .thenReturn(8);
181.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);
182.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(9);
183.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);
184. 
185.     when(namespaceAPI.countPublicAppNamespaceAssociatedNamespaces(testEnv, testNamespaceName)).thenReturn(10);
186. 
187.     List<NamespaceUsage> usages = namespaceService.getNamespaceUsageByAppId(testAppId, testNamespaceName);
188.     assertThat(usages).asList().hasSize(1);
189.     assertThat(usages.get(0).getInstanceCount()).isEqualTo(8);
190.     assertThat(usages.get(0).getBranchInstanceCount()).isEqualTo(9);
191.     assertThat(usages.get(0).getLinkedNamespaceCount()).isEqualTo(10);
192. 
193.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(testAppId, testNamespaceName, testEnv, testClusterName);
194.     assertThat(usage).isNotNull();
195.     assertThat(usage.getInstanceCount()).isEqualTo(8);
196.     assertThat(usage.getBranchInstanceCount()).isEqualTo(9);
197.     assertThat(usage.getLinkedNamespaceCount()).isEqualTo(0);
198.   }
199. 
200.   @Test
201.   public void testDeleteEmptyNamespace() {
202.     String branchName = "branch";
203.     String operator = "user";
204. 
205.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);
206.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);
207. 
208.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);
209.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))
210.         .thenReturn(0);
211.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);
212.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(0);
213.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);
214. 
215.     NamespaceDTO namespace = createNamespace(testAppId, testClusterName, testNamespaceName);
216.     when(namespaceAPI.getPublicAppNamespaceAllNamespaces(testEnv, testNamespaceName, 0, 10)).thenReturn(
217.         Collections.singletonList(namespace));
218.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));
219. 
220.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);
221. 
222.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);
223. 
224.   }
225. 
226. 
227.   private AppNamespace createAppNamespace(String appId, String name, boolean isPublic) {
228.     AppNamespace instance = new AppNamespace();
229. 
230.     instance.setAppId(appId);
231.     instance.setName(name);
232.     instance.setPublic(isPublic);
233. 
234.     return instance;
235.   }
236. 
237.   private NamespaceDTO createNamespace(String appId, String clusterName, String namespaceName) {
238.     NamespaceDTO instance = new NamespaceDTO();
239. 
240.     instance.setAppId(appId);
241.     instance.setClusterName(clusterName);
242.     instance.setNamespaceName(namespaceName);
243. 
244.     return instance;
245.   }
246. 
247.   private UserInfo createUser(String userId) {
248.     UserInfo instance = new UserInfo();
249. 
250.     instance.setUserId(userId);
251. 
252.     return instance;
253.   }
254. }

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:39:21,543 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The user needs 5 complete, self-contained existing test cases related to namespace creation/query behavior, especially around dot handling. The aggregated context already includes full contents (with imports and helpers) for relevant tests across adminservice, portal, common, configservice util, and configservice controller. These cover validation errors, InputValidator rules, namespace normalization, and config queries involving dot-suffixed names. No additional files or documentation are necessary to fulfill the request.' query='' extra_requirements='' purpose=''
2025-11-12 11:39:21,546 - thread-135845287823040.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Context retrieved: [Context(relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java', content='1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.adminservice.controller;\n18. \n19. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;\n20. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;\n21. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n22. \n23. import org.junit.Assert;\n24. import org.junit.Test;\n25. import org.springframework.beans.factory.annotation.Autowired;\n26. import org.springframework.test.context.jdbc.Sql;\n27. \n28. public class AppNamespaceControllerTest extends AbstractControllerTest{\n29. \n30.   @Autowired\n31.   private AppNamespaceRepository namespaceRepository;\n32. \n33.   @Test\n34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)\n35.   public void testCreate(){\n36.     String appId = "6666";\n37.     String name = "testnamespace";\n38.     String comment = "comment";\n39.     AppNamespaceDTO dto = new AppNamespaceDTO();\n40.     dto.setAppId(appId);\n41.     dto.setName(name);\n42.     dto.setComment(comment);\n43.     dto.setDataChangeCreatedBy("apollo");\n44. \n45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(\n46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();\n47. \n48.     Assert.assertEquals(appId, resultDto.getAppId());\n49.     Assert.assertTrue(resultDto.getId() > 0);\n50. \n51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);\n52.     Assert.assertNotNull(savedAppNs);\n53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());\n54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());\n55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());\n56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());\n57. \n58. \n59. \n60. \n61.   }\n62. }', start_line_number=1, end_line_number=62), Context(relative_path='apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java', content='1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.adminservice.controller;\n18. \n19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;\n20. import com.ctrip.framework.apollo.common.utils.InputValidator;\n21. import org.junit.Assert;\n22. import org.junit.Test;\n23. import org.springframework.web.client.HttpClientErrorException;\n24. import static org.hamcrest.Matchers.containsString;\n25. \n26. /**\n27.  * Created by kezhenxu at 2019/1/8 16:27.\n28.  *\n29.  * @author kezhenxu (kezhenxu94@163.com)\n30.  */\n31. public class NamespaceControllerTest extends AbstractControllerTest {\n32.   @Test\n33.   public void create() {\n34.     try {\n35.       NamespaceDTO namespaceDTO = new NamespaceDTO();\n36.       namespaceDTO.setClusterName("cluster");\n37.       namespaceDTO.setNamespaceName("invalid name");\n38.       namespaceDTO.setAppId("whatever");\n39.       restTemplate.postForEntity(\n40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),\n41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());\n42.       Assert.fail("Should throw");\n43.     } catch (HttpClientErrorException e) {\n44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));\n45.     }\n46.   }\n47. }', start_line_number=1, end_line_number=47), Context(relative_path='apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java', content='1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.common.utils;\n18. \n19. import static org.junit.Assert.*;\n20. \n21. import org.junit.Test;\n22. \n23. public class InputValidatorTest {\n24. \n25.   @Test\n26.   public void testValidClusterName() throws Exception {\n27.     checkClusterName("some.cluster-_name.123", true);\n28.     checkClusterName("some.cluster-_name.123.yml", true);\n29.     checkClusterName("some.&.name", false);\n30.     checkClusterName("", false);\n31.     checkClusterName(null, false);\n32.   }\n33. \n34.   @Test\n35.   public void testValidAppNamespaceName() throws Exception {\n36.     checkAppNamespaceName("some.cluster-_name.123", true);\n37.     checkAppNamespaceName("some.&.name", false);\n38.     checkAppNamespaceName("", false);\n39.     checkAppNamespaceName(null, false);\n40.     checkAppNamespaceName("some.name.json", false);\n41.     checkAppNamespaceName("some.name.yml", false);\n42.     checkAppNamespaceName("some.name.yaml", false);\n43.     checkAppNamespaceName("some.name.xml", false);\n44.     checkAppNamespaceName("some.name.properties", false);\n45.   }\n46. \n47.   private void checkClusterName(String name, boolean valid) {\n48.     assertEquals(valid, InputValidator.isValidClusterNamespace(name));\n49.   }\n50. \n51.   private void checkAppNamespaceName(String name, boolean valid) {\n52.     assertEquals(valid, InputValidator.isValidAppNamespace(name));\n53.   }\n54. }', start_line_number=1, end_line_number=54), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java', content='1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.configservice.controller;\n18. \n19. import com.ctrip.framework.apollo.biz.entity.Release;\n20. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\n22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;\n23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;\n24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;\n25. import com.ctrip.framework.apollo.core.ConfigConsts;\n26. import com.ctrip.framework.apollo.core.dto.ApolloConfig;\n27. import com.ctrip.framework.apollo.core.dto.ApolloNotificationMessages;\n28. import com.google.common.base.Joiner;\n29. import com.google.common.collect.ImmutableMap;\n30. import com.google.common.collect.Lists;\n31. import com.google.gson.Gson;\n32. import com.google.gson.JsonSyntaxException;\n33. import org.junit.Before;\n34. import org.junit.Test;\n35. import org.junit.runner.RunWith;\n36. import org.mockito.Mock;\n37. import org.mockito.junit.MockitoJUnitRunner;\n38. \n39. import javax.servlet.http.HttpServletRequest;\n40. import javax.servlet.http.HttpServletResponse;\n41. import java.util.Map;\n42. \n43. import static org.junit.Assert.assertEquals;\n44. import static org.junit.Assert.assertNull;\n45. import static org.mockito.Mockito.*;\n46. \n47. /**\n48.  * @author Jason Song(song_s@ctrip.com)\n49.  */\n50. @RunWith(MockitoJUnitRunner.class)\n51. public class ConfigControllerTest {\n52.   private ConfigController configController;\n53.   @Mock\n54.   private ConfigService configService;\n55.   @Mock\n56.   private AppNamespaceServiceWithCache appNamespaceService;\n57.   private String someAppId;\n58.   private String someClusterName;\n59.   private String defaultClusterName;\n60.   private String defaultNamespaceName;\n61.   private String somePublicNamespaceName;\n62.   private String someDataCenter;\n63.   private String someClientIp;\n64.   private String someClientLabel;\n65.   private String someMessagesAsString;\n66.   @Mock\n67.   private ApolloNotificationMessages someNotificationMessages;\n68.   @Mock\n69.   private Release someRelease;\n70.   @Mock\n71.   private Release somePublicRelease;\n72.   @Mock\n73.   private NamespaceUtil namespaceUtil;\n74.   @Mock\n75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;\n76.   @Mock\n77.   private HttpServletRequest someRequest;\n78.   private Gson gson = new Gson();\n79. \n80.   @Before\n81.   public void setUp() throws Exception {\n82.     configController = spy(new ConfigController(\n83.         configService, appNamespaceService, namespaceUtil, instanceConfigAuditUtil, gson\n84.     ));\n85. \n86.     someAppId = "1";\n87.     someClusterName = "someClusterName";\n88.     defaultClusterName = ConfigConsts.CLUSTER_NAME_DEFAULT;\n89.     defaultNamespaceName = ConfigConsts.NAMESPACE_APPLICATION;\n90.     somePublicNamespaceName = "somePublicNamespace";\n91.     someDataCenter = "someDC";\n92.     someClientIp = "someClientIp";\n93.     someClientLabel = "someClientLabel";\n94.     String someValidConfiguration = "{\\"apollo.bar\\": \\"foo\\"}";\n95.     String somePublicConfiguration = "{\\"apollo.public.bar\\": \\"foo\\"}";\n96. \n97.     when(someRelease.getAppId()).thenReturn(someAppId);\n98.     when(someRelease.getClusterName()).thenReturn(someClusterName);\n99.     when(someRelease.getConfigurations()).thenReturn(someValidConfiguration);\n100.     when(somePublicRelease.getConfigurations()).thenReturn(somePublicConfiguration);\n101.     when(namespaceUtil.filterNamespaceName(defaultNamespaceName)).thenReturn(defaultNamespaceName);\n102.     when(namespaceUtil.filterNamespaceName(somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n103.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);\n104.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n105. \n106.     someMessagesAsString = "someValidJson";\n107.     when(configController.transformMessages(someMessagesAsString)).thenReturn(someNotificationMessages);\n108.   }\n109. \n110.   @Test\n111.   public void testQueryConfig() throws Exception {\n112.     String someClientSideReleaseKey = "1";\n113.     String someServerSideNewReleaseKey = "2";\n114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n115. \n116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,\n117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);\n119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);\n120. \n121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,\n122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,\n123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n124. \n125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,\n126.         defaultNamespaceName, someDataCenter, someNotificationMessages);\n127.     assertEquals(someAppId, result.getAppId());\n128.     assertEquals(someClusterName, result.getCluster());\n129.     assertEquals(defaultNamespaceName, result.getNamespaceName());\n130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());\n131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);\n133.   }\n134. \n135.   @Test\n136.   public void testQueryConfigFile() throws Exception {\n137.     String someClientSideReleaseKey = "1";\n138.     String someServerSideNewReleaseKey = "2";\n139.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n140.     String someNamespaceName = String.format("%s.%s", defaultClusterName, "properties");\n141. \n142.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,\n143.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n144.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);\n145.     when(namespaceUtil.filterNamespaceName(someNamespaceName)).thenReturn(defaultNamespaceName);\n146.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);\n147. \n148.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,\n149.         someNamespaceName, someDataCenter, someClientSideReleaseKey,\n150.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n151. \n152.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,\n153.         defaultNamespaceName, someDataCenter, someNotificationMessages);\n154.     assertEquals(someAppId, result.getAppId());\n155.     assertEquals(someClusterName, result.getCluster());\n156.     assertEquals(someNamespaceName, result.getNamespaceName());\n157.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());\n158.   }\n159. \n160.   @Test\n161.   public void testQueryConfigFileWithPrivateNamespace() throws Exception {\n162.     String someClientSideReleaseKey = "1";\n163.     String someServerSideNewReleaseKey = "2";\n164.     String somePrivateNamespace = "datasource";\n165.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n166.     String somePrivateNamespaceName = String.format("%s.%s", somePrivateNamespace, "xml");\n167.     AppNamespace appNamespace = mock(AppNamespace.class);\n168. \n169.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePrivateNamespace,\n170.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n171.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);\n172.     when(namespaceUtil.filterNamespaceName(somePrivateNamespaceName)).thenReturn(somePrivateNamespace);\n173.     when(namespaceUtil.normalizeNamespace(someAppId, somePrivateNamespace)).thenReturn(somePrivateNamespace);\n174.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePrivateNamespace))\n175.         .thenReturn(appNamespace);\n176. \n177.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,\n178.         somePrivateNamespaceName, someDataCenter, someClientSideReleaseKey,\n179.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n180. \n181.     assertEquals(someAppId, result.getAppId());\n182.     assertEquals(someClusterName, result.getCluster());\n183.     assertEquals(somePrivateNamespaceName, result.getNamespaceName());\n184.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());\n185.   }\n186. \n187.   @Test\n188.   public void testQueryConfigWithReleaseNotFound() throws Exception {\n189.     String someClientSideReleaseKey = "1";\n190.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n191. \n192.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,\n193.         someDataCenter, someNotificationMessages)).thenReturn(null);\n194. \n195.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,\n196.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,\n197.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n198. \n199.     assertNull(result);\n200.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());\n201.   }\n202. \n203.   @Test\n204.   public void testQueryConfigWithApolloConfigNotModified() throws Exception {\n205.     String someClientSideReleaseKey = "1";\n206.     String someServerSideReleaseKey = someClientSideReleaseKey;\n207.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n208. \n209.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,\n210.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n211.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n212. \n213.     ApolloConfig result =\n214.         configController.queryConfig(someAppId, someClusterName, defaultNamespaceName, someDataCenter,\n215.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n216. \n217.     assertNull(result);\n218.     verify(someResponse, times(1)).setStatus(HttpServletResponse.SC_NOT_MODIFIED);\n219.   }\n220. \n221.   @Test\n222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {\n223.     String someClientSideReleaseKey = "1";\n224.     String someServerSideReleaseKey = "2";\n225.     String someAppOwnNamespaceName = "someAppOwn";\n226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n227.     AppNamespace someAppOwnNamespace =\n228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);\n229. \n230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,\n231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))\n233.         .thenReturn(someAppOwnNamespace);\n234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);\n236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);\n237. \n238.     ApolloConfig result =\n239.         configController\n240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,\n241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n242. \n243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n244.     assertEquals(someAppId, result.getAppId());\n245.     assertEquals(someClusterName, result.getCluster());\n246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());\n247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));\n248.   }\n249. \n250.   @Test\n251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {\n252.     String someClientSideReleaseKey = "1";\n253.     String someServerSideReleaseKey = "2";\n254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n255.     String somePublicAppId = "somePublicAppId";\n256.     String somePublicClusterName = "somePublicClusterName";\n257.     AppNamespace somePublicAppNamespace =\n258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n259. \n260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,\n261.         someDataCenter, someNotificationMessages)).thenReturn(null);\n262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n263.         .thenReturn(somePublicAppNamespace);\n264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);\n268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);\n269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);\n270. \n271.     ApolloConfig result = configController\n272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,\n273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n274. \n275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n276.     assertEquals(someAppId, result.getAppId());\n277.     assertEquals(someClusterName, result.getCluster());\n278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());\n279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));\n280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);\n282.   }\n283. \n284.   @Test\n285.   public void testQueryConfigFileWithPublicNamespaceAndNoAppOverride() throws Exception {\n286.     String someClientSideReleaseKey = "1";\n287.     String someServerSideReleaseKey = "2";\n288.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n289.     String somePublicAppId = "somePublicAppId";\n290.     String someNamespace = String.format("%s.%s", somePublicNamespaceName, "properties");\n291.     AppNamespace somePublicAppNamespace =\n292.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n293. \n294.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,\n295.         someDataCenter, someNotificationMessages)).thenReturn(null);\n296.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n297.         .thenReturn(somePublicAppNamespace);\n298.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n299.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n300.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n301.     when(namespaceUtil.filterNamespaceName(someNamespace)).thenReturn(somePublicNamespaceName);\n302.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n303.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePublicNamespaceName)).thenReturn(null);\n304. \n305.     ApolloConfig result = configController\n306.         .queryConfig(someAppId, someClusterName, someNamespace, someDataCenter,\n307.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n308. \n309.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n310.     assertEquals(someAppId, result.getAppId());\n311.     assertEquals(someClusterName, result.getCluster());\n312.     assertEquals(someNamespace, result.getNamespaceName());\n313.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));\n314.   }\n315. \n316.   @Test\n317.   public void testQueryConfigWithPublicNamespaceAndAppOverride() throws Exception {\n318.     String someAppSideReleaseKey = "1";\n319.     String somePublicAppSideReleaseKey = "2";\n320. \n321.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n322.     String somePublicAppId = "somePublicAppId";\n323.     AppNamespace somePublicAppNamespace =\n324.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n325. \n326.     when(someRelease.getConfigurations()).thenReturn("{\\"apollo.public.foo\\": \\"foo-override\\"}");\n327.     when(somePublicRelease.getConfigurations())\n328.         .thenReturn("{\\"apollo.public.foo\\": \\"foo\\", \\"apollo.public.bar\\": \\"bar\\"}");\n329. \n330.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,\n331.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n332.     when(someRelease.getReleaseKey()).thenReturn(someAppSideReleaseKey);\n333.     when(someRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);\n334.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n335.         .thenReturn(somePublicAppNamespace);\n336.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n337.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n338.     when(somePublicRelease.getReleaseKey()).thenReturn(somePublicAppSideReleaseKey);\n339.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);\n340.     when(somePublicRelease.getClusterName()).thenReturn(someDataCenter);\n341.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);\n342. \n343.     ApolloConfig result =\n344.         configController\n345.             .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,\n346.                 someAppSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n347. \n348.     assertEquals(Joiner.on(ConfigConsts.CLUSTER_NAMESPACE_SEPARATOR)\n349.             .join(someAppSideReleaseKey, somePublicAppSideReleaseKey),\n350.         result.getReleaseKey());\n351.     assertEquals(someAppId, result.getAppId());\n352.     assertEquals(someClusterName, result.getCluster());\n353.     assertEquals(somePublicNamespaceName, result.getNamespaceName());\n354.     assertEquals("foo-override", result.getConfigurations().get("apollo.public.foo"));\n355.     assertEquals("bar", result.getConfigurations().get("apollo.public.bar"));\n356.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n357.         someClientIp, someAppId, someClusterName, somePublicNamespaceName, someAppSideReleaseKey);\n358.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n359.         someClientIp, somePublicAppId, someDataCenter, somePublicNamespaceName, somePublicAppSideReleaseKey);\n360.   }\n361. \n362.   @Test\n363.   public void testMergeConfigurations() throws Exception {\n364.     Gson gson = new Gson();\n365.     String key1 = "key1";\n366.     String value1 = "value1";\n367.     String anotherValue1 = "anotherValue1";\n368. \n369.     String key2 = "key2";\n370.     String value2 = "value2";\n371. \n372.     Map<String, String> config = ImmutableMap.of(key1, anotherValue1);\n373.     Map<String, String> anotherConfig = ImmutableMap.of(key1, value1, key2, value2);\n374. \n375.     Release releaseWithHighPriority = new Release();\n376.     releaseWithHighPriority.setConfigurations(gson.toJson(config));\n377. \n378.     Release releaseWithLowPriority = new Release();\n379.     releaseWithLowPriority.setConfigurations(gson.toJson(anotherConfig));\n380. \n381.     Map<String, String> result =\n382.         configController.mergeReleaseConfigurations(\n383.             Lists.newArrayList(releaseWithHighPriority, releaseWithLowPriority));\n384. \n385.     assertEquals(2, result.keySet().size());\n386.     assertEquals(anotherValue1, result.get(key1));\n387.     assertEquals(value2, result.get(key2));\n388.   }\n389. \n390.   @Test(expected = JsonSyntaxException.class)\n391.   public void testTransformConfigurationToMapFailed() throws Exception {\n392.     String someInvalidConfiguration = "xxx";\n393.     Release someRelease = new Release();\n394.     someRelease.setConfigurations(someInvalidConfiguration);\n395. \n396.     configController.mergeReleaseConfigurations(Lists.newArrayList(someRelease));\n397.   }\n398. \n399.   @Test\n400.   public void testQueryConfigForNoAppIdPlaceHolder() throws Exception {\n401.     String someClientSideReleaseKey = "1";\n402.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n403.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;\n404. \n405.     ApolloConfig result = configController.queryConfig(appId, someClusterName,\n406.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,\n407.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n408. \n409.     verify(configService, never()).loadConfig(appId, someClientIp, someAppId, someClientLabel, someClusterName, defaultNamespaceName,\n410.         someDataCenter, someNotificationMessages);\n411.     verify(appNamespaceService, never()).findPublicNamespaceByName(defaultNamespaceName);\n412.     assertNull(result);\n413.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());\n414.   }\n415. \n416.   @Test\n417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {\n418.     String someClientSideReleaseKey = "1";\n419.     String someServerSideReleaseKey = "2";\n420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n421.     String somePublicAppId = "somePublicAppId";\n422.     AppNamespace somePublicAppNamespace =\n423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;\n425. \n426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n427.         .thenReturn(somePublicAppNamespace);\n428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n432. \n433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,\n434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,\n435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n436. \n437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,\n438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);\n439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n440.     assertEquals(appId, result.getAppId());\n441.     assertEquals(someClusterName, result.getCluster());\n442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());\n443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));\n444.   }\n445. \n446.   @Test\n447.   public void testTransformMessages() throws Exception {\n448.     String someKey = "someKey";\n449.     long someNotificationId = 1;\n450.     String anotherKey = "anotherKey";\n451.     long anotherNotificationId = 2;\n452.     ApolloNotificationMessages notificationMessages = new ApolloNotificationMessages();\n453.     notificationMessages.put(someKey, someNotificationId);\n454.     notificationMessages.put(anotherKey, anotherNotificationId);\n455. \n456.     String someMessagesAsString = gson.toJson(notificationMessages);\n457. \n458.     ApolloNotificationMessages result = configController.transformMessages(someMessagesAsString);\n459. \n460.     assertEquals(notificationMessages.getDetails(), result.getDetails());\n461.   }\n462. \n463.   @Test\n464.   public void testTransformInvalidMessages() throws Exception {\n465.     String someInvalidMessages = "someInvalidMessages";\n466. \n467.     assertNull(configController.transformMessages(someInvalidMessages));\n468.   }\n469. \n470.   private AppNamespace assemblePublicAppNamespace(String appId, String namespace) {\n471.     return assembleAppNamespace(appId, namespace, true);\n472.   }\n473. \n474.   private AppNamespace assembleAppNamespace(String appId, String namespace, boolean isPublic) {\n475.     AppNamespace appNamespace = new AppNamespace();\n476.     appNamespace.setAppId(appId);\n477.     appNamespace.setName(namespace);\n478.     appNamespace.setPublic(isPublic);\n479.     return appNamespace;\n480.   }\n481. }', start_line_number=1, end_line_number=481), Context(relative_path='apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java', content='1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.configservice.util;\n18. \n19. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\n21. import org.junit.Before;\n22. import org.junit.Test;\n23. import org.junit.runner.RunWith;\n24. import org.mockito.Mock;\n25. import org.mockito.junit.MockitoJUnitRunner;\n26. \n27. import static org.junit.Assert.assertEquals;\n28. import static org.mockito.Mockito.*;\n29. \n30. /**\n31.  * @author Jason Song(song_s@ctrip.com)\n32.  */\n33. @RunWith(MockitoJUnitRunner.class)\n34. public class NamespaceUtilTest {\n35.   private NamespaceUtil namespaceUtil;\n36. \n37.   @Mock\n38.   private AppNamespaceServiceWithCache appNamespaceServiceWithCache;\n39. \n40.   @Before\n41.   public void setUp() throws Exception {\n42.     namespaceUtil = new NamespaceUtil(appNamespaceServiceWithCache);\n43.   }\n44. \n45.   @Test\n46.   public void testFilterNamespaceName() throws Exception {\n47.     String someName = "a.properties";\n48. \n49.     assertEquals("a", namespaceUtil.filterNamespaceName(someName));\n50.   }\n51. \n52.   @Test\n53.   public void testFilterNamespaceNameUnchanged() throws Exception {\n54.     String someName = "a.xml";\n55. \n56.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));\n57.   }\n58. \n59.   @Test\n60.   public void testFilterNamespaceNameWithMultiplePropertiesSuffix() throws Exception {\n61.     String someName = "a.properties.properties";\n62. \n63.     assertEquals("a.properties", namespaceUtil.filterNamespaceName(someName));\n64.   }\n65. \n66.   @Test\n67.   public void testFilterNamespaceNameWithRandomCase() throws Exception {\n68.     String someName = "AbC.ProPErties";\n69. \n70.     assertEquals("AbC", namespaceUtil.filterNamespaceName(someName));\n71.   }\n72. \n73.   @Test\n74.   public void testFilterNamespaceNameWithRandomCaseUnchanged() throws Exception {\n75.     String someName = "AbCD.xMl";\n76. \n77.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));\n78.   }\n79. \n80.   @Test\n81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {\n82.     String someAppId = "someAppId";\n83.     String someNamespaceName = "someNamespaceName";\n84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";\n85.     AppNamespace someAppNamespace = mock(AppNamespace.class);\n86. \n87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);\n88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn\n89.         (someAppNamespace);\n90. \n91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));\n92. \n93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);\n94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);\n95.   }\n96. \n97.   @Test\n98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {\n99.     String someAppId = "someAppId";\n100.     String someNamespaceName = "someNamespaceName";\n101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";\n102.     AppNamespace someAppNamespace = mock(AppNamespace.class);\n103. \n104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);\n105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);\n106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);\n107. \n108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));\n109. \n110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);\n111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);\n112.   }\n113. \n114.   @Test\n115.   public void testNormalizeNamespaceFailed() throws Exception {\n116.     String someAppId = "someAppId";\n117.     String someNamespaceName = "someNamespaceName";\n118. \n119.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);\n120.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(null);\n121. \n122.     assertEquals(someNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));\n123. \n124.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);\n125.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);\n126.   }\n127. }', start_line_number=1, end_line_number=127), Context(relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java', content='1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.openapi.v1.controller;\n18. \n19. import com.ctrip.framework.apollo.common.utils.InputValidator;\n20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;\n21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;\n22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;\n23. import org.junit.Assert;\n24. import org.junit.Test;\n25. import org.springframework.beans.factory.annotation.Autowired;\n26. import org.springframework.test.context.ActiveProfiles;\n27. import org.springframework.web.client.HttpClientErrorException;\n28. import static org.hamcrest.Matchers.containsString;\n29. \n30. /**\n31.  * Created by kezhenxu at 2019/1/8 18:17.\n32.  *\n33.  * @author kezhenxu (kezhenxu94@163.com)\n34.  */\n35. @ActiveProfiles("skipAuthorization")\n36. public class NamespaceControllerTest extends AbstractControllerTest {\n37.   @Autowired\n38.   private ConsumerPermissionValidator consumerPermissionValidator;\n39. \n40.   @Test\n41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {\n42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));\n43. \n44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();\n45.     dto.setAppId("appId");\n46.     dto.setName("invalid name");\n47.     dto.setFormat(ConfigFileFormat.Properties.getValue());\n48.     dto.setDataChangeCreatedBy("apollo");\n49.     try {\n50.       restTemplate.postForEntity(\n51.           url("/openapi/v1/apps/{appId}/appnamespaces"),\n52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()\n53.       );\n54.       Assert.fail("should throw");\n55.     } catch (HttpClientErrorException e) {\n56.       String result = e.getResponseBodyAsString();\n57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));\n58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));\n59.     }\n60.   }\n61. }', start_line_number=1, end_line_number=61), Context(relative_path='apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java', content='1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.portal.service;\n18. \n19. import com.ctrip.framework.apollo.common.dto.ClusterDTO;\n20. import com.ctrip.framework.apollo.common.dto.ItemDTO;\n21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;\n22. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;\n23. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;\n25. import com.ctrip.framework.apollo.portal.component.PortalSettings;\n26. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;\n27. import com.ctrip.framework.apollo.portal.environment.Env;\n28. import com.ctrip.framework.apollo.portal.AbstractUnitTest;\n29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;\n30. import com.ctrip.framework.apollo.portal.component.txtresolver.PropertyResolver;\n31. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;\n32. import com.ctrip.framework.apollo.portal.entity.bo.UserInfo;\n33. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;\n34. \n35. import org.assertj.core.util.Lists;\n36. import org.junit.Before;\n37. import org.junit.Test;\n38. import org.mockito.InjectMocks;\n39. import org.mockito.Mock;\n40. \n41. import java.util.Arrays;\n42. import java.util.Collections;\n43. import java.util.List;\n44. \n45. import static org.assertj.core.api.AssertionsForClassTypes.assertThat;\n46. import static org.assertj.core.api.AssertionsForClassTypes.assertThatExceptionOfType;\n47. import static org.junit.Assert.assertEquals;\n48. import static org.mockito.Mockito.mock;\n49. import static org.mockito.Mockito.times;\n50. import static org.mockito.Mockito.verify;\n51. import static org.mockito.Mockito.when;\n52. \n53. public class NamespaceServiceTest extends AbstractUnitTest {\n54. \n55.   @Mock\n56.   private AdminServiceAPI.NamespaceAPI namespaceAPI;\n57.   @Mock\n58.   private ReleaseService releaseService;\n59.   @Mock\n60.   private ItemService itemService;\n61.   @Mock\n62.   private PropertyResolver resolver;\n63.   @Mock\n64.   private AppNamespaceService appNamespaceService;\n65.   @Mock\n66.   private InstanceService instanceService;\n67.   @Mock\n68.   private NamespaceBranchService branchService;\n69.   @Mock\n70.   private UserInfoHolder userInfoHolder;\n71.   @Mock\n72.   private AdditionalUserInfoEnrichService additionalUserInfoEnrichService;\n73.   @Mock\n74.   private PortalSettings portalSettings;\n75.   @Mock\n76.   private ClusterService clusterService;\n77. \n78.   @InjectMocks\n79.   private NamespaceService namespaceService;\n80. \n81.   private String testAppId = "6666";\n82.   private String testClusterName = "default";\n83.   private String testNamespaceName = "application";\n84.   private Env testEnv = Env.DEV;\n85. \n86.   @Before\n87.   public void setup() {\n88.   }\n89. \n90.   @Test\n91.   public void testFindNamespace() {\n92. \n93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);\n94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);\n95. \n96.     NamespaceDTO application = new NamespaceDTO();\n97.     application.setId(1);\n98.     application.setClusterName(testClusterName);\n99.     application.setAppId(testAppId);\n100.     application.setNamespaceName(testNamespaceName);\n101. \n102.     NamespaceDTO hermes = new NamespaceDTO();\n103.     hermes.setId(2);\n104.     hermes.setClusterName("default");\n105.     hermes.setAppId(testAppId);\n106.     hermes.setNamespaceName("hermes");\n107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);\n108. \n109.     ReleaseDTO someRelease = new ReleaseDTO();\n110.     someRelease.setConfigurations("{\\"a\\":\\"123\\",\\"b\\":\\"123\\"}");\n111. \n112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);\n113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);\n114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);\n115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);\n116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);\n117. \n118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());\n119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());\n120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))\n121.         .thenReturn(applicationAppNamespace);\n122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);\n123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);\n124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,\n125.                                           testNamespaceName)).thenReturn(someRelease);\n126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);\n127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);\n128. \n129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);\n130.     assertEquals(2, namespaceVOs.size());\n131. \n132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));\n133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);\n134.     assertEquals(1, namespaceVOs.size());\n135.     NamespaceBO namespaceVO = namespaceVOs.get(0);\n136.     assertEquals(4, namespaceVO.getItems().size());\n137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());\n138.     assertEquals(2, namespaceVO.getItemModifiedCnt());\n139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());\n140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());\n141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());\n142. \n143.     ReleaseDTO errorRelease = new ReleaseDTO();\n144.     errorRelease.setConfigurations("\\"a\\":\\"123\\",\\"b\\":\\"123\\"");\n145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);\n146.     assertThatExceptionOfType(RuntimeException.class)\n147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))\n148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");\n149. \n150.   }\n151. \n152.   @Test\n153.   public void testDeletePrivateNamespace() {\n154.     String operator = "user";\n155.     AppNamespace privateNamespace = createAppNamespace(testAppId, testNamespaceName, false);\n156. \n157.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(privateNamespace);\n158. \n159.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));\n160. \n161.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);\n162. \n163.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);\n164.   }\n165. \n166.   @Test\n167.   public void testGetNamespaceUsage() {\n168.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);\n169.     String branchName = "branch";\n170. \n171.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);\n172. \n173.     when(portalSettings.getActiveEnvs()).thenReturn(Lists.newArrayList(testEnv));\n174.     ClusterDTO cluster = new ClusterDTO();\n175.     cluster.setName(testClusterName);\n176.     cluster.setAppId(testAppId);\n177.     when(clusterService.findClusters(testEnv, testAppId)).thenReturn(Lists.newArrayList(cluster));\n178.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);\n179.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))\n180.         .thenReturn(8);\n181.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);\n182.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(9);\n183.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);\n184. \n185.     when(namespaceAPI.countPublicAppNamespaceAssociatedNamespaces(testEnv, testNamespaceName)).thenReturn(10);\n186. \n187.     List<NamespaceUsage> usages = namespaceService.getNamespaceUsageByAppId(testAppId, testNamespaceName);\n188.     assertThat(usages).asList().hasSize(1);\n189.     assertThat(usages.get(0).getInstanceCount()).isEqualTo(8);\n190.     assertThat(usages.get(0).getBranchInstanceCount()).isEqualTo(9);\n191.     assertThat(usages.get(0).getLinkedNamespaceCount()).isEqualTo(10);\n192. \n193.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(testAppId, testNamespaceName, testEnv, testClusterName);\n194.     assertThat(usage).isNotNull();\n195.     assertThat(usage.getInstanceCount()).isEqualTo(8);\n196.     assertThat(usage.getBranchInstanceCount()).isEqualTo(9);\n197.     assertThat(usage.getLinkedNamespaceCount()).isEqualTo(0);\n198.   }\n199. \n200.   @Test\n201.   public void testDeleteEmptyNamespace() {\n202.     String branchName = "branch";\n203.     String operator = "user";\n204. \n205.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);\n206.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);\n207. \n208.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);\n209.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))\n210.         .thenReturn(0);\n211.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);\n212.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(0);\n213.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);\n214. \n215.     NamespaceDTO namespace = createNamespace(testAppId, testClusterName, testNamespaceName);\n216.     when(namespaceAPI.getPublicAppNamespaceAllNamespaces(testEnv, testNamespaceName, 0, 10)).thenReturn(\n217.         Collections.singletonList(namespace));\n218.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));\n219. \n220.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);\n221. \n222.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);\n223. \n224.   }\n225. \n226. \n227.   private AppNamespace createAppNamespace(String appId, String name, boolean isPublic) {\n228.     AppNamespace instance = new AppNamespace();\n229. \n230.     instance.setAppId(appId);\n231.     instance.setName(name);\n232.     instance.setPublic(isPublic);\n233. \n234.     return instance;\n235.   }\n236. \n237.   private NamespaceDTO createNamespace(String appId, String clusterName, String namespaceName) {\n238.     NamespaceDTO instance = new NamespaceDTO();\n239. \n240.     instance.setAppId(appId);\n241.     instance.setClusterName(clusterName);\n242.     instance.setNamespaceName(namespaceName);\n243. \n244.     return instance;\n245.   }\n246. \n247.   private UserInfo createUser(String userId) {\n248.     UserInfo instance = new UserInfo();\n249. \n250.     instance.setUserId(userId);\n251. \n252.     return instance;\n253.   }\n254. }', start_line_number=1, end_line_number=254)]
2025-11-12 11:39:21,549 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_message_node - DEBUG - Sending message to BugReproducingWriteNode:
content='Issue title:\ncreate namespace with single dot 500 error\n\nIssue description: \n<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner\'s，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->\n\n- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)\n- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.\n- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.\n\n**Describe the bug**\ncreate namespace with . will crash in query namespace.\n\n\n**To Reproduce**\nSteps to reproduce the behavior:\n1.  create namespace with single dot(.)\n2. refresh namespace. \n\n**Expected behavior**\ndisplay normally.\n\n**Screenshots**\n\nhttps://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov\n\n\n\n\n### Additional Details & Logs\n\n- Latest Version (All)\n\n\nIssue comments:\n\n\nBug reproducing context:\nFile: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceControllerTest.java\nLine number range: 1 - 62\nContent:\n1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.adminservice.controller;\n18. \n19. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;\n20. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;\n21. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n22. \n23. import org.junit.Assert;\n24. import org.junit.Test;\n25. import org.springframework.beans.factory.annotation.Autowired;\n26. import org.springframework.test.context.jdbc.Sql;\n27. \n28. public class AppNamespaceControllerTest extends AbstractControllerTest{\n29. \n30.   @Autowired\n31.   private AppNamespaceRepository namespaceRepository;\n32. \n33.   @Test\n34.   @Sql(scripts = "/controller/cleanup.sql", executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD)\n35.   public void testCreate(){\n36.     String appId = "6666";\n37.     String name = "testnamespace";\n38.     String comment = "comment";\n39.     AppNamespaceDTO dto = new AppNamespaceDTO();\n40.     dto.setAppId(appId);\n41.     dto.setName(name);\n42.     dto.setComment(comment);\n43.     dto.setDataChangeCreatedBy("apollo");\n44. \n45.     AppNamespaceDTO resultDto = restTemplate.postForEntity(\n46.         String.format("http://localhost:%d/apps/%s/appnamespaces", port, appId),dto, AppNamespaceDTO.class).getBody();\n47. \n48.     Assert.assertEquals(appId, resultDto.getAppId());\n49.     Assert.assertTrue(resultDto.getId() > 0);\n50. \n51.     AppNamespace savedAppNs = namespaceRepository.findByAppIdAndName(appId, name);\n52.     Assert.assertNotNull(savedAppNs);\n53.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedTime());\n54.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedTime());\n55.     Assert.assertNotNull(savedAppNs.getDataChangeLastModifiedBy());\n56.     Assert.assertNotNull(savedAppNs.getDataChangeCreatedBy());\n57. \n58. \n59. \n60. \n61.   }\n62. }\n\n\nFile: apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceControllerTest.java\nLine number range: 1 - 47\nContent:\n1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.adminservice.controller;\n18. \n19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;\n20. import com.ctrip.framework.apollo.common.utils.InputValidator;\n21. import org.junit.Assert;\n22. import org.junit.Test;\n23. import org.springframework.web.client.HttpClientErrorException;\n24. import static org.hamcrest.Matchers.containsString;\n25. \n26. /**\n27.  * Created by kezhenxu at 2019/1/8 16:27.\n28.  *\n29.  * @author kezhenxu (kezhenxu94@163.com)\n30.  */\n31. public class NamespaceControllerTest extends AbstractControllerTest {\n32.   @Test\n33.   public void create() {\n34.     try {\n35.       NamespaceDTO namespaceDTO = new NamespaceDTO();\n36.       namespaceDTO.setClusterName("cluster");\n37.       namespaceDTO.setNamespaceName("invalid name");\n38.       namespaceDTO.setAppId("whatever");\n39.       restTemplate.postForEntity(\n40.           url("/apps/{appId}/clusters/{clusterName}/namespaces"),\n41.           namespaceDTO, NamespaceDTO.class, namespaceDTO.getAppId(), namespaceDTO.getClusterName());\n42.       Assert.fail("Should throw");\n43.     } catch (HttpClientErrorException e) {\n44.       Assert.assertThat(new String(e.getResponseBodyAsByteArray()), containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));\n45.     }\n46.   }\n47. }\n\n\nFile: apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/InputValidatorTest.java\nLine number range: 1 - 54\nContent:\n1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.common.utils;\n18. \n19. import static org.junit.Assert.*;\n20. \n21. import org.junit.Test;\n22. \n23. public class InputValidatorTest {\n24. \n25.   @Test\n26.   public void testValidClusterName() throws Exception {\n27.     checkClusterName("some.cluster-_name.123", true);\n28.     checkClusterName("some.cluster-_name.123.yml", true);\n29.     checkClusterName("some.&.name", false);\n30.     checkClusterName("", false);\n31.     checkClusterName(null, false);\n32.   }\n33. \n34.   @Test\n35.   public void testValidAppNamespaceName() throws Exception {\n36.     checkAppNamespaceName("some.cluster-_name.123", true);\n37.     checkAppNamespaceName("some.&.name", false);\n38.     checkAppNamespaceName("", false);\n39.     checkAppNamespaceName(null, false);\n40.     checkAppNamespaceName("some.name.json", false);\n41.     checkAppNamespaceName("some.name.yml", false);\n42.     checkAppNamespaceName("some.name.yaml", false);\n43.     checkAppNamespaceName("some.name.xml", false);\n44.     checkAppNamespaceName("some.name.properties", false);\n45.   }\n46. \n47.   private void checkClusterName(String name, boolean valid) {\n48.     assertEquals(valid, InputValidator.isValidClusterNamespace(name));\n49.   }\n50. \n51.   private void checkAppNamespaceName(String name, boolean valid) {\n52.     assertEquals(valid, InputValidator.isValidAppNamespace(name));\n53.   }\n54. }\n\n\nFile: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java\nLine number range: 1 - 481\nContent:\n1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.configservice.controller;\n18. \n19. import com.ctrip.framework.apollo.biz.entity.Release;\n20. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n21. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\n22. import com.ctrip.framework.apollo.configservice.service.config.ConfigService;\n23. import com.ctrip.framework.apollo.configservice.util.InstanceConfigAuditUtil;\n24. import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;\n25. import com.ctrip.framework.apollo.core.ConfigConsts;\n26. import com.ctrip.framework.apollo.core.dto.ApolloConfig;\n27. import com.ctrip.framework.apollo.core.dto.ApolloNotificationMessages;\n28. import com.google.common.base.Joiner;\n29. import com.google.common.collect.ImmutableMap;\n30. import com.google.common.collect.Lists;\n31. import com.google.gson.Gson;\n32. import com.google.gson.JsonSyntaxException;\n33. import org.junit.Before;\n34. import org.junit.Test;\n35. import org.junit.runner.RunWith;\n36. import org.mockito.Mock;\n37. import org.mockito.junit.MockitoJUnitRunner;\n38. \n39. import javax.servlet.http.HttpServletRequest;\n40. import javax.servlet.http.HttpServletResponse;\n41. import java.util.Map;\n42. \n43. import static org.junit.Assert.assertEquals;\n44. import static org.junit.Assert.assertNull;\n45. import static org.mockito.Mockito.*;\n46. \n47. /**\n48.  * @author Jason Song(song_s@ctrip.com)\n49.  */\n50. @RunWith(MockitoJUnitRunner.class)\n51. public class ConfigControllerTest {\n52.   private ConfigController configController;\n53.   @Mock\n54.   private ConfigService configService;\n55.   @Mock\n56.   private AppNamespaceServiceWithCache appNamespaceService;\n57.   private String someAppId;\n58.   private String someClusterName;\n59.   private String defaultClusterName;\n60.   private String defaultNamespaceName;\n61.   private String somePublicNamespaceName;\n62.   private String someDataCenter;\n63.   private String someClientIp;\n64.   private String someClientLabel;\n65.   private String someMessagesAsString;\n66.   @Mock\n67.   private ApolloNotificationMessages someNotificationMessages;\n68.   @Mock\n69.   private Release someRelease;\n70.   @Mock\n71.   private Release somePublicRelease;\n72.   @Mock\n73.   private NamespaceUtil namespaceUtil;\n74.   @Mock\n75.   private InstanceConfigAuditUtil instanceConfigAuditUtil;\n76.   @Mock\n77.   private HttpServletRequest someRequest;\n78.   private Gson gson = new Gson();\n79. \n80.   @Before\n81.   public void setUp() throws Exception {\n82.     configController = spy(new ConfigController(\n83.         configService, appNamespaceService, namespaceUtil, instanceConfigAuditUtil, gson\n84.     ));\n85. \n86.     someAppId = "1";\n87.     someClusterName = "someClusterName";\n88.     defaultClusterName = ConfigConsts.CLUSTER_NAME_DEFAULT;\n89.     defaultNamespaceName = ConfigConsts.NAMESPACE_APPLICATION;\n90.     somePublicNamespaceName = "somePublicNamespace";\n91.     someDataCenter = "someDC";\n92.     someClientIp = "someClientIp";\n93.     someClientLabel = "someClientLabel";\n94.     String someValidConfiguration = "{\\"apollo.bar\\": \\"foo\\"}";\n95.     String somePublicConfiguration = "{\\"apollo.public.bar\\": \\"foo\\"}";\n96. \n97.     when(someRelease.getAppId()).thenReturn(someAppId);\n98.     when(someRelease.getClusterName()).thenReturn(someClusterName);\n99.     when(someRelease.getConfigurations()).thenReturn(someValidConfiguration);\n100.     when(somePublicRelease.getConfigurations()).thenReturn(somePublicConfiguration);\n101.     when(namespaceUtil.filterNamespaceName(defaultNamespaceName)).thenReturn(defaultNamespaceName);\n102.     when(namespaceUtil.filterNamespaceName(somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n103.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);\n104.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n105. \n106.     someMessagesAsString = "someValidJson";\n107.     when(configController.transformMessages(someMessagesAsString)).thenReturn(someNotificationMessages);\n108.   }\n109. \n110.   @Test\n111.   public void testQueryConfig() throws Exception {\n112.     String someClientSideReleaseKey = "1";\n113.     String someServerSideNewReleaseKey = "2";\n114.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n115. \n116.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,\n117.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n118.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);\n119.     when(someRelease.getNamespaceName()).thenReturn(defaultNamespaceName);\n120. \n121.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,\n122.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,\n123.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n124. \n125.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,\n126.         defaultNamespaceName, someDataCenter, someNotificationMessages);\n127.     assertEquals(someAppId, result.getAppId());\n128.     assertEquals(someClusterName, result.getCluster());\n129.     assertEquals(defaultNamespaceName, result.getNamespaceName());\n130.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());\n131.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n132.         someClientIp, someAppId, someClusterName, defaultNamespaceName, someServerSideNewReleaseKey);\n133.   }\n134. \n135.   @Test\n136.   public void testQueryConfigFile() throws Exception {\n137.     String someClientSideReleaseKey = "1";\n138.     String someServerSideNewReleaseKey = "2";\n139.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n140.     String someNamespaceName = String.format("%s.%s", defaultClusterName, "properties");\n141. \n142.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,\n143.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n144.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);\n145.     when(namespaceUtil.filterNamespaceName(someNamespaceName)).thenReturn(defaultNamespaceName);\n146.     when(namespaceUtil.normalizeNamespace(someAppId, defaultNamespaceName)).thenReturn(defaultNamespaceName);\n147. \n148.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,\n149.         someNamespaceName, someDataCenter, someClientSideReleaseKey,\n150.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n151. \n152.     verify(configService, times(1)).loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName,\n153.         defaultNamespaceName, someDataCenter, someNotificationMessages);\n154.     assertEquals(someAppId, result.getAppId());\n155.     assertEquals(someClusterName, result.getCluster());\n156.     assertEquals(someNamespaceName, result.getNamespaceName());\n157.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());\n158.   }\n159. \n160.   @Test\n161.   public void testQueryConfigFileWithPrivateNamespace() throws Exception {\n162.     String someClientSideReleaseKey = "1";\n163.     String someServerSideNewReleaseKey = "2";\n164.     String somePrivateNamespace = "datasource";\n165.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n166.     String somePrivateNamespaceName = String.format("%s.%s", somePrivateNamespace, "xml");\n167.     AppNamespace appNamespace = mock(AppNamespace.class);\n168. \n169.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePrivateNamespace,\n170.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n171.     when(someRelease.getReleaseKey()).thenReturn(someServerSideNewReleaseKey);\n172.     when(namespaceUtil.filterNamespaceName(somePrivateNamespaceName)).thenReturn(somePrivateNamespace);\n173.     when(namespaceUtil.normalizeNamespace(someAppId, somePrivateNamespace)).thenReturn(somePrivateNamespace);\n174.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePrivateNamespace))\n175.         .thenReturn(appNamespace);\n176. \n177.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,\n178.         somePrivateNamespaceName, someDataCenter, someClientSideReleaseKey,\n179.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n180. \n181.     assertEquals(someAppId, result.getAppId());\n182.     assertEquals(someClusterName, result.getCluster());\n183.     assertEquals(somePrivateNamespaceName, result.getNamespaceName());\n184.     assertEquals(someServerSideNewReleaseKey, result.getReleaseKey());\n185.   }\n186. \n187.   @Test\n188.   public void testQueryConfigWithReleaseNotFound() throws Exception {\n189.     String someClientSideReleaseKey = "1";\n190.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n191. \n192.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,\n193.         someDataCenter, someNotificationMessages)).thenReturn(null);\n194. \n195.     ApolloConfig result = configController.queryConfig(someAppId, someClusterName,\n196.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,\n197.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n198. \n199.     assertNull(result);\n200.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());\n201.   }\n202. \n203.   @Test\n204.   public void testQueryConfigWithApolloConfigNotModified() throws Exception {\n205.     String someClientSideReleaseKey = "1";\n206.     String someServerSideReleaseKey = someClientSideReleaseKey;\n207.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n208. \n209.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, defaultNamespaceName,\n210.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n211.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n212. \n213.     ApolloConfig result =\n214.         configController.queryConfig(someAppId, someClusterName, defaultNamespaceName, someDataCenter,\n215.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n216. \n217.     assertNull(result);\n218.     verify(someResponse, times(1)).setStatus(HttpServletResponse.SC_NOT_MODIFIED);\n219.   }\n220. \n221.   @Test\n222.   public void testQueryConfigWithAppOwnNamespace() throws Exception {\n223.     String someClientSideReleaseKey = "1";\n224.     String someServerSideReleaseKey = "2";\n225.     String someAppOwnNamespaceName = "someAppOwn";\n226.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n227.     AppNamespace someAppOwnNamespace =\n228.         assemblePublicAppNamespace(someAppId, someAppOwnNamespaceName);\n229. \n230.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, someAppOwnNamespaceName,\n231.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n232.     when(appNamespaceService.findPublicNamespaceByName(someAppOwnNamespaceName))\n233.         .thenReturn(someAppOwnNamespace);\n234.     when(someRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n235.     when(namespaceUtil.filterNamespaceName(someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);\n236.     when(namespaceUtil.normalizeNamespace(someAppId, someAppOwnNamespaceName)).thenReturn(someAppOwnNamespaceName);\n237. \n238.     ApolloConfig result =\n239.         configController\n240.             .queryConfig(someAppId, someClusterName, someAppOwnNamespaceName, someDataCenter,\n241.                 someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n242. \n243.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n244.     assertEquals(someAppId, result.getAppId());\n245.     assertEquals(someClusterName, result.getCluster());\n246.     assertEquals(someAppOwnNamespaceName, result.getNamespaceName());\n247.     assertEquals("foo", result.getConfigurations().get("apollo.bar"));\n248.   }\n249. \n250.   @Test\n251.   public void testQueryConfigWithPubicNamespaceAndNoAppOverride() throws Exception {\n252.     String someClientSideReleaseKey = "1";\n253.     String someServerSideReleaseKey = "2";\n254.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n255.     String somePublicAppId = "somePublicAppId";\n256.     String somePublicClusterName = "somePublicClusterName";\n257.     AppNamespace somePublicAppNamespace =\n258.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n259. \n260.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,\n261.         someDataCenter, someNotificationMessages)).thenReturn(null);\n262.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n263.         .thenReturn(somePublicAppNamespace);\n264.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n265.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n266.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n267.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);\n268.     when(somePublicRelease.getClusterName()).thenReturn(somePublicClusterName);\n269.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);\n270. \n271.     ApolloConfig result = configController\n272.         .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,\n273.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n274. \n275.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n276.     assertEquals(someAppId, result.getAppId());\n277.     assertEquals(someClusterName, result.getCluster());\n278.     assertEquals(somePublicNamespaceName, result.getNamespaceName());\n279.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));\n280.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n281.         someClientIp, somePublicAppId, somePublicClusterName, somePublicNamespaceName, someServerSideReleaseKey);\n282.   }\n283. \n284.   @Test\n285.   public void testQueryConfigFileWithPublicNamespaceAndNoAppOverride() throws Exception {\n286.     String someClientSideReleaseKey = "1";\n287.     String someServerSideReleaseKey = "2";\n288.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n289.     String somePublicAppId = "somePublicAppId";\n290.     String someNamespace = String.format("%s.%s", somePublicNamespaceName, "properties");\n291.     AppNamespace somePublicAppNamespace =\n292.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n293. \n294.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,\n295.         someDataCenter, someNotificationMessages)).thenReturn(null);\n296.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n297.         .thenReturn(somePublicAppNamespace);\n298.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n299.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n300.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n301.     when(namespaceUtil.filterNamespaceName(someNamespace)).thenReturn(somePublicNamespaceName);\n302.     when(namespaceUtil.normalizeNamespace(someAppId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n303.     when(appNamespaceService.findByAppIdAndNamespace(someAppId, somePublicNamespaceName)).thenReturn(null);\n304. \n305.     ApolloConfig result = configController\n306.         .queryConfig(someAppId, someClusterName, someNamespace, someDataCenter,\n307.             someClientSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n308. \n309.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n310.     assertEquals(someAppId, result.getAppId());\n311.     assertEquals(someClusterName, result.getCluster());\n312.     assertEquals(someNamespace, result.getNamespaceName());\n313.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));\n314.   }\n315. \n316.   @Test\n317.   public void testQueryConfigWithPublicNamespaceAndAppOverride() throws Exception {\n318.     String someAppSideReleaseKey = "1";\n319.     String somePublicAppSideReleaseKey = "2";\n320. \n321.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n322.     String somePublicAppId = "somePublicAppId";\n323.     AppNamespace somePublicAppNamespace =\n324.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n325. \n326.     when(someRelease.getConfigurations()).thenReturn("{\\"apollo.public.foo\\": \\"foo-override\\"}");\n327.     when(somePublicRelease.getConfigurations())\n328.         .thenReturn("{\\"apollo.public.foo\\": \\"foo\\", \\"apollo.public.bar\\": \\"bar\\"}");\n329. \n330.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, someAppId, someClusterName, somePublicNamespaceName,\n331.         someDataCenter, someNotificationMessages)).thenReturn(someRelease);\n332.     when(someRelease.getReleaseKey()).thenReturn(someAppSideReleaseKey);\n333.     when(someRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);\n334.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n335.         .thenReturn(somePublicAppNamespace);\n336.     when(configService.loadConfig(someAppId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n337.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n338.     when(somePublicRelease.getReleaseKey()).thenReturn(somePublicAppSideReleaseKey);\n339.     when(somePublicRelease.getAppId()).thenReturn(somePublicAppId);\n340.     when(somePublicRelease.getClusterName()).thenReturn(someDataCenter);\n341.     when(somePublicRelease.getNamespaceName()).thenReturn(somePublicNamespaceName);\n342. \n343.     ApolloConfig result =\n344.         configController\n345.             .queryConfig(someAppId, someClusterName, somePublicNamespaceName, someDataCenter,\n346.                 someAppSideReleaseKey, someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n347. \n348.     assertEquals(Joiner.on(ConfigConsts.CLUSTER_NAMESPACE_SEPARATOR)\n349.             .join(someAppSideReleaseKey, somePublicAppSideReleaseKey),\n350.         result.getReleaseKey());\n351.     assertEquals(someAppId, result.getAppId());\n352.     assertEquals(someClusterName, result.getCluster());\n353.     assertEquals(somePublicNamespaceName, result.getNamespaceName());\n354.     assertEquals("foo-override", result.getConfigurations().get("apollo.public.foo"));\n355.     assertEquals("bar", result.getConfigurations().get("apollo.public.bar"));\n356.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n357.         someClientIp, someAppId, someClusterName, somePublicNamespaceName, someAppSideReleaseKey);\n358.     verify(instanceConfigAuditUtil, times(1)).audit(someAppId, someClusterName, someDataCenter,\n359.         someClientIp, somePublicAppId, someDataCenter, somePublicNamespaceName, somePublicAppSideReleaseKey);\n360.   }\n361. \n362.   @Test\n363.   public void testMergeConfigurations() throws Exception {\n364.     Gson gson = new Gson();\n365.     String key1 = "key1";\n366.     String value1 = "value1";\n367.     String anotherValue1 = "anotherValue1";\n368. \n369.     String key2 = "key2";\n370.     String value2 = "value2";\n371. \n372.     Map<String, String> config = ImmutableMap.of(key1, anotherValue1);\n373.     Map<String, String> anotherConfig = ImmutableMap.of(key1, value1, key2, value2);\n374. \n375.     Release releaseWithHighPriority = new Release();\n376.     releaseWithHighPriority.setConfigurations(gson.toJson(config));\n377. \n378.     Release releaseWithLowPriority = new Release();\n379.     releaseWithLowPriority.setConfigurations(gson.toJson(anotherConfig));\n380. \n381.     Map<String, String> result =\n382.         configController.mergeReleaseConfigurations(\n383.             Lists.newArrayList(releaseWithHighPriority, releaseWithLowPriority));\n384. \n385.     assertEquals(2, result.keySet().size());\n386.     assertEquals(anotherValue1, result.get(key1));\n387.     assertEquals(value2, result.get(key2));\n388.   }\n389. \n390.   @Test(expected = JsonSyntaxException.class)\n391.   public void testTransformConfigurationToMapFailed() throws Exception {\n392.     String someInvalidConfiguration = "xxx";\n393.     Release someRelease = new Release();\n394.     someRelease.setConfigurations(someInvalidConfiguration);\n395. \n396.     configController.mergeReleaseConfigurations(Lists.newArrayList(someRelease));\n397.   }\n398. \n399.   @Test\n400.   public void testQueryConfigForNoAppIdPlaceHolder() throws Exception {\n401.     String someClientSideReleaseKey = "1";\n402.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n403.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;\n404. \n405.     ApolloConfig result = configController.queryConfig(appId, someClusterName,\n406.         defaultNamespaceName, someDataCenter, someClientSideReleaseKey,\n407.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n408. \n409.     verify(configService, never()).loadConfig(appId, someClientIp, someAppId, someClientLabel, someClusterName, defaultNamespaceName,\n410.         someDataCenter, someNotificationMessages);\n411.     verify(appNamespaceService, never()).findPublicNamespaceByName(defaultNamespaceName);\n412.     assertNull(result);\n413.     verify(someResponse, times(1)).sendError(eq(HttpServletResponse.SC_NOT_FOUND), anyString());\n414.   }\n415. \n416.   @Test\n417.   public void testQueryConfigForNoAppIdPlaceHolderWithPublicNamespace() throws Exception {\n418.     String someClientSideReleaseKey = "1";\n419.     String someServerSideReleaseKey = "2";\n420.     HttpServletResponse someResponse = mock(HttpServletResponse.class);\n421.     String somePublicAppId = "somePublicAppId";\n422.     AppNamespace somePublicAppNamespace =\n423.         assemblePublicAppNamespace(somePublicAppId, somePublicNamespaceName);\n424.     String appId = ConfigConsts.NO_APPID_PLACEHOLDER;\n425. \n426.     when(appNamespaceService.findPublicNamespaceByName(somePublicNamespaceName))\n427.         .thenReturn(somePublicAppNamespace);\n428.     when(configService.loadConfig(appId, someClientIp, someClientLabel, somePublicAppId, someClusterName, somePublicNamespaceName,\n429.         someDataCenter, someNotificationMessages)).thenReturn(somePublicRelease);\n430.     when(somePublicRelease.getReleaseKey()).thenReturn(someServerSideReleaseKey);\n431.     when(namespaceUtil.normalizeNamespace(appId, somePublicNamespaceName)).thenReturn(somePublicNamespaceName);\n432. \n433.     ApolloConfig result = configController.queryConfig(appId, someClusterName,\n434.         somePublicNamespaceName, someDataCenter, someClientSideReleaseKey,\n435.         someClientIp, someClientLabel, someMessagesAsString, someRequest, someResponse);\n436. \n437.     verify(configService, never()).loadConfig(appId, someClientIp, someClientLabel, appId, someClusterName,\n438.         somePublicNamespaceName, someDataCenter, someNotificationMessages);\n439.     assertEquals(someServerSideReleaseKey, result.getReleaseKey());\n440.     assertEquals(appId, result.getAppId());\n441.     assertEquals(someClusterName, result.getCluster());\n442.     assertEquals(somePublicNamespaceName, result.getNamespaceName());\n443.     assertEquals("foo", result.getConfigurations().get("apollo.public.bar"));\n444.   }\n445. \n446.   @Test\n447.   public void testTransformMessages() throws Exception {\n448.     String someKey = "someKey";\n449.     long someNotificationId = 1;\n450.     String anotherKey = "anotherKey";\n451.     long anotherNotificationId = 2;\n452.     ApolloNotificationMessages notificationMessages = new ApolloNotificationMessages();\n453.     notificationMessages.put(someKey, someNotificationId);\n454.     notificationMessages.put(anotherKey, anotherNotificationId);\n455. \n456.     String someMessagesAsString = gson.toJson(notificationMessages);\n457. \n458.     ApolloNotificationMessages result = configController.transformMessages(someMessagesAsString);\n459. \n460.     assertEquals(notificationMessages.getDetails(), result.getDetails());\n461.   }\n462. \n463.   @Test\n464.   public void testTransformInvalidMessages() throws Exception {\n465.     String someInvalidMessages = "someInvalidMessages";\n466. \n467.     assertNull(configController.transformMessages(someInvalidMessages));\n468.   }\n469. \n470.   private AppNamespace assemblePublicAppNamespace(String appId, String namespace) {\n471.     return assembleAppNamespace(appId, namespace, true);\n472.   }\n473. \n474.   private AppNamespace assembleAppNamespace(String appId, String namespace, boolean isPublic) {\n475.     AppNamespace appNamespace = new AppNamespace();\n476.     appNamespace.setAppId(appId);\n477.     appNamespace.setName(namespace);\n478.     appNamespace.setPublic(isPublic);\n479.     return appNamespace;\n480.   }\n481. }\n\n\nFile: apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java\nLine number range: 1 - 127\nContent:\n1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.configservice.util;\n18. \n19. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\n21. import org.junit.Before;\n22. import org.junit.Test;\n23. import org.junit.runner.RunWith;\n24. import org.mockito.Mock;\n25. import org.mockito.junit.MockitoJUnitRunner;\n26. \n27. import static org.junit.Assert.assertEquals;\n28. import static org.mockito.Mockito.*;\n29. \n30. /**\n31.  * @author Jason Song(song_s@ctrip.com)\n32.  */\n33. @RunWith(MockitoJUnitRunner.class)\n34. public class NamespaceUtilTest {\n35.   private NamespaceUtil namespaceUtil;\n36. \n37.   @Mock\n38.   private AppNamespaceServiceWithCache appNamespaceServiceWithCache;\n39. \n40.   @Before\n41.   public void setUp() throws Exception {\n42.     namespaceUtil = new NamespaceUtil(appNamespaceServiceWithCache);\n43.   }\n44. \n45.   @Test\n46.   public void testFilterNamespaceName() throws Exception {\n47.     String someName = "a.properties";\n48. \n49.     assertEquals("a", namespaceUtil.filterNamespaceName(someName));\n50.   }\n51. \n52.   @Test\n53.   public void testFilterNamespaceNameUnchanged() throws Exception {\n54.     String someName = "a.xml";\n55. \n56.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));\n57.   }\n58. \n59.   @Test\n60.   public void testFilterNamespaceNameWithMultiplePropertiesSuffix() throws Exception {\n61.     String someName = "a.properties.properties";\n62. \n63.     assertEquals("a.properties", namespaceUtil.filterNamespaceName(someName));\n64.   }\n65. \n66.   @Test\n67.   public void testFilterNamespaceNameWithRandomCase() throws Exception {\n68.     String someName = "AbC.ProPErties";\n69. \n70.     assertEquals("AbC", namespaceUtil.filterNamespaceName(someName));\n71.   }\n72. \n73.   @Test\n74.   public void testFilterNamespaceNameWithRandomCaseUnchanged() throws Exception {\n75.     String someName = "AbCD.xMl";\n76. \n77.     assertEquals(someName, namespaceUtil.filterNamespaceName(someName));\n78.   }\n79. \n80.   @Test\n81.   public void testNormalizeNamespaceWithPrivateNamespace() throws Exception {\n82.     String someAppId = "someAppId";\n83.     String someNamespaceName = "someNamespaceName";\n84.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";\n85.     AppNamespace someAppNamespace = mock(AppNamespace.class);\n86. \n87.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);\n88.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn\n89.         (someAppNamespace);\n90. \n91.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));\n92. \n93.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);\n94.     verify(appNamespaceServiceWithCache, never()).findPublicNamespaceByName(someNamespaceName);\n95.   }\n96. \n97.   @Test\n98.   public void testNormalizeNamespaceWithPublicNamespace() throws Exception {\n99.     String someAppId = "someAppId";\n100.     String someNamespaceName = "someNamespaceName";\n101.     String someNormalizedNamespaceName = "someNormalizedNamespaceName";\n102.     AppNamespace someAppNamespace = mock(AppNamespace.class);\n103. \n104.     when(someAppNamespace.getName()).thenReturn(someNormalizedNamespaceName);\n105.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);\n106.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(someAppNamespace);\n107. \n108.     assertEquals(someNormalizedNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));\n109. \n110.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);\n111.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);\n112.   }\n113. \n114.   @Test\n115.   public void testNormalizeNamespaceFailed() throws Exception {\n116.     String someAppId = "someAppId";\n117.     String someNamespaceName = "someNamespaceName";\n118. \n119.     when(appNamespaceServiceWithCache.findByAppIdAndNamespace(someAppId, someNamespaceName)).thenReturn(null);\n120.     when(appNamespaceServiceWithCache.findPublicNamespaceByName(someNamespaceName)).thenReturn(null);\n121. \n122.     assertEquals(someNamespaceName, namespaceUtil.normalizeNamespace(someAppId, someNamespaceName));\n123. \n124.     verify(appNamespaceServiceWithCache, times(1)).findByAppIdAndNamespace(someAppId, someNamespaceName);\n125.     verify(appNamespaceServiceWithCache, times(1)).findPublicNamespaceByName(someNamespaceName);\n126.   }\n127. }\n\n\nFile: apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java\nLine number range: 1 - 61\nContent:\n1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.openapi.v1.controller;\n18. \n19. import com.ctrip.framework.apollo.common.utils.InputValidator;\n20. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;\n21. import com.ctrip.framework.apollo.openapi.auth.ConsumerPermissionValidator;\n22. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;\n23. import org.junit.Assert;\n24. import org.junit.Test;\n25. import org.springframework.beans.factory.annotation.Autowired;\n26. import org.springframework.test.context.ActiveProfiles;\n27. import org.springframework.web.client.HttpClientErrorException;\n28. import static org.hamcrest.Matchers.containsString;\n29. \n30. /**\n31.  * Created by kezhenxu at 2019/1/8 18:17.\n32.  *\n33.  * @author kezhenxu (kezhenxu94@163.com)\n34.  */\n35. @ActiveProfiles("skipAuthorization")\n36. public class NamespaceControllerTest extends AbstractControllerTest {\n37.   @Autowired\n38.   private ConsumerPermissionValidator consumerPermissionValidator;\n39. \n40.   @Test\n41.   public void shouldFailWhenAppNamespaceNameIsInvalid() {\n42.     Assert.assertTrue(consumerPermissionValidator.hasCreateNamespacePermission(null, null));\n43. \n44.     OpenAppNamespaceDTO dto = new OpenAppNamespaceDTO();\n45.     dto.setAppId("appId");\n46.     dto.setName("invalid name");\n47.     dto.setFormat(ConfigFileFormat.Properties.getValue());\n48.     dto.setDataChangeCreatedBy("apollo");\n49.     try {\n50.       restTemplate.postForEntity(\n51.           url("/openapi/v1/apps/{appId}/appnamespaces"),\n52.           dto, OpenAppNamespaceDTO.class, dto.getAppId()\n53.       );\n54.       Assert.fail("should throw");\n55.     } catch (HttpClientErrorException e) {\n56.       String result = e.getResponseBodyAsString();\n57.       Assert.assertThat(result, containsString(InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE));\n58.       Assert.assertThat(result, containsString(InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));\n59.     }\n60.   }\n61. }\n\n\nFile: apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java\nLine number range: 1 - 254\nContent:\n1. /*\n2.  * Copyright 2022 Apollo Authors\n3.  *\n4.  * Licensed under the Apache License, Version 2.0 (the "License");\n5.  * you may not use this file except in compliance with the License.\n6.  * You may obtain a copy of the License at\n7.  *\n8.  * http://www.apache.org/licenses/LICENSE-2.0\n9.  *\n10.  * Unless required by applicable law or agreed to in writing, software\n11.  * distributed under the License is distributed on an "AS IS" BASIS,\n12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n13.  * See the License for the specific language governing permissions and\n14.  * limitations under the License.\n15.  *\n16.  */\n17. package com.ctrip.framework.apollo.portal.service;\n18. \n19. import com.ctrip.framework.apollo.common.dto.ClusterDTO;\n20. import com.ctrip.framework.apollo.common.dto.ItemDTO;\n21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;\n22. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;\n23. import com.ctrip.framework.apollo.common.entity.AppNamespace;\n24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;\n25. import com.ctrip.framework.apollo.portal.component.PortalSettings;\n26. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;\n27. import com.ctrip.framework.apollo.portal.environment.Env;\n28. import com.ctrip.framework.apollo.portal.AbstractUnitTest;\n29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;\n30. import com.ctrip.framework.apollo.portal.component.txtresolver.PropertyResolver;\n31. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;\n32. import com.ctrip.framework.apollo.portal.entity.bo.UserInfo;\n33. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;\n34. \n35. import org.assertj.core.util.Lists;\n36. import org.junit.Before;\n37. import org.junit.Test;\n38. import org.mockito.InjectMocks;\n39. import org.mockito.Mock;\n40. \n41. import java.util.Arrays;\n42. import java.util.Collections;\n43. import java.util.List;\n44. \n45. import static org.assertj.core.api.AssertionsForClassTypes.assertThat;\n46. import static org.assertj.core.api.AssertionsForClassTypes.assertThatExceptionOfType;\n47. import static org.junit.Assert.assertEquals;\n48. import static org.mockito.Mockito.mock;\n49. import static org.mockito.Mockito.times;\n50. import static org.mockito.Mockito.verify;\n51. import static org.mockito.Mockito.when;\n52. \n53. public class NamespaceServiceTest extends AbstractUnitTest {\n54. \n55.   @Mock\n56.   private AdminServiceAPI.NamespaceAPI namespaceAPI;\n57.   @Mock\n58.   private ReleaseService releaseService;\n59.   @Mock\n60.   private ItemService itemService;\n61.   @Mock\n62.   private PropertyResolver resolver;\n63.   @Mock\n64.   private AppNamespaceService appNamespaceService;\n65.   @Mock\n66.   private InstanceService instanceService;\n67.   @Mock\n68.   private NamespaceBranchService branchService;\n69.   @Mock\n70.   private UserInfoHolder userInfoHolder;\n71.   @Mock\n72.   private AdditionalUserInfoEnrichService additionalUserInfoEnrichService;\n73.   @Mock\n74.   private PortalSettings portalSettings;\n75.   @Mock\n76.   private ClusterService clusterService;\n77. \n78.   @InjectMocks\n79.   private NamespaceService namespaceService;\n80. \n81.   private String testAppId = "6666";\n82.   private String testClusterName = "default";\n83.   private String testNamespaceName = "application";\n84.   private Env testEnv = Env.DEV;\n85. \n86.   @Before\n87.   public void setup() {\n88.   }\n89. \n90.   @Test\n91.   public void testFindNamespace() {\n92. \n93.     AppNamespace applicationAppNamespace = mock(AppNamespace.class);\n94.     AppNamespace hermesAppNamespace = mock(AppNamespace.class);\n95. \n96.     NamespaceDTO application = new NamespaceDTO();\n97.     application.setId(1);\n98.     application.setClusterName(testClusterName);\n99.     application.setAppId(testAppId);\n100.     application.setNamespaceName(testNamespaceName);\n101. \n102.     NamespaceDTO hermes = new NamespaceDTO();\n103.     hermes.setId(2);\n104.     hermes.setClusterName("default");\n105.     hermes.setAppId(testAppId);\n106.     hermes.setNamespaceName("hermes");\n107.     List<NamespaceDTO> namespaces = Arrays.asList(application, hermes);\n108. \n109.     ReleaseDTO someRelease = new ReleaseDTO();\n110.     someRelease.setConfigurations("{\\"a\\":\\"123\\",\\"b\\":\\"123\\"}");\n111. \n112.     ItemDTO i1 = new ItemDTO("a", "123", "", 1);\n113.     ItemDTO i2 = new ItemDTO("b", "1", "", 2);\n114.     ItemDTO i3 = new ItemDTO("", "", "#dddd", 3);\n115.     ItemDTO i4 = new ItemDTO("c", "1", "", 4);\n116.     List<ItemDTO> someItems = Arrays.asList(i1, i2, i3, i4);\n117. \n118.     when(applicationAppNamespace.getFormat()).thenReturn(ConfigFileFormat.Properties.getValue());\n119.     when(hermesAppNamespace.getFormat()).thenReturn(ConfigFileFormat.XML.getValue());\n120.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName))\n121.         .thenReturn(applicationAppNamespace);\n122.     when(appNamespaceService.findPublicAppNamespace("hermes")).thenReturn(hermesAppNamespace);\n123.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(namespaces);\n124.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName,\n125.                                           testNamespaceName)).thenReturn(someRelease);\n126.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, "hermes")).thenReturn(someRelease);\n127.     when(itemService.findItems(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(someItems);\n128. \n129.     List<NamespaceBO> namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);\n130.     assertEquals(2, namespaceVOs.size());\n131. \n132.     when(namespaceAPI.findNamespaceByCluster(testAppId, Env.DEV, testClusterName)).thenReturn(Lists.list(application));\n133.     namespaceVOs = namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName);\n134.     assertEquals(1, namespaceVOs.size());\n135.     NamespaceBO namespaceVO = namespaceVOs.get(0);\n136.     assertEquals(4, namespaceVO.getItems().size());\n137.     assertEquals("a", namespaceVO.getItems().get(0).getItem().getKey());\n138.     assertEquals(2, namespaceVO.getItemModifiedCnt());\n139.     assertEquals(testAppId, namespaceVO.getBaseInfo().getAppId());\n140.     assertEquals(testClusterName, namespaceVO.getBaseInfo().getClusterName());\n141.     assertEquals(testNamespaceName, namespaceVO.getBaseInfo().getNamespaceName());\n142. \n143.     ReleaseDTO errorRelease = new ReleaseDTO();\n144.     errorRelease.setConfigurations("\\"a\\":\\"123\\",\\"b\\":\\"123\\"");\n145.     when(releaseService.loadLatestRelease(testAppId, Env.DEV, testClusterName, testNamespaceName)).thenReturn(errorRelease);\n146.     assertThatExceptionOfType(RuntimeException.class)\n147.         .isThrownBy(()-> namespaceService.findNamespaceBOs(testAppId, Env.DEV, testClusterName))\n148.         .withMessageStartingWith("Parse namespaces error, expected: 1, but actual: 0, cannot get those namespaces: [application]");\n149. \n150.   }\n151. \n152.   @Test\n153.   public void testDeletePrivateNamespace() {\n154.     String operator = "user";\n155.     AppNamespace privateNamespace = createAppNamespace(testAppId, testNamespaceName, false);\n156. \n157.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(privateNamespace);\n158. \n159.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));\n160. \n161.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);\n162. \n163.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);\n164.   }\n165. \n166.   @Test\n167.   public void testGetNamespaceUsage() {\n168.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);\n169.     String branchName = "branch";\n170. \n171.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);\n172. \n173.     when(portalSettings.getActiveEnvs()).thenReturn(Lists.newArrayList(testEnv));\n174.     ClusterDTO cluster = new ClusterDTO();\n175.     cluster.setName(testClusterName);\n176.     cluster.setAppId(testAppId);\n177.     when(clusterService.findClusters(testEnv, testAppId)).thenReturn(Lists.newArrayList(cluster));\n178.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);\n179.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))\n180.         .thenReturn(8);\n181.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);\n182.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(9);\n183.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);\n184. \n185.     when(namespaceAPI.countPublicAppNamespaceAssociatedNamespaces(testEnv, testNamespaceName)).thenReturn(10);\n186. \n187.     List<NamespaceUsage> usages = namespaceService.getNamespaceUsageByAppId(testAppId, testNamespaceName);\n188.     assertThat(usages).asList().hasSize(1);\n189.     assertThat(usages.get(0).getInstanceCount()).isEqualTo(8);\n190.     assertThat(usages.get(0).getBranchInstanceCount()).isEqualTo(9);\n191.     assertThat(usages.get(0).getLinkedNamespaceCount()).isEqualTo(10);\n192. \n193.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(testAppId, testNamespaceName, testEnv, testClusterName);\n194.     assertThat(usage).isNotNull();\n195.     assertThat(usage.getInstanceCount()).isEqualTo(8);\n196.     assertThat(usage.getBranchInstanceCount()).isEqualTo(9);\n197.     assertThat(usage.getLinkedNamespaceCount()).isEqualTo(0);\n198.   }\n199. \n200.   @Test\n201.   public void testDeleteEmptyNamespace() {\n202.     String branchName = "branch";\n203.     String operator = "user";\n204. \n205.     AppNamespace publicNamespace = createAppNamespace(testAppId, testNamespaceName, true);\n206.     NamespaceDTO branch = createNamespace(testAppId, branchName, testNamespaceName);\n207. \n208.     when(appNamespaceService.findByAppIdAndName(testAppId, testNamespaceName)).thenReturn(publicNamespace);\n209.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, testClusterName, testNamespaceName))\n210.         .thenReturn(0);\n211.     when(branchService.findBranchBaseInfo(testAppId, testEnv, testClusterName, testNamespaceName)).thenReturn(branch);\n212.     when(instanceService.getInstanceCountByNamespace(testAppId, testEnv, branchName, testNamespaceName)).thenReturn(0);\n213.     when(appNamespaceService.findPublicAppNamespace(testNamespaceName)).thenReturn(publicNamespace);\n214. \n215.     NamespaceDTO namespace = createNamespace(testAppId, testClusterName, testNamespaceName);\n216.     when(namespaceAPI.getPublicAppNamespaceAllNamespaces(testEnv, testNamespaceName, 0, 10)).thenReturn(\n217.         Collections.singletonList(namespace));\n218.     when(userInfoHolder.getUser()).thenReturn(createUser(operator));\n219. \n220.     namespaceService.deleteNamespace(testAppId, testEnv, testClusterName, testNamespaceName);\n221. \n222.     verify(namespaceAPI, times(1)).deleteNamespace(testEnv, testAppId, testClusterName, testNamespaceName, operator);\n223. \n224.   }\n225. \n226. \n227.   private AppNamespace createAppNamespace(String appId, String name, boolean isPublic) {\n228.     AppNamespace instance = new AppNamespace();\n229. \n230.     instance.setAppId(appId);\n231.     instance.setName(name);\n232.     instance.setPublic(isPublic);\n233. \n234.     return instance;\n235.   }\n236. \n237.   private NamespaceDTO createNamespace(String appId, String clusterName, String namespaceName) {\n238.     NamespaceDTO instance = new NamespaceDTO();\n239. \n240.     instance.setAppId(appId);\n241.     instance.setClusterName(clusterName);\n242.     instance.setNamespaceName(namespaceName);\n243. \n244.     return instance;\n245.   }\n246. \n247.   private UserInfo createUser(String userId) {\n248.     UserInfo instance = new UserInfo();\n249. \n250.     instance.setUserId(userId);\n251. \n252.     return instance;\n253.   }\n254. }\n\n\nNow generate the complete self-contained test case that reproduces the bug with the same error/exception.\n' additional_kwargs={} response_metadata={}
2025-11-12 11:39:53,385 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\nimport com.ctrip.framework.apollo.configservice.util.NamespaceUtil;\nimport org.junit.Before;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.mockito.junit.MockitoJUnitRunner;\n\nimport static org.junit.Assert.assertEquals;\n\n@RunWith(MockitoJUnitRunner.class)\npublic class NamespaceUtilSingleDotTest {\n  private NamespaceUtil namespaceUtil;\n\n  @Before\n  public void setUp() throws Exception {\n    // AppNamespaceServiceWithCache is not used in filterNamespaceName, so a null is fine here for minimal setup\n    namespaceUtil = new NamespaceUtil(null);\n  }\n\n  @Test\n  public void testFilterNamespaceNameWithSingleDot() throws Exception {\n    String singleDot = ".";\n    // Creating namespace with a single dot should be handled and not crash during query/filtering\n    assertEquals(singleDot, namespaceUtil.filterNamespaceName(singleDot));\n  }\n}' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 3534, 'prompt_tokens': 14588, 'total_tokens': 18122, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 3328, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--e23bee80-115b-4993-954a-b560775c6cc1-0' usage_metadata={'input_tokens': 14588, 'output_tokens': 3534, 'total_tokens': 18122, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 3328}}
2025-11-12 11:39:56,227 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_eqM06i356NN8zMJoBmHd4Iyo', 'function': {'arguments': '{"relative_path":"apollo/apollo-configservice/src/test/java/com"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 97, 'prompt_tokens': 4696, 'total_tokens': 4793, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--726bbb6c-c150-4d63-adde-9ae654d0cd50-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo/apollo-configservice/src/test/java/com'}, 'id': 'call_eqM06i356NN8zMJoBmHd4Iyo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4696, 'output_tokens': 97, 'total_tokens': 4793, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 11:40:00,959 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_SVnDhbSL62yAz6DBG7Pujvwm', 'function': {'arguments': '{"relative_path":"apollo/apollo-configservice/src/main/java/com"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 289, 'prompt_tokens': 4749, 'total_tokens': 5038, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4c83182f-e3f5-43d7-ae58-acab0100b539-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo/apollo-configservice/src/main/java/com'}, 'id': 'call_SVnDhbSL62yAz6DBG7Pujvwm', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4749, 'output_tokens': 289, 'total_tokens': 5038, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 11:40:15,676 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VjtbOb7LUZaLXDdDZhqV4cag', 'function': {'arguments': '{"relative_path":"apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java","content":"import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\\nimport com.ctrip.framework.apollo.configservice.util.NamespaceUtil;\\nimport org.junit.Before;\\nimport org.junit.Test;\\nimport org.junit.runner.RunWith;\\nimport org.mockito.junit.MockitoJUnitRunner;\\n\\nimport static org.junit.Assert.assertEquals;\\n\\n@RunWith(MockitoJUnitRunner.class)\\npublic class NamespaceUtilSingleDotTest {\\n  private NamespaceUtil namespaceUtil;\\n\\n  @Before\\n  public void setUp() throws Exception {\\n    // AppNamespaceServiceWithCache is not used in filterNamespaceName, so a null is fine here for minimal setup\\n    namespaceUtil = new NamespaceUtil(null);\\n  }\\n\\n  @Test\\n  public void testFilterNamespaceNameWithSingleDot() throws Exception {\\n    String singleDot = \\".\\";\\n    // Creating namespace with a single dot should be handled and not crash during query/filtering\\n    assertEquals(singleDot, namespaceUtil.filterNamespaceName(singleDot));\\n  }\\n}\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1233, 'prompt_tokens': 4802, 'total_tokens': 6035, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--57509aff-6494-4f1f-a2df-24151d60e647-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java', 'content': 'import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;\nimport com.ctrip.framework.apollo.configservice.util.NamespaceUtil;\nimport org.junit.Before;\nimport org.junit.Test;\nimport org.junit.runner.RunWith;\nimport org.mockito.junit.MockitoJUnitRunner;\n\nimport static org.junit.Assert.assertEquals;\n\n@RunWith(MockitoJUnitRunner.class)\npublic class NamespaceUtilSingleDotTest {\n  private NamespaceUtil namespaceUtil;\n\n  @Before\n  public void setUp() throws Exception {\n    // AppNamespaceServiceWithCache is not used in filterNamespaceName, so a null is fine here for minimal setup\n    namespaceUtil = new NamespaceUtil(null);\n  }\n\n  @Test\n  public void testFilterNamespaceNameWithSingleDot() throws Exception {\n    String singleDot = ".";\n    // Creating namespace with a single dot should be handled and not crash during query/filtering\n    assertEquals(singleDot, namespaceUtil.filterNamespaceName(singleDot));\n  }\n}\n'}, 'id': 'call_VjtbOb7LUZaLXDdDZhqV4cag', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4802, 'output_tokens': 1233, 'total_tokens': 6035, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 11:40:17,951 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 5111, 'total_tokens': 5140, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--2e01c830-924e-43fd-afd3-d207a5e6ca48-0' usage_metadata={'input_tokens': 5111, 'output_tokens': 29, 'total_tokens': 5140, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:40:18,077 - thread-135845287823040.prometheus.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java b/apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java
new file mode 100644
index 000000000..afb17baa4
--- /dev/null
+++ b/apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java
@@ -0,0 +1,26 @@
+import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
+import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;
+import org.junit.Before;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.mockito.junit.MockitoJUnitRunner;
+
+import static org.junit.Assert.assertEquals;
+
+@RunWith(MockitoJUnitRunner.class)
+public class NamespaceUtilSingleDotTest {
+  private NamespaceUtil namespaceUtil;
+
+  @Before
+  public void setUp() throws Exception {
+    // AppNamespaceServiceWithCache is not used in filterNamespaceName, so a null is fine here for minimal setup
+    namespaceUtil = new NamespaceUtil(null);
+  }
+
+  @Test
+  public void testFilterNamespaceNameWithSingleDot() throws Exception {
+    String singleDot = ".";
+    // Creating namespace with a single dot should be handled and not crash during query/filtering
+    assertEquals(singleDot, namespaceUtil.filterNamespaceName(singleDot));
+  }
+}

2025-11-12 11:40:18,078 - thread-135845287823040.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-12 11:40:18,115 - thread-135845287823040.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-12 11:40:18,115 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-12 11:40:18,450 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:40:18,450 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 526a93506 Fix Apollo checks the yaml format interface Response Code = 500  (#4567)
[?2004l
2025-11-12 11:40:18,450 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-12 11:40:18,552 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:40:18,552 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing Dockerfile
[?2004l
2025-11-12 11:40:18,553 - thread-135845287823040.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-12 11:40:18,553 - thread-135845287823040.prometheus.docker.base_container - INFO - Creating directory apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util in the container
2025-11-12 11:40:18,553 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util
2025-11-12 11:40:18,655 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:40:18,655 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 mkdir -p apollo/apollo-configservice/src/test/java/com/ctrip/framework/
/apollo/configservice/util
[?2004l
[?2004l
2025-11-12 11:40:18,655 - thread-135845287823040.prometheus.docker.base_container - INFO - Updating apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java in the container
2025-11-12 11:40:18,665 - thread-135845287823040.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-12 11:40:23,576 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_18XnVgVXEx7yKqc23V2VONQp', 'function': {'arguments': '{"command":"ls -la"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 282, 'prompt_tokens': 629, 'total_tokens': 911, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e5cdd88f-8885-4385-b574-4b38ff44fc8e-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la'}, 'id': 'call_18XnVgVXEx7yKqc23V2VONQp', 'type': 'tool_call'}] usage_metadata={'input_tokens': 629, 'output_tokens': 282, 'total_tokens': 911, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 11:40:23,580 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la
2025-11-12 11:40:23,682 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:40:23,682 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 332
drwxr-xr-x 1 root root  4096 Nov 12 11:40 .
drwxr-xr-x 1 root root  4096 Nov 12 11:40 ..
-rw-r--r-- 1 root root 24090 Nov 12 11:29 .flattened-pom.xml
drwxrwxr-x 1 root root  4096 Nov 12 11:40 .git
-rw-r--r-- 1 root root    27 Nov 12 11:40 .gitattributes
drwxrwxr-x 1 root root  4096 Nov 12 11:40 .github
-rw-r--r-- 1 root root   317 Nov 12 11:40 .gitignore
-rw-r--r-- 1 root root  1490 Nov 12 11:40 .licenserc.yaml
drwxrwxr-x 1 root root  4096 Aug 24 21:16 .mvn
-rw-r--r-- 1 root root  3126 Nov 12 11:40 CHANGES.md
-rw-r--r-- 1 root root  3227 Nov 12 11:40 CODE_OF_CONDUCT.md
-rw-r--r-- 1 root root  2332 Nov 12 11:40 CONTRIBUTING.md
-rw-r--r-- 1 root root  6024 Nov 12 11:40 GOVERNANCE.md
-rw-r--r-- 1 root root 11357 Nov 12 11:40 LICENSE
-rw-r--r-- 1 root root 49958 Nov 12 11:40 README.md
-rw-r--r-- 1 root root   598 Nov 12 11:40 SECURITY.md
drwxr-xr-x 3 root root  4096 Nov 12 11:40 apollo
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-adminservice
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-assembly
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-biz
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-buildtools
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-client
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-client-config-data
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-common
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-configservice
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-core
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-mockserver
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-openapi
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-portal
drwxrwxr-x 1 root root  4096 Nov 12 11:40 changes
drwxrwxr-x 1 root root  4096 Aug 24 21:16 doc
drwxrwxr-x 1 root root  4096 Nov 12 11:40 docs
-rwxr-xr-x 1 root root  9113 Nov 12 11:40 mvnw
-rwxr-xr-x 1 root root  5810 Nov 12 11:40 mvnw.cmd
-rw-r--r-- 1 root root 22960 Nov 12 11:40 pom.xml
drwxrwxr-x 1 root root  4096 Nov 12 11:40 scripts
drwxr-xr-x 3 root root  4096 Aug 24 21:16 target
[?2004l
2025-11-12 11:40:29,619 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_FRfSBkEgOheNP8RHpa6Pox7F', 'function': {'arguments': '{"command":"./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 502, 'prompt_tokens': 1588, 'total_tokens': 2090, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 448, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d8ee7b84-dd52-468f-b731-5508cf95214d-0' tool_calls=[{'name': 'run_command', 'args': {'command': './mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test'}, 'id': 'call_FRfSBkEgOheNP8RHpa6Pox7F', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1588, 'output_tokens': 502, 'total_tokens': 2090, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 448}}
2025-11-12 11:40:29,623 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test
2025-11-12 11:40:29,724 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 11:40:29,724 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.co
onfigservice.util.NamespaceUtilSingleDotTest test
[?2004l
./mvnw: line 121: which: command not found
./mvnw: line 149: which: command not found
Error: JAVA_HOME is not defined correctly.
  We cannot execute 
[?2004l
2025-11-12 11:40:36,941 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_8ByDKogJy0MouKkBZcM2LF7W', 'function': {'arguments': '{"command":"apt-get update -y"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 604, 'prompt_tokens': 1738, 'total_tokens': 2342, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--05d69084-56f6-4a00-804b-ba25bc0451a1-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'apt-get update -y'}, 'id': 'call_8ByDKogJy0MouKkBZcM2LF7W', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1738, 'output_tokens': 604, 'total_tokens': 2342, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 11:40:36,945 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: apt-get update -y
2025-11-12 11:40:37,047 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 127
2025-11-12 11:40:37,047 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
bash: apt-get: command not found
[?2004l
2025-11-12 11:40:39,806 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OYjvGfKfwr2qQcZ7pBYSaVjo', 'function': {'arguments': '{"command":"apk update"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 89, 'prompt_tokens': 1792, 'total_tokens': 1881, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6e0fffa4-ca6a-428c-9303-b75c865c340d-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'apk update'}, 'id': 'call_OYjvGfKfwr2qQcZ7pBYSaVjo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1792, 'output_tokens': 89, 'total_tokens': 1881, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 11:40:39,810 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: apk update
2025-11-12 11:40:39,911 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 127
2025-11-12 11:40:39,912 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
bash: apk: command not found
[?2004l
2025-11-12 11:40:41,455 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_s6e6lS93tIsgmPjinrEKCFON', 'function': {'arguments': '{"command":"yum -y update"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 91, 'prompt_tokens': 1842, 'total_tokens': 1933, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--06eb1e44-8aad-411c-a2c5-7ffc151002e3-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'yum -y update'}, 'id': 'call_s6e6lS93tIsgmPjinrEKCFON', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1842, 'output_tokens': 91, 'total_tokens': 1933, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 11:40:41,459 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: yum -y update
2025-11-12 11:40:42,922 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:40:42,922 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Amazon Linux 2023 re     [===                 ] ---  B/s |   0  B     --:-- ETA
Amazon Linux 2023 re100% [====================] 334  B/s | 118  B     00:00 ETA
Amazon Linux 2023 repository                    6.7 kB/s | 3.6 kB     00:00    
Dependencies resolved.
Nothing to do.
Complete!
[?2004l
2025-11-12 11:40:43,967 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_f099SmUfKNsz9z7fU7O1j3yq', 'function': {'arguments': '{"command":"yum -y install java-17-amazon-corretto-devel"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 29, 'prompt_tokens': 1978, 'total_tokens': 2007, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b3a7143e-291c-4430-8d79-df1763df17b7-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'yum -y install java-17-amazon-corretto-devel'}, 'id': 'call_f099SmUfKNsz9z7fU7O1j3yq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1978, 'output_tokens': 29, 'total_tokens': 2007, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:40:43,971 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: yum -y install java-17-amazon-corretto-devel
2025-11-12 11:40:44,465 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:40:44,465 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Last metadata expiration check: 0:00:02 ago on Wed Nov 12 11:40:42 2025.
Package java-17-amazon-corretto-devel-1:17.0.16+8-1.amzn2023.1.x86_64 is already installed.
Dependencies resolved.
Nothing to do.
Complete!
[?2004l
2025-11-12 11:40:45,599 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_P0gZoFIlRpomaZkdDSxnrRsf', 'function': {'arguments': '{"command":"echo $JAVA_HOME; java -version"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 2101, 'total_tokens': 2126, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--eaaf5494-3010-40ba-a382-2533ad2cc5b1-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'echo $JAVA_HOME; java -version'}, 'id': 'call_P0gZoFIlRpomaZkdDSxnrRsf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2101, 'output_tokens': 25, 'total_tokens': 2126, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:40:45,603 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: echo $JAVA_HOME; java -version
2025-11-12 11:40:45,723 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:40:45,723 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l

openjdk version "1.8.0_462"
OpenJDK Runtime Environment Corretto-8.462.08.1 (build 1.8.0_462-b08)
OpenJDK 64-Bit Server VM Corretto-8.462.08.1 (build 25.462-b08, mixed mode)
[?2004l
2025-11-12 11:40:50,590 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_SKJj6Gcs9yIXq3VbJerW9HIl', 'function': {'arguments': '{"command":"ls -la /usr/lib/jvm"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 351, 'prompt_tokens': 2220, 'total_tokens': 2571, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--27961089-5cea-4f97-b0fc-4fec75cf24d5-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la /usr/lib/jvm'}, 'id': 'call_SKJj6Gcs9yIXq3VbJerW9HIl', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2220, 'output_tokens': 351, 'total_tokens': 2571, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 11:40:50,594 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la /usr/lib/jvm
2025-11-12 11:40:50,695 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:40:50,696 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 20
drwxr-xr-x 1 root root 4096 Aug 24 21:16 .
dr-xr-xr-x 1 root root 4096 Aug 24 19:54 ..
lrwxrwxrwx 1 root root   26 Aug 24 19:54 java -> /etc/alternatives/java_sdk
lrwxrwxrwx 1 root root   32 Aug 24 19:54 java-1.8.0 -> /etc/alternatives/java_sdk_1.8.0
lrwxrwxrwx 1 root root   44 Aug 24 21:16 java-1.8.0-amazon-corretto -> /etc/alternatives/java-1.8.0-amazon-corretto
drwxr-xr-x 9 root root 4096 Aug 24 19:54 java-1.8.0-amazon-corretto.x86_64
lrwxrwxrwx 1 root root   40 Aug 24 19:54 java-1.8.0-openjdk -> /etc/alternatives/java_sdk_1.8.0_openjdk
lrwxrwxrwx 1 root root   29 Aug 24 19:54 java-11 -> /etc/alternatives/java_sdk_11
drwxr-xr-x 9 root root 4096 Aug 24 19:54 java-11-amazon-corretto.x86_64
lrwxrwxrwx 1 root root   37 Aug 24 19:54 java-11-openjdk -> /etc/alternatives/java_sdk_11_openjdk
lrwxrwxrwx 1 root root   29 Aug 24 19:54 java-17 -> /etc/alternatives/java_sdk_17
drwxr-xr-x 9 root root 4096 Aug 24 19:54 java-17-amazon-corretto.x86_64
lrwxrwxrwx 1 root root   37 Aug 24 19:54 java-17-openjdk -> /etc/alternatives/java_sdk_17_openjdk
lrwxrwxrwx 1 root root   21 Aug 24 19:54 jre -> /etc/alternatives/jre
lrwxrwxrwx 1 root root   27 Aug 24 19:54 jre-1.8.0 -> /etc/alternatives/jre_1.8.0
lrwxrwxrwx 1 root root   35 Aug 24 19:54 jre-1.8.0-openjdk -> /etc/alternatives/jre_1.8.0_openjdk
lrwxrwxrwx 1 root root   24 Aug 24 19:54 jre-11 -> /etc/alternatives/jre_11
lrwxrwxrwx 1 root root   32 Aug 24 19:54 jre-11-openjdk -> /etc/alternatives/jre_11_openjdk
lrwxrwxrwx 1 root root   24 Aug 24 19:54 jre-17 -> /etc/alternatives/jre_17
lrwxrwxrwx 1 root root   32 Aug 24 19:54 jre-17-openjdk -> /etc/alternatives/jre_17_openjdk
[?2004l
2025-11-12 11:40:57,827 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_mqbpsbvTxxRS5Y4CUsA5VNyG', 'function': {'arguments': '{"command":"JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 604, 'prompt_tokens': 2994, 'total_tokens': 3598, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b588f3b9-17b5-4dc0-b45e-531e1bcbc3a5-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test'}, 'id': 'call_mqbpsbvTxxRS5Y4CUsA5VNyG', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2994, 'output_tokens': 604, 'total_tokens': 3598, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 11:40:57,831 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test
2025-11-12 11:41:00,391 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 11:41:00,391 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm
m/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dt
test=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest tes
st
[?2004l
[[1;31mERROR[m] Failed to execute goal on project [36mapollo-configservice[m: [1;31mCould not resolve dependencies for project com.ctrip.framework.apollo:apollo-configservice:jar:2.1.0-SNAPSHOT: Could not find artifact com.ctrip.framework.apollo:apollo-biz:jar:2.1.0-SNAPSHOT[m -> [1m[Help 1][m
[[1;31mERROR[m] 
[[1;31mERROR[m] To see the full stack trace of the errors, re-run Maven with the [1m-e[m switch.
[[1;31mERROR[m] Re-run Maven using the [1m-X[m switch to enable full debug logging.
[[1;31mERROR[m] 
[[1;31mERROR[m] For more information about the errors and possible solutions, please read the following articles:
[[1;31mERROR[m] [1m[Help 1][m http://cwiki.apache.org/confluence/display/MAVEN/DependencyResolutionException
[?2004l
2025-11-12 11:41:11,273 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_576AjgreJ567TI7SQGQSMbDF', 'function': {'arguments': '{"command":"JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -DskipTests install -pl apollo-configservice -am"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 656, 'prompt_tokens': 3453, 'total_tokens': 4109, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1a7d6cd8-c9d8-4169-8a35-a73424b41c86-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -DskipTests install -pl apollo-configservice -am'}, 'id': 'call_576AjgreJ567TI7SQGQSMbDF', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3453, 'output_tokens': 656, 'total_tokens': 4109, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 11:41:11,277 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -DskipTests install -pl apollo-configservice -am
2025-11-12 11:41:35,358 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:41:35,358 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm
m/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -DskipTests install -pl apol
llo-configservice -am
[?2004l
[?2004l
2025-11-12 11:41:36,750 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1hmKdSpU4tXZjAXaDQgEfb2m', 'function': {'arguments': '{"command":"JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 86, 'prompt_tokens': 3612, 'total_tokens': 3698, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--bcb0a674-5cb9-4f8b-b6ab-b23b7485710b-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test'}, 'id': 'call_1hmKdSpU4tXZjAXaDQgEfb2m', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3612, 'output_tokens': 86, 'total_tokens': 3698, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:41:36,754 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test
2025-11-12 11:41:40,975 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 11:41:40,975 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm
m/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dt
test=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest tes
st
[?2004l
[[1;31mERROR[m] Failed to execute goal [32morg.apache.maven.plugins:maven-surefire-plugin:2.22.2:test[m [1m(default-test)[m on project [36mapollo-configservice[m: [1;31mNo tests were executed!  (Set -DfailIfNoTests=false to ignore this error.)[m -> [1m[Help 1][m
[[1;31mERROR[m] 
[[1;31mERROR[m] To see the full stack trace of the errors, re-run Maven with the [1m-e[m switch.
[[1;31mERROR[m] Re-run Maven using the [1m-X[m switch to enable full debug logging.
[[1;31mERROR[m] 
[[1;31mERROR[m] For more information about the errors and possible solutions, please read the following articles:
[[1;31mERROR[m] [1m[Help 1][m http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
[?2004l
2025-11-12 11:41:47,858 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3DEsN8dt4yTjKfUGCEYWIKaL', 'function': {'arguments': '{"command":"JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=**/NamespaceUtilSingleDotTest.java test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 598, 'prompt_tokens': 4074, 'total_tokens': 4672, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1792}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3c3701f5-17fb-43e5-bfb6-48b94559592a-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=**/NamespaceUtilSingleDotTest.java test'}, 'id': 'call_3DEsN8dt4yTjKfUGCEYWIKaL', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4074, 'output_tokens': 598, 'total_tokens': 4672, 'input_token_details': {'audio': 0, 'cache_read': 1792}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 11:41:47,862 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=**/NamespaceUtilSingleDotTest.java test
2025-11-12 11:41:51,918 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 11:41:51,918 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm
m/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dt
test=**/NamespaceUtilSingleDotTest.java test
[?2004l
[[1;31mERROR[m] Failed to execute goal [32morg.apache.maven.plugins:maven-surefire-plugin:2.22.2:test[m [1m(default-test)[m on project [36mapollo-configservice[m: [1;31mNo tests were executed!  (Set -DfailIfNoTests=false to ignore this error.)[m -> [1m[Help 1][m
[[1;31mERROR[m] 
[[1;31mERROR[m] To see the full stack trace of the errors, re-run Maven with the [1m-e[m switch.
[[1;31mERROR[m] Re-run Maven using the [1m-X[m switch to enable full debug logging.
[[1;31mERROR[m] 
[[1;31mERROR[m] For more information about the errors and possible solutions, please read the following articles:
[[1;31mERROR[m] [1m[Help 1][m http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
[?2004l
2025-11-12 11:41:56,073 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hdMZ2ENi49EcEYT2qiHssXwG', 'function': {'arguments': '{"command":"ls -la apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 301, 'prompt_tokens': 4522, 'total_tokens': 4823, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8891dcc1-2d54-4126-abce-00502e737082-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util'}, 'id': 'call_hdMZ2ENi49EcEYT2qiHssXwG', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4522, 'output_tokens': 301, 'total_tokens': 4823, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 11:41:56,077 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util
2025-11-12 11:41:56,179 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:41:56,179 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo/apollo-configservice/src/test/java/com/ctrip/framework/ap
pollo/configservice/util
[?2004l
total 12
drwxr-xr-x 2 root root 4096 Nov 12 11:40 .
drwxr-xr-x 3 root root 4096 Nov 12 11:40 ..
-rw-r--r-- 1 root root  946 Nov 12 11:40 NamespaceUtilSingleDotTest.java
[?2004l
2025-11-12 11:41:58,976 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_s36ZagUltIRrNpOOSx5wGdGs', 'function': {'arguments': '{"command":"ls -la apollo-configservice"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 158, 'prompt_tokens': 4681, 'total_tokens': 4839, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--edb56cb4-e8e1-4a30-b117-71850da63a0b-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo-configservice'}, 'id': 'call_s36ZagUltIRrNpOOSx5wGdGs', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4681, 'output_tokens': 158, 'total_tokens': 4839, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 11:41:58,980 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo-configservice
2025-11-12 11:41:59,082 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:41:59,082 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 48
drwxrwxr-x 1 root root 4096 Nov 12 11:40 .
drwxr-xr-x 1 root root 4096 Nov 12 11:40 ..
-rw-r--r-- 1 root root 6301 Nov 12 11:41 .flattened-pom.xml
-rw-r--r-- 1 root root 5733 Nov 12 11:40 pom.xml
drwxrwxr-x 1 root root 4096 Aug 24 21:16 src
drwxr-xr-x 1 root root 4096 Nov 12 11:41 target
[?2004l
2025-11-12 11:42:01,755 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_PihDA0MFxePBAG2j1BXHM9J9', 'function': {'arguments': '{"command":"ls -la apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util || true; sed -n \'1,200p\' apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 145, 'prompt_tokens': 4868, 'total_tokens': 5013, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4608}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9a8a31bd-e9a2-4780-9753-1f2f7e66e20a-0' tool_calls=[{'name': 'run_command', 'args': {'command': "ls -la apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util || true; sed -n '1,200p' apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java"}, 'id': 'call_PihDA0MFxePBAG2j1BXHM9J9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4868, 'output_tokens': 145, 'total_tokens': 5013, 'input_token_details': {'audio': 0, 'cache_read': 4608}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 11:42:01,759 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util || true; sed -n '1,200p' apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java
2025-11-12 11:42:01,860 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:42:01,860 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo-configservice/src/test/java/com/ctrip/framework/apollo/co
onfigservice/util || true; sed -n '1,200p' apollo/apollo-configservice/src/test/j
java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.jav
va
[?2004l
total 36
drwxrwxr-x 1 root root 4096 Nov 12 11:40 .
drwxrwxr-x 1 root root 4096 Aug 24 21:16 ..
-rw-r--r-- 1 root root 3497 Nov 12 11:40 AccessKeyUtilTest.java
-rw-r--r-- 1 root root 3819 Nov 12 11:40 InstanceConfigAuditUtilTest.java
-rw-r--r-- 1 root root 4846 Nov 12 11:40 NamespaceUtilTest.java
-rw-r--r-- 1 root root 7596 Nov 12 11:40 WatchKeysUtilTest.java
import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
import com.ctrip.framework.apollo.configservice.util.NamespaceUtil;
import org.junit.Before;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.mockito.junit.MockitoJUnitRunner;

import static org.junit.Assert.assertEquals;

@RunWith(MockitoJUnitRunner.class)
public class NamespaceUtilSingleDotTest {
  private NamespaceUtil namespaceUtil;

  @Before
  public void setUp() throws Exception {
    // AppNamespaceServiceWithCache is not used in filterNamespaceName, so a null is fine here for minimal setup
    namespaceUtil = new NamespaceUtil(null);
  }

  @Test
  public void testFilterNamespaceNameWithSingleDot() throws Exception {
    String singleDot = ".";
    // Creating namespace with a single dot should be handled and not crash during query/filtering
    assertEquals(singleDot, namespaceUtil.filterNamespaceName(singleDot));
  }
}
[?2004l
2025-11-12 11:42:09,723 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ViCJRik9f1LEHvoHlJULtat5', 'function': {'arguments': '{"command":"sed -n \'1,200p\' apollo/pom.xml"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 293, 'prompt_tokens': 5378, 'total_tokens': 5671, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3584}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6619b3ca-e09b-4902-86f2-ecd2b67d1239-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' apollo/pom.xml"}, 'id': 'call_ViCJRik9f1LEHvoHlJULtat5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5378, 'output_tokens': 293, 'total_tokens': 5671, 'input_token_details': {'audio': 0, 'cache_read': 3584}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 11:42:09,728 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' apollo/pom.xml
2025-11-12 11:42:09,829 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 2
2025-11-12 11:42:09,829 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
sed: can't read apollo/pom.xml: No such file or directory
[?2004l
2025-11-12 11:42:20,991 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xumaYmm6ZGqx2YjhfNtPUEt5', 'function': {'arguments': '{"command":"ls -la apollo"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 796, 'prompt_tokens': 5448, 'total_tokens': 6244, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--be4174f7-13a0-4fbb-973b-3f91cf6f73ad-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo'}, 'id': 'call_xumaYmm6ZGqx2YjhfNtPUEt5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5448, 'output_tokens': 796, 'total_tokens': 6244, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 11:42:20,995 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo
2025-11-12 11:42:21,097 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:42:21,097 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 16
drwxr-xr-x 3 root root 4096 Nov 12 11:40 .
drwxr-xr-x 1 root root 4096 Nov 12 11:40 ..
drwxr-xr-x 3 root root 4096 Nov 12 11:40 apollo-configservice
[?2004l
2025-11-12 11:42:26,642 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3NVhtxP6PeWJpqvnEoi0PE4U', 'function': {'arguments': '{"command":"sed -n \'1,200p\' pom.xml"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 418, 'prompt_tokens': 5564, 'total_tokens': 5982, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--81eef23c-299d-4087-a6c1-d4ed13862890-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' pom.xml"}, 'id': 'call_3NVhtxP6PeWJpqvnEoi0PE4U', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5564, 'output_tokens': 418, 'total_tokens': 5982, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 11:42:26,646 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' pom.xml
2025-11-12 11:42:26,748 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:42:26,748 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2022 Apollo Authors
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<groupId>com.ctrip.framework.apollo</groupId>
	<artifactId>apollo</artifactId>
	<version>${revision}</version>
	<name>Apollo</name>
	<packaging>pom</packaging>
	<description>Configuration Center</description>
	<url>https://github.com/apolloconfig/apollo</url>

	<licenses>
		<license>
			<name>Apache License, Version 2.0</name>
			<url>http://www.apache.org/licenses/LICENSE-2.0</url>
		</license>
	</licenses>

	<scm>
		<url>https://github.com/apolloconfig/apollo</url>
		<connection>scm:git:git@github.com:apolloconfig/apollo.git</connection>
		<developerConnection>scm:git:ssh://git@github.com:apolloconfig/apollo.git</developerConnection>
	</scm>

	<ciManagement>
		<system>GitHub Actions</system>
		<url>https://github.com/apolloconfig/apollo/actions</url>
	</ciManagement>

	<issueManagement>
		<system>github</system>
		<url>https://github.com/apolloconfig/apollo/issues</url>
	</issueManagement>

	<developers>
		<developer>
			<id>apollo</id>
			<name>The Apollo Project Contributors</name>
			<email>apollo-config@googlegroups.com</email>
			<url>https://www.apolloconfig.com/</url>
		</developer>
	</developers>

	<properties>
		<revision>2.1.0-SNAPSHOT</revision>
		<java.version>1.8</java.version>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<spring-boot.version>2.6.8</spring-boot.version>
		<spring-cloud.version>2021.0.2</spring-cloud.version>
		<spring-security.version>5.7.3</spring-security.version>
		<jaxb.version>2.3.1</jaxb.version>
		<javax.activation.version>1.1.1</javax.activation.version>
		<javax.mail.version>1.6.2</javax.mail.version>
		<javassist.version>3.23.1-GA</javassist.version>
		<nacos-discovery-api.version>1.4.0</nacos-discovery-api.version>
		<common-lang3.version>3.12.0</common-lang3.version>
		<mysql-connector-java.version>8.0.29</mysql-connector-java.version>
		<cat.client.version>3.1.0</cat.client.version>
		<!-- Plugins Version -->
		<maven-compiler-plugin.version>3.10.1</maven-compiler-plugin.version>
		<maven-surefire-plugin.version>2.22.2</maven-surefire-plugin.version>
		<maven-source-plugin.version>3.2.1</maven-source-plugin.version>
		<maven-jar-plugin.version>3.2.2</maven-jar-plugin.version>
		<maven-war-plugin.version>3.3.2</maven-war-plugin.version>
		<maven-install-plugin.version>2.5.2</maven-install-plugin.version>
		<maven-deploy-plugin.version>2.8.2</maven-deploy-plugin.version>
		<maven-javadoc-plugin.version>3.4.0</maven-javadoc-plugin.version>
		<maven-gpg-plugin.version>3.0.1</maven-gpg-plugin.version>
		<maven-assembly-plugin.version>3.3.0</maven-assembly-plugin.version>
	</properties>

	<modules>
		<module>apollo-buildtools</module>
		<module>apollo-core</module>
		<module>apollo-client</module>
		<module>apollo-client-config-data</module>
		<module>apollo-common</module>
		<module>apollo-biz</module>
		<module>apollo-configservice</module>
		<module>apollo-adminservice</module>
		<module>apollo-portal</module>
		<module>apollo-assembly</module>
		<module>apollo-mockserver</module>
		<module>apollo-openapi</module>
	</modules>

	<dependencyManagement>
		<dependencies>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-core</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-client</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-common</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-biz</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-buildtools</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-configservice</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-adminservice</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-portal</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-openapi</artifactId>
				<version>${project.version}</version>
			</dependency>
			<!--third party -->
			<dependency>
				<groupId>org.slf4j</groupId>
				<artifactId>slf4j-api</artifactId>
				<version>1.7.21</version>
			</dependency>
			<dependency>
				<groupId>com.google.guava</groupId>
				<artifactId>guava</artifactId>
				<version>31.0.1-jre</version>
			</dependency>
			<dependency>
				<groupId>com.google.code.gson</groupId>
				<artifactId>gson</artifactId>
				<version>2.8.9</version>
			</dependency>
			<dependency>
				<groupId>mysql</groupId>
				<artifactId>mysql-connector-java</artifactId>
				<version>${mysql-connector-java.version}</version>
			</dependency>
			<dependency>
				<groupId>com.google.inject</groupId>
				<artifactId>guice</artifactId>
				<version>5.0.1</version>
			</dependency>
			<dependency>
				<groupId>org.apache.commons</groupId>
				<artifactId>commons-lang3</artifactId>
				<version>${common-lang3.version}</version>
			</dependency>
			<dependency>
				<groupId>com.dianping.cat</groupId>
				<artifactId>cat-client</artifactId>
				<version>${cat.client.version}</version>
			</dependency>
			<!-- to fix CVE-2020-26217 -->
			<dependency>
				<groupId>com.thoughtworks.xstream</groupId>
				<artifactId>xstream</artifactId>
				<version>1.4.19</version>
			</dependency>
			<!--for test -->
			<dependency>
				<groupId>com.h2database</groupId>
				<artifactId>h2</artifactId>
				<version>1.4.191</version>
				<scope>test</scope>
			</dependency>
[?2004l
2025-11-12 11:42:28,288 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zewuOKN93AYH4m3r8KLTMLpq', 'function': {'arguments': '{"command":"JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest -pl apollo -am test"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 86, 'prompt_tokens': 7777, 'total_tokens': 7863, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4864}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9120816a-4ef5-4349-9aed-a8e47bfdaed2-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest -pl apollo -am test'}, 'id': 'call_zewuOKN93AYH4m3r8KLTMLpq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7777, 'output_tokens': 86, 'total_tokens': 7863, 'input_token_details': {'audio': 0, 'cache_read': 4864}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:42:28,291 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest -pl apollo -am test
2025-11-12 11:42:30,323 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 11:42:30,323 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm
m/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -Dtest=com.ctrip.framework.a
apollo.configservice.util.NamespaceUtilSingleDotTest -pl apollo -am test
[?2004l
[[1;31mERROR[m] [ERROR] Could not find the selected project in the reactor: apollo @ 
[[1;31mERROR[m] Could not find the selected project in the reactor: apollo -> [1m[Help 1][m
[[1;31mERROR[m] 
[[1;31mERROR[m] To see the full stack trace of the errors, re-run Maven with the [1m-e[m switch.
[[1;31mERROR[m] Re-run Maven using the [1m-X[m switch to enable full debug logging.
[[1;31mERROR[m] 
[[1;31mERROR[m] For more information about the errors and possible solutions, please read the following articles:
[[1;31mERROR[m] [1m[Help 1][m http://cwiki.apache.org/confluence/display/MAVEN/MavenExecutionException
[?2004l
2025-11-12 11:42:39,336 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_q25WTXIia0OWjsH2Q3rSALHu', 'function': {'arguments': '{"command":"ls -la apollo/apollo-configservice"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 736, 'prompt_tokens': 8194, 'total_tokens': 8930, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3968}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4183df6d-7a01-4928-8c0e-99a72afd168c-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo/apollo-configservice'}, 'id': 'call_q25WTXIia0OWjsH2Q3rSALHu', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8194, 'output_tokens': 736, 'total_tokens': 8930, 'input_token_details': {'audio': 0, 'cache_read': 3968}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-12 11:42:39,340 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo/apollo-configservice
2025-11-12 11:42:39,442 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:42:39,442 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 12
drwxr-xr-x 3 root root 4096 Nov 12 11:40 .
drwxr-xr-x 3 root root 4096 Nov 12 11:40 ..
drwxr-xr-x 3 root root 4096 Nov 12 11:40 src
[?2004l
2025-11-12 11:42:44,436 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_XUqHO1hHXGkSjDpHeq27JmmW', 'function': {'arguments': '{"command":"ls -la apollo/apollo-configservice; sed -n \'1,200p\' apollo/apollo-configservice/pom.xml"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 307, 'prompt_tokens': 8311, 'total_tokens': 8618, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1536}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--16618076-98b4-423c-b171-f896b49f0d4d-0' tool_calls=[{'name': 'run_command', 'args': {'command': "ls -la apollo/apollo-configservice; sed -n '1,200p' apollo/apollo-configservice/pom.xml"}, 'id': 'call_XUqHO1hHXGkSjDpHeq27JmmW', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8311, 'output_tokens': 307, 'total_tokens': 8618, 'input_token_details': {'audio': 0, 'cache_read': 1536}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 11:42:44,440 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo/apollo-configservice; sed -n '1,200p' apollo/apollo-configservice/pom.xml
2025-11-12 11:42:44,541 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 2
2025-11-12 11:42:44,541 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo/apollo-configservice; sed -n '1,200p' apollo/apollo-confi
igservice/pom.xml
[?2004l
total 12
drwxr-xr-x 3 root root 4096 Nov 12 11:40 .
drwxr-xr-x 3 root root 4096 Nov 12 11:40 ..
drwxr-xr-x 3 root root 4096 Nov 12 11:40 src
sed: can't read apollo/apollo-configservice/pom.xml: No such file or directory
[?2004l
2025-11-12 11:42:49,745 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_lXFol2LyE6gul22f2mtM1E5R', 'function': {'arguments': '{"command":"ls -la apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util; sed -n \'1,200p\' apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 458, 'prompt_tokens': 8499, 'total_tokens': 8957, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 5376}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0773e0c8-1317-4db9-adce-719a65b63c67-0' tool_calls=[{'name': 'run_command', 'args': {'command': "ls -la apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util; sed -n '1,200p' apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java"}, 'id': 'call_lXFol2LyE6gul22f2mtM1E5R', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8499, 'output_tokens': 458, 'total_tokens': 8957, 'input_token_details': {'audio': 0, 'cache_read': 5376}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 11:42:49,749 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util; sed -n '1,200p' apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java
2025-11-12 11:42:49,850 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:42:49,851 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo-configservice/src/main/java/com/ctrip/framework/apollo/co
onfigservice/util; sed -n '1,200p' apollo-configservice/src/main/java/com/ctrip/f
framework/apollo/configservice/util/NamespaceUtil.java
[?2004l
total 40
drwxrwxr-x 1 root root  4096 Nov 12 11:40 .
drwxrwxr-x 1 root root  4096 Nov 12 11:40 ..
-rw-r--r-- 1 root root  2873 Nov 12 11:40 AccessKeyUtil.java
-rw-r--r-- 1 root root 10852 Nov 12 11:40 InstanceConfigAuditUtil.java
-rw-r--r-- 1 root root  1901 Nov 12 11:40 NamespaceUtil.java
-rw-r--r-- 1 root root  6225 Nov 12 11:40 WatchKeysUtil.java
/*
 * Copyright 2022 Apollo Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
package com.ctrip.framework.apollo.configservice.util;

import com.ctrip.framework.apollo.common.entity.AppNamespace;
import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
import org.springframework.stereotype.Component;

/**
 * @author Jason Song(song_s@ctrip.com)
 */
@Component
public class NamespaceUtil {

  private final AppNamespaceServiceWithCache appNamespaceServiceWithCache;

  public NamespaceUtil(final AppNamespaceServiceWithCache appNamespaceServiceWithCache) {
    this.appNamespaceServiceWithCache = appNamespaceServiceWithCache;
  }

  public String filterNamespaceName(String namespaceName) {
    if (namespaceName.toLowerCase().endsWith(".properties")) {
      int dotIndex = namespaceName.lastIndexOf(".");
      return namespaceName.substring(0, dotIndex);
    }

    return namespaceName;
  }

  public String normalizeNamespace(String appId, String namespaceName) {
    AppNamespace appNamespace = appNamespaceServiceWithCache.findByAppIdAndNamespace(appId, namespaceName);
    if (appNamespace != null) {
      return appNamespace.getName();
    }

    appNamespace = appNamespaceServiceWithCache.findPublicNamespaceByName(namespaceName);
    if (appNamespace != null) {
      return appNamespace.getName();
    }

    return namespaceName;
  }
}
[?2004l
2025-11-12 11:43:08,448 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_vmdTouWtf2Og7M58BbC9ZKEQ', 'function': {'arguments': '{"command":"ls -la apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/service"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1451, 'prompt_tokens': 9199, 'total_tokens': 10650, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1408, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1664}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a606ef08-0abf-41e3-b9bc-4d4d3a7d29d8-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/service'}, 'id': 'call_vmdTouWtf2Og7M58BbC9ZKEQ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9199, 'output_tokens': 1451, 'total_tokens': 10650, 'input_token_details': {'audio': 0, 'cache_read': 1664}, 'output_token_details': {'audio': 0, 'reasoning': 1408}}
2025-11-12 11:43:08,451 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/service
2025-11-12 11:43:08,553 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:43:08,553 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo-configservice/src/main/java/com/ctrip/framework/apollo/co
onfigservice/service
[?2004l
total 48
drwxrwxr-x 1 root root  4096 Nov 12 11:40 .
drwxrwxr-x 1 root root  4096 Nov 12 11:40 ..
-rw-r--r-- 1 root root  8165 Nov 12 11:40 AccessKeyServiceWithCache.java
-rw-r--r-- 1 root root 11235 Nov 12 11:40 AppNamespaceServiceWithCache.java
-rw-r--r-- 1 root root  6966 Nov 12 11:40 ReleaseMessageServiceWithCache.java
drwxrwxr-x 1 root root  4096 Nov 12 11:40 config
[?2004l
2025-11-12 11:43:21,550 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_nDByhEhi98Zc99d4cRWYLsZT', 'function': {'arguments': '{"command":"sed -n \'1,200p\' apollo-configservice/pom.xml"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1127, 'prompt_tokens': 9437, 'total_tokens': 10564, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1088, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 7808}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c9bbf76b-1c5c-44c1-84d3-2bd2f697e79f-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' apollo-configservice/pom.xml"}, 'id': 'call_nDByhEhi98Zc99d4cRWYLsZT', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9437, 'output_tokens': 1127, 'total_tokens': 10564, 'input_token_details': {'audio': 0, 'cache_read': 7808}, 'output_token_details': {'audio': 0, 'reasoning': 1088}}
2025-11-12 11:43:21,554 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' apollo-configservice/pom.xml
2025-11-12 11:43:21,656 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:43:21,656 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
<?xml version="1.0"  encoding="UTF-8"?>
<!--
  ~ Copyright 2022 Apollo Authors
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<parent>
		<groupId>com.ctrip.framework.apollo</groupId>
		<artifactId>apollo</artifactId>
		<version>${revision}</version>
		<relativePath>../pom.xml</relativePath>
	</parent>
	<modelVersion>4.0.0</modelVersion>
	<artifactId>apollo-configservice</artifactId>
	<name>Apollo ConfigService</name>
	<properties>
		<github.path>${project.artifactId}</github.path>
	</properties>
	<dependencies>
		<!-- apollo -->
		<dependency>
			<groupId>com.ctrip.framework.apollo</groupId>
			<artifactId>apollo-biz</artifactId>
		</dependency>
		<!-- end of apollo -->
		<!-- eureka -->
		<dependency>
			<groupId>org.springframework.cloud</groupId>
			<artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
			<exclusions>
				<exclusion>
					<artifactId>spring-cloud-starter-netflix-archaius</artifactId>
					<groupId>org.springframework.cloud</groupId>
				</exclusion>
				<exclusion>
					<artifactId>spring-cloud-starter-netflix-ribbon</artifactId>
					<groupId>org.springframework.cloud</groupId>
				</exclusion>
				<exclusion>
					<artifactId>ribbon-eureka</artifactId>
					<groupId>com.netflix.ribbon</groupId>
				</exclusion>
				<exclusion>
					<artifactId>aws-java-sdk-core</artifactId>
					<groupId>com.amazonaws</groupId>
				</exclusion>
				<exclusion>
					<artifactId>aws-java-sdk-ec2</artifactId>
					<groupId>com.amazonaws</groupId>
				</exclusion>
				<exclusion>
					<artifactId>aws-java-sdk-autoscaling</artifactId>
					<groupId>com.amazonaws</groupId>
				</exclusion>
				<exclusion>
					<artifactId>aws-java-sdk-sts</artifactId>
					<groupId>com.amazonaws</groupId>
				</exclusion>
				<exclusion>
					<artifactId>aws-java-sdk-route53</artifactId>
					<groupId>com.amazonaws</groupId>
				</exclusion>
				<!-- duplicated with spring-security-core -->
				<exclusion>
					<groupId>org.springframework.security</groupId>
					<artifactId>spring-security-crypto</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>com.sun.jersey.contribs</groupId>
			<artifactId>jersey-apache-client4</artifactId>
		</dependency>
		<!-- end of eureka -->
		<dependency>
			<groupId>com.alibaba.nacos</groupId>
			<artifactId>nacos-api</artifactId>
			<version>${nacos-discovery-api.version}</version>
		</dependency>
		<dependency>
			<groupId>com.h2database</groupId>
			<artifactId>h2</artifactId>
			<scope>test</scope>
		</dependency>
		<!-- JDK 1.8+ -->
		<dependency>
			<groupId>javax.xml.bind</groupId>
			<artifactId>jaxb-api</artifactId>
		</dependency>
		<dependency>
			<groupId>com.sun.xml.bind</groupId>
			<artifactId>jaxb-impl</artifactId>
		</dependency>
		<dependency>
			<groupId>org.glassfish.jaxb</groupId>
			<artifactId>jaxb-runtime</artifactId>
		</dependency>
		<dependency>
			<groupId>javax.activation</groupId>
			<artifactId>activation</artifactId>
		</dependency>
		<!-- end of JDK 1.8+ -->
		<!-- JDK 11+ -->
		<dependency>
			<groupId>org.javassist</groupId>
			<artifactId>javassist</artifactId>
		</dependency>
		<!-- end of JDK 11+ -->
	</dependencies>
	<build>
		<plugins>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
			</plugin>
			<plugin>
				<artifactId>maven-assembly-plugin</artifactId>
				<executions>
					<execution>
						<phase>package</phase>
						<goals>
							<goal>single</goal>
						</goals>
						<configuration>
							<finalName>${project.artifactId}-${project.version}-${package.environment}</finalName>
							<appendAssemblyId>false</appendAssemblyId>
							<descriptors>
								<descriptor>src/assembly/assembly-descriptor.xml</descriptor>
							</descriptors>
						</configuration>
					</execution>
				</executions>
			</plugin>
			<plugin>
				<groupId>com.spotify</groupId>
				<artifactId>docker-maven-plugin</artifactId>
				<version>1.2.2</version>
				<configuration>
					<imageName>apolloconfig/${project.artifactId}</imageName>
					<imageTags>
						<imageTag>${project.version}</imageTag>
						<imageTag>latest</imageTag>
					</imageTags>
					<dockerDirectory>${project.basedir}/src/main/docker</dockerDirectory>
					<serverId>docker-hub</serverId>
					<buildArgs>
						<VERSION>${project.version}</VERSION>
					</buildArgs>
					<resources>
						<resource>
							<targetPath>/</targetPath>
							<directory>${project.build.directory}</directory>
							<include>*.zip</include>
						</resource>
					</resources>
				</configuration>
			</plugin>
		</plugins>
	</build>

	<profiles>
		<profile>
			<id>nacos-discovery</id>
			<dependencies>
				<dependency>
					<groupId>com.alibaba.boot</groupId>
					<artifactId>nacos-discovery-spring-boot-starter</artifactId>
				</dependency>
				<dependency>
					<groupId>com.alibaba</groupId>
					<artifactId>fastjson</artifactId>
				</dependency>
			</dependencies>
		</profile>
	</profiles>

</project>
[?2004l
2025-11-12 11:43:37,359 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_9UNR84Zf8VrajarsnWhDCutd', 'function': {'arguments': '{"command":"grep -R \\"junit\\" -n pom.xml apollo-configservice/pom.xml apollo-biz/pom.xml apollo-common/pom.xml apollo-core/pom.xml | sed -n \'1,200p\'"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1286, 'prompt_tokens': 11251, 'total_tokens': 12537, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1216, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 9344}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b7e1cdaa-7e56-4e6d-a8cf-fbee9e7c1c38-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'grep -R "junit" -n pom.xml apollo-configservice/pom.xml apollo-biz/pom.xml apollo-common/pom.xml apollo-core/pom.xml | sed -n \'1,200p\''}, 'id': 'call_9UNR84Zf8VrajarsnWhDCutd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11251, 'output_tokens': 1286, 'total_tokens': 12537, 'input_token_details': {'audio': 0, 'cache_read': 9344}, 'output_token_details': {'audio': 0, 'reasoning': 1216}}
2025-11-12 11:43:37,362 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: grep -R "junit" -n pom.xml apollo-configservice/pom.xml apollo-biz/pom.xml apollo-common/pom.xml apollo-core/pom.xml | sed -n '1,200p'
2025-11-12 11:43:37,481 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:43:37,481 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 grep -R "junit" -n pom.xml apollo-configservice/pom.xml apollo-biz/pom.
.xml apollo-common/pom.xml apollo-core/pom.xml | sed -n '1,200p'
[?2004l
pom.xml:208:				<groupId>org.junit.vintage</groupId>
pom.xml:209:				<artifactId>junit-vintage-engine</artifactId>
pom.xml:301:		<!-- for junit 4 -->
pom.xml:303:			<groupId>org.junit.vintage</groupId>
pom.xml:304:			<artifactId>junit-vintage-engine</artifactId>
[?2004l
2025-11-12 11:43:50,498 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ltBi74IJpYce38dhQAv3ib3F', 'function': {'arguments': '{"command":"ls -la apollo-configservice/target"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1056, 'prompt_tokens': 11477, 'total_tokens': 12533, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1024, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 11136}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--66a1d2d5-610e-42e3-bb1a-346ef3e381e4-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo-configservice/target'}, 'id': 'call_ltBi74IJpYce38dhQAv3ib3F', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11477, 'output_tokens': 1056, 'total_tokens': 12533, 'input_token_details': {'audio': 0, 'cache_read': 11136}, 'output_token_details': {'audio': 0, 'reasoning': 1024}}
2025-11-12 11:43:50,501 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo-configservice/target
2025-11-12 11:43:50,603 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:43:50,603 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 156872
drwxr-xr-x 1 root root     4096 Nov 12 11:41 .
drwxrwxr-x 1 root root     4096 Nov 12 11:40 ..
-rw-r--r-- 1 root root 75616177 Nov 12 11:41 apollo-configservice-2.1.0-SNAPSHOT-github.zip
-rw-r--r-- 1 root root    64129 Nov 12 11:41 apollo-configservice-2.1.0-SNAPSHOT-sources.jar
-rwxr--r-- 1 root root 84785688 Nov 12 11:41 apollo-configservice-2.1.0-SNAPSHOT.jar
-rw-r--r-- 1 root root    95116 Nov 12 11:41 apollo-configservice-2.1.0-SNAPSHOT.jar.original
drwxr-xr-x 2 root root     4096 Nov 12 11:41 archive-tmp
drwxr-xr-x 1 root root     4096 Aug 24 21:16 classes
drwxr-xr-x 3 root root     4096 Aug 24 21:16 generated-sources
drwxr-xr-x 3 root root     4096 Aug 24 21:16 generated-test-sources
drwxr-xr-x 2 root root     4096 Nov 12 11:41 maven-archiver
drwxr-xr-x 1 root root     4096 Aug 24 21:16 maven-status
drwxr-xr-x 4 root root     4096 Aug 24 21:16 site
drwxr-xr-x 2 root root     4096 Nov 12 11:29 surefire-reports
drwxr-xr-x 1 root root     4096 Aug 24 21:16 test-classes
[?2004l
2025-11-12 11:43:59,622 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_uvqfyV0kwawgQuryPzGFIpWA', 'function': {'arguments': '{"command":"ls -la apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java || true; sed -n \'1,200p\' apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java || true"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 600, 'prompt_tokens': 11946, 'total_tokens': 12546, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 8192}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--56f5d743-5fb1-4284-9575-57829fde6238-0' tool_calls=[{'name': 'run_command', 'args': {'command': "ls -la apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java || true; sed -n '1,200p' apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java || true"}, 'id': 'call_uvqfyV0kwawgQuryPzGFIpWA', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11946, 'output_tokens': 600, 'total_tokens': 12546, 'input_token_details': {'audio': 0, 'cache_read': 8192}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 11:43:59,627 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java || true; sed -n '1,200p' apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java || true
2025-11-12 11:43:59,728 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:43:59,728 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo-configservice/src/test/java/com/ctrip/framework/apollo/co
onfigservice/util/NamespaceUtilSingleDotTest.java || true; sed -n '1,200p' apollo
o-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/Names
spaceUtilSingleDotTest.java || true
[?2004l
ls: cannot access 'apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java': No such file or directory
sed: can't read apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java: No such file or directory
[?2004l
2025-11-12 11:44:10,801 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3nvjt9cwfnYtqlQIrwgUPH3l', 'function': {'arguments': '{"command":"grep -R \\"mockito\\" -n"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 672, 'prompt_tokens': 12194, 'total_tokens': 12866, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--fc68ca95-dcd0-4ec3-b599-654016eb7be0-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'grep -R "mockito" -n'}, 'id': 'call_3nvjt9cwfnYtqlQIrwgUPH3l', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12194, 'output_tokens': 672, 'total_tokens': 12866, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-12 11:44:10,805 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: grep -R "mockito" -n
2025-11-12 11:44:11,107 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:44:11,107 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
grep: .git/objects/pack/pack-d1a27b079990f2e406e2d816672110117d014f96.pack: binary file matches
apollo-portal/src/test/java/com/ctrip/framework/apollo/SkipAuthorizationConfiguration.java:26:import static org.mockito.ArgumentMatchers.any;
apollo-portal/src/test/java/com/ctrip/framework/apollo/SkipAuthorizationConfiguration.java:27:import static org.mockito.Mockito.mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/SkipAuthorizationConfiguration.java:28:import static org.mockito.Mockito.when;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/UserInfoControllerTest.java:27:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/UserInfoControllerTest.java:28:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/UserInfoControllerTest.java:29:import org.mockito.Mockito;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/UserInfoControllerTest.java:30:import org.mockito.junit.MockitoJUnitRunner;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/SearchControllerTest.java:33:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/SearchControllerTest.java:34:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/SearchControllerTest.java:35:import org.mockito.junit.MockitoJUnitRunner;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/SearchControllerTest.java:42:import static org.mockito.ArgumentMatchers.any;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/SearchControllerTest.java:43:import static org.mockito.Mockito.times;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/SearchControllerTest.java:44:import static org.mockito.Mockito.verify;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/SearchControllerTest.java:45:import static org.mockito.Mockito.when;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/ItemControllerTest.java:33:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/ItemControllerTest.java:34:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/ItemControllerTest.java:35:import org.mockito.junit.MockitoJUnitRunner;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/ServiceExceptionTest.java:31:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/ServiceExceptionTest.java:32:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/ServiceExceptionTest.java:37:import static org.mockito.ArgumentMatchers.any;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/ServiceExceptionTest.java:38:import static org.mockito.Mockito.when;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:23:import static org.mockito.ArgumentMatchers.any;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:24:import static org.mockito.ArgumentMatchers.eq;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:25:import static org.mockito.ArgumentMatchers.isNull;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:26:import static org.mockito.Mockito.mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:27:import static org.mockito.Mockito.never;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:28:import static org.mockito.Mockito.times;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:29:import static org.mockito.Mockito.verify;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:30:import static org.mockito.Mockito.when;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:51:import org.mockito.ArgumentCaptor;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:52:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.java:53:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java:38:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java:39:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java:48:import static org.mockito.Mockito.mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java:49:import static org.mockito.Mockito.times;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java:50:import static org.mockito.Mockito.verify;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.java:51:import static org.mockito.Mockito.when;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigsExportServiceTest.java:35:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigsExportServiceTest.java:36:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigsExportServiceTest.java:49:import static org.mockito.ArgumentMatchers.any;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigsExportServiceTest.java:50:import static org.mockito.ArgumentMatchers.anyString;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigsExportServiceTest.java:51:import static org.mockito.Mockito.times;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigsExportServiceTest.java:52:import static org.mockito.Mockito.verify;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigsExportServiceTest.java:53:import static org.mockito.Mockito.when;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigServiceTest.java:39:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigServiceTest.java:40:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigServiceTest.java:47:import static org.mockito.Mockito.mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/service/ConfigServiceTest.java:48:import static org.mockito.Mockito.when;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/environment/DatabasePortalMetaServerProviderTest.java:27:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/environment/DatabasePortalMetaServerProviderTest.java:28:import org.mockito.Mockito;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/environment/DatabasePortalMetaServerProviderTest.java:29:import org.mockito.MockitoAnnotations;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/environment/DatabasePortalMetaServerProviderTest.java:30:import org.mockito.junit.MockitoJUnitRunner;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/environment/PortalMetaDomainServiceTest.java:29:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/environment/PortalMetaDomainServiceTest.java:30:import org.mockito.Mockito;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/environment/PortalMetaDomainServiceTest.java:31:import org.mockito.junit.MockitoJUnitRunner;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/spi/defaultImpl/RoleInitializationServiceTest.java:33:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/spi/defaultImpl/RoleInitializationServiceTest.java:34:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/spi/defaultImpl/RoleInitializationServiceTest.java:39:import static org.mockito.Mockito.*;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/config/ConfigTest.java:25:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/config/ConfigTest.java:26:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/config/ConfigTest.java:29:import static org.mockito.Mockito.when;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/util/AuthUserPasswordCheckerTest.java:31:import org.mockito.Mockito;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/component/txtresolver/PropertyResolverTest.java:27:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/component/txtresolver/FileTextResolverTest.java:26:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/AbstractUnitTest.java:20:import org.mockito.junit.MockitoJUnitRunner;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/filter/ConsumerAuthenticationFilterTest.java:25:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/filter/ConsumerAuthenticationFilterTest.java:26:import org.mockito.junit.MockitoJUnitRunner;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/filter/ConsumerAuthenticationFilterTest.java:33:import static org.mockito.ArgumentMatchers.anyLong;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/filter/ConsumerAuthenticationFilterTest.java:34:import static org.mockito.ArgumentMatchers.anyString;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/filter/ConsumerAuthenticationFilterTest.java:35:import static org.mockito.ArgumentMatchers.eq;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/filter/ConsumerAuthenticationFilterTest.java:36:import static org.mockito.Mockito.never;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/filter/ConsumerAuthenticationFilterTest.java:37:import static org.mockito.Mockito.times;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/filter/ConsumerAuthenticationFilterTest.java:38:import static org.mockito.Mockito.verify;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/filter/ConsumerAuthenticationFilterTest.java:39:import static org.mockito.Mockito.when;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/service/ConsumerServiceTest.java:36:import org.mockito.InjectMocks;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/service/ConsumerServiceTest.java:37:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/service/ConsumerServiceTest.java:38:import org.mockito.Spy;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/service/ConsumerServiceTest.java:47:import static org.mockito.Mockito.*;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/AppControllerTest.java:47:import org.mockito.ArgumentCaptor;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/AppControllerTest.java:48:import org.mockito.Mockito;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/AppControllerTest.java:51:import org.springframework.boot.test.mock.mockito.MockBean;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/util/ConsumerAuthUtilTest.java:23:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/util/ConsumerAuthUtilTest.java:24:import org.mockito.junit.MockitoJUnitRunner;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/util/ConsumerAuthUtilTest.java:29:import static org.mockito.Mockito.*;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/util/ConsumerAuditUtilTest.java:26:import org.mockito.Mock;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/util/ConsumerAuditUtilTest.java:27:import org.mockito.junit.MockitoJUnitRunner;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/util/ConsumerAuditUtilTest.java:28:import org.mockito.stubbing.Answer;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/util/ConsumerAuditUtilTest.java:36:import static org.mockito.ArgumentMatchers.anyCollection;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/util/ConsumerAuditUtilTest.java:37:import static org.mockito.Mockito.doAnswer;
apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/util/ConsumerAuditUtilTest.java:38:import static org.mockito.Mockito.when;
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/SkipAuthorizationConfiguration.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/controller/UserInfoControllerTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/controller/SearchControllerTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/controller/ItemControllerTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/service/ConfigsExportServiceTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/service/ConfigServiceTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/service/NamespaceServiceTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/environment/PortalMetaDomainServiceTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/environment/DatabasePortalMetaServerProviderTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/spi/defaultImpl/RoleInitializationServiceTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/config/ConfigTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/ServiceExceptionTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/RetryableRestTemplateTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/util/AuthUserPasswordCheckerTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/component/txtresolver/PropertyResolverTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/component/txtresolver/FileTextResolverTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/portal/AbstractUnitTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/openapi/filter/ConsumerAuthenticationFilterTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/openapi/service/ConsumerServiceTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/openapi/v1/controller/AppControllerTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/openapi/util/ConsumerAuthUtilTest.class: binary file matches
grep: apollo-portal/target/test-classes/com/ctrip/framework/apollo/openapi/util/ConsumerAuditUtilTest.class: binary file matches
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/InstanceConfigControllerTest.java:33:import org.mockito.Mock;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/InstanceConfigControllerTest.java:34:import org.mockito.junit.MockitoJUnitRunner;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/InstanceConfigControllerTest.java:46:import static org.mockito.ArgumentMatchers.any;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/InstanceConfigControllerTest.java:47:import static org.mockito.ArgumentMatchers.eq;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/InstanceConfigControllerTest.java:48:import static org.mockito.Mockito.mock;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/InstanceConfigControllerTest.java:49:import static org.mockito.Mockito.when;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ControllerExceptionTest.java:29:import org.mockito.Mock;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ControllerExceptionTest.java:30:import org.mockito.junit.MockitoJUnitRunner;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ControllerExceptionTest.java:37:import static org.mockito.ArgumentMatchers.any;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ControllerExceptionTest.java:38:import static org.mockito.Mockito.when;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseControllerTest.java:50:import static org.mockito.Mockito.*;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ClusterControllerTest.java:28:import org.mockito.Mock;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ClusterControllerTest.java:29:import org.mockito.MockitoAnnotations;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ClusterControllerTest.java:34:import static org.mockito.Mockito.*;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ControllerIntegrationExceptionTest.java:30:import org.mockito.Mock;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ControllerIntegrationExceptionTest.java:31:import org.mockito.MockitoAnnotations;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ControllerIntegrationExceptionTest.java:40:import static org.mockito.ArgumentMatchers.any;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/ControllerIntegrationExceptionTest.java:41:import static org.mockito.Mockito.when;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/filter/AdminServiceAuthenticationFilterTest.java:19:import static org.mockito.ArgumentMatchers.anyInt;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/filter/AdminServiceAuthenticationFilterTest.java:20:import static org.mockito.ArgumentMatchers.anyString;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/filter/AdminServiceAuthenticationFilterTest.java:21:import static org.mockito.Mockito.mock;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/filter/AdminServiceAuthenticationFilterTest.java:22:import static org.mockito.Mockito.never;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/filter/AdminServiceAuthenticationFilterTest.java:23:import static org.mockito.Mockito.times;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/filter/AdminServiceAuthenticationFilterTest.java:24:import static org.mockito.Mockito.verify;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/filter/AdminServiceAuthenticationFilterTest.java:25:import static org.mockito.Mockito.when;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/filter/AdminServiceAuthenticationFilterTest.java:34:import org.mockito.Mock;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/filter/AdminServiceAuthenticationFilterTest.java:35:import org.mockito.junit.MockitoJUnitRunner;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceUnlockAspectTest.java:29:import org.mockito.InjectMocks;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceUnlockAspectTest.java:30:import org.mockito.Mock;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceUnlockAspectTest.java:31:import org.mockito.junit.MockitoJUnitRunner;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceUnlockAspectTest.java:37:import static org.mockito.Mockito.when;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceLockTest.java:31:import org.mockito.InjectMocks;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceLockTest.java:32:import org.mockito.Mock;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceLockTest.java:33:import org.mockito.junit.MockitoJUnitRunner;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceLockTest.java:36:import static org.mockito.ArgumentMatchers.any;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceLockTest.java:37:import static org.mockito.ArgumentMatchers.anyLong;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceLockTest.java:38:import static org.mockito.Mockito.times;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceLockTest.java:39:import static org.mockito.Mockito.verify;
apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/aop/NamespaceLockTest.java:40:import static org.mockito.Mockito.when;
grep: apollo-adminservice/target/test-classes/com/ctrip/framework/apollo/adminservice/controller/ReleaseControllerTest.class: binary file matches
grep: apollo-adminservice/target/test-classes/com/ctrip/framework/apollo/adminservice/controller/ControllerIntegrationExceptionTest.class: binary file matches
grep: apollo-adminservice/target/test-classes/com/ctrip/framework/apollo/adminservice/controller/InstanceConfigControllerTest.class: binary file matches
grep: apollo-adminservice/target/test-classes/com/ctrip/framework/apollo/adminservice/controller/ClusterControllerTest.class: binary file matches
grep: apollo-adminservice/target/test-classes/com/ctrip/framework/apollo/adminservice/controller/ControllerExceptionTest.class: binary file matches
grep: apollo-adminservice/target/test-classes/com/ctrip/framework/apollo/adminservice/filter/AdminServiceAuthenticationFilterTest.class: binary file matches
grep: apollo-adminservice/target/test-classes/com/ctrip/framework/apollo/adminservice/aop/NamespaceUnlockAspectTest.class: binary file matches
grep: apollo-adminservice/target/test-classes/com/ctrip/framework/apollo/adminservice/aop/NamespaceLockTest.class: binary file matches
apollo-core/src/test/java/com/ctrip/framework/apollo/tracer/TracerTest.java:29:import static org.mockito.Mockito.doThrow;
apollo-core/src/test/java/com/ctrip/framework/apollo/tracer/TracerTest.java:30:import static org.mockito.Mockito.mock;
apollo-core/src/test/java/com/ctrip/framework/apollo/tracer/TracerTest.java:31:import static org.mockito.Mockito.times;
apollo-core/src/test/java/com/ctrip/framework/apollo/tracer/TracerTest.java:32:import static org.mockito.Mockito.verify;
apollo-core/src/test/java/com/ctrip/framework/apollo/tracer/TracerTest.java:33:import static org.mockito.Mockito.when;
apollo-core/src/test/java/com/ctrip/framework/apollo/BaseIntegrationTest.java:19:import static org.mockito.ArgumentMatchers.anyString;
apollo-core/src/test/java/com/ctrip/framework/apollo/BaseIntegrationTest.java:20:import static org.mockito.Mockito.mock;
apollo-core/src/test/java/com/ctrip/framework/apollo/BaseIntegrationTest.java:21:import static org.mockito.Mockito.when;
grep: apollo-core/target/test-classes/com/ctrip/framework/apollo/tracer/TracerTest.class: binary file matches
grep: apollo-core/target/test-classes/com/ctrip/framework/apollo/BaseIntegrationTest.class: binary file matches
apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/WebUtilsTest.java:23:import org.mockito.junit.MockitoJUnitRunner;
apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/BeanUtilsTest.java:24:import org.mockito.InjectMocks;
apollo-common/src/test/java/com/ctrip/framework/apollo/common/utils/BeanUtilsTest.java:25:import org.mockito.junit.MockitoJUnitRunner;
apollo-common/target/surefire-reports/TEST-com.ctrip.framework.apollo.common.utils.InputValidatorTest.xml:9:    <property name="java.class.path" value="/testbed/apollo-common/target/test-classes:/testbed/apollo-common/target/classes:/testbed/apollo-core/target/classes:/root/.m2/repository/com/google/code/gson/gson/2.8.9/gson-2.8.9.jar:/root/.m2/repository/com/google/guava/guava/31.0.1-jre/guava-31.0.1-jre.jar:/root/.m2/repository/com/google/guava/failureaccess/1.0.1/failureaccess-1.0.1.jar:/root/.m2/repository/com/google/guava/listenablefuture/9999.0-empty-to-avoid-conflict-with-guava/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar:/root/.m2/repository/com/google/code/findbugs/jsr305/3.0.2/jsr305-3.0.2.jar:/root/.m2/repository/org/checkerframework/checker-qual/3.12.0/checker-qual-3.12.0.jar:/root/.m2/repository/com/google/errorprone/error_prone_annotations/2.7.1/error_prone_annotations-2.7.1.jar:/root/.m2/repository/com/google/j2objc/j2objc-annotations/1.3/j2objc-annotations-1.3.jar:/root/.m2/repository/org/slf4j/slf4j-api/1.7.21/slf4j-api-1.7.21.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-actuator/2.6.8/spring-boot-starter-actuator-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter/2.6.8/spring-boot-starter-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot/2.6.8/spring-boot-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-autoconfigure/2.6.8/spring-boot-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-logging/2.6.8/spring-boot-starter-logging-2.6.8.jar:/root/.m2/repository/ch/qos/logback/logback-classic/1.2.11/logback-classic-1.2.11.jar:/root/.m2/repository/ch/qos/logback/logback-core/1.2.11/logback-core-1.2.11.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-to-slf4j/2.17.2/log4j-to-slf4j-2.17.2.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-api/2.17.2/log4j-api-2.17.2.jar:/root/.m2/repository/org/slf4j/jul-to-slf4j/1.7.36/jul-to-slf4j-1.7.36.jar:/root/.m2/repository/jakarta/annotation/jakarta.annotation-api/1.3.5/jakarta.annotation-api-1.3.5.jar:/root/.m2/repository/org/yaml/snakeyaml/1.29/snakeyaml-1.29.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator-autoconfigure/2.6.8/spring-boot-actuator-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator/2.6.8/spring-boot-actuator-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-databind/2.13.3/jackson-databind-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-annotations/2.13.3/jackson-annotations-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.13.3/jackson-core-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jsr310/2.13.3/jackson-datatype-jsr310-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-web/2.6.8/spring-boot-starter-web-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-json/2.6.8/spring-boot-starter-json-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jdk8/2.13.3/jackson-datatype-jdk8-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/module/jackson-module-parameter-names/2.13.3/jackson-module-parameter-names-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-tomcat/2.6.8/spring-boot-starter-tomcat-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-core/9.0.63/tomcat-embed-core-9.0.63.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-websocket/9.0.63/tomcat-embed-websocket-9.0.63.jar:/root/.m2/repository/org/springframework/spring-web/5.3.20/spring-web-5.3.20.jar:/root/.m2/repository/org/springframework/spring-webmvc/5.3.20/spring-webmvc-5.3.20.jar:/root/.m2/repository/org/springframework/spring-context/5.3.20/spring-context-5.3.20.jar:/root/.m2/repository/org/springframework/spring-expression/5.3.20/spring-expression-5.3.20.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-validation/2.6.8/spring-boot-starter-validation-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-el/9.0.63/tomcat-embed-el-9.0.63.jar:/root/.m2/repository/org/hibernate/validator/hibernate-validator/6.2.3.Final/hibernate-validator-6.2.3.Final.jar:/root/.m2/repository/jakarta/validation/jakarta.validation-api/2.0.2/jakarta.validation-api-2.0.2.jar:/root/.m2/repository/org/jboss/logging/jboss-logging/3.4.3.Final/jboss-logging-3.4.3.Final.jar:/root/.m2/repository/com/fasterxml/classmate/1.5.1/classmate-1.5.1.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-security/2.6.8/spring-boot-starter-security-2.6.8.jar:/root/.m2/repository/org/springframework/spring-aop/5.3.20/spring-aop-5.3.20.jar:/root/.m2/repository/org/springframework/security/spring-security-config/5.7.3/spring-security-config-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-core/5.7.3/spring-security-core-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-crypto/5.7.3/spring-security-crypto-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-web/5.7.3/spring-security-web-5.7.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-data-jpa/2.6.8/spring-boot-starter-data-jpa-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-aop/2.6.8/spring-boot-starter-aop-2.6.8.jar:/root/.m2/repository/org/aspectj/aspectjweaver/1.9.7/aspectjweaver-1.9.7.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-jdbc/2.6.8/spring-boot-starter-jdbc-2.6.8.jar:/root/.m2/repository/com/zaxxer/HikariCP/4.0.3/HikariCP-4.0.3.jar:/root/.m2/repository/org/springframework/spring-jdbc/5.3.20/spring-jdbc-5.3.20.jar:/root/.m2/repository/jakarta/transaction/jakarta.transaction-api/1.3.3/jakarta.transaction-api-1.3.3.jar:/root/.m2/repository/jakarta/persistence/jakarta.persistence-api/2.2.3/jakarta.persistence-api-2.2.3.jar:/root/.m2/repository/org/hibernate/hibernate-core/5.6.9.Final/hibernate-core-5.6.9.Final.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/antlr/antlr/2.7.7/antlr-2.7.7.jar:/root/.m2/repository/org/jboss/jandex/2.4.2.Final/jandex-2.4.2.Final.jar:/root/.m2/repository/org/hibernate/common/hibernate-commons-annotations/5.1.2.Final/hibernate-commons-annotations-5.1.2.Final.jar:/root/.m2/repository/org/glassfish/jaxb/jaxb-runtime/2.3.1/jaxb-runtime-2.3.1.jar:/root/.m2/repository/org/glassfish/jaxb/txw2/2.3.6/txw2-2.3.6.jar:/root/.m2/repository/com/sun/istack/istack-commons-runtime/3.0.7/istack-commons-runtime-3.0.7.jar:/root/.m2/repository/org/jvnet/staxex/stax-ex/1.8/stax-ex-1.8.jar:/root/.m2/repository/com/sun/xml/fastinfoset/FastInfoset/1.2.15/FastInfoset-1.2.15.jar:/root/.m2/repository/org/springframework/data/spring-data-jpa/2.6.4/spring-data-jpa-2.6.4.jar:/root/.m2/repository/org/springframework/spring-orm/5.3.20/spring-orm-5.3.20.jar:/root/.m2/repository/org/springframework/spring-tx/5.3.20/spring-tx-5.3.20.jar:/root/.m2/repository/org/springframework/spring-aspects/5.3.20/spring-aspects-5.3.20.jar:/root/.m2/repository/mysql/mysql-connector-java/8.0.29/mysql-connector-java-8.0.29.jar:/root/.m2/repository/com/google/protobuf/protobuf-java/3.19.4/protobuf-java-3.19.4.jar:/root/.m2/repository/org/springframework/data/spring-data-commons/2.6.4/spring-data-commons-2.6.4.jar:/root/.m2/repository/org/springframework/spring-core/5.3.20/spring-core-5.3.20.jar:/root/.m2/repository/org/springframework/spring-jcl/5.3.20/spring-jcl-5.3.20.jar:/root/.m2/repository/org/springframework/spring-beans/5.3.20/spring-beans-5.3.20.jar:/root/.m2/repository/org/apache/httpcomponents/httpclient/4.5.13/httpclient-4.5.13.jar:/root/.m2/repository/org/apache/httpcomponents/httpcore/4.4.15/httpcore-4.4.15.jar:/root/.m2/repository/commons-codec/commons-codec/1.15/commons-codec-1.15.jar:/root/.m2/repository/org/codehaus/janino/janino/3.1.7/janino-3.1.7.jar:/root/.m2/repository/org/codehaus/janino/commons-compiler/3.1.7/commons-compiler-3.1.7.jar:/root/.m2/repository/org/apache/commons/commons-lang3/3.12.0/commons-lang3-3.12.0.jar:/root/.m2/repository/io/micrometer/micrometer-core/1.8.6/micrometer-core-1.8.6.jar:/root/.m2/repository/org/hdrhistogram/HdrHistogram/2.1.12/HdrHistogram-2.1.12.jar:/root/.m2/repository/org/latencyutils/LatencyUtils/2.0.3/LatencyUtils-2.0.3.jar:/root/.m2/repository/io/micrometer/micrometer-registry-prometheus/1.8.6/micrometer-registry-prometheus-1.8.6.jar:/root/.m2/repository/io/prometheus/simpleclient_common/0.12.0/simpleclient_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient/0.12.0/simpleclient-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel/0.12.0/simpleclient_tracer_otel-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_common/0.12.0/simpleclient_tracer_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel_agent/0.12.0/simpleclient_tracer_otel_agent-0.12.0.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-test/2.6.8/spring-boot-starter-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test/2.6.8/spring-boot-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test-autoconfigure/2.6.8/spring-boot-test-autoconfigure-2.6.8.jar:/root/.m2/repository/com/jayway/jsonpath/json-path/2.6.0/json-path-2.6.0.jar:/root/.m2/repository/net/minidev/json-smart/2.4.8/json-smart-2.4.8.jar:/root/.m2/repository/net/minidev/accessors-smart/2.4.8/accessors-smart-2.4.8.jar:/root/.m2/repository/org/ow2/asm/asm/9.1/asm-9.1.jar:/root/.m2/repository/jakarta/xml/bind/jakarta.xml.bind-api/2.3.3/jakarta.xml.bind-api-2.3.3.jar:/root/.m2/repository/jakarta/activation/jakarta.activation-api/1.2.2/jakarta.activation-api-1.2.2.jar:/root/.m2/repository/org/assertj/assertj-core/3.21.0/assertj-core-3.21.0.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter/5.8.2/junit-jupiter-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-api/5.8.2/junit-jupiter-api-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-params/5.8.2/junit-jupiter-params-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-engine/5.8.2/junit-jupiter-engine-5.8.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar:/root/.m2/repository/org/mockito/mockito-junit-jupiter/4.0.0/mockito-junit-jupiter-4.0.0.jar:/root/.m2/repository/org/skyscreamer/jsonassert/1.5.0/jsonassert-1.5.0.jar:/root/.m2/repository/com/vaadin/external/google/android-json/0.0.20131108.vaadin1/android-json-0.0.20131108.vaadin1.jar:/root/.m2/repository/org/springframework/spring-test/5.3.20/spring-test-5.3.20.jar:/root/.m2/repository/org/xmlunit/xmlunit-core/2.8.4/xmlunit-core-2.8.4.jar:/root/.m2/repository/org/awaitility/awaitility/4.0.3/awaitility-4.0.3.jar:/root/.m2/repository/org/junit/vintage/junit-vintage-engine/5.7.0/junit-vintage-engine-5.7.0.jar:/root/.m2/repository/org/apiguardian/apiguardian-api/1.1.0/apiguardian-api-1.1.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-engine/1.8.2/junit-platform-engine-1.8.2.jar:/root/.m2/repository/org/opentest4j/opentest4j/1.2.0/opentest4j-1.2.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-commons/1.8.2/junit-platform-commons-1.8.2.jar:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:"/>
apollo-common/target/surefire-reports/TEST-com.ctrip.framework.apollo.common.utils.InputValidatorTest.xml:21:    <property name="surefire.test.class.path" value="/testbed/apollo-common/target/test-classes:/testbed/apollo-common/target/classes:/testbed/apollo-core/target/classes:/root/.m2/repository/com/google/code/gson/gson/2.8.9/gson-2.8.9.jar:/root/.m2/repository/com/google/guava/guava/31.0.1-jre/guava-31.0.1-jre.jar:/root/.m2/repository/com/google/guava/failureaccess/1.0.1/failureaccess-1.0.1.jar:/root/.m2/repository/com/google/guava/listenablefuture/9999.0-empty-to-avoid-conflict-with-guava/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar:/root/.m2/repository/com/google/code/findbugs/jsr305/3.0.2/jsr305-3.0.2.jar:/root/.m2/repository/org/checkerframework/checker-qual/3.12.0/checker-qual-3.12.0.jar:/root/.m2/repository/com/google/errorprone/error_prone_annotations/2.7.1/error_prone_annotations-2.7.1.jar:/root/.m2/repository/com/google/j2objc/j2objc-annotations/1.3/j2objc-annotations-1.3.jar:/root/.m2/repository/org/slf4j/slf4j-api/1.7.21/slf4j-api-1.7.21.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-actuator/2.6.8/spring-boot-starter-actuator-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter/2.6.8/spring-boot-starter-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot/2.6.8/spring-boot-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-autoconfigure/2.6.8/spring-boot-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-logging/2.6.8/spring-boot-starter-logging-2.6.8.jar:/root/.m2/repository/ch/qos/logback/logback-classic/1.2.11/logback-classic-1.2.11.jar:/root/.m2/repository/ch/qos/logback/logback-core/1.2.11/logback-core-1.2.11.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-to-slf4j/2.17.2/log4j-to-slf4j-2.17.2.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-api/2.17.2/log4j-api-2.17.2.jar:/root/.m2/repository/org/slf4j/jul-to-slf4j/1.7.36/jul-to-slf4j-1.7.36.jar:/root/.m2/repository/jakarta/annotation/jakarta.annotation-api/1.3.5/jakarta.annotation-api-1.3.5.jar:/root/.m2/repository/org/yaml/snakeyaml/1.29/snakeyaml-1.29.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator-autoconfigure/2.6.8/spring-boot-actuator-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator/2.6.8/spring-boot-actuator-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-databind/2.13.3/jackson-databind-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-annotations/2.13.3/jackson-annotations-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.13.3/jackson-core-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jsr310/2.13.3/jackson-datatype-jsr310-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-web/2.6.8/spring-boot-starter-web-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-json/2.6.8/spring-boot-starter-json-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jdk8/2.13.3/jackson-datatype-jdk8-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/module/jackson-module-parameter-names/2.13.3/jackson-module-parameter-names-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-tomcat/2.6.8/spring-boot-starter-tomcat-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-core/9.0.63/tomcat-embed-core-9.0.63.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-websocket/9.0.63/tomcat-embed-websocket-9.0.63.jar:/root/.m2/repository/org/springframework/spring-web/5.3.20/spring-web-5.3.20.jar:/root/.m2/repository/org/springframework/spring-webmvc/5.3.20/spring-webmvc-5.3.20.jar:/root/.m2/repository/org/springframework/spring-context/5.3.20/spring-context-5.3.20.jar:/root/.m2/repository/org/springframework/spring-expression/5.3.20/spring-expression-5.3.20.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-validation/2.6.8/spring-boot-starter-validation-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-el/9.0.63/tomcat-embed-el-9.0.63.jar:/root/.m2/repository/org/hibernate/validator/hibernate-validator/6.2.3.Final/hibernate-validator-6.2.3.Final.jar:/root/.m2/repository/jakarta/validation/jakarta.validation-api/2.0.2/jakarta.validation-api-2.0.2.jar:/root/.m2/repository/org/jboss/logging/jboss-logging/3.4.3.Final/jboss-logging-3.4.3.Final.jar:/root/.m2/repository/com/fasterxml/classmate/1.5.1/classmate-1.5.1.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-security/2.6.8/spring-boot-starter-security-2.6.8.jar:/root/.m2/repository/org/springframework/spring-aop/5.3.20/spring-aop-5.3.20.jar:/root/.m2/repository/org/springframework/security/spring-security-config/5.7.3/spring-security-config-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-core/5.7.3/spring-security-core-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-crypto/5.7.3/spring-security-crypto-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-web/5.7.3/spring-security-web-5.7.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-data-jpa/2.6.8/spring-boot-starter-data-jpa-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-aop/2.6.8/spring-boot-starter-aop-2.6.8.jar:/root/.m2/repository/org/aspectj/aspectjweaver/1.9.7/aspectjweaver-1.9.7.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-jdbc/2.6.8/spring-boot-starter-jdbc-2.6.8.jar:/root/.m2/repository/com/zaxxer/HikariCP/4.0.3/HikariCP-4.0.3.jar:/root/.m2/repository/org/springframework/spring-jdbc/5.3.20/spring-jdbc-5.3.20.jar:/root/.m2/repository/jakarta/transaction/jakarta.transaction-api/1.3.3/jakarta.transaction-api-1.3.3.jar:/root/.m2/repository/jakarta/persistence/jakarta.persistence-api/2.2.3/jakarta.persistence-api-2.2.3.jar:/root/.m2/repository/org/hibernate/hibernate-core/5.6.9.Final/hibernate-core-5.6.9.Final.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/antlr/antlr/2.7.7/antlr-2.7.7.jar:/root/.m2/repository/org/jboss/jandex/2.4.2.Final/jandex-2.4.2.Final.jar:/root/.m2/repository/org/hibernate/common/hibernate-commons-annotations/5.1.2.Final/hibernate-commons-annotations-5.1.2.Final.jar:/root/.m2/repository/org/glassfish/jaxb/jaxb-runtime/2.3.1/jaxb-runtime-2.3.1.jar:/root/.m2/repository/org/glassfish/jaxb/txw2/2.3.6/txw2-2.3.6.jar:/root/.m2/repository/com/sun/istack/istack-commons-runtime/3.0.7/istack-commons-runtime-3.0.7.jar:/root/.m2/repository/org/jvnet/staxex/stax-ex/1.8/stax-ex-1.8.jar:/root/.m2/repository/com/sun/xml/fastinfoset/FastInfoset/1.2.15/FastInfoset-1.2.15.jar:/root/.m2/repository/org/springframework/data/spring-data-jpa/2.6.4/spring-data-jpa-2.6.4.jar:/root/.m2/repository/org/springframework/spring-orm/5.3.20/spring-orm-5.3.20.jar:/root/.m2/repository/org/springframework/spring-tx/5.3.20/spring-tx-5.3.20.jar:/root/.m2/repository/org/springframework/spring-aspects/5.3.20/spring-aspects-5.3.20.jar:/root/.m2/repository/mysql/mysql-connector-java/8.0.29/mysql-connector-java-8.0.29.jar:/root/.m2/repository/com/google/protobuf/protobuf-java/3.19.4/protobuf-java-3.19.4.jar:/root/.m2/repository/org/springframework/data/spring-data-commons/2.6.4/spring-data-commons-2.6.4.jar:/root/.m2/repository/org/springframework/spring-core/5.3.20/spring-core-5.3.20.jar:/root/.m2/repository/org/springframework/spring-jcl/5.3.20/spring-jcl-5.3.20.jar:/root/.m2/repository/org/springframework/spring-beans/5.3.20/spring-beans-5.3.20.jar:/root/.m2/repository/org/apache/httpcomponents/httpclient/4.5.13/httpclient-4.5.13.jar:/root/.m2/repository/org/apache/httpcomponents/httpcore/4.4.15/httpcore-4.4.15.jar:/root/.m2/repository/commons-codec/commons-codec/1.15/commons-codec-1.15.jar:/root/.m2/repository/org/codehaus/janino/janino/3.1.7/janino-3.1.7.jar:/root/.m2/repository/org/codehaus/janino/commons-compiler/3.1.7/commons-compiler-3.1.7.jar:/root/.m2/repository/org/apache/commons/commons-lang3/3.12.0/commons-lang3-3.12.0.jar:/root/.m2/repository/io/micrometer/micrometer-core/1.8.6/micrometer-core-1.8.6.jar:/root/.m2/repository/org/hdrhistogram/HdrHistogram/2.1.12/HdrHistogram-2.1.12.jar:/root/.m2/repository/org/latencyutils/LatencyUtils/2.0.3/LatencyUtils-2.0.3.jar:/root/.m2/repository/io/micrometer/micrometer-registry-prometheus/1.8.6/micrometer-registry-prometheus-1.8.6.jar:/root/.m2/repository/io/prometheus/simpleclient_common/0.12.0/simpleclient_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient/0.12.0/simpleclient-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel/0.12.0/simpleclient_tracer_otel-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_common/0.12.0/simpleclient_tracer_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel_agent/0.12.0/simpleclient_tracer_otel_agent-0.12.0.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-test/2.6.8/spring-boot-starter-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test/2.6.8/spring-boot-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test-autoconfigure/2.6.8/spring-boot-test-autoconfigure-2.6.8.jar:/root/.m2/repository/com/jayway/jsonpath/json-path/2.6.0/json-path-2.6.0.jar:/root/.m2/repository/net/minidev/json-smart/2.4.8/json-smart-2.4.8.jar:/root/.m2/repository/net/minidev/accessors-smart/2.4.8/accessors-smart-2.4.8.jar:/root/.m2/repository/org/ow2/asm/asm/9.1/asm-9.1.jar:/root/.m2/repository/jakarta/xml/bind/jakarta.xml.bind-api/2.3.3/jakarta.xml.bind-api-2.3.3.jar:/root/.m2/repository/jakarta/activation/jakarta.activation-api/1.2.2/jakarta.activation-api-1.2.2.jar:/root/.m2/repository/org/assertj/assertj-core/3.21.0/assertj-core-3.21.0.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter/5.8.2/junit-jupiter-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-api/5.8.2/junit-jupiter-api-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-params/5.8.2/junit-jupiter-params-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-engine/5.8.2/junit-jupiter-engine-5.8.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar:/root/.m2/repository/org/mockito/mockito-junit-jupiter/4.0.0/mockito-junit-jupiter-4.0.0.jar:/root/.m2/repository/org/skyscreamer/jsonassert/1.5.0/jsonassert-1.5.0.jar:/root/.m2/repository/com/vaadin/external/google/android-json/0.0.20131108.vaadin1/android-json-0.0.20131108.vaadin1.jar:/root/.m2/repository/org/springframework/spring-test/5.3.20/spring-test-5.3.20.jar:/root/.m2/repository/org/xmlunit/xmlunit-core/2.8.4/xmlunit-core-2.8.4.jar:/root/.m2/repository/org/awaitility/awaitility/4.0.3/awaitility-4.0.3.jar:/root/.m2/repository/org/junit/vintage/junit-vintage-engine/5.7.0/junit-vintage-engine-5.7.0.jar:/root/.m2/repository/org/apiguardian/apiguardian-api/1.1.0/apiguardian-api-1.1.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-engine/1.8.2/junit-platform-engine-1.8.2.jar:/root/.m2/repository/org/opentest4j/opentest4j/1.2.0/opentest4j-1.2.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-commons/1.8.2/junit-platform-commons-1.8.2.jar:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:"/>
grep: apollo-common/target/test-classes/com/ctrip/framework/apollo/common/utils/BeanUtilsTest.class: binary file matches
grep: apollo-common/target/test-classes/com/ctrip/framework/apollo/common/utils/WebUtilsTest.class: binary file matches
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/message/DatabaseMessageSenderTest.java:24:import org.mockito.ArgumentCaptor;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/message/DatabaseMessageSenderTest.java:25:import org.mockito.Mock;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/message/DatabaseMessageSenderTest.java:28:import static org.mockito.Mockito.*;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/message/ReleaseMessageScannerTest.java:32:import org.mockito.Mock;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/message/ReleaseMessageScannerTest.java:40:import static org.mockito.Mockito.when;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java:28:import org.mockito.InjectMocks;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java:29:import org.mockito.Mock;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java:30:import org.mockito.Spy;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java:38:import static org.mockito.Mockito.doReturn;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.java:39:import static org.mockito.Mockito.when;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/BizDBPropertySourceTest.java:30:import org.mockito.Mock;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/BizDBPropertySourceTest.java:37:import static org.mockito.Mockito.spy;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/BizDBPropertySourceTest.java:38:import static org.mockito.Mockito.when;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespacePublishInfoTest.java:29:import org.mockito.InjectMocks;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespacePublishInfoTest.java:30:import org.mockito.Mock;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespacePublishInfoTest.java:36:import static org.mockito.ArgumentMatchers.any;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespacePublishInfoTest.java:37:import static org.mockito.ArgumentMatchers.anyLong;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/NamespacePublishInfoTest.java:38:import static org.mockito.Mockito.when;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/ReleaseServiceTest.java:33:import org.mockito.InjectMocks;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/ReleaseServiceTest.java:34:import org.mockito.Mock;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/ReleaseServiceTest.java:43:import static org.mockito.Mockito.mock;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/ReleaseServiceTest.java:44:import static org.mockito.Mockito.times;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/ReleaseServiceTest.java:45:import static org.mockito.Mockito.verify;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/service/ReleaseServiceTest.java:46:import static org.mockito.Mockito.when;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/grayReleaseRule/GrayReleaseRulesHolderTest.java:36:import org.mockito.Mock;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/grayReleaseRule/GrayReleaseRulesHolderTest.java:37:import org.mockito.junit.MockitoJUnitRunner;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/grayReleaseRule/GrayReleaseRulesHolderTest.java:48:import static org.mockito.Mockito.spy;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/grayReleaseRule/GrayReleaseRulesHolderTest.java:49:import static org.mockito.Mockito.when;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/config/BizConfigTest.java:23:import org.mockito.Mock;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/config/BizConfigTest.java:24:import org.mockito.junit.MockitoJUnitRunner;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/config/BizConfigTest.java:29:import static org.mockito.Mockito.when;
apollo-biz/src/test/java/com/ctrip/framework/apollo/biz/AbstractUnitTest.java:20:import org.mockito.junit.MockitoJUnitRunner;
grep: apollo-biz/target/test-classes/com/ctrip/framework/apollo/biz/message/ReleaseMessageScannerTest.class: binary file matches
grep: apollo-biz/target/test-classes/com/ctrip/framework/apollo/biz/message/DatabaseMessageSenderTest.class: binary file matches
grep: apollo-biz/target/test-classes/com/ctrip/framework/apollo/biz/service/NamespaceServiceTest.class: binary file matches
grep: apollo-biz/target/test-classes/com/ctrip/framework/apollo/biz/service/BizDBPropertySourceTest.class: binary file matches
grep: apollo-biz/target/test-classes/com/ctrip/framework/apollo/biz/service/ReleaseServiceTest.class: binary file matches
grep: apollo-biz/target/test-classes/com/ctrip/framework/apollo/biz/service/NamespacePublishInfoTest.class: binary file matches
grep: apollo-biz/target/test-classes/com/ctrip/framework/apollo/biz/grayReleaseRule/GrayReleaseRulesHolderTest.class: binary file matches
grep: apollo-biz/target/test-classes/com/ctrip/framework/apollo/biz/config/BizConfigTest.class: binary file matches
grep: apollo-biz/target/test-classes/com/ctrip/framework/apollo/biz/AbstractUnitTest.class: binary file matches
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/controller/ServiceControllerTest.java:20:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/controller/ServiceControllerTest.java:29:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/controller/ServiceControllerTest.java:30:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/controller/HomePageControllerTest.java:20:import static org.mockito.Mockito.mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/controller/HomePageControllerTest.java:21:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/controller/HomePageControllerTest.java:31:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/controller/HomePageControllerTest.java:32:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/ZookeeperDiscoveryServiceTest.java:26:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/ZookeeperDiscoveryServiceTest.java:27:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/ZookeeperDiscoveryServiceTest.java:34:import static org.mockito.Mockito.mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/ZookeeperDiscoveryServiceTest.java:35:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/NacosDiscoveryServiceTest.java:26:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/NacosDiscoveryServiceTest.java:27:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/NacosDiscoveryServiceTest.java:33:import static org.mockito.Mockito.mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/NacosDiscoveryServiceTest.java:34:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/ConsulDiscoveryServiceTest.java:24:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/ConsulDiscoveryServiceTest.java:25:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/ConsulDiscoveryServiceTest.java:33:import static org.mockito.Mockito.mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/ConsulDiscoveryServiceTest.java:34:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/DefaultDiscoveryServiceTest.java:20:import static org.mockito.Mockito.mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/DefaultDiscoveryServiceTest.java:21:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/DefaultDiscoveryServiceTest.java:34:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/DefaultDiscoveryServiceTest.java:35:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/KubernetesDiscoveryServiceTest.java:20:import static org.mockito.Mockito.times;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/KubernetesDiscoveryServiceTest.java:21:import static org.mockito.Mockito.verify;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/KubernetesDiscoveryServiceTest.java:22:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/KubernetesDiscoveryServiceTest.java:31:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/metaservice/service/KubernetesDiscoveryServiceTest.java:32:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/NotificationControllerV2Test.java:39:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/NotificationControllerV2Test.java:40:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/NotificationControllerV2Test.java:53:import static org.mockito.Mockito.*;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/NotificationControllerTest.java:33:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/NotificationControllerTest.java:34:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/NotificationControllerTest.java:44:import static org.mockito.Mockito.mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/NotificationControllerTest.java:45:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigFileControllerTest.java:40:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigFileControllerTest.java:41:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigFileControllerTest.java:48:import static org.mockito.ArgumentMatchers.anyString;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigFileControllerTest.java:49:import static org.mockito.Mockito.mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigFileControllerTest.java:50:import static org.mockito.Mockito.times;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigFileControllerTest.java:51:import static org.mockito.Mockito.verify;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigFileControllerTest.java:52:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java:36:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java:37:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.java:45:import static org.mockito.Mockito.*;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/filter/ClientAuthenticationFilterTest.java:19:import static org.mockito.ArgumentMatchers.any;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/filter/ClientAuthenticationFilterTest.java:20:import static org.mockito.Mockito.never;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/filter/ClientAuthenticationFilterTest.java:21:import static org.mockito.Mockito.times;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/filter/ClientAuthenticationFilterTest.java:22:import static org.mockito.Mockito.verify;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/filter/ClientAuthenticationFilterTest.java:23:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/filter/ClientAuthenticationFilterTest.java:36:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/filter/ClientAuthenticationFilterTest.java:37:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/ReleaseMessageServiceWithCacheTest.java:28:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/ReleaseMessageServiceWithCacheTest.java:29:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/ReleaseMessageServiceWithCacheTest.java:40:import static org.mockito.Mockito.*;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/DefaultConfigServiceTest.java:20:import static org.mockito.ArgumentMatchers.anyString;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/DefaultConfigServiceTest.java:21:import static org.mockito.Mockito.mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/DefaultConfigServiceTest.java:22:import static org.mockito.Mockito.never;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/DefaultConfigServiceTest.java:23:import static org.mockito.Mockito.times;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/DefaultConfigServiceTest.java:24:import static org.mockito.Mockito.verify;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/DefaultConfigServiceTest.java:25:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/DefaultConfigServiceTest.java:35:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/DefaultConfigServiceTest.java:36:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/ConfigServiceWithCacheTest.java:32:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/ConfigServiceWithCacheTest.java:33:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/ConfigServiceWithCacheTest.java:38:import static org.mockito.Mockito.mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/ConfigServiceWithCacheTest.java:39:import static org.mockito.Mockito.times;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/ConfigServiceWithCacheTest.java:40:import static org.mockito.Mockito.verify;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/config/ConfigServiceWithCacheTest.java:41:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCacheTest.java:28:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCacheTest.java:29:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCacheTest.java:41:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/AccessKeyServiceWithCacheTest.java:20:import static org.mockito.ArgumentMatchers.anyList;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/AccessKeyServiceWithCacheTest.java:21:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/AccessKeyServiceWithCacheTest.java:34:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/service/AccessKeyServiceWithCacheTest.java:35:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/InstanceConfigAuditUtilTest.java:25:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/InstanceConfigAuditUtilTest.java:26:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/InstanceConfigAuditUtilTest.java:33:import static org.mockito.Mockito.*;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/WatchKeysUtilTest.java:29:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/WatchKeysUtilTest.java:30:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/WatchKeysUtilTest.java:37:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/AccessKeyUtilTest.java:20:import static org.mockito.Mockito.verify;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/AccessKeyUtilTest.java:21:import static org.mockito.Mockito.when;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/AccessKeyUtilTest.java:30:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/AccessKeyUtilTest.java:31:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java:24:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java:25:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.java:28:import static org.mockito.Mockito.*;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/wrapper/CaseInsensitiveMapWrapperTest.java:22:import org.mockito.Mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/wrapper/CaseInsensitiveMapWrapperTest.java:23:import org.mockito.junit.MockitoJUnitRunner;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/wrapper/CaseInsensitiveMapWrapperTest.java:28:import static org.mockito.Mockito.mock;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/wrapper/CaseInsensitiveMapWrapperTest.java:29:import static org.mockito.Mockito.times;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/wrapper/CaseInsensitiveMapWrapperTest.java:30:import static org.mockito.Mockito.verify;
apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/wrapper/CaseInsensitiveMapWrapperTest.java:31:import static org.mockito.Mockito.when;
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/metaservice/controller/ServiceControllerTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/metaservice/controller/HomePageControllerTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/metaservice/service/KubernetesDiscoveryServiceTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/metaservice/service/ZookeeperDiscoveryServiceTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/metaservice/service/DefaultDiscoveryServiceTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/metaservice/service/NacosDiscoveryServiceTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/metaservice/service/ConsulDiscoveryServiceTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/controller/NotificationControllerTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/controller/ConfigFileControllerTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/controller/NotificationControllerV2Test.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/controller/ConfigControllerTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/filter/ClientAuthenticationFilterTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/service/ReleaseMessageServiceWithCacheTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/service/config/ConfigServiceWithCacheTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/service/config/DefaultConfigServiceTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCacheTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/service/AccessKeyServiceWithCacheTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/util/WatchKeysUtilTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/util/InstanceConfigAuditUtilTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/util/NamespaceUtilTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/util/AccessKeyUtilTest.class: binary file matches
grep: apollo-configservice/target/test-classes/com/ctrip/framework/apollo/configservice/wrapper/CaseInsensitiveMapWrapperTest.class: binary file matches
apollo-configservice/target/surefire-reports/TEST-com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest.xml:9:    <property name="java.class.path" value="/testbed/apollo-configservice/target/test-classes:/testbed/apollo-configservice/target/classes:/testbed/apollo-biz/target/classes:/testbed/apollo-common/target/classes:/testbed/apollo-core/target/classes:/root/.m2/repository/com/google/code/gson/gson/2.8.9/gson-2.8.9.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-actuator/2.6.8/spring-boot-starter-actuator-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator-autoconfigure/2.6.8/spring-boot-actuator-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator/2.6.8/spring-boot-actuator-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jsr310/2.13.3/jackson-datatype-jsr310-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-web/2.6.8/spring-boot-starter-web-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-json/2.6.8/spring-boot-starter-json-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jdk8/2.13.3/jackson-datatype-jdk8-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/module/jackson-module-parameter-names/2.13.3/jackson-module-parameter-names-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-tomcat/2.6.8/spring-boot-starter-tomcat-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-core/9.0.63/tomcat-embed-core-9.0.63.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-websocket/9.0.63/tomcat-embed-websocket-9.0.63.jar:/root/.m2/repository/org/springframework/spring-web/5.3.20/spring-web-5.3.20.jar:/root/.m2/repository/org/springframework/spring-webmvc/5.3.20/spring-webmvc-5.3.20.jar:/root/.m2/repository/org/springframework/spring-expression/5.3.20/spring-expression-5.3.20.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-validation/2.6.8/spring-boot-starter-validation-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-el/9.0.63/tomcat-embed-el-9.0.63.jar:/root/.m2/repository/org/hibernate/validator/hibernate-validator/6.2.3.Final/hibernate-validator-6.2.3.Final.jar:/root/.m2/repository/jakarta/validation/jakarta.validation-api/2.0.2/jakarta.validation-api-2.0.2.jar:/root/.m2/repository/org/jboss/logging/jboss-logging/3.4.3.Final/jboss-logging-3.4.3.Final.jar:/root/.m2/repository/com/fasterxml/classmate/1.5.1/classmate-1.5.1.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-security/2.6.8/spring-boot-starter-security-2.6.8.jar:/root/.m2/repository/org/springframework/spring-aop/5.3.20/spring-aop-5.3.20.jar:/root/.m2/repository/org/springframework/security/spring-security-config/5.7.3/spring-security-config-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-core/5.7.3/spring-security-core-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-crypto/5.7.3/spring-security-crypto-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-web/5.7.3/spring-security-web-5.7.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-data-jpa/2.6.8/spring-boot-starter-data-jpa-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-aop/2.6.8/spring-boot-starter-aop-2.6.8.jar:/root/.m2/repository/org/aspectj/aspectjweaver/1.9.7/aspectjweaver-1.9.7.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-jdbc/2.6.8/spring-boot-starter-jdbc-2.6.8.jar:/root/.m2/repository/com/zaxxer/HikariCP/4.0.3/HikariCP-4.0.3.jar:/root/.m2/repository/org/springframework/spring-jdbc/5.3.20/spring-jdbc-5.3.20.jar:/root/.m2/repository/jakarta/transaction/jakarta.transaction-api/1.3.3/jakarta.transaction-api-1.3.3.jar:/root/.m2/repository/jakarta/persistence/jakarta.persistence-api/2.2.3/jakarta.persistence-api-2.2.3.jar:/root/.m2/repository/org/hibernate/hibernate-core/5.6.9.Final/hibernate-core-5.6.9.Final.jar:/root/.m2/repository/antlr/antlr/2.7.7/antlr-2.7.7.jar:/root/.m2/repository/org/jboss/jandex/2.4.2.Final/jandex-2.4.2.Final.jar:/root/.m2/repository/org/hibernate/common/hibernate-commons-annotations/5.1.2.Final/hibernate-commons-annotations-5.1.2.Final.jar:/root/.m2/repository/org/springframework/data/spring-data-jpa/2.6.4/spring-data-jpa-2.6.4.jar:/root/.m2/repository/org/springframework/spring-orm/5.3.20/spring-orm-5.3.20.jar:/root/.m2/repository/org/springframework/spring-tx/5.3.20/spring-tx-5.3.20.jar:/root/.m2/repository/org/springframework/spring-aspects/5.3.20/spring-aspects-5.3.20.jar:/root/.m2/repository/mysql/mysql-connector-java/8.0.29/mysql-connector-java-8.0.29.jar:/root/.m2/repository/com/google/protobuf/protobuf-java/3.19.4/protobuf-java-3.19.4.jar:/root/.m2/repository/org/springframework/data/spring-data-commons/2.6.4/spring-data-commons-2.6.4.jar:/root/.m2/repository/org/springframework/spring-beans/5.3.20/spring-beans-5.3.20.jar:/root/.m2/repository/org/codehaus/janino/janino/3.1.7/janino-3.1.7.jar:/root/.m2/repository/org/codehaus/janino/commons-compiler/3.1.7/commons-compiler-3.1.7.jar:/root/.m2/repository/io/micrometer/micrometer-core/1.8.6/micrometer-core-1.8.6.jar:/root/.m2/repository/org/hdrhistogram/HdrHistogram/2.1.12/HdrHistogram-2.1.12.jar:/root/.m2/repository/org/latencyutils/LatencyUtils/2.0.3/LatencyUtils-2.0.3.jar:/root/.m2/repository/io/micrometer/micrometer-registry-prometheus/1.8.6/micrometer-registry-prometheus-1.8.6.jar:/root/.m2/repository/io/prometheus/simpleclient_common/0.12.0/simpleclient_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient/0.12.0/simpleclient-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel/0.12.0/simpleclient_tracer_otel-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_common/0.12.0/simpleclient_tracer_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel_agent/0.12.0/simpleclient_tracer_otel_agent-0.12.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-netflix-eureka-client/3.1.2/spring-cloud-starter-netflix-eureka-client-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-netflix-eureka-client/3.1.2/spring-cloud-netflix-eureka-client-3.1.2.jar:/root/.m2/repository/com/netflix/eureka/eureka-client/1.10.17/eureka-client-1.10.17.jar:/root/.m2/repository/com/netflix/netflix-commons/netflix-eventbus/0.3.0/netflix-eventbus-0.3.0.jar:/root/.m2/repository/com/netflix/netflix-commons/netflix-infix/0.3.0/netflix-infix-0.3.0.jar:/root/.m2/repository/commons-jxpath/commons-jxpath/1.3/commons-jxpath-1.3.jar:/root/.m2/repository/joda-time/joda-time/2.3/joda-time-2.3.jar:/root/.m2/repository/org/antlr/antlr-runtime/3.4/antlr-runtime-3.4.jar:/root/.m2/repository/org/antlr/stringtemplate/3.2.1/stringtemplate-3.2.1.jar:/root/.m2/repository/org/apache/commons/commons-math/2.2/commons-math-2.2.jar:/root/.m2/repository/com/thoughtworks/xstream/xstream/1.4.19/xstream-1.4.19.jar:/root/.m2/repository/io/github/x-stream/mxparser/1.2.2/mxparser-1.2.2.jar:/root/.m2/repository/xmlpull/xmlpull/1.1.3.1/xmlpull-1.1.3.1.jar:/root/.m2/repository/javax/ws/rs/jsr311-api/1.1.1/jsr311-api-1.1.1.jar:/root/.m2/repository/com/netflix/servo/servo-core/0.12.21/servo-core-0.12.21.jar:/root/.m2/repository/commons-configuration/commons-configuration/1.10/commons-configuration-1.10.jar:/root/.m2/repository/commons-lang/commons-lang/2.6/commons-lang-2.6.jar:/root/.m2/repository/com/google/inject/guice/5.0.1/guice-5.0.1.jar:/root/.m2/repository/org/codehaus/jettison/jettison/1.4.0/jettison-1.4.0.jar:/root/.m2/repository/com/netflix/eureka/eureka-core/1.10.17/eureka-core-1.10.17.jar:/root/.m2/repository/com/fasterxml/woodstox/woodstox-core/6.2.1/woodstox-core-6.2.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-consul-discovery/3.1.0/spring-cloud-starter-consul-discovery-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-consul/3.1.0/spring-cloud-starter-consul-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-consul-core/3.1.0/spring-cloud-consul-core-3.1.0.jar:/root/.m2/repository/com/ecwid/consul/consul-api/1.4.5/consul-api-1.4.5.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-consul-discovery/3.1.0/spring-cloud-consul-discovery-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-zookeeper-discovery/3.1.1/spring-cloud-starter-zookeeper-discovery-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-zookeeper/3.1.1/spring-cloud-starter-zookeeper-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-zookeeper-core/3.1.1/spring-cloud-zookeeper-core-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-zookeeper-discovery/3.1.1/spring-cloud-zookeeper-discovery-3.1.1.jar:/root/.m2/repository/org/apache/curator/curator-x-discovery/5.1.0/curator-x-discovery-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-recipes/5.1.0/curator-recipes-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-framework/5.1.0/curator-framework-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-client/5.1.0/curator-client-5.1.0.jar:/root/.m2/repository/org/apache/zookeeper/zookeeper/3.6.0/zookeeper-3.6.0.jar:/root/.m2/repository/org/apache/zookeeper/zookeeper-jute/3.6.0/zookeeper-jute-3.6.0.jar:/root/.m2/repository/org/apache/yetus/audience-annotations/0.5.0/audience-annotations-0.5.0.jar:/root/.m2/repository/io/netty/netty-handler/4.1.77.Final/netty-handler-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-common/4.1.77.Final/netty-common-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-resolver/4.1.77.Final/netty-resolver-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-buffer/4.1.77.Final/netty-buffer-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport/4.1.77.Final/netty-transport-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-codec/4.1.77.Final/netty-codec-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-native-epoll/4.1.77.Final/netty-transport-native-epoll-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-native-unix-common/4.1.77.Final/netty-transport-native-unix-common-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-classes-epoll/4.1.77.Final/netty-transport-classes-epoll-4.1.77.Final.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-netflix-eureka-server/3.1.2/spring-cloud-starter-netflix-eureka-server-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter/3.1.2/spring-cloud-starter-3.1.2.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter/2.6.8/spring-boot-starter-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-logging/2.6.8/spring-boot-starter-logging-2.6.8.jar:/root/.m2/repository/ch/qos/logback/logback-classic/1.2.11/logback-classic-1.2.11.jar:/root/.m2/repository/ch/qos/logback/logback-core/1.2.11/logback-core-1.2.11.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-to-slf4j/2.17.2/log4j-to-slf4j-2.17.2.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-api/2.17.2/log4j-api-2.17.2.jar:/root/.m2/repository/org/slf4j/jul-to-slf4j/1.7.36/jul-to-slf4j-1.7.36.jar:/root/.m2/repository/jakarta/annotation/jakarta.annotation-api/1.3.5/jakarta.annotation-api-1.3.5.jar:/root/.m2/repository/org/yaml/snakeyaml/1.29/snakeyaml-1.29.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-context/3.1.2/spring-cloud-context-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-commons/3.1.2/spring-cloud-commons-3.1.2.jar:/root/.m2/repository/org/springframework/security/spring-security-rsa/1.0.10.RELEASE/spring-security-rsa-1.0.10.RELEASE.jar:/root/.m2/repository/org/bouncycastle/bcpkix-jdk15on/1.68/bcpkix-jdk15on-1.68.jar:/root/.m2/repository/org/bouncycastle/bcprov-jdk15on/1.68/bcprov-jdk15on-1.68.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-netflix-eureka-server/3.1.2/spring-cloud-netflix-eureka-server-3.1.2.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-freemarker/2.6.8/spring-boot-starter-freemarker-2.6.8.jar:/root/.m2/repository/org/freemarker/freemarker/2.3.31/freemarker-2.3.31.jar:/root/.m2/repository/org/springframework/spring-context-support/5.3.20/spring-context-support-5.3.20.jar:/root/.m2/repository/com/sun/jersey/jersey-servlet/1.19.4/jersey-servlet-1.19.4.jar:/root/.m2/repository/com/sun/jersey/jersey-server/1.19.4/jersey-server-1.19.4.jar:/root/.m2/repository/javax/inject/javax.inject/1/javax.inject-1.jar:/root/.m2/repository/com/fasterxml/jackson/dataformat/jackson-dataformat-xml/2.13.3/jackson-dataformat-xml-2.13.3.jar:/root/.m2/repository/org/codehaus/woodstox/stax2-api/4.2.1/stax2-api-4.2.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-loadbalancer/3.1.2/spring-cloud-starter-loadbalancer-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-loadbalancer/3.1.2/spring-cloud-loadbalancer-3.1.2.jar:/root/.m2/repository/io/projectreactor/reactor-core/3.4.18/reactor-core-3.4.18.jar:/root/.m2/repository/org/reactivestreams/reactive-streams/1.0.3/reactive-streams-1.0.3.jar:/root/.m2/repository/io/projectreactor/addons/reactor-extra/3.4.8/reactor-extra-3.4.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-cache/2.6.8/spring-boot-starter-cache-2.6.8.jar:/root/.m2/repository/com/stoyanr/evictor/1.0.0/evictor-1.0.0.jar:/root/.m2/repository/com/sun/jersey/contribs/jersey-apache-client4/1.19.4/jersey-apache-client4-1.19.4.jar:/root/.m2/repository/org/apache/httpcomponents/httpclient/4.5.13/httpclient-4.5.13.jar:/root/.m2/repository/org/apache/httpcomponents/httpcore/4.4.15/httpcore-4.4.15.jar:/root/.m2/repository/commons-codec/commons-codec/1.15/commons-codec-1.15.jar:/root/.m2/repository/com/sun/jersey/jersey-client/1.19.4/jersey-client-1.19.4.jar:/root/.m2/repository/com/sun/jersey/jersey-core/1.19.4/jersey-core-1.19.4.jar:/root/.m2/repository/com/alibaba/nacos/nacos-api/1.4.0/nacos-api-1.4.0.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.13.3/jackson-core-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-databind/2.13.3/jackson-databind-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-annotations/2.13.3/jackson-annotations-2.13.3.jar:/root/.m2/repository/org/apache/commons/commons-lang3/3.12.0/commons-lang3-3.12.0.jar:/root/.m2/repository/com/google/guava/guava/31.0.1-jre/guava-31.0.1-jre.jar:/root/.m2/repository/com/google/guava/failureaccess/1.0.1/failureaccess-1.0.1.jar:/root/.m2/repository/com/google/guava/listenablefuture/9999.0-empty-to-avoid-conflict-with-guava/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar:/root/.m2/repository/com/google/code/findbugs/jsr305/3.0.2/jsr305-3.0.2.jar:/root/.m2/repository/org/checkerframework/checker-qual/3.12.0/checker-qual-3.12.0.jar:/root/.m2/repository/com/google/errorprone/error_prone_annotations/2.7.1/error_prone_annotations-2.7.1.jar:/root/.m2/repository/com/google/j2objc/j2objc-annotations/1.3/j2objc-annotations-1.3.jar:/root/.m2/repository/com/h2database/h2/1.4.191/h2-1.4.191.jar:/root/.m2/repository/javax/xml/bind/jaxb-api/2.3.1/jaxb-api-2.3.1.jar:/root/.m2/repository/javax/activation/javax.activation-api/1.2.0/javax.activation-api-1.2.0.jar:/root/.m2/repository/com/sun/xml/bind/jaxb-impl/2.3.1/jaxb-impl-2.3.1.jar:/root/.m2/repository/org/glassfish/jaxb/jaxb-runtime/2.3.1/jaxb-runtime-2.3.1.jar:/root/.m2/repository/org/glassfish/jaxb/txw2/2.3.6/txw2-2.3.6.jar:/root/.m2/repository/com/sun/istack/istack-commons-runtime/3.0.7/istack-commons-runtime-3.0.7.jar:/root/.m2/repository/org/jvnet/staxex/stax-ex/1.8/stax-ex-1.8.jar:/root/.m2/repository/com/sun/xml/fastinfoset/FastInfoset/1.2.15/FastInfoset-1.2.15.jar:/root/.m2/repository/javax/activation/activation/1.1.1/activation-1.1.1.jar:/root/.m2/repository/org/javassist/javassist/3.23.1-GA/javassist-3.23.1-GA.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-test/2.6.8/spring-boot-starter-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test/2.6.8/spring-boot-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot/2.6.8/spring-boot-2.6.8.jar:/root/.m2/repository/org/springframework/spring-context/5.3.20/spring-context-5.3.20.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test-autoconfigure/2.6.8/spring-boot-test-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-autoconfigure/2.6.8/spring-boot-autoconfigure-2.6.8.jar:/root/.m2/repository/com/jayway/jsonpath/json-path/2.6.0/json-path-2.6.0.jar:/root/.m2/repository/net/minidev/json-smart/2.4.8/json-smart-2.4.8.jar:/root/.m2/repository/net/minidev/accessors-smart/2.4.8/accessors-smart-2.4.8.jar:/root/.m2/repository/org/ow2/asm/asm/9.1/asm-9.1.jar:/root/.m2/repository/org/slf4j/slf4j-api/1.7.21/slf4j-api-1.7.21.jar:/root/.m2/repository/jakarta/xml/bind/jakarta.xml.bind-api/2.3.3/jakarta.xml.bind-api-2.3.3.jar:/root/.m2/repository/jakarta/activation/jakarta.activation-api/1.2.2/jakarta.activation-api-1.2.2.jar:/root/.m2/repository/org/assertj/assertj-core/3.21.0/assertj-core-3.21.0.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter/5.8.2/junit-jupiter-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-api/5.8.2/junit-jupiter-api-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-params/5.8.2/junit-jupiter-params-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-engine/5.8.2/junit-jupiter-engine-5.8.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar:/root/.m2/repository/org/mockito/mockito-junit-jupiter/4.0.0/mockito-junit-jupiter-4.0.0.jar:/root/.m2/repository/org/skyscreamer/jsonassert/1.5.0/jsonassert-1.5.0.jar:/root/.m2/repository/com/vaadin/external/google/android-json/0.0.20131108.vaadin1/android-json-0.0.20131108.vaadin1.jar:/root/.m2/repository/org/springframework/spring-core/5.3.20/spring-core-5.3.20.jar:/root/.m2/repository/org/springframework/spring-jcl/5.3.20/spring-jcl-5.3.20.jar:/root/.m2/repository/org/springframework/spring-test/5.3.20/spring-test-5.3.20.jar:/root/.m2/repository/org/xmlunit/xmlunit-core/2.8.4/xmlunit-core-2.8.4.jar:/root/.m2/repository/org/awaitility/awaitility/4.0.3/awaitility-4.0.3.jar:/root/.m2/repository/org/junit/vintage/junit-vintage-engine/5.7.0/junit-vintage-engine-5.7.0.jar:/root/.m2/repository/org/apiguardian/apiguardian-api/1.1.0/apiguardian-api-1.1.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-engine/1.8.2/junit-platform-engine-1.8.2.jar:/root/.m2/repository/org/opentest4j/opentest4j/1.2.0/opentest4j-1.2.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-commons/1.8.2/junit-platform-commons-1.8.2.jar:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:"/>
apollo-configservice/target/surefire-reports/TEST-com.ctrip.framework.apollo.configservice.controller.ConfigControllerTest.xml:21:    <property name="surefire.test.class.path" value="/testbed/apollo-configservice/target/test-classes:/testbed/apollo-configservice/target/classes:/testbed/apollo-biz/target/classes:/testbed/apollo-common/target/classes:/testbed/apollo-core/target/classes:/root/.m2/repository/com/google/code/gson/gson/2.8.9/gson-2.8.9.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-actuator/2.6.8/spring-boot-starter-actuator-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator-autoconfigure/2.6.8/spring-boot-actuator-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator/2.6.8/spring-boot-actuator-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jsr310/2.13.3/jackson-datatype-jsr310-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-web/2.6.8/spring-boot-starter-web-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-json/2.6.8/spring-boot-starter-json-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jdk8/2.13.3/jackson-datatype-jdk8-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/module/jackson-module-parameter-names/2.13.3/jackson-module-parameter-names-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-tomcat/2.6.8/spring-boot-starter-tomcat-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-core/9.0.63/tomcat-embed-core-9.0.63.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-websocket/9.0.63/tomcat-embed-websocket-9.0.63.jar:/root/.m2/repository/org/springframework/spring-web/5.3.20/spring-web-5.3.20.jar:/root/.m2/repository/org/springframework/spring-webmvc/5.3.20/spring-webmvc-5.3.20.jar:/root/.m2/repository/org/springframework/spring-expression/5.3.20/spring-expression-5.3.20.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-validation/2.6.8/spring-boot-starter-validation-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-el/9.0.63/tomcat-embed-el-9.0.63.jar:/root/.m2/repository/org/hibernate/validator/hibernate-validator/6.2.3.Final/hibernate-validator-6.2.3.Final.jar:/root/.m2/repository/jakarta/validation/jakarta.validation-api/2.0.2/jakarta.validation-api-2.0.2.jar:/root/.m2/repository/org/jboss/logging/jboss-logging/3.4.3.Final/jboss-logging-3.4.3.Final.jar:/root/.m2/repository/com/fasterxml/classmate/1.5.1/classmate-1.5.1.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-security/2.6.8/spring-boot-starter-security-2.6.8.jar:/root/.m2/repository/org/springframework/spring-aop/5.3.20/spring-aop-5.3.20.jar:/root/.m2/repository/org/springframework/security/spring-security-config/5.7.3/spring-security-config-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-core/5.7.3/spring-security-core-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-crypto/5.7.3/spring-security-crypto-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-web/5.7.3/spring-security-web-5.7.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-data-jpa/2.6.8/spring-boot-starter-data-jpa-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-aop/2.6.8/spring-boot-starter-aop-2.6.8.jar:/root/.m2/repository/org/aspectj/aspectjweaver/1.9.7/aspectjweaver-1.9.7.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-jdbc/2.6.8/spring-boot-starter-jdbc-2.6.8.jar:/root/.m2/repository/com/zaxxer/HikariCP/4.0.3/HikariCP-4.0.3.jar:/root/.m2/repository/org/springframework/spring-jdbc/5.3.20/spring-jdbc-5.3.20.jar:/root/.m2/repository/jakarta/transaction/jakarta.transaction-api/1.3.3/jakarta.transaction-api-1.3.3.jar:/root/.m2/repository/jakarta/persistence/jakarta.persistence-api/2.2.3/jakarta.persistence-api-2.2.3.jar:/root/.m2/repository/org/hibernate/hibernate-core/5.6.9.Final/hibernate-core-5.6.9.Final.jar:/root/.m2/repository/antlr/antlr/2.7.7/antlr-2.7.7.jar:/root/.m2/repository/org/jboss/jandex/2.4.2.Final/jandex-2.4.2.Final.jar:/root/.m2/repository/org/hibernate/common/hibernate-commons-annotations/5.1.2.Final/hibernate-commons-annotations-5.1.2.Final.jar:/root/.m2/repository/org/springframework/data/spring-data-jpa/2.6.4/spring-data-jpa-2.6.4.jar:/root/.m2/repository/org/springframework/spring-orm/5.3.20/spring-orm-5.3.20.jar:/root/.m2/repository/org/springframework/spring-tx/5.3.20/spring-tx-5.3.20.jar:/root/.m2/repository/org/springframework/spring-aspects/5.3.20/spring-aspects-5.3.20.jar:/root/.m2/repository/mysql/mysql-connector-java/8.0.29/mysql-connector-java-8.0.29.jar:/root/.m2/repository/com/google/protobuf/protobuf-java/3.19.4/protobuf-java-3.19.4.jar:/root/.m2/repository/org/springframework/data/spring-data-commons/2.6.4/spring-data-commons-2.6.4.jar:/root/.m2/repository/org/springframework/spring-beans/5.3.20/spring-beans-5.3.20.jar:/root/.m2/repository/org/codehaus/janino/janino/3.1.7/janino-3.1.7.jar:/root/.m2/repository/org/codehaus/janino/commons-compiler/3.1.7/commons-compiler-3.1.7.jar:/root/.m2/repository/io/micrometer/micrometer-core/1.8.6/micrometer-core-1.8.6.jar:/root/.m2/repository/org/hdrhistogram/HdrHistogram/2.1.12/HdrHistogram-2.1.12.jar:/root/.m2/repository/org/latencyutils/LatencyUtils/2.0.3/LatencyUtils-2.0.3.jar:/root/.m2/repository/io/micrometer/micrometer-registry-prometheus/1.8.6/micrometer-registry-prometheus-1.8.6.jar:/root/.m2/repository/io/prometheus/simpleclient_common/0.12.0/simpleclient_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient/0.12.0/simpleclient-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel/0.12.0/simpleclient_tracer_otel-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_common/0.12.0/simpleclient_tracer_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel_agent/0.12.0/simpleclient_tracer_otel_agent-0.12.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-netflix-eureka-client/3.1.2/spring-cloud-starter-netflix-eureka-client-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-netflix-eureka-client/3.1.2/spring-cloud-netflix-eureka-client-3.1.2.jar:/root/.m2/repository/com/netflix/eureka/eureka-client/1.10.17/eureka-client-1.10.17.jar:/root/.m2/repository/com/netflix/netflix-commons/netflix-eventbus/0.3.0/netflix-eventbus-0.3.0.jar:/root/.m2/repository/com/netflix/netflix-commons/netflix-infix/0.3.0/netflix-infix-0.3.0.jar:/root/.m2/repository/commons-jxpath/commons-jxpath/1.3/commons-jxpath-1.3.jar:/root/.m2/repository/joda-time/joda-time/2.3/joda-time-2.3.jar:/root/.m2/repository/org/antlr/antlr-runtime/3.4/antlr-runtime-3.4.jar:/root/.m2/repository/org/antlr/stringtemplate/3.2.1/stringtemplate-3.2.1.jar:/root/.m2/repository/org/apache/commons/commons-math/2.2/commons-math-2.2.jar:/root/.m2/repository/com/thoughtworks/xstream/xstream/1.4.19/xstream-1.4.19.jar:/root/.m2/repository/io/github/x-stream/mxparser/1.2.2/mxparser-1.2.2.jar:/root/.m2/repository/xmlpull/xmlpull/1.1.3.1/xmlpull-1.1.3.1.jar:/root/.m2/repository/javax/ws/rs/jsr311-api/1.1.1/jsr311-api-1.1.1.jar:/root/.m2/repository/com/netflix/servo/servo-core/0.12.21/servo-core-0.12.21.jar:/root/.m2/repository/commons-configuration/commons-configuration/1.10/commons-configuration-1.10.jar:/root/.m2/repository/commons-lang/commons-lang/2.6/commons-lang-2.6.jar:/root/.m2/repository/com/google/inject/guice/5.0.1/guice-5.0.1.jar:/root/.m2/repository/org/codehaus/jettison/jettison/1.4.0/jettison-1.4.0.jar:/root/.m2/repository/com/netflix/eureka/eureka-core/1.10.17/eureka-core-1.10.17.jar:/root/.m2/repository/com/fasterxml/woodstox/woodstox-core/6.2.1/woodstox-core-6.2.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-consul-discovery/3.1.0/spring-cloud-starter-consul-discovery-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-consul/3.1.0/spring-cloud-starter-consul-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-consul-core/3.1.0/spring-cloud-consul-core-3.1.0.jar:/root/.m2/repository/com/ecwid/consul/consul-api/1.4.5/consul-api-1.4.5.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-consul-discovery/3.1.0/spring-cloud-consul-discovery-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-zookeeper-discovery/3.1.1/spring-cloud-starter-zookeeper-discovery-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-zookeeper/3.1.1/spring-cloud-starter-zookeeper-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-zookeeper-core/3.1.1/spring-cloud-zookeeper-core-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-zookeeper-discovery/3.1.1/spring-cloud-zookeeper-discovery-3.1.1.jar:/root/.m2/repository/org/apache/curator/curator-x-discovery/5.1.0/curator-x-discovery-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-recipes/5.1.0/curator-recipes-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-framework/5.1.0/curator-framework-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-client/5.1.0/curator-client-5.1.0.jar:/root/.m2/repository/org/apache/zookeeper/zookeeper/3.6.0/zookeeper-3.6.0.jar:/root/.m2/repository/org/apache/zookeeper/zookeeper-jute/3.6.0/zookeeper-jute-3.6.0.jar:/root/.m2/repository/org/apache/yetus/audience-annotations/0.5.0/audience-annotations-0.5.0.jar:/root/.m2/repository/io/netty/netty-handler/4.1.77.Final/netty-handler-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-common/4.1.77.Final/netty-common-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-resolver/4.1.77.Final/netty-resolver-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-buffer/4.1.77.Final/netty-buffer-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport/4.1.77.Final/netty-transport-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-codec/4.1.77.Final/netty-codec-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-native-epoll/4.1.77.Final/netty-transport-native-epoll-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-native-unix-common/4.1.77.Final/netty-transport-native-unix-common-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-classes-epoll/4.1.77.Final/netty-transport-classes-epoll-4.1.77.Final.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-netflix-eureka-server/3.1.2/spring-cloud-starter-netflix-eureka-server-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter/3.1.2/spring-cloud-starter-3.1.2.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter/2.6.8/spring-boot-starter-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-logging/2.6.8/spring-boot-starter-logging-2.6.8.jar:/root/.m2/repository/ch/qos/logback/logback-classic/1.2.11/logback-classic-1.2.11.jar:/root/.m2/repository/ch/qos/logback/logback-core/1.2.11/logback-core-1.2.11.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-to-slf4j/2.17.2/log4j-to-slf4j-2.17.2.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-api/2.17.2/log4j-api-2.17.2.jar:/root/.m2/repository/org/slf4j/jul-to-slf4j/1.7.36/jul-to-slf4j-1.7.36.jar:/root/.m2/repository/jakarta/annotation/jakarta.annotation-api/1.3.5/jakarta.annotation-api-1.3.5.jar:/root/.m2/repository/org/yaml/snakeyaml/1.29/snakeyaml-1.29.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-context/3.1.2/spring-cloud-context-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-commons/3.1.2/spring-cloud-commons-3.1.2.jar:/root/.m2/repository/org/springframework/security/spring-security-rsa/1.0.10.RELEASE/spring-security-rsa-1.0.10.RELEASE.jar:/root/.m2/repository/org/bouncycastle/bcpkix-jdk15on/1.68/bcpkix-jdk15on-1.68.jar:/root/.m2/repository/org/bouncycastle/bcprov-jdk15on/1.68/bcprov-jdk15on-1.68.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-netflix-eureka-server/3.1.2/spring-cloud-netflix-eureka-server-3.1.2.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-freemarker/2.6.8/spring-boot-starter-freemarker-2.6.8.jar:/root/.m2/repository/org/freemarker/freemarker/2.3.31/freemarker-2.3.31.jar:/root/.m2/repository/org/springframework/spring-context-support/5.3.20/spring-context-support-5.3.20.jar:/root/.m2/repository/com/sun/jersey/jersey-servlet/1.19.4/jersey-servlet-1.19.4.jar:/root/.m2/repository/com/sun/jersey/jersey-server/1.19.4/jersey-server-1.19.4.jar:/root/.m2/repository/javax/inject/javax.inject/1/javax.inject-1.jar:/root/.m2/repository/com/fasterxml/jackson/dataformat/jackson-dataformat-xml/2.13.3/jackson-dataformat-xml-2.13.3.jar:/root/.m2/repository/org/codehaus/woodstox/stax2-api/4.2.1/stax2-api-4.2.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-loadbalancer/3.1.2/spring-cloud-starter-loadbalancer-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-loadbalancer/3.1.2/spring-cloud-loadbalancer-3.1.2.jar:/root/.m2/repository/io/projectreactor/reactor-core/3.4.18/reactor-core-3.4.18.jar:/root/.m2/repository/org/reactivestreams/reactive-streams/1.0.3/reactive-streams-1.0.3.jar:/root/.m2/repository/io/projectreactor/addons/reactor-extra/3.4.8/reactor-extra-3.4.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-cache/2.6.8/spring-boot-starter-cache-2.6.8.jar:/root/.m2/repository/com/stoyanr/evictor/1.0.0/evictor-1.0.0.jar:/root/.m2/repository/com/sun/jersey/contribs/jersey-apache-client4/1.19.4/jersey-apache-client4-1.19.4.jar:/root/.m2/repository/org/apache/httpcomponents/httpclient/4.5.13/httpclient-4.5.13.jar:/root/.m2/repository/org/apache/httpcomponents/httpcore/4.4.15/httpcore-4.4.15.jar:/root/.m2/repository/commons-codec/commons-codec/1.15/commons-codec-1.15.jar:/root/.m2/repository/com/sun/jersey/jersey-client/1.19.4/jersey-client-1.19.4.jar:/root/.m2/repository/com/sun/jersey/jersey-core/1.19.4/jersey-core-1.19.4.jar:/root/.m2/repository/com/alibaba/nacos/nacos-api/1.4.0/nacos-api-1.4.0.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.13.3/jackson-core-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-databind/2.13.3/jackson-databind-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-annotations/2.13.3/jackson-annotations-2.13.3.jar:/root/.m2/repository/org/apache/commons/commons-lang3/3.12.0/commons-lang3-3.12.0.jar:/root/.m2/repository/com/google/guava/guava/31.0.1-jre/guava-31.0.1-jre.jar:/root/.m2/repository/com/google/guava/failureaccess/1.0.1/failureaccess-1.0.1.jar:/root/.m2/repository/com/google/guava/listenablefuture/9999.0-empty-to-avoid-conflict-with-guava/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar:/root/.m2/repository/com/google/code/findbugs/jsr305/3.0.2/jsr305-3.0.2.jar:/root/.m2/repository/org/checkerframework/checker-qual/3.12.0/checker-qual-3.12.0.jar:/root/.m2/repository/com/google/errorprone/error_prone_annotations/2.7.1/error_prone_annotations-2.7.1.jar:/root/.m2/repository/com/google/j2objc/j2objc-annotations/1.3/j2objc-annotations-1.3.jar:/root/.m2/repository/com/h2database/h2/1.4.191/h2-1.4.191.jar:/root/.m2/repository/javax/xml/bind/jaxb-api/2.3.1/jaxb-api-2.3.1.jar:/root/.m2/repository/javax/activation/javax.activation-api/1.2.0/javax.activation-api-1.2.0.jar:/root/.m2/repository/com/sun/xml/bind/jaxb-impl/2.3.1/jaxb-impl-2.3.1.jar:/root/.m2/repository/org/glassfish/jaxb/jaxb-runtime/2.3.1/jaxb-runtime-2.3.1.jar:/root/.m2/repository/org/glassfish/jaxb/txw2/2.3.6/txw2-2.3.6.jar:/root/.m2/repository/com/sun/istack/istack-commons-runtime/3.0.7/istack-commons-runtime-3.0.7.jar:/root/.m2/repository/org/jvnet/staxex/stax-ex/1.8/stax-ex-1.8.jar:/root/.m2/repository/com/sun/xml/fastinfoset/FastInfoset/1.2.15/FastInfoset-1.2.15.jar:/root/.m2/repository/javax/activation/activation/1.1.1/activation-1.1.1.jar:/root/.m2/repository/org/javassist/javassist/3.23.1-GA/javassist-3.23.1-GA.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-test/2.6.8/spring-boot-starter-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test/2.6.8/spring-boot-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot/2.6.8/spring-boot-2.6.8.jar:/root/.m2/repository/org/springframework/spring-context/5.3.20/spring-context-5.3.20.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test-autoconfigure/2.6.8/spring-boot-test-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-autoconfigure/2.6.8/spring-boot-autoconfigure-2.6.8.jar:/root/.m2/repository/com/jayway/jsonpath/json-path/2.6.0/json-path-2.6.0.jar:/root/.m2/repository/net/minidev/json-smart/2.4.8/json-smart-2.4.8.jar:/root/.m2/repository/net/minidev/accessors-smart/2.4.8/accessors-smart-2.4.8.jar:/root/.m2/repository/org/ow2/asm/asm/9.1/asm-9.1.jar:/root/.m2/repository/org/slf4j/slf4j-api/1.7.21/slf4j-api-1.7.21.jar:/root/.m2/repository/jakarta/xml/bind/jakarta.xml.bind-api/2.3.3/jakarta.xml.bind-api-2.3.3.jar:/root/.m2/repository/jakarta/activation/jakarta.activation-api/1.2.2/jakarta.activation-api-1.2.2.jar:/root/.m2/repository/org/assertj/assertj-core/3.21.0/assertj-core-3.21.0.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter/5.8.2/junit-jupiter-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-api/5.8.2/junit-jupiter-api-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-params/5.8.2/junit-jupiter-params-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-engine/5.8.2/junit-jupiter-engine-5.8.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar:/root/.m2/repository/org/mockito/mockito-junit-jupiter/4.0.0/mockito-junit-jupiter-4.0.0.jar:/root/.m2/repository/org/skyscreamer/jsonassert/1.5.0/jsonassert-1.5.0.jar:/root/.m2/repository/com/vaadin/external/google/android-json/0.0.20131108.vaadin1/android-json-0.0.20131108.vaadin1.jar:/root/.m2/repository/org/springframework/spring-core/5.3.20/spring-core-5.3.20.jar:/root/.m2/repository/org/springframework/spring-jcl/5.3.20/spring-jcl-5.3.20.jar:/root/.m2/repository/org/springframework/spring-test/5.3.20/spring-test-5.3.20.jar:/root/.m2/repository/org/xmlunit/xmlunit-core/2.8.4/xmlunit-core-2.8.4.jar:/root/.m2/repository/org/awaitility/awaitility/4.0.3/awaitility-4.0.3.jar:/root/.m2/repository/org/junit/vintage/junit-vintage-engine/5.7.0/junit-vintage-engine-5.7.0.jar:/root/.m2/repository/org/apiguardian/apiguardian-api/1.1.0/apiguardian-api-1.1.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-engine/1.8.2/junit-platform-engine-1.8.2.jar:/root/.m2/repository/org/opentest4j/opentest4j/1.2.0/opentest4j-1.2.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-commons/1.8.2/junit-platform-commons-1.8.2.jar:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:"/>
apollo-configservice/target/surefire-reports/TEST-com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest.xml:9:    <property name="java.class.path" value="/testbed/apollo-configservice/target/test-classes:/testbed/apollo-configservice/target/classes:/testbed/apollo-biz/target/classes:/testbed/apollo-common/target/classes:/testbed/apollo-core/target/classes:/root/.m2/repository/com/google/code/gson/gson/2.8.9/gson-2.8.9.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-actuator/2.6.8/spring-boot-starter-actuator-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator-autoconfigure/2.6.8/spring-boot-actuator-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator/2.6.8/spring-boot-actuator-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jsr310/2.13.3/jackson-datatype-jsr310-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-web/2.6.8/spring-boot-starter-web-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-json/2.6.8/spring-boot-starter-json-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jdk8/2.13.3/jackson-datatype-jdk8-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/module/jackson-module-parameter-names/2.13.3/jackson-module-parameter-names-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-tomcat/2.6.8/spring-boot-starter-tomcat-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-core/9.0.63/tomcat-embed-core-9.0.63.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-websocket/9.0.63/tomcat-embed-websocket-9.0.63.jar:/root/.m2/repository/org/springframework/spring-web/5.3.20/spring-web-5.3.20.jar:/root/.m2/repository/org/springframework/spring-webmvc/5.3.20/spring-webmvc-5.3.20.jar:/root/.m2/repository/org/springframework/spring-expression/5.3.20/spring-expression-5.3.20.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-validation/2.6.8/spring-boot-starter-validation-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-el/9.0.63/tomcat-embed-el-9.0.63.jar:/root/.m2/repository/org/hibernate/validator/hibernate-validator/6.2.3.Final/hibernate-validator-6.2.3.Final.jar:/root/.m2/repository/jakarta/validation/jakarta.validation-api/2.0.2/jakarta.validation-api-2.0.2.jar:/root/.m2/repository/org/jboss/logging/jboss-logging/3.4.3.Final/jboss-logging-3.4.3.Final.jar:/root/.m2/repository/com/fasterxml/classmate/1.5.1/classmate-1.5.1.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-security/2.6.8/spring-boot-starter-security-2.6.8.jar:/root/.m2/repository/org/springframework/spring-aop/5.3.20/spring-aop-5.3.20.jar:/root/.m2/repository/org/springframework/security/spring-security-config/5.7.3/spring-security-config-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-core/5.7.3/spring-security-core-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-crypto/5.7.3/spring-security-crypto-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-web/5.7.3/spring-security-web-5.7.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-data-jpa/2.6.8/spring-boot-starter-data-jpa-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-aop/2.6.8/spring-boot-starter-aop-2.6.8.jar:/root/.m2/repository/org/aspectj/aspectjweaver/1.9.7/aspectjweaver-1.9.7.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-jdbc/2.6.8/spring-boot-starter-jdbc-2.6.8.jar:/root/.m2/repository/com/zaxxer/HikariCP/4.0.3/HikariCP-4.0.3.jar:/root/.m2/repository/org/springframework/spring-jdbc/5.3.20/spring-jdbc-5.3.20.jar:/root/.m2/repository/jakarta/transaction/jakarta.transaction-api/1.3.3/jakarta.transaction-api-1.3.3.jar:/root/.m2/repository/jakarta/persistence/jakarta.persistence-api/2.2.3/jakarta.persistence-api-2.2.3.jar:/root/.m2/repository/org/hibernate/hibernate-core/5.6.9.Final/hibernate-core-5.6.9.Final.jar:/root/.m2/repository/antlr/antlr/2.7.7/antlr-2.7.7.jar:/root/.m2/repository/org/jboss/jandex/2.4.2.Final/jandex-2.4.2.Final.jar:/root/.m2/repository/org/hibernate/common/hibernate-commons-annotations/5.1.2.Final/hibernate-commons-annotations-5.1.2.Final.jar:/root/.m2/repository/org/springframework/data/spring-data-jpa/2.6.4/spring-data-jpa-2.6.4.jar:/root/.m2/repository/org/springframework/spring-orm/5.3.20/spring-orm-5.3.20.jar:/root/.m2/repository/org/springframework/spring-tx/5.3.20/spring-tx-5.3.20.jar:/root/.m2/repository/org/springframework/spring-aspects/5.3.20/spring-aspects-5.3.20.jar:/root/.m2/repository/mysql/mysql-connector-java/8.0.29/mysql-connector-java-8.0.29.jar:/root/.m2/repository/com/google/protobuf/protobuf-java/3.19.4/protobuf-java-3.19.4.jar:/root/.m2/repository/org/springframework/data/spring-data-commons/2.6.4/spring-data-commons-2.6.4.jar:/root/.m2/repository/org/springframework/spring-beans/5.3.20/spring-beans-5.3.20.jar:/root/.m2/repository/org/codehaus/janino/janino/3.1.7/janino-3.1.7.jar:/root/.m2/repository/org/codehaus/janino/commons-compiler/3.1.7/commons-compiler-3.1.7.jar:/root/.m2/repository/io/micrometer/micrometer-core/1.8.6/micrometer-core-1.8.6.jar:/root/.m2/repository/org/hdrhistogram/HdrHistogram/2.1.12/HdrHistogram-2.1.12.jar:/root/.m2/repository/org/latencyutils/LatencyUtils/2.0.3/LatencyUtils-2.0.3.jar:/root/.m2/repository/io/micrometer/micrometer-registry-prometheus/1.8.6/micrometer-registry-prometheus-1.8.6.jar:/root/.m2/repository/io/prometheus/simpleclient_common/0.12.0/simpleclient_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient/0.12.0/simpleclient-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel/0.12.0/simpleclient_tracer_otel-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_common/0.12.0/simpleclient_tracer_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel_agent/0.12.0/simpleclient_tracer_otel_agent-0.12.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-netflix-eureka-client/3.1.2/spring-cloud-starter-netflix-eureka-client-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-netflix-eureka-client/3.1.2/spring-cloud-netflix-eureka-client-3.1.2.jar:/root/.m2/repository/com/netflix/eureka/eureka-client/1.10.17/eureka-client-1.10.17.jar:/root/.m2/repository/com/netflix/netflix-commons/netflix-eventbus/0.3.0/netflix-eventbus-0.3.0.jar:/root/.m2/repository/com/netflix/netflix-commons/netflix-infix/0.3.0/netflix-infix-0.3.0.jar:/root/.m2/repository/commons-jxpath/commons-jxpath/1.3/commons-jxpath-1.3.jar:/root/.m2/repository/joda-time/joda-time/2.3/joda-time-2.3.jar:/root/.m2/repository/org/antlr/antlr-runtime/3.4/antlr-runtime-3.4.jar:/root/.m2/repository/org/antlr/stringtemplate/3.2.1/stringtemplate-3.2.1.jar:/root/.m2/repository/org/apache/commons/commons-math/2.2/commons-math-2.2.jar:/root/.m2/repository/com/thoughtworks/xstream/xstream/1.4.19/xstream-1.4.19.jar:/root/.m2/repository/io/github/x-stream/mxparser/1.2.2/mxparser-1.2.2.jar:/root/.m2/repository/xmlpull/xmlpull/1.1.3.1/xmlpull-1.1.3.1.jar:/root/.m2/repository/javax/ws/rs/jsr311-api/1.1.1/jsr311-api-1.1.1.jar:/root/.m2/repository/com/netflix/servo/servo-core/0.12.21/servo-core-0.12.21.jar:/root/.m2/repository/commons-configuration/commons-configuration/1.10/commons-configuration-1.10.jar:/root/.m2/repository/commons-lang/commons-lang/2.6/commons-lang-2.6.jar:/root/.m2/repository/com/google/inject/guice/5.0.1/guice-5.0.1.jar:/root/.m2/repository/org/codehaus/jettison/jettison/1.4.0/jettison-1.4.0.jar:/root/.m2/repository/com/netflix/eureka/eureka-core/1.10.17/eureka-core-1.10.17.jar:/root/.m2/repository/com/fasterxml/woodstox/woodstox-core/6.2.1/woodstox-core-6.2.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-consul-discovery/3.1.0/spring-cloud-starter-consul-discovery-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-consul/3.1.0/spring-cloud-starter-consul-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-consul-core/3.1.0/spring-cloud-consul-core-3.1.0.jar:/root/.m2/repository/com/ecwid/consul/consul-api/1.4.5/consul-api-1.4.5.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-consul-discovery/3.1.0/spring-cloud-consul-discovery-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-zookeeper-discovery/3.1.1/spring-cloud-starter-zookeeper-discovery-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-zookeeper/3.1.1/spring-cloud-starter-zookeeper-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-zookeeper-core/3.1.1/spring-cloud-zookeeper-core-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-zookeeper-discovery/3.1.1/spring-cloud-zookeeper-discovery-3.1.1.jar:/root/.m2/repository/org/apache/curator/curator-x-discovery/5.1.0/curator-x-discovery-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-recipes/5.1.0/curator-recipes-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-framework/5.1.0/curator-framework-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-client/5.1.0/curator-client-5.1.0.jar:/root/.m2/repository/org/apache/zookeeper/zookeeper/3.6.0/zookeeper-3.6.0.jar:/root/.m2/repository/org/apache/zookeeper/zookeeper-jute/3.6.0/zookeeper-jute-3.6.0.jar:/root/.m2/repository/org/apache/yetus/audience-annotations/0.5.0/audience-annotations-0.5.0.jar:/root/.m2/repository/io/netty/netty-handler/4.1.77.Final/netty-handler-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-common/4.1.77.Final/netty-common-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-resolver/4.1.77.Final/netty-resolver-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-buffer/4.1.77.Final/netty-buffer-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport/4.1.77.Final/netty-transport-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-codec/4.1.77.Final/netty-codec-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-native-epoll/4.1.77.Final/netty-transport-native-epoll-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-native-unix-common/4.1.77.Final/netty-transport-native-unix-common-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-classes-epoll/4.1.77.Final/netty-transport-classes-epoll-4.1.77.Final.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-netflix-eureka-server/3.1.2/spring-cloud-starter-netflix-eureka-server-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter/3.1.2/spring-cloud-starter-3.1.2.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter/2.6.8/spring-boot-starter-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-logging/2.6.8/spring-boot-starter-logging-2.6.8.jar:/root/.m2/repository/ch/qos/logback/logback-classic/1.2.11/logback-classic-1.2.11.jar:/root/.m2/repository/ch/qos/logback/logback-core/1.2.11/logback-core-1.2.11.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-to-slf4j/2.17.2/log4j-to-slf4j-2.17.2.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-api/2.17.2/log4j-api-2.17.2.jar:/root/.m2/repository/org/slf4j/jul-to-slf4j/1.7.36/jul-to-slf4j-1.7.36.jar:/root/.m2/repository/jakarta/annotation/jakarta.annotation-api/1.3.5/jakarta.annotation-api-1.3.5.jar:/root/.m2/repository/org/yaml/snakeyaml/1.29/snakeyaml-1.29.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-context/3.1.2/spring-cloud-context-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-commons/3.1.2/spring-cloud-commons-3.1.2.jar:/root/.m2/repository/org/springframework/security/spring-security-rsa/1.0.10.RELEASE/spring-security-rsa-1.0.10.RELEASE.jar:/root/.m2/repository/org/bouncycastle/bcpkix-jdk15on/1.68/bcpkix-jdk15on-1.68.jar:/root/.m2/repository/org/bouncycastle/bcprov-jdk15on/1.68/bcprov-jdk15on-1.68.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-netflix-eureka-server/3.1.2/spring-cloud-netflix-eureka-server-3.1.2.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-freemarker/2.6.8/spring-boot-starter-freemarker-2.6.8.jar:/root/.m2/repository/org/freemarker/freemarker/2.3.31/freemarker-2.3.31.jar:/root/.m2/repository/org/springframework/spring-context-support/5.3.20/spring-context-support-5.3.20.jar:/root/.m2/repository/com/sun/jersey/jersey-servlet/1.19.4/jersey-servlet-1.19.4.jar:/root/.m2/repository/com/sun/jersey/jersey-server/1.19.4/jersey-server-1.19.4.jar:/root/.m2/repository/javax/inject/javax.inject/1/javax.inject-1.jar:/root/.m2/repository/com/fasterxml/jackson/dataformat/jackson-dataformat-xml/2.13.3/jackson-dataformat-xml-2.13.3.jar:/root/.m2/repository/org/codehaus/woodstox/stax2-api/4.2.1/stax2-api-4.2.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-loadbalancer/3.1.2/spring-cloud-starter-loadbalancer-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-loadbalancer/3.1.2/spring-cloud-loadbalancer-3.1.2.jar:/root/.m2/repository/io/projectreactor/reactor-core/3.4.18/reactor-core-3.4.18.jar:/root/.m2/repository/org/reactivestreams/reactive-streams/1.0.3/reactive-streams-1.0.3.jar:/root/.m2/repository/io/projectreactor/addons/reactor-extra/3.4.8/reactor-extra-3.4.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-cache/2.6.8/spring-boot-starter-cache-2.6.8.jar:/root/.m2/repository/com/stoyanr/evictor/1.0.0/evictor-1.0.0.jar:/root/.m2/repository/com/sun/jersey/contribs/jersey-apache-client4/1.19.4/jersey-apache-client4-1.19.4.jar:/root/.m2/repository/org/apache/httpcomponents/httpclient/4.5.13/httpclient-4.5.13.jar:/root/.m2/repository/org/apache/httpcomponents/httpcore/4.4.15/httpcore-4.4.15.jar:/root/.m2/repository/commons-codec/commons-codec/1.15/commons-codec-1.15.jar:/root/.m2/repository/com/sun/jersey/jersey-client/1.19.4/jersey-client-1.19.4.jar:/root/.m2/repository/com/sun/jersey/jersey-core/1.19.4/jersey-core-1.19.4.jar:/root/.m2/repository/com/alibaba/nacos/nacos-api/1.4.0/nacos-api-1.4.0.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.13.3/jackson-core-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-databind/2.13.3/jackson-databind-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-annotations/2.13.3/jackson-annotations-2.13.3.jar:/root/.m2/repository/org/apache/commons/commons-lang3/3.12.0/commons-lang3-3.12.0.jar:/root/.m2/repository/com/google/guava/guava/31.0.1-jre/guava-31.0.1-jre.jar:/root/.m2/repository/com/google/guava/failureaccess/1.0.1/failureaccess-1.0.1.jar:/root/.m2/repository/com/google/guava/listenablefuture/9999.0-empty-to-avoid-conflict-with-guava/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar:/root/.m2/repository/com/google/code/findbugs/jsr305/3.0.2/jsr305-3.0.2.jar:/root/.m2/repository/org/checkerframework/checker-qual/3.12.0/checker-qual-3.12.0.jar:/root/.m2/repository/com/google/errorprone/error_prone_annotations/2.7.1/error_prone_annotations-2.7.1.jar:/root/.m2/repository/com/google/j2objc/j2objc-annotations/1.3/j2objc-annotations-1.3.jar:/root/.m2/repository/com/h2database/h2/1.4.191/h2-1.4.191.jar:/root/.m2/repository/javax/xml/bind/jaxb-api/2.3.1/jaxb-api-2.3.1.jar:/root/.m2/repository/javax/activation/javax.activation-api/1.2.0/javax.activation-api-1.2.0.jar:/root/.m2/repository/com/sun/xml/bind/jaxb-impl/2.3.1/jaxb-impl-2.3.1.jar:/root/.m2/repository/org/glassfish/jaxb/jaxb-runtime/2.3.1/jaxb-runtime-2.3.1.jar:/root/.m2/repository/org/glassfish/jaxb/txw2/2.3.6/txw2-2.3.6.jar:/root/.m2/repository/com/sun/istack/istack-commons-runtime/3.0.7/istack-commons-runtime-3.0.7.jar:/root/.m2/repository/org/jvnet/staxex/stax-ex/1.8/stax-ex-1.8.jar:/root/.m2/repository/com/sun/xml/fastinfoset/FastInfoset/1.2.15/FastInfoset-1.2.15.jar:/root/.m2/repository/javax/activation/activation/1.1.1/activation-1.1.1.jar:/root/.m2/repository/org/javassist/javassist/3.23.1-GA/javassist-3.23.1-GA.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-test/2.6.8/spring-boot-starter-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test/2.6.8/spring-boot-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot/2.6.8/spring-boot-2.6.8.jar:/root/.m2/repository/org/springframework/spring-context/5.3.20/spring-context-5.3.20.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test-autoconfigure/2.6.8/spring-boot-test-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-autoconfigure/2.6.8/spring-boot-autoconfigure-2.6.8.jar:/root/.m2/repository/com/jayway/jsonpath/json-path/2.6.0/json-path-2.6.0.jar:/root/.m2/repository/net/minidev/json-smart/2.4.8/json-smart-2.4.8.jar:/root/.m2/repository/net/minidev/accessors-smart/2.4.8/accessors-smart-2.4.8.jar:/root/.m2/repository/org/ow2/asm/asm/9.1/asm-9.1.jar:/root/.m2/repository/org/slf4j/slf4j-api/1.7.21/slf4j-api-1.7.21.jar:/root/.m2/repository/jakarta/xml/bind/jakarta.xml.bind-api/2.3.3/jakarta.xml.bind-api-2.3.3.jar:/root/.m2/repository/jakarta/activation/jakarta.activation-api/1.2.2/jakarta.activation-api-1.2.2.jar:/root/.m2/repository/org/assertj/assertj-core/3.21.0/assertj-core-3.21.0.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter/5.8.2/junit-jupiter-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-api/5.8.2/junit-jupiter-api-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-params/5.8.2/junit-jupiter-params-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-engine/5.8.2/junit-jupiter-engine-5.8.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar:/root/.m2/repository/org/mockito/mockito-junit-jupiter/4.0.0/mockito-junit-jupiter-4.0.0.jar:/root/.m2/repository/org/skyscreamer/jsonassert/1.5.0/jsonassert-1.5.0.jar:/root/.m2/repository/com/vaadin/external/google/android-json/0.0.20131108.vaadin1/android-json-0.0.20131108.vaadin1.jar:/root/.m2/repository/org/springframework/spring-core/5.3.20/spring-core-5.3.20.jar:/root/.m2/repository/org/springframework/spring-jcl/5.3.20/spring-jcl-5.3.20.jar:/root/.m2/repository/org/springframework/spring-test/5.3.20/spring-test-5.3.20.jar:/root/.m2/repository/org/xmlunit/xmlunit-core/2.8.4/xmlunit-core-2.8.4.jar:/root/.m2/repository/org/awaitility/awaitility/4.0.3/awaitility-4.0.3.jar:/root/.m2/repository/org/junit/vintage/junit-vintage-engine/5.7.0/junit-vintage-engine-5.7.0.jar:/root/.m2/repository/org/apiguardian/apiguardian-api/1.1.0/apiguardian-api-1.1.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-engine/1.8.2/junit-platform-engine-1.8.2.jar:/root/.m2/repository/org/opentest4j/opentest4j/1.2.0/opentest4j-1.2.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-commons/1.8.2/junit-platform-commons-1.8.2.jar:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:"/>
apollo-configservice/target/surefire-reports/TEST-com.ctrip.framework.apollo.configservice.util.NamespaceUtilTest.xml:21:    <property name="surefire.test.class.path" value="/testbed/apollo-configservice/target/test-classes:/testbed/apollo-configservice/target/classes:/testbed/apollo-biz/target/classes:/testbed/apollo-common/target/classes:/testbed/apollo-core/target/classes:/root/.m2/repository/com/google/code/gson/gson/2.8.9/gson-2.8.9.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-actuator/2.6.8/spring-boot-starter-actuator-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator-autoconfigure/2.6.8/spring-boot-actuator-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-actuator/2.6.8/spring-boot-actuator-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jsr310/2.13.3/jackson-datatype-jsr310-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-web/2.6.8/spring-boot-starter-web-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-json/2.6.8/spring-boot-starter-json-2.6.8.jar:/root/.m2/repository/com/fasterxml/jackson/datatype/jackson-datatype-jdk8/2.13.3/jackson-datatype-jdk8-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/module/jackson-module-parameter-names/2.13.3/jackson-module-parameter-names-2.13.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-tomcat/2.6.8/spring-boot-starter-tomcat-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-core/9.0.63/tomcat-embed-core-9.0.63.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-websocket/9.0.63/tomcat-embed-websocket-9.0.63.jar:/root/.m2/repository/org/springframework/spring-web/5.3.20/spring-web-5.3.20.jar:/root/.m2/repository/org/springframework/spring-webmvc/5.3.20/spring-webmvc-5.3.20.jar:/root/.m2/repository/org/springframework/spring-expression/5.3.20/spring-expression-5.3.20.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-validation/2.6.8/spring-boot-starter-validation-2.6.8.jar:/root/.m2/repository/org/apache/tomcat/embed/tomcat-embed-el/9.0.63/tomcat-embed-el-9.0.63.jar:/root/.m2/repository/org/hibernate/validator/hibernate-validator/6.2.3.Final/hibernate-validator-6.2.3.Final.jar:/root/.m2/repository/jakarta/validation/jakarta.validation-api/2.0.2/jakarta.validation-api-2.0.2.jar:/root/.m2/repository/org/jboss/logging/jboss-logging/3.4.3.Final/jboss-logging-3.4.3.Final.jar:/root/.m2/repository/com/fasterxml/classmate/1.5.1/classmate-1.5.1.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-security/2.6.8/spring-boot-starter-security-2.6.8.jar:/root/.m2/repository/org/springframework/spring-aop/5.3.20/spring-aop-5.3.20.jar:/root/.m2/repository/org/springframework/security/spring-security-config/5.7.3/spring-security-config-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-core/5.7.3/spring-security-core-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-crypto/5.7.3/spring-security-crypto-5.7.3.jar:/root/.m2/repository/org/springframework/security/spring-security-web/5.7.3/spring-security-web-5.7.3.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-data-jpa/2.6.8/spring-boot-starter-data-jpa-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-aop/2.6.8/spring-boot-starter-aop-2.6.8.jar:/root/.m2/repository/org/aspectj/aspectjweaver/1.9.7/aspectjweaver-1.9.7.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-jdbc/2.6.8/spring-boot-starter-jdbc-2.6.8.jar:/root/.m2/repository/com/zaxxer/HikariCP/4.0.3/HikariCP-4.0.3.jar:/root/.m2/repository/org/springframework/spring-jdbc/5.3.20/spring-jdbc-5.3.20.jar:/root/.m2/repository/jakarta/transaction/jakarta.transaction-api/1.3.3/jakarta.transaction-api-1.3.3.jar:/root/.m2/repository/jakarta/persistence/jakarta.persistence-api/2.2.3/jakarta.persistence-api-2.2.3.jar:/root/.m2/repository/org/hibernate/hibernate-core/5.6.9.Final/hibernate-core-5.6.9.Final.jar:/root/.m2/repository/antlr/antlr/2.7.7/antlr-2.7.7.jar:/root/.m2/repository/org/jboss/jandex/2.4.2.Final/jandex-2.4.2.Final.jar:/root/.m2/repository/org/hibernate/common/hibernate-commons-annotations/5.1.2.Final/hibernate-commons-annotations-5.1.2.Final.jar:/root/.m2/repository/org/springframework/data/spring-data-jpa/2.6.4/spring-data-jpa-2.6.4.jar:/root/.m2/repository/org/springframework/spring-orm/5.3.20/spring-orm-5.3.20.jar:/root/.m2/repository/org/springframework/spring-tx/5.3.20/spring-tx-5.3.20.jar:/root/.m2/repository/org/springframework/spring-aspects/5.3.20/spring-aspects-5.3.20.jar:/root/.m2/repository/mysql/mysql-connector-java/8.0.29/mysql-connector-java-8.0.29.jar:/root/.m2/repository/com/google/protobuf/protobuf-java/3.19.4/protobuf-java-3.19.4.jar:/root/.m2/repository/org/springframework/data/spring-data-commons/2.6.4/spring-data-commons-2.6.4.jar:/root/.m2/repository/org/springframework/spring-beans/5.3.20/spring-beans-5.3.20.jar:/root/.m2/repository/org/codehaus/janino/janino/3.1.7/janino-3.1.7.jar:/root/.m2/repository/org/codehaus/janino/commons-compiler/3.1.7/commons-compiler-3.1.7.jar:/root/.m2/repository/io/micrometer/micrometer-core/1.8.6/micrometer-core-1.8.6.jar:/root/.m2/repository/org/hdrhistogram/HdrHistogram/2.1.12/HdrHistogram-2.1.12.jar:/root/.m2/repository/org/latencyutils/LatencyUtils/2.0.3/LatencyUtils-2.0.3.jar:/root/.m2/repository/io/micrometer/micrometer-registry-prometheus/1.8.6/micrometer-registry-prometheus-1.8.6.jar:/root/.m2/repository/io/prometheus/simpleclient_common/0.12.0/simpleclient_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient/0.12.0/simpleclient-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel/0.12.0/simpleclient_tracer_otel-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_common/0.12.0/simpleclient_tracer_common-0.12.0.jar:/root/.m2/repository/io/prometheus/simpleclient_tracer_otel_agent/0.12.0/simpleclient_tracer_otel_agent-0.12.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-netflix-eureka-client/3.1.2/spring-cloud-starter-netflix-eureka-client-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-netflix-eureka-client/3.1.2/spring-cloud-netflix-eureka-client-3.1.2.jar:/root/.m2/repository/com/netflix/eureka/eureka-client/1.10.17/eureka-client-1.10.17.jar:/root/.m2/repository/com/netflix/netflix-commons/netflix-eventbus/0.3.0/netflix-eventbus-0.3.0.jar:/root/.m2/repository/com/netflix/netflix-commons/netflix-infix/0.3.0/netflix-infix-0.3.0.jar:/root/.m2/repository/commons-jxpath/commons-jxpath/1.3/commons-jxpath-1.3.jar:/root/.m2/repository/joda-time/joda-time/2.3/joda-time-2.3.jar:/root/.m2/repository/org/antlr/antlr-runtime/3.4/antlr-runtime-3.4.jar:/root/.m2/repository/org/antlr/stringtemplate/3.2.1/stringtemplate-3.2.1.jar:/root/.m2/repository/org/apache/commons/commons-math/2.2/commons-math-2.2.jar:/root/.m2/repository/com/thoughtworks/xstream/xstream/1.4.19/xstream-1.4.19.jar:/root/.m2/repository/io/github/x-stream/mxparser/1.2.2/mxparser-1.2.2.jar:/root/.m2/repository/xmlpull/xmlpull/1.1.3.1/xmlpull-1.1.3.1.jar:/root/.m2/repository/javax/ws/rs/jsr311-api/1.1.1/jsr311-api-1.1.1.jar:/root/.m2/repository/com/netflix/servo/servo-core/0.12.21/servo-core-0.12.21.jar:/root/.m2/repository/commons-configuration/commons-configuration/1.10/commons-configuration-1.10.jar:/root/.m2/repository/commons-lang/commons-lang/2.6/commons-lang-2.6.jar:/root/.m2/repository/com/google/inject/guice/5.0.1/guice-5.0.1.jar:/root/.m2/repository/org/codehaus/jettison/jettison/1.4.0/jettison-1.4.0.jar:/root/.m2/repository/com/netflix/eureka/eureka-core/1.10.17/eureka-core-1.10.17.jar:/root/.m2/repository/com/fasterxml/woodstox/woodstox-core/6.2.1/woodstox-core-6.2.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-consul-discovery/3.1.0/spring-cloud-starter-consul-discovery-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-consul/3.1.0/spring-cloud-starter-consul-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-consul-core/3.1.0/spring-cloud-consul-core-3.1.0.jar:/root/.m2/repository/com/ecwid/consul/consul-api/1.4.5/consul-api-1.4.5.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-consul-discovery/3.1.0/spring-cloud-consul-discovery-3.1.0.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-zookeeper-discovery/3.1.1/spring-cloud-starter-zookeeper-discovery-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-zookeeper/3.1.1/spring-cloud-starter-zookeeper-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-zookeeper-core/3.1.1/spring-cloud-zookeeper-core-3.1.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-zookeeper-discovery/3.1.1/spring-cloud-zookeeper-discovery-3.1.1.jar:/root/.m2/repository/org/apache/curator/curator-x-discovery/5.1.0/curator-x-discovery-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-recipes/5.1.0/curator-recipes-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-framework/5.1.0/curator-framework-5.1.0.jar:/root/.m2/repository/org/apache/curator/curator-client/5.1.0/curator-client-5.1.0.jar:/root/.m2/repository/org/apache/zookeeper/zookeeper/3.6.0/zookeeper-3.6.0.jar:/root/.m2/repository/org/apache/zookeeper/zookeeper-jute/3.6.0/zookeeper-jute-3.6.0.jar:/root/.m2/repository/org/apache/yetus/audience-annotations/0.5.0/audience-annotations-0.5.0.jar:/root/.m2/repository/io/netty/netty-handler/4.1.77.Final/netty-handler-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-common/4.1.77.Final/netty-common-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-resolver/4.1.77.Final/netty-resolver-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-buffer/4.1.77.Final/netty-buffer-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport/4.1.77.Final/netty-transport-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-codec/4.1.77.Final/netty-codec-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-native-epoll/4.1.77.Final/netty-transport-native-epoll-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-native-unix-common/4.1.77.Final/netty-transport-native-unix-common-4.1.77.Final.jar:/root/.m2/repository/io/netty/netty-transport-classes-epoll/4.1.77.Final/netty-transport-classes-epoll-4.1.77.Final.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-netflix-eureka-server/3.1.2/spring-cloud-starter-netflix-eureka-server-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter/3.1.2/spring-cloud-starter-3.1.2.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter/2.6.8/spring-boot-starter-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-logging/2.6.8/spring-boot-starter-logging-2.6.8.jar:/root/.m2/repository/ch/qos/logback/logback-classic/1.2.11/logback-classic-1.2.11.jar:/root/.m2/repository/ch/qos/logback/logback-core/1.2.11/logback-core-1.2.11.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-to-slf4j/2.17.2/log4j-to-slf4j-2.17.2.jar:/root/.m2/repository/org/apache/logging/log4j/log4j-api/2.17.2/log4j-api-2.17.2.jar:/root/.m2/repository/org/slf4j/jul-to-slf4j/1.7.36/jul-to-slf4j-1.7.36.jar:/root/.m2/repository/jakarta/annotation/jakarta.annotation-api/1.3.5/jakarta.annotation-api-1.3.5.jar:/root/.m2/repository/org/yaml/snakeyaml/1.29/snakeyaml-1.29.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-context/3.1.2/spring-cloud-context-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-commons/3.1.2/spring-cloud-commons-3.1.2.jar:/root/.m2/repository/org/springframework/security/spring-security-rsa/1.0.10.RELEASE/spring-security-rsa-1.0.10.RELEASE.jar:/root/.m2/repository/org/bouncycastle/bcpkix-jdk15on/1.68/bcpkix-jdk15on-1.68.jar:/root/.m2/repository/org/bouncycastle/bcprov-jdk15on/1.68/bcprov-jdk15on-1.68.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-netflix-eureka-server/3.1.2/spring-cloud-netflix-eureka-server-3.1.2.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-freemarker/2.6.8/spring-boot-starter-freemarker-2.6.8.jar:/root/.m2/repository/org/freemarker/freemarker/2.3.31/freemarker-2.3.31.jar:/root/.m2/repository/org/springframework/spring-context-support/5.3.20/spring-context-support-5.3.20.jar:/root/.m2/repository/com/sun/jersey/jersey-servlet/1.19.4/jersey-servlet-1.19.4.jar:/root/.m2/repository/com/sun/jersey/jersey-server/1.19.4/jersey-server-1.19.4.jar:/root/.m2/repository/javax/inject/javax.inject/1/javax.inject-1.jar:/root/.m2/repository/com/fasterxml/jackson/dataformat/jackson-dataformat-xml/2.13.3/jackson-dataformat-xml-2.13.3.jar:/root/.m2/repository/org/codehaus/woodstox/stax2-api/4.2.1/stax2-api-4.2.1.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-starter-loadbalancer/3.1.2/spring-cloud-starter-loadbalancer-3.1.2.jar:/root/.m2/repository/org/springframework/cloud/spring-cloud-loadbalancer/3.1.2/spring-cloud-loadbalancer-3.1.2.jar:/root/.m2/repository/io/projectreactor/reactor-core/3.4.18/reactor-core-3.4.18.jar:/root/.m2/repository/org/reactivestreams/reactive-streams/1.0.3/reactive-streams-1.0.3.jar:/root/.m2/repository/io/projectreactor/addons/reactor-extra/3.4.8/reactor-extra-3.4.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-cache/2.6.8/spring-boot-starter-cache-2.6.8.jar:/root/.m2/repository/com/stoyanr/evictor/1.0.0/evictor-1.0.0.jar:/root/.m2/repository/com/sun/jersey/contribs/jersey-apache-client4/1.19.4/jersey-apache-client4-1.19.4.jar:/root/.m2/repository/org/apache/httpcomponents/httpclient/4.5.13/httpclient-4.5.13.jar:/root/.m2/repository/org/apache/httpcomponents/httpcore/4.4.15/httpcore-4.4.15.jar:/root/.m2/repository/commons-codec/commons-codec/1.15/commons-codec-1.15.jar:/root/.m2/repository/com/sun/jersey/jersey-client/1.19.4/jersey-client-1.19.4.jar:/root/.m2/repository/com/sun/jersey/jersey-core/1.19.4/jersey-core-1.19.4.jar:/root/.m2/repository/com/alibaba/nacos/nacos-api/1.4.0/nacos-api-1.4.0.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-core/2.13.3/jackson-core-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-databind/2.13.3/jackson-databind-2.13.3.jar:/root/.m2/repository/com/fasterxml/jackson/core/jackson-annotations/2.13.3/jackson-annotations-2.13.3.jar:/root/.m2/repository/org/apache/commons/commons-lang3/3.12.0/commons-lang3-3.12.0.jar:/root/.m2/repository/com/google/guava/guava/31.0.1-jre/guava-31.0.1-jre.jar:/root/.m2/repository/com/google/guava/failureaccess/1.0.1/failureaccess-1.0.1.jar:/root/.m2/repository/com/google/guava/listenablefuture/9999.0-empty-to-avoid-conflict-with-guava/listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar:/root/.m2/repository/com/google/code/findbugs/jsr305/3.0.2/jsr305-3.0.2.jar:/root/.m2/repository/org/checkerframework/checker-qual/3.12.0/checker-qual-3.12.0.jar:/root/.m2/repository/com/google/errorprone/error_prone_annotations/2.7.1/error_prone_annotations-2.7.1.jar:/root/.m2/repository/com/google/j2objc/j2objc-annotations/1.3/j2objc-annotations-1.3.jar:/root/.m2/repository/com/h2database/h2/1.4.191/h2-1.4.191.jar:/root/.m2/repository/javax/xml/bind/jaxb-api/2.3.1/jaxb-api-2.3.1.jar:/root/.m2/repository/javax/activation/javax.activation-api/1.2.0/javax.activation-api-1.2.0.jar:/root/.m2/repository/com/sun/xml/bind/jaxb-impl/2.3.1/jaxb-impl-2.3.1.jar:/root/.m2/repository/org/glassfish/jaxb/jaxb-runtime/2.3.1/jaxb-runtime-2.3.1.jar:/root/.m2/repository/org/glassfish/jaxb/txw2/2.3.6/txw2-2.3.6.jar:/root/.m2/repository/com/sun/istack/istack-commons-runtime/3.0.7/istack-commons-runtime-3.0.7.jar:/root/.m2/repository/org/jvnet/staxex/stax-ex/1.8/stax-ex-1.8.jar:/root/.m2/repository/com/sun/xml/fastinfoset/FastInfoset/1.2.15/FastInfoset-1.2.15.jar:/root/.m2/repository/javax/activation/activation/1.1.1/activation-1.1.1.jar:/root/.m2/repository/org/javassist/javassist/3.23.1-GA/javassist-3.23.1-GA.jar:/root/.m2/repository/org/springframework/boot/spring-boot-starter-test/2.6.8/spring-boot-starter-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test/2.6.8/spring-boot-test-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot/2.6.8/spring-boot-2.6.8.jar:/root/.m2/repository/org/springframework/spring-context/5.3.20/spring-context-5.3.20.jar:/root/.m2/repository/org/springframework/boot/spring-boot-test-autoconfigure/2.6.8/spring-boot-test-autoconfigure-2.6.8.jar:/root/.m2/repository/org/springframework/boot/spring-boot-autoconfigure/2.6.8/spring-boot-autoconfigure-2.6.8.jar:/root/.m2/repository/com/jayway/jsonpath/json-path/2.6.0/json-path-2.6.0.jar:/root/.m2/repository/net/minidev/json-smart/2.4.8/json-smart-2.4.8.jar:/root/.m2/repository/net/minidev/accessors-smart/2.4.8/accessors-smart-2.4.8.jar:/root/.m2/repository/org/ow2/asm/asm/9.1/asm-9.1.jar:/root/.m2/repository/org/slf4j/slf4j-api/1.7.21/slf4j-api-1.7.21.jar:/root/.m2/repository/jakarta/xml/bind/jakarta.xml.bind-api/2.3.3/jakarta.xml.bind-api-2.3.3.jar:/root/.m2/repository/jakarta/activation/jakarta.activation-api/1.2.2/jakarta.activation-api-1.2.2.jar:/root/.m2/repository/org/assertj/assertj-core/3.21.0/assertj-core-3.21.0.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter/5.8.2/junit-jupiter-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-api/5.8.2/junit-jupiter-api-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-params/5.8.2/junit-jupiter-params-5.8.2.jar:/root/.m2/repository/org/junit/jupiter/junit-jupiter-engine/5.8.2/junit-jupiter-engine-5.8.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar:/root/.m2/repository/org/mockito/mockito-junit-jupiter/4.0.0/mockito-junit-jupiter-4.0.0.jar:/root/.m2/repository/org/skyscreamer/jsonassert/1.5.0/jsonassert-1.5.0.jar:/root/.m2/repository/com/vaadin/external/google/android-json/0.0.20131108.vaadin1/android-json-0.0.20131108.vaadin1.jar:/root/.m2/repository/org/springframework/spring-core/5.3.20/spring-core-5.3.20.jar:/root/.m2/repository/org/springframework/spring-jcl/5.3.20/spring-jcl-5.3.20.jar:/root/.m2/repository/org/springframework/spring-test/5.3.20/spring-test-5.3.20.jar:/root/.m2/repository/org/xmlunit/xmlunit-core/2.8.4/xmlunit-core-2.8.4.jar:/root/.m2/repository/org/awaitility/awaitility/4.0.3/awaitility-4.0.3.jar:/root/.m2/repository/org/junit/vintage/junit-vintage-engine/5.7.0/junit-vintage-engine-5.7.0.jar:/root/.m2/repository/org/apiguardian/apiguardian-api/1.1.0/apiguardian-api-1.1.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-engine/1.8.2/junit-platform-engine-1.8.2.jar:/root/.m2/repository/org/opentest4j/opentest4j/1.2.0/opentest4j-1.2.0.jar:/root/.m2/repository/org/junit/platform/junit-platform-commons/1.8.2/junit-platform-commons-1.8.2.jar:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:"/>
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ReleaseOpenApiServiceTest.java:20:import static org.mockito.Mockito.times;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ReleaseOpenApiServiceTest.java:21:import static org.mockito.Mockito.verify;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ReleaseOpenApiServiceTest.java:22:import static org.mockito.Mockito.when;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ReleaseOpenApiServiceTest.java:31:import org.mockito.ArgumentCaptor;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ItemOpenApiServiceTest.java:21:import static org.mockito.Mockito.times;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ItemOpenApiServiceTest.java:22:import static org.mockito.Mockito.verify;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ItemOpenApiServiceTest.java:23:import static org.mockito.Mockito.when;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ItemOpenApiServiceTest.java:36:import org.mockito.ArgumentCaptor;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ClusterOpenApiServiceTest.java:20:import static org.mockito.Mockito.times;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ClusterOpenApiServiceTest.java:21:import static org.mockito.Mockito.verify;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ClusterOpenApiServiceTest.java:22:import static org.mockito.Mockito.when;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/ClusterOpenApiServiceTest.java:32:import org.mockito.ArgumentCaptor;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/AbstractOpenApiServiceTest.java:19:import static org.mockito.ArgumentMatchers.any;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/AbstractOpenApiServiceTest.java:20:import static org.mockito.Mockito.when;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/AbstractOpenApiServiceTest.java:31:import org.mockito.Mock;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/AbstractOpenApiServiceTest.java:32:import org.mockito.junit.MockitoJUnitRunner;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/AppOpenApiServiceTest.java:20:import static org.mockito.Mockito.times;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/AppOpenApiServiceTest.java:21:import static org.mockito.Mockito.verify;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/AppOpenApiServiceTest.java:22:import static org.mockito.Mockito.when;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/AppOpenApiServiceTest.java:28:import org.mockito.ArgumentCaptor;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/NamespaceOpenApiServiceTest.java:20:import static org.mockito.Mockito.times;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/NamespaceOpenApiServiceTest.java:21:import static org.mockito.Mockito.verify;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/NamespaceOpenApiServiceTest.java:22:import static org.mockito.Mockito.when;
apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/client/service/NamespaceOpenApiServiceTest.java:30:import org.mockito.ArgumentCaptor;
grep: apollo-openapi/target/test-classes/com/ctrip/framework/apollo/openapi/client/service/NamespaceOpenApiServiceTest.class: binary file matches
grep: apollo-openapi/target/test-classes/com/ctrip/framework/apollo/openapi/client/service/AbstractOpenApiServiceTest.class: binary file matches
grep: apollo-openapi/target/test-classes/com/ctrip/framework/apollo/openapi/client/service/ItemOpenApiServiceTest.class: binary file matches
grep: apollo-openapi/target/test-classes/com/ctrip/framework/apollo/openapi/client/service/AppOpenApiServiceTest.class: binary file matches
grep: apollo-openapi/target/test-classes/com/ctrip/framework/apollo/openapi/client/service/ReleaseOpenApiServiceTest.class: binary file matches
grep: apollo-openapi/target/test-classes/com/ctrip/framework/apollo/openapi/client/service/ClusterOpenApiServiceTest.class: binary file matches
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/SimpleConfigTest.java:20:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/SimpleConfigTest.java:21:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/SimpleConfigTest.java:33:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/SimpleConfigTest.java:34:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/SimpleConfigTest.java:35:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/SimpleConfigTest.java:44:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/AbstractConfigTest.java:20:import static org.mockito.ArgumentMatchers.any;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/AbstractConfigTest.java:21:import static org.mockito.ArgumentMatchers.eq;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/AbstractConfigTest.java:22:import static org.mockito.Mockito.spy;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/AbstractConfigTest.java:23:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/AbstractConfigTest.java:24:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/DefaultConfigTest.java:24:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/DefaultConfigTest.java:25:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/DefaultConfigTest.java:26:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/DefaultConfigTest.java:27:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/DefaultConfigTest.java:65:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/DefaultConfigTest.java:66:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/InterestedConfigChangeEventTest.java:38:import static org.mockito.Mockito.*;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/LocalFileConfigRepositoryTest.java:20:import static org.mockito.ArgumentMatchers.eq;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/LocalFileConfigRepositoryTest.java:21:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/LocalFileConfigRepositoryTest.java:22:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/LocalFileConfigRepositoryTest.java:23:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/LocalFileConfigRepositoryTest.java:24:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/LocalFileConfigRepositoryTest.java:36:import org.mockito.ArgumentCaptor;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/LocalFileConfigRepositoryTest.java:44:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/LocalFileConfigRepositoryTest.java:45:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/DefaultConfigManagerTest.java:22:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/JsonConfigFileTest.java:23:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/JsonConfigFileTest.java:31:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/JsonConfigFileTest.java:32:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:22:import static org.mockito.ArgumentMatchers.any;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:23:import static org.mockito.ArgumentMatchers.eq;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:24:import static org.mockito.Mockito.doAnswer;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:25:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:26:import static org.mockito.Mockito.never;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:27:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:28:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:29:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:54:import org.mockito.ArgumentCaptor;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:55:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:56:import org.mockito.Mockito;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:57:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:58:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.java:59:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:23:import static org.mockito.ArgumentMatchers.eq;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:24:import static org.mockito.Mockito.any;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:25:import static org.mockito.Mockito.atLeast;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:26:import static org.mockito.Mockito.doAnswer;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:27:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:28:import static org.mockito.Mockito.spy;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:29:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:30:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:31:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:65:import org.mockito.ArgumentCaptor;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:66:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:67:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:68:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.java:69:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesCompatibleFileConfigRepositoryTest.java:20:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesCompatibleFileConfigRepositoryTest.java:21:import static org.mockito.Mockito.reset;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesCompatibleFileConfigRepositoryTest.java:22:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesCompatibleFileConfigRepositoryTest.java:23:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesCompatibleFileConfigRepositoryTest.java:24:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesCompatibleFileConfigRepositoryTest.java:33:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesCompatibleFileConfigRepositoryTest.java:34:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesConfigFileTest.java:23:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesConfigFileTest.java:38:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesConfigFileTest.java:39:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesConfigFileTest.java:40:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/PropertiesConfigFileTest.java:43:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/YamlConfigFileTest.java:20:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/YamlConfigFileTest.java:34:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/YamlConfigFileTest.java:35:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/YamlConfigFileTest.java:36:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/YamlConfigFileTest.java:37:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/TxtConfigFileTest.java:20:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/TxtConfigFileTest.java:28:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/TxtConfigFileTest.java:29:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/XmlConfigFileTest.java:23:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/XmlConfigFileTest.java:38:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/XmlConfigFileTest.java:39:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/XmlConfigFileTest.java:40:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/internals/XmlConfigFileTest.java:44:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryTest.java:24:import static org.mockito.Mockito.doReturn;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryTest.java:25:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryTest.java:26:import static org.mockito.Mockito.spy;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryTest.java:27:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryFileCachePropertyTest.java:20:import static org.mockito.Mockito.doReturn;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryFileCachePropertyTest.java:21:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryFileCachePropertyTest.java:22:import static org.mockito.Mockito.never;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryFileCachePropertyTest.java:23:import static org.mockito.Mockito.spy;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryFileCachePropertyTest.java:24:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryFileCachePropertyTest.java:25:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/spi/DefaultConfigFactoryFileCachePropertyTest.java:26:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/util/ConfigUtilTest.java:28:import static org.mockito.Mockito.doReturn;
apollo-client/src/test/java/com/ctrip/framework/apollo/util/ConfigUtilTest.java:29:import static org.mockito.Mockito.spy;
apollo-client/src/test/java/com/ctrip/framework/apollo/util/yaml/YamlParserTest.java:21:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/util/yaml/YamlParserTest.java:22:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/util/yaml/YamlParserTest.java:35:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/util/yaml/YamlParserTest.java:36:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigPlaceholderTest.java:20:import static org.mockito.ArgumentMatchers.anyString;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigPlaceholderTest.java:21:import static org.mockito.ArgumentMatchers.eq;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigPlaceholderTest.java:22:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigPlaceholderTest.java:23:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigPlaceholderTest.java:33:import org.mockito.Mockito;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/BootstrapConfigTest.java:31:import org.mockito.Mockito;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/BootstrapConfigTest.java:46:import static org.mockito.ArgumentMatchers.anyString;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/BootstrapConfigTest.java:47:import static org.mockito.ArgumentMatchers.eq;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/BootstrapConfigTest.java:48:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/BootstrapConfigTest.java:49:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XmlConfigPlaceholderTest.java:20:import static org.mockito.ArgumentMatchers.anyString;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XmlConfigPlaceholderTest.java:21:import static org.mockito.ArgumentMatchers.eq;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XmlConfigPlaceholderTest.java:22:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XmlConfigPlaceholderTest.java:23:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XmlConfigPlaceholderTest.java:29:import org.mockito.Mockito;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:43:import org.mockito.ArgumentCaptor;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:44:import org.mockito.Mockito;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:45:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:46:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:59:import static org.mockito.ArgumentMatchers.any;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:60:import static org.mockito.ArgumentMatchers.anySet;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:61:import static org.mockito.ArgumentMatchers.eq;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:62:import static org.mockito.Mockito.atLeastOnce;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:63:import static org.mockito.Mockito.doAnswer;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:64:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:65:import static org.mockito.Mockito.never;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:66:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:67:import static org.mockito.Mockito.spy;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:68:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.java:69:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/boot/ApolloApplicationContextInitializerTest.java:20:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/boot/ApolloApplicationContextInitializerTest.java:21:import static org.mockito.Mockito.spy;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/boot/ApolloApplicationContextInitializerTest.java:22:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/PropertySourcesProcessorTest.java:20:import static org.mockito.Mockito.*;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/PropertySourcesProcessorTest.java:36:import org.mockito.ArgumentCaptor;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.java:23:import static org.mockito.ArgumentMatchers.any;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.java:24:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.java:25:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.java:26:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.java:27:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.java:39:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.java:40:import org.mockito.Mockito;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.java:41:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.java:42:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.java:43:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.java:22:import static org.mockito.ArgumentMatchers.any;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.java:23:import static org.mockito.Mockito.doAnswer;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.java:24:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.java:25:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.java:26:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.java:27:import static org.mockito.Mockito.when;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.java:38:import org.mockito.Mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.java:39:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.java:40:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.java:41:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/util/BeanRegistrationUtilTest.java:26:import org.mockito.InjectMocks;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/util/BeanRegistrationUtilTest.java:27:import org.mockito.Mockito;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/util/BeanRegistrationUtilTest.java:28:import org.mockito.junit.MockitoJUnitRunner;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest.java:20:import static org.mockito.ArgumentMatchers.any;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest.java:21:import static org.mockito.Mockito.doAnswer;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest.java:22:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest.java:23:import static org.mockito.Mockito.times;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest.java:24:import static org.mockito.Mockito.verify;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest.java:32:import org.mockito.ArgumentCaptor;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest.java:33:import org.mockito.Mockito;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest.java:34:import org.mockito.invocation.InvocationOnMock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest.java:35:import org.mockito.stubbing.Answer;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/AbstractSpringIntegrationTest.java:19:import static org.mockito.Mockito.mock;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/AbstractSpringIntegrationTest.java:20:import static org.mockito.Mockito.spy;
apollo-client/src/test/java/com/ctrip/framework/apollo/spring/AbstractSpringIntegrationTest.java:21:import static org.mockito.Mockito.when;
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/DefaultConfigTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/SimpleConfigTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/SimpleConfigTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/AbstractConfigTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest$2.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/LocalFileConfigRepositoryTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$9.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/PropertiesCompatibleFileConfigRepositoryTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/DefaultConfigManagerTest$MockConfigFactoryManager$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/XmlConfigFileTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/JsonConfigFileTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$11.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$3.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/DefaultConfigTest$9.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/YamlConfigFileTest$2.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest$4.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/XmlConfigFileTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/DefaultConfigTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$8.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/TxtConfigFileTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/PropertiesConfigFileTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/YamlConfigFileTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$2.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/PropertiesConfigFileTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$13.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$6.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/DefaultConfigTest$2.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/LocalFileConfigRepositoryTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$12.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$5.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/InterestedConfigChangeEventTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$10.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$7.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigRepositoryTest$3.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/RemoteConfigLongPollServiceTest$4.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/internals/YamlConfigFileTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spi/DefaultConfigFactoryTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spi/DefaultConfigFactoryFileCachePropertyTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/util/ConfigUtilTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/util/yaml/YamlParserTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/util/yaml/YamlParserTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/BootstrapConfigTest$TestWithBootstrapEnabledAndNamespacesAndConditionalOn.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/XmlConfigPlaceholderTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/BootstrapConfigTest$TestWithBootstrapEnabledAndEagerLoadEnabled.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest$2.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest$3.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/BootstrapConfigTest$TestWithBootstrapDisabledAndDefaultNamespacesAndConditionalOff.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/BootstrapConfigTest$TestWithBootstrapDisabledAndDefaultNamespacesAndConditionalOn.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/BootstrapConfigTest$TestWithBootstrapEnabledAndDefaultNamespacesAndConditionalOn.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest$AppConfig11.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/BootstrapConfigTest$TestWithBootstrapEnabledAndDefaultNamespacesAndConditionalOff.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/BootstrapConfigTest$TestWithBootstrapEnabledAndNamespacesAndConditionalOnWithYamlFile.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest$2.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/boot/ApolloApplicationContextInitializerTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/BootstrapConfigTest$TestWithBootstrapEnabledAndDefaultNamespacesAndConditionalOnFailed.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/config/PropertySourcesProcessorTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/config/ConfigPropertySourceTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/config/CachedCompositePropertySourceTest$2.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/AbstractSpringIntegrationTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest$1.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/JavaConfigAnnotationTest$4.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/util/BeanRegistrationUtilTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/JavaConfigPlaceholderTest.class: binary file matches
grep: apollo-client/target/test-classes/com/ctrip/framework/apollo/spring/XMLConfigAnnotationTest.class: binary file matches
apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java:6:import org.mockito.junit.MockitoJUnitRunner;
[?2004l
2025-11-12 11:44:58,769 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_kdBZPqEA5qndjO0aPRREKMre', 'function': {'arguments': '{"command":"ls -la /testbed/apollo-configservice/target/classes || true"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 3494, 'prompt_tokens': 67761, 'total_tokens': 71255, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 3456, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--fdfd2334-06d4-4088-9194-c7838b3ba8d7-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la /testbed/apollo-configservice/target/classes || true'}, 'id': 'call_kdBZPqEA5qndjO0aPRREKMre', 'type': 'tool_call'}] usage_metadata={'input_tokens': 67761, 'output_tokens': 3494, 'total_tokens': 71255, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 3456}}
2025-11-12 11:44:58,773 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la /testbed/apollo-configservice/target/classes || true
2025-11-12 11:44:58,875 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:44:58,875 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 80
drwxr-xr-x 1 root root 4096 Aug 24 21:16 .
drwxr-xr-x 1 root root 4096 Nov 12 11:41 ..
drwxr-xr-x 1 root root 4096 Aug 24 21:16 META-INF
-rw-rw-r-- 1 root root  223 Nov 12 11:41 apollo-configservice.conf
-rw-r--r-- 1 root root 1177 Nov 12 11:29 apollo-git.properties
-rw-rw-r-- 1 root root  608 Nov 12 11:41 app.properties
-rw-rw-r-- 1 root root  900 Nov 12 11:41 application-consul-discovery.properties
-rw-rw-r-- 1 root root  678 Nov 12 11:41 application-custom-defined-discovery.properties
-rw-rw-r-- 1 root root  758 Nov 12 11:41 application-github.properties
-rw-rw-r-- 1 root root  677 Nov 12 11:41 application-kubernetes.properties
-rw-rw-r-- 1 root root  825 Nov 12 11:41 application-nacos-discovery.properties
-rw-rw-r-- 1 root root  883 Nov 12 11:41 application-zookeeper-discovery.properties
-rw-rw-r-- 1 root root 1774 Nov 12 11:41 application.yml
drwxr-xr-x 1 root root 4096 Aug 24 21:16 com
-rw-rw-r-- 1 root root  804 Nov 12 11:41 configservice.properties
-rw-rw-r-- 1 root root 1523 Nov 12 11:41 logback.xml
[?2004l
2025-11-12 11:45:24,169 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_cPBIePL5gib172pBn7MH9grt', 'function': {'arguments': '{"command":"mkdir -p /tmp/test-classes; JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH javac -cp apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar -d /tmp/test-classes apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1864, 'prompt_tokens': 68211, 'total_tokens': 70075, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1600, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--12eddce7-a3a1-4c4b-bf26-e97713233167-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'mkdir -p /tmp/test-classes; JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH javac -cp apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar -d /tmp/test-classes apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java'}, 'id': 'call_cPBIePL5gib172pBn7MH9grt', 'type': 'tool_call'}] usage_metadata={'input_tokens': 68211, 'output_tokens': 1864, 'total_tokens': 70075, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1600}}
2025-11-12 11:45:24,173 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p /tmp/test-classes; JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH javac -cp apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar -d /tmp/test-classes apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java
2025-11-12 11:45:24,796 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:45:24,796 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 mkdir -p /tmp/test-classes; JAVA_HOME=/usr/lib/jvm/java-17-amazon-corre
etto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH javac -cp 
 apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/juni
it-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.
.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22
2.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agen
nt-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar
r -d /tmp/test-classes apollo/apollo-configservice/src/test/java/com/ctrip/framew
work/apollo/configservice/util/NamespaceUtilSingleDotTest.java
[?2004l
[?2004l
2025-11-12 11:45:37,244 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_QbnSxhS0nP7B2BblaaKe8ihD', 'function': {'arguments': '{"command":"JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1079, 'prompt_tokens': 68750, 'total_tokens': 69829, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cc0b0acb-fff1-4f09-b490-3a478c744064-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest'}, 'id': 'call_QbnSxhS0nP7B2BblaaKe8ihD', 'type': 'tool_call'}] usage_metadata={'input_tokens': 68750, 'output_tokens': 1079, 'total_tokens': 69829, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 11:45:37,247 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest
2025-11-12 11:45:37,446 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 11:45:37,446 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm
m/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-conf
figservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.ja
ar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/ro
oot/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/
/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.j
jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.
.runner.JUnitCore com.ctrip.framework.apollo.configservice.util.NamespaceUtilSing
gleDotTest
[?2004l
JUnit version 4.13.2
.E
Time: 0.003
There was 1 failure:
1) initializationError(org.junit.runner.JUnitCommandLineParseResult)
java.lang.IllegalArgumentException: Could not find class [com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest]
	at org.junit.runner.JUnitCommandLineParseResult.parseParameters(JUnitCommandLineParseResult.java:100)
	at org.junit.runner.JUnitCommandLineParseResult.parseArgs(JUnitCommandLineParseResult.java:50)
	at org.junit.runner.JUnitCommandLineParseResult.parse(JUnitCommandLineParseResult.java:44)
	at org.junit.runner.JUnitCore.runMain(JUnitCore.java:72)
	at org.junit.runner.JUnitCore.main(JUnitCore.java:36)
Caused by: java.lang.ClassNotFoundException: com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest
	at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)
	at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)
	at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:525)
	at java.base/java.lang.Class.forName0(Native Method)
	at java.base/java.lang.Class.forName(Class.java:467)
	at org.junit.internal.Classes.getClass(Classes.java:42)
	at org.junit.internal.Classes.getClass(Classes.java:27)
	at org.junit.runner.JUnitCommandLineParseResult.parseParameters(JUnitCommandLineParseResult.java:98)
	... 4 more

FAILURES!!!
Tests run: 1,  Failures: 1

[?2004l
2025-11-12 11:45:51,583 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1uUJHyfwmNFgT4yDyfLxfOEC', 'function': {'arguments': '{"command":"JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1005, 'prompt_tokens': 69596, 'total_tokens': 70601, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--eec7d60a-85cf-478c-874d-2d21ba010f1f-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest'}, 'id': 'call_1uUJHyfwmNFgT4yDyfLxfOEC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 69596, 'output_tokens': 1005, 'total_tokens': 70601, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 11:45:51,588 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest
2025-11-12 11:45:51,730 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 11:45:51,731 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm
m/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-conf
figservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.ja
ar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/ro
oot/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/
/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.j
jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.
.runner.JUnitCore NamespaceUtilSingleDotTest
[?2004l
JUnit version 4.13.2
Exception in thread "main" java.lang.NoClassDefFoundError: org/hamcrest/SelfDescribing
	at java.base/java.lang.ClassLoader.defineClass1(Native Method)
	at java.base/java.lang.ClassLoader.defineClass(ClassLoader.java:1017)
	at java.base/java.security.SecureClassLoader.defineClass(SecureClassLoader.java:150)
	at java.base/jdk.internal.loader.BuiltinClassLoader.defineClass(BuiltinClassLoader.java:862)
	at java.base/jdk.internal.loader.BuiltinClassLoader.findClassOnClassPathOrNull(BuiltinClassLoader.java:760)
	at java.base/jdk.internal.loader.BuiltinClassLoader.loadClassOrNull(BuiltinClassLoader.java:681)
	at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:639)
	at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)
	at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:525)
	at org.junit.runner.Computer.getSuite(Computer.java:28)
	at org.junit.runner.Request.classes(Request.java:77)
	at org.junit.runner.JUnitCommandLineParseResult.createRequest(JUnitCommandLineParseResult.java:116)
	at org.junit.runner.JUnitCore.runMain(JUnitCore.java:77)
	at org.junit.runner.JUnitCore.main(JUnitCore.java:36)
Caused by: java.lang.ClassNotFoundException: org.hamcrest.SelfDescribing
	at java.base/jdk.internal.loader.BuiltinClassLoader.loadClass(BuiltinClassLoader.java:641)
	at java.base/jdk.internal.loader.ClassLoaders$AppClassLoader.loadClass(ClassLoaders.java:188)
	at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:525)
	... 14 more
[?2004l
2025-11-12 11:46:17,518 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_g3R6WKCkQbnyS4nQrxqXDkii', 'function': {'arguments': '{"command":"JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1607, 'prompt_tokens': 70448, 'total_tokens': 72055, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a7f611a6-8e0a-4e97-b636-8ca8747b2780-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest'}, 'id': 'call_g3R6WKCkQbnyS4nQrxqXDkii', 'type': 'tool_call'}] usage_metadata={'input_tokens': 70448, 'output_tokens': 1607, 'total_tokens': 72055, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-12 11:46:17,522 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest
2025-11-12 11:46:18,075 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:46:18,075 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm
m/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-conf
figservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.ja
ar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repo
ository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repositor
ry/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/n
net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/rep
pository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore
e NamespaceUtilSingleDotTest
[?2004l
JUnit version 4.13.2
.
Time: 0.318

OK (1 test)

[?2004l
2025-11-12 11:46:20,562 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='JUnit version 4.13.2\n.\nTime: 0.318\n\nOK (1 test)' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 26, 'prompt_tokens': 71009, 'total_tokens': 71035, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 69504}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--97117661-4d3a-44d7-85cd-f8a106fc4fcf-0' usage_metadata={'input_tokens': 71009, 'output_tokens': 26, 'total_tokens': 71035, 'input_token_details': {'audio': 0, 'cache_read': 69504}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:47:07,965 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_structured_node - DEBUG - reproduced_bug=False reproduced_bug_failure_log='Attempt 1 (mvn surefire):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test\n[ERROR] Failed to execute goal on project apollo-configservice: Could not resolve dependencies for project com.ctrip.framework.apollo:apollo-configservice:jar:2.1.0-SNAPSHOT: Could not find artifact com.ctrip.framework.apollo:apollo-biz:jar:2.1.0-SNAPSHOT -> [Help 1]\n\nAttempt 2 (install dependencies):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -DskipTests install -pl apollo-configservice -am\n(install completed, no error output)\n\nAttempt 3 (mvn surefire again):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.22.2:test (default-test) on project apollo-configservice: No tests were executed!  (Set -DfailIfNoTests=false to ignore this error.) -> [Help 1]\n\nAttempt 4 (manual JUnit run, missing class):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest\nJUnit version 4.13.2\n.E\nTime: 0.003\nThere was 1 failure:\n1) initializationError(org.junit.runner.JUnitCommandLineParseResult)\njava.lang.IllegalArgumentException: Could not find class [com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest]\nCaused by: java.lang.ClassNotFoundException: com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest\n\nAttempt 5 (manual JUnit run, missing hamcrest):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest\nJUnit version 4.13.2\nException in thread "main" java.lang.NoClassDefFoundError: org/hamcrest/SelfDescribing\nCaused by: java.lang.ClassNotFoundException: org.hamcrest.SelfDescribing\n\nAttempt 6 (manual JUnit run, correct classpath):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest\nJUnit version 4.13.2\n.\nTime: 0.318\n\nOK (1 test)\n\nExplanation: The test passed, but it should fail to demonstrate the unfixed bug. The reported issue describes a crash (HTTP 500) when querying namespaces after creating a namespace named with a single dot ("."). The provided test only asserts that filterNamespaceName(".") returns the same string, which does not exercise the query path nor reproduce the 500 error. It does not demonstrate the same underlying problem described in the issue (server-side crash on namespace query/refresh).\n\nTo properly reproduce the bug, the test needs to:\n- Create a namespace named "." within the relevant service (likely apollo-portal/apollo-configservice) and then invoke the namespace query/refresh API used by the UI.\n- Assert the observed erroneous behavior (e.g., an exception/500 error or NPE) matches the issue. A unit test against NamespaceUtil.filterNamespaceName is insufficient; an integration/controller test (e.g., ConfigController/NamespaceService in portal) that simulates the refresh operation is required.\n- Use the exact example from the issue (namespace name "." and a refresh/query operation) and verify the failure mode.\n' reproduced_bug_commands=['JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test', 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=**/NamespaceUtilSingleDotTest.java test', 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH javac -cp apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar -d /tmp/test-classes apollo/apollo-configservice/src/test/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtilSingleDotTest.java', 'JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest']
2025-11-12 11:47:07,967 - thread-135845287823040.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting bug_reproducing_file_messages in state.
2025-11-12 11:47:07,969 - thread-135845287823040.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting bug_reproducing_execute_messages in state.
2025-11-12 11:47:07,970 - thread-135845287823040.prometheus.lang_graph.nodes.git_reset_node - DEBUG - Resetting the git repository
2025-11-12 11:47:08,009 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_message_node - DEBUG - Sending message to BugReproducingWriteNode:
content='Your previous test case failed to reproduce the bug. Here is the failure log:\nAttempt 1 (mvn surefire):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test\n[ERROR] Failed to execute goal on project apollo-configservice: Could not resolve dependencies for project com.ctrip.framework.apollo:apollo-configservice:jar:2.1.0-SNAPSHOT: Could not find artifact com.ctrip.framework.apollo:apollo-biz:jar:2.1.0-SNAPSHOT -> [Help 1]\n\nAttempt 2 (install dependencies):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -DskipTests install -pl apollo-configservice -am\n(install completed, no error output)\n\nAttempt 3 (mvn surefire again):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH ./mvnw -q -pl apollo-configservice -Dtest=com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest test\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.22.2:test (default-test) on project apollo-configservice: No tests were executed!  (Set -DfailIfNoTests=false to ignore this error.) -> [Help 1]\n\nAttempt 4 (manual JUnit run, missing class):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest\nJUnit version 4.13.2\n.E\nTime: 0.003\nThere was 1 failure:\n1) initializationError(org.junit.runner.JUnitCommandLineParseResult)\njava.lang.IllegalArgumentException: Could not find class [com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest]\nCaused by: java.lang.ClassNotFoundException: com.ctrip.framework.apollo.configservice.util.NamespaceUtilSingleDotTest\n\nAttempt 5 (manual JUnit run, missing hamcrest):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest\nJUnit version 4.13.2\nException in thread "main" java.lang.NoClassDefFoundError: org/hamcrest/SelfDescribing\nCaused by: java.lang.ClassNotFoundException: org.hamcrest.SelfDescribing\n\nAttempt 6 (manual JUnit run, correct classpath):\nJAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto.x86_64 PATH=/usr/lib/jvm/java-17-amazon-corretto.x86_64/bin:$PATH java -cp /tmp/test-classes:apollo-configservice/target/classes:/root/.m2/repository/junit/junit/4.13.2/junit-4.13.2.jar:/root/.m2/repository/org/hamcrest/hamcrest/2.2/hamcrest-2.2.jar:/root/.m2/repository/org/mockito/mockito-core/4.0.0/mockito-core-4.0.0.jar:/root/.m2/repository/net/bytebuddy/byte-buddy/1.11.22/byte-buddy-1.11.22.jar:/root/.m2/repository/net/bytebuddy/byte-buddy-agent/1.11.22/byte-buddy-agent-1.11.22.jar:/root/.m2/repository/org/objenesis/objenesis/3.2/objenesis-3.2.jar org.junit.runner.JUnitCore NamespaceUtilSingleDotTest\nJUnit version 4.13.2\n.\nTime: 0.318\n\nOK (1 test)\n\nExplanation: The test passed, but it should fail to demonstrate the unfixed bug. The reported issue describes a crash (HTTP 500) when querying namespaces after creating a namespace named with a single dot ("."). The provided test only asserts that filterNamespaceName(".") returns the same string, which does not exercise the query path nor reproduce the 500 error. It does not demonstrate the same underlying problem described in the issue (server-side crash on namespace query/refresh).\n\nTo properly reproduce the bug, the test needs to:\n- Create a namespace named "." within the relevant service (likely apollo-portal/apollo-configservice) and then invoke the namespace query/refresh API used by the UI.\n- Assert the observed erroneous behavior (e.g., an exception/500 error or NPE) matches the issue. A unit test against NamespaceUtil.filterNamespaceName is insufficient; an integration/controller test (e.g., ConfigController/NamespaceService in portal) that simulates the refresh operation is required.\n- Use the exact example from the issue (namespace name "." and a refresh/query operation) and verify the failure mode.\n\n\nNow think about what went wrong and generate the complete self-contained test case that reproduces the bug with the same error/exception again.\n' additional_kwargs={} response_metadata={}
2025-11-12 11:47:12,520 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_caeRu7efpqueYA3rc0PTFoEJ', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 236, 'prompt_tokens': 16313, 'total_tokens': 16549, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d157078b-4e4b-4aa4-98b3-a2624d7d9342-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java'}, 'id': 'call_caeRu7efpqueYA3rc0PTFoEJ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16313, 'output_tokens': 236, 'total_tokens': 16549, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 11:47:18,755 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zuMlufemigHoGIJjxDLISga0', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/controller/ConfigController.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 556, 'prompt_tokens': 16903, 'total_tokens': 17459, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--68e6cc53-9777-4449-921a-c2437b58c08a-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/controller/ConfigController.java'}, 'id': 'call_zuMlufemigHoGIJjxDLISga0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 16903, 'output_tokens': 556, 'total_tokens': 17459, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 11:47:28,562 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_kr3KPeXCGWMvYfSaevgYFA4u', 'function': {'arguments': '{"relative_path":"apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 553, 'prompt_tokens': 19506, 'total_tokens': 20059, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--12737790-ccb4-4d28-8c6f-106c448cd3f5-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java'}, 'id': 'call_kr3KPeXCGWMvYfSaevgYFA4u', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19506, 'output_tokens': 553, 'total_tokens': 20059, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 11:47:38,838 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_87hnri7mvWFNWkxA3pZzhGVv', 'function': {'arguments': '{"relative_path":"apollo-core/src/main/java/com/ctrip/framework/apollo/core/ConfigConsts.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1001, 'prompt_tokens': 20076, 'total_tokens': 21077, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 16896}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--aa3fc801-6a27-4e2a-b6b8-19c1c8d54630-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo-core/src/main/java/com/ctrip/framework/apollo/core/ConfigConsts.java'}, 'id': 'call_87hnri7mvWFNWkxA3pZzhGVv', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20076, 'output_tokens': 1001, 'total_tokens': 21077, 'input_token_details': {'audio': 0, 'cache_read': 16896}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 11:48:09,564 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZcgWG7R3u5JLxyqTaQxldd67', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2156, 'prompt_tokens': 20430, 'total_tokens': 22586, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2112, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 16256}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0ee984dd-f96b-4eea-a927-9a7b229caced-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java'}, 'id': 'call_ZcgWG7R3u5JLxyqTaQxldd67', 'type': 'tool_call'}] usage_metadata={'input_tokens': 20430, 'output_tokens': 2156, 'total_tokens': 22586, 'input_token_details': {'audio': 0, 'cache_read': 16256}, 'output_token_details': {'audio': 0, 'reasoning': 2112}}
2025-11-12 11:48:23,683 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OLLFirD28yRTj7Dnxpt6DLDM', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1388, 'prompt_tokens': 24233, 'total_tokens': 25621, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 19968}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--74311efb-8b3a-4df5-a608-9a00e7f562f4-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java'}, 'id': 'call_OLLFirD28yRTj7Dnxpt6DLDM', 'type': 'tool_call'}] usage_metadata={'input_tokens': 24233, 'output_tokens': 1388, 'total_tokens': 25621, 'input_token_details': {'audio': 0, 'cache_read': 19968}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-12 11:48:40,364 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4UtOlgOgwspHhoRu4sDMI4jz', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/AbstractControllerTest.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1005, 'prompt_tokens': 28959, 'total_tokens': 29964, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b4aca207-42de-4179-b216-bb85ad954275-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/AbstractControllerTest.java'}, 'id': 'call_4UtOlgOgwspHhoRu4sDMI4jz', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28959, 'output_tokens': 1005, 'total_tokens': 29964, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 11:48:42,699 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_BnGLjbqXr6KxoRmFU9FiZQH4', 'function': {'arguments': '{"relative_path":"apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/AbstractControllerTest.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 29036, 'total_tokens': 29077, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--acd8029a-94e0-47ac-bab3-55ade494699c-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo-portal/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/AbstractControllerTest.java'}, 'id': 'call_BnGLjbqXr6KxoRmFU9FiZQH4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 29036, 'output_tokens': 41, 'total_tokens': 29077, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:48:45,492 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_j0P5ScjPu8O6gEvirn0m7Nfy', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AbstractControllerTest.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 39, 'prompt_tokens': 29630, 'total_tokens': 29669, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--637084fc-5888-40e1-ab82-a53cf66ccf75-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo-adminservice/src/test/java/com/ctrip/framework/apollo/adminservice/controller/AbstractControllerTest.java'}, 'id': 'call_j0P5ScjPu8O6gEvirn0m7Nfy', 'type': 'tool_call'}] usage_metadata={'input_tokens': 29630, 'output_tokens': 39, 'total_tokens': 29669, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:50:19,097 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_write_node - DEBUG - content='import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;\nimport com.ctrip.framework.apollo.common.entity.AppNamespace;\nimport com.ctrip.framework.apollo.openapi.v1.controller.AbstractControllerTest;\nimport org.junit.Assert;\nimport org.junit.Test;\nimport org.springframework.test.context.ActiveProfiles;\nimport org.springframework.http.ResponseEntity;\n\n@ActiveProfiles("skipAuthorization")\npublic class NamespaceControllerSingleDotTest extends AbstractControllerTest {\n\n  @Test\n  public void shouldDisplayNamespaceWithSingleDot() {\n    String appId = "app-single-dot";\n    String namespaceName = ".";\n\n    // create app namespace with single dot\n    AppNamespace appNamespace = new AppNamespace();\n    appNamespace.setAppId(appId);\n    appNamespace.setName(namespaceName);\n    appNamespace.setComment("single dot namespace");\n    appNamespace.setDataChangeCreatedBy("apollo");\n\n    restTemplate.postForEntity(\n        url("/apps/{appId}/appnamespaces"),\n        appNamespace,\n        AppNamespace.class,\n        appId\n    );\n\n    // query the created app namespace, expecting no server error\n    ResponseEntity<AppNamespaceDTO> response = restTemplate.getForEntity(\n        url("/apps/{appId}/appnamespaces/{namespaceName}"),\n        AppNamespaceDTO.class,\n        appId, namespaceName\n    );\n\n    Assert.assertEquals(namespaceName, response.getBody().getName());\n  }\n}' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 8168, 'prompt_tokens': 30213, 'total_tokens': 38381, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 7872, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--c0b3bee7-08d2-4ef0-80f9-571e42faa46a-0' usage_metadata={'input_tokens': 30213, 'output_tokens': 8168, 'total_tokens': 38381, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 7872}}
2025-11-12 11:50:25,868 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_p1eoUOuiFk9jWPyNLMYIl8UQ', 'function': {'arguments': '{"relative_path":"apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/AbstractControllerTest.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 433, 'prompt_tokens': 4786, 'total_tokens': 5219, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7cc5fc16-4b35-4bf1-8579-efc6bbdc6d84-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/AbstractControllerTest.java'}, 'id': 'call_p1eoUOuiFk9jWPyNLMYIl8UQ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4786, 'output_tokens': 433, 'total_tokens': 5219, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 11:50:32,754 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_cm2S5pKDw0efbUZ5bDXRip9Y', 'function': {'arguments': '{"relative_path":"apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 625, 'prompt_tokens': 4871, 'total_tokens': 5496, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--76112664-3094-4226-872c-4f405ca72cb9-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerTest.java'}, 'id': 'call_cm2S5pKDw0efbUZ5bDXRip9Y', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4871, 'output_tokens': 625, 'total_tokens': 5496, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 11:50:40,944 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_B2XW9FUZEBnxYLDam15SCOcd', 'function': {'arguments': '{"relative_path":"apollo/apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/AbstractControllerTest.java"}', 'name': 'read_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 431, 'prompt_tokens': 4956, 'total_tokens': 5387, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4736}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f1f9a04c-6f33-4236-aa39-1425f9be76e8-0' tool_calls=[{'name': 'read_file', 'args': {'relative_path': 'apollo/apollo-portal/src/test/java/com/ctrip/framework/apollo/portal/controller/AbstractControllerTest.java'}, 'id': 'call_B2XW9FUZEBnxYLDam15SCOcd', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4956, 'output_tokens': 431, 'total_tokens': 5387, 'input_token_details': {'audio': 0, 'cache_read': 4736}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 11:50:53,375 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_tNskdqLF4jqKgJtoSDMGdl2n', 'function': {'arguments': '{"relative_path":"apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java","content":"package com.ctrip.framework.apollo.openapi.v1.controller;\\n\\nimport com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;\\nimport com.ctrip.framework.apollo.common.entity.AppNamespace;\\nimport org.junit.Assert;\\nimport org.junit.Test;\\nimport org.springframework.test.context.ActiveProfiles;\\nimport org.springframework.http.ResponseEntity;\\n\\n@ActiveProfiles(\\"skipAuthorization\\")\\npublic class NamespaceControllerSingleDotTest extends AbstractControllerTest {\\n\\n  @Test\\n  public void shouldDisplayNamespaceWithSingleDot() {\\n    String appId = \\"app-single-dot\\";\\n    String namespaceName = \\".\\";\\n\\n    // create app namespace with single dot\\n    AppNamespace appNamespace = new AppNamespace();\\n    appNamespace.setAppId(appId);\\n    appNamespace.setName(namespaceName);\\n    appNamespace.setComment(\\"single dot namespace\\");\\n    appNamespace.setDataChangeCreatedBy(\\"apollo\\");\\n\\n    restTemplate.postForEntity(\\n        url(\\"/apps/{appId}/appnamespaces\\"),\\n        appNamespace,\\n        AppNamespace.class,\\n        appId\\n    );\\n\\n    // query the created app namespace, expecting no server error\\n    ResponseEntity<AppNamespaceDTO> response = restTemplate.getForEntity(\\n        url(\\"/apps/{appId}/appnamespaces/{namespaceName}\\"),\\n        AppNamespaceDTO.class,\\n        appId, namespaceName\\n    );\\n\\n    Assert.assertEquals(namespaceName, response.getBody().getName());\\n  }\\n}\\n"}', 'name': 'create_file'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1286, 'prompt_tokens': 5037, 'total_tokens': 6323, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 896, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--997ce2eb-ba7c-495b-9cde-6b9b92c4f063-0' tool_calls=[{'name': 'create_file', 'args': {'relative_path': 'apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java', 'content': 'package com.ctrip.framework.apollo.openapi.v1.controller;\n\nimport com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;\nimport com.ctrip.framework.apollo.common.entity.AppNamespace;\nimport org.junit.Assert;\nimport org.junit.Test;\nimport org.springframework.test.context.ActiveProfiles;\nimport org.springframework.http.ResponseEntity;\n\n@ActiveProfiles("skipAuthorization")\npublic class NamespaceControllerSingleDotTest extends AbstractControllerTest {\n\n  @Test\n  public void shouldDisplayNamespaceWithSingleDot() {\n    String appId = "app-single-dot";\n    String namespaceName = ".";\n\n    // create app namespace with single dot\n    AppNamespace appNamespace = new AppNamespace();\n    appNamespace.setAppId(appId);\n    appNamespace.setName(namespaceName);\n    appNamespace.setComment("single dot namespace");\n    appNamespace.setDataChangeCreatedBy("apollo");\n\n    restTemplate.postForEntity(\n        url("/apps/{appId}/appnamespaces"),\n        appNamespace,\n        AppNamespace.class,\n        appId\n    );\n\n    // query the created app namespace, expecting no server error\n    ResponseEntity<AppNamespaceDTO> response = restTemplate.getForEntity(\n        url("/apps/{appId}/appnamespaces/{namespaceName}"),\n        AppNamespaceDTO.class,\n        appId, namespaceName\n    );\n\n    Assert.assertEquals(namespaceName, response.getBody().getName());\n  }\n}\n'}, 'id': 'call_tNskdqLF4jqKgJtoSDMGdl2n', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5037, 'output_tokens': 1286, 'total_tokens': 6323, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 896}}
2025-11-12 11:50:54,459 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_file_node - DEBUG - content='apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 5465, 'total_tokens': 5496, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4992}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--fd287434-3b5f-49d7-863d-cf4c51da7e8f-0' usage_metadata={'input_tokens': 5465, 'output_tokens': 31, 'total_tokens': 5496, 'input_token_details': {'audio': 0, 'cache_read': 4992}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:50:54,495 - thread-135845287823040.prometheus.lang_graph.nodes.git_diff_node - INFO - Generated patch:
diff --git a/apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java b/apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java
new file mode 100644
index 000000000..24f530287
--- /dev/null
+++ b/apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java
@@ -0,0 +1,41 @@
+package com.ctrip.framework.apollo.openapi.v1.controller;
+
+import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
+import com.ctrip.framework.apollo.common.entity.AppNamespace;
+import org.junit.Assert;
+import org.junit.Test;
+import org.springframework.test.context.ActiveProfiles;
+import org.springframework.http.ResponseEntity;
+
+@ActiveProfiles("skipAuthorization")
+public class NamespaceControllerSingleDotTest extends AbstractControllerTest {
+
+  @Test
+  public void shouldDisplayNamespaceWithSingleDot() {
+    String appId = "app-single-dot";
+    String namespaceName = ".";
+
+    // create app namespace with single dot
+    AppNamespace appNamespace = new AppNamespace();
+    appNamespace.setAppId(appId);
+    appNamespace.setName(namespaceName);
+    appNamespace.setComment("single dot namespace");
+    appNamespace.setDataChangeCreatedBy("apollo");
+
+    restTemplate.postForEntity(
+        url("/apps/{appId}/appnamespaces"),
+        appNamespace,
+        AppNamespace.class,
+        appId
+    );
+
+    // query the created app namespace, expecting no server error
+    ResponseEntity<AppNamespaceDTO> response = restTemplate.getForEntity(
+        url("/apps/{appId}/appnamespaces/{namespaceName}"),
+        AppNamespaceDTO.class,
+        appId, namespaceName
+    );
+
+    Assert.assertEquals(namespaceName, response.getBody().getName());
+  }
+}

2025-11-12 11:50:54,497 - thread-135845287823040.prometheus.lang_graph.nodes.update_container_node - INFO - Copy over all updated files to the container
2025-11-12 11:50:54,528 - thread-135845287823040.prometheus.docker.base_container - INFO - Resetting git repository in the container
2025-11-12 11:50:54,528 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: git reset --hard
2025-11-12 11:50:54,782 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:50:54,782 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
HEAD is now at 526a93506 Fix Apollo checks the yaml format interface Response Code = 500  (#4567)
[?2004l
2025-11-12 11:50:54,782 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: git clean -fd
2025-11-12 11:50:54,884 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:50:54,884 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Removing apollo/
[?2004l
2025-11-12 11:50:54,885 - thread-135845287823040.prometheus.docker.base_container - INFO - Updating files in the container after edits.
2025-11-12 11:50:54,885 - thread-135845287823040.prometheus.docker.base_container - INFO - Creating directory apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller in the container
2025-11-12 11:50:54,885 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: mkdir -p apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller
2025-11-12 11:50:54,987 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:50:54,987 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 mkdir -p apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo
o/openapi/v1/controller
[?2004l
[?2004l
2025-11-12 11:50:54,987 - thread-135845287823040.prometheus.docker.base_container - INFO - Updating apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java in the container
2025-11-12 11:50:54,996 - thread-135845287823040.prometheus.docker.base_container - INFO - Files updated successfully
2025-11-12 11:51:01,670 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ssmuOizhiB1mnj4gfZYu5LpZ', 'function': {'arguments': '{"command":"ls -la"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 410, 'prompt_tokens': 631, 'total_tokens': 1041, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0767180a-bb78-4432-b8cf-d48f64500305-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la'}, 'id': 'call_ssmuOizhiB1mnj4gfZYu5LpZ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 631, 'output_tokens': 410, 'total_tokens': 1041, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 11:51:01,673 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la
2025-11-12 11:51:01,775 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:51:01,775 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 332
drwxr-xr-x 1 root root  4096 Nov 12 11:50 .
drwxr-xr-x 1 root root  4096 Nov 12 11:50 ..
-rw-r--r-- 1 root root 24089 Nov 12 11:41 .flattened-pom.xml
drwxrwxr-x 1 root root  4096 Nov 12 11:50 .git
-rw-r--r-- 1 root root    27 Nov 12 11:40 .gitattributes
drwxrwxr-x 1 root root  4096 Nov 12 11:40 .github
-rw-r--r-- 1 root root   317 Nov 12 11:40 .gitignore
-rw-r--r-- 1 root root  1490 Nov 12 11:40 .licenserc.yaml
drwxrwxr-x 1 root root  4096 Aug 24 21:16 .mvn
-rw-r--r-- 1 root root  3126 Nov 12 11:40 CHANGES.md
-rw-r--r-- 1 root root  3227 Nov 12 11:40 CODE_OF_CONDUCT.md
-rw-r--r-- 1 root root  2332 Nov 12 11:40 CONTRIBUTING.md
-rw-r--r-- 1 root root  6024 Nov 12 11:40 GOVERNANCE.md
-rw-r--r-- 1 root root 11357 Nov 12 11:40 LICENSE
-rw-r--r-- 1 root root 49958 Nov 12 11:40 README.md
-rw-r--r-- 1 root root   598 Nov 12 11:40 SECURITY.md
drwxr-xr-x 3 root root  4096 Nov 12 11:50 apollo
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-adminservice
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-assembly
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-biz
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-buildtools
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-client
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-client-config-data
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-common
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-configservice
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-core
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-mockserver
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-openapi
drwxrwxr-x 1 root root  4096 Nov 12 11:40 apollo-portal
drwxrwxr-x 1 root root  4096 Nov 12 11:40 changes
drwxrwxr-x 1 root root  4096 Aug 24 21:16 doc
drwxrwxr-x 1 root root  4096 Nov 12 11:40 docs
-rwxr-xr-x 1 root root  9113 Nov 12 11:40 mvnw
-rwxr-xr-x 1 root root  5810 Nov 12 11:40 mvnw.cmd
-rw-r--r-- 1 root root 22960 Nov 12 11:40 pom.xml
drwxrwxr-x 1 root root  4096 Nov 12 11:40 scripts
drwxr-xr-x 3 root root  4096 Aug 24 21:16 target
[?2004l
2025-11-12 11:51:18,487 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_X4zSoQpun2Dcm8p9uIcvVEbx', 'function': {'arguments': '{"command":"./mvnw -q -DskipTests install"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1378, 'prompt_tokens': 1590, 'total_tokens': 2968, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--87c2781e-29b5-4e98-9a58-895140460627-0' tool_calls=[{'name': 'run_command', 'args': {'command': './mvnw -q -DskipTests install'}, 'id': 'call_X4zSoQpun2Dcm8p9uIcvVEbx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1590, 'output_tokens': 1378, 'total_tokens': 2968, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-12 11:51:18,490 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ./mvnw -q -DskipTests install
2025-11-12 11:51:18,592 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 1
2025-11-12 11:51:18,592 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
./mvnw: line 121: which: command not found
./mvnw: line 149: which: command not found
Error: JAVA_HOME is not defined correctly.
  We cannot execute 
[?2004l
2025-11-12 11:51:25,521 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_FjegBz5KNQzdekfjCk0agb2d', 'function': {'arguments': '{"command":"ls -la apollo"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 668, 'prompt_tokens': 1685, 'total_tokens': 2353, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--459e5c6c-1abc-4975-a501-6fdf58c8f56b-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo'}, 'id': 'call_FjegBz5KNQzdekfjCk0agb2d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1685, 'output_tokens': 668, 'total_tokens': 2353, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-12 11:51:25,525 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo
2025-11-12 11:51:25,626 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:51:25,626 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
total 16
drwxr-xr-x 3 root root 4096 Nov 12 11:50 .
drwxr-xr-x 1 root root 4096 Nov 12 11:50 ..
drwxr-xr-x 3 root root 4096 Nov 12 11:50 apollo-openapi
[?2004l
2025-11-12 11:51:26,658 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WnKNGSP51o0ULHCa0jwgS3Kb', 'function': {'arguments': '{"command":"ls -la apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 1801, 'total_tokens': 1842, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4489f3b8-2d24-43e2-a199-4d50990080a9-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller'}, 'id': 'call_WnKNGSP51o0ULHCa0jwgS3Kb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1801, 'output_tokens': 41, 'total_tokens': 1842, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:51:26,662 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller
2025-11-12 11:51:26,763 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:51:26,763 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/o
openapi/v1/controller
[?2004l
total 12
drwxr-xr-x 2 root root 4096 Nov 12 11:50 .
drwxr-xr-x 3 root root 4096 Nov 12 11:50 ..
-rw-r--r-- 1 root root 1353 Nov 12 11:50 NamespaceControllerSingleDotTest.java
[?2004l
2025-11-12 11:51:32,347 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1JvCY7LFdXcw0UcNZbdshZTO', 'function': {'arguments': '{"command":"apt-get update"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 346, 'prompt_tokens': 1965, 'total_tokens': 2311, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f041714b-1428-48b3-9fb8-ff3003a34f13-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'apt-get update'}, 'id': 'call_1JvCY7LFdXcw0UcNZbdshZTO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 1965, 'output_tokens': 346, 'total_tokens': 2311, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 11:51:32,350 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: apt-get update
2025-11-12 11:51:32,452 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 127
2025-11-12 11:51:32,452 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
bash: apt-get: command not found
[?2004l
2025-11-12 11:51:33,874 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_BfJk4AITnKjv7TYdDS4w8KdG', 'function': {'arguments': '{"command":"uname -a && cat /etc/*-release || true"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 35, 'prompt_tokens': 2017, 'total_tokens': 2052, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4a0eaf2b-025a-4373-b53f-8b096cde647a-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'uname -a && cat /etc/*-release || true'}, 'id': 'call_BfJk4AITnKjv7TYdDS4w8KdG', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2017, 'output_tokens': 35, 'total_tokens': 2052, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:51:33,877 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: uname -a && cat /etc/*-release || true
2025-11-12 11:51:33,978 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:51:33,978 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
Linux ucl-research 6.8.0-36-generic #36-Ubuntu SMP PREEMPT_DYNAMIC Mon Jun 10 10:49:14 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
Amazon Linux release 2023.8.20250808 (Amazon Linux)
NAME="Amazon Linux"
VERSION="2023"
ID="amzn"
ID_LIKE="fedora"
VERSION_ID="2023"
PLATFORM_ID="platform:al2023"
PRETTY_NAME="Amazon Linux 2023.8.20250808"
ANSI_COLOR="0;33"
CPE_NAME="cpe:2.3:o:amazon:amazon_linux:2023"
HOME_URL="https://aws.amazon.com/linux/amazon-linux-2023/"
DOCUMENTATION_URL="https://docs.aws.amazon.com/linux/"
SUPPORT_URL="https://aws.amazon.com/premiumsupport/"
BUG_REPORT_URL="https://github.com/amazonlinux/amazon-linux-2023"
VENDOR_NAME="AWS"
VENDOR_URL="https://aws.amazon.com/"
SUPPORT_END="2029-06-30"
Amazon Linux release 2023.8.20250808 (Amazon Linux)
[?2004l
2025-11-12 11:51:37,911 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Fe38wBy4HH0q36Jx071q0aas', 'function': {'arguments': '{"command":"ls -la /usr/lib/jvm || true; java -version || true; mvn -version || true; echo $JAVA_HOME || true; command -v which || true; command -v dnf || true; command -v yum || true; command -v microdnf || true; command -v zypper || true; command -v apk || true"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 228, 'prompt_tokens': 2322, 'total_tokens': 2550, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b0bc1c12-55ea-4264-a049-3ee26eda3623-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la /usr/lib/jvm || true; java -version || true; mvn -version || true; echo $JAVA_HOME || true; command -v which || true; command -v dnf || true; command -v yum || true; command -v microdnf || true; command -v zypper || true; command -v apk || true'}, 'id': 'call_Fe38wBy4HH0q36Jx071q0aas', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2322, 'output_tokens': 228, 'total_tokens': 2550, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 11:51:37,913 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la /usr/lib/jvm || true; java -version || true; mvn -version || true; echo $JAVA_HOME || true; command -v which || true; command -v dnf || true; command -v yum || true; command -v microdnf || true; command -v zypper || true; command -v apk || true
2025-11-12 11:51:38,301 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:51:38,301 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la /usr/lib/jvm || true; java -version || true; mvn -version || tru
ue; echo $JAVA_HOME || true; command -v which || true; command -v dnf || true; co
ommand -v yum || true; command -v microdnf || true; command -v zypper || true; co
ommand -v apk || true
[?2004l
total 20
drwxr-xr-x 1 root root 4096 Aug 24 21:16 .
dr-xr-xr-x 1 root root 4096 Aug 24 19:54 ..
lrwxrwxrwx 1 root root   26 Aug 24 19:54 java -> /etc/alternatives/java_sdk
lrwxrwxrwx 1 root root   32 Aug 24 19:54 java-1.8.0 -> /etc/alternatives/java_sdk_1.8.0
lrwxrwxrwx 1 root root   44 Aug 24 21:16 java-1.8.0-amazon-corretto -> /etc/alternatives/java-1.8.0-amazon-corretto
drwxr-xr-x 9 root root 4096 Aug 24 19:54 java-1.8.0-amazon-corretto.x86_64
lrwxrwxrwx 1 root root   40 Aug 24 19:54 java-1.8.0-openjdk -> /etc/alternatives/java_sdk_1.8.0_openjdk
lrwxrwxrwx 1 root root   29 Aug 24 19:54 java-11 -> /etc/alternatives/java_sdk_11
drwxr-xr-x 9 root root 4096 Aug 24 19:54 java-11-amazon-corretto.x86_64
lrwxrwxrwx 1 root root   37 Aug 24 19:54 java-11-openjdk -> /etc/alternatives/java_sdk_11_openjdk
lrwxrwxrwx 1 root root   29 Aug 24 19:54 java-17 -> /etc/alternatives/java_sdk_17
drwxr-xr-x 9 root root 4096 Aug 24 19:54 java-17-amazon-corretto.x86_64
lrwxrwxrwx 1 root root   37 Aug 24 19:54 java-17-openjdk -> /etc/alternatives/java_sdk_17_openjdk
lrwxrwxrwx 1 root root   21 Aug 24 19:54 jre -> /etc/alternatives/jre
lrwxrwxrwx 1 root root   27 Aug 24 19:54 jre-1.8.0 -> /etc/alternatives/jre_1.8.0
lrwxrwxrwx 1 root root   35 Aug 24 19:54 jre-1.8.0-openjdk -> /etc/alternatives/jre_1.8.0_openjdk
lrwxrwxrwx 1 root root   24 Aug 24 19:54 jre-11 -> /etc/alternatives/jre_11
lrwxrwxrwx 1 root root   32 Aug 24 19:54 jre-11-openjdk -> /etc/alternatives/jre_11_openjdk
lrwxrwxrwx 1 root root   24 Aug 24 19:54 jre-17 -> /etc/alternatives/jre_17
lrwxrwxrwx 1 root root   32 Aug 24 19:54 jre-17-openjdk -> /etc/alternatives/jre_17_openjdk
openjdk version "1.8.0_462"
OpenJDK Runtime Environment Corretto-8.462.08.1 (build 1.8.0_462-b08)
OpenJDK 64-Bit Server VM Corretto-8.462.08.1 (build 25.462-b08, mixed mode)
[1mApache Maven 3.9.11 (3e54c93a704957b63ee3494413a2b544fd3d825b)[m
Maven home: /usr/local/apache-maven-3.9.11
Java version: 1.8.0_462, vendor: Amazon.com Inc., runtime: /usr/lib/jvm/java-1.8.0-amazon-corretto.x86_64/jre
Default locale: en_US, platform encoding: ANSI_X3.4-1968
OS name: "linux", version: "6.8.0-36-generic", arch: "amd64", family: "unix"
[0m[0m
/usr/bin/dnf
/usr/bin/yum
[?2004l
2025-11-12 11:51:42,629 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_wGdej8q5KbJxqF0nA1QB2X3d', 'function': {'arguments': '{"command":"ls -la apollo/apollo-openapi; cat apollo/apollo-openapi/pom.xml | sed -n \'1,120p\'"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 309, 'prompt_tokens': 3490, 'total_tokens': 3799, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c26ecb25-7859-437a-9823-9dc2e503cd29-0' tool_calls=[{'name': 'run_command', 'args': {'command': "ls -la apollo/apollo-openapi; cat apollo/apollo-openapi/pom.xml | sed -n '1,120p'"}, 'id': 'call_wGdej8q5KbJxqF0nA1QB2X3d', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3490, 'output_tokens': 309, 'total_tokens': 3799, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 11:51:42,632 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo/apollo-openapi; cat apollo/apollo-openapi/pom.xml | sed -n '1,120p'
2025-11-12 11:51:42,733 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:51:42,733 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo/apollo-openapi; cat apollo/apollo-openapi/pom.xml | sed -
-n '1,120p'
[?2004l
total 12
drwxr-xr-x 3 root root 4096 Nov 12 11:50 .
drwxr-xr-x 3 root root 4096 Nov 12 11:50 ..
drwxr-xr-x 3 root root 4096 Nov 12 11:50 src
cat: apollo/apollo-openapi/pom.xml: No such file or directory
[?2004l
2025-11-12 11:51:45,584 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_u4K0jrwuMGhCGnOxPrNAf6WZ', 'function': {'arguments': '{"command":"sed -n \'1,200p\' pom.xml"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 162, 'prompt_tokens': 3676, 'total_tokens': 3838, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 1536}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c44ed9e7-d338-486e-b8a3-c6815a25dc0e-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' pom.xml"}, 'id': 'call_u4K0jrwuMGhCGnOxPrNAf6WZ', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3676, 'output_tokens': 162, 'total_tokens': 3838, 'input_token_details': {'audio': 0, 'cache_read': 1536}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 11:51:45,589 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: sed -n '1,200p' pom.xml
2025-11-12 11:51:45,691 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:51:45,691 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2022 Apollo Authors
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
-->
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<groupId>com.ctrip.framework.apollo</groupId>
	<artifactId>apollo</artifactId>
	<version>${revision}</version>
	<name>Apollo</name>
	<packaging>pom</packaging>
	<description>Configuration Center</description>
	<url>https://github.com/apolloconfig/apollo</url>

	<licenses>
		<license>
			<name>Apache License, Version 2.0</name>
			<url>http://www.apache.org/licenses/LICENSE-2.0</url>
		</license>
	</licenses>

	<scm>
		<url>https://github.com/apolloconfig/apollo</url>
		<connection>scm:git:git@github.com:apolloconfig/apollo.git</connection>
		<developerConnection>scm:git:ssh://git@github.com:apolloconfig/apollo.git</developerConnection>
	</scm>

	<ciManagement>
		<system>GitHub Actions</system>
		<url>https://github.com/apolloconfig/apollo/actions</url>
	</ciManagement>

	<issueManagement>
		<system>github</system>
		<url>https://github.com/apolloconfig/apollo/issues</url>
	</issueManagement>

	<developers>
		<developer>
			<id>apollo</id>
			<name>The Apollo Project Contributors</name>
			<email>apollo-config@googlegroups.com</email>
			<url>https://www.apolloconfig.com/</url>
		</developer>
	</developers>

	<properties>
		<revision>2.1.0-SNAPSHOT</revision>
		<java.version>1.8</java.version>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<spring-boot.version>2.6.8</spring-boot.version>
		<spring-cloud.version>2021.0.2</spring-cloud.version>
		<spring-security.version>5.7.3</spring-security.version>
		<jaxb.version>2.3.1</jaxb.version>
		<javax.activation.version>1.1.1</javax.activation.version>
		<javax.mail.version>1.6.2</javax.mail.version>
		<javassist.version>3.23.1-GA</javassist.version>
		<nacos-discovery-api.version>1.4.0</nacos-discovery-api.version>
		<common-lang3.version>3.12.0</common-lang3.version>
		<mysql-connector-java.version>8.0.29</mysql-connector-java.version>
		<cat.client.version>3.1.0</cat.client.version>
		<!-- Plugins Version -->
		<maven-compiler-plugin.version>3.10.1</maven-compiler-plugin.version>
		<maven-surefire-plugin.version>2.22.2</maven-surefire-plugin.version>
		<maven-source-plugin.version>3.2.1</maven-source-plugin.version>
		<maven-jar-plugin.version>3.2.2</maven-jar-plugin.version>
		<maven-war-plugin.version>3.3.2</maven-war-plugin.version>
		<maven-install-plugin.version>2.5.2</maven-install-plugin.version>
		<maven-deploy-plugin.version>2.8.2</maven-deploy-plugin.version>
		<maven-javadoc-plugin.version>3.4.0</maven-javadoc-plugin.version>
		<maven-gpg-plugin.version>3.0.1</maven-gpg-plugin.version>
		<maven-assembly-plugin.version>3.3.0</maven-assembly-plugin.version>
	</properties>

	<modules>
		<module>apollo-buildtools</module>
		<module>apollo-core</module>
		<module>apollo-client</module>
		<module>apollo-client-config-data</module>
		<module>apollo-common</module>
		<module>apollo-biz</module>
		<module>apollo-configservice</module>
		<module>apollo-adminservice</module>
		<module>apollo-portal</module>
		<module>apollo-assembly</module>
		<module>apollo-mockserver</module>
		<module>apollo-openapi</module>
	</modules>

	<dependencyManagement>
		<dependencies>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-core</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-client</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-common</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-biz</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-buildtools</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-configservice</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-adminservice</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-portal</artifactId>
				<version>${project.version}</version>
			</dependency>
			<dependency>
				<groupId>com.ctrip.framework.apollo</groupId>
				<artifactId>apollo-openapi</artifactId>
				<version>${project.version}</version>
			</dependency>
			<!--third party -->
			<dependency>
				<groupId>org.slf4j</groupId>
				<artifactId>slf4j-api</artifactId>
				<version>1.7.21</version>
			</dependency>
			<dependency>
				<groupId>com.google.guava</groupId>
				<artifactId>guava</artifactId>
				<version>31.0.1-jre</version>
			</dependency>
			<dependency>
				<groupId>com.google.code.gson</groupId>
				<artifactId>gson</artifactId>
				<version>2.8.9</version>
			</dependency>
			<dependency>
				<groupId>mysql</groupId>
				<artifactId>mysql-connector-java</artifactId>
				<version>${mysql-connector-java.version}</version>
			</dependency>
			<dependency>
				<groupId>com.google.inject</groupId>
				<artifactId>guice</artifactId>
				<version>5.0.1</version>
			</dependency>
			<dependency>
				<groupId>org.apache.commons</groupId>
				<artifactId>commons-lang3</artifactId>
				<version>${common-lang3.version}</version>
			</dependency>
			<dependency>
				<groupId>com.dianping.cat</groupId>
				<artifactId>cat-client</artifactId>
				<version>${cat.client.version}</version>
			</dependency>
			<!-- to fix CVE-2020-26217 -->
			<dependency>
				<groupId>com.thoughtworks.xstream</groupId>
				<artifactId>xstream</artifactId>
				<version>1.4.19</version>
			</dependency>
			<!--for test -->
			<dependency>
				<groupId>com.h2database</groupId>
				<artifactId>h2</artifactId>
				<version>1.4.191</version>
				<scope>test</scope>
			</dependency>
[?2004l
2025-11-12 11:51:46,976 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4SuFQuPtrxYwKk2cRoX6Afbf', 'function': {'arguments': '{"command":"sed -n \'200,500p\' pom.xml"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 5889, 'total_tokens': 5917, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3584}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e06343c0-9ebd-4200-8b35-18ef97d71581-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '200,500p' pom.xml"}, 'id': 'call_4SuFQuPtrxYwKk2cRoX6Afbf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 5889, 'output_tokens': 28, 'total_tokens': 5917, 'input_token_details': {'audio': 0, 'cache_read': 3584}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:51:46,980 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: sed -n '200,500p' pom.xml
2025-11-12 11:51:47,082 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:51:47,082 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
			</dependency>
			<dependency>
				<groupId>org.awaitility</groupId>
				<artifactId>awaitility</artifactId>
				<version>4.0.3</version>
				<scope>test</scope>
			</dependency>
			<dependency>
				<groupId>org.junit.vintage</groupId>
				<artifactId>junit-vintage-engine</artifactId>
				<version>5.7.0</version>
				<scope>test</scope>
			</dependency>
			<dependency>
				<groupId>com.github.stefanbirkner</groupId>
				<artifactId>system-lambda</artifactId>
				<version>1.2.0</version>
				<scope>test</scope>
			</dependency>
			<!-- Spring-security BOMs -->
			<dependency>
				<groupId>org.springframework.security</groupId>
				<artifactId>spring-security-bom</artifactId>
				<version>${spring-security.version}</version>
				<type>pom</type>
				<scope>import</scope>
			</dependency>
			<!-- declare Spring BOMs in order -->
			<dependency>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-dependencies</artifactId>
				<version>${spring-boot.version}</version>
				<type>pom</type>
				<scope>import</scope>
			</dependency>
			<dependency>
				<groupId>org.springframework.cloud</groupId>
				<artifactId>spring-cloud-dependencies</artifactId>
				<version>${spring-cloud.version}</version>
				<type>pom</type>
				<scope>import</scope>
			</dependency>
			<!-- required by eureka -->
			<dependency>
				<groupId>com.sun.jersey.contribs</groupId>
				<artifactId>jersey-apache-client4</artifactId>
				<version>1.19.4</version>
			</dependency>
			<!-- JDK 1.8+ -->
			<dependency>
				<groupId>javax.xml.bind</groupId>
				<artifactId>jaxb-api</artifactId>
				<version>${jaxb.version}</version>
			</dependency>
			<dependency>
				<groupId>com.sun.xml.bind</groupId>
				<artifactId>jaxb-impl</artifactId>
				<version>${jaxb.version}</version>
			</dependency>
			<dependency>
				<groupId>org.glassfish.jaxb</groupId>
				<artifactId>jaxb-runtime</artifactId>
				<version>${jaxb.version}</version>
			</dependency>
			<dependency>
				<groupId>javax.activation</groupId>
				<artifactId>activation</artifactId>
				<version>${javax.activation.version}</version>
			</dependency>
			<dependency>
				<groupId>com.sun.mail</groupId>
				<artifactId>javax.mail</artifactId>
				<version>${javax.mail.version}</version>
			</dependency>
			<!-- JDK 11+ -->
			<dependency>
				<groupId>org.javassist</groupId>
				<artifactId>javassist</artifactId>
				<version>${javassist.version}</version>
			</dependency>
			<!-- end of JDK 11+ -->
		</dependencies>
	</dependencyManagement>

	<dependencies>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-test</artifactId>
			<scope>test</scope>
			<exclusions>
				<exclusion>
					<artifactId>spring-boot-starter</artifactId>
					<groupId>org.springframework.boot</groupId>
				</exclusion>
			</exclusions>
		</dependency>
		<dependency>
			<groupId>org.awaitility</groupId>
			<artifactId>awaitility</artifactId>
			<scope>test</scope>
		</dependency>
		<!-- for junit 4 -->
		<dependency>
			<groupId>org.junit.vintage</groupId>
			<artifactId>junit-vintage-engine</artifactId>
			<scope>test</scope>
			<exclusions>
				<exclusion>
					<groupId>org.hamcrest</groupId>
					<artifactId>hamcrest-core</artifactId>
				</exclusion>
			</exclusions>
		</dependency>
	</dependencies>

	<build>
		<pluginManagement>
			<plugins>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-compiler-plugin</artifactId>
					<version>${maven-compiler-plugin.version}</version>
					<configuration>
						<source>${java.version}</source>
						<target>${java.version}</target>
						<encoding>${project.build.sourceEncoding}</encoding>
					</configuration>
				</plugin>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-surefire-plugin</artifactId>
					<version>${maven-surefire-plugin.version}</version>
				</plugin>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-source-plugin</artifactId>
					<version>${maven-source-plugin.version}</version>
					<executions>
						<execution>
							<id>attach-sources</id>
							<goals>
								<goal>jar-no-fork</goal>
							</goals>
						</execution>
					</executions>
				</plugin>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-jar-plugin</artifactId>
					<version>${maven-jar-plugin.version}</version>
				</plugin>
				<plugin>
					<artifactId>maven-javadoc-plugin</artifactId>
					<version>${maven-javadoc-plugin.version}</version>
					<executions>
						<execution>
							<id>attach-javadoc</id>
							<goals>
								<goal>jar</goal>
							</goals>
							<configuration>
								<doclint>none</doclint>
							</configuration>
						</execution>
					</executions>
					<configuration>
						<show>public</show>
						<charset>UTF-8</charset>
						<encoding>UTF-8</encoding>
						<docencoding>UTF-8</docencoding>
						<links>
							<link>http://docs.oracle.com/javase/7/docs/api</link>
						</links>
					</configuration>
				</plugin>

				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-war-plugin</artifactId>
					<version>${maven-war-plugin.version}</version>
				</plugin>

				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-install-plugin</artifactId>
					<version>${maven-install-plugin.version}</version>
				</plugin>

				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-deploy-plugin</artifactId>
					<version>${maven-deploy-plugin.version}</version>
				</plugin>

				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-gpg-plugin</artifactId>
					<version>${maven-gpg-plugin.version}</version>
					<configuration>
						<!-- Prevent gpg from using pinentry programs -->
						<gpgArguments>
							<arg>--pinentry-mode</arg>
							<arg>loopback</arg>
						</gpgArguments>
					</configuration>
					<executions>
						<execution>
							<phase>verify</phase>
							<goals>
								<goal>sign</goal>
							</goals>
						</execution>
					</executions>
				</plugin>
				<plugin>
					<groupId>org.springframework.boot</groupId>
					<artifactId>spring-boot-maven-plugin</artifactId>
					<version>${spring-boot.version}</version>
					<configuration>
						<executable>true</executable>
						<attach>false</attach>
					</configuration>
					<executions>
						<execution>
							<goals>
								<goal>repackage</goal>
							</goals>
						</execution>
					</executions>
				</plugin>
				<plugin>
					<groupId>org.codehaus.mojo</groupId>
					<artifactId>findbugs-maven-plugin</artifactId>
					<version>3.0.3</version>
					<configuration>
						<xmlOutput>true</xmlOutput>
						<effort>Max</effort>
						<threshold>Low</threshold>
						<failOnError>false</failOnError>
					</configuration>
				</plugin>
				<plugin>
					<groupId>org.codehaus.mojo</groupId>
					<artifactId>cobertura-maven-plugin</artifactId>
					<version>2.7</version>
					<dependencies>
						<dependency>
							<groupId>ch.qos.logback</groupId>
							<artifactId>logback-classic</artifactId>
							<version>1.2.0</version>
						</dependency>
					</dependencies>
				</plugin>
				<plugin>
					<groupId>org.apache.maven.plugins</groupId>
					<artifactId>maven-assembly-plugin</artifactId>
					<version>${maven-assembly-plugin.version}</version>
				</plugin>
				<plugin>
					<groupId>org.codehaus.mojo</groupId>
					<artifactId>versions-maven-plugin</artifactId>
					<version>2.2</version>
				</plugin>
				<plugin>
					<groupId>pl.project13.maven</groupId>
					<artifactId>git-commit-id-plugin</artifactId>
					<version>2.2.6</version>
					<executions>
						<execution>
							<goals>
								<goal>revision</goal>
							</goals>
						</execution>
					</executions>
					<configuration>
						<verbose>true</verbose>
						<dateFormat>yyyy-MM-dd'T'HH:mm:ssZ</dateFormat>
						<generateGitPropertiesFile>true</generateGitPropertiesFile>
						<generateGitPropertiesFilename>${project.build.outputDirectory}/apollo-git.properties</generateGitPropertiesFilename>
						<failOnNoGitDirectory>false</failOnNoGitDirectory>
					</configuration>
				</plugin>
				<plugin>
					<groupId>org.codehaus.mojo</groupId>
					<artifactId>flatten-maven-plugin</artifactId>
					<version>1.1.0</version>
					<configuration>
						<updatePomFile>true</updatePomFile>
						<flattenMode>resolveCiFriendliesOnly</flattenMode>
					</configuration>
					<executions>
						<execution>
							<id>flatten</id>
							<phase>process-resources</phase>
							<goals>
								<goal>flatten</goal>
							</goals>
						</execution>
						<execution>
							<id>flatten.clean</id>
							<phase>clean</phase>
[?2004l
2025-11-12 11:51:48,661 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_cOTYZio4nDcwnfDIdNVOAG2V', 'function': {'arguments': '{"command":"sed -n \'500,900p\' pom.xml"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 28, 'prompt_tokens': 8617, 'total_tokens': 8645, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2136d5bd-3cc4-4850-9722-dfd8881f4cfc-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '500,900p' pom.xml"}, 'id': 'call_cOTYZio4nDcwnfDIdNVOAG2V', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8617, 'output_tokens': 28, 'total_tokens': 8645, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:51:48,664 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: sed -n '500,900p' pom.xml
2025-11-12 11:51:48,766 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:51:48,766 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
[?2004l
							<phase>clean</phase>
							<goals>
								<goal>clean</goal>
							</goals>
						</execution>
					</executions>
				</plugin>
				<!-- Need to set releases.repo and snapshots.repo properties in your .m2/settings.xml -->
			</plugins>
		</pluginManagement>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-surefire-plugin</artifactId>
				<configuration>
					<trimStackTrace>false</trimStackTrace>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-source-plugin</artifactId>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-war-plugin</artifactId>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-install-plugin</artifactId>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-deploy-plugin</artifactId>
			</plugin>
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>findbugs-maven-plugin</artifactId>
			</plugin>
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>versions-maven-plugin</artifactId>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-jar-plugin</artifactId>
				<configuration>
					<archive>
						<manifest>
							<addDefaultImplementationEntries>true</addDefaultImplementationEntries>
							<addDefaultSpecificationEntries>true</addDefaultSpecificationEntries>
						</manifest>
					</archive>
				</configuration>
			</plugin>
			<plugin>
				<groupId>pl.project13.maven</groupId>
				<artifactId>git-commit-id-plugin</artifactId>
			</plugin>
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>flatten-maven-plugin</artifactId>
			</plugin>
		</plugins>
		<resources>
			<resource>
				<directory>src/main/resources</directory>
				<filtering>true</filtering>
				<includes>
					<include>**/*.yml</include>
					<include>**/*.yaml</include>
					<include>**/*.properties</include>
					<include>**/*.xml</include>
				</includes>
			</resource>
			<resource>
				<directory>src/main/resources</directory>
				<filtering>false</filtering>
				<excludes>
					<exclude>**/*.yml</exclude>
					<exclude>**/*.yaml</exclude>
					<exclude>**/*.properties</exclude>
					<exclude>**/*.xml</exclude>
				</excludes>
			</resource>
			<resource>
				<directory>src/main/config</directory>
				<filtering>true</filtering>
				<includes>
					<include>application-github.properties</include>
				</includes>
			</resource>
			<resource>
				<directory>src/main/config</directory>
				<filtering>false</filtering>
				<excludes>
					<exclude>application-github.properties</exclude>
				</excludes>
			</resource>
		</resources>
	</build>
	<profiles>
		<profile>
			<!-- for travis usage -->
			<id>travis</id>
			<activation>
				<property>
					<name>env.TRAVIS</name>
					<value>true</value>
				</property>
			</activation>
			<build>
				<plugins>
					<plugin>
						<groupId>com.github.github</groupId>
						<artifactId>site-maven-plugin</artifactId>
						<version>0.12</version>
						<configuration>
							<message>Site for ${project.artifactId}, ${project.version}</message>
							<path>${github.path}</path>
							<merge>true</merge>
						</configuration>
						<executions>
							<execution>
								<goals>
									<goal>site</goal>
								</goals>
								<phase>site</phase>
							</execution>
						</executions>
					</plugin>
					<plugin>
						<groupId>org.jacoco</groupId>
						<artifactId>jacoco-maven-plugin</artifactId>
						<version>0.8.3</version>
						<executions>
							<execution>
								<id>prepare-agent</id>
								<goals>
									<goal>prepare-agent</goal>
								</goals>
							</execution>
						</executions>
					</plugin>
					<plugin>
						<groupId>org.eluder.coveralls</groupId>
						<artifactId>coveralls-maven-plugin</artifactId>
						<version>4.2.0</version>
					</plugin>
				</plugins>
			</build>
		</profile>
		<profile>
			<!-- for open source usage -->
			<id>github</id>
			<properties>
				<package.environment>github</package.environment>
			</properties>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
		</profile>
		<profile>
			<id>nacos-discovery</id>
			<properties>
				<nacos.discovery.version>0.2.7</nacos.discovery.version>
				<fastjson.version>1.2.75</fastjson.version>
			</properties>
			<dependencyManagement>
				<dependencies>
					<dependency>
						<groupId>com.alibaba.boot</groupId>
						<artifactId>nacos-discovery-spring-boot-starter</artifactId>
						<version>${nacos.discovery.version}</version>
					</dependency>
					<dependency>
						<groupId>com.alibaba</groupId>
						<artifactId>fastjson</artifactId>
						<version>${fastjson.version}</version>
					</dependency>
				</dependencies>
			</dependencyManagement>
		</profile>
		<profile>
			<id>release</id>
			<build>
				<plugins>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-javadoc-plugin</artifactId>
					</plugin>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-gpg-plugin</artifactId>
					</plugin>
				</plugins>
			</build>
		</profile>
	</profiles>

	<reporting>
		<plugins>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-project-info-reports-plugin</artifactId>
				<version>2.9</version>
				<reportSets>
					<reportSet>
						<reports>
							<report>index</report>
							<report>summary</report>
							<report>dependency-info</report>
							<report>project-team</report>
							<report>scm</report>
							<report>issue-tracking</report>
							<report>mailing-list</report>
							<!-- <report>dependency-management</report> -->
							<!-- <report>dependencies</report> -->
							<!-- <report>dependency-convergence</report> -->
							<report>cim</report>
							<report>plugin-management</report>
							<report>plugins</report>
							<report>distribution-management</report>
							<report>license</report>
							<report>modules</report>
						</reports>
					</reportSet>
				</reportSets>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-checkstyle-plugin</artifactId>
				<version>2.17</version>
				<configuration>
					<configLocation>google_checks.xml</configLocation>
					<headerLocation>LICENSE-2.0.txt</headerLocation>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-pmd-plugin</artifactId>
				<version>3.6</version>
				<configuration>
					<aggregate>true</aggregate>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>findbugs-maven-plugin</artifactId>
				<version>3.0.3</version>
			</plugin>
		</plugins>
	</reporting>
	<distributionManagement>
		<repository>
			<id>releases</id>
			<url>${releases.repo}</url>
		</repository>
		<snapshotRepository>
			<id>snapshots</id>
			<url>${snapshots.repo}</url>
		</snapshotRepository>
	</distributionManagement>
[?2004l
2025-11-12 11:51:53,439 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_8coavGr27VdmYoBGoUFrRKRX', 'function': {'arguments': '{"command":"ls -la apollo-openapi || true; ls -la apollo/apollo-openapi || true; find apollo/apollo-openapi -maxdepth 3 -type f | wc -l"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 320, 'prompt_tokens': 10885, 'total_tokens': 11205, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--6ac5e515-a4b1-4a8c-bd4e-57d1571b537e-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo-openapi || true; ls -la apollo/apollo-openapi || true; find apollo/apollo-openapi -maxdepth 3 -type f | wc -l'}, 'id': 'call_8coavGr27VdmYoBGoUFrRKRX', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10885, 'output_tokens': 320, 'total_tokens': 11205, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 11:51:53,443 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo-openapi || true; ls -la apollo/apollo-openapi || true; find apollo/apollo-openapi -maxdepth 3 -type f | wc -l
2025-11-12 11:51:53,544 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:51:53,545 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo-openapi || true; ls -la apollo/apollo-openapi || true; fi
ind apollo/apollo-openapi -maxdepth 3 -type f | wc -l
[?2004l
total 36
drwxrwxr-x 1 root root 4096 Nov 12 11:40 .
drwxr-xr-x 1 root root 4096 Nov 12 11:50 ..
-rw-r--r-- 1 root root 2357 Aug 24 21:16 .flattened-pom.xml
-rw-r--r-- 1 root root 2111 Nov 12 11:40 pom.xml
drwxrwxr-x 1 root root 4096 Aug 24 21:16 src
drwxr-xr-x 8 root root 4096 Aug 24 21:16 target
total 12
drwxr-xr-x 3 root root 4096 Nov 12 11:50 .
drwxr-xr-x 3 root root 4096 Nov 12 11:50 ..
drwxr-xr-x 3 root root 4096 Nov 12 11:50 src
0
[?2004l
2025-11-12 11:52:01,584 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WgMZyQXAqM6HZunUkV0KeazW', 'function': {'arguments': '{"command":"ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller || true; find apollo-openapi/src/test -name \'*SingleDot*\' -print"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 576, 'prompt_tokens': 11220, 'total_tokens': 11796, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 10880}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--fdd371eb-6cd2-4235-8627-96abeff42a11-0' tool_calls=[{'name': 'run_command', 'args': {'command': "ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller || true; find apollo-openapi/src/test -name '*SingleDot*' -print"}, 'id': 'call_WgMZyQXAqM6HZunUkV0KeazW', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11220, 'output_tokens': 576, 'total_tokens': 11796, 'input_token_details': {'audio': 0, 'cache_read': 10880}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 11:52:01,587 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller || true; find apollo-openapi/src/test -name '*SingleDot*' -print
2025-11-12 11:52:01,689 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:52:01,689 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/
/v1/controller || true; find apollo-openapi/src/test -name '*SingleDot*' -print
[?2004l
ls: cannot access 'apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller': No such file or directory
[?2004l
2025-11-12 11:52:13,784 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_6fEX4pAnnUgDKq2gqVsq3MKi', 'function': {'arguments': '{"command":"ls -R apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller; sed -n \'1,200p\' apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1045, 'prompt_tokens': 11374, 'total_tokens': 12419, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d10e15d0-0904-43b7-a640-28cb398fefe6-0' tool_calls=[{'name': 'run_command', 'args': {'command': "ls -R apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller; sed -n '1,200p' apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java"}, 'id': 'call_6fEX4pAnnUgDKq2gqVsq3MKi', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11374, 'output_tokens': 1045, 'total_tokens': 12419, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 11:52:13,788 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -R apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller; sed -n '1,200p' apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java
2025-11-12 11:52:13,889 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:52:13,889 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -R apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/op
penapi/v1/controller; sed -n '1,200p' apollo/apollo-openapi/src/test/java/com/ctr
rip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.java 
[Arip/framework/apollo/openapi/v1/controller/NamespaceControllerSingleDotTest.jav[Ka
[?2004l
apollo/apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller:
NamespaceControllerSingleDotTest.java
package com.ctrip.framework.apollo.openapi.v1.controller;

import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
import com.ctrip.framework.apollo.common.entity.AppNamespace;
import org.junit.Assert;
import org.junit.Test;
import org.springframework.test.context.ActiveProfiles;
import org.springframework.http.ResponseEntity;

@ActiveProfiles("skipAuthorization")
public class NamespaceControllerSingleDotTest extends AbstractControllerTest {

  @Test
  public void shouldDisplayNamespaceWithSingleDot() {
    String appId = "app-single-dot";
    String namespaceName = ".";

    // create app namespace with single dot
    AppNamespace appNamespace = new AppNamespace();
    appNamespace.setAppId(appId);
    appNamespace.setName(namespaceName);
    appNamespace.setComment("single dot namespace");
    appNamespace.setDataChangeCreatedBy("apollo");

    restTemplate.postForEntity(
        url("/apps/{appId}/appnamespaces"),
        appNamespace,
        AppNamespace.class,
        appId
    );

    // query the created app namespace, expecting no server error
    ResponseEntity<AppNamespaceDTO> response = restTemplate.getForEntity(
        url("/apps/{appId}/appnamespaces/{namespaceName}"),
        AppNamespaceDTO.class,
        appId, namespaceName
    );

    Assert.assertEquals(namespaceName, response.getBody().getName());
  }
}
[?2004l
2025-11-12 11:52:24,297 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_BLfzvdn7rrLu4DJAKTybazAA', 'function': {'arguments': '{"command":"ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller || true"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 751, 'prompt_tokens': 11876, 'total_tokens': 12627, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 704, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 11264}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a099407e-7801-434d-8949-d98359451e84-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller || true'}, 'id': 'call_BLfzvdn7rrLu4DJAKTybazAA', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11876, 'output_tokens': 751, 'total_tokens': 12627, 'input_token_details': {'audio': 0, 'cache_read': 11264}, 'output_token_details': {'audio': 0, 'reasoning': 704}}
2025-11-12 11:52:24,300 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller || true
2025-11-12 11:52:24,401 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:52:24,402 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/
/v1/controller || true
[?2004l
ls: cannot access 'apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller': No such file or directory
[?2004l
2025-11-12 11:52:38,963 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_saPiNTFPBJvDhYQv6515fB1B', 'function': {'arguments': '{"command":"grep -R \\"class AbstractControllerTest\\" -n apollo-openapi/src/test || true; find apollo-openapi/src/test/java -type f -maxdepth 5 -name \'*.java\' | wc -l; ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller || true"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1245, 'prompt_tokens': 11996, 'total_tokens': 13241, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1152, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0746f1bc-047a-4c7c-9dc1-fd0379822ba6-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'grep -R "class AbstractControllerTest" -n apollo-openapi/src/test || true; find apollo-openapi/src/test/java -type f -maxdepth 5 -name \'*.java\' | wc -l; ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller || true'}, 'id': 'call_saPiNTFPBJvDhYQv6515fB1B', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11996, 'output_tokens': 1245, 'total_tokens': 13241, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1152}}
2025-11-12 11:52:38,967 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: grep -R "class AbstractControllerTest" -n apollo-openapi/src/test || true; find apollo-openapi/src/test/java -type f -maxdepth 5 -name '*.java' | wc -l; ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller || true
2025-11-12 11:52:39,072 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 0
2025-11-12 11:52:39,072 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 grep -R "class AbstractControllerTest" -n apollo-openapi/src/test || tr
rue; find apollo-openapi/src/test/java -type f -maxdepth 5 -name '*.java' | wc -l
l; ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/cont
troller || true
[?2004l
find: warning: you have specified the global option -maxdepth after the argument -type, but global options are not positional, i.e., -maxdepth affects tests specified before it as well as those specified after it.  Please specify global options before other arguments.
0
ls: cannot access 'apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller': No such file or directory
[?2004l
2025-11-12 11:52:50,709 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VccYFEobJsFWIpQZu59LSJKC', 'function': {'arguments': '{"command":"ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller; ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 835, 'prompt_tokens': 12272, 'total_tokens': 13107, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 11904}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--650dc050-fee7-4fae-9243-0e3e66f2cfbc-0' tool_calls=[{'name': 'run_command', 'args': {'command': 'ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller; ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1'}, 'id': 'call_VccYFEobJsFWIpQZu59LSJKC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12272, 'output_tokens': 835, 'total_tokens': 13107, 'input_token_details': {'audio': 0, 'cache_read': 11904}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 11:52:50,713 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Executing command: ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller; ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1
2025-11-12 11:52:50,814 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command exit code: 2
2025-11-12 11:52:50,814 - thread-135845287823040.prometheus.docker.base_container - DEBUG - Command output:
 ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/
/v1/controller; ls -la apollo-openapi/src/test/java/com/ctrip/framework/apollo/op
penapi/v1
[?2004l
ls: cannot access 'apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1/controller': No such file or directory
ls: cannot access 'apollo-openapi/src/test/java/com/ctrip/framework/apollo/openapi/v1': No such file or directory
[?2004l
2025-11-12 11:53:02,771 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproducing_execute_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_KShGlwkAVjTYyLrsrVNiTBdf', 'function': {'arguments': '{"command":"sed -n \'1,200p\' apollo-openapi/pom.xml"}', 'name': 'run_command'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1255, 'prompt_tokens': 12463, 'total_tokens': 13718, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1216, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3f23bbe4-e233-4186-9f32-f9fa2f60cd26-0' tool_calls=[{'name': 'run_command', 'args': {'command': "sed -n '1,200p' apollo-openapi/pom.xml"}, 'id': 'call_KShGlwkAVjTYyLrsrVNiTBdf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12463, 'output_tokens': 1255, 'total_tokens': 13718, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1216}}
2025-11-12 11:53:02,773 - thread-135845287823040.prometheus.lang_graph.nodes.bug_reproduction_subgraph_node - INFO - Recursion limit reached, returning reproduced_bug=False
2025-11-12 11:53:02,806 - thread-135845287823040.prometheus.lang_graph.nodes.issue_not_verified_bug_subgraph_node - INFO - Enter IssueNotVerifiedBugSubgraphNode
2025-11-12 11:53:02,808 - thread-135845287823040.prometheus.lang_graph.nodes.issue_bug_context_message_node - DEBUG - Sending query to context provider:
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

2025-11-12 11:53:02,809 - thread-135845287823040.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - INFO - Enter context retrieval subgraph
2025-11-12 11:53:02,810 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

--- END ORIGINAL QUERY ---



All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:53:43,654 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning='The issue involves creating a namespace named "." causing a 500 error when querying; this likely stems from server-side parsing/validation of namespace names and file format resolution (split by dot) in the portal and biz layers. The provided file tree doesn’t include specific class files, so we need the concrete implementations of the namespace-related controllers, services, entities, and utilities that parse namespace names, as well as the enum defining config file formats and input validation utilities. This is essential to follow the code path for namespace creation and querying and identify where "." triggers an error.' query='Please provide the full source of: (1) apollo-portal NamespaceController.java, AppNamespaceController.java, NamespaceService.java, AppNamespaceService.java, NamespaceBO.java, and any portal utility that parses namespace name/file format (e.g., NamespaceUtil); (2) apollo-biz AppNamespace.java, Namespace.java, AppNamespaceService.java, NamespaceService.java, and any related repository; (3) apollo-core ConfigFileFormat.java; and (4) apollo-common InputValidator.java.' extra_requirements="If exact paths differ, share any classes that handle namespace REST endpoints, namespace name parsing/splitting by '.', and namespace/item querying logic." purpose='To trace namespace parsing and querying logic to reproduce and fix the 500 error when the namespace name is a single dot.'
2025-11-12 11:53:43,656 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full source of: (1) apollo-portal NamespaceController.java, AppNamespaceController.java, NamespaceService.java, AppNamespaceService.java, NamespaceBO.java, and any portal utility that parses namespace name/file format (e.g., NamespaceUtil); (2) apollo-biz AppNamespace.java, Namespace.java, AppNamespaceService.java, NamespaceService.java, and any related repository; (3) apollo-core ConfigFileFormat.java; and (4) apollo-common InputValidator.java.
2025-11-12 11:53:47,609 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 11:53:47,610 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 11:53:47,610 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 11:53:47,610 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 11:53:47,612 - thread-135845287823040.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 11:53:47,613 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 11:53:47,613 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full source of: (1) apollo-portal NamespaceController.java, AppNamespaceController.java, NamespaceService.java, AppNamespaceService.java, NamespaceBO.java, and any portal utility that parses namespace name/file format (e.g., NamespaceUtil); (2) apollo-biz AppNamespace.java, Namespace.java, AppNamespaceService.java, NamespaceService.java, and any related repository; (3) apollo-core ConfigFileFormat.java; and (4) apollo-common InputValidator.java.
Extra requirements: If exact paths differ, share any classes that handle namespace REST endpoints, namespace name parsing/splitting by '.', and namespace/item querying logic.
Purpose: To trace namespace parsing and querying logic to reproduce and fix the 500 error when the namespace name is a single dot.
2025-11-12 11:54:00,803 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_p8fcCzAzE700oWiTEKU2osxi', 'function': {'arguments': '{"basename":"NamespaceController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 990, 'prompt_tokens': 2320, 'total_tokens': 3310, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--33a0a7cb-8e3d-46c6-8747-076d1071ef0f-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceController.java'}, 'id': 'call_p8fcCzAzE700oWiTEKU2osxi', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2320, 'output_tokens': 990, 'total_tokens': 3310, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 11:54:05,034 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_DF0Ov7v7HeSAhEUEJ5vmaL5e', 'function': {'arguments': '{"basename":"AppNamespaceController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 351, 'prompt_tokens': 2509, 'total_tokens': 2860, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7564e698-f1f6-4b04-90ea-aa1b475158f8-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceController.java'}, 'id': 'call_DF0Ov7v7HeSAhEUEJ5vmaL5e', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2509, 'output_tokens': 351, 'total_tokens': 2860, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 11:54:07,966 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JOHDfcFCnxuelNQNzTCSKKQ7', 'function': {'arguments': '{"basename":"NamespaceService.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 158, 'prompt_tokens': 2598, 'total_tokens': 2756, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--12236477-419b-4b5f-8128-5d5bb70b208e-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceService.java'}, 'id': 'call_JOHDfcFCnxuelNQNzTCSKKQ7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2598, 'output_tokens': 158, 'total_tokens': 2756, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 11:54:09,508 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_8Ko7QJH1h8LHoyhMGZxFXHBq', 'function': {'arguments': '{"basename":"AppNamespaceService.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 2735, 'total_tokens': 2760, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2560}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a41161a3-a0cf-4b42-8bd9-654297a98839-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceService.java'}, 'id': 'call_8Ko7QJH1h8LHoyhMGZxFXHBq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2735, 'output_tokens': 25, 'total_tokens': 2760, 'input_token_details': {'audio': 0, 'cache_read': 2560}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:54:10,830 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Dt6GQ54eKfQ4FOqdNhgUSltk', 'function': {'arguments': '{"basename":"NamespaceBO.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 2875, 'total_tokens': 2899, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--61f7a90a-d5f1-46a1-90ef-9c6e0397f972-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceBO.java'}, 'id': 'call_Dt6GQ54eKfQ4FOqdNhgUSltk', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2875, 'output_tokens': 24, 'total_tokens': 2899, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:54:12,163 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_VpkOfvEZoKbIX4DI3mnh7kSx', 'function': {'arguments': '{"basename":"NamespaceUtil.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 2964, 'total_tokens': 2988, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2816}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f6dc8772-9f03-450b-a814-cfc3309e39ed-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceUtil.java'}, 'id': 'call_VpkOfvEZoKbIX4DI3mnh7kSx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2964, 'output_tokens': 24, 'total_tokens': 2988, 'input_token_details': {'audio': 0, 'cache_read': 2816}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:54:16,572 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_vwaXTHA8HSNNpQmsLfi5Jw9l', 'function': {'arguments': '{"basename":"AppNamespace.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 350, 'prompt_tokens': 3051, 'total_tokens': 3401, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b16df4f5-e6ff-4adf-9772-6fb092549b93-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespace.java'}, 'id': 'call_vwaXTHA8HSNNpQmsLfi5Jw9l', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3051, 'output_tokens': 350, 'total_tokens': 3401, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 11:54:17,654 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_MhBK1Z1s255DfP5VtAKFiDvn', 'function': {'arguments': '{"basename":"Namespace.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 23, 'prompt_tokens': 3135, 'total_tokens': 3158, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--cc313595-e4ab-44d7-a674-019fc8c7fe93-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'Namespace.java'}, 'id': 'call_MhBK1Z1s255DfP5VtAKFiDvn', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3135, 'output_tokens': 23, 'total_tokens': 3158, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:54:18,811 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JDArWmKPTw9xKLbnkRb98n2j', 'function': {'arguments': '{"basename":"ConfigFileFormat.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 3219, 'total_tokens': 3244, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--dd4566b5-85a2-432b-bdf4-3651e2a189dd-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ConfigFileFormat.java'}, 'id': 'call_JDArWmKPTw9xKLbnkRb98n2j', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3219, 'output_tokens': 25, 'total_tokens': 3244, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:54:20,024 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_bfyc4b86xAiKVhk1ta8OLplf', 'function': {'arguments': '{"basename":"InputValidator.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 3308, 'total_tokens': 3332, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3200}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1a1b9c45-3a2d-42f9-a358-f07578945ced-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'InputValidator.java'}, 'id': 'call_bfyc4b86xAiKVhk1ta8OLplf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3308, 'output_tokens': 24, 'total_tokens': 3332, 'input_token_details': {'audio': 0, 'cache_read': 3200}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:54:32,632 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_irYFnLp00pPATcjaIpCF4V54', 'function': {'arguments': '{"basename":"AppNamespaceRepository.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1376, 'prompt_tokens': 3392, 'total_tokens': 4768, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--443ccb37-67bc-49f8-9377-a515cb350b51-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceRepository.java'}, 'id': 'call_irYFnLp00pPATcjaIpCF4V54', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3392, 'output_tokens': 1376, 'total_tokens': 4768, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-12 11:54:34,458 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_PAymmOHBMs0oRl7F0AcV6qM7', 'function': {'arguments': '{"basename":"NamespaceRepository.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 3534, 'total_tokens': 3558, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2688}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f7dda66f-a8a9-4389-b439-ec5d4f2707c9-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceRepository.java'}, 'id': 'call_PAymmOHBMs0oRl7F0AcV6qM7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3534, 'output_tokens': 24, 'total_tokens': 3558, 'input_token_details': {'audio': 0, 'cache_read': 2688}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:54:52,492 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_uTDoqWtZN9mnfv1luvnEDFmL', 'function': {'arguments': '{"basename":"ItemRepository.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1694, 'prompt_tokens': 3622, 'total_tokens': 5316, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1664, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--06528103-9628-4f4e-9c2f-9ce318a129db-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ItemRepository.java'}, 'id': 'call_uTDoqWtZN9mnfv1luvnEDFmL', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3622, 'output_tokens': 1694, 'total_tokens': 5316, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1664}}
2025-11-12 11:54:53,548 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZfTHdmHBVUyT15wrG8Fy0izh', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 3710, 'total_tokens': 3753, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3328}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--94468885-b06a-4f15-9d1b-6e80f584c70d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java'}, 'id': 'call_ZfTHdmHBVUyT15wrG8Fy0izh', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3710, 'output_tokens': 43, 'total_tokens': 3753, 'input_token_details': {'audio': 0, 'cache_read': 3328}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:54:54,863 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1wdjtErRTCJ0RLtj5mIaNogL', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 7960, 'total_tokens': 8003, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b21a5727-f53e-4046-94b8-83750f656d58-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java'}, 'id': 'call_1wdjtErRTCJ0RLtj5mIaNogL', 'type': 'tool_call'}] usage_metadata={'input_tokens': 7960, 'output_tokens': 43, 'total_tokens': 8003, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:54:56,382 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4B66E1GzJCbaXFlC5JR4eO9F', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/NamespaceBO.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 45, 'prompt_tokens': 13247, 'total_tokens': 13292, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3328}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a2a3fb38-a6f4-49ce-a509-0ef6d45a9742-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/NamespaceBO.java'}, 'id': 'call_4B66E1GzJCbaXFlC5JR4eO9F', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13247, 'output_tokens': 45, 'total_tokens': 13292, 'input_token_details': {'audio': 0, 'cache_read': 3328}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:54:58,326 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_u4gAHSe3jkCSAzomSQGWcLph', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 14267, 'total_tokens': 14310, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e3f8a47f-eeeb-4c1b-91fa-466e61c915d2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java'}, 'id': 'call_u4gAHSe3jkCSAzomSQGWcLph', 'type': 'tool_call'}] usage_metadata={'input_tokens': 14267, 'output_tokens': 43, 'total_tokens': 14310, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:55:00,160 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_NveuIERzfUZeLvatnnCOEmwW', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 17433, 'total_tokens': 17476, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 14208}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--757b9e94-ab0f-454a-b779-8ed7aae53889-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java'}, 'id': 'call_NveuIERzfUZeLvatnnCOEmwW', 'type': 'tool_call'}] usage_metadata={'input_tokens': 17433, 'output_tokens': 43, 'total_tokens': 17476, 'input_token_details': {'audio': 0, 'cache_read': 14208}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:55:01,700 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_AmbEl0f8GA8KIYA0TV9nZP6G', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 19844, 'total_tokens': 19887, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--31972490-ce2d-4c72-9ba2-455b31612723-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java'}, 'id': 'call_AmbEl0f8GA8KIYA0TV9nZP6G', 'type': 'tool_call'}] usage_metadata={'input_tokens': 19844, 'output_tokens': 43, 'total_tokens': 19887, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:55:03,756 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_GGQ1cnPr7kGX4J1RQDyiolC4', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 42, 'prompt_tokens': 24879, 'total_tokens': 24921, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--affd01b3-1b40-4fe3-9fdf-a770affac5ee-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java'}, 'id': 'call_GGQ1cnPr7kGX4J1RQDyiolC4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 24879, 'output_tokens': 42, 'total_tokens': 24921, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:55:06,338 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_7cYtn4fGmb1MbAIg7hjFlxwU', 'function': {'arguments': '{"relative_path":"apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 40, 'prompt_tokens': 25789, 'total_tokens': 25829, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--76b3f59d-1409-48ae-98c4-58490ab6e262-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java'}, 'id': 'call_7cYtn4fGmb1MbAIg7hjFlxwU', 'type': 'tool_call'}] usage_metadata={'input_tokens': 25789, 'output_tokens': 40, 'total_tokens': 25829, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:55:08,550 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_n1BpSVUVhDIV9AQneze0tlGz', 'function': {'arguments': '{"relative_path":"apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 26955, 'total_tokens': 26998, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 25728}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f3ed5b66-2ad8-4d39-b901-536079ff7228-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java'}, 'id': 'call_n1BpSVUVhDIV9AQneze0tlGz', 'type': 'tool_call'}] usage_metadata={'input_tokens': 26955, 'output_tokens': 43, 'total_tokens': 26998, 'input_token_details': {'audio': 0, 'cache_read': 25728}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:55:10,900 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_K8zNh8gRyZLn4XrbVx2klPu7', 'function': {'arguments': '{"relative_path":"apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 40, 'prompt_tokens': 28517, 'total_tokens': 28557, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3456}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--a0579b24-8baf-49ba-8182-00cefca57699-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java'}, 'id': 'call_K8zNh8gRyZLn4XrbVx2klPu7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 28517, 'output_tokens': 40, 'total_tokens': 28557, 'input_token_details': {'audio': 0, 'cache_read': 3456}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:55:27,206 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xfPIQQtD8H7iwSMk8ogURtCg', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1649, 'prompt_tokens': 29222, 'total_tokens': 30871, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1600, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3712}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--69d4117c-d794-4449-8c00-bcb1b2bae712-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java'}, 'id': 'call_xfPIQQtD8H7iwSMk8ogURtCg', 'type': 'tool_call'}] usage_metadata={'input_tokens': 29222, 'output_tokens': 1649, 'total_tokens': 30871, 'input_token_details': {'audio': 0, 'cache_read': 3712}, 'output_token_details': {'audio': 0, 'reasoning': 1600}}
2025-11-12 11:55:29,264 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_UJtBueECA46smlnOruQg7djw', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 30664, 'total_tokens': 30707, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 7936}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--368c0e8b-126e-4b99-afbe-6372d114c1ea-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java'}, 'id': 'call_UJtBueECA46smlnOruQg7djw', 'type': 'tool_call'}] usage_metadata={'input_tokens': 30664, 'output_tokens': 43, 'total_tokens': 30707, 'input_token_details': {'audio': 0, 'cache_read': 7936}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:55:38,747 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_oP5XmBCHncGPYetAAmzXhmOE', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 625, 'prompt_tokens': 32492, 'total_tokens': 33117, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2944}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c5c1b7df-9a50-4606-b172-4b5911a41a1d-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java'}, 'id': 'call_oP5XmBCHncGPYetAAmzXhmOE', 'type': 'tool_call'}] usage_metadata={'input_tokens': 32492, 'output_tokens': 625, 'total_tokens': 33117, 'input_token_details': {'audio': 0, 'cache_read': 2944}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 11:55:51,222 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_8ide79x3kuWlpYPKZTIzozP6', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1138, 'prompt_tokens': 33225, 'total_tokens': 34363, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1088, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 29184}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--235d6d43-9f37-48a1-93a5-829055bf5bfb-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java'}, 'id': 'call_8ide79x3kuWlpYPKZTIzozP6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 33225, 'output_tokens': 1138, 'total_tokens': 34363, 'input_token_details': {'audio': 0, 'cache_read': 29184}, 'output_token_details': {'audio': 0, 'reasoning': 1088}}
2025-11-12 11:55:52,985 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ZVhqmT3WRqdpDAswyH1I6GJe', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 34022, 'total_tokens': 34066, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 19840}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c24435cb-6d65-4e76-a537-2f8907dcd0c4-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java'}, 'id': 'call_ZVhqmT3WRqdpDAswyH1I6GJe', 'type': 'tool_call'}] usage_metadata={'input_tokens': 34022, 'output_tokens': 44, 'total_tokens': 34066, 'input_token_details': {'audio': 0, 'cache_read': 19840}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:56:00,109 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_t6Dg7CFfWrYerWjO7oSFbws5', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/ItemRepository.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 626, 'prompt_tokens': 34730, 'total_tokens': 35356, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 24832}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e1fb3ade-9835-47b5-bb09-f89ab393c9c6-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/ItemRepository.java'}, 'id': 'call_t6Dg7CFfWrYerWjO7oSFbws5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 34730, 'output_tokens': 626, 'total_tokens': 35356, 'input_token_details': {'audio': 0, 'cache_read': 24832}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 11:56:04,661 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_egeyq0mlOAVpkwffPmBSyuHO', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/AppNamespaceController.java"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 240, 'prompt_tokens': 35440, 'total_tokens': 35680, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 32384}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--3ee64c80-05da-4811-b997-63ff28d77513-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/AppNamespaceController.java'}, 'id': 'call_egeyq0mlOAVpkwffPmBSyuHO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 35440, 'output_tokens': 240, 'total_tokens': 35680, 'input_token_details': {'audio': 0, 'cache_read': 32384}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 11:56:06,828 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_UTmq098EcrYAqvVApoQzPYep', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 45, 'prompt_tokens': 35508, 'total_tokens': 35553, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9a671ce3-73b5-45dd-b7b2-97fbd198049f-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java'}, 'id': 'call_UTmq098EcrYAqvVApoQzPYep', 'type': 'tool_call'}] usage_metadata={'input_tokens': 35508, 'output_tokens': 45, 'total_tokens': 35553, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:56:26,959 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located and retrieved the full sources for all requested classes across modules: apollo-portal (NamespaceController, NamespaceService, AppNamespaceService, NamespaceBO; plus the OpenAPI NamespaceController), apollo-adminservice (NamespaceController, AppNamespaceController), apollo-biz (NamespaceService and related repositories NamespaceRepository, AppNamespaceRepository, ItemRepository), apollo-core (ConfigFileFormat), and apollo-common (InputValidator, AppNamespace entity). Since portal doesn’t have a NamespaceUtil, I included the configservice NamespaceUtil that parses/sanitizes namespace names (e.g., strips .properties) and normalizes by app/public namespaces. These sources cover REST endpoints using {namespaceName:.+}, namespace name parsing/format appending, and namespace/item querying logic. This should help trace how a single dot namespace is handled and where the 500 error might originate.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2234, 'prompt_tokens': 37018, 'total_tokens': 39252, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2048, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 34688}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--ec14f5f0-b6bf-4ef6-910e-fba1738e5ba0-0' usage_metadata={'input_tokens': 37018, 'output_tokens': 2234, 'total_tokens': 39252, 'input_token_details': {'audio': 0, 'cache_read': 34688}, 'output_token_details': {'audio': 0, 'reasoning': 2048}}
2025-11-12 11:56:26,962 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full source of: (1) apollo-portal NamespaceController.java, AppNamespaceController.java, NamespaceService.java, AppNamespaceService.java, NamespaceBO.java, and any portal utility that parses namespace name/file format (e.g., NamespaceUtil); (2) apollo-biz AppNamespace.java, Namespace.java, AppNamespaceService.java, NamespaceService.java, and any related repository; (3) apollo-core ConfigFileFormat.java; and (4) apollo-common InputValidator.java.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
If exact paths differ, share any classes that handle namespace REST endpoints, namespace name parsing/splitting by '.', and namespace/item querying logic.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
To trace namespace parsing and querying logic to reproduce and fix the 500 error when the namespace name is a single dot.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java
Line number range: 1 - 108
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Namespace;
20. import com.ctrip.framework.apollo.biz.service.AppNamespaceService;
21. import com.ctrip.framework.apollo.biz.service.NamespaceService;
22. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
23. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
24. import com.ctrip.framework.apollo.common.entity.AppNamespace;
25. import com.ctrip.framework.apollo.common.exception.BadRequestException;
26. import com.ctrip.framework.apollo.common.utils.BeanUtils;
27. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
28. import com.ctrip.framework.apollo.core.utils.StringUtils;
29. import org.springframework.data.domain.Pageable;
30. import org.springframework.web.bind.annotation.DeleteMapping;
31. import org.springframework.web.bind.annotation.GetMapping;
32. import org.springframework.web.bind.annotation.PathVariable;
33. import org.springframework.web.bind.annotation.PostMapping;
34. import org.springframework.web.bind.annotation.RequestBody;
35. import org.springframework.web.bind.annotation.RequestParam;
36. import org.springframework.web.bind.annotation.RestController;
37. 
38. import java.util.List;
39. 
40. @RestController
41. public class AppNamespaceController {
42. 
43.   private final AppNamespaceService appNamespaceService;
44.   private final NamespaceService namespaceService;
45. 
46.   public AppNamespaceController(
47.       final AppNamespaceService appNamespaceService,
48.       final NamespaceService namespaceService) {
49.     this.appNamespaceService = appNamespaceService;
50.     this.namespaceService = namespaceService;
51.   }
52. 
53.   @PostMapping("/apps/{appId}/appnamespaces")
54.   public AppNamespaceDTO create(@RequestBody AppNamespaceDTO appNamespace,
55.                                 @RequestParam(defaultValue = "false") boolean silentCreation) {
56. 
57.     AppNamespace entity = BeanUtils.transform(AppNamespace.class, appNamespace);
58.     AppNamespace managedEntity = appNamespaceService.findOne(entity.getAppId(), entity.getName());
59. 
60.     if (managedEntity == null) {
61.       if (StringUtils.isEmpty(entity.getFormat())){
62.         entity.setFormat(ConfigFileFormat.Properties.getValue());
63.       }
64. 
65.       entity = appNamespaceService.createAppNamespace(entity);
66.     } else if (silentCreation) {
67.       appNamespaceService.createNamespaceForAppNamespaceInAllCluster(appNamespace.getAppId(), appNamespace.getName(),
68.           appNamespace.getDataChangeCreatedBy());
69. 
70.       entity = managedEntity;
71.     } else {
72.       throw new BadRequestException("app namespaces already exist.");
73.     }
74. 
75.     return BeanUtils.transform(AppNamespaceDTO.class, entity);
76.   }
77. 
78.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
79.   public void delete(@PathVariable("appId") String appId, @PathVariable("namespaceName") String namespaceName,
80.       @RequestParam String operator) {
81.     AppNamespace entity = appNamespaceService.findOne(appId, namespaceName);
82.     if (entity == null) {
83.       throw new BadRequestException("app namespace not found for appId: " + appId + " namespace: " + namespaceName);
84.     }
85.     appNamespaceService.deleteAppNamespace(entity, operator);
86.   }
87. 
88.   @GetMapping("/appnamespaces/{publicNamespaceName}/namespaces")
89.   public List<NamespaceDTO> findPublicAppNamespaceAllNamespaces(@PathVariable String publicNamespaceName, Pageable pageable) {
90. 
91.     List<Namespace> namespaces = namespaceService.findPublicAppNamespaceAllNamespaces(publicNamespaceName, pageable);
92. 
93.     return BeanUtils.batchTransform(NamespaceDTO.class, namespaces);
94.   }
95. 
96.   @GetMapping("/appnamespaces/{publicNamespaceName}/associated-namespaces/count")
97.   public int countPublicAppNamespaceAssociatedNamespaces(@PathVariable String publicNamespaceName) {
98.     return namespaceService.countPublicAppNamespaceAssociatedNamespaces(publicNamespaceName);
99.   }
100. 
101.   @GetMapping("/apps/{appId}/appnamespaces")
102.   public List<AppNamespaceDTO> getAppNamespaces(@PathVariable("appId") String appId) {
103. 
104.     List<AppNamespace> appNamespaces = appNamespaceService.findByAppId(appId);
105. 
106.     return BeanUtils.batchTransform(AppNamespaceDTO.class, appNamespaces);
107.   }
108. }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java
Line number range: 1 - 140
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Namespace;
20. import com.ctrip.framework.apollo.biz.service.NamespaceService;
21. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
22. import com.ctrip.framework.apollo.common.dto.PageDTO;
23. import com.ctrip.framework.apollo.common.exception.BadRequestException;
24. import com.ctrip.framework.apollo.common.exception.NotFoundException;
25. import com.ctrip.framework.apollo.common.utils.BeanUtils;
26. 
27. import org.springframework.data.domain.Page;
28. import org.springframework.data.domain.Pageable;
29. import org.springframework.web.bind.annotation.DeleteMapping;
30. import org.springframework.web.bind.annotation.GetMapping;
31. import org.springframework.web.bind.annotation.PathVariable;
32. import org.springframework.web.bind.annotation.PostMapping;
33. import org.springframework.web.bind.annotation.RequestBody;
34. import org.springframework.web.bind.annotation.RequestParam;
35. import org.springframework.web.bind.annotation.RestController;
36. 
37. import javax.validation.Valid;
38. import java.util.List;
39. import java.util.Map;
40. 
41. @RestController
42. public class NamespaceController {
43. 
44.   private final NamespaceService namespaceService;
45. 
46.   public NamespaceController(final NamespaceService namespaceService) {
47.     this.namespaceService = namespaceService;
48.   }
49. 
50.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces")
51.   public NamespaceDTO create(@PathVariable("appId") String appId,
52.                              @PathVariable("clusterName") String clusterName,
53.                              @Valid @RequestBody NamespaceDTO dto) {
54.     Namespace entity = BeanUtils.transform(Namespace.class, dto);
55.     Namespace managedEntity = namespaceService.findOne(appId, clusterName, entity.getNamespaceName());
56.     if (managedEntity != null) {
57.       throw new BadRequestException("namespace already exist.");
58.     }
59. 
60.     entity = namespaceService.save(entity);
61. 
62.     return BeanUtils.transform(NamespaceDTO.class, entity);
63.   }
64. 
65.   @DeleteMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
66.   public void delete(@PathVariable("appId") String appId,
67.                      @PathVariable("clusterName") String clusterName,
68.                      @PathVariable("namespaceName") String namespaceName, @RequestParam String operator) {
69.     Namespace entity = namespaceService.findOne(appId, clusterName, namespaceName);
70.     if (entity == null) {
71.       throw new NotFoundException("namespace not found for %s %s %s", appId, clusterName,
72.           namespaceName);
73.     }
74. 
75.     namespaceService.deleteNamespace(entity, operator);
76.   }
77. 
78.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces")
79.   public List<NamespaceDTO> find(@PathVariable("appId") String appId,
80.                                  @PathVariable("clusterName") String clusterName) {
81.     List<Namespace> groups = namespaceService.findNamespaces(appId, clusterName);
82.     return BeanUtils.batchTransform(NamespaceDTO.class, groups);
83.   }
84. 
85.   @GetMapping("/namespaces/{namespaceId}")
86.   public NamespaceDTO get(@PathVariable("namespaceId") Long namespaceId) {
87.     Namespace namespace = namespaceService.findOne(namespaceId);
88.     if (namespace == null) {
89.         throw new NotFoundException("namespace not found for %s", namespaceId);
90.     }
91.     return BeanUtils.transform(NamespaceDTO.class, namespace);
92.   }
93. 
94.   /**
95.    * the returned content's size is not fixed. so please carefully used.
96.    */
97.   @GetMapping("/namespaces/find-by-item")
98.   public PageDTO<NamespaceDTO> findByItem(@RequestParam String itemKey, Pageable pageable) {
99.     Page<Namespace> namespacePage = namespaceService.findByItem(itemKey, pageable);
100. 
101.     List<NamespaceDTO> namespaceDTOS = BeanUtils.batchTransform(NamespaceDTO.class, namespacePage.getContent());
102. 
103.     return new PageDTO<>(namespaceDTOS, pageable, namespacePage.getTotalElements());
104.   }
105. 
106.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
107.   public NamespaceDTO get(@PathVariable("appId") String appId,
108.                           @PathVariable("clusterName") String clusterName,
109.                           @PathVariable("namespaceName") String namespaceName) {
110.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
111.     if (namespace == null) {
112.       throw new NotFoundException("namespace not found for %s %s %s", appId, clusterName,
113.           namespaceName);
114.     }
115.     return BeanUtils.transform(NamespaceDTO.class, namespace);
116.   }
117. 
118.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/associated-public-namespace")
119.   public NamespaceDTO findPublicNamespaceForAssociatedNamespace(@PathVariable String appId,
120.                                                                 @PathVariable String clusterName,
121.                                                                 @PathVariable String namespaceName) {
122.     Namespace namespace = namespaceService.findPublicNamespaceForAssociatedNamespace(clusterName, namespaceName);
123. 
124.     if (namespace == null) {
125.       throw new NotFoundException("public namespace not found. namespace:%s", namespaceName);
126.     }
127. 
128.     return BeanUtils.transform(NamespaceDTO.class, namespace);
129.   }
130. 
131.   /**
132.    * cluster -> cluster has not published namespaces?
133.    */
134.   @GetMapping("/apps/{appId}/namespaces/publish_info")
135.   public Map<String, Boolean> namespacePublishInfo(@PathVariable String appId) {
136.     return namespaceService.namespacePublishInfo(appId);
137.   }
138. 
139. 
140. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java
Line number range: 1 - 81
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.entity;
18. 
19. import com.ctrip.framework.apollo.common.entity.BaseEntity;
20. 
21. import org.hibernate.annotations.SQLDelete;
22. import org.hibernate.annotations.Where;
23. 
24. import javax.persistence.Column;
25. import javax.persistence.Entity;
26. import javax.persistence.Table;
27. 
28. @Entity
29. @Table(name = "Namespace")
30. @SQLDelete(sql = "Update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")
31. @Where(clause = "isDeleted = 0")
32. public class Namespace extends BaseEntity {
33. 
34.   @Column(name = "appId", nullable = false)
35.   private String appId;
36. 
37.   @Column(name = "ClusterName", nullable = false)
38.   private String clusterName;
39. 
40.   @Column(name = "NamespaceName", nullable = false)
41.   private String namespaceName;
42. 
43.   public Namespace(){
44. 
45.   }
46. 
47.   public Namespace(String appId, String clusterName, String namespaceName) {
48.     this.appId = appId;
49.     this.clusterName = clusterName;
50.     this.namespaceName = namespaceName;
51.   }
52. 
53.   public String getAppId() {
54.     return appId;
55.   }
56. 
57.   public String getClusterName() {
58.     return clusterName;
59.   }
60. 
61.   public String getNamespaceName() {
62.     return namespaceName;
63.   }
64. 
65.   public void setAppId(String appId) {
66.     this.appId = appId;
67.   }
68. 
69.   public void setClusterName(String clusterName) {
70.     this.clusterName = clusterName;
71.   }
72. 
73.   public void setNamespaceName(String namespaceName) {
74.     this.namespaceName = namespaceName;
75.   }
76. 
77.   public String toString() {
78.     return toStringHelper().add("appId", appId).add("clusterName", clusterName)
79.         .add("namespaceName", namespaceName).toString();
80.   }
81. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java
Line number range: 1 - 52
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.repository;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. 
21. import org.springframework.data.jpa.repository.Modifying;
22. import org.springframework.data.jpa.repository.Query;
23. import org.springframework.data.repository.PagingAndSortingRepository;
24. 
25. import java.util.List;
26. import java.util.Set;
27. 
28. 
29. public interface AppNamespaceRepository extends PagingAndSortingRepository<AppNamespace, Long>{
30. 
31.   AppNamespace findByAppIdAndName(String appId, String namespaceName);
32. 
33.   List<AppNamespace> findByAppIdAndNameIn(String appId, Set<String> namespaceNames);
34. 
35.   AppNamespace findByNameAndIsPublicTrue(String namespaceName);
36. 
37.   List<AppNamespace> findByNameInAndIsPublicTrue(Set<String> namespaceNames);
38. 
39.   List<AppNamespace> findByAppIdAndIsPublic(String appId, boolean isPublic);
40. 
41.   List<AppNamespace> findByAppIdOrderByIdAsc(String appId);
42. 
43.   List<AppNamespace> findFirst500ByIdGreaterThanOrderByIdAsc(long id);
44. 
45.   @Modifying
46.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?2 WHERE AppId=?1 and IsDeleted = 0")
47.   int batchDeleteByAppId(String appId, String operator);
48. 
49.   @Modifying
50.   @Query("UPDATE AppNamespace SET IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 WHERE AppId=?1 and Name = ?2 and IsDeleted = 0")
51.   int delete(String appId, String namespaceName, String operator);
52. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/ItemRepository.java
Line number range: 1 - 50
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.repository;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Item;
20. 
21. import org.springframework.data.domain.Page;
22. import org.springframework.data.domain.Pageable;
23. import org.springframework.data.jpa.repository.Modifying;
24. import org.springframework.data.jpa.repository.Query;
25. import org.springframework.data.repository.PagingAndSortingRepository;
26. 
27. import java.util.Date;
28. import java.util.List;
29. 
30. public interface ItemRepository extends PagingAndSortingRepository<Item, Long> {
31. 
32.   Item findByNamespaceIdAndKey(Long namespaceId, String key);
33. 
34.   List<Item> findByNamespaceIdOrderByLineNumAsc(Long namespaceId);
35. 
36.   List<Item> findByNamespaceId(Long namespaceId);
37. 
38.   List<Item> findByNamespaceIdAndDataChangeLastModifiedTimeGreaterThan(Long namespaceId, Date date);
39. 
40.   Page<Item> findByKey(String key, Pageable pageable);
41. 
42.   Page<Item> findByNamespaceId(Long namespaceId, Pageable pageable);
43.   
44.   Item findFirst1ByNamespaceIdOrderByLineNumDesc(Long namespaceId);
45. 
46.   @Modifying
47.   @Query("update Item set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?2 where namespaceId = ?1 and IsDeleted = 0")
48.   int deleteByNamespaceId(long namespaceId, String operator);
49. 
50. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java
Line number range: 1 - 47
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.repository;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Namespace;
20. 
21. import org.springframework.data.domain.Pageable;
22. import org.springframework.data.jpa.repository.Modifying;
23. import org.springframework.data.jpa.repository.Query;
24. import org.springframework.data.repository.PagingAndSortingRepository;
25. 
26. import java.util.List;
27. import java.util.Set;
28. 
29. public interface NamespaceRepository extends PagingAndSortingRepository<Namespace, Long> {
30. 
31.   List<Namespace> findByAppIdAndClusterNameOrderByIdAsc(String appId, String clusterName);
32. 
33.   Namespace findByAppIdAndClusterNameAndNamespaceName(String appId, String clusterName, String namespaceName);
34. 
35.   @Modifying
36.   @Query("update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 where appId=?1 and clusterName=?2 and IsDeleted = 0")
37.   int batchDelete(String appId, String clusterName, String operator);
38. 
39.   List<Namespace> findByAppIdAndNamespaceNameOrderByIdAsc(String appId, String namespaceName);
40. 
41.   List<Namespace> findByNamespaceName(String namespaceName, Pageable page);
42. 
43.   List<Namespace> findByIdIn(Set<Long> namespaceIds);
44. 
45.   int countByNamespaceNameAndAppIdNot(String namespaceName, String appId);
46. 
47. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 1 - 196
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Audit;
20. import com.ctrip.framework.apollo.biz.entity.Cluster;
21. import com.ctrip.framework.apollo.biz.entity.Namespace;
22. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;
23. import com.ctrip.framework.apollo.common.entity.AppNamespace;
24. import com.ctrip.framework.apollo.common.exception.ServiceException;
25. import com.ctrip.framework.apollo.common.utils.BeanUtils;
26. import com.ctrip.framework.apollo.core.ConfigConsts;
27. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
28. import com.ctrip.framework.apollo.core.utils.StringUtils;
29. import com.google.common.base.Preconditions;
30. import com.google.common.base.Strings;
31. import org.slf4j.Logger;
32. import org.slf4j.LoggerFactory;
33. import org.springframework.context.annotation.Lazy;
34. import org.springframework.stereotype.Service;
35. import org.springframework.transaction.annotation.Transactional;
36. 
37. import java.util.Collections;
38. import java.util.List;
39. import java.util.Objects;
40. import java.util.Set;
41. 
42. @Service
43. public class AppNamespaceService {
44. 
45.   private static final Logger logger = LoggerFactory.getLogger(AppNamespaceService.class);
46. 
47.   private final AppNamespaceRepository appNamespaceRepository;
48.   private final NamespaceService namespaceService;
49.   private final ClusterService clusterService;
50.   private final AuditService auditService;
51. 
52.   public AppNamespaceService(
53.       final AppNamespaceRepository appNamespaceRepository,
54.       final @Lazy NamespaceService namespaceService,
55.       final @Lazy ClusterService clusterService,
56.       final AuditService auditService) {
57.     this.appNamespaceRepository = appNamespaceRepository;
58.     this.namespaceService = namespaceService;
59.     this.clusterService = clusterService;
60.     this.auditService = auditService;
61.   }
62. 
63.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {
64.     Objects.requireNonNull(appId, "AppId must not be null");
65.     Objects.requireNonNull(namespaceName, "Namespace must not be null");
66.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));
67.   }
68. 
69.   public AppNamespace findPublicNamespaceByName(String namespaceName) {
70.     Preconditions.checkArgument(namespaceName != null, "Namespace must not be null");
71.     return appNamespaceRepository.findByNameAndIsPublicTrue(namespaceName);
72.   }
73. 
74.   public List<AppNamespace> findByAppId(String appId) {
75.     return appNamespaceRepository.findByAppIdOrderByIdAsc(appId);
76.   }
77. 
78.   public List<AppNamespace> findPublicNamespacesByNames(Set<String> namespaceNames) {
79.     if (namespaceNames == null || namespaceNames.isEmpty()) {
80.       return Collections.emptyList();
81.     }
82. 
83.     return appNamespaceRepository.findByNameInAndIsPublicTrue(namespaceNames);
84.   }
85. 
86.   public List<AppNamespace> findPrivateAppNamespace(String appId) {
87.     return appNamespaceRepository.findByAppIdAndIsPublic(appId, false);
88.   }
89. 
90.   public AppNamespace findOne(String appId, String namespaceName) {
91.     Preconditions
92.         .checkArgument(!StringUtils.isContainEmpty(appId, namespaceName), "appId or Namespace must not be null");
93.     return appNamespaceRepository.findByAppIdAndName(appId, namespaceName);
94.   }
95. 
96.   public List<AppNamespace> findByAppIdAndNamespaces(String appId, Set<String> namespaceNames) {
97.     Preconditions.checkArgument(!Strings.isNullOrEmpty(appId), "appId must not be null");
98.     if (namespaceNames == null || namespaceNames.isEmpty()) {
99.       return Collections.emptyList();
100.     }
101.     return appNamespaceRepository.findByAppIdAndNameIn(appId, namespaceNames);
102.   }
103. 
104.   @Transactional
105.   public void createDefaultAppNamespace(String appId, String createBy) {
106.     if (!isAppNamespaceNameUnique(appId, ConfigConsts.NAMESPACE_APPLICATION)) {
107.       throw new ServiceException("appnamespace not unique");
108.     }
109.     AppNamespace appNs = new AppNamespace();
110.     appNs.setAppId(appId);
111.     appNs.setName(ConfigConsts.NAMESPACE_APPLICATION);
112.     appNs.setComment("default app namespace");
113.     appNs.setFormat(ConfigFileFormat.Properties.getValue());
114.     appNs.setDataChangeCreatedBy(createBy);
115.     appNs.setDataChangeLastModifiedBy(createBy);
116.     appNamespaceRepository.save(appNs);
117. 
118.     auditService.audit(AppNamespace.class.getSimpleName(), appNs.getId(), Audit.OP.INSERT,
119.                        createBy);
120.   }
121. 
122.   @Transactional
123.   public AppNamespace createAppNamespace(AppNamespace appNamespace) {
124.     String createBy = appNamespace.getDataChangeCreatedBy();
125.     if (!isAppNamespaceNameUnique(appNamespace.getAppId(), appNamespace.getName())) {
126.       throw new ServiceException("appnamespace not unique");
127.     }
128.     appNamespace.setId(0);//protection
129.     appNamespace.setDataChangeCreatedBy(createBy);
130.     appNamespace.setDataChangeLastModifiedBy(createBy);
131. 
132.     appNamespace = appNamespaceRepository.save(appNamespace);
133. 
134.     createNamespaceForAppNamespaceInAllCluster(appNamespace.getAppId(), appNamespace.getName(), createBy);
135. 
136.     auditService.audit(AppNamespace.class.getSimpleName(), appNamespace.getId(), Audit.OP.INSERT, createBy);
137.     return appNamespace;
138.   }
139. 
140.   public AppNamespace update(AppNamespace appNamespace) {
141.     AppNamespace managedNs = appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName());
142.     BeanUtils.copyEntityProperties(appNamespace, managedNs);
143.     managedNs = appNamespaceRepository.save(managedNs);
144. 
145.     auditService.audit(AppNamespace.class.getSimpleName(), managedNs.getId(), Audit.OP.UPDATE,
146.                        managedNs.getDataChangeLastModifiedBy());
147. 
148.     return managedNs;
149.   }
150. 
151.   public void createNamespaceForAppNamespaceInAllCluster(String appId, String namespaceName, String createBy) {
152.     List<Cluster> clusters = clusterService.findParentClusters(appId);
153. 
154.     for (Cluster cluster : clusters) {
155. 
156.       // in case there is some dirty data, e.g. public namespace deleted in other app and now created in this app
157.       if (!namespaceService.isNamespaceUnique(appId, cluster.getName(), namespaceName)) {
158.         continue;
159.       }
160. 
161.       Namespace namespace = new Namespace();
162.       namespace.setClusterName(cluster.getName());
163.       namespace.setAppId(appId);
164.       namespace.setNamespaceName(namespaceName);
165.       namespace.setDataChangeCreatedBy(createBy);
166.       namespace.setDataChangeLastModifiedBy(createBy);
167. 
168.       namespaceService.save(namespace);
169.     }
170.   }
171. 
172.   @Transactional
173.   public void batchDelete(String appId, String operator) {
174.     appNamespaceRepository.batchDeleteByAppId(appId, operator);
175.   }
176. 
177.   @Transactional
178.   public void deleteAppNamespace(AppNamespace appNamespace, String operator) {
179.     String appId = appNamespace.getAppId();
180.     String namespaceName = appNamespace.getName();
181. 
182.     logger.info("{} is deleting AppNamespace, appId: {}, namespace: {}", operator, appId, namespaceName);
183. 
184.     // 1. delete namespaces
185.     List<Namespace> namespaces = namespaceService.findByAppIdAndNamespaceName(appId, namespaceName);
186. 
187.     if (namespaces != null) {
188.       for (Namespace namespace : namespaces) {
189.         namespaceService.deleteNamespace(namespace, operator);
190.       }
191.     }
192. 
193.     // 2. delete app namespace
194.     appNamespaceRepository.delete(appId, namespaceName, operator);
195.   }
196. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 1 - 447
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Audit;
20. import com.ctrip.framework.apollo.biz.entity.Cluster;
21. import com.ctrip.framework.apollo.biz.entity.Item;
22. import com.ctrip.framework.apollo.biz.entity.Namespace;
23. import com.ctrip.framework.apollo.biz.entity.Release;
24. import com.ctrip.framework.apollo.biz.message.MessageSender;
25. import com.ctrip.framework.apollo.biz.message.Topics;
26. import com.ctrip.framework.apollo.biz.repository.NamespaceRepository;
27. import com.ctrip.framework.apollo.biz.utils.ReleaseMessageKeyGenerator;
28. import com.ctrip.framework.apollo.common.constants.GsonType;
29. import com.ctrip.framework.apollo.common.constants.NamespaceBranchStatus;
30. import com.ctrip.framework.apollo.common.entity.AppNamespace;
31. import com.ctrip.framework.apollo.common.exception.BadRequestException;
32. import com.ctrip.framework.apollo.common.exception.ServiceException;
33. import com.ctrip.framework.apollo.common.utils.BeanUtils;
34. import com.ctrip.framework.apollo.core.ConfigConsts;
35. import com.google.common.collect.Maps;
36. import com.google.gson.Gson;
37. import org.springframework.context.annotation.Lazy;
38. import org.springframework.data.domain.Page;
39. import org.springframework.data.domain.PageImpl;
40. import org.springframework.data.domain.Pageable;
41. import org.springframework.stereotype.Service;
42. import org.springframework.transaction.annotation.Transactional;
43. import org.springframework.util.CollectionUtils;
44. 
45. import java.util.Collections;
46. import java.util.Date;
47. import java.util.LinkedList;
48. import java.util.List;
49. import java.util.Map;
50. import java.util.Objects;
51. import java.util.Set;
52. import java.util.stream.Collectors;
53. 
54. @Service
55. public class NamespaceService {
56. 
57.   private static final Gson GSON = new Gson();
58. 
59.   private final NamespaceRepository namespaceRepository;
60.   private final AuditService auditService;
61.   private final AppNamespaceService appNamespaceService;
62.   private final ItemService itemService;
63.   private final CommitService commitService;
64.   private final ReleaseService releaseService;
65.   private final ClusterService clusterService;
66.   private final NamespaceBranchService namespaceBranchService;
67.   private final ReleaseHistoryService releaseHistoryService;
68.   private final NamespaceLockService namespaceLockService;
69.   private final InstanceService instanceService;
70.   private final MessageSender messageSender;
71. 
72.   public NamespaceService(
73.       final ReleaseHistoryService releaseHistoryService,
74.       final NamespaceRepository namespaceRepository,
75.       final AuditService auditService,
76.       final @Lazy AppNamespaceService appNamespaceService,
77.       final MessageSender messageSender,
78.       final @Lazy ItemService itemService,
79.       final CommitService commitService,
80.       final @Lazy ReleaseService releaseService,
81.       final @Lazy ClusterService clusterService,
82.       final @Lazy NamespaceBranchService namespaceBranchService,
83.       final NamespaceLockService namespaceLockService,
84.       final InstanceService instanceService) {
85.     this.releaseHistoryService = releaseHistoryService;
86.     this.namespaceRepository = namespaceRepository;
87.     this.auditService = auditService;
88.     this.appNamespaceService = appNamespaceService;
89.     this.messageSender = messageSender;
90.     this.itemService = itemService;
91.     this.commitService = commitService;
92.     this.releaseService = releaseService;
93.     this.clusterService = clusterService;
94.     this.namespaceBranchService = namespaceBranchService;
95.     this.namespaceLockService = namespaceLockService;
96.     this.instanceService = instanceService;
97.   }
98. 
99. 
100.   public Namespace findOne(Long namespaceId) {
101.     return namespaceRepository.findById(namespaceId).orElse(null);
102.   }
103. 
104.   public Namespace findOne(String appId, String clusterName, String namespaceName) {
105.     return namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, clusterName,
106.                                                                          namespaceName);
107.   }
108. 
109.   /**
110.    * the returned content's size is not fixed. so please carefully used.
111.    */
112.   public Page<Namespace> findByItem(String itemKey, Pageable pageable) {
113.     Page<Item> items = itemService.findItemsByKey(itemKey, pageable);
114. 
115.     if (!items.hasContent()) {
116.       return Page.empty();
117.     }
118. 
119.     Set<Long> namespaceIds = BeanUtils.toPropertySet("namespaceId", items.getContent());
120. 
121.     return new PageImpl<>(namespaceRepository.findByIdIn(namespaceIds));
122.   }
123. 
124.   public Namespace findPublicNamespaceForAssociatedNamespace(String clusterName, String namespaceName) {
125.     AppNamespace appNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);
126.     if (appNamespace == null) {
127.       throw new BadRequestException("namespace not exist");
128.     }
129. 
130.     String appId = appNamespace.getAppId();
131. 
132.     Namespace namespace = findOne(appId, clusterName, namespaceName);
133. 
134.     //default cluster's namespace
135.     if (Objects.equals(clusterName, ConfigConsts.CLUSTER_NAME_DEFAULT)) {
136.       return namespace;
137.     }
138. 
139.     //custom cluster's namespace not exist.
140.     //return default cluster's namespace
141.     if (namespace == null) {
142.       return findOne(appId, ConfigConsts.CLUSTER_NAME_DEFAULT, namespaceName);
143.     }
144. 
145.     //custom cluster's namespace exist and has published.
146.     //return custom cluster's namespace
147.     Release latestActiveRelease = releaseService.findLatestActiveRelease(namespace);
148.     if (latestActiveRelease != null) {
149.       return namespace;
150.     }
151. 
152.     Namespace defaultNamespace = findOne(appId, ConfigConsts.CLUSTER_NAME_DEFAULT, namespaceName);
153. 
154.     //custom cluster's namespace exist but never published.
155.     //and default cluster's namespace not exist.
156.     //return custom cluster's namespace
157.     if (defaultNamespace == null) {
158.       return namespace;
159.     }
160. 
161.     //custom cluster's namespace exist but never published.
162.     //and default cluster's namespace exist and has published.
163.     //return default cluster's namespace
164.     Release defaultNamespaceLatestActiveRelease = releaseService.findLatestActiveRelease(defaultNamespace);
165.     if (defaultNamespaceLatestActiveRelease != null) {
166.       return defaultNamespace;
167.     }
168. 
169.     //custom cluster's namespace exist but never published.
170.     //and default cluster's namespace exist but never published.
171.     //return custom cluster's namespace
172.     return namespace;
173.   }
174. 
175.   public List<Namespace> findPublicAppNamespaceAllNamespaces(String namespaceName, Pageable page) {
176.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);
177. 
178.     if (publicAppNamespace == null) {
179.       throw new BadRequestException(
180.           String.format("Public appNamespace not exists. NamespaceName = %s", namespaceName));
181.     }
182. 
183.     List<Namespace> namespaces = namespaceRepository.findByNamespaceName(namespaceName, page);
184. 
185.     return filterChildNamespace(namespaces);
186.   }
187. 
188.   private List<Namespace> filterChildNamespace(List<Namespace> namespaces) {
189.     List<Namespace> result = new LinkedList<>();
190. 
191.     if (CollectionUtils.isEmpty(namespaces)) {
192.       return result;
193.     }
194. 
195.     for (Namespace namespace : namespaces) {
196.       if (!isChildNamespace(namespace)) {
197.         result.add(namespace);
198.       }
199.     }
200. 
201.     return result;
202.   }
203. 
204.   public int countPublicAppNamespaceAssociatedNamespaces(String publicNamespaceName) {
205.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(publicNamespaceName);
206. 
207.     if (publicAppNamespace == null) {
208.       throw new BadRequestException(
209.           String.format("Public appNamespace not exists. NamespaceName = %s", publicNamespaceName));
210.     }
211. 
212.     return namespaceRepository.countByNamespaceNameAndAppIdNot(publicNamespaceName, publicAppNamespace.getAppId());
213.   }
214. 
215.   public List<Namespace> findNamespaces(String appId, String clusterName) {
216.     List<Namespace> namespaces = namespaceRepository.findByAppIdAndClusterNameOrderByIdAsc(appId, clusterName);
217.     if (namespaces == null) {
218.       return Collections.emptyList();
219.     }
220.     return namespaces;
221.   }
222. 
223.   public List<Namespace> findByAppIdAndNamespaceName(String appId, String namespaceName) {
224.     return namespaceRepository.findByAppIdAndNamespaceNameOrderByIdAsc(appId, namespaceName);
225.   }
226. 
227.   public Namespace findChildNamespace(String appId, String parentClusterName, String namespaceName) {
228.     List<Namespace> namespaces = findByAppIdAndNamespaceName(appId, namespaceName);
229.     if (CollectionUtils.isEmpty(namespaces) || namespaces.size() == 1) {
230.       return null;
231.     }
232. 
233.     List<Cluster> childClusters = clusterService.findChildClusters(appId, parentClusterName);
234.     if (CollectionUtils.isEmpty(childClusters)) {
235.       return null;
236.     }
237. 
238.     Set<String> childClusterNames = childClusters.stream().map(Cluster::getName).collect(Collectors.toSet());
239.     //the child namespace is the intersection of the child clusters and child namespaces
240.     for (Namespace namespace : namespaces) {
241.       if (childClusterNames.contains(namespace.getClusterName())) {
242.         return namespace;
243.       }
244.     }
245. 
246.     return null;
247.   }
248. 
249.   public Namespace findChildNamespace(Namespace parentNamespace) {
250.     String appId = parentNamespace.getAppId();
251.     String parentClusterName = parentNamespace.getClusterName();
252.     String namespaceName = parentNamespace.getNamespaceName();
253. 
254.     return findChildNamespace(appId, parentClusterName, namespaceName);
255. 
256.   }
257. 
258.   public Namespace findParentNamespace(String appId, String clusterName, String namespaceName) {
259.     return findParentNamespace(new Namespace(appId, clusterName, namespaceName));
260.   }
261. 
262.   public Namespace findParentNamespace(Namespace namespace) {
263.     String appId = namespace.getAppId();
264.     String namespaceName = namespace.getNamespaceName();
265. 
266.     Cluster cluster = clusterService.findOne(appId, namespace.getClusterName());
267.     if (cluster != null && cluster.getParentClusterId() > 0) {
268.       Cluster parentCluster = clusterService.findOne(cluster.getParentClusterId());
269.       return findOne(appId, parentCluster.getName(), namespaceName);
270.     }
271. 
272.     return null;
273.   }
274. 
275.   public boolean isChildNamespace(String appId, String clusterName, String namespaceName) {
276.     return isChildNamespace(new Namespace(appId, clusterName, namespaceName));
277.   }
278. 
279.   public boolean isChildNamespace(Namespace namespace) {
280.     return findParentNamespace(namespace) != null;
281.   }
282. 
283.   public boolean isNamespaceUnique(String appId, String cluster, String namespace) {
284.     Objects.requireNonNull(appId, "AppId must not be null");
285.     Objects.requireNonNull(cluster, "Cluster must not be null");
286.     Objects.requireNonNull(namespace, "Namespace must not be null");
287.     return Objects.isNull(
288.         namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, cluster, namespace));
289.   }
290. 
291.   @Transactional
292.   public void deleteByAppIdAndClusterName(String appId, String clusterName, String operator) {
293. 
294.     List<Namespace> toDeleteNamespaces = findNamespaces(appId, clusterName);
295. 
296.     for (Namespace namespace : toDeleteNamespaces) {
297. 
298.       deleteNamespace(namespace, operator);
299. 
300.     }
301.   }
302. 
303.   @Transactional
304.   public Namespace deleteNamespace(Namespace namespace, String operator) {
305.     String appId = namespace.getAppId();
306.     String clusterName = namespace.getClusterName();
307.     String namespaceName = namespace.getNamespaceName();
308. 
309.     itemService.batchDelete(namespace.getId(), operator);
310.     commitService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);
311. 
312.     // Child namespace releases should retain as long as the parent namespace exists, because parent namespaces' release
313.     // histories need them
314.     if (!isChildNamespace(namespace)) {
315.       releaseService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);
316.     }
317. 
318.     //delete child namespace
319.     Namespace childNamespace = findChildNamespace(namespace);
320.     if (childNamespace != null) {
321.       namespaceBranchService.deleteBranch(appId, clusterName, namespaceName,
322.                                           childNamespace.getClusterName(), NamespaceBranchStatus.DELETED, operator);
323.       //delete child namespace's releases. Notice: delete child namespace will not delete child namespace's releases
324.       releaseService.batchDelete(appId, childNamespace.getClusterName(), namespaceName, operator);
325.     }
326. 
327.     releaseHistoryService.batchDelete(appId, clusterName, namespaceName, operator);
328. 
329.     instanceService.batchDeleteInstanceConfig(appId, clusterName, namespaceName);
330. 
331.     namespaceLockService.unlock(namespace.getId());
332. 
333.     namespace.setDeleted(true);
334.     namespace.setDataChangeLastModifiedBy(operator);
335. 
336.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.DELETE, operator);
337. 
338.     Namespace deleted = namespaceRepository.save(namespace);
339. 
340.     //Publish release message to do some clean up in config service, such as updating the cache
341.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),
342.         Topics.APOLLO_RELEASE_TOPIC);
343. 
344.     return deleted;
345.   }
346. 
347.   @Transactional
348.   public Namespace save(Namespace entity) {
349.     if (!isNamespaceUnique(entity.getAppId(), entity.getClusterName(), entity.getNamespaceName())) {
350.       throw new ServiceException("namespace not unique");
351.     }
352.     entity.setId(0);//protection
353.     Namespace namespace = namespaceRepository.save(entity);
354. 
355.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.INSERT,
356.                        namespace.getDataChangeCreatedBy());
357. 
358.     return namespace;
359.   }
360. 
361.   @Transactional
362.   public Namespace update(Namespace namespace) {
363.     Namespace managedNamespace = namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(
364.         namespace.getAppId(), namespace.getClusterName(), namespace.getNamespaceName());
365.     BeanUtils.copyEntityProperties(namespace, managedNamespace);
366.     managedNamespace = namespaceRepository.save(managedNamespace);
367. 
368.     auditService.audit(Namespace.class.getSimpleName(), managedNamespace.getId(), Audit.OP.UPDATE,
369.                        managedNamespace.getDataChangeLastModifiedBy());
370. 
371.     return managedNamespace;
372.   }
373. 
374.   @Transactional
375.   public void instanceOfAppNamespaces(String appId, String clusterName, String createBy) {
376. 
377.     List<AppNamespace> appNamespaces = appNamespaceService.findByAppId(appId);
378. 
379.     for (AppNamespace appNamespace : appNamespaces) {
380.       Namespace ns = new Namespace();
381.       ns.setAppId(appId);
382.       ns.setClusterName(clusterName);
383.       ns.setNamespaceName(appNamespace.getName());
384.       ns.setDataChangeCreatedBy(createBy);
385.       ns.setDataChangeLastModifiedBy(createBy);
386.       namespaceRepository.save(ns);
387.       auditService.audit(Namespace.class.getSimpleName(), ns.getId(), Audit.OP.INSERT, createBy);
388.     }
389. 
390.   }
391. 
392.   public Map<String, Boolean> namespacePublishInfo(String appId) {
393.     List<Cluster> clusters = clusterService.findParentClusters(appId);
394.     if (CollectionUtils.isEmpty(clusters)) {
395.       throw new BadRequestException("app not exist");
396.     }
397. 
398.     Map<String, Boolean> clusterHasNotPublishedItems = Maps.newHashMap();
399. 
400.     for (Cluster cluster : clusters) {
401.       String clusterName = cluster.getName();
402.       List<Namespace> namespaces = findNamespaces(appId, clusterName);
403. 
404.       for (Namespace namespace : namespaces) {
405.         boolean isNamespaceNotPublished = isNamespaceNotPublished(namespace);
406. 
407.         if (isNamespaceNotPublished) {
408.           clusterHasNotPublishedItems.put(clusterName, true);
409.           break;
410.         }
411.       }
412. 
413.       clusterHasNotPublishedItems.putIfAbsent(clusterName, false);
414.     }
415. 
416.     return clusterHasNotPublishedItems;
417.   }
418. 
419.   private boolean isNamespaceNotPublished(Namespace namespace) {
420. 
421.     Release latestRelease = releaseService.findLatestActiveRelease(namespace);
422.     long namespaceId = namespace.getId();
423. 
424.     if (latestRelease == null) {
425.       Item lastItem = itemService.findLastOne(namespaceId);
426.       return lastItem != null;
427.     }
428. 
429.     Date lastPublishTime = latestRelease.getDataChangeLastModifiedTime();
430.     List<Item> itemsModifiedAfterLastPublish = itemService.findItemsModifiedAfterDate(namespaceId, lastPublishTime);
431. 
432.     if (CollectionUtils.isEmpty(itemsModifiedAfterLastPublish)) {
433.       return false;
434.     }
435. 
436.     Map<String, String> publishedConfiguration = GSON.fromJson(latestRelease.getConfigurations(), GsonType.CONFIG);
437.     for (Item item : itemsModifiedAfterLastPublish) {
438.       if (!Objects.equals(item.getValue(), publishedConfiguration.get(item.getKey()))) {
439.         return true;
440.       }
441.     }
442. 
443.     return false;
444.   }
445. 
446. 
447. }


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java
Line number range: 1 - 107
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.common.entity;
18. 
19. 
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
22. 
23. import javax.validation.constraints.NotBlank;
24. import javax.validation.constraints.Pattern;
25. import org.hibernate.annotations.SQLDelete;
26. import org.hibernate.annotations.Where;
27. 
28. import javax.persistence.Column;
29. import javax.persistence.Entity;
30. import javax.persistence.Table;
31. 
32. @Entity
33. @Table(name = "AppNamespace")
34. @SQLDelete(sql = "Update AppNamespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")
35. @Where(clause = "isDeleted = 0")
36. public class AppNamespace extends BaseEntity {
37. 
38.   @NotBlank(message = "AppNamespace Name cannot be blank")
39.   @Pattern(
40.       regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR,
41.       message = "Invalid Namespace format: " + InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE
42.   )
43.   @Column(name = "Name", nullable = false)
44.   private String name;
45. 
46.   @NotBlank(message = "AppId cannot be blank")
47.   @Column(name = "AppId", nullable = false)
48.   private String appId;
49. 
50.   @Column(name = "Format", nullable = false)
51.   private String format;
52. 
53.   @Column(name = "IsPublic", columnDefinition = "Bit default '0'")
54.   private boolean isPublic = false;
55. 
56.   @Column(name = "Comment")
57.   private String comment;
58. 
59.   public String getAppId() {
60.     return appId;
61.   }
62. 
63.   public String getComment() {
64.     return comment;
65.   }
66. 
67.   public String getName() {
68.     return name;
69.   }
70. 
71.   public void setAppId(String appId) {
72.     this.appId = appId;
73.   }
74. 
75.   public void setComment(String comment) {
76.     this.comment = comment;
77.   }
78. 
79.   public void setName(String name) {
80.     this.name = name;
81.   }
82. 
83.   public boolean isPublic() {
84.     return isPublic;
85.   }
86. 
87.   public void setPublic(boolean aPublic) {
88.     isPublic = aPublic;
89.   }
90. 
91.   public ConfigFileFormat formatAsEnum() {
92.     return ConfigFileFormat.fromString(this.format);
93.   }
94. 
95.   public String getFormat() {
96.     return format;
97.   }
98. 
99.   public void setFormat(String format) {
100.     this.format = format;
101.   }
102. 
103.   public String toString() {
104.     return toStringHelper().add("name", name).add("appId", appId).add("comment", comment)
105.         .add("format", format).add("isPublic", isPublic).toString();
106.   }
107. }


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
Line number range: 1 - 47
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.common.utils;
18. 
19. import com.ctrip.framework.apollo.core.utils.StringUtils;
20. 
21. import java.util.regex.Pattern;
22. 
23. /**
24.  * @author Jason Song(song_s@ctrip.com)
25.  */
26. public class InputValidator {
27.   public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbol - _ . are allowed";
28.   public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE = "not allowed to end with .json, .yml, .yaml, .xml, .properties";
29.   public static final String CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+";
30.   private static final String APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$";
31.   private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);
32.   private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);
33. 
34.   public static boolean isValidClusterNamespace(String name) {
35.     if (StringUtils.isEmpty(name)){
36.       return false;
37.     }
38.     return CLUSTER_NAMESPACE_PATTERN.matcher(name).matches();
39.   }
40. 
41.   public static boolean isValidAppNamespace(String name){
42.     if (StringUtils.isEmpty(name)){
43.       return false;
44.     }
45.     return APP_NAMESPACE_PATTERN.matcher(name).matches();
46.   }
47. }


File: apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java
Line number range: 1 - 57
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.util;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
21. import org.springframework.stereotype.Component;
22. 
23. /**
24.  * @author Jason Song(song_s@ctrip.com)
25.  */
26. @Component
27. public class NamespaceUtil {
28. 
29.   private final AppNamespaceServiceWithCache appNamespaceServiceWithCache;
30. 
31.   public NamespaceUtil(final AppNamespaceServiceWithCache appNamespaceServiceWithCache) {
32.     this.appNamespaceServiceWithCache = appNamespaceServiceWithCache;
33.   }
34. 
35.   public String filterNamespaceName(String namespaceName) {
36.     if (namespaceName.toLowerCase().endsWith(".properties")) {
37.       int dotIndex = namespaceName.lastIndexOf(".");
38.       return namespaceName.substring(0, dotIndex);
39.     }
40. 
41.     return namespaceName;
42.   }
43. 
44.   public String normalizeNamespace(String appId, String namespaceName) {
45.     AppNamespace appNamespace = appNamespaceServiceWithCache.findByAppIdAndNamespace(appId, namespaceName);
46.     if (appNamespace != null) {
47.       return appNamespace.getName();
48.     }
49. 
50.     appNamespace = appNamespaceServiceWithCache.findPublicNamespaceByName(namespaceName);
51.     if (appNamespace != null) {
52.       return appNamespace.getName();
53.     }
54. 
55.     return namespaceName;
56.   }
57. }


File: apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java
Line number range: 1 - 131
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.core.enums;
18. 
19. import com.ctrip.framework.apollo.core.utils.StringUtils;
20. import java.util.stream.Stream;
21. 
22. /**
23.  * This enum represents all the possible Configuration file formats apollo currently supports.
24.  * <p>
25.  * Currently the following formats are supported:
26.  * <ul>
27.  *   <li>{@link ConfigFileFormat#Properties}</li>
28.  *   <li>{@link ConfigFileFormat#XML}</li>
29.  *   <li>{@link ConfigFileFormat#JSON}</li>
30.  *   <li>{@link ConfigFileFormat#YML}</li>
31.  *   <li>{@link ConfigFileFormat#YAML}</li>
32.  *   <li>{@link ConfigFileFormat#TXT}</li>
33.  * </ul>
34.  *
35.  * @author Jason Song(song_s@ctrip.com)
36.  * @author Diego Krupitza(info@diegokrupitza.com)
37.  */
38. public enum ConfigFileFormat {
39.   Properties("properties"), XML("xml"), JSON("json"), YML("yml"), YAML("yaml"), TXT("txt");
40. 
41.   private final String value;
42. 
43.   ConfigFileFormat(String value) {
44.     this.value = value;
45.   }
46. 
47.   /**
48.    * Cleans a given configFilename so it does not contain leading or trailing spaces and is always
49.    * lowercase.
50.    * <p>
51.    * For example:
52.    *
53.    * <table border="1" cellspacing="1">
54.    *   <tr>
55.    *   <th>Before</th>
56.    *   <th>After</th>
57.    *   </tr>
58.    *   <tr>
59.    *     <td>"Properties "</td>
60.    *     <td>"properties"</td>
61.    *   </tr>
62.    *   <tr>
63.    *    <td>"    "</td>
64.    *    <td>""</td>
65.    *    </tr>
66.    * </table>
67.    *
68.    * @param configFileName the name we want to clean
69.    * @return the cleansed configFileName
70.    */
71.   private static String getWellFormedName(String configFileName) {
72.     if (StringUtils.isBlank(configFileName)) {
73.       return "";
74.     }
75.     return configFileName.trim().toLowerCase();
76.   }
77. 
78.   /**
79.    * Transforms a given string to its matching {@link ConfigFileFormat}.
80.    *
81.    * @param value the string that matches
82.    * @return the matching {@link ConfigFileFormat}
83.    * @throws IllegalArgumentException in case the <code>value</code> is empty or there is no
84.    *                                  matching {@link ConfigFileFormat}
85.    */
86.   public static ConfigFileFormat fromString(String value) {
87.     if (StringUtils.isEmpty(value)) {
88.       throw new IllegalArgumentException("value can not be empty");
89.     }
90. 
91.     final String cleansedName = getWellFormedName(value);
92. 
93.     return Stream.of(ConfigFileFormat.values())
94.         .filter(item -> cleansedName.equalsIgnoreCase(item.getValue()))
95.         .findFirst()
96.         .orElseThrow(() -> new IllegalArgumentException(value + " can not map enum"));
97.   }
98. 
99.   /**
100.    * Checks if a given string is a valid {@link ConfigFileFormat}.
101.    *
102.    * @param value the string to check on
103.    * @return is it a valid format
104.    */
105.   public static boolean isValidFormat(String value) {
106.     try {
107.       fromString(value);
108.       return true;
109.     } catch (IllegalArgumentException e) {
110.       return false;
111.     }
112.   }
113. 
114.   /**
115.    * Checks whether a given {@link ConfigFileFormat} is compatible with {@link
116.    * ConfigFileFormat#Properties}
117.    *
118.    * @param format the format to check its compatibility
119.    * @return is it compatible with {@link ConfigFileFormat#Properties}
120.    */
121.   public static boolean isPropertiesCompatible(ConfigFileFormat format) {
122.     return format == YAML || format == YML || format == Properties;
123.   }
124. 
125.   /**
126.    * @return The string representation of the given {@link ConfigFileFormat}
127.    */
128.   public String getValue() {
129.     return value;
130.   }
131. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java
Line number range: 1 - 103
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.openapi.v1.controller;
18. 
19. import com.ctrip.framework.apollo.common.exception.BadRequestException;
20. import com.ctrip.framework.apollo.common.utils.InputValidator;
21. import com.ctrip.framework.apollo.common.utils.RequestPrecondition;
22. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
23. import com.ctrip.framework.apollo.openapi.api.NamespaceOpenApiService;
24. import com.ctrip.framework.apollo.openapi.dto.OpenAppNamespaceDTO;
25. import com.ctrip.framework.apollo.openapi.dto.OpenNamespaceDTO;
26. import com.ctrip.framework.apollo.openapi.dto.OpenNamespaceLockDTO;
27. import com.ctrip.framework.apollo.portal.spi.UserService;
28. import org.springframework.security.access.prepost.PreAuthorize;
29. import org.springframework.web.bind.annotation.GetMapping;
30. import org.springframework.web.bind.annotation.PathVariable;
31. import org.springframework.web.bind.annotation.PostMapping;
32. import org.springframework.web.bind.annotation.RequestBody;
33. import org.springframework.web.bind.annotation.RestController;
34. 
35. import javax.servlet.http.HttpServletRequest;
36. import java.util.List;
37. import java.util.Objects;
38. 
39. @RestController("openapiNamespaceController")
40. public class NamespaceController {
41. 
42.   private final UserService userService;
43.   private final NamespaceOpenApiService namespaceOpenApiService;
44. 
45.   public NamespaceController(
46.       final UserService userService,
47.       NamespaceOpenApiService namespaceOpenApiService) {
48.     this.userService = userService;
49.     this.namespaceOpenApiService = namespaceOpenApiService;
50.   }
51. 
52.   @PreAuthorize(value = "@consumerPermissionValidator.hasCreateNamespacePermission(#request, #appId)")
53.   @PostMapping(value = "/openapi/v1/apps/{appId}/appnamespaces")
54.   public OpenAppNamespaceDTO createNamespace(@PathVariable String appId,
55.                                              @RequestBody OpenAppNamespaceDTO appNamespaceDTO,
56.                                              HttpServletRequest request) {
57. 
58.     if (!Objects.equals(appId, appNamespaceDTO.getAppId())) {
59.       throw new BadRequestException(String.format("AppId not equal. AppId in path = %s, AppId in payload = %s", appId,
60.                                                   appNamespaceDTO.getAppId()));
61.     }
62.     RequestPrecondition.checkArgumentsNotEmpty(appNamespaceDTO.getAppId(), appNamespaceDTO.getName(),
63.                                                appNamespaceDTO.getFormat(), appNamespaceDTO.getDataChangeCreatedBy());
64. 
65.     if (!InputValidator.isValidAppNamespace(appNamespaceDTO.getName())) {
66.       throw new BadRequestException(String.format("Invalid Namespace format: %s",
67.                                                   InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & "
68.                                                   + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
69.     }
70. 
71.     if (!ConfigFileFormat.isValidFormat(appNamespaceDTO.getFormat())) {
72.       throw new BadRequestException(String.format("Invalid namespace format. format = %s", appNamespaceDTO.getFormat()));
73.     }
74. 
75.     String operator = appNamespaceDTO.getDataChangeCreatedBy();
76.     if (userService.findByUserId(operator) == null) {
77.       throw new BadRequestException(String.format("Illegal user. user = %s", operator));
78.     }
79. 
80.     return this.namespaceOpenApiService.createAppNamespace(appNamespaceDTO);
81.   }
82. 
83.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces")
84.   public List<OpenNamespaceDTO> findNamespaces(@PathVariable String appId, @PathVariable String env,
85.                                                @PathVariable String clusterName) {
86.     return this.namespaceOpenApiService.getNamespaces(appId, env, clusterName);
87.   }
88. 
89.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
90.   public OpenNamespaceDTO loadNamespace(@PathVariable String appId, @PathVariable String env,
91.                                         @PathVariable String clusterName, @PathVariable String
92.                                             namespaceName) {
93.     return this.namespaceOpenApiService.getNamespace(appId, env, clusterName, namespaceName);
94.   }
95. 
96.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/lock")
97.   public OpenNamespaceLockDTO getNamespaceLock(@PathVariable String appId, @PathVariable String env,
98.                                                @PathVariable String clusterName, @PathVariable
99.                                                    String namespaceName) {
100.     return this.namespaceOpenApiService.getNamespaceLock(appId, env, clusterName, namespaceName);
101.   }
102. 
103. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 1 - 314
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.controller;
18. 
19. import com.ctrip.framework.apollo.common.dto.AppNamespaceDTO;
20. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
21. import com.ctrip.framework.apollo.common.entity.AppNamespace;
22. import com.ctrip.framework.apollo.common.exception.BadRequestException;
23. import com.ctrip.framework.apollo.common.http.MultiResponseEntity;
24. import com.ctrip.framework.apollo.common.http.RichResponseEntity;
25. import com.ctrip.framework.apollo.common.utils.BeanUtils;
26. import com.ctrip.framework.apollo.common.utils.InputValidator;
27. import com.ctrip.framework.apollo.common.utils.RequestPrecondition;
28. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
29. import com.ctrip.framework.apollo.portal.environment.Env;
30. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
31. import com.ctrip.framework.apollo.portal.component.PermissionValidator;
32. import com.ctrip.framework.apollo.portal.component.config.PortalConfig;
33. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
34. import com.ctrip.framework.apollo.portal.entity.model.NamespaceCreationModel;
35. import com.ctrip.framework.apollo.portal.listener.AppNamespaceCreationEvent;
36. import com.ctrip.framework.apollo.portal.listener.AppNamespaceDeletionEvent;
37. import com.ctrip.framework.apollo.portal.service.AppNamespaceService;
38. import com.ctrip.framework.apollo.portal.service.NamespaceService;
39. import com.ctrip.framework.apollo.portal.service.RoleInitializationService;
40. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
41. import com.ctrip.framework.apollo.tracer.Tracer;
42. import com.google.common.collect.Lists;
43. import com.google.common.collect.Sets;
44. import org.slf4j.Logger;
45. import org.slf4j.LoggerFactory;
46. import org.springframework.context.ApplicationEventPublisher;
47. import org.springframework.http.ResponseEntity;
48. import org.springframework.security.access.prepost.PreAuthorize;
49. import org.springframework.util.CollectionUtils;
50. import org.springframework.web.bind.annotation.DeleteMapping;
51. import org.springframework.web.bind.annotation.GetMapping;
52. import org.springframework.web.bind.annotation.PathVariable;
53. import org.springframework.web.bind.annotation.PostMapping;
54. import org.springframework.web.bind.annotation.RequestBody;
55. import org.springframework.web.bind.annotation.RequestParam;
56. import org.springframework.web.bind.annotation.RestController;
57. 
58. import javax.validation.Valid;
59. import java.util.List;
60. import java.util.Map;
61. import java.util.Set;
62. import java.util.stream.Collectors;
63. 
64. import static com.ctrip.framework.apollo.common.utils.RequestPrecondition.checkModel;
65. 
66. @RestController
67. public class NamespaceController {
68. 
69.   private static final Logger logger = LoggerFactory.getLogger(NamespaceController.class);
70. 
71.   private final ApplicationEventPublisher publisher;
72.   private final UserInfoHolder userInfoHolder;
73.   private final NamespaceService namespaceService;
74.   private final AppNamespaceService appNamespaceService;
75.   private final RoleInitializationService roleInitializationService;
76.   private final PortalConfig portalConfig;
77.   private final PermissionValidator permissionValidator;
78.   private final AdminServiceAPI.NamespaceAPI namespaceAPI;
79. 
80.   public NamespaceController(
81.       final ApplicationEventPublisher publisher,
82.       final UserInfoHolder userInfoHolder,
83.       final NamespaceService namespaceService,
84.       final AppNamespaceService appNamespaceService,
85.       final RoleInitializationService roleInitializationService,
86.       final PortalConfig portalConfig,
87.       final PermissionValidator permissionValidator,
88.       final AdminServiceAPI.NamespaceAPI namespaceAPI) {
89.     this.publisher = publisher;
90.     this.userInfoHolder = userInfoHolder;
91.     this.namespaceService = namespaceService;
92.     this.appNamespaceService = appNamespaceService;
93.     this.roleInitializationService = roleInitializationService;
94.     this.portalConfig = portalConfig;
95.     this.permissionValidator = permissionValidator;
96.     this.namespaceAPI = namespaceAPI;
97.   }
98. 
99. 
100.   @GetMapping("/appnamespaces/public")
101.   public List<AppNamespace> findPublicAppNamespaces() {
102.     return appNamespaceService.findPublicAppNamespaces();
103.   }
104. 
105.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces")
106.   public List<NamespaceBO> findNamespaces(@PathVariable String appId, @PathVariable String env,
107.                                           @PathVariable String clusterName) {
108. 
109.     List<NamespaceBO> namespaceBOs = namespaceService.findNamespaceBOs(appId, Env.valueOf(env), clusterName);
110. 
111.     for (NamespaceBO namespaceBO : namespaceBOs) {
112.       if (permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceBO.getBaseInfo().getNamespaceName())) {
113.         namespaceBO.hideItems();
114.       }
115.     }
116. 
117.     return namespaceBOs;
118.   }
119. 
120.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
121.   public NamespaceBO findNamespace(@PathVariable String appId, @PathVariable String env,
122.                                    @PathVariable String clusterName, @PathVariable String namespaceName) {
123. 
124.     NamespaceBO namespaceBO = namespaceService.loadNamespaceBO(appId, Env.valueOf(env), clusterName, namespaceName);
125. 
126.     if (namespaceBO != null && permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceName)) {
127.       namespaceBO.hideItems();
128.     }
129. 
130.     return namespaceBO;
131.   }
132. 
133.   @GetMapping("/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/associated-public-namespace")
134.   public NamespaceBO findPublicNamespaceForAssociatedNamespace(@PathVariable String env,
135.                                                                @PathVariable String appId,
136.                                                                @PathVariable String namespaceName,
137.                                                                @PathVariable String clusterName) {
138. 
139.     return namespaceService.findPublicNamespaceForAssociatedNamespace(Env.valueOf(env), appId, clusterName, namespaceName);
140.   }
141. 
142.   @PreAuthorize(value = "@permissionValidator.hasCreateNamespacePermission(#appId)")
143.   @PostMapping("/apps/{appId}/namespaces")
144.   public ResponseEntity<Void> createNamespace(@PathVariable String appId,
145.                                               @RequestBody List<NamespaceCreationModel> models) {
146. 
147.     checkModel(!CollectionUtils.isEmpty(models));
148.     String operator = userInfoHolder.getUser().getUserId();
149. 
150.     for (NamespaceCreationModel model : models) {
151.       String namespaceName = model.getNamespace().getNamespaceName();
152.       roleInitializationService.initNamespaceRoles(appId, namespaceName, operator);
153.       roleInitializationService.initNamespaceEnvRoles(appId, namespaceName, operator);
154.       NamespaceDTO namespace = model.getNamespace();
155.       RequestPrecondition.checkArgumentsNotEmpty(model.getEnv(), namespace.getAppId(),
156.                                                  namespace.getClusterName(), namespace.getNamespaceName());
157. 
158.       try {
159.         namespaceService.createNamespace(Env.valueOf(model.getEnv()), namespace);
160.       } catch (Exception e) {
161.         logger.error("create namespace fail.", e);
162.         Tracer.logError(
163.                 String.format("create namespace fail. (env=%s namespace=%s)", model.getEnv(),
164.                         namespace.getNamespaceName()), e);
165.       }
166.       namespaceService.assignNamespaceRoleToOperator(appId, namespaceName,userInfoHolder.getUser().getUserId());
167.     }
168. 
169.     return ResponseEntity.ok().build();
170.   }
171. 
172.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
173.   @DeleteMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName:.+}")
174.   public ResponseEntity<Void> deleteLinkedNamespace(@PathVariable String appId, @PathVariable String env,
175.       @PathVariable String clusterName, @PathVariable String namespaceName) {
176. 
177.     namespaceService.deleteNamespace(appId, Env.valueOf(env), clusterName, namespaceName);
178. 
179.     return ResponseEntity.ok().build();
180.   }
181. 
182.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName}/usage")
183.   public List<NamespaceUsage> findLinkedNamespaceUsage(@PathVariable String appId, @PathVariable String env,
184.       @PathVariable String clusterName, @PathVariable String namespaceName) {
185.     NamespaceUsage usage = namespaceService.getNamespaceUsageByEnv(appId, namespaceName, Env.valueOf(env), clusterName);
186.     return Lists.newArrayList(usage);
187.   }
188. 
189.   @GetMapping("/apps/{appId}/namespaces/{namespaceName}/usage")
190.   public List<NamespaceUsage> findNamespaceUsage(@PathVariable String appId, @PathVariable String namespaceName) {
191.     return namespaceService.getNamespaceUsageByAppId(appId, namespaceName);
192.   }
193. 
194.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
195.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
196.   public ResponseEntity<Void> deleteAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
197. 
198.     AppNamespace appNamespace = appNamespaceService.deleteAppNamespace(appId, namespaceName);
199. 
200.     publisher.publishEvent(new AppNamespaceDeletionEvent(appNamespace));
201. 
202.     return ResponseEntity.ok().build();
203.   }
204. 
205.   @GetMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
206.   public AppNamespaceDTO findAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
207.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);
208. 
209.     if (appNamespace == null) {
210.       throw new BadRequestException(
211.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));
212.     }
213. 
214.     return BeanUtils.transform(AppNamespaceDTO.class, appNamespace);
215.   }
216. 
217.   @PreAuthorize(value = "@permissionValidator.hasCreateAppNamespacePermission(#appId, #appNamespace)")
218.   @PostMapping("/apps/{appId}/appnamespaces")
219.   public AppNamespace createAppNamespace(@PathVariable String appId,
220.       @RequestParam(defaultValue = "true") boolean appendNamespacePrefix,
221.       @Valid @RequestBody AppNamespace appNamespace) {
222.     if (!InputValidator.isValidAppNamespace(appNamespace.getName())) {
223.       throw new BadRequestException(String.format("Invalid Namespace format: %s",
224.           InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
225.     }
226. 
227.     AppNamespace createdAppNamespace = appNamespaceService.createAppNamespaceInLocal(appNamespace, appendNamespacePrefix);
228. 
229.     if (portalConfig.canAppAdminCreatePrivateNamespace() || createdAppNamespace.isPublic()) {
230.       namespaceService.assignNamespaceRoleToOperator(appId, appNamespace.getName(),
231.           userInfoHolder.getUser().getUserId());
232.     }
233. 
234.     publisher.publishEvent(new AppNamespaceCreationEvent(createdAppNamespace));
235. 
236.     return createdAppNamespace;
237.   }
238. 
239.   /**
240.    * env -> cluster -> cluster has not published namespace?
241.    * Example:
242.    * dev ->
243.    *  default -> true   (default cluster has not published namespace)
244.    *  customCluster -> false (customCluster cluster's all namespaces had published)
245.    */
246.   @GetMapping("/apps/{appId}/namespaces/publish_info")
247.   public Map<String, Map<String, Boolean>> getNamespacesPublishInfo(@PathVariable String appId) {
248.     return namespaceService.getNamespacesPublishInfo(appId);
249.   }
250. 
251.   @GetMapping("/envs/{env}/appnamespaces/{publicNamespaceName}/namespaces")
252.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(@PathVariable String env,
253.                                                                @PathVariable String publicNamespaceName,
254.                                                                @RequestParam(name = "page", defaultValue = "0") int page,
255.                                                                @RequestParam(name = "size", defaultValue = "10") int size) {
256. 
257.     return namespaceService.getPublicAppNamespaceAllNamespaces(Env.valueOf(env), publicNamespaceName, page, size);
258. 
259.   }
260. 
261.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/missing-namespaces")
262.   public MultiResponseEntity<String> findMissingNamespaces(@PathVariable String appId, @PathVariable String env, @PathVariable String clusterName) {
263. 
264.     MultiResponseEntity<String> response = MultiResponseEntity.ok();
265. 
266.     Set<String> missingNamespaces = findMissingNamespaceNames(appId, env, clusterName);
267. 
268.     for (String missingNamespace : missingNamespaces) {
269.       response.addResponseEntity(RichResponseEntity.ok(missingNamespace));
270.     }
271. 
272.     return response;
273.   }
274. 
275.   @PostMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/missing-namespaces")
276.   public ResponseEntity<Void> createMissingNamespaces(@PathVariable String appId, @PathVariable String env, @PathVariable String clusterName) {
277. 
278.     Set<String> missingNamespaces = findMissingNamespaceNames(appId, env, clusterName);
279. 
280.     for (String missingNamespace : missingNamespaces) {
281.       namespaceAPI.createMissingAppNamespace(Env.valueOf(env), findAppNamespace(appId, missingNamespace));
282.     }
283. 
284.     return ResponseEntity.ok().build();
285.   }
286. 
287.   private Set<String> findMissingNamespaceNames(String appId, String env, String clusterName) {
288.     List<AppNamespaceDTO> configDbAppNamespaces = namespaceAPI.getAppNamespaces(appId, Env.valueOf(env));
289.     List<NamespaceDTO> configDbNamespaces = namespaceService.findNamespaces(appId, Env.valueOf(env), clusterName);
290.     List<AppNamespace> portalDbAppNamespaces = appNamespaceService.findByAppId(appId);
291. 
292.     Set<String> configDbAppNamespaceNames = configDbAppNamespaces.stream().map(AppNamespaceDTO::getName)
293.             .collect(Collectors.toSet());
294.     Set<String> configDbNamespaceNames = configDbNamespaces.stream().map(NamespaceDTO::getNamespaceName)
295.         .collect(Collectors.toSet());
296. 
297.     Set<String> portalDbAllAppNamespaceNames = Sets.newHashSet();
298.     Set<String> portalDbPrivateAppNamespaceNames = Sets.newHashSet();
299. 
300.     for (AppNamespace appNamespace : portalDbAppNamespaces) {
301.       portalDbAllAppNamespaceNames.add(appNamespace.getName());
302.       if (!appNamespace.isPublic()) {
303.         portalDbPrivateAppNamespaceNames.add(appNamespace.getName());
304.       }
305.     }
306. 
307.     // AppNamespaces should be the same
308.     Set<String> missingAppNamespaceNames = Sets.difference(portalDbAllAppNamespaceNames, configDbAppNamespaceNames);
309.     // Private namespaces should all exist
310.     Set<String> missingNamespaceNames = Sets.difference(portalDbPrivateAppNamespaceNames, configDbNamespaceNames);
311. 
312.     return Sets.union(missingAppNamespaceNames, missingNamespaceNames);
313.   }
314. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/entity/bo/NamespaceBO.java
Line number range: 1 - 103
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.entity.bo;
18. 
19. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
20. 
21. import java.util.List;
22. 
23. public class NamespaceBO {
24.   private NamespaceDTO baseInfo;
25.   private int itemModifiedCnt;
26.   private List<ItemBO> items;
27.   private String format;
28.   private boolean isPublic;
29.   private String parentAppId;
30.   private String comment;
31.   // is the configs hidden to current user?
32.   private boolean isConfigHidden;
33. 
34.   public NamespaceDTO getBaseInfo() {
35.     return baseInfo;
36.   }
37. 
38.   public void setBaseInfo(NamespaceDTO baseInfo) {
39.     this.baseInfo = baseInfo;
40.   }
41. 
42.   public int getItemModifiedCnt() {
43.     return itemModifiedCnt;
44.   }
45. 
46.   public void setItemModifiedCnt(int itemModifiedCnt) {
47.     this.itemModifiedCnt = itemModifiedCnt;
48.   }
49. 
50.   public List<ItemBO> getItems() {
51.     return items;
52.   }
53. 
54.   public void setItems(List<ItemBO> items) {
55.     this.items = items;
56.   }
57. 
58.   public String getFormat() {
59.     return format;
60.   }
61. 
62.   public void setFormat(String format) {
63.     this.format = format;
64.   }
65. 
66.   public boolean isPublic() {
67.     return isPublic;
68.   }
69. 
70.   public void setPublic(boolean aPublic) {
71.     isPublic = aPublic;
72.   }
73. 
74.   public String getParentAppId() {
75.     return parentAppId;
76.   }
77. 
78.   public void setParentAppId(String parentAppId) {
79.     this.parentAppId = parentAppId;
80.   }
81. 
82.   public String getComment() {
83.     return comment;
84.   }
85. 
86.   public void setComment(String comment) {
87.     this.comment = comment;
88.   }
89. 
90.   public boolean isConfigHidden() {
91.     return isConfigHidden;
92.   }
93. 
94.   public void setConfigHidden(boolean hidden) {
95.     isConfigHidden = hidden;
96.   }
97. 
98.   public void hideItems() {
99.     setConfigHidden(true);
100.     items.clear();
101.     setItemModifiedCnt(0);
102.   }
103. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 1 - 258
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.entity.App;
20. import com.ctrip.framework.apollo.common.entity.AppNamespace;
21. import com.ctrip.framework.apollo.common.exception.BadRequestException;
22. import com.ctrip.framework.apollo.core.ConfigConsts;
23. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
24. import com.ctrip.framework.apollo.core.utils.StringUtils;
25. import com.ctrip.framework.apollo.portal.repository.AppNamespaceRepository;
26. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
27. import com.google.common.base.Joiner;
28. import com.google.common.collect.Lists;
29. import com.google.common.collect.Sets;
30. import java.util.List;
31. import java.util.Objects;
32. import java.util.Set;
33. import org.springframework.context.annotation.Lazy;
34. import org.springframework.stereotype.Service;
35. import org.springframework.transaction.annotation.Transactional;
36. import org.springframework.util.CollectionUtils;
37. 
38. @Service
39. public class AppNamespaceService {
40. 
41.   private static final int PRIVATE_APP_NAMESPACE_NOTIFICATION_COUNT = 5;
42.   private static final Joiner APP_NAMESPACE_JOINER = Joiner.on(",").skipNulls();
43. 
44.   private final UserInfoHolder userInfoHolder;
45.   private final AppNamespaceRepository appNamespaceRepository;
46.   private final RoleInitializationService roleInitializationService;
47.   private final AppService appService;
48.   private final RolePermissionService rolePermissionService;
49. 
50.   public AppNamespaceService(
51.       final UserInfoHolder userInfoHolder,
52.       final AppNamespaceRepository appNamespaceRepository,
53.       final RoleInitializationService roleInitializationService,
54.       final @Lazy AppService appService,
55.       final RolePermissionService rolePermissionService) {
56.     this.userInfoHolder = userInfoHolder;
57.     this.appNamespaceRepository = appNamespaceRepository;
58.     this.roleInitializationService = roleInitializationService;
59.     this.appService = appService;
60.     this.rolePermissionService = rolePermissionService;
61.   }
62. 
63.   /**
64.    * 公共的app ns,能被其它项目关联到的app ns
65.    */
66.   public List<AppNamespace> findPublicAppNamespaces() {
67.     return appNamespaceRepository.findByIsPublicTrue();
68.   }
69. 
70.   public AppNamespace findPublicAppNamespace(String namespaceName) {
71.     List<AppNamespace> appNamespaces = appNamespaceRepository.findByNameAndIsPublic(namespaceName, true);
72. 
73.     if (CollectionUtils.isEmpty(appNamespaces)) {
74.       return null;
75.     }
76. 
77.     return appNamespaces.get(0);
78.   }
79. 
80.   private List<AppNamespace> findAllPrivateAppNamespaces(String namespaceName) {
81.     return appNamespaceRepository.findByNameAndIsPublic(namespaceName, false);
82.   }
83. 
84.   public AppNamespace findByAppIdAndName(String appId, String namespaceName) {
85.     return appNamespaceRepository.findByAppIdAndName(appId, namespaceName);
86.   }
87. 
88.   public List<AppNamespace> findByAppId(String appId) {
89.     return appNamespaceRepository.findByAppId(appId);
90.   }
91. 
92.   public List<AppNamespace> findAll() {
93.     Iterable<AppNamespace> appNamespaces = appNamespaceRepository.findAll();
94.     return Lists.newArrayList(appNamespaces);
95.   }
96. 
97.   @Transactional
98.   public void createDefaultAppNamespace(String appId) {
99.     if (!isAppNamespaceNameUnique(appId, ConfigConsts.NAMESPACE_APPLICATION)) {
100.       throw new BadRequestException(String.format("App already has application namespace. AppId = %s", appId));
101.     }
102. 
103.     AppNamespace appNs = new AppNamespace();
104.     appNs.setAppId(appId);
105.     appNs.setName(ConfigConsts.NAMESPACE_APPLICATION);
106.     appNs.setComment("default app namespace");
107.     appNs.setFormat(ConfigFileFormat.Properties.getValue());
108.     String userId = userInfoHolder.getUser().getUserId();
109.     appNs.setDataChangeCreatedBy(userId);
110.     appNs.setDataChangeLastModifiedBy(userId);
111. 
112.     appNamespaceRepository.save(appNs);
113.   }
114. 
115.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {
116.     Objects.requireNonNull(appId, "AppId must not be null");
117.     Objects.requireNonNull(namespaceName, "Namespace must not be null");
118.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));
119.   }
120. 
121.   @Transactional
122.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace) {
123.     return createAppNamespaceInLocal(appNamespace, true);
124.   }
125. 
126.   @Transactional
127.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace, boolean appendNamespacePrefix) {
128.     String appId = appNamespace.getAppId();
129. 
130.     //add app org id as prefix
131.     App app = appService.load(appId);
132.     if (app == null) {
133.       throw new BadRequestException("App not exist. AppId = " + appId);
134.     }
135. 
136.     StringBuilder appNamespaceName = new StringBuilder();
137.     //add prefix postfix
138.     appNamespaceName
139.         .append(appNamespace.isPublic() && appendNamespacePrefix ? app.getOrgId() + "." : "")
140.         .append(appNamespace.getName())
141.         .append(appNamespace.formatAsEnum() == ConfigFileFormat.Properties ? "" : "." + appNamespace.getFormat());
142.     appNamespace.setName(appNamespaceName.toString());
143. 
144.     if (appNamespace.getComment() == null) {
145.       appNamespace.setComment("");
146.     }
147. 
148.     if (!ConfigFileFormat.isValidFormat(appNamespace.getFormat())) {
149.      throw new BadRequestException("Invalid namespace format. format must be properties、json、yaml、yml、xml");
150.     }
151. 
152.     String operator = appNamespace.getDataChangeCreatedBy();
153.     if (StringUtils.isEmpty(operator)) {
154.       operator = userInfoHolder.getUser().getUserId();
155.       appNamespace.setDataChangeCreatedBy(operator);
156.     }
157. 
158.     appNamespace.setDataChangeLastModifiedBy(operator);
159. 
160.     // globally uniqueness check for public app namespace
161.     if (appNamespace.isPublic()) {
162.       checkAppNamespaceGlobalUniqueness(appNamespace);
163.     } else {
164.       // check private app namespace
165.       if (appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName()) != null) {
166.         throw new BadRequestException("Private AppNamespace " + appNamespace.getName() + " already exists!");
167.       }
168.       // should not have the same with public app namespace
169.       checkPublicAppNamespaceGlobalUniqueness(appNamespace);
170.     }
171. 
172.     AppNamespace createdAppNamespace = appNamespaceRepository.save(appNamespace);
173. 
174.     roleInitializationService.initNamespaceRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
175.     roleInitializationService.initNamespaceEnvRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
176. 
177.     return createdAppNamespace;
178.   }
179. 
180.   @Transactional
181.   public AppNamespace importAppNamespaceInLocal(AppNamespace appNamespace) {
182.     // globally uniqueness check for public app namespace
183.     if (appNamespace.isPublic()) {
184.       checkAppNamespaceGlobalUniqueness(appNamespace);
185.     } else {
186.       // check private app namespace
187.       if (appNamespaceRepository.findByAppIdAndName(appNamespace.getAppId(), appNamespace.getName()) != null) {
188.         throw new BadRequestException("Private AppNamespace " + appNamespace.getName() + " already exists!");
189.       }
190.       // should not have the same with public app namespace
191.       checkPublicAppNamespaceGlobalUniqueness(appNamespace);
192.     }
193. 
194.     AppNamespace createdAppNamespace = appNamespaceRepository.save(appNamespace);
195. 
196.     String operator = appNamespace.getDataChangeCreatedBy();
197. 
198.     roleInitializationService.initNamespaceRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
199.     roleInitializationService.initNamespaceEnvRoles(appNamespace.getAppId(), appNamespace.getName(), operator);
200. 
201.     return createdAppNamespace;
202.   }
203. 
204.   private void checkAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {
205.     checkPublicAppNamespaceGlobalUniqueness(appNamespace);
206. 
207.     List<AppNamespace> privateAppNamespaces = findAllPrivateAppNamespaces(appNamespace.getName());
208. 
209.     if (!CollectionUtils.isEmpty(privateAppNamespaces)) {
210.       Set<String> appIds = Sets.newHashSet();
211.       for (AppNamespace ans : privateAppNamespaces) {
212.         appIds.add(ans.getAppId());
213.         if (appIds.size() == PRIVATE_APP_NAMESPACE_NOTIFICATION_COUNT) {
214.           break;
215.         }
216.       }
217. 
218.       throw new BadRequestException(
219.           "Public AppNamespace " + appNamespace.getName() + " already exists as private AppNamespace in appId: "
220.               + APP_NAMESPACE_JOINER.join(appIds) + ", etc. Please select another name!");
221.     }
222.   }
223. 
224.   private void checkPublicAppNamespaceGlobalUniqueness(AppNamespace appNamespace) {
225.     AppNamespace publicAppNamespace = findPublicAppNamespace(appNamespace.getName());
226.     if (publicAppNamespace != null) {
227.       throw new BadRequestException("AppNamespace " + appNamespace.getName() + " already exists as public namespace in appId: " + publicAppNamespace.getAppId() + "!");
228.     }
229.   }
230. 
231. 
232.   @Transactional
233.   public AppNamespace deleteAppNamespace(String appId, String namespaceName) {
234.     AppNamespace appNamespace = appNamespaceRepository.findByAppIdAndName(appId, namespaceName);
235.     if (appNamespace == null) {
236.       throw new BadRequestException(
237.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));
238.     }
239. 
240.     String operator = userInfoHolder.getUser().getUserId();
241. 
242.     // this operator is passed to com.ctrip.framework.apollo.portal.listener.DeletionListener.onAppNamespaceDeletionEvent
243.     appNamespace.setDataChangeLastModifiedBy(operator);
244. 
245.     // delete app namespace in portal db
246.     appNamespaceRepository.delete(appId, namespaceName, operator);
247. 
248.     // delete Permission and Role related data
249.     rolePermissionService.deleteRolePermissionsByAppIdAndNamespace(appId, namespaceName, operator);
250. 
251.     return appNamespace;
252.   }
253. 
254.   public void batchDeleteByAppId(String appId, String operator) {
255.     appNamespaceRepository.batchDeleteByAppId(appId, operator);
256.   }
257. 
258. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 1 - 423
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.constants.GsonType;
20. import com.ctrip.framework.apollo.common.dto.ClusterDTO;
21. import com.ctrip.framework.apollo.common.dto.ItemDTO;
22. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
23. import com.ctrip.framework.apollo.common.dto.PageDTO;
24. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
25. import com.ctrip.framework.apollo.common.entity.AppNamespace;
26. import com.ctrip.framework.apollo.common.exception.BadRequestException;
27. import com.ctrip.framework.apollo.common.utils.BeanUtils;
28. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
29. import com.ctrip.framework.apollo.core.utils.ApolloThreadFactory;
30. import com.ctrip.framework.apollo.core.utils.StringUtils;
31. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
32. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI.NamespaceAPI;
33. import com.ctrip.framework.apollo.portal.component.PortalSettings;
34. import com.ctrip.framework.apollo.portal.component.config.PortalConfig;
35. import com.ctrip.framework.apollo.portal.constant.RoleType;
36. import com.ctrip.framework.apollo.portal.constant.TracerEventType;
37. import com.ctrip.framework.apollo.portal.enricher.adapter.BaseDtoUserInfoEnrichedAdapter;
38. import com.ctrip.framework.apollo.portal.entity.bo.ItemBO;
39. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
40. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
41. import com.ctrip.framework.apollo.portal.environment.Env;
42. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
43. import com.ctrip.framework.apollo.portal.util.RoleUtils;
44. import com.ctrip.framework.apollo.tracer.Tracer;
45. import com.google.common.collect.Maps;
46. import com.google.common.collect.Sets;
47. import com.google.gson.Gson;
48. import java.util.ArrayList;
49. import java.util.Collections;
50. import java.util.Comparator;
51. import java.util.HashMap;
52. import java.util.LinkedList;
53. import java.util.List;
54. import java.util.Map;
55. import java.util.Set;
56. import java.util.concurrent.CountDownLatch;
57. import java.util.concurrent.ExecutorService;
58. import java.util.concurrent.Executors;
59. import java.util.stream.Collectors;
60. import org.slf4j.Logger;
61. import org.slf4j.LoggerFactory;
62. import org.springframework.context.annotation.Lazy;
63. import org.springframework.data.domain.Pageable;
64. import org.springframework.stereotype.Service;
65. import org.springframework.transaction.annotation.Transactional;
66. 
67. @Service
68. public class NamespaceService {
69. 
70.   private static final Logger LOGGER = LoggerFactory.getLogger(NamespaceService.class);
71.   private static final Gson GSON = new Gson();
72.   private static final ExecutorService executorService = Executors.newFixedThreadPool(
73.       Runtime.getRuntime().availableProcessors() * 2
74.       , ApolloThreadFactory.create("NamespaceService", true));
75. 
76.   private final PortalConfig portalConfig;
77.   private final PortalSettings portalSettings;
78.   private final UserInfoHolder userInfoHolder;
79.   private final AdminServiceAPI.NamespaceAPI namespaceAPI;
80.   private final ItemService itemService;
81.   private final ReleaseService releaseService;
82.   private final AppNamespaceService appNamespaceService;
83.   private final InstanceService instanceService;
84.   private final NamespaceBranchService branchService;
85.   private final RolePermissionService rolePermissionService;
86.   private final AdditionalUserInfoEnrichService additionalUserInfoEnrichService;
87.   private final ClusterService clusterService;
88. 
89.   public NamespaceService(
90.       final PortalConfig portalConfig,
91.       final PortalSettings portalSettings,
92.       final UserInfoHolder userInfoHolder,
93.       final NamespaceAPI namespaceAPI,
94.       final ItemService itemService,
95.       final ReleaseService releaseService,
96.       final AppNamespaceService appNamespaceService,
97.       final InstanceService instanceService,
98.       final @Lazy NamespaceBranchService branchService,
99.       final RolePermissionService rolePermissionService,
100.       final AdditionalUserInfoEnrichService additionalUserInfoEnrichService,
101.       ClusterService clusterService) {
102.     this.portalConfig = portalConfig;
103.     this.portalSettings = portalSettings;
104.     this.userInfoHolder = userInfoHolder;
105.     this.namespaceAPI = namespaceAPI;
106.     this.itemService = itemService;
107.     this.releaseService = releaseService;
108.     this.appNamespaceService = appNamespaceService;
109.     this.instanceService = instanceService;
110.     this.branchService = branchService;
111.     this.rolePermissionService = rolePermissionService;
112.     this.additionalUserInfoEnrichService = additionalUserInfoEnrichService;
113.     this.clusterService = clusterService;
114.   }
115. 
116. 
117.   public NamespaceDTO createNamespace(Env env, NamespaceDTO namespace) {
118.     if (StringUtils.isEmpty(namespace.getDataChangeCreatedBy())) {
119.       namespace.setDataChangeCreatedBy(userInfoHolder.getUser().getUserId());
120.     }
121. 
122.     if (StringUtils.isEmpty(namespace.getDataChangeLastModifiedBy())) {
123.       namespace.setDataChangeLastModifiedBy(userInfoHolder.getUser().getUserId());
124.     }
125.     NamespaceDTO createdNamespace = namespaceAPI.createNamespace(env, namespace);
126. 
127.     Tracer.logEvent(TracerEventType.CREATE_NAMESPACE,
128.         String.format("%s+%s+%s+%s", namespace.getAppId(), env, namespace.getClusterName(),
129.             namespace.getNamespaceName()));
130.     return createdNamespace;
131.   }
132. 
133. 
134.   public List<NamespaceUsage> getNamespaceUsageByAppId(String appId, String namespaceName) {
135.     List<Env> envs = portalSettings.getActiveEnvs();
136.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);
137.     List<NamespaceUsage> usages = new ArrayList<>();
138.     for (Env env : envs) {
139.       List<ClusterDTO> clusters = clusterService.findClusters(env, appId);
140.       for (ClusterDTO cluster : clusters) {
141.         String clusterName = cluster.getName();
142.         NamespaceUsage usage = this.getNamespaceUsageByEnv(appId, namespaceName, env, clusterName);
143.         if (appNamespace != null && appNamespace.isPublic()) {
144.           int associatedNamespace = this.getPublicAppNamespaceHasAssociatedNamespace(namespaceName, env);
145.           usage.setLinkedNamespaceCount(associatedNamespace);
146.         }
147. 
148.         if(usage.getLinkedNamespaceCount() > 0 || usage.getBranchInstanceCount() > 0 || usage.getInstanceCount() > 0) {
149.           usages.add(usage);
150.         }
151.       }
152.     }
153.     return usages;
154.   }
155. 
156.   public NamespaceUsage getNamespaceUsageByEnv(String appId, String namespaceName, Env env, String clusterName) {
157.     NamespaceUsage namespaceUsage = new NamespaceUsage(namespaceName, appId, clusterName, env.getName());
158.     int instanceCount = instanceService.getInstanceCountByNamespace(appId, env, clusterName, namespaceName);
159.     namespaceUsage.setInstanceCount(instanceCount);
160. 
161.     NamespaceDTO branchNamespace = branchService.findBranchBaseInfo(appId, env, clusterName, namespaceName);
162.     if(branchNamespace != null){
163.       String branchClusterName = branchNamespace.getClusterName();
164.       int branchInstanceCount = instanceService.getInstanceCountByNamespace(appId, env, branchClusterName, namespaceName);
165.       namespaceUsage.setBranchInstanceCount(branchInstanceCount);
166.     }
167.     return namespaceUsage;
168.   }
169. 
170.   @Transactional
171.   public void deleteNamespace(String appId, Env env, String clusterName, String namespaceName) {
172. 
173.     String operator = userInfoHolder.getUser().getUserId();
174.     namespaceAPI.deleteNamespace(env, appId, clusterName, namespaceName, operator);
175.   }
176. 
177.   public NamespaceDTO loadNamespaceBaseInfo(String appId, Env env, String clusterName,
178.       String namespaceName) {
179.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
180.     if (namespace == null) {
181.       throw new BadRequestException(String.format("Namespace: %s not exist.", namespaceName));
182.     }
183.     return namespace;
184.   }
185. 
186.   /**
187.    * load cluster all namespace info with items
188.    */
189.   public List<NamespaceBO> findNamespaceBOs(String appId, Env env, String clusterName) {
190. 
191.     List<NamespaceDTO> namespaces = namespaceAPI.findNamespaceByCluster(appId, env, clusterName);
192.     if (namespaces == null || namespaces.size() == 0) {
193.       throw new BadRequestException("namespaces not exist");
194.     }
195. 
196.     List<NamespaceBO> namespaceBOs = Collections.synchronizedList(new LinkedList<>());
197.     List<String> exceptionNamespaces = Collections.synchronizedList(new LinkedList<>());
198.     CountDownLatch latch = new CountDownLatch(namespaces.size());
199.     for (NamespaceDTO namespace : namespaces) {
200.       executorService.submit(() -> {
201.         NamespaceBO namespaceBO;
202.         try {
203.           namespaceBO = transformNamespace2BO(env, namespace);
204.           namespaceBOs.add(namespaceBO);
205.         } catch (Exception e) {
206.           LOGGER.error("parse namespace error. app id:{}, env:{}, clusterName:{}, namespace:{}",
207.               appId, env, clusterName, namespace.getNamespaceName(), e);
208.           exceptionNamespaces.add(namespace.getNamespaceName());
209.         } finally {
210.           latch.countDown();
211.         }
212.       });
213. 
214.     }
215.     try {
216.       latch.await();
217.     } catch (InterruptedException e) {
218.       //ignore
219.     }
220. 
221.     if(namespaceBOs.size() != namespaces.size()){
222.        throw new RuntimeException(String
223.            .format("Parse namespaces error, expected: %s, but actual: %s, cannot get those namespaces: %s", namespaces.size(), namespaceBOs.size(), exceptionNamespaces));
224.     }
225. 
226.     return namespaceBOs.stream()
227.         .sorted(Comparator.comparing(o -> o.getBaseInfo().getId()))
228.         .collect(Collectors.toList());
229.   }
230. 
231.   public List<NamespaceDTO> findNamespaces(String appId, Env env, String clusterName) {
232.     return namespaceAPI.findNamespaceByCluster(appId, env, clusterName);
233.   }
234. 
235.   /**
236.    * the returned content's size is not fixed. so please carefully used.
237.    */
238.   public PageDTO<NamespaceDTO> findNamespacesByItem(Env env, String itemKey, Pageable pageable) {
239.     return namespaceAPI.findByItem(env, itemKey, pageable.getPageNumber(), pageable.getPageSize());
240.   }
241. 
242.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(Env env, String publicNamespaceName,
243.       int page,
244.       int size) {
245.     return namespaceAPI.getPublicAppNamespaceAllNamespaces(env, publicNamespaceName, page, size);
246.   }
247. 
248.   public NamespaceBO loadNamespaceBO(String appId, Env env, String clusterName,
249.       String namespaceName) {
250.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
251.     if (namespace == null) {
252.       throw new BadRequestException("namespaces not exist");
253.     }
254.     return transformNamespace2BO(env, namespace);
255.   }
256. 
257.   public boolean publicAppNamespaceHasAssociatedNamespace(String publicNamespaceName, Env env) {
258.     return getPublicAppNamespaceHasAssociatedNamespace(publicNamespaceName, env) > 0;
259.   }
260. 
261.   public int getPublicAppNamespaceHasAssociatedNamespace(String publicNamespaceName, Env env) {
262.     return namespaceAPI.countPublicAppNamespaceAssociatedNamespaces(env, publicNamespaceName);
263.   }
264. 
265.   public NamespaceBO findPublicNamespaceForAssociatedNamespace(Env env, String appId,
266.       String clusterName, String namespaceName) {
267.     NamespaceDTO namespace =
268.         namespaceAPI
269.             .findPublicNamespaceForAssociatedNamespace(env, appId, clusterName, namespaceName);
270. 
271.     return transformNamespace2BO(env, namespace);
272.   }
273. 
274.   public Map<String, Map<String, Boolean>> getNamespacesPublishInfo(String appId) {
275.     Map<String, Map<String, Boolean>> result = Maps.newHashMap();
276. 
277.     Set<Env> envs = portalConfig.publishTipsSupportedEnvs();
278.     for (Env env : envs) {
279.       if (portalSettings.isEnvActive(env)) {
280.         result.put(env.toString(), namespaceAPI.getNamespacePublishInfo(env, appId));
281.       }
282.     }
283. 
284.     return result;
285.   }
286. 
287.   private NamespaceBO transformNamespace2BO(Env env, NamespaceDTO namespace) {
288.     NamespaceBO namespaceBO = new NamespaceBO();
289.     namespaceBO.setBaseInfo(namespace);
290. 
291.     String appId = namespace.getAppId();
292.     String clusterName = namespace.getClusterName();
293.     String namespaceName = namespace.getNamespaceName();
294. 
295.     fillAppNamespaceProperties(namespaceBO);
296. 
297.     List<ItemBO> itemBOs = new LinkedList<>();
298.     namespaceBO.setItems(itemBOs);
299. 
300.     //latest Release
301.     ReleaseDTO latestRelease;
302.     Map<String, String> releaseItems = new HashMap<>();
303.     Map<String, ItemDTO> deletedItemDTOs = new HashMap<>();
304.     latestRelease = releaseService.loadLatestRelease(appId, env, clusterName, namespaceName);
305.     if (latestRelease != null) {
306.       releaseItems = GSON.fromJson(latestRelease.getConfigurations(), GsonType.CONFIG);
307.     }
308. 
309.     //not Release config items
310.     List<ItemDTO> items = itemService.findItems(appId, env, clusterName, namespaceName);
311.     additionalUserInfoEnrichService
312.         .enrichAdditionalUserInfo(items, BaseDtoUserInfoEnrichedAdapter::new);
313.     int modifiedItemCnt = 0;
314.     for (ItemDTO itemDTO : items) {
315. 
316.       ItemBO itemBO = transformItem2BO(itemDTO, releaseItems);
317. 
318.       if (itemBO.isModified()) {
319.         modifiedItemCnt++;
320.       }
321. 
322.       itemBOs.add(itemBO);
323.     }
324. 
325.     //deleted items
326.     itemService.findDeletedItems(appId, env, clusterName, namespaceName).forEach(item -> {
327.       deletedItemDTOs.put(item.getKey(),item);
328.     });
329. 
330.     List<ItemBO> deletedItems = parseDeletedItems(items, releaseItems, deletedItemDTOs);
331.     itemBOs.addAll(deletedItems);
332.     modifiedItemCnt += deletedItems.size();
333. 
334.     namespaceBO.setItemModifiedCnt(modifiedItemCnt);
335. 
336.     return namespaceBO;
337.   }
338. 
339.   private void fillAppNamespaceProperties(NamespaceBO namespace) {
340. 
341.     final NamespaceDTO namespaceDTO = namespace.getBaseInfo();
342.     final String appId = namespaceDTO.getAppId();
343.     final String clusterName = namespaceDTO.getClusterName();
344.     final String namespaceName = namespaceDTO.getNamespaceName();
345.     //先从当前appId下面找,包含私有的和公共的
346.     AppNamespace appNamespace =
347.         appNamespaceService
348.             .findByAppIdAndName(appId, namespaceName);
349.     //再从公共的app namespace里面找
350.     if (appNamespace == null) {
351.       appNamespace = appNamespaceService.findPublicAppNamespace(namespaceName);
352.     }
353. 
354.     final String format;
355.     final boolean isPublic;
356.     if (appNamespace == null) {
357.       //dirty data
358.       LOGGER.warn("Dirty data, cannot find appNamespace by namespaceName [{}], appId = {}, cluster = {}, set it format to {}, make public", namespaceName, appId, clusterName, ConfigFileFormat.Properties.getValue());
359.       format = ConfigFileFormat.Properties.getValue();
360.       isPublic = true; // set to true, because public namespace allowed to delete by user
361.     } else {
362.       format = appNamespace.getFormat();
363.       isPublic = appNamespace.isPublic();
364.       namespace.setParentAppId(appNamespace.getAppId());
365.       namespace.setComment(appNamespace.getComment());
366.     }
367.     namespace.setFormat(format);
368.     namespace.setPublic(isPublic);
369.   }
370. 
371.   private List<ItemBO> parseDeletedItems(List<ItemDTO> newItems, Map<String, String> releaseItems, Map<String, ItemDTO> deletedItemDTOs) {
372.     Map<String, ItemDTO> newItemMap = BeanUtils.mapByKey("key", newItems);
373. 
374.     List<ItemBO> deletedItems = new LinkedList<>();
375.     for (Map.Entry<String, String> entry : releaseItems.entrySet()) {
376.       String key = entry.getKey();
377.       if (newItemMap.get(key) == null) {
378.         ItemBO deletedItem = new ItemBO();
379. 
380.         deletedItem.setDeleted(true);
381.         ItemDTO deletedItemDto = deletedItemDTOs.computeIfAbsent(key, k -> new ItemDTO());
382.         deletedItemDto.setKey(key);
383.         String oldValue = entry.getValue();
384.         deletedItem.setItem(deletedItemDto);
385. 
386.         deletedItemDto.setValue(oldValue);
387.         deletedItem.setModified(true);
388.         deletedItem.setOldValue(oldValue);
389.         deletedItem.setNewValue("");
390.         deletedItems.add(deletedItem);
391.       }
392.     }
393.     return deletedItems;
394.   }
395. 
396.   private ItemBO transformItem2BO(ItemDTO itemDTO, Map<String, String> releaseItems) {
397.     String key = itemDTO.getKey();
398.     ItemBO itemBO = new ItemBO();
399.     itemBO.setItem(itemDTO);
400.     String newValue = itemDTO.getValue();
401.     String oldValue = releaseItems.get(key);
402.     //new item or modified
403.     if (!StringUtils.isEmpty(key) && (!newValue.equals(oldValue))) {
404.       itemBO.setModified(true);
405.       itemBO.setOldValue(oldValue == null ? "" : oldValue);
406.       itemBO.setNewValue(newValue);
407.     }
408.     return itemBO;
409.   }
410. 
411.   public void assignNamespaceRoleToOperator(String appId, String namespaceName, String operator) {
412.     //default assign modify、release namespace role to namespace creator
413. 
414.     rolePermissionService
415.         .assignRoleToUsers(
416.             RoleUtils.buildNamespaceRoleName(appId, namespaceName, RoleType.MODIFY_NAMESPACE),
417.             Sets.newHashSet(operator), operator);
418.     rolePermissionService
419.         .assignRoleToUsers(
420.             RoleUtils.buildNamespaceRoleName(appId, namespaceName, RoleType.RELEASE_NAMESPACE),
421.             Sets.newHashSet(operator), operator);
422.   }
423. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 11:57:59,446 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning="Portal NamespaceController REST endpoint to load a specific namespace uses {namespaceName:.+}, which is critical to handling names with dots, including a single dot. Directly matches 'namespace REST endpoints' requirement.", relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=120, end_line=131), ContextOutput(reasoning='Portal NamespaceController DELETE linked namespace endpoint uses {namespaceName:.+}, relevant to dot handling in path variables and namespace REST endpoints.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=172, end_line=180), ContextOutput(reasoning='Portal NamespaceController DELETE app namespace endpoint with {namespaceName:.+}, relevant to REST endpoint handling of namespace names containing dots.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=194, end_line=203), ContextOutput(reasoning='Portal NamespaceController GET app namespace endpoint with {namespaceName:.+}, relevant to retrieving app namespace by name containing dots.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java', start_line=205, end_line=215), ContextOutput(reasoning='OpenAPI controller validates app namespace name with InputValidator and format with ConfigFileFormat. This is essential to understand validation allowing names like a single dot and format checking.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java', start_line=65, end_line=75), ContextOutput(reasoning='OpenAPI controller endpoint to load a specific namespace uses {namespaceName:.+}, ensuring dot-containing names are captured. Matches namespace REST endpoints requirement.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java', start_line=89, end_line=94), ContextOutput(reasoning="Portal AppNamespaceService constructs the stored namespace name, appending orgId prefix and file format suffix with a dot unless Properties. This implements name parsing/splitting by '.', critical for single dot cases.", relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', start_line=126, end_line=144), ContextOutput(reasoning='Portal AppNamespaceService validates the namespace format string via ConfigFileFormat.isValidFormat, relevant to file format handling.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', start_line=148, end_line=151), ContextOutput(reasoning='Portal AppNamespaceService finds public app namespace by name, part of namespace querying logic.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', start_line=70, end_line=78), ContextOutput(reasoning='Portal AppNamespaceService method to find AppNamespace by appId and name, core to namespace querying by name in portal.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java', start_line=84, end_line=86), ContextOutput(reasoning='Portal NamespaceService fills NamespaceBO properties by finding AppNamespace by name (first private within app, then public), deriving format and public flag. Critical to namespace querying and format handling.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', start_line=339, end_line=369), ContextOutput(reasoning='Portal NamespaceService transforms a NamespaceDTO to business object, loads latest release and items; illustrates item querying and usage of namespaceName throughout.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', start_line=287, end_line=337), ContextOutput(reasoning='Portal NamespaceService loads a single namespace base info by appId/cluster/namespaceName, throwing if not exists. Relevant to namespace retrieval by name.', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', start_line=177, end_line=184), ContextOutput(reasoning='ConfigService NamespaceUtil strips .properties suffix and normalizes namespace to canonical name based on app or public app namespaces. Essential namespace name parsing logic.', relative_path='apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java', start_line=35, end_line=42), ContextOutput(reasoning='ConfigService NamespaceUtil normalizeNamespace finds canonical namespace name through lookup; relevant to name normalization when dots and formats are involved.', relative_path='apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java', start_line=44, end_line=56), ContextOutput(reasoning="InputValidator constants and regex patterns define allowable namespace names (including '.') and disallow ending with certain extensions, plus validation methods. Directly addresses name validation allowing a single dot.", relative_path='apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java', start_line=26, end_line=47), ContextOutput(reasoning='ConfigFileFormat enum definitions of supported formats, relevant for suffix handling and format validation.', relative_path='apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java', start_line=38, end_line=41), ContextOutput(reasoning='ConfigFileFormat.fromString validates and maps string to enum, used throughout to validate format strings appended to namespace names.', relative_path='apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java', start_line=86, end_line=97), ContextOutput(reasoning='ConfigFileFormat.getValue returns string representation used when appending file format to namespace names.', relative_path='apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java', start_line=128, end_line=130), ContextOutput(reasoning='Biz Namespace entity definition contains namespaceName field, central to storage and querying by name.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java', start_line=28, end_line=75), ContextOutput(reasoning='AppNamespace entity defines validation using InputValidator and holds format; formatAsEnum method used when constructing names with suffix. Necessary since actual path differs (entity lives in common module).', relative_path='apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java', start_line=38, end_line=44), ContextOutput(reasoning='AppNamespace format and formatAsEnum getter/setter, used when constructing names and checking file format suffix.', relative_path='apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java', start_line=91, end_line=101), ContextOutput(reasoning='Biz NamespaceService.findOne retrieves namespace by appId, clusterName, and namespaceName, core lookup by name.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=104, end_line=107), ContextOutput(reasoning="Biz NamespaceService.findByItem uses ItemService.findItemsByKey and then loads Namespaces by ids; this is the 'namespace/item querying logic' asked.", relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=112, end_line=122), ContextOutput(reasoning='Biz NamespaceService.findPublicAppNamespaceAllNamespaces queries by namespaceName and filters children; illustrates repository findByNamespaceName usage.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=175, end_line=185), ContextOutput(reasoning='Biz NamespaceService.countPublicAppNamespaceAssociatedNamespaces uses countByNamespaceNameAndAppIdNot for associations; relevant querying by name.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=204, end_line=213), ContextOutput(reasoning='Biz NamespaceService.findNamespaces finds namespaces by appId and clusterName; returns empty if null; part of overall querying.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=215, end_line=221), ContextOutput(reasoning='Biz NamespaceService.findByAppIdAndNamespaceName returns list of namespaces for appId and namespaceName.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=223, end_line=225), ContextOutput(reasoning='Biz NamespaceService.isNamespaceUnique checks for uniqueness by querying repository with appId/cluster/namespace; important for creation logic.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=283, end_line=289), ContextOutput(reasoning='Biz AppNamespaceService.createAppNamespace saves AppNamespace then creates corresponding Namespaces across clusters; touches namespace names and creation flow.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', start_line=122, end_line=138), ContextOutput(reasoning='Biz AppNamespaceService.createNamespaceForAppNamespaceInAllCluster iterates clusters and creates Namespaces with setNamespaceName; relevant to how names propagate.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', start_line=151, end_line=169), ContextOutput(reasoning='Biz AppNamespaceService.findOne finds AppNamespace by appId and name; core to querying app namespaces by name.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', start_line=90, end_line=94), ContextOutput(reasoning='Biz AppNamespaceService.isAppNamespaceNameUnique checks uniqueness by appId and namespaceName; base validation.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', start_line=63, end_line=67), ContextOutput(reasoning='Biz AppNamespaceService.findPublicNamespaceByName finds public namespace by name; supports name normalization/querying.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java', start_line=69, end_line=72), ContextOutput(reasoning='Biz NamespaceRepository methods for querying by namespace name, appId, cluster and counting associations; directly used in services above.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java', start_line=31, end_line=47), ContextOutput(reasoning='Biz AppNamespaceRepository key query methods used in services to find by appId/name and by public flag.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java', start_line=31, end_line=41), ContextOutput(reasoning='Biz ItemRepository.findByKey supports querying namespaces by item key via service findByItem.', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/ItemRepository.java', start_line=40, end_line=41), ContextOutput(reasoning='AdminService NamespaceController delete endpoint and get by name endpoint use {namespaceName:.+} and NotFound handling, illustrating backend REST behavior with dot-containing names.', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java', start_line=65, end_line=76), ContextOutput(reasoning='AdminService NamespaceController findByItem REST endpoint maps to service.findByItem showing item-based namespace querying.', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java', start_line=97, end_line=104), ContextOutput(reasoning='AdminService NamespaceController get specific namespace endpoint uses {namespaceName:.+}, relevant to path handling and name lookup.', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java', start_line=106, end_line=116), ContextOutput(reasoning='AdminService AppNamespaceController delete endpoint uses {namespaceName:.+}, relevant for app namespace REST handling of dot-containing names.', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java', start_line=78, end_line=86), ContextOutput(reasoning='AdminService AppNamespaceController endpoints to find all namespaces of a public app namespace and count associations; showcases querying by namespace name.', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java', start_line=88, end_line=100)]
2025-11-12 11:57:59,463 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 42 contexts to memory for query: Please provide the full source of: (1) apollo-portal NamespaceController.java, AppNamespaceController.java, NamespaceService.java, AppNamespaceService.java, NamespaceBO.java, and any portal utility that parses namespace name/file format (e.g., NamespaceUtil); (2) apollo-biz AppNamespace.java, Namespace.java, AppNamespaceService.java, NamespaceService.java, and any related repository; (3) apollo-core ConfigFileFormat.java; and (4) apollo-common InputValidator.java.
2025-11-12 11:57:59,789 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 11:57:59,790 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 42 new contexts to 0 existing contexts
2025-11-12 11:57:59,792 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 42 total contexts (removed 0 duplicates)
2025-11-12 11:57:59,793 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full source of: (1) apollo-portal NamespaceController.java, AppNamespaceController.java, NamespaceService.java, AppNamespaceService.java, NamespaceBO.java, and any portal utility that parses namespace name/file format (e.g., NamespaceUtil); (2) apollo-biz AppNamespace.java, Namespace.java, AppNamespaceService.java, NamespaceService.java, and any related repository; (3) apollo-core ConfigFileFormat.java; and (4) apollo-common InputValidator.java.
Extra Requirements: If exact paths differ, share any classes that handle namespace REST endpoints, namespace name parsing/splitting by '.', and namespace/item querying logic.
Purpose: To trace namespace parsing and querying logic to reproduce and fix the 500 error when the namespace name is a single dot.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java
Line number range: 78 - 86
Content:
78.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
79.   public void delete(@PathVariable("appId") String appId, @PathVariable("namespaceName") String namespaceName,
80.       @RequestParam String operator) {
81.     AppNamespace entity = appNamespaceService.findOne(appId, namespaceName);
82.     if (entity == null) {
83.       throw new BadRequestException("app namespace not found for appId: " + appId + " namespace: " + namespaceName);
84.     }
85.     appNamespaceService.deleteAppNamespace(entity, operator);
86.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java
Line number range: 88 - 100
Content:
88.   @GetMapping("/appnamespaces/{publicNamespaceName}/namespaces")
89.   public List<NamespaceDTO> findPublicAppNamespaceAllNamespaces(@PathVariable String publicNamespaceName, Pageable pageable) {
90. 
91.     List<Namespace> namespaces = namespaceService.findPublicAppNamespaceAllNamespaces(publicNamespaceName, pageable);
92. 
93.     return BeanUtils.batchTransform(NamespaceDTO.class, namespaces);
94.   }
95. 
96.   @GetMapping("/appnamespaces/{publicNamespaceName}/associated-namespaces/count")
97.   public int countPublicAppNamespaceAssociatedNamespaces(@PathVariable String publicNamespaceName) {
98.     return namespaceService.countPublicAppNamespaceAssociatedNamespaces(publicNamespaceName);
99.   }
100. 


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java
Line number range: 65 - 76
Content:
65.   @DeleteMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
66.   public void delete(@PathVariable("appId") String appId,
67.                      @PathVariable("clusterName") String clusterName,
68.                      @PathVariable("namespaceName") String namespaceName, @RequestParam String operator) {
69.     Namespace entity = namespaceService.findOne(appId, clusterName, namespaceName);
70.     if (entity == null) {
71.       throw new NotFoundException("namespace not found for %s %s %s", appId, clusterName,
72.           namespaceName);
73.     }
74. 
75.     namespaceService.deleteNamespace(entity, operator);
76.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java
Line number range: 97 - 104
Content:
97.   @GetMapping("/namespaces/find-by-item")
98.   public PageDTO<NamespaceDTO> findByItem(@RequestParam String itemKey, Pageable pageable) {
99.     Page<Namespace> namespacePage = namespaceService.findByItem(itemKey, pageable);
100. 
101.     List<NamespaceDTO> namespaceDTOS = BeanUtils.batchTransform(NamespaceDTO.class, namespacePage.getContent());
102. 
103.     return new PageDTO<>(namespaceDTOS, pageable, namespacePage.getTotalElements());
104.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java
Line number range: 106 - 116
Content:
106.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
107.   public NamespaceDTO get(@PathVariable("appId") String appId,
108.                           @PathVariable("clusterName") String clusterName,
109.                           @PathVariable("namespaceName") String namespaceName) {
110.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
111.     if (namespace == null) {
112.       throw new NotFoundException("namespace not found for %s %s %s", appId, clusterName,
113.           namespaceName);
114.     }
115.     return BeanUtils.transform(NamespaceDTO.class, namespace);
116.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java
Line number range: 28 - 75
Content:
28. @Entity
29. @Table(name = "Namespace")
30. @SQLDelete(sql = "Update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")
31. @Where(clause = "isDeleted = 0")
32. public class Namespace extends BaseEntity {
33. 
34.   @Column(name = "appId", nullable = false)
35.   private String appId;
36. 
37.   @Column(name = "ClusterName", nullable = false)
38.   private String clusterName;
39. 
40.   @Column(name = "NamespaceName", nullable = false)
41.   private String namespaceName;
42. 
43.   public Namespace(){
44. 
45.   }
46. 
47.   public Namespace(String appId, String clusterName, String namespaceName) {
48.     this.appId = appId;
49.     this.clusterName = clusterName;
50.     this.namespaceName = namespaceName;
51.   }
52. 
53.   public String getAppId() {
54.     return appId;
55.   }
56. 
57.   public String getClusterName() {
58.     return clusterName;
59.   }
60. 
61.   public String getNamespaceName() {
62.     return namespaceName;
63.   }
64. 
65.   public void setAppId(String appId) {
66.     this.appId = appId;
67.   }
68. 
69.   public void setClusterName(String clusterName) {
70.     this.clusterName = clusterName;
71.   }
72. 
73.   public void setNamespaceName(String namespaceName) {
74.     this.namespaceName = namespaceName;
75.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java
Line number range: 31 - 41
Content:
31.   AppNamespace findByAppIdAndName(String appId, String namespaceName);
32. 
33.   List<AppNamespace> findByAppIdAndNameIn(String appId, Set<String> namespaceNames);
34. 
35.   AppNamespace findByNameAndIsPublicTrue(String namespaceName);
36. 
37.   List<AppNamespace> findByNameInAndIsPublicTrue(Set<String> namespaceNames);
38. 
39.   List<AppNamespace> findByAppIdAndIsPublic(String appId, boolean isPublic);
40. 
41.   List<AppNamespace> findByAppIdOrderByIdAsc(String appId);


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/ItemRepository.java
Line number range: 40 - 41
Content:
40.   Page<Item> findByKey(String key, Pageable pageable);
41. 


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java
Line number range: 31 - 47
Content:
31.   List<Namespace> findByAppIdAndClusterNameOrderByIdAsc(String appId, String clusterName);
32. 
33.   Namespace findByAppIdAndClusterNameAndNamespaceName(String appId, String clusterName, String namespaceName);
34. 
35.   @Modifying
36.   @Query("update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 where appId=?1 and clusterName=?2 and IsDeleted = 0")
37.   int batchDelete(String appId, String clusterName, String operator);
38. 
39.   List<Namespace> findByAppIdAndNamespaceNameOrderByIdAsc(String appId, String namespaceName);
40. 
41.   List<Namespace> findByNamespaceName(String namespaceName, Pageable page);
42. 
43.   List<Namespace> findByIdIn(Set<Long> namespaceIds);
44. 
45.   int countByNamespaceNameAndAppIdNot(String namespaceName, String appId);
46. 
47. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 63 - 67
Content:
63.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {
64.     Objects.requireNonNull(appId, "AppId must not be null");
65.     Objects.requireNonNull(namespaceName, "Namespace must not be null");
66.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));
67.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 69 - 72
Content:
69.   public AppNamespace findPublicNamespaceByName(String namespaceName) {
70.     Preconditions.checkArgument(namespaceName != null, "Namespace must not be null");
71.     return appNamespaceRepository.findByNameAndIsPublicTrue(namespaceName);
72.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 90 - 94
Content:
90.   public AppNamespace findOne(String appId, String namespaceName) {
91.     Preconditions
92.         .checkArgument(!StringUtils.isContainEmpty(appId, namespaceName), "appId or Namespace must not be null");
93.     return appNamespaceRepository.findByAppIdAndName(appId, namespaceName);
94.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 122 - 138
Content:
122.   @Transactional
123.   public AppNamespace createAppNamespace(AppNamespace appNamespace) {
124.     String createBy = appNamespace.getDataChangeCreatedBy();
125.     if (!isAppNamespaceNameUnique(appNamespace.getAppId(), appNamespace.getName())) {
126.       throw new ServiceException("appnamespace not unique");
127.     }
128.     appNamespace.setId(0);//protection
129.     appNamespace.setDataChangeCreatedBy(createBy);
130.     appNamespace.setDataChangeLastModifiedBy(createBy);
131. 
132.     appNamespace = appNamespaceRepository.save(appNamespace);
133. 
134.     createNamespaceForAppNamespaceInAllCluster(appNamespace.getAppId(), appNamespace.getName(), createBy);
135. 
136.     auditService.audit(AppNamespace.class.getSimpleName(), appNamespace.getId(), Audit.OP.INSERT, createBy);
137.     return appNamespace;
138.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 151 - 169
Content:
151.   public void createNamespaceForAppNamespaceInAllCluster(String appId, String namespaceName, String createBy) {
152.     List<Cluster> clusters = clusterService.findParentClusters(appId);
153. 
154.     for (Cluster cluster : clusters) {
155. 
156.       // in case there is some dirty data, e.g. public namespace deleted in other app and now created in this app
157.       if (!namespaceService.isNamespaceUnique(appId, cluster.getName(), namespaceName)) {
158.         continue;
159.       }
160. 
161.       Namespace namespace = new Namespace();
162.       namespace.setClusterName(cluster.getName());
163.       namespace.setAppId(appId);
164.       namespace.setNamespaceName(namespaceName);
165.       namespace.setDataChangeCreatedBy(createBy);
166.       namespace.setDataChangeLastModifiedBy(createBy);
167. 
168.       namespaceService.save(namespace);
169.     }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 104 - 107
Content:
104.   public Namespace findOne(String appId, String clusterName, String namespaceName) {
105.     return namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, clusterName,
106.                                                                          namespaceName);
107.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 112 - 122
Content:
112.   public Page<Namespace> findByItem(String itemKey, Pageable pageable) {
113.     Page<Item> items = itemService.findItemsByKey(itemKey, pageable);
114. 
115.     if (!items.hasContent()) {
116.       return Page.empty();
117.     }
118. 
119.     Set<Long> namespaceIds = BeanUtils.toPropertySet("namespaceId", items.getContent());
120. 
121.     return new PageImpl<>(namespaceRepository.findByIdIn(namespaceIds));
122.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 175 - 185
Content:
175.   public List<Namespace> findPublicAppNamespaceAllNamespaces(String namespaceName, Pageable page) {
176.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);
177. 
178.     if (publicAppNamespace == null) {
179.       throw new BadRequestException(
180.           String.format("Public appNamespace not exists. NamespaceName = %s", namespaceName));
181.     }
182. 
183.     List<Namespace> namespaces = namespaceRepository.findByNamespaceName(namespaceName, page);
184. 
185.     return filterChildNamespace(namespaces);


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 204 - 213
Content:
204.   public int countPublicAppNamespaceAssociatedNamespaces(String publicNamespaceName) {
205.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(publicNamespaceName);
206. 
207.     if (publicAppNamespace == null) {
208.       throw new BadRequestException(
209.           String.format("Public appNamespace not exists. NamespaceName = %s", publicNamespaceName));
210.     }
211. 
212.     return namespaceRepository.countByNamespaceNameAndAppIdNot(publicNamespaceName, publicAppNamespace.getAppId());
213.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 215 - 221
Content:
215.   public List<Namespace> findNamespaces(String appId, String clusterName) {
216.     List<Namespace> namespaces = namespaceRepository.findByAppIdAndClusterNameOrderByIdAsc(appId, clusterName);
217.     if (namespaces == null) {
218.       return Collections.emptyList();
219.     }
220.     return namespaces;
221.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 223 - 225
Content:
223.   public List<Namespace> findByAppIdAndNamespaceName(String appId, String namespaceName) {
224.     return namespaceRepository.findByAppIdAndNamespaceNameOrderByIdAsc(appId, namespaceName);
225.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 283 - 289
Content:
283.   public boolean isNamespaceUnique(String appId, String cluster, String namespace) {
284.     Objects.requireNonNull(appId, "AppId must not be null");
285.     Objects.requireNonNull(cluster, "Cluster must not be null");
286.     Objects.requireNonNull(namespace, "Namespace must not be null");
287.     return Objects.isNull(
288.         namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, cluster, namespace));
289.   }


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java
Line number range: 38 - 44
Content:
38.   @NotBlank(message = "AppNamespace Name cannot be blank")
39.   @Pattern(
40.       regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR,
41.       message = "Invalid Namespace format: " + InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE
42.   )
43.   @Column(name = "Name", nullable = false)
44.   private String name;


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java
Line number range: 91 - 101
Content:
91.   public ConfigFileFormat formatAsEnum() {
92.     return ConfigFileFormat.fromString(this.format);
93.   }
94. 
95.   public String getFormat() {
96.     return format;
97.   }
98. 
99.   public void setFormat(String format) {
100.     this.format = format;
101.   }


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
Line number range: 26 - 47
Content:
26. public class InputValidator {
27.   public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbol - _ . are allowed";
28.   public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE = "not allowed to end with .json, .yml, .yaml, .xml, .properties";
29.   public static final String CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+";
30.   private static final String APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$";
31.   private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);
32.   private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);
33. 
34.   public static boolean isValidClusterNamespace(String name) {
35.     if (StringUtils.isEmpty(name)){
36.       return false;
37.     }
38.     return CLUSTER_NAMESPACE_PATTERN.matcher(name).matches();
39.   }
40. 
41.   public static boolean isValidAppNamespace(String name){
42.     if (StringUtils.isEmpty(name)){
43.       return false;
44.     }
45.     return APP_NAMESPACE_PATTERN.matcher(name).matches();
46.   }
47. }


File: apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java
Line number range: 35 - 42
Content:
35.   public String filterNamespaceName(String namespaceName) {
36.     if (namespaceName.toLowerCase().endsWith(".properties")) {
37.       int dotIndex = namespaceName.lastIndexOf(".");
38.       return namespaceName.substring(0, dotIndex);
39.     }
40. 
41.     return namespaceName;
42.   }


File: apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java
Line number range: 44 - 56
Content:
44.   public String normalizeNamespace(String appId, String namespaceName) {
45.     AppNamespace appNamespace = appNamespaceServiceWithCache.findByAppIdAndNamespace(appId, namespaceName);
46.     if (appNamespace != null) {
47.       return appNamespace.getName();
48.     }
49. 
50.     appNamespace = appNamespaceServiceWithCache.findPublicNamespaceByName(namespaceName);
51.     if (appNamespace != null) {
52.       return appNamespace.getName();
53.     }
54. 
55.     return namespaceName;
56.   }


File: apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java
Line number range: 38 - 41
Content:
38. public enum ConfigFileFormat {
39.   Properties("properties"), XML("xml"), JSON("json"), YML("yml"), YAML("yaml"), TXT("txt");
40. 
41.   private final String value;


File: apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java
Line number range: 86 - 97
Content:
86.   public static ConfigFileFormat fromString(String value) {
87.     if (StringUtils.isEmpty(value)) {
88.       throw new IllegalArgumentException("value can not be empty");
89.     }
90. 
91.     final String cleansedName = getWellFormedName(value);
92. 
93.     return Stream.of(ConfigFileFormat.values())
94.         .filter(item -> cleansedName.equalsIgnoreCase(item.getValue()))
95.         .findFirst()
96.         .orElseThrow(() -> new IllegalArgumentException(value + " can not map enum"));
97.   }


File: apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java
Line number range: 128 - 130
Content:
128.   public String getValue() {
129.     return value;
130.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java
Line number range: 65 - 75
Content:
65.     if (!InputValidator.isValidAppNamespace(appNamespaceDTO.getName())) {
66.       throw new BadRequestException(String.format("Invalid Namespace format: %s",
67.                                                   InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & "
68.                                                   + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
69.     }
70. 
71.     if (!ConfigFileFormat.isValidFormat(appNamespaceDTO.getFormat())) {
72.       throw new BadRequestException(String.format("Invalid namespace format. format = %s", appNamespaceDTO.getFormat()));
73.     }
74. 
75.     String operator = appNamespaceDTO.getDataChangeCreatedBy();


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java
Line number range: 89 - 94
Content:
89.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
90.   public OpenNamespaceDTO loadNamespace(@PathVariable String appId, @PathVariable String env,
91.                                         @PathVariable String clusterName, @PathVariable String
92.                                             namespaceName) {
93.     return this.namespaceOpenApiService.getNamespace(appId, env, clusterName, namespaceName);
94.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 120 - 131
Content:
120.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
121.   public NamespaceBO findNamespace(@PathVariable String appId, @PathVariable String env,
122.                                    @PathVariable String clusterName, @PathVariable String namespaceName) {
123. 
124.     NamespaceBO namespaceBO = namespaceService.loadNamespaceBO(appId, Env.valueOf(env), clusterName, namespaceName);
125. 
126.     if (namespaceBO != null && permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceName)) {
127.       namespaceBO.hideItems();
128.     }
129. 
130.     return namespaceBO;
131.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 172 - 180
Content:
172.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
173.   @DeleteMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName:.+}")
174.   public ResponseEntity<Void> deleteLinkedNamespace(@PathVariable String appId, @PathVariable String env,
175.       @PathVariable String clusterName, @PathVariable String namespaceName) {
176. 
177.     namespaceService.deleteNamespace(appId, Env.valueOf(env), clusterName, namespaceName);
178. 
179.     return ResponseEntity.ok().build();
180.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 194 - 203
Content:
194.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
195.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
196.   public ResponseEntity<Void> deleteAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
197. 
198.     AppNamespace appNamespace = appNamespaceService.deleteAppNamespace(appId, namespaceName);
199. 
200.     publisher.publishEvent(new AppNamespaceDeletionEvent(appNamespace));
201. 
202.     return ResponseEntity.ok().build();
203.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 205 - 215
Content:
205.   @GetMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
206.   public AppNamespaceDTO findAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
207.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);
208. 
209.     if (appNamespace == null) {
210.       throw new BadRequestException(
211.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));
212.     }
213. 
214.     return BeanUtils.transform(AppNamespaceDTO.class, appNamespace);
215.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 70 - 78
Content:
70.   public AppNamespace findPublicAppNamespace(String namespaceName) {
71.     List<AppNamespace> appNamespaces = appNamespaceRepository.findByNameAndIsPublic(namespaceName, true);
72. 
73.     if (CollectionUtils.isEmpty(appNamespaces)) {
74.       return null;
75.     }
76. 
77.     return appNamespaces.get(0);
78.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 84 - 86
Content:
84.   public AppNamespace findByAppIdAndName(String appId, String namespaceName) {
85.     return appNamespaceRepository.findByAppIdAndName(appId, namespaceName);
86.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 126 - 144
Content:
126.   @Transactional
127.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace, boolean appendNamespacePrefix) {
128.     String appId = appNamespace.getAppId();
129. 
130.     //add app org id as prefix
131.     App app = appService.load(appId);
132.     if (app == null) {
133.       throw new BadRequestException("App not exist. AppId = " + appId);
134.     }
135. 
136.     StringBuilder appNamespaceName = new StringBuilder();
137.     //add prefix postfix
138.     appNamespaceName
139.         .append(appNamespace.isPublic() && appendNamespacePrefix ? app.getOrgId() + "." : "")
140.         .append(appNamespace.getName())
141.         .append(appNamespace.formatAsEnum() == ConfigFileFormat.Properties ? "" : "." + appNamespace.getFormat());
142.     appNamespace.setName(appNamespaceName.toString());
143. 
144.     if (appNamespace.getComment() == null) {


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 148 - 151
Content:
148.     if (!ConfigFileFormat.isValidFormat(appNamespace.getFormat())) {
149.      throw new BadRequestException("Invalid namespace format. format must be properties、json、yaml、yml、xml");
150.     }
151. 


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 177 - 184
Content:
177.   public NamespaceDTO loadNamespaceBaseInfo(String appId, Env env, String clusterName,
178.       String namespaceName) {
179.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
180.     if (namespace == null) {
181.       throw new BadRequestException(String.format("Namespace: %s not exist.", namespaceName));
182.     }
183.     return namespace;
184.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 287 - 337
Content:
287.   private NamespaceBO transformNamespace2BO(Env env, NamespaceDTO namespace) {
288.     NamespaceBO namespaceBO = new NamespaceBO();
289.     namespaceBO.setBaseInfo(namespace);
290. 
291.     String appId = namespace.getAppId();
292.     String clusterName = namespace.getClusterName();
293.     String namespaceName = namespace.getNamespaceName();
294. 
295.     fillAppNamespaceProperties(namespaceBO);
296. 
297.     List<ItemBO> itemBOs = new LinkedList<>();
298.     namespaceBO.setItems(itemBOs);
299. 
300.     //latest Release
301.     ReleaseDTO latestRelease;
302.     Map<String, String> releaseItems = new HashMap<>();
303.     Map<String, ItemDTO> deletedItemDTOs = new HashMap<>();
304.     latestRelease = releaseService.loadLatestRelease(appId, env, clusterName, namespaceName);
305.     if (latestRelease != null) {
306.       releaseItems = GSON.fromJson(latestRelease.getConfigurations(), GsonType.CONFIG);
307.     }
308. 
309.     //not Release config items
310.     List<ItemDTO> items = itemService.findItems(appId, env, clusterName, namespaceName);
311.     additionalUserInfoEnrichService
312.         .enrichAdditionalUserInfo(items, BaseDtoUserInfoEnrichedAdapter::new);
313.     int modifiedItemCnt = 0;
314.     for (ItemDTO itemDTO : items) {
315. 
316.       ItemBO itemBO = transformItem2BO(itemDTO, releaseItems);
317. 
318.       if (itemBO.isModified()) {
319.         modifiedItemCnt++;
320.       }
321. 
322.       itemBOs.add(itemBO);
323.     }
324. 
325.     //deleted items
326.     itemService.findDeletedItems(appId, env, clusterName, namespaceName).forEach(item -> {
327.       deletedItemDTOs.put(item.getKey(),item);
328.     });
329. 
330.     List<ItemBO> deletedItems = parseDeletedItems(items, releaseItems, deletedItemDTOs);
331.     itemBOs.addAll(deletedItems);
332.     modifiedItemCnt += deletedItems.size();
333. 
334.     namespaceBO.setItemModifiedCnt(modifiedItemCnt);
335. 
336.     return namespaceBO;
337.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 339 - 369
Content:
339.   private void fillAppNamespaceProperties(NamespaceBO namespace) {
340. 
341.     final NamespaceDTO namespaceDTO = namespace.getBaseInfo();
342.     final String appId = namespaceDTO.getAppId();
343.     final String clusterName = namespaceDTO.getClusterName();
344.     final String namespaceName = namespaceDTO.getNamespaceName();
345.     //先从当前appId下面找,包含私有的和公共的
346.     AppNamespace appNamespace =
347.         appNamespaceService
348.             .findByAppIdAndName(appId, namespaceName);
349.     //再从公共的app namespace里面找
350.     if (appNamespace == null) {
351.       appNamespace = appNamespaceService.findPublicAppNamespace(namespaceName);
352.     }
353. 
354.     final String format;
355.     final boolean isPublic;
356.     if (appNamespace == null) {
357.       //dirty data
358.       LOGGER.warn("Dirty data, cannot find appNamespace by namespaceName [{}], appId = {}, cluster = {}, set it format to {}, make public", namespaceName, appId, clusterName, ConfigFileFormat.Properties.getValue());
359.       format = ConfigFileFormat.Properties.getValue();
360.       isPublic = true; // set to true, because public namespace allowed to delete by user
361.     } else {
362.       format = appNamespace.getFormat();
363.       isPublic = appNamespace.isPublic();
364.       namespace.setParentAppId(appNamespace.getAppId());
365.       namespace.setComment(appNamespace.getComment());
366.     }
367.     namespace.setFormat(format);
368.     namespace.setPublic(isPublic);
369.   }

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 11:58:30,881 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning="The issue occurs when querying a namespace named '.' and likely relates to how the system parses namespace names and formats during item/release retrieval. Current context shows some controllers and validators, but lacks portal-side NamespaceService (full), ItemService, ReleaseService, and the portal API clients (AdminServiceAPI/ConfigServiceAPI) as well as adminservice item/release endpoints that process namespaceName. These are critical to trace the query path and pinpoint where '.' triggers a 500." query='Please provide the full source of apollo-portal NamespaceService.java, ItemService.java, ReleaseService.java, and the portal API clients (AdminServiceAPI and ConfigServiceAPI), plus apollo-adminservice controllers and services for Item and Release endpoints that accept namespaceName in the path.' extra_requirements='Include any helper utilities that parse or normalize namespace names (e.g., NamespaceUtil, AppNamespaceServiceWithCache) if they are used in these flows.' purpose='To trace how a single-dot namespace is processed during query and identify the exact component causing the 500 error.'
2025-11-12 11:58:30,883 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full source of apollo-portal NamespaceService.java, ItemService.java, ReleaseService.java, and the portal API clients (AdminServiceAPI and ConfigServiceAPI), plus apollo-adminservice controllers and services for Item and Release endpoints that accept namespaceName in the path.
2025-11-12 11:58:31,169 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 11:58:31,169 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 11:58:31,169 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 11:58:31,169 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 11:58:31,171 - thread-135845287823040.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 11:58:31,174 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 11:58:31,175 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full source of apollo-portal NamespaceService.java, ItemService.java, ReleaseService.java, and the portal API clients (AdminServiceAPI and ConfigServiceAPI), plus apollo-adminservice controllers and services for Item and Release endpoints that accept namespaceName in the path.
Extra requirements: Include any helper utilities that parse or normalize namespace names (e.g., NamespaceUtil, AppNamespaceServiceWithCache) if they are used in these flows.
Purpose: To trace how a single-dot namespace is processed during query and identify the exact component causing the 500 error.
2025-11-12 11:58:36,012 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_djMPem3aBwbcVH3uFZKMqATp', 'function': {'arguments': '{"basename":"NamespaceService.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 286, 'prompt_tokens': 2275, 'total_tokens': 2561, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8072d9cb-a450-4b2a-a136-1d41f6c52407-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceService.java'}, 'id': 'call_djMPem3aBwbcVH3uFZKMqATp', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2275, 'output_tokens': 286, 'total_tokens': 2561, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 11:58:41,923 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_GayrCAwTHGVHJcmcuOQnLZN3', 'function': {'arguments': '{"basename":"ItemService.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 414, 'prompt_tokens': 2412, 'total_tokens': 2826, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c37a3542-3343-4629-aab6-403759932d71-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ItemService.java'}, 'id': 'call_GayrCAwTHGVHJcmcuOQnLZN3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2412, 'output_tokens': 414, 'total_tokens': 2826, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 11:58:43,918 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_OnaO3wF4rposPQyKZ8nmgiW9', 'function': {'arguments': '{"basename":"ReleaseService.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 2549, 'total_tokens': 2573, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d474a713-d846-41a2-a97b-49176cbca1cd-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ReleaseService.java'}, 'id': 'call_OnaO3wF4rposPQyKZ8nmgiW9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2549, 'output_tokens': 24, 'total_tokens': 2573, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:58:45,363 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_nCtO0KTN0O3wvLhOOCxQOjyO', 'function': {'arguments': '{"basename":"AdminServiceAPI.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 2686, 'total_tokens': 2717, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--62afbfcc-728a-4f0c-aebc-068dc65b4708-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AdminServiceAPI.java'}, 'id': 'call_nCtO0KTN0O3wvLhOOCxQOjyO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2686, 'output_tokens': 31, 'total_tokens': 2717, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:58:46,388 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_oyGsRf4rLPHwoBKYqHJyk46z', 'function': {'arguments': '{"basename":"ConfigServiceAPI.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 25, 'prompt_tokens': 2775, 'total_tokens': 2800, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2560}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7b1b3bb5-2972-4dc4-ad99-8281d78b601e-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ConfigServiceAPI.java'}, 'id': 'call_oyGsRf4rLPHwoBKYqHJyk46z', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2775, 'output_tokens': 25, 'total_tokens': 2800, 'input_token_details': {'audio': 0, 'cache_read': 2560}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:58:49,813 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ux1ltAIRRaJiMB33LofRbSvL', 'function': {'arguments': '{"basename":"ConfigServiceApi.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 159, 'prompt_tokens': 2826, 'total_tokens': 2985, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2560}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--177d870b-7a7e-4ccd-996d-ea6dcbaf3c40-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ConfigServiceApi.java'}, 'id': 'call_ux1ltAIRRaJiMB33LofRbSvL', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2826, 'output_tokens': 159, 'total_tokens': 2985, 'input_token_details': {'audio': 0, 'cache_read': 2560}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 11:58:57,492 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_WnyoTN2EnS39gt7r4gSOLKi4', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 689, 'prompt_tokens': 2877, 'total_tokens': 3566, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9751643c-3aea-4872-ab6d-f959266d9156-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java'}, 'id': 'call_WnyoTN2EnS39gt7r4gSOLKi4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2877, 'output_tokens': 689, 'total_tokens': 3566, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-12 11:58:59,151 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_iPQvifDjQmfRpQpphixxGoZm', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ItemService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 8164, 'total_tokens': 8207, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2816}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--64386cf0-3d9c-4312-b29e-ff50957fc35e-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ItemService.java'}, 'id': 'call_iPQvifDjQmfRpQpphixxGoZm', 'type': 'tool_call'}] usage_metadata={'input_tokens': 8164, 'output_tokens': 43, 'total_tokens': 8207, 'input_token_details': {'audio': 0, 'cache_read': 2816}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:59:00,696 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_rsc1OdmuwyDOP5MuU8CY7Gs0', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ReleaseService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 12998, 'total_tokens': 13041, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--4389415b-9d91-47d5-8118-4c00a8f067b8-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ReleaseService.java'}, 'id': 'call_rsc1OdmuwyDOP5MuU8CY7Gs0', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12998, 'output_tokens': 43, 'total_tokens': 13041, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:59:03,176 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4xYBcOOVSc03EkAcwa0ueidt', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 15796, 'total_tokens': 15839, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2699dee2-b32e-4ca2-9753-b876cf496d82-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java'}, 'id': 'call_4xYBcOOVSc03EkAcwa0ueidt', 'type': 'tool_call'}] usage_metadata={'input_tokens': 15796, 'output_tokens': 43, 'total_tokens': 15839, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:59:05,224 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_qBY34GwNx0XvjtyYJILSNiMw', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 22422, 'total_tokens': 22465, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8b8819e1-2b1d-4be4-ad1d-95ee2e6c2e5a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java'}, 'id': 'call_qBY34GwNx0XvjtyYJILSNiMw', 'type': 'tool_call'}] usage_metadata={'input_tokens': 22422, 'output_tokens': 43, 'total_tokens': 22465, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:59:11,372 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_2ethnEKus7WNSw369Ivvamu2', 'function': {'arguments': '{"basename":"ReleaseController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 414, 'prompt_tokens': 29048, 'total_tokens': 29462, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 22400}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--572f93c3-42b0-4b04-94eb-ced4afff326f-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ReleaseController.java'}, 'id': 'call_2ethnEKus7WNSw369Ivvamu2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 29048, 'output_tokens': 414, 'total_tokens': 29462, 'input_token_details': {'audio': 0, 'cache_read': 22400}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 11:59:13,535 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3Xk914P5o7mooz80DVd7osNt', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 29237, 'total_tokens': 29280, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 12928}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--78dc38dd-65b5-4292-bcb0-fef9dd7ab26b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java'}, 'id': 'call_3Xk914P5o7mooz80DVd7osNt', 'type': 'tool_call'}] usage_metadata={'input_tokens': 29237, 'output_tokens': 43, 'total_tokens': 29280, 'input_token_details': {'audio': 0, 'cache_read': 12928}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:59:16,150 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Nr9PyObWVQBijv3yFJnjqXs9', 'function': {'arguments': '{"basename":"ItemController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 32384, 'total_tokens': 32408, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--83c47662-1142-43bc-a3fb-af634ab15386-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ItemController.java'}, 'id': 'call_Nr9PyObWVQBijv3yFJnjqXs9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 32384, 'output_tokens': 24, 'total_tokens': 32408, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:59:18,946 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ga0QVrPWlnWrxRyNhn3Bwqrb', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 32573, 'total_tokens': 32616, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b9f27847-75a6-4a7d-bb44-76e566556d2a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java'}, 'id': 'call_ga0QVrPWlnWrxRyNhn3Bwqrb', 'type': 'tool_call'}] usage_metadata={'input_tokens': 32573, 'output_tokens': 43, 'total_tokens': 32616, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 11:59:30,755 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_LCda1HQifjssV42bl4dtMuU6', 'function': {'arguments': '{"basename":"ConfigServiceAPI.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 799, 'prompt_tokens': 36093, 'total_tokens': 36892, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 28928}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--63863033-d152-41e4-ae02-902adba5b4bf-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ConfigServiceAPI.java'}, 'id': 'call_LCda1HQifjssV42bl4dtMuU6', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36093, 'output_tokens': 799, 'total_tokens': 36892, 'input_token_details': {'audio': 0, 'cache_read': 28928}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 11:59:46,334 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_PldW3IEKKMLscQujoldjGSNo', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/ConfigServiceAPI.java"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1521, 'prompt_tokens': 36144, 'total_tokens': 37665, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1472, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8df226ca-29cb-4508-ae4b-26a8cb1f7a17-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/ConfigServiceAPI.java'}, 'id': 'call_PldW3IEKKMLscQujoldjGSNo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36144, 'output_tokens': 1521, 'total_tokens': 37665, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1472}}
2025-11-12 11:59:55,429 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4sHJgzvOHhnzYf9y036vleXS', 'function': {'arguments': '{"basename":"ConfigService.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 670, 'prompt_tokens': 36213, 'total_tokens': 36883, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 640, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--51eced99-62d4-4816-a38d-412d6fa0bc91-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'ConfigService.java'}, 'id': 'call_4sHJgzvOHhnzYf9y036vleXS', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36213, 'output_tokens': 670, 'total_tokens': 36883, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 640}}
2025-11-12 12:00:05,712 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0BoxU3fxcYj6zIm1XqVfeUO2', 'function': {'arguments': '{"basename":"InstanceController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 606, 'prompt_tokens': 36347, 'total_tokens': 36953, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 576, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1e067413-1f8d-49f5-b589-65a4f521390b-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'InstanceController.java'}, 'id': 'call_0BoxU3fxcYj6zIm1XqVfeUO2', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36347, 'output_tokens': 606, 'total_tokens': 36953, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 576}}
2025-11-12 12:00:11,752 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_0butKeKoXuSxm44D39VSrVm9', 'function': {'arguments': '{"text":"class ConfigServiceAPI","basename":"AdminServiceAPI.java"}', 'name': 'find_ast_node_with_text_in_file_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 426, 'prompt_tokens': 36434, 'total_tokens': 36860, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e0269d3b-e73a-4a0a-9136-a0e850cc15bb-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'text': 'class ConfigServiceAPI', 'basename': 'AdminServiceAPI.java'}, 'id': 'call_0butKeKoXuSxm44D39VSrVm9', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36434, 'output_tokens': 426, 'total_tokens': 36860, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 12:00:29,914 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_4CNcS6Gh48jBOwoC6UOcIkW7', 'function': {'arguments': '{"basename":"API.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 989, 'prompt_tokens': 36500, 'total_tokens': 37489, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 960, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 32512}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c1ab4d62-e0ef-45d8-a3ff-6bb810d5719f-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'API.java'}, 'id': 'call_4CNcS6Gh48jBOwoC6UOcIkW7', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36500, 'output_tokens': 989, 'total_tokens': 37489, 'input_token_details': {'audio': 0, 'cache_read': 32512}, 'output_token_details': {'audio': 0, 'reasoning': 960}}
2025-11-12 12:00:32,304 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_rpSEGqy0naLnIrJd4Ezq7dAB', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/API.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 36583, 'total_tokens': 36624, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2816}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--13a979c7-9fed-4f76-b42e-f18378f72219-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/API.java'}, 'id': 'call_rpSEGqy0naLnIrJd4Ezq7dAB', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36583, 'output_tokens': 41, 'total_tokens': 36624, 'input_token_details': {'audio': 0, 'cache_read': 2816}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:00:44,810 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Ste49RxVLxmV5hjMQvtEBwGf', 'function': {'arguments': '{"text":"ConfigServiceAPI","basename":"NamespaceService.java"}', 'name': 'find_ast_node_with_text_in_file_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1064, 'prompt_tokens': 36998, 'total_tokens': 38062, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1024, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 35968}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--dc909309-3333-48bf-87c5-c7212a82ddfa-0' tool_calls=[{'name': 'find_ast_node_with_text_in_file_with_basename', 'args': {'text': 'ConfigServiceAPI', 'basename': 'NamespaceService.java'}, 'id': 'call_Ste49RxVLxmV5hjMQvtEBwGf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 36998, 'output_tokens': 1064, 'total_tokens': 38062, 'input_token_details': {'audio': 0, 'cache_read': 35968}, 'output_token_details': {'audio': 0, 'reasoning': 1024}}
2025-11-12 12:00:58,393 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_vhnaAT33ZhsM5dcjjCUgTjSo', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 881, 'prompt_tokens': 37062, 'total_tokens': 37943, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 29184}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b5ee5591-9baf-4ebe-8ae5-3d136c5dba54-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java'}, 'id': 'call_vhnaAT33ZhsM5dcjjCUgTjSo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 37062, 'output_tokens': 881, 'total_tokens': 37943, 'input_token_details': {'audio': 0, 'cache_read': 29184}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 12:01:02,256 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_bkQGhwnFEQP1y9Ko4CcHt61o', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 39763, 'total_tokens': 39806, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 36352}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--64e2b842-3777-4567-9231-cf839e0f2f28-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java'}, 'id': 'call_bkQGhwnFEQP1y9Ko4CcHt61o', 'type': 'tool_call'}] usage_metadata={'input_tokens': 39763, 'output_tokens': 43, 'total_tokens': 39806, 'input_token_details': {'audio': 0, 'cache_read': 36352}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:01:04,378 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zq45ELxvAg53ojB4VlJ6Sut5', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 45733, 'total_tokens': 45776, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 36608}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--c14943f8-5809-4a4c-9a5b-9b4e12822dc0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java'}, 'id': 'call_zq45ELxvAg53ojB4VlJ6Sut5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 45733, 'output_tokens': 43, 'total_tokens': 45776, 'input_token_details': {'audio': 0, 'cache_read': 36608}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:01:16,255 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_kt5TBg3mSQZknibtJTnmRHU5', 'function': {'arguments': '{"basename":"NamespaceUtil.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 798, 'prompt_tokens': 51703, 'total_tokens': 52501, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 768, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 36992}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f6877d2e-8b8a-4e62-9a4c-d8a0423fe4ce-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceUtil.java'}, 'id': 'call_kt5TBg3mSQZknibtJTnmRHU5', 'type': 'tool_call'}] usage_metadata={'input_tokens': 51703, 'output_tokens': 798, 'total_tokens': 52501, 'input_token_details': {'audio': 0, 'cache_read': 36992}, 'output_token_details': {'audio': 0, 'reasoning': 768}}
2025-11-12 12:01:19,902 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_KDeyl9TIIo0riYGU19tyINI3', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 51790, 'total_tokens': 51833, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 36096}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f42a95bf-8d12-4eaa-8c0a-ad03cbc8e1ba-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java'}, 'id': 'call_KDeyl9TIIo0riYGU19tyINI3', 'type': 'tool_call'}] usage_metadata={'input_tokens': 51790, 'output_tokens': 43, 'total_tokens': 51833, 'input_token_details': {'audio': 0, 'cache_read': 36096}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:01:22,011 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_2yZNFn2cS4o5H2umP7h3aDjg', 'function': {'arguments': '{"basename":"AppNamespaceServiceWithCache.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 27, 'prompt_tokens': 52523, 'total_tokens': 52550, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 36096}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8a6ec0ff-c10d-45f4-88e3-a9b9139794a8-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceServiceWithCache.java'}, 'id': 'call_2yZNFn2cS4o5H2umP7h3aDjg', 'type': 'tool_call'}] usage_metadata={'input_tokens': 52523, 'output_tokens': 27, 'total_tokens': 52550, 'input_token_details': {'audio': 0, 'cache_read': 36096}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:01:25,886 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_cwsxWlDi3zO45XOqdgkIDhen', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCache.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 45, 'prompt_tokens': 52618, 'total_tokens': 52663, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--ad5ca668-11e4-43f4-8dcb-df449ee8758b-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCache.java'}, 'id': 'call_cwsxWlDi3zO45XOqdgkIDhen', 'type': 'tool_call'}] usage_metadata={'input_tokens': 52618, 'output_tokens': 45, 'total_tokens': 52663, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:01:39,600 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_k2UZHjO99Gej0IShPWdYRBPY', 'function': {'arguments': '{"relative_path":"apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1201, 'prompt_tokens': 56084, 'total_tokens': 57285, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1152, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 36224}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e8771307-7b38-487b-8142-b437a0ee3cd8-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java'}, 'id': 'call_k2UZHjO99Gej0IShPWdYRBPY', 'type': 'tool_call'}] usage_metadata={'input_tokens': 56084, 'output_tokens': 1201, 'total_tokens': 57285, 'input_token_details': {'audio': 0, 'cache_read': 36224}, 'output_token_details': {'audio': 0, 'reasoning': 1152}}
2025-11-12 12:01:59,455 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_tGv8yGHZUxnG1bMaKbglm8yF', 'function': {'arguments': '{"basename":"InstanceController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1374, 'prompt_tokens': 61119, 'total_tokens': 62493, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1344, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 15744}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7b8f2cf7-d9b4-4368-ab73-96f9319ee0b0-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'InstanceController.java'}, 'id': 'call_tGv8yGHZUxnG1bMaKbglm8yF', 'type': 'tool_call'}] usage_metadata={'input_tokens': 61119, 'output_tokens': 1374, 'total_tokens': 62493, 'input_token_details': {'audio': 0, 'cache_read': 15744}, 'output_token_details': {'audio': 0, 'reasoning': 1344}}
2025-11-12 12:02:17,866 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_sATX8HtFgdAnPs6kD1i8z7EI', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java", "start_line":1, "end_line":1000}', 'name': 'read_code_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1532, 'prompt_tokens': 61206, 'total_tokens': 62738, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1472, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 56064}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--644624f9-7a45-4ab3-9fbf-d59d73c6f7ff-0' tool_calls=[{'name': 'read_code_with_relative_path', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java', 'start_line': 1, 'end_line': 1000}, 'id': 'call_sATX8HtFgdAnPs6kD1i8z7EI', 'type': 'tool_call'}] usage_metadata={'input_tokens': 61206, 'output_tokens': 1532, 'total_tokens': 62738, 'input_token_details': {'audio': 0, 'cache_read': 56064}, 'output_token_details': {'audio': 0, 'reasoning': 1472}}
2025-11-12 12:02:52,676 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located and read the full sources of the apollo-portal NamespaceService.java, ItemService.java, ReleaseService.java, and the AdminServiceAPI client. I also pulled the apollo-adminservice ItemController and ReleaseController, along with their corresponding biz-layer ItemService and ReleaseService implementations that back the endpoints using namespaceName in the path. Additionally, I included the helper utilities NamespaceUtil and AppNamespaceServiceWithCache that normalize/resolve namespace names. I could not find a ConfigServiceAPI client in the portal module in this codebase snapshot; the portal appears to use AdminServiceAPI for these flows.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2181, 'prompt_tokens': 68851, 'total_tokens': 71032, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 2048, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 52608}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--59e5a424-aee3-411a-9d70-a936089af377-0' usage_metadata={'input_tokens': 68851, 'output_tokens': 2181, 'total_tokens': 71032, 'input_token_details': {'audio': 0, 'cache_read': 52608}, 'output_token_details': {'audio': 0, 'reasoning': 2048}}
2025-11-12 12:02:52,681 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - This is the query you need to answer:

--- BEGIN QUERY ---
Please provide the full source of apollo-portal NamespaceService.java, ItemService.java, ReleaseService.java, and the portal API clients (AdminServiceAPI and ConfigServiceAPI), plus apollo-adminservice controllers and services for Item and Release endpoints that accept namespaceName in the path.
--- END QUERY ---

--- BEGIN EXTRA REQUIREMENTS ---
Include any helper utilities that parse or normalize namespace names (e.g., NamespaceUtil, AppNamespaceServiceWithCache) if they are used in these flows.
--- END EXTRA REQUIREMENTS ---

--- BEGIN PURPOSE ---
To trace how a single-dot namespace is processed during query and identify the exact component causing the 500 error.
--- END PURPOSE ---

The context or file content that you have seen so far (Some of the context may be IRRELEVANT to the query!!!):

--- BEGIN CONTEXT ---
File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java
Line number range: 1 - 260
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. import com.ctrip.framework.apollo.adminservice.aop.PreAcquireNamespaceLock;
20. import com.ctrip.framework.apollo.biz.entity.Commit;
21. import com.ctrip.framework.apollo.biz.entity.Item;
22. import com.ctrip.framework.apollo.biz.entity.Namespace;
23. import com.ctrip.framework.apollo.biz.entity.Release;
24. import com.ctrip.framework.apollo.biz.service.CommitService;
25. import com.ctrip.framework.apollo.biz.service.ItemService;
26. import com.ctrip.framework.apollo.biz.service.NamespaceService;
27. import com.ctrip.framework.apollo.biz.service.ReleaseService;
28. import com.ctrip.framework.apollo.biz.utils.ConfigChangeContentBuilder;
29. import com.ctrip.framework.apollo.common.dto.ItemDTO;
30. import com.ctrip.framework.apollo.common.dto.PageDTO;
31. import com.ctrip.framework.apollo.common.exception.BadRequestException;
32. import com.ctrip.framework.apollo.common.exception.NotFoundException;
33. import com.ctrip.framework.apollo.common.utils.BeanUtils;
34. import com.ctrip.framework.apollo.core.utils.StringUtils;
35. import java.nio.charset.StandardCharsets;
36. import java.util.Base64;
37. import java.util.Collection;
38. import java.util.Collections;
39. import java.util.List;
40. import java.util.Objects;
41. import java.util.stream.Collectors;
42. import org.springframework.data.domain.Page;
43. import org.springframework.data.domain.Pageable;
44. import org.springframework.web.bind.annotation.DeleteMapping;
45. import org.springframework.web.bind.annotation.GetMapping;
46. import org.springframework.web.bind.annotation.PathVariable;
47. import org.springframework.web.bind.annotation.PostMapping;
48. import org.springframework.web.bind.annotation.PutMapping;
49. import org.springframework.web.bind.annotation.RequestBody;
50. import org.springframework.web.bind.annotation.RequestParam;
51. import org.springframework.web.bind.annotation.RestController;
52. 
53. @RestController
54. public class ItemController {
55. 
56.   private final ItemService itemService;
57.   private final NamespaceService namespaceService;
58.   private final CommitService commitService;
59.   private final ReleaseService releaseService;
60. 
61. 
62.   public ItemController(final ItemService itemService, final NamespaceService namespaceService, final CommitService commitService, final ReleaseService releaseService) {
63.     this.itemService = itemService;
64.     this.namespaceService = namespaceService;
65.     this.commitService = commitService;
66.     this.releaseService = releaseService;
67.   }
68. 
69.   @PreAcquireNamespaceLock
70.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items")
71.   public ItemDTO create(@PathVariable("appId") String appId,
72.                         @PathVariable("clusterName") String clusterName,
73.                         @PathVariable("namespaceName") String namespaceName, @RequestBody ItemDTO dto) {
74.     Item entity = BeanUtils.transform(Item.class, dto);
75. 
76.     Item managedEntity = itemService.findOne(appId, clusterName, namespaceName, entity.getKey());
77.     if (managedEntity != null) {
78.       throw new BadRequestException("item already exists");
79.     }
80.     entity = itemService.save(entity);
81.     dto = BeanUtils.transform(ItemDTO.class, entity);
82. 
83.     Commit commit = new Commit();
84.     commit.setAppId(appId);
85.     commit.setClusterName(clusterName);
86.     commit.setNamespaceName(namespaceName);
87.     commit.setChangeSets(new ConfigChangeContentBuilder().createItem(entity).build());
88.     commit.setDataChangeCreatedBy(dto.getDataChangeLastModifiedBy());
89.     commit.setDataChangeLastModifiedBy(dto.getDataChangeLastModifiedBy());
90.     commitService.save(commit);
91. 
92.     return dto;
93.   }
94. 
95.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/comment_items")
96.   public ItemDTO createComment(@PathVariable("appId") String appId,
97.                         @PathVariable("clusterName") String clusterName,
98.                         @PathVariable("namespaceName") String namespaceName, @RequestBody ItemDTO dto) {
99.     if (!StringUtils.isBlank(dto.getKey()) || !StringUtils.isBlank(dto.getValue())) {
100.       throw new BadRequestException("Comment item's key or value should be blank.");
101.     }
102.     if (StringUtils.isBlank(dto.getComment())) {
103.       throw new BadRequestException("Comment item's comment should not be blank.");
104.     }
105. 
106.     // check if comment existed
107.     List<Item> allItems = itemService.findItemsWithOrdered(appId, clusterName, namespaceName);
108.     for (Item item : allItems) {
109.       if (StringUtils.isBlank(item.getKey()) && StringUtils.isBlank(item.getValue()) &&
110.           Objects.equals(item.getComment(), dto.getComment())) {
111.         return BeanUtils.transform(ItemDTO.class, item);
112.       }
113.     }
114. 
115.     Item entity = BeanUtils.transform(Item.class, dto);
116.     entity = itemService.saveComment(entity);
117. 
118.     return BeanUtils.transform(ItemDTO.class, entity);
119.   }
120. 
121. 
122.   @PreAcquireNamespaceLock
123.   @PutMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/{itemId}")
124.   public ItemDTO update(@PathVariable("appId") String appId,
125.                         @PathVariable("clusterName") String clusterName,
126.                         @PathVariable("namespaceName") String namespaceName,
127.                         @PathVariable("itemId") long itemId,
128.                         @RequestBody ItemDTO itemDTO) {
129.     Item managedEntity = itemService.findOne(itemId);
130.     if (managedEntity == null) {
131.       throw new NotFoundException("item not found for itemId " + itemId);
132.     }
133. 
134.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
135.     // In case someone constructs an attack scenario
136.     if (namespace == null || namespace.getId() != managedEntity.getNamespaceId()) {
137.       throw new BadRequestException("Invalid request, item and namespace do not match!");
138.     }
139. 
140.     Item entity = BeanUtils.transform(Item.class, itemDTO);
141. 
142.     ConfigChangeContentBuilder builder = new ConfigChangeContentBuilder();
143. 
144.     Item beforeUpdateItem = BeanUtils.transform(Item.class, managedEntity);
145. 
146.     //protect. only value,comment,lastModifiedBy can be modified
147.     managedEntity.setValue(entity.getValue());
148.     managedEntity.setComment(entity.getComment());
149.     managedEntity.setDataChangeLastModifiedBy(entity.getDataChangeLastModifiedBy());
150. 
151.     entity = itemService.update(managedEntity);
152.     builder.updateItem(beforeUpdateItem, entity);
153.     itemDTO = BeanUtils.transform(ItemDTO.class, entity);
154. 
155.     if (builder.hasContent()) {
156.       Commit commit = new Commit();
157.       commit.setAppId(appId);
158.       commit.setClusterName(clusterName);
159.       commit.setNamespaceName(namespaceName);
160.       commit.setChangeSets(builder.build());
161.       commit.setDataChangeCreatedBy(itemDTO.getDataChangeLastModifiedBy());
162.       commit.setDataChangeLastModifiedBy(itemDTO.getDataChangeLastModifiedBy());
163.       commitService.save(commit);
164.     }
165. 
166.     return itemDTO;
167.   }
168. 
169.   @PreAcquireNamespaceLock
170.   @DeleteMapping("/items/{itemId}")
171.   public void delete(@PathVariable("itemId") long itemId, @RequestParam String operator) {
172.     Item entity = itemService.findOne(itemId);
173.     if (entity == null) {
174.       throw new NotFoundException("item not found for itemId " + itemId);
175.     }
176.     itemService.delete(entity.getId(), operator);
177. 
178.     Namespace namespace = namespaceService.findOne(entity.getNamespaceId());
179. 
180.     Commit commit = new Commit();
181.     commit.setAppId(namespace.getAppId());
182.     commit.setClusterName(namespace.getClusterName());
183.     commit.setNamespaceName(namespace.getNamespaceName());
184.     commit.setChangeSets(new ConfigChangeContentBuilder().deleteItem(entity).build());
185.     commit.setDataChangeCreatedBy(operator);
186.     commit.setDataChangeLastModifiedBy(operator);
187.     commitService.save(commit);
188.   }
189. 
190.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items")
191.   public List<ItemDTO> findItems(@PathVariable("appId") String appId,
192.                                  @PathVariable("clusterName") String clusterName,
193.                                  @PathVariable("namespaceName") String namespaceName) {
194.     return BeanUtils.batchTransform(ItemDTO.class, itemService.findItemsWithOrdered(appId, clusterName, namespaceName));
195.   }
196. 
197.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/deleted")
198.   public List<ItemDTO> findDeletedItems(@PathVariable("appId") String appId,
199.                                         @PathVariable("clusterName") String clusterName,
200.                                         @PathVariable("namespaceName") String namespaceName) {
201.     //get latest release time
202.     Release latestActiveRelease = releaseService.findLatestActiveRelease(appId, clusterName, namespaceName);
203.     List<Commit> commits;
204.     if (Objects.nonNull(latestActiveRelease)) {
205.       commits = commitService.find(appId, clusterName, namespaceName, latestActiveRelease.getDataChangeCreatedTime(), null);
206.     } else {
207.       commits = commitService.find(appId, clusterName, namespaceName, null);
208.     }
209. 
210.     if (Objects.nonNull(commits)) {
211.       List<Item> deletedItems = commits.stream()
212.           .map(item -> ConfigChangeContentBuilder.convertJsonString(item.getChangeSets()).getDeleteItems())
213.           .flatMap(Collection::stream)
214.           .collect(Collectors.toList());
215.       return BeanUtils.batchTransform(ItemDTO.class, deletedItems);
216.     }
217.     return Collections.emptyList();
218.   }
219. 
220.   @GetMapping("/items/{itemId}")
221.   public ItemDTO get(@PathVariable("itemId") long itemId) {
222.     Item item = itemService.findOne(itemId);
223.     if (item == null) {
224.       throw new NotFoundException("item not found for itemId " + itemId);
225.     }
226.     return BeanUtils.transform(ItemDTO.class, item);
227.   }
228. 
229.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/{key:.+}")
230.   public ItemDTO get(@PathVariable("appId") String appId,
231.       @PathVariable("clusterName") String clusterName,
232.       @PathVariable("namespaceName") String namespaceName, @PathVariable("key") String key) {
233.     Item item = itemService.findOne(appId, clusterName, namespaceName, key);
234.     if (item == null) {
235.       throw new NotFoundException("item not found for %s %s %s %s", appId, clusterName,
236.           namespaceName, key);
237.     }
238.     return BeanUtils.transform(ItemDTO.class, item);
239.   }
240. 
241.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/encodedItems/{key:.+}")
242.   public ItemDTO getByEncodedKey(@PathVariable("appId") String appId,
243.       @PathVariable("clusterName") String clusterName,
244.       @PathVariable("namespaceName") String namespaceName, @PathVariable("key") String key) {
245.     return this.get(appId, clusterName, namespaceName,
246.         new String(Base64.getUrlDecoder().decode(key.getBytes(StandardCharsets.UTF_8))));
247.   }
248. 
249.   @GetMapping(value = "/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items-with-page")
250.   public PageDTO<ItemDTO> findItemsByNamespace(@PathVariable("appId") String appId,
251.                                                @PathVariable("clusterName") String clusterName,
252.                                                @PathVariable("namespaceName") String namespaceName,
253.                                                Pageable pageable) {
254.     Page<Item> itemPage = itemService.findItemsByNamespace(appId, clusterName, namespaceName, pageable);
255. 
256.     List<ItemDTO> itemDTOS = BeanUtils.batchTransform(ItemDTO.class, itemPage.getContent());
257.     return new PageDTO<>(itemDTOS, pageable, itemPage.getTotalElements());
258.   }
259. 
260. }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java
Line number range: 1 - 237
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.adminservice.controller;
18. 
19. 
20. import com.ctrip.framework.apollo.biz.entity.Namespace;
21. import com.ctrip.framework.apollo.biz.entity.Release;
22. import com.ctrip.framework.apollo.biz.message.MessageSender;
23. import com.ctrip.framework.apollo.biz.message.Topics;
24. import com.ctrip.framework.apollo.biz.service.NamespaceBranchService;
25. import com.ctrip.framework.apollo.biz.service.NamespaceService;
26. import com.ctrip.framework.apollo.biz.service.ReleaseService;
27. import com.ctrip.framework.apollo.biz.utils.ReleaseMessageKeyGenerator;
28. import com.ctrip.framework.apollo.common.constants.NamespaceBranchStatus;
29. import com.ctrip.framework.apollo.common.dto.ItemChangeSets;
30. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
31. import com.ctrip.framework.apollo.common.exception.NotFoundException;
32. import com.ctrip.framework.apollo.common.utils.BeanUtils;
33. import com.google.common.base.Splitter;
34. import org.springframework.data.domain.Pageable;
35. import org.springframework.transaction.annotation.Transactional;
36. import org.springframework.web.bind.annotation.GetMapping;
37. import org.springframework.web.bind.annotation.PathVariable;
38. import org.springframework.web.bind.annotation.PostMapping;
39. import org.springframework.web.bind.annotation.PutMapping;
40. import org.springframework.web.bind.annotation.RequestBody;
41. import org.springframework.web.bind.annotation.RequestParam;
42. import org.springframework.web.bind.annotation.RestController;
43. 
44. import java.util.List;
45. import java.util.Set;
46. import java.util.stream.Collectors;
47. 
48. @RestController
49. public class ReleaseController {
50. 
51.   private static final Splitter RELEASES_SPLITTER = Splitter.on(",").omitEmptyStrings()
52.       .trimResults();
53. 
54.   private final ReleaseService releaseService;
55.   private final NamespaceService namespaceService;
56.   private final MessageSender messageSender;
57.   private final NamespaceBranchService namespaceBranchService;
58. 
59.   public ReleaseController(
60.       final ReleaseService releaseService,
61.       final NamespaceService namespaceService,
62.       final MessageSender messageSender,
63.       final NamespaceBranchService namespaceBranchService) {
64.     this.releaseService = releaseService;
65.     this.namespaceService = namespaceService;
66.     this.messageSender = messageSender;
67.     this.namespaceBranchService = namespaceBranchService;
68.   }
69. 
70. 
71.   @GetMapping("/releases/{releaseId}")
72.   public ReleaseDTO get(@PathVariable("releaseId") long releaseId) {
73.     Release release = releaseService.findOne(releaseId);
74.     if (release == null) {
75.       throw new NotFoundException("release not found for %s", releaseId);
76.     }
77.     return BeanUtils.transform(ReleaseDTO.class, release);
78.   }
79. 
80.   @GetMapping("/releases")
81.   public List<ReleaseDTO> findReleaseByIds(@RequestParam("releaseIds") String releaseIds) {
82.     Set<Long> releaseIdSet = RELEASES_SPLITTER.splitToList(releaseIds).stream().map(Long::parseLong)
83.         .collect(Collectors.toSet());
84. 
85.     List<Release> releases = releaseService.findByReleaseIds(releaseIdSet);
86. 
87.     return BeanUtils.batchTransform(ReleaseDTO.class, releases);
88.   }
89. 
90.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/all")
91.   public List<ReleaseDTO> findAllReleases(@PathVariable("appId") String appId,
92.                                           @PathVariable("clusterName") String clusterName,
93.                                           @PathVariable("namespaceName") String namespaceName,
94.                                           Pageable page) {
95.     List<Release> releases = releaseService.findAllReleases(appId, clusterName, namespaceName, page);
96.     return BeanUtils.batchTransform(ReleaseDTO.class, releases);
97.   }
98. 
99. 
100.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/active")
101.   public List<ReleaseDTO> findActiveReleases(@PathVariable("appId") String appId,
102.                                              @PathVariable("clusterName") String clusterName,
103.                                              @PathVariable("namespaceName") String namespaceName,
104.                                              Pageable page) {
105.     List<Release> releases = releaseService.findActiveReleases(appId, clusterName, namespaceName, page);
106.     return BeanUtils.batchTransform(ReleaseDTO.class, releases);
107.   }
108. 
109.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/latest")
110.   public ReleaseDTO getLatest(@PathVariable("appId") String appId,
111.                               @PathVariable("clusterName") String clusterName,
112.                               @PathVariable("namespaceName") String namespaceName) {
113.     Release release = releaseService.findLatestActiveRelease(appId, clusterName, namespaceName);
114.     return BeanUtils.transform(ReleaseDTO.class, release);
115.   }
116. 
117.   @Transactional
118.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases")
119.   public ReleaseDTO publish(@PathVariable("appId") String appId,
120.                             @PathVariable("clusterName") String clusterName,
121.                             @PathVariable("namespaceName") String namespaceName,
122.                             @RequestParam("name") String releaseName,
123.                             @RequestParam(name = "comment", required = false) String releaseComment,
124.                             @RequestParam("operator") String operator,
125.                             @RequestParam(name = "isEmergencyPublish", defaultValue = "false") boolean isEmergencyPublish) {
126.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
127.     if (namespace == null) {
128.       throw new NotFoundException("Could not find namespace for %s %s %s", appId, clusterName,
129.           namespaceName);
130.     }
131.     Release release = releaseService.publish(namespace, releaseName, releaseComment, operator, isEmergencyPublish);
132. 
133.     //send release message
134.     Namespace parentNamespace = namespaceService.findParentNamespace(namespace);
135.     String messageCluster;
136.     if (parentNamespace != null) {
137.       messageCluster = parentNamespace.getClusterName();
138.     } else {
139.       messageCluster = clusterName;
140.     }
141.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, messageCluster, namespaceName),
142.                               Topics.APOLLO_RELEASE_TOPIC);
143.     return BeanUtils.transform(ReleaseDTO.class, release);
144.   }
145. 
146. 
147.   /**
148.    * merge branch items to master and publish master
149.    *
150.    * @return published result
151.    */
152.   @Transactional
153.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/updateAndPublish")
154.   public ReleaseDTO updateAndPublish(@PathVariable("appId") String appId,
155.                                      @PathVariable("clusterName") String clusterName,
156.                                      @PathVariable("namespaceName") String namespaceName,
157.                                      @RequestParam("releaseName") String releaseName,
158.                                      @RequestParam("branchName") String branchName,
159.                                      @RequestParam(value = "deleteBranch", defaultValue = "true") boolean deleteBranch,
160.                                      @RequestParam(name = "releaseComment", required = false) String releaseComment,
161.                                      @RequestParam(name = "isEmergencyPublish", defaultValue = "false") boolean isEmergencyPublish,
162.                                      @RequestBody ItemChangeSets changeSets) {
163.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
164.     if (namespace == null) {
165.       throw new NotFoundException("Could not find namespace for %s %s %s", appId, clusterName,
166.           namespaceName);
167.     }
168. 
169.     Release release = releaseService.mergeBranchChangeSetsAndRelease(namespace, branchName, releaseName,
170.                                                                      releaseComment, isEmergencyPublish, changeSets);
171. 
172.     if (deleteBranch) {
173.       namespaceBranchService.deleteBranch(appId, clusterName, namespaceName, branchName,
174.                                           NamespaceBranchStatus.MERGED, changeSets.getDataChangeLastModifiedBy());
175.     }
176. 
177.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),
178.                               Topics.APOLLO_RELEASE_TOPIC);
179. 
180.     return BeanUtils.transform(ReleaseDTO.class, release);
181. 
182.   }
183. 
184.   @Transactional
185.   @PutMapping("/releases/{releaseId}/rollback")
186.   public void rollback(@PathVariable("releaseId") long releaseId,
187.                        @RequestParam(name="toReleaseId", defaultValue = "-1") long toReleaseId,
188.                        @RequestParam("operator") String operator) {
189. 
190.     Release release;
191.     if (toReleaseId > -1) {
192.       release = releaseService.rollbackTo(releaseId, toReleaseId, operator);
193.     } else {
194.       release = releaseService.rollback(releaseId, operator);
195.     }
196. 
197.     String appId = release.getAppId();
198.     String clusterName = release.getClusterName();
199.     String namespaceName = release.getNamespaceName();
200.     //send release message
201.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),
202.                               Topics.APOLLO_RELEASE_TOPIC);
203.   }
204. 
205.   @Transactional
206.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/gray-del-releases")
207.   public ReleaseDTO publish(@PathVariable("appId") String appId,
208.                             @PathVariable("clusterName") String clusterName,
209.                             @PathVariable("namespaceName") String namespaceName,
210.                             @RequestParam("operator") String operator,
211.                             @RequestParam("releaseName") String releaseName,
212.                             @RequestParam(name = "comment", required = false) String releaseComment,
213.                             @RequestParam(name = "isEmergencyPublish", defaultValue = "false") boolean isEmergencyPublish,
214.                             @RequestParam(name = "grayDelKeys") Set<String> grayDelKeys){
215.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
216.     if (namespace == null) {
217.       throw new NotFoundException("Could not find namespace for %s %s %s", appId, clusterName, 
218.           namespaceName);
219.     }
220. 
221.     Release release = releaseService.grayDeletionPublish(namespace, releaseName, releaseComment, 
222.         operator, isEmergencyPublish, grayDelKeys);
223. 
224.     //send release message
225.     Namespace parentNamespace = namespaceService.findParentNamespace(namespace);
226.     String messageCluster;
227.     if (parentNamespace != null) {
228.       messageCluster = parentNamespace.getClusterName();
229.     } else {
230.       messageCluster = clusterName;
231.     }
232.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, messageCluster, namespaceName),
233.             Topics.APOLLO_RELEASE_TOPIC);
234.     return BeanUtils.transform(ReleaseDTO.class, release);
235.   }
236. 
237. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java
Line number range: 1 - 233
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. 
20. import com.ctrip.framework.apollo.biz.config.BizConfig;
21. import com.ctrip.framework.apollo.biz.entity.Audit;
22. import com.ctrip.framework.apollo.biz.entity.Item;
23. import com.ctrip.framework.apollo.biz.entity.Namespace;
24. import com.ctrip.framework.apollo.biz.repository.ItemRepository;
25. import com.ctrip.framework.apollo.common.exception.BadRequestException;
26. import com.ctrip.framework.apollo.common.exception.NotFoundException;
27. import com.ctrip.framework.apollo.common.utils.BeanUtils;
28. import com.ctrip.framework.apollo.core.utils.StringUtils;
29. 
30. import org.springframework.context.annotation.Lazy;
31. import org.springframework.data.domain.Page;
32. import org.springframework.data.domain.Pageable;
33. import org.springframework.stereotype.Service;
34. import org.springframework.transaction.annotation.Transactional;
35. 
36. import java.util.Collections;
37. import java.util.Date;
38. import java.util.List;
39. import java.util.Map;
40. 
41. @Service
42. public class ItemService {
43. 
44.   private final ItemRepository itemRepository;
45.   private final NamespaceService namespaceService;
46.   private final AuditService auditService;
47.   private final BizConfig bizConfig;
48. 
49.   public ItemService(
50.       final ItemRepository itemRepository,
51.       final @Lazy NamespaceService namespaceService,
52.       final AuditService auditService,
53.       final BizConfig bizConfig) {
54.     this.itemRepository = itemRepository;
55.     this.namespaceService = namespaceService;
56.     this.auditService = auditService;
57.     this.bizConfig = bizConfig;
58.   }
59. 
60. 
61.   @Transactional
62.   public Item delete(long id, String operator) {
63.     Item item = itemRepository.findById(id).orElse(null);
64.     if (item == null) {
65.       throw new IllegalArgumentException("item not exist. ID:" + id);
66.     }
67. 
68.     item.setDeleted(true);
69.     item.setDataChangeLastModifiedBy(operator);
70.     Item deletedItem = itemRepository.save(item);
71. 
72.     auditService.audit(Item.class.getSimpleName(), id, Audit.OP.DELETE, operator);
73.     return deletedItem;
74.   }
75. 
76.   @Transactional
77.   public int batchDelete(long namespaceId, String operator) {
78.     return itemRepository.deleteByNamespaceId(namespaceId, operator);
79. 
80.   }
81. 
82.   public Item findOne(String appId, String clusterName, String namespaceName, String key) {
83.     Namespace namespace = findNamespaceByAppIdAndClusterNameAndNamespaceName(appId, clusterName, namespaceName);
84.     return itemRepository.findByNamespaceIdAndKey(namespace.getId(), key);
85.   }
86. 
87.   public Item findLastOne(String appId, String clusterName, String namespaceName) {
88.     Namespace namespace = findNamespaceByAppIdAndClusterNameAndNamespaceName(appId, clusterName, namespaceName);
89.     return findLastOne(namespace.getId());
90.   }
91. 
92.   public Item findLastOne(long namespaceId) {
93.     return itemRepository.findFirst1ByNamespaceIdOrderByLineNumDesc(namespaceId);
94.   }
95. 
96.   public Item findOne(long itemId) {
97.     return itemRepository.findById(itemId).orElse(null);
98.   }
99. 
100.   public List<Item> findItemsWithoutOrdered(Long namespaceId) {
101.     List<Item> items = itemRepository.findByNamespaceId(namespaceId);
102.     if (items == null) {
103.       return Collections.emptyList();
104.     }
105.     return items;
106.   }
107. 
108.   public List<Item> findItemsWithoutOrdered(String appId, String clusterName, String namespaceName) {
109.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
110.     if (namespace != null) {
111.       return findItemsWithoutOrdered(namespace.getId());
112.     }
113.     return Collections.emptyList();
114.   }
115. 
116.   public List<Item> findItemsWithOrdered(Long namespaceId) {
117.     List<Item> items = itemRepository.findByNamespaceIdOrderByLineNumAsc(namespaceId);
118.     if (items == null) {
119.       return Collections.emptyList();
120.     }
121.     return items;
122.   }
123. 
124.   public List<Item> findItemsWithOrdered(String appId, String clusterName, String namespaceName) {
125.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
126.     if (namespace != null) {
127.       return findItemsWithOrdered(namespace.getId());
128.     }
129.     return Collections.emptyList();
130.   }
131. 
132.   public List<Item> findItemsModifiedAfterDate(long namespaceId, Date date) {
133.     return itemRepository.findByNamespaceIdAndDataChangeLastModifiedTimeGreaterThan(namespaceId, date);
134.   }
135. 
136.   public Page<Item> findItemsByKey(String key, Pageable pageable) {
137.     return itemRepository.findByKey(key, pageable);
138.   }
139. 
140.   public Page<Item> findItemsByNamespace(String appId, String clusterName, String namespaceName, Pageable pageable) {
141.     Namespace namespace = findNamespaceByAppIdAndClusterNameAndNamespaceName(appId, clusterName, namespaceName);
142.     return itemRepository.findByNamespaceId(namespace.getId(), pageable);
143.   }
144. 
145.   @Transactional
146.   public Item save(Item entity) {
147.     checkItemKeyLength(entity.getKey());
148.     checkItemValueLength(entity.getNamespaceId(), entity.getValue());
149. 
150.     entity.setId(0);//protection
151. 
152.     if (entity.getLineNum() == 0) {
153.       Item lastItem = findLastOne(entity.getNamespaceId());
154.       int lineNum = lastItem == null ? 1 : lastItem.getLineNum() + 1;
155.       entity.setLineNum(lineNum);
156.     }
157. 
158.     Item item = itemRepository.save(entity);
159. 
160.     auditService.audit(Item.class.getSimpleName(), item.getId(), Audit.OP.INSERT,
161.                        item.getDataChangeCreatedBy());
162. 
163.     return item;
164.   }
165. 
166.   @Transactional
167.   public Item saveComment(Item entity) {
168.     entity.setKey("");
169.     entity.setValue("");
170.     entity.setId(0);//protection
171. 
172.     if (entity.getLineNum() == 0) {
173.       Item lastItem = findLastOne(entity.getNamespaceId());
174.       int lineNum = lastItem == null ? 1 : lastItem.getLineNum() + 1;
175.       entity.setLineNum(lineNum);
176.     }
177. 
178.     Item item = itemRepository.save(entity);
179. 
180.     auditService.audit(Item.class.getSimpleName(), item.getId(), Audit.OP.INSERT,
181.                        item.getDataChangeCreatedBy());
182. 
183.     return item;
184.   }
185. 
186.   @Transactional
187.   public Item update(Item item) {
188.     checkItemValueLength(item.getNamespaceId(), item.getValue());
189.     Item managedItem = itemRepository.findById(item.getId()).orElse(null);
190.     BeanUtils.copyEntityProperties(item, managedItem);
191.     managedItem = itemRepository.save(managedItem);
192. 
193.     auditService.audit(Item.class.getSimpleName(), managedItem.getId(), Audit.OP.UPDATE,
194.                        managedItem.getDataChangeLastModifiedBy());
195. 
196.     return managedItem;
197.   }
198. 
199.   private boolean checkItemValueLength(long namespaceId, String value) {
200.     int limit = getItemValueLengthLimit(namespaceId);
201.     if (!StringUtils.isEmpty(value) && value.length() > limit) {
202.       throw new BadRequestException("value too long. length limit:" + limit);
203.     }
204.     return true;
205.   }
206. 
207.   private boolean checkItemKeyLength(String key) {
208.     if (!StringUtils.isEmpty(key) && key.length() > bizConfig.itemKeyLengthLimit()) {
209.       throw new BadRequestException("key too long. length limit:" + bizConfig.itemKeyLengthLimit());
210.     }
211.     return true;
212.   }
213. 
214.   private int getItemValueLengthLimit(long namespaceId) {
215.     Map<Long, Integer> namespaceValueLengthOverride = bizConfig.namespaceValueLengthLimitOverride();
216.     if (namespaceValueLengthOverride != null && namespaceValueLengthOverride.containsKey(namespaceId)) {
217.       return namespaceValueLengthOverride.get(namespaceId);
218.     }
219.     return bizConfig.itemValueLengthLimit();
220.   }
221. 
222.   private Namespace findNamespaceByAppIdAndClusterNameAndNamespaceName(String appId,
223.                                                                        String clusterName,
224.                                                                        String namespaceName) {
225.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
226.     if (namespace == null) {
227.       throw new NotFoundException(String.format("namespace not found for appId:%s clusterName:%s namespaceName:%s",
228.               appId, clusterName, namespaceName));
229.     }
230.     return namespace;
231.   }
232. 
233. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 1 - 447
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Audit;
20. import com.ctrip.framework.apollo.biz.entity.Cluster;
21. import com.ctrip.framework.apollo.biz.entity.Item;
22. import com.ctrip.framework.apollo.biz.entity.Namespace;
23. import com.ctrip.framework.apollo.biz.entity.Release;
24. import com.ctrip.framework.apollo.biz.message.MessageSender;
25. import com.ctrip.framework.apollo.biz.message.Topics;
26. import com.ctrip.framework.apollo.biz.repository.NamespaceRepository;
27. import com.ctrip.framework.apollo.biz.utils.ReleaseMessageKeyGenerator;
28. import com.ctrip.framework.apollo.common.constants.GsonType;
29. import com.ctrip.framework.apollo.common.constants.NamespaceBranchStatus;
30. import com.ctrip.framework.apollo.common.entity.AppNamespace;
31. import com.ctrip.framework.apollo.common.exception.BadRequestException;
32. import com.ctrip.framework.apollo.common.exception.ServiceException;
33. import com.ctrip.framework.apollo.common.utils.BeanUtils;
34. import com.ctrip.framework.apollo.core.ConfigConsts;
35. import com.google.common.collect.Maps;
36. import com.google.gson.Gson;
37. import org.springframework.context.annotation.Lazy;
38. import org.springframework.data.domain.Page;
39. import org.springframework.data.domain.PageImpl;
40. import org.springframework.data.domain.Pageable;
41. import org.springframework.stereotype.Service;
42. import org.springframework.transaction.annotation.Transactional;
43. import org.springframework.util.CollectionUtils;
44. 
45. import java.util.Collections;
46. import java.util.Date;
47. import java.util.LinkedList;
48. import java.util.List;
49. import java.util.Map;
50. import java.util.Objects;
51. import java.util.Set;
52. import java.util.stream.Collectors;
53. 
54. @Service
55. public class NamespaceService {
56. 
57.   private static final Gson GSON = new Gson();
58. 
59.   private final NamespaceRepository namespaceRepository;
60.   private final AuditService auditService;
61.   private final AppNamespaceService appNamespaceService;
62.   private final ItemService itemService;
63.   private final CommitService commitService;
64.   private final ReleaseService releaseService;
65.   private final ClusterService clusterService;
66.   private final NamespaceBranchService namespaceBranchService;
67.   private final ReleaseHistoryService releaseHistoryService;
68.   private final NamespaceLockService namespaceLockService;
69.   private final InstanceService instanceService;
70.   private final MessageSender messageSender;
71. 
72.   public NamespaceService(
73.       final ReleaseHistoryService releaseHistoryService,
74.       final NamespaceRepository namespaceRepository,
75.       final AuditService auditService,
76.       final @Lazy AppNamespaceService appNamespaceService,
77.       final MessageSender messageSender,
78.       final @Lazy ItemService itemService,
79.       final CommitService commitService,
80.       final @Lazy ReleaseService releaseService,
81.       final @Lazy ClusterService clusterService,
82.       final @Lazy NamespaceBranchService namespaceBranchService,
83.       final NamespaceLockService namespaceLockService,
84.       final InstanceService instanceService) {
85.     this.releaseHistoryService = releaseHistoryService;
86.     this.namespaceRepository = namespaceRepository;
87.     this.auditService = auditService;
88.     this.appNamespaceService = appNamespaceService;
89.     this.messageSender = messageSender;
90.     this.itemService = itemService;
91.     this.commitService = commitService;
92.     this.releaseService = releaseService;
93.     this.clusterService = clusterService;
94.     this.namespaceBranchService = namespaceBranchService;
95.     this.namespaceLockService = namespaceLockService;
96.     this.instanceService = instanceService;
97.   }
98. 
99. 
100.   public Namespace findOne(Long namespaceId) {
101.     return namespaceRepository.findById(namespaceId).orElse(null);
102.   }
103. 
104.   public Namespace findOne(String appId, String clusterName, String namespaceName) {
105.     return namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, clusterName,
106.                                                                          namespaceName);
107.   }
108. 
109.   /**
110.    * the returned content's size is not fixed. so please carefully used.
111.    */
112.   public Page<Namespace> findByItem(String itemKey, Pageable pageable) {
113.     Page<Item> items = itemService.findItemsByKey(itemKey, pageable);
114. 
115.     if (!items.hasContent()) {
116.       return Page.empty();
117.     }
118. 
119.     Set<Long> namespaceIds = BeanUtils.toPropertySet("namespaceId", items.getContent());
120. 
121.     return new PageImpl<>(namespaceRepository.findByIdIn(namespaceIds));
122.   }
123. 
124.   public Namespace findPublicNamespaceForAssociatedNamespace(String clusterName, String namespaceName) {
125.     AppNamespace appNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);
126.     if (appNamespace == null) {
127.       throw new BadRequestException("namespace not exist");
128.     }
129. 
130.     String appId = appNamespace.getAppId();
131. 
132.     Namespace namespace = findOne(appId, clusterName, namespaceName);
133. 
134.     //default cluster's namespace
135.     if (Objects.equals(clusterName, ConfigConsts.CLUSTER_NAME_DEFAULT)) {
136.       return namespace;
137.     }
138. 
139.     //custom cluster's namespace not exist.
140.     //return default cluster's namespace
141.     if (namespace == null) {
142.       return findOne(appId, ConfigConsts.CLUSTER_NAME_DEFAULT, namespaceName);
143.     }
144. 
145.     //custom cluster's namespace exist and has published.
146.     //return custom cluster's namespace
147.     Release latestActiveRelease = releaseService.findLatestActiveRelease(namespace);
148.     if (latestActiveRelease != null) {
149.       return namespace;
150.     }
151. 
152.     Namespace defaultNamespace = findOne(appId, ConfigConsts.CLUSTER_NAME_DEFAULT, namespaceName);
153. 
154.     //custom cluster's namespace exist but never published.
155.     //and default cluster's namespace not exist.
156.     //return custom cluster's namespace
157.     if (defaultNamespace == null) {
158.       return namespace;
159.     }
160. 
161.     //custom cluster's namespace exist but never published.
162.     //and default cluster's namespace exist and has published.
163.     //return default cluster's namespace
164.     Release defaultNamespaceLatestActiveRelease = releaseService.findLatestActiveRelease(defaultNamespace);
165.     if (defaultNamespaceLatestActiveRelease != null) {
166.       return defaultNamespace;
167.     }
168. 
169.     //custom cluster's namespace exist but never published.
170.     //and default cluster's namespace exist but never published.
171.     //return custom cluster's namespace
172.     return namespace;
173.   }
174. 
175.   public List<Namespace> findPublicAppNamespaceAllNamespaces(String namespaceName, Pageable page) {
176.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);
177. 
178.     if (publicAppNamespace == null) {
179.       throw new BadRequestException(
180.           String.format("Public appNamespace not exists. NamespaceName = %s", namespaceName));
181.     }
182. 
183.     List<Namespace> namespaces = namespaceRepository.findByNamespaceName(namespaceName, page);
184. 
185.     return filterChildNamespace(namespaces);
186.   }
187. 
188.   private List<Namespace> filterChildNamespace(List<Namespace> namespaces) {
189.     List<Namespace> result = new LinkedList<>();
190. 
191.     if (CollectionUtils.isEmpty(namespaces)) {
192.       return result;
193.     }
194. 
195.     for (Namespace namespace : namespaces) {
196.       if (!isChildNamespace(namespace)) {
197.         result.add(namespace);
198.       }
199.     }
200. 
201.     return result;
202.   }
203. 
204.   public int countPublicAppNamespaceAssociatedNamespaces(String publicNamespaceName) {
205.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(publicNamespaceName);
206. 
207.     if (publicAppNamespace == null) {
208.       throw new BadRequestException(
209.           String.format("Public appNamespace not exists. NamespaceName = %s", publicNamespaceName));
210.     }
211. 
212.     return namespaceRepository.countByNamespaceNameAndAppIdNot(publicNamespaceName, publicAppNamespace.getAppId());
213.   }
214. 
215.   public List<Namespace> findNamespaces(String appId, String clusterName) {
216.     List<Namespace> namespaces = namespaceRepository.findByAppIdAndClusterNameOrderByIdAsc(appId, clusterName);
217.     if (namespaces == null) {
218.       return Collections.emptyList();
219.     }
220.     return namespaces;
221.   }
222. 
223.   public List<Namespace> findByAppIdAndNamespaceName(String appId, String namespaceName) {
224.     return namespaceRepository.findByAppIdAndNamespaceNameOrderByIdAsc(appId, namespaceName);
225.   }
226. 
227.   public Namespace findChildNamespace(String appId, String parentClusterName, String namespaceName) {
228.     List<Namespace> namespaces = findByAppIdAndNamespaceName(appId, namespaceName);
229.     if (CollectionUtils.isEmpty(namespaces) || namespaces.size() == 1) {
230.       return null;
231.     }
232. 
233.     List<Cluster> childClusters = clusterService.findChildClusters(appId, parentClusterName);
234.     if (CollectionUtils.isEmpty(childClusters)) {
235.       return null;
236.     }
237. 
238.     Set<String> childClusterNames = childClusters.stream().map(Cluster::getName).collect(Collectors.toSet());
239.     //the child namespace is the intersection of the child clusters and child namespaces
240.     for (Namespace namespace : namespaces) {
241.       if (childClusterNames.contains(namespace.getClusterName())) {
242.         return namespace;
243.       }
244.     }
245. 
246.     return null;
247.   }
248. 
249.   public Namespace findChildNamespace(Namespace parentNamespace) {
250.     String appId = parentNamespace.getAppId();
251.     String parentClusterName = parentNamespace.getClusterName();
252.     String namespaceName = parentNamespace.getNamespaceName();
253. 
254.     return findChildNamespace(appId, parentClusterName, namespaceName);
255. 
256.   }
257. 
258.   public Namespace findParentNamespace(String appId, String clusterName, String namespaceName) {
259.     return findParentNamespace(new Namespace(appId, clusterName, namespaceName));
260.   }
261. 
262.   public Namespace findParentNamespace(Namespace namespace) {
263.     String appId = namespace.getAppId();
264.     String namespaceName = namespace.getNamespaceName();
265. 
266.     Cluster cluster = clusterService.findOne(appId, namespace.getClusterName());
267.     if (cluster != null && cluster.getParentClusterId() > 0) {
268.       Cluster parentCluster = clusterService.findOne(cluster.getParentClusterId());
269.       return findOne(appId, parentCluster.getName(), namespaceName);
270.     }
271. 
272.     return null;
273.   }
274. 
275.   public boolean isChildNamespace(String appId, String clusterName, String namespaceName) {
276.     return isChildNamespace(new Namespace(appId, clusterName, namespaceName));
277.   }
278. 
279.   public boolean isChildNamespace(Namespace namespace) {
280.     return findParentNamespace(namespace) != null;
281.   }
282. 
283.   public boolean isNamespaceUnique(String appId, String cluster, String namespace) {
284.     Objects.requireNonNull(appId, "AppId must not be null");
285.     Objects.requireNonNull(cluster, "Cluster must not be null");
286.     Objects.requireNonNull(namespace, "Namespace must not be null");
287.     return Objects.isNull(
288.         namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, cluster, namespace));
289.   }
290. 
291.   @Transactional
292.   public void deleteByAppIdAndClusterName(String appId, String clusterName, String operator) {
293. 
294.     List<Namespace> toDeleteNamespaces = findNamespaces(appId, clusterName);
295. 
296.     for (Namespace namespace : toDeleteNamespaces) {
297. 
298.       deleteNamespace(namespace, operator);
299. 
300.     }
301.   }
302. 
303.   @Transactional
304.   public Namespace deleteNamespace(Namespace namespace, String operator) {
305.     String appId = namespace.getAppId();
306.     String clusterName = namespace.getClusterName();
307.     String namespaceName = namespace.getNamespaceName();
308. 
309.     itemService.batchDelete(namespace.getId(), operator);
310.     commitService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);
311. 
312.     // Child namespace releases should retain as long as the parent namespace exists, because parent namespaces' release
313.     // histories need them
314.     if (!isChildNamespace(namespace)) {
315.       releaseService.batchDelete(appId, clusterName, namespace.getNamespaceName(), operator);
316.     }
317. 
318.     //delete child namespace
319.     Namespace childNamespace = findChildNamespace(namespace);
320.     if (childNamespace != null) {
321.       namespaceBranchService.deleteBranch(appId, clusterName, namespaceName,
322.                                           childNamespace.getClusterName(), NamespaceBranchStatus.DELETED, operator);
323.       //delete child namespace's releases. Notice: delete child namespace will not delete child namespace's releases
324.       releaseService.batchDelete(appId, childNamespace.getClusterName(), namespaceName, operator);
325.     }
326. 
327.     releaseHistoryService.batchDelete(appId, clusterName, namespaceName, operator);
328. 
329.     instanceService.batchDeleteInstanceConfig(appId, clusterName, namespaceName);
330. 
331.     namespaceLockService.unlock(namespace.getId());
332. 
333.     namespace.setDeleted(true);
334.     namespace.setDataChangeLastModifiedBy(operator);
335. 
336.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.DELETE, operator);
337. 
338.     Namespace deleted = namespaceRepository.save(namespace);
339. 
340.     //Publish release message to do some clean up in config service, such as updating the cache
341.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),
342.         Topics.APOLLO_RELEASE_TOPIC);
343. 
344.     return deleted;
345.   }
346. 
347.   @Transactional
348.   public Namespace save(Namespace entity) {
349.     if (!isNamespaceUnique(entity.getAppId(), entity.getClusterName(), entity.getNamespaceName())) {
350.       throw new ServiceException("namespace not unique");
351.     }
352.     entity.setId(0);//protection
353.     Namespace namespace = namespaceRepository.save(entity);
354. 
355.     auditService.audit(Namespace.class.getSimpleName(), namespace.getId(), Audit.OP.INSERT,
356.                        namespace.getDataChangeCreatedBy());
357. 
358.     return namespace;
359.   }
360. 
361.   @Transactional
362.   public Namespace update(Namespace namespace) {
363.     Namespace managedNamespace = namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(
364.         namespace.getAppId(), namespace.getClusterName(), namespace.getNamespaceName());
365.     BeanUtils.copyEntityProperties(namespace, managedNamespace);
366.     managedNamespace = namespaceRepository.save(managedNamespace);
367. 
368.     auditService.audit(Namespace.class.getSimpleName(), managedNamespace.getId(), Audit.OP.UPDATE,
369.                        managedNamespace.getDataChangeLastModifiedBy());
370. 
371.     return managedNamespace;
372.   }
373. 
374.   @Transactional
375.   public void instanceOfAppNamespaces(String appId, String clusterName, String createBy) {
376. 
377.     List<AppNamespace> appNamespaces = appNamespaceService.findByAppId(appId);
378. 
379.     for (AppNamespace appNamespace : appNamespaces) {
380.       Namespace ns = new Namespace();
381.       ns.setAppId(appId);
382.       ns.setClusterName(clusterName);
383.       ns.setNamespaceName(appNamespace.getName());
384.       ns.setDataChangeCreatedBy(createBy);
385.       ns.setDataChangeLastModifiedBy(createBy);
386.       namespaceRepository.save(ns);
387.       auditService.audit(Namespace.class.getSimpleName(), ns.getId(), Audit.OP.INSERT, createBy);
388.     }
389. 
390.   }
391. 
392.   public Map<String, Boolean> namespacePublishInfo(String appId) {
393.     List<Cluster> clusters = clusterService.findParentClusters(appId);
394.     if (CollectionUtils.isEmpty(clusters)) {
395.       throw new BadRequestException("app not exist");
396.     }
397. 
398.     Map<String, Boolean> clusterHasNotPublishedItems = Maps.newHashMap();
399. 
400.     for (Cluster cluster : clusters) {
401.       String clusterName = cluster.getName();
402.       List<Namespace> namespaces = findNamespaces(appId, clusterName);
403. 
404.       for (Namespace namespace : namespaces) {
405.         boolean isNamespaceNotPublished = isNamespaceNotPublished(namespace);
406. 
407.         if (isNamespaceNotPublished) {
408.           clusterHasNotPublishedItems.put(clusterName, true);
409.           break;
410.         }
411.       }
412. 
413.       clusterHasNotPublishedItems.putIfAbsent(clusterName, false);
414.     }
415. 
416.     return clusterHasNotPublishedItems;
417.   }
418. 
419.   private boolean isNamespaceNotPublished(Namespace namespace) {
420. 
421.     Release latestRelease = releaseService.findLatestActiveRelease(namespace);
422.     long namespaceId = namespace.getId();
423. 
424.     if (latestRelease == null) {
425.       Item lastItem = itemService.findLastOne(namespaceId);
426.       return lastItem != null;
427.     }
428. 
429.     Date lastPublishTime = latestRelease.getDataChangeLastModifiedTime();
430.     List<Item> itemsModifiedAfterLastPublish = itemService.findItemsModifiedAfterDate(namespaceId, lastPublishTime);
431. 
432.     if (CollectionUtils.isEmpty(itemsModifiedAfterLastPublish)) {
433.       return false;
434.     }
435. 
436.     Map<String, String> publishedConfiguration = GSON.fromJson(latestRelease.getConfigurations(), GsonType.CONFIG);
437.     for (Item item : itemsModifiedAfterLastPublish) {
438.       if (!Objects.equals(item.getValue(), publishedConfiguration.get(item.getKey()))) {
439.         return true;
440.       }
441.     }
442. 
443.     return false;
444.   }
445. 
446. 
447. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java
Line number range: 1 - 500
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.biz.service;
18. 
19. import com.ctrip.framework.apollo.biz.entity.Audit;
20. import com.ctrip.framework.apollo.biz.entity.GrayReleaseRule;
21. import com.ctrip.framework.apollo.biz.entity.Item;
22. import com.ctrip.framework.apollo.biz.entity.Namespace;
23. import com.ctrip.framework.apollo.biz.entity.NamespaceLock;
24. import com.ctrip.framework.apollo.biz.entity.Release;
25. import com.ctrip.framework.apollo.biz.entity.ReleaseHistory;
26. import com.ctrip.framework.apollo.biz.repository.ReleaseRepository;
27. import com.ctrip.framework.apollo.biz.utils.ReleaseKeyGenerator;
28. import com.ctrip.framework.apollo.common.constants.GsonType;
29. import com.ctrip.framework.apollo.common.constants.ReleaseOperation;
30. import com.ctrip.framework.apollo.common.constants.ReleaseOperationContext;
31. import com.ctrip.framework.apollo.common.dto.ItemChangeSets;
32. import com.ctrip.framework.apollo.common.exception.BadRequestException;
33. import com.ctrip.framework.apollo.common.exception.NotFoundException;
34. import com.ctrip.framework.apollo.common.utils.GrayReleaseRuleItemTransformer;
35. import com.ctrip.framework.apollo.core.utils.StringUtils;
36. import com.google.common.base.Strings;
37. import com.google.common.collect.Lists;
38. import com.google.common.collect.Maps;
39. import com.google.common.collect.Sets;
40. import com.google.gson.Gson;
41. import com.google.gson.reflect.TypeToken;
42. import java.lang.reflect.Type;
43. import java.util.Collection;
44. import java.util.Collections;
45. import java.util.Date;
46. import java.util.LinkedHashMap;
47. import java.util.List;
48. import java.util.Map;
49. import java.util.Objects;
50. import java.util.Set;
51. import org.apache.commons.lang.time.FastDateFormat;
52. import org.springframework.data.domain.Page;
53. import org.springframework.data.domain.PageRequest;
54. import org.springframework.data.domain.Pageable;
55. import org.springframework.stereotype.Service;
56. import org.springframework.transaction.annotation.Transactional;
57. import org.springframework.util.CollectionUtils;
58. 
59. /**
60.  * @author Jason Song(song_s@ctrip.com)
61.  */
62. @Service
63. public class ReleaseService {
64. 
65.   private static final FastDateFormat TIMESTAMP_FORMAT = FastDateFormat.getInstance("yyyyMMddHHmmss");
66.   private static final Gson GSON = new Gson();
67.   private static final Set<Integer> BRANCH_RELEASE_OPERATIONS = Sets
68.       .newHashSet(ReleaseOperation.GRAY_RELEASE, ReleaseOperation.MASTER_NORMAL_RELEASE_MERGE_TO_GRAY,
69.           ReleaseOperation.MATER_ROLLBACK_MERGE_TO_GRAY);
70.   private static final Pageable FIRST_ITEM = PageRequest.of(0, 1);
71.   private static final Type OPERATION_CONTEXT_TYPE_REFERENCE = new TypeToken<Map<String, Object>>() { }.getType();
72. 
73.   private final ReleaseRepository releaseRepository;
74.   private final ItemService itemService;
75.   private final AuditService auditService;
76.   private final NamespaceLockService namespaceLockService;
77.   private final NamespaceService namespaceService;
78.   private final NamespaceBranchService namespaceBranchService;
79.   private final ReleaseHistoryService releaseHistoryService;
80.   private final ItemSetService itemSetService;
81. 
82.   public ReleaseService(
83.       final ReleaseRepository releaseRepository,
84.       final ItemService itemService,
85.       final AuditService auditService,
86.       final NamespaceLockService namespaceLockService,
87.       final NamespaceService namespaceService,
88.       final NamespaceBranchService namespaceBranchService,
89.       final ReleaseHistoryService releaseHistoryService,
90.       final ItemSetService itemSetService) {
91.     this.releaseRepository = releaseRepository;
92.     this.itemService = itemService;
93.     this.auditService = auditService;
94.     this.namespaceLockService = namespaceLockService;
95.     this.namespaceService = namespaceService;
96.     this.namespaceBranchService = namespaceBranchService;
97.     this.releaseHistoryService = releaseHistoryService;
98.     this.itemSetService = itemSetService;
99.   }
100. 
101.   public Release findOne(long releaseId) {
102.     return releaseRepository.findById(releaseId).orElse(null);
103.   }
104. 
105. 
106.   public Release findActiveOne(long releaseId) {
107.     return releaseRepository.findByIdAndIsAbandonedFalse(releaseId);
108.   }
109. 
110.   public List<Release> findByReleaseIds(Set<Long> releaseIds) {
111.     Iterable<Release> releases = releaseRepository.findAllById(releaseIds);
112.     if (releases == null) {
113.       return Collections.emptyList();
114.     }
115.     return Lists.newArrayList(releases);
116.   }
117. 
118.   public List<Release> findByReleaseKeys(Set<String> releaseKeys) {
119.     return releaseRepository.findByReleaseKeyIn(releaseKeys);
120.   }
121. 
122.   public Release findLatestActiveRelease(Namespace namespace) {
123.     return findLatestActiveRelease(namespace.getAppId(),
124.                                    namespace.getClusterName(), namespace.getNamespaceName());
125. 
126.   }
127. 
128.   public Release findLatestActiveRelease(String appId, String clusterName, String namespaceName) {
129.     return releaseRepository.findFirstByAppIdAndClusterNameAndNamespaceNameAndIsAbandonedFalseOrderByIdDesc(appId,
130.                                                                                                             clusterName,
131.                                                                                                             namespaceName);
132.   }
133. 
134.   public List<Release> findAllReleases(String appId, String clusterName, String namespaceName, Pageable page) {
135.     List<Release> releases = releaseRepository.findByAppIdAndClusterNameAndNamespaceNameOrderByIdDesc(appId,
136.                                                                                                       clusterName,
137.                                                                                                       namespaceName,
138.                                                                                                       page);
139.     if (releases == null) {
140.       return Collections.emptyList();
141.     }
142.     return releases;
143.   }
144. 
145.   public List<Release> findActiveReleases(String appId, String clusterName, String namespaceName, Pageable page) {
146.     List<Release>
147.         releases =
148.         releaseRepository.findByAppIdAndClusterNameAndNamespaceNameAndIsAbandonedFalseOrderByIdDesc(appId, clusterName,
149.                                                                                                     namespaceName,
150.                                                                                                     page);
151.     if (releases == null) {
152.       return Collections.emptyList();
153.     }
154.     return releases;
155.   }
156. 
157.   private List<Release> findActiveReleasesBetween(String appId, String clusterName, String namespaceName,
158.                                                   long fromReleaseId, long toReleaseId) {
159.     List<Release>
160.         releases =
161.         releaseRepository.findByAppIdAndClusterNameAndNamespaceNameAndIsAbandonedFalseAndIdBetweenOrderByIdDesc(appId,
162.                                                                                                                 clusterName,
163.                                                                                                                 namespaceName,
164.                                                                                                                 fromReleaseId,
165.                                                                                                                 toReleaseId);
166.     if (releases == null) {
167.       return Collections.emptyList();
168.     }
169.     return releases;
170.   }
171. 
172.   @Transactional
173.   public Release mergeBranchChangeSetsAndRelease(Namespace namespace, String branchName, String releaseName,
174.                                                  String releaseComment, boolean isEmergencyPublish,
175.                                                  ItemChangeSets changeSets) {
176. 
177.     checkLock(namespace, isEmergencyPublish, changeSets.getDataChangeLastModifiedBy());
178. 
179.     itemSetService.updateSet(namespace, changeSets);
180. 
181.     Release branchRelease = findLatestActiveRelease(namespace.getAppId(), branchName, namespace
182.         .getNamespaceName());
183.     long branchReleaseId = branchRelease == null ? 0 : branchRelease.getId();
184. 
185.     Map<String, String> operateNamespaceItems = getNamespaceItems(namespace);
186. 
187.     Map<String, Object> operationContext = Maps.newLinkedHashMap();
188.     operationContext.put(ReleaseOperationContext.SOURCE_BRANCH, branchName);
189.     operationContext.put(ReleaseOperationContext.BASE_RELEASE_ID, branchReleaseId);
190.     operationContext.put(ReleaseOperationContext.IS_EMERGENCY_PUBLISH, isEmergencyPublish);
191. 
192.     return masterRelease(namespace, releaseName, releaseComment, operateNamespaceItems,
193.                          changeSets.getDataChangeLastModifiedBy(),
194.                          ReleaseOperation.GRAY_RELEASE_MERGE_TO_MASTER, operationContext);
195. 
196.   }
197. 
198.   @Transactional
199.   public Release publish(Namespace namespace, String releaseName, String releaseComment,
200.                          String operator, boolean isEmergencyPublish) {
201. 
202.     checkLock(namespace, isEmergencyPublish, operator);
203. 
204.     Map<String, String> operateNamespaceItems = getNamespaceItems(namespace);
205. 
206.     Namespace parentNamespace = namespaceService.findParentNamespace(namespace);
207. 
208.     //branch release
209.     if (parentNamespace != null) {
210.       return publishBranchNamespace(parentNamespace, namespace, operateNamespaceItems,
211.                                     releaseName, releaseComment, operator, isEmergencyPublish);
212.     }
213. 
214.     Namespace childNamespace = namespaceService.findChildNamespace(namespace);
215. 
216.     Release previousRelease = null;
217.     if (childNamespace != null) {
218.       previousRelease = findLatestActiveRelease(namespace);
219.     }
220. 
221.     //master release
222.     Map<String, Object> operationContext = Maps.newLinkedHashMap();
223.     operationContext.put(ReleaseOperationContext.IS_EMERGENCY_PUBLISH, isEmergencyPublish);
224. 
225.     Release release = masterRelease(namespace, releaseName, releaseComment, operateNamespaceItems,
226.                                     operator, ReleaseOperation.NORMAL_RELEASE, operationContext);
227. 
228.     //merge to branch and auto release
229.     if (childNamespace != null) {
230.       mergeFromMasterAndPublishBranch(namespace, childNamespace, operateNamespaceItems,
231.                                       releaseName, releaseComment, operator, previousRelease,
232.                                       release, isEmergencyPublish);
233.     }
234. 
235.     return release;
236.   }
237. 
238.   private Release publishBranchNamespace(Namespace parentNamespace, Namespace childNamespace,
239.                                          Map<String, String> childNamespaceItems,
240.                                          String releaseName, String releaseComment,
241.                                          String operator, boolean isEmergencyPublish, Set<String> grayDelKeys) {
242.     Release parentLatestRelease = findLatestActiveRelease(parentNamespace);
243.     Map<String, String> parentConfigurations = parentLatestRelease != null ?
244.             GSON.fromJson(parentLatestRelease.getConfigurations(),
245.                           GsonType.CONFIG) : new LinkedHashMap<>();
246.     long baseReleaseId = parentLatestRelease == null ? 0 : parentLatestRelease.getId();
247. 
248.     Map<String, String> configsToPublish = mergeConfiguration(parentConfigurations, childNamespaceItems);
249. 
250.     if(!(grayDelKeys == null || grayDelKeys.size()==0)){
251.       for (String key : grayDelKeys){
252.         configsToPublish.remove(key);
253.       }
254.     }
255. 
256.     return branchRelease(parentNamespace, childNamespace, releaseName, releaseComment,
257.         configsToPublish, baseReleaseId, operator, ReleaseOperation.GRAY_RELEASE, isEmergencyPublish,
258.         childNamespaceItems.keySet());
259. 
260.   }
261. 
262.   @Transactional
263.   public Release grayDeletionPublish(Namespace namespace, String releaseName, String releaseComment,
264.                                      String operator, boolean isEmergencyPublish, Set<String> grayDelKeys) {
265. 
266.     checkLock(namespace, isEmergencyPublish, operator);
267. 
268.     Map<String, String> operateNamespaceItems = getNamespaceItems(namespace);
269. 
270.     Namespace parentNamespace = namespaceService.findParentNamespace(namespace);
271. 
272.     //branch release
273.     if (parentNamespace != null) {
274.       return publishBranchNamespace(parentNamespace, namespace, operateNamespaceItems,
275.               releaseName, releaseComment, operator, isEmergencyPublish, grayDelKeys);
276.     }
277.     throw new NotFoundException("Parent namespace not found");
278.   }
279. 
280.   private void checkLock(Namespace namespace, boolean isEmergencyPublish, String operator) {
281.     if (!isEmergencyPublish) {
282.       NamespaceLock lock = namespaceLockService.findLock(namespace.getId());
283.       if (lock != null && lock.getDataChangeCreatedBy().equals(operator)) {
284.         throw new BadRequestException("Config can not be published by yourself.");
285.       }
286.     }
287.   }
288. 
289.   private void mergeFromMasterAndPublishBranch(Namespace parentNamespace, Namespace childNamespace,
290.                                                Map<String, String> parentNamespaceItems,
291.                                                String releaseName, String releaseComment,
292.                                                String operator, Release masterPreviousRelease,
293.                                                Release parentRelease, boolean isEmergencyPublish) {
294.     //create release for child namespace
295.     Release childNamespaceLatestActiveRelease = findLatestActiveRelease(childNamespace);
296. 
297.     Map<String, String> childReleaseConfiguration;
298.     Collection<String> branchReleaseKeys;
299.     if (childNamespaceLatestActiveRelease != null) {
300.       childReleaseConfiguration = GSON.fromJson(childNamespaceLatestActiveRelease.getConfigurations(), GsonType.CONFIG);
301.       branchReleaseKeys = getBranchReleaseKeys(childNamespaceLatestActiveRelease.getId());
302.     } else {
303.       childReleaseConfiguration = Collections.emptyMap();
304.       branchReleaseKeys = null;
305.     }
306. 
307.     Map<String, String> parentNamespaceOldConfiguration = masterPreviousRelease == null ?
308.                                                           null : GSON.fromJson(masterPreviousRelease.getConfigurations(),
309.                                                                                GsonType.CONFIG);
310. 
311.     Map<String, String> childNamespaceToPublishConfigs =
312.         calculateChildNamespaceToPublishConfiguration(parentNamespaceOldConfiguration, parentNamespaceItems,
313.             childReleaseConfiguration, branchReleaseKeys);
314. 
315.     //compare
316.     if (!childNamespaceToPublishConfigs.equals(childReleaseConfiguration)) {
317.       branchRelease(parentNamespace, childNamespace, releaseName, releaseComment,
318.                     childNamespaceToPublishConfigs, parentRelease.getId(), operator,
319.                     ReleaseOperation.MASTER_NORMAL_RELEASE_MERGE_TO_GRAY, isEmergencyPublish, branchReleaseKeys);
320.     }
321. 
322.   }
323. 
324.   private Collection<String> getBranchReleaseKeys(long releaseId) {
325.     Page<ReleaseHistory> releaseHistories = releaseHistoryService
326.         .findByReleaseIdAndOperationInOrderByIdDesc(releaseId, BRANCH_RELEASE_OPERATIONS, FIRST_ITEM);
327. 
328.     if (!releaseHistories.hasContent()) {
329.       return null;
330.     }
331. 
332.     String operationContextJson = releaseHistories.getContent().get(0).getOperationContext();
333.     if (Strings.isNullOrEmpty(operationContextJson)
334.         || !operationContextJson.contains(ReleaseOperationContext.BRANCH_RELEASE_KEYS)) {
335.       return null;
336.     }
337. 
338.     Map<String, Object> operationContext = GSON.fromJson(operationContextJson,
339.         OPERATION_CONTEXT_TYPE_REFERENCE);
340. 
341.     if (operationContext == null) {
342.       return null;
343.     }
344. 
345.     return (Collection<String>) operationContext.get(ReleaseOperationContext.BRANCH_RELEASE_KEYS);
346.   }
347. 
348.   private Release publishBranchNamespace(Namespace parentNamespace, Namespace childNamespace,
349.                                          Map<String, String> childNamespaceItems,
350.                                          String releaseName, String releaseComment,
351.                                          String operator, boolean isEmergencyPublish) {
352.     return publishBranchNamespace(parentNamespace, childNamespace, childNamespaceItems, releaseName, releaseComment,
353.             operator, isEmergencyPublish, null);
354. 
355.   }
356. 
357.   private Release masterRelease(Namespace namespace, String releaseName, String releaseComment,
358.                                 Map<String, String> configurations, String operator,
359.                                 int releaseOperation, Map<String, Object> operationContext) {
360.     Release lastActiveRelease = findLatestActiveRelease(namespace);
361.     long previousReleaseId = lastActiveRelease == null ? 0 : lastActiveRelease.getId();
362.     Release release = createRelease(namespace, releaseName, releaseComment,
363.                                     configurations, operator);
364. 
365.     releaseHistoryService.createReleaseHistory(namespace.getAppId(), namespace.getClusterName(),
366.                                                namespace.getNamespaceName(), namespace.getClusterName(),
367.                                                release.getId(), previousReleaseId, releaseOperation,
368.                                                operationContext, operator);
369. 
370.     return release;
371.   }
372. 
373.   private Release branchRelease(Namespace parentNamespace, Namespace childNamespace,
374.                                 String releaseName, String releaseComment,
375.                                 Map<String, String> configurations, long baseReleaseId,
376.                                 String operator, int releaseOperation, boolean isEmergencyPublish, Collection<String> branchReleaseKeys) {
377.     Release previousRelease = findLatestActiveRelease(childNamespace.getAppId(),
378.                                                       childNamespace.getClusterName(),
379.                                                       childNamespace.getNamespaceName());
380.     long previousReleaseId = previousRelease == null ? 0 : previousRelease.getId();
381. 
382.     Map<String, Object> releaseOperationContext = Maps.newLinkedHashMap();
383.     releaseOperationContext.put(ReleaseOperationContext.BASE_RELEASE_ID, baseReleaseId);
384.     releaseOperationContext.put(ReleaseOperationContext.IS_EMERGENCY_PUBLISH, isEmergencyPublish);
385.     releaseOperationContext.put(ReleaseOperationContext.BRANCH_RELEASE_KEYS, branchReleaseKeys);
386. 
387.     Release release =
388.         createRelease(childNamespace, releaseName, releaseComment, configurations, operator);
389. 
390.     //update gray release rules
391.     GrayReleaseRule grayReleaseRule = namespaceBranchService.updateRulesReleaseId(childNamespace.getAppId(),
392.                                                                                   parentNamespace.getClusterName(),
393.                                                                                   childNamespace.getNamespaceName(),
394.                                                                                   childNamespace.getClusterName(),
395.                                                                                   release.getId(), operator);
396. 
397.     if (grayReleaseRule != null) {
398.       releaseOperationContext.put(ReleaseOperationContext.RULES, GrayReleaseRuleItemTransformer
399.           .batchTransformFromJSON(grayReleaseRule.getRules()));
400.     }
401. 
402.     releaseHistoryService.createReleaseHistory(parentNamespace.getAppId(), parentNamespace.getClusterName(),
403.                                                parentNamespace.getNamespaceName(), childNamespace.getClusterName(),
404.                                                release.getId(),
405.                                                previousReleaseId, releaseOperation, releaseOperationContext, operator);
406. 
407.     return release;
408.   }
409. 
410.   private Map<String, String> mergeConfiguration(Map<String, String> baseConfigurations,
411.                                                  Map<String, String> coverConfigurations) {
412.     int expectedSize = baseConfigurations.size() + coverConfigurations.size();
413.     Map<String, String> result = Maps.newLinkedHashMapWithExpectedSize(expectedSize);
414. 
415.     //copy base configuration
416.     result.putAll(baseConfigurations);
417. 
418.     //update and publish
419.     result.putAll(coverConfigurations);
420. 
421.     return result;
422.   }
423. 
424.   private Map<String, String> getNamespaceItems(Namespace namespace) {
425.     List<Item> items = itemService.findItemsWithOrdered(namespace.getId());
426.     Map<String, String> configurations = new LinkedHashMap<>();
427.     for (Item item : items) {
428.       if (StringUtils.isEmpty(item.getKey())) {
429.         continue;
430.       }
431.       configurations.put(item.getKey(), item.getValue());
432.     }
433. 
434.     return configurations;
435.   }
436. 
437.   private Release createRelease(Namespace namespace, String name, String comment,
438.                                 Map<String, String> configurations, String operator) {
439.     Release release = new Release();
440.     release.setReleaseKey(ReleaseKeyGenerator.generateReleaseKey(namespace));
441.     release.setDataChangeCreatedTime(new Date());
442.     release.setDataChangeCreatedBy(operator);
443.     release.setDataChangeLastModifiedBy(operator);
444.     release.setName(name);
445.     release.setComment(comment);
446.     release.setAppId(namespace.getAppId());
447.     release.setClusterName(namespace.getClusterName());
448.     release.setNamespaceName(namespace.getNamespaceName());
449.     release.setConfigurations(GSON.toJson(configurations));
450.     release = releaseRepository.save(release);
451. 
452.     namespaceLockService.unlock(namespace.getId());
453.     auditService.audit(Release.class.getSimpleName(), release.getId(), Audit.OP.INSERT,
454.                        release.getDataChangeCreatedBy());
455. 
456.     return release;
457.   }
458. 
459.   @Transactional
460.   public Release rollback(long releaseId, String operator) {
461.     Release release = findOne(releaseId);
462.     if (release == null) {
463.       throw new NotFoundException("release not found");
464.     }
465.     if (release.isAbandoned()) {
466.       throw new BadRequestException("release is not active");
467.     }
468. 
469.     String appId = release.getAppId();
470.     String clusterName = release.getClusterName();
471.     String namespaceName = release.getNamespaceName();
472. 
473.     PageRequest page = PageRequest.of(0, 2);
474.     List<Release> twoLatestActiveReleases = findActiveReleases(appId, clusterName, namespaceName, page);
475.     if (twoLatestActiveReleases == null || twoLatestActiveReleases.size() < 2) {
476.       throw new BadRequestException(String.format(
477.           "Can't rollback namespace(appId=%s, clusterName=%s, namespaceName=%s) because there is only one active release",
478.           appId,
479.           clusterName,
480.           namespaceName));
481.     }
482. 
483.     release.setAbandoned(true);
484.     release.setDataChangeLastModifiedBy(operator);
485. 
486.     releaseRepository.save(release);
487. 
488.     releaseHistoryService.createReleaseHistory(appId, clusterName,
489.                                                namespaceName, clusterName, twoLatestActiveReleases.get(1).getId(),
490.                                                release.getId(), ReleaseOperation.ROLLBACK, null, operator);
491. 
492.     //publish child namespace if namespace has child
493.     rollbackChildNamespace(appId, clusterName, namespaceName, twoLatestActiveReleases, operator);
494. 
495.     return release;
496.   }
497. 
498.   @Transactional
499.   public Release rollbackTo(long releaseId, long toReleaseId, String operator) {
500.     if (releaseId == toReleaseId) {


File: apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCache.java
Line number range: 1 - 291
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.service;
18. 
19. import com.ctrip.framework.apollo.biz.config.BizConfig;
20. import com.ctrip.framework.apollo.biz.repository.AppNamespaceRepository;
21. import com.ctrip.framework.apollo.common.entity.AppNamespace;
22. import com.ctrip.framework.apollo.configservice.wrapper.CaseInsensitiveMapWrapper;
23. import com.ctrip.framework.apollo.core.ConfigConsts;
24. import com.ctrip.framework.apollo.core.utils.ApolloThreadFactory;
25. import com.ctrip.framework.apollo.core.utils.StringUtils;
26. import com.ctrip.framework.apollo.tracer.Tracer;
27. import com.ctrip.framework.apollo.tracer.spi.Transaction;
28. import com.google.common.base.Joiner;
29. import com.google.common.base.Preconditions;
30. import com.google.common.base.Strings;
31. import com.google.common.collect.Lists;
32. import com.google.common.collect.Maps;
33. import com.google.common.collect.Sets;
34. import org.slf4j.Logger;
35. import org.slf4j.LoggerFactory;
36. import org.springframework.beans.factory.InitializingBean;
37. import org.springframework.stereotype.Service;
38. import org.springframework.util.CollectionUtils;
39. 
40. import java.util.Collections;
41. import java.util.List;
42. import java.util.Map;
43. import java.util.Set;
44. import java.util.concurrent.Executors;
45. import java.util.concurrent.ScheduledExecutorService;
46. import java.util.concurrent.TimeUnit;
47. 
48. /**
49.  * @author Jason Song(song_s@ctrip.com)
50.  */
51. @Service
52. public class AppNamespaceServiceWithCache implements InitializingBean {
53.   private static final Logger logger = LoggerFactory.getLogger(AppNamespaceServiceWithCache.class);
54.   private static final Joiner STRING_JOINER = Joiner.on(ConfigConsts.CLUSTER_NAMESPACE_SEPARATOR)
55.       .skipNulls();
56.   private final AppNamespaceRepository appNamespaceRepository;
57.   private final BizConfig bizConfig;
58. 
59.   private int scanInterval;
60.   private TimeUnit scanIntervalTimeUnit;
61.   private int rebuildInterval;
62.   private TimeUnit rebuildIntervalTimeUnit;
63.   private ScheduledExecutorService scheduledExecutorService;
64.   private long maxIdScanned;
65. 
66.   //store namespaceName -> AppNamespace
67.   private CaseInsensitiveMapWrapper<AppNamespace> publicAppNamespaceCache;
68. 
69.   //store appId+namespaceName -> AppNamespace
70.   private CaseInsensitiveMapWrapper<AppNamespace> appNamespaceCache;
71. 
72.   //store id -> AppNamespace
73.   private Map<Long, AppNamespace> appNamespaceIdCache;
74. 
75.   public AppNamespaceServiceWithCache(
76.       final AppNamespaceRepository appNamespaceRepository,
77.       final BizConfig bizConfig) {
78.     this.appNamespaceRepository = appNamespaceRepository;
79.     this.bizConfig = bizConfig;
80.     initialize();
81.   }
82. 
83.   private void initialize() {
84.     maxIdScanned = 0;
85.     publicAppNamespaceCache = new CaseInsensitiveMapWrapper<>(Maps.newConcurrentMap());
86.     appNamespaceCache = new CaseInsensitiveMapWrapper<>(Maps.newConcurrentMap());
87.     appNamespaceIdCache = Maps.newConcurrentMap();
88.     scheduledExecutorService = Executors.newScheduledThreadPool(1, ApolloThreadFactory
89.         .create("AppNamespaceServiceWithCache", true));
90.   }
91. 
92.   public AppNamespace findByAppIdAndNamespace(String appId, String namespaceName) {
93.     Preconditions.checkArgument(!StringUtils.isContainEmpty(appId, namespaceName), "appId and namespaceName must not be empty");
94.     return appNamespaceCache.get(STRING_JOINER.join(appId, namespaceName));
95.   }
96. 
97.   public List<AppNamespace> findByAppIdAndNamespaces(String appId, Set<String> namespaceNames) {
98.     Preconditions.checkArgument(!Strings.isNullOrEmpty(appId), "appId must not be null");
99.     if (namespaceNames == null || namespaceNames.isEmpty()) {
100.       return Collections.emptyList();
101.     }
102.     List<AppNamespace> result = Lists.newArrayList();
103.     for (String namespaceName : namespaceNames) {
104.       AppNamespace appNamespace = appNamespaceCache.get(STRING_JOINER.join(appId, namespaceName));
105.       if (appNamespace != null) {
106.         result.add(appNamespace);
107.       }
108.     }
109.     return result;
110.   }
111. 
112.   public AppNamespace findPublicNamespaceByName(String namespaceName) {
113.     Preconditions.checkArgument(!Strings.isNullOrEmpty(namespaceName), "namespaceName must not be empty");
114.     return publicAppNamespaceCache.get(namespaceName);
115.   }
116. 
117.   public List<AppNamespace> findPublicNamespacesByNames(Set<String> namespaceNames) {
118.     if (namespaceNames == null || namespaceNames.isEmpty()) {
119.       return Collections.emptyList();
120.     }
121. 
122.     List<AppNamespace> result = Lists.newArrayList();
123.     for (String namespaceName : namespaceNames) {
124.       AppNamespace appNamespace = publicAppNamespaceCache.get(namespaceName);
125.       if (appNamespace != null) {
126.         result.add(appNamespace);
127.       }
128.     }
129.     return result;
130.   }
131. 
132.   @Override
133.   public void afterPropertiesSet() throws Exception {
134.     populateDataBaseInterval();
135.     scanNewAppNamespaces(); //block the startup process until load finished
136.     scheduledExecutorService.scheduleAtFixedRate(() -> {
137.       Transaction transaction = Tracer.newTransaction("Apollo.AppNamespaceServiceWithCache",
138.           "rebuildCache");
139.       try {
140.         this.updateAndDeleteCache();
141.         transaction.setStatus(Transaction.SUCCESS);
142.       } catch (Throwable ex) {
143.         transaction.setStatus(ex);
144.         logger.error("Rebuild cache failed", ex);
145.       } finally {
146.         transaction.complete();
147.       }
148.     }, rebuildInterval, rebuildInterval, rebuildIntervalTimeUnit);
149.     scheduledExecutorService.scheduleWithFixedDelay(this::scanNewAppNamespaces, scanInterval,
150.         scanInterval, scanIntervalTimeUnit);
151.   }
152. 
153.   private void scanNewAppNamespaces() {
154.     Transaction transaction = Tracer.newTransaction("Apollo.AppNamespaceServiceWithCache",
155.         "scanNewAppNamespaces");
156.     try {
157.       this.loadNewAppNamespaces();
158.       transaction.setStatus(Transaction.SUCCESS);
159.     } catch (Throwable ex) {
160.       transaction.setStatus(ex);
161.       logger.error("Load new app namespaces failed", ex);
162.     } finally {
163.       transaction.complete();
164.     }
165.   }
166. 
167.   //for those new app namespaces
168.   private void loadNewAppNamespaces() {
169.     boolean hasMore = true;
170.     while (hasMore && !Thread.currentThread().isInterrupted()) {
171.       //current batch is 500
172.       List<AppNamespace> appNamespaces = appNamespaceRepository
173.           .findFirst500ByIdGreaterThanOrderByIdAsc(maxIdScanned);
174.       if (CollectionUtils.isEmpty(appNamespaces)) {
175.         break;
176.       }
177.       mergeAppNamespaces(appNamespaces);
178.       int scanned = appNamespaces.size();
179.       maxIdScanned = appNamespaces.get(scanned - 1).getId();
180.       hasMore = scanned == 500;
181.       logger.info("Loaded {} new app namespaces with startId {}", scanned, maxIdScanned);
182.     }
183.   }
184. 
185.   private void mergeAppNamespaces(List<AppNamespace> appNamespaces) {
186.     for (AppNamespace appNamespace : appNamespaces) {
187.       appNamespaceCache.put(assembleAppNamespaceKey(appNamespace), appNamespace);
188.       appNamespaceIdCache.put(appNamespace.getId(), appNamespace);
189.       if (appNamespace.isPublic()) {
190.         publicAppNamespaceCache.put(appNamespace.getName(), appNamespace);
191.       }
192.     }
193.   }
194. 
195.   //for those updated or deleted app namespaces
196.   private void updateAndDeleteCache() {
197.     List<Long> ids = Lists.newArrayList(appNamespaceIdCache.keySet());
198.     if (CollectionUtils.isEmpty(ids)) {
199.       return;
200.     }
201.     List<List<Long>> partitionIds = Lists.partition(ids, 500);
202.     for (List<Long> toRebuild : partitionIds) {
203.       Iterable<AppNamespace> appNamespaces = appNamespaceRepository.findAllById(toRebuild);
204. 
205.       if (appNamespaces == null) {
206.         continue;
207.       }
208. 
209.       //handle updated
210.       Set<Long> foundIds = handleUpdatedAppNamespaces(appNamespaces);
211. 
212.       //handle deleted
213.       handleDeletedAppNamespaces(Sets.difference(Sets.newHashSet(toRebuild), foundIds));
214.     }
215.   }
216. 
217.   //for those updated app namespaces
218.   private Set<Long> handleUpdatedAppNamespaces(Iterable<AppNamespace> appNamespaces) {
219.     Set<Long> foundIds = Sets.newHashSet();
220.     for (AppNamespace appNamespace : appNamespaces) {
221.       foundIds.add(appNamespace.getId());
222.       AppNamespace thatInCache = appNamespaceIdCache.get(appNamespace.getId());
223.       if (thatInCache != null && appNamespace.getDataChangeLastModifiedTime().after(thatInCache
224.           .getDataChangeLastModifiedTime())) {
225.         appNamespaceIdCache.put(appNamespace.getId(), appNamespace);
226.         String oldKey = assembleAppNamespaceKey(thatInCache);
227.         String newKey = assembleAppNamespaceKey(appNamespace);
228.         appNamespaceCache.put(newKey, appNamespace);
229. 
230.         //in case appId or namespaceName changes
231.         if (!newKey.equals(oldKey)) {
232.           appNamespaceCache.remove(oldKey);
233.         }
234. 
235.         if (appNamespace.isPublic()) {
236.           publicAppNamespaceCache.put(appNamespace.getName(), appNamespace);
237. 
238.           //in case namespaceName changes
239.           if (!appNamespace.getName().equals(thatInCache.getName()) && thatInCache.isPublic()) {
240.             publicAppNamespaceCache.remove(thatInCache.getName());
241.           }
242.         } else if (thatInCache.isPublic()) {
243.           //just in case isPublic changes
244.           publicAppNamespaceCache.remove(thatInCache.getName());
245.         }
246.         logger.info("Found AppNamespace changes, old: {}, new: {}", thatInCache, appNamespace);
247.       }
248.     }
249.     return foundIds;
250.   }
251. 
252.   //for those deleted app namespaces
253.   private void handleDeletedAppNamespaces(Set<Long> deletedIds) {
254.     if (CollectionUtils.isEmpty(deletedIds)) {
255.       return;
256.     }
257.     for (Long deletedId : deletedIds) {
258.       AppNamespace deleted = appNamespaceIdCache.remove(deletedId);
259.       if (deleted == null) {
260.         continue;
261.       }
262.       appNamespaceCache.remove(assembleAppNamespaceKey(deleted));
263.       if (deleted.isPublic()) {
264.         AppNamespace publicAppNamespace = publicAppNamespaceCache.get(deleted.getName());
265.         // in case there is some dirty data, e.g. public namespace deleted in some app and now created in another app
266.         if (publicAppNamespace == deleted) {
267.           publicAppNamespaceCache.remove(deleted.getName());
268.         }
269.       }
270.       logger.info("Found AppNamespace deleted, {}", deleted);
271.     }
272.   }
273. 
274.   private String assembleAppNamespaceKey(AppNamespace appNamespace) {
275.     return STRING_JOINER.join(appNamespace.getAppId(), appNamespace.getName());
276.   }
277. 
278.   private void populateDataBaseInterval() {
279.     scanInterval = bizConfig.appNamespaceCacheScanInterval();
280.     scanIntervalTimeUnit = bizConfig.appNamespaceCacheScanIntervalTimeUnit();
281.     rebuildInterval = bizConfig.appNamespaceCacheRebuildInterval();
282.     rebuildIntervalTimeUnit = bizConfig.appNamespaceCacheRebuildIntervalTimeUnit();
283.   }
284. 
285.   //only for test use
286.   private void reset() throws Exception {
287.     scheduledExecutorService.shutdownNow();
288.     initialize();
289.     afterPropertiesSet();
290.   }
291. }


File: apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java
Line number range: 1 - 57
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.configservice.util;
18. 
19. import com.ctrip.framework.apollo.common.entity.AppNamespace;
20. import com.ctrip.framework.apollo.configservice.service.AppNamespaceServiceWithCache;
21. import org.springframework.stereotype.Component;
22. 
23. /**
24.  * @author Jason Song(song_s@ctrip.com)
25.  */
26. @Component
27. public class NamespaceUtil {
28. 
29.   private final AppNamespaceServiceWithCache appNamespaceServiceWithCache;
30. 
31.   public NamespaceUtil(final AppNamespaceServiceWithCache appNamespaceServiceWithCache) {
32.     this.appNamespaceServiceWithCache = appNamespaceServiceWithCache;
33.   }
34. 
35.   public String filterNamespaceName(String namespaceName) {
36.     if (namespaceName.toLowerCase().endsWith(".properties")) {
37.       int dotIndex = namespaceName.lastIndexOf(".");
38.       return namespaceName.substring(0, dotIndex);
39.     }
40. 
41.     return namespaceName;
42.   }
43. 
44.   public String normalizeNamespace(String appId, String namespaceName) {
45.     AppNamespace appNamespace = appNamespaceServiceWithCache.findByAppIdAndNamespace(appId, namespaceName);
46.     if (appNamespace != null) {
47.       return appNamespace.getName();
48.     }
49. 
50.     appNamespace = appNamespaceServiceWithCache.findPublicNamespaceByName(namespaceName);
51.     if (appNamespace != null) {
52.       return appNamespace.getName();
53.     }
54. 
55.     return namespaceName;
56.   }
57. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/API.java
Line number range: 1 - 29
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.api;
18. 
19. 
20. import com.ctrip.framework.apollo.portal.component.RetryableRestTemplate;
21. 
22. import org.springframework.beans.factory.annotation.Autowired;
23. 
24. public abstract class API {
25. 
26.   @Autowired
27.   protected RetryableRestTemplate restTemplate;
28. 
29. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java
Line number range: 1 - 1000
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.api;
18. 
19. import com.ctrip.framework.apollo.common.dto.*;
20. import com.ctrip.framework.apollo.openapi.dto.OpenItemDTO;
21. import com.ctrip.framework.apollo.portal.environment.Env;
22. import com.google.common.base.Joiner;
23. import java.nio.charset.StandardCharsets;
24. import java.util.Base64;
25. import org.springframework.boot.actuate.health.Health;
26. import org.springframework.core.ParameterizedTypeReference;
27. import org.springframework.http.HttpEntity;
28. import org.springframework.http.HttpHeaders;
29. import org.springframework.http.MediaType;
30. import org.springframework.http.ResponseEntity;
31. import org.springframework.stereotype.Service;
32. import org.springframework.util.CollectionUtils;
33. import org.springframework.util.LinkedMultiValueMap;
34. import org.springframework.util.MultiValueMap;
35. import java.util.Arrays;
36. import java.util.Collections;
37. import java.util.List;
38. import java.util.Map;
39. import java.util.Set;
40. 
41. 
42. @Service
43. public class AdminServiceAPI {
44. 
45.   @Service
46.   public static class HealthAPI extends API {
47. 
48.     public Health health(Env env) {
49.       return restTemplate.get(env, "/health", Health.class);
50.     }
51.   }
52. 
53.   @Service
54.   public static class AppAPI extends API {
55. 
56.     public AppDTO loadApp(Env env, String appId) {
57.       return restTemplate.get(env, "apps/{appId}", AppDTO.class, appId);
58.     }
59. 
60.     public AppDTO createApp(Env env, AppDTO app) {
61.       return restTemplate.post(env, "apps", app, AppDTO.class);
62.     }
63. 
64.     public void updateApp(Env env, AppDTO app) {
65.       restTemplate.put(env, "apps/{appId}", app, app.getAppId());
66.     }
67. 
68.     public void deleteApp(Env env, String appId, String operator) {
69.       restTemplate.delete(env, "/apps/{appId}?operator={operator}", appId, operator);
70.     }
71.   }
72. 
73. 
74.   @Service
75.   public static class NamespaceAPI extends API {
76. 
77.     private ParameterizedTypeReference<PageDTO<NamespaceDTO>>
78.         namespacePageDTO = new ParameterizedTypeReference<PageDTO<NamespaceDTO>>() {
79.     };
80. 
81.     private ParameterizedTypeReference<Map<String, Boolean>>
82.         typeReference = new ParameterizedTypeReference<Map<String, Boolean>>() {
83.     };
84. 
85.     public List<NamespaceDTO> findNamespaceByCluster(String appId, Env env, String clusterName) {
86.       NamespaceDTO[] namespaceDTOs = restTemplate.get(env, "apps/{appId}/clusters/{clusterName}/namespaces",
87.           NamespaceDTO[].class, appId,
88.           clusterName);
89.       return Arrays.asList(namespaceDTOs);
90.     }
91. 
92.     public PageDTO<NamespaceDTO> findByItem(Env env, String itemKey, int page, int size) {
93.       ResponseEntity<PageDTO<NamespaceDTO>>
94.           entity =
95.           restTemplate.get(env, "/namespaces/find-by-item?itemKey={itemKey}&page={page}&size={size}",
96.                            namespacePageDTO, itemKey, page, size);
97.       return entity.getBody();
98.     }
99. 
100.     public NamespaceDTO loadNamespace(String appId, Env env, String clusterName,
101.         String namespaceName) {
102.       return
103.           restTemplate.get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}",
104.               NamespaceDTO.class, appId, clusterName, namespaceName);
105.     }
106. 
107.     public NamespaceDTO findPublicNamespaceForAssociatedNamespace(Env env, String appId, String clusterName,
108.         String namespaceName) {
109.       return
110.           restTemplate
111.               .get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/associated-public-namespace",
112.                   NamespaceDTO.class, appId, clusterName, namespaceName);
113.     }
114. 
115.     public NamespaceDTO createNamespace(Env env, NamespaceDTO namespace) {
116.       return restTemplate
117.           .post(env, "apps/{appId}/clusters/{clusterName}/namespaces", namespace, NamespaceDTO.class,
118.               namespace.getAppId(), namespace.getClusterName());
119.     }
120. 
121.     public AppNamespaceDTO createAppNamespace(Env env, AppNamespaceDTO appNamespace) {
122.       return restTemplate
123.           .post(env, "apps/{appId}/appnamespaces", appNamespace, AppNamespaceDTO.class, appNamespace.getAppId());
124.     }
125. 
126.     public AppNamespaceDTO createMissingAppNamespace(Env env, AppNamespaceDTO appNamespace) {
127.       return restTemplate
128.           .post(env, "apps/{appId}/appnamespaces?silentCreation=true", appNamespace, AppNamespaceDTO.class,
129.               appNamespace.getAppId());
130.     }
131. 
132.     public List<AppNamespaceDTO> getAppNamespaces(String appId, Env env) {
133.       AppNamespaceDTO[] appNamespaceDTOs = restTemplate.get(env, "apps/{appId}/appnamespaces", AppNamespaceDTO[].class, appId);
134.       return Arrays.asList(appNamespaceDTOs);
135.     }
136. 
137.     public void deleteNamespace(Env env, String appId, String clusterName, String namespaceName, String operator) {
138.       restTemplate
139.           .delete(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}?operator={operator}", appId,
140.               clusterName,
141.               namespaceName, operator);
142.     }
143. 
144.     public Map<String, Boolean> getNamespacePublishInfo(Env env, String appId) {
145.       return restTemplate.get(env, "apps/{appId}/namespaces/publish_info", typeReference, appId).getBody();
146.     }
147. 
148.     public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(Env env, String publicNamespaceName,
149.         int page, int size) {
150.       NamespaceDTO[] namespaceDTOs =
151.           restTemplate.get(env, "/appnamespaces/{publicNamespaceName}/namespaces?page={page}&size={size}",
152.               NamespaceDTO[].class, publicNamespaceName, page, size);
153.       return Arrays.asList(namespaceDTOs);
154.     }
155. 
156.     public int countPublicAppNamespaceAssociatedNamespaces(Env env, String publicNamesapceName) {
157.       Integer count =
158.           restTemplate.get(env, "/appnamespaces/{publicNamespaceName}/associated-namespaces/count", Integer.class,
159.               publicNamesapceName);
160. 
161.       return count == null ? 0 : count;
162.     }
163. 
164.     public void deleteAppNamespace(Env env, String appId, String namespaceName, String operator) {
165.       restTemplate.delete(env, "/apps/{appId}/appnamespaces/{namespaceName}?operator={operator}", appId, namespaceName,
166.           operator);
167.     }
168.   }
169. 
170.   @Service
171.   public static class ItemAPI extends API {
172. 
173.     private final ParameterizedTypeReference<PageDTO<OpenItemDTO>> openItemPageDTO =
174.             new ParameterizedTypeReference<PageDTO<OpenItemDTO>>() {};
175. 
176.     public List<ItemDTO> findItems(String appId, Env env, String clusterName, String namespaceName) {
177.       ItemDTO[] itemDTOs =
178.           restTemplate.get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items",
179.               ItemDTO[].class, appId, clusterName, namespaceName);
180.       return Arrays.asList(itemDTOs);
181.     }
182. 
183.     public List<ItemDTO> findDeletedItems(String appId, Env env, String clusterName, String namespaceName) {
184.       ItemDTO[] itemDTOs =
185.           restTemplate.get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/deleted",
186.               ItemDTO[].class, appId, clusterName, namespaceName);
187.       return Arrays.asList(itemDTOs);
188.     }
189. 
190.     public ItemDTO loadItem(Env env, String appId, String clusterName, String namespaceName, String key) {
191.       return restTemplate.get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/{key}",
192.           ItemDTO.class, appId, clusterName, namespaceName, key);
193.     }
194. 
195.     public ItemDTO loadItemByEncodeKey(Env env, String appId, String clusterName, String namespaceName, String key) {
196.       return restTemplate.get(env,
197.           "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/encodedItems/{key}",
198.           ItemDTO.class, appId, clusterName, namespaceName,
199.           new String(Base64.getEncoder().encode(key.getBytes(StandardCharsets.UTF_8))));
200.     }
201. 
202.     public ItemDTO loadItemById(Env env, long itemId) {
203.       return restTemplate.get(env, "items/{itemId}", ItemDTO.class, itemId);
204.     }
205. 
206.     public void updateItemsByChangeSet(String appId, Env env, String clusterName, String namespace,
207.         ItemChangeSets changeSets) {
208.       restTemplate.post(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/itemset",
209.           changeSets, Void.class, appId, clusterName, namespace);
210.     }
211. 
212.     public void updateItem(String appId, Env env, String clusterName, String namespace, long itemId, ItemDTO item) {
213.       restTemplate.put(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/{itemId}",
214.           item, appId, clusterName, namespace, itemId);
215. 
216.     }
217. 
218.     public ItemDTO createItem(String appId, Env env, String clusterName, String namespace, ItemDTO item) {
219.       return restTemplate.post(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items",
220.           item, ItemDTO.class, appId, clusterName, namespace);
221.     }
222. 
223.     public ItemDTO createCommentItem(String appId, Env env, String clusterName, String namespace, ItemDTO item) {
224.       return restTemplate.post(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/comment_items",
225.                                item, ItemDTO.class, appId, clusterName, namespace);
226.     }
227. 
228.     public void deleteItem(Env env, long itemId, String operator) {
229. 
230.       restTemplate.delete(env, "items/{itemId}?operator={operator}", itemId, operator);
231.     }
232. 
233.     public PageDTO<OpenItemDTO> findItemsByNamespace(String appId, Env env, String clusterName,
234.                                                      String namespaceName, int page, int size) {
235.       ResponseEntity<PageDTO<OpenItemDTO>> entity = restTemplate.get(env,
236.               "/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items-with-page?page={page}&size={size}",
237.                       openItemPageDTO, appId, clusterName, namespaceName, page, size);
238.       return entity.getBody();
239.     }
240.   }
241. 
242.   @Service
243.   public static class ClusterAPI extends API {
244. 
245.     public List<ClusterDTO> findClustersByApp(String appId, Env env) {
246.       ClusterDTO[] clusterDTOs = restTemplate.get(env, "apps/{appId}/clusters", ClusterDTO[].class,
247.           appId);
248.       return Arrays.asList(clusterDTOs);
249.     }
250. 
251.     public ClusterDTO loadCluster(String appId, Env env, String clusterName) {
252.       return restTemplate.get(env, "apps/{appId}/clusters/{clusterName}", ClusterDTO.class,
253.           appId, clusterName);
254.     }
255. 
256.     public boolean isClusterUnique(String appId, Env env, String clusterName) {
257.       return restTemplate
258.           .get(env, "apps/{appId}/cluster/{clusterName}/unique", Boolean.class,
259.               appId, clusterName);
260. 
261.     }
262. 
263.     public ClusterDTO create(Env env, ClusterDTO cluster) {
264.       return restTemplate.post(env, "apps/{appId}/clusters", cluster, ClusterDTO.class,
265.           cluster.getAppId());
266.     }
267. 
268. 
269.     public void delete(Env env, String appId, String clusterName, String operator) {
270.       restTemplate.delete(env, "apps/{appId}/clusters/{clusterName}?operator={operator}", appId, clusterName, operator);
271.     }
272.   }
273. 
274.   @Service
275.   public static class AccessKeyAPI extends API {
276. 
277.     public AccessKeyDTO create(Env env, AccessKeyDTO accessKey) {
278.       return restTemplate.post(env, "apps/{appId}/accesskeys",
279.           accessKey, AccessKeyDTO.class, accessKey.getAppId());
280.     }
281. 
282.     public List<AccessKeyDTO> findByAppId(Env env, String appId) {
283.       AccessKeyDTO[] accessKeys = restTemplate.get(env, "apps/{appId}/accesskeys",
284.           AccessKeyDTO[].class, appId);
285.       return Arrays.asList(accessKeys);
286.     }
287. 
288.     public void delete(Env env, String appId, long id, String operator) {
289.       restTemplate.delete(env, "apps/{appId}/accesskeys/{id}?operator={operator}",
290.           appId, id, operator);
291.     }
292. 
293.     public void enable(Env env, String appId, long id, String operator) {
294.       restTemplate.put(env, "apps/{appId}/accesskeys/{id}/enable?operator={operator}",
295.           null, appId, id, operator);
296.     }
297. 
298.     public void disable(Env env, String appId, long id, String operator) {
299.       restTemplate.put(env, "apps/{appId}/accesskeys/{id}/disable?operator={operator}",
300.           null, appId, id, operator);
301.     }
302.   }
303. 
304.   @Service
305.   public static class ReleaseAPI extends API {
306. 
307.     private static final Joiner JOINER = Joiner.on(",");
308. 
309.     public ReleaseDTO loadRelease(Env env, long releaseId) {
310.       return restTemplate.get(env, "releases/{releaseId}", ReleaseDTO.class, releaseId);
311.     }
312. 
313.     public List<ReleaseDTO> findReleaseByIds(Env env, Set<Long> releaseIds) {
314.       if (CollectionUtils.isEmpty(releaseIds)) {
315.         return Collections.emptyList();
316.       }
317. 
318.       ReleaseDTO[]
319.           releases =
320.           restTemplate.get(env, "/releases?releaseIds={releaseIds}", ReleaseDTO[].class, JOINER.join(releaseIds));
321.       return Arrays.asList(releases);
322. 
323.     }
324. 
325.     public List<ReleaseDTO> findAllReleases(String appId, Env env, String clusterName, String namespaceName, int page,
326.         int size) {
327.       ReleaseDTO[] releaseDTOs = restTemplate.get(
328.           env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/all?page={page}&size={size}",
329.           ReleaseDTO[].class,
330.           appId, clusterName, namespaceName, page, size);
331.       return Arrays.asList(releaseDTOs);
332.     }
333. 
334.     public List<ReleaseDTO> findActiveReleases(String appId, Env env, String clusterName, String namespaceName,
335.         int page,
336.         int size) {
337.       ReleaseDTO[] releaseDTOs = restTemplate.get(
338.           env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/active?page={page}&size={size}",
339.           ReleaseDTO[].class,
340.           appId, clusterName, namespaceName, page, size);
341.       return Arrays.asList(releaseDTOs);
342.     }
343. 
344.     public ReleaseDTO loadLatestRelease(String appId, Env env, String clusterName,
345.         String namespace) {
346.       ReleaseDTO releaseDTO = restTemplate
347.           .get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/latest",
348.               ReleaseDTO.class, appId, clusterName, namespace);
349.       return releaseDTO;
350.     }
351. 
352.     public ReleaseDTO createRelease(String appId, Env env, String clusterName, String namespace,
353.         String releaseName, String releaseComment, String operator,
354.         boolean isEmergencyPublish) {
355.       HttpHeaders headers = new HttpHeaders();
356.       headers.setContentType(MediaType.parseMediaType(MediaType.APPLICATION_FORM_URLENCODED_VALUE + ";charset=UTF-8"));
357.       MultiValueMap<String, String> parameters = new LinkedMultiValueMap<>();
358.       parameters.add("name", releaseName);
359.       parameters.add("comment", releaseComment);
360.       parameters.add("operator", operator);
361.       parameters.add("isEmergencyPublish", String.valueOf(isEmergencyPublish));
362.       HttpEntity<MultiValueMap<String, String>> entity =
363.           new HttpEntity<>(parameters, headers);
364.       ReleaseDTO response = restTemplate.post(
365.           env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases", entity,
366.           ReleaseDTO.class, appId, clusterName, namespace);
367.       return response;
368.     }
369. 
370.     public ReleaseDTO createGrayDeletionRelease(String appId, Env env, String clusterName, String namespace,
371.                                     String releaseName, String releaseComment, String operator,
372.                                     boolean isEmergencyPublish, Set<String> grayDelKeys) {
373.       HttpHeaders headers = new HttpHeaders();
374.       headers.setContentType(MediaType.parseMediaType(MediaType.APPLICATION_FORM_URLENCODED_VALUE + ";charset=UTF-8"));
375.       MultiValueMap<String, String> parameters = new LinkedMultiValueMap<>();
376.       parameters.add("releaseName", releaseName);
377.       parameters.add("comment", releaseComment);
378.       parameters.add("operator", operator);
379.       parameters.add("isEmergencyPublish", String.valueOf(isEmergencyPublish));
380.       grayDelKeys.forEach(key -> parameters.add("grayDelKeys",key));
381.       HttpEntity<MultiValueMap<String, String>> entity =
382.               new HttpEntity<>(parameters, headers);
383.       ReleaseDTO response = restTemplate.post(
384.               env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/gray-del-releases", entity,
385.               ReleaseDTO.class, appId, clusterName, namespace);
386.       return response;
387.     }
388. 
389.     public ReleaseDTO updateAndPublish(String appId, Env env, String clusterName, String namespace,
390.         String releaseName, String releaseComment, String branchName,
391.         boolean isEmergencyPublish, boolean deleteBranch, ItemChangeSets changeSets) {
392. 
393.       return restTemplate.post(env,
394.           "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/updateAndPublish?"
395.               + "releaseName={releaseName}&releaseComment={releaseComment}&branchName={branchName}"
396.               + "&deleteBranch={deleteBranch}&isEmergencyPublish={isEmergencyPublish}",
397.           changeSets, ReleaseDTO.class, appId, clusterName, namespace,
398.           releaseName, releaseComment, branchName, deleteBranch, isEmergencyPublish);
399. 
400.     }
401. 
402.     public void rollback(Env env, long releaseId, String operator) {
403.       restTemplate.put(env,
404.           "releases/{releaseId}/rollback?operator={operator}",
405.           null, releaseId, operator);
406.     }
407. 
408.     public void rollbackTo(Env env, long releaseId, long toReleaseId, String operator) {
409.       restTemplate.put(env,
410.               "releases/{releaseId}/rollback?toReleaseId={toReleaseId}&operator={operator}",
411.               null, releaseId, toReleaseId, operator);
412.     }
413.   }
414. 
415.   @Service
416.   public static class CommitAPI extends API {
417. 
418.     public List<CommitDTO> find(String appId, Env env, String clusterName, String namespaceName, int page, int size) {
419. 
420.       CommitDTO[] commitDTOs = restTemplate.get(env,
421.           "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/commit?page={page}&size={size}",
422.           CommitDTO[].class,
423.           appId, clusterName, namespaceName, page, size);
424. 
425.       return Arrays.asList(commitDTOs);
426.     }
427. 
428.     public List<CommitDTO> findByKey(String appId, Env env, String clusterName, String namespaceName, String key, int page, int size) {
429. 
430.       CommitDTO[] commitDTOs = restTemplate.get(env,
431.               "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/commit?key={key}&page={page}&size={size}",
432.               CommitDTO[].class,
433.               appId, clusterName, namespaceName, key, page, size);
434. 
435.       return Arrays.asList(commitDTOs);
436.     }
437.   }
438. 
439.   @Service
440.   public static class NamespaceLockAPI extends API {
441. 
442.     public NamespaceLockDTO getNamespaceLockOwner(String appId, Env env, String clusterName, String namespaceName) {
443.       return restTemplate.get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/lock",
444.           NamespaceLockDTO.class,
445.           appId, clusterName, namespaceName);
446. 
447.     }
448.   }
449. 
450.   @Service
451.   public static class InstanceAPI extends API {
452. 
453.     private Joiner joiner = Joiner.on(",");
454.     private ParameterizedTypeReference<PageDTO<InstanceDTO>>
455.         pageInstanceDtoType =
456.         new ParameterizedTypeReference<PageDTO<InstanceDTO>>() {
457.         };
458. 
459.     public PageDTO<InstanceDTO> getByRelease(Env env, long releaseId, int page, int size) {
460.       ResponseEntity<PageDTO<InstanceDTO>>
461.           entity =
462.           restTemplate
463.               .get(env, "/instances/by-release?releaseId={releaseId}&page={page}&size={size}", pageInstanceDtoType,
464.                   releaseId, page, size);
465.       return entity.getBody();
466. 
467.     }
468. 
469.     public List<InstanceDTO> getByReleasesNotIn(String appId, Env env, String clusterName, String namespaceName,
470.         Set<Long> releaseIds) {
471. 
472.       InstanceDTO[]
473.           instanceDTOs =
474.           restTemplate.get(env,
475.               "/instances/by-namespace-and-releases-not-in?appId={appId}&clusterName={clusterName}&namespaceName={namespaceName}&releaseIds={releaseIds}",
476.               InstanceDTO[].class, appId, clusterName, namespaceName, joiner.join(releaseIds));
477. 
478.       return Arrays.asList(instanceDTOs);
479.     }
480. 
481.     public PageDTO<InstanceDTO> getByNamespace(String appId, Env env, String clusterName, String namespaceName,
482.         String instanceAppId,
483.         int page, int size) {
484.       ResponseEntity<PageDTO<InstanceDTO>>
485.           entity =
486.           restTemplate.get(env,
487.               "/instances/by-namespace?appId={appId}"
488.                   + "&clusterName={clusterName}&namespaceName={namespaceName}&instanceAppId={instanceAppId}"
489.                   + "&page={page}&size={size}",
490.               pageInstanceDtoType, appId, clusterName, namespaceName, instanceAppId, page, size);
491.       return entity.getBody();
492.     }
493. 
494.     public int getInstanceCountByNamespace(String appId, Env env, String clusterName, String namespaceName) {
495.       Integer
496.           count =
497.           restTemplate.get(env,
498.               "/instances/by-namespace/count?appId={appId}&clusterName={clusterName}&namespaceName={namespaceName}",
499.               Integer.class, appId, clusterName, namespaceName);
500.       if (count == null) {
501.         return 0;
502.       }
503.       return count;
504.     }
505.   }
506. 
507.   @Service
508.   public static class NamespaceBranchAPI extends API {
509. 
510.     public NamespaceDTO createBranch(String appId, Env env, String clusterName,
511.         String namespaceName, String operator) {
512.       return restTemplate
513.           .post(env, "/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/branches?operator={operator}",
514.               null, NamespaceDTO.class, appId, clusterName, namespaceName, operator);
515.     }
516. 
517.     public NamespaceDTO findBranch(String appId, Env env, String clusterName,
518.         String namespaceName) {
519.       return restTemplate.get(env, "/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/branches",
520.           NamespaceDTO.class, appId, clusterName, namespaceName);
521.     }
522. 
523.     public GrayReleaseRuleDTO findBranchGrayRules(String appId, Env env, String clusterName,
524.         String namespaceName, String branchName) {
525.       return restTemplate
526.           .get(env, "/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/branches/{branchName}/rules",
527.               GrayReleaseRuleDTO.class, appId, clusterName, namespaceName, branchName);
528. 
529.     }
530. 
531.     public void updateBranchGrayRules(String appId, Env env, String clusterName,
532.         String namespaceName, String branchName, GrayReleaseRuleDTO rules) {
533.       restTemplate
534.           .put(env, "/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/branches/{branchName}/rules",
535.               rules, appId, clusterName, namespaceName, branchName);
536. 
537.     }
538. 
539.     public void deleteBranch(String appId, Env env, String clusterName,
540.         String namespaceName, String branchName, String operator) {
541.       restTemplate.delete(env,
542.           "/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/branches/{branchName}?operator={operator}",
543.           appId, clusterName, namespaceName, branchName, operator);
544.     }
545.   }
546. 
547.   @Service
548.   public static class ReleaseHistoryAPI extends API {
549. 
550.     private ParameterizedTypeReference<PageDTO<ReleaseHistoryDTO>> type =
551.         new ParameterizedTypeReference<PageDTO<ReleaseHistoryDTO>>() {
552.         };
553. 
554. 
555.     public PageDTO<ReleaseHistoryDTO> findReleaseHistoriesByNamespace(String appId, Env env, String clusterName,
556.         String namespaceName, int page, int size) {
557.       return restTemplate.get(env,
558.           "/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/histories?page={page}&size={size}",
559.           type, appId, clusterName, namespaceName, page, size).getBody();
560.     }
561. 
562.     public PageDTO<ReleaseHistoryDTO> findByReleaseIdAndOperation(Env env, long releaseId, int operation, int page,
563.         int size) {
564.       return restTemplate.get(env,
565.           "/releases/histories/by_release_id_and_operation?releaseId={releaseId}&operation={operation}&page={page}&size={size}",
566.           type, releaseId, operation, page, size).getBody();
567.     }
568. 
569.     public PageDTO<ReleaseHistoryDTO> findByPreviousReleaseIdAndOperation(Env env, long previousReleaseId,
570.         int operation, int page, int size) {
571.       return restTemplate.get(env,
572.           "/releases/histories/by_previous_release_id_and_operation?previousReleaseId={releaseId}&operation={operation}&page={page}&size={size}",
573.           type, previousReleaseId, operation, page, size).getBody();
574.     }
575. 
576.   }
577. 
578. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ItemService.java
Line number range: 1 - 367
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. 
20. import com.ctrip.framework.apollo.common.constants.GsonType;
21. import com.ctrip.framework.apollo.common.dto.*;
22. import com.ctrip.framework.apollo.common.exception.BadRequestException;
23. import com.ctrip.framework.apollo.common.utils.BeanUtils;
24. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
25. import com.ctrip.framework.apollo.openapi.utils.UrlUtils;
26. import com.ctrip.framework.apollo.openapi.dto.OpenItemDTO;
27. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI.ItemAPI;
28. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI.NamespaceAPI;
29. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI.ReleaseAPI;
30. import com.ctrip.framework.apollo.portal.environment.Env;
31. import com.ctrip.framework.apollo.core.utils.StringUtils;
32. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
33. import com.ctrip.framework.apollo.portal.component.txtresolver.ConfigTextResolver;
34. import com.ctrip.framework.apollo.portal.constant.TracerEventType;
35. import com.ctrip.framework.apollo.portal.entity.model.NamespaceTextModel;
36. import com.ctrip.framework.apollo.portal.entity.vo.ItemDiffs;
37. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceIdentifier;
38. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
39. import com.ctrip.framework.apollo.tracer.Tracer;
40. import com.google.gson.Gson;
41. import java.util.HashMap;
42. import java.util.concurrent.atomic.AtomicInteger;
43. import org.springframework.beans.factory.annotation.Qualifier;
44. import org.springframework.http.HttpStatus;
45. import org.springframework.stereotype.Service;
46. import org.springframework.util.CollectionUtils;
47. import org.springframework.web.client.HttpClientErrorException;
48. 
49. import java.util.LinkedList;
50. import java.util.List;
51. import java.util.Map;
52. 
53. @Service
54. public class ItemService {
55.   private static final Gson GSON = new Gson();
56. 
57.   private final UserInfoHolder userInfoHolder;
58.   private final AdminServiceAPI.NamespaceAPI namespaceAPI;
59.   private final AdminServiceAPI.ItemAPI itemAPI;
60.   private final AdminServiceAPI.ReleaseAPI releaseAPI;
61.   private final ConfigTextResolver fileTextResolver;
62.   private final ConfigTextResolver propertyResolver;
63. 
64.   public ItemService(
65.       final UserInfoHolder userInfoHolder,
66.       final NamespaceAPI namespaceAPI,
67.       final ItemAPI itemAPI,
68.       final ReleaseAPI releaseAPI,
69.       final @Qualifier("fileTextResolver") ConfigTextResolver fileTextResolver,
70.       final @Qualifier("propertyResolver") ConfigTextResolver propertyResolver) {
71.     this.userInfoHolder = userInfoHolder;
72.     this.namespaceAPI = namespaceAPI;
73.     this.itemAPI = itemAPI;
74.     this.releaseAPI = releaseAPI;
75.     this.fileTextResolver = fileTextResolver;
76.     this.propertyResolver = propertyResolver;
77.   }
78. 
79. 
80.   /**
81.    * parse config text and update config items
82.    *
83.    * @return parse result
84.    */
85.   public void updateConfigItemByText(NamespaceTextModel model) {
86.     String appId = model.getAppId();
87.     Env env = model.getEnv();
88.     String clusterName = model.getClusterName();
89.     String namespaceName = model.getNamespaceName();
90. 
91.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
92.     if (namespace == null) {
93.       throw new BadRequestException(
94.           "namespace:" + namespaceName + " not exist in env:" + env + ", cluster:" + clusterName);
95.     }
96.     long namespaceId = namespace.getId();
97. 
98.     // In case someone constructs an attack scenario
99.     if (model.getNamespaceId() != namespaceId) {
100.       throw new BadRequestException("Invalid request, item and namespace do not match!");
101.     }
102. 
103.     String configText = model.getConfigText();
104. 
105.     ConfigTextResolver resolver =
106.         model.getFormat() == ConfigFileFormat.Properties ? propertyResolver : fileTextResolver;
107. 
108.     ItemChangeSets changeSets = resolver.resolve(namespaceId, configText,
109.         itemAPI.findItems(appId, env, clusterName, namespaceName));
110.     if (changeSets.isEmpty()) {
111.       return;
112.     }
113. 
114.     String operator = model.getOperator();
115.     if (StringUtils.isBlank(operator)) {
116.       operator = userInfoHolder.getUser().getUserId();
117.     }
118.     changeSets.setDataChangeLastModifiedBy(operator);
119. 
120.     updateItems(appId, env, clusterName, namespaceName, changeSets);
121. 
122.     Tracer.logEvent(TracerEventType.MODIFY_NAMESPACE_BY_TEXT,
123.         String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
124.     Tracer.logEvent(TracerEventType.MODIFY_NAMESPACE, String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
125.   }
126. 
127.   public void updateItems(String appId, Env env, String clusterName, String namespaceName, ItemChangeSets changeSets){
128.     itemAPI.updateItemsByChangeSet(appId, env, clusterName, namespaceName, changeSets);
129.   }
130. 
131. 
132.   public ItemDTO createItem(String appId, Env env, String clusterName, String namespaceName, ItemDTO item) {
133.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
134.     if (namespace == null) {
135.       throw new BadRequestException(
136.           "namespace:" + namespaceName + " not exist in env:" + env + ", cluster:" + clusterName);
137.     }
138.     item.setNamespaceId(namespace.getId());
139. 
140.     ItemDTO itemDTO = itemAPI.createItem(appId, env, clusterName, namespaceName, item);
141.     Tracer.logEvent(TracerEventType.MODIFY_NAMESPACE, String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
142.     return itemDTO;
143.   }
144. 
145.   public ItemDTO createCommentItem(String appId, Env env, String clusterName, String namespaceName, ItemDTO item) {
146.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
147.     if (namespace == null) {
148.       throw new BadRequestException(
149.           "namespace:" + namespaceName + " not exist in env:" + env + ", cluster:" + clusterName);
150.     }
151.     item.setNamespaceId(namespace.getId());
152. 
153.     return itemAPI.createCommentItem(appId, env, clusterName, namespaceName, item);
154.   }
155. 
156.   public void updateItem(String appId, Env env, String clusterName, String namespaceName, ItemDTO item) {
157.     itemAPI.updateItem(appId, env, clusterName, namespaceName, item.getId(), item);
158.   }
159. 
160.   public void deleteItem(Env env, long itemId, String userId) {
161.     itemAPI.deleteItem(env, itemId, userId);
162.   }
163. 
164.   public List<ItemDTO> findItems(String appId, Env env, String clusterName, String namespaceName) {
165.     return itemAPI.findItems(appId, env, clusterName, namespaceName);
166.   }
167. 
168.   public List<ItemDTO> findDeletedItems(String appId, Env env, String clusterName, String namespaceName) {
169.     return itemAPI.findDeletedItems(appId, env, clusterName, namespaceName);
170.   }
171. 
172.   public ItemDTO loadItem(Env env, String appId, String clusterName, String namespaceName, String key) {
173.     if (UrlUtils.hasIllegalChar(key)) {
174.       return itemAPI.loadItemByEncodeKey(env, appId, clusterName, namespaceName, key);
175.     }
176.     return itemAPI.loadItem(env, appId, clusterName, namespaceName, key);
177.   }
178. 
179.   public ItemDTO loadItemById(Env env, long itemId) {
180.     ItemDTO item = itemAPI.loadItemById(env, itemId);
181.     if (item == null) {
182.       throw new BadRequestException("item not found for itemId " + itemId);
183.     }
184.     return item;
185.   }
186. 
187.   public void syncItems(List<NamespaceIdentifier> comparedNamespaces, List<ItemDTO> sourceItems) {
188.     List<ItemDiffs> itemDiffs = compare(comparedNamespaces, sourceItems);
189.     for (ItemDiffs itemDiff : itemDiffs) {
190.       NamespaceIdentifier namespaceIdentifier = itemDiff.getNamespace();
191.       ItemChangeSets changeSets = itemDiff.getDiffs();
192.       changeSets.setDataChangeLastModifiedBy(userInfoHolder.getUser().getUserId());
193. 
194.       String appId = namespaceIdentifier.getAppId();
195.       Env env = namespaceIdentifier.getEnv();
196.       String clusterName = namespaceIdentifier.getClusterName();
197.       String namespaceName = namespaceIdentifier.getNamespaceName();
198. 
199.       itemAPI.updateItemsByChangeSet(appId, env, clusterName, namespaceName, changeSets);
200. 
201.       Tracer.logEvent(TracerEventType.SYNC_NAMESPACE, String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
202.     }
203.   }
204. 
205. 
206.   public void revokeItem(String appId, Env env, String clusterName, String namespaceName) {
207. 
208.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
209.     if (namespace == null) {
210.       throw new BadRequestException(
211.           "namespace:" + namespaceName + " not exist in env:" + env + ", cluster:" + clusterName);
212.     }
213.     long namespaceId = namespace.getId();
214. 
215.     Map<String, String> releaseItemDTOs = new HashMap<>();
216.     ReleaseDTO latestRelease = releaseAPI.loadLatestRelease(appId,env,clusterName,namespaceName);
217.     if (latestRelease != null) {
218.       releaseItemDTOs = GSON.fromJson(latestRelease.getConfigurations(), GsonType.CONFIG);
219.     }
220.     List<ItemDTO> baseItems = itemAPI.findItems(appId, env, clusterName, namespaceName);
221.     Map<String, ItemDTO> oldKeyMapItem = BeanUtils.mapByKey("key", baseItems);
222.     Map<String, ItemDTO> deletedItemDTOs = new HashMap<>();
223. 
224.     //deleted items for comment
225.     findDeletedItems(appId, env, clusterName, namespaceName).forEach(item -> {
226.       deletedItemDTOs.put(item.getKey(),item);
227.     });
228. 
229.     ItemChangeSets changeSets = new ItemChangeSets();
230.     AtomicInteger lineNum = new AtomicInteger(1);
231.     releaseItemDTOs.forEach((key,value) -> {
232.       ItemDTO oldItem = oldKeyMapItem.get(key);
233.       if (oldItem == null) {
234.         ItemDTO deletedItemDto = deletedItemDTOs.computeIfAbsent(key, k -> new ItemDTO());
235.         changeSets.addCreateItem(buildNormalItem(0L, namespaceId,key,value,deletedItemDto.getComment(),lineNum.get()));
236.       } else if (!oldItem.getValue().equals(value) || lineNum.get() != oldItem
237.           .getLineNum()) {
238.         changeSets.addUpdateItem(buildNormalItem(oldItem.getId(), namespaceId, key,
239.             value, oldItem.getComment(), lineNum.get()));
240.       }
241.       oldKeyMapItem.remove(key);
242.       lineNum.set(lineNum.get() + 1);
243.     });
244.     oldKeyMapItem.forEach((key, value) -> changeSets.addDeleteItem(oldKeyMapItem.get(key)));
245.     changeSets.setDataChangeLastModifiedBy(userInfoHolder.getUser().getUserId());
246. 
247.     updateItems(appId, env, clusterName, namespaceName, changeSets);
248. 
249.     String formatStr = String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName);
250.     Tracer.logEvent(TracerEventType.MODIFY_NAMESPACE_BY_TEXT, formatStr);
251.     Tracer.logEvent(TracerEventType.MODIFY_NAMESPACE, formatStr);
252.   }
253. 
254.   public List<ItemDiffs> compare(List<NamespaceIdentifier> comparedNamespaces, List<ItemDTO> sourceItems) {
255. 
256.     List<ItemDiffs> result = new LinkedList<>();
257. 
258.     for (NamespaceIdentifier namespace : comparedNamespaces) {
259. 
260.       ItemDiffs itemDiffs = new ItemDiffs(namespace);
261.       try {
262.         itemDiffs.setDiffs(parseChangeSets(namespace, sourceItems));
263.       } catch (BadRequestException e) {
264.         itemDiffs.setDiffs(new ItemChangeSets());
265.         itemDiffs.setExtInfo("该集群下没有名为 " + namespace.getNamespaceName() + " 的namespace");
266.       }
267.       result.add(itemDiffs);
268.     }
269. 
270.     return result;
271.   }
272. 
273.   public PageDTO<OpenItemDTO> findItemsByNamespace(String appId, Env env, String clusterName,
274.                                                    String namespaceName, int page, int size) {
275.     return itemAPI.findItemsByNamespace(appId, env, clusterName, namespaceName, page, size);
276.   }
277. 
278.   private long getNamespaceId(NamespaceIdentifier namespaceIdentifier) {
279.     String appId = namespaceIdentifier.getAppId();
280.     String clusterName = namespaceIdentifier.getClusterName();
281.     String namespaceName = namespaceIdentifier.getNamespaceName();
282.     Env env = namespaceIdentifier.getEnv();
283.     NamespaceDTO namespaceDTO;
284.     try {
285.       namespaceDTO = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
286.     } catch (HttpClientErrorException e) {
287.       if (e.getStatusCode() == HttpStatus.NOT_FOUND) {
288.         throw new BadRequestException(String.format(
289.             "namespace not exist. appId:%s, env:%s, clusterName:%s, namespaceName:%s", appId, env, clusterName,
290.             namespaceName));
291.       }
292.       throw e;
293.     }
294.     return namespaceDTO.getId();
295.   }
296. 
297.   private ItemChangeSets parseChangeSets(NamespaceIdentifier namespace, List<ItemDTO> sourceItems) {
298.     ItemChangeSets changeSets = new ItemChangeSets();
299.     List<ItemDTO>
300.         targetItems =
301.         itemAPI.findItems(namespace.getAppId(), namespace.getEnv(),
302.             namespace.getClusterName(), namespace.getNamespaceName());
303. 
304.     long namespaceId = getNamespaceId(namespace);
305. 
306.     if (CollectionUtils.isEmpty(targetItems)) {//all source items is added
307.       int lineNum = 1;
308.       for (ItemDTO sourceItem : sourceItems) {
309.         changeSets.addCreateItem(buildItem(namespaceId, lineNum++, sourceItem));
310.       }
311.     } else {
312.       Map<String, ItemDTO> targetItemMap = BeanUtils.mapByKey("key", targetItems);
313.       String key, sourceValue, sourceComment;
314.       ItemDTO targetItem = null;
315.       int maxLineNum = targetItems.size();//append to last
316.       for (ItemDTO sourceItem : sourceItems) {
317.         key = sourceItem.getKey();
318.         sourceValue = sourceItem.getValue();
319.         sourceComment = sourceItem.getComment();
320.         targetItem = targetItemMap.get(key);
321. 
322.         if (targetItem == null) {//added items
323. 
324.           changeSets.addCreateItem(buildItem(namespaceId, ++maxLineNum, sourceItem));
325. 
326.         } else if (isModified(sourceValue, targetItem.getValue(), sourceComment,
327.             targetItem.getComment())) {//modified items
328.           targetItem.setValue(sourceValue);
329.           targetItem.setComment(sourceComment);
330.           changeSets.addUpdateItem(targetItem);
331.         }
332.       }
333.     }
334. 
335.     return changeSets;
336.   }
337. 
338.   private ItemDTO buildItem(long namespaceId, int lineNum, ItemDTO sourceItem) {
339.     ItemDTO createdItem = new ItemDTO();
340.     BeanUtils.copyEntityProperties(sourceItem, createdItem);
341.     createdItem.setLineNum(lineNum);
342.     createdItem.setNamespaceId(namespaceId);
343.     return createdItem;
344.   }
345. 
346.   private ItemDTO buildNormalItem(Long id, Long namespaceId, String key, String value, String comment, int lineNum) {
347.     ItemDTO item = new ItemDTO(key, value, comment, lineNum);
348.     item.setId(id);
349.     item.setNamespaceId(namespaceId);
350.     return item;
351.   }
352. 
353.   private boolean isModified(String sourceValue, String targetValue, String sourceComment, String targetComment) {
354. 
355.     if (!sourceValue.equals(targetValue)) {
356.       return true;
357.     }
358. 
359.     if (sourceComment == null) {
360.       return !StringUtils.isEmpty(targetComment);
361.     }
362.     if (targetComment != null) {
363.       return !sourceComment.equals(targetComment);
364.     }
365.     return false;
366.   }
367. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 1 - 423
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.constants.GsonType;
20. import com.ctrip.framework.apollo.common.dto.ClusterDTO;
21. import com.ctrip.framework.apollo.common.dto.ItemDTO;
22. import com.ctrip.framework.apollo.common.dto.NamespaceDTO;
23. import com.ctrip.framework.apollo.common.dto.PageDTO;
24. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
25. import com.ctrip.framework.apollo.common.entity.AppNamespace;
26. import com.ctrip.framework.apollo.common.exception.BadRequestException;
27. import com.ctrip.framework.apollo.common.utils.BeanUtils;
28. import com.ctrip.framework.apollo.core.enums.ConfigFileFormat;
29. import com.ctrip.framework.apollo.core.utils.ApolloThreadFactory;
30. import com.ctrip.framework.apollo.core.utils.StringUtils;
31. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
32. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI.NamespaceAPI;
33. import com.ctrip.framework.apollo.portal.component.PortalSettings;
34. import com.ctrip.framework.apollo.portal.component.config.PortalConfig;
35. import com.ctrip.framework.apollo.portal.constant.RoleType;
36. import com.ctrip.framework.apollo.portal.constant.TracerEventType;
37. import com.ctrip.framework.apollo.portal.enricher.adapter.BaseDtoUserInfoEnrichedAdapter;
38. import com.ctrip.framework.apollo.portal.entity.bo.ItemBO;
39. import com.ctrip.framework.apollo.portal.entity.bo.NamespaceBO;
40. import com.ctrip.framework.apollo.portal.entity.vo.NamespaceUsage;
41. import com.ctrip.framework.apollo.portal.environment.Env;
42. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
43. import com.ctrip.framework.apollo.portal.util.RoleUtils;
44. import com.ctrip.framework.apollo.tracer.Tracer;
45. import com.google.common.collect.Maps;
46. import com.google.common.collect.Sets;
47. import com.google.gson.Gson;
48. import java.util.ArrayList;
49. import java.util.Collections;
50. import java.util.Comparator;
51. import java.util.HashMap;
52. import java.util.LinkedList;
53. import java.util.List;
54. import java.util.Map;
55. import java.util.Set;
56. import java.util.concurrent.CountDownLatch;
57. import java.util.concurrent.ExecutorService;
58. import java.util.concurrent.Executors;
59. import java.util.stream.Collectors;
60. import org.slf4j.Logger;
61. import org.slf4j.LoggerFactory;
62. import org.springframework.context.annotation.Lazy;
63. import org.springframework.data.domain.Pageable;
64. import org.springframework.stereotype.Service;
65. import org.springframework.transaction.annotation.Transactional;
66. 
67. @Service
68. public class NamespaceService {
69. 
70.   private static final Logger LOGGER = LoggerFactory.getLogger(NamespaceService.class);
71.   private static final Gson GSON = new Gson();
72.   private static final ExecutorService executorService = Executors.newFixedThreadPool(
73.       Runtime.getRuntime().availableProcessors() * 2
74.       , ApolloThreadFactory.create("NamespaceService", true));
75. 
76.   private final PortalConfig portalConfig;
77.   private final PortalSettings portalSettings;
78.   private final UserInfoHolder userInfoHolder;
79.   private final AdminServiceAPI.NamespaceAPI namespaceAPI;
80.   private final ItemService itemService;
81.   private final ReleaseService releaseService;
82.   private final AppNamespaceService appNamespaceService;
83.   private final InstanceService instanceService;
84.   private final NamespaceBranchService branchService;
85.   private final RolePermissionService rolePermissionService;
86.   private final AdditionalUserInfoEnrichService additionalUserInfoEnrichService;
87.   private final ClusterService clusterService;
88. 
89.   public NamespaceService(
90.       final PortalConfig portalConfig,
91.       final PortalSettings portalSettings,
92.       final UserInfoHolder userInfoHolder,
93.       final NamespaceAPI namespaceAPI,
94.       final ItemService itemService,
95.       final ReleaseService releaseService,
96.       final AppNamespaceService appNamespaceService,
97.       final InstanceService instanceService,
98.       final @Lazy NamespaceBranchService branchService,
99.       final RolePermissionService rolePermissionService,
100.       final AdditionalUserInfoEnrichService additionalUserInfoEnrichService,
101.       ClusterService clusterService) {
102.     this.portalConfig = portalConfig;
103.     this.portalSettings = portalSettings;
104.     this.userInfoHolder = userInfoHolder;
105.     this.namespaceAPI = namespaceAPI;
106.     this.itemService = itemService;
107.     this.releaseService = releaseService;
108.     this.appNamespaceService = appNamespaceService;
109.     this.instanceService = instanceService;
110.     this.branchService = branchService;
111.     this.rolePermissionService = rolePermissionService;
112.     this.additionalUserInfoEnrichService = additionalUserInfoEnrichService;
113.     this.clusterService = clusterService;
114.   }
115. 
116. 
117.   public NamespaceDTO createNamespace(Env env, NamespaceDTO namespace) {
118.     if (StringUtils.isEmpty(namespace.getDataChangeCreatedBy())) {
119.       namespace.setDataChangeCreatedBy(userInfoHolder.getUser().getUserId());
120.     }
121. 
122.     if (StringUtils.isEmpty(namespace.getDataChangeLastModifiedBy())) {
123.       namespace.setDataChangeLastModifiedBy(userInfoHolder.getUser().getUserId());
124.     }
125.     NamespaceDTO createdNamespace = namespaceAPI.createNamespace(env, namespace);
126. 
127.     Tracer.logEvent(TracerEventType.CREATE_NAMESPACE,
128.         String.format("%s+%s+%s+%s", namespace.getAppId(), env, namespace.getClusterName(),
129.             namespace.getNamespaceName()));
130.     return createdNamespace;
131.   }
132. 
133. 
134.   public List<NamespaceUsage> getNamespaceUsageByAppId(String appId, String namespaceName) {
135.     List<Env> envs = portalSettings.getActiveEnvs();
136.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);
137.     List<NamespaceUsage> usages = new ArrayList<>();
138.     for (Env env : envs) {
139.       List<ClusterDTO> clusters = clusterService.findClusters(env, appId);
140.       for (ClusterDTO cluster : clusters) {
141.         String clusterName = cluster.getName();
142.         NamespaceUsage usage = this.getNamespaceUsageByEnv(appId, namespaceName, env, clusterName);
143.         if (appNamespace != null && appNamespace.isPublic()) {
144.           int associatedNamespace = this.getPublicAppNamespaceHasAssociatedNamespace(namespaceName, env);
145.           usage.setLinkedNamespaceCount(associatedNamespace);
146.         }
147. 
148.         if(usage.getLinkedNamespaceCount() > 0 || usage.getBranchInstanceCount() > 0 || usage.getInstanceCount() > 0) {
149.           usages.add(usage);
150.         }
151.       }
152.     }
153.     return usages;
154.   }
155. 
156.   public NamespaceUsage getNamespaceUsageByEnv(String appId, String namespaceName, Env env, String clusterName) {
157.     NamespaceUsage namespaceUsage = new NamespaceUsage(namespaceName, appId, clusterName, env.getName());
158.     int instanceCount = instanceService.getInstanceCountByNamespace(appId, env, clusterName, namespaceName);
159.     namespaceUsage.setInstanceCount(instanceCount);
160. 
161.     NamespaceDTO branchNamespace = branchService.findBranchBaseInfo(appId, env, clusterName, namespaceName);
162.     if(branchNamespace != null){
163.       String branchClusterName = branchNamespace.getClusterName();
164.       int branchInstanceCount = instanceService.getInstanceCountByNamespace(appId, env, branchClusterName, namespaceName);
165.       namespaceUsage.setBranchInstanceCount(branchInstanceCount);
166.     }
167.     return namespaceUsage;
168.   }
169. 
170.   @Transactional
171.   public void deleteNamespace(String appId, Env env, String clusterName, String namespaceName) {
172. 
173.     String operator = userInfoHolder.getUser().getUserId();
174.     namespaceAPI.deleteNamespace(env, appId, clusterName, namespaceName, operator);
175.   }
176. 
177.   public NamespaceDTO loadNamespaceBaseInfo(String appId, Env env, String clusterName,
178.       String namespaceName) {
179.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
180.     if (namespace == null) {
181.       throw new BadRequestException(String.format("Namespace: %s not exist.", namespaceName));
182.     }
183.     return namespace;
184.   }
185. 
186.   /**
187.    * load cluster all namespace info with items
188.    */
189.   public List<NamespaceBO> findNamespaceBOs(String appId, Env env, String clusterName) {
190. 
191.     List<NamespaceDTO> namespaces = namespaceAPI.findNamespaceByCluster(appId, env, clusterName);
192.     if (namespaces == null || namespaces.size() == 0) {
193.       throw new BadRequestException("namespaces not exist");
194.     }
195. 
196.     List<NamespaceBO> namespaceBOs = Collections.synchronizedList(new LinkedList<>());
197.     List<String> exceptionNamespaces = Collections.synchronizedList(new LinkedList<>());
198.     CountDownLatch latch = new CountDownLatch(namespaces.size());
199.     for (NamespaceDTO namespace : namespaces) {
200.       executorService.submit(() -> {
201.         NamespaceBO namespaceBO;
202.         try {
203.           namespaceBO = transformNamespace2BO(env, namespace);
204.           namespaceBOs.add(namespaceBO);
205.         } catch (Exception e) {
206.           LOGGER.error("parse namespace error. app id:{}, env:{}, clusterName:{}, namespace:{}",
207.               appId, env, clusterName, namespace.getNamespaceName(), e);
208.           exceptionNamespaces.add(namespace.getNamespaceName());
209.         } finally {
210.           latch.countDown();
211.         }
212.       });
213. 
214.     }
215.     try {
216.       latch.await();
217.     } catch (InterruptedException e) {
218.       //ignore
219.     }
220. 
221.     if(namespaceBOs.size() != namespaces.size()){
222.        throw new RuntimeException(String
223.            .format("Parse namespaces error, expected: %s, but actual: %s, cannot get those namespaces: %s", namespaces.size(), namespaceBOs.size(), exceptionNamespaces));
224.     }
225. 
226.     return namespaceBOs.stream()
227.         .sorted(Comparator.comparing(o -> o.getBaseInfo().getId()))
228.         .collect(Collectors.toList());
229.   }
230. 
231.   public List<NamespaceDTO> findNamespaces(String appId, Env env, String clusterName) {
232.     return namespaceAPI.findNamespaceByCluster(appId, env, clusterName);
233.   }
234. 
235.   /**
236.    * the returned content's size is not fixed. so please carefully used.
237.    */
238.   public PageDTO<NamespaceDTO> findNamespacesByItem(Env env, String itemKey, Pageable pageable) {
239.     return namespaceAPI.findByItem(env, itemKey, pageable.getPageNumber(), pageable.getPageSize());
240.   }
241. 
242.   public List<NamespaceDTO> getPublicAppNamespaceAllNamespaces(Env env, String publicNamespaceName,
243.       int page,
244.       int size) {
245.     return namespaceAPI.getPublicAppNamespaceAllNamespaces(env, publicNamespaceName, page, size);
246.   }
247. 
248.   public NamespaceBO loadNamespaceBO(String appId, Env env, String clusterName,
249.       String namespaceName) {
250.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
251.     if (namespace == null) {
252.       throw new BadRequestException("namespaces not exist");
253.     }
254.     return transformNamespace2BO(env, namespace);
255.   }
256. 
257.   public boolean publicAppNamespaceHasAssociatedNamespace(String publicNamespaceName, Env env) {
258.     return getPublicAppNamespaceHasAssociatedNamespace(publicNamespaceName, env) > 0;
259.   }
260. 
261.   public int getPublicAppNamespaceHasAssociatedNamespace(String publicNamespaceName, Env env) {
262.     return namespaceAPI.countPublicAppNamespaceAssociatedNamespaces(env, publicNamespaceName);
263.   }
264. 
265.   public NamespaceBO findPublicNamespaceForAssociatedNamespace(Env env, String appId,
266.       String clusterName, String namespaceName) {
267.     NamespaceDTO namespace =
268.         namespaceAPI
269.             .findPublicNamespaceForAssociatedNamespace(env, appId, clusterName, namespaceName);
270. 
271.     return transformNamespace2BO(env, namespace);
272.   }
273. 
274.   public Map<String, Map<String, Boolean>> getNamespacesPublishInfo(String appId) {
275.     Map<String, Map<String, Boolean>> result = Maps.newHashMap();
276. 
277.     Set<Env> envs = portalConfig.publishTipsSupportedEnvs();
278.     for (Env env : envs) {
279.       if (portalSettings.isEnvActive(env)) {
280.         result.put(env.toString(), namespaceAPI.getNamespacePublishInfo(env, appId));
281.       }
282.     }
283. 
284.     return result;
285.   }
286. 
287.   private NamespaceBO transformNamespace2BO(Env env, NamespaceDTO namespace) {
288.     NamespaceBO namespaceBO = new NamespaceBO();
289.     namespaceBO.setBaseInfo(namespace);
290. 
291.     String appId = namespace.getAppId();
292.     String clusterName = namespace.getClusterName();
293.     String namespaceName = namespace.getNamespaceName();
294. 
295.     fillAppNamespaceProperties(namespaceBO);
296. 
297.     List<ItemBO> itemBOs = new LinkedList<>();
298.     namespaceBO.setItems(itemBOs);
299. 
300.     //latest Release
301.     ReleaseDTO latestRelease;
302.     Map<String, String> releaseItems = new HashMap<>();
303.     Map<String, ItemDTO> deletedItemDTOs = new HashMap<>();
304.     latestRelease = releaseService.loadLatestRelease(appId, env, clusterName, namespaceName);
305.     if (latestRelease != null) {
306.       releaseItems = GSON.fromJson(latestRelease.getConfigurations(), GsonType.CONFIG);
307.     }
308. 
309.     //not Release config items
310.     List<ItemDTO> items = itemService.findItems(appId, env, clusterName, namespaceName);
311.     additionalUserInfoEnrichService
312.         .enrichAdditionalUserInfo(items, BaseDtoUserInfoEnrichedAdapter::new);
313.     int modifiedItemCnt = 0;
314.     for (ItemDTO itemDTO : items) {
315. 
316.       ItemBO itemBO = transformItem2BO(itemDTO, releaseItems);
317. 
318.       if (itemBO.isModified()) {
319.         modifiedItemCnt++;
320.       }
321. 
322.       itemBOs.add(itemBO);
323.     }
324. 
325.     //deleted items
326.     itemService.findDeletedItems(appId, env, clusterName, namespaceName).forEach(item -> {
327.       deletedItemDTOs.put(item.getKey(),item);
328.     });
329. 
330.     List<ItemBO> deletedItems = parseDeletedItems(items, releaseItems, deletedItemDTOs);
331.     itemBOs.addAll(deletedItems);
332.     modifiedItemCnt += deletedItems.size();
333. 
334.     namespaceBO.setItemModifiedCnt(modifiedItemCnt);
335. 
336.     return namespaceBO;
337.   }
338. 
339.   private void fillAppNamespaceProperties(NamespaceBO namespace) {
340. 
341.     final NamespaceDTO namespaceDTO = namespace.getBaseInfo();
342.     final String appId = namespaceDTO.getAppId();
343.     final String clusterName = namespaceDTO.getClusterName();
344.     final String namespaceName = namespaceDTO.getNamespaceName();
345.     //先从当前appId下面找,包含私有的和公共的
346.     AppNamespace appNamespace =
347.         appNamespaceService
348.             .findByAppIdAndName(appId, namespaceName);
349.     //再从公共的app namespace里面找
350.     if (appNamespace == null) {
351.       appNamespace = appNamespaceService.findPublicAppNamespace(namespaceName);
352.     }
353. 
354.     final String format;
355.     final boolean isPublic;
356.     if (appNamespace == null) {
357.       //dirty data
358.       LOGGER.warn("Dirty data, cannot find appNamespace by namespaceName [{}], appId = {}, cluster = {}, set it format to {}, make public", namespaceName, appId, clusterName, ConfigFileFormat.Properties.getValue());
359.       format = ConfigFileFormat.Properties.getValue();
360.       isPublic = true; // set to true, because public namespace allowed to delete by user
361.     } else {
362.       format = appNamespace.getFormat();
363.       isPublic = appNamespace.isPublic();
364.       namespace.setParentAppId(appNamespace.getAppId());
365.       namespace.setComment(appNamespace.getComment());
366.     }
367.     namespace.setFormat(format);
368.     namespace.setPublic(isPublic);
369.   }
370. 
371.   private List<ItemBO> parseDeletedItems(List<ItemDTO> newItems, Map<String, String> releaseItems, Map<String, ItemDTO> deletedItemDTOs) {
372.     Map<String, ItemDTO> newItemMap = BeanUtils.mapByKey("key", newItems);
373. 
374.     List<ItemBO> deletedItems = new LinkedList<>();
375.     for (Map.Entry<String, String> entry : releaseItems.entrySet()) {
376.       String key = entry.getKey();
377.       if (newItemMap.get(key) == null) {
378.         ItemBO deletedItem = new ItemBO();
379. 
380.         deletedItem.setDeleted(true);
381.         ItemDTO deletedItemDto = deletedItemDTOs.computeIfAbsent(key, k -> new ItemDTO());
382.         deletedItemDto.setKey(key);
383.         String oldValue = entry.getValue();
384.         deletedItem.setItem(deletedItemDto);
385. 
386.         deletedItemDto.setValue(oldValue);
387.         deletedItem.setModified(true);
388.         deletedItem.setOldValue(oldValue);
389.         deletedItem.setNewValue("");
390.         deletedItems.add(deletedItem);
391.       }
392.     }
393.     return deletedItems;
394.   }
395. 
396.   private ItemBO transformItem2BO(ItemDTO itemDTO, Map<String, String> releaseItems) {
397.     String key = itemDTO.getKey();
398.     ItemBO itemBO = new ItemBO();
399.     itemBO.setItem(itemDTO);
400.     String newValue = itemDTO.getValue();
401.     String oldValue = releaseItems.get(key);
402.     //new item or modified
403.     if (!StringUtils.isEmpty(key) && (!newValue.equals(oldValue))) {
404.       itemBO.setModified(true);
405.       itemBO.setOldValue(oldValue == null ? "" : oldValue);
406.       itemBO.setNewValue(newValue);
407.     }
408.     return itemBO;
409.   }
410. 
411.   public void assignNamespaceRoleToOperator(String appId, String namespaceName, String operator) {
412.     //default assign modify、release namespace role to namespace creator
413. 
414.     rolePermissionService
415.         .assignRoleToUsers(
416.             RoleUtils.buildNamespaceRoleName(appId, namespaceName, RoleType.MODIFY_NAMESPACE),
417.             Sets.newHashSet(operator), operator);
418.     rolePermissionService
419.         .assignRoleToUsers(
420.             RoleUtils.buildNamespaceRoleName(appId, namespaceName, RoleType.RELEASE_NAMESPACE),
421.             Sets.newHashSet(operator), operator);
422.   }
423. }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ReleaseService.java
Line number range: 1 - 219
Content:
1. /*
2.  * Copyright 2022 Apollo Authors
3.  *
4.  * Licensed under the Apache License, Version 2.0 (the "License");
5.  * you may not use this file except in compliance with the License.
6.  * You may obtain a copy of the License at
7.  *
8.  * http://www.apache.org/licenses/LICENSE-2.0
9.  *
10.  * Unless required by applicable law or agreed to in writing, software
11.  * distributed under the License is distributed on an "AS IS" BASIS,
12.  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
13.  * See the License for the specific language governing permissions and
14.  * limitations under the License.
15.  *
16.  */
17. package com.ctrip.framework.apollo.portal.service;
18. 
19. import com.ctrip.framework.apollo.common.constants.GsonType;
20. import com.ctrip.framework.apollo.common.dto.ItemChangeSets;
21. import com.ctrip.framework.apollo.common.dto.ReleaseDTO;
22. import com.ctrip.framework.apollo.portal.environment.Env;
23. import com.ctrip.framework.apollo.core.utils.StringUtils;
24. import com.ctrip.framework.apollo.portal.api.AdminServiceAPI;
25. import com.ctrip.framework.apollo.portal.constant.TracerEventType;
26. import com.ctrip.framework.apollo.portal.entity.bo.KVEntity;
27. import com.ctrip.framework.apollo.portal.entity.bo.ReleaseBO;
28. import com.ctrip.framework.apollo.portal.entity.model.NamespaceGrayDelReleaseModel;
29. import com.ctrip.framework.apollo.portal.entity.model.NamespaceReleaseModel;
30. import com.ctrip.framework.apollo.portal.entity.vo.ReleaseCompareResult;
31. import com.ctrip.framework.apollo.portal.enums.ChangeType;
32. import com.ctrip.framework.apollo.portal.spi.UserInfoHolder;
33. import com.ctrip.framework.apollo.tracer.Tracer;
34. import com.google.common.base.Objects;
35. import com.google.gson.Gson;
36. import org.springframework.stereotype.Service;
37. import org.springframework.util.CollectionUtils;
38. 
39. import java.util.Collections;
40. import java.util.HashMap;
41. import java.util.HashSet;
42. import java.util.LinkedHashSet;
43. import java.util.LinkedList;
44. import java.util.List;
45. import java.util.Map;
46. import java.util.Set;
47. 
48. @Service
49. public class ReleaseService {
50. 
51.   private static final Gson GSON = new Gson();
52. 
53.   private final UserInfoHolder userInfoHolder;
54.   private final AdminServiceAPI.ReleaseAPI releaseAPI;
55. 
56.   public ReleaseService(final UserInfoHolder userInfoHolder, final AdminServiceAPI.ReleaseAPI releaseAPI) {
57.     this.userInfoHolder = userInfoHolder;
58.     this.releaseAPI = releaseAPI;
59.   }
60. 
61.   public ReleaseDTO publish(NamespaceReleaseModel model) {
62.     Env env = model.getEnv();
63.     boolean isEmergencyPublish = model.isEmergencyPublish();
64.     String appId = model.getAppId();
65.     String clusterName = model.getClusterName();
66.     String namespaceName = model.getNamespaceName();
67.     String releaseBy = StringUtils.isEmpty(model.getReleasedBy()) ?
68.                        userInfoHolder.getUser().getUserId() : model.getReleasedBy();
69. 
70.     ReleaseDTO releaseDTO = releaseAPI.createRelease(appId, env, clusterName, namespaceName,
71.                                                      model.getReleaseTitle(), model.getReleaseComment(),
72.                                                      releaseBy, isEmergencyPublish);
73. 
74.     Tracer.logEvent(TracerEventType.RELEASE_NAMESPACE,
75.                     String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
76. 
77.     return releaseDTO;
78.   }
79. 
80.   //gray deletion release
81.   public ReleaseDTO publish(NamespaceGrayDelReleaseModel model, String releaseBy) {
82.     Env env = model.getEnv();
83.     boolean isEmergencyPublish = model.isEmergencyPublish();
84.     String appId = model.getAppId();
85.     String clusterName = model.getClusterName();
86.     String namespaceName = model.getNamespaceName();
87. 
88.     ReleaseDTO releaseDTO = releaseAPI.createGrayDeletionRelease(appId, env, clusterName, namespaceName,
89.             model.getReleaseTitle(), model.getReleaseComment(),
90.             releaseBy, isEmergencyPublish, model.getGrayDelKeys());
91. 
92.     Tracer.logEvent(TracerEventType.RELEASE_NAMESPACE,
93.             String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
94. 
95.     return releaseDTO;
96.   }
97. 
98.   public ReleaseDTO updateAndPublish(String appId, Env env, String clusterName, String namespaceName,
99.                                      String releaseTitle, String releaseComment, String branchName,
100.                                      boolean isEmergencyPublish, boolean deleteBranch, ItemChangeSets changeSets) {
101. 
102.     return releaseAPI.updateAndPublish(appId, env, clusterName, namespaceName, releaseTitle, releaseComment, branchName,
103.                                        isEmergencyPublish, deleteBranch, changeSets);
104.   }
105. 
106.   public List<ReleaseBO> findAllReleases(String appId, Env env, String clusterName, String namespaceName, int page,
107.                                          int size) {
108.     List<ReleaseDTO> releaseDTOs = releaseAPI.findAllReleases(appId, env, clusterName, namespaceName, page, size);
109. 
110.     if (CollectionUtils.isEmpty(releaseDTOs)) {
111.       return Collections.emptyList();
112.     }
113. 
114.     List<ReleaseBO> releases = new LinkedList<>();
115.     for (ReleaseDTO releaseDTO : releaseDTOs) {
116.       ReleaseBO release = new ReleaseBO();
117.       release.setBaseInfo(releaseDTO);
118. 
119.       Set<KVEntity> kvEntities = new LinkedHashSet<>();
120.       Map<String, String> configurations = GSON.fromJson(releaseDTO.getConfigurations(), GsonType.CONFIG);
121.       Set<Map.Entry<String, String>> entries = configurations.entrySet();
122.       for (Map.Entry<String, String> entry : entries) {
123.         kvEntities.add(new KVEntity(entry.getKey(), entry.getValue()));
124.       }
125.       release.setItems(kvEntities);
126.       //为了减少数据量
127.       releaseDTO.setConfigurations("");
128.       releases.add(release);
129.     }
130. 
131.     return releases;
132.   }
133. 
134.   public List<ReleaseDTO> findActiveReleases(String appId, Env env, String clusterName, String namespaceName, int page,
135.                                              int size) {
136.     return releaseAPI.findActiveReleases(appId, env, clusterName, namespaceName, page, size);
137.   }
138. 
139.   public ReleaseDTO findReleaseById(Env env, long releaseId) {
140.     Set<Long> releaseIds = new HashSet<>(1);
141.     releaseIds.add(releaseId);
142.     List<ReleaseDTO> releases = findReleaseByIds(env, releaseIds);
143.     if (CollectionUtils.isEmpty(releases)) {
144.       return null;
145.     }
146.     return releases.get(0);
147. 
148.   }
149. 
150.   public List<ReleaseDTO> findReleaseByIds(Env env, Set<Long> releaseIds) {
151.     return releaseAPI.findReleaseByIds(env, releaseIds);
152.   }
153. 
154.   public ReleaseDTO loadLatestRelease(String appId, Env env, String clusterName, String namespaceName) {
155.     return releaseAPI.loadLatestRelease(appId, env, clusterName, namespaceName);
156.   }
157. 
158.   public void rollback(Env env, long releaseId, String operator) {
159.     releaseAPI.rollback(env, releaseId, operator);
160.   }
161. 
162.   public void rollbackTo(Env env, long releaseId, long toReleaseId, String operator) {
163.     releaseAPI.rollbackTo(env, releaseId, toReleaseId, operator);
164.   }
165. 
166.   public ReleaseCompareResult compare(Env env, long baseReleaseId, long toCompareReleaseId) {
167. 
168.     ReleaseDTO baseRelease = null;
169.     ReleaseDTO toCompareRelease = null;
170.     if (baseReleaseId != 0) {
171.       baseRelease = releaseAPI.loadRelease(env, baseReleaseId);
172.     }
173. 
174.     if (toCompareReleaseId != 0) {
175.       toCompareRelease = releaseAPI.loadRelease(env, toCompareReleaseId);
176.     }
177. 
178.     return compare(baseRelease, toCompareRelease);
179.   }
180. 
181.   public ReleaseCompareResult compare(ReleaseDTO baseRelease, ReleaseDTO toCompareRelease) {
182.     Map<String, String> baseReleaseConfiguration = baseRelease == null ? new HashMap<>() :
183.                                                    GSON.fromJson(baseRelease.getConfigurations(), GsonType.CONFIG);
184.     Map<String, String> toCompareReleaseConfiguration = toCompareRelease == null ? new HashMap<>() :
185.                                                         GSON.fromJson(toCompareRelease.getConfigurations(),
186.                                                                       GsonType.CONFIG);
187. 
188.     ReleaseCompareResult compareResult = new ReleaseCompareResult();
189. 
190.     //added and modified in firstRelease
191.     for (Map.Entry<String, String> entry : baseReleaseConfiguration.entrySet()) {
192.       String key = entry.getKey();
193.       String firstValue = entry.getValue();
194.       String secondValue = toCompareReleaseConfiguration.get(key);
195.       //added
196.       if (secondValue == null) {
197.         compareResult.addEntityPair(ChangeType.DELETED, new KVEntity(key, firstValue),
198.                                     new KVEntity(key, null));
199.       } else if (!Objects.equal(firstValue, secondValue)) {
200.         compareResult.addEntityPair(ChangeType.MODIFIED, new KVEntity(key, firstValue),
201.                                     new KVEntity(key, secondValue));
202.       }
203. 
204.     }
205. 
206.     //deleted in firstRelease
207.     for (Map.Entry<String, String> entry : toCompareReleaseConfiguration.entrySet()) {
208.       String key = entry.getKey();
209.       String value = entry.getValue();
210.       if (baseReleaseConfiguration.get(key) == null) {
211.         compareResult
212.             .addEntityPair(ChangeType.ADDED, new KVEntity(key, ""), new KVEntity(key, value));
213.       }
214. 
215.     }
216. 
217.     return compareResult;
218.   }
219. }

--- END CONTEXT ---

REMEMBER: Your task is to summarize the relevant contexts to the given query and return it in the specified format!

2025-11-12 12:03:45,288 - thread-135845287823040.prometheus.lang_graph.nodes.context_extraction_node - DEBUG - Model response: context=[ContextOutput(reasoning='1. Query requirement analysis:\n- Needs apollo-adminservice ItemController endpoints that accept namespaceName in the path\n2. Extended relevance:\n- Shows how namespaceName is passed through create, comment, update, list, and retrieval endpoints and contributes to commits\n- Critical for tracing namespace handling for items', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java', start_line=69, end_line=93), ContextOutput(reasoning='1. Query requirement analysis:\n- Include adminservice ItemController endpoints with namespaceName in path\n2. Extended relevance:\n- Comment item creation path includes namespaceName and inspects existing items within that namespace', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java', start_line=95, end_line=119), ContextOutput(reasoning='1. Query requirement analysis:\n- Update item endpoint with namespaceName in path\n2. Extended relevance:\n- Validates namespace via NamespaceService.findOne(appId, clusterName, namespaceName) and constructs commit with namespaceName, crucial for tracing request flow', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java', start_line=122, end_line=167), ContextOutput(reasoning='1. Query requirement analysis:\n- List items under specific namespace\n2. Extended relevance:\n- Demonstrates how namespaceName is used to fetch ordered items', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java', start_line=190, end_line=195), ContextOutput(reasoning='1. Query requirement analysis:\n- Fetch deleted items under namespace\n2. Extended relevance:\n- Uses namespaceName for release and commit lookup, necessary for tracing deletions', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java', start_line=197, end_line=218), ContextOutput(reasoning='1. Query requirement analysis:\n- Get item by key under namespace\n2. Extended relevance:\n- Uses namespaceName path segment directly to locate item', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java', start_line=229, end_line=239), ContextOutput(reasoning='1. Query requirement analysis:\n- Get item by encoded key under namespace\n2. Extended relevance:\n- Path includes namespaceName and demonstrates decoding logic before lookup', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java', start_line=241, end_line=247), ContextOutput(reasoning='1. Query requirement analysis:\n- Paged items endpoint under namespace\n2. Extended relevance:\n- Uses namespaceName to query items via ItemService.findItemsByNamespace', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java', start_line=249, end_line=257), ContextOutput(reasoning='1. Query requirement analysis:\n- Include adminservice ReleaseController endpoints with namespaceName in path\n2. Extended relevance:\n- Lists all releases per namespace', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java', start_line=90, end_line=98), ContextOutput(reasoning='1. Query requirement analysis:\n- Active releases endpoint under namespace\n2. Extended relevance:\n- Uses namespaceName for querying non-abandoned releases', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java', start_line=100, end_line=108), ContextOutput(reasoning='1. Query requirement analysis:\n- Latest release endpoint under namespace\n2. Extended relevance:\n- Retrieves latest active release using namespaceName', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java', start_line=109, end_line=115), ContextOutput(reasoning='1. Query requirement analysis:\n- Publish release endpoint under namespace\n2. Extended relevance:\n- Validates namespace through NamespaceService.findOne(appId, clusterName, namespaceName), then publish and send release message keyed by namespaceName', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java', start_line=117, end_line=144), ContextOutput(reasoning='1. Query requirement analysis:\n- Update and publish endpoint under namespace\n2. Extended relevance:\n- Uses namespaceName to find and merge branch changes, important for tracing complex flows', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java', start_line=152, end_line=182), ContextOutput(reasoning='1. Query requirement analysis:\n- Gray deletion release endpoint under namespace\n2. Extended relevance:\n- Validates namespaceName and performs gray deletion publish, sends message with namespaceName', relative_path='apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java', start_line=205, end_line=237), ContextOutput(reasoning='1. Query requirement analysis:\n- Include adminservice biz ItemService methods taking namespaceName\n2. Extended relevance:\n- Directly uses NamespaceService.findOne(appId, clusterName, namespaceName) to resolve namespaceId from namespaceName before item queries', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java', start_line=82, end_line=90), ContextOutput(reasoning='1. Query requirement analysis:\n- Item queries by (appId, clusterName, namespaceName)\n2. Extended relevance:\n- Shows how namespaceName leads to ordered item retrieval', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java', start_line=124, end_line=130), ContextOutput(reasoning='1. Query requirement analysis:\n- Paged item query with namespaceName\n2. Extended relevance:\n- Resolves namespace by namespaceName and queries repository', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java', start_line=140, end_line=144), ContextOutput(reasoning='1. Extended relevance:\n- Helper method to resolve Namespace by appId/clusterName/namespaceName and throw NotFoundException if missing\n- Critical to understand failures when an invalid namespaceName causes 404/500', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java', start_line=222, end_line=231), ContextOutput(reasoning='1. Query requirement analysis:\n- Include biz NamespaceService lookup by namespaceName\n2. Extended relevance:\n- Core resolver for namespaceName mapping to Namespace entity used across Item/Release services and controllers', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java', start_line=104, end_line=107), ContextOutput(reasoning='1. Query requirement analysis:\n- Include biz ReleaseService methods handling namespaceName\n2. Extended relevance:\n- Query methods: findLatestActiveRelease, findAllReleases, findActiveReleases, all taking namespaceName', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java', start_line=128, end_line=155), ContextOutput(reasoning='1. Query requirement analysis:\n- Release publish logic that uses namespaceName indirectly\n2. Extended relevance:\n- Publishes releases for a given Namespace, and handles parent/child namespaces; necessary to trace namespaceName usage through publish', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java', start_line=198, end_line=236), ContextOutput(reasoning='1. Query requirement analysis:\n- Gray deletion publish for namespace\n2. Extended relevance:\n- Validates parent namespace and performs branch publish using namespaceName', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java', start_line=262, end_line=279), ContextOutput(reasoning='1. Extended relevance:\n- Release creation persists namespaceName into Release entity; critical for tracing downstream usage', relative_path='apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java', start_line=437, end_line=451), ContextOutput(reasoning='1. Query requirement analysis:\n- Portal AdminServiceAPI client methods using namespaceName in paths\n2. Extended relevance:\n- NamespaceAPI loadNamespace/deleteNamespace; central for portal-to-adminservice calls with namespaceName', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java', start_line=100, end_line=106), ContextOutput(reasoning='1. Query requirement analysis:\n- Portal AdminServiceAPI NamespaceAPI delete endpoint using namespaceName\n2. Extended relevance:\n- Demonstrates delete path building with namespaceName', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java', start_line=137, end_line=143), ContextOutput(reasoning='1. Query requirement analysis:\n- Portal AdminServiceAPI ItemAPI methods using namespaceName\n2. Extended relevance:\n- Find, load, update, create, delete items under namespace; crucial to trace portal flows', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java', start_line=176, end_line=221), ContextOutput(reasoning='1. Query requirement analysis:\n- Encoded key and itemset update endpoints include namespaceName\n2. Extended relevance:\n- Shows handling of special keys and bulk item updates within namespace', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java', start_line=195, end_line=210), ContextOutput(reasoning='1. Query requirement analysis:\n- Paged items by namespaceName in portal AdminServiceAPI\n2. Extended relevance:\n- For tracing pagination flows with namespaceName', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java', start_line=233, end_line=239), ContextOutput(reasoning='1. Query requirement analysis:\n- Portal AdminServiceAPI ReleaseAPI methods using namespaceName\n2. Extended relevance:\n- Find releases, load latest release, create release, gray deletion, updateAndPublish paths all including namespaceName', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java', start_line=325, end_line=350), ContextOutput(reasoning='1. Query requirement analysis:\n- Portal AdminServiceAPI ReleaseAPI create & gray deletion endpoints using namespaceName\n2. Extended relevance:\n- Demonstrates form POST building and usage of namespaceName in the path; key to trace publish flows', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java', start_line=352, end_line=387), ContextOutput(reasoning='1. Query requirement analysis:\n- Portal AdminServiceAPI ReleaseAPI updateAndPublish endpoint using namespaceName\n2. Extended relevance:\n- Shows complex merge-and-publish with namespaceName in path', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java', start_line=389, end_line=400), ContextOutput(reasoning='1. Query requirement analysis:\n- apollo-portal NamespaceService usage of namespaceName\n2. Extended relevance:\n- deleteNamespace and loadNamespaceBaseInfo use namespaceName in calls to AdminServiceAPI; foundational for portal handling', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', start_line=170, end_line=184), ContextOutput(reasoning='1. Extended relevance:\n- loadNamespaceBO and transformNamespace2BO pipelines use namespaceName to load items and releases via portal services; necessary to understand namespace-bound data assembly', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', start_line=248, end_line=337), ContextOutput(reasoning='1. Extended relevance:\n- fillAppNamespaceProperties uses namespaceName to retrieve AppNamespace metadata, impacting format/visibility; important when tracing namespace interpretation', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java', start_line=339, end_line=369), ContextOutput(reasoning='1. Query requirement analysis:\n- apollo-portal ItemService methods using namespaceName\n2. Extended relevance:\n- updateConfigItemByText, updateItems, create item/comment, update, delete, find/load items leverage namespaceName throughout portal-to-admin flows', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ItemService.java', start_line=85, end_line=177), ContextOutput(reasoning='1. Query requirement analysis:\n- Paged items by namespaceName in portal ItemService\n2. Extended relevance:\n- Delegates to AdminServiceAPI ItemAPI with namespaceName', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ItemService.java', start_line=273, end_line=276), ContextOutput(reasoning='1. Query requirement analysis:\n- apollo-portal ReleaseService publish flows using namespaceName\n2. Extended relevance:\n- publish, gray deletion, updateAndPublish, findAllReleases, and loadLatestRelease all involve namespaceName, key for tracing release-related errors', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ReleaseService.java', start_line=61, end_line=113), ContextOutput(reasoning='1. Query requirement analysis:\n- apollo-portal ReleaseService loadLatestRelease using namespaceName\n2. Extended relevance:\n- Retrieves latest release for a namespace, aiding trace', relative_path='apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ReleaseService.java', start_line=154, end_line=156), ContextOutput(reasoning='1. Extended relevance:\n- Helper utility used in configservice to parse and normalize namespace names\n- filterNamespaceName removes .properties suffix; normalizeNamespace resolves to canonical name via AppNamespaceServiceWithCache\n- Critical for understanding namespace name processing, especially single-dot scenarios', relative_path='apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java', start_line=35, end_line=56), ContextOutput(reasoning='1. Extended relevance:\n- Provides cached lookup for AppNamespace by appId+namespaceName and public namespace by name; used by NamespaceUtil.normalizeNamespace\n- Essential for tracing how namespaceName is normalized', relative_path='apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCache.java', start_line=92, end_line=95), ContextOutput(reasoning='1. Extended relevance:\n- Public namespace lookup method used in normalization\n- Shows case-insensitive cache behavior', relative_path='apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCache.java', start_line=112, end_line=115)]
2025-11-12 12:03:45,304 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Storing 40 contexts to memory for query: Please provide the full source of apollo-portal NamespaceService.java, ItemService.java, ReleaseService.java, and the portal API clients (AdminServiceAPI and ConfigServiceAPI), plus apollo-adminservice controllers and services for Item and Release endpoints that accept namespaceName in the path.
2025-11-12 12:03:45,623 - thread-135845287823040.prometheus.lang_graph.nodes.memory_storage_node - INFO - Successfully stored contexts to memory
2025-11-12 12:03:45,625 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - Adding 40 new contexts to 42 existing contexts
2025-11-12 12:03:45,629 - thread-135845287823040.prometheus.lang_graph.nodes.add_result_context_node - INFO - After deduplication: 76 total contexts (removed 6 duplicates)
2025-11-12 12:03:45,631 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - This is the codebase structure:
--- BEGIN FILE TREE ---
apollo
├── .github
|   ├── FUNDING.yml
|   ├── ISSUE_TEMPLATE
|   |   ├── bug_report_en.md
|   |   ├── bug_report_zh.md
|   |   ├── feature_request_en.md
|   |   └── feature_request_zh.md
|   ├── PULL_REQUEST_TEMPLATE.md
|   ├── stale.yml
|   └── workflows
|       ├── build.yml
|       ├── cla.yml
|       ├── license.yml
|       └── release.yml
├── .licenserc.yaml
├── .mvn
|   └── wrapper
|       ├── MavenWrapperDownloader.java
|       └── maven-wrapper.properties
├── CHANGES.md
├── CODE_OF_CONDUCT.md
├── CONTRIBUTING.md
├── GOVERNANCE.md
├── README.md
├── SECURITY.md
├── apollo-adminservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── adminservice.properties
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── controller
|               ├── data.sql
|               ├── filter
|               ├── import.sql
|               └── logback-test.xml
├── apollo-assembly
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── META-INF
|       |       ├── application.yml
|       |       └── logback.xml
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               └── logback-test.xml
├── apollo-biz
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── data.sql
|               ├── import.sql
|               ├── logback-test.xml
|               └── sql
├── apollo-buildtools
|   ├── pom.xml
|   ├── src
|   |   └── main
|   |       ├── resources
|   |       |   ├── LICENSE-2.0.txt
|   |       |   └── google_checks.xml
|   |       └── scripts
|   |           └── deploy_jenkins.sh
|   └── style
|       ├── eclipse-java-google-style.xml
|       └── intellij-java-google-style.xml
├── apollo-client
|   ├── doc
|   |   └── pic
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── log4j2.xml
|               ├── spring
|               └── yaml
├── apollo-client-config-data
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── application-test-compatible.properties
|               └── log4j2.xml
├── apollo-common
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       ├── application-ctrip.properties
|       |       ├── application-github.properties
|       |       ├── application.properties
|       |       ├── banner.txt
|       |       └── datasource.xml
|       └── test
|           └── java
|               └── com
├── apollo-configservice
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   └── application-github.properties
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── application-consul-discovery.properties
|       |   |   ├── application-custom-defined-discovery.properties
|       |   |   ├── application-kubernetes.properties
|       |   |   ├── application-nacos-discovery.properties
|       |   |   ├── application-zookeeper-discovery.properties
|       |   |   ├── application.yml
|       |   |   ├── configservice.properties
|       |   |   └── logback.xml
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── data.sql
|               ├── import.sql
|               ├── integration-test
|               └── logback-test.xml
├── apollo-core
|   ├── pom.xml
|   └── src
|       ├── main
|       |   ├── java
|       |   |   └── com
|       |   └── resources
|       |       └── META-INF
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── apollo-env.properties
|               ├── log4j2.xml
|               └── properties
├── apollo-mockserver
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── META-INF
|               ├── mockdata-anotherNamespace.properties
|               ├── mockdata-application.properties
|               └── mockdata-otherNamespace.properties
├── apollo-openapi
|   ├── pom.xml
|   └── src
|       ├── main
|       |   └── java
|       |       └── com
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               └── log4j2.xml
├── apollo-portal
|   ├── pom.xml
|   └── src
|       ├── assembly
|       |   └── assembly-descriptor.xml
|       ├── main
|       |   ├── config
|       |   |   ├── app.properties
|       |   |   ├── application-github.properties
|       |   |   ├── application-ldap-activedirectory-sample.yml
|       |   |   ├── application-ldap-apacheds-sample.yml
|       |   |   ├── application-ldap-openldap-sample.yml
|       |   |   └── application-oidc-sample.yml
|       |   ├── docker
|       |   |   └── Dockerfile
|       |   ├── java
|       |   |   └── com
|       |   ├── resources
|       |   |   ├── META-INF
|       |   |   ├── apollo-env.properties
|       |   |   ├── application-ctrip.yml
|       |   |   ├── application.yml
|       |   |   ├── logback.xml
|       |   |   └── static
|       |   └── scripts
|       |       ├── shutdown.sh
|       |       └── startup.sh
|       └── test
|           ├── java
|           |   └── com
|           └── resources
|               ├── application.properties
|               ├── application.yml
|               ├── import.sql
|               ├── logback-test.xml
|               ├── sql
|               └── yaml
├── changes
|   ├── changes-1.9.0.md
|   ├── changes-1.9.1.md
|   ├── changes-1.9.2.md
|   ├── changes-2.0.0.md
|   └── changes-2.0.1.md
├── doc
|   └── images
|       ├── gray-release
|       ├── local-development
|       └── logo
├── docs
|   ├── _coverpage.md
|   ├── charts
|   |   └── index.yaml
|   ├── css
|   |   ├── buble.css
|   |   ├── dark.css
|   |   ├── fonts.css
|   |   ├── pure.css
|   |   └── vue.css
|   ├── en
|   |   ├── README.md
|   |   ├── _navbar.md
|   |   ├── _sidebar.md
|   |   ├── community
|   |   |   ├── team.md
|   |   |   └── thank-you.md
|   |   ├── deployment
|   |   |   ├── deployment-architecture.md
|   |   |   ├── distributed-deployment-guide.md
|   |   |   ├── quick-start-docker.md
|   |   |   ├── quick-start.md
|   |   |   └── third-party-tool-rainbond.md
|   |   ├── design
|   |   |   ├── apollo-core-concept-namespace.md
|   |   |   ├── apollo-design.md
|   |   |   └── apollo-introduction.md
|   |   ├── development
|   |   |   ├── apollo-development-guide.md
|   |   |   ├── apollo-release-guide.md
|   |   |   ├── portal-how-to-enable-email-service.md
|   |   |   ├── portal-how-to-enable-session-store.md
|   |   |   ├── portal-how-to-enable-webhook-notification.md
|   |   |   └── portal-how-to-implement-user-login-function.md
|   |   ├── faq
|   |   |   ├── common-issues-in-deployment-and-development-phase.md
|   |   |   └── faq.md
|   |   ├── images
|   |   |   └── community
|   |   ├── misc
|   |   |   └── apollo-benchmark.md
|   |   ├── quick-start.md
|   |   └── usage
|   |       ├── apollo-open-api-platform.md
|   |       ├── apollo-user-guide.md
|   |       ├── apollo-user-practices.md
|   |       ├── dotnet-sdk-user-guide.md
|   |       ├── java-sdk-user-guide.md
|   |       ├── other-language-client-user-guide.md
|   |       └── third-party-sdks-user-guide.md
|   ├── index.html
|   ├── scripts
|   |   └── multiple-language-redirect.js
|   └── zh
|       ├── README.md
|       ├── _navbar.md
|       ├── _sidebar.md
|       ├── community
|       |   ├── team.md
|       |   └── thank-you.md
|       ├── deployment
|       |   ├── deployment-architecture.md
|       |   ├── distributed-deployment-guide.md
|       |   ├── quick-start-docker.md
|       |   ├── quick-start.md
|       |   └── third-party-tool-rainbond.md
|       ├── design
|       |   ├── apollo-core-concept-namespace.md
|       |   ├── apollo-design.md
|       |   └── apollo-introduction.md
|       ├── development
|       |   ├── apollo-development-guide.md
|       |   ├── apollo-release-guide.md
|       |   ├── portal-how-to-enable-email-service.md
|       |   ├── portal-how-to-enable-session-store.md
|       |   ├── portal-how-to-enable-webhook-notification.md
|       |   └── portal-how-to-implement-user-login-function.md
|       ├── faq
|       |   ├── common-issues-in-deployment-and-development-phase.md
|       |   └── faq.md
|       ├── images
|       |   └── community
|       ├── misc
|       |   └── apollo-benchmark.md
|       └── usage
|           ├── apollo-open-api-platform.md
|           ├── apollo-user-guide.md
|           ├── apollo-user-practices.md
|           ├── dotnet-sdk-user-guide.md
|           ├── java-sdk-user-guide.md
|           ├── other-language-client-user-guide.md
|           └── third-party-sdks-user-guide.md
├── pom.xml
└── scripts
    ├── build.sh
    ├── openapi
    |   └── bash
    |       ├── openapi-usage-example.sh
    |       └── openapi.sh
    └── sql
        ├── apolloconfigdb.sql
        ├── apolloportaldb.sql
        └── delta
            ├── v040-v050
            |   ├── apolloconfigdb-v040-v050.sql
            |   └── apolloportaldb-v040-v050.sql
            ├── v060-v062
            |   ├── apolloconfigdb-v060-v062.sql
            |   └── apolloportaldb-v060-v062.sql
            ├── v080-v090
            |   └── apolloportaldb-v080-v090.sql
            ├── v151-v160
            |   └── apolloconfigdb-v151-v160.sql
            ├── v170-v180
            |   ├── apolloconfigdb-v170-v180.sql
            |   └── apolloportaldb-v170-v180.sql
            ├── v180-v190
            |   ├── apolloconfigdb-v180-v190.sql
            |   └── apolloportaldb-v180-v190.sql
            ├── v190-v200
            |   ├── apolloconfigdb-v190-v200-after.sql
            |   ├── apolloconfigdb-v190-v200.sql
            |   ├── apolloportaldb-v190-v200-after.sql
            |   └── apolloportaldb-v190-v200.sql
            └── v200-v210
                └── apolloconfigdb-v200-v210.sql
--- END FILE TREE ---
    
This is the original user query:
--- BEGIN ORIGINAL QUERY ---
Issue title:
create namespace with single dot 500 error

Issue description: 
<!-- The content in here will not be show。To forbid duplication，easier search in the feature，before you create an issue，please check the following. If your question is a newer/beginner's，recommand to https://github.com/ctripcorp/apollo/discussions to ask it. -->

- [x] I have checked the [discussions](https://github.com/ctripcorp/apollo/discussions)
- [x] I have searched the [issues](https://github.com/ctripcorp/apollo/issues) of this repository and believe that this is not a duplicate.
- [x] I have checked the [FAQ](https://www.apolloconfig.com/#/zh/faq/common-issues-in-deployment-and-development-phase) of this repository and believe that this is not a duplicate.

**Describe the bug**
create namespace with . will crash in query namespace.


**To Reproduce**
Steps to reproduce the behavior:
1.  create namespace with single dot(.)
2. refresh namespace. 

**Expected behavior**
display normally.

**Screenshots**

https://user-images.githubusercontent.com/50099513/189686696-179451cc-00b9-433b-a2ef-f270baf848c2.mov




### Additional Details & Logs

- Latest Version (All)


Issue comments:


Find all relevant source code context and documentation needed to understand and fix this issue.
Focus on production code (ignore test files) and follow these steps:
1. Identify key components mentioned in the issue, especially from the error message(functions, classes, types, etc.)
2. Find their complete implementations and class definitions
3. Include related code from the same module that affects the behavior
4. Follow imports to find dependent code that directly impacts the issue

Skip any test files

--- END ORIGINAL QUERY ---

These are the previously asked refined queries:
--- BEGIN PREVIOUS QUERY ---
Previous refined query 1:
Essential Query: Please provide the full source of: (1) apollo-portal NamespaceController.java, AppNamespaceController.java, NamespaceService.java, AppNamespaceService.java, NamespaceBO.java, and any portal utility that parses namespace name/file format (e.g., NamespaceUtil); (2) apollo-biz AppNamespace.java, Namespace.java, AppNamespaceService.java, NamespaceService.java, and any related repository; (3) apollo-core ConfigFileFormat.java; and (4) apollo-common InputValidator.java.
Extra Requirements: If exact paths differ, share any classes that handle namespace REST endpoints, namespace name parsing/splitting by '.', and namespace/item querying logic.
Purpose: To trace namespace parsing and querying logic to reproduce and fix the 500 error when the namespace name is a single dot.

Previous refined query 2:
Essential Query: Please provide the full source of apollo-portal NamespaceService.java, ItemService.java, ReleaseService.java, and the portal API clients (AdminServiceAPI and ConfigServiceAPI), plus apollo-adminservice controllers and services for Item and Release endpoints that accept namespaceName in the path.
Extra Requirements: Include any helper utilities that parse or normalize namespace names (e.g., NamespaceUtil, AppNamespaceServiceWithCache) if they are used in these flows.
Purpose: To trace how a single-dot namespace is processed during query and identify the exact component causing the 500 error.
--- END PREVIOUS QUERY ---

All aggregated context for the queries:
--- BEGIN AGGREGATED CONTEXT ---
File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java
Line number range: 78 - 86
Content:
78.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
79.   public void delete(@PathVariable("appId") String appId, @PathVariable("namespaceName") String namespaceName,
80.       @RequestParam String operator) {
81.     AppNamespace entity = appNamespaceService.findOne(appId, namespaceName);
82.     if (entity == null) {
83.       throw new BadRequestException("app namespace not found for appId: " + appId + " namespace: " + namespaceName);
84.     }
85.     appNamespaceService.deleteAppNamespace(entity, operator);
86.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java
Line number range: 88 - 100
Content:
88.   @GetMapping("/appnamespaces/{publicNamespaceName}/namespaces")
89.   public List<NamespaceDTO> findPublicAppNamespaceAllNamespaces(@PathVariable String publicNamespaceName, Pageable pageable) {
90. 
91.     List<Namespace> namespaces = namespaceService.findPublicAppNamespaceAllNamespaces(publicNamespaceName, pageable);
92. 
93.     return BeanUtils.batchTransform(NamespaceDTO.class, namespaces);
94.   }
95. 
96.   @GetMapping("/appnamespaces/{publicNamespaceName}/associated-namespaces/count")
97.   public int countPublicAppNamespaceAssociatedNamespaces(@PathVariable String publicNamespaceName) {
98.     return namespaceService.countPublicAppNamespaceAssociatedNamespaces(publicNamespaceName);
99.   }
100. 


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java
Line number range: 69 - 93
Content:
69.   @PreAcquireNamespaceLock
70.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items")
71.   public ItemDTO create(@PathVariable("appId") String appId,
72.                         @PathVariable("clusterName") String clusterName,
73.                         @PathVariable("namespaceName") String namespaceName, @RequestBody ItemDTO dto) {
74.     Item entity = BeanUtils.transform(Item.class, dto);
75. 
76.     Item managedEntity = itemService.findOne(appId, clusterName, namespaceName, entity.getKey());
77.     if (managedEntity != null) {
78.       throw new BadRequestException("item already exists");
79.     }
80.     entity = itemService.save(entity);
81.     dto = BeanUtils.transform(ItemDTO.class, entity);
82. 
83.     Commit commit = new Commit();
84.     commit.setAppId(appId);
85.     commit.setClusterName(clusterName);
86.     commit.setNamespaceName(namespaceName);
87.     commit.setChangeSets(new ConfigChangeContentBuilder().createItem(entity).build());
88.     commit.setDataChangeCreatedBy(dto.getDataChangeLastModifiedBy());
89.     commit.setDataChangeLastModifiedBy(dto.getDataChangeLastModifiedBy());
90.     commitService.save(commit);
91. 
92.     return dto;
93.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java
Line number range: 95 - 119
Content:
95.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/comment_items")
96.   public ItemDTO createComment(@PathVariable("appId") String appId,
97.                         @PathVariable("clusterName") String clusterName,
98.                         @PathVariable("namespaceName") String namespaceName, @RequestBody ItemDTO dto) {
99.     if (!StringUtils.isBlank(dto.getKey()) || !StringUtils.isBlank(dto.getValue())) {
100.       throw new BadRequestException("Comment item's key or value should be blank.");
101.     }
102.     if (StringUtils.isBlank(dto.getComment())) {
103.       throw new BadRequestException("Comment item's comment should not be blank.");
104.     }
105. 
106.     // check if comment existed
107.     List<Item> allItems = itemService.findItemsWithOrdered(appId, clusterName, namespaceName);
108.     for (Item item : allItems) {
109.       if (StringUtils.isBlank(item.getKey()) && StringUtils.isBlank(item.getValue()) &&
110.           Objects.equals(item.getComment(), dto.getComment())) {
111.         return BeanUtils.transform(ItemDTO.class, item);
112.       }
113.     }
114. 
115.     Item entity = BeanUtils.transform(Item.class, dto);
116.     entity = itemService.saveComment(entity);
117. 
118.     return BeanUtils.transform(ItemDTO.class, entity);
119.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java
Line number range: 122 - 167
Content:
122.   @PreAcquireNamespaceLock
123.   @PutMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/{itemId}")
124.   public ItemDTO update(@PathVariable("appId") String appId,
125.                         @PathVariable("clusterName") String clusterName,
126.                         @PathVariable("namespaceName") String namespaceName,
127.                         @PathVariable("itemId") long itemId,
128.                         @RequestBody ItemDTO itemDTO) {
129.     Item managedEntity = itemService.findOne(itemId);
130.     if (managedEntity == null) {
131.       throw new NotFoundException("item not found for itemId " + itemId);
132.     }
133. 
134.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
135.     // In case someone constructs an attack scenario
136.     if (namespace == null || namespace.getId() != managedEntity.getNamespaceId()) {
137.       throw new BadRequestException("Invalid request, item and namespace do not match!");
138.     }
139. 
140.     Item entity = BeanUtils.transform(Item.class, itemDTO);
141. 
142.     ConfigChangeContentBuilder builder = new ConfigChangeContentBuilder();
143. 
144.     Item beforeUpdateItem = BeanUtils.transform(Item.class, managedEntity);
145. 
146.     //protect. only value,comment,lastModifiedBy can be modified
147.     managedEntity.setValue(entity.getValue());
148.     managedEntity.setComment(entity.getComment());
149.     managedEntity.setDataChangeLastModifiedBy(entity.getDataChangeLastModifiedBy());
150. 
151.     entity = itemService.update(managedEntity);
152.     builder.updateItem(beforeUpdateItem, entity);
153.     itemDTO = BeanUtils.transform(ItemDTO.class, entity);
154. 
155.     if (builder.hasContent()) {
156.       Commit commit = new Commit();
157.       commit.setAppId(appId);
158.       commit.setClusterName(clusterName);
159.       commit.setNamespaceName(namespaceName);
160.       commit.setChangeSets(builder.build());
161.       commit.setDataChangeCreatedBy(itemDTO.getDataChangeLastModifiedBy());
162.       commit.setDataChangeLastModifiedBy(itemDTO.getDataChangeLastModifiedBy());
163.       commitService.save(commit);
164.     }
165. 
166.     return itemDTO;
167.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java
Line number range: 190 - 195
Content:
190.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items")
191.   public List<ItemDTO> findItems(@PathVariable("appId") String appId,
192.                                  @PathVariable("clusterName") String clusterName,
193.                                  @PathVariable("namespaceName") String namespaceName) {
194.     return BeanUtils.batchTransform(ItemDTO.class, itemService.findItemsWithOrdered(appId, clusterName, namespaceName));
195.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java
Line number range: 197 - 218
Content:
197.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/deleted")
198.   public List<ItemDTO> findDeletedItems(@PathVariable("appId") String appId,
199.                                         @PathVariable("clusterName") String clusterName,
200.                                         @PathVariable("namespaceName") String namespaceName) {
201.     //get latest release time
202.     Release latestActiveRelease = releaseService.findLatestActiveRelease(appId, clusterName, namespaceName);
203.     List<Commit> commits;
204.     if (Objects.nonNull(latestActiveRelease)) {
205.       commits = commitService.find(appId, clusterName, namespaceName, latestActiveRelease.getDataChangeCreatedTime(), null);
206.     } else {
207.       commits = commitService.find(appId, clusterName, namespaceName, null);
208.     }
209. 
210.     if (Objects.nonNull(commits)) {
211.       List<Item> deletedItems = commits.stream()
212.           .map(item -> ConfigChangeContentBuilder.convertJsonString(item.getChangeSets()).getDeleteItems())
213.           .flatMap(Collection::stream)
214.           .collect(Collectors.toList());
215.       return BeanUtils.batchTransform(ItemDTO.class, deletedItems);
216.     }
217.     return Collections.emptyList();
218.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java
Line number range: 229 - 239
Content:
229.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/{key:.+}")
230.   public ItemDTO get(@PathVariable("appId") String appId,
231.       @PathVariable("clusterName") String clusterName,
232.       @PathVariable("namespaceName") String namespaceName, @PathVariable("key") String key) {
233.     Item item = itemService.findOne(appId, clusterName, namespaceName, key);
234.     if (item == null) {
235.       throw new NotFoundException("item not found for %s %s %s %s", appId, clusterName,
236.           namespaceName, key);
237.     }
238.     return BeanUtils.transform(ItemDTO.class, item);
239.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java
Line number range: 241 - 247
Content:
241.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/encodedItems/{key:.+}")
242.   public ItemDTO getByEncodedKey(@PathVariable("appId") String appId,
243.       @PathVariable("clusterName") String clusterName,
244.       @PathVariable("namespaceName") String namespaceName, @PathVariable("key") String key) {
245.     return this.get(appId, clusterName, namespaceName,
246.         new String(Base64.getUrlDecoder().decode(key.getBytes(StandardCharsets.UTF_8))));
247.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ItemController.java
Line number range: 249 - 257
Content:
249.   @GetMapping(value = "/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items-with-page")
250.   public PageDTO<ItemDTO> findItemsByNamespace(@PathVariable("appId") String appId,
251.                                                @PathVariable("clusterName") String clusterName,
252.                                                @PathVariable("namespaceName") String namespaceName,
253.                                                Pageable pageable) {
254.     Page<Item> itemPage = itemService.findItemsByNamespace(appId, clusterName, namespaceName, pageable);
255. 
256.     List<ItemDTO> itemDTOS = BeanUtils.batchTransform(ItemDTO.class, itemPage.getContent());
257.     return new PageDTO<>(itemDTOS, pageable, itemPage.getTotalElements());


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java
Line number range: 65 - 76
Content:
65.   @DeleteMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
66.   public void delete(@PathVariable("appId") String appId,
67.                      @PathVariable("clusterName") String clusterName,
68.                      @PathVariable("namespaceName") String namespaceName, @RequestParam String operator) {
69.     Namespace entity = namespaceService.findOne(appId, clusterName, namespaceName);
70.     if (entity == null) {
71.       throw new NotFoundException("namespace not found for %s %s %s", appId, clusterName,
72.           namespaceName);
73.     }
74. 
75.     namespaceService.deleteNamespace(entity, operator);
76.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java
Line number range: 97 - 104
Content:
97.   @GetMapping("/namespaces/find-by-item")
98.   public PageDTO<NamespaceDTO> findByItem(@RequestParam String itemKey, Pageable pageable) {
99.     Page<Namespace> namespacePage = namespaceService.findByItem(itemKey, pageable);
100. 
101.     List<NamespaceDTO> namespaceDTOS = BeanUtils.batchTransform(NamespaceDTO.class, namespacePage.getContent());
102. 
103.     return new PageDTO<>(namespaceDTOS, pageable, namespacePage.getTotalElements());
104.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/NamespaceController.java
Line number range: 106 - 116
Content:
106.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
107.   public NamespaceDTO get(@PathVariable("appId") String appId,
108.                           @PathVariable("clusterName") String clusterName,
109.                           @PathVariable("namespaceName") String namespaceName) {
110.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
111.     if (namespace == null) {
112.       throw new NotFoundException("namespace not found for %s %s %s", appId, clusterName,
113.           namespaceName);
114.     }
115.     return BeanUtils.transform(NamespaceDTO.class, namespace);
116.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java
Line number range: 90 - 98
Content:
90.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/all")
91.   public List<ReleaseDTO> findAllReleases(@PathVariable("appId") String appId,
92.                                           @PathVariable("clusterName") String clusterName,
93.                                           @PathVariable("namespaceName") String namespaceName,
94.                                           Pageable page) {
95.     List<Release> releases = releaseService.findAllReleases(appId, clusterName, namespaceName, page);
96.     return BeanUtils.batchTransform(ReleaseDTO.class, releases);
97.   }
98. 


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java
Line number range: 100 - 108
Content:
100.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/active")
101.   public List<ReleaseDTO> findActiveReleases(@PathVariable("appId") String appId,
102.                                              @PathVariable("clusterName") String clusterName,
103.                                              @PathVariable("namespaceName") String namespaceName,
104.                                              Pageable page) {
105.     List<Release> releases = releaseService.findActiveReleases(appId, clusterName, namespaceName, page);
106.     return BeanUtils.batchTransform(ReleaseDTO.class, releases);
107.   }
108. 


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java
Line number range: 109 - 115
Content:
109.   @GetMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/latest")
110.   public ReleaseDTO getLatest(@PathVariable("appId") String appId,
111.                               @PathVariable("clusterName") String clusterName,
112.                               @PathVariable("namespaceName") String namespaceName) {
113.     Release release = releaseService.findLatestActiveRelease(appId, clusterName, namespaceName);
114.     return BeanUtils.transform(ReleaseDTO.class, release);
115.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java
Line number range: 117 - 144
Content:
117.   @Transactional
118.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases")
119.   public ReleaseDTO publish(@PathVariable("appId") String appId,
120.                             @PathVariable("clusterName") String clusterName,
121.                             @PathVariable("namespaceName") String namespaceName,
122.                             @RequestParam("name") String releaseName,
123.                             @RequestParam(name = "comment", required = false) String releaseComment,
124.                             @RequestParam("operator") String operator,
125.                             @RequestParam(name = "isEmergencyPublish", defaultValue = "false") boolean isEmergencyPublish) {
126.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
127.     if (namespace == null) {
128.       throw new NotFoundException("Could not find namespace for %s %s %s", appId, clusterName,
129.           namespaceName);
130.     }
131.     Release release = releaseService.publish(namespace, releaseName, releaseComment, operator, isEmergencyPublish);
132. 
133.     //send release message
134.     Namespace parentNamespace = namespaceService.findParentNamespace(namespace);
135.     String messageCluster;
136.     if (parentNamespace != null) {
137.       messageCluster = parentNamespace.getClusterName();
138.     } else {
139.       messageCluster = clusterName;
140.     }
141.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, messageCluster, namespaceName),
142.                               Topics.APOLLO_RELEASE_TOPIC);
143.     return BeanUtils.transform(ReleaseDTO.class, release);
144.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java
Line number range: 152 - 182
Content:
152.   @Transactional
153.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/updateAndPublish")
154.   public ReleaseDTO updateAndPublish(@PathVariable("appId") String appId,
155.                                      @PathVariable("clusterName") String clusterName,
156.                                      @PathVariable("namespaceName") String namespaceName,
157.                                      @RequestParam("releaseName") String releaseName,
158.                                      @RequestParam("branchName") String branchName,
159.                                      @RequestParam(value = "deleteBranch", defaultValue = "true") boolean deleteBranch,
160.                                      @RequestParam(name = "releaseComment", required = false) String releaseComment,
161.                                      @RequestParam(name = "isEmergencyPublish", defaultValue = "false") boolean isEmergencyPublish,
162.                                      @RequestBody ItemChangeSets changeSets) {
163.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
164.     if (namespace == null) {
165.       throw new NotFoundException("Could not find namespace for %s %s %s", appId, clusterName,
166.           namespaceName);
167.     }
168. 
169.     Release release = releaseService.mergeBranchChangeSetsAndRelease(namespace, branchName, releaseName,
170.                                                                      releaseComment, isEmergencyPublish, changeSets);
171. 
172.     if (deleteBranch) {
173.       namespaceBranchService.deleteBranch(appId, clusterName, namespaceName, branchName,
174.                                           NamespaceBranchStatus.MERGED, changeSets.getDataChangeLastModifiedBy());
175.     }
176. 
177.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, clusterName, namespaceName),
178.                               Topics.APOLLO_RELEASE_TOPIC);
179. 
180.     return BeanUtils.transform(ReleaseDTO.class, release);
181. 
182.   }


File: apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/ReleaseController.java
Line number range: 205 - 237
Content:
205.   @Transactional
206.   @PostMapping("/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/gray-del-releases")
207.   public ReleaseDTO publish(@PathVariable("appId") String appId,
208.                             @PathVariable("clusterName") String clusterName,
209.                             @PathVariable("namespaceName") String namespaceName,
210.                             @RequestParam("operator") String operator,
211.                             @RequestParam("releaseName") String releaseName,
212.                             @RequestParam(name = "comment", required = false) String releaseComment,
213.                             @RequestParam(name = "isEmergencyPublish", defaultValue = "false") boolean isEmergencyPublish,
214.                             @RequestParam(name = "grayDelKeys") Set<String> grayDelKeys){
215.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
216.     if (namespace == null) {
217.       throw new NotFoundException("Could not find namespace for %s %s %s", appId, clusterName, 
218.           namespaceName);
219.     }
220. 
221.     Release release = releaseService.grayDeletionPublish(namespace, releaseName, releaseComment, 
222.         operator, isEmergencyPublish, grayDelKeys);
223. 
224.     //send release message
225.     Namespace parentNamespace = namespaceService.findParentNamespace(namespace);
226.     String messageCluster;
227.     if (parentNamespace != null) {
228.       messageCluster = parentNamespace.getClusterName();
229.     } else {
230.       messageCluster = clusterName;
231.     }
232.     messageSender.sendMessage(ReleaseMessageKeyGenerator.generate(appId, messageCluster, namespaceName),
233.             Topics.APOLLO_RELEASE_TOPIC);
234.     return BeanUtils.transform(ReleaseDTO.class, release);
235.   }
236. 
237. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/entity/Namespace.java
Line number range: 28 - 75
Content:
28. @Entity
29. @Table(name = "Namespace")
30. @SQLDelete(sql = "Update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000) where Id = ?")
31. @Where(clause = "isDeleted = 0")
32. public class Namespace extends BaseEntity {
33. 
34.   @Column(name = "appId", nullable = false)
35.   private String appId;
36. 
37.   @Column(name = "ClusterName", nullable = false)
38.   private String clusterName;
39. 
40.   @Column(name = "NamespaceName", nullable = false)
41.   private String namespaceName;
42. 
43.   public Namespace(){
44. 
45.   }
46. 
47.   public Namespace(String appId, String clusterName, String namespaceName) {
48.     this.appId = appId;
49.     this.clusterName = clusterName;
50.     this.namespaceName = namespaceName;
51.   }
52. 
53.   public String getAppId() {
54.     return appId;
55.   }
56. 
57.   public String getClusterName() {
58.     return clusterName;
59.   }
60. 
61.   public String getNamespaceName() {
62.     return namespaceName;
63.   }
64. 
65.   public void setAppId(String appId) {
66.     this.appId = appId;
67.   }
68. 
69.   public void setClusterName(String clusterName) {
70.     this.clusterName = clusterName;
71.   }
72. 
73.   public void setNamespaceName(String namespaceName) {
74.     this.namespaceName = namespaceName;
75.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/AppNamespaceRepository.java
Line number range: 31 - 41
Content:
31.   AppNamespace findByAppIdAndName(String appId, String namespaceName);
32. 
33.   List<AppNamespace> findByAppIdAndNameIn(String appId, Set<String> namespaceNames);
34. 
35.   AppNamespace findByNameAndIsPublicTrue(String namespaceName);
36. 
37.   List<AppNamespace> findByNameInAndIsPublicTrue(Set<String> namespaceNames);
38. 
39.   List<AppNamespace> findByAppIdAndIsPublic(String appId, boolean isPublic);
40. 
41.   List<AppNamespace> findByAppIdOrderByIdAsc(String appId);


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/ItemRepository.java
Line number range: 40 - 41
Content:
40.   Page<Item> findByKey(String key, Pageable pageable);
41. 


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/repository/NamespaceRepository.java
Line number range: 31 - 47
Content:
31.   List<Namespace> findByAppIdAndClusterNameOrderByIdAsc(String appId, String clusterName);
32. 
33.   Namespace findByAppIdAndClusterNameAndNamespaceName(String appId, String clusterName, String namespaceName);
34. 
35.   @Modifying
36.   @Query("update Namespace set IsDeleted = 1, DeletedAt = ROUND(UNIX_TIMESTAMP(NOW(4))*1000), DataChange_LastModifiedBy = ?3 where appId=?1 and clusterName=?2 and IsDeleted = 0")
37.   int batchDelete(String appId, String clusterName, String operator);
38. 
39.   List<Namespace> findByAppIdAndNamespaceNameOrderByIdAsc(String appId, String namespaceName);
40. 
41.   List<Namespace> findByNamespaceName(String namespaceName, Pageable page);
42. 
43.   List<Namespace> findByIdIn(Set<Long> namespaceIds);
44. 
45.   int countByNamespaceNameAndAppIdNot(String namespaceName, String appId);
46. 
47. }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 63 - 67
Content:
63.   public boolean isAppNamespaceNameUnique(String appId, String namespaceName) {
64.     Objects.requireNonNull(appId, "AppId must not be null");
65.     Objects.requireNonNull(namespaceName, "Namespace must not be null");
66.     return Objects.isNull(appNamespaceRepository.findByAppIdAndName(appId, namespaceName));
67.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 69 - 72
Content:
69.   public AppNamespace findPublicNamespaceByName(String namespaceName) {
70.     Preconditions.checkArgument(namespaceName != null, "Namespace must not be null");
71.     return appNamespaceRepository.findByNameAndIsPublicTrue(namespaceName);
72.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 90 - 94
Content:
90.   public AppNamespace findOne(String appId, String namespaceName) {
91.     Preconditions
92.         .checkArgument(!StringUtils.isContainEmpty(appId, namespaceName), "appId or Namespace must not be null");
93.     return appNamespaceRepository.findByAppIdAndName(appId, namespaceName);
94.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 122 - 138
Content:
122.   @Transactional
123.   public AppNamespace createAppNamespace(AppNamespace appNamespace) {
124.     String createBy = appNamespace.getDataChangeCreatedBy();
125.     if (!isAppNamespaceNameUnique(appNamespace.getAppId(), appNamespace.getName())) {
126.       throw new ServiceException("appnamespace not unique");
127.     }
128.     appNamespace.setId(0);//protection
129.     appNamespace.setDataChangeCreatedBy(createBy);
130.     appNamespace.setDataChangeLastModifiedBy(createBy);
131. 
132.     appNamespace = appNamespaceRepository.save(appNamespace);
133. 
134.     createNamespaceForAppNamespaceInAllCluster(appNamespace.getAppId(), appNamespace.getName(), createBy);
135. 
136.     auditService.audit(AppNamespace.class.getSimpleName(), appNamespace.getId(), Audit.OP.INSERT, createBy);
137.     return appNamespace;
138.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/AppNamespaceService.java
Line number range: 151 - 169
Content:
151.   public void createNamespaceForAppNamespaceInAllCluster(String appId, String namespaceName, String createBy) {
152.     List<Cluster> clusters = clusterService.findParentClusters(appId);
153. 
154.     for (Cluster cluster : clusters) {
155. 
156.       // in case there is some dirty data, e.g. public namespace deleted in other app and now created in this app
157.       if (!namespaceService.isNamespaceUnique(appId, cluster.getName(), namespaceName)) {
158.         continue;
159.       }
160. 
161.       Namespace namespace = new Namespace();
162.       namespace.setClusterName(cluster.getName());
163.       namespace.setAppId(appId);
164.       namespace.setNamespaceName(namespaceName);
165.       namespace.setDataChangeCreatedBy(createBy);
166.       namespace.setDataChangeLastModifiedBy(createBy);
167. 
168.       namespaceService.save(namespace);
169.     }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java
Line number range: 82 - 90
Content:
82.   public Item findOne(String appId, String clusterName, String namespaceName, String key) {
83.     Namespace namespace = findNamespaceByAppIdAndClusterNameAndNamespaceName(appId, clusterName, namespaceName);
84.     return itemRepository.findByNamespaceIdAndKey(namespace.getId(), key);
85.   }
86. 
87.   public Item findLastOne(String appId, String clusterName, String namespaceName) {
88.     Namespace namespace = findNamespaceByAppIdAndClusterNameAndNamespaceName(appId, clusterName, namespaceName);
89.     return findLastOne(namespace.getId());
90.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java
Line number range: 124 - 130
Content:
124.   public List<Item> findItemsWithOrdered(String appId, String clusterName, String namespaceName) {
125.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
126.     if (namespace != null) {
127.       return findItemsWithOrdered(namespace.getId());
128.     }
129.     return Collections.emptyList();
130.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java
Line number range: 140 - 144
Content:
140.   public Page<Item> findItemsByNamespace(String appId, String clusterName, String namespaceName, Pageable pageable) {
141.     Namespace namespace = findNamespaceByAppIdAndClusterNameAndNamespaceName(appId, clusterName, namespaceName);
142.     return itemRepository.findByNamespaceId(namespace.getId(), pageable);
143.   }
144. 


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ItemService.java
Line number range: 222 - 231
Content:
222.   private Namespace findNamespaceByAppIdAndClusterNameAndNamespaceName(String appId,
223.                                                                        String clusterName,
224.                                                                        String namespaceName) {
225.     Namespace namespace = namespaceService.findOne(appId, clusterName, namespaceName);
226.     if (namespace == null) {
227.       throw new NotFoundException(String.format("namespace not found for appId:%s clusterName:%s namespaceName:%s",
228.               appId, clusterName, namespaceName));
229.     }
230.     return namespace;
231.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 104 - 107
Content:
104.   public Namespace findOne(String appId, String clusterName, String namespaceName) {
105.     return namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, clusterName,
106.                                                                          namespaceName);
107.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 112 - 122
Content:
112.   public Page<Namespace> findByItem(String itemKey, Pageable pageable) {
113.     Page<Item> items = itemService.findItemsByKey(itemKey, pageable);
114. 
115.     if (!items.hasContent()) {
116.       return Page.empty();
117.     }
118. 
119.     Set<Long> namespaceIds = BeanUtils.toPropertySet("namespaceId", items.getContent());
120. 
121.     return new PageImpl<>(namespaceRepository.findByIdIn(namespaceIds));
122.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 175 - 185
Content:
175.   public List<Namespace> findPublicAppNamespaceAllNamespaces(String namespaceName, Pageable page) {
176.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(namespaceName);
177. 
178.     if (publicAppNamespace == null) {
179.       throw new BadRequestException(
180.           String.format("Public appNamespace not exists. NamespaceName = %s", namespaceName));
181.     }
182. 
183.     List<Namespace> namespaces = namespaceRepository.findByNamespaceName(namespaceName, page);
184. 
185.     return filterChildNamespace(namespaces);


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 204 - 213
Content:
204.   public int countPublicAppNamespaceAssociatedNamespaces(String publicNamespaceName) {
205.     AppNamespace publicAppNamespace = appNamespaceService.findPublicNamespaceByName(publicNamespaceName);
206. 
207.     if (publicAppNamespace == null) {
208.       throw new BadRequestException(
209.           String.format("Public appNamespace not exists. NamespaceName = %s", publicNamespaceName));
210.     }
211. 
212.     return namespaceRepository.countByNamespaceNameAndAppIdNot(publicNamespaceName, publicAppNamespace.getAppId());
213.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 215 - 221
Content:
215.   public List<Namespace> findNamespaces(String appId, String clusterName) {
216.     List<Namespace> namespaces = namespaceRepository.findByAppIdAndClusterNameOrderByIdAsc(appId, clusterName);
217.     if (namespaces == null) {
218.       return Collections.emptyList();
219.     }
220.     return namespaces;
221.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 223 - 225
Content:
223.   public List<Namespace> findByAppIdAndNamespaceName(String appId, String namespaceName) {
224.     return namespaceRepository.findByAppIdAndNamespaceNameOrderByIdAsc(appId, namespaceName);
225.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/NamespaceService.java
Line number range: 283 - 289
Content:
283.   public boolean isNamespaceUnique(String appId, String cluster, String namespace) {
284.     Objects.requireNonNull(appId, "AppId must not be null");
285.     Objects.requireNonNull(cluster, "Cluster must not be null");
286.     Objects.requireNonNull(namespace, "Namespace must not be null");
287.     return Objects.isNull(
288.         namespaceRepository.findByAppIdAndClusterNameAndNamespaceName(appId, cluster, namespace));
289.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java
Line number range: 128 - 155
Content:
128.   public Release findLatestActiveRelease(String appId, String clusterName, String namespaceName) {
129.     return releaseRepository.findFirstByAppIdAndClusterNameAndNamespaceNameAndIsAbandonedFalseOrderByIdDesc(appId,
130.                                                                                                             clusterName,
131.                                                                                                             namespaceName);
132.   }
133. 
134.   public List<Release> findAllReleases(String appId, String clusterName, String namespaceName, Pageable page) {
135.     List<Release> releases = releaseRepository.findByAppIdAndClusterNameAndNamespaceNameOrderByIdDesc(appId,
136.                                                                                                       clusterName,
137.                                                                                                       namespaceName,
138.                                                                                                       page);
139.     if (releases == null) {
140.       return Collections.emptyList();
141.     }
142.     return releases;
143.   }
144. 
145.   public List<Release> findActiveReleases(String appId, String clusterName, String namespaceName, Pageable page) {
146.     List<Release>
147.         releases =
148.         releaseRepository.findByAppIdAndClusterNameAndNamespaceNameAndIsAbandonedFalseOrderByIdDesc(appId, clusterName,
149.                                                                                                     namespaceName,
150.                                                                                                     page);
151.     if (releases == null) {
152.       return Collections.emptyList();
153.     }
154.     return releases;
155.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java
Line number range: 198 - 236
Content:
198.   @Transactional
199.   public Release publish(Namespace namespace, String releaseName, String releaseComment,
200.                          String operator, boolean isEmergencyPublish) {
201. 
202.     checkLock(namespace, isEmergencyPublish, operator);
203. 
204.     Map<String, String> operateNamespaceItems = getNamespaceItems(namespace);
205. 
206.     Namespace parentNamespace = namespaceService.findParentNamespace(namespace);
207. 
208.     //branch release
209.     if (parentNamespace != null) {
210.       return publishBranchNamespace(parentNamespace, namespace, operateNamespaceItems,
211.                                     releaseName, releaseComment, operator, isEmergencyPublish);
212.     }
213. 
214.     Namespace childNamespace = namespaceService.findChildNamespace(namespace);
215. 
216.     Release previousRelease = null;
217.     if (childNamespace != null) {
218.       previousRelease = findLatestActiveRelease(namespace);
219.     }
220. 
221.     //master release
222.     Map<String, Object> operationContext = Maps.newLinkedHashMap();
223.     operationContext.put(ReleaseOperationContext.IS_EMERGENCY_PUBLISH, isEmergencyPublish);
224. 
225.     Release release = masterRelease(namespace, releaseName, releaseComment, operateNamespaceItems,
226.                                     operator, ReleaseOperation.NORMAL_RELEASE, operationContext);
227. 
228.     //merge to branch and auto release
229.     if (childNamespace != null) {
230.       mergeFromMasterAndPublishBranch(namespace, childNamespace, operateNamespaceItems,
231.                                       releaseName, releaseComment, operator, previousRelease,
232.                                       release, isEmergencyPublish);
233.     }
234. 
235.     return release;
236.   }


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java
Line number range: 262 - 279
Content:
262.   @Transactional
263.   public Release grayDeletionPublish(Namespace namespace, String releaseName, String releaseComment,
264.                                      String operator, boolean isEmergencyPublish, Set<String> grayDelKeys) {
265. 
266.     checkLock(namespace, isEmergencyPublish, operator);
267. 
268.     Map<String, String> operateNamespaceItems = getNamespaceItems(namespace);
269. 
270.     Namespace parentNamespace = namespaceService.findParentNamespace(namespace);
271. 
272.     //branch release
273.     if (parentNamespace != null) {
274.       return publishBranchNamespace(parentNamespace, namespace, operateNamespaceItems,
275.               releaseName, releaseComment, operator, isEmergencyPublish, grayDelKeys);
276.     }
277.     throw new NotFoundException("Parent namespace not found");
278.   }
279. 


File: apollo-biz/src/main/java/com/ctrip/framework/apollo/biz/service/ReleaseService.java
Line number range: 437 - 451
Content:
437.   private Release createRelease(Namespace namespace, String name, String comment,
438.                                 Map<String, String> configurations, String operator) {
439.     Release release = new Release();
440.     release.setReleaseKey(ReleaseKeyGenerator.generateReleaseKey(namespace));
441.     release.setDataChangeCreatedTime(new Date());
442.     release.setDataChangeCreatedBy(operator);
443.     release.setDataChangeLastModifiedBy(operator);
444.     release.setName(name);
445.     release.setComment(comment);
446.     release.setAppId(namespace.getAppId());
447.     release.setClusterName(namespace.getClusterName());
448.     release.setNamespaceName(namespace.getNamespaceName());
449.     release.setConfigurations(GSON.toJson(configurations));
450.     release = releaseRepository.save(release);
451. 


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java
Line number range: 38 - 44
Content:
38.   @NotBlank(message = "AppNamespace Name cannot be blank")
39.   @Pattern(
40.       regexp = InputValidator.CLUSTER_NAMESPACE_VALIDATOR,
41.       message = "Invalid Namespace format: " + InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & " + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE
42.   )
43.   @Column(name = "Name", nullable = false)
44.   private String name;


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/entity/AppNamespace.java
Line number range: 91 - 101
Content:
91.   public ConfigFileFormat formatAsEnum() {
92.     return ConfigFileFormat.fromString(this.format);
93.   }
94. 
95.   public String getFormat() {
96.     return format;
97.   }
98. 
99.   public void setFormat(String format) {
100.     this.format = format;
101.   }


File: apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java
Line number range: 26 - 47
Content:
26. public class InputValidator {
27.   public static final String INVALID_CLUSTER_NAMESPACE_MESSAGE = "Only digits, alphabets and symbol - _ . are allowed";
28.   public static final String INVALID_NAMESPACE_NAMESPACE_MESSAGE = "not allowed to end with .json, .yml, .yaml, .xml, .properties";
29.   public static final String CLUSTER_NAMESPACE_VALIDATOR = "[0-9a-zA-Z_.-]+";
30.   private static final String APP_NAMESPACE_VALIDATOR = "[a-zA-Z0-9._-]+(?<!\\.(json|yml|yaml|xml|properties))$";
31.   private static final Pattern CLUSTER_NAMESPACE_PATTERN = Pattern.compile(CLUSTER_NAMESPACE_VALIDATOR);
32.   private static final Pattern APP_NAMESPACE_PATTERN = Pattern.compile(APP_NAMESPACE_VALIDATOR);
33. 
34.   public static boolean isValidClusterNamespace(String name) {
35.     if (StringUtils.isEmpty(name)){
36.       return false;
37.     }
38.     return CLUSTER_NAMESPACE_PATTERN.matcher(name).matches();
39.   }
40. 
41.   public static boolean isValidAppNamespace(String name){
42.     if (StringUtils.isEmpty(name)){
43.       return false;
44.     }
45.     return APP_NAMESPACE_PATTERN.matcher(name).matches();
46.   }
47. }


File: apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCache.java
Line number range: 92 - 95
Content:
92.   public AppNamespace findByAppIdAndNamespace(String appId, String namespaceName) {
93.     Preconditions.checkArgument(!StringUtils.isContainEmpty(appId, namespaceName), "appId and namespaceName must not be empty");
94.     return appNamespaceCache.get(STRING_JOINER.join(appId, namespaceName));
95.   }


File: apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/service/AppNamespaceServiceWithCache.java
Line number range: 112 - 115
Content:
112.   public AppNamespace findPublicNamespaceByName(String namespaceName) {
113.     Preconditions.checkArgument(!Strings.isNullOrEmpty(namespaceName), "namespaceName must not be empty");
114.     return publicAppNamespaceCache.get(namespaceName);
115.   }


File: apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java
Line number range: 35 - 56
Content:
35.   public String filterNamespaceName(String namespaceName) {
36.     if (namespaceName.toLowerCase().endsWith(".properties")) {
37.       int dotIndex = namespaceName.lastIndexOf(".");
38.       return namespaceName.substring(0, dotIndex);
39.     }
40. 
41.     return namespaceName;
42.   }
43. 
44.   public String normalizeNamespace(String appId, String namespaceName) {
45.     AppNamespace appNamespace = appNamespaceServiceWithCache.findByAppIdAndNamespace(appId, namespaceName);
46.     if (appNamespace != null) {
47.       return appNamespace.getName();
48.     }
49. 
50.     appNamespace = appNamespaceServiceWithCache.findPublicNamespaceByName(namespaceName);
51.     if (appNamespace != null) {
52.       return appNamespace.getName();
53.     }
54. 
55.     return namespaceName;
56.   }


File: apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java
Line number range: 38 - 41
Content:
38. public enum ConfigFileFormat {
39.   Properties("properties"), XML("xml"), JSON("json"), YML("yml"), YAML("yaml"), TXT("txt");
40. 
41.   private final String value;


File: apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java
Line number range: 86 - 97
Content:
86.   public static ConfigFileFormat fromString(String value) {
87.     if (StringUtils.isEmpty(value)) {
88.       throw new IllegalArgumentException("value can not be empty");
89.     }
90. 
91.     final String cleansedName = getWellFormedName(value);
92. 
93.     return Stream.of(ConfigFileFormat.values())
94.         .filter(item -> cleansedName.equalsIgnoreCase(item.getValue()))
95.         .findFirst()
96.         .orElseThrow(() -> new IllegalArgumentException(value + " can not map enum"));
97.   }


File: apollo-core/src/main/java/com/ctrip/framework/apollo/core/enums/ConfigFileFormat.java
Line number range: 128 - 130
Content:
128.   public String getValue() {
129.     return value;
130.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java
Line number range: 65 - 75
Content:
65.     if (!InputValidator.isValidAppNamespace(appNamespaceDTO.getName())) {
66.       throw new BadRequestException(String.format("Invalid Namespace format: %s",
67.                                                   InputValidator.INVALID_CLUSTER_NAMESPACE_MESSAGE + " & "
68.                                                   + InputValidator.INVALID_NAMESPACE_NAMESPACE_MESSAGE));
69.     }
70. 
71.     if (!ConfigFileFormat.isValidFormat(appNamespaceDTO.getFormat())) {
72.       throw new BadRequestException(String.format("Invalid namespace format. format = %s", appNamespaceDTO.getFormat()));
73.     }
74. 
75.     String operator = appNamespaceDTO.getDataChangeCreatedBy();


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/openapi/v1/controller/NamespaceController.java
Line number range: 89 - 94
Content:
89.   @GetMapping(value = "/openapi/v1/envs/{env}/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
90.   public OpenNamespaceDTO loadNamespace(@PathVariable String appId, @PathVariable String env,
91.                                         @PathVariable String clusterName, @PathVariable String
92.                                             namespaceName) {
93.     return this.namespaceOpenApiService.getNamespace(appId, env, clusterName, namespaceName);
94.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java
Line number range: 100 - 106
Content:
100.     public NamespaceDTO loadNamespace(String appId, Env env, String clusterName,
101.         String namespaceName) {
102.       return
103.           restTemplate.get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}",
104.               NamespaceDTO.class, appId, clusterName, namespaceName);
105.     }
106. 


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java
Line number range: 137 - 143
Content:
137.     public void deleteNamespace(Env env, String appId, String clusterName, String namespaceName, String operator) {
138.       restTemplate
139.           .delete(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}?operator={operator}", appId,
140.               clusterName,
141.               namespaceName, operator);
142.     }
143. 


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java
Line number range: 176 - 221
Content:
176.     public List<ItemDTO> findItems(String appId, Env env, String clusterName, String namespaceName) {
177.       ItemDTO[] itemDTOs =
178.           restTemplate.get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items",
179.               ItemDTO[].class, appId, clusterName, namespaceName);
180.       return Arrays.asList(itemDTOs);
181.     }
182. 
183.     public List<ItemDTO> findDeletedItems(String appId, Env env, String clusterName, String namespaceName) {
184.       ItemDTO[] itemDTOs =
185.           restTemplate.get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/deleted",
186.               ItemDTO[].class, appId, clusterName, namespaceName);
187.       return Arrays.asList(itemDTOs);
188.     }
189. 
190.     public ItemDTO loadItem(Env env, String appId, String clusterName, String namespaceName, String key) {
191.       return restTemplate.get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/{key}",
192.           ItemDTO.class, appId, clusterName, namespaceName, key);
193.     }
194. 
195.     public ItemDTO loadItemByEncodeKey(Env env, String appId, String clusterName, String namespaceName, String key) {
196.       return restTemplate.get(env,
197.           "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/encodedItems/{key}",
198.           ItemDTO.class, appId, clusterName, namespaceName,
199.           new String(Base64.getEncoder().encode(key.getBytes(StandardCharsets.UTF_8))));
200.     }
201. 
202.     public ItemDTO loadItemById(Env env, long itemId) {
203.       return restTemplate.get(env, "items/{itemId}", ItemDTO.class, itemId);
204.     }
205. 
206.     public void updateItemsByChangeSet(String appId, Env env, String clusterName, String namespace,
207.         ItemChangeSets changeSets) {
208.       restTemplate.post(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/itemset",
209.           changeSets, Void.class, appId, clusterName, namespace);
210.     }
211. 
212.     public void updateItem(String appId, Env env, String clusterName, String namespace, long itemId, ItemDTO item) {
213.       restTemplate.put(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items/{itemId}",
214.           item, appId, clusterName, namespace, itemId);
215. 
216.     }
217. 
218.     public ItemDTO createItem(String appId, Env env, String clusterName, String namespace, ItemDTO item) {
219.       return restTemplate.post(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items",
220.           item, ItemDTO.class, appId, clusterName, namespace);
221.     }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java
Line number range: 233 - 239
Content:
233.     public PageDTO<OpenItemDTO> findItemsByNamespace(String appId, Env env, String clusterName,
234.                                                      String namespaceName, int page, int size) {
235.       ResponseEntity<PageDTO<OpenItemDTO>> entity = restTemplate.get(env,
236.               "/apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/items-with-page?page={page}&size={size}",
237.                       openItemPageDTO, appId, clusterName, namespaceName, page, size);
238.       return entity.getBody();
239.     }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java
Line number range: 325 - 350
Content:
325.     public List<ReleaseDTO> findAllReleases(String appId, Env env, String clusterName, String namespaceName, int page,
326.         int size) {
327.       ReleaseDTO[] releaseDTOs = restTemplate.get(
328.           env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/all?page={page}&size={size}",
329.           ReleaseDTO[].class,
330.           appId, clusterName, namespaceName, page, size);
331.       return Arrays.asList(releaseDTOs);
332.     }
333. 
334.     public List<ReleaseDTO> findActiveReleases(String appId, Env env, String clusterName, String namespaceName,
335.         int page,
336.         int size) {
337.       ReleaseDTO[] releaseDTOs = restTemplate.get(
338.           env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/active?page={page}&size={size}",
339.           ReleaseDTO[].class,
340.           appId, clusterName, namespaceName, page, size);
341.       return Arrays.asList(releaseDTOs);
342.     }
343. 
344.     public ReleaseDTO loadLatestRelease(String appId, Env env, String clusterName,
345.         String namespace) {
346.       ReleaseDTO releaseDTO = restTemplate
347.           .get(env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases/latest",
348.               ReleaseDTO.class, appId, clusterName, namespace);
349.       return releaseDTO;
350.     }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java
Line number range: 352 - 387
Content:
352.     public ReleaseDTO createRelease(String appId, Env env, String clusterName, String namespace,
353.         String releaseName, String releaseComment, String operator,
354.         boolean isEmergencyPublish) {
355.       HttpHeaders headers = new HttpHeaders();
356.       headers.setContentType(MediaType.parseMediaType(MediaType.APPLICATION_FORM_URLENCODED_VALUE + ";charset=UTF-8"));
357.       MultiValueMap<String, String> parameters = new LinkedMultiValueMap<>();
358.       parameters.add("name", releaseName);
359.       parameters.add("comment", releaseComment);
360.       parameters.add("operator", operator);
361.       parameters.add("isEmergencyPublish", String.valueOf(isEmergencyPublish));
362.       HttpEntity<MultiValueMap<String, String>> entity =
363.           new HttpEntity<>(parameters, headers);
364.       ReleaseDTO response = restTemplate.post(
365.           env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/releases", entity,
366.           ReleaseDTO.class, appId, clusterName, namespace);
367.       return response;
368.     }
369. 
370.     public ReleaseDTO createGrayDeletionRelease(String appId, Env env, String clusterName, String namespace,
371.                                     String releaseName, String releaseComment, String operator,
372.                                     boolean isEmergencyPublish, Set<String> grayDelKeys) {
373.       HttpHeaders headers = new HttpHeaders();
374.       headers.setContentType(MediaType.parseMediaType(MediaType.APPLICATION_FORM_URLENCODED_VALUE + ";charset=UTF-8"));
375.       MultiValueMap<String, String> parameters = new LinkedMultiValueMap<>();
376.       parameters.add("releaseName", releaseName);
377.       parameters.add("comment", releaseComment);
378.       parameters.add("operator", operator);
379.       parameters.add("isEmergencyPublish", String.valueOf(isEmergencyPublish));
380.       grayDelKeys.forEach(key -> parameters.add("grayDelKeys",key));
381.       HttpEntity<MultiValueMap<String, String>> entity =
382.               new HttpEntity<>(parameters, headers);
383.       ReleaseDTO response = restTemplate.post(
384.               env, "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/gray-del-releases", entity,
385.               ReleaseDTO.class, appId, clusterName, namespace);
386.       return response;
387.     }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/api/AdminServiceAPI.java
Line number range: 389 - 400
Content:
389.     public ReleaseDTO updateAndPublish(String appId, Env env, String clusterName, String namespace,
390.         String releaseName, String releaseComment, String branchName,
391.         boolean isEmergencyPublish, boolean deleteBranch, ItemChangeSets changeSets) {
392. 
393.       return restTemplate.post(env,
394.           "apps/{appId}/clusters/{clusterName}/namespaces/{namespaceName}/updateAndPublish?"
395.               + "releaseName={releaseName}&releaseComment={releaseComment}&branchName={branchName}"
396.               + "&deleteBranch={deleteBranch}&isEmergencyPublish={isEmergencyPublish}",
397.           changeSets, ReleaseDTO.class, appId, clusterName, namespace,
398.           releaseName, releaseComment, branchName, deleteBranch, isEmergencyPublish);
399. 
400.     }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 120 - 131
Content:
120.   @GetMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/namespaces/{namespaceName:.+}")
121.   public NamespaceBO findNamespace(@PathVariable String appId, @PathVariable String env,
122.                                    @PathVariable String clusterName, @PathVariable String namespaceName) {
123. 
124.     NamespaceBO namespaceBO = namespaceService.loadNamespaceBO(appId, Env.valueOf(env), clusterName, namespaceName);
125. 
126.     if (namespaceBO != null && permissionValidator.shouldHideConfigToCurrentUser(appId, env, namespaceName)) {
127.       namespaceBO.hideItems();
128.     }
129. 
130.     return namespaceBO;
131.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 172 - 180
Content:
172.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
173.   @DeleteMapping("/apps/{appId}/envs/{env}/clusters/{clusterName}/linked-namespaces/{namespaceName:.+}")
174.   public ResponseEntity<Void> deleteLinkedNamespace(@PathVariable String appId, @PathVariable String env,
175.       @PathVariable String clusterName, @PathVariable String namespaceName) {
176. 
177.     namespaceService.deleteNamespace(appId, Env.valueOf(env), clusterName, namespaceName);
178. 
179.     return ResponseEntity.ok().build();
180.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 194 - 203
Content:
194.   @PreAuthorize(value = "@permissionValidator.hasDeleteNamespacePermission(#appId)")
195.   @DeleteMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
196.   public ResponseEntity<Void> deleteAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
197. 
198.     AppNamespace appNamespace = appNamespaceService.deleteAppNamespace(appId, namespaceName);
199. 
200.     publisher.publishEvent(new AppNamespaceDeletionEvent(appNamespace));
201. 
202.     return ResponseEntity.ok().build();
203.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java
Line number range: 205 - 215
Content:
205.   @GetMapping("/apps/{appId}/appnamespaces/{namespaceName:.+}")
206.   public AppNamespaceDTO findAppNamespace(@PathVariable String appId, @PathVariable String namespaceName) {
207.     AppNamespace appNamespace = appNamespaceService.findByAppIdAndName(appId, namespaceName);
208. 
209.     if (appNamespace == null) {
210.       throw new BadRequestException(
211.           String.format("AppNamespace not exists. AppId = %s, NamespaceName = %s", appId, namespaceName));
212.     }
213. 
214.     return BeanUtils.transform(AppNamespaceDTO.class, appNamespace);
215.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 70 - 78
Content:
70.   public AppNamespace findPublicAppNamespace(String namespaceName) {
71.     List<AppNamespace> appNamespaces = appNamespaceRepository.findByNameAndIsPublic(namespaceName, true);
72. 
73.     if (CollectionUtils.isEmpty(appNamespaces)) {
74.       return null;
75.     }
76. 
77.     return appNamespaces.get(0);
78.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 84 - 86
Content:
84.   public AppNamespace findByAppIdAndName(String appId, String namespaceName) {
85.     return appNamespaceRepository.findByAppIdAndName(appId, namespaceName);
86.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 126 - 144
Content:
126.   @Transactional
127.   public AppNamespace createAppNamespaceInLocal(AppNamespace appNamespace, boolean appendNamespacePrefix) {
128.     String appId = appNamespace.getAppId();
129. 
130.     //add app org id as prefix
131.     App app = appService.load(appId);
132.     if (app == null) {
133.       throw new BadRequestException("App not exist. AppId = " + appId);
134.     }
135. 
136.     StringBuilder appNamespaceName = new StringBuilder();
137.     //add prefix postfix
138.     appNamespaceName
139.         .append(appNamespace.isPublic() && appendNamespacePrefix ? app.getOrgId() + "." : "")
140.         .append(appNamespace.getName())
141.         .append(appNamespace.formatAsEnum() == ConfigFileFormat.Properties ? "" : "." + appNamespace.getFormat());
142.     appNamespace.setName(appNamespaceName.toString());
143. 
144.     if (appNamespace.getComment() == null) {


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/AppNamespaceService.java
Line number range: 148 - 151
Content:
148.     if (!ConfigFileFormat.isValidFormat(appNamespace.getFormat())) {
149.      throw new BadRequestException("Invalid namespace format. format must be properties、json、yaml、yml、xml");
150.     }
151. 


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ItemService.java
Line number range: 85 - 177
Content:
85.   public void updateConfigItemByText(NamespaceTextModel model) {
86.     String appId = model.getAppId();
87.     Env env = model.getEnv();
88.     String clusterName = model.getClusterName();
89.     String namespaceName = model.getNamespaceName();
90. 
91.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
92.     if (namespace == null) {
93.       throw new BadRequestException(
94.           "namespace:" + namespaceName + " not exist in env:" + env + ", cluster:" + clusterName);
95.     }
96.     long namespaceId = namespace.getId();
97. 
98.     // In case someone constructs an attack scenario
99.     if (model.getNamespaceId() != namespaceId) {
100.       throw new BadRequestException("Invalid request, item and namespace do not match!");
101.     }
102. 
103.     String configText = model.getConfigText();
104. 
105.     ConfigTextResolver resolver =
106.         model.getFormat() == ConfigFileFormat.Properties ? propertyResolver : fileTextResolver;
107. 
108.     ItemChangeSets changeSets = resolver.resolve(namespaceId, configText,
109.         itemAPI.findItems(appId, env, clusterName, namespaceName));
110.     if (changeSets.isEmpty()) {
111.       return;
112.     }
113. 
114.     String operator = model.getOperator();
115.     if (StringUtils.isBlank(operator)) {
116.       operator = userInfoHolder.getUser().getUserId();
117.     }
118.     changeSets.setDataChangeLastModifiedBy(operator);
119. 
120.     updateItems(appId, env, clusterName, namespaceName, changeSets);
121. 
122.     Tracer.logEvent(TracerEventType.MODIFY_NAMESPACE_BY_TEXT,
123.         String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
124.     Tracer.logEvent(TracerEventType.MODIFY_NAMESPACE, String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
125.   }
126. 
127.   public void updateItems(String appId, Env env, String clusterName, String namespaceName, ItemChangeSets changeSets){
128.     itemAPI.updateItemsByChangeSet(appId, env, clusterName, namespaceName, changeSets);
129.   }
130. 
131. 
132.   public ItemDTO createItem(String appId, Env env, String clusterName, String namespaceName, ItemDTO item) {
133.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
134.     if (namespace == null) {
135.       throw new BadRequestException(
136.           "namespace:" + namespaceName + " not exist in env:" + env + ", cluster:" + clusterName);
137.     }
138.     item.setNamespaceId(namespace.getId());
139. 
140.     ItemDTO itemDTO = itemAPI.createItem(appId, env, clusterName, namespaceName, item);
141.     Tracer.logEvent(TracerEventType.MODIFY_NAMESPACE, String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
142.     return itemDTO;
143.   }
144. 
145.   public ItemDTO createCommentItem(String appId, Env env, String clusterName, String namespaceName, ItemDTO item) {
146.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
147.     if (namespace == null) {
148.       throw new BadRequestException(
149.           "namespace:" + namespaceName + " not exist in env:" + env + ", cluster:" + clusterName);
150.     }
151.     item.setNamespaceId(namespace.getId());
152. 
153.     return itemAPI.createCommentItem(appId, env, clusterName, namespaceName, item);
154.   }
155. 
156.   public void updateItem(String appId, Env env, String clusterName, String namespaceName, ItemDTO item) {
157.     itemAPI.updateItem(appId, env, clusterName, namespaceName, item.getId(), item);
158.   }
159. 
160.   public void deleteItem(Env env, long itemId, String userId) {
161.     itemAPI.deleteItem(env, itemId, userId);
162.   }
163. 
164.   public List<ItemDTO> findItems(String appId, Env env, String clusterName, String namespaceName) {
165.     return itemAPI.findItems(appId, env, clusterName, namespaceName);
166.   }
167. 
168.   public List<ItemDTO> findDeletedItems(String appId, Env env, String clusterName, String namespaceName) {
169.     return itemAPI.findDeletedItems(appId, env, clusterName, namespaceName);
170.   }
171. 
172.   public ItemDTO loadItem(Env env, String appId, String clusterName, String namespaceName, String key) {
173.     if (UrlUtils.hasIllegalChar(key)) {
174.       return itemAPI.loadItemByEncodeKey(env, appId, clusterName, namespaceName, key);
175.     }
176.     return itemAPI.loadItem(env, appId, clusterName, namespaceName, key);
177.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ItemService.java
Line number range: 273 - 276
Content:
273.   public PageDTO<OpenItemDTO> findItemsByNamespace(String appId, Env env, String clusterName,
274.                                                    String namespaceName, int page, int size) {
275.     return itemAPI.findItemsByNamespace(appId, env, clusterName, namespaceName, page, size);
276.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 170 - 184
Content:
170.   @Transactional
171.   public void deleteNamespace(String appId, Env env, String clusterName, String namespaceName) {
172. 
173.     String operator = userInfoHolder.getUser().getUserId();
174.     namespaceAPI.deleteNamespace(env, appId, clusterName, namespaceName, operator);
175.   }
176. 
177.   public NamespaceDTO loadNamespaceBaseInfo(String appId, Env env, String clusterName,
178.       String namespaceName) {
179.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
180.     if (namespace == null) {
181.       throw new BadRequestException(String.format("Namespace: %s not exist.", namespaceName));
182.     }
183.     return namespace;
184.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 248 - 337
Content:
248.   public NamespaceBO loadNamespaceBO(String appId, Env env, String clusterName,
249.       String namespaceName) {
250.     NamespaceDTO namespace = namespaceAPI.loadNamespace(appId, env, clusterName, namespaceName);
251.     if (namespace == null) {
252.       throw new BadRequestException("namespaces not exist");
253.     }
254.     return transformNamespace2BO(env, namespace);
255.   }
256. 
257.   public boolean publicAppNamespaceHasAssociatedNamespace(String publicNamespaceName, Env env) {
258.     return getPublicAppNamespaceHasAssociatedNamespace(publicNamespaceName, env) > 0;
259.   }
260. 
261.   public int getPublicAppNamespaceHasAssociatedNamespace(String publicNamespaceName, Env env) {
262.     return namespaceAPI.countPublicAppNamespaceAssociatedNamespaces(env, publicNamespaceName);
263.   }
264. 
265.   public NamespaceBO findPublicNamespaceForAssociatedNamespace(Env env, String appId,
266.       String clusterName, String namespaceName) {
267.     NamespaceDTO namespace =
268.         namespaceAPI
269.             .findPublicNamespaceForAssociatedNamespace(env, appId, clusterName, namespaceName);
270. 
271.     return transformNamespace2BO(env, namespace);
272.   }
273. 
274.   public Map<String, Map<String, Boolean>> getNamespacesPublishInfo(String appId) {
275.     Map<String, Map<String, Boolean>> result = Maps.newHashMap();
276. 
277.     Set<Env> envs = portalConfig.publishTipsSupportedEnvs();
278.     for (Env env : envs) {
279.       if (portalSettings.isEnvActive(env)) {
280.         result.put(env.toString(), namespaceAPI.getNamespacePublishInfo(env, appId));
281.       }
282.     }
283. 
284.     return result;
285.   }
286. 
287.   private NamespaceBO transformNamespace2BO(Env env, NamespaceDTO namespace) {
288.     NamespaceBO namespaceBO = new NamespaceBO();
289.     namespaceBO.setBaseInfo(namespace);
290. 
291.     String appId = namespace.getAppId();
292.     String clusterName = namespace.getClusterName();
293.     String namespaceName = namespace.getNamespaceName();
294. 
295.     fillAppNamespaceProperties(namespaceBO);
296. 
297.     List<ItemBO> itemBOs = new LinkedList<>();
298.     namespaceBO.setItems(itemBOs);
299. 
300.     //latest Release
301.     ReleaseDTO latestRelease;
302.     Map<String, String> releaseItems = new HashMap<>();
303.     Map<String, ItemDTO> deletedItemDTOs = new HashMap<>();
304.     latestRelease = releaseService.loadLatestRelease(appId, env, clusterName, namespaceName);
305.     if (latestRelease != null) {
306.       releaseItems = GSON.fromJson(latestRelease.getConfigurations(), GsonType.CONFIG);
307.     }
308. 
309.     //not Release config items
310.     List<ItemDTO> items = itemService.findItems(appId, env, clusterName, namespaceName);
311.     additionalUserInfoEnrichService
312.         .enrichAdditionalUserInfo(items, BaseDtoUserInfoEnrichedAdapter::new);
313.     int modifiedItemCnt = 0;
314.     for (ItemDTO itemDTO : items) {
315. 
316.       ItemBO itemBO = transformItem2BO(itemDTO, releaseItems);
317. 
318.       if (itemBO.isModified()) {
319.         modifiedItemCnt++;
320.       }
321. 
322.       itemBOs.add(itemBO);
323.     }
324. 
325.     //deleted items
326.     itemService.findDeletedItems(appId, env, clusterName, namespaceName).forEach(item -> {
327.       deletedItemDTOs.put(item.getKey(),item);
328.     });
329. 
330.     List<ItemBO> deletedItems = parseDeletedItems(items, releaseItems, deletedItemDTOs);
331.     itemBOs.addAll(deletedItems);
332.     modifiedItemCnt += deletedItems.size();
333. 
334.     namespaceBO.setItemModifiedCnt(modifiedItemCnt);
335. 
336.     return namespaceBO;
337.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/NamespaceService.java
Line number range: 339 - 369
Content:
339.   private void fillAppNamespaceProperties(NamespaceBO namespace) {
340. 
341.     final NamespaceDTO namespaceDTO = namespace.getBaseInfo();
342.     final String appId = namespaceDTO.getAppId();
343.     final String clusterName = namespaceDTO.getClusterName();
344.     final String namespaceName = namespaceDTO.getNamespaceName();
345.     //先从当前appId下面找,包含私有的和公共的
346.     AppNamespace appNamespace =
347.         appNamespaceService
348.             .findByAppIdAndName(appId, namespaceName);
349.     //再从公共的app namespace里面找
350.     if (appNamespace == null) {
351.       appNamespace = appNamespaceService.findPublicAppNamespace(namespaceName);
352.     }
353. 
354.     final String format;
355.     final boolean isPublic;
356.     if (appNamespace == null) {
357.       //dirty data
358.       LOGGER.warn("Dirty data, cannot find appNamespace by namespaceName [{}], appId = {}, cluster = {}, set it format to {}, make public", namespaceName, appId, clusterName, ConfigFileFormat.Properties.getValue());
359.       format = ConfigFileFormat.Properties.getValue();
360.       isPublic = true; // set to true, because public namespace allowed to delete by user
361.     } else {
362.       format = appNamespace.getFormat();
363.       isPublic = appNamespace.isPublic();
364.       namespace.setParentAppId(appNamespace.getAppId());
365.       namespace.setComment(appNamespace.getComment());
366.     }
367.     namespace.setFormat(format);
368.     namespace.setPublic(isPublic);
369.   }


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ReleaseService.java
Line number range: 61 - 113
Content:
61.   public ReleaseDTO publish(NamespaceReleaseModel model) {
62.     Env env = model.getEnv();
63.     boolean isEmergencyPublish = model.isEmergencyPublish();
64.     String appId = model.getAppId();
65.     String clusterName = model.getClusterName();
66.     String namespaceName = model.getNamespaceName();
67.     String releaseBy = StringUtils.isEmpty(model.getReleasedBy()) ?
68.                        userInfoHolder.getUser().getUserId() : model.getReleasedBy();
69. 
70.     ReleaseDTO releaseDTO = releaseAPI.createRelease(appId, env, clusterName, namespaceName,
71.                                                      model.getReleaseTitle(), model.getReleaseComment(),
72.                                                      releaseBy, isEmergencyPublish);
73. 
74.     Tracer.logEvent(TracerEventType.RELEASE_NAMESPACE,
75.                     String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
76. 
77.     return releaseDTO;
78.   }
79. 
80.   //gray deletion release
81.   public ReleaseDTO publish(NamespaceGrayDelReleaseModel model, String releaseBy) {
82.     Env env = model.getEnv();
83.     boolean isEmergencyPublish = model.isEmergencyPublish();
84.     String appId = model.getAppId();
85.     String clusterName = model.getClusterName();
86.     String namespaceName = model.getNamespaceName();
87. 
88.     ReleaseDTO releaseDTO = releaseAPI.createGrayDeletionRelease(appId, env, clusterName, namespaceName,
89.             model.getReleaseTitle(), model.getReleaseComment(),
90.             releaseBy, isEmergencyPublish, model.getGrayDelKeys());
91. 
92.     Tracer.logEvent(TracerEventType.RELEASE_NAMESPACE,
93.             String.format("%s+%s+%s+%s", appId, env, clusterName, namespaceName));
94. 
95.     return releaseDTO;
96.   }
97. 
98.   public ReleaseDTO updateAndPublish(String appId, Env env, String clusterName, String namespaceName,
99.                                      String releaseTitle, String releaseComment, String branchName,
100.                                      boolean isEmergencyPublish, boolean deleteBranch, ItemChangeSets changeSets) {
101. 
102.     return releaseAPI.updateAndPublish(appId, env, clusterName, namespaceName, releaseTitle, releaseComment, branchName,
103.                                        isEmergencyPublish, deleteBranch, changeSets);
104.   }
105. 
106.   public List<ReleaseBO> findAllReleases(String appId, Env env, String clusterName, String namespaceName, int page,
107.                                          int size) {
108.     List<ReleaseDTO> releaseDTOs = releaseAPI.findAllReleases(appId, env, clusterName, namespaceName, page, size);
109. 
110.     if (CollectionUtils.isEmpty(releaseDTOs)) {
111.       return Collections.emptyList();
112.     }
113. 


File: apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/service/ReleaseService.java
Line number range: 154 - 156
Content:
154.   public ReleaseDTO loadLatestRelease(String appId, Env env, String clusterName, String namespaceName) {
155.     return releaseAPI.loadLatestRelease(appId, env, clusterName, namespaceName);
156.   }

--- END AGGREGATED CONTEXT ---

Analyze if the current context is sufficient to complete the user query by considering:
1. Do you understand the full scope and requirements of the user query?
2. Do you have access to all relevant code that needs to be examined or modified?
3. Are all critical dependencies and their interfaces visible?
4. Is there enough context about the system architecture and design patterns?
5. Do you have access to relevant documentation or tests if needed?

Only request additional context if essential information is missing. Ensure you're not requesting:
- Information already provided in previous queries
- Nice-to-have but non-essential details
- Implementation details that aren't relevant to the current task

If additional context is needed:
- Be specific about what you're looking for
- Consider both code and documentation that might be relevant

IMPORTANT:
- Try to avoid asking for the SAME or very similar information as previous queries, because these queries have already been asked and satisfied.

2025-11-12 12:04:46,433 - thread-135845287823040.prometheus.lang_graph.nodes.context_refine_node - DEBUG - reasoning="We have most adminservice/portal controllers and services that read namespaces, plus InputValidator and configservice NamespaceUtil. However, the issue involves creating a namespace named '.' and crashing when querying it. To pinpoint the root cause, we still need: (1) portal-side namespace name utilities that may parse/split by '.', (2) the portal controller(s) and repository used to create AppNamespaces (to see how name '.' is persisted and displayed), and (3) any Spring MVC path matching configuration that could affect '.' handling in URL paths (since a single-dot path segment can be normalized by the container). Also, application.yml in portal/adminservice may configure suffix/path extension matching behavior. These are critical to understand and fix the 500 error path." query='Please provide the full source of apollo-portal AppNamespaceController (UI, not OpenAPI), any portal-side NamespaceUtil or similar name-parsing utility, the portal AppNamespaceRepository, and any Web MVC config classes; additionally, share application.yml of apollo-portal and apollo-adminservice for MVC/path-matching settings.' extra_requirements='If exact class names differ, include any controller handling app namespace creation, any utility that parses namespace names or file formats, any WebMvcConfigurer/WebMvcConfigurationSupport subclasses, and only the relevant spring.mvc and server.servlet settings from the YAMLs.' purpose='These components determine how a single-dot namespace is validated, persisted, parsed, and routed in URLs and will reveal why querying it triggers a 500 error and how to fix it.'
2025-11-12 12:04:46,435 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieving contexts from memory for query: Please provide the full source of apollo-portal AppNamespaceController (UI, not OpenAPI), any portal-side NamespaceUtil or similar name-parsing utility, the portal AppNamespaceRepository, and any Web MVC config classes; additionally, share application.yml of apollo-portal and apollo-adminservice for MVC/path-matching settings.
2025-11-12 12:04:46,758 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - DEBUG - Retrieved contexts: []
2025-11-12 12:04:46,759 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 memories from memory
2025-11-12 12:04:46,759 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - Retrieved 0 contexts from memory
2025-11-12 12:04:46,759 - thread-135845287823040.prometheus.lang_graph.nodes.memory_retrieval_node - INFO - After deduplication and sorting: 0 contexts from memory
2025-11-12 12:04:46,760 - thread-135845287823040.prometheus.lang_graph.nodes.reset_messages_node - DEBUG - Resetting context_provider_messages in state.
2025-11-12 12:04:46,762 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - INFO - Creating context provider message from refined query
2025-11-12 12:04:46,762 - thread-135845287823040.prometheus.lang_graph.nodes.add_context_refined_query_message_node - DEBUG - Query message: Essential query: Please provide the full source of apollo-portal AppNamespaceController (UI, not OpenAPI), any portal-side NamespaceUtil or similar name-parsing utility, the portal AppNamespaceRepository, and any Web MVC config classes; additionally, share application.yml of apollo-portal and apollo-adminservice for MVC/path-matching settings.
Extra requirements: If exact class names differ, include any controller handling app namespace creation, any utility that parses namespace names or file formats, any WebMvcConfigurer/WebMvcConfigurationSupport subclasses, and only the relevant spring.mvc and server.servlet settings from the YAMLs.
Purpose: These components determine how a single-dot namespace is validated, persisted, parsed, and routed in URLs and will reveal why querying it triggers a 500 error and how to fix it.
2025-11-12 12:04:55,670 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_Rd4QhFdEqdaxQMk1ipjqxIQi', 'function': {'arguments': '{"basename":"AppNamespaceController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 543, 'prompt_tokens': 2317, 'total_tokens': 2860, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2725e27a-3863-43f4-beba-4246a42ef72b-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceController.java'}, 'id': 'call_Rd4QhFdEqdaxQMk1ipjqxIQi', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2317, 'output_tokens': 543, 'total_tokens': 2860, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 12:04:57,982 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_zWkDSr0bFHDF8i5Sw54WSI3x', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 112, 'prompt_tokens': 2406, 'total_tokens': 2518, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 64, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--547bb519-59ac-4527-bba2-6248320ecb13-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java'}, 'id': 'call_zWkDSr0bFHDF8i5Sw54WSI3x', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2406, 'output_tokens': 112, 'total_tokens': 2518, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 64}}
2025-11-12 12:05:00,142 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_pt7I7h94KZBcP6xxo8M3DQUf', 'function': {'arguments': '{"basename":"NamespaceController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 158, 'prompt_tokens': 2512, 'total_tokens': 2670, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--08e65ba6-35ce-4ba2-87b7-bdfada062a86-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceController.java'}, 'id': 'call_pt7I7h94KZBcP6xxo8M3DQUf', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2512, 'output_tokens': 158, 'total_tokens': 2670, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 12:05:03,347 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_jQlubht6tjIpYAXnB5NU3ACO', 'function': {'arguments': '{"basename":"AppNamespaceController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 159, 'prompt_tokens': 2701, 'total_tokens': 2860, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 128, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f8b8f67a-fadc-4d0c-bf5f-8429c9e0e20e-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceController.java'}, 'id': 'call_jQlubht6tjIpYAXnB5NU3ACO', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2701, 'output_tokens': 159, 'total_tokens': 2860, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 128}}
2025-11-12 12:05:07,873 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_FtV9bzWlwtKSJ8dbEWutcXsv', 'function': {'arguments': '{"basename":"AppNamespaceService.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 287, 'prompt_tokens': 2790, 'total_tokens': 3077, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--1585a5b2-1e79-4ae7-88b6-a97c9c815a72-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceService.java'}, 'id': 'call_FtV9bzWlwtKSJ8dbEWutcXsv', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2790, 'output_tokens': 287, 'total_tokens': 3077, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 12:05:11,431 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_8JZXMKyrlUMxhLJa17yjOCSV', 'function': {'arguments': '{"basename":"NamespaceUtil.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 222, 'prompt_tokens': 2930, 'total_tokens': 3152, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 192, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--7b593e16-77c6-4855-a44d-a7429dc51665-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceUtil.java'}, 'id': 'call_8JZXMKyrlUMxhLJa17yjOCSV', 'type': 'tool_call'}] usage_metadata={'input_tokens': 2930, 'output_tokens': 222, 'total_tokens': 3152, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 192}}
2025-11-12 12:05:15,400 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_jF4fpphIoL3hcqU9Z9ZoBECa', 'function': {'arguments': '{"basename":"WebMvcConfig.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 415, 'prompt_tokens': 3017, 'total_tokens': 3432, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 384, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2432}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0a175ce5-6414-4dc2-b7b8-ce747f7bde31-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'WebMvcConfig.java'}, 'id': 'call_jF4fpphIoL3hcqU9Z9ZoBECa', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3017, 'output_tokens': 415, 'total_tokens': 3432, 'input_token_details': {'audio': 0, 'cache_read': 2432}, 'output_token_details': {'audio': 0, 'reasoning': 384}}
2025-11-12 12:05:20,618 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_jpJmRjICvnnH9jr1KYnTuqko', 'function': {'arguments': '{"basename":"AppNamespaceRepository.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 543, 'prompt_tokens': 3104, 'total_tokens': 3647, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2944}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--e910f398-1a8e-49d2-9706-10ca9b9f200f-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceRepository.java'}, 'id': 'call_jpJmRjICvnnH9jr1KYnTuqko', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3104, 'output_tokens': 543, 'total_tokens': 3647, 'input_token_details': {'audio': 0, 'cache_read': 2944}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 12:05:24,539 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_3BhEzN31HanSsTTRWgoNG1ci', 'function': {'arguments': '{"basename":"AppNamespaceController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 3246, 'total_tokens': 3277, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--fce01c3c-87cc-46fc-9f90-985a7f62995d-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceController.java'}, 'id': 'call_3BhEzN31HanSsTTRWgoNG1ci', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3246, 'output_tokens': 31, 'total_tokens': 3277, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:05:29,204 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_vQ1WHSh2LqkhgkRastrXhrR4', 'function': {'arguments': '{"basename":"NamespaceValidator.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 286, 'prompt_tokens': 3335, 'total_tokens': 3621, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2688}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b5175299-d2d5-4d6c-a516-be0691fc845e-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceValidator.java'}, 'id': 'call_vQ1WHSh2LqkhgkRastrXhrR4', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3335, 'output_tokens': 286, 'total_tokens': 3621, 'input_token_details': {'audio': 0, 'cache_read': 2688}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 12:05:35,925 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ePx8cGpfnRZE9q8vpH0rhKwo', 'function': {'arguments': '{"basename":"application.yml"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 541, 'prompt_tokens': 3385, 'total_tokens': 3926, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 512, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2304}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--d98e2717-910d-4515-a7cc-c60dedae82a4-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'application.yml'}, 'id': 'call_ePx8cGpfnRZE9q8vpH0rhKwo', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3385, 'output_tokens': 541, 'total_tokens': 3926, 'input_token_details': {'audio': 0, 'cache_read': 2304}, 'output_token_details': {'audio': 0, 'reasoning': 512}}
2025-11-12 12:05:37,041 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_YkUnYSy4mQhoLwRJNWilMLZx', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/main/resources/application.yml"}', 'name': 'find_file_node_with_relative_path'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 30, 'prompt_tokens': 3606, 'total_tokens': 3636, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3328}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f4679a2c-8d33-45db-898e-2b807b646abf-0' tool_calls=[{'name': 'find_file_node_with_relative_path', 'args': {'relative_path': 'apollo-adminservice/src/main/resources/application.yml'}, 'id': 'call_YkUnYSy4mQhoLwRJNWilMLZx', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3606, 'output_tokens': 30, 'total_tokens': 3636, 'input_token_details': {'audio': 0, 'cache_read': 3328}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:05:39,678 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_1AogAT38npYRi20x3xf24G1g', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/resources/application.yml"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 3686, 'total_tokens': 3717, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3200}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--be91c3d5-6002-4ec0-8543-8d53bc2185a2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/resources/application.yml'}, 'id': 'call_1AogAT38npYRi20x3xf24G1g', 'type': 'tool_call'}] usage_metadata={'input_tokens': 3686, 'output_tokens': 31, 'total_tokens': 3717, 'input_token_details': {'audio': 0, 'cache_read': 3200}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:05:40,879 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_xA9bAGuVUPfP7OcIRZnbM1ua', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/main/resources/application.yml"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 31, 'prompt_tokens': 4269, 'total_tokens': 4300, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--9c9d317b-d4ac-4355-a5c1-3c056feed16a-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/main/resources/application.yml'}, 'id': 'call_xA9bAGuVUPfP7OcIRZnbM1ua', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4269, 'output_tokens': 31, 'total_tokens': 4300, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:05:49,223 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_jB3jt92cQAEDho0VpPyNjRYL', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 881, 'prompt_tokens': 4934, 'total_tokens': 5815, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 832, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--8cc75bdb-572c-4aa6-895a-4b2de80fd3eb-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/controller/NamespaceController.java'}, 'id': 'call_jB3jt92cQAEDho0VpPyNjRYL', 'type': 'tool_call'}] usage_metadata={'input_tokens': 4934, 'output_tokens': 881, 'total_tokens': 5815, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 832}}
2025-11-12 12:05:54,566 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_aMBxSYA5wPnkBVPhc62KCYeC', 'function': {'arguments': '{"basename":"AppNamespaceController.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 287, 'prompt_tokens': 9184, 'total_tokens': 9471, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 256, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 4224}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--2c1410f1-f4aa-40ab-8509-2d017a0038f7-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'AppNamespaceController.java'}, 'id': 'call_aMBxSYA5wPnkBVPhc62KCYeC', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9184, 'output_tokens': 287, 'total_tokens': 9471, 'input_token_details': {'audio': 0, 'cache_read': 4224}, 'output_token_details': {'audio': 0, 'reasoning': 256}}
2025-11-12 12:05:56,076 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_ua4GwwvjQtcispQ0GecWZ2Uq', 'function': {'arguments': '{"relative_path":"apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 9273, 'total_tokens': 9316, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--646c8e83-42e1-4140-a93a-f83411624393-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-adminservice/src/main/java/com/ctrip/framework/apollo/adminservice/controller/AppNamespaceController.java'}, 'id': 'call_ua4GwwvjQtcispQ0GecWZ2Uq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 9273, 'output_tokens': 43, 'total_tokens': 9316, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:05:57,458 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_hyeL2y25P2T5CUJZOYnr4ySU', 'function': {'arguments': '{"relative_path":"apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 44, 'prompt_tokens': 10715, 'total_tokens': 10759, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2816}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--aef4d404-9bfd-4c9a-bb0d-c467a18070f9-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-portal/src/main/java/com/ctrip/framework/apollo/portal/repository/AppNamespaceRepository.java'}, 'id': 'call_hyeL2y25P2T5CUJZOYnr4ySU', 'type': 'tool_call'}] usage_metadata={'input_tokens': 10715, 'output_tokens': 44, 'total_tokens': 10759, 'input_token_details': {'audio': 0, 'cache_read': 2816}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:05:58,956 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_USPuha3ly0GCofAGbKbAMArK', 'function': {'arguments': '{"relative_path":"apollo-common/src/main/java/com/ctrip/framework/apollo/common/controller/WebMvcConfig.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 41, 'prompt_tokens': 11420, 'total_tokens': 11461, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3584}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--27686bce-98b1-420c-90e5-b5719ac7bec2-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/controller/WebMvcConfig.java'}, 'id': 'call_USPuha3ly0GCofAGbKbAMArK', 'type': 'tool_call'}] usage_metadata={'input_tokens': 11420, 'output_tokens': 41, 'total_tokens': 11461, 'input_token_details': {'audio': 0, 'cache_read': 3584}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:06:04,367 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_JjAVF8H1mHa1JUXpavn8ly6I', 'function': {'arguments': '{"basename":"InputValidator.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 350, 'prompt_tokens': 12390, 'total_tokens': 12740, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 3712}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--0485ead2-e22a-402b-b28f-66f97191d514-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'InputValidator.java'}, 'id': 'call_JjAVF8H1mHa1JUXpavn8ly6I', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12390, 'output_tokens': 350, 'total_tokens': 12740, 'input_token_details': {'audio': 0, 'cache_read': 3712}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 12:06:05,984 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_UbQgs0O13WD54Z8rn9632Rdq', 'function': {'arguments': '{"relative_path":"apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 40, 'prompt_tokens': 12474, 'total_tokens': 12514, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--dad5a930-26d8-4577-a1ee-aa914a318fe0-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-common/src/main/java/com/ctrip/framework/apollo/common/utils/InputValidator.java'}, 'id': 'call_UbQgs0O13WD54Z8rn9632Rdq', 'type': 'tool_call'}] usage_metadata={'input_tokens': 12474, 'output_tokens': 40, 'total_tokens': 12514, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:06:12,712 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_XtQWiiOx2QDZGBgUM5XB53Iv', 'function': {'arguments': '{"basename":"NamespaceUtils.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 350, 'prompt_tokens': 13179, 'total_tokens': 13529, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 320, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--b1d68c3b-2d2b-4dfb-bc17-a26e96e665e9-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceUtils.java'}, 'id': 'call_XtQWiiOx2QDZGBgUM5XB53Iv', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13179, 'output_tokens': 350, 'total_tokens': 13529, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 320}}
2025-11-12 12:06:13,892 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_pbtgL7pxET91KwGLn42ILtGw', 'function': {'arguments': '{"basename":"NamespaceUtil.java"}', 'name': 'find_file_node_with_basename'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 24, 'prompt_tokens': 13229, 'total_tokens': 13253, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 10752}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--f11b7b6f-c115-4123-abf5-4ed6a0e4e831-0' tool_calls=[{'name': 'find_file_node_with_basename', 'args': {'basename': 'NamespaceUtil.java'}, 'id': 'call_pbtgL7pxET91KwGLn42ILtGw', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13229, 'output_tokens': 24, 'total_tokens': 13253, 'input_token_details': {'audio': 0, 'cache_read': 10752}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:06:15,112 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='' additional_kwargs={'tool_calls': [{'id': 'call_SAlNYfMWDPX94fQwUNt19lxl', 'function': {'arguments': '{"relative_path":"apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java"}', 'name': 'read_file_with_knowledge_graph_data'}, 'type': 'function'}], 'refusal': None} response_metadata={'token_usage': {'completion_tokens': 43, 'prompt_tokens': 13316, 'total_tokens': 13359, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 0, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 13184}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'tool_calls', 'logprobs': None} id='run--026092ab-a79c-4119-9bcd-49d7904ee1df-0' tool_calls=[{'name': 'read_file_with_knowledge_graph_data', 'args': {'relative_path': 'apollo-configservice/src/main/java/com/ctrip/framework/apollo/configservice/util/NamespaceUtil.java'}, 'id': 'call_SAlNYfMWDPX94fQwUNt19lxl', 'type': 'tool_call'}] usage_metadata={'input_tokens': 13316, 'output_tokens': 43, 'total_tokens': 13359, 'input_token_details': {'audio': 0, 'cache_read': 13184}, 'output_token_details': {'audio': 0, 'reasoning': 0}}
2025-11-12 12:06:36,571 - thread-135845287823040.prometheus.lang_graph.nodes.context_provider_node - DEBUG - content='I located and provided the portal-side controller that handles app namespace creation (NamespaceController.java in apollo-portal) and the full source of the portal AppNamespaceRepository. For name parsing/validation used by the portal, I included InputValidator.java (used by the portal controller to validate namespace format) and noted there’s no separate NamespaceUtil in the portal module. I also included the Web MVC config class (WebMvcConfig.java, which implements WebMvcConfigurer and disables favorPathExtension) and extracted the relevant application.yml settings for apollo-portal and apollo-adminservice (no spring.mvc or server.servlet path-matching settings are defined in either; only spring.servlet.multipart appears in portal). These pieces together show how dot-containing namespace names are routed (via .+ path variable), validated, and persisted.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 2156, 'prompt_tokens': 14049, 'total_tokens': 16205, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1984, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 2048}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--e745f323-bba3-4d72-9019-cb2a6de1ef5f-0' usage_metadata={'input_tokens': 14049, 'output_tokens': 2156, 'total_tokens': 16205, 'input_token_details': {'audio': 0, 'cache_read': 2048}, 'output_token_details': {'audio': 0, 'reasoning': 1984}}
2025-11-12 12:06:36,575 - thread-135845287823040.prometheus.lang_graph.nodes.context_retrieval_subgraph_node - DEBUG - Graph recursion limit reached, returning empty context
2025-11-12 12:06:36,575 - thread-135845287823040.prometheus.lang_graph.nodes.issue_not_verified_bug_subgraph_node - DEBUG - GraphRecursionError encountered, returning empty patch
2025-11-12 12:06:58,003 - thread-135845287823040.prometheus.lang_graph.nodes.issue_bug_responder_node - DEBUG - content='Thanks for the clear report and the screen recording.\n\nSummary of the issue:\n- Creating a namespace whose name is a single dot (.) leads to a 500 error when querying/refreshing the namespace list in the Portal.\n\nTo help us diagnose this quickly, could you please share:\n- Exact component versions for Portal, AdminService, and ConfigService you’re running\n- How the namespace was created (Portal UI vs OpenAPI)\n- Relevant server-side logs and stack traces from:\n  - Portal at the time the 500 occurs\n  - AdminService/ConfigService handling the namespace query\n- The exact request path (from the browser dev tools or server logs) that returns 500\n- Database type and version\n\nIn the meantime, a practical workaround is to avoid using a single dot as the namespace name. Using an alphanumeric name (or at least including characters other than a lone dot) should prevent the error.\n\nOnce we have the logs and version details, we can pinpoint the root cause.' additional_kwargs={'refusal': None} response_metadata={'token_usage': {'completion_tokens': 1365, 'prompt_tokens': 549, 'total_tokens': 1914, 'completion_tokens_details': {'accepted_prediction_tokens': 0, 'audio_tokens': 0, 'reasoning_tokens': 1152, 'rejected_prediction_tokens': 0}, 'prompt_tokens_details': {'audio_tokens': 0, 'cached_tokens': 0}}, 'model_name': 'gpt-5-2025-08-07', 'system_fingerprint': None, 'finish_reason': 'stop', 'logprobs': None} id='run--8fc76e74-27ac-4686-96b8-25cfc521436e-0' usage_metadata={'input_tokens': 549, 'output_tokens': 1365, 'total_tokens': 1914, 'input_token_details': {'audio': 0, 'cache_read': 0}, 'output_token_details': {'audio': 0, 'reasoning': 1152}}
2025-11-12 12:06:58,005 - thread-135845287823040.prometheus.docker.base_container - INFO - Cleaning up container and temporary files
2025-11-12 12:06:58,005 - thread-135845287823040.prometheus.docker.base_container - INFO - Closing persistent shell...
2025-11-12 12:06:58,106 - thread-135845287823040.prometheus.docker.base_container - INFO - Cleaning up container and temporary files
2025-11-12 12:07:08,543 - thread-135845287823040.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - Generated patch:
None
2025-11-12 12:07:08,544 - thread-135845287823040.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - passed_reproducing_test: False
2025-11-12 12:07:08,544 - thread-135845287823040.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - passed_regression_test: False
2025-11-12 12:07:08,544 - thread-135845287823040.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - passed_existing_test: False
2025-11-12 12:07:08,544 - thread-135845287823040.prometheus.lang_graph.nodes.issue_bug_subgraph_node - INFO - issue_response:
Thanks for the clear report and the screen recording.

Summary of the issue:
- Creating a namespace whose name is a single dot (.) leads to a 500 error when querying/refreshing the namespace list in the Portal.

To help us diagnose this quickly, could you please share:
- Exact component versions for Portal, AdminService, and ConfigService you’re running
- How the namespace was created (Portal UI vs OpenAPI)
- Relevant server-side logs and stack traces from:
  - Portal at the time the 500 occurs
  - AdminService/ConfigService handling the namespace query
- The exact request path (from the browser dev tools or server logs) that returns 500
- Database type and version

In the meantime, a practical workaround is to avoid using a single dot as the namespace name. Using an alphanumeric name (or at least including characters other than a lone dot) should prevent the error.

Once we have the logs and version details, we can pinpoint the root cause.
